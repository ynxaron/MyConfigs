"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[53568,39447],{756191:(e,t,o)=>{o.d(t,{FR:()=>m,OY:()=>d,ic:()=>y,sB:()=>p,sG:()=>u,y_:()=>h});o(241792);var n=()=>o(513670),r=()=>o(696459),a=()=>o(834458),c=()=>o(193962),i=()=>o(455222),s=()=>o(177634);function l(e){switch(e){case"checkbox":return"boolean";case"number":return"number";case"text":return"text";case"date":return"date";case"array":return"array";case"block":return"block";case"person":return"person";case"select":return"select";case"function":return"function";case"unknown":return"unknown";case"undefined":return"undefined";default:(0,r().t1)(e)}}function u(e){switch(e.type){case i().$E.InvalidCharacter:return{...c().mr.InvalidCharacter,values:{errorCharacter:e.character}};case i().$E.UnclosedStringLiteral:return c().mr.UnclosedStringLiteral;case i().$E.UnclosedComment:return c().mr.UnclosedComment;case i().$E.TokenExpected:return{...c().mr.TokenExpected,values:{expectedToken:e.token}};case i().$E.StringLiteralContainsToken:return c().mr.StringLiteralContainsToken;case i().$E.ExpressionExpected:return c().mr.ExpressionExpected;case i().$E.PropertyTokenOrFunctionExpected:return c().mr.PropertyTokenOrFunctionExpected;case i().$E.EndOfInputExpected:return c().mr.EndOfInputExpected;case i().$E.UnexpectedError:return c().mr.UnexpectedError;case i().$E.TooDeeplyNested:return c().mr.TooDeeplyNested;default:(0,r().t1)(e)}}function p(e){switch(e.type){case i().h4.FunctionCallArgumentWrongType:case i().h4.FunctionCallUnexpectedArgument:return e.argument;default:return e.node}}function y(e,t){let o;switch(t.type){case i().h4.ThisRowTypeNotFound:o=c().o8.ThisRowTypeNotFound;break;case i().h4.ThisRowNotBlockWithCollection:o=c().o8.ThisRowNotBlockWithCollection;break;case i().h4.MissingPropertyOnThisRow:o={...c().o8.MissingPropertyOnThisRow,values:{propertyName:t.property}};break;case i().h4.MissingContextVariable:{const e=(0,s().Xp)(t.token)?t.token.contextValueId:t.token.valueId;o={...c().o8.MissingContextVariable,values:{valueId:e}}}break;case i().h4.MissingBlock:o={...c().o8.MissingBlock,values:{blockId:t.token.blockId}};break;case i().h4.CallingNotFunction:o={...c().o8.CallingNotFunction,values:{expressionType:l(t.callee.type.type)}};break;case i().h4.FunctionCallTooFewArguments:o={...c().o8.FunctionCallTooFewArguments,values:{minNumParameters:t.minNumParameters,functionName:t.libraryFunction.name,numArguments:t.numArguments}};break;case i().h4.FunctionCallUnexpectedArgument:o={...c().o8.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case i().h4.FunctionCallArgumentWrongType:o={...c().o8.FunctionCallArgumentWrongType,values:{argumentType:l(t.argument.type.type),functionName:t.libraryFunction.name}};break;case i().h4.MemberPropertyMismatchCollection:o={...c().o8.MemberPropertyMismatchCollection,values:{propertyName:t.token.property}};break;case i().h4.MemberPropertyMissing:o={...c().o8.MemberPropertyMissing,values:{propertyName:t.property}};break;case i().h4.MemberPropertyTargetNotBlock:o=c().o8.MemberPropertyTargetNotBlock;break;case i().h4.MemberPropertyTypeInvalid:o={...c().o8.MemberPropertyTypeInvalid,values:{propertyName:t.propertyName,propertyType:t.propertyType}};break;case i().h4.UndefinedIdentifier:o={...c().o8.UndefinedIdentifier,values:{identifier:t.node.text}};break;case i().h4.UnifiedFunctionCannotFindFunction:o={...c().o8.UnifiedFunctionCannotFindFunction,values:{functionName:t.name}};break;case i().h4.UnifiedFunctionNoArguments:o={...c().o8.UnifiedFunctionNoArguments,values:{functionName:t.libraryFunction.name}};break;case i().h4.UnifiedFunctionTargetWrongType:o={...c().o8.UnifiedFunctionTargetWrongType,values:{functionName:t.libraryFunction.name,targetType:l(t.expression.type.type)}};break;case i().h4.CannotRelativelyCompareTypes:o={...c().o8.CannotRelativelyCompareTypes,values:{lhsType:l(t.lhsType.type),rhsType:l(t.rhsType.type)}};break;case i().h4.CannotDoMathOnType:o={...c().o8.CannotDoMathOnType,values:{lhsType:l(t.lhsType.type),rhsType:l(t.rhsType.type)}};break;case i().h4.UnaryMinusOnNonNumber:o={...c().o8.UnaryMinusOnNonNumber,values:{type:l(t.expression.type.type)}};break;case i().h4.IdentifierExpected:o=c().o8.IdentifierExpected;break;case i().h4.FunctionCallExpected:o={...c().o8.FunctionCallExpected,values:{functionName:t.functionName}};break;case i().h4.RenamedIdentifier:o={...c().o8.RenamedIdentifier,values:{identifier:t.identifier,renamedTo:t.renamedTo}};break;case i().h4.RemovedFunction:o={...c().o8.RemovedFunction,values:{functionName:t.functionName,alternative:t.alternative}};break;case i().h4.ContextVariableNotBlockWithCollection:o={...c().o8.ContextVariableNotBlockWithCollection,values:{valueId:t.token.contextValueId}};break;case i().h4.MissingPropertyOnContextVariable:o={...c().o8.MissingPropertyOnContextVariable,values:{propertyName:t.property,valueId:t.token.contextValueId}};break;case i().h4.BlockPropertyTypeInvalid:o={...c().o8.BlockPropertyTypeInvalid,values:{propertyName:t.propertyName}};break;case i().h4.DisallowedReturnType:{const n=t.allowedReturnTypes.map((t=>e.formatMessage((0,a().getHumanReadableType)(t)).toLocaleLowerCase()));o={...c().o8.DisallowedReturnType,values:{allowedReturnType:e.formatList(n,{style:"long",type:"conjunction"}),allowedReturnTypeCount:t.allowedReturnTypes.length,returnType:e.formatMessage((0,a().getHumanReadableType)(t.returnType)).toLocaleLowerCase()}};break}case i().h4.CrossSpacePropertyNotSupported:o={...c().o8.CrossSpacePropertyNotSupported};break;default:(0,r().t1)(t)}return{...o,values:{...o.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}}function d(e,t){let o;switch(t.type){case i().FY.MissingThisRow:o=c().YG.MissingThisRow;break;case i().FY.MissingSchemaPropertyOnThisRow:o={...c().YG.MissingSchemaPropertyOnThisRow,values:{propertyName:t.property}};break;case i().FY.ThisRowBlockPropertyMismatchCollection:o=c().YG.ThisRowBlockPropertyMismatchCollection;break;case i().FY.MissingContextVariable:o={...c().YG.MissingContextVariable,values:{valueId:t.valueId}};break;case i().FY.IdentifierNotFound:o={...c().YG.IdentifierNotFound,values:{identifier:t.node.text}};break;case i().FY.CannotRelativelyCompareTypes:o={...c().YG.CannotRelativelyCompareTypes,values:{lhsType:l(t.lhsType),rhsType:l(t.rhsType)}};break;case i().FY.CannotDoMathOnType:o={...c().YG.CannotDoMathOnType,values:{valueType:l(t.valueType)}};break;case i().FY.CannotCallNonFunction:o={...c().YG.CannotCallNonFunction,values:{calleeType:l(t.calleeType)}};break;case i().FY.UnifiedFunctionPropertyNotFound:o={...c().YG.UnifiedFunctionPropertyNotFound,values:{functionName:t.node.name}};break;case i().FY.LibraryFunctionExecutionError:const n=t.error instanceof i().Mu?t.error:void 0;o=(null==n?void 0:n.info.type)===i().sj.DateInvalidDurationUnit?{...c().z8.DateInvalidDurationUnit,values:{functionName:t.libraryFunction.name,invalidUnit:n.info.invalidUnit}}:(null==n?void 0:n.info.type)===i().sj.CannotUseToNumberOnList?{...c().z8.CannotUseToNumberOnList}:(null==n?void 0:n.info.type)===i().sj.CannotRoundToNonInteger?{...c().z8.CannotRoundToNonInteger,values:{precision:n.info.precision}}:(null==n?void 0:n.info.type)===i().sj.CannotRoundToTooManyDecimalPlaces?{...c().z8.CannotRoundToTooManyDecimalPlaces,values:{precision:n.info.precision}}:{...c().YG.LibraryFunctionExecutionError,values:{functionName:t.libraryFunction.name}};break;case i().FY.FunctionCallTooFewArguments:o={...c().YG.FunctionCallTooFewArguments,values:{functionName:t.libraryFunction.name}};break;case i().FY.FunctionCallUnexpectedArgument:o={...c().YG.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case i().FY.FunctionCallArgumentWrongType:o={...c().YG.FunctionCallArgumentWrongType,values:{functionName:t.libraryFunction.name,argumentType:l(t.argumentType)}};break;case i().FY.AccessingPropertyOnNonBlock:o=c().YG.AccessingPropertyOnNonBlock;break;case i().FY.MissingDataDependencyBlock:o={...c().YG.MissingDataDependencyBlock,values:{blockId:t.blockPointer.id}};break;case i().FY.MissingDataDependencyPerson:o={...c().YG.MissingDataDependencyPerson,values:{personId:t.personPointer.id}};break;case i().FY.MemberPropertyMismatchCollection:o=c().YG.MemberPropertyMismatchCollection;break;case i().FY.MissingPropertyOnSchemaForMemberProperty:o=c().YG.MissingPropertyOnSchemaForMemberProperty;break;case i().FY.UnaryMinusOnNonNumber:o={...c().YG.UnaryMinusOnNonNumber,values:{expressionType:l(t.expressionType)}};break;case i().FY.UnexpectedRecoveryNode:o=c().YG.UnexpectedRecoveryNode;break;case i().FY.UnexpectedError:o=c().YG.UnexpectedError;break;case i().FY.DepthExceeded:o=c().YG.DepthExceeded;break;case i().FY.CycleDetected:o=c().YG.CycleDetected;break;case i().FY.DownstreamParseFailure:o=c().YG.DownstreamParseFailure;break;case i().FY.MaxEvaluationTimeExceeded:o=c().YG.MaxEvaluationTimeExceeded;break;case i().FY.MissingSchemaPropertyOnCollection:o={...c().YG.MissingSchemaPropertyOnCollection,values:{collectionId:t.collectionId,propertyName:t.property}};break;case i().FY.ContextVariableWrongType:o={...c().YG.ContextVariableWrongType,values:{expectedType:t.expectedType,propertyType:t.resultType,valueId:t.valueId}};break;case i().FY.DisallowedValueType:{const n=t.allowedValueTypes.map((t=>e.formatMessage((0,a().getHumanReadableType)(t)).toLocaleLowerCase()));o={...c().o8.DisallowedReturnType,values:{allowedValueType:e.formatList(n,{style:"long",type:"conjunction"}),allowedValueTypeCount:t.allowedValueTypes.length,valueType:e.formatMessage((0,a().getHumanReadableValueType)(t.expressionValue)).toLocaleLowerCase()}};break}default:(0,r().t1)(t)}return(0,s().w7)(t)?{...o,values:{...o.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}:o}function m(e){const t=null==e?void 0:e.values;return[n().CE(e,"values"),t]}function h(e){return e.type===i().FY.DepthExceeded||e.type===i().FY.CycleDetected||e.type===i().FY.MaxEvaluationTimeExceeded||e.type===i().FY.LibraryFunctionExecutionError}},853031:(e,t,o)=>{o.r(t),o.d(t,{hasAccessDefaultFn:()=>F,hasAccessToCode:()=>b,hasAccessToProperty:()=>k,hasReadPermissionsAccess:()=>T,hasSameSpaceAccess:()=>x,testOnly:()=>g});o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(653476);var n=()=>o(513670),r=()=>o(839002),a=()=>o(855741),c=()=>o(696459),i=()=>o(226413),s=()=>o(92960),l=()=>o(216316),u=()=>o(177634),p=()=>o(407589),y=()=>o(748627);function*d(e){const{collectionPointer:t,context:o,propertyId:n,propertySchema:r,visitedPointers:a,hasAccessFn:c}=e,i=(0,l().M)({...t,propertyId:n});if(a.has(i))return!0;a.add(i);const s=c({propertySchema:r,spaceId:o.spaceId});return"boolean"==typeof s?s:yield*s}function*m(e){var t,o;const{collectionPointer:r,depth:p,collectionSchema:d,context:m,propertyId:h,propertySchema:f,visitedPointers:F,hasAccessFn:T}=e;if("v2"!==f.version||p>s().FORMULA_MAX_DEPTH)return!1;const x=(0,l().M)({...r,propertyId:h});if(F.has(x))return!0;if(F.add(x),!(0,c().$K)(null===(t=f.formula2)||void 0===t?void 0:t.code))return!0;const k=(0,y().H)(null===(o=f.formula2)||void 0===o?void 0:o.code);if(a().x.isFail(k))return!1;const{spaceId:b}=m,g=(0,l().jm)({formulaTypecheckContextValues:[{kind:s().FormulaContextValueKind.ThisRow,type:{collection:r,type:"block"}}],node:k.value,spaceId:b}),P=(0,n().mN)(g,(e=>(0,l().M)(e)));if(0===P.length)return!0;const{getRecordModel:S}=yield{collectionBlockProperties:[{blockPointers:[],collectionPointer:r,property:h,schema:d}],recordPointers:P.filter((e=>(0,u().no)(e)))};for(const n of P)if((0,i().rv)(n)){const e=S(n);if(!(0,c().$K)(e))return!1;const t=n.propertyId,o=e.getSchema(),r=o[t];if(!r)continue;if((0,i().no)(r)||(0,i().AF)(r)){if(!(yield*v({collectionPointer:n,collectionSchema:o,context:m,depth:p+1,propertyId:t,propertySchema:r,visitedPointers:F,hasAccessFn:T})))return!1}else if((0,i().p_)(r)){if(!(yield*v({collectionPointer:n,collectionSchema:o,context:m,depth:p,propertyId:t,propertySchema:r,visitedPointers:F,hasAccessFn:T})))return!1}}else if(!(0,c().$K)(S(n)))return!1;return!0}function*h(e){const{collectionPointer:t,depth:o,collectionSchema:n,context:r,propertyId:a,propertySchema:c,visitedPointers:u,hasAccessFn:y}=e;if("v2"===c.version||o>s().FORMULA_MAX_DEPTH)return!1;const d=(0,l().M)({...t,propertyId:a});if(u.has(d))return!0;u.add(d);const m=(0,p().b$)(c.formula);if(0===m.length)return!0;for(const s of m){const e=n[s];if(e)if((0,i().no)(e)||(0,i().AF)(e)){if(!(yield*v({collectionPointer:t,depth:o+1,collectionSchema:n,context:r,propertyId:s,propertySchema:e,visitedPointers:u,hasAccessFn:y})))return!1}else if((0,i().p_)(e)){if(!(yield*v({collectionPointer:t,collectionSchema:n,context:r,depth:o,propertyId:s,propertySchema:e,visitedPointers:u,hasAccessFn:y})))return!1}}return!0}function*f(e){const{collectionPointer:t,depth:o,collectionSchema:n,context:r,propertyId:a,propertySchema:c,visitedPointers:u,hasAccessFn:p}=e;if(o>s().FORMULA_MAX_DEPTH)return!1;const y=(0,l().M)({...t,propertyId:a});if(u.has(y))return!0;if(u.add(y),!c.relation_property||!c.target_property)return!0;const d=n[c.relation_property];if(!d||"relation"!==d.type)return!0;const m=p({propertySchema:d,spaceId:r.spaceId});if(!("boolean"==typeof m?m:yield*m))return!1;const h=(0,i().j0)(d);if(!h)return!0;const{getRecordModel:f}=yield{recordPointers:[h]},F=f(h),T=null==F?void 0:F.getNormalizedSchema();if(c.target_property_type&&T){const e=T[c.target_property];if(e&&c.target_property_type===e.type){if((0,i().AF)(e))return yield*v({collectionPointer:h,collectionSchema:T,context:r,depth:o+1,propertyId:c.target_property,propertySchema:e,visitedPointers:u,hasAccessFn:p});if((0,i().p_)(e))return yield*v({collectionPointer:h,collectionSchema:T,context:r,depth:o,propertyId:c.target_property,propertySchema:e,visitedPointers:u,hasAccessFn:p})}}return!0}function*v(e){const{collectionPointer:t,depth:o,collectionSchema:n,context:r,propertyId:a,propertySchema:c,visitedPointers:s,hasAccessFn:l}=e;return(0,i().p_)(c)?yield*d({collectionPointer:t,context:r,propertyId:a,propertySchema:c,visitedPointers:s,hasAccessFn:l}):(0,i().AF)(c)?"v2"===c.version?yield*m({collectionPointer:t,depth:o,collectionSchema:n,context:r,propertyId:a,propertySchema:c,visitedPointers:s,hasAccessFn:l}):yield*h({collectionPointer:t,depth:o,collectionSchema:n,context:r,propertyId:a,propertySchema:c,visitedPointers:s,hasAccessFn:l}):!(0,i().no)(c)||(yield*f({collectionPointer:t,depth:o,collectionSchema:n,context:r,propertyId:a,propertySchema:c,visitedPointers:s,hasAccessFn:l}))}function*F(e){const{propertySchema:t,spaceId:o}=e,n=(0,i().j0)(t);if(!(0,c().$K)(n))return!0;const{getRecordModel:r}=yield{recordPointers:[n]},a=r(n);return(0,c().$K)(a)&&x({spaceId:o,propertySchema:t})}function*T(e){const{propertySchema:t}=e,o=(0,i().j0)(t);if(!(0,c().$K)(o))return!0;const{getRecordModel:n}=yield{recordPointers:[o]},r=n(o);return(0,c().$K)(r)}function x(e){const{propertySchema:t,spaceId:o}=e;return!(0,i().Qh)(o,t)}async function k(e){const{collectionPointer:t,collectionSchema:o,context:n,propertyId:a,hasAccessFn:c}=e,i=o[a];return!i||await async function(e){const{context:t}=e;try{const o=v(e);let n=o.next();for(;!n.done;){const e=t.handleDataRequest(n.value);n=o.next((0,r().tI)(e)?await e:e)}return n.value}catch(o){return!0}}({collectionPointer:t,depth:0,collectionSchema:o,context:n,propertyId:a,propertySchema:i,visitedPointers:new Set,hasAccessFn:c})}function b(e){const{context:t}=e;try{const o=function*(e){const{collectionPointer:t,depth:o,context:r,code:p,visitedPointers:d,hasAccessFn:m}=e,h=(0,y().H)(p);if(a().x.isFail(h))return!1;const{spaceId:f}=r,F=r.valueTypes.filter((e=>e.kind!==s().FormulaContextValueKind.ThisRow)),T=(0,l().jm)({formulaTypecheckContextValues:t?[...F,{kind:s().FormulaContextValueKind.ThisRow,type:{collection:t,type:"block"}}]:[],node:h.value,spaceId:f}),x=(0,n().mN)(T,(e=>(0,l().M)(e)));if(0===x.length)return!0;const{getRecordModel:k}=yield{collectionBlockProperties:[],recordPointers:x.filter((e=>(0,u().no)(e)))};for(const n of x)if((0,i().rv)(n)){const e=k(n);if(!(0,c().$K)(e))return!1;const t=n.propertyId,a=e.getSchema(),s=a[t];if(!s)continue;if((0,i().no)(s)||(0,i().AF)(s)){if(!(yield*v({collectionPointer:n,collectionSchema:a,context:r,depth:o+1,propertyId:t,propertySchema:s,visitedPointers:d,hasAccessFn:m})))return!1}else if((0,i().p_)(s)&&!(yield*v({collectionPointer:n,collectionSchema:a,context:r,depth:o,propertyId:t,propertySchema:s,visitedPointers:d,hasAccessFn:m})))return!1}else if(!(0,c().$K)(k(n)))return!1;return!0}(e);let r=o.next();for(;!r.done;){const e=t.handleDataRequest(r.value);r=o.next(e)}return r.value}catch(o){return!0}}const g={hasAccessDefaultFn:F,hasAccessToProperty:k,hasAccessToFormula1Property:h,hasAccessToFormula2Property:m,hasAccessToRelationProperty:d,hasAccessToRollupProperty:f}},907874:(e,t,o)=>{o.r(t),o.d(t,{analyzeSimpleFormulaOrFormulaSync:()=>i,executeSimpleFormulaAsyncWithStats:()=>d,filterTextValueToSimpleFormulaValueTokens:()=>F().hX,fromSimpleFormulaArrayValue:()=>F().A6,getDependenciesForSimpleFormula:()=>F().w9,getDependenciesForSimpleFormulaOrFormula:()=>F().fK,getReferencedContextValueIds:()=>F().UB,isAnnotationSimpleValueToken:()=>F().S3,setPropertyValueToFormulaReturnType:()=>F().H0,setPropertyValueToSimpleFormulaReturnType:()=>F().qW,simpleFormulaValueTypeToFormulaReturnType:()=>F().LX,simpleFormulaValueWithoutToken:()=>F().Ck,singleSimpleValueTokenToTextToken:()=>F().L4,toSimpleFormulaArrayValue:()=>F().iC,toSimpleFormulaSingleValue:()=>F().YD,typecheckSimpleFormulaOrFormula:()=>s});o(670560),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624);var n=()=>o(696459),r=()=>o(955620),a=()=>o(853031),c=()=>o(22183);function i(e){const{context:t,value:o}=e;if((0,n().$K)(o)&&(0,n().$K)(o.value)){if("simple"===o.type)return function(e,t){const o=[],n=[];for(const a of e){const e=(0,r().hDy)(a);if(!(0,r().IVR)(e))continue;const i=(0,c().analyzeFormulaSync)([a],t);o.push(...i.parseErrors??[]),n.push(...i.typeErrors??[])}return{type:{type:"text"},parseErrors:o,typeErrors:n}}(o.value,t);{const e=(0,c().analyzeFormulaSync)(o.value,t);return(0,n().$K)(e.type)?e:{parseErrors:e.parseErrors,type:{type:"unknown"},typeErrors:e.typeErrors}}}return{type:{type:"unknown"}}}function s(e){const{context:t,value:o,collectionPointer:n}=e,c=performance.now(),s=i({context:t,value:o}),l=Math.trunc(performance.now()-c),u=!(s.typeErrors&&0!==s.typeErrors.length||s.parseErrors&&0!==s.parseErrors.length),p=!!u&&function(e){let{context:t,value:o,collectionPointer:n}=e;if(!t.featureGates.collections_xws||!o.value)return!1;let c=!1;if("formula"===o.type){(0,a().hasAccessToCode)({collectionPointer:n,context:t,depth:0,code:o.value,visitedPointers:new Set,hasAccessFn:a().hasSameSpaceAccess})||(c=!0)}else if("simple"===o.type)for(const i of o.value){const e=(0,r().hDy)(i);if(!(0,r().IVR)(e))continue;(0,a().hasAccessToCode)({collectionPointer:n,context:t,depth:0,code:[i],visitedPointers:new Set,hasAccessFn:a().hasSameSpaceAccess})||(c=!0)}return c}({context:t,value:o,collectionPointer:n});return{result:s,hasCrossSpaceError:p,stats:{formulaTypecheckDurationMs:void 0,formulaTypecheckSuccess:void 0,formulaExecutionDurationMs:void 0,formulaExecutionSuccess:void 0,totalFormulas:void 0,simpleFormulaTypecheckDurationMs:void 0,simpleFormulaTypecheckSuccess:void 0,simpleFormulaExecutionDurationMs:void 0,simpleFormulaExecutionSuccess:void 0,totalSimpleFormulas:void 0,..."simple"===o.type?{simpleFormulaTypecheckDurationMs:l,simpleFormulaTypecheckSuccess:u,totalSimpleFormulas:1}:{formulaTypecheckDurationMs:l,formulaTypecheckSuccess:u,totalFormulas:1}}}}o(267602),o(653476),o(241792);var l=()=>o(855741),u=()=>o(532850),p=()=>o(177634);function y(e){return!("number"===e.type||"text"===e.type||"checkbox"===e.type)}async function d(e){const{context:t,value:o}=e,r=performance.now(),a=await m(e),c=Math.trunc(performance.now()-r),i=l().x.isSuccess(a);return"simple"===o.type?y(t.returnType)?{result:a,stats:{formulaTypecheckDurationMs:void 0,formulaTypecheckSuccess:void 0,formulaExecutionDurationMs:void 0,formulaExecutionSuccess:void 0,totalFormulas:void 0,simpleFormulaTypecheckDurationMs:void 0,simpleFormulaTypecheckSuccess:void 0,simpleFormulaExecutionDurationMs:c,simpleFormulaExecutionSuccess:i,totalSimpleFormulas:1}}:{result:a}:"formula"===o.type?{result:a,stats:{formulaTypecheckDurationMs:void 0,formulaTypecheckSuccess:void 0,formulaExecutionDurationMs:c,formulaExecutionSuccess:i,totalFormulas:1,simpleFormulaTypecheckDurationMs:void 0,simpleFormulaTypecheckSuccess:void 0,simpleFormulaExecutionDurationMs:void 0,simpleFormulaExecutionSuccess:void 0,totalSimpleFormulas:void 0}}:(0,n().t1)(o.type)}async function m(e){const{context:t,executeFormula:o,ignoreErrors:a,value:c}=e,{returnType:i}=t,s=c.value;if("simple"===c.type){let e=s;if(!y(i)&&v(e)){const n=await h({context:t,executeFormula:o,value:e});if(l().x.isFail(n))return a?{value:{type:"undefined"}}:n;e=n.value}if("number"===i.type){const t=u().VY(e);return(0,n().$K)(t)&&!isNaN(t)?{value:{type:"number",value:t}}:{value:{type:"undefined"}}}if("text"===i.type)return{value:{type:"text",value:e??[]}};if("checkbox"===i.type){return{value:{type:"checkbox",value:"true"===r().QaF(e)}}}return o(t,e)}return"formula"===c.type?o(t,s):(0,n().t1)(c.type)}async function h(e){const{context:t,executeFormula:o,ignoreErrors:a,value:c}=e;if(!(0,n().$K)(c))return{value:void 0};const i=[];let s=[];for(const n of c)if(s=r().hDy(n),r().sP4(s)){const e=await o(t,[n]);if(l().x.isFail(e)&&!a)return e;l().x.isSuccess(e)&&i.push(...f((0,p().j4)(e.value),s))}else if(r().jRb(s)){const e=await o(t,[n]);if(l().x.isFail(e)&&!a)return e;l().x.isSuccess(e)&&i.push(...f((0,p().j4)(e.value),s))}else i.push(n);return{value:i}}function f(e,t){if(0===r().VrM(e))return e;const o=t.filter((e=>r().inx(e)));return 0===o.length?e:r().Zxt(e.map((e=>{const t=r().hDy(e);return 0===t.length?r().V3y(r().WiV(e),o):r().V3y(r().WiV(e),r().wrb(t,o))})))}function v(e){if(!(0,n().$K)(e))return!1;let t;for(const o of e)if(t=r().hDy(o),0!==t.length&&r().IVR(t))return!0;return!1}var F=()=>o(610856)}}]);