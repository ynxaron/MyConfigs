"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[34291],{632599:(e,t,r)=>{r.d(t,{Z:()=>i});var a=r(667294),n=()=>r(846550),s=()=>r(729201),l=()=>r(312578),o=r(785893);function i(e){let{loadingMessage:t}=e;const r=(0,n().Fg)(),i=(0,s().Z)(!0,400);return(0,o.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:i&&(0,o.jsxs)(a.Fragment,{children:[(0,o.jsx)(l().Z,{}),t&&(0,o.jsx)("div",{style:{marginLeft:8,color:r.text.secondary},children:t})]})})}},945634:(e,t,r)=>{r.d(t,{Z:()=>d});r(667294);var a=()=>r(219727),n=()=>r(142735),s=()=>r(846550),l=()=>r(459805),o=()=>r(965913),i=()=>r(589525),u=r(785893);function c(){const e=(0,s().yK)((e=>({icon:{position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===e.mode?e.regularTextColor:"#3E3C38",stroke:"dark"===e.mode?e.surface.wash:"white",strokeWidth:"dark"===e.mode?"1.85px":"1.5px"}})),[]);return(0,u.jsx)("div",{children:(0,o().Y)(e.icon)})}function d(e){var t;const r=(0,a().O7)(),o=r.device.isMobile,d=(0,n().VK)((()=>{var t,a;if(o)return r.WindowSizeStore.getSafePaddingLeftCSS("number"==typeof(null===(t=e.style)||void 0===t?void 0:t.paddingLeft)?null===(a=e.style)||void 0===a?void 0:a.paddingLeft:10)}),[r.WindowSizeStore,o,null===(t=e.style)||void 0===t?void 0:t.paddingLeft]),h=(0,s().yK)((t=>({wrapper:{...o?{display:"flex",alignItems:"center",width:"100%",minHeight:26,fontSize:16,paddingTop:8,paddingBottom:8,paddingLeft:d,paddingRight:10,userSelect:"none",boxShadow:void 0,marginBottom:e.shouldShowMobileMarginBottom?12:1}:{display:"flex",alignItems:"center",width:"100%",fontSize:14,minHeight:e.isBottomItem?24:27,height:i().H3,paddingTop:4,paddingBottom:4,...(0,l().MF)()},...e.style},icon:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,flexGrow:0,width:o?28:22,height:o?24:18,marginRight:8,position:"relative"},right:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,flexGrow:0,height:"100%",...e.rightStyle},left:{flexShrink:0,flexGrow:0,borderRadius:4,color:t.mediumTextColor,width:o?24:i().MY,height:o?24:i().MY,display:"flex",alignItems:"center",justifyContent:"center",marginRight:e.icon?0:8},children:{flexGrow:1,flexShrink:1,flexBasis:"auto",whiteSpace:"nowrap",minWidth:0,overflow:"hidden",textOverflow:e.right&&!o?"clip":"ellipsis",...e.childrenStyle}})),[o,d,e.shouldShowMobileMarginBottom,e.isBottomItem,e.style,e.rightStyle,e.icon,e.right,e.childrenStyle]);return(0,u.jsxs)("div",{role:e.role,dir:"ltr","aria-current":e["aria-current"],"aria-expanded":e["aria-expanded"],"aria-owns":e["aria-owns"],"aria-labelledby":e["aria-labelledby"],style:h.wrapper,onFocus:e.onFocus,onBlur:e.onBlur,onMouseMove:e.onMouseMove,onMouseLeave:e.onMouseLeave,onClick:e.onClick,className:e.className,children:[e.left&&(0,u.jsx)("div",{style:h.left,children:e.left}),e.icon&&(0,u.jsxs)("div",{style:h.icon,children:[e.icon,e.isAlias&&(0,u.jsx)(c,{})]}),(0,u.jsx)("div",{style:h.children,children:e.children}),e.right&&(0,u.jsx)("div",{style:h.right,children:e.right})]})}},709237:(e,t,r)=>{r.d(t,{z:()=>n});r(667294);var a=r(785893);const n=(0,r(827282).IU)("sidebarHome",{viewBox:"0 0 20 20",svg:(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.54446 3.06854C9.8066 2.84385 10.1934 2.84385 10.4556 3.06854L15.7064 7.56922C16.0832 7.89219 16.3 8.36369 16.3 8.85996V14.6C16.3 15.5389 15.5389 16.3 14.6 16.3H11.75C11.3634 16.3 11.05 15.9866 11.05 15.6V11.7H8.95001V15.6C8.95001 15.9866 8.63661 16.3 8.25001 16.3H5.40001C4.46113 16.3 3.70001 15.5389 3.70001 14.6V8.85996C3.70001 8.36369 3.91687 7.89219 4.29367 7.56922L9.54446 3.06854ZM10 4.52198L5.20477 8.63218C5.13828 8.68918 5.10001 8.77238 5.10001 8.85996V14.6C5.10001 14.7657 5.23433 14.9 5.40001 14.9H7.55001V11.5C7.55001 10.8373 8.08727 10.3 8.75001 10.3H11.25C11.9128 10.3 12.45 10.8373 12.45 11.5V14.9H14.6C14.7657 14.9 14.9 14.7657 14.9 14.6V8.85996C14.9 8.77238 14.8617 8.68918 14.7952 8.63218L10 4.52198Z"})})},343931:(e,t,r)=>{r.d(t,{K_:()=>m,N8:()=>v,YD:()=>E,hR:()=>g,nJ:()=>_,nt:()=>S});r(267602),r(653476),r(749411);var a=()=>r(730120),n=()=>r(245015),s=()=>r(696459),l=()=>r(636340),o=()=>r(269299),i=()=>r(348141),u=()=>r(989134),c=()=>r(876822),d=()=>r(934262),h=()=>r(772529),f=()=>r(232222);function _(e){const{currentUserSettingsStore:t}=c().default.state;t&&o().createAndCommit({userAction:"SidebarPersonalHomeButton.markAsSeen",environment:e,canUndo:!0,perform:e=>{i().d2({userSettingsStore:t,transaction:e,data:{seen_personal_home:!0}})}})}function g(e){const{currentUserSettingsStore:t}=c().default.state;t&&(d().default.setState({type:"inactive"}),o().createAndCommit({userAction:"SidebarPersonalHomeButton.markHomeTooltipAsSeen",environment:e,canUndo:!0,perform:e=>{i().d2({userSettingsStore:t,transaction:e,data:{personal_home_delayed_tooltip_dismissed_at:a().ou.now().toMillis()}})}}))}function E(e){const{environment:t,newSeenWelcomeHomeValue:r}=e,a=c().default.state.currentSpaceViewStore;a&&o().createAndCommit({userAction:"SidebarPersonalHomeSettings.markWelcomeAnimationAsSeen",environment:t,canUndo:!0,perform:e=>{const t=a.getSettingsStore().getKeyStore("personal_home").getKeyStore("seen_welcome_animation");l().sO({store:t,transaction:e,value:r})}})}function m(e){const{environment:t,tipType:r,completed:a}=e,{currentUserSettingsStore:n}=c().default.state;if(!n)return;const s=n.getPersonalHomeTipsSettings(),l={...s,progress_data:{...s.progress_data,[r]:{completed:a}}};o().createAndCommit({userAction:"LearnHomePanel.updateProgress",environment:t,canUndo:!0,perform:e=>{i().d2({userSettingsStore:n,transaction:e,data:{personal_home_tips_settings:l}})}})}function v(e){const{environment:t,hide:r}=e,{currentUserSettingsStore:a}=c().default.state;if(!a)return;const n={...a.getPersonalHomeTipsSettings(),hide_completed:r};o().createAndCommit({userAction:"LearnHomePanel.hideCompleted",environment:t,canUndo:!0,perform:e=>{i().d2({userSettingsStore:a,transaction:e,data:{personal_home_tips_settings:n}})}})}function S(e){const{blockId:t,enabledFeatures:r,userId:a}=e,l=(0,s().qP)(r).flatMap((e=>{let[t,r]=e;if(!r)return[];switch(t){case"tasks":return[(0,h().Ep)("myTasksAssignedToMeCollectionView")];case"customDb":const e=(0,h().Ep)("customDb");return[e&&(0,u().Zs)({userId:a,viewBlockId:e})].filter(s().$K);case"similarUsersAndTrending":return[(0,h().Ep)("similarUsersCollectionView"),(0,h().Ep)("trendingCollectionView")];case"unifiedFeed":return[(0,h().Ep)("postsCollectionView")];case"recents":case"updates":case"templates":case"tips":case"calendar":return[];default:(0,s().t1)(t)}})),{isHomeKey:o,homeCollectionViewIdsKey:i}=(0,f().C)(t);n().Z.set(o,!0),n().Z.set(i,l)}},307853:(e,t,r)=>{r.d(t,{Y:()=>ee,f:()=>X});r(267602),r(916054),r(653476),r(470928),r(749411),r(30005),r(241792),r(228244);var a=()=>r(619186),n=()=>r(396136),s=()=>r(53432),l=()=>r(899133),o=()=>r(513670),i=()=>r(342792),u=()=>r(696459),c=()=>r(326966),d=()=>r(28162),h=()=>r(594546),f=()=>r(8),_=()=>r(90065);r(670560),r(122556),r(582845),r(250570),r(533019),r(721473),r(788208),r(22624);async function g(e){const{spaceId:t,userId:a,blocks:n,environment:s}=e,l=n.map((e=>e.blockModel.id));if(!t||!a||!(0,u().Of)(l))return;const o=await r(824462).callApi({eventName:"getPageSignals",environment:s,data:{spaceId:t,pageIds:l,includeRecords:!0,signals:[{name:"pageAuthorityV1"}]}});if("success"===o.type){const e=l.map((e=>({})));o.data.signals.forEach((t=>{if("success"===t.status){const{name:r,data:a}=t;a.forEach(((t,a)=>{e[a][r]=t}))}}));const r=(0,c().m8)(e.map(((e,t)=>[l[t],e]))),n=m.getKey(t,a);m.update((e=>{const t=e.pageSignals.get(n),a=e.pageSignals.set(n,{...t,...r});return{...e,pageSignals:a}}))}}class E extends(()=>r(263184))().default{getInitialState(){return{pageSignals:new Map}}getKey(e,t){return`${e}:${t}`}getPageSignals(e){let{spaceId:t,userId:r}=e;if(!t||!r)return;const a=this.getKey(t,r),n=this.state.pageSignals.get(a);return n||void 0}async updatePageSignals(e){const{spaceId:t,userId:r,blocks:a}=e;if(!t||!r)return;const n=this.getPageSignals(e),s=void 0===n?a:a.filter((e=>!n.hasOwnProperty(e.blockModel.id)));if(s.length>0&&await g({...e,blocks:s}),n){const e=Object.keys(n).length+s.length;if(e>2048){const s=e-2048,l=new Set(a.map((e=>e.blockModel.id)));!function(e){const{spaceId:t,userId:r,pageIds:a}=e,n=m.getKey(t,r);m.update((e=>{const t={...e.pageSignals.get(n)};a.forEach((e=>delete t[e]));const r=e.pageSignals.set(n,t);return{...e,pageSignals:r}}))}({spaceId:t,userId:r,pageIds:Object.keys(n).filter((e=>!l.has(e))).slice(0,s)})}}}}const m=new E;class v{constructor(e,t,a){var n;this.featuresets=void 0,this.queryLower=void 0,this.userId=void 0,this.spaceId=void 0,this.currentTimeMs=void 0,this.currentDateMs=void 0,this.pageSignals=void 0,this.resultsFeatureMetadata={},this.recentPagesMap=void 0,this.featuresets=e,this.queryLower=a.toLowerCase();const s=t.currentUser.id,l=null===(n=r(876822).default.state.currentSpaceStore)||void 0===n?void 0:n.id;this.userId=s,this.spaceId=l,this.currentTimeMs=Date.now(),this.currentDateMs=new Date(new Date(this.currentTimeMs).toDateString()).getTime(),this.pageSignals=m.getPageSignals({spaceId:this.spaceId,userId:this.userId}),this.recentPagesMap=o().HP((()=>{const e=(l?r(63317).Z.get(l):[])??[];return new Map(e.map((e=>[e.pageId,e.visitedAt])))}))}searchFrecencyVisits(e){const{spaceId:t,userId:a}=this;if(t&&a)return(0,r(214445).xA)({spaceId:t,userId:a,pageId:e})}searchSimilarUserVisits(e){const{spaceId:t,userId:a}=this;if(t&&a)return function(e){const{spaceId:t,userId:a,pageId:n}=e,s=r(768905).default.getUserSignals({spaceId:t,userId:a});if(!s)return;return s.similarUserRecentPages[n]}({spaceId:t,userId:a,pageId:e})}extractFeatureGroup(e){const t=[];for(const r of this.featuresets){const a={groupName:r.name,features:[]};for(const t of r.features)a.features.push(t({result:e,featureExtractor:this}));t.push(a)}return t}}var S=()=>r(524434),p=()=>r(749826),T=()=>r(128076),C=()=>r(625820),I=()=>r(735039);function R(e){return Number.isFinite(e)?e:0}const O={name:"CLIENT_FEATURESET_RELEVANCY_MODEL",features:[function(e){let{result:t,featureExtractor:r}=e;return{name:"TIME_SINCE_LAST_EDIT",value:r.currentTimeMs-t.block.blockModel.last_edited_time}},function(e){let{result:t,featureExtractor:r}=e;return{name:"IS_LAST_EDITED_BY_ME",value:r.userId&&t.block.blockModel.last_edited_by_id===r.userId?1:0}},function(e){let{result:t,featureExtractor:r}=e;return{name:"IS_CREATED_BY_ME",value:r.userId&&t.block.blockModel.created_by_id===r.userId?1:0}},...l().ik.map((e=>t=>{let{result:r}=t;return{name:`BLOCK_SOURCE_${e}`,value:r.block.source.has(e)?1:0}})),function(e){var t;let{result:r,featureExtractor:a}=e;return{name:"PAGE_AUTHORITY_V1",value:a.pageSignals?null===(t=a.pageSignals[r.block.blockModel.id])||void 0===t?void 0:t.pageAuthorityV1:void 0}},function(e){let{result:t}=e;return{name:"TITLE_LENGTH",value:t.block.text.length}},function(e){let{result:{terms:t},featureExtractor:{queryLower:r}}=e;return{name:"TERMS_COUNT_NORMALIZED",value:R(t.length/(0,I().pv)(r).length)}},function(e){let{result:{terms:t},featureExtractor:{queryLower:r}}=e;const a=(0,I().pv)(r),n=new Set(t);return{name:"FULL_MATCH_TERM_COUNT_NORMALIZED",value:R(a.filter((e=>n.has(e))).length/a.length)}},function(e){let{result:{terms:t,block:{text:r}}}=e;const a=(0,I().pv)(r.toLowerCase());return{name:"MATCHING_PERCENTAGE_OF_TITLE",value:R(t.length/a.length)}}]},M={name:"CLIENT_FEATURESET_RELEVANCY_MODEL_UNIFIED",features:[function(e){let{result:t,featureExtractor:r}=e;const a=t.block.blockModel.id,n=r.recentPagesMap().get(a),s=r.currentDateMs,l=Math.max(n??-1);return l<0?{name:"RECENT_VISIT_SCORE",value:U}:{name:"RECENT_VISIT_SCORE",value:1+L({nowDateMs:s,visitedAt:l})}},function(e){let{result:t,featureExtractor:r}=e;const a=t.block.blockModel.id,n=r.searchFrecencyVisits(a),s=r.currentDateMs;if(!n)return{name:"SEARCH_FRECENCY_SCORE",value:U};const l=n.visits.map((e=>L({nowDateMs:s,visitedAt:e}))),i=(0,o().Sm)(l)/l.length;return{name:"SEARCH_FRECENCY_SCORE",value:1+n.totalVisits*i}},function(e){let{result:t,featureExtractor:r}=e;const a=t.block.blockModel.id,n=r.searchSimilarUserVisits(a);return n&&n.sortedSimilarUserSignals.length?{name:"SIMILAR_USER_VISIT_SCORE",value:1+n.sortedSimilarUserSignals[0].similarity}:{name:"SIMILAR_USER_VISIT_SCORE",value:0}},function(e){let{result:t,featureExtractor:r}=e;return{name:"MINISEARCH_SCORE",value:t.minisearchScore}},function(e){let{result:t,featureExtractor:r}=e;return{name:"MINISEARCH_SCORE_BOOST",value:t.score/t.minisearchScore}}]};function L(e){let{nowDateMs:t,visitedAt:r}=e;const a=new Date(new Date(r).toDateString()).getTime(),n=Math.max(Math.round((t-a)/c().A0),0);return A[Math.min(n,119)]??0}const A=[1,.434123725,.2014437701,.1884654745,.15822173,.1422946031,.142166057,.1585730404,.104180793,.08345552147,.08087231107,.07897914664,.07896564574,.08624855475,.1008828419,.07266583529,.06040518516,.05852083656,.05753743353,.05815673014,.0642358674,.07381557067,.05695876233,.04843320955,.0470903377,.0466126019,.04746668155,.05325934739,.06307552903,.04855074175,.04160564903,.04030096372,.0391499705,.03939387352,.04339750927,.04955280165,.03917733172,.03338547498,.03209648275,.03168258564,.03227832486,.03591521672,.04128251996,.03310833841,.02833391706,.0272294016,.02689436518,.02729836191,.03046923141,.03441215965,.02831271484,.02449716514,.02354647072,.02317412649,.02358864378,.0263629034,.03012237319,.02459941584,.02126459634,.02046809053,.02030330894,.02052315898,.0228313469,.02579947184,.02105456017,.01811545682,.01734374938,.01698213336,.01714570426,.01897155626,.02136217635,.01769765159,.01529119728,.01463419502,.01431262545,.01444443674,.0159017961,.01772871671,.01474489776,.01280999558,.01220517103,.01190906906,.01197576757,.01314474565,.01475010088,.01212414472,.01051461218,.009996802444,.009711358103,.009723316362,.01077170102,.01191292066,.009778124374,.008391943098,.007831708926,.007399958434,.007365904844,.008059776794,.008782521067,.007061224987,.006022772552,.005622109974,.005249218012,.005053326649,.005458692089,.005740997442,.004543123306,.00380476497,.003402129751,.003036012596,.002836157214,.00291875208,.00288708271,.002093633442,.001635128163,.001354411665,.001031197037,.0007361583583,.0005966154595,.000366973101],U=.4558522322;r(821057),r(731107);function y(e,t){return N(e,t,0)}function N(e,t,r){const a=t[r];if("value"in a)return a.value;const{feature:n,threshold:s,left:l,right:o}=a;return e[n]<=s?N(e,t,o):N(e,t,l)}const b=[{feature:"NUMBER_OF_BLOCK_SOURCES",threshold:.9803883731365204,left:1,right:64},{feature:"NUMBER_OF_BLOCK_SOURCES",threshold:-.02051524817943573,left:2,right:33},{feature:"TITLE_LENGTH",threshold:-.9804741442203522,left:3,right:18},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:4,right:11},{feature:"PAGE_AUTHORITY_V1",threshold:.9929431676864624,left:5,right:8},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:6,right:7},{value:.055661729574773056},{value:.11489805030510493},{feature:"IS_LAST_EDITED_BY_ME",threshold:.5,left:9,right:10},{value:.1303473491773309},{value:.2761679479597871},{feature:"PAGE_AUTHORITY_V1",threshold:.7070983946323395,left:12,right:15},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:13,right:14},{value:.15403218305273927},{value:.2901420576840293},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:16,right:17},{value:.3969548667754214},{value:.5434689507494647},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:19,right:26},{feature:"PAGE_AUTHORITY_V1",threshold:-9373319335297929e-20,left:20,right:23},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:21,right:22},{value:.019246861924686193},{value:.0422577337207315},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.38750000298023224,left:24,right:25},{value:.04463445567238064},{value:.08163417730973187},{feature:"PAGE_AUTHORITY_V1",threshold:.9430259466171265,left:27,right:30},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:28,right:29},{value:.04921499627799959},{value:.11522081288769559},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:31,right:32},{value:.15812057498390902},{value:.26642904878592116},{feature:"TITLE_LENGTH",threshold:-.8644499182701111,left:34,right:49},{feature:"PAGE_AUTHORITY_V1",threshold:.7071063816547394,left:35,right:42},{feature:"TIME_SINCE_LAST_EDIT",threshold:-.9999998509883881,left:36,right:39},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.7386363744735718,left:37,right:38},{value:.5046524356869184},{value:.6139737991266375},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.9545454680919647,left:40,right:41},{value:.35265916931762176},{value:.4631217838765009},{feature:"IS_LAST_EDITED_BY_ME",threshold:.5,left:43,right:46},{feature:"BLOCK_SOURCE_teamPage",threshold:.5,left:44,right:45},{value:.5826717293752157},{value:.3459669582118562},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.9285714328289032,left:47,right:48},{value:.6696084874659657},{value:.7931906286870049},{feature:"PAGE_AUTHORITY_V1",threshold:.7071079015731812,left:50,right:57},{feature:"TIME_SINCE_LAST_EDIT",threshold:-.7071194350719452,left:51,right:54},{feature:"TITLE_LENGTH",threshold:.0027717105112969875,left:52,right:53},{value:.3084340622029064},{value:.20221830985915493},{feature:"TITLE_LENGTH",threshold:.0014528378378599882,left:55,right:56},{value:.19599360481519798},{value:.12874983418294833},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:58,right:61},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.3484848588705063,left:59,right:60},{value:.1674727932285369},{value:.2761101463656661},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.3229166716337204,left:62,right:63},{value:.31311018131101814},{value:.4333284274045184},{feature:"TITLE_LENGTH",threshold:-.8199742436408997,left:65,right:96},{feature:"PAGE_AUTHORITY_V1",threshold:.9987315237522125,left:66,right:81},{feature:"TIME_SINCE_LAST_EDIT",threshold:-.7075438499450684,left:67,right:74},{feature:"TERMS_COUNT_NORMALIZED",threshold:.7859025001525879,left:68,right:71},{feature:"NUMBER_OF_BLOCK_SOURCES",threshold:1.0080004930496216,left:69,right:70},{value:.6666666666666666},{value:.5572065378900446},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.8090909123420715,left:72,right:73},{value:.730962836028703},{value:.82483781278962},{feature:"TERMS_COUNT_NORMALIZED",threshold:.7750000059604645,left:75,right:78},{feature:"BLOCK_SOURCE_defaultRecordCache",threshold:.5,left:76,right:77},{value:.5598243688254665},{value:.3112244897959184},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:79,right:80},{value:.48986486486486486},{value:.6522655426765016},{feature:"TIME_SINCE_LAST_EDIT",threshold:-.9759486615657806,left:82,right:89},{feature:"IS_CREATED_BY_ME",threshold:.5,left:83,right:86},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:84,right:85},{value:.7596830985915493},{value:.8754666411409974},{feature:"TERMS_COUNT_NORMALIZED",threshold:.7750000059604645,left:87,right:88},{value:.8577648766328012},{value:.9412431085265464},{feature:"TERMS_COUNT_NORMALIZED",threshold:.9000000059604645,left:90,right:93},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.7083333432674408,left:91,right:92},{value:.7364085667215815},{value:.4639175257731959},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:94,right:95},{value:.7003610108303249},{value:.8495272810115048},{feature:"PAGE_AUTHORITY_V1",threshold:.9999995827674866,left:97,right:112},{feature:"TITLE_LENGTH",threshold:1.0038834810256958,left:98,right:105},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:99,right:102},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:100,right:101},{value:.18298261665141813},{value:.34929850024189646},{feature:"TIME_SINCE_LAST_EDIT",threshold:-.7071070969104767,left:103,right:104},{value:.5148422178641469},{value:.42366514623021195},{feature:"NUMBER_OF_BLOCK_SOURCES",threshold:1.3351261019706726,left:106,right:109},{feature:"TITLE_LENGTH",threshold:1.4187065362930298,left:107,right:108},{value:.2810958904109589},{value:.14157014157014158},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:110,right:111},{value:.19499105545617174},{value:.40776554596846176},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:113,right:120},{feature:"PAGE_AUTHORITY_V1",threshold:1.4150558710098267,left:114,right:117},{feature:"TITLE_LENGTH",threshold:.09616653248667717,left:115,right:116},{value:.5727355901189387},{value:.4002079002079002},{feature:"TITLE_LENGTH",threshold:.36996421217918396,left:118,right:119},{value:.3089700996677741},{value:.10194174757281553},{feature:"PAGE_AUTHORITY_V1",threshold:1.000001072883606,left:121,right:124},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.22649572789669037,left:122,right:123},{value:.6954795357361027},{value:.7911777488048675},{feature:"TITLE_LENGTH",threshold:-.2670345604419708,left:125,right:126},{value:.7278492480521833},{value:.5908471377647305}],w=["PAGE_AUTHORITY_V1"],x=["TIME_SINCE_LAST_EDIT"],k=["TIME_SINCE_LAST_EDIT","PAGE_AUTHORITY_V1","TITLE_LENGTH","NUMBER_OF_BLOCK_SOURCES"];class B extends Error{constructor(e,t){super(e),this.name="MathError",this.cause=void 0,this.cause=t}}function G(e){if(0===e.length)throw new Error("Can't compute std of an empty array.");const t=(0,o().J6)(e),r=(0,o().Sm)(e.map((e=>Math.pow(e-t,2))))/e.length;return Math.sqrt(r)}const H=[function(e){return{name:"NUMBER_OF_BLOCK_SOURCES",value:e.reduce(((e,t)=>{let{name:r,value:a}=t;return void 0!==a&&r.startsWith("BLOCK_SOURCE")?e+a:e}),0)}}];function P(e){return[...e,...H.map((t=>t(e)))]}const K={TIME_SINCE_LAST_EDIT:-.17725330223424154,IS_LAST_EDITED_BY_ME:.16176141450635628,IS_CREATED_BY_ME:.0593282388860205,BLOCK_SOURCE_spacePage:-.1800298837847493,BLOCK_SOURCE_recentVisit:.38019907955270416,BLOCK_SOURCE_bookmarkedPage:.2273554336295929,BLOCK_SOURCE_sharedPage:-.11405912441003871,BLOCK_SOURCE_frecencyStore:.7303811564943883,BLOCK_SOURCE_teamPage:-.3886937481702676,BLOCK_SOURCE_defaultRecordCache:-.08630181620439217,BLOCK_SOURCE_similarUser1dRecentPages:.1516065982402135,BLOCK_SOURCE_topPages7dPageView:.04024980669809112,BLOCK_SOURCE_editedPages1d:-.12760596916369363,BLOCK_SOURCE_similarUsersEditedPages1d:-.209104241796053,BLOCK_SOURCE_unknown:0,PAGE_AUTHORITY_V1:.4303514640388112,TITLE_LENGTH:-.4316382562266375,TERMS_COUNT_NORMALIZED:-.1032745452783248,FULL_MATCH_TERM_COUNT_NORMALIZED:.18313025417928205,MATCHING_PERCENTAGE_OF_TITLE:1.0003388486917193,NUMBER_OF_BLOCK_SOURCES:.7940652678793755},D=-2.48072057;function V(e){const t=e.map((e=>{let{name:t,value:r}=e;return K[t]*(r??0)}));return r=(0,o().Sm)([D,...t]),1/(1+Math.exp(-r/2));var r}function F(e){if(e.some((e=>{let{value:t}=e;return void 0===t})))return 0;const t=(0,c().m8)(e.map((e=>{let{name:t,value:r}=e;return[t,r]}))),r=[b].map((e=>y(t,e)));return(0,o().J6)([...r,V(e)])}const Y=1.25,j=[O],Z=0;function $(e){const{results:t,featureGroups:r,shouldCalculateRelevancies:a}=e,n=t.map(((e,t)=>{const{block:a,score:n,personalizationBoost:s,rendered:o,terms:i}=e;return{sources:[l().vp.Local],id:a.blockModel.id,spaceId:a.blockModel.space_id,score:n,localSource:a.source,personalizationBoost:s,terms:i,highlight:{text:o},featureGroups:r[t]}})),s=a?function(e){const t=j.map(((t,r)=>{const a=e.map((e=>{var t;let{featureGroups:a}=e;return null===(t=a[r])||void 0===t?void 0:t.features}));if(a.some((e=>void 0===e)))return;return function(e){const t=(0,o().Xh)(e);for(const s of t)for(const e of s)(0,u().DE)(w,e.name)?e.value??=0:(0,u().DE)(x,e.name)&&(e.value=Math.log(e.value??1));const r=new Map,a=new Map,n=new Map;for(const s of t)for(const e of s)if(void 0!==e.value&&(0,u().DE)(k,e.name)){r.has(e.name)||r.set(e.name,[]);const t=r.get(e.name);t&&t.push(e.value)}for(const[s,l]of r.entries())a.set(s,(0,o().J6)(l)),n.set(s,G(l));for(const s of t)for(const e of s)if((0,u().DE)(k,e.name)){const t=a.get(e.name),r=n.get(e.name);if(void 0===e.value||void 0===t||void 0===r)throw new B(`Couldn't scale feature ${e.name}`);e.value=0===r?0:(e.value-t)/r}return t}(a.map(P)).map(F)}));if(!t.some((e=>void 0===e)))return(0,o().Ri)(t.filter(u().$K))}(n):void 0;return n.map(((e,t)=>({...e,localRelevancies:void 0!==s?s[t]:void 0})))}function q(e,t,r){const a=e=>r.matches(e.block),n=(0,s().wS)(t);if(1===n.length)return e.search(t,{filter:a,prefix:!0,fields:["text","inits"]});const l=e.search(t,{filter:a,combineWith:"AND",fields:["text"]});if(l.length>0)return l;const o=n.filter((e=>e.length>=I().Qu)),i=(u=o.length,Math.round(.6*u+.5));var u;return e.search(t,{filter:e=>e.queryTerms.length>=i&&a(e)})}function z(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function W(e){const{block:t,score:r,terms:a}=e,{source:n,text:s}=t,o=a.map(z).join("|"),i=new RegExp(o,"ig");var u;return{block:t,rendered:a.length>0?s.replaceAll(i,`${l().Um}$&${l().dK}`):s,score:r,personalizationBoost:(u=n).has("recentVisit")||u.has("frecencyStore")||u.has("bookmarkedPage")||u.has("defaultRecordCache")?Y:1,terms:a,minisearchScore:e.minisearchScore??r}}function J(e,t,r){const{blocks:n,getAllBlocks:s}=e,l=r.text.trim(),o=(0,i().nv)(l),u=o.length>0?o.join(" "):l,c=new(f().uL)(t);return u.length>0?function(e){const{blocksIndex:t,queryString:r,filterMatcher:n}=e,s=q(t,r,n),l=S().KR.isQuickFindEnabled()||"search_frecency_store_new_recency_score"===p().default.getGroup("search_local_ranking_new_frecency_and_score")?{exactMatch:a().DF,prefixMatch:1.5,wordPrefixMatch:1.25,substringMatch:1}:{exactMatch:a().DF,prefixMatch:a().uI,wordPrefixMatch:a().V5,substringMatch:a().T6};return s.map((e=>{const t=(0,I().RA)(r,e.block.text,l);return{...e,score:e.score*t,minisearchScore:e.score}})).map(W)}({blocksIndex:n,queryString:u,filterMatcher:c}):s().filter((e=>c.matches(e.block))).map(W)}const Q=(0,o().Ds)(((e,t)=>{t[0].featureGroups.forEach(((r,a)=>{let{groupName:n}=r;const s=t.map((e=>({features:e.featureGroups[a].features,id:e.id})));(0,h().K4)(e,"search_local_result_features",{search_session_id:d().LT(),group_name:n,results_features:s})}))}),1e3,{leading:!1,trailing:!0});function X(e){let{query:t,localCachedPages:r,userId:a,includeRecordMap:n,environment:s,shouldUseNewRerankerDebugOverrideEnabled:l}=e;const{query:i,limit:u}=t,{filters:c,sort:d}=i,h=J(r,c,i),g=S().KR.isQuickFindEnabled()||"search_frecency_store_new_recency_score"===p().default.getGroup("search_local_ranking_new_frecency_and_score");if(0===h.length)return;const E=function(e,t){const{field:r}=e,a="relevance"===r||"desc"===e.direction?-1:1;switch(r){case"lastEdited":case"scroll":return(0,o().MR)(t,(e=>{let{block:{blockModel:t}}=e;return a*(t.last_edited_time||0)}));case"created":return(0,o().MR)(t,(e=>{let{block:{blockModel:t}}=e;return a*(t.created_time||0)}));default:return(0,o().MR)(t,(e=>{let{score:t}=e;return a*t}))}}(d,h),m="relevance"===d.field,T=l||"on"===p().default.getEligibleGroup({experimentId:"search-use-local-reranker-layered",parameter:"shouldUseLocalReranker",defaultGroup:"control"}),I=function(e,t,r,a){const n=new v(t,e,r);return a.map((e=>n.extractFeatureGroup(e)))}(s,g?T?[O,M]:[M]:j,t.query.text,E),R=$({results:E,featureGroups:I,shouldCalculateRelevancies:T}),L=T&&R.every((e=>{let{localRelevancies:t}=e;return void 0!==t&&t.length>0&&void 0!==t[Z]})),A=m?L?(U=Z,R.sort(((e,t)=>{let{localRelevancies:r}=e,{localRelevancies:a}=t;return(a??[])[U]-(r??[])[U]}))):g?function(e){const t=e.map((e=>{const t=e.featureGroups.flatMap((e=>e.groupName===M.name?e.features:[])).find((e=>"SEARCH_FRECENCY_SCORE"===e.name)),r=t?t.value:void 0;return r&&(e.score*=r),e}));return(0,o().MR)(t,(e=>{let{score:t}=e;return-1*t}))}(R):(0,f().YB)({sort:d,currentUserId:a,unsorted:R,batchSize:C().Xv}):R;var U;const y=A.slice(0,u);return(0,_().QV)({results:y,recordMap:r.recordMap}),{total:h.length,results:y,recordMap:n??1?r.recordMap.toJson():{},trackEventProperties:void 0,allMatchingResultIds:A.map((e=>e.id))}}function ee(e){let{query:t,localCachedPages:r,parentStore:a,isOnline:s,environment:i,shouldLimitLocalResultsWhenOnline:_,canUseLtr:g,shouldUseNewRerankerDebugOverrideEnabled:E}=e;const m=X({query:t,localCachedPages:r,userId:i.currentUser.id,environment:i,shouldUseNewRerankerDebugOverrideEnabled:E});if(!m)return;if(0===m.results.length)return{error:l().Ix.NoResults};const v=m.results.map(((e,t)=>({...e,originalPosition:t,store:T().G.createChildStore(a,{table:n().iU,id:e.id}),serverEventProperties:void 0}))),S=s&&_,C=(S?e=>(0,f().g8)(i,e):e=>e)(v);if(0===C.length)return{error:l().Ix.NoResults};const I=v.map((e=>{let{localRelevancies:t}=e;return t})),R=(0,o().Ri)(I.filter(u().$K)),O=R.map(o().J6),M=(0,o().Ri)(C.map((e=>{let{localRelevancies:t}=e;return t})).filter(u().$K)).map(o().J6),L=I.some(u().$K)?{...(0,c().m8)(R.map(((e,t)=>[`result_relevancies_${t}`,e]))),result_relevancies_means:O,visible_result_relevancy_means:M}:{},A=t.query.text.length>1&&g;return(0,h().K4)(i,"search_local_recall_results",{results:v.map(te),search_session_id:d().LT(),num_local_results:C.length,are_results_limited:S,...L}),A&&(Q(i,C),p().default.logEvent("visible_local_search_results",C.length,{resultRelevancyV1:O[0],visibleResultRelevancyV1:M[0]})),{value:{total:v.length,totalResultIds:v.map((e=>e.id)),allMatchingResultIds:m.allMatchingResultIds,results:C,debugInfo:void 0}}}function te(e){const{id:t,localSource:r}=e;return{id:t,localSource:[...r??[]]}}},53432:(e,t,r)=>{r.d(t,{wS:()=>s});r(267602),r(653476),r(30005);var a=()=>r(513670);const n=/[-./\\()"'’‘”“，。、·～；,;<>~!@#$%^&*|+=[\]{}`~?:\s]/u;function s(e){return(0,a().oA)(e.split(n))}}}]);