"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[13856,82164],{491925:(e,t,o)=>{o.d(t,{Ty:()=>l,hW:()=>a,nI:()=>s,vp:()=>c});o(267602),o(653476),o(241792);var n=()=>o(142735),r=()=>o(696459),i=()=>o(469753);const a=(0,o(788860).vU)({unsupportedPublicQuestionType:{defaultMessage:"This question type cannot be used in public forms.",id:"useNewQuestionPropertyMenuItems.invalidPublicQuestionType"},relatedCollectionNotPublic:{defaultMessage:"Only relations to public databases are supported in public forms.",id:"formEditorQuestion.relatedCollectionNotPublic"},editorPlaceholder:{defaultMessage:"Respondent's answer",id:"formEditorQuestion.editorPlaceholder"},viewerEmptyPlaceholder:{defaultMessage:"Your answer",id:"formEditorQuestion.viewerEmptyPlaceholder"}});function s(e){let{layoutStore:t,collectionStore:o}=e;const a=(0,n().VK)((()=>t.getFormQuestionsForFormLayout()??[]),[t]),s=(0,n().VK)((()=>a.map((e=>{var t;return null===(t=e.getConfig())||void 0===t?void 0:t.propertyId})).filter(r().$K)),[a]);return(0,n().VK)((()=>{if(!o)return[];const e=o.getSchema();if(!t.getModel())return[];return(0,r().qP)(e).map((e=>{let[t,o]=e;if(o&&(0,i().I0)(o)&&!s.includes(t))return t})).filter(r().$K)}),[o,t,s])}function l(e){const t=e.type;return["person","relation","multi_select"].includes(t)}function c(e,t){var o;if(!e||!l(e))return;const n=e.type,r=null==t||null===(o=t.getPropertyTypeSpecificConfig(n))||void 0===o?void 0:o.maxSelectionCount;if("multi_select"===e.type)return r;const i=e.limit;return void 0===r?i:void 0===i||r<i?r:i}},675334:(e,t,o)=>{o.d(t,{Z:()=>d});o(667294);var n=()=>o(219727),r=()=>o(846550),i=()=>o(714230),a=()=>o(788860),s=()=>o(707513),l=()=>o(396439),c=o(785893);function d(e){const t=(0,a().YB)(),o=function(e){const{isMobile:t}=(0,n().Fy)(),o=t?18:14,i=1,a=6,l=20;return(0,r().yK)((t=>({githubContainer:{display:"flex",alignSelf:"center",flexDirection:"column",width:e||"90%",padding:l,border:`${i}px solid ${t.tableDividerColor}`,borderRadius:a,borderBottomRightRadius:6,cursor:"default"},githubPrTitleRow:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",width:`calc(100% + ${l}px)`,overflow:"hidden"},githubPrTitle:{display:"inline-flex",fontSize:o,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",background:t.whiteButtonBackground,padding:"2px 4px",borderTopLeftRadius:5,borderBottomLeftRadius:5,borderLeft:`2px solid ${t.blueColor}`,borderTop:`2px solid ${t.blueColor}`,borderBottom:`2px solid ${t.blueColor}`,width:"100%"},githubTask:{background:"light"===t.mode?t.accentColors.blue[50]:t.accentColors.blue[400]},githubPrInfoRow:{display:"inline-flex"},githubPrInfoPill:{display:"flex",flexDirection:"row",alignItems:"center",width:"fit-content",padding:"4px 10px",borderRadius:"2em",background:"#238636",flexShrink:0,...s().Yu},githubPrInfoOpenText:{color:"white",fontSize:o-2,fontWeight:500},githubPrInfoMergeInto:{display:"inline-flex",alignItems:"center",fontSize:o-2,color:t.lightTextColor,...s().Yu},githubPrInfoMain:{padding:"0px 4px",fontFamily:s().Gl.githubMono,background:t.cardPressedBackground,borderRadius:a,color:t.regularTextColor,verticalAlign:"text-bottom",...s().Yu}})),[o,e])}(e.width),d=(0,c.jsx)("div",{id:"github-preview-github-pr-title-row",style:o.githubPrTitleRow,children:(0,c.jsxs)("div",{id:"github-preview-github-pr-title-wrapper",style:o.githubPrTitle,children:[(0,c.jsx)(l().Z,{size:2}),"[",(0,c.jsxs)("div",{id:"github-preview-github-pr-task",style:o.githubTask,children:[e.uniqueIdPrefix||t.formatMessage(u.idPrefix),e.uniqueIdValue?`-${e.uniqueIdValue}`:"-1"]}),"]",(0,c.jsx)(l().Z,{size:2}),t.formatMessage(u.prTitle)]})}),p=(0,c.jsxs)("div",{id:"github-preview-github-pr-info-row",style:o.githubPrInfoRow,children:[(0,c.jsxs)("div",{id:"github-preview-github-open-pr-pill",style:o.githubPrInfoPill,children:[(0,c.jsx)("img",{src:i().Z.images.externalIntegrations.githubPullOpenIconWhitePng,style:{width:16,height:16}}),(0,c.jsx)(l().Z,{size:2}),(0,c.jsx)("div",{style:o.githubPrInfoOpenText,children:t.formatMessage(u.open)})]}),(0,c.jsx)(l().Z,{size:8}),(0,c.jsx)("div",{id:"github-preview-github-merge-into-main",style:o.githubPrInfoMergeInto,children:(0,c.jsxs)("span",{style:o.githubPrInfoMergeInto,children:[t.formatMessage(u.mergeInto),(0,c.jsx)(l().Z,{size:4}),(0,c.jsx)("span",{style:o.githubPrInfoMain,children:t.formatMessage(u.main)})]})})]});return(0,c.jsxs)("div",{id:"github-preview-github-container",style:o.githubContainer,children:[d,(0,c.jsx)(l().Z,{size:12}),p]})}const u=(0,a().vU)({dismissButtonAriaLabel:{defaultMessage:"A button to dismiss the user education preview.",id:"database.viewSettings.githubConfigTab.preview.dismissButtonAriaLabel"},idPrefix:{defaultMessage:"TASK",id:"database.viewSettings.githubConfigTab.preview.idPrefix"},prTitle:{defaultMessage:"GitHub PR Title",id:"database.viewSettings.githubConfigTab.preview.prTitle"},open:{defaultMessage:"Open",id:"database.viewSettings.githubConfigTab.preview.open"},mergeInto:{defaultMessage:"Merge into",id:"database.viewSettings.githubConfigTab.preview.mergeInto"},main:{defaultMessage:"main",id:"database.viewSettings.githubConfigTab.preview.main"}})},178498:(e,t,o)=>{o.d(t,{Z:()=>a});var n=o(667294),r=o(785893);function i(e,t){return(0,r.jsx)(o(18748).ZP,{...e,ref:t,style:{background:"none",borderBottom:"none",boxShadow:"",marginTop:2,marginBottom:6,paddingTop:4,paddingBottom:4,minHeight:"none",...e.style}})}const a=(0,n.forwardRef)(i)},249392:(e,t,o)=>{o.d(t,{Z:()=>a});var n=o(667294),r=o(785893);function i(e){const{pageName:t,targetCollectionStore:n,...i}=e,a=(0,o(219727).Fy)(),s=(0,o(142735).VK)((()=>n.getIcon()),[n]),l=(0,o(846550).yK)((e=>({medium:{color:e.mediumTextColor},dbName:{display:"flex",alignItems:"center",marginLeft:4},title:{marginLeft:o(820748).Qi*(a.isRetina?.5:1)},icon:{width:16,fill:e.mediumIconColor}})),[a.isRetina]),c=(0,r.jsxs)("div",{style:l.dbName,children:[(0,r.jsx)(o(943620).Z,{disabled:!0,icon:s,isEmptyPage:!1,size:a.isMobile?24:20}),(0,r.jsx)(o(384241).Z,{store:n,style:l.title})]});return(0,r.jsx)(o(827973).Z,{title:(0,r.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,r.jsx)(o(788860)._H,{id:"database.searchRelation.createNewPageFooter",defaultMessage:"<medium>New</medium> {pageName} <medium> in</medium> {databaseNameWithIcon}",values:{medium:e=>(0,r.jsx)("span",{style:l.medium,children:e}),pageName:(0,r.jsx)("span",{style:{marginLeft:4,marginRight:4},children:t}),databaseNameWithIcon:c}})}),icon:(0,o(521777).R)(l.icon),...i})}const a=n.memo(i)},497459:(e,t,o)=>{o.d(t,{Z:()=>r});o(667294);var n=o(785893);const r=function(){return(0,n.jsx)(o(18748).ZP,{title:(0,n.jsx)(o(312578).Z,{})})}},12530:(e,t,o)=>{o.d(t,{N:()=>i,Z:()=>s});o(667294);var n=o(785893);const r={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:16,height:16,fontSize:10,textAlign:"center",fontWeight:o(707513).Ue.semibold,borderRadius:4,color:o(568017).ZP.white,position:"static",marginLeft:6,WebkitFontSmoothing:"auto"};let i=function(e){return e[e.Red=0]="Red",e[e.Gray=1]="Gray",e}({});function a(e){return!!e&&e>0}const s=function(e){let{count:t,color:s,style:c,numberStyle:d,fadeIn:u}=e;const p=s===i.Red,g=(0,o(846550).yK)((e=>({badge:{...r,...c,...(t??0)>99&&{width:void 0,padding:2},background:p?e.redBadgeBackground:e.lightIconColor,...u&&{transition:"opacity 0.1s",opacity:a(t)?1:0}}})),[t,u,p,c]);return u||a(t)?(0,n.jsx)("div",{style:g.badge,children:(0,n.jsx)(l,{count:t,numberStyle:d})}):null};function l(e){let{count:t,numberStyle:o}=e;return t?1===t?(0,n.jsx)("span",{style:{marginLeft:-.5,...o},children:"1"}):t>99?(0,n.jsx)("span",{style:{letterSpacing:-.5,...o},children:"99+"}):t>9?(0,n.jsx)("span",{style:{letterSpacing:-.5,marginLeft:-.5,...o},children:t}):(0,n.jsx)("span",{style:{...o},children:t}):null}},903639:(e,t,o)=>{o.d(t,{default:()=>I});o(267602),o(653476),o(470928),o(241792);var n=o(667294),r=()=>o(219727),i=()=>o(142735),a=()=>o(846550),s=()=>o(766933),l=()=>o(788860),c=()=>o(513670),d=()=>o(707513),u=()=>o(917881),p=()=>o(421654),g=()=>o(269299),h=()=>o(352230),m=()=>o(129338),y=()=>o(109806),f=()=>o(607031),v=()=>o(998901),b=()=>o(178498),S=()=>o(356321),C=()=>o(827973),x=()=>o(119891),P=()=>o(1910),R=()=>o(198829),_=()=>o(255577),M=()=>o(388284),k=o(785893);const I=function(e){let{collectionStore:t,targetCollectionStore:s,property:c,disabled:d,rowType:u}=e;const p=(0,a().Fg)(),g=(0,r().O7)(),h=(0,i().qz)(void 0,o(692304).Z),{format:y}=(0,n.useContext)(o(459217).m),f=(0,i().VK)((()=>{const e=m().U1({collectionStore:t,property:c}),o=Object.keys(s.getSchema()).map((t=>e.find((e=>e.property===t))??{property:t,visible:!1})),n=e.map((e=>e.property)),r=e=>{const t=n.indexOf(e);return-1!==t?t:1/0};return o.sort(((e,t)=>r(e.property)-r(t.property))),o}),[t,s,c]),b=(0,n.useCallback)((e=>(0,k.jsx)(L,{parent:e,collectionStore:t,property:c,disabled:d,targetCollectionStore:s,menuListStore:h,allRelatedTargetProperties:f})),[t,c,d,s,h,f]);return(0,r().MO)()&&"section"!==u||y===S().C.FormEditor||y===S().C.FormViewer?null:(0,k.jsx)(o(654133).Z,{renderTooltip:()=>(0,k.jsx)(l()._H,{id:"database.RelationCustomizeLayoutMenu.tooltip.button.message",defaultMessage:"Customize shown properties"}),placement:"section"===u?v().Placement.Top:v().Placement.Right,render:e=>(0,k.jsx)(o(448419).ZP,{popupType:o(967092).kQ.Popup,alignmentToOrigin:v().Alignment.Start,...e,renderOrigin:t=>(0,k.jsx)(P().Z,{icon:o(314379).o,iconStyle:{width:16,color:p.mediumIconColor,fill:p.mediumIconColor},...t,...e}),onClick:()=>{o(491927).gP(g,{from:"section"===u?"relation_section":"configure_relation_modal"})},originGap:16,render:b})})};function w(e){const{props:t,children:o}=e;return(0,k.jsx)(M().Z,{...t,noTextOverflow:!0,isTitleUppercase:!1,title:(0,k.jsx)(l()._H,{defaultMessage:"Hidden in relation",id:"database.relationMenu.hiddenInRelationTitle"}),desktopTitleStyle:{height:19},children:o,disableDesktopPadding:!0})}function j(e,t,o,n,r,i,a){const{properties:l,visibility:p}=e;return c().oA(l.map((e=>function(e,t,o,n,r,i,a){const{propertyFormat:l,visibility:c}=e,p=!c,g=r.getSchema();if(!g)return;const h=g[l.property];return h?{key:l.property,render:e=>(0,k.jsx)(C().Z,{...e,showDragHandle:!a,title:(0,k.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,k.jsx)(s().ZP,{icon:h.icon,type:h.type,size:16,theme:o,style:{fill:o.regularIconColor}}),(0,k.jsx)("span",{style:{marginLeft:8,...d().Yu},children:h.name})]}),right:(0,k.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,k.jsx)(P().Z,{icon:p?f().B:y().c,iconStyle:{width:16,height:16},isDarkIconColor:!p,onClick:()=>{u().qK({propertyFormat:l,visibility:c,collectionStore:n,property:i,environment:t})},disabled:a||"title"===l.property})})}),action:()=>{}}:void 0}({propertyFormat:e,visibility:p},t,o,n,r,i,a))))}function T(e){const t=(0,r().O7)(),{collectionStore:o,property:n,menuListStore:i,disabled:a,visibleProperties:s,hiddenProperties:l,children:d}=e,u=c().oA([...s.map((e=>e.property)),s.length>0&&l.length>0&&{key:"group-header-hidden-property",draggable:!1},...l.map((e=>e.property))]);return(0,k.jsx)(x().ZP,{direction:"vertical",keys:u,renderKey:(e,t)=>d[t],onDrop:e=>{!function(e,t,o,n,r){const{newPropertyKeys:i}=e,a=m().U1({collectionStore:o,property:n}),s=i.indexOf("group-header-hidden-property"),l=c().oA(i.filter((e=>!e.startsWith("group-header-"))).map(((e,t)=>{const o=a.find((t=>t.property===e));return o?s>0?"title"===e&&t>=s?o:{...o,visible:Boolean(t<s)}:o:{property:e,visible:!(s>0)||Boolean(t<s)}}))),d=a.filter((e=>!i.includes(e.property))),u={...m().ZI(o)};u[n]||(u[n]={}),u[n].related_properties=[...l,...d],g().createAndCommit({userAction:"RelationPropertyCustomizeLayoutMenu.handlePropertyReorder",environment:t,canUndo:!0,perform:e=>{p().FH({stores:[o],update:{collection_relation_options:u},transaction:e})}}),r.reset()}({newPropertyKeys:e},t,o,n,i)},disabled:a})}function L(e){let{parent:t,collectionStore:o,property:n,disabled:s,targetCollectionStore:d,menuListStore:u,allRelatedTargetProperties:p}=e;const g=(0,a().Fg)(),m=(0,r().O7)(),y=p.filter((e=>e.visible)),f=p.filter((e=>!e.visible)),v=(0,i().VK)((()=>j({properties:y,visibility:!0},m,g,o,d,n,s)),[y,m,g,o,d,n,s]),S=(0,i().VK)((()=>j({properties:f,visibility:!1},m,g,o,d,n,s)),[f,m,g,o,d,n,s]);return p?(0,k.jsxs)(R().Z,{menuType:h().o.Popup,maxWidth:240,maxHeight:500,children:[0===p.length&&(0,k.jsx)(M().Z,{children:(0,k.jsx)(b().Z,{caption:(0,k.jsx)(l()._H,{defaultMessage:"No properties",id:"database.relationMenu.noProperties"})})}),p.length>0&&(0,k.jsx)(_().Z,{type:_().i.Vertical,store:u,initialFocus:void 0,sections:c().oA([y.length>0&&{key:"visible_and_hidden_properties",render:e=>(0,k.jsx)(M().Z,{...e,noTextOverflow:!0,isTitleUppercase:!1,title:(0,k.jsx)(l()._H,{defaultMessage:"Shown in relation",id:"database.relationMenu.shownInRelationTitle"}),desktopTitleStyle:{height:18},children:(0,k.jsx)(T,{collectionStore:o,property:n,disabled:s,menuListStore:u,visibleProperties:y,hiddenProperties:f,children:e.children})}),items:c().oA([...v,f.length>0&&{key:"group-header-hidden-property",render:e=>(0,k.jsx)(w,{props:e,children:(0,k.jsx)(k.Fragment,{})}),action:()=>{}},...S])},0===y.length&&f.length>0&&{key:"hidden_properties",render:e=>(0,k.jsx)(w,{props:e,children:(0,k.jsx)(T,{collectionStore:o,property:n,disabled:s,menuListStore:u,visibleProperties:y,hiddenProperties:f,children:e.children})}),items:S}])})]}):null}},743790:(e,t,o)=>{o.d(t,{Y:()=>m});o(241792),o(667294);var n=()=>o(219727),r=()=>o(142735),i=()=>o(846550),a=()=>o(801812),s=()=>o(788860),l=()=>o(707513),c=()=>o(30238),d=()=>o(824462),u=()=>o(907099),p=()=>o(876822),g=()=>o(239444),h=o(785893);function m(e){const{group:t,limit:o,noMembersMessage:m,color:y,trackHover:f}=e,v=(0,i().yK)((e=>({container:{marginBottom:4,..."white_background"===y?{fontSize:l().JB.UISmall.desktop,color:e.mediumTextColor,padding:"4px 8px"}:{}},userContainer:{display:"flex",alignContent:"flex-end",minWidth:140,width:"100%",marginTop:4},user:{flexGrow:1},moreMessage:{marginLeft:2,marginTop:4,..."white_background"===y?{fontSize:l().JB.UISmall.desktop,color:e.mediumTextColor}:{color:e.mediumInvertedTextColor}}})),[y]),b=(0,r().VK)((()=>p().default.state.currentSpaceStore),[]),S=(0,n().O7)();(0,r().VK)((()=>{f&&c().iH(S,{group_id:t.group_id})}),[f,t,S]);const[{value:C}]=(0,a().r5)((async()=>{if(!b)return;const e=await d().callApi({eventName:"getSpacePermissionGroupMembers",environment:S,data:{groupIds:[t.group_id],spaceId:b.id}});if("success"===e.type){var n;const r=null===(n=e.data.groupUsersMap[t.group_id])||void 0===n?void 0:n.userIds;return(0,u().rm)({userIds:r,limit:o,spaceStore:b})}}),[b,S,t,o]);return 0===(null==C?void 0:C.limitedUserStores.length)?(0,h.jsx)(h.Fragment,{children:m}):(0,h.jsxs)("div",{style:v.container,children:[null==C?void 0:C.limitedUserStores.map((e=>(0,h.jsx)("div",{style:v.userContainer,children:(0,h.jsx)(g().Z,{style:v.user,userStore:e,avatarSize:18})},e.id))),C&&C.countRemainingUsers>0&&(0,h.jsx)("div",{style:v.moreMessage,children:(0,h.jsx)(s()._H,{id:"blockPermissionsSettings.groupPermissionUsers.tooltip",defaultMessage:"{countRemainingUsers} more…",values:{countRemainingUsers:C.countRemainingUsers}})})]})}},718798:(e,t,o)=>{o.d(t,{Z:()=>r});class n extends(()=>o(263184))().default{getInitialState(){return{inputValue:"",focus:!1}}}const r=n},766463:(e,t,o)=>{o.d(t,{s:()=>H});o(670560),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(916054),o(653476),o(470928),o(241792),o(228244);var n=o(667294),r=()=>o(629013),i=()=>o(219727),a=()=>o(142735),s=()=>o(511115),l=()=>o(364402),c=()=>o(565630),d=()=>o(647834),u=()=>o(752778),p=()=>o(899133),g=()=>o(513670),h=()=>o(855741),m=()=>o(696459),y=()=>o(326966),f=()=>o(824462),v=()=>o(932753),b=()=>o(594546),S=()=>o(43721),C=()=>o(15981),x=()=>o(8),P=()=>o(90065),R=()=>o(620218),_=()=>o(828946),M=()=>o(98228),k=()=>o(876822),I=()=>o(804217),w=()=>o(749826),j=()=>o(63317),T=()=>o(485014),L=()=>o(21965),D=()=>o(826955);class V extends(()=>o(263184))().default{getInitialState(){return{query:void 0,localResults:[],numTotalLocalResults:0,serverResults:[],numTotalServerResults:0,searchSessionId:(0,o(956057).Il)(),isResultsLoading:!1}}}const F=V;var Z=()=>o(677559),B=()=>o(358565);function H(e){var t;const{searchQuery:o,limit:V,source:H,type:O,disable:K,overrideSpaceStore:N,overrideSearchSessionId:W,usePrefetch:q,isTitleOnly:G=!0}=e,z=(0,i().O7)(),Q=(0,c().D9)(o),Y=(0,c().D9)(e.filters),$=(0,n.useRef)(0),X=(0,n.useRef)(!0),J=(0,a().VK)((()=>I().default.state.online),[]),ee=(0,a().VK)((()=>e.isLocalOnlyMode||!J),[J,e.isLocalOnlyMode]),te=(0,n.useMemo)((()=>new F),[]),oe=(0,a().VK)((()=>W&&W!==te.state.searchSessionId?(te.update((e=>({...e,searchSessionId:W}))),W):te.state.searchSessionId),[te,W]),{searchLocalResults:ne,searchServerResults:re,isResultsLoading:ie,numTotalLocalResults:ae,numTotalServerResults:se}=(0,a().VK)((()=>({searchLocalResults:te.state.localResults,searchServerResults:te.state.serverResults,isResultsLoading:te.state.isResultsLoading,numTotalLocalResults:te.state.numTotalLocalResults,numTotalServerResults:te.state.numTotalServerResults})),[te]),le=(0,a().VK)((()=>{if(ee||ie&&X.current)return ne;let e=function(e){const{localResults:t,serverResults:o}=e,n=t.map((e=>e.store.id)),r=new Set(n),i=o.filter((e=>!r.has(e.store.id)));return[...t,...i]}({localResults:ne,serverResults:re});return O===p().n8.CollectionsInSpace&&(e=U(e)),e}),[ee,ie,ne,re,O]),ce=(0,a().VK)((()=>N||k().default.state.currentSpaceStore),[N]),de=(0,a().VK)((()=>"on"===w().default.getEligibleGroup({experimentId:"search-use-local-reranker-layered",parameter:"shouldUseLocalReranker",defaultGroup:"control"})),[]),ue=(0,a().VK)((()=>ee&&J&&Boolean(q)),[ee,J,q]),pe=(0,a().VK)((()=>(0,x().bC)(z).hasPublicAccessPermission),[z]),ge=(0,n.useMemo)((()=>{const t={navigableBlockContentOnly:G,...e.filters};return(0,p().u4)(t)}),[e.filters,G]),he=(0,n.useMemo)((()=>{var t;return function(e){const{blockTypes:t,queryType:o}=e;switch(o){case p().n8.CollectionsInSpace:return["collection_view","collection_view_page"];case p().n8.BlocksInCollection:return["page","collection_view_page"];case p().n8.BlocksInSpace:default:return[...t??[]]}}({blockTypes:null===(t=e.filters)||void 0===t?void 0:t.blockTypes,queryType:O})}),[null===(t=e.filters)||void 0===t?void 0:t.blockTypes,O]),me=(0,n.useCallback)(((e,t)=>{const{isSuccess:o,totalResultsCount:n,localCacheMetadata:r,query:i}=t;R().default.measure(e,{environment:z,data:{start_time:e.startTime,success:o,surface:H,num_results:n,search_session_id:oe,local_cache_metadata:r,query_length:i.length}})}),[z,H,oe]),ye=(0,n.useCallback)(((e,t)=>{const{isSuccess:o,totalResultsCount:n,query:r}=t;R().default.measure(e,{environment:z,data:{start_time:e.startTime,success:o,surface:H,num_results:n,search_session_id:oe,search_session_flow_number:$.current,query_length:r.length}})}),[z,H,oe]),fe=(0,Z().XJ)(_().x.searchActions),ve=(0,n.useCallback)((e=>{const t=R().default.mark("rum.local_quick_search_query"),{query:o,spaceStore:n}=e;if("resolved"!==fe.status)return;const r=O===p().n8.CollectionsInSpace;let i=[];0===o.length&&r&&(i=function(e){const{spaceStore:t,environment:o}=e,n=(0,v().lG)({currentUserId:o.currentUser.id,spaceId:t.id}).map((e=>{const o=D().NW.createChildStore(t,{table:u().vF,id:e}).getParentBlockStore();if(null==o?void 0:o.pathIsAccessibleAndAlive())return o}));return(0,g().oA)(n)}({environment:z,spaceStore:n}).map(((e,t)=>({store:e,originalPosition:t,id:e.id,score:0,spaceId:e.getSpaceId(),sources:[p().vp.Local],featureGroups:[],serverEventProperties:void 0}))));const a=T().Z.state.localSearchableBlocksCache,s=(0,S().U)({environment:z,overrideSpaceStore:n,overrideLocalSearchableBlocksCache:a}),l=(0,B().NH)({environment:z,parentStore:n,isOnline:J,requestInput:{query:{text:o,filters:{...ge,blockTypes:he},sort:{field:"relevance"}},limit:ee?V:Math.min(V,5)},localSearchCache:a,shouldUseNewRerankerDebugOverrideEnabled:de,shouldLimitLocalResultsWhenOnline:!ee,hasPublicAccessPermission:pe}),c=ue?E({query:o,serverResults:we.current}):[],d=l&&h().x.unwrapOr(l,void 0),m=(null==d?void 0:d.results)??[],y=(null==d?void 0:d.total)??0;let f=g().mN([...i,...m,...c],(e=>e.id));f=r?U(f):f,te.update((e=>e.query!==o?e:(Te.current=f.map((e=>e.id)),me(t,{query:o,isSuccess:Boolean(d),totalResultsCount:y,localCacheMetadata:s}),{...e,localResults:f,isResultsLoading:!ee&&e.isResultsLoading,numTotalLocalResults:y})))}),[he,z,ge,pe,ee,J,V,fe.status,te,de,O,me,ue]),be=(0,r().y)(ve,M().E5),Se=(0,n.useCallback)((e=>{const{result:t,isMetaClick:n,context:r}=e;(0,b().j)({environment:z,event:{eventName:"select_search_item",eventProperties:{sources:t.sources,localSources:Array.from(t.localSource||new Set),searchSessionId:oe,searchSessionFlowNumber:$.current,context:r,queryStringLength:o.length,totalSearchResultCount:ae+se,numLocalResults:ne.length,numTotalLocalResults:ae,isMobile:z.device.isMobile,isMetaClick:n,hasFilters:Boolean(ge),originalPosition:t.originalPosition,selectedItemIndex:t.originalPosition,selectedSearchResultMetadata:{blockId:t.id,blockType:t.store.getModel().type},searchSource:H,verificationState:(0,P().T7)(t.store)}}})}),[z,ae,se,ne,o,oe,$,ge,H]),Ce=Q===o,xe=g().Xy(Y,e.filters),Pe=Boolean(Q&&!o),Re=xe&&Ce,_e=!K&&ce&&!Re,Me=Pe||!xe,ke=(0,n.useRef)(!1),Ie=(0,n.useRef)([]),we=(0,n.useRef)([]),je=(0,n.useRef)([]),Te=(0,n.useRef)([]),Le=(0,a().VK)((()=>{if("mention_menu"!==H)return;return L().Z.getMentionedIds(z.currentUser.id)}),[z.currentUser.id,H]),De=(0,n.useCallback)((async e=>{const t=R().default.mark("rum.server_quick_search_query"),{query:o,spaceStore:n,size:r}=e,i=n.id;if(ee&&!ue)return;const a=!X.current&&xe?Ie.current:[],s=ue?E({query:o,serverResults:we.current}):[];if(ue&&(o.length<=1||s.length>=5||je.current.some((e=>e===o))))return;je.current.push(o);const c=await f().callApi({eventName:"search",environment:z,data:{type:O,query:o,spaceId:i,collectionId:(null==ge?void 0:ge.parentId)??"",limit:ue?15:r+1,filters:ge,sort:{field:"relevance"},source:H,searchSessionId:oe,searchSessionFlowNumber:$.current,recentlyMentionedPageIds:Le,recentPagesForBoosting:(0,C().Wk)(j().Z.getWithoutSubscribing(i)),excludedBlockIds:g().jj([...a.map((e=>e.id)),...Te.current||[],...we.current.map((e=>e.id))]),ignoresHighlight:!0}});if(!c||"failed"===c.type)return;const u=c.data.total,p=(0,y().m8)((0,m().qP)(c.data.trackEventProperties).map((e=>{let[t,o]=e;return[`server-${t}`,o]}))),h=c.data.results.slice(0,r).map(((e,t)=>{const o=D().G.createChildStore(n,{id:e.id,spaceId:e.spaceId,table:"block"}),r=ue?function(e){const{result:t,store:o,environment:n}=e;if(t.terms)return t.terms;const r=o.getModel();if(!r)return[];const i=n.defaultRecordCache.inMemoryRecordCache.makeGetRecordValueFn(n.currentUser.id),a=(0,d().$B)((0,l().ut)({blockValue:r,getRecordValue:i}).text);if(!a)return[];return A(a)}({environment:z,store:o,result:e}):e.terms;return{store:o,originalPosition:t,...e,serverEventProperties:p,terms:r}}));ke.current=!(u<=r);const v=[...a,...h];Ie.current=v,we.current=g().mN([...ue?h:[],...we.current],(e=>e.id)),ue||(te.update((e=>e.query!==o?e:(ye(t,{query:o,isSuccess:"success"===c.type,totalResultsCount:u}),{...e,serverResults:v,isResultsLoading:!1,numTotalServerResults:u}))),$.current+=1)}),[ee,xe,z,O,ge,H,oe,Le,Te,te,ye,ue]),Ve=(0,n.useCallback)((e=>{!K&&ce&&ke.current&&!ie&&J&&(te.update((e=>({...e,isResultsLoading:!0}))),ke.current=!1,X.current=!1,De({query:o,spaceStore:ce,size:e??20}))}),[ce,K,De,J,ie,o,te]),Fe=(0,s().z)(Ve,M().rE),Ze=(0,r().y)(De,ue?0:M().rE);return(0,n.useEffect)((()=>{if(Me){const e=te.getInitialState();te.update((t=>({...e,searchSessionId:t.searchSessionId}))),we.current=[],je.current=[]}_e&&(X.current=!0,te.update((e=>({...e,isResultsLoading:!0,query:o}))),be({query:o,spaceStore:ce}),Ze({query:o,spaceStore:ce,size:V}))}),[ce,be,Ze,V,o,_e,te,Me]),{results:le,isResultsLoading:ie,searchSessionId:oe,fetchAdditionalServerResultsOnChange:!K&&!ee&&ke.current&&Re?Fe:void 0,searchSessionFlowNumber:$.current,hasMoreResults:ke.current,searchAnalytics:{trackSelectSearchItem:Se}}}function A(e){return e.normalize().toLocaleLowerCase().split(/\s/gu)}function E(e){const{query:t,serverResults:o}=e;if(!t)return[];const n=A(t),r=n.pop();return r?o.filter((e=>{const t=e.terms??[],o=t.find((e=>e.startsWith(r))),i=n.every((e=>t.some((t=>t===e))));return o&&i})):[]}function U(e){const t=new Set;return e.filter((e=>{const o=e.store.getCollectionViewSourceCollectionStore();return!(!o||t.has(o.id))&&(t.add(o.id),!0)}))}},404553:(e,t,o)=>{o.d(t,{M:()=>n().M});var n=()=>o(682890)},985481:(e,t,o)=>{o.d(t,{k:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("arrowRightSmaller",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M15.383 8.352a.877.877 0 01-.274.64l-5.156 5.14a.864.864 0 01-.617.266.831.831 0 01-.602-.234.795.795 0 01-.234-.586c0-.12.02-.232.063-.336a.912.912 0 01.187-.273l1.75-1.766 2.914-2.656.274.5-2.711.156H1.484c-.26 0-.471-.078-.632-.234a.851.851 0 01-.235-.617c0-.256.078-.461.235-.618a.856.856 0 01.632-.242h9.493l2.71.164-.273.508L10.5 5.5 8.75 3.727a.946.946 0 01-.188-.266.917.917 0 01-.062-.344c0-.234.078-.43.234-.586a.831.831 0 01.602-.234.79.79 0 01.328.07c.104.047.203.117.297.211l5.148 5.133a.877.877 0 01.274.64z"})})},850790:(e,t,o)=>{o.d(t,{K:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("boltFilled",{svg:(0,n.jsx)("path",{d:"M0 12.117c0 .38.293.664.703.664h5.518l-2.91 7.91c-.381 1.006.664 1.543 1.318.723l8.877-11.094c.166-.205.254-.4.254-.625 0-.371-.293-.664-.703-.664H7.539l2.91-7.91C10.83.115 9.785-.422 9.131.408L.254 11.492c-.166.215-.254.41-.254.625z"}),viewBox:"0 0 14 22"})},151684:(e,t,o)=>{o.d(t,{E:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("chevronDownRounded",{viewBox:"0 0 15 9",svg:(0,n.jsx)("path",{d:"M7.92188 8.65625C8.19531 8.64844 8.44531 8.54688 8.64844 8.32812L14.5859 2.25C14.7578 2.07812 14.8516 1.85938 14.8516 1.60156C14.8516 1.08594 14.4453 0.671875 13.9297 0.671875C13.6797 0.671875 13.4375 0.773438 13.2578 0.953125L7.92969 6.42969L2.58594 0.953125C2.40625 0.78125 2.17188 0.671875 1.91406 0.671875C1.39844 0.671875 0.992188 1.08594 0.992188 1.60156C0.992188 1.85938 1.08594 2.07812 1.25781 2.25L7.20312 8.32812C7.41406 8.54688 7.64844 8.65625 7.92188 8.65625Z"})})},384697:(e,t,o)=>{o.d(t,{R:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("chevronUpRounded",{viewBox:"0 0 15 9",svg:(0,n.jsx)("path",{d:"M1.258 6.5L7.203.422a.946.946 0 01.719-.32.99.99 0 01.726.32L14.586 6.5a.89.89 0 01.266.648c0 .524-.407.93-.922.93a.921.921 0 01-.672-.281L7.93 2.32 2.586 7.797a.926.926 0 01-.672.281.915.915 0 01-.922-.93c0-.25.094-.476.266-.648z"})})},94453:(e,t,o)=>{o.d(t,{H:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("copyPadded",{viewBox:"0 0 24 24",svg:(0,n.jsx)("path",{d:"M4.89062 18.5107C4.89062 19.9873 5.64941 20.7529 7.1123 20.7529H13.5107C14.9736 20.7529 15.7256 19.9805 15.7256 18.5107V17.2461H16.8877C18.3506 17.2461 19.1094 16.4805 19.1094 15.0039V9.58984C19.1094 8.69434 18.9248 8.12012 18.3848 7.56641L14.9736 4.09375C14.4609 3.56738 13.8525 3.36914 13.0664 3.36914H10.4893C9.0332 3.36914 8.26758 4.13477 8.26758 5.61133V6.86914H7.1123C5.64941 6.86914 4.89062 7.6416 4.89062 9.11133V18.5107ZM15.042 11.3262L11.3369 7.55957C10.8105 7.02637 10.3662 6.88281 9.60742 6.87598V5.68652C9.60742 5.05762 9.94238 4.70898 10.6055 4.70898H13.4629V7.97656C13.4629 8.82422 13.9141 9.26172 14.7549 9.26172H17.7695V14.9219C17.7695 15.5576 17.4414 15.9062 16.7715 15.9062H15.7256V13.2539C15.7256 12.3311 15.6162 11.9072 15.042 11.3262ZM14.584 7.80566V5.2627L17.4209 8.14062H14.9189C14.6865 8.14062 14.584 8.04492 14.584 7.80566ZM6.23047 18.4287V9.19336C6.23047 8.56445 6.55859 8.20898 7.22168 8.20898H9.32031V11.9551C9.32031 12.9326 9.80566 13.4111 10.7764 13.4111H14.3857V18.4287C14.3857 19.0645 14.0576 19.4131 13.3945 19.4131H7.22168C6.55859 19.4131 6.23047 19.0645 6.23047 18.4287ZM10.9062 12.2285C10.626 12.2285 10.5029 12.1055 10.5029 11.8252V8.46875L14.2012 12.2285H10.9062Z"})})},109806:(e,t,o)=>{o.d(t,{c:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("eye",{viewBox:"0 0 32 32",svg:(0,n.jsx)("path",{d:"M16.006 25.812c8.863 0 14.994-7.17 14.994-9.406C31 14.16 24.858 7 16.006 7 7.252 7 1 14.16 1 16.406c0 2.236 6.252 9.406 15.006 9.406zm0-3.242a6.194 6.194 0 01-6.197-6.164c-.012-3.452 2.744-6.164 6.197-6.164 3.419 0 6.185 2.711 6.185 6.164 0 3.364-2.766 6.164-6.185 6.164zm0-3.94c1.228 0 2.246-1.007 2.246-2.224 0-1.228-1.018-2.235-2.246-2.235-1.24 0-2.258 1.007-2.258 2.235 0 1.217 1.018 2.224 2.258 2.224z"})})},975899:(e,t,o)=>{o.d(t,{o:()=>n().o});var n=()=>o(81979)},710125:(e,t,o)=>{o.d(t,{l:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("import",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M13.291 14.5723C13.291 14.1484 12.9902 13.834 12.5732 13.834H8.06836C8.24609 13.8203 8.42383 13.7314 8.56055 13.5947L13.0586 9.08301C13.2158 8.91895 13.291 8.74121 13.291 8.54297C13.291 8.12598 12.9902 7.81836 12.5801 7.81836C12.3682 7.81836 12.1836 7.90039 12.0469 8.03711L10.4951 9.56836L8.69043 11.585L8.75195 10.1084V1.61133C8.75195 1.16016 8.44434 0.852539 8 0.852539C7.5625 0.852539 7.25488 1.16016 7.25488 1.61133V10.1084L7.30957 11.5781L5.50488 9.56836L3.95312 8.03711C3.82324 7.90039 3.63184 7.81836 3.42676 7.81836C3.0166 7.81836 2.70898 8.12598 2.70898 8.54297C2.70898 8.74121 2.78418 8.91895 2.94141 9.08301L7.44629 13.5947C7.58301 13.7314 7.75391 13.8203 7.93848 13.834H3.44043C3.0166 13.834 2.70898 14.1484 2.70898 14.5723C2.70898 14.9893 3.0166 15.3037 3.44043 15.3037H12.5732C12.9902 15.3037 13.291 14.9893 13.291 14.5723Z"})})},965910:(e,t,o)=>{o.d(t,{h:()=>n().h});var n=()=>o(968061)},104937:(e,t,o)=>{o.d(t,{R:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("openTeam",{viewBox:"0 0 28 28",svg:(0,n.jsx)("path",{d:"M3.24121 21.4326C3.24121 22.4082 3.80371 23.0322 4.7002 23.0322H22.4629C23.3506 23.0322 23.9131 22.4082 23.9131 21.4326V10.2178C23.9131 9.24219 23.3506 8.61816 22.4629 8.61816H17.2334V5.89355C17.2334 4.91797 16.6709 4.29395 15.7832 4.29395H4.7002C3.80371 4.29395 3.24121 4.91797 3.24121 5.89355V21.4326ZM4.65625 21.1074V6.21875C4.65625 5.86719 4.81445 5.70898 5.16602 5.70898H15.3174C15.6602 5.70898 15.8184 5.86719 15.8184 6.21875V21.1074C15.8184 21.4502 15.6602 21.6172 15.3174 21.6172H13.2959V19.0244C13.2959 18.2686 12.9619 17.917 12.2412 17.917H8.2334C7.5127 17.917 7.17871 18.2686 7.17871 19.0244V21.6172H5.16602C4.81445 21.6172 4.65625 21.4502 4.65625 21.1074ZM7.31934 9.5498H9.0332C9.24414 9.5498 9.39355 9.40918 9.39355 9.18945V7.52832C9.39355 7.31738 9.24414 7.16797 9.0332 7.16797H7.31934C7.1084 7.16797 6.97656 7.31738 6.97656 7.52832V9.18945C6.97656 9.40918 7.1084 9.5498 7.31934 9.5498ZM11.4414 9.5498H13.1465C13.3574 9.5498 13.5068 9.40918 13.5068 9.18945V7.52832C13.5068 7.31738 13.3574 7.16797 13.1465 7.16797H11.4414C11.2217 7.16797 11.0898 7.31738 11.0898 7.52832V9.18945C11.0898 9.40918 11.2217 9.5498 11.4414 9.5498ZM17.2334 21.4326V10.0332H21.9971C22.3398 10.0332 22.498 10.2002 22.498 10.543V21.1074C22.498 21.4502 22.3398 21.6172 21.9971 21.6172H17.2246C17.2334 21.5557 17.2334 21.4941 17.2334 21.4326ZM7.31934 13.0303H9.0332C9.24414 13.0303 9.39355 12.8896 9.39355 12.6699V11.0088C9.39355 10.7979 9.24414 10.6484 9.0332 10.6484H7.31934C7.1084 10.6484 6.97656 10.7979 6.97656 11.0088V12.6699C6.97656 12.8896 7.1084 13.0303 7.31934 13.0303ZM11.4414 13.0303H13.1465C13.3574 13.0303 13.5068 12.8896 13.5068 12.6699V11.0088C13.5068 10.7979 13.3574 10.6484 13.1465 10.6484H11.4414C11.2217 10.6484 11.0898 10.7979 11.0898 11.0088V12.6699C11.0898 12.8896 11.2217 13.0303 11.4414 13.0303ZM19.1582 13.4521H20.5732C20.749 13.4521 20.8721 13.3291 20.8721 13.1533V11.7822C20.8721 11.6064 20.749 11.4834 20.5732 11.4834H19.1582C18.9736 11.4834 18.8682 11.6064 18.8682 11.7822V13.1533C18.8682 13.3291 18.9736 13.4521 19.1582 13.4521ZM7.31934 16.5107H9.0332C9.24414 16.5107 9.39355 16.3613 9.39355 16.1504V14.4893C9.39355 14.2695 9.24414 14.1289 9.0332 14.1289H7.31934C7.1084 14.1289 6.97656 14.2695 6.97656 14.4893V16.1504C6.97656 16.3613 7.1084 16.5107 7.31934 16.5107ZM11.4414 16.5107H13.1465C13.3574 16.5107 13.5068 16.3613 13.5068 16.1504V14.4893C13.5068 14.2695 13.3574 14.1289 13.1465 14.1289H11.4414C11.2217 14.1289 11.0898 14.2695 11.0898 14.4893V16.1504C11.0898 16.3613 11.2217 16.5107 11.4414 16.5107ZM19.1582 16.8096H20.5732C20.749 16.8096 20.8721 16.6865 20.8721 16.5107V15.1396C20.8721 14.9639 20.749 14.8408 20.5732 14.8408H19.1582C18.9736 14.8408 18.8682 14.9639 18.8682 15.1396V16.5107C18.8682 16.6865 18.9736 16.8096 19.1582 16.8096ZM19.1582 20.167H20.5732C20.749 20.167 20.8721 20.0439 20.8721 19.8682V18.4971C20.8721 18.3213 20.749 18.1982 20.5732 18.1982H19.1582C18.9736 18.1982 18.8682 18.3213 18.8682 18.4971V19.8682C18.8682 20.0439 18.9736 20.167 19.1582 20.167ZM8.33008 19.3496C8.33008 19.165 8.42676 19.0684 8.61133 19.0684H11.8633C12.0566 19.0684 12.1445 19.165 12.1445 19.3496V21.6172H8.33008V19.3496Z"})})},419273:(e,t,o)=>{o.d(t,{f:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("plusThick",{viewBox:"0 0 14 14",svg:(0,n.jsx)("path",{d:"M2 7.16357C2 7.59692 2.36011 7.95093 2.78735 7.95093H6.37622V11.5398C6.37622 11.9731 6.73022 12.3271 7.16357 12.3271C7.59692 12.3271 7.95093 11.9731 7.95093 11.5398V7.95093H11.5398C11.9731 7.95093 12.3271 7.59692 12.3271 7.16357C12.3271 6.73022 11.9731 6.37622 11.5398 6.37622H7.95093V2.78735C7.95093 2.36011 7.59692 2 7.16357 2C6.73022 2 6.37622 2.36011 6.37622 2.78735V6.37622H2.78735C2.36011 6.37622 2 6.73022 2 7.16357Z"})})},464660:(e,t,o)=>{o.d(t,{x:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("privateTeam",{viewBox:"0 0 28 28",svg:(0,n.jsx)("path",{d:"M20.6455 21.2744C20.9092 21.5469 21.3311 21.5645 21.6035 21.2744C21.8936 20.9844 21.8672 20.5889 21.6035 20.3164L6.9082 5.62988C6.64453 5.36621 6.21387 5.36621 5.94141 5.62988C5.68652 5.88477 5.68652 6.33301 5.94141 6.58789L20.6455 21.2744ZM13.8076 6.13086C12.2783 6.13086 10.8896 6.39453 9.59766 6.8252L10.7578 7.97656C11.7246 7.68652 12.7178 7.51953 13.8076 7.51953C19.5908 7.51953 24.2754 12.6172 24.2754 13.6631C24.2754 14.375 22.7373 16.291 20.3027 17.7852L21.3838 18.8662C24.1611 17.0645 25.8135 14.7002 25.8135 13.6631C25.8135 11.8613 20.9092 6.13086 13.8076 6.13086ZM13.8076 21.1953C15.4424 21.1953 16.9365 20.9053 18.2988 20.4395L17.1475 19.2881C16.1016 19.6133 14.9941 19.8066 13.8076 19.8066C8.01562 19.8066 3.33105 14.9023 3.33105 13.6631C3.33105 13.0479 4.95703 11 7.5498 9.44434L6.45996 8.35449C3.5332 10.165 1.79297 12.5996 1.79297 13.6631C1.79297 15.4561 6.79395 21.1953 13.8076 21.1953ZM18.3164 15.5879C18.5889 14.999 18.7383 14.3398 18.7383 13.6631C18.7383 10.9121 16.541 8.74121 13.8076 8.74121C13.1133 8.74121 12.4629 8.89062 11.874 9.14551L18.3164 15.5879ZM13.8076 18.585C14.5811 18.585 15.3105 18.3916 15.9609 18.0752L9.36914 11.4834C9.04395 12.1338 8.85938 12.8721 8.85938 13.6631C8.86816 16.3438 11.0566 18.585 13.8076 18.585Z"})})},848854:(e,t,o)=>{o.d(t,{v:()=>n().v});var n=()=>o(545914)},356140:(e,t,o)=>{o.d(t,{W:()=>i});var n=()=>o(142735),r=()=>o(876822);function i(){const{currentSpaceStore:e}=(0,n().VK)((()=>r().default.state),[]);return null==e?void 0:e.id}},420406:(e,t,o)=>{o.d(t,{$:()=>n});function n(e,t){t.route.name;return!1}},341643:(e,t,o)=>{o.d(t,{DW:()=>v,IG:()=>m,J4:()=>f,hZ:()=>y,q9:()=>h,qq:()=>b,s4:()=>g});var n=o(667294),r=()=>o(219727),i=()=>o(142735),a=()=>o(801812),s=()=>o(677559),l=()=>o(690664),c=()=>o(105649),d=()=>o(291335),u=()=>o(590972),p=()=>o(420406);const g=new(s().Ss)("PerformanceToolbar",(()=>Promise.all([o.e(62743),o.e(5242),o.e(4642),o.e(69197),o.e(52658),o.e(54194)]).then(o.bind(o,333301)))),h=(0,s().kF)(g,(e=>e.PerformanceToolbar)),m=(0,s().kF)(g,(e=>e.PerformanceToolbarSettings));function y(){const e=(0,r().O7)();return(0,i().VK)((()=>(0,p().$)(e,e.RouterStore.state)),[e])}function f(){const e=(0,r().O7)(),t=S("PerformanceToolbarStore"),o=S("isPerformanceToolbarVisible");return(0,i().VK)((()=>!(!t||!o)&&o(e,e.RouterStore.state,t.state)),[o,e,t])}function v(){const e=S("PerformanceToolbarStore");return(0,i().VK)((()=>!!e&&e.state.isPerformanceToolbarMounted),[e])}function b(){const e=(0,r().O7)(),t=S("createPerformanceToolbarMouseListeners"),o=S("PerformanceToolbarStore"),{sidebarExpanded:a,sidebarWidth:s,secondarySidebarExpanded:p,secondarySidebarWidth:g,updateSidebarExpanded:h,updateSidebarWidth:m}=(0,i().VK)((()=>({sidebarExpanded:d().sidebarExpandedStore.state,sidebarWidth:d().sidebarWidthStore.state,secondarySidebarExpanded:c().default.isOpen(),secondarySidebarWidth:l().default.getWidth(),updateSidebarExpanded:u().default.state.expanded,updateSidebarWidth:u().default.state.width})),[]);return(0,n.useEffect)((()=>{if(o&&t)return t(e,(e=>o.update((t=>({...t,isMouseNearPerformanceToolbar:e})))),a,s,p,g,h,m)}),[t,e,o,a,s,p,g,h,m])}function S(e){const t=y(),[{value:o}]=(0,a().r5)((()=>t?g.load().then((t=>t[e])):Promise.resolve(void 0)),[e,t]);return o}},835698:(e,t,o)=>{o.d(t,{default:()=>Po});o(670560),o(267602),o(653476),o(470928),o(30005),o(241792);var n=o(667294),r=()=>o(219727),i=()=>o(142735),a=()=>o(846550),s=()=>o(506347),l=()=>o(926724),c=()=>o(226413),d=()=>o(532850),u=()=>o(892981),p=()=>o(135857),g=()=>o(235484),h=()=>o(998411),m=()=>o(801812),y=()=>o(396136),f=()=>o(255933),v=()=>o(899133),b=()=>o(255393),S=()=>o(788860),C=()=>o(491927),x=()=>o(250303),P=()=>o(54512),R=()=>o(824462),_=()=>o(959137),M=()=>o(308186),k=()=>o(463058),I=()=>o(497065),w=()=>o(970105),j=()=>o(269299),T=()=>o(423402),L=()=>o(491925),D=()=>o(459217),V=()=>o(356321),F=()=>o(827973),Z=()=>o(573357),B=()=>o(740046),H=()=>o(198829),A=()=>o(838367),E=()=>o(967092),U=()=>o(943620),O=()=>o(384241),K=()=>o(388284),N=()=>o(641481),W=()=>o(249392),q=o(785893);function G(e){const{targetCollectionStore:t,title:o,onClick:s,focused:l,isSection:c,index:d}=e,u=(0,i().VK)((()=>t.canEdit()),[t]),p=(0,i().VK)((()=>t.isSyncedCollection()),[t]),g=(0,r().Fy)(),h=(0,a().yK)((e=>({wrapper:{borderTop:`1px solid ${e.lightDividerColor}`,paddingTop:4,paddingBottom:4},row:{fontSize:g.isMobile?16:14,minHeight:g.isMobile?44:32}})),[g]),{format:m}=(0,n.useContext)(D().m);if(m===V().C.FormEditor||m===V().C.FormViewer)return null;if(!u)return null;const y=(0,q.jsx)(W().Z,{targetCollectionStore:t,pageName:o,onClick:()=>s(d),style:h.row,focused:l});return p?(0,q.jsx)(q.Fragment,{}):c?(0,q.jsx)(K().Z,{style:h.wrapper,disableDesktopPadding:!0,disableMobilePadding:!0,children:y}):y}var z=()=>o(125659),Q=()=>o(594546),Y=()=>o(337897),$=()=>o(763266),X=()=>o(861026),J=()=>o(487270),ee=()=>o(527278),te=()=>o(352230),oe=()=>o(129338),ne=()=>o(148126),re=()=>o(8),ie=()=>o(173113),ae=()=>o(766463),se=()=>o(466970),le=()=>o(521777),ce=()=>o(620218),de=()=>o(98228),ue=()=>o(663132),pe=()=>o(876822),ge=()=>o(749826),he=()=>o(138912),me=()=>o(826955),ye=()=>o(897257);const fe=(0,S().vU)({syncedCollectionInputPlaceholder:{defaultMessage:"Link a page",id:"relationPropertyMenuInput.syncedCollection.searchPlaceholder"},connectedRelationInputPlaceholder:{defaultMessage:"Find a page",id:"relationPropertyMenuInput.connectedRelation.searchPlaceholder"},connectedRelationGoogleDriveInputPlaceholder:{defaultMessage:"Paste in Google Drive or Google Docs link",id:"relationPropertyMenuInput.connectedRelationGoogleDrive.searchPlaceholder"},connectedRelationFigmaInputPlaceholder:{defaultMessage:"Paste in https://figma.com/...",id:"relationPropertyMenuInput.connectedRelationFigma.searchPlaceholder"},connectedRelationGithubInputPlaceholder:{defaultMessage:"Paste in https://github.com/...",id:"relationPropertyMenuInput.connectedRelationGithub.searchPlaceholder"}}),ve=(0,S().vU)({inputPlaceholderEditable:{defaultMessage:"Link or create a page…",id:"relationPropertyMenuInput.placeholder.defaultEditable"},formInputPlaceholderEditable:{defaultMessage:"Search…",id:"relationPropertyMenuInput.placeholder.form"},inputPlaceholderUneditable:{defaultMessage:"Search linked pages…",id:"relationPropertyMenuInput.placeholder.defaultUneditable"}}),be=(0,S().vU)({inputPlaceholder:{defaultMessage:"Search {propertyName}...",id:"relationPropertyMenuInput.placeholder.sharing"}}),Se=(0,S().vU)({inputPlaceholder:{defaultMessage:"Search...",id:"relationPropertyMenuInput.placeholder.sprint"}});function Ce(e){let{intl:t,connectedRelationFlags:o,overlayMode:n,disabled:r,format:i}=e;const a=function(e){const{isSyncedCollectionRelation:t,isGithubPrRelation:o,isGoogleDriveRelation:n,isFigmaRelation:r,isConnectedRelation:i}=e;if(t)return fe.syncedCollectionInputPlaceholder;if(o)return fe.connectedRelationGithubInputPlaceholder;if(n)return fe.connectedRelationGoogleDriveInputPlaceholder;if(r)return fe.connectedRelationFigmaInputPlaceholder;if(i)return fe.connectedRelationInputPlaceholder}(o);return a?t.formatMessage(a):"view"===(null==n?void 0:n.type)||r?t.formatMessage(ve.inputPlaceholderUneditable):i&&(0,Y().xE)(i)?t.formatMessage(ve.formInputPlaceholderEditable):t.formatMessage(ve.inputPlaceholderEditable)}function xe(e,t){return e.formatMessage(be.inputPlaceholder,t)}o(821057),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624);var Pe=()=>o(799891),Re=()=>o(792409),_e=()=>o(828946),Me=()=>o(106128);async function ke(e){let{environment:t,query:o,targetCollectionStore:n,blockPointers:r}=e;try{const e=await _e().x.searchActions.load(),{results:i}=await e.searchPagesInCollection({environment:t,query:o.query,collectionId:n.id,limit:o.limit,spaceId:n.getSpaceId(),excludeTemplates:!0,source:"relation_menu",includePublicPagesWithoutExplicitAccess:!0,boostRecentlyViewedPages:!0,ignoresHighlight:!0});return we({results:i,targetCollectionStore:n,blockPointers:r})}catch(i){return Pe().log({level:"error",from:"relationPropertySearchRequest",type:"performDefaultSearchRequest",error:(0,Re().Ui)(i)}),[]}}async function Ie(e){const{environment:t,query:o,targetCollectionStore:n,blockPointers:r}=e;try{const e=await async function(e){const{environment:t,sprintCollectionStore:o,searchQuery:n}=e,r=o.getPropertyMapping(),i=null==r?void 0:r[l().b0.StatusV2],a=null==r?void 0:r[l().b0.Dates];if(!i||!a)throw new Error("Sprints database does not have the required properties");const s="results",c={userTimeZone:(0,h().r)(),searchQuery:n,sort:[{property:i,direction:"ascending"},{property:a,direction:"ascending"}],reducers:{[s]:{type:"results",limit:100}}},d=o.getParentBlockStore();if(!d)return[];await d.load();const u=d.getCollectionViewStores()[0];if(!u)return[];const p=o.getSpaceId(),g=await R().callApi({eventName:"queryCollection",environment:t,data:{source:{type:"collection",id:o.id,spaceId:p},collectionView:{id:u.id,spaceId:p},loader:c},tracking:{src:"relation_property_menu"}});if("success"!==g.type)return[];const m=g.data.result.reducerResults[s];if("results"!==m.type)return[];return m.blockIds}({environment:t,sprintCollectionStore:n,searchQuery:o.query});return we({results:e,targetCollectionStore:n,blockPointers:r})}catch(i){Pe().log({level:"error",from:"relationPropertySearchRequest",type:"performSprintSearchRequest",error:(0,Re().Ui)(i)});return await ke(e)}}function we(e){let{results:t,targetCollectionStore:o,blockPointers:n}=e;const r=new Set(n.map((e=>e.id))),i=[];return t.forEach((e=>{const t={spaceId:o.getSpaceId(),id:e,table:y().iU},n=me().G.createChildStore(o,t);if(r.has(e)){const t={key:e,type:Me().Rt.SelectedPage,store:n};i.push(t)}else{const t={key:e,type:Me().Rt.SearchPage,store:n};i.push(t)}})),i}const je=(0,n.createContext)(void 0);function Te(e){const{children:t,relationPropertyMenuStore:o,property:r,targetCollectionStore:i,propertySchema:a,targetParentUrl:s,connectedRelationFlags:l}=e,c=(0,n.useMemo)((()=>({relationPropertyMenuStore:o,property:r,targetCollectionStore:i,propertySchema:a,targetParentUrl:s,connectedRelationFlags:l})),[o,r,i,a,s,l]);return(0,q.jsx)(je.Provider,{value:c,children:t})}je.displayName="RelationPropertyMenuContext";var Le=()=>o(454860),De=()=>o(707513),Ve=()=>o(909240),Fe=()=>o(291198),Ze=()=>o(729775);function Be(e){const{showTargetDatabase:t,inputPlaceholder:o,addPage:s}=e,{analyticsFrom:l,blockPropertyValueOverlayStore:c,blockStore:d,insertChar:u}=(0,n.useContext)(D().m),p=(0,n.useContext)(je),g=(0,r().O7)(),h=(0,r().Fy)(),{searchQuery:m,searchPopupOpen:y}=(0,i().VK)((()=>(null==p?void 0:p.relationPropertyMenuStore.state)??{searchQuery:u??"",searchPopupOpen:!1}),[null==p?void 0:p.relationPropertyMenuStore,u]),f=(0,i().VK)((()=>null==p?void 0:p.targetCollectionStore.getIcon()),[null==p?void 0:p.targetCollectionStore]),v=(0,a().yK)((e=>({regular:{color:e.mediumTextColor,whiteSpace:"nowrap",marginLeft:4},headerWrap:{display:"flex",width:"100%",position:"relative",zIndex:2,padding:"6px 10px",fontSize:14,background:e.inputBackground,boxShadow:`\n\t\t\t\t\t0 1px 0 ${e.darkDividerColor}\n\t\t\t\t`},recordTitle:{fontWeight:De().Ue.semibold,fontSize:14,marginLeft:Me().Qi*(h.isRetina?.5:1)},searchIcon:{fill:e.mediumIconColor,width:14,height:14,marginRight:10},input:{flexGrow:1},targetDatabase:{display:"flex",marginLeft:10,alignItems:"center"},linkBoxOuterStyle:{marginLeft:Me().Qi},linkBoxInnerStyle:{display:"flex"}})),[h.isRetina]);if(!d||!c||!p)return null;const{relationPropertyMenuStore:b,targetCollectionStore:x,targetParentUrl:P}=p;return(0,q.jsxs)("div",{style:v.headerWrap,children:[(0,q.jsx)(Fe().Z,{style:v.input,value:m,placeholder:o,forceShowClearButton:Boolean(m||y),focus:!0,onChange:e=>{const t=e.target.value;b.setState({...b.state,searchQuery:t,searchPopupOpen:!!t,searchLimit:Le().Z.limitIncrement})},onClearButtonClick:()=>{b.setState(b.getInitialState())},onClick:()=>{b.setState({...b.state,searchQuery:m,searchPopupOpen:!0,searchLimit:Le().Z.limitIncrement})},onKeyDown:e=>{"Escape"===e.key&&b.setState(b.getInitialState())},format:Fe().B.Transparent,onSubmit:()=>{if(!s)return;const e=x.getFormat().integration_id,t=he().default.integrations.state.find((t=>t.id===e)),o=x.getFormat().pattern_name;if(!t||!o)return;(0,oe().DB)({integration:t,patternName:o,url:m})&&s()}}),t&&(0,q.jsx)("div",{style:v.targetDatabase,children:(0,q.jsx)(S()._H,{id:"database.relationProperty.newRelation.targetDatabase",defaultMessage:"<regular>In</regular> {databaseWithIcon}",values:{regular:e=>(0,q.jsx)("span",{style:v.regular,children:e}),databaseWithIcon:(0,q.jsxs)(Ze().Z,{href:P,style:v.linkBoxOuterStyle,innerStyle:v.linkBoxInnerStyle,onClick:()=>{l&&C().ZZ(g,{from:l}),Ve().xv({environment:g,blockPropertyValueOverlayStore:c})},children:[(0,q.jsx)(U().Z,{disabled:!0,icon:f,isEmptyPage:!1,size:Me().WO}),(0,q.jsx)(O().Z,{store:x,underline:!0,style:v.recordTitle,maxLength:25})]})}})})]})}var He=()=>o(565630),Ae=()=>o(513670),Ee=()=>o(494657),Ue=()=>o(119891),Oe=()=>o(78078),Ke=()=>o(668001),Ne=()=>o(312578),We=()=>o(18748),qe=()=>o(255577),Ge=()=>o(906651),ze=()=>o(842574),Qe=()=>o(906769),Ye=()=>o(868744),$e=()=>o(687892);function Xe(e){const{targetCollectionStore:t,onClick:o,focused:s,isSection:l,index:c,onMouseEnter:d,blockPropertyValueOverlayStore:u}=e,p=(0,i().VK)((()=>t.canEdit()),[t]),g=(0,i().VK)((()=>t.isSyncedCollection()),[t]),h=(0,r().Fy)(),m=(0,a().yK)((e=>({medium:{fontWeight:De().Ue.medium},wrapper:{borderTop:`1px solid ${e.lightDividerColor}`},icon:{width:14,fill:"#A6A299",marginRight:-2,marginLeft:0},row:{fontSize:h.isMobile?16:14,minHeight:h.isMobile?44:32}})),[h]),y=(0,q.jsx)(F().Z,{focused:s,onMouseEnter:d,icon:(0,$e().R)(m.icon),style:m.row,onClick:(0,n.useCallback)((()=>{o(c),u.setState({isOpen:!1})}),[c,o,u]),title:(0,q.jsx)(S()._H,{id:"database.searchRelation.MoveToBacklogFooter",defaultMessage:"<medium>Move to backlog</medium>",values:{medium:e=>(0,q.jsx)("span",{style:m.medium,children:e})}})}),f=l?(0,q.jsx)(K().Z,{style:m.wrapper,disableDesktopPadding:!0,disableMobilePadding:!0,children:y}):y;return p?g?null:f:null}var Je=()=>o(903639),et=()=>o(320197),tt=()=>o(250625),ot=()=>o(899018),nt=()=>o(423470),rt=()=>o(333023),it=()=>o(520849),at=()=>o(428241),st=(o(749411),()=>o(730120)),lt=()=>o(646574),ct=()=>o(874459),dt=()=>o(312117),ut=()=>o(565271),pt=()=>o(956057),gt=()=>o(530980),ht=()=>o(572948),mt=()=>o(830968),yt=()=>o(568017),ft=()=>o(326966),vt=()=>o(388915),bt=()=>o(518242),St=()=>o(654133),Ct=()=>o(205228),xt=()=>o(338530),Pt=()=>o(485569),Rt=()=>o(949842),_t=()=>o(164079),Mt=()=>o(852465),kt=()=>o(419273),It=()=>o(998901),wt=()=>o(56424);function jt(){const e=(0,r().O7)(),t=function(){const e=(0,r().Fy)().isMobile;return(0,a().yK)((t=>({figmaResults:{display:"flex",flexDirection:"column",alignItems:"flex-start",fontSize:e?16:12,padding:16,paddingBottom:4},figmaResultsCopyWrapper:{marginTop:0,color:t.lightTextColor}})),[e])}();return e.device.isMobile?(0,q.jsx)(q.Fragment,{}):(0,q.jsx)("div",{style:t.figmaResults,children:(0,q.jsx)("p",{style:t.figmaResultsCopyWrapper,children:(0,q.jsx)(S()._H,{defaultMessage:"To link, paste the Figma File URL above",id:"connectedRelationPropertyMenuResults.figmaRelationUserEducationPasteUrl.description"})})})}var Tt=()=>o(659089),Lt=()=>o(628191),Dt=()=>o(984871),Vt=()=>o(752127),Ft=()=>o(360240),Zt=()=>o(675334),Bt=()=>o(154186),Ht=()=>o(666414),At=()=>o(396439),Et=()=>o(325107),Ut=()=>o(653457);const Ot=(0,S().vU)({githubCopyIdAria:{defaultMessage:"Copy the ID value.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.copyIdAria"},githubAddIdAria:{defaultMessage:"Add a unique id property to the database.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.addIdAria"},githubLearnMoreAria:{defaultMessage:"Learn more about the GitHub Pull Requests feature.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.learnMoreAria"}});function Kt(e){const{pageBlockStore:t,blockPropertyValueOverlayStore:o}=e,n=(0,r().O7)(),a=(0,S().YB)(),s=Nt(),l=(0,z().Y$)(),c=(0,i().VK)((()=>l.collectionStore()),[l]),u=(0,i().VK)((()=>l.databaseType),[l]),p=(0,i().VK)((()=>{var e;return c&&(null===(e=c.getRecordKeyStore())||void 0===e?void 0:e.getRecordKey())}),[c]),{uniqueIdPropertyId:h,uniqueIdValue:m}=(0,i().VK)((()=>{const e=t.getSchema(),o=(0,Tt().$z)(e);if(1!==o.length)return{uniqueIdPropertyId:void 0,uniqueIdValue:void 0};const n=t.getPropertyValue(o[0]);return{uniqueIdPropertyId:o[0],uniqueIdValue:(0,d().ah)(n)}}),[t]),y=(0,i().VK)((()=>(0,Tt().wf)(p,m)),[p,m]),f=(0,i().VK)((()=>!Boolean(p)||!Boolean(m)),[p,m]);return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("div",{style:s.githubResults,children:[(0,q.jsx)(Wt,{}),(0,q.jsx)("p",{style:s.githubResultsCopyWrapper,children:f?(0,q.jsx)(S()._H,{defaultMessage:"Create a prefixed ID property to paste in the GitHub PR title.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.badIdError"}):(0,q.jsx)(S()._H,{defaultMessage:"Copy the {singleItemName} ID and paste it into the title of your PR in GitHub.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducationLinkPastingOn.description",values:{singleItemName:(0,Ft().sN)(u)}})}),(0,q.jsx)(Zt().Z,{width:"100%",uniqueIdPrefix:p,uniqueIdValue:m})]}),(0,q.jsxs)("div",{style:s.githubResultsButtonsWrapper,children:[(0,q.jsxs)(Bt().Z,{style:s.githubResultsLearnMore,ariaLabel:a.formatMessage(Ot.githubLearnMoreAria),onClick:e=>{e.preventDefault(),Vt().D({environment:n,url:(0,ne().UY)("guides.githubRelation"),targetSelf:!1})},children:[(0,Ut().m)({width:n.device.isMobile?16:12}),(0,q.jsx)(At().Z,{size:4}),(0,q.jsx)(S()._H,{defaultMessage:"Learn more",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.learnMore"})]}),f?(0,q.jsxs)(Bt().Z,{style:s.githubResultsCTAButton,ariaLabel:a.formatMessage(Ot.githubAddIdAria),onClick:async e=>{e.preventDefault(),c&&(await Lt().K({environment:n,collectionStore:c}),j().createAndCommit({userAction:"CollectionSettingsAutoIncrementIdPropertyCreateNewIdProperty",environment:n,canUndo:!0,perform:e=>{Dt().G3({environment:n,collectionStore:c,collectionViewArgs:void 0,propertyType:"auto_increment_id",transaction:e})}}),x()._H({environment:n,collectionContextStore:l,from:"github_relation_menu",property_type:"auto_increment_id",integration_id:g().U9}))},children:[(0,le().R)({width:n.device.isMobile?16:12}),(0,q.jsx)(At().Z,{size:4}),(0,q.jsx)(S()._H,{defaultMessage:"Add ID property",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.addId"})]}):(0,q.jsxs)(Bt().Z,{style:s.githubResultsCTAButton,ariaLabel:a.formatMessage(Ot.githubCopyIdAria),onClick:async e=>{e.preventDefault();const r=await _().F.clipboardActions.load();await r.copyString({stringValue:y,environment:n,copiedMessage:r.clipboardMessages.copiedPropertyToClipboard}),h&&x().S$(n,l,{block_id:t.id,property:h,property_type:"auto_increment_id",github_relation_menu:!0}),o.setState({isOpen:!1})},children:[(0,Et().U)({width:n.device.isMobile?16:12}),(0,q.jsx)(At().Z,{size:4}),(0,q.jsx)(S()._H,{defaultMessage:"Copy {singleItemName} ID",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.copyId",values:{singleItemName:(0,Ft().sN)(u)}})]})]})]})}function Nt(){const e=(0,r().Fy)().isMobile;return(0,a().yK)((t=>({githubResults:{display:"flex",flexDirection:"column",alignItems:"flex-start",fontSize:e?16:12,padding:16,paddingBottom:4},githubResultsCopyWrapper:{marginTop:0,color:t.lightTextColor},githubResultsErrorWrapper:{marginTop:0,color:yt().ZP.red},githubResultsButtonsWrapper:{width:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",fontSize:e?16:12,padding:"10px"},githubResultsLearnMore:{display:"flex",flexDirection:"row",alignItems:"center",padding:4,borderRadius:5,color:t.lightTextColor},githubResultsCTAButton:{display:"flex",flexDirection:"row",alignItems:"center",padding:4,borderRadius:5,color:t.blueColor},githubLinkPastingSeparator:{border:t.tableDividerColor,width:"100%"},githubLinkPastingContainer:{width:"100%",position:"relative",display:"flex",justifyContent:"center",alignItems:"center",margin:"8px 0px"},githubLinkPastingSeparatorText:{position:"absolute",backgroundColor:t.popoverBackground,color:t.lightTextColor,padding:"0px 8px"}})),[e])}function Wt(){const e=Nt();return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)("p",{style:e.githubResultsCopyWrapper,children:(0,q.jsx)(S()._H,{defaultMessage:"To link, paste the GitHub PR URL above",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducationPasteUrl.description"})}),(0,q.jsxs)("div",{style:e.githubLinkPastingContainer,children:[(0,q.jsx)(Ht().Z,{size:1,style:e.githubLinkPastingSeparator}),(0,q.jsx)("div",{style:e.githubLinkPastingSeparatorText,children:"or"})]}),(0,q.jsx)(At().Z,{size:8})]})}var qt=()=>o(667009);function Gt(e){const t=(0,r().O7)(),o=function(){const e=(0,r().Fy)().isMobile;return(0,a().yK)((t=>({googleDriveResults:{display:"flex",flexDirection:"column",alignItems:"flex-start",fontSize:e?16:12,padding:16,paddingBottom:4,paddingTop:4},googleDriveResultsCopyWrapper:{marginTop:0,color:t.lightTextColor,marginBottom:0},googleDriveResultsLearnMore:{display:"flex",flexDirection:"row",alignItems:"center",padding:4,borderRadius:5},googleDriveResultsAccount:{fontSize:12,margin:0},googleDriveLinkPastingSeparator:{border:t.tableDividerColor,width:"100%"},googleDriveLinkPastingContainer:{width:"100%",position:"relative",display:"flex",justifyContent:"center",alignItems:"center",margin:"8px 0px"},googleDriveLinkPastingSeparatorText:{position:"absolute",backgroundColor:t.cardContentBackground,color:t.lightTextColor,padding:"0px 8px"}})),[e])}(),n=(0,i().VK)((()=>he().default.externalAuthentications.state.filter((e=>{let{integration_id:t}=e;return t===g().f3}))),[]);return t.device.isMobile?(0,q.jsx)(q.Fragment,{}):(0,q.jsxs)("div",{style:o.googleDriveResults,children:[(0,q.jsx)("p",{style:o.googleDriveResultsCopyWrapper,children:(0,q.jsx)(S()._H,{defaultMessage:"To link, paste the Google Drive File URL above",id:"connectedRelationPropertyMenuResults.googleDriveRelationUserEducationPasteUrl.description"})}),(0,q.jsxs)("div",{style:o.googleDriveLinkPastingContainer,children:[(0,q.jsx)(Ht().Z,{size:1,style:o.googleDriveLinkPastingSeparator}),(0,q.jsx)("div",{style:o.googleDriveLinkPastingSeparatorText,children:"or"})]}),(0,q.jsx)(At().Z,{size:2}),(0,q.jsx)("p",{style:o.googleDriveResultsCopyWrapper,children:(0,q.jsx)(S()._H,{defaultMessage:"Select an account below to browse files on your Google Drive",id:"connectedRelationPropertyMenuResults.googleDriveRelationUserEducationSourcePicker.description"})}),(0,q.jsx)(At().Z,{size:2}),n.map(((n,r)=>(0,q.jsx)(Bt().Z,{style:o.googleDriveResultsLearnMore,onClick:async o=>{o.preventDefault(),await(async(o,n)=>{const r=await T().jh({environment:t,externalAuthenticationValue:n}),i=he().default.integrations.state.find((e=>e.id===n.integration_id));if(!i)return;const{id:a,name:s,info:l}=i,{icon:c,dark_icon:d,accent_color:u,accent_icon:p}=l,g="dark"===t.ThemeStore.state.mode&&d?d:c;g&&u&&p&&r&&"failed"!==r.type&&await(0,qt().v)({environment:t,accessToken:r.data.access_token,callback:(t,n)=>{e.onFileSelect(o,n)},integration:{id:a,name:s,icon:g,accentColor:u,accentIcon:p},from:"connected_relation_property_value"})})(o,n)},children:(0,q.jsx)("p",{style:o.googleDriveResultsAccount,children:(0,q.jsx)(S()._H,{defaultMessage:"{account}",id:"connectedRelationPropertyMenuResults.googleDriveRelation.googleDriveAccount.description",values:{account:n.account_name}})})},r)))]})}function zt(){const e=(0,r().O7)(),t=function(){const e=(0,r().Fy)().isMobile;return(0,a().yK)((t=>({salesforceResults:{display:"flex",flexDirection:"column",alignItems:"flex-start",fontSize:e?16:12,padding:16,paddingBottom:4,paddingTop:4},salesforceResultsCopyWrapper:{marginTop:0,color:t.lightTextColor,marginBottom:0},salesforceResultsLearnMore:{display:"flex",flexDirection:"row",alignItems:"center",padding:4,borderRadius:5}})),[e])}();return e.device.isMobile?(0,q.jsx)(q.Fragment,{}):(0,q.jsx)(q.Fragment,{children:(0,q.jsx)("div",{style:t.salesforceResults,children:(0,q.jsx)("p",{style:t.salesforceResultsCopyWrapper,children:(0,q.jsx)(S()._H,{defaultMessage:"To link, paste the Salesforce URL above",id:"connectedRelationPropertyMenuResults.salesforceRelationUserEducationPasteUrl.description"})})})})}function Qt(e){let{patternName:t}=e;const o=(0,r().O7)(),n=function(){const e=(0,r().Fy)().isMobile;return(0,a().yK)((t=>({slackResults:{display:"flex",flexDirection:"column",alignItems:"flex-start",fontSize:e?16:12,padding:16,paddingBottom:4},slackResultsCopyWrapper:{marginTop:0,color:t.lightTextColor}})),[e])}();return o.device.isMobile?null:(0,q.jsx)("div",{style:n.slackResults,children:(0,q.jsx)("p",{style:n.slackResultsCopyWrapper,children:"slack_channel"===t?(0,q.jsx)(S()._H,{defaultMessage:"To link, paste the Slack channel URL above",id:"connectedRelationPropertyMenuResults.slackChannelRelationUserEducationPasteUrl.description"}):(0,q.jsx)(S()._H,{defaultMessage:"To link, paste the Slack URL above",id:"connectedRelationPropertyMenuResults.slackRelationUserEducationPasteUrl.description"})})})}function Yt(e){var t;const{sections:o,targetCollectionStore:n,search:s,property:l,propertySchema:c,pageRecordStore:u,blockPropertyValueOverlayStore:p}=e,f=(0,a().yK)((e=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px 16px 16px 8px"},settingsMenuSearchBox:{background:e.contentBackground,marginBottom:10},addPageButton:{width:"100%",display:"flex",justifyContent:"center"},suggestionBox:{display:"flex",alignItems:"center",fontSize:12,color:yt().ZP.white,background:yt().ZP.blue,borderRadius:6,padding:10,boxShadow:e.largeLightBoxShadow,alignSelf:"center",maxWidth:"80%"},errorMessage:{alignSelf:"center",padding:10,fontSize:14,color:e.errorText},addingPage:{width:"100%",padding:10,display:"flex",justifyContent:"flex-start",fontSize:14,color:e.mediumTextColor},enterText:{color:e.lightTextColor}})),[]),v=d().Kp(c),b=d().gg(c),C=d().ic(c),x=d().R3(c),P=d().RB(c),_=(0,i().VK)((()=>{if(!n)return;const e=n.getFormat().integration_id;return he().default.integrations.state.find((t=>t.id===e))}),[n]),M=(0,i().VK)((()=>_?(0,$().NP)(_.id):[]),[_]),k=(0,r().O7)(),I=(0,S().YB)(),w=(0,a().Fg)(),j=(0,i().VK)((()=>{const e=he().default.state;return e.loaded?e.integrations:[]}),[]),T=(0,i().VK)((()=>{var e;return Boolean(null===(e=pe().default.state.currentSpaceStore)||void 0===e?void 0:e.canAdmin())}),[]),L=(0,i().VK)((()=>{var e;return!(!(null===(e=pe().default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit())||!(0,$().sw)(k))}),[k]),D=(0,i().VK)((()=>{const e=he().default.state;return e.loaded&&_?e.externalAuthentications.filter((e=>e.integration_id===_.id)):[]}),[_]),V=(0,i().VK)((()=>D.length?D[0]:null),[D]),[{value:Z,status:B}]=(0,m().r5)((async()=>{if(!V||!_||!(0,g().ok)(_.id))return;const e=V.parent_id;return R().callApi({eventName:"listExternalObjects",environment:k,data:{bot_id:e,query:s}})}),[k,V,s,_],{debounce:1e3}),H=(0,i().VK)((()=>n.getFormat().pattern_name),[n]),A=(0,i().VK)((()=>{if(_&&s)return(0,oe().DB)({integration:_,patternName:H,url:s})}),[H,_,s]),E=(0,Mt().OY)(u)?u:void 0,U=(0,i().VK)((()=>(0,Mt().OY)(u)?u.getPropertyStore(l):void 0),[u,l]),O=(0,i().VK)((()=>null==n?void 0:n.getIcon()),[n]),N=(0,i().VK)((()=>{var e;return null===(e=pe().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),W=(0,xt().C)(),G={key:"githubPrRelationUserEducation",render:e=>void 0!==E&&(0,q.jsx)(Kt,{pageBlockStore:E,blockPropertyValueOverlayStore:p}),items:[]},z={key:"googleDriveRelation",render:t=>(0,q.jsx)(Gt,{onFileSelect:(t,o)=>{(0,Rt().ZP)({context:Rt().Af.ButtonMouseDown,callback:()=>{e.addPage(o)},event:t})}}),items:[]},Q={key:"figmaRelation",render:e=>(0,q.jsx)(jt,{}),items:[]},Y={key:"salesforceRelation",render:e=>(0,q.jsx)(zt,{}),items:[]},X={key:"slackRelation",render:e=>(0,q.jsx)(Qt,{patternName:H}),items:[]};if(!U||!_)return(0,q.jsx)(qe().Z,{type:qe().i.Vertical,style:{padding:"4px 0px"},initialFocus:0,sections:o});if(!((0,g().Hz)(null==_?void 0:_.id)?null===(t=M[0])||void 0===t?void 0:t.id:null==V?void 0:V.parent_id)){const e=function(e){const{collectionIcon:t,integration:o,environment:n,spaceId:r,isAdmin:i,userAllowedToAuth:a}=e,s=o.id===g().U9,l=()=>{r&&(vt().hM({environment:n,integration:o,spaceId:r,from:"connected_relation_property_menu"}),wt().Z.reset())},c=!s&&o.id!==g().Dv;if(c){if(e.environment.device.isMobile)return{key:"askUseBrowserOrDesktopForAuth",render:e=>(0,q.jsx)(K().Z,{...e,disableMobilePadding:!0,title:(0,q.jsx)("div",{style:{whiteSpace:"normal",paddingTop:8},children:(0,q.jsx)(S()._H,{defaultMessage:"Please authorize this integration in the browser or a desktop app.",id:"connectedRelationProperty.mobile.guide.title"})})}),items:[]};if(!a)return{key:"askGuestToGetMemberAccess",render:e=>(0,q.jsx)(K().Z,{...e,disableMobilePadding:!0,title:(0,q.jsx)("div",{style:{whiteSpace:"normal",paddingTop:8},children:(0,q.jsx)(S()._H,{defaultMessage:"To use {integration} integration, request the workspace admin to add you as a member",id:"connectedRelationProperty.guest.auth.guide",values:{integration:o.name}})})}),items:[]}}const d=!s||i&&a?{key:"authenticateButton",render:e=>(0,q.jsx)(F().Z,{...e,title:(0,q.jsx)(S()._H,{defaultMessage:"Connect to {integration}",id:"connectedRelationPropertyMenuResults.authenticateButton.title",values:{integration:o.name}}),icon:(0,q.jsx)(bt().ZP,{src:null==t?void 0:t.icon,style:{width:14}})}),action:()=>l()}:{key:"askAdminToAuthenticateButton",render:e=>(0,q.jsx)(F().Z,{...e,title:(0,q.jsx)("div",{style:{whiteSpace:"normal"},children:(0,q.jsx)(S()._H,{defaultMessage:"Ask your workspace admin to configure the GitHub (Workspace) connection.",id:"connectedRelationPropertyMenuResults.askAdminToAuthenticateButton.title"})}),icon:(0,q.jsx)(bt().ZP,{src:null==t?void 0:t.icon,style:{width:14}}),hoveredStyle:{cursor:"default",background:void 0},pressedStyle:{background:void 0}}),action:()=>{}};return{key:"authenticateIntegration",render:e=>(0,q.jsx)(K().Z,{...e,disableMobilePadding:!0,title:(0,q.jsx)(S()._H,{defaultMessage:"Connect to {integration}",id:"connectedRelationPropertyMenuResults.authenticateHeader.title",values:{integration:o.name}})}),items:[d]}}({environment:k,integration:_,collectionIcon:O,spaceId:N,isAdmin:T,userAllowedToAuth:L});return(0,q.jsx)(qe().Z,{type:qe().i.Vertical,style:{padding:"4px 0px"},initialFocus:0,sections:[...o,e]})}const J=("success"===(null==Z?void 0:Z.type)&&"data"in Z.data?Z.data.data:[]).map((e=>{const t=e.attributes.flatMap((e=>{const t=(0,mt().GY)(e);return(0,ut().nj)(t)?[t]:(console.error(t),[])})),o=(0,ft().m8)(t.flatMap((e=>[[e.id,e]])));return{uri:e.uri,attributes:t,attributesById:o}}));function ee(){let e=(0,q.jsx)(S()._H,{id:"connectedRelationPropertyMenuResults.addPageButton.label",defaultMessage:"Link page"});return(null==_?void 0:_.id)===g().f3||(null==_?void 0:_.id)===g().mQ?e=(0,q.jsx)(S()._H,{id:"connectedRelationPropertyMenuResults.addFileButton.label",defaultMessage:"Link file"}):(null==_?void 0:_.id)===g().Nw?e=(0,q.jsx)(S()._H,{id:"connectedRelationPropertyMenuResults.addTicketButton.label",defaultMessage:"Link ticket"}):(null==_?void 0:_.id)===g().U9?e=(0,q.jsx)(S()._H,{id:"connectedRelationPropertyMenuResults.addPRButton.label",defaultMessage:"Link PR"}):(null==_?void 0:_.id)===g().aW?e=(0,q.jsx)(S()._H,{id:"connectedRelationPropertyMenuResults.addObjectButton.label",defaultMessage:"Link Object"}):(null==_?void 0:_.id)===g().nO&&"slack_channel"===H?e=(0,q.jsx)(S()._H,{id:"connectedRelationPropertyMenuResults.addChannelButton.label",defaultMessage:"Link channel"}):(null==_?void 0:_.id)===g().nO&&(e=(0,q.jsx)(S()._H,{id:"connectedRelationPropertyMenuResults.addMessageButton.label",defaultMessage:"Link message"})),e}const te={key:"thirdPartySearchResults",render:e=>(0,q.jsx)(K().Z,{...e,disableMobilePadding:!0}),items:[{key:"addPage",render:e=>(0,q.jsx)(F().Z,{...e,title:ee(),icon:(0,kt().f)({width:14}),right:(0,q.jsx)(S()._H,{id:"connectedRelationPropertyMenuResults.linkPageButton.enter",defaultMessage:"Enter"}),rightStyle:f.enterText}),action:t=>{(0,Rt().ZP)({event:t,context:Rt().Af.ButtonMouseDown,callback:()=>{e.addPage()}})}}]},ne={key:"noResultsFoundInThirdParty",render:e=>(0,q.jsx)(K().Z,{...e,disableMobilePadding:!0,title:(0,q.jsx)(S()._H,{defaultMessage:"No results found in {integration}.",id:"connectedRelationPropertyMenuResults.notMatched.help",values:{integration:_.name}})}),items:[]},re=[];_&&(0,g().ok)(_.id)&&re.push(...function(e){const{environment:t,intl:o,theme:n,externalIntegrations:r,emojiData:i}=e,a=e.results.flatMap((e=>{const t=e.attributesById.start;if(t&&(0,mt().Gc)(t)){const n=(0,ct().NK)(t.values[0],(0,h().r)(),o.locale);return[{...e,dateTime:n.start}]}return[]})),s=Ae().vM(a,(e=>e.dateTime.toFormat(ct().Iq))),l=Ae().MR(Object.keys(s),(e=>st().ou.fromFormat(e,ct().Iq).valueOf())).flatMap((a=>{const l=s[a],c=Ae().MR(l,(e=>e.dateTime.valueOf())),d=(0,dt().Ki)(a);if(!d)return[];let u;(Ae().Xy(d,(0,ct().Lg)((0,h().r)()))||Ae().Xy(d,(0,ct().Ro)((0,h().r)())))&&(u="relative");const p=(0,lt().ZV)({value:d,intl:o,allowRelativeDates:Boolean(u),date_format:u});return[{key:p,items:c.flatMap((a=>{const s=new(me().G)(t,{table:y().iU,id:pt().Il(),spaceId:pt().Il()}),l={id:s.id,type:"external_object_instance",alive:!0,format:{bot_id:"",external_object_id:"",uri:a.uri,attributes:a.attributes},version:0,space_id:"",parent_id:"",parent_table:"block"};let c=null,d=null;const u=a.attributesById.title,p=a.attributesById.start,g=a.attributesById.end;return p&&g&&(0,mt().Gc)(p)&&(0,mt().Gc)(g)&&(c=(0,q.jsx)("div",{children:(0,q.jsxs)("span",{children:[(0,q.jsx)(Pt().r4,{style:{color:void 0,display:"inline"},attribute:p,dateStyle:"exact_time"})," - ",(0,q.jsx)(Pt().r4,{attribute:g,dateStyle:"exact_time",style:{color:void 0,display:"inline"}})]})}),d=(0,q.jsxs)("div",{children:[(0,q.jsx)("span",{children:(0,q.jsx)(Pt().ox,{style:{color:void 0,display:"inline"},store:s,attribute:u})}),c]})),{key:a.uri,render:e=>(0,q.jsx)(St().Z,{renderTooltip:()=>d,placement:It().Placement.Left,textWrap:!0,render:a=>(0,q.jsx)(F().Z,{...(0,_t().Z)(a||{},e),title:(0,ht().dD)({blockModel:gt().kk5.fromBlock(l),intl:o,index:0,style:{},disableHover:!0,disableLinks:!0,isAndroid:!1,classNames:[],theme:n,baseUrl:Ct().default.domainBaseUrl,emojiType:"raw",currentUserId:t.currentUser.id,getRecordModel:s.getRecordModel,externalIntegrations:r,emojiData:i}),caption:c})}),action:t=>{(0,Rt().ZP)({event:t.event,context:Rt().Af.ButtonMouseDown,callback:()=>{e.addPage(a.uri)}})}}})),render:e=>(0,q.jsx)(K().Z,{...e,disableMobilePadding:!0,title:p})}]}));return l}({environment:k,intl:I,theme:w,externalIntegrations:j,results:J,addPage:e.addPage,emojiData:W}));const ie={key:"loadingSpinner",render:t=>(0,q.jsx)(K().Z,{...t,disableMobilePadding:!0,title:(0,q.jsxs)("div",{style:{...f.addingPage,justifyContent:e.addingPage?"center":"flex-start"},children:[(0,q.jsx)(Ne().Z,{}),(0,q.jsx)("span",{style:{marginLeft:10},children:(0,q.jsx)(S()._H,{id:"connectedRelationPropertyMenuResults.fetchingData",defaultMessage:"Fetching data..."})})]})}),items:[]},ae=[];return"pending"===B||e.addingPage?ae.push(ie):A?ae.push(te):re.length>0?ae.push(...re):b?ae.push(z):C?ae.push(Q):x?ae.push(Y):P?ae.push(X):v&&0===o.length?ae.push(G):v&&o.length>0||ae.push(ne),(0,q.jsx)(qe().Z,{type:qe().i.Vertical,style:{padding:"4px 0px"},initialFocus:0,sections:[...o,...ae]})}function $t(){return(0,q.jsx)("div",{style:{height:"100%",padding:Me().wI,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,q.jsx)(Ne().Z,{style:{margin:"0 auto"}})})}function Xt(e){const{collectionStore:t,targetCollectionStore:o,schema:n,property:r,showRight:a,disabled:s,style:l}=e,d=(0,i().VK)((()=>o.isSyncedCollection()),[o]),u=(0,i().VK)((()=>{const e=n[r];return Boolean(e&&c().NK(e))}),[n,r]);return(0,q.jsx)(K().Z,{...e,noTextOverflow:!0,isTitleUppercase:!1,right:a&&!d&&!u&&t&&(0,q.jsx)(Je().default,{collectionStore:t,targetCollectionStore:o,property:r,disabled:s}),style:{paddingTop:0,paddingBottom:4,...l},desktopTitleStyle:{height:19,alignItems:"center",marginTop:6,marginBottom:6,paddingLeft:12,paddingRight:9}})}const Jt=function(e){const t=(0,r().Fy)(),a=(0,i().qz)(void 0,o(692304).Z),s=(0,i().qz)(void 0,o(280977).Z),l=(0,He().D9)(e.searchQuery);return(0,n.useEffect)((()=>{!e.searchQuery||(0,Ae().Xy)(l,e.searchQuery)||t.isMobile||a.setState({...a.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[t.isMobile,a,l,e.searchQuery]),t.isMobile?(0,q.jsx)(go,{relationPropertyMenuResultProps:e,menuListStore:a,draggableListStore:s}):(0,q.jsx)(co,{relationPropertyMenuResultProps:e,menuListStore:a,draggableListStore:s})};function eo(e,t){const o=t[e];return Boolean(o&&"relation"===o.type&&1===o.limit)}function to(e){const{result:t,pointer:o,environment:n,relationPropertyMenuResultProps:r,canDragRow:i,isSharingEnabled:a,limitReached:s,propertyLimit:l}=e,{disabled:c,parentStore:d,collectionStore:u,collectionId:p,schema:g,targetCollectionStore:h,onAccept:m,property:y,propertySchema:f,blockPropertyValueOverlayStore:v,onClickActionButton:b,disableClickToNavigateToPage:S}=r,C=me().G.createChildStore(d,o);return{key:C.id,render:(e,r)=>{let{ref:m,...x}=e;const P=(0,q.jsx)(et().a,{...x,canDrag:i,limitReached:s,collectionStore:u,collectionId:p,schema:g,targetCollectionStore:h,relatedPageStore:C,disabled:c,isSelected:t.type===Me().Rt.SelectedPage,pageStore:d,property:y,propertySchema:f,rowType:"popup",onActionButtonClick:()=>b(t),blockPropertyValueOverlayStore:v,propertyLimit:l,onOpenPageButtonClick:()=>{k().O({relationPointers:[o],relatedPageStore:C,environment:n,from:"relation_property"})},disableClickToNavigateToPage:S});return a?(0,q.jsx)(oo,{originElement:P,pageStore:C,result:t,focused:x.focused,isSelected:t.type===Me().Rt.SelectedPage,onFocus:r.onFocus,onClickActionButton:b}):P},action:e=>{a&&t.type!==Me().Rt.SelectedPage||m(t,tt().DJ(e.event))}}}function oo(e){let{originElement:t,pageStore:o,result:s,focused:l,onFocus:c,isSelected:d,onClickActionButton:u}=e;const p=(0,r().O7)(),g=(0,r().Fy)(),h=(0,at().u)(),m=(0,i().VK)((()=>rt().mk({store:o,environment:p,trustedDomainsStore:h})),[o,p,h]),[y,f]=(0,n.useState)(!1),v=(0,a().yK)((e=>({unselectedHeader:{paddingRight:10,paddingLeft:10,paddingTop:6,paddingBottom:6,borderRadius:6,color:e.text.uiYellowPrimary,backgroundColor:e.tint.uiYellow,fontSize:14,fontWeight:400},selectedHeader:{paddingRight:8,paddingLeft:8,paddingTop:4,color:e.mediumTextColor,fill:e.mediumIconColor,fontSize:14,fontWeight:400},pageTitleWrapper:{display:"inline",padding:2},icon:{display:"inline-block",marginRight:4,width:12,height:12},title:{display:"inline",overflow:"hidden",wordBreak:"break-word",textWrap:"balance",fontWeight:500},popupContainer:{padding:16,display:"flex",flexDirection:"column",height:"100%"},permissionsListContainer:{flex:1,overflow:"auto"},generalAccessPermissionListContainer:{borderTop:`0.5px solid ${e.darkDividerColor}`,paddingTop:8},confirmButton:{width:"100%"}})),[]);return g.isPhone?(0,q.jsxs)("div",{onClick:e=>{d||f(!0)},children:[t,(0,q.jsx)(E().ZP,{popupType:E().kQ.SlideUp,enableOutsideClickDismiss:!0,onDismiss:()=>f(!1),open:y,style:{borderTopLeftRadius:24,borderTopRightRadius:24,maxHeight:"66%"},originRect:new DOMRect(0,0,0,0),render:()=>(0,q.jsxs)("div",{style:v.popupContainer,children:[(0,q.jsx)(ot().Qo,{children:d?(0,q.jsx)("div",{style:v.selectedHeader,children:(0,q.jsx)(S()._H,{id:"relationPropertyMenu.sharingEnabled.permissionsList.selectedHeader",defaultMessage:"This task is currently shared with everyone who has access to {title}",values:{title:(0,q.jsxs)("div",{style:v.pageTitleWrapper,children:[(0,q.jsx)(U().Z,{icon:o.getIcon(),isEmptyPage:!1,size:12,disabled:!0,style:v.icon}),(0,q.jsx)(O().Z,{store:o,style:v.title})]})}})}):(0,q.jsx)("div",{style:v.unselectedHeader,children:(0,q.jsx)(S()._H,{id:"relationPropertyMenu.sharingEnabled.permissionsList.unselectedHeader",defaultMessage:"By selecting this project, only the people below will have access to this task:"})})}),(0,q.jsx)("div",{style:v.permissionsListContainer,children:(0,q.jsx)(nt().Z,{store:o,showFooter:!1,showPermissionInheritanceBanner:!1,calculatedPermissions:{...m,showRestrictedPermissionBanner:!1,showSitePublicPermission:!1,showTeamPermission:!0,showSpacePermission:!0},buttonPopupStore:void 0,permissionItemArgs:{location:"relation_menu",shouldDisable:!0}})}),(0,q.jsx)("div",{style:v.generalAccessPermissionListContainer,children:(0,q.jsx)(nt().w,{store:o,calculatedPermissions:m,permissionItemArgs:{location:"relation_menu",shouldDisable:!0}})}),(0,q.jsx)(Ge().Z,{isLarge:!0,style:v.confirmButton,onClick:()=>u(s),children:(0,q.jsx)(S()._H,{id:"relationPropertyMenu.sharingEnabled.confirmButton",defaultMessage:"Confirm"})})]})})]}):(0,q.jsx)(Ye().Z,{focused:l,onFocus:c,disableDefaultClick:!0,renderOrigin:(e,o)=>(0,q.jsx)(We().ZP,{...e,ref:o,title:t,textWrapperStyle:{margin:0},showExtensionArrow:!1}),renderExtension:e=>(0,q.jsxs)("div",{...e,children:[(0,q.jsx)(ot().Qo,{children:d?(0,q.jsx)("div",{style:v.selectedHeader,children:(0,q.jsx)(S()._H,{id:"relationPropertyMenu.sharingEnabled.permissionsList.selectedHeader",defaultMessage:"This task is currently shared with everyone who has access to {title}",values:{title:(0,q.jsxs)("div",{style:v.pageTitleWrapper,children:[(0,q.jsx)(U().Z,{icon:o.getIcon(),isEmptyPage:!1,size:12,disabled:!0,style:v.icon}),(0,q.jsx)(O().Z,{store:o,style:v.title})]})}})}):(0,q.jsx)("div",{style:v.unselectedHeader,children:(0,q.jsx)(S()._H,{id:"relationPropertyMenu.sharingEnabled.permissionsList.unselectedHeader",defaultMessage:"By selecting this project, only the people below will have access to this task:"})})}),(0,q.jsx)(nt().Z,{store:o,showFooter:!1,showPermissionInheritanceBanner:!1,calculatedPermissions:{...m,showRestrictedPermissionBanner:!1,showSitePublicPermission:!1,showTeamPermission:!0,showSpacePermission:!0},buttonPopupStore:void 0,permissionItemArgs:{location:"relation_menu",shouldDisable:!0}})]})})}function no(e){const{canDrag:t,property:o,schema:n,totalRelatedPages:r}=e;return t&&!eo(o,n)&&r>1}function ro(e){const{numRelatedPages:t,integrationId:o,limit:n}=e;return n&&1===n?(0,q.jsx)(S()._H,{id:"database.relationProperty.relatedPages.limit.subHeader",defaultMessage:"Selected"}):o===g().f3||o===g().mQ?(0,q.jsx)(S()._H,{id:"database.relationProperty.relatedGoogleDriveOrFigmaFiles.subHeader",defaultMessage:"{count, plural, one {{count} linked file} other {{count} linked files}}",values:{count:t}}):o===g().U9?(0,q.jsx)(S()._H,{id:"database.relationProperty.relatedGithubPages.subHeader",defaultMessage:"{count, plural, one {{count} linked PR} other {{count} linked PRs}}",values:{count:t}}):(0,q.jsx)(S()._H,{id:"database.relationProperty.relatedPages.subHeader",defaultMessage:"{count} selected",values:{count:t}})}function io(e){const{loading:t,numRelatedPages:o,numUnrelatedPages:n,limit:r}=e;if(!t||0!==o||0!==n)return 0===n?(0,q.jsx)(S()._H,{id:"database.relationProperty.noResults.subHeader",defaultMessage:"No results"}):0===o?void 0:r&&1===r?(0,q.jsx)(S()._H,{id:"database.relationProperty.changeSelection.subHeader",defaultMessage:"Change selection"}):(0,q.jsx)(S()._H,{id:"database.relationProperty.selectMore.subHeader",defaultMessage:"Select more"})}const ao=(0,S().vU)({selected:{id:"database.relationProperty.sharing.selected.subHeader",defaultMessage:"Selected"},unselected:{id:"database.relationProperty.sharing.unselected.subHeader",defaultMessage:"Possible choices"}});function so(e){const{targetCollectionStore:t,collectionStore:o,schema:n,property:r,canConfigureCollection:i,numRelatedPages:a,handleClearProperty:s,overlayMode:l,index:c,blockPropertyValueOverlayStore:d}=e;return{key:"backlog",render:e=>(0,q.jsx)(Xt,{...e,collectionStore:o,schema:n,targetCollectionStore:t,property:r,showRight:0===a||"add"===(null==l?void 0:l.type),disabled:!i,style:{paddingBottom:0,paddingTop:0}}),items:[{key:"sprints_backlog",render:e=>(0,q.jsx)(Xe,{focused:e.focused,onMouseEnter:e.onMouseEnter,targetCollectionStore:t,onClick:s,isSection:!1,index:c,blockPropertyValueOverlayStore:d}),action:()=>{s&&s()}}]}}function lo(e){let{relationPropertyMenuResultProps:t,menuListStore:o,draggableListStore:a}=e;const{results:s,onDrag:c,parentStore:d,collectionStore:u,targetCollectionStore:p,property:g,canDrag:h,canConfigureCollection:m,loading:y,onCreatePage:f,overlayMode:v,disabled:b,schema:C,searchQuery:x,index:P,handleClearProperty:R,blockPropertyValueOverlayStore:_,relationPropertyMenuStore:M,addPage:k,addingPage:I}=t,w=(0,r().O7)(),j=(0,n.useCallback)(((e,t)=>function(e,t,o,n){n&&n(e),Ee().sv({store:o,focus:{section:0,indexLocal:t.endPosition,indexGlobal:t.endPosition,footerFocused:!1}})}(e,t,o,c)),[o,c]),{device:T}=w,D=(0,S().YB)(),V=C[g],F=Boolean("relation"===(null==V?void 0:V.type)&&V.connectedRelation),Z=(0,ie().a)(V),B=(0,i().VK)((()=>function(e,t,o){const n=e.getDatabaseType()===l().p$;return t?{getCanDragRow:()=>!1,getRelatedSectionHeaderTitle:()=>o.formatMessage(ao.selected),getUnrelatedSectionHeaderTitle:()=>o.formatMessage(ao.unselected),getFooterSection:()=>{}}:n?{getCanDragRow:()=>!1,getRelatedSectionHeaderTitle:()=>{},getUnrelatedSectionHeaderTitle:()=>{},getFooterSection:so}:{getCanDragRow:no,getRelatedSectionHeaderTitle:ro,getUnrelatedSectionHeaderTitle:io,getFooterSection:()=>{}}}(p,Z,D)),[Z,p,D]),H=(0,i().VK)((()=>{if(_.state.isOpen)return(0,L().vp)(V,_.state.formQuestionStore)}),[V,_]),[A,E]=(0,i().VK)((()=>{const e=[],o=[],n=s.filter((e=>e.type===Me().Rt.SelectedPage)).length;for(const r of s)if(r.type===Me().Rt.SearchPage){const e=r.store,i=Boolean(H&&n>=H);e.isTemplate()||o.push(to({environment:w,isSharingEnabled:Z,result:r,pointer:e.pointer,relationPropertyMenuResultProps:t,canDragRow:!1,limitReached:i,propertyLimit:H}))}else if(r.type===Me().Rt.SelectedPage){const o=B.getCanDragRow({canDrag:h,property:g,schema:C,totalRelatedPages:n});e.push(to({environment:w,result:r,pointer:r.store.pointer,relationPropertyMenuResultProps:t,canDragRow:o,isSharingEnabled:Z}))}return[e,o]}),[s,w,t,B,h,g,C,Z,H]),U=(0,i().VK)((()=>p.getFormat().integration_id),[p]),O=B.getRelatedSectionHeaderTitle({numRelatedPages:A.length,integrationId:U,limit:H}),K=[];if(A.length>0){const e=A.map((e=>e.key.toString()));K.push({key:"results",render:t=>(0,q.jsx)(Xt,{...t,title:O,collectionStore:u,schema:C,targetCollectionStore:p,property:g,showRight:"add"!==(null==v?void 0:v.type),disabled:!m,style:{paddingBottom:void 0===O?0:4},children:h&&!eo(g,C)&&e.length>1?(0,q.jsx)(Ue().ZP,{direction:"vertical",keys:e,renderKey:o=>t.children[e.indexOf(o)],onDrop:j,store:a}):t.children}),items:A})}if(!F&&(0===E.length&&0===A.length||E.length>0)){const e=B.getUnrelatedSectionHeaderTitle({loading:y,numRelatedPages:A.length,numUnrelatedPages:E.length,limit:H}),t=!y&&0===E.length&&!T.isMobile&&!F&&x;let o;t&&E.push({key:"empty",render:e=>(0,q.jsx)(G,{targetCollectionStore:p,title:x||"",focused:e.focused,onClick:f,isSection:!1,index:P}),action:()=>{f&&f()}}),(t||void 0===e)&&(o={paddingBottom:0});const n={key:"unrelated",render:t=>(0,q.jsx)(Xt,{...t,title:e,collectionStore:u,schema:C,targetCollectionStore:p,property:g,showRight:0===A.length||"add"===(null==v?void 0:v.type),disabled:!m,style:o}),items:E};"add"===(null==v?void 0:v.type)?K.unshift(n):K.push(n)}if(!T.isMobile&&A.length>0&&!b){const e=B.getFooterSection({targetCollectionStore:p,collectionStore:u,schema:C,property:g,canConfigureCollection:m,numRelatedPages:A.length,handleClearProperty:R,overlayMode:v,index:P,blockPropertyValueOverlayStore:_});e&&K.push(e)}return F?(0,q.jsx)(Yt,{blockPropertyValueOverlayStore:_,targetCollectionStore:p,sections:K,propertySchema:V,property:g,pageRecordStore:d,search:x,relationPropertyMenuStore:M,addPage:k,addingPage:I}):(0,q.jsx)(qe().Z,{type:qe().i.Vertical,store:o,style:{padding:"4px 0px"},initialFocus:w.device.isMobile?void 0:0,sections:K})}function co(e){let{relationPropertyMenuResultProps:t,menuListStore:o,draggableListStore:n}=e;const{results:r,loading:a,onScrollOffsetChange:s}=t,l=(0,i().VK)((()=>"on"===ge().default.getEligibleGroup({experimentId:"search_surfaces_relation_search",defaultGroup:"unassigned"})&&a),[a]),c=0===r.length;return(0,q.jsxs)(ze().Z,{style:{width:"100%",maxHeight:300,position:"relative",...c&&{marginTop:0}},type:it().Z.Y,children:[c&&l&&(0,q.jsx)(uo,{}),(0,q.jsx)(lo,{relationPropertyMenuResultProps:t,menuListStore:o,draggableListStore:n}),s&&(0,q.jsx)(Qe().Z,{onChange:s}),a?l?(0,q.jsx)(po,{}):(0,q.jsx)($t,{}):null]})}function uo(){const e=(0,a().yK)((e=>({sectionName:{height:12,borderRadius:4,width:"20%",marginTop:15,marginLeft:13,marginBottom:6}})),[]);return(0,q.jsx)(Ke().Z,{style:e.sectionName})}const po=(0,n.memo)((function(e){const{count:t=10}=e,o=(0,a().yK)((e=>({wrapper:{marginRight:8,marginLeft:12},icon:{height:16,width:16,borderRadius:4},pageName:{height:15,borderRadius:4,marginLeft:-1}})),[]),n=Array.from({length:t},(()=>!0));return(0,q.jsx)("div",{style:o.wrapper,children:(0,q.jsx)(Oe().sg,{gap:12,children:n.map(((e,t)=>(0,q.jsx)("div",{children:(0,q.jsxs)(Oe().X2,{gap:8,alignItems:"center",children:[(0,q.jsx)(Ke().Z,{style:o.icon}),(0,q.jsx)(Ke().Z,{style:{...o.pageName,width:Ae().UP(["30%","40%","43%","45%","48%","50%","54%","55%","60%"])}})]})},`relation-result-shimmer-${t}`)))})})}));function go(e){let{relationPropertyMenuResultProps:t,menuListStore:o,draggableListStore:r}=e;const{results:i,loading:a,resultsType:s,schema:l,property:c,blockPropertyValueOverlayStore:d,targetCollectionStore:u,parentStore:p,searchQuery:g,relationPropertyMenuStore:h,addPage:m,addingPage:y}=t,f=0===i.length,v=l[c];return Boolean("relation"===(null==v?void 0:v.type)&&v.connectedRelation)&&f?(0,q.jsx)("div",{style:{marginTop:20},children:(0,q.jsx)(Yt,{blockPropertyValueOverlayStore:d,targetCollectionStore:u,sections:[],propertySchema:v,property:c,pageRecordStore:p,search:g,relationPropertyMenuStore:h,addPage:m,addingPage:y})}):(0,q.jsxs)(n.Fragment,{children:[f&&!a&&"existing"===s?void 0:(0,q.jsx)(lo,{relationPropertyMenuResultProps:t,menuListStore:o,draggableListStore:r}),a&&(0,q.jsx)($t,{})]})}var ho=()=>o(955620),mo=()=>o(348141),yo=()=>o(715139),fo=()=>o(1910),vo=()=>o(708518),bo=()=>o(543631);const So=(0,o(827282).IU)("questionMarkFilled",{viewBox:"0 0 14 14",svg:(0,q.jsx)("path",{d:"M7 14C6.04379 14 5.14248 13.817 4.29608 13.451C3.45425 13.085 2.71078 12.5794 2.06569 11.9343C1.42059 11.2892 0.915033 10.5458 0.54902 9.70392C0.183007 8.85752 0 7.95621 0 7C0 6.04379 0.183007 5.14477 0.54902 4.30294C0.915033 3.45654 1.4183 2.71078 2.05882 2.06569C2.70392 1.42059 3.44739 0.915033 4.28922 0.54902C5.13562 0.183007 6.03693 0 6.99314 0C7.94935 0 8.85065 0.183007 9.69706 0.54902C10.5435 0.915033 11.2892 1.42059 11.9343 2.06569C12.5794 2.71078 13.085 3.45654 13.451 4.30294C13.817 5.14477 14 6.04379 14 7C14 7.95621 13.817 8.85752 13.451 9.70392C13.085 10.5458 12.5794 11.2892 11.9343 11.9343C11.2892 12.5794 10.5435 13.085 9.69706 13.451C8.85523 13.817 7.95621 14 7 14ZM6.86275 8.46863C7.04118 8.46863 7.18072 8.42059 7.28137 8.32451C7.38203 8.22386 7.43235 8.10261 7.43235 7.96078C7.43235 7.94706 7.43235 7.93333 7.43235 7.91961C7.43235 7.90131 7.43235 7.88758 7.43235 7.87843C7.43235 7.67712 7.49183 7.50556 7.61078 7.36373C7.72974 7.21732 7.91275 7.06405 8.1598 6.90392C8.50294 6.67974 8.78431 6.44412 9.00392 6.19706C9.22811 5.95 9.3402 5.61373 9.3402 5.18824C9.3402 4.79477 9.23497 4.46536 9.02451 4.2C8.81405 3.93007 8.53726 3.72647 8.19412 3.58922C7.85556 3.45196 7.48497 3.38333 7.08235 3.38333C6.46928 3.38333 5.97059 3.50458 5.58627 3.74706C5.20654 3.98954 4.96634 4.27549 4.86569 4.6049C4.84739 4.6598 4.83137 4.71699 4.81765 4.77647C4.8085 4.83595 4.80392 4.89543 4.80392 4.9549C4.80392 5.11046 4.85654 5.2317 4.96176 5.31863C5.06699 5.40098 5.17909 5.44216 5.29804 5.44216C5.41699 5.44216 5.51765 5.41699 5.6 5.36667C5.68235 5.31177 5.75556 5.24314 5.81961 5.16078L5.94314 4.98922C6.03007 4.85196 6.12843 4.73529 6.23824 4.63922C6.34804 4.54314 6.46928 4.46993 6.60196 4.41961C6.73464 4.36928 6.87876 4.34412 7.03431 4.34412C7.35458 4.34412 7.61078 4.42647 7.80294 4.59118C7.99967 4.75588 8.09804 4.9732 8.09804 5.24314C8.09804 5.48562 8.02255 5.68464 7.87157 5.8402C7.72059 5.99118 7.48954 6.17418 7.17843 6.38922C6.9268 6.56765 6.71634 6.76209 6.54706 6.97255C6.37778 7.18301 6.29314 7.46438 6.29314 7.81667C6.29314 7.83039 6.29314 7.84641 6.29314 7.86471C6.29314 7.87843 6.29314 7.89216 6.29314 7.90588C6.29314 8.28105 6.48301 8.46863 6.86275 8.46863ZM6.84216 10.5755C7.04804 10.5755 7.22647 10.5046 7.37745 10.3627C7.53301 10.2209 7.61078 10.0471 7.61078 9.84118C7.61078 9.63529 7.53529 9.46144 7.38431 9.31961C7.23333 9.1732 7.05261 9.1 6.84216 9.1C6.63627 9.1 6.45784 9.1732 6.30686 9.31961C6.15588 9.46601 6.08039 9.63987 6.08039 9.84118C6.08039 10.0471 6.15588 10.2209 6.30686 10.3627C6.46242 10.5046 6.64085 10.5755 6.84216 10.5755Z"})});var Co=()=>o(848854);function xo(e){let{onConfirm:t,onClosed:o,currentBlockTitle:s,blockWithExistingRelationTitle:l,canAccessBlockWithExistingRelation:c}=e;const d=s?ho().Jcv(s):void 0,u=c&&l?ho().Jcv(l):void 0,p=(0,r().O7)(),g=(0,i().VK)((()=>{const{currentUserSettingsStore:e}=pe().default.state;return e}),[]),[h,m]=n.useState(!1),y=(0,He().Z_)(h,100,((e,t)=>e===t));n.useEffect((()=>{if(!g)return;const e=y?Date.now():null;j().createAndCommit({environment:p,userAction:"twoWayWithLimitAddRelationConfirmationDialog.setDismissModalForever",canUndo:!0,perform:t=>{mo().d2({userSettingsStore:g,transaction:t,data:{relation_limit_confirmation_dialog_dismissed_at:e}})}})}),[y,g,p]);const f=(0,n.useCallback)((()=>{t(),o()}),[t,o]),v=(0,a().yK)((e=>({checkBoxContainer:{display:"flex",flexDirection:"row",alignItems:"center",gap:4,flexGrow:0,alignSelf:"center",marginTop:24,color:e.text.secondary,fontSize:14,lineHeight:"20px"},questionMarkButton:{display:"inline-block",width:14,height:14,marginLeft:4,paddingTop:2},questionMarkIcon:{fill:e.icon.secondary}})),[]),b=(0,S().YB)();return(0,q.jsx)(vo().Z,{open:!0,render:()=>(0,q.jsx)(q.Fragment,{children:(0,q.jsx)(bo().ZP,{width:300,title:(0,q.jsx)(S()._H,{defaultMessage:"Are you sure you want to link this page to {currentBlockTitleText}",id:"twoWayLimitAddRelationConfirmationDialog.title",values:{currentBlockTitleText:d}}),subtitle:(0,q.jsxs)(q.Fragment,{children:[c&&u?(0,q.jsx)(S()._H,{defaultMessage:"This will unlink it from {blockWithExistingRelationTitleText}.",id:"twoWayLimitAddRelationConfirmationDialog.subtitle",values:{blockWithExistingRelationTitleText:u}}):(0,q.jsx)(S()._H,{defaultMessage:"This will unlink it from another page in this database.",id:"twoWayLimitAddRelationConfirmationDialog.subtitleWithNoAccessToOtherPage"}),(0,q.jsx)(St().Z,{renderTooltip:()=>(0,q.jsx)(S()._H,{defaultMessage:"Pages from this database can only be linked to one record.",id:"twoWayLimitAddRelationConfirmationDialog.tooltip.noAccess"}),render:e=>(0,q.jsx)(fo().Z,{...e,style:v.questionMarkButton,ariaLabel:b.formatMessage({defaultMessage:"Pages from this database can only be linked to one record.",id:"twoWayLimitAddRelationConfirmationDialog.subtitle.questionMark.ariaLabel"}),icon:So,iconStyle:v.questionMarkIcon})})]}),confirmText:(0,q.jsx)(S()._H,{defaultMessage:"Continue",id:"twoWayLimitAddRelationConfirmationDialog.primaryButton.text"}),onConfirm:f,onDismiss:o,radioOptions:[],icon:Co().v,footer:(0,q.jsxs)("div",{style:v.checkBoxContainer,children:[(0,q.jsx)(yo().Z,{checked:h,onClick:()=>m(!h),size:14,id:"twoWayLimitAddRelationConfirmationDialog.doNotShowAgain"}),(0,q.jsx)("label",{htmlFor:"twoWayLimitAddRelationConfirmationDialog.doNotShowAgain",children:(0,q.jsx)(S()._H,{defaultMessage:"Don't ask again",id:"twoWayLimitAddRelationConfirmationDialog.dontAskAgain.checkbox.label"})})]})})})})}function Po(){const{blockStore:e,schema:t,property:o,format:a}=(0,n.useContext)(D().m),s=(0,r().O7)(),u=(0,n.useMemo)((()=>new(Le().Z)),[]),g=(0,i().VK)((()=>function(e){const{environment:t,blockStore:o,schema:n,property:r}=e;if(!o)return;const i=n[r];if("relation"!==(null==i?void 0:i.type))return;const a=c().j0(i);if(!a)return;const s=me().NW.createChildStore(o,a);if(!s)return;const l=s.getParentId();if(!l)return;const u=me().G.createChildStore(s,{table:y().iU,id:l});if(!u)return;const g=u.isDefined()?ue().Or(t,u):void 0,h=(0,p().Z)({pageId:u.id,pageModel:u.getModel(),baseUrl:g,pageVisitSource:void 0});return{property:r,propertySchema:i,targetCollectionStore:s,targetParentUrl:h,connectedRelationFlags:{isSyncedCollectionRelation:s.isSyncedCollection(),isGithubPrRelation:d().Kp(i),isGoogleDriveRelation:d().gg(i),isFigmaRelation:d().ic(i),isZendeskRelation:d().U8(i),isSalesforceRelation:d().R3(i),isSlackRelation:d().RB(i),isConnectedRelation:c().NK(i)}}}({environment:s,blockStore:e,schema:t,property:o})),[s,e,t,o]),h=(0,ie().a)(t[o]),m=(0,i().VK)((()=>null==g?void 0:g.targetCollectionStore.getDatabaseType()),[null==g?void 0:g.targetCollectionStore]),f=(0,i().VK)((()=>h?"sharing":m===l().p$?"sprint":"default"),[m,h]);return g?(0,q.jsx)(Te,{relationPropertyMenuStore:u,property:g.property,propertySchema:g.propertySchema,targetCollectionStore:g.targetCollectionStore,targetParentUrl:g.targetParentUrl,connectedRelationFlags:g.connectedRelationFlags,children:(0,q.jsx)(Z().Z,{capture:!0,allowMenuList:!0,allowEsc:!0,allowUndo:!0,allowTabUntab:!0,render:()=>(0,q.jsx)(Ro,{type:f})})}):(0,q.jsx)(K().Z,{children:(0,Y().xE)(a)?(0,q.jsx)(A().Z,{title:(0,q.jsx)(S()._H,{defaultMessage:"You may not have access to the related database. Contact the form creator.",id:"database.relationPropertyMenu.formViewer.noAccess.message"})}):(0,q.jsx)(A().Z,{title:(0,q.jsx)(S()._H,{defaultMessage:"You may not have access to the related database.",id:"database.relationPropertyMenu.noAccess.message"})})})}function Ro(e){let{type:t}=e;const{blockStore:o,blockPropertyValueOverlayStore:a,overlayMode:s,isDisabled:l,schema:c,property:d,insertChar:u,format:p,onChange:g,analyticsFrom:h}=(0,n.useContext)(D().m),y=(0,n.useContext)(je),b=(0,r().O7)(),x=(0,r().Fy)(),P=(0,S().YB)(),R=(0,i().VK)((()=>null==y?void 0:y.relationPropertyMenuStore),[null==y?void 0:y.relationPropertyMenuStore]),_=wo(),{relationSearchLimit:M,relationSearchQuery:k}=(0,i().VK)((()=>({relationSearchQuery:null==R?void 0:R.state.searchQuery,relationSearchLimit:null==R?void 0:R.state.searchLimit})),[R]);(0,n.useEffect)((()=>{R&&0===_.length&&R.setState({searchPopupOpen:x.isMobile,searchQuery:u??"",searchLimit:Le().Z.limitIncrement,addingPage:!1})}),[]);const I=(0,i().VK)((()=>"on"===ge().default.getEligibleGroup({experimentId:"search_surfaces_relation_search",defaultGroup:"unassigned"})),[]),w=Boolean(I&&k&&k.length>0&&"sprint"!==t&&"sharing"!==t),j=(0,i().VK)((()=>(0,re().bC)(b).hasPublicAccessPermission),[b]),T=(0,i().VK)((()=>{const e=null==y?void 0:y.targetCollectionStore.getSpaceId();if(o&&e)return me().H2.createChildStore(o,{table:f().bx,id:e})}),[o,null==y?void 0:y.targetCollectionStore]),{results:L,isResultsLoading:F,fetchAdditionalServerResultsOnChange:Z,searchSessionId:B,searchSessionFlowNumber:H}=(0,ae().s)({disable:!w,searchQuery:k??"",limit:M??20,type:v().n8.BlocksInCollection,source:"relation_menu",overrideSpaceStore:j?T:void 0,filters:{parentId:null==y?void 0:y.targetCollectionStore.id,includePublicPagesWithoutExplicitAccess:p===V().C.FormViewer}}),A="sprint"===t?Ie:ke,{searchResults:E,searchSessionFlowNumber:U,isSearchLoading:O}=function(e){const{forceDisable:t,getSearchResults:o}=e,{blockPointers:a,isDisabled:s}=(0,n.useContext)(D().m),l=(0,r().O7)(),c=(0,n.useContext)(je),d=(0,n.useRef)(void 0),u=(0,z().DK)(),p=(0,n.useRef)(0),g=(0,se().E)("collections_cached_relation_search"),{searchQuery:h,searchLimit:y}=(0,i().VK)((()=>({searchQuery:(null==c?void 0:c.relationPropertyMenuStore.state.searchQuery)??"",searchLimit:(null==c?void 0:c.relationPropertyMenuStore.state.searchLimit)??0})),[null==c?void 0:c.relationPropertyMenuStore]),f=(0,i().VK)((()=>h===d.current),[d,h]),[{status:v,value:b}]=(0,m().r5)((async()=>{if(s||t)return[];if(null==c||!c.propertySchema||null==c||!c.targetCollectionStore)return[];if(null!=c&&c.connectedRelationFlags.isGoogleDriveRelation||null!=c&&c.connectedRelationFlags.isFigmaRelation)return[];if(g&&u){const e=u.relationResultsCacheStore.getState(),t=e.get(c.property)??{},n=t[h];if(!n||Date.now()-n.timestamp>Le().Z.resultsCacheTTL||n.results.length<y){const n=await o({environment:l,query:{query:h,limit:y},targetCollectionStore:null==c?void 0:c.targetCollectionStore,propertySchema:null==c?void 0:c.propertySchema,blockPointers:a}),r=n.slice(0,y);return e.set(c.property,{...t,[h]:{timestamp:Date.now(),results:r}}),u.relationResultsCacheStore.emit(),n}return n.results}const e=await o({environment:l,query:{query:h,limit:y},targetCollectionStore:null==c?void 0:c.targetCollectionStore,propertySchema:null==c?void 0:c.propertySchema,blockPointers:a});return f||(d.current=h,p.current+=1),e}),[s,t,null==c?void 0:c.propertySchema,null==c?void 0:c.targetCollectionStore,null==c?void 0:c.connectedRelationFlags.isGoogleDriveRelation,null==c?void 0:c.connectedRelationFlags.isFigmaRelation,null==c?void 0:c.property,g,u,o,l,h,y,a,f],{debounce:de().vp}),S=(0,i().VK)((()=>"pending"===v),[v]);return{searchResults:b,searchSessionFlowNumber:p.current,isSearchLoading:S}}({getSearchResults:A,forceDisable:w}),K=(0,n.useRef)(B),N=(0,n.useRef)(0);N.current=U+H,(0,n.useEffect)((()=>{K.current=B,N.current=H}),[b,B,H]),(0,n.useEffect)((()=>(Q().j({environment:b,event:{eventName:"collections_relation_property_menu_open",eventProperties:{search_session_id:K.current,using_secondary_search_surfaces_hook:I}}}),()=>{Q().j({environment:b,event:{eventName:"collections_relation_property_menu_close",eventProperties:{search_session_id:K.current,search_session_flow_number:N.current}}})})),[b,I]);const W=(0,i().VK)((()=>L.map((e=>({type:Me().Rt.SearchPage,store:e.store,key:e.id})))),[L]),G=(0,i().VK)((()=>(0,ne().Sr)(b)),[b]),$=I&&k&&k.length>0&&"default"===t?W:E,J=(0,n.useRef)(void 0);(0,n.useEffect)((()=>{if(Boolean(null==k?void 0:k.length))return;const e=O;!e||J.current?!e&&J.current&&$&&(ce().default.measure(J.current,{environment:b,data:{search_session_id:B}}),J.current=void 0):J.current=ce().default.mark("collection_relation_search_initial_results_loaded")}),[$,b,B,null==k?void 0:k.length,O]);const ee=!(((0,Y().xE)(p)&&G||(null==y?void 0:y.connectedRelationFlags.isFigmaRelation)||(null==y?void 0:y.connectedRelationFlags.isGoogleDriveRelation))??!1)&&"default"===t,[te,oe]=n.useState(null),ie=(0,z().DK)(),le=(0,n.useMemo)((()=>{if(!te)return null;const{blockWithExistingRelationTitle:e,currentBlockTitle:t,canAccessBlockWithExistingRelation:o}=te;return(0,q.jsx)(xo,{onConfirm:()=>{g(te.update),h&&C().eW(b,{from:h,...(0,X().Pn)(ie),target_collection_id:null==y?void 0:y.targetCollectionStore.id}),1===(null==y?void 0:y.propertySchema.limit)&&(null==a||a.setState({isOpen:!1}))},onClosed:()=>{oe(null)},currentBlockTitle:t,blockWithExistingRelationTitle:e,canAccessBlockWithExistingRelation:o})}),[h,a,te,ie,b,null==y?void 0:y.propertySchema.limit,null==y?void 0:y.targetCollectionStore.id,g]);if(!(y&&R&&c&&o&&a))return null;const ue={searchSessionId:B,shouldShowShimmers:I&&(F||O),onScrollSearchHookFn:Z,searchSessionFlowNumber:N.current};if(x.isMobile)return(0,Y().xE)(p)?(0,q.jsx)(Io,{searchResults:$,isDefaultSearchLoading:O,searchHookData:{...ue,shouldShowShimmers:!1},showChangeConfirmationDialog:oe}):(0,q.jsxs)(_o,{showChangeConfirmationDialog:oe,children:[(0,q.jsx)(Io,{searchResults:$,isDefaultSearchLoading:O,searchHookData:{...ue,shouldShowShimmers:!1},showChangeConfirmationDialog:oe}),le]});let pe;switch(t){case"sharing":pe=xe(P,{propertyName:y.propertySchema.name});break;case"sprint":pe=function(e){return e.formatMessage(Se.inputPlaceholder)}(P);break;default:pe=Ce({intl:P,connectedRelationFlags:y.connectedRelationFlags,overlayMode:s,disabled:l,format:p})}return(0,q.jsxs)(Mo,{header:(0,q.jsx)(Be,{inputPlaceholder:pe,showTargetDatabase:ee,addPage:()=>jo({environment:b,menuStore:R,blockPropertyValueOverlayStore:a,blockStore:o,schema:c,property:d,targetCollectionStore:y.targetCollectionStore})}),footer:(0,q.jsx)(ko,{searchResultsLength:(null==$?void 0:$.length)??0,showFooterInViewMode:"sprint"===t}),children:[(0,q.jsx)(Io,{searchResults:$,isDefaultSearchLoading:O,searchHookData:ue,showChangeConfirmationDialog:oe}),le]})}function _o(e){const{children:t,showChangeConfirmationDialog:o}=e,{collectionStore:s,property:l,schema:c,blockStore:d,blockPropertyValueOverlayStore:u,isDisabled:p,canConfigureCollection:h,blockPointers:m,analyticsFrom:y,overlayMode:f,onChange:v,onDismiss:b,format:x}=(0,n.useContext)(D().m),P=(0,n.useContext)(je),R=(0,r().O7)(),_=(0,z().DK)(),M=wo(),k=(0,a().yK)((e=>({input:{color:e.mediumTextColor},menuTitle:{display:"flex"},databaseIcon:{display:"flex",marginLeft:2*Me().Qi},databaseTitle:{marginLeft:Me().Qi},addPageButton:{display:"flex",alignItems:"center"},plusIcon:{marginRight:8,width:16,height:16}})),[]),w=(0,i().VK)((()=>null==P?void 0:P.targetCollectionStore.getIcon()),[null==P?void 0:P.targetCollectionStore]),j=(0,i().VK)((()=>{const e=Boolean(he().default.bots.state.find((e=>e.integration_id===g().U9))),t=Boolean(he().default.bots.state.find((e=>e.integration_id===g().f3))),o=Boolean(he().default.bots.state.find((e=>e.integration_id===g().mQ)));return(null==P?void 0:P.connectedRelationFlags.isGithubPrRelation)&&!e||(null==P?void 0:P.connectedRelationFlags.isGoogleDriveRelation)&&!t||(null==P?void 0:P.connectedRelationFlags.isFigmaRelation)&&!o}),[null==P?void 0:P.connectedRelationFlags.isGithubPrRelation,null==P?void 0:P.connectedRelationFlags.isGoogleDriveRelation,null==P?void 0:P.connectedRelationFlags.isFigmaRelation]),T=(0,i().VK)((()=>Boolean(null==P?void 0:P.relationPropertyMenuStore.state.addingPage)),[null==P?void 0:P.relationPropertyMenuStore]),L=(0,i().VK)((()=>Boolean(null==P?void 0:P.relationPropertyMenuStore.state.searchPopupOpen)),[null==P?void 0:P.relationPropertyMenuStore]),V=(0,ie().a)(c[l]);if(!(s&&d&&u&&P))return null;const{relationPropertyMenuStore:Z,propertySchema:B,targetCollectionStore:A,targetParentUrl:N,connectedRelationFlags:{isConnectedRelation:W}}=P,G=(0,q.jsx)("div",{style:k.menuTitle,children:(0,q.jsx)(S()._H,{id:"database.relationProperty.newRelation.targetDatabase",defaultMessage:"<regular>In</regular> {databaseWithIcon}",values:{regular:e=>e,databaseWithIcon:(0,q.jsxs)("div",{style:k.databaseIcon,children:[(0,q.jsx)(U().Z,{disabled:!0,icon:w,isEmptyPage:!1,size:Me().WO}),(0,q.jsx)(O().Z,{store:A,underline:!0,style:k.databaseTitle,maxLength:25})]})}})});return(0,q.jsxs)(H().Z,{menuType:te().o.Modal,title:B.name,right:(0,q.jsx)(S()._H,{defaultMessage:"Done",id:"relationPropertyMenu.mobileMenuDone.button"}),onClickRight:b,children:[!W&&(0,q.jsx)(K().Z,{disableMobilePadding:!0,children:(0,q.jsx)(F().Z,{focused:!1,title:G,showExtensionArrow:!1,onClick:()=>function(e){const{environment:t,targetParentUrl:o,analyticsFrom:n}=e;I().c4({environment:t,url:o}),n&&C().ZZ(t,{from:n})}({environment:R,targetParentUrl:N,analyticsFrom:y})})}),!j&&(0,q.jsx)(K().Z,{topBorder:!0,disableMobilePadding:!1,children:(0,q.jsx)(E().ZP,{popupType:E().kQ.SlideUp,open:L,origin:(0,q.jsx)(F().Z,{focused:!1,title:(0,q.jsxs)("span",{style:k.addPageButton,children:[(0,le().R)(k.plusIcon),V?(0,q.jsx)(S()._H,{defaultMessage:"Select {name}",id:"relationPropertyMenu.add.button",values:{name:B.name}}):(0,q.jsx)(S()._H,{defaultMessage:"Add a page",id:"relationPropertyMenu.addAPage.button"})]}),onClick:()=>{var e;(e=Z).setState({...e.state,searchPopupOpen:!0,searchLimit:Le().Z.limitIncrement})},style:k.input}),render:()=>t})}),(0,q.jsx)(Jt,{collectionStore:s,collectionId:s.id,targetCollectionStore:A,results:M,resultsType:"existing",property:l,schema:c,propertySchema:B,parentStore:d,disabled:p,canConfigureCollection:h,loading:!1,canDrag:!1,blockPropertyValueOverlayStore:u,onAccept:(e,t)=>function(e){const{environment:t,analyticsFrom:o,result:n,openInNew:r}=e;n.type===Me().Rt.SelectedPage&&Do({environment:t,analyticsFrom:o,result:n,openInNew:r})}({environment:R,analyticsFrom:y,result:e,openInNew:t}),onClickActionButton:e=>Lo({environment:R,collectionContextStore:_,blockPropertyValueOverlayStore:u,result:e,blockPointers:m,onChange:v,analyticsFrom:y,overlayMode:f,propertySchema:B,targetCollectionStore:A,showChangeConfirmationDialog:o}),onCreatePage:e=>To({environment:R,collectionContextStore:_,relationPropertyMenuStore:Z,blockPointers:m,onChange:v,index:e,propertySchema:B,targetCollectionStore:A}),handleClearProperty:()=>v({newValues:[],oldValues:m}),relationPropertyMenuStore:Z,addPage:e=>jo({environment:R,menuStore:Z,blockPropertyValueOverlayStore:u,blockStore:d,schema:c,property:l,targetCollectionStore:A,uri:e}),addingPage:T,format:x})]})}function Mo(e){const{children:t,header:o,footer:r}=e,s=(0,n.useContext)(je),l=(0,i().VK)((()=>{var e;const t=Boolean(he().default.bots.state.find((e=>e.integration_id===g().U9))),o=(null==s?void 0:s.connectedRelationFlags.isGoogleDriveRelation)||(null==s?void 0:s.connectedRelationFlags.isFigmaRelation)||(null==s?void 0:s.connectedRelationFlags.isZendeskRelation)||(null==s?void 0:s.connectedRelationFlags.isSalesforceRelation)||(null==s?void 0:s.connectedRelationFlags.isSlackRelation),n=null===(e=pe().default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit();return(null==s?void 0:s.connectedRelationFlags.isGithubPrRelation)&&!t||o&&!n}),[null==s?void 0:s.connectedRelationFlags.isGithubPrRelation,null==s?void 0:s.connectedRelationFlags.isGoogleDriveRelation,null==s?void 0:s.connectedRelationFlags.isFigmaRelation,null==s?void 0:s.connectedRelationFlags.isZendeskRelation,null==s?void 0:s.connectedRelationFlags.isSalesforceRelation,null==s?void 0:s.connectedRelationFlags.isSlackRelation]),c=(0,a().yK)((e=>({menuContent:{overflow:"hidden",maxHeight:"70vh"}})),[]);return(0,q.jsx)(H().Z,{menuType:te().o.Popup,header:!l&&o,footer:r,children:(0,q.jsx)("div",{style:c.menuContent,children:t})})}function ko(e){const{searchResultsLength:t,showFooterInViewMode:o}=e,a=(0,n.useContext)(je),{blockPointers:s,onChange:l,overlayMode:c,isDisabled:d,insertChar:u}=(0,n.useContext)(D().m),p=(0,r().O7)(),g=(0,z().DK)(),h=(0,i().VK)((()=>(null==a?void 0:a.relationPropertyMenuStore.state.searchQuery)??u??""),[null==a?void 0:a.relationPropertyMenuStore,u]);if(!o&&"view"===(null==c?void 0:c.type))return null;if(!a)return null;const{relationPropertyMenuStore:m,propertySchema:y,targetCollectionStore:f}=a;return y.connectedRelation||d||!f?null:0!==t&&h?(0,q.jsx)(G,{targetCollectionStore:f,title:h,onClick:e=>To({environment:p,collectionContextStore:g,relationPropertyMenuStore:m,blockPointers:s,onChange:l,index:e,propertySchema:y,targetCollectionStore:f}),focused:!1,isSection:!0,index:"add"===(null==c?void 0:c.type)?null==c?void 0:c.index:void 0}):null}function Io(e){const{searchResults:t,isDefaultSearchLoading:o,searchHookData:{shouldShowShimmers:s,onScrollSearchHookFn:l,searchSessionId:c,searchSessionFlowNumber:d},showChangeConfirmationDialog:p}=e,{blockPointers:g,collectionStore:m,collectionId:f,property:v,schema:b,blockStore:x,blockPropertyValueOverlayStore:P,isDisabled:R,canConfigureCollection:_,analyticsFrom:M,overlayMode:I,onChange:w,insertChar:j,format:T,onDismiss:L}=(0,n.useContext)(D().m),V=(0,n.useContext)(je),F=(0,r().O7)(),Z=(0,r().Fy)(),A=(0,S().YB)(),E=(0,z().DK)(),U=(0,ie().a)(b[v]),{searchQuery:O,addingPage:K}=(0,i().VK)((()=>(null==V?void 0:V.relationPropertyMenuStore.state)??{searchQuery:j??"",addingPage:!1}),[null==V?void 0:V.relationPropertyMenuStore,j]),W=(0,a().yK)((e=>({inputMenu:{...Z.isAndroid&&{borderBottom:"none"}}})),[Z.isAndroid]),$=wo(),X=(0,i().VK)((()=>x?O?$.filter((e=>{const t=e.store,o=t.getModel();if(o)return(0,u().fY)({block:o,query:O,getRecordModel:t.getRecordModel,userTimeZone:(0,h().r)(),schema:b,intl:ee().Z.getIntl(),onlyPropertyIds:["title"]})})):$:[]),[x,b,O,$]),J=(0,i().VK)((()=>!t&&0===X.length||s),[X.length,s,t]),oe=(0,i().VK)((()=>x?x.getSpaceId():void 0),[x]),re=n.useRef(void 0);if(n.useEffect((()=>{J&&""!==O&&(re.current=ce().default.mark("rum.relation_search_query"))}),[J,O]),n.useEffect((()=>{!J&&""!==O&&re.current&&(ce().default.measure(re.current,{environment:F,data:{search_session_id:c}}),re.current=void 0)}),[J,F,c,O]),!(x&&oe&&P&&V))return null;const{relationPropertyMenuStore:ae,propertySchema:se,targetCollectionStore:le,connectedRelationFlags:de}=V,ue=[...X];t&&t.forEach((e=>{if((e.type===Me().Rt.SelectedPage||e.type===Me().Rt.SearchPage)&&X.find((t=>(t.type===Me().Rt.SelectedPage||t.type===Me().Rt.SearchPage)&&t.store.id===e.store.id)))return;const t=se.limit?g.slice(0,1):g,o=e.type!==Me().Rt.NewPage?t.map((e=>e.id)).includes(e.store.id):void 0;o&&!O&&"add"===(null==I?void 0:I.type)||(e.type===Me().Rt.SearchPage&&o?ue.push({...e,type:Me().Rt.SelectedPage}):e.type!==Me().Rt.SelectedPage||o?ue.push(e):ue.push({...e,type:Me().Rt.SearchPage}))}));const he=ue.filter((e=>e.type===Me().Rt.SearchPage)),me=e=>{if(e.type===Me().Rt.SearchPage){const t=he.indexOf(e);if(-1===t)return;const o=1/(t+1),n={index:t,search_session_id:c,query_length:O.length,reciprocal_rank:o,search_session_flow_number:d};Q().j({environment:F,event:{eventName:"collections_relation_search_item_click",eventProperties:n}}),ge().default.logEvent("collections_relation_search_mrr",o,n)}},ye=(0,q.jsx)(Jt,{collectionStore:m,collectionId:f,targetCollectionStore:le,results:ue,resultsType:0===ue.length&&0===$.length?"existing":"search",property:v,schema:b,propertySchema:se,parentStore:x,disabled:R,canConfigureCollection:_,loading:J,canDrag:!R&&0===O.length&&!(0,Y().xE)(T),disableClickToNavigateToPage:(0,Y().xE)(T),blockPropertyValueOverlayStore:P,onAccept:(e,t)=>{!function(e){const{environment:t,collectionId:o,collectionContextStore:n,blockPointers:r,result:i,analyticsFrom:a,isDisabled:s,onChange:l,overlayMode:c,openInNew:d,propertySchema:u,targetCollectionStore:p,blockPropertyValueOverlayStore:g,showChangeConfirmationDialog:h}=e;if(s)return;if(!p||!u)return;const{mainEditorCurrentBlockStore:m}=pe().default.state;if(!m)return;if(i.type===Me().Rt.SearchPage){const e=i.store,s={newValues:u.limit?[i.store.pointer]:"add"===(null==c?void 0:c.type)?[...r.slice(0,c.index),e.pointer,...r.slice(c.index)]:[...r,e.pointer],oldValues:r};k().Q({environment:t,store:g,update:s,collectionStore:null==n?void 0:n.collectionStore(),propertySchema:u}).then((e=>{var r,i;e?h(e):(l(s),a&&C().eW(t,{from:a,collection_id:o,collection_view_id:null==n||null===(r=n.collectionViewStore())||void 0===r?void 0:r.id,collection_view_block_id:null==n||null===(i=n.collectionViewBlockStore())||void 0===i?void 0:i.id,target_collection_id:null==p?void 0:p.id}))})).catch((e=>{console.error(e)}))}else i.type===Me().Rt.SelectedPage&&Do({environment:t,analyticsFrom:a,result:i,openInNew:d})}({environment:F,collectionId:f,collectionContextStore:E,blockPointers:g,result:e,analyticsFrom:M,isDisabled:R,onChange:w,overlayMode:I,openInNew:t,propertySchema:se,targetCollectionStore:le,showChangeConfirmationDialog:p,blockPropertyValueOverlayStore:P}),me(e)},onClickActionButton:e=>{Lo({environment:F,collectionContextStore:E,blockPropertyValueOverlayStore:P,result:e,blockPointers:g,onChange:w,analyticsFrom:M,overlayMode:I,propertySchema:se,targetCollectionStore:le,showChangeConfirmationDialog:p}),me(e)},onScrollOffsetChange:e=>function(e){const{offsetFromBottom:t,store:o,isLoading:n,searchResults:r,onScrollSearchHookFn:i}=e,a=o.state.searchLimit+Le().Z.limitIncrement;if(t<Le().Z.incrementScrollOffset&&!n&&((null==r?void 0:r.length)??0)>=o.state.searchLimit){if(i)return void i(Le().Z.limitIncrement);o.setState({...o.state,searchLimit:a})}}({offsetFromBottom:e,store:ae,isLoading:o,searchResults:t,onScrollSearchHookFn:l}),onDrag:e=>function(e){const{newPageIds:t,blockPointers:o,spaceId:n,onChange:r,analyticsFrom:i,environment:a}=e;r({newValues:t.map((e=>({id:e,spaceId:n,table:y().iU}))),oldValues:o}),i&&C().yT(a,{from:i})}({environment:F,newPageIds:e,blockPointers:g,spaceId:oe,onChange:w,analyticsFrom:M}),onCreatePage:e=>To({environment:F,collectionContextStore:E,relationPropertyMenuStore:ae,blockPointers:g,onChange:w,index:e,propertySchema:se,targetCollectionStore:le}),handleClearProperty:()=>w({newValues:[],oldValues:g}),searchQuery:O,overlayMode:I,relationPropertyMenuStore:ae,addPage:e=>jo({environment:F,menuStore:ae,blockPropertyValueOverlayStore:P,blockStore:x,schema:b,property:v,uri:e,targetCollectionStore:le}),addingPage:K,format:T});if(!Z.isMobile)return ye;let fe;return fe=U?xe(A,{propertyName:se.name}):Ce({connectedRelationFlags:de,overlayMode:I,disabled:R,format:T,intl:A}),(0,q.jsx)(H().Z,{menuType:te().o.Modal,title:(0,q.jsx)(S()._H,{defaultMessage:"Relation",id:"relationPropertyMenu.mobileRelationMenu.title"}),left:(0,q.jsx)(N().Z,{href:(0,ne().UY)("guides.relations"),analyticsFrom:"relation_menu"}),right:(0,q.jsx)(S()._H,{defaultMessage:"Done",id:"relationPropertyMenu.mobileDoneButton"}),header:(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(B().ZP,{value:O,disabled:R,onChange:e=>{const t=e.target.value;ae.setState({...ae.state,searchQuery:t,searchLimit:Le().Z.limitIncrement})},placeholder:fe,showClearButton:!0,focusInitial:!0,style:W.inputMenu}),O&&!R&&!de.isConnectedRelation&&(0,q.jsx)(G,{targetCollectionStore:le,title:O,onClick:e=>To({environment:F,collectionContextStore:E,relationPropertyMenuStore:ae,blockPointers:g,onChange:w,index:e,propertySchema:se,targetCollectionStore:le}),focused:!1,isSection:!0})]}),onClickRight:()=>(0,Y().xE)(T)?L():ae.reset(),children:ye})}function wo(){const e=(0,n.useContext)(je),{blockStore:t,blockPointers:o,overlayMode:r}=(0,n.useContext)(D().m),a=(0,i().VK)((()=>(null==e?void 0:e.relationPropertyMenuStore.state.searchQuery)??""),[null==e?void 0:e.relationPropertyMenuStore]);return(0,i().VK)((()=>t&&null!=e&&e.propertySchema&&null!=e&&e.targetCollectionStore&&(a||"add"!==(null==r?void 0:r.type))?d().j$({relationValue:o,propertySchema:null==e?void 0:e.propertySchema,getRecordModel:t.getRecordModel,includeDeleted:ge().default.checkGate({gateName:"relations_show_deleted"}),includeInvalidCollection:ge().default.checkGate({gateName:"relations_show_invalid_collection"}),includeNoAccess:ge().default.checkGate({gateName:"relations_show_no_access"})}).map((e=>{const o=me().G.createChildStore(t,e);return{key:e.id,type:Me().Rt.SelectedPage,store:o}})):[]),[t,o,r,a,null==e?void 0:e.propertySchema,null==e?void 0:e.targetCollectionStore])}async function jo(e){const{environment:t,menuStore:o,blockPropertyValueOverlayStore:n,blockStore:r,schema:i,property:a,uri:s,targetCollectionStore:l}=e;if(!l)return;const c=await _().F.clipboardActions.load(),u=l.getFormat().integration_id,p=he().default.externalAuthentications.state.filter((e=>e.integration_id===u))[0],h=l.getFormat().pattern_name,m=he().default.integrations.state.find((e=>e.id===u)),f=r instanceof me().G?r:void 0,v=r instanceof me().G?r.getPropertyStore(a):void 0;o.setState({...o.state,addingPage:!0});try{var C,k;if(!m||!f||!v)return;const e=d().rq(v.getValue()),r=s||o.state.searchQuery||"";if(!(0,oe().DB)({integration:m,patternName:h,url:r}))return void M().vC({items:[{label:(0,q.jsx)(S()._H,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.copyDebuggingInformation",defaultMessage:"Copy debugging information"}),color:"blue",onAccept:()=>{c.copyString({environment:t,stringValue:JSON.stringify({botId:null==p?void 0:p.parent_id,url:r},null,2),copiedMessage:c.clipboardMessages.copiedToClipboard})}},{label:(0,q.jsx)(S()._H,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.closeButton",defaultMessage:"Close"}),onAccept:()=>{}}],showCancel:!1,keepFocus:!1,message:(0,q.jsx)(S()._H,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.title",defaultMessage:"This source is currently not supported. Please try a different source."})});const u=i[a],_=d().Kp(u),I=_?v.id:void 0,L=d().gg(u),D=d().ic(u),V=d().U8(u),F=d().A0(u),Z=d().R3(u),B=d().RB(u),H=F&&ge().default.checkGate({gateName:"cron_connected_relation"}),A=V&&ge().default.checkGate({gateName:"zendesk_ai_enabled"}),E=Z&&ge().default.checkGate({gateName:"salesforce_connected_relation"}),U=B&&ge().default.checkGate({gateName:"slack_connected_relation"}),O=(0,$().NP)(m.id),K=(null==m?void 0:m.id)===g().U9?null===(C=O[0])||void 0===C?void 0:C.id:null==p?void 0:p.parent_id,N=_||L||V||H||D||E||U?O.map((e=>e.id)):[K],W=await T().yp({environment:t,url:r,botIds:N,userDefinedExternalCollectionStore:l,relatedPageId:I});if(!W)return;const G=(null===(k=ye().subscriptionDataStoreInstance.state)||void 0===k?void 0:k.addOns)??[];A&&(0,b().de)(G)&&(R().callApi({eventName:"getZendeskTicketConversation",environment:t,data:{ticketUrl:r,spaceId:W.getSpaceId(),botId:N[0],pageId:v.id}}),Q().K4(t,"zendesk_unfurl_ai")),j().createAndCommit({userAction:"connectedRelationPropertyMenuResults.createRelationPage",environment:t,canUndo:!0,perform:o=>{const r={id:W.id,table:y().iU,spaceId:W.getSpaceId()},i=null!=u&&u.limit?[r]:[...e,r],s=d().ow(i);w().sO({environment:t,store:v,value:s,transaction:o}),n&&n.state.isOpen&&n.state.collectionContextStore&&(x().rv({environment:t,collectionContextStore:n.state.collectionContextStore,block_id:f.id,property:a,property_type:"relation",from:"relation_section",isFromBulkActionsToolbar:!1,integration_id:m.id,action:"add"}),P().W(t,{...(0,X().Pn)(n.state.collectionContextStore),from:"relation_menu",type:"page",integration_id:m.id,creating_block_id:f.id}))}}),o.reset()}finally{o.setState({...o.state,addingPage:!1})}}function To(e){const{environment:t,collectionContextStore:o,relationPropertyMenuStore:n,blockPointers:r,onChange:i,index:a,propertySchema:s,targetCollectionStore:l}=e,c=null==l?void 0:l.getSpaceId(),d=null==s?void 0:s.limit,u=(0,J().Ii)({environment:t,table:y().iU,spaceId:c}),p=u.id,g=d?[u]:a?[...r.slice(0,a),u,...r.slice(a)]:[...r,u];i({newPage:{id:p,spaceId:c,name:n.state.searchQuery},newValues:g,oldValues:r}),P().W(t,{...(0,X().Pn)(o),from:"relation_menu",type:"page",target_collection_id:null==l?void 0:l.id,new_page_id:p,creating_block_id:p})}function Lo(e){const{environment:t,collectionContextStore:o,blockPropertyValueOverlayStore:n,result:r,blockPointers:i,onChange:a,analyticsFrom:s,overlayMode:l,propertySchema:c,targetCollectionStore:d,showChangeConfirmationDialog:u}=e,{mainEditorCurrentBlockStore:p}=pe().default.state;if(!p||!n.state.isOpen)return;const g=e=>{a(e),s&&C().eW(t,{from:s,...(0,X().Pn)(o),target_collection_id:null==d?void 0:d.id}),y&&(null==n||n.setState({isOpen:!1}))},h=null==c?void 0:c.limit,m=(0,Y().xE)(n.state.format),y=m?(0,L().vp)(c,n.state.formQuestionStore):h;if(r.type===Me().Rt.SearchPage){let e;if(1===y)e={newValues:[r.store.pointer],oldValues:i};else if(void 0===y||y&&i.length+1<=y){const t="add"===(null==l?void 0:l.type)?[...i.slice(0,l.index),r.store.pointer,...i.slice(l.index)]:[...i,r.store.pointer];e={newValues:t,oldValues:i}}e&&(m?g(e):k().Q({environment:t,store:n,update:e,collectionStore:null==o?void 0:o.collectionStore(),propertySchema:c}).then((t=>{t?u(t):g(e)})).catch((e=>{console.error(e)})))}else if(r.type===Me().Rt.SelectedPage){const e=i.filter((e=>e.id!==r.store.id));g({newValues:e,oldValues:i})}}function Do(e){const{environment:t,result:o,openInNew:n,analyticsFrom:r}=e,{mainEditorCurrentBlockStore:i}=pe().default.state;if(!i)return;let a;const l=o.store;if(n){const e=l.isDefined()?ue().Or(t,l):void 0;a=(0,p().Z)({pageId:l.id,pageModel:l.getModel(),baseUrl:e,pageVisitSource:s().tY.LinkInPage})}else{const e=i.isDefined()?ue().Or(t,i):void 0;a=(0,p().Z)({pageId:i.id,pageModel:i.getModel(),baseUrl:e,peekViewBlockId:l.id,pageVisitSource:s().tY.LinkInPage})}I().c4({environment:t,url:a,openInNew:n}),r&&C().XX(t,{from:r,meta_click:Boolean(n)})}},454860:(e,t,o)=>{o.d(t,{Z:()=>r});class n extends(()=>o(263184))().default{getInitialState(){return{searchQuery:"",searchLimit:n.limitIncrement,searchPopupOpen:!1,addingPage:!1}}}n.limitIncrement=20,n.resultsCacheTTL=2*o(326966).hM,n.incrementScrollOffset=200;const r=n},845465:(e,t,o)=>{o.d(t,{J4:()=>i,S2:()=>h,SD:()=>d,ZY:()=>f,bY:()=>v,fV:()=>y,gf:()=>s,gr:()=>a,lw:()=>b,o8:()=>g,q5:()=>c,u0:()=>m,w5:()=>u});var n=()=>o(890085),r=()=>o(641506);const i=16,a=20,s=8,l=10,c=12,d=456,u=24,p=24,g=48;function h(e){let{theme:t,inheritanceBannerEnabled:o,isMobile:n}=e;return{background:t.tint.regular,borderRadius:8,paddingTop:8,paddingBottom:8,paddingLeft:8,paddingRight:8,marginLeft:n?0:i,marginRight:n?0:i,marginTop:4,marginBottom:8}}function m(e){let{isRedesignEnabled:t,isMobile:o}=e;return t?{...f({isMobile:o}),width:"unset",height:g,paddingTop:6,paddingBottom:6}:{}}function y(e){let{environment:t,isRedesignEnabled:o}=e;return o?(0,r().yv)(t,t.device.isMobile?"UISmall":"UIRegular"):(0,r().yv)(t,"UISmall")}function f(e){let{isMobile:t}=e;return{marginLeft:t?0:s,marginRight:t?0:s,borderRadius:l,transition:"background 150ms ease-out"}}function v(e){let{isMobile:t}=e;return t?12:10}function b(e){let{theme:t,colorOverride:o,size:r=p,useLargeBorderRadius:i,useLightBackgroundColor:a,icon:s}=e;return{background:o||(s&&(0,n().V2)(s)?(0,n().Pk)({icon:s,mode:t.mode,useLightGrayColor:a}):a?t.lightDividerColor:t.regularDividerColor),width:r,height:r,borderRadius:i?6:"0.25em"}}},815277:(e,t,o)=>{o.d(t,{CH:()=>g,DE:()=>l().DE,KQ:()=>l().KQ,Rv:()=>l().Rv,V5:()=>p().V5,VX:()=>h,eB:()=>l().eB,oo:()=>l().oo});var n=()=>o(255933),r=()=>o(779709),i=()=>o(205228),a=()=>o(845682),s=()=>o(30795),l=()=>o(546464),c=()=>o(404791),d=()=>o(897257),u=()=>o(18281),p=()=>o(259408);const g={guests:e=>{if(!d().subscriptionDataStoreInstance.state)return"loading";return{current:(0,u().s1)(e.environment,e.spaceId,d().subscriptionDataStoreInstance.state)}},team_self_promotion:e=>{},internal_guests:e=>{if(!d().subscriptionDataStoreInstance.state)return"loading";return{current:(0,u().s1)(e.environment,e.spaceId,d().subscriptionDataStoreInstance.state),hasLowGuestLimit:(0,o(548812).fc)()}},members:e=>{const t=d().subscriptionDataStoreInstance.state;return{current:t?(0,s().W)(e.environment,e.spaceId,t):0}},non_admin_members:e=>{},view_chart:e=>{},form_filesize:e=>{},form_customization:e=>{},premium_automations:e=>{},move_to:e=>{},claimable_spaces:e=>{},domain_settings:e=>{},managed_users:e=>{},invite_user_to_workspace_mentions:e=>{},saml:e=>{},scim:e=>{},export_members:e=>{},hipaa_compliance:e=>{},sites_multiple_public_domains:e=>{},custom_image_upload_favicon:e=>{},custom_public_sites_layout:e=>{},seo_title_and_description:e=>{},admin_transfer_private_content:e=>{},ai_slack_qna:e=>{},configurable_mention_invites:e=>{},configurable_retention:e=>{},unbranded_forms:e=>{},ai_google_drive_qna:e=>{},watermarkless_chart_export:e=>{},configurable_deletion_and_retention_settings:e=>{},sudo_mode:e=>{},ai_github_connector:e=>{},ai_jira_connector:e=>{},slack_imports_invite:e=>{},content_reprovisioning:e=>{},ai_space_usage:e=>{var t;let{environment:o,spaceId:l}=e;const u=new(a().H)(o,{table:n().bx,id:l}).getModel(),p=(0,r().oc)(i().default.promotions.ai,u),g=(null===(t=c().Z.state)||void 0===t?void 0:t.spaceUsage)??0,h=d().subscriptionDataStoreInstance.state;return{current:g,memberCount:h?(0,s().W)(o,l,h):0,aiPromotionConfig:p,space:u}},ai_user_usage:e=>{var t;let{environment:o,spaceId:l}=e;const u=new(a().H)(o,{table:n().bx,id:l}).getModel(),p=(0,r().oc)(i().default.promotions.ai,u),g=(null===(t=c().Z.state)||void 0===t?void 0:t.userUsage)??0,h=d().subscriptionDataStoreInstance.state;return{current:g,memberCount:h?(0,s().W)(o,l,h):0,aiPromotionConfig:p,space:u}},block_read_and_write_role:e=>{}};function h(e){return(0,l().Rv)(e)??!1}},877727:(e,t,o)=>{o.d(t,{C3:()=>s,D:()=>l,QZ:()=>a,fo:()=>i});var n=()=>o(146947),r=()=>o(749826);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r().default.checkGate({gateName:"packaging_m2_additional_entrypoints"})&&a(e,t)}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!e.device.isPhone&&s(t)}function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r().default.checkGate({gateName:"workflow_templates_prototype",...e})||"control"!==l(e)}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n().locale.startsWith("en-")||r().default.checkGate({gateName:"packaging_m2_localize_templates"})?r().default.getEligibleGroup({experimentId:"packaging_m2_entry_point",defaultGroup:"control",...e}):"control"}},999582:(e,t,o)=>{o.d(t,{Z:()=>i});class n extends(()=>o(263184))().default{getInitialState(){return{}}}const r=new n;o(947115).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",r);const i=r},184441:(e,t,o)=>{o.d(t,{default:()=>i});class n extends(()=>o(263184))().default{getInitialState(){return{open:!1,isShowingLoadingState:!1}}updateUserCustomizations(e,t){this.state.open&&this.state.collectionTemplate&&this.setState({...this.state,userCustomizations:{...this.state.userCustomizations,[e]:t}})}updateCollectionTemplate(e){this.state.open&&this.state.collectionTemplate&&this.setState({...this.state,collectionTemplate:e})}updatePreviewCollectionViewTemplateId(e){this.state.open&&this.state.collectionTemplate&&this.setState({...this.state,previewCollectionViewTemplateId:e})}getParentStore(){return this.state.open?this.state.parentStore:void 0}getShouldShowExpandedTemplateList(){return this.state.open&&this.state.shouldShowExpandedTemplateList}setShouldShowExpandedTemplateList(e){this.state.open&&this.setState({...this.state,shouldShowExpandedTemplateList:e})}close(e){var t,o;this.state.open&&(null===(t=(o=this.state).onClose)||void 0===t||t.call(o,e),this.setState({open:!1,isShowingLoadingState:!1}))}reset(){this.setState(this.getInitialState())}}const r=new n;(0,o(947115).exposeDebugValue)("InitializeWorkflowTemplateModalStore",r);const i=r},29488:(e,t,o)=>{function n(e){return`${e.table}:${e.id}`}o.d(t,{O:()=>n})},912203:(e,t,o)=>{o.d(t,{$M:()=>y,GQ:()=>x,Jy:()=>_,LF:()=>R,NO:()=>g,Of:()=>M,SF:()=>u,TX:()=>C,XO:()=>f,Y_:()=>d,Ym:()=>m,bD:()=>b,cO:()=>p,fo:()=>P,rR:()=>h});o(267602),o(653476),o(228244);var n=()=>o(513670),r=()=>o(696459),i=()=>o(226413),a=()=>o(109477),s=()=>o(455222),l=()=>o(305580);(0,r().AO)((e=>(0,r().$K)(e)&&(0,r().$K)(e.target)&&(0,r().$K)(e.external_bot_id)?{true:{external_bot_id:e.external_bot_id,target:e.target}}:{false:e}));const c={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1},d={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function u(e){return Boolean(c[e.type]&&!(0,i().NK)(e)&&(!(0,i().qQ)(e)||void 0===(0,i().q3)(e)))}function p(e){const{collectionFormat:t,collectionSchema:o,filter:s,sort:c,sourcePropertyIds:d}=e,p=(d??(0,r().Yd)(o)).filter(((t,n,r)=>{const a=o[t];return!(!a||!u(a))&&(("relation"!==a.type||!e.restrictCrossSpace||!(0,i().Qh)(e.spaceId,a))&&(!s||s([t,a],n,o)))}));if(0===p.length)return[];if(!t||!1===c)return p;const g=(0,l().i)(t,o,void 0,a().j5.Page).collection_page_properties||[];return n().MR(p,(e=>g.findIndex((t=>t.property===e))))}function g(e){const{collectionFormat:t,collectionSchema:o,sort:s}=e,c=(0,r().Yd)(o).filter(((e,t,n)=>{const r=o[e];return!(!r||!(0,i().U8)(r))}));if(0===c.length)return[];if(!t||!1===s)return c;const d=(0,l().i)(t,o,void 0,a().j5.Page).collection_page_properties||[];return n().MR(c,(e=>d.findIndex((t=>t.property===e))))}function h(e){return e.type===s().$E.InvalidCharacter?{type:e.type,character:e.character}:e.type===s().$E.TokenExpected?{type:e.type,token:e.token}:e.type===s().FY.MissingSchemaPropertyOnThisRow||e.type===s().FY.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===s().FY.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection}:e.type===s().FY.MissingContextVariable?{type:e.type,valueId:e.valueId}:e.type===s().FY.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments}:e.type===s().FY.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex}:e.type===s().FY.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex}:e.type===s().FY.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer}:e.type===s().FY.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer}:e.type===s().FY.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection}:e.type===s().FY.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===s().FY.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType}:e.type===s().FY.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes}:e.type===s().FY.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name}:{type:e.type}}const m={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1};function y(e){return Boolean(m[e.type])}function f(e){const{collectionFormat:t,collectionSchema:o,filter:s,sort:c}=e,d=(0,r().Yd)(o).filter(((e,t,n)=>{var r;const a=o[e];return!(!a||!m[a.type])&&((!(0,i().qQ)(a)||null===(r=(0,i().q3)(a))||void 0===r||!r.auto_update_on_edit)&&(!s||s([e,a],t,o)))}));if(0===d.length)return[];if(!t||!1===c)return d;const u=(0,l().i)(t,o,void 0,a().j5.Page).collection_page_properties||[];return n().MR(d,(e=>u.findIndex((t=>t.property===e))))}const v={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1};function b(e){return v[e.type]}const S={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1};function C(e){return S[e.type]}function x(e){return 0===e}function P(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function R(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function _(e){const{collectionSchema:t,property:o,type:n}=e,r=null==t?void 0:t[o];return!r||("action"===n?!u(r):!m[r.type])}function M(e){let{automationTrigger:t,collectionSchema:o}=e;if("event"===(null==t?void 0:t.type)||"notification_event"===(null==t?void 0:t.type)){const{pagesAdded:e,pagePropertiesEdited:n,source:i}=t.event;if(void 0===i)return!1;const a="some"===n.type&&n.some,s="all"===n.type&&n.all;if((a||s||[]).some((e=>R({collectionSchema:o,property:e.property})||_({collectionSchema:o,property:e.property,type:"trigger"}))))return!1;const l="some"===n.type&&(!(0,r().$K)(n.some)||0===n.some.length),c="all"===n.type&&(!(0,r().$K)(n.all)||0===n.all.length);if(!e&&("none"===n.type||l||c))return!1}else{if("recurrence"!==(null==t?void 0:t.type))return!1;if(!t.recurrence)return!1}return!0}},157955:(e,t,o)=>{o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>w,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>x,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>C,MAX_RECURRENCE_INTERVAL:()=>y,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>f,RRULE_WEEKDAYS_MAP:()=>m,convertFromUnpersistedRecurrenceConfig:()=>L,convertToUnpersistedRecurrenceConfig:()=>j,getFormattedEndCondition:()=>I,getFormattedNextRecurrenceTime:()=>k,getNextDateUtc:()=>M,getRecurrenceAfter:()=>R,isRunningBetweenMidnightAnd3AM:()=>_,isValidRecurrenceInterval:()=>v,isValidRecurrenceNumberOfRuns:()=>b,rruleFromRecurrence:()=>S,templateAncestorsViolateRecurrenceNesting:()=>P});o(267602),o(653476),o(241792);var n=()=>o(730120);o(670560);function r(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];if(0===o.length)return e.map((e=>[e]));const i=[];for(const a of e)i.push(...r(o[0],...o.slice(1)).map((e=>[a,...e])));return i}var i=()=>o(696459),a=()=>o(326966),s=()=>o(803021),l=()=>o(646574),c=()=>o(998411),d=()=>o(578292);class u extends(()=>o(484885))().Ci{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var p=()=>o(494616);const g=(0,o(788860).vU)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12–3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),h={day:u.DAILY,week:u.WEEKLY,month:u.MONTHLY,year:u.YEARLY},m={MO:u.MO,TU:u.TU,WE:u.WE,TH:u.TH,FR:u.FR,SA:u.SA,SU:u.SU},y=99,f=999;function v(e){return(0,a().hj)(e)&&Number.isInteger(e)&&e>0&&e<=y}function b(e){return(0,a().hj)(e)&&Number.isInteger(e)&&e>0&&e<=f}function S(e){const{start_date:t,frequency:o,interval:n,weekdays:a,timezone:l,hour:c,minute:d}=e,p="week"===o&&a?a.map((e=>m[e])):void 0,g={};return(0,i().$K)(e.end_condition)&&("date"===e.end_condition.type?g.until=(0,s().pd)(e.end_condition.end_at):"number"===e.end_condition.type?g.count=e.end_condition.number_of_occurrences:(0,i().t1)(e.end_condition)),"month"===e.frequency&&(0,i().$K)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?g.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?g.byweekday=r(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,o]=e;return m[t].nth(o)})):(0,i().t1)(e.monthly_restriction)),new u({freq:h[o],dtstart:(0,s().pd)(t),interval:n,byweekday:p,tzid:l,byhour:c??0,byminute:d??0,bysecond:0,...g})}const C=1,x=1;function P(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const o=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),n=e.length,r=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=n>C,a=o.length>=x;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:n,immediateAncestorRecurrenceType:r}}function R(e){const{recurrence:t,afterDate:o}=e;if((0,p().nA)(t)){const e=(0,s().kq)(o);return t.start_date>=e?new Date(t.start_date):void 0}{const e=S(t).after((0,s().pd)(o));if(!e)return;return(0,s().YL)(e)}}function _(e){return 0===e.hour||1===e.hour||2===e.hour}function M(e){return S(e).after((0,s().pd)((0,s().Jh)()))||void 0}function k(e){const{recurrence:t,intl:o}=e,r=M(L(t));if(!r)return;const i=_(t),a=n().ou.fromJSDate(r).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,d().E2)(o)).setZone(t.timezone),s=(0,l().p6)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:o,shortenDate:!0});if(i)return o.formatMessage(g.dateBetweenMidnightAnd3AM,{date:s});{let e=a.toLocaleString(n().ou.TIME_SIMPLE);return t.timezone!==(0,c().r)()&&(e+=` ${a.toFormat("ZZZZ")}`),o.formatMessage(g.dateAtTime,{date:s,time:e})}}function I(e,t){return(0,i().$K)(e)?"number"===e.type?t.formatMessage(g.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,l().p6)({date:n().ou.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,i().t1)(e):t.formatMessage(g.noEndCondition)}const w=100;function j(e){return{...e,start_date:(0,s().kq)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,s().kq)(e.end_condition.end_at)}:(0,i().t1)(e.end_condition):void 0}}function T(e,t){const o=n().ou.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,s().Jh)(o.toJSDate())}}function L(e){return{...e,start_date:(0,s().Jh)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?T(e,e.end_condition):(0,i().t1)(e.end_condition):void 0}}},682890:(e,t,o)=>{o.d(t,{M:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("arrowDown",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M8 1.57715C7.5625 1.57715 7.25488 1.88477 7.25488 2.33594V10.8262L7.30957 12.3027L5.50488 10.2861L3.95312 8.75488C3.82324 8.625 3.63184 8.53613 3.42676 8.53613C3.0166 8.53613 2.70898 8.85059 2.70898 9.26758C2.70898 9.46582 2.78418 9.64355 2.94141 9.80762L7.44629 14.3193C7.59668 14.4697 7.79492 14.5586 8 14.5586C8.20508 14.5586 8.40332 14.4697 8.55371 14.3193L13.0586 9.80762C13.2158 9.64355 13.291 9.46582 13.291 9.26758C13.291 8.85059 12.9902 8.53613 12.5801 8.53613C12.3682 8.53613 12.1836 8.625 12.0469 8.75488L10.4951 10.2861L8.69043 12.2959L8.74512 10.8262V2.33594C8.74512 1.88477 8.44434 1.57715 8 1.57715Z"})})},81979:(e,t,o)=>{o.d(t,{o:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("globe2",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM3.88477 3.76465C4.56836 3.11523 5.39551 2.61621 6.31836 2.34277C5.83301 2.82812 5.42285 3.51172 5.11523 4.3457C4.63672 4.19531 4.22656 3.99707 3.88477 3.76465ZM9.68848 2.34961C10.6045 2.62305 11.4316 3.11523 12.1084 3.76465C11.7734 4.00391 11.3633 4.19531 10.8848 4.35254C10.5771 3.51172 10.167 2.82812 9.68848 2.34961ZM8.47852 2.56836C9.0459 2.8418 9.56543 3.58008 9.93457 4.58496C9.4834 4.66699 8.99805 4.71484 8.47852 4.73535V2.56836ZM6.06543 4.58496C6.44141 3.58008 6.9541 2.8418 7.52148 2.56836V4.73535C7.00195 4.71484 6.5166 4.66699 6.06543 4.58496ZM2.05273 7.58594C2.14844 6.42383 2.58594 5.35059 3.25586 4.46875C3.67285 4.77637 4.21289 5.04297 4.8418 5.24121C4.66406 5.95215 4.54785 6.74512 4.51367 7.58594H2.05273ZM11.4863 7.58594C11.4521 6.74512 11.3359 5.95215 11.1582 5.24121C11.7871 5.04297 12.3271 4.7832 12.7373 4.46875C13.4141 5.35059 13.8516 6.42383 13.9473 7.58594H11.4863ZM5.49121 7.58594C5.52539 6.84082 5.62793 6.12988 5.78516 5.4873C6.33203 5.59668 6.91309 5.66504 7.52148 5.69238V7.58594H5.49121ZM8.47852 7.58594V5.69238C9.08691 5.66504 9.66797 5.59668 10.2148 5.4873C10.3721 6.12988 10.4746 6.84082 10.5088 7.58594H8.47852ZM2.05273 8.54297H4.51367C4.54785 9.39746 4.66406 10.1973 4.8418 10.915C4.21973 11.1133 3.68652 11.373 3.27637 11.6807C2.59277 10.792 2.14844 9.71191 2.05273 8.54297ZM5.49121 8.54297H7.52148V10.4707C6.91992 10.498 6.33203 10.5664 5.79199 10.6689C5.62793 10.0195 5.51855 9.29492 5.49121 8.54297ZM8.47852 10.4707V8.54297H10.5088C10.4814 9.29492 10.3721 10.0195 10.208 10.6689C9.66797 10.5664 9.08691 10.498 8.47852 10.4707ZM11.1582 10.915C11.3428 10.1973 11.4521 9.39746 11.4863 8.54297H13.9473C13.8516 9.71191 13.4072 10.792 12.7236 11.6807C12.3135 11.373 11.7803 11.1133 11.1582 10.915ZM8.47852 11.4277C8.99121 11.4482 9.47656 11.4961 9.9209 11.5781C9.55176 12.5625 9.03906 13.2939 8.47852 13.5605V11.4277ZM6.0791 11.5781C6.52344 11.4961 7.00879 11.4482 7.52148 11.4277V13.5605C6.96094 13.2939 6.44824 12.5625 6.0791 11.5781ZM3.90527 12.3848C4.24023 12.1523 4.65039 11.9609 5.12207 11.8105C5.42969 12.6309 5.83301 13.3008 6.30469 13.7793C5.40234 13.5059 4.58203 13.0205 3.90527 12.3848ZM10.8779 11.8105C11.3496 11.9609 11.7598 12.1523 12.0947 12.3848C11.418 13.0205 10.5977 13.5059 9.69531 13.7793C10.167 13.3008 10.5703 12.6309 10.8779 11.8105Z"})})},77973:(e,t,o)=>{o.d(t,{U:()=>j});var n=o.n(o(389539)),r=(o(821057),o(409045),o(453627),o(994774),o(995194),o(520522),o(200082),o(379976),o(724224),o(761121),o(637133),o(241792),o.n(o(402568))),i=()=>o(513670),a=()=>o(326966),s=()=>o(431595),l=()=>o(24945),c=()=>o(255933);const d={version:8,notion_version:0,variant:2},u={version:8,notion_version:1,variant:2},p=0,g=1,h=6,m=8,y=10,f=Date.UTC(2024,0,1);function v(e,t){if(e)return t[p]=255,t[p+1]=240|15&t[p+1],t;const o=Math.floor(((new Date).getTime()-f)/a().A0);if(o>=4096||o<0)throw new Error("Invalid offsetInDays.");return t[p]=o>>4,t[p+1]=o<<4&240|15&t[p+1],t}function b(e,t){if(e>=2**36||e<0)throw new Error("Invalid spaceShortId.");t[g]=240&t[g]|e/2**32&15;for(let o=0;o<4;o++)t[g+1+o]=e/2**(24-8*o)&255;return t}function S(e,t){const o=e?1:0;return t[h]=d.version<<4&240|d.notion_version<<1&14|1&o,t[m]=d.variant<<6&192|63&t[m],t}function C(e,t){if("block"===e)return t[y]=(0,l().ym)(e)|63&t[y],t;const o=(0,l().ym)(e);return t[y]=o>>8&127,t[y+1]=255&o,t}function x(e,t){const o=(0,l().Nq)(e);return t[y]=127&o|128&t[y],t}function P(e,t,o,n){const r=new Uint8Array(16),i=globalThis.crypto.getRandomValues(r);return o!==c().bx&&v(e,i),b(t,i),S(n,i),C(o,i),k(i)}function R(e,t,o){return _(e,t,o)}function _(e,t,o){const n=r()(o),a=i().yo(n,2).map((e=>parseInt(e.join(""),16)));if((0,l().LV)(t)){if(void 0===e)throw new(s().D3)(`Deterministic ID for '${t}' must specify a space short id`)}else if(void 0!==e)throw new(s().D3)(`Deterministic ID for '${t}' should not provide a space short id`);const c=new Uint8Array(a);return e&&b(e,c),x(t,c),function(e){e[h]=240&u.version<<4|14&u.notion_version<<1|1&e[h],e[m]=192&u.variant<<6|63&e[m]}(c),k(c)}const M=new Array(256).fill(0).map(((e,t)=>t.toString(16).padStart(2,"0")));function k(e){let t=0;return M[e[t++]]+M[e[t++]]+M[e[t++]]+M[e[t++]]+"-"+M[e[t++]]+M[e[t++]]+"-"+M[e[t++]]+M[e[t++]]+"-"+M[e[t++]]+M[e[t++]]+"-"+M[e[t++]]+M[e[t++]]+M[e[t++]]+M[e[t++]]+M[e[t++]]+M[e[t++]]}var I=()=>o(956057);const w=`,${[o(363777).uK].join(",")},`;class j{constructor(e){this.environmentName=void 0,this.mainShortId=void 0,this.getSettings=void 0,this.isServerOriginated=void 0,this.mapSpaceIdToShortId=void 0,this.idCreatorLogger=void 0,this.environmentName=e.environmentName,this.mainShortId=o(631871).jF[this.environmentName],this.getSettings=e.getSettings,this.isServerOriginated=e.isServerOriginated,this.mapSpaceIdToShortId=e.mapSpaceIdToShortId,this.idCreatorLogger=e.idCreatorLogger??(()=>{})}idInMain(e,t){const{enableTestDateOffset:o,enableIdSchema:n}=this.getSettings(t);return!n||w.includes(`,${e},`)?this.legacyId(e,"disabled",t):(this.idCreatorLogger(void 0,e,o?"id_schema_test":"id_schema",t),function(e,t,o,n){return P(e,t,o,n)}(o,this.mainShortId,e,this.isServerOriginated))}pointerInMain(e,t){return{table:e,id:this.idInMain(e,t)}}async idWithSpaceId(e,t,o){const{enableTestDateOffset:r,enableIdSchema:i}=this.getSettings(o);if(!i)return this.legacyId(t,"disabled",o);const a=this.mapSpaceIdToShortId(e),s=n().types.isPromise(a)?await a:a;return s?(this.idCreatorLogger(e,t,r?"id_schema_test":"id_schema",o),P(r,s,t,this.isServerOriginated)):this.legacyId(t,"missing_short_id",o)}async pointerWithSpaceId(e,t,o){return{table:t,spaceId:e,id:await this.idWithSpaceId(e,t,o)}}idWithSpaceShortId(e,t,o){const{enableTestDateOffset:n,enableIdSchema:r}=this.getSettings(o);return r?(this.idCreatorLogger(void 0,t,n?"id_schema_test":"id_schema",o),P(n,e,t,this.isServerOriginated)):this.legacyId(t,"disabled",o)}legacyId(e,t,o){return this.idCreatorLogger(void 0,e,t,o),I().Il()}async deterministicIdWithSpaceId(e,t,o,r){const{enableTestDateOffset:i,enableIdSchema:a}=this.getSettings(r);if(!a)return this.idCreatorLogger(e,t,"disabled",r),I().Ul(o);const s=this.mapSpaceIdToShortId(e),l=n().types.isPromise(s)?await s:s;return l?(this.idCreatorLogger(e,t,i?"id_schema_test":"id_schema",r),R(l,t,o)):(this.idCreatorLogger(e,t,"missing_short_id",r),I().Ul(o))}deterministicIdWithSpaceShortId(e,t,o,n){const{enableTestDateOffset:r,enableIdSchema:i}=this.getSettings(n);return i?(this.idCreatorLogger(void 0,t,r?"id_schema_test":"id_schema",n),R(e,t,o)):(this.idCreatorLogger(void 0,t,"disabled",n),I().Ul(o))}async getSpaceIdCreator(e){if(!e)return new T(e,this.idCreatorLogger);const{enableIdSchema:t}=this.getSettings();if(!t)return new T(e,this.idCreatorLogger);const o=this.mapSpaceIdToShortId(e),r=n().types.isPromise(o)?await o:o;return this.getSpaceShortIdCreator(e,r)}getSpaceIdCreatorSync(e){if(!e)return new T(e,this.idCreatorLogger);const{enableIdSchema:t}=this.getSettings();if(!t)return new T(e,this.idCreatorLogger);const o=this.mapSpaceIdToShortId(e),r=n().types.isPromise(o)?void 0:o;return this.getSpaceShortIdCreator(e,r)}getSpaceShortIdCreator(e,t){const{enableIdSchema:o}=this.getSettings();return o&&t?new L(e,this,t):new T(e,this.idCreatorLogger)}async getSpaceIdCreatorFromModel(e){return e.getShortIdStr()?this.getSpaceShortIdCreator(e.id,Number(e.getShortIdStr())):await this.getSpaceIdCreator(e.id)}}class T{constructor(e,t){this.spaceId=void 0,this.idCreatorLogger=void 0,this.spaceId=e,this.idCreatorLogger=t}idInSavedSpace(e,t){return this.idCreatorLogger(void 0,e,"disabled",t),I().Il()}idInMain(e,t){return this.idCreatorLogger(void 0,e,"disabled",t),I().Il()}deterministicIdInSavedSpace(e,t,o){return this.idCreatorLogger(void 0,e,"disabled",o),I().Ul(t)}pointerInMain(e,t){return{id:this.idInMain(e),table:e}}pointerInSavedSpace(e,t){return{id:this.idInSavedSpace(e),table:e,spaceId:this.spaceId}}getSpaceId(){return this.spaceId}}class L{constructor(e,t,o){this.spaceId=void 0,this.idCreator=void 0,this.spaceShortId=void 0,this.spaceId=e,this.idCreator=t,this.spaceShortId=o}idInSavedSpace(e,t){return this.idCreator.idWithSpaceShortId(this.spaceShortId,e,t)}idInMain(e,t){return this.idCreator.idInMain(e,t)}deterministicIdInSavedSpace(e,t,o){return this.idCreator.deterministicIdWithSpaceShortId(this.spaceShortId,e,t,o)}pointerInMain(e,t){return{id:this.idInMain(e,t),table:e}}pointerInSavedSpace(e,t){return{id:this.idInSavedSpace(e,t),table:e,spaceId:this.spaceId}}getSpaceId(){return this.spaceId}}},259408:(e,t,o)=>{o.d(t,{$W:()=>p,KQ:()=>u,_e:()=>h,Ay:()=>f,fS:()=>d,t:()=>i(),V5:()=>m,Kz:()=>y});o(267602),o(653476);var n=()=>o(513670),r=()=>o(696459),i=()=>o(124199),a=()=>o(629719);const s=["student","personal","plus","business","enterprise"];function l(e){return(0,r().DE)(s,e)}var c=()=>o(122792);const d=["plus","business","enterprise","ai","sites_custom_hostnames"];function u(e,t,o,n){return h(p(e,t,o,n))}function p(e,t,o,n){const{name:i,scope:a,actor:s}=n,l={...n,billingData:a.billingData},c=a.premiumFeatureOverrides,d=i in c?function(e,t,o){const n={type:"contact_account_manager"},i=e[t.name].type;if("check"===i){const e={type:"none"};return!0===o?{type:"available",limit:e}:{type:"upsell",upsell:n,limit:e}}if("per_use"===i){const e=t.amount,r={type:"per_use",amount:o};return"unlimited"===o||o>e?{type:"available",limit:r}:{type:"upsell",upsell:n,limit:r}}if("cumulative"===i){const e=t.amount,r=t.data.current,i={type:"cumulative",current:r,total:o};return"unlimited"===o||o>=r+e?{type:"available",limit:i}:{type:"upsell",upsell:n,limit:i}}(0,r().t1)(i)}(t,n,c[i]):o[i](l);let u;if("available"===d.type){const e=d.upsell?g(a.billingData,d.upsell,n.supportedProducts):void 0;u={...d,upsell:e}}else if("blocked"===d.type){const e=g(a.billingData,d.upsell,n.supportedProducts);u={...d,upsell:e}}else{const e=g(a.billingData,d.upsell,n.supportedProducts),t=function(e){const{actor:t,supportedProducts:o,upsell:n}=e;if(!t.isSpaceAdmin)return"blocked";const i=n.type;switch(i){case"product":return o.includes(n.product)?"upsell":"blocked";case"contact_sales":case"contact_account_manager":return"upsell";default:(0,r().t1)(i)}}({actor:s,supportedProducts:n.supportedProducts,upsell:e});u={...d,type:t,upsell:e}}return Math.random()<.001&&e({level:"info",from:"premiumFeatureFramework",type:"getPremiumFeatureAvailability",data:{featureName:i,featureScope:a,featureActor:s,featureAvailability:d}}),u}function g(e,t,o){if((0,a().Rd)(e.subscription))return{type:"contact_account_manager"};if("product"!==(null==t?void 0:t.type)||o.includes(t.product)||!l(t.product))return t;const r=t.product,i=o.filter((e=>l(e))).filter((e=>"student"!==e)).filter((e=>c().rC[e]>=c().rC[r])),s=(0,n().F)(i,(e=>c().rC[e]));return s?{...t,product:s}:t}function h(e){return"available"===(null==e?void 0:e.type)}function m(e,t){const{available:o}=t;let n,i;return"unavailable"in t?(n=t.unavailable,i=t.unavailable):(n=t.blocked,i=t.upsell),"available"===e.type?o():"upsell"===e.type?i(e):"blocked"===e.type?n(e):(0,r().t1)(e)}function y(e,t){if(void 0!==e)return m(e,{available:()=>{},blocked:t,upsell:()=>{}})}function f(e){return i().object({required:e,optional:{}})}},971095:(e,t,o)=>{o.d(t,{A:()=>n});const n=(0,o(830742).LS)("importEvernote")}}]);