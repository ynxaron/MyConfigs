"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[67197],{41384:(e,t,o)=>{o.r(t),o.d(t,{TimelineItemDateRange:()=>_,propertiesWidth:()=>q,scrollArrowLeftOffset:()=>H,scrollArrowLeftOffsetAnimatePx:()=>O});o(241792);var r=o(667294),l=()=>o(219727),n=()=>o(142735),i=()=>o(846550),a=()=>o(492522),s=()=>o(788860),c=()=>o(513670),d=()=>o(707513),u=()=>o(574089),g=()=>o(879952),m=()=>o(269299),S=()=>o(887430),p=()=>o(768826),h=()=>o(760536),b=()=>o(356321),f=()=>o(596324),y=()=>o(973509),v=()=>o(943620),x=()=>o(384241),k=()=>o(345837),C=()=>o(247724),w=()=>o(582835),D=()=>o(12512),V=()=>o(735501),P=()=>o(32969),I=()=>o(749826),K=()=>o(197666),j=()=>o(493843),R=()=>o(701182),M=()=>o(473604),T=()=>o(790964),B=()=>o(275200),A=o(785893);const F=24;function L(e){const{store:t,schema:o,timelineState:a,dateValueStore:s,collectionContextStore:c,isFullScreen:d,isRootChild:u}=e,g=(0,r.useRef)(null),[S,p]=(0,r.useState)(!1),h=(0,l().O7)(),b=(0,n().VK)((()=>{const e=a.drawState.state;if(e)return e.startStore===t}),[t,a.drawState]),f=(0,n().VK)((()=>!b&&a.hoveredItem.state===t&&!K().Z.state),[b,t,a.hoveredItem]),y=(0,n().VK)((()=>(0,R().H5)(c)),[c]),v=(0,r.useCallback)((e=>{if(e.preventDefault(),!a.scrollLeft.state||!g.current)return;const r=(0,B().VW)(g.current);j().J4({timelineState:a,store:t,startX:e.startX,startY:e.startY,schema:o,collectionContextStore:c,verticalScroller:r}),p(!1)}),[c,o,t,a]),x=(0,r.useCallback)((e=>{if(!g.current)return;const t=(0,B().VW)(g.current);j().mz({timelineState:a,currentX:e.currentX,currentY:e.currentY,verticalScroller:t})}),[a]),k=(0,r.useCallback)((()=>{m().createAndCommit({userAction:"TimelineItemDependencyDrawHandle.handleDraggableDragEnd",environment:h,canUndo:!0,perform:e=>{j().$o({timelineState:a,environment:h,transaction:e,collectionContextStore:c,isFullScreen:d,isRootChild:u})}})}),[h,a,c,d,u]),C=(0,r.useCallback)((e=>{j().x({timelineState:a,environment:h})}),[h,a]),w=(0,r.useCallback)((()=>{p(!0)}),[p]),D=(0,r.useCallback)((()=>{p(!1)}),[p]),V=(0,i().yK)((e=>({draggableStyle:{position:"absolute",top:0,right:-F,width:F,height:"100%",zIndex:1,isolation:"auto"},draggableSvgStyle:{position:"absolute",left:0,cursor:"pointer"},svgPathStyle:{stroke:y?e.collectionValidDependencyArrow:e.collectionUnsetDependencyArrow,strokeWidth:R().lf},svgCircleFill:{color:e.white}})),[y]),P=(0,r.useCallback)((e=>{if(!s.state)return;return(0,A.jsx)("div",{ref:g,style:V.draggableStyle,...e,children:f&&(0,A.jsx)("div",{style:V.draggableSvgStyle,children:(0,A.jsxs)("svg",{style:{width:22,height:30},onMouseMove:w,onMouseLeave:D,children:[(0,A.jsx)(M().Z,{startPoint:{x:0,y:14},endPoint:{x:10,y:14},style:V.svgPathStyle,showArrowHead:S}),(0,A.jsx)("circle",{cx:S?10+R().S7:10,cy:14,r:S?R().S7:R().Wk,style:V.svgPathStyle,fill:V.svgCircleFill.color})]})})})}),[s,D,w,f,V.draggableStyle,V.draggableSvgStyle,V.svgCircleFill.color,V.svgPathStyle,S]);return(0,A.jsx)(T().Z,{render:P,onDraggableDragStart:v,onDraggableDragMove:x,onDraggableDragEnd:k,onDraggableDragCancel:C})}var E=()=>o(645843);const z={position:"absolute",top:0,right:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"},Z={position:"absolute",top:0,left:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"};function N(e){let{type:t,store:o,query:a,schema:c,timelineState:d,dateValueStore:u,collectionContextStore:g,isInPeekRenderer:S,isFullScreen:p,isRootChild:b}=e;const f=(0,l().O7)(),y=(0,s().YB)(),[v,x]=(0,r.useState)(!1),k=(0,n().VK)((()=>{const e=d.dragState.state;return e?e.stores[0]===o&&("left"===t?e.type===R().px.LeftResizer:e.type===R().px.RightResizer):v&&!K().Z.state}),[v,o,d,t]),C=(0,n().Kw)(u),w=(0,n().Kw)(d.zoomLevel),D=(0,i().yK)((e=>{const t={position:"absolute",top:6,borderRadius:3,width:3,bottom:6,background:e.regularTextColor},o={fontSize:12,position:"absolute",width:200,lineHeight:`${h().Z}px`,pointerEvents:"none"};return{leftDraggableIndicator:{...t,left:Math.ceil(3.5)+1},rightDraggableIndicator:{...t,left:Math.floor(.5)},leftDraggableLabel:{...o,right:12,textAlign:"right"},rightDraggableLabel:{...o,left:12},timelineBackground:{background:S?e.peekTimelineBackground:e.timelineBackground,padding:4,borderRadius:6}}}),[S]),V=(0,r.useCallback)((()=>x(!0)),[]),P=(0,r.useCallback)((()=>x(!1)),[]),I=(0,r.useCallback)((e=>{j().td({timelineState:d,currentX:e.currentX})}),[d]),M=(0,r.useCallback)((()=>{m().createAndCommit({userAction:"TimelineItemResizer.handleDraggableDragEnd",environment:f,canUndo:!0,perform:e=>{j().fX({timelineState:d,collectionContextStore:g,query:a,schema:c,intl:y,environment:f,transaction:e})}}),(0,E().ne)(f,{...(0,E().Ii)({environment:f,collectionContextStore:g,timelineState:d,isFullScreen:p,isRootChild:b}),type:t})}),[g,f,y,p,b,a,c,d,t]),B=(0,r.useCallback)((e=>{e.preventDefault(),j().f$({timelineState:d,store:o,startX:e.startX,type:"left"===t?R().px.LeftResizer:R().px.RightResizer,query:a,schema:c,intl:y,environment:f})}),[f,y,a,c,o,d,t]),F=(0,r.useCallback)((()=>{j().cQ({timelineState:d,environment:f})}),[f,d]),L=(0,r.useCallback)((e=>{const o="left"===t;if(C)return(0,A.jsx)("div",{style:o?Z:z,onMouseMove:V,onMouseLeave:P,...e,children:k&&(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("div",{style:o?D.leftDraggableIndicator:D.rightDraggableIndicator}),(0,A.jsx)("span",{style:o?D.leftDraggableLabel:D.rightDraggableLabel,children:(0,A.jsx)("span",{style:D.timelineBackground,children:o?(0,R().yk)(C,w):(0,R().fc)(C,w)})})]})})}),[C,w,P,V,k,D,t]);return(0,A.jsx)(T().Z,{render:L,onDraggableDragStart:B,onDraggableDragMove:I,onDraggableDragEnd:M,onDraggableDragCancel:F})}const W=r.memo(N,o(632314).Z),X=(0,s().vU)({typeAName:{defaultMessage:"Type a nameâ€¦",id:"timelineItem.itemName.placeholder"}}),H=21,O=48,q=800,Y=400;var $=function(e){return e[e.Absolute=0]="Absolute",e[e.Sticky=1]="Sticky",e}($||{});function U(e){const{timelineState:t,scrollerLeftOffset:c,itemPositionStore:d,store:u,query:g,schema:p,dateValueStore:b,disabled:f,isDraggingViaTimelineItemStore:y,collectionContextStore:v,isFullScreen:x,isRootChild:k,parentStore:w,toggleButton:D,isInPeekRenderer:V,handleOpenPeekPage:P,showProperties:M,clonedStore:T,blockPropertyValueOverlayStore:B,propertiesWrapElementRef:F}=e,E=(0,l().O7)(),z=(0,s().YB)(),{value:Z}=(0,o(677559).XJ)(o(141735).F.formulas),N=(0,n().VK)((()=>d.state),[d]),X=(0,n().VK)((()=>{if(N){const{left:e,right:o}=N,r=o-e;if(!((0,R().Tp)(E)&&r>50))return{position:$.Absolute,left:e};{const l=t.scrollLeft.state;if(void 0!==l){const t=l+c-e+H;if(t<0)return{position:$.Absolute,left:e};if(t>r)return{position:$.Absolute,left:o};if(t>0)return{position:$.Sticky,left:c+H}}}}}),[E,N,c,t.scrollLeft]),O=(0,n().VK)((()=>{var e;const t=o(127519).default.state;if("editing"!==t.mode)return!1;const r=null===(e=(0,o(191003).QY)(t.multiSelection))||void 0===e?void 0:e.store;return u&&r&&r===u.getBlockTitleStore()}),[u]),Y=(0,n().VK)((()=>(0,R().H5)(v)),[v]),U=(0,n().VK)((()=>t.hoveredItem.state===u),[u,t.hoveredItem]),_=(0,n().VK)((()=>{const{mainEditorCurrentBlockStore:e}=o(876822).default.state;if(u&&e)return S().mb({environment:E,store:u,mainEditorCurrentBlockStore:e,collectionContextStore:v,fullyQualified:!1})}),[E,v,u]),ee=(0,n().VK)((()=>{if(u)return(0,o(429725).ZP)({store:u,fullyQualified:!1,pageVisitSource:o(506347).tY.LinkInPage})}),[u]),oe=(0,n().VK)((()=>!f&&(null==u?void 0:u.canEdit())),[f,u]),re=(0,l().MO)(),le=(0,n().VK)((()=>"collectionTypedView"===v.contextType),[v]),ne=(0,n().VK)((()=>oe&&!re&&(Y||v.permissionScopesStore.state.canConfigureBlock)&&!le),[oe,v.permissionScopesStore,re,le,Y]),ie=(0,n().VK)((()=>v.currentSubitemFormatStoreForUiDisplayStore.state),[v]),ae=ie?42:10,se=N?Math.max(N.right-N.left,ae)+1:ae+1,ce=(0,n().VK)((()=>y.state),[y]),de=(0,n().VK)((()=>{const e=w,t=(0,o(576868).m1)({collectionContextStore:v,collectionStore:e,environment:E}),r=null==u?void 0:u.getModel(),l=null==u?void 0:u.getRecordModel;if(!t||!r||!l)return!0;const n=I().default.getConfigKey("collection_request_settings","clientFormulaTimeoutMs");return(0,o(455947).q)(t)({block:r,getRecordModel:l,propertyMapping:null==e?void 0:e.getPropertyMapping(),formulaTimeoutTimestampMs:Date.now()+n,resultCache:new Map,regExpCache:new Map,experimentService:I().default,formulasModule:Z})}),[v,E,w,u,Z]),ue=(0,n().VK)((()=>v.isInHomeWidgetStore.state),[v.isInHomeWidgetStore]),ge=(0,n().VK)((()=>!!u&&S().Ts(u)),[u]),me=(0,n().VK)((()=>{const e=t.drawState.state;return e&&e.startStore!==u}),[u,t.drawState]),Se=(0,r.useMemo)((()=>(0,A.jsx)(Q,{collectionContextStore:v,toggleButton:D,itemPositionStore:d})),[v,d,D]),pe=(0,i().yK)((e=>({linkBoxStyle:{width:"100%",height:"100%",borderRadius:6},linkBoxInnerStyle:{width:"100%",height:"100%",display:"flex",paddingLeft:6,paddingRight:6,borderRadius:6},container:{position:"absolute",left:null==N?void 0:N.left,marginTop:1,marginBottom:1,width:se,height:h().Z-2,borderRadius:6,display:"flex",...null!=N&&N.isExistingSubitemPlaceholder?void 0:{..."light"===e.mode?{background:null!=N&&N.isPlaceholder?e.buttonHoveredBackground:e.contentBackground,boxShadow:null!=N&&N.isPlaceholder?void 0:e.buttonBoxShadow}:{background:V?e.calendarItemBackground:e.popoverBackground,boxShadow:null!=N&&N.isPlaceholder?void 0:e.lightBoxShadow}},...(null==N?void 0:N.isPlaceholder)&&{cursor:"crosshair"},...ce&&{display:"none"},...!de&&{opacity:.5},zIndex:a().ov},halo:{...S().pB(e,ge),borderRadius:6},propertiesContainer:{width:"100%",WebkitMaskImage:null!=N&&N.maskPercent&&(null==N?void 0:N.maskPercent)<1&&U?`linear-gradient(90deg, rgba(0,0,0,1) ${100*N.maskPercent}%, rgba(0,0,0,0.4) ${100*N.maskPercent}%)`:void 0,pointerEvents:"none",...ce&&{display:"none"},zIndex:a().ov,opacity:de?1:.5},propertiesWrapInnerStyle:{display:"flex",height:h().Z-2+1,paddingLeft:ie&&Se?24:6,width:q,overflow:"hidden"}})),[ce,U,V,de,N,ge,ie,Se,se]),he=(0,r.useCallback)((()=>{const e=null==F?void 0:F.current,t=X;e&&t&&(e.style.position=t.position===$.Absolute?"absolute":"sticky",e.style.left=`${t.left}px`)}),[X,F]),be=(0,r.useMemo)((()=>(0,A.jsx)("div",{style:pe.propertiesContainer,children:(0,A.jsx)("div",{style:pe.propertiesWrapInnerStyle,ref:F,className:C().z_z,children:M.map(((e,t)=>(0,A.jsx)(te,{showProperties:M,store:u,disabled:f,blockPropertyValueOverlayStore:B,clonedStore:T,collectionContextStore:v,parentStore:w,editingTitle:O,property:e,index:t},e)))})})),[B,T,v,f,O,w,F,M,u,pe]),fe=(0,r.useCallback)((e=>{u&&(t.dragState.state||j().f$({timelineState:t,store:u,startX:e.startX,type:R().px.ItemDrag,query:g,schema:p,intl:z,environment:E}),j().td({timelineState:t,currentX:e.currentX}))}),[t,u,g,p,z,E]),ye=(0,r.useCallback)((()=>{m().createAndCommit({userAction:"TimelineItemDateRange.handleSelectableDragEnd",environment:E,canUndo:!0,perform:e=>{j().fX({timelineState:t,collectionContextStore:v,query:g,schema:p,intl:z,environment:E,transaction:e})}})}),[t,v,g,p,z,E]),ve=(0,r.useCallback)((()=>{j().cQ({timelineState:t,environment:E})}),[t,E]),xe=(0,r.useCallback)((e=>{const o=t.dragState.state;(K().Z.state||o)&&!me||E.device.isPhone||t.hoveredItem.setState(u)}),[t,me,E,u]),ke=(0,r.useCallback)((()=>{const e=t.dragState.state;K().Z.state}),[t,me]);return(0,r.useEffect)((()=>{he()}),[X,he]),N?!u||null!=N&&N.isPlaceholder?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("div",{style:pe.container,className:C().ovr}),be]}):(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(o(307369).Z,{style:pe.container,haloStyle:pe.halo,className:C().ovr,store:u,canSelect:!0,shouldShowHalo:!ue,shouldForceRenderSelectionHalo:ge,canDrag:oe,analyticsName:"timeline",onDraggableDragStart:J,onDraggableDragMove:fe,onDraggableDragEnd:ye,onDraggableDragCancel:ve,canTriggerContextMenu:oe,getGhostElement:G,disableScrollToReveal:!0,onMouseMove:xe,onMouseLeave:ke,showBlockMenuInput:!0,children:[Se,(0,A.jsx)(o(729775).Z,{style:pe.linkBoxStyle,innerStyle:pe.linkBoxInnerStyle,onClick:P,href:ee,metaHref:_,hovered:U,ignoreLocalHoverState:!0}),ne&&u&&(0,A.jsx)(L,{store:u,isFullScreen:x,isRootChild:k,schema:p,timelineState:t,dateValueStore:b,collectionContextStore:v}),oe&&!re&&(0,A.jsx)(W,{type:"left",store:u,query:g,schema:p,timelineState:t,dateValueStore:b,collectionContextStore:v,isFullScreen:x,isInPeekRenderer:V,isRootChild:k}),oe&&!re&&(0,A.jsx)(W,{type:"right",store:u,query:g,schema:p,timelineState:t,dateValueStore:b,collectionContextStore:v,isFullScreen:x,isInPeekRenderer:V,isRootChild:k})]}),be]}):null}const _=r.memo(U);function Q(e){let{collectionContextStore:t,toggleButton:o,itemPositionStore:r}=e;const l=(0,n().Kw)(t.currentSubitemFormatStoreForUiDisplayStore),i=(0,n().Kw)(r);return!l||!o||null!=i&&i.isExistingSubitemPlaceholder?null:(0,A.jsx)("span",{style:{zIndex:1,paddingTop:3},children:o})}function J(e){e.preventDefault()}function G(e){const t=P().C.findSelectablesFromStore(e),o=c().oA(t.map((e=>e.getNode()))),r=c().oA(o.map((e=>e.closest(`.${C().o4s}`))))[0];if(r){const e=u().eN(r),t=e.cloned.querySelector(`.${C().ovr}`),o=e.cloned.querySelector(`.${C().z_z}`);return t&&o&&"sticky"===o.style.position&&(o.style.position="absolute",o.style.left=t.style.left),[e]}return o.map(u().eN)}function ee(e){let{isLast:t,store:o,collectionContextStore:a,parentStore:u,editingTitle:m}=e;const S=(0,i().Fg)(),p=(0,l().O7)(),h=(0,s().YB)(),b=(0,n().VK)((()=>null==o?void 0:o.getIcon()),[o]),C=(0,n().VK)((()=>null==a?void 0:a.shouldShowPageIcon()),[a]),P=(0,n().VK)((()=>null==o?void 0:o.hasError()),[o]),I=(0,n().VK)((()=>!o||o.isEmptyPage()),[o]),K=(0,n().Kw)(a.currentSubitemFormatStoreForUiDisplayStore),j=(0,n().VK)((()=>{var e;return K&&u?null===(e=u.getSchema()[K.property])||void 0===e?void 0:e.name:""}),[u,K]),R=(0,n().VK)((()=>null==o?void 0:o.getBlockTitleStore()),[o]),M=(0,n().VK)((()=>o&&(0,w().Cr)({collectionContextStore:a,blockStore:o})),[a,o]),T=(0,n().VK)((()=>o&&(0,w().wI)({collectionContextStore:a,blockStore:o})),[a,o]),B=(0,r.useCallback)((()=>{o&&g().Ys({environment:p,store:o})}),[p,o]);return(0,A.jsxs)("div",{style:{display:"flex",marginRight:t?0:10,fontSize:14,fontWeight:d().Ue.medium,alignItems:"center"},children:[C&&b&&!P&&(0,A.jsx)(v().Z,{disabled:!0,icon:b,isEmptyPage:I,size:20,style:{marginLeft:2,marginRight:6}}),P&&(0,V().t)({display:"inline-block",verticalAlign:"text-top",marginLeft:4,marginRight:7,width:16,fill:S.accentColors.orange[500]}),o&&!m&&(0,A.jsx)(x().Z,{style:{whiteSpace:"nowrap",maxWidth:Y},store:o}),m&&o&&R&&(0,A.jsx)(k().Z,{store:R,style:{whiteSpace:p.device.isFirefox?"pre":"nowrap"},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:B,onEsc:B,onTab:c().yR,placeholder:h.formatMessage(X.typeAName),disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:D().B3.none}),o&&M&&(0,A.jsx)("div",{style:{paddingTop:2,paddingLeft:4},children:(0,A.jsx)(f().O,{blockStore:o,collectionContextStore:a})}),o&&T&&(0,A.jsx)("div",{style:{paddingTop:2,paddingLeft:8,color:S.lightTextColor},children:(0,A.jsx)(y().B,{blockStore:o,collectionContextStore:a})}),!o&&(0,A.jsx)("span",{children:u&&j?(0,A.jsx)(s()._H,{defaultMessage:"New page in {propertyName}",id:"timeline.itemPlaceholder.nest.addSubitemWithPropertyName",values:{propertyName:j}}):(0,A.jsx)(s()._H,{id:"timeline.itemPlaceholder.newPage",defaultMessage:"New page"})})]},"title")}function te(e){let{property:t,index:o,showProperties:r,store:l,disabled:i,blockPropertyValueOverlayStore:a,clonedStore:s,collectionContextStore:c,parentStore:d,editingTitle:u}=e;const g=o===r.length-1,m=(0,n().VK)((()=>null==l?void 0:l.getAssociatedCollectionStore()),[l]),S=(0,n().VK)((()=>null==l?void 0:l.canEdit()),[l]),h=(0,n().VK)((()=>c.collectionViewStore()),[c]);return m?"title"===t?(0,A.jsx)(ee,{store:l,collectionContextStore:c,parentStore:d,editingTitle:u,isLast:g}):l&&s?(0,A.jsx)(p().m,{store:s,property:t,disabled:i||!S,locked:!1,format:b().C.Timeline,tableWrap:!1,isLast:g,blockPropertyValueOverlayStore:a,enablePointerEventsForInteractiveTypes:!0,collectionStore:m,collectionViewStore:h},t):null:null}}}]);