"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[59822],{5317:(e,t,o)=>{o.d(t,{Z:()=>g});o(667294);var n=()=>o(219727),i=()=>o(846550),l=()=>o(788860),r=()=>o(250303),s=()=>o(269299),c=()=>o(827973),a=()=>o(663631),d=()=>o(677559),p=()=>o(909679),u=()=>o(688725),m=o(785893);function g(e){const{collectionContextStore:t,onClose:o,focused:g,isCompact:w}=e,S=(0,n().O7)(),{value:f}=(0,d().XJ)(u().formsEditorDependency),h=(0,i().yK)((e=>({newFormButton:{color:e.mediumTextColor,display:"flex",flexDirection:"row"}})),[]);function v(){s().createAndCommit({userAction:"CollectionViewTabBar.createGenericViewType",environment:S,canUndo:!0,perform:e=>{f&&f.formEditorActions.createAndFocusCollectionFormEditorView({environment:S,collectionContextStore:t,transaction:e})}}),o(),r().xb({environment:S,collectionContextStore:t,view_type:"form_editor"})}if(!f)return null;const x=(0,m.jsx)(c().Z,{focused:g,onClick:v,title:(0,m.jsxs)("div",{style:h.newFormButton,children:[(0,m.jsx)(l()._H,{defaultMessage:"New form",id:"database.collectionViewSelect.newFormButtonTitle"}),(0,m.jsx)(a().Z,{})]}),style:{padding:"1 0"},icon:(0,p().E)({width:14,fill:h.newFormButton.color,marginRight:2})}),C=(0,m.jsx)(c().Z,{focused:g,onClick:v,title:(0,m.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,m.jsx)(l()._H,{defaultMessage:"Form",id:"CollectionViewTabBar.newFormItem.title"}),(0,m.jsx)(a().Z,{})]}),icon:(0,p().E)({width:16}),shouldWrapCaption:!0,caption:(0,m.jsx)(l()._H,{defaultMessage:"Create a form to input data directly into this database",id:"CollectionViewTabBar.newFormItem.description"})});return w?x:C}},821159:(e,t,o)=>{o.d(t,{Y:()=>d,s:()=>a});o(667294);var n=()=>o(219727),i=()=>o(846550),l=()=>o(707513),r=()=>o(827973),s=()=>o(641506),c=o(785893);function a(e){let{environment:t}=e;return{padding:t.device.isMobile?"12px 2px":"6px 4px",alignItems:"center"}}function d(e){let{buttonMenuItemProps:t,title:o,caption:d,icon:p,onClick:u,right:m,isDisabled:g}=e;const w=(0,n().O7)(),S=(0,i().yK)((e=>({menuItem:{display:"flex",...a({environment:w}),opacity:g?.4:void 0},title:{fontSize:w.device.isMobile?16:14,...l().Yu},caption:{fontSize:(0,s().yv)(w,"UISmall"),overflow:"hidden",color:e.mediumTextColor,whiteSpace:"nowrap",textOverflow:"ellipsis"}})),[w,g]),f={};return u&&(f.onClick=u),(0,c.jsx)(r().Z,{...t,style:S.menuItem,disabled:g,title:(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{style:S.title,children:o}),d&&(0,c.jsx)("div",{style:S.caption,children:d})]}),icon:p,right:m,...f})}},368199:(e,t,o)=>{o.r(t),o.d(t,{CollectionNewViewsPopupComponent:()=>W});o(267602),o(653476),o(241792);var n=o(667294),i=()=>o(219727),l=()=>o(142735),r=()=>o(846550),s=()=>o(353329),c=()=>o(788860),a=()=>o(250303),d=()=>o(269299),p=()=>o(763707),u=()=>o(2971),m=()=>o(110232),g=()=>o(5317),w=()=>o(827973),S=()=>o(573357),f=()=>o(198829),h=()=>o(255577),v=()=>o(470386),x=()=>o(388284),C=()=>o(654133),y=()=>o(527278),T=()=>o(352230),I=()=>o(913813),V=()=>o(521777),b=()=>o(998901),k=()=>o(876822),_=()=>o(535645),j=()=>o(499819),M=()=>o(281236),Z=()=>o(925880),F=()=>o(182722),B=()=>o(932753),L=()=>o(887430),P=()=>o(716025),O=o(785893);const E=3;function K(e){let{numberOfSuggestedViews:t,isShowingMoreSuggestions:o}=e;return t>=5&&!o}function A(e){let{suggestedWorkflowTemplateViews:t,isShowingMoreSuggestions:o}=e;const n=t.map((e=>e.templateId));return K({numberOfSuggestedViews:n.length,isShowingMoreSuggestions:o})?n.slice(0,E):n}function W(e){let{collectionContextStore:t,onClose:o,showNewViewItems:W}=e;const R=(0,i().O7)(),N=R.device,[U,Y]=(0,n.useState)(!1),z=(0,r().yK)((e=>({showMoreLabel:{color:e.mediumTextColor}})),[]),H=(0,l().VK)((()=>{const e=t.collectionStore(),o=t.collectionViewBlockStore();if(!e||!o)return[];const n=e.getFormat().app_config_uri,i=n?(0,m().YB)((0,u().appConfigs)(),n):void 0;return i?(0,m().$L)({environment:R,appConfig:i,collectionStore:e,collectionViewBlockStore:o}):[]}),[t,R]),$=(0,l().VK)((()=>(0,L().kn)(t,N)),[t,N]),D=(0,Z().c)(t).filter((e=>(0,s().U2)(e,"collection_view"))),G=(0,n.useCallback)((e=>({key:e,render:t=>(0,O.jsx)(w().Z,{title:y().Z.formatMessage(L().b1[e]),icon:(0,O.jsx)(P().F,{color:"regular",viewType:e}),...t}),action:()=>{d().createAndCommit({userAction:"CollectionViewTabBar.createGenericViewType",environment:R,canUndo:!0,perform:o=>{B().ME({environment:R,collectionContextStore:t,newViewType:e,transaction:o,skipOpenSettings:!0})}}),a().xb({environment:R,collectionContextStore:t,view_type:e})}})),[R,t]),{renderSuggestedTypedView:J}=function(e,t){const o=(0,i().O7)(),r=(0,l().VK)((()=>k().default.state.currentSpaceViewStore),[]),s=(0,l().VK)((()=>e.collectionViewBlockStore()),[e]),c=(0,l().VK)((()=>e.collectionStore()),[e]),g=(0,l().VK)((()=>{var e;if(!c)return;const t=null===(e=c.getFormat())||void 0===e?void 0:e.app_config_uri;return t?(0,m().YB)((0,u().appConfigs)(),t):void 0}),[c]),S=n.useCallback((t=>{if(!s||!g||!r)return;const n=s.getParentStore();if(!n||"block"!==n.table&&"space"!==n.table&&"team"!==n.table)return;if(1!==t.dependencies.length)return;const i=t.dependencies[0];d().createAndCommit({userAction:"CollectionViewSuggestedViews.createView",environment:o,canUndo:!0,perform:l=>{var c;p().applyTypedFeatures({environment:o,spaceViewStore:r,appParentStore:n,appUri:g.uri,features:[{type:"simple",featureUri:t.uri}],appCollectionViewBlockStores:[s],createOrModify:"modify",transaction:l});const d=((null===(c=s.getFormat())||void 0===c?void 0:c.app_uri_map)??{})[i.uri];B().f8({environment:o,collectionContextStore:e,collectionViewId:d,isFullScreen:e.isFullScreenStore.state,isRootChild:e.isRootChildStore.state,isInPeekRenderer:e.isInPeekRendererStore.state}),a().xb({environment:o,collectionContextStore:e,view_type:i.value.type,view_config_uri:t.uri,feature:{id:d,from:"suggested_view",type:t.uri}})}})}),[s,g,r,o,e]),f=n.useCallback((e=>{const o=(e,t)=>{var o;const n=e.dependencies[0],i=(0,O.jsx)(P().F,{color:"regular",viewIcon:null===(o=n.value.format)||void 0===o?void 0:o.collection_view_icon,viewType:n.value.type});return(0,O.jsx)(w().Z,{title:n.value.name?n.value.name:"New View",icon:i,...t})};return{key:e.uri,render:t=>(0,O.jsx)(C().Z,{placement:b().Placement.Left,render:n=>o(e,{...t,...n,onMouseEnter:e=>{var o,i;null===(o=n.onMouseEnter)||void 0===o||o.call(n,e),null===(i=t.onMouseEnter)||void 0===i||i.call(t,e)}}),renderTooltip:()=>e.description}),action:()=>{S(e),t()}}}),[S,t]);return{renderSuggestedTypedView:f}}(t,o),{renderSuggestedWorkflowTemplateView:X}=function(e,t){const o=(0,i().O7)(),n=(0,r().yK)((e=>({icon:{fill:e.regularIconColor}})),[]);return{renderSuggestedWorkflowTemplateView:(i,l,r)=>({key:`workflow.${i.templateId}`,action:()=>{(0,_().r)({environment:o,collectionContextStore:e,template:i,suggestedFeatureAnalytics:{origin:"suggested_views",shownTemplateIds:r,selectedIndex:l}}),t()},render:e=>(0,O.jsx)(w().Z,{...e,icon:(0,O.jsx)(j().l,{template:i,size:16,iconStyle:n.icon}),title:(0,M().getWorkflowTemplateName)(i)})})}}(t,o),Q={key:"showMore",render:e=>(0,O.jsx)(w().Z,{...e,style:z.showMoreLabel,icon:(0,I().O)({width:14,marginRight:2}),title:(0,O.jsx)(c()._H,{defaultMessage:"More...",id:"collectionViewSuggestedViews.showMore.label"})}),action:()=>{Y(!0)}},q={key:"emptyView",render:e=>(0,O.jsx)(w().Z,{title:(0,O.jsx)(c()._H,{defaultMessage:"Empty view",id:"collectionTabBar.newEmptyView.title"}),icon:(0,V().R)({width:16}),...e}),action:()=>{d().createAndCommit({userAction:"CollectionViewTabBar.createGenericViewType",environment:R,canUndo:!0,perform:e=>{B().ME({environment:R,collectionContextStore:t,newViewType:"table",transaction:e,skipOpenSettings:!1})}}),a().xb({environment:R,collectionContextStore:t,view_type:"table"})}},ee=["table","board","chart","list","timeline","calendar","gallery"].map((e=>G(e)));let te;te=H.length?H.map((e=>J(e))):D.length?D.map(((e,t)=>X(e,t,A({suggestedWorkflowTemplateViews:D,isShowingMoreSuggestions:U})))):ee,(0,F().J)({collectionContextStore:t,origin:"suggested_views",shownTemplateIds:A({suggestedWorkflowTemplateViews:D,isShowingMoreSuggestions:U})});const oe={key:"genericViews",render:e=>(0,O.jsx)(x().Z,{title:(0,O.jsx)(c()._H,{defaultMessage:"New view",id:"database.collectionTabBar.newViews"}),...e}),items:(D.length||H.length)&&K({numberOfSuggestedViews:te.length,isShowingMoreSuggestions:U})?[q,...te.slice(0,E),Q]:[q,...te]},ne={key:"form",render:e=>(0,O.jsx)(x().Z,{topBorder:!0,...e}),items:[{key:"formViewItem",action:()=>{},render:e=>(0,O.jsx)(g().Z,{collectionContextStore:t,onClose:o,focused:e.focused,isCompact:!1})}]};return(0,O.jsx)(S().Z,{capture:!0,allowEsc:!0,render:e=>{let t;return t=N.isPhone?{menuType:T().o.Modal,right:(0,O.jsx)(v().DoneMenuText,{}),onClickRight:o,...e}:{menuType:T().o.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...e},(0,O.jsx)(f().Z,{...t,children:(0,O.jsx)(h().Z,{type:h().i.Vertical,initialFocus:void 0,sections:[oe,...W&&!$?[ne]:[]],onAccept:e=>{"showMore"!==e.key&&o()}})})}})}},80159:(e,t,o)=>{o.d(t,{w:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("templates",{viewBox:"0 0 20 20",svg:(0,n.jsxs)("g",{children:[(0,n.jsx)("path",{d:"M6.39733 5.67853C5.89764 5.50234 5.36002 5.40649 4.8 5.40649C2.14904 5.40649 0 7.55432 0 10.2038C0 12.8533 2.14904 15.0011 4.8 15.0011C6.52165 15.0011 8.0316 14.0952 8.87867 12.7343L5.26487 12.0975L6.39733 5.67853Z"}),(0,n.jsx)("path",{d:"M17.3126 3.66609L7.85843 2L6.19141 11.4489L10.6545 12.2354L14.3998 5.81854L16.3449 9.15116L17.3126 3.66609Z"}),(0,n.jsx)("path",{d:"M8.80078 17L14.4008 7.4054L20.0008 17H8.80078Z"})]})})},535645:(e,t,o)=>{o.d(t,{N:()=>b,r:()=>k});o(821057),o(241792),o(667294);var n=()=>o(219727),i=()=>o(142735),l=()=>o(846550),r=()=>o(353329),s=()=>o(226413),c=()=>o(696459),a=()=>o(139224),d=()=>o(269299),p=()=>o(821159),u=()=>o(887430),m=()=>o(594546),g=()=>o(527278),w=()=>o(833186),S=()=>o(298032),f=()=>o(697360),h=()=>o(281236),v=()=>o(382474),x=()=>o(822909),C=()=>o(741119),y=()=>o(792329),T=()=>o(563452),I=()=>o(499819),V=o(785893);function b(e){let{environment:t,template:o,isInSuggestedSection:n,collectionContextStore:i}=e;return{key:o.templateId,action:()=>{if(n)k({environment:t,template:o,collectionContextStore:i,suggestedFeatureAnalytics:void 0});else{const{collectionStore:e,collectionViewStore:n,collectionSettingsStore:l}=(0,x().B)(i);(0,f().zY)({template:o,environment:t,collectionStore:e,collectionViewStore:n,collectionSettingsStore:l,collectionContextStore:i})}},render:e=>(0,V.jsx)(_,{buttonMenuItemProps:e,template:o,isInSuggestedSection:n})}}function k(e){let{environment:t,collectionContextStore:o,template:n,suggestedFeatureAnalytics:i}=e;const l=o.collectionStore();if(!l)throw new Error("collectionStore not found");const s=l.getWorkflowTemplateId();i&&(0,m().j)({environment:t,event:{eventName:"suggested_feature_template_clicked",eventProperties:{origin:i.origin,selected_index:i.selectedIndex,template_ids_shown:i.shownTemplateIds,template_id_clicked:n.templateId,collection_template_id:s}}});const c=o.settingsStore;if((0,y().isWorkflowTemplateWithConfirmStep)(n))a().H4({collectionSettingsStore:c,item:{type:"confirmAddTemplate",template:n}});else if((0,r().yw)(n)){const{relatedCollectionTemplateId:e}=n;!function(e){var t;let{environment:o,template:n,collectionStore:i,relatedCollectionTemplateId:l}=e;const r=null===(t=i.getParentBlockStore())||void 0===t?void 0:t.getParentStore();if(!r)throw new Error(`parentStore not found for ${i.id}`);if(!(0,h().isCollectionTemplateParentStore)(r))throw new Error(`Incorrect parent store: ${r.table} ${r.id}`);const s=h().globalWorkflowTemplates.fromIdOfType({templateId:l,type:"collection"});(0,w().openSelectedTemplateOnboardingModalForInAppFlows)({environment:o,template:s,origin:"suggested_feature_template",parentStore:r,navigateToOnFinish:"skip",relationInfos:[{type:"source",collectionStore:i,relationPropertyTemplate:n}],aiPrompt:void 0})}({environment:t,template:n,collectionStore:l,relatedCollectionTemplateId:e})}else d().createAndCommit({userAction:"FeatureTemplateMenuItem.addFeatureTemplateToTarget",environment:t,canUndo:!0,perform:e=>{S().rU({environment:t,transaction:e,collectionStore:l,template:n,logger:new(h().WorkflowTemplateLogger),origin:"suggested_feature"}),i&&(0,m().j)({environment:t,event:{eventName:"suggested_feature_template_added",eventProperties:{origin:i.origin,template_id_added:n.templateId,collection_template_id:s}}});const r=o.collectionViewStore();r&&f().zY({template:n,environment:t,collectionStore:l,collectionViewStore:r,collectionSettingsStore:c,collectionContextStore:o})}})}function _(e){let{buttonMenuItemProps:t,template:o,isInSuggestedSection:r}=e;const a=(0,l().yK)((e=>({iconContainer:{height:28,width:28,display:"flex",alignItems:"center",justifyContent:"center"},icon:{fill:e.regularIconColor}})),[]),{collectionStore:d}=(0,x().M)(),m=(0,n().O7)(),w=(0,i().VK)((()=>(0,v().w2)({environment:m,collectionStore:d,templateId:o.templateId})),[m,d,o.templateId]),S=(0,i().VK)((()=>function(e){let{template:t,collectionStore:o}=e;const{type:n}=t;switch(n){case"property":const{value:e}=t;if((0,s().t)(e)){const n=function(e){let{templateId:t,propertyTemplateSchema:o,collectionStore:n}=e;const i=(0,v().ZQ)({collectionStore:n,templateId:t,instancePointerType:"property"});if(!i)return o.options??[];const l=n.getSchema()[i.id];if(!l||!(0,s().t)(l))return[];return l.options??[]}({templateId:t.templateId,propertyTemplateSchema:e,collectionStore:o}).map((e=>e.value));return(0,h().getWorkflowTemplateItemsCaption)(n)}return;case"collection_view":return`${g().Z.formatMessage(u().b1[t.value.type])} view`;case"compound":return;default:(0,c().t1)(n)}}({template:o,collectionStore:d})),[o,d]),f=(0,h().getWorkflowTemplateName)(o);return r?(0,V.jsx)(p().Y,{buttonMenuItemProps:t,title:f,icon:(0,V.jsx)(I().$,{template:o}),right:(0,V.jsx)(T().a,{isAdded:w})}):(0,V.jsx)(p().Y,{buttonMenuItemProps:t,title:f,caption:S,icon:(0,V.jsx)("div",{style:a.iconContainer,children:(0,V.jsx)(I().l,{template:o,iconStyle:a.icon})}),right:(0,V.jsx)(C().K,{})})}},741119:(e,t,o)=>{o.d(t,{K:()=>r});o(667294);var n=()=>o(846550),i=()=>o(696347),l=o(785893);function r(){const e=(0,n().yK)((e=>({icon:{width:12,fill:e.lightIconColor,marginLeft:6,transition:"transform 200ms ease-in-out"}})),[]);return(0,l.jsx)(l.Fragment,{children:(0,i().o)(e.icon)})}},563452:(e,t,o)=>{o.d(t,{a:()=>s});o(667294);var n=()=>o(846550),i=()=>o(15409),l=()=>o(419273),r=o(785893);function s(e){let{isAdded:t}=e;const o=(0,n().yK)((e=>({circle:{height:24,width:24,borderRadius:50,display:"flex",alignItems:"center",justifyContent:"center",background:t?"dark"===e.mode?e.accentColors.blue[100]:e.accentColors.blue[50]:e.lightGrayButtonBackground},plusIcon:{height:15,width:15,fill:e.mediumIconColor},checkIcon:{height:12,width:12,fill:e.blueColor}})),[t]);return(0,r.jsx)("div",{style:o.circle,children:t?(0,i().e)(o.checkIcon):(0,l().f)(o.plusIcon)})}},932200:(e,t,o)=>{o.d(t,{Y:()=>f,j:()=>h});var n=()=>o(219727),i=()=>o(142735),l=()=>o(29488),r=()=>o(801812),s=()=>o(255933),c=()=>o(293307),a=()=>o(824462),d=()=>o(677559),p=()=>o(876822),u=()=>o(972776),m=()=>o(601952),g=()=>o(877727),w=()=>o(999582);const S=!1;function f(e){var t;const o=null===(t=(0,d().XJ)(c().iL).value)||void 0===t?void 0:t.loadWorkflowTemplateInstances;(0,i().VK)((()=>{if(!o)return;const t=e instanceof u().Z?e.collectionStore():e;t&&o(t)}),[o,e])}function h(){const e=(0,n().O7)(),t=(0,i().VK)((()=>{var e;if(function(){if(!(0,g().C3)({disableExposureLogging:!0}))return!1;const e=m().default.state.initialRenderCompleted;S&&!e&&console.log("Initial page render is not yet completed, delaying refresh of workflow template instances.");return e}())return null===(e=p().default.state.currentSpaceStore)||void 0===e?void 0:e.getSpaceId()}),[]);(0,r().r5)((async()=>{if(!t)return;(w().Z.debug||S)&&console.log("Refreshing workflow template instance map for space",t);const o={table:s().bx,id:t,spaceId:t},n=await a().callApi({eventName:"getWorkflowTemplateInstances",environment:e,data:{spaceId:o.spaceId,scopeTable:o.table,scopeId:o.id,enableInstanceRobustness:!0}});if("success"===n.type){const e=(0,l().O)(o);w().Z.setState({...w().Z.state,[e]:n.data.instanceMap[e]})}}),[e,t])}},925880:(e,t,o)=>{o.d(t,{c:()=>s});var n=()=>o(219727),i=()=>o(142735),l=()=>o(281236),r=()=>o(932200);function s(e){const t=(0,n().O7)();return(0,r().Y)(e),(0,i().VK)((()=>{const o=e.collectionStore();return o?(0,l().getSuggestedTemplates)(t,o):[]}),[t,e])}},182722:(e,t,o)=>{o.d(t,{J:()=>s});var n=o(667294),i=()=>o(219727),l=()=>o(142735),r=()=>o(594546);function s(e){let{collectionContextStore:t,shownTemplateIds:o,origin:s}=e;const c=(0,i().O7)(),a=(0,l().VK)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getWorkflowTemplateId()}),[t]),d=(0,n.useRef)(!1);(0,n.useEffect)((()=>{!d.current&&o.length>0&&((0,r().j)({environment:c,event:{eventName:"suggested_feature_templates_shown",eventProperties:{origin:s,collection_template_id:a,template_ids_shown:o}}}),d.current=!0)}))}},822909:(e,t,o)=>{o.d(t,{B:()=>s,M:()=>r});var n=()=>o(142735),i=()=>o(349220),l=()=>o(125659);function r(){const e=(0,l().Y$)(),{collectionStore:t,collectionViewStore:o,collectionSettingsStore:i}=(0,n().VK)((()=>s(e)),[e]);return{collectionStore:t,collectionViewStore:o,collectionSettingsStore:i,collectionContextStore:e}}function s(e){return{collectionStore:(0,i().TO)(e.collectionStore(),"collectionStore not found"),collectionViewStore:(0,i().TO)(e.collectionViewStore(),"collectionViewStore not found"),collectionSettingsStore:e.settingsStore}}},184441:(e,t,o)=>{o.d(t,{default:()=>l});class n extends(()=>o(263184))().default{getInitialState(){return{open:!1,isShowingLoadingState:!1}}updateUserCustomizations(e,t){this.state.open&&this.state.collectionTemplate&&this.setState({...this.state,userCustomizations:{...this.state.userCustomizations,[e]:t}})}updateCollectionTemplate(e){this.state.open&&this.state.collectionTemplate&&this.setState({...this.state,collectionTemplate:e})}updatePreviewCollectionViewTemplateId(e){this.state.open&&this.state.collectionTemplate&&this.setState({...this.state,previewCollectionViewTemplateId:e})}getParentStore(){return this.state.open?this.state.parentStore:void 0}getShouldShowExpandedTemplateList(){return this.state.open&&this.state.shouldShowExpandedTemplateList}setShouldShowExpandedTemplateList(e){this.state.open&&this.setState({...this.state,shouldShowExpandedTemplateList:e})}close(e){var t,o;this.state.open&&(null===(t=(o=this.state).onClose)||void 0===t||t.call(o,e),this.setState({open:!1,isShowingLoadingState:!1}))}reset(){this.setState(this.getInitialState())}}const i=new n;(0,o(947115).exposeDebugValue)("InitializeWorkflowTemplateModalStore",i);const l=i}}]);