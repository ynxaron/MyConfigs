"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[54843],{581356:(e,t,i)=>{i.d(t,{B:()=>s,H:()=>o});i(670560),i(267602),i(653476),i(228244);var n=()=>i(446866);function o(e){const{target:t,inviteTargetsStore:i}=e;return i.state.inviteTargets.some((e=>"newUser"===t.type?e.type===t.type&&t.value.email===e.value.email:"invalidUser"===t.type?e.type===t.type&&t.value.text===e.value.text:"group"===t.type?e.type===t.type&&e.value.group_id===t.value.group_id:e.type===t.type&&e.value.id===t.value.id))}function r(e){return"invalidUser"!==e.type}function s(e){const{inviteTargetsStore:t,includeInputFieldText:i}=e,s=[...t.state.inviteTargets];if(i){const e=function(e){const t=e.state.tokenQuery.trim();if(!(0,n().oH)(t))return;const i={type:"newUser",value:{email:t},source:"email"};return o({target:i,inviteTargetsStore:e})?void 0:i}(t);e&&s.push(e)}return s.filter(r)}},216697:(e,t,i)=>{i.d(t,{E:()=>s});var n=()=>i(799891),o=()=>i(792409),r=()=>i(123398);async function s(e){const{environment:t,onInviteComplete:i,onInviteClick:s,flowId:a,intl:l,spaceStore:c,inviteTargetsStore:u,inviteOrigin:d,onError:v}=e;let g={success:!1};try{const e=await r().sR.personPropertyInviteActions.load();g=await e.inviteToSpaceAsMembers({environment:t,spaceStore:c,from:d,flowId:a,intl:l,inviteTargetsStore:u,onInviteStart:()=>{null==s||s()}})}catch(p){null==v||v(p),n().log({level:"error",from:"contactsImportsInviteActions",type:"handleMemberInvite",error:(0,o().Ui)(p)})}finally{null==i||i(g)}}},336932:(e,t,i)=>{i.d(t,{x:()=>r});i(667294);var n=()=>i(788860),o=i(785893);function r(e){let{totalInviteCount:t}=e;return 0===t?(0,o.jsx)(n()._H,{id:"invite.contacts_imports.button.title.no_selected",defaultMessage:"Add members",values:{totalInviteCount:t}}):(0,o.jsx)(n()._H,{id:"invite.contacts_imports.button.title.selected",defaultMessage:"Add {totalInviteCount} {totalInviteCount, plural, one {member} other {members}}",values:{totalInviteCount:t}})}},648905:(e,t,i)=>{i.d(t,{K:()=>a});i(667294);var n=()=>i(846550),o=()=>i(568017),r=()=>i(15409),s=i(785893);function a(e){const{checked:t}=e,i=(0,n().yK)((e=>({circleCheckmark:{display:"flex",justifyContent:"center",alignItems:"center",width:18,height:18,borderRadius:"50%",borderStyle:"solid",borderWidth:1.75,borderColor:t?o().ZP.blue:e.buttonPressedBackground,backgroundColor:t?o().ZP.blue:"transparent"},checkIcon:{height:12,width:12,color:"white"}})),[t]);return(0,s.jsx)("div",{style:i.circleCheckmark,children:t&&(0,r().e)(i.checkIcon)})}},376429:(e,t,i)=>{i.d(t,{u:()=>a});i(667294);var n=()=>i(788860),o=()=>i(838367),r=()=>i(64131),s=i(785893);function a(e){let{isLoading:t}=e;return(0,s.jsx)(r().l,{loading:t,children:(0,s.jsx)(o().Z,{title:(0,s.jsx)(n()._H,{id:"contactsImportsInviteSearchRequest.searchInput.errorMessage",defaultMessage:"Something went wrong"})})})}},563946:(e,t,i)=>{i.r(t),i.d(t,{SlackImportsInviteWithModal:()=>D,shouldEnableSlackImportsInvite:()=>$});var n=i(667294),o=()=>i(219727),r=()=>i(142735),s=()=>i(846550),a=()=>i(714230),l=()=>i(788860),c=()=>i(832024),u=()=>i(643051),d=()=>i(923550),v=()=>i(602137),g=()=>i(876822),p=()=>i(257934),m=()=>i(815277),I=()=>i(842576),f=()=>i(188447);let y=function(e){return e.SearchInput="search_input",e.NoFocus="no_focus",e}({});class S extends(()=>i(263184))().default{getInitialState(){return{flowId:i(956057).Il(),modalOpen:!1,focus:y.NoFocus}}}const k=S;var h=()=>i(720866),x=()=>i(692304),_=(i(267602),i(653476),i(241792),i(785893));const C=function(e){const{slackImportsInviteStore:t,inviteTargetsStore:s,inviteOrigin:a,onInviteComplete:u,onInviteClick:d}=e,v=(0,o().O7)(),p=(0,l().YB)(),m=(0,I().M6)(),f=(0,r().VK)((()=>g().default.state.currentSpaceStore),[]),S=(0,r().VK)((()=>t.state.flowId),[t]),k=(0,r().VK)((()=>s.state.inviteTargets.length),[s]),x=(0,n.useCallback)((async e=>{const{response:n,invitedUserEmails:o}=e;c().u0(v,{invite_stage:"invite_complete",invite_flow_id:S,origin:a,is_success:n.success,invited_user_count:o.length}),n.success&&t.setState({...t.state,modalOpen:!1}),null==u||u(n.success,k);(await i(123398).sR.personPropertyInviteActions.load()).showMessageForInviteComplete({success:n.success,invitedUserEmails:o})}),[a,v,S,u,t,k]),C=(0,n.useCallback)((e=>{const t=(0,h().t)(e);c().u0(v,{invite_stage:"invite_member",invited_user_count:k,invite_flow_id:S,error:t,origin:a,is_success:!1})}),[v,S,a,k]),b=(0,n.useCallback)((async()=>{const e=s.state.inviteTargets.filter((e=>"newUser"===e.type||"existingUser"===e.type)).map((e=>e.value.email));if(!f)return null;await i(216697).E({environment:v,spaceStore:f,flowId:S,intl:p,inviteTargetsStore:s,inviteOrigin:a,onInviteComplete:t=>x({response:t,invitedUserEmails:e}),onInviteClick:d,onError:C}),s.reset()}),[f,v,S,s,p,a,d,x,C]),T=(0,n.useCallback)((async()=>{t.setState({...t.state,focus:y.NoFocus}),c().AK(v,{invited_user_count:k,origin:a,inviteTargets:s.state.inviteTargets.map((e=>e.type.toString())),inviteTokenQuery:s.state.tokenQuery,invite_flow_id:S}),await b()}),[b,v,S,a,t,s,k]);return(0,_.jsx)("div",{style:m.footerStyle,children:(0,_.jsx)(i(906651).Z,{isLarge:!0,style:{borderRadius:6},onClick:T,disabled:0===k,children:(0,_.jsx)(i(336932).x,{totalInviteCount:k})})})};var b=()=>i(67961);const T=function(e){const{isLoading:t}=e,n=(0,I().wg)(),o=t?(0,_.jsx)(i(312578).Z,{style:{marginLeft:6}}):null;return(0,_.jsxs)("div",{style:n.topContainer,children:[(0,_.jsx)(b().Z,{style:n.sendInviteLabel,children:(0,_.jsx)(l()._H,{id:"invite.slack_imports.header_title",defaultMessage:"Import from Slack"})}),o]})};var w=()=>i(930085),j=()=>i(122671);const L=function(e){const{inviteTargetsStore:t,slackImportsInviteStore:s,inviteOrigin:a}=e,c=(0,l().YB)(),u=(0,o().O7)(),{tokenQuery:d}=(0,r().VK)((()=>{const{tokenQuery:e}=t.state;return{tokenQuery:e}}),[t]),{focus:v,flowId:g}=(0,r().VK)((()=>({focus:s.state.focus===y.SearchInput,flowId:s.state.flowId})),[s]),p=(0,I().$w)({focus:v}),m=c.formatMessage({id:"invite.slack_imports.search.placeholder",defaultMessage:"Search people, emails..."}),f=(0,i(356140).W)(),S=(0,i(661769).nL)({spaceId:f}),k=(0,n.useCallback)((e=>{t.setState({...t.state,tokenQuery:e.target.value}),O({environment:u,flowId:g,billingData:S,origin:a})}),[t,g,a,u,S]);return(0,_.jsx)("div",{style:p.searchBar,children:(0,_.jsx)(j().ZP,{focus:v,onClick:()=>{s.setState({...s.state,focus:y.SearchInput})},format:j().UR.Share,value:d,onChange:k,type:"email",tokens:[],autoComplete:"off",placeholder:m,onRemoveLastToken:()=>{},showBorder:!0,style:p.tokenInputMenuItem,inputFullWidth:!0})})},O=i(513670).Ds((e=>{let{environment:t,flowId:i,billingData:n,origin:o}=e;w().UW(t,{invite_flow_id:i,billingData:n,invite_origin:o})}),1e3);var K=()=>i(801812),M=()=>i(849129),B=()=>i(827973),Z=()=>i(666414),A=()=>i(255577),U=()=>i(388284),F=()=>i(581356),R=()=>i(697623),z=()=>i(648905),V=()=>i(376429);function E(e){const{inviteTargetsStore:t,slackImportsInviteStore:i}=e,n=(0,o().O7)(),s=(0,l().YB)(),a=(0,r().VK)((()=>t.state.tokenQuery),[t]),c=(0,r().VK)((()=>i.state.flowId),[i]),[{value:u,status:d}]=(0,K().r5)((async()=>M().jL({query:a,sectionLimit:{userLimit:0,botLimit:0,groupLimit:0,importContactLimit:1e3},environment:n,intl:s,membersOnly:!1,importContactType:"slack"})),[n,s,a],{debounce:40});return(0,_.jsx)(P,{...e,tokenQuery:a,ready:"pending"!==d,error:"rejected"===d,result:u,flowId:c,environment:n})}function P(e){const{inviteTargetsStore:t,slackImportsInviteStore:i,tokenQuery:n,error:o,ready:s,result:a,inviteOrigin:u,flowId:d,environment:v}=e,g=(0,I().N2)(),p=(0,r().VK)((()=>(null==a?void 0:a.importedContacts)??[]),[a]),m=(0,r().qz)(e.menuListStore,x().Z),f={key:"select all",render:e=>(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(U().Z,{...e,style:g.selectAllSectionStyle}),(0,_.jsx)(Z().Z,{size:1,innerStyle:g.dividerInnerStyle,style:g.dividerStyle})]}),items:[{key:"select all item",render:e=>(0,_.jsx)(B().Z,{...e,title:(0,_.jsxs)("div",{style:g.selectAllStyle,children:[(0,_.jsx)(l()._H,{id:"invite.slack_imports.select_all.title",defaultMessage:"Select all"}),(0,_.jsx)(b().Z,{style:g.totalCountsStyle,isSmall:!0,children:`(${p.length})`})]}),right:(0,_.jsx)(z().K,{checked:(0,I().sM)({filteredImportedContacts:p,inviteTargetsStore:t})})}),action:()=>{!function(e){const{filteredImportedContacts:t,inviteTargetsStore:i,environment:n,origin:o,flowId:r,tokenQuery:s}=e;if(i.state.inviteTargets.length===t.length)return i.setState({...i.state,inviteTargets:[]}),void c().hc(n,{origin:o,invite_flow_id:r,invited_user_count:0,is_unselect:!0,invite_token_query:s});c().hc(n,{origin:o,invite_flow_id:r,invited_user_count:t.length,is_unselect:!1,invite_token_query:s}),i.setState({...i.state,inviteTargets:t})}({filteredImportedContacts:p,inviteTargetsStore:t,origin:u,flowId:d,environment:v,tokenQuery:n}),i.setState({...i.state,focus:y.NoFocus})}}]},S=(0,I().M_)({filteredImportedContacts:p}),k=Object.keys(S).sort(((e,t)=>"#"===e?1:"#"===t?-1:e.localeCompare(t))).map((e=>function(e){const{charKey:t,importedContacts:i,inviteTargetsStore:n,slackImportsInviteStore:o,menuListStore:r,style:s,tokenQuery:a,environment:c}=e,u={key:`imported contacts with ${t}`,render:e=>(0,_.jsx)(U().Z,{...e,style:s,title:(0,_.jsx)(l()._H,{id:"invite.slack_imports.grouped_section.title",defaultMessage:"{charKey}",values:{charKey:t}})}),items:i.sort(((e,t)=>(e.value.name||"").localeCompare(t.value.name||""))).map(((e,t)=>({key:e.value.email,render:t=>(0,_.jsx)(Q,{...t,invited:!1,inviteTarget:e,isInInviteTargets:F().H({target:e,inviteTargetsStore:n})}),action:()=>{F().H({target:e,inviteTargetsStore:n})?n.setState({...n.state,inviteTargets:n.state.inviteTargets.filter((t=>"newUser"!==t.type||e.value.email!==t.value.email))}):(w().hE(c,{invite_token_query:a,selected_user_token:e,selected_user_token_rank:t,from:"slack_imports_space_setting",subscription_tier:(0,R().zt)(),type:"slack"}),o.setState({...o.state,focus:y.NoFocus}),n.setState({...n.state,inviteTargets:[...n.state.inviteTargets,e]}),r.unsetFocus())}})))};return u}({charKey:e,importedContacts:S[e],inviteTargetsStore:t,slackImportsInviteStore:i,menuListStore:m,style:g.sectionMenuItem,tokenQuery:n,environment:v})));return o?(0,_.jsx)(V().u,{isLoading:!s}):(0,_.jsx)(A().Z,{type:A().i.Vertical,initialFocus:n.length>0?0:void 0,sections:[f,...k],store:m})}const Q=n.forwardRef((function(e,t){const{inviteTarget:i}=e;return(0,_.jsx)(H,{...e,ref:t,inviteTarget:i})})),H=n.forwardRef((function(e,t){const{inviteTarget:o,isInInviteTargets:r,...l}=e,c=(0,s().yK)((()=>({cellMemberAvatarContainer:{paddingTop:8,paddingBottom:8},iconBox:{position:"absolute",bottom:-3,right:-3},iconBoxImage:{background:"white",padding:2,borderRadius:"100%"}})),[]),d=(0,n.useMemo)((()=>({actorStore:void 0,avatar:{email:o.value.email,name:"slack"===o.source?o.value.name:void 0,avatarUrl:"slack"===o.source?o.value.avatar_url:void 0}})),[o]);return(0,_.jsx)(B().Z,{...l,ref:t,title:(0,_.jsx)(i(421736).Z,{isLarge:!0,...d,containerStyle:c.cellMemberAvatarContainer,avatarBadge:(0,_.jsx)(u().Z,{type:"image_url",imageURL:a().Z.images.externalIntegrations.slackIconPng,size:18,style:c.iconBox,imageStyle:c.iconBoxImage})}),right:(0,_.jsx)(z().K,{checked:r})})}));const q=function(e){const{inviteTargetsStore:t,slackImportsInviteStore:s,inviteOrigin:a,onInviteComplete:l,onInviteClick:u}=e,d=(0,o().O7)(),[v,p]=(0,n.useState)(!1),m=(0,r().Kw)(i(138912).default.completeSlackAuthentications),I=(0,r().VK)((()=>g().default.state.currentSpaceStore),[]),f=(0,r().VK)((()=>s.state.flowId),[s]),y=(0,r().qz)(void 0,x().Z);(0,n.useEffect)((()=>{c().e8(d,{invite_flow_id:s.state.flowId,origin:a}),async function(){if(I&&!v){for(const e of m)await i(824462).callApi({eventName:"loadContacts",environment:d,data:{botId:e.id,spaceId:I.id,integrationId:i(235484).nO,importContactType:"slack"}}).catch((e=>{const t=(0,h().t)(e);c().u0(d,{invite_stage:"load_slack_contacts",invited_user_count:0,invite_flow_id:f,error:t,origin:a,is_success:!1}),i(799891).log({level:"error",from:"SlackImportsInvite",type:"loadSlackContacts",error:(0,i(792409).Ui)(e)})}));p(!0)}}()}),[I,m,d,v,a,s,f]);const S=function(e){let{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,isLoading:o}=e;return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(T,{isLoading:o}),(0,_.jsx)(L,{inviteTargetsStore:i,slackImportsInviteStore:t,inviteOrigin:n})]})}({inviteTargetsStore:t,slackImportsInviteStore:s,inviteOrigin:a,isLoading:!v}),k=function(e){let{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:o,onInviteClick:r}=e;return(0,_.jsx)(C,{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:o,onInviteClick:r})}({slackImportsInviteStore:s,inviteTargetsStore:t,inviteOrigin:a,onInviteComplete:l,onInviteClick:u}),b=function(e){let{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,menuListStore:o,isLoading:r}=e;if(r)return null;return(0,_.jsx)(E,{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,menuListStore:o})}({slackImportsInviteStore:s,inviteTargetsStore:t,inviteOrigin:a,menuListStore:y,isLoading:!v}),w={menuType:i(352230).o.Popup,width:480,height:"60vh",header:S,footer:k,tokenInputHeader:!1,disableScroller:!1};return(0,_.jsx)(i(198829).Z,{...w,className:i(247724).FJA,children:(0,_.jsx)("div",{children:b})})};function D(e){const t=(0,o().O7)(),{inviteOrigin:i,canEditPermission:s,onInviteComplete:a,onInviteClick:l,buttonLabel:u,buttonStyle:y,buttonContainerStyle:S}=e,{isMobile:h}=(0,o().Fy)(),x=(0,I().Tr)(y,S),C=(0,r().qz)(void 0,k),b=(0,r().qz)(void 0,p().ZP),{modalOpen:T,flowId:w}=(0,r().Kw)(C),{userId:j,spaceId:L}=(0,r().VK)((()=>{var e,t;return{userId:null===(e=g().default.state.currentUserStore)||void 0===e?void 0:e.id,spaceId:null===(t=g().default.state.currentSpaceStore)||void 0===t?void 0:t.id}}),[]),O=(0,n.useCallback)((()=>{!function(e){e.reset()}(C),c().Td(t,{origin:i,invite_flow_id:w})}),[C,i,t,w]),K=(0,n.useCallback)((()=>function(e){const{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:o,onInviteClick:r}=e;return(0,_.jsx)(q,{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:o,onInviteClick:r})}({inviteTargetsStore:b,slackImportsInviteStore:C,inviteOrigin:i,onInviteComplete:a,onInviteClick:l})),[b,C,i,l,a]),M=(0,m().VX)({name:"slack_imports_invite",spaceId:L,userId:j});return(0,r().VK)((()=>{const e=$({canEditPermission:s,isMobile:h,hasAccessToFeature:M});return e&&(0,f().e)({environment:t,flowId:w,origin:i,type:"slack"}),e}),[s,h,t,w,i,M])?(0,_.jsx)(d().Z,{open:T,onDismiss:O,renderContent:K,origin:(0,_.jsx)(v().hF,{onClickAuthenticated:()=>{!function(e){e.setState({...e.state,modalOpen:!0})}(C)},title:u??(0,_.jsx)(N,{}),hideChevronIcon:!0,containerStyle:x.buttonContainer,buttonStyle:x.button,from:"space_settings",inviteOrigin:i,loadContacts:!1})}):null}function N(){const e=(0,s().yK)((e=>({slackTitle:{display:"flex",fontSize:14,color:e.text.primary},integrationIcon:{marginRight:4}})),[]);return(0,_.jsxs)("div",{style:e.slackTitle,children:[(0,_.jsx)(u().Z,{type:"image_url",imageURL:a().Z.images.externalIntegrations.slackIconPng,size:16,imageStyle:e.integrationIcon}),(0,_.jsx)(l()._H,{defaultMessage:"Import from Slack",id:"invite.slack_imports.button.label"})]})}function $(e){const{canEditPermission:t,isMobile:i,hasAccessToFeature:n}=e;return!(i||n||!t)}},842576:(e,t,i)=>{i.d(t,{$w:()=>s,M6:()=>l,M_:()=>g,N2:()=>a,Tr:()=>d,ph:()=>c,sM:()=>v,wg:()=>u});i(670560),i(267602),i(30005);var n=()=>i(846550),o=()=>i(568017),r=()=>i(707513);function s(e){const{focus:t}=e;return(0,n().yK)((e=>({searchBar:{padding:16},inputStyle:{minWidth:60,width:"auto",borderTopLeftRadius:4,borderTopRightRadius:4,fontSize:14,fontWeight:r().Ue.regular},tokenInputMenuItem:{padding:6,borderRadius:6,height:20,alignItems:"center",minHeight:32,background:e.accentColors.gray[30],...t&&{background:"none"}}})),[t])}function a(){return(0,n().yK)((e=>({selectAllSectionStyle:{display:"flex",flexDirection:"column",gap:2,padding:"8px 0px 16px 0px"},sectionMenuItem:{padding:"12px 0px 0px 2px",display:"flex",flexDirection:"column",gap:2},dividerStyle:{margin:"0px 16px"},dividerInnerStyle:{borderBottom:`1px solid ${e.stroke.secondary}`},selectAllStyle:{display:"flex",fontSize:14,color:e.text.primary},totalCountsStyle:{paddingLeft:3,fontSize:14,color:e.text.tertiary}})),[])}function l(){return(0,n().yK)((e=>({footerStyle:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:60,padding:"12px 16px 16px 16px",borderTop:`1px solid ${e.stroke.secondary}`}})),[])}function c(){return(0,n().yK)((e=>({labelContainer:{display:"flex",alignItems:"center",color:o().ZP.uiLightBlack,size:14,gap:6},importListButton:{height:28,borderRadius:4,border:void 0,width:"100%"},importListButtonContainer:{padding:"0 6px",alignItems:"center"}})),[])}function u(){return(0,n().yK)((e=>({topContainer:{display:"flex",alignItems:"center",width:"100%",height:40,padding:"0 16px",borderBottom:`1px solid ${e.stroke.secondary}`},sendInviteLabel:{color:e.text.primary,fontSize:14,fontWeight:r().Ue.medium,textAlign:"left",verticalAlign:"top"}})),[])}function d(e,t){return(0,n().yK)((i=>({buttonContainer:{padding:"0 8px",...t},button:{height:32,borderRadius:4,border:`1px solid ${i.stroke.primary}`,...e}})),[e,t])}function v(e){const{filteredImportedContacts:t,inviteTargetsStore:i}=e,n=i.state.inviteTargets.length;return 0!==n&&n===t.length}function g(e){const{filteredImportedContacts:t}=e,i={};return t.forEach(((e,t)=>{const n=e.value.email[0].toUpperCase(),o=/^[A-Za-z]$/.test(n)?n:"#";i[o]||(i[o]=[]),i[o].push(e)})),i}},188447:(e,t,i)=>{i.d(t,{e:()=>n});const n=i(513670).Ds((e=>{let{environment:t,flowId:n,origin:o,type:r}=e;switch(r){case"slack":i(832024).gV(t,{origin:o,invite_flow_id:n});break;case"google":break;default:(0,i(696459).t1)(r)}}),2e3)},602137:(e,t,i)=>{i.d(t,{hF:()=>r,oI:()=>s});var n=()=>i(677559);const o={SlackImportContactsButton:new(n().Ss)("SlackImportContactsButton",(()=>i.e(45379).then(i.bind(i,221937)))),GoogleImportContactsButton:new(n().Ss)("GoogleImportContactsButton",(()=>i.e(24149).then(i.bind(i,81223))))},r=(0,n().kF)(o.SlackImportContactsButton,(e=>e.default)),s=(0,n().kF)(o.GoogleImportContactsButton,(e=>e.GoogleImportContactsButton))}}]);