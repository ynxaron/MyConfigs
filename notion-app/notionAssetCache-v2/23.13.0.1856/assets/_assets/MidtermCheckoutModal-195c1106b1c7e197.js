"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[78275],{728779:(e,t,i)=>{i.d(t,{Z:()=>r,i:()=>n});class a extends(()=>i(263184))().default{getInitialState(){return{billingEventsLimit:20,billingEvents:[]}}}const n=new a,r=a},464888:(e,t,i)=>{i.d(t,{R:()=>l});i(667294);var a=()=>i(846550),n=()=>i(212493),r=()=>i(830581),s=()=>i(661641),o=i(785893);function l(e){let{primaryButtons:t,secondaryButtons:i,termsOfService:l,error:d,textAlign:u="left"}=e;const c=(0,a().yK)((e=>({errorText:{color:e.text.uiRedPrimary,textAlign:u}})),[u]);return(0,o.jsx)(r().a6,{primaryButtons:t,secondaryButtons:i,caption:(0,o.jsxs)(n().jX,{gap:16,children:[(0,o.jsx)(s().q,{styleName:"Caption-12px/Regular",colorName:"secondary",style:{textAlign:u},children:l}),d?(0,o.jsx)("span",{style:c.errorText,children:d}):null]}),layout:"vertical",sectionGap:16})}},251054:(e,t,i)=>{i.d(t,{M:()=>s});i(667294);var a=()=>i(212493),n=()=>i(661641),r=i(785893);function s(e){const{title:t,subtitle:i,image:s}=e;return(0,r.jsxs)(a().jX,{gap:8,align:"top-left",children:[s,(0,r.jsxs)(a().jX,{gap:4,children:[(0,r.jsx)(n().q,{styleName:i?"Title-22px/Bold":"Title-Large-26px/Bold",children:t}),i?(0,r.jsx)(n().q,{styleName:"Heading-17px/Regular",colorName:"secondary",children:i}):null]})]})}},346191:(e,t,i)=>{i.r(t),i.d(t,{MidtermCheckoutModal:()=>de});var a=i(667294),n=()=>i(219727),r=()=>i(142735),s=()=>i(629719),o=()=>i(921981),l=()=>i(247724),d=()=>i(661769),u=()=>i(897257),c=()=>i(28886),m=(i(267602),i(653476),i(241792),()=>i(846550)),p=()=>i(714230),g=()=>i(383802),x=()=>i(323926),h=()=>i(948505),y=()=>i(788860),b=()=>i(513670),f=()=>i(696459),v=()=>i(785673),j=()=>i(212493),S=()=>i(666414),I=()=>i(518242),w=()=>i(661641),M=()=>i(916095),D=()=>i(768064),T=()=>i(575154),B=()=>i(339538),E=()=>i(565577),L=()=>i(669861),P=()=>i(251054),_=()=>i(875120),U=()=>i(647803),q=()=>i(242645),k=()=>i(214293),C=i(785893);function H(e){let{billingData:t}=e;const i=t.address&&_().A(t.address);return(0,C.jsxs)(j().jX,{direction:"row",gap:24,children:[i?(0,C.jsx)(U().x,{gap:4,label:(0,C.jsx)(y()._H,{id:"subscriptionUpdateModal.billedTo",defaultMessage:"Billed to"}),children:(0,C.jsx)(w().q,{styleName:"UIRegular-14px/Regular",colorName:"primary",children:(0,C.jsx)(k().l,{layout:"full",address:t.address})})}):null,(0,C.jsx)(U().x,{gap:4,label:(0,C.jsx)(y()._H,{id:"subscriptionUpdateModal.paymentDetails",defaultMessage:"Payment details"}),children:(0,C.jsx)(q().X,{paymentMethod:t.paymentMethod})})]})}i(470928),i(731107);var A=()=>i(146947),N=()=>i(646574),X=()=>i(976102),Z=()=>i(681941),z=()=>i(824462),O=()=>i(728779),R=()=>i(576387),V=()=>i(30795);function K(e){let{environment:t,currencyValue:i,address:n,lineItems:r,taxableAmount:s,billingData:o}=e;const[l,d]=(0,a.useState)(0),[u,c]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{!async function(){if(!n||0===r.length||0===s.amount)return;c(!0);const e=await(0,D().km)({environment:t,taxableAmount:s,lineItems:r,address:n,billingData:o});d(e??0),c(!1)}()}),[t,s,r,n,o]),{tax:new(h().n)(i,l),isLoading:u}}var W=()=>i(799891),Y=()=>i(979614),Q=()=>i(587510),F=()=>i(498854),G=()=>i(38812),$=()=>i(939985),J=()=>i(464888);function ee(e){let{desiredState:t,subscription:i,spaceStore:r,showTrialEndDisclaimer:o,modalId:l,primaryButtonText:d}=e;const u=(0,n().O7)(),m=(0,y().YB)(),[p,g]=a.useState(void 0),[x,h]=a.useState(!1);return(0,C.jsx)(J().R,{textAlign:"center",primaryButtons:[{buttonType:"primary",label:d??(0,C.jsx)(y()._H,{id:"subscriptionUpdateModal.confirmationButton",defaultMessage:"Confirm changes"}),onClick:async()=>{Y().nd(u,{state:{modalId:l}}),h(!0);const e=await(0,G().getStripe)();if(!e)return(0,W().log)({level:"error",from:"MidtermCheckoutModal",type:"StripeError",error:{miscDataString:"Stripe elements not initialized when user tried to upgrade"}}),g(m.formatMessage({id:"spaceSubscriptionUpgradeModal.stripeNotLoaded",defaultMessage:"We could not reach our payment processor. Please reload the page or try again later."})),void h(!1);if((0,Q().Pz)({environment:u,currentState:i,desiredState:t})){if(!(await(0,$().D)(u)))return void h(!1)}const a=await async function(e){let{environment:t,spaceStore:i,desiredState:a,stripe:n,coupon:r,intl:s}=e;try{const e=await R().Mg({environment:t,from:"midterm_checkout_modal",spaceStore:i,desiredState:a,inAppOffer:r});await R().KD({paymentIntentData:e,stripe:n,onSuccess:()=>{(0,R().zb)(t,O().i)}})}catch{return{error:s.formatMessage({id:"spaceSubscriptionUpgradeModal.payment.genericError",defaultMessage:"Your payment could not be processed. Please try again."})}}}({environment:u,spaceStore:r,desiredState:t,stripe:e,intl:m});if(null!=a&&a.error)return g(a.error),void h(!1);(0,c().z)(u,l)},baseStyleOverride:{borderRadius:8},isDisabled:x,isLoading:x}],termsOfService:(0,C.jsx)(F().E,{products:(0,s().Xp)(t),showTrialEndDisclaimer:o}),error:p})}var te=()=>i(668001),ie=()=>i(632752),ae=()=>i(702548),ne=()=>i(720343);function re(e){let{immediate:t,recurring:i,nextBillingDate:r,accountBalance:s,items:o,chargeType:l={chargeType:"immediate"},modalId:d}=e;const u=(0,n().O7)(),[c,p]=(0,a.useState)(!1),x=(0,m().yK)((e=>({summaryContainer:{background:e.surface.wash,padding:16,borderRadius:8}})),[]),b=t.subtotal.plus(t.tax),f=new(h().n)(g().X[i.subtotal.currencyCode],0),v=(0,L().c)({subtotal:i.subtotal,discount:f,balance:s},i.tax),I=0!==v.amount&&0!==b.amount&&v.amount!==b.amount,[M,D,T]="immediate"===l.chargeType?[b,t.subtotal,t.tax]:[v,i.subtotal,i.tax];return(0,C.jsxs)(j().jX,{gap:8,children:[(0,C.jsx)(ne().Mq,{useNewStyle:!0,isTotalLoading:t.isLoading,total:M,handleToggleExpanded:()=>{c?Y().k1(u,{state:{modalId:d}}):Y().y$(u,{state:{modalId:d}}),p(!c)},isExpanded:c,discount:f,accountBalance:s,subtitle:"immediate"===l.chargeType?(0,C.jsx)(se,{recurringTotal:v,periodEnd:r,isNextBillDifferent:I,isLoading:i.isLoading||t.isLoading}):null,...l}),(0,C.jsx)(ne().MA,{isExpanded:c,children:(0,C.jsxs)(j().jX,{gap:8,style:x.summaryContainer,children:[I?(0,C.jsx)(w().q,{styleName:"UISmall-12px/Medium",colorName:"secondary",children:(0,C.jsx)(y()._H,{id:"checkout.orderSummary.title",defaultMessage:"Prorated charge"})}):null,(0,C.jsxs)(j().jX,{gap:12,children:[(0,C.jsx)(ne().tQ,{items:o,showMonthlyPricing:!1}),(0,C.jsx)(S().Z,{size:1}),(0,C.jsx)(ne().J0,{subtotal:D,subtotalText:I?(0,C.jsx)(y()._H,{id:"checkout.orderSummary.subtotalProrated",defaultMessage:"Subtotal (prorated)"}):void 0,discount:f,showDiscountLine:!1,accountBalance:s,tax:T})]})]})})]})}function se(e){let{recurringTotal:t,periodEnd:i,isLoading:a,isNextBillDifferent:n}=e;return a?(0,C.jsx)(te().Z,{style:{width:180,height:16,borderRadius:4}}):n?(0,C.jsxs)(j().jX,{direction:"row",gap:4,align:"center-left",children:[(0,C.jsx)(y()._H,{id:"checkout.orderSummary.estimatedBill",defaultMessage:"Estimated next bill: {price}",values:{price:(0,C.jsx)(ae().W,{cost:t,trailingZeroDisplay:"stripIfInteger"})}}),(0,C.jsx)(ie().p,{tooltipTitle:(0,C.jsx)(y()._H,{id:"checkout.orderSummary.estimatedBillTooltip",defaultMessage:"This is an estimate of your next charge on {date}. If you add/remove members, this amount might change",values:{date:(0,N().ZW)({value:i,preset:"medium",locale:A().locale})}}),tooltipDescription:(0,C.jsx)(y()._H,{id:"checkout.orderSummary.estimatedBillTooltipDescription",defaultMessage:"Click to learn more about billing"}),buttonProps:{href:"https://www.notion.com/help/billing-and-payment-info",external:!0},tooltipWidth:240})]}):null}function oe(e){let{desiredProducts:t,desiredInterval:i,billingData:o,subscription:l,subscriptionData:d,spaceStore:u,modalId:c,prices:_}=e;const U=(0,n().O7)(),q=(0,m().yK)((()=>({headerImage:{width:49,height:52}})),[]),k=(0,m().Fg)(),O=(0,s().bs)(l)??"USD",R=g().X[O],W=(0,E().Et)(o,O),{desiredState:Y,quantities:Q,newItems:F}=function(e){let{desiredProducts:t,desiredInterval:i,billingData:n,subscriptionData:r,prices:o}=e;const l=(0,s().bs)(n.subscription)??"USD",d=(0,a.useMemo)((()=>(0,s().Lg)(n)),[n]),u=(0,V().V)(r),c=(0,a.useMemo)((()=>{var e;return{numSeats:u,numCustomHostnames:(null===(e=(0,s().a7)(n.subscription,"sites_custom_hostnames"))||void 0===e?void 0:e.quantity)??0}}),[n.subscription,u]),m=(0,a.useMemo)((()=>{const e=(0,b().oA)(t.map((e=>o.find((t=>t.product===e&&t.billingInterval===i)))));return 0===e.length?[]:(0,Z().Vj)({prices:e,quantity:c.numSeats,domainsQuantity:c.numCustomHostnames})}),[i,t,o,c]),p=(0,a.useMemo)((()=>t.reduce(((e,t)=>(0,X().dP)(m,e,{interval:i,currency:l,product:t})),d)),[t,d,m,i,l]),g=(0,a.useMemo)((()=>(0,b().mz)(p.items,d.items,"price.externalId")),[p.items,d]);return{desiredState:p,quantities:c,newItems:g}}({desiredProducts:t,desiredInterval:i,billingData:o,subscriptionData:d,prices:_}),G=(0,a.useMemo)((()=>function(e,t){return((null==t?void 0:t.items)??[]).reduce(((e,t)=>{const i=(0,s().uD)(t.price);return e.plus(i.getCostPerBillingInterval({quantity:t.quantity}))}),new(h().n)(e,0))}(R,Y)),[R,Y]),$=(0,a.useMemo)((()=>Y.items.map(D().zW).filter(f().$K)),[Y.items]),{tax:J,isLoading:te}=K({environment:U,currencyValue:R,address:o.address,lineItems:$,taxableAmount:G,billingData:o}),{subtotal:ie,lineItems:ae,isLoading:ne}=function(e){const{spaceStore:t,quantities:i,desiredState:s,currencyValue:o}=e,l=(0,r().VK)((()=>t.id),[t]),d=(0,n().O7)(),[u,c]=(0,a.useState)(),[m,p]=(0,a.useState)(),[g,x]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{!async function(){var e;x(!0);const t=await z().callApi({eventName:"getImmediateUpdateCost",environment:d,data:{spaceId:l,quantities:i,desiredState:{items:(null==s?void 0:s.items.map((e=>({id:e.id,quantity:e.quantity,priceData:{external_id:e.price.externalId,product:e.price.product,billing_interval:e.price.billingInterval,currency:e.price.unitAmount.currencyCode,unit_amount:e.price.unitAmount.amount,state:e.price.state}}))))||[],trialEnd:null===(e=s.trialEnd)||void 0===e?void 0:e.toString()}}});x(!1),"success"===t.type&&(c(h().n.fromValue(t.data.total)),p(t.data.lineItems))}()}),[d,null==s?void 0:s.items,i,l,null==s?void 0:s.trialEnd]),{subtotal:u??new(h().n)(o,0),lineItems:m,isLoading:g}}({spaceStore:u,quantities:Q,desiredState:Y,currencyValue:R}),se=(0,a.useMemo)((()=>ae&&(0,f().Of)(ae)?ae.map((e=>(0,D().yA)({line:e}))):[]),[ae]),{tax:oe,isLoading:le}=K({environment:U,currencyValue:R,address:o.address,lineItems:se,taxableAmount:ie??new(h().n)(R,0),billingData:o}),de=(0,x().Y1)(_,o,Y,Q,{}),ue=(0,s().FG)(l)&&"reset_and_invoice"===de.type,ce=function(e){let{change:t,interval:i,currentPeriodEnd:a,now:n}=e;return(0,x().Uy)(t)&&i?n.plus({months:"month"===i?1:12}):a}({change:de,interval:(0,s().Hw)(Y),currentPeriodEnd:l.currentPeriodEnd,now:o.clock.now}),me=(0,a.useMemo)((()=>(0,B().ig)(o)?(0,b().mz)(de.immediate.items,l.items,"price.externalId"):F),[o,de.immediate.items,l.items,F]),pe=t[0],ge=!(0,B().ig)(o)&&i!==(0,s().Hw)(l),xe=ge?function(e){let{interval:t,effectiveDate:i}=e;return{title:(0,C.jsx)(y()._H,{id:"midtermIntervalChange.title",defaultMessage:"Switch to {interval, select, month {monthly} other {annual}} billing",values:{interval:t}}),subtitle:i?(0,C.jsx)(y()._H,{id:"midtermIntervalChange.subtitle.nextPeriod",defaultMessage:"Effective {periodEnd}",values:{periodEnd:(0,N().ZW)({value:i,preset:"medium",locale:A().locale})}}):(0,C.jsx)(y()._H,{id:"spaceSubscriptionUpgradeModal.effectiveToday.header",defaultMessage:"Effective today"})}}({interval:i,effectiveDate:(0,x().sY)(de)?void 0:ce}):(0,L().We)({product:pe});return(0,C.jsxs)(j().jX,{gap:28,padding:"28px 32px",children:[(0,C.jsx)(P().M,{...xe,title:(0,C.jsx)(w().q,{styleName:"Title-Large-26px/Bold",colorName:"primary",children:xe.title}),image:ge?(0,C.jsx)(I().ZP,{src:"light"===k.mode?p().Z.images.pricing.light.changeBillingPeriodPng:p().Z.images.pricing.dark.changeBillingPeriodPng,style:q.headerImage}):"ai"===pe?(0,C.jsx)(v().fy,{variant:"medium",style:{}}):(0,C.jsx)(T().q,{product:pe})}),(0,C.jsx)(H,{billingData:o}),(0,C.jsxs)(j().jX,{gap:20,children:[(0,C.jsx)(S().Z,{size:1}),(0,C.jsx)(re,{immediate:{subtotal:ie,tax:oe,isLoading:le||ne},recurring:{subtotal:G,tax:J,isLoading:te},nextBillingDate:ce,accountBalance:W,items:me,chargeType:(0,x().sY)(de)?{chargeType:"immediate"}:{chargeType:"nextPeriod",periodEnd:ce},modalId:c}),(0,C.jsx)(ee,{desiredState:Y,subscription:l,spaceStore:u,showTrialEndDisclaimer:ue,modalId:c,primaryButtonText:ge?void 0:(0,C.jsx)(y()._H,{id:"subscriptionUpgradeModal.upgradeButton.upgradeAi",defaultMessage:"Upgrade now"})})]}),(0,C.jsx)(M().U4,{style:{top:16,right:16}})]})}var le=()=>i(563460);function de(e){let{spaceStore:t}=e;const i=(0,n().O7)(),a=(0,d().pQ)({spaceId:t.id}),m=(0,d().h1)(),p=(0,r().Kw)(u().subscriptionDataStoreInstance),g=(0,r().VK)((()=>le().Z.state),[]);if(!(a&&a.subscription&&g.open&&p&&0!==m.length))return null;const x=a.subscription,h=(0,s().Lg)(a),y=g.desiredProducts??(0,s().Xp)(h),b=g.desiredInterval??(0,s().Hw)(h)??(0,s().Hw)(x)??"month";return(0,C.jsx)(o().c,{ariaLabelledBy:l().BaY,isOpen:!0,onDismiss:()=>(0,c().z)(i,g.modalId),animateSizeTransition:!1,areaConstraint:{width:{type:"min",length:480},height:{type:"unlimited",scroll:"allow"}},render:()=>(0,C.jsx)(oe,{desiredProducts:y,desiredInterval:b,billingData:a,subscription:x,subscriptionData:p,spaceStore:t,modalId:g.modalId,prices:m})})}},575154:(e,t,i)=>{i.d(t,{q:()=>s});i(667294);var a=()=>i(518242),n=()=>i(759251),r=i(785893);function s(e){const{product:t}=e,i=function(e){switch(e){case"free":case"student":case"personal":return n().LU.free.originalImage;case"plus":return n().LU.plus.originalImage;case"business":return n().LU.business.originalImage;case"enterprise":return n().LU.enterprise.originalImage;case"ai":return n().LU.ai.originalImage;case"sites_custom_hostnames":return n().LU.sites_custom_hostnames.originalImage;default:return}}(t);return i?(0,r.jsx)(a().ZP,{src:i.path,style:{width:49,height:52}}):null}}}]);