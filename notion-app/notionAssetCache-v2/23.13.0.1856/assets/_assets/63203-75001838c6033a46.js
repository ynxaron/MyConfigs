"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[63203],{166312:(e,t,a)=>{a.d(t,{De:()=>f,HH:()=>y,WP:()=>p,dF:()=>g,mq:()=>d,wo:()=>u,z$:()=>m});a(670560);var i=()=>a(730120),n=(a(667294),()=>a(157955)),l=()=>a(874459),r=()=>a(788860),o=()=>a(696459),s=()=>a(239482),c=a(785893);const d=[{frequency:"day",interval:1},{frequency:"week",interval:1},{frequency:"month",interval:1},{frequency:"year",interval:1}];function u(e){const t=s().eG(e)??[],a=[];for(const i of t){if(!("block"===i.table&&!0===i.isTemplate()&&i.getFormat().automation_id&&i.id!==e.id))continue;const t=i.getAutomationStore();if(t){if(!t.isReady())return{automationStoresReady:!1};void 0!==t.getRecurrence()&&t.isDefined()&&a.push(t.getModel())}}return{automationStoresReady:!0,...(0,n().templateAncestorsViolateRecurrenceNesting)(a)}}function m(e){switch(e){case"day":return(0,c.jsx)(r()._H,{defaultMessage:"Repeat daily",id:"database.templatePickerItem.recurrenceFrequency.daily"});case"week":return(0,c.jsx)(r()._H,{defaultMessage:"Repeat weekly",id:"database.templatePickerItem.recurrenceFrequency.weekly"});case"month":return(0,c.jsx)(r()._H,{defaultMessage:"Repeat monthly",id:"database.templatePickerItem.recurrenceFrequency.monthly"});case"year":return(0,c.jsx)(r()._H,{defaultMessage:"Repeat yearly",id:"database.templatePickerItem.recurrenceFrequency.yearly"});default:(0,o().t1)(e)}}function p(e,t){const a="week"!==t||void 0!==e.weekdays&&0!==e.weekdays.length?e.weekdays:[(l=e.start_date,(0,o().Yd)(n().RRULE_WEEKDAYS_MAP)[i().ou.fromMillis(l).weekday-1])];var l;return{...e,weekdays:a,frequency:t}}function g(){return{start_date:i().ou.local().plus({days:1}).set({hour:0,minute:0,second:0,millisecond:0}).toMillis(),timezone:(0,l().Sv)(),hour:0,minute:0,frequency:"day",interval:1}}function f(e){const{recurrence:t,intl:a,leadingPhrase:i}=e;return(0,n().rruleFromRecurrence)({..."month"===t.frequency?{...t,monthly_restriction:void 0}:t,weekdays:void 0,hour:0,minute:0,end_condition:void 0}).toText((e=>{switch(e){case"every":if(void 0===i)return"";if("every"===i)return a.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.every",defaultMessage:"every"});if("repeat every"===i)return a.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.repeatEvery",defaultMessage:"repeat every"});(0,o().t1)(i);break;case"day":return a.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.day",defaultMessage:"day"});case"days":return a.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.days",defaultMessage:"days"});case"week":return a.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.week",defaultMessage:"week"});case"weeks":return a.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.weeks",defaultMessage:"weeks"});case"month":return a.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.month",defaultMessage:"month"});case"months":return a.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.months",defaultMessage:"months"});case"year":return a.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.year",defaultMessage:"year"});case"years":return a.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.years",defaultMessage:"years"});default:return e.toString()}})).trim()}function y(e){const t=e.getRecurrence();return Boolean(e.isTriggerType("recurrence")&&t&&"disabled_recurrence_ended"===e.getStatus())}},39607:(e,t,a)=>{a.d(t,{Z:()=>H});a(267602),a(916054),a(653476),a(241792);var i=a(667294),n=()=>a(219727),l=()=>a(142735),r=()=>a(846550),o=()=>a(506347),s=()=>a(788860),c=()=>a(513670),d=()=>a(8101),u=()=>a(295274),m=()=>a(497065),p=()=>a(269299),g=()=>a(707513),f=()=>a(270315),y=a(785893);const k={...g().Yu,position:"absolute",left:0,right:0,top:0,bottom:0},v={marginLeft:4,fontWeight:g().Ue.semibold};function b(e){const{prefix:t,viewName:a,viewType:i}=e;return(0,y.jsxs)("div",{style:{position:"relative",width:"100%"},children:[" ",(0,y.jsxs)("div",{style:k,children:[t,i&&f().aW[i]({marginLeft:8,marginRight:2,width:"1em",display:"inline",verticalAlign:"bottom"}),(0,y.jsx)("span",{style:v,children:a})]})]})}var h=()=>a(125659),M=()=>a(41340),C=()=>a(718048),x=()=>a(641702),w=()=>a(861026),S=()=>a(429725),P=()=>a(352230),_=()=>a(148126),j=()=>a(521777),T=()=>a(270820),I=()=>a(876822),R=()=>a(826955),E=()=>a(807230),L=()=>a(292612);const V=function(e){const t=(0,n().O7)(),i=(0,r().Fg)();return(0,y.jsx)(a(108714).Z,{href:e.href,external:!0,onClick:()=>a(407391).Fs(t,{from:e.helpButtonContext}),children:(0,y.jsx)(a(1910).Z,{icon:a(653457).m,style:{height:24,width:24,marginRight:-6,fill:i.mediumIconColor}})})};var Z=()=>a(953744),F=()=>a(119891),B=()=>a(740046),O=()=>a(18748),q=()=>a(255577),A=()=>a(388284),D=()=>a(98693);const K=(0,s().vU)({filterPlaceholder:{id:"collectionPicker.searchBarFilter.text",defaultMessage:"Filter…"}});const H=function(e){let{collectionStore:t,isOverlay:i,onEmptyEnter:o,onEmptyPageClick:c,onCancelClick:d,canConfigureCollection:u,locked:m,onTemplateClick:p}=e;const g=(0,r().Fg)(),f=(0,n().Fy)(),k=(0,l().qz)(void 0,a(718798).Z),v=(0,l().qz)(void 0,a(692304).Z),b=(0,l().VK)((()=>t.getTemplatePageStores().filter((e=>e.getAlive()))),[t]),h=(0,l().VK)((()=>b.every((e=>e.isReady()))),[b]),M=(0,l().VK)((()=>k.state.inputValue),[k]),C=(0,l().VK)((()=>i&&null!=M&&M.length?(0,a(619186).ZP)(M,b,(e=>String(e.getProperties().title)??"")):b),[b,M,i]);if(!h)return null;let x=(0,y.jsx)(W,{collectionStore:t,onEmptyEnter:o,onEmptyPageClick:c,onCancelClick:d,canConfigureCollection:u,isOverlay:i,locked:m,onTemplateClick:p,menuListStore:v,templateInputStore:k,filteredTemplatePageStores:C,draggable:!0});const w=(0,y.jsx)(z,{templateInputStore:k});if(i){let e;return e=f.isMobile?{menuType:P().o.Modal,title:(0,y.jsx)(s()._H,{defaultMessage:"Database templates",id:"database.mobileTemplatesMenu.title"}),left:(0,y.jsx)(a(470386).CancelMenuText,{}),onClickLeft:d}:{menuType:P().o.Popup,width:360},b.length>6&&M&&(x=(0,y.jsx)(W,{collectionStore:t,onEmptyEnter:o,onEmptyPageClick:c,onCancelClick:d,canConfigureCollection:u,isOverlay:i,locked:m,onTemplateClick:p,menuListStore:v,templateInputStore:k,filteredTemplatePageStores:C,draggable:!1})),(0,y.jsxs)(a(198829).Z,{...e,header:(0,y.jsx)(U,{collectionStore:t}),children:[0===b.length&&(0,y.jsx)(A().Z,{children:(0,y.jsx)("div",{style:{fontSize:14,padding:f.isMobile?"12px 16px":"0 14px 3px 14px",color:g.lightTextColor,wordBreak:"keep-all",...f.isMobile&&{background:g.contentBackground,boxShadow:`0 1px 0 ${g.regularDividerColor}`,marginBottom:1}},children:(0,y.jsx)(s()._H,{defaultMessage:"Replicate page formats inside this database with templates.",id:"database.emptyTemplatesList.info"})})}),b.length>6?w:void 0,x]})}return x};function U(e){let{collectionStore:t}=e;const a=(0,n().O7)(),i=(0,l().VK)((()=>t.getNameStore().getValue()),[t]);if(a.device.isMobile)return null;const r=i?(0,y.jsx)(y.Fragment,{children:(0,x().Xh)(i,t)}):(0,y.jsx)(s()._H,{defaultMessage:"Untitled",id:"database.templateList.UntitledDatabaseTitle"});return(0,y.jsx)(O().ZP,{style:{marginTop:6},title:(0,y.jsx)(b,{prefix:(0,y.jsx)(s()._H,{id:"database.templatesList.templatesFor",defaultMessage:"Templates for"}),viewName:r}),right:(0,y.jsx)(V,{helpButtonContext:"collection_templates_menu",href:(0,_().UY)("guides.databaseTemplates")})})}function N(e){let{props:{ref:t,...a},isOverlay:i,locked:l}=e;const o=(0,r().Fg)(),c=(0,n().O7)(),d=(0,y.jsx)(s()._H,{defaultMessage:"New template",id:"database.templateView.newTemplateButton"});return i?(0,y.jsx)(L().Z,{isBlue:c.device.isDesktop,title:d,...a}):(0,y.jsx)(D().Z,{title:d,icon:(0,j().R)({width:18,fill:o.lightIconColor,marginLeft:1,marginRight:11}),type:"new_template",format:i?"collection-overlay":"page-menu-item",locked:l,...a})}function Y(e,t,a){const{mainEditorCurrentBlockStore:i}=I().default.state;!function(e,t,a){a?a(e):m().c4({environment:t,url:e})}(i?(0,S().ZP)({store:i,peekViewBlockId:e.id,fullyQualified:!1,pageVisitSource:o().tY.Create}):(0,S().ZP)({store:e,fullyQualified:!1,pageVisitSource:o().tY.Create}),t,a)}function z(e){let{templateInputStore:t}=e;const a=(0,s().YB)(),r=(0,n().O7)(),o=(0,i.useCallback)((e=>function(e,t){t.setState({...t.state,inputValue:e.currentTarget.value})}(e,t)),[t]),c=(0,l().Kw)(t),{device:d}=r,u=!d.isMobile||void 0;return(0,y.jsx)("div",{style:{margin:d.isMobile?0:"10px 0"},children:(0,y.jsx)(B().ZP,{value:c.inputValue,focusInitial:u,placeholder:a.formatMessage(K.filterPlaceholder),showClearButton:!0,inputLeft:(0,y.jsx)(B().f_,{icon:T().R}),onChange:o,style:{...d.isAndroid&&{borderBottom:"none"}}})})}function W(e){let{filteredTemplatePageStores:t,draggable:a,collectionStore:r,onEmptyEnter:o,onEmptyPageClick:s,onCancelClick:m,canConfigureCollection:g,isOverlay:f,locked:k,onTemplateClick:v,menuListStore:b,templateInputStore:x}=e;const S=(0,n().O7)(),P=(0,i.useContext)(h().cu),_=(0,i.useContext)(M().Z),j=(0,i.useCallback)((e=>function(e,t,a,i){i.unsetFocus(),p().createAndCommit({userAction:"CollectionTemplatePicker.handleCollectionTemplatesReorder",environment:t,canUndo:!0,perform:t=>u().$p({collectionStore:a,newTemplateIds:e,transaction:t})})}(e,S,r,b)),[S,r,b]),T=(0,i.useCallback)((()=>function(e,t,a,i){var n;(0,E().ww)(e)&&(a(),d().rN(e,{template_type:"empty_page",from:"collections_template_picker",is_keyboard:!0,collection_id:t.id,collection_view_id:null==i||null===(n=i.collectionViewStore())||void 0===n?void 0:n.id}))}(S,r,o,P)),[S,r,o,P]),I=(0,i.useCallback)((e=>function(e,t,a,i){(0,E().ww)(t)&&(a(e.event),d().rN(t,{template_type:"empty_page",from:"collections_template_picker",is_keyboard:"keydown"===e.event.type,...i&&(0,w().Pn)(i)}))}(e,S,s,P)),[P,S,s]),L=(0,i.useCallback)((e=>function(e,t,a,i,n,l,r){if((0,E().ww)(t)){var o;const{performResult:e}=p().createAndCommit({userAction:"CollectionTemplatePicker.newPage",environment:t,canUndo:!0,perform:e=>u().nx({environment:t,collectionStore:a,transaction:e,title:i?i.state.inputValue:void 0})});e&&Y(e,t,l),d().dZ(t,{collection_id:a.id,collection_view_id:null==r||null===(o=r.collectionViewStore())||void 0===o?void 0:o.id})}null==n||n()}(0,S,r,x,m,_,P)),[S,r,x,m,_,P]),{device:V}=S,B=(0,i.useMemo)((()=>({key:"create-template",render:(e,t)=>(0,y.jsx)(N,{isOverlay:f,locked:k,props:e}),action:L})),[L,f,k]),O=(0,l().VK)((()=>null==P?void 0:P.defaultPageTemplateStore.state),[P]),D=(0,l().VK)((()=>({key:"empty",render:(e,a)=>{if(0!==t.length&&""===x.state.inputValue)return(0,y.jsx)(Z().Z,{collectionStore:r,canConfigureCollection:g,isOverlay:f,templateStore:void 0,isMobile:S.device.isMobile,locked:k||!g,draggable:!0,isDefault:void 0===(null==O?void 0:O.id),onCancelClick:m,...e})},action:I})),[g,r,null==O?void 0:O.id,S.device.isMobile,I,f,k,m,x,t.length]),K=(0,l().VK)((()=>{const e=t.map((e=>e.id));return c().oA([0!==t.length&&{key:"templates",render:t=>{const n=t.children.slice(0,t.children.length-1),l=t.children[t.children.length-1];return(0,y.jsx)(A().Z,{...t,disableDesktopPadding:!f,disableMobileBorders:!0,children:(0,y.jsxs)(i.Fragment,{children:[V.isMobile||k||!g?n.map(((e,t)=>n[t])):(0,y.jsx)(F().ZP,{direction:"vertical",keys:e,disabled:!a,renderKey:(t,a)=>n[e.indexOf(t)],onDrop:j}),l]})})},items:[...t.map((e=>function(e,t,a,n,l,r,o,s,c,d){const{device:u}=e,m=null==d?void 0:d.defaultPageTemplateStore.state,p=R().Mz.fromBlockStore(t),g=null!=p&&p.isActive()?p.getRecurrence():void 0,f=p&&!p.canEdit(),y="disabled_duplication"===(null==p?void 0:p.getStatus())||"disabled_inactive_space"===(null==p?void 0:p.getStatus());return{key:t.id,render:e=>(0,i.createElement)(Z().Z,{...e,key:t.id,isOverlay:o,collectionStore:n,canConfigureCollection:l,templateStore:t,isMobile:u.isMobile,locked:r,onCancelClick:s,draggable:a,isDefault:(null==m?void 0:m.id)===t.id,recurrence:g,recurrenceDisabled:y,recurrenceButtonDisabled:f}),action:a=>{(0,E().ww)(e)&&c({templateStore:t,isKeyboard:"keydown"===a.event.type,useCrdt:(0,C().WA)(n.getSpaceStore())})}}}(S,e,a,r,g,k,f,m,v,P))),D]},g?{key:"create-template",render:e=>(0,y.jsx)(A().Z,{topBorder:f,disableDesktopPadding:!f,disableMobileBorders:!0,...e}),items:[B]}:void 0])}),[g,P,r,B,V.isMobile,a,D,S,j,f,k,m,v,t]);return(0,y.jsx)(q().Z,{type:q().i.Vertical,store:b,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onEmptyEnter:T,sections:K,resetFocusOnMouseOut:!0})}}}]);