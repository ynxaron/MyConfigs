"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[41926],{430053:(e,t,o)=>{o.d(t,{I:()=>h});o(667294);var n=()=>o(219727),i=()=>o(142735),c=()=>o(846550),l=()=>o(437187),r=()=>o(788860),a=()=>o(47443),s=()=>o(92175),d=()=>o(943620),u=()=>o(384241),p=()=>o(717245),f=o(785893);function h(e){const{collectionStore:t,pageVisitSource:o,size:h}=e,w=(0,n().O7)(),m=(0,r().YB)(),S=(0,i().VK)((()=>{var e;return null==t||null===(e=t.getParentBlockStore())||void 0===e?void 0:e.getNavigableBlockStore()}),[t]),V=(0,i().VK)((()=>null==t?void 0:t.getIcon()),[t]),g=function(e){return(0,c().yK)((t=>({button:{display:"inline-flex",alignItems:"center",color:t.regularTextColor,paddingLeft:4,paddingRight:4,marginRight:2,height:24,flex:"1 1 auto",gap:4,fontSize:e}})),[e])}(h);return(0,f.jsxs)(s().Z,{style:g.button,onClick:e=>{S&&(a()._c({environment:w,store:S,pageVisitSource:o}),p().M.close(),e.stopPropagation(),e.preventDefault())},children:[(0,f.jsx)(d().Z,{disabled:!0,icon:V,isEmptyPage:!1,size:h,useInvertedColors:!1}),t?(0,f.jsx)(u().Z,{store:t}):(0,l().Q2)(m)]})}},366005:(e,t,o)=>{o.r(t),o.d(t,{ModalOverlayCollectionView:()=>Z});o(821057);var n=o(667294),i=()=>o(219727),c=()=>o(142735),l=()=>o(846550),r=()=>o(506347),a=()=>o(801812),s=()=>o(139978),d=()=>o(788860),u=()=>o(696459),p=()=>o(707513),f=()=>o(269299),h=()=>o(963310),w=()=>o(573357),m=()=>o(312578),S=()=>o(708518),V=()=>o(247724),g=()=>o(473244),v=()=>o(466970),C=()=>o(688293),y=()=>o(876822),k=()=>o(109083),x=()=>o(826955),I=()=>o(932753),b=()=>o(717245),B=()=>o(430053),j=o(785893);const R=600,A=800,O={display:"flex",justifyContent:"center",alignItems:"center",height:o(203890).Ze+o(706363).Ct+40},M=["search","saveOrOpenOverflow","closeCollectionViewInModal"];function Z(){const e=(0,c().VK)((()=>b().M.state),[]);return e.isOpen?"create_ephemeral"===e.type&&e.collectionViewBlockStore&&e.collectionViewValue?(0,j.jsx)(E,{collectionViewBlockStore:e.collectionViewBlockStore,collectionViewValue:e.collectionViewValue}):"already_created"===e.type&&e.collectionViewBlockId&&e.collectionViewId?(0,j.jsx)(T,{render:()=>(0,j.jsx)(K,{collectionViewBlockId:e.collectionViewBlockId,collectionViewId:e.collectionViewId})}):null:null}function E(e){const{collectionViewBlockStore:t,collectionViewValue:o}=e,[c,l]=(0,n.useState)(),r=(0,i().O7)(),a=(0,v().E)("charts_drilldown"),s=(0,C().N)(g().uw,{canUndo:!1}),d=(0,C().t)(s,t);return(0,n.useEffect)((()=>{if(!a)return;const e=f().createAndCommit({environment:r,perform:e=>I().W9({environment:r,collectionViewBlockStore:d,collectionView:o,transaction:e,isEphemeral:!0}).id,userAction:"CollectionChartView.onDrilldownClick",canUndo:!1});l(e.performResult)}),[t,o,d,r,a]),c?(0,j.jsx)(T,{render:()=>(0,j.jsx)(K,{collectionViewBlockId:t.id,collectionViewId:c})}):null}function T(e){const{render:t}=e,o=(0,l().yK)((e=>({modalInnerStyle:{background:e.surface.wash,borderRadius:12,minHeight:250,maxHeight:R,width:A}})),[]),i=(0,n.useCallback)((()=>b().M.close()),[]);return(0,j.jsx)(S().Z,{className:V().rAK,open:!0,preventHideChildrenWhileOpening:!0,onDismiss:i,innerStyle:o.modalInnerStyle,render:()=>(0,j.jsx)(w().Z,{capture:!0,allowEsc:!0,render:t})})}function K(e){const{collectionViewBlockId:t,collectionViewId:o}=e,i=function(e){const{collectionViewBlockId:t,collectionViewId:o}=e,n=(0,c().VK)((()=>{if(y().default.state.currentSpaceStore)return y().default.state.currentSpaceStore;const e=y().default.state.mainEditorCurrentBlockStore;return null!=e&&e.getSpaceStore()?e.getSpaceStore():void 0}),[]),[{value:i}]=(0,a().r5)((async()=>{var e;if(!n)return{type:"loading"};let i=x().G.createChildStore(n,{table:"block",id:t});const c=null===(e=k().Z.state.caches[g().uw])||void 0===e?void 0:e.inMemoryRecordCache;if(c&&(i=i.clone(c)),await i.load(),!i.isCollectionView())throw new Error("expected collection view");const l=x().Xr.createChildStore(i,{table:s().np,id:o});await l.load();const r=l.getCollectionStore();return await(null==r?void 0:r.load()),{collectionViewBlockStore:i,collectionViewStore:l,collectionStore:r}}),[t,o,n]);return i&&"loading"!==i.type&&i.collectionViewBlockStore?{type:"loaded",value:{collectionViewBlockStore:i.collectionViewBlockStore,collectionViewStore:i.collectionViewStore,collectionStore:i.collectionStore}}:{type:"loading"}}({collectionViewBlockId:t,collectionViewId:o}),l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const[t,o]=(0,n.useState)(!1),i=(0,n.useRef)(Date.now());return(0,n.useEffect)((()=>{let t;const n=requestAnimationFrame((()=>t=requestAnimationFrame((()=>{const t=Date.now()-i.current;t>e?o(!0):setTimeout((()=>{o(!0)}),e-t)}))));return()=>{cancelAnimationFrame(n),t&&cancelAnimationFrame(t)}}),[]),t}(150);if(!l)return(0,j.jsx)("div",{style:O,children:(0,j.jsx)(m().Z,{})});switch(i.type){case"loading":return(0,j.jsx)("div",{style:O,children:(0,j.jsx)(m().Z,{})});case"loaded":{const{collectionViewBlockStore:e,collectionViewStore:t,collectionStore:n}=i.value;return(0,j.jsx)(h().DZ,{headerText:(0,j.jsx)(U,{collectionStore:n}),headerActionsBehavior:"always_show",headerAllowedActions:M,hideViewTabBar:!0,isUnlistedView:!0,store:e,isFullScreen:!1,disabled:!1,viewId:o,overridePaddingLeft:0,overridePaddingRight:0,additionalCollectionViewInnerHorizontalPadding:16,maxHeight:R-72,setCollectionContextStore:o=>{o.setContext({type:"collectionView",collectionViewBlockStore:e,collectionViewStore:t,collectionStore:n,pageVisitSourceOverride:void 0}),o.filtersBarOpenStore.setState(!0)}})}default:(0,u().t1)(i)}}function U(e){const{collectionStore:t}=e,o=(0,l().yK)((e=>({textWrapper:{color:e.primaryBlack,fontSize:17,fontWeight:p().Ue.medium,display:"flex",alignItems:"center"}})),[]);return(0,j.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexGrow:1},children:(0,j.jsx)("div",{style:o.textWrapper,children:(0,j.jsx)(d()._H,{defaultMessage:"Results in {databaseName}",id:"AssistantEphemeralViewHeader.resultsIn",values:{databaseName:(0,j.jsx)(B().I,{collectionStore:t,pageVisitSource:r().tY.AIEphemeralView,size:17})}})})})}},688293:(e,t,o)=>{o.d(t,{N:()=>f,t:()=>h});o(670560);var n=o(667294),i=()=>o(219727),c=()=>o(142735),l=()=>o(799891),r=(o(821057),()=>o(386616)),a=()=>o(826955),s=()=>o(269299);var d=()=>o(109083),u=()=>o(910135),p=()=>o(142109);function f(e,t){let{canUndo:o,shouldPersistOperation:f}=t;const h=(0,i().O7)(),w=(0,n.useRef)([]).current,m=(0,n.useCallback)((e=>{w.push(...e)}),[w]),S=(0,n.useCallback)((e=>{f&&!f(e)||m([e])}),[m,f]),V=(0,p().$)(e,{cacheFallback:h.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0,onOperationCallback:S});(0,n.useEffect)((()=>{d().Z.initializeCache(e,V)}),[e,V]);const g=(0,n.useCallback)((()=>{u().default.reset(),d().Z.clearCache(e)}),[e]);(0,n.useEffect)((()=>(u().default.reset(),()=>{u().default.reset(),d().Z.expire(e)})),[e]);const v=(0,c().VK)((()=>u().default.state.undoStack.length>0),[]);(0,n.useEffect)((()=>{d().Z.updateUnsavedCacheState(e,v)}),[e,v]);const C=(0,n.useCallback)((async e=>{if(0===w.length)return void 0;V.assertUnexpired(),function(e){for(const t of u().default.state.undoStack)for(const o of t.transactions)for(const t of o.stores)if(t.inMemoryRecordCache!==e&&!t.inMemoryRecordCache.isMockTextStore){const n=o.getUserActionForAnalyticsPurposesOnly(),i=t.inMemoryRecordCache.name,c=e.name,r=`Undoable user action "${n}" was applied to cache "${i}", but only operations in the cache "${c}" should be in the undo stack!`;(0,l().log)({from:"useLocalDraft",type:"invalidStoreInRevisionStack",level:"error",data:{message:r,miscDataToConvertToString:{userAction:n,inMemoryRecordCacheName:i,expectedInMemoryRecordCacheName:c}}})}}(V);const{serverCommitResult:t}=s().createAndCommit({environment:h,userAction:e,perform(e){!function(e){let{environment:t,transaction:o,operationsWithStores:n}=e;for(const{operation:i,store:c}of n){if(!(c instanceof a().ST))continue;const e=c.clone(t.defaultRecordCache.inMemoryRecordCache);(0,r().Qf)(i)?s().applyCrdtTextOperation({store:c,operation:i,transaction:o,invertedOperation:void 0}):s().applyOperation({transaction:o,store:e,operation:i})}}({environment:h,transaction:e,operationsWithStores:w}),e.postSubmitCallbacks.push((e=>{e||(V.expire(),u().default.reset())}))},canUndo:o});return t}),[e,o,h,w,V]);return(0,n.useMemo)((()=>({cache:V,hasChanges:v,persist:C,reset:g})),[v,C,g,V])}function h(e,t){return(0,c().VK)((()=>t.clone(e.cache)),[t,e.cache])}}}]);