"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[58049],{958969:(e,n,o)=>{o.r(n),o.d(n,{getFormulaAnalytics:()=>k,getRedactedFormulaAsStringSync:()=>$,getSimpleFormulaAnalytics:()=>R});o(670560),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(30005);var t=()=>o(696459),i=()=>o(870910),r=()=>o(530980),l=()=>o(92960),c=()=>o(455222),a=()=>o(177634);const s="unknown";function u(e,n){e.mentions.properties[n]??=0,e.mentions.properties[n]++}function d(e,n){e.mentions.variables[n]??=0,e.mentions.variables[n]++}function p(e,n){e.function_names[n]??=0,e.function_names[n]++}function y(e){return"array"===e.type?`array of ${y(e.of)}`:e.type}function b(e,n,o){const{getRecordModel:i,typecheckContextValues:r}=o;switch(e.type){case l().FormulaTokenType.Person:n.mentions.users++;break;case l().FormulaTokenType.Block:n.mentions.pages++;break;case l().FormulaTokenType.BlockProperty:if("collection"in e)if(void 0===e.collection)u(n,e.property);else{const o=i(e.collection),t=null==o?void 0:o.getNormalizedSchema(),r=null==t?void 0:t[(0,a().SR)(e.property)];u(n,r?r.type:s)}else if(e.contextValueId){const o=(0,a().b0)(r,(0,a().Kv)(e.contextValueId));if(o&&"block"===o.type.type&&o.type.collection){const t=i(o.type.collection),r=null==t?void 0:t.getNormalizedSchema(),l=null==r?void 0:r[(0,a().Uw)(e.property)];u(n,l?l.type:s)}}else u(n,s);break;case l().FormulaTokenType.ContextValue:{const o=(0,a().b0)(r,(0,a().Kv)(e.valueId));null!=o&&o.type?d(n,y(o.type)):d(n,s);break}case l().FormulaTokenType.Date:case l().FormulaTokenType.Checkbox:break;default:(0,t().t1)(e)}}function m(e,n,o){const{getRecordModel:t}=o;if("collection"in e)if(void 0===e.collection)u(n,e.property);else{const o=t(e.collection),i=null==o?void 0:o.getNormalizedSchema(),r=null==i?void 0:i[(0,a().SR)(e.property)];u(n,r?r.type:s)}else u(n,s)}function f(e,n,o){switch(function(e,n){e.node_kinds[n]??=0,e.node_kinds[n]++}(n,e.kind),e.kind){case c().bG.Number:case c().bG.String:case c().bG.Boolean:case c().bG.Identifier:case c().bG.RecoveryNode:break;case c().bG.Array:case c().bG.LogicalOr:case c().bG.LogicalAnd:e.elements.forEach((e=>f(e,n,o)));break;case c().bG.NotionToken:b(e.token,n,o);break;case c().bG.Conditional:f(e.condition,n,o),f(e.expIfTrue,n,o),e.expIfFalse&&f(e.expIfFalse,n,o);break;case c().bG.Equality:case c().bG.Relational:case c().bG.Additive:case c().bG.Multiplicative:case c().bG.Exponentiation:f(e.lhs,n,o),f(e.rhs,n,o);break;case c().bG.Unary:f(e.expression,n,o);break;case c().bG.Call:f(e.expression,n,o),e.expression.kind===c().bG.Identifier?p(n,e.expression.text):e.expression.kind===c().bG.UnifiedFunctionProperty&&p(n,e.expression.name),e.arguments.forEach((e=>f(e,n,o)));break;case c().bG.UnifiedFunctionProperty:f(e.expression,n,o);break;case c().bG.MemberBlockProperty:f(e.expression,n,o),m(e.propertyToken,n,o);break;default:(0,t().t1)(e)}}function k(e,n){const o={function_names:{},mentions:{pages:0,properties:{},users:0,variables:{}},node_kinds:{}},t=n.getRecordModel??r().omK.constant(void 0);return f(e,o,{...n,getRecordModel:t}),o}function*v(e,n){const{typecheckContextValues:o}=n;if("collection"in e){if(void 0===e.collection)return e.property;{const n=yield*i().R.fetchRecord(e.collection),o=null==n?void 0:n.getNormalizedSchema(),t=null==o?void 0:o[(0,a().SR)(e.property)];return(null==t?void 0:t.type)??s}}{const n=(0,a().b0)(o,(0,a().Kv)(e.contextValueId)),t=null==n?void 0:n.type;if("block"===(null==t?void 0:t.type)&&t.collection){const n=yield*i().R.fetchRecord(t.collection),o=null==n?void 0:n.getNormalizedSchema(),r=null==o?void 0:o[(0,a().SR)(e.property)];return(null==r?void 0:r.type)??s}}return s}function*x(e){let n;if(void 0===e.collection)n=e.property;else{const o=yield*i().R.fetchRecord(e.collection),t=null==o?void 0:o.getNormalizedSchema(),r=null==t?void 0:t[(0,a().SR)(e.property)];n=(null==r?void 0:r.type)??s}return`[Property mention - ${n}]`}function*h(e,n){const{typecheckContextValues:o}=n;switch(e.type){case l().FormulaTokenType.Checkbox:return`[Checkbox - ${e.checked.toString()}]`;case l().FormulaTokenType.Person:return"[Person mention]";case l().FormulaTokenType.Block:return"[Page mention]";case l().FormulaTokenType.Date:return"[Date mention]";case l().FormulaTokenType.BlockProperty:return`[Property mention - ${yield*v(e,n)}]`;case l().FormulaTokenType.ContextValue:{const n=(0,a().b0)(o,(0,a().Kv)(e.valueId));return n?`[Formula variable mention - ${y(n.type)}]`:"[Formula variable mention - Unknown]"}default:(0,t().t1)(e)}}function G(e,n){return e.expression.kind===c().bG.Identifier&&e.expression.text===n}function g(e,n){let o;for(let t=0;t<e.length;t+=2)o=e[t],o.kind===c().bG.Identifier&&n.add(o.text);return n}function*T(e,n){switch(e.kind){case c().bG.Number:return'"**"';case c().bG.String:return'"*"';case c().bG.Boolean:return e.text;case c().bG.Identifier:return n.variableNames.has(e.text)?"[User created variable]":e.text;case c().bG.RecoveryNode:return"";case c().bG.Array:const o=[];for(const t of e.elements)o.push(yield*T(t,n));return`[${o.join(", ")}]`;case c().bG.LogicalOr:return`${yield*T(e.elements[0],n)} or ${yield*T(e.elements[1],n)}`;case c().bG.LogicalAnd:return`${yield*T(e.elements[0],n)} and ${yield*T(e.elements[1],n)}`;case c().bG.Conditional:return`${yield*T(e.condition,n)} ? ${yield*T(e.expIfTrue,n)} : ${e.expIfFalse?yield*T(e.expIfFalse,n):"undefined"}`;case c().bG.Equality:case c().bG.Relational:case c().bG.Additive:case c().bG.Multiplicative:case c().bG.Exponentiation:return`${yield*T(e.lhs,n)} ${e.op} ${yield*T(e.rhs,n)}`;case c().bG.Unary:return"not"===e.op?`${e.op} ${yield*T(e.expression,n)}`:`${e.op}${yield*T(e.expression,n)}`;case c().bG.Call:{(G(e,"let")||G(e,"lets"))&&g(e.arguments,n.variableNames);const o=[];for(const t of e.arguments)o.push(yield*T(t,n));return`${yield*T(e.expression,n)}(${o.join(", ")})`}case c().bG.UnifiedFunctionProperty:return`${yield*T(e.expression,n)}.${e.name}`;case c().bG.MemberBlockProperty:return`${yield*T(e.expression,n)}.${yield*x(e.propertyToken)}`;case c().bG.NotionToken:return yield*h(e.token,n);default:(0,t().t1)(e)}}function $(e,n){return i().R.runSync(n.getRecordModel,T(e,{typecheckContextValues:n.typecheckContextValues,variableNames:new Set}))}var F=()=>o(955620);function R(e,n){const{getRecordModel:o,typecheckContextValues:t}=n,i={function_names:{},mentions:{pages:0,properties:{},users:0,variables:{}},node_kinds:{}},l=o??r().omK.constant(void 0);let c,p,b;for(const r of e)if((0,F().km_)(r))if(c=(0,F().hDy)(r),(0,F().V8Y)(c))i.mentions.pages++;else if((0,F().hH9)(c))i.mentions.users++;else if(p=(0,F().sP4)(c)){b=p[1],b.id;const e=(0,a().b0)(t,b.id);null!=e&&e.type?d(i,y(e.type)):d(i,s)}else if(p=(0,F().jRb)(c))if(b=p[1],"collection"in b)if(void 0===b.collection)u(i,b.property);else{const e=l(b.collection);if(e){var m;u(i,(null===(m=e.getNormalizedSchema()[b.property])||void 0===m?void 0:m.type)??s)}else u(i,s)}else if("contextValueId"in b){const e=(0,a().b0)(t,b.contextValueId),n=null==e?void 0:e.type;if(n&&"block"===n.type&&n.collection){const e=l(n.collection);if(e){var f;u(i,(null===(f=e.getNormalizedSchema()[b.property])||void 0===f?void 0:f.type)??s)}}else u(i,s)}return i}}}]);