"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[81898],{942265:(e,t,r)=>{r.d(t,{K:()=>p});r(821057),r(267602),r(470928),r(241792);var n=()=>r(720866),o=()=>r(92960),s=()=>r(549045),i=()=>r(455222),a=()=>r(177634);const l=new RegExp(/\\([\\nt"])/g);function c(e){return e.find((e=>void 0!==e&&!isNaN(e)))}function p(e){const t=function(){const e=(0,s().XR)(),t=(0,s().Z8)(e).getBaseCstVisitorConstructor();return new class extends t{constructor(){super(),this.validateVisitor()}expression(e){return this.visit(e.conditionalExpression)}primaryExpression(e){if(void 0!==e.parenthesisExpression)return this.visit(e.parenthesisExpression);if(void 0!==e.arrayExpression)return this.visit(e.arrayExpression);if(void 0!==e.NumberLiteral)return{kind:i().bG.Number,text:e.NumberLiteral[0].image,startOffset:e.NumberLiteral[0].startOffset,endOffset:e.NumberLiteral[0].endOffset};if(void 0!==e.StringLiteral){const t=e.StringLiteral[0].image.slice(1,-1).replace(l,((e,t)=>{switch(t){case"n":return"\n";case"t":return"\t";default:return t}}));return{kind:i().bG.String,text:t,startOffset:e.StringLiteral[0].startOffset,endOffset:e.StringLiteral[0].endOffset}}return void 0!==e.UnclosedStringLiteral?{kind:i().bG.String,text:e.UnclosedStringLiteral[0].image.substring(1,e.UnclosedStringLiteral[0].image.length),startOffset:e.UnclosedStringLiteral[0].startOffset,endOffset:e.UnclosedStringLiteral[0].endOffset}:void 0!==e.BooleanLiteral?{kind:i().bG.Boolean,text:e.BooleanLiteral[0].image,startOffset:e.BooleanLiteral[0].startOffset,endOffset:e.BooleanLiteral[0].endOffset}:void 0!==e.InputToken?{kind:i().bG.NotionToken,token:e.InputToken[0].payload,startOffset:e.InputToken[0].startOffset,endOffset:e.InputToken[0].endOffset}:void 0!==e.IdentifierName?{kind:i().bG.Identifier,text:e.IdentifierName[0].image,startOffset:e.IdentifierName[0].startOffset,endOffset:e.IdentifierName[0].endOffset}:{kind:i().bG.RecoveryNode,startOffset:-1,endOffset:-1}}conditionalExpression(e){const t=this.visit(e.condition[0]);var r,n,o,s;return void 0!==e.QuestionMark?{kind:i().bG.Conditional,condition:t,expIfTrue:this.visit(e.expIfTrue[0]),expIfFalse:void 0!==(null===(r=e.expIfFalse)||void 0===r?void 0:r[0])?this.visit(e.expIfFalse[0]):void 0,startOffset:e.condition[0].location.startOffset,endOffset:c([null===(n=e.expIfFalse)||void 0===n||null===(n=n[0].location)||void 0===n?void 0:n.endOffset,null===(o=e.Colon)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.endOffset,null===(s=e.expIfTrue[0].location)||void 0===s?void 0:s.endOffset,e.QuestionMark[0].endOffset])}:t}logicalOrExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.Or){var r,n;const o=(null===(r=e.rhs)||void 0===r?void 0:r.map((e=>this.visit(e))))??[];return{kind:i().bG.LogicalOr,elements:[t,...o],startOffset:e.lhs[0].location.startOffset,endOffset:c([null===(n=e.rhs)||void 0===n||null===(n=n[e.rhs.length-1])||void 0===n||null===(n=n.location)||void 0===n?void 0:n.endOffset,e.Or[0].endOffset])}}return t}logicalAndExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.And){var r,n;const o=(null===(r=e.rhs)||void 0===r?void 0:r.map((e=>this.visit(e))))??[];return{kind:i().bG.LogicalAnd,elements:[t,...o],startOffset:e.lhs[0].location.startOffset,endOffset:c([null===(n=e.rhs)||void 0===n||null===(n=n[e.rhs.length-1])||void 0===n||null===(n=n.location)||void 0===n?void 0:n.endOffset,e.And[0].endOffset])}}return t}equalityExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.EqualityOperator){var r;const n=e.rhs[0];return{kind:i().bG.Equality,op:e.EqualityOperator[0].image,lhs:t,rhs:this.visit(n),startOffset:e.lhs[0].location.startOffset,endOffset:c([null===(r=n.location)||void 0===r?void 0:r.endOffset,e.EqualityOperator[0].endOffset])}}return t}relationalExpression(e){const t=this.visit(e.lhs[0]);if(void 0!==e.RelationalOperator){var r;const n=e.rhs[0];return{kind:i().bG.Relational,op:e.RelationalOperator[0].image,lhs:t,rhs:this.visit(n),startOffset:e.lhs[0].location.startOffset,endOffset:c([null===(r=n.location)||void 0===r?void 0:r.endOffset,e.RelationalOperator[0].endOffset])}}return t}additionExpression(e){let t=this.visit(e.lhs[0]);if(void 0!==e.AdditionOperator)for(let n=0;n<e.AdditionOperator.length;n++){var r;const o=e.rhs[n];t={kind:i().bG.Additive,op:e.AdditionOperator[n].image,lhs:t,rhs:this.visit(o),startOffset:e.lhs[0].location.startOffset,endOffset:c([null===(r=o.location)||void 0===r?void 0:r.endOffset,e.AdditionOperator[n].endOffset])}}return t}multiplicationExpression(e){let t=this.visit(e.lhs[0]);if(void 0!==e.MultiplicationOperator)for(let n=0;n<e.MultiplicationOperator.length;n++){var r;const o=e.rhs[n];t={kind:i().bG.Multiplicative,op:e.MultiplicationOperator[n].image,lhs:t,rhs:this.visit(o),startOffset:e.lhs[0].location.startOffset,endOffset:c([null===(r=o.location)||void 0===r?void 0:r.endOffset,e.MultiplicationOperator[n].endOffset])}}return t}exponentiationExpression(e){let t;const r=this.visit(e.lhs[0]);if(void 0!==e.Caret){var n;const o=e.Caret.length-1;let s,a=null===(n=e.rhs[o].location)||void 0===n?void 0:n.endOffset;(void 0===a||isNaN(a))&&(a=e.Caret[o].endOffset);for(let r=e.Caret.length-1;r>=0;r--){const n=e.rhs[r];t=void 0===s?this.visit(n):{kind:i().bG.Exponentiation,op:s,lhs:this.visit(n),rhs:t,startOffset:n.location.startOffset,endOffset:a},s=e.Caret[r].image}return{kind:i().bG.Exponentiation,op:s,lhs:r,rhs:t,startOffset:e.lhs[0].location.startOffset,endOffset:a}}return r}unaryExpression(e){let t=this.visit(e.primaryExpression[0]),r=e.primaryExpression[0].location.startOffset;const n=void 0!==e.UnaryOperator&&"-"===e.UnaryOperator[0].image&&t.kind===i().bG.Number;var s;if(n&&(t={kind:i().bG.Unary,op:e.UnaryOperator[0].image.toLowerCase(),expression:t,startOffset:e.UnaryOperator[0].startOffset,endOffset:t.endOffset}),isNaN(r)&&(r=null===(s=e.memberCallSubExpression)||void 0===s?void 0:s[0].location.startOffset),void 0!==e.memberCallSubExpression)for(const f of e.memberCallSubExpression){const e=f.location.endOffset;if(void 0!==f.children.callArguments){var l,c,p;const n=f.children.callArguments[0].children;t={kind:i().bG.Call,expression:t,arguments:(null===(l=f.children.callArguments[0])||void 0===l||null===(l=l.children.expression)||void 0===l?void 0:l.map((e=>this.visit(e))))??[],lParenOffset:n.LParen[0].startOffset,rParenOffset:null===(c=n.RParen)||void 0===c?void 0:c[0].startOffset,commaOffsets:(null===(p=n.Comma)||void 0===p?void 0:p.map((e=>e.startOffset)))??[],startOffset:r,endOffset:e}}else if(void 0!==f.children.dotMemberExpression){const n=f.children.dotMemberExpression[0].children;if(void 0!==n.IdentifierName){const o=n.IdentifierName[0];t={kind:i().bG.UnifiedFunctionProperty,expression:t,name:o.image,nameStartOffset:o.startOffset,nameEndOffset:o.endOffset,startOffset:r,endOffset:e}}else if(void 0!==n.InputToken){const s=n.InputToken[0],l=s.payload;if(l.type===o().FormulaTokenType.BlockProperty){if((0,a().Xp)(l))throw new Error("unexpected block property context value in unaryExpression");t={kind:i().bG.MemberBlockProperty,expression:t,propertyToken:void 0===l.collection?{property:l.property,collection:void 0}:{property:l.property,collection:l.collection},propertyStartOffset:s.startOffset,propertyEndOffset:s.endOffset,startOffset:r,endOffset:e}}}}}return void 0===e.UnaryOperator||n?t:{kind:i().bG.Unary,op:e.UnaryOperator[0].image.toLowerCase().trimEnd(),expression:t,startOffset:e.UnaryOperator[0].startOffset,endOffset:t.endOffset}}parenthesisExpression(e){return this.visit(e.expression[0])}arrayExpression(e){var t,r,n,o,s;return{kind:i().bG.Array,elements:(null===(t=e.expression)||void 0===t?void 0:t.map((e=>this.visit(e))))??[],lBracketOffset:e.LBracket[0].startOffset,rBracketOffset:null===(r=e.RBracket)||void 0===r?void 0:r[0].startOffset,commaOffsets:(null===(n=e.Comma)||void 0===n?void 0:n.map((e=>e.startOffset)))??[],startOffset:e.LBracket[0].startOffset,endOffset:c([null===(o=e.RBracket)||void 0===o?void 0:o[0].endOffset,null===(s=e.expression)||void 0===s||null===(s=s[e.expression.length-1])||void 0===s||null===(s=s.location)||void 0===s?void 0:s.endOffset,e.LBracket[0].endOffset])}}memberCallSubExpression(e){throw new Error("unexpected memberCallSubExpression")}dotMemberExpression(e){throw new Error("unexpected dotMemberExpression")}callArguments(e){throw new Error("unexpected callArguments")}}}();try{return{value:t.visit(e)}}catch(r){return{error:{type:i().$E.UnexpectedError,error:(0,n().t)(r),offset:0}}}}},549045:(e,t,r)=>{r.d(t,{Nh:()=>d,XR:()=>l,Z8:()=>f,mK:()=>u,s:()=>c});r(821057),r(725847);var n=()=>r(478701),o=()=>r(513670),s=()=>r(92960),i=()=>r(455222),a=()=>r(177634);const l=o().HP((()=>function(){const e=(0,n().V3)({name:"AdditionOperator",pattern:n().hW.NA}),t=(0,n().V3)({name:"UnaryOperator",pattern:n().hW.NA}),o=(0,n().V3)({name:"Plus",pattern:/\+/,categories:e}),i=(0,n().V3)({name:"Minus",pattern:/-/,categories:[e,t]}),l=(0,n().V3)({name:"ExclamationPoint",pattern:/!/,categories:t}),c=(0,n().V3)({name:"MultiplicationOperator",pattern:n().hW.NA}),p=(0,n().V3)({name:"Multi",pattern:/\*/,categories:c}),f=(0,n().V3)({name:"Div",pattern:/\//,categories:c}),d=(0,n().V3)({name:"Modulo",pattern:/%/,categories:c}),h=(0,n().V3)({name:"Caret",pattern:/\^/}),u=(0,n().V3)({name:"BooleanLiteral",pattern:n().hW.NA}),m=(0,n().V3)({name:"True",pattern:/true/i,categories:u}),E=(0,n().V3)({name:"False",pattern:/false/i,categories:u}),y=(0,n().V3)({name:"And",pattern:/and |&&/i}),O=(0,n().V3)({name:"Or",pattern:/or |\|\|/i}),x=(0,n().V3)({name:"Not",pattern:/not /i,categories:t}),v=(0,n().V3)({name:"RelationalOperator",pattern:n().hW.NA}),k=(0,n().V3)({name:"LessThan",pattern:/<=?/,categories:v}),L=(0,n().V3)({name:"GreaterThan",pattern:/>=?/,categories:v}),S=(0,n().V3)({name:"EqualityOperator",pattern:n().hW.NA}),U=(0,n().V3)({name:"Equal",pattern:/==/,categories:S}),g=(0,n().V3)({name:"NotEqual",pattern:/!=/,categories:S}),T=(0,n().V3)({name:"LParen",pattern:/\(/}),A=(0,n().V3)({name:"RParen",pattern:/\)/}),P=(0,n().V3)({name:"LBracket",pattern:/\[/}),R=(0,n().V3)({name:"RBracket",pattern:/\]/}),I=(0,n().V3)({name:"Comma",pattern:/,/}),N=(0,n().V3)({name:"Dot",pattern:/\./}),b=(0,n().V3)({name:"QuestionMark",pattern:/\?/}),M=(0,n().V3)({name:"Colon",pattern:/:/}),C=(0,n().V3)({name:"StringLiteral",pattern:/"(?:[^\\"]|\\.)*"/,start_chars_hint:['"']}),B=(0,n().V3)({name:"UnclosedStringLiteral",pattern:/"(?:[^\\"]|\\.)*/,start_chars_hint:['"']}),F=(0,n().V3)({name:"NumberLiteral",pattern:/(0|[1-9]\d*)(\.\d+)?([eE][+-]?\d+)?/}),V=(0,n().V3)({name:"Comment",pattern:/\/\*(?:[^*]|\*(?:[^\/]))*\*\//,group:n().hW.SKIPPED,start_chars_hint:["/*"]}),_=(0,n().V3)({name:"UnclosedComment",pattern:/\/\*(?:[^*]|\*(?:[^\/]))*/,group:n().hW.SKIPPED,start_chars_hint:["/*"]}),w=(0,n().V3)({name:"InputToken",pattern:{exec:(e,t)=>{if(!e.startsWith(s().FORMULA_TOKEN_PREFIX,t))return null;const n=e.substring(t),o=s().tokenBlockPropertyOptionalCollectionPattern.exec(n);if(null!==o){const e=[o[0]],t=(0,a().i0)(o[1]);let n;if(void 0!==o[2])n={type:s().FormulaTokenType.BlockProperty,property:t,collection:{table:r(752778).vF,id:o[3],spaceId:o[4]}};else{if(!s().FormulaTokenSupportedBlockSystemPropertyList.includes(t))return null;n={type:s().FormulaTokenType.BlockProperty,property:t,collection:void 0}}return e.payload=n,e}const i=s().tokenBlockPropertyContextValueIdPattern.exec(n);if(null!==i){const e=[i[0]],t=(0,a().i0)(i[1]),r=(0,a().wf)(i[2]),n=(0,a().by)(e[3]),o={contextValueId:r,property:t,type:s().FormulaTokenType.BlockProperty,valueSnapshot:n};return e.payload=o,e}const l=s().tokenBlockPattern.exec(n);if(null!==l){const e=[l[0]],t={type:s().FormulaTokenType.Block,blockId:l[1],spaceId:void 0!==l[2]?l[2].substring(1):void 0};return e.payload=t,e}const c=s().tokenPersonPattern.exec(n);if(null!==c){const e=[c[0]],t={type:s().FormulaTokenType.Person,userId:c[1]};return e.payload=t,e}const p=s().tokenCheckboxPattern.exec(n);if(null!==p){const e=[p[0]],t={type:s().FormulaTokenType.Checkbox,checked:"true"===p[1]};return e.payload=t,e}const f=s().tokenContextValuePattern.exec(n);if(null!==f){const e=[f[0]],t=(0,a().wf)(f[1]),r={type:s().FormulaTokenType.ContextValue,valueId:t};return e.payload=r,e}const d=s().tokenDatePattern.exec(n);if(null!==d){const e=[d[0]],t={type:s().FormulaTokenType.Date,date:(0,a().DF)(d[1])};return e.payload=t,e}return null}},line_breaks:!1,start_chars_hint:[s().FORMULA_TOKEN_PREFIX]}),$=(0,n().V3)({name:"IdentifierName",pattern:(G=/[\p{Letter}_][\p{Number}\p{Letter}_]*/u,(e,t)=>{const r=new RegExp(G.source,`${G.flags}y`);return r.lastIndex=t,r.exec(e)}),line_breaks:!1});var G;return{WhiteSpace:(0,n().V3)({name:"WhiteSpace",pattern:/\s+/,group:n().hW.SKIPPED}),NumberLiteral:F,StringLiteral:C,UnclosedStringLiteral:B,Comment:V,UnclosedComment:_,InputToken:w,True:m,False:E,And:y,Or:O,Not:x,IdentifierName:$,Equal:U,NotEqual:g,Plus:o,Minus:i,ExclamationPoint:l,Multi:p,Div:f,Modulo:d,Caret:h,LParen:T,RParen:A,LBracket:P,RBracket:R,AdditionOperator:e,MultiplicationOperator:c,LessThan:k,GreaterThan:L,QuestionMark:b,Colon:M,Comma:I,Dot:N,UnaryOperator:t,EqualityOperator:S,RelationalOperator:v,BooleanLiteral:u}}()));const c=o().HP((e=>new(n().hW)(function(e){return Object.values(e)}(e))));class p extends n().wd{constructor(e){super(Object.values(e),{recoveryEnabled:!0,nodeLocationTracking:"onlyOffset"}),this.formulaTokens=void 0,this.c1=void 0,this.expression=this.RULE("expression",(()=>{this.SUBRULE(this.conditionalExpression)})),this.primaryExpression=this.RULE("primaryExpression",(()=>{this.OR(this.c1||(this.c1=[{ALT:()=>this.SUBRULE(this.parenthesisExpression)},{ALT:()=>this.SUBRULE(this.arrayExpression)},{ALT:()=>this.CONSUME(this.formulaTokens.NumberLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.StringLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.UnclosedStringLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.BooleanLiteral)},{ALT:()=>this.CONSUME(this.formulaTokens.IdentifierName)},{ALT:()=>this.CONSUME(this.formulaTokens.InputToken)}]))})),this.conditionalExpression=this.RULE("conditionalExpression",(()=>{this.SUBRULE(this.logicalOrExpression,{LABEL:"condition"}),this.OPTION((()=>{this.CONSUME(this.formulaTokens.QuestionMark),this.SUBRULE2(this.logicalOrExpression,{LABEL:"expIfTrue"}),this.CONSUME(this.formulaTokens.Colon),this.SUBRULE3(this.logicalOrExpression,{LABEL:"expIfFalse"})}))})),this.logicalOrExpression=this.RULE("logicalOrExpression",(()=>{this.SUBRULE(this.logicalAndExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.Or),this.SUBRULE2(this.logicalAndExpression,{LABEL:"rhs"})}))})),this.logicalAndExpression=this.RULE("logicalAndExpression",(()=>{this.SUBRULE(this.equalityExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.And),this.SUBRULE2(this.equalityExpression,{LABEL:"rhs"})}))})),this.equalityExpression=this.RULE("equalityExpression",(()=>{this.SUBRULE(this.relationalExpression,{LABEL:"lhs"}),this.OPTION((()=>{this.CONSUME(this.formulaTokens.EqualityOperator),this.SUBRULE2(this.relationalExpression,{LABEL:"rhs"})}))})),this.relationalExpression=this.RULE("relationalExpression",(()=>{this.SUBRULE(this.additionExpression,{LABEL:"lhs"}),this.OPTION((()=>{this.CONSUME(this.formulaTokens.RelationalOperator),this.SUBRULE2(this.additionExpression,{LABEL:"rhs"})}))})),this.additionExpression=this.RULE("additionExpression",(()=>{this.SUBRULE(this.multiplicationExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.AdditionOperator),this.SUBRULE2(this.multiplicationExpression,{LABEL:"rhs"})}))})),this.multiplicationExpression=this.RULE("multiplicationExpression",(()=>{this.SUBRULE(this.exponentiationExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.MultiplicationOperator),this.SUBRULE2(this.exponentiationExpression,{LABEL:"rhs"})}))})),this.exponentiationExpression=this.RULE("exponentiationExpression",(()=>{this.SUBRULE(this.unaryExpression,{LABEL:"lhs"}),this.MANY((()=>{this.CONSUME(this.formulaTokens.Caret),this.SUBRULE2(this.unaryExpression,{LABEL:"rhs"})}))})),this.unaryExpression=this.RULE("unaryExpression",(()=>{this.OPTION((()=>{this.CONSUME(this.formulaTokens.UnaryOperator)})),this.SUBRULE(this.primaryExpression),this.MANY((()=>{this.SUBRULE2(this.memberCallSubExpression)}))})),this.memberCallSubExpression=this.RULE("memberCallSubExpression",(()=>{this.OR([{ALT:()=>this.SUBRULE(this.dotMemberExpression)},{ALT:()=>this.SUBRULE(this.callArguments)}])})),this.dotMemberExpression=this.RULE("dotMemberExpression",(()=>{this.CONSUME(this.formulaTokens.Dot),this.OR([{ALT:()=>this.CONSUME(this.formulaTokens.IdentifierName)},{GATE:()=>{var e;const t=this.LA(1);return t.tokenType===this.formulaTokens.InputToken&&(null===(e=t.payload)||void 0===e?void 0:e.type)===s().FormulaTokenType.BlockProperty},ALT:()=>this.CONSUME(this.formulaTokens.InputToken)}])})),this.callArguments=this.RULE("callArguments",(()=>{this.CONSUME(this.formulaTokens.LParen),this.OPTION((()=>{this.SUBRULE(this.expression),this.MANY((()=>{this.CONSUME(this.formulaTokens.Comma),this.SUBRULE2(this.expression)}))})),this.CONSUME(this.formulaTokens.RParen)})),this.parenthesisExpression=this.RULE("parenthesisExpression",(()=>{this.CONSUME(this.formulaTokens.LParen),this.SUBRULE(this.expression),this.CONSUME(this.formulaTokens.RParen)})),this.arrayExpression=this.RULE("arrayExpression",(()=>{this.CONSUME(this.formulaTokens.LBracket),this.OPTION((()=>{this.SUBRULE(this.expression),this.MANY((()=>{this.CONSUME(this.formulaTokens.Comma),this.SUBRULE2(this.expression)}))})),this.CONSUME(this.formulaTokens.RBracket)})),this.formulaTokens=e,this.performSelfAnalysis()}}const f=o().HP((e=>new p(e)));function d(e){const t=/unexpected character: ->(.+)<- at offset/.exec(e.message);if(null!==t)return{type:i().$E.InvalidCharacter,character:t[1],offset:e.offset};if("unclosed string literal"===e.message)return{type:i().$E.UnclosedStringLiteral,offset:e.offset};if("unclosed comment"===e.message)return{type:i().$E.UnclosedComment,offset:e.offset};throw new Error(`Unhandled chevrotain recognition error: ${e.message}`)}const h={RParen:")",RBracket:"]",Colon:":"};function u(e){const t=e.token.tokenType===n().sd?"eof":e.token.startOffset;switch(e.name){case"MismatchedTokenException":{const r=/Expecting token of type --> (.+) <-- but found/.exec(e.message);if(null!==r){const e=r[1],n=h[e];if(void 0!==n)return{type:i().$E.TokenExpected,token:n,offset:t}}break}case"NoViableAltException":{const r=e.context.ruleStack[e.context.ruleStack.length-1];switch(r){case"primaryExpression":return{type:i().$E.ExpressionExpected,offset:t};case"dotMemberExpression":return{type:i().$E.PropertyTokenOrFunctionExpected,offset:t}}throw new Error(`Unhandled unviable alt: ${r}`)}case"NotAllInputParsedException":return{type:i().$E.EndOfInputExpected,offset:t}}return{type:i().$E.UnexpectedError,error:new Error(`Unhandled chevrotain recognition error: ${e.name}`),offset:t}}},853031:(e,t,r)=>{r.r(t),r.d(t,{hasAccessDefaultFn:()=>O,hasAccessToCode:()=>L,hasAccessToProperty:()=>k,hasReadPermissionsAccess:()=>x,hasSameSpaceAccess:()=>v,testOnly:()=>S});r(122556),r(582845),r(250570),r(533019),r(721473),r(788208),r(22624),r(267602),r(653476);var n=()=>r(513670),o=()=>r(839002),s=()=>r(855741),i=()=>r(696459),a=()=>r(226413),l=()=>r(92960),c=()=>r(216316),p=()=>r(177634),f=()=>r(407589),d=()=>r(748627);function*h(e){const{collectionPointer:t,context:r,propertyId:n,propertySchema:o,visitedPointers:s,hasAccessFn:i}=e,a=(0,c().M)({...t,propertyId:n});if(s.has(a))return!0;s.add(a);const l=i({propertySchema:o,spaceId:r.spaceId});return"boolean"==typeof l?l:yield*l}function*u(e){var t,r;const{collectionPointer:o,depth:f,collectionSchema:h,context:u,propertyId:m,propertySchema:E,visitedPointers:O,hasAccessFn:x}=e;if("v2"!==E.version||f>l().FORMULA_MAX_DEPTH)return!1;const v=(0,c().M)({...o,propertyId:m});if(O.has(v))return!0;if(O.add(v),!(0,i().$K)(null===(t=E.formula2)||void 0===t?void 0:t.code))return!0;const k=(0,d().H)(null===(r=E.formula2)||void 0===r?void 0:r.code);if(s().x.isFail(k))return!1;const{spaceId:L}=u,S=(0,c().jm)({formulaTypecheckContextValues:[{kind:l().FormulaContextValueKind.ThisRow,type:{collection:o,type:"block"}}],node:k.value,spaceId:L}),U=(0,n().mN)(S,(e=>(0,c().M)(e)));if(0===U.length)return!0;const{getRecordModel:g}=yield{collectionBlockProperties:[{blockPointers:[],collectionPointer:o,property:m,schema:h}],recordPointers:U.filter((e=>(0,p().no)(e)))};for(const n of U)if((0,a().rv)(n)){const e=g(n);if(!(0,i().$K)(e))return!1;const t=n.propertyId,r=e.getSchema(),o=r[t];if(!o)continue;if((0,a().no)(o)||(0,a().AF)(o)){if(!(yield*y({collectionPointer:n,collectionSchema:r,context:u,depth:f+1,propertyId:t,propertySchema:o,visitedPointers:O,hasAccessFn:x})))return!1}else if((0,a().p_)(o)){if(!(yield*y({collectionPointer:n,collectionSchema:r,context:u,depth:f,propertyId:t,propertySchema:o,visitedPointers:O,hasAccessFn:x})))return!1}}else if(!(0,i().$K)(g(n)))return!1;return!0}function*m(e){const{collectionPointer:t,depth:r,collectionSchema:n,context:o,propertyId:s,propertySchema:i,visitedPointers:p,hasAccessFn:d}=e;if("v2"===i.version||r>l().FORMULA_MAX_DEPTH)return!1;const h=(0,c().M)({...t,propertyId:s});if(p.has(h))return!0;p.add(h);const u=(0,f().b$)(i.formula);if(0===u.length)return!0;for(const l of u){const e=n[l];if(e)if((0,a().no)(e)||(0,a().AF)(e)){if(!(yield*y({collectionPointer:t,depth:r+1,collectionSchema:n,context:o,propertyId:l,propertySchema:e,visitedPointers:p,hasAccessFn:d})))return!1}else if((0,a().p_)(e)){if(!(yield*y({collectionPointer:t,collectionSchema:n,context:o,depth:r,propertyId:l,propertySchema:e,visitedPointers:p,hasAccessFn:d})))return!1}}return!0}function*E(e){const{collectionPointer:t,depth:r,collectionSchema:n,context:o,propertyId:s,propertySchema:i,visitedPointers:p,hasAccessFn:f}=e;if(r>l().FORMULA_MAX_DEPTH)return!1;const d=(0,c().M)({...t,propertyId:s});if(p.has(d))return!0;if(p.add(d),!i.relation_property||!i.target_property)return!0;const h=n[i.relation_property];if(!h||"relation"!==h.type)return!0;const u=f({propertySchema:h,spaceId:o.spaceId});if(!("boolean"==typeof u?u:yield*u))return!1;const m=(0,a().j0)(h);if(!m)return!0;const{getRecordModel:E}=yield{recordPointers:[m]},O=E(m),x=null==O?void 0:O.getNormalizedSchema();if(i.target_property_type&&x){const e=x[i.target_property];if(e&&i.target_property_type===e.type){if((0,a().AF)(e))return yield*y({collectionPointer:m,collectionSchema:x,context:o,depth:r+1,propertyId:i.target_property,propertySchema:e,visitedPointers:p,hasAccessFn:f});if((0,a().p_)(e))return yield*y({collectionPointer:m,collectionSchema:x,context:o,depth:r,propertyId:i.target_property,propertySchema:e,visitedPointers:p,hasAccessFn:f})}}return!0}function*y(e){const{collectionPointer:t,depth:r,collectionSchema:n,context:o,propertyId:s,propertySchema:i,visitedPointers:l,hasAccessFn:c}=e;return(0,a().p_)(i)?yield*h({collectionPointer:t,context:o,propertyId:s,propertySchema:i,visitedPointers:l,hasAccessFn:c}):(0,a().AF)(i)?"v2"===i.version?yield*u({collectionPointer:t,depth:r,collectionSchema:n,context:o,propertyId:s,propertySchema:i,visitedPointers:l,hasAccessFn:c}):yield*m({collectionPointer:t,depth:r,collectionSchema:n,context:o,propertyId:s,propertySchema:i,visitedPointers:l,hasAccessFn:c}):!(0,a().no)(i)||(yield*E({collectionPointer:t,depth:r,collectionSchema:n,context:o,propertyId:s,propertySchema:i,visitedPointers:l,hasAccessFn:c}))}function*O(e){const{propertySchema:t,spaceId:r}=e,n=(0,a().j0)(t);if(!(0,i().$K)(n))return!0;const{getRecordModel:o}=yield{recordPointers:[n]},s=o(n);return(0,i().$K)(s)&&v({spaceId:r,propertySchema:t})}function*x(e){const{propertySchema:t}=e,r=(0,a().j0)(t);if(!(0,i().$K)(r))return!0;const{getRecordModel:n}=yield{recordPointers:[r]},o=n(r);return(0,i().$K)(o)}function v(e){const{propertySchema:t,spaceId:r}=e;return!(0,a().Qh)(r,t)}async function k(e){const{collectionPointer:t,collectionSchema:r,context:n,propertyId:s,hasAccessFn:i}=e,a=r[s];return!a||await async function(e){const{context:t}=e;try{const r=y(e);let n=r.next();for(;!n.done;){const e=t.handleDataRequest(n.value);n=r.next((0,o().tI)(e)?await e:e)}return n.value}catch(r){return!0}}({collectionPointer:t,depth:0,collectionSchema:r,context:n,propertyId:s,propertySchema:a,visitedPointers:new Set,hasAccessFn:i})}function L(e){const{context:t}=e;try{const r=function*(e){const{collectionPointer:t,depth:r,context:o,code:f,visitedPointers:h,hasAccessFn:u}=e,m=(0,d().H)(f);if(s().x.isFail(m))return!1;const{spaceId:E}=o,O=o.valueTypes.filter((e=>e.kind!==l().FormulaContextValueKind.ThisRow)),x=(0,c().jm)({formulaTypecheckContextValues:t?[...O,{kind:l().FormulaContextValueKind.ThisRow,type:{collection:t,type:"block"}}]:[],node:m.value,spaceId:E}),v=(0,n().mN)(x,(e=>(0,c().M)(e)));if(0===v.length)return!0;const{getRecordModel:k}=yield{collectionBlockProperties:[],recordPointers:v.filter((e=>(0,p().no)(e)))};for(const n of v)if((0,a().rv)(n)){const e=k(n);if(!(0,i().$K)(e))return!1;const t=n.propertyId,s=e.getSchema(),l=s[t];if(!l)continue;if((0,a().no)(l)||(0,a().AF)(l)){if(!(yield*y({collectionPointer:n,collectionSchema:s,context:o,depth:r+1,propertyId:t,propertySchema:l,visitedPointers:h,hasAccessFn:u})))return!1}else if((0,a().p_)(l)&&!(yield*y({collectionPointer:n,collectionSchema:s,context:o,depth:r,propertyId:t,propertySchema:l,visitedPointers:h,hasAccessFn:u})))return!1}else if(!(0,i().$K)(k(n)))return!1;return!0}(e);let o=r.next();for(;!o.done;){const e=t.handleDataRequest(o.value);o=r.next(e)}return o.value}catch(r){return!0}}const S={hasAccessDefaultFn:O,hasAccessToProperty:k,hasAccessToFormula1Property:m,hasAccessToFormula2Property:u,hasAccessToRelationProperty:h,hasAccessToRollupProperty:E}},748627:(e,t,r)=>{r.d(t,{H:()=>f,k:()=>c});r(821057),r(670560),r(267602),r(653476);var n=()=>r(799891),o=()=>r(942265),s=()=>r(92960),i=()=>r(414853),a=()=>r(549045),l=()=>r(455222);function c(e,t){const r=(0,a().XR)(),o=(0,a().s)(r).tokenize(e),c=[];for(const n of o.errors)c.push((0,a().Nh)(n));for(const n of o.tokens.filter((e=>e.tokenType===r.UnclosedStringLiteral||e.tokenType===r.UnclosedComment)))c.push({type:n.tokenType===r.UnclosedStringLiteral?l().$E.UnclosedStringLiteral:l().$E.UnclosedComment,offset:t?(0,i().aU)(t,n.startOffset,"left"):n.startOffset});for(const n of o.tokens.filter((e=>e.tokenType===r.StringLiteral)))s().FORMULA_TOKEN_REGEX.test(n.image)&&c.push({type:l().$E.StringLiteralContainsToken,offset:t?(0,i().aU)(t,n.startOffset,"left"):n.startOffset});try{const e=(0,a().Z8)(r);e.input=o.tokens;const t=e.expression();for(const r of e.errors)c.push((0,a().mK)(r));return[t,c]}catch(p){if(p instanceof RangeError&&"Maximum call stack size exceeded"===p.message)c.push({type:l().$E.TooDeeplyNested,offset:0});else{const e=p instanceof Error?p:new Error("Unknown parsing error");n().log({level:"error",from:"parseFormulaInputToCst",type:"formulaParserUnexpectedError",error:e}),c.push({type:l().$E.UnexpectedError,offset:0,error:e})}return[{name:"",children:{}},c]}}const p=new WeakMap;function f(e){let t=p.get(e);if(void 0!==t)return t;const[r,n]=(0,i().dJ)(e),[s,a]=c(r);return t=a.length>0?{error:a[0]}:(0,o().K)(s),p.set(e,t),t}}}]);