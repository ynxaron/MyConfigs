"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[98032],{298032:(e,t,o)=>{o.d(t,{rU:()=>re,ao:()=>ae,OI:()=>ie});o(267602),o(470928);var n=()=>o(353329),r=()=>o(530980),a=()=>o(139978),i=()=>o(483791),l=()=>o(513670),c=()=>o(696459),p=()=>o(984871),d=()=>o(102182),s=()=>o(269299),m=()=>o(641702),u=()=>o(527278),y=()=>o(826955),f=()=>o(281236),v=()=>o(382474);function g(e){var t;let{environment:o,collectionStore:r,collectionViewValue:a,dependencyMap:i,logger:l}=e;if((0,f().remapPropertyIds)({collectionStore:r,object:a,dependencyMap:i}),function(e){let{environment:t,spaceId:o,collectionViewValue:n,logger:r}=e;for(const l of(null===(a=n.format)||void 0===a?void 0:a.collection_groups)??[]){var a,i;const{value:e}=l;if(("created_by"===e.type||"last_edited_by"===e.type)&&"notion_user"===(null===(i=e.value)||void 0===i?void 0:i.table)){const n=t.currentUser.id;if(!n){r.warn("No current user ID, unable to remap collection group user to current user!");continue}r.log(`Remapping user ID ${e.value.id} to ${n} in collection view group.`),e.value.id=n,e.value.spaceId=o}}}({environment:o,spaceId:r.getSpaceId(),collectionViewValue:a,logger:l}),a.query2&&function(e){let{collectionStore:t,query2:o,dependencyMap:r}=e;for(const a of n().py){const e=o[a];e&&(o[a]=(0,v().Zl)({collectionStore:t,sourceTemplateType:"property",dependencyMap:r,sourcePrimitiveId:e}))}}({collectionStore:r,query2:a.query2,dependencyMap:i}),"object"==typeof(null===(t=a.format)||void 0===t?void 0:t.collection_view_default_template)){const e=(0,v().CX)({collectionStore:r,sourceTemplateType:"block",dependencyMap:i,sourcePrimitiveId:a.format.collection_view_default_template.template_page_id});e?a.format.collection_view_default_template={template_page_id:e}:(l.warn("Unable to resolve collection_view default template, omitting it."),delete a.format.collection_view_default_template)}}o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(241792),o(653476),o(670560);var I=()=>o(780741);const S=Symbol("BuilderKey");_({type:"property",id:o(226413).iw});function _(e){return(0,c().lD)(`${e.type}:${e.id}`,S)}function h(e){let{collectionStore:t,modules:o,dependencyMap:n}=e;return b({modules:o,mapper:w(t,n)})}function w(e,t){return o=>(0,v().Zl)({collectionStore:e,sourceTemplateType:"property",sourcePrimitiveId:o,dependencyMap:t})}function b(e){let{modules:t,mapper:o}=e;const n=e=>e?e.map((e=>function(e){let{module:t,mapper:o}=e;switch(t.type){case"bottomControls":case"relationsGroup":case"cover":case"discussions":case"editor":case"expandedBacklinks":case"formQuestion":case"formSubmit":case"formTitle":case"inlinePageSections":case"placeholder":case"properties":case"transcript":case"viewsMain":return t;case"property":return{...t,propertyId:o(t.propertyId)};case"titleWithIcon":return{...t,propertyIds:t.propertyIds?t.propertyIds.map(o):void 0};case"views":return{...t,relation_pointer:t.relation_pointer?{...t.relation_pointer,property:o(t.relation_pointer.property)}:void 0}}return t}({module:e,mapper:o}))):void 0;return{page_layout_schema:n(t.page_layout_schema),page_info_layout_schema:n(t.page_info_layout_schema),form_layout_schema:n(t.form_layout_schema)}}var T=o.n(o(369282)),k=()=>o(764052),P=()=>o(177634),M=()=>o(956057),C=()=>o(275138),$=()=>o(827370),D=()=>o(494616),F=()=>o(922713),V=()=>o(396136),x=()=>o(752778),N=()=>o(989478),A=()=>o(49396),O=()=>o(205228),R=()=>o(487270);function U(e){let{collectionStore:t,environment:o,logger:n,template:a,transaction:i}=e;const l=function(e){let{environment:t,logger:o,parentStore:n,template:a,transaction:i}=e;const l=(0,R().Ii)({environment:t,spaceId:n.getSpaceId(),table:D().cv}),c=t.currentUser.id,p=r().kk5.fromAutomation({alive:!0,created_by_id:c??"",created_by_table:N().KJ,created_time:Date.now(),id:l.id,parent_id:n.pointer.id,parent_table:n.pointer.table,space_id:n.getSpaceId(),trigger:{...a.value.trigger,id:M().Il()},version:0,last_edited_by_id:c??"",last_edited_by_table:N().KJ,last_edited_time:Date.now(),status:"active"}),d=j({actionPlaceholderIdToActionId:new Map,collectionStore:n,dependencyMap:a.dependencyMap,logger:o}),{value:s}=(0,k().R)({automationModel:p,visitors:d}),m=s.getTrigger(),u=A().createAutomation({actionIds:[],environment:t,automationId:l.id,automationName:a.value.name,parentPointer:n.getSpaceShardedPointer(),transaction:i,trigger:m});return u}({environment:o,logger:n,parentStore:t,template:a,transaction:i}),c=new Map;return a.value.actions.map((e=>function(e){let{actionPlaceholderIdToActionId:t,actionTemplate:o,collectionStore:n,environment:r,logger:a,parentStore:i,parentTemplate:l,transaction:c}=e;const p=(0,R().Ii)({environment:r,spaceId:i.getSpaceId(),table:F().Xj}),{config:d,placeholderId:s,type:m}=o,{model:y}=C().IN.create({alive:!0,config:d,id:p.id,parent_id:i.pointer.id,parent_table:i.pointer.table,space_id:n.getSpaceId(),type:m,version:0}),f=j({actionPlaceholderIdToActionId:t,collectionStore:n,dependencyMap:l.dependencyMap,logger:a}),{value:v}=(0,k().e)({automationActionModel:y,baseUrl:O().default.domainBaseUrl,preventClearingConfig:!0,publicDomainName:O().default.publicDomainName,sourceSpaceId:n.getSpaceId(),visitors:f}),g=v.getConfig(),I=A().addAutomationAction({actionId:p.id,actionType:o.type,automationStore:i,config:g,createDuplicateBlocksContainer:!0,environment:r,intl:u().Z.getIntl(),transaction:c});return T()(I,"Failed to create automation action"),t.set(s,I.id),I}({actionPlaceholderIdToActionId:c,actionTemplate:e,collectionStore:t,environment:o,logger:n,parentStore:l,parentTemplate:a,transaction:i}))),l.isTriggerType("event")&&s().applyOperation({store:t,operation:{pointer:t.pointer,path:["format","automation_ids"],command:"listAfter",args:{id:l.id}},transaction:i}),{id:l.id,spaceId:t.getSpaceId(),type:"automation"}}function j(e){const{actionPlaceholderIdToActionId:t,collectionStore:o,dependencyMap:n,logger:r}=e;function i(e){const o=(0,P().MY)(e);if("action"===o.source){const e=t.get(o.action_id)??o.action_id;return(0,P().Kd)({...o,action_id:e})}if("global"===o.source)return e;(0,c().t1)(o)}function p(e){if(!n)return;if("title"===e)return e;const t=(0,v().CX)({collectionStore:o,sourceTemplateType:"property",sourcePrimitiveId:e,dependencyMap:n});return t||r.warn(`Failed to remap property ID ${e} in automation template`),t}return{visitCollectionProperty:e=>n?{type:"replace",value:p(e)}:{type:"keep"},visitCollectionPropertyPointer:e=>{if(!n)return{type:"keep"};const t=p(e.propertyId);if(!t)return{type:"replace",value:void 0};const a=(0,v().CX)({collectionStore:o,sourceTemplateType:"collection",sourcePrimitiveId:e.id,dependencyMap:n});return a?{type:"replace",value:{id:a,propertyId:t,spaceId:o.getSpaceId(),table:x().vF}}:(r.warn(`Failed to remap collection ID ${e.id} in automation template`),{type:"replace",value:void 0})},visitFormulaContextValue:e=>({type:"replace",value:i(e)}),visitFormulaPageProperty:e=>{if(!n)return{type:"keep"};const t=(0,l().Xh)(e),a=p(e.property);if(!a)return{type:"replace",value:void 0};if(t.property=a,"collection"in t&&t.collection){const e=(0,v().CX)({collectionStore:o,sourceTemplateType:x().vF,sourcePrimitiveId:t.collection.id,dependencyMap:n});if(!e)return r.warn(`Failed to remap collection ID ${t.collection.id} in automation template`),{type:"replace",value:void 0};t.collection=$().dr.fromSpaceShardRecordId({id:e,spaceId:o.getSpaceId()},x().vF)}else"contextValueId"in t&&t.contextValueId&&(t.contextValueId=i(t.contextValueId));return{type:"replace",value:t}},visitRecordPointer:e=>{if(!n)return{type:"keep"};if(e.table===V().iU||e.table===x().vF||e.table===D().cv||e.table===a().np){const t=(0,v().CX)({collectionStore:o,sourceTemplateType:e.table,sourcePrimitiveId:e.id,dependencyMap:n});return t?{type:"replace",value:$().dr.fromSpaceShardRecordId({id:t,spaceId:o.getSpaceId()},e.table)}:(r.warn(`Failed to remap record pointer ${$().dr.toKey(e)} in automation template`),{type:"replace",value:void 0})}return{type:"keep"}}}}o(821057);var E=()=>o(217465),B=()=>o(282662),X=()=>o(332542),Z=()=>o(872308);var q=()=>o(636340);function L(e){let{environment:t,transaction:o,collectionStore:n,template:r,logger:i}=e;const l=n.getParentBlockStore();if(!l)throw new Error("Collection view block store not found");const{value:c,dependencyMap:p}=r;if(!p)throw new Error("Dependency map not defined on view template");g({environment:t,collectionStore:n,collectionViewValue:c,dependencyMap:p,logger:i}),function(e){var t;let{collectionStore:o,collectionViewValue:n}=e;const r=null===(t=n.format)||void 0===t?void 0:t.table_properties;if(!r)return;const a=r.map((e=>e.property)),i=Object.keys(o.getSchema()).filter((e=>!a.includes(e)));for(const l of i)r.push({property:l,visible:!1})}({collectionStore:n,collectionViewValue:c});const d=q().ae({environment:t,table:a().np,inMemoryRecordCache:l.inMemoryRecordCache,value:{...c,parent_id:l.id,parent_table:l.table,space_id:l.getSpaceId(),format:{...c.format,collection_pointer:n.pointer},alive:!0},transaction:o}),s=y().Xr.createChildStore(l,d.pointer);return B().R3({parentStore:l.getCollectionViewsStore(),appendStore:s,transaction:o}),{type:"collection_view",id:s.id}}var K=()=>o(342792);var W=()=>o(349220),H=()=>o(142730);var Q=()=>o(216316),J=()=>o(543172),z=()=>o(932753),G=()=>o(90065);function Y(e){const{environment:t,logger:o,transaction:r,collectionStore:a,template:i}=e,c=function(e){if("title"===e.value.type)return"title";if(e.templateId===I().FL)return G().EI.Verification;if(e.templateId===I().Iu)return G().EI.Owner;return(0,J().ZP)()}(i);if((0,n().dI)(i,"formula"))ee({...e,template:i});else if((0,n().IH)(i)){const t=f().globalWorkflowTemplates.featureFromId(i.buttonAutomationId);o.log(`Instantiating dependency "${t.templateId}" of button property template "${i.templateId}".`);const n=ae({...e,template:t});if(!n)throw new Error(`Failed to create instance of automation template "${t.templateId}"`);if("automation"!==n.type)throw new Error(`Unexpected instance pointer. Expected "automation" but got "${n.type}"`);i.value.automation_id=n.id}const p=(0,l().Xh)(i.value);return p.workflow_template_instance={template_id:i.templateId},z().xO({environment:t,collectionStore:a,update:{[c]:p},transaction:r}),{type:"property",id:c,collectionId:a.id}}function ee(e){let{template:t,collectionStore:o}=e;const{value:n,dependencyMap:r}=t;if(!r)return;if(!n.formula2)return;const{value:a}=(0,Q().RA)({baseUrl:O().default.domainBaseUrl,formula:n.formula2.code,publicDomainName:O().default.publicDomainName,spaceId:o.getSpaceId(),visitors:{visitFormulaContextValue:void 0,visitFormulaPageProperty:e=>{const t={...e};return t.property=(0,v().Zl)({dependencyMap:r,collectionStore:o,sourcePrimitiveId:e.property,sourceTemplateType:"property"}),"collection"in t&&t.collection&&(t.collection=o.pointer),{type:"replace",value:t}},visitRecordPointer:void 0}});n.formula2.code=a}var te=()=>o(688745),oe=()=>o(737128);const ne=(0,o(788860).vU)({thisDatabase:{id:"thisDatabase",defaultMessage:"this database"},featureTemplateCreatedConfirmation:{id:"featureTemplateCreatedConfirmation",defaultMessage:"Added {featureName} to {collectionName}"},featureTemplateLinkedConfirmation:{id:"featureTemplateLinkedConfirmation",defaultMessage:"Linked an existing {featureName} to {collectionName}"}});function re(e){let{environment:t,transaction:o,collectionStore:l,template:c,logger:p,origin:I}=e;const S=ae({transaction:o,environment:t,collectionStore:l,template:c,logger:p,origin:I}),_=(0,f().getPropertyTemplates)([c]);return(0,oe().U)({transaction:o,collectionStore:l,propertyTemplates:_}),(0,oe().M)({transaction:o,collectionStore:l,propertyTemplates:_}),function(e){let{environment:t,transaction:o,collectionStore:n,template:l,logger:c}=e;const p=(0,v().Vc)({environment:t,collectionStore:n});for(const{instancePointer:d,templateId:m}of p){const e=f().globalWorkflowTemplates.fromId(m);if(!("dependencyMap"in e)||!e.dependencyMap)continue;if(!Object.values(e.dependencyMap).includes(l.templateId))continue;c.log(`Remapping dependency "${l.templateId}" in "${m}".`);const p={};if("layout"===d.type){const e=y().xj.createChildStore(n,{table:i().Bh,id:d.id,spaceId:d.spaceId}),t=e.getRawModules();if(t){const a=h({collectionStore:n,modules:t,dependencyMap:p});s().applyOperation({transaction:o,store:e,operation:r().CIp.updateModules(e.pointer,a)})}}else if("collection_view"===d.type){const e=y().Xr.createChildStore(n,{table:a().np,id:d.id}),o=e.getType();if(!o)continue;g({environment:t,collectionStore:n,collectionViewValue:{type:o,name:e.getName(),format:e.getFormat(),query2:e.getRawQuery()},dependencyMap:p,logger:c})}else c.warn(`Don't know how to remap instance type "${d.type}"!`)}}({environment:t,transaction:o,collectionStore:l,template:c,logger:p}),function(e){let{collectionStore:t,template:o}=e;const r=(0,f().getWorkflowTemplateName)(o),a=(0,m().Xh)(t.getName(),t),i=a.length>0?a:u().Z.formatMessage(ne.thisDatabase);(0,n().yw)(o)?d().oV({label:u().Z.formatMessage(ne.featureTemplateLinkedConfirmation,{featureName:r,collectionName:i})}):d().oV({label:u().Z.formatMessage(ne.featureTemplateCreatedConfirmation,{featureName:r,collectionName:i})})}({collectionStore:l,template:c}),S}function ae(e){const{collectionStore:t,template:o,transaction:r}=e;!function(e){const{template:t,logger:o}=e,r=(0,n().EL)({template:t,logger:o}),{environment:a,collectionStore:i}=e;for(const n of r){(0,v().A5)({environment:a,scopeStore:i,templateId:n.templateId})||(o.log(`Template "${t.templateId}" has implicit dependency "${n.templateId}" (source: ${n.debugSource}), instantiating it.`),ae({...e,template:f().globalWorkflowTemplates.featureFromId(n.templateId)}))}}(e);const a=function(e){const{logger:t}=e,o=l().Xh(e.template),{type:r}=o;switch(t.log(`Instantiating ${r} template "${o.templateId}".`),r){case"property":return Y({...e,template:o});case"collection_view":return L({...e,template:o});case"layout":return function(e){let{environment:t,transaction:o,collectionStore:n,template:r}=e;if(!r.dependencyMap)throw new Error("Dependency map not defined on layout template");const a=h({collectionStore:n,modules:{page_layout_schema:void 0,page_info_layout_schema:void 0,form_layout_schema:void 0,...r.value},dependencyMap:r.dependencyMap}),{model:i}=(0,H().m2)({environment:t,transaction:o,collectionStore:n,userId:(0,W().TO)(t.currentUser.id),modules:a});return{type:"layout",id:i.id,spaceId:n.getSpaceId()}}({...e,template:o});case"compound":return function(e){const{environment:t,template:o,collectionStore:r,logger:a}=e,i=[],l=e=>{if(!(0,v().cb)(e)||"compound"===e.type)throw new Error(`Template in compound template generated a non-feature instance pointer of an illegal type: ${e.type}`);i.push(e)};for(const c of o.value.templateItems){const{optionality:i,pointer:p}=c;if("optionalDefaultOff"===i)continue;const d=(0,v().A5)({environment:t,scopeStore:r,templateId:c.pointer});if(d){l(d);continue}const s=f().globalWorkflowTemplates.fromId(p);if(!(0,n().qu)(s))throw new Error(`${s.templateId} in compound template is of an illegal type: ${s.type}`);a.log(`Instantiating dependency "${s.templateId}" of compound template "${o.templateId}".`);const m=re({...e,template:s});m&&l(m)}return{type:"compound",id:(0,K().ZP)(),instancePointers:i,collectionId:r.id}}({...e,template:o});case"block":return function(e){let{environment:t,transaction:o,collectionStore:n,template:r}=e;const a=(0,R().Ii)({environment:t,spaceId:n.getSpaceId(),table:V().iU});if("block"!==r.type)throw new Error(`Expected block template, got ${r.type} template: ${r.templateId}`);if(!r.dependencyMap)throw new Error(`Dependency map not defined on block template: ${r.templateId}`);const{dependencyMap:i}=r,l=E().RecordMap.create(r.value.recordMap),c=l.getModel(r.value.blockPointer);if(c){const e=c.getProperties();for(const[t,o]of Object.entries(e)){const r=(0,v().Zl)({collectionStore:n,sourceTemplateType:"property",sourcePrimitiveId:t,dependencyMap:i});r&&(delete e[t],e[r]=o)}}const{targetBlockStore:p}=Z().localDuplicate({environment:t,sourceBlockId:r.value.blockPointer.id,targetBlockPointer:a,sourceBlockSubtree:l,transaction:o,deepCopyTransclusionContainers:!1,targetInMemoryRecordCache:n.inMemoryRecordCache,resolveTemplateVariables:!1});return X().zw({childStore:p,parentStore:n,transaction:o}),p.isTemplate()&&B().R3({parentStore:n.getTemplatePagesStore(),appendStore:p,transaction:o}),{type:"block",id:p.id,spaceId:n.getSpaceId()}}({...e,template:o});case"automation":return U({...e,template:o});default:(0,c().t1)(r)}}(e);return a&&(0,te().cP)({transaction:r,collectionStore:t,templateId:o.templateId,instance:a,logger:e.logger}),a}function ie(e){let{environment:t,transaction:o,template:n,collectionStore:r}=e;const{type:a,templateId:i}=n;switch(a){case"compound":!function(e){var t;let{environment:o,transaction:n,collectionStore:r,templateId:a}=e;const i=null===(t=r.getFormat().compound_workflow_template_instances)||void 0===t?void 0:t.find((e=>e.template_id===a));if(i)for(const l of i.instance_pointers){const e=(0,v().ip)({environment:o,collectionStore:r,instancePointerId:l.id});e&&ie({environment:o,transaction:n,template:e,collectionStore:r})}}({environment:t,transaction:o,collectionStore:r,templateId:i});break;case"property":!function(e){let{environment:t,transaction:o,collectionStore:n,templateId:r}=e;const a=n.getSchema(),i=Object.entries(a).find((e=>{var t;let[o,n]=e;return r===(null==n||null===(t=n.workflow_template_instance)||void 0===t?void 0:t.template_id)}));if(!i)return;const[l]=i;p().E2({environment:t,collectionStore:n,schema:n.getSchema(),property:l,transaction:o,permanentlyDelete:!1})}({environment:t,transaction:o,collectionStore:r,templateId:i});break;case"collection_view":case"layout":case"block":case"automation":break;default:(0,c().t1)(a)}}},688745:(e,t,o)=>{o.d(t,{D5:()=>k,Ym:()=>T,cP:()=>b});o(821057),o(267602),o(916054),o(653476),o(241792),o(667294);var n=()=>o(146947),r=()=>o(780741),a=()=>o(481529),i=()=>o(494616),l=()=>o(396136),c=()=>o(752778),p=()=>o(139978),d=()=>o(483791),s=()=>o(212360),m=()=>o(788860),u=()=>o(513670),y=()=>o(696459),f=()=>o(250303),v=()=>o(984871),g=()=>o(308186),I=()=>o(269299),S=()=>o(90065),_=()=>o(826955),h=()=>o(382474),w=o(785893);function b(e){let{transaction:t,collectionStore:o,templateId:n,instance:r,logger:m}=e;m.debug(`Creating/updating ${s().qB} record for "${n}".`);const u=o.getSpaceId(),f=r.id;if("automation"===r.type){const e={table:i().cv,id:f,spaceId:u};I().applyOperation({store:_().Mz.createChildStore(o,e),operation:a().op.set({pointer:e,path:["properties","workflow_template_instance"],args:{template_id:n}}),transaction:t})}else if("block"===r.type){const e={table:l().iU,id:f,spaceId:u};I().applyOperation({store:_().G.createChildStore(o,e),operation:a().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:n}}),transaction:t})}else if("collection"===r.type){const e={table:c().vF,id:f,spaceId:u};I().applyOperation({store:o,operation:a().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:n}}),transaction:t})}else if("collection_view"===r.type){const e={table:p().np,id:f,spaceId:u};I().applyOperation({store:_().Xr.createChildStore(o,e),operation:a().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:n}}),transaction:t})}else if("layout"===r.type){const e={table:d().Bh,id:f,spaceId:u};I().applyOperation({store:_().xj.createChildStore(o,e),operation:a().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:n}}),transaction:t})}else if("compound"===r.type){if(r.instancePointers.length<2)throw new Error(`Compound template instance ${r.id} must contain 2 or more instances`);const e=r.instancePointers.map((e=>{switch(e.type){case"automation":return{type:"automation",id:e.id};case"block":return{type:"block",id:e.id};case"collection_view":return{type:"collection_view",id:e.id};case"layout":return{type:"layout",id:e.id};case"property":return{type:"property",id:e.id}}(0,y().t1)(e)}));I().applyOperation({store:o,operation:{command:"keyedObjectListUpdate",pointer:o.pointer,path:["format","compound_workflow_template_instances"],args:{value:{template_id:n,id:r.id,instance_pointers:e}}},transaction:t})}else"property"===r.type?I().applyOperation({store:o,operation:a().op.update({pointer:o.pointer,path:["schema",r.id],args:{workflow_template_instance:{template_id:n}}}),transaction:t}):(0,y().t1)(r)}function T(e){let{environment:t,collectionStore:o,propertyId:n,compoundTemplateInstancesToDelete:a,collectionContextStore:i,from:l}=e;if(!a.every((e=>e.templateId===r()._5)))return!1;if(!(0,S().h$)())return!1;const c=(0,h().OA)({environment:t,collectionStore:o,compoundTemplateInstancesToDelete:a}),p=u().jj(c.filter((e=>"property"===e.type&&e.id!==n)).map((e=>e.id)));return P({environment:t,collectionStore:o,clickedPropertyId:n,otherPropertyIds:p,collectionContextStore:i,from:l}),!0}function k(e){let{environment:t,collectionStore:o,propertyId:n,collectionContextStore:r,from:a}=e;const i=o.getSchema(),l=Object.keys(i).filter((e=>e!==n&&((0,S().TJ)({collectionStore:o,propertyId:e})||(0,S().e_)(e))));return P({environment:t,collectionStore:o,clickedPropertyId:n,otherPropertyIds:l,collectionContextStore:r,from:a}),!0}function P(e){var t;let{environment:o,collectionStore:r,clickedPropertyId:a,otherPropertyIds:i,collectionContextStore:l,from:c}=e;const p=[a,...i],d=[{label:(0,w.jsx)(m()._H,{id:"workflowTemplateInstanceActions.deleteRequiredProperty.deleteOption",defaultMessage:"{count, plural, one {Delete {count} property} other {Delete {count} properties}}",values:{count:p.length}}),color:"red",onAccept:()=>function(e){let{environment:t,collectionStore:o,collectionContextStore:n,propertyIds:r,from:a}=e;I().createAndCommit({userAction:"workflowTemplateInstanceActions.handleDeleteAccept",environment:t,canUndo:!0,perform:e=>{const i=o.getSchema();for(const l of r){v().E2({environment:t,collectionStore:o,schema:i,property:l,transaction:e});const r=i[l];r&&f().y9({environment:t,collectionContextStore:n,property_type:r.type,from:a,property:l})}}})}({environment:o,collectionStore:r,collectionContextStore:l,propertyIds:p,from:c})}],s=r.getSchema(),u=i.map((e=>{if(e===a)return;const t=s[e];return null==t?void 0:t.name})).filter(y().$K),S=null===(t=s[a])||void 0===t?void 0:t.name,_=new Intl.ListFormat(n().locale,{style:"long",type:"conjunction"}),h=(0,w.jsx)(m()._H,{id:"workflowTemplateInstanceActions.deleteRequiredProperty.deletePropertyFromDb",defaultMessage:"{hasPropertyName, select, true {Delete {propertyName} from this database? This will also delete the following properties: {otherPropertyNames}} other {Delete this property from this database? This will also delete the following properties: {otherPropertyNames}}}",values:{hasPropertyName:Boolean(S),propertyName:S,otherPropertyNames:_.format(u)}});g().vC({message:(0,w.jsx)("span",{children:h}),showCancel:!0,keepFocus:!0,innerStyle:{width:400},items:d})}},737128:(e,t,o)=>{o.d(t,{M:()=>l,U:()=>i});o(670560),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(653476),o(241792);var n=()=>o(353329),r=()=>o(421654),a=()=>o(382474);function i(e){var t;let{transaction:o,collectionStore:i,propertyTemplates:l}=e;const c=(null===(t=i.getParentBlockStore())||void 0===t?void 0:t.getCollectionViewStores().filter((e=>"table"===e.getType())))??[];if(0===c.length)return;const p=[];for(const r of l){const e=(0,a().ZQ)({collectionStore:i,templateId:r.templateId,instancePointerType:"property"});e&&p.push({property:e.id,visible:!(0,n().yw)(r),...r.tablePropertyFormat})}if(0!==p.length)for(const n of c){var d;const e=(null===(d=n.getPropertyFormatsStore("table_properties"))||void 0===d?void 0:d.getValue())??[],t=new Set(e.map((e=>e.property))),a=p.filter((e=>!t.has(e.property)));0!==a.length&&r().FH({stores:[n],update:{table_properties:[...e,...a]},transaction:o})}}function l(e){let{transaction:t,collectionStore:o,propertyTemplates:n}=e;const i=[];for(const r of n){const e=(0,a().ZQ)({collectionStore:o,templateId:r.templateId,instancePointerType:"property"});e&&i.push({property:e.id,visible:!0})}const l=o.getFormat().collection_page_properties??[],c=new Set(l.map((e=>e.property))),p=i.filter((e=>!c.has(e.property)));p.length&&r().FH({stores:[o],update:{collection_page_properties:[...l,...p]},transaction:t})}}}]);