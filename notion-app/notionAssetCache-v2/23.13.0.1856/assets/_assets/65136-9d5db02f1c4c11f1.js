"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[65136],{790819:(e,t,o)=>{o.d(t,{S:()=>s});var r=o(667294),n=()=>o(707513),a=()=>o(486539),i=o(785893);const l={height:"auto",maxWidth:"auto",paddingInline:4},s=(0,r.forwardRef)((function(e,t){const{children:s,disabled:c,hasActionRequired:p,errorIcon:d,icon:m,isCompact:g,isError:y,isSecondary:h,onClick:f,style:v,tooltipMessage:x,dropdownButtonType:S}=e,b=(0,o(219727).O7)(),C="dropdown"===S,k=(0,o(846550).yK)((e=>({button:{...u(e,{isError:y,hasActionRequired:p,isSecondary:h,dropdownButtonType:S}),gap:2,padding:"0 6px",...g?l:void 0,...C&&{alignItems:"center",height:20,paddingBlock:0,marginBlock:0},...v},children:{...n().Yu,lineHeight:"20px",flex:"1 1 auto",display:"grid",gridTemplateColumns:"auto auto",gap:2,...C&&{padding:"0 2px"}},icon:{width:16,height:16,marginRight:2,...y?{fill:e.lightErrorText}:void 0},warningIcon:{color:e.errorText,fill:e.errorText,height:12,flex:"0 0 auto",marginRight:2,width:12},chevronIcon:{fill:e.icon.secondary,flex:"0 0 auto",...g?{height:12,width:12}:{height:14,width:14},...C&&{fill:"unset"}}})),[y,p,h,S,g,C,v]),T=(0,r.useMemo)((()=>m?()=>m(k.icon):void 0),[m,k.icon]),M=(0,r.useCallback)((()=>x??null),[x]),_=(0,r.useCallback)((e=>{o(990966).clear({environment:b}),o(879952).ZH({environment:b}),null==f||f(e),e.stopPropagation()}),[b,f]),j=d||o(735501).t,P=y?()=>j(k.warningIcon):T;return(0,i.jsx)(o(654133).Z,{delayThreshold:0,disableTooltip:!Boolean(x),placement:o(998901).Placement.Bottom,render:e=>"dropdown"===S?(0,i.jsxs)(o(687626).Z,{...e,variant:y?"secondary":"lightGray",disabled:c,disabledFeedback:c,onClick:_,ref:t,style:k.button,children:[P&&P(),(0,i.jsx)("div",{style:k.children,children:s}),g?(0,o(536691).A)(k.chevronIcon):(0,a().Y)(k.chevronIcon)]}):(0,i.jsxs)(o(92175).Z,{...e,icon:y?P:T,disabled:c,disabledFeedback:c,onClick:_,ref:t,shouldShrink:!0,style:k.button,isRed:y,children:[(0,i.jsx)("div",{style:k.children,children:s}),(0,a().Y)(k.chevronIcon)]}),renderTooltip:M})}));function u(e,t){const{isError:o,hasActionRequired:r,isSecondary:a,dropdownButtonType:i}=t;return o?{color:e.errorText,..."dropdown"===i&&{boxShadow:"none"}}:r?{fontWeight:n().Ue.regular,color:e.text.secondary}:a?{color:e.text.secondary}:{fontWeight:n().Ue.regular,color:e.text.primary}}},703760:(e,t,o)=>{o.d(t,{D:()=>i});o(667294);var r=()=>o(846550),n=()=>o(154186),a=o(785893);function i(e){const{ariaLabel:t,disabled:o,icon:i,onClick:l,title:s}=e,u=(0,r().yK)((e=>({button:{alignItems:"center",border:`1px solid ${e.stroke.secondary}`,borderRadius:10,color:e.text.secondary,display:"flex",gap:8,justifyContent:"flex-start",padding:12},buttonHoveredStyle:{background:e.outlineButtonHoveredBackground},buttonPressedStyle:{background:e.buttonPressedBackground},iconContainer:{fill:e.icon.secondary,width:20,height:20,display:"flex",justifyContent:"center",alignItems:"center"},title:{fontSize:14,lineHeight:"20px"}})),[]);return(0,a.jsxs)(n().Z,{ariaLabel:t,disabled:o,disabledFeedback:o,onClick:l,style:u.button,hoveredStyle:u.buttonHoveredStyle,pressedStyle:u.buttonPressedStyle,children:[i&&(0,a.jsx)("div",{"aria-hidden":"true",style:u.iconContainer,children:i}),(0,a.jsx)("div",{style:u.title,children:s})]})}},196007:(e,t,o)=>{o.d(t,{dN:()=>D,nT:()=>$,HC:()=>U,RD:()=>W});o(267602),o(228244);var r=o(667294),n=()=>o(219727),a=()=>o(142735),i=()=>o(846550),l=()=>o(788860),s=()=>o(707513),u=()=>o(448419),c=()=>o(1910),p=(o(653476),o(241792),()=>o(827973)),d=()=>o(388284),m=()=>o(522319),g=o(785893);function y(e){let{disabled:t,handleSelectOperator:o,selectedItem:a}=e;const c=(0,n().Fy)(),y=(0,i().yK)((e=>({buttonWrap:{height:"initial"},buttonStyle:{fontSize:c.isMobile?14:12,height:18,lineHeight:"unset",marginRight:2,marginLeft:2,paddingLeft:2,paddingRight:2,textTransform:"lowercase",fontWeight:s().Ue.semibold,...t?{opacity:"unset",color:"unset"}:{color:e.lightTextColor}},downIconStyle:{...t?{fill:"unset",opacity:"unset"}:{fill:e.lightTextColor}}})),[c.isMobile,t]),h=Object.values(f).filter((e=>e.shown)),v=(0,r.useMemo)((()=>f[a].shown?f[a]:f.all),[a]);return(0,g.jsx)(m().Z,{disabled:t,alignmentToOrigin:u().vR.Start,style:y.buttonWrap,innerButtonStyle:y.buttonStyle,downIconStyle:y.downIconStyle,selectedTitle:(0,g.jsx)(l()._H,{...v.text}),renderMenuSections:e=>[{key:"selectTriggerOperator",render:e=>(0,g.jsx)(d().Z,{...e}),items:h.map((t=>({key:t.value,action:()=>{o(t.value),e.close()},render:e=>(0,g.jsx)(p().Z,{...e,title:(0,g.jsx)(l()._H,{...t.text})})})))}]})}const h=(0,l().vU)({allOf:{id:"automations.propertyTrigger.all",defaultMessage:"All of"},anyOf:{id:"automations.propertyTrigger.any",defaultMessage:"Any of"},all:{id:"automations.builderModal.propertyTrigger.all",defaultMessage:"All"},any:{id:"automations.builderModal.propertyTrigger.any",defaultMessage:"Any"}}),f={all:{text:h.all,value:"all",shown:!0},some:{text:h.any,value:"some",shown:!0},none:{shown:!1,value:"none"},any:{shown:!1,value:"any"}};var v=()=>o(135515),x=()=>o(637118),S=()=>o(676279),b=()=>o(809638),C=()=>o(703760);const k=(0,o(827282).IU)("cursorArrowClick2",{viewBox:"0 0 20 20",svg:(0,g.jsxs)("g",{children:[(0,g.jsx)("path",{d:"M0 10.18c0 3.74 2.158 7.04 5.107 8.661 1.026.577 1.875-.79.743-1.445-2.452-1.367-4.18-4.082-4.18-7.217 0-4.609 3.672-8.3 8.281-8.3 4.61 0 8.31 3.691 8.31 8.3 0 .586.45.87.88.87.4 0 .78-.293.78-.87 0-5.449-4.52-9.96-9.97-9.96C4.511.218 0 4.73 0 10.178Z"}),(0,g.jsx)("path",{d:"M3.945 10.18c0 2.177 1.192 4.003 2.618 4.921.986.664 1.835-.654 1.005-1.22a4.41 4.41 0 0 1-2.011-3.702A4.38 4.38 0 0 1 9.95 5.765c2.442 0 4.326 1.944 4.414 4.414.02.45.362.801.81.801.45 0 .802-.351.802-.8 0-3.301-2.725-6.026-6.026-6.026-3.281 0-6.006 2.725-6.006 6.025Z"}),(0,g.jsx)("path",{d:"M9.58 17.25c-.01.38.44.508.684.263l1.494-1.494 1.67 4.121c.078.186.273.274.449.205l.967-.39c.176-.078.244-.283.156-.469l-1.748-4.063 2.1-.078c.37-.02.546-.38.283-.654l-5.332-5.488c-.254-.254-.625-.108-.635.254Z"})]})});var T=()=>o(361726),M=()=>o(70753);function _(){const e=(0,l().YB)(),{automationStore:t}=(0,x().YC)();if(!P(t))return null;const o=e.formatMessage(T().Bo.triggerButtonClicked,{b:j});return(0,g.jsx)(M().R,{icon:k,tooltip:o,children:o})}function j(e){return(0,g.jsx)("span",{style:{fontWeight:s().Ue.medium},children:e})}function P(e){return(0,a().VK)((()=>Boolean(null==e?void 0:e.isTriggerType("button"))),[e])}var V=()=>o(521777);function w(){const{automationStore:e}=(0,x().YC)(),{removePageAddedTrigger:t}=(0,b().i)(),o=(0,l().YB)(),r=(0,i().yK)((()=>({title:{fontWeight:s().Ue.medium}})),[]);if(!A(e))return null;const n=T().Mz(o);return(0,g.jsx)(M().R,{icon:V().R,onDelete:t,tooltip:n,children:(0,g.jsx)("div",{style:r.title,children:n})})}function A(e){return(0,a().VK)((()=>{if(!(null!=e&&e.isTriggerType("event")||null!=e&&e.isTriggerType("notification_event")))return!1;const t=e.getEventConfiguration();return Boolean(null==t?void 0:t.pagesAdded)}),[e])}var I=()=>o(906022),R=()=>o(867624),F=()=>o(696459),N=()=>o(521632),B=()=>o(960852),Z=()=>o(166312),E=()=>o(790819),K=()=>o(5485);function O(){const{automationStore:e}=(0,x().YC)(),{removeRecurrenceTrigger:t}=(0,b().i)(),o=(0,i().yK)((e=>({title:{fontWeight:s().Ue.medium,display:"flex",gap:6,alignItems:"center"},badgeContainer:{alignItems:"center",display:"flex"},icon:{width:12,height:12,marginRight:"4px"},badge:{backgroundColor:e.tint.regular,color:e.text.secondary,marginLeft:8}})),[]),r=function(e){return(0,a().VK)((()=>Boolean(null==e?void 0:e.isTriggerType("recurrence"))),[e])}(e),n=(0,a().VK)((()=>(0,Z().HH)(e)),[e]);return r?(0,g.jsx)(M().R,{icon:B().N,onDelete:t,children:(0,g.jsxs)("div",{style:o.title,children:[(0,g.jsx)(l()._H,{id:"RecurrenceTrigger.title",defaultMessage:"<span>Every </span>{frequency}",values:{frequency:(0,g.jsx)(L,{}),span:e=>(0,g.jsx)("span",{style:{flex:0},children:e})}}),n&&(0,g.jsx)(N().Z,{style:o.badge,content:(0,g.jsx)("div",{style:o.badgeContainer,children:(0,g.jsx)(l()._H,{defaultMessage:"Completed",id:"automationSummaryCard.completedToken"})})})]})}):null}function L(){const e=(0,l().YB)(),{isMobile:t}=(0,n().Fy)(),{automationStore:o}=(0,x().YC)(),{changeRecurrenceSchedule:r}=(0,b().i)(),i=(0,a().VK)((()=>o.getRecurrence()),[o]),s=i?(0,Z().De)({intl:e,recurrence:i}):(0,g.jsx)(l()._H,{id:"RecurrenceTrigger.frequency",defaultMessage:"frequency"}),c=(0,K().k)({recurrence:i,onChange:r,disabled:!1,autoFocusIfNew:!0});return(0,g.jsx)(u().ZP,{...c,popupType:t?u().Z4.SlideUp:u().Z4.Popup,placementToOrigin:u().pO.Bottom,renderOrigin:e=>(0,g.jsx)(E().S,{...e,isCompact:!0,dropdownButtonType:"dropdown",hasActionRequired:!(0,F().$K)(i),children:s})})}const D="automation-list-item automation-list-item-modal",H=(0,l().vU)({newTriggerLabel:{defaultMessage:"New trigger",id:"collectionSettings.editAutomationView.triggerSection.newPlaceholder"},addTriggerLabel:{defaultMessage:"Add trigger",id:"collectionSettings.editAutomationView.triggerSection.placeholder"},addTriggerAriaLabel:{id:"collectionSettings.editAutomationView.addTrigger.iconButton",defaultMessage:"Add trigger"},builderModalTriggerTitleWithOperatorButton:{defaultMessage:"When {operatorButton} triggers occur",id:"builderModal.editAutomationView.triggerSection.titleWithOperator"},buttonBuilderTriggerTitleOrNoTriggers:{defaultMessage:"When",id:"builderModal.editAutomationView.buttonBuilderTriggerSection.title"}});function W(){return(0,i().yK)((e=>({wrap:{position:"relative",paddingInline:1},list:{display:"flex",flexDirection:"column"}})),[])}function U(e){const{children:t}=e;return(0,g.jsx)("div",{className:D,children:t})}function q(e){const{children:t}=e,o=W();return(0,g.jsx)("div",{style:o.wrap,children:(0,g.jsx)("div",{style:o.list,children:t})})}function Y(e){const{variant:t,hasAnyTriggers:o}=e,n=(0,S().d)(),a=(0,l().YB)(),i=(0,r.useMemo)((()=>({type:"eventTriggers"})),[]);return(0,g.jsx)(u().ZP,{alignmentToOrigin:u().vR.Start,placementToOrigin:u().pO.Bottom,popupType:n,render:e=>(0,g.jsx)(R().Z,{initialState:i,buttonPopupParent:e}),renderOrigin:e=>"icon"===t?(0,g.jsx)(c().Z,{...e,ariaLabel:a.formatMessage(o?H.addTriggerLabel:H.newTriggerLabel),icon:v().A}):(0,g.jsx)(C().D,{...e,ariaLabel:a.formatMessage(H.addTriggerAriaLabel),icon:(0,v().A)({height:16,width:16}),title:(0,g.jsx)(l()._H,{...o?H.addTriggerLabel:H.newTriggerLabel})})})}function $(e){const{isEditable:t}=e,{isMobile:o}=(0,n().Fy)(),{showAnyPropertyTriggers:r,showButtonClickedTrigger:u,showPageAddedTrigger:c,showRecurrenceTrigger:p}=function(){const{automationStore:e}=(0,x().YC)(),t=P(e),o=A(e),r=(0,I().Zr)(e),n=(0,a().VK)((()=>Boolean(e.isTriggerType("recurrence"))),[e]);return{showAnyPropertyTriggers:r,showPageAddedTrigger:o,showButtonClickedTrigger:t,showRecurrenceTrigger:n}}(),d=r||u||c||p,m=!p,y=(0,i().yK)((e=>({section:{display:"flex",flexDirection:"column",gap:4,width:"100%"},header:{alignItems:"center",display:"flex",flexDirection:"row"},headerAdd:{marginLeft:"auto",flexGrow:0,flexShrink:0,visibility:d?void 0:"hidden"},title:{color:e.lightTextColor,fontSize:o?14:12,lineHeight:1.3,fontWeight:s().Ue.medium}})),[d,o]),{contextType:h}=(0,x().YC)(),f="button_property"===h||"button_block"===h;return(0,g.jsxs)("section",{style:y.section,children:[(0,g.jsx)("header",{style:y.header,children:(0,g.jsx)("div",{style:y.title,children:f?(0,g.jsx)(l()._H,{...H.buttonBuilderTriggerTitleOrNoTriggers}):(0,g.jsx)(z,{disabled:!t})})}),(0,g.jsxs)(q,{children:[u&&(0,g.jsx)(_,{}),c&&(0,g.jsx)(w,{}),r&&(0,g.jsx)(I().Dl,{}),t&&m&&(0,g.jsx)(Y,{hasAnyTriggers:d,variant:"button"}),p&&(0,g.jsx)(O,{})]})]})}function z(e){let{disabled:t}=e;const{automationStore:o}=(0,x().YC)(),{updateTriggerOperator:n}=(0,b().i)(),s=(0,a().VK)((()=>{if(!(null!=o&&o.isTriggerType("event")||null!=o&&o.isTriggerType("notification_event")))return"some";const e=o.getEventConfiguration();return(null==e?void 0:e.pagePropertiesEdited.type)||"all"}),[o]),u=(0,a().VK)((()=>{if(!(null!=o&&o.isTriggerType("event")||null!=o&&o.isTriggerType("notification_event")))return 0;const e=o.getEventConfiguration(),t=null==e?void 0:e.pagePropertiesEdited;return t?"any"===t.type?1:"all"===t.type?(null==t||null===(r=t.all)||void 0===r?void 0:r.length)??0:"some"===t.type?(null==t||null===(n=t.some)||void 0===n?void 0:n.length)??0:0:0;var r,n}),[o]),c=(0,r.useCallback)((e=>{n(e)}),[n]),p=(0,i().yK)((e=>({title:{alignItems:"center",display:"flex",flexWrap:"wrap",height:24}})),[]);return(0,g.jsx)("div",{style:p.title,children:(0,g.jsx)(l()._H,{...u>0?H.builderModalTriggerTitleWithOperatorButton:H.buttonBuilderTriggerTitleOrNoTriggers,values:{operatorButton:(0,g.jsx)(y,{disabled:t,handleSelectOperator:c,selectedItem:s})}})})}},311419:(e,t,o)=>{o.d(t,{L:()=>Y});o(821057),o(670560),o(267602),o(653476),o(241792);var r=o(667294),n=()=>o(219727),a=()=>o(142735),i=()=>o(846550),l=()=>o(156642),s=()=>o(92960),u=()=>o(177634),c=()=>o(619186),p=()=>o(801812),d=()=>o(956057),m=()=>o(396136),g=()=>o(752778),y=()=>o(788860),h=()=>o(513670),f=()=>o(696459),v=()=>o(178498),x=()=>o(827973),S=()=>o(740046),b=()=>o(198829),C=()=>o(255577),k=()=>o(231219),T=()=>o(388284),M=()=>o(654133),_=()=>o(122890),j=()=>o(497459),P=()=>o(125659),V=()=>o(718959),w=()=>o(493954),A=()=>o(164079),I=()=>o(677559),R=()=>o(975899),F=()=>o(828946),N=()=>o(98228),B=()=>o(998901),Z=()=>o(876822),E=()=>o(692304),K=()=>o(826955),O=()=>o(637118),L=()=>o(918745),D=o(785893);const H=(0,y().vU)({searchInputPlaceholder:{defaultMessage:"Type to search…",id:"automations.AutomationTargetPickerMenu.search.placeholder"},searchInputPlaceholderUrlsAllowed:{defaultMessage:"Type to search or paste a link…",id:"automations.AutomationTargetPickerMenu.search.placeholderUrlsAllowed"}}),W=5,U=20,q=20;function Y(e){const t=(0,L().F)({maxWidth:360,width:280}),o=(0,r.useMemo)((()=>d().Il()),[]);return(0,D.jsx)(b().Z,{...t,children:(0,D.jsx)(G,{...e,searchSessionId:o})})}const $=Object.values(l().Ti).filter((e=>e!==l().Ti.form)),z=[l().Ti.form];function G(e){const{formulaTypecheckContextValues:t,includeThisPage:o,onChange:i,onClose:l,parentRecordStore:d,selectedTarget:m,skipCollections:S,skipPages:b,skipVariables:L,spaceId:H,urlBehavior:U}=e,Y=(0,a().qz)(void 0,E().Z),G=(0,O().DZ)(),re=(0,a().VK)((()=>{if(L)return[];if((0,f().$K)(t)&&t.length>0){return Object.values(t).filter((e=>{if(!(0,u().uy)(e.type,{type:"block"}))return!1;if(!o&&"event"===(null==G?void 0:G.contextType)&&e.kind===s().FormulaContextValueKind.ContextValue){const t=(0,u().MY)(e.id);return!("global"===t.source&&"button_page"===t.global)}return!0}))}return[]}),[o,L,t,null==G?void 0:G.contextType],{useDeepEqual:!0}),[ne]=(0,r.useState)((()=>"url"===(null==m?void 0:m.type)?m.url:"")),[ae,ie]=(0,r.useReducer)(J,{automationVariables:[],collectionQueryLimit:W,pageQueryLimit:W,formQueryLimit:W,searchTerm:ne});(0,r.useEffect)((()=>{if(ae.searchTerm){const e=(0,c().ZP)(ae.searchTerm,re,(e=>e.kind===s().FormulaContextValueKind.ContextValue?e.name:""));ie({type:"set_variables",variables:e})}else ie({type:"set_variables",variables:re})}),[ae.searchTerm,re]);const le=function(e){const{limit:t,searchTerm:o,skip:i}=e,l=(0,n().O7)(),s=(0,a().VK)((()=>(0,V().np)()),[]),u=(0,a().VK)((()=>Z().default.state.currentSpaceStore),[]),c=(0,P().DK)(),d=(0,a().VK)((()=>null==c?void 0:c.collectionViewBlockStore()),[c]),[m,g]=(0,r.useReducer)(ee,{error:void 0,isLoading:Boolean(i),results:void 0,total:void 0}),y=(0,I().XJ)(F().x.searchActions),[h]=(0,p().r5)((async()=>{if(i||!s||"resolved"!==y.status)return;const e=y.value,r=await e.searchCollectionsWithRecents({collectionViewBlockStore:d,environment:l,spaceStore:u,limit:t,parentStore:s,query:o,requireEditPermissions:!0,searchSessionId:void 0});return{results:r.results,total:r.total}}),[i,s,y.status,y.value,d,l,u,t,o],{debounce:N().vp});return(0,r.useEffect)((()=>{if("pending"===h.status||"idle"===h.status)g({type:"query_loadstart"});else if("resolved"===h.status){var e,t;g({results:null===(e=h.value)||void 0===e?void 0:e.results,total:null===(t=h.value)||void 0===t?void 0:t.total,type:"query_finish"})}else"rejected"===h.status?g({error:h.error,type:"query_error"}):(0,f().t1)(h)}),[h]),m}({limit:ae.collectionQueryLimit,searchTerm:ae.searchTerm,skip:S}),se=te({limit:ae.pageQueryLimit,searchTerm:ae.searchTerm,skip:b,spaceId:H,blockTypes:$}),ue=te({limit:ae.pageQueryLimit,searchTerm:ae.searchTerm,skip:b,spaceId:H,blockTypes:z}),ce=(0,f().$K)(U)?(0,w().dY)(ae.searchTerm):void 0,pe=(0,r.useCallback)((e=>{m&&!h().Xy(m,e)?i(e):m?l():i(e)}),[m,i,l]),de=(0,r.useCallback)((e=>{const t=e.target.value;ie({searchTerm:t,type:"set_search_term"}),Y.setState({focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[Y]),me=(0,r.useCallback)((()=>{ie({queryLimit:ae.collectionQueryLimit+q,type:"set_collection_query_limit"})}),[ae.collectionQueryLimit]),ge=(0,r.useCallback)((()=>{ie({queryLimit:ae.pageQueryLimit+q,type:"set_page_query_limit"})}),[ae.pageQueryLimit]),ye=(0,r.useCallback)((()=>{ie({queryLimit:ae.formQueryLimit+q,type:"set_form_query_limit"})}),[ae.formQueryLimit]),he="variable"===(null==m?void 0:m.type)?m.id:void 0,fe="collection"===(null==m?void 0:m.type)?m.collection.id:void 0,ve="page"===(null==m?void 0:m.type)?m.page.id:void 0,xe=[],Se=function(e){const{automationVariables:t,onClick:o,selectedVariableId:r,parentRecordStore:n}=e,a=t.map((e=>{if(e.kind!==s().FormulaContextValueKind.ContextValue)throw new Error("Not implemented yet.");return{action:()=>o({id:e.id,type:"variable"}),key:e.id,render:t=>(0,D.jsx)(_().Z,{contextValue:e,checkState:e.id===r,menuArgs:t,parentRecordStore:n})}}));if(0===a.length)return;return{key:"variable_results",items:a,render:e=>(0,D.jsx)(T().Z,{...e,title:(0,D.jsx)(y()._H,{defaultMessage:"From this automation",id:"automations.AutomationTargetPickerMenu.variablesSection.title"})})}}({automationVariables:ae.automationVariables,onClick:pe,selectedVariableId:he,parentRecordStore:d});Se&&xe.push(Se);const be=function(e){const{urlResult:t,urlBehavior:o,onMenuItemClick:r}=e;if(!t||!o)return;if("notion"===t.type);else{if("web"===t.type||"other"===t.type){const e=[],n={title:t.url,icon:(0,R().o)({width:16,paddingTop:4})};return"allow"===o?e.push({action:()=>{r({type:"url",url:t.url})},key:"url",render:e=>(0,D.jsx)(x().Z,{...e,...n})}):"disallow_with_message"===o?e.push({action:()=>{},key:"url",render:e=>(0,D.jsx)(M().Z,{placement:B().Placement.Right,render:t=>(0,D.jsx)(x().Z,{...(0,A().Z)(t,e),disabled:!0,disabledFeedback:!0,...n}),renderTooltip:()=>(0,D.jsx)(y()._H,{defaultMessage:"Linking to a URL is only allowed if it is the first action in an automation.",id:"automations.AutomationTargetPickerMenu.urlSection.disabledMessage"})})}):(0,f().t1)(o),{key:"url_results",items:e,render:e=>(0,D.jsx)(T().Z,{...e,title:(0,D.jsx)(y()._H,{defaultMessage:"Link",id:"automations.AutomationTargetPickerMenu.urlSection.sectionTitle"})})}}(0,f().t1)(t.type)}}({urlResult:ce,urlBehavior:U,onMenuItemClick:pe});be&&xe.push(be);const Ce=function(e){const{collectionQueryResult:t,onCollectionMenuItemClick:o,onShowMoreItemClick:r,parentRecordStore:n,selectedCollectionId:a}=e;if(t.isLoading)return;let i=[];if(t.error)i.push({action:r,key:"show_more_collection_results",render:e=>(0,D.jsx)(v().Z,{...e,caption:(0,D.jsx)(y()._H,{defaultMessage:"Sorry, something went wrong while searching for databases.",id:"automations.AutomationTargetPickerMenu.errorCollections.label"}),shouldWrapCaption:!0})});else{const e=t.results??[],l=e.length;i=e.map((e=>{const t=K().NW.createChildStore(n,{table:g().vF,id:e});return{action:()=>o({collection:t.getSpaceShardedPointer(),type:"collection"}),key:e,render:o=>(0,D.jsx)(k().Z,{...o,checkState:e===a,store:t})}}));const s=t.total??0,u=Math.max(0,s-l);u>0&&i.push({action:r,key:"show_more_collection_results",render:e=>(0,D.jsx)(X,{...e,showMoreCount:u})})}if(0===i.length)return;return{key:"collection_results",items:i,render:e=>(0,D.jsx)(T().Z,{...e,title:(0,D.jsx)(y()._H,{defaultMessage:"Databases",id:"automations.AutomationTargetPickerMenu.collectionsSection.title"})})}}({collectionQueryResult:le,onCollectionMenuItemClick:pe,onShowMoreItemClick:me,parentRecordStore:d,selectedCollectionId:fe});Ce&&xe.push(Ce);const ke=oe({type:"page",onPageMenuItemClick:pe,onShowMoreItemClick:ge,queryResult:se,parentRecordStore:d,selectedPageId:ve});ke&&xe.push(ke);const Te=oe({type:"form",onPageMenuItemClick:pe,onShowMoreItemClick:ye,queryResult:ue,parentRecordStore:d,selectedPageId:ve});Te&&xe.push(Te);const Me=le.isLoading||se.isLoading||ue.isLoading;let _e;return _e=xe.length>0?(0,D.jsx)(C().Z,{initialFocus:0,sections:xe,store:Y,type:C().i.Vertical}):Me?(0,D.jsx)(T().Z,{children:(0,D.jsx)(j().Z,{})}):(0,D.jsx)(v().Z,{caption:(0,D.jsx)(y()._H,{defaultMessage:"No results",id:"automations.AutomationTargetPickerMenu.noResults.label"})}),(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(Q,{onChange:de,value:ae.searchTerm,urlsAllowed:"allow"===U}),_e]})}function Q(e){const{onChange:t,value:o,urlsAllowed:r}=e,{isMobile:a}=(0,n().Fy)(),l=(0,y().YB)(),s=(0,i().yK)((()=>({section:{paddingBlockStart:0,marginTop:12}})),[]);return(0,D.jsx)(T().Z,{style:s.section,children:(0,D.jsx)(S().ZP,{focusInitial:!a||void 0,onChange:t,placeholder:l.formatMessage(r?H.searchInputPlaceholderUrlsAllowed:H.searchInputPlaceholder),showClearButton:!0,value:o??""})})}const X=(0,r.forwardRef)((function(e,t){const{showMoreCount:r}=e,n=(0,i().yK)((e=>({showMoreButton:{color:e.mediumTextColor,fill:e.mediumIconColor}})),[]);return(0,D.jsx)(x().Z,{...e,icon:(0,o(314379).o)({width:16,height:16}),ref:t,style:n.showMoreButton,title:(0,D.jsx)(y()._H,{defaultMessage:"Show {showMore} more",id:"automations.AutomationTargetPickerMenu.showMore.label",values:{showMore:Math.min(r,q)}})})}));function J(e,t){if("set_variables"===t.type)return{...e,automationVariables:t.variables.slice(0)};if("set_search_term"===t.type){const o=t.searchTerm?U:W;return{...e,collectionQueryLimit:o,pageQueryLimit:o,searchTerm:t.searchTerm}}if("set_collection_query_limit"===t.type){if(e.collectionQueryLimit!==t.queryLimit)return{...e,collectionQueryLimit:t.queryLimit}}else if("set_page_query_limit"===t.type){if(e.pageQueryLimit!==t.queryLimit)return{...e,pageQueryLimit:t.queryLimit}}else if("set_form_query_limit"===t.type){if(e.formQueryLimit!==t.queryLimit)return{...e,formQueryLimit:t.queryLimit}}else(0,f().t1)(t);return e}function ee(e,t){if("query_loadstart"===t.type){if(!e.isLoading)return{...e,isLoading:!0}}else{if("query_finish"===t.type)return{...e,error:void 0,isLoading:!1,results:t.results,total:t.total};if("query_error"===t.type)return{...e,error:t.error,isLoading:!1,results:void 0,total:void 0};(0,f().t1)(t)}return e}function te(e){const{limit:t,searchTerm:o,skip:a,spaceId:i,blockTypes:l}=e,s=(0,n().O7)(),[u,c]=(0,r.useReducer)(ee,{error:void 0,isLoading:Boolean(a),results:void 0,total:void 0}),[d]=(0,p().r5)((async()=>{if(a||!i)return;const e=await F().x.searchActions.load(),r=await e.searchPagesInSpace({boostRecentlyViewedPages:!0,environment:s,excludeTemplates:!0,limit:t,query:o,requireEditPermissions:!1,source:"automation_page_picker",spaceId:i,filterOverrides:{blockTypes:l}});return{results:r.results.map((e=>e.id)),total:r.total}}),[l,s,t,o,a,i],{debounce:N().vp});return(0,r.useEffect)((()=>{if("pending"===d.status||"idle"===d.status)c({type:"query_loadstart"});else if("resolved"===d.status){var e,t;c({results:null===(e=d.value)||void 0===e?void 0:e.results,total:null===(t=d.value)||void 0===t?void 0:t.total,type:"query_finish"})}else"rejected"===d.status?c({error:d.error,type:"query_error"}):(0,f().t1)(d)}),[d]),u}function oe(e){const{type:t,queryResult:o,onPageMenuItemClick:r,onShowMoreItemClick:n,selectedPageId:a,parentRecordStore:i}=e;if(o.isLoading)return;const l=[];if(o.error)l.push({action:n,key:"show_more_page_results",render:e=>(0,D.jsx)(v().Z,{...e,caption:(0,D.jsx)(y()._H,{defaultMessage:"Sorry, something went wrong while searching for pages.",id:"automations.AutomationTargetPickerMenu.errorPages.label"}),shouldWrapCaption:!0})});else{const e=(o.results??[]).length;for(const n of o.results??[]){const e=K().G.createChildStore(i,{table:m().iU,id:n}),t={key:n,render:t=>(0,D.jsx)(k().Z,{...t,checkState:n===a,store:e}),action:()=>r({page:e.getSpaceShardedPointer(),type:"page"})};l.push(t)}const t=o.total??0,s=Math.max(0,t-e);s>0&&l.push({action:n,key:"show_more_page_results",render:e=>(0,D.jsx)(X,{...e,showMoreCount:s})})}return 0!==l.length?{key:"page"===t?"page_results":"form_results",items:l,render:e=>(0,D.jsx)(T().Z,{...e,title:"page"===t?(0,D.jsx)(y()._H,{defaultMessage:"Pages",id:"automations.AutomationTargetPickerMenu.pagesSection.title"}):(0,D.jsx)(y()._H,{defaultMessage:"Forms",id:"automations.AutomationTargetPickerMenu.formsSection.title"})})}:void 0}},239869:(e,t,o)=>{o.d(t,{y:()=>s});var r=o(667294),n=()=>o(846550),a=()=>o(654133),i=()=>o(998901),l=o(785893);function s(e){const{caption:t,disable:o,renderOrigin:s,title:u,tooltipAlignment:c,tooltipPlacement:p,disableTooltip:d}=e,m=(0,n().yK)((e=>({tooltipTitle:{margin:0},tooltipCaption:{color:e.mediumInvertedTextColor,margin:0}})),[]),g=(0,r.useCallback)((()=>(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{style:m.tooltipTitle,children:u}),(0,l.jsx)("p",{style:m.tooltipCaption,children:t})]})),[t,u,m.tooltipCaption,m.tooltipTitle]);return(0,l.jsx)(a().Z,{alignment:c||i().Alignment.Center,delayThreshold:800,disableTooltip:o||d,placement:p||i().Placement.Bottom,render:s,renderTooltip:g,textWrap:!0})}},982614:(e,t,o)=>{o.d(t,{YG:()=>Y,Ao:()=>$,R7:()=>Q,vu:()=>G,_S:()=>q,on:()=>X});var r=o.n(o(294184)),n=o(667294),a=()=>o(219727),i=()=>o(474788),l=()=>o(260799),s=()=>o(142735),u=()=>o(846550),c=()=>o(473304),p=()=>o(523733),d=()=>o(990966),m=()=>o(154186),g=()=>o(735697),y=()=>o(654133),h=()=>o(442531),f=()=>o(641506),v=()=>o(677559),x=()=>o(644248),S=()=>o(998901),b=()=>o(529048),C=()=>o(195245),k=()=>o(788860),T=()=>o(855741),M=()=>o(466970),_=()=>o(637118),j=()=>o(960597),P=o(785893);function V(e){let{actionId:t}=e;const{typecheckResult:o}=(0,_().YC)(),{suppressActionErrors:r}=(0,C().i)(),n=(0,M().E)("automation_updated_error_states"),a=(0,s().VK)((()=>{if(n&&T().x.isSuccess(o)&&!r.includes(t)){return(o.value.actionValidationFailures[t]||[]).length>0}return!1}),[t,n,r,o]);return{hasTypecheckErrors:a,typecheckErrorMessage:a?(0,P.jsx)(k()._H,{...j().Mm.generalErrorMessage}):null}}o(267602),o(653476),o(241792);var w=()=>o(696459);function A(e){let{disabled:t}=e;const{automationStore:o}=(0,_().YC)(),{hideDragHandle:r}=(0,C().i)(),n=(0,s().VK)((()=>o.getActionStores().map((e=>e.isDefined()&&e.hasConcern("display")?e:null)).filter(w().K0)),[o]);return r||1===n.length||t}var I=()=>o(448419),R=()=>o(1910),F=()=>o(967092),N=()=>o(913813),B=()=>o(827282);const Z=(0,B().IU)("rectangleCollapseVertical",{viewBox:"0 0 16 16",svg:(0,P.jsx)("path",{d:"M2.80281 10.1213C2.42849 10.1213 2.0967 10.0426 1.80746 9.88526C1.51821 9.72788 1.29277 9.51307 1.13113 9.24084C0.969491 8.96435 0.888672 8.65384 0.888672 8.30929V7.69039C0.888672 7.34159 0.969491 7.0332 1.13113 6.76522C1.29702 6.49299 1.52246 6.27818 1.80746 6.1208C2.0967 5.95916 2.42849 5.87834 2.80281 5.87834H13.1965C13.5709 5.87834 13.9027 5.95916 14.1919 6.1208C14.4811 6.27818 14.7066 6.49299 14.8682 6.76522C15.0299 7.0332 15.1107 7.34159 15.1107 7.69039V8.30929C15.1107 8.65384 15.0299 8.96435 14.8682 9.24084C14.7066 9.51307 14.4811 9.72788 14.1919 9.88526C13.9027 10.0426 13.5709 10.1213 13.1965 10.1213H2.80281ZM2.98784 9.01114H13.0115C13.2923 9.01114 13.5113 8.93032 13.6687 8.76868C13.8303 8.60279 13.9112 8.39436 13.9112 8.1434V7.85628C13.9112 7.60106 13.8303 7.39263 13.6687 7.231C13.5113 7.06511 13.2923 6.98216 13.0115 6.98216H2.98784C2.71135 6.98216 2.49229 7.06511 2.33065 7.231C2.17327 7.39263 2.09458 7.60106 2.09458 7.85628V8.1434C2.09458 8.39436 2.17327 8.60279 2.33065 8.76868C2.49229 8.93032 2.71135 9.01114 2.98784 9.01114ZM8.00287 15.9977C7.84548 15.9977 7.70937 15.9403 7.59452 15.8255C7.48393 15.7149 7.42863 15.5851 7.42863 15.4362V13.4711L7.47967 12.4119L6.98838 12.9543L6.21634 13.7518C6.16955 13.8029 6.11213 13.8433 6.04407 13.873C5.97601 13.9028 5.90583 13.9177 5.83352 13.9177C5.68464 13.9177 5.55916 13.8688 5.45707 13.771C5.35924 13.6731 5.31032 13.5519 5.31032 13.4073C5.31032 13.3307 5.32521 13.2605 5.35498 13.1967C5.38901 13.1372 5.4358 13.0776 5.49535 13.0181L7.58176 11.0656C7.65407 10.9976 7.72213 10.9487 7.78593 10.9189C7.85399 10.8891 7.9263 10.8742 8.00287 10.8742C8.13898 10.8742 8.27723 10.938 8.4176 11.0656L10.504 13.0181C10.5636 13.0776 10.6082 13.1372 10.638 13.1967C10.672 13.2605 10.689 13.3307 10.689 13.4073C10.689 13.5519 10.638 13.6731 10.5359 13.771C10.4381 13.8688 10.3126 13.9177 10.1595 13.9177C10.0106 13.9177 9.8851 13.8624 9.78301 13.7518L9.01736 12.9543L8.52606 12.4119L8.57073 13.4711V15.4362C8.57073 15.5851 8.5133 15.7149 8.39846 15.8255C8.28786 15.9403 8.156 15.9977 8.00287 15.9977ZM8.00287 5.12545C7.8625 5.12545 7.72213 5.06165 7.58176 4.93404L5.49535 2.97524C5.4358 2.91994 5.38901 2.86252 5.35498 2.80297C5.32521 2.73916 5.31032 2.66898 5.31032 2.59241C5.31032 2.44354 5.35924 2.32231 5.45707 2.22873C5.55916 2.13089 5.68464 2.08198 5.83352 2.08198C5.90583 2.08198 5.97601 2.09687 6.04407 2.12664C6.11213 2.15642 6.16955 2.19683 6.21634 2.24787L6.98838 3.04543L7.47967 3.58776L7.42863 2.52861V0.563432C7.42863 0.414555 7.48393 0.284819 7.59452 0.174225C7.70937 0.0593771 7.84548 0.00195312 8.00287 0.00195312C8.156 0.00195312 8.28786 0.0593771 8.39846 0.174225C8.5133 0.284819 8.57073 0.414555 8.57073 0.563432V2.52861L8.52606 3.58776L9.01736 3.03904L9.78301 2.24787C9.8851 2.13728 10.0106 2.08198 10.1595 2.08198C10.3126 2.08198 10.4381 2.13089 10.5359 2.22873C10.638 2.32231 10.689 2.44354 10.689 2.59241C10.689 2.66898 10.672 2.73916 10.638 2.80297C10.6082 2.86677 10.5636 2.9242 10.504 2.97524L8.4176 4.93404C8.27723 5.06165 8.13898 5.12545 8.00287 5.12545Z"})}),E=(0,B().IU)("rectangleExpandVertical",{viewBox:"0 0 16 16",svg:(0,P.jsx)("path",{d:"M2.38379 12.6506C1.79492 12.6506 1.32031 12.4771 0.959961 12.1299C0.599609 11.7827 0.419434 11.3389 0.419434 10.7983V5.54468C0.419434 4.99976 0.599609 4.55591 0.959961 4.21313C1.32031 3.87036 1.79492 3.69897 2.38379 3.69897H4.56567V4.83936H2.58813C2.30249 4.83936 2.07617 4.92505 1.90918 5.09644C1.74658 5.26343 1.66528 5.47876 1.66528 5.74243V10.6006C1.66528 10.8599 1.74658 11.0752 1.90918 11.2466C2.07617 11.418 2.30249 11.5037 2.58813 11.5037H4.56567V12.6506H2.38379ZM13.6162 12.6506H11.4343V11.5037H13.4119C13.6975 11.5037 13.9238 11.418 14.0908 11.2466C14.2578 11.0752 14.3413 10.8599 14.3413 10.6006V5.74243C14.3413 5.47876 14.2578 5.26343 14.0908 5.09644C13.9238 4.92505 13.6975 4.83936 13.4119 4.83936H11.4343V3.69897H13.6162C14.2051 3.69897 14.6797 3.87036 15.04 4.21313C15.4004 4.55591 15.5806 4.99976 15.5806 5.54468V10.7983C15.5806 11.3389 15.4004 11.7827 15.04 12.1299C14.6797 12.4771 14.2051 12.6506 13.6162 12.6506ZM8 16.1575C7.9209 16.1575 7.84839 16.1421 7.78247 16.1113C7.71655 16.0806 7.64624 16.03 7.57153 15.9597L5.40942 13.936C5.3479 13.8833 5.30176 13.824 5.271 13.7581C5.24023 13.6921 5.22485 13.6196 5.22485 13.5405C5.22485 13.3867 5.27759 13.2593 5.38306 13.1582C5.48853 13.0615 5.61816 13.0132 5.77197 13.0132C5.84229 13.0132 5.9104 13.0286 5.97632 13.0593C6.04663 13.0901 6.10815 13.1318 6.16089 13.1846L6.9519 14.0085L7.45947 14.5623L7.40674 13.4746V11.4048C7.40674 11.2422 7.46387 11.1038 7.57812 10.9895C7.69678 10.8752 7.8374 10.8181 8 10.8181C8.1626 10.8181 8.30103 10.8752 8.41528 10.9895C8.52954 11.1038 8.58667 11.2422 8.58667 11.4048V13.4746L8.54053 14.5623L9.0481 14.0085L9.83911 13.1846C9.94897 13.0703 10.0808 13.0132 10.2346 13.0132C10.3928 13.0132 10.5225 13.0615 10.6235 13.1582C10.7246 13.2593 10.7751 13.3867 10.7751 13.5405C10.7751 13.6196 10.7598 13.6921 10.729 13.7581C10.6982 13.824 10.6543 13.8833 10.5972 13.936L8.42847 15.9597C8.28345 16.0916 8.14062 16.1575 8 16.1575ZM8 5.5249C7.8374 5.5249 7.69678 5.46777 7.57812 5.35352C7.46387 5.23926 7.40674 5.10303 7.40674 4.94482V2.86841L7.45947 1.78076L6.9519 2.33447L6.16089 3.15845C6.05103 3.27271 5.91919 3.32983 5.76538 3.32983C5.61157 3.32983 5.48193 3.28149 5.37646 3.18481C5.27539 3.08374 5.22485 2.9563 5.22485 2.80249C5.22485 2.72339 5.24023 2.65308 5.271 2.59155C5.30176 2.52563 5.3479 2.46411 5.40942 2.40698L7.57153 0.383301C7.71655 0.251465 7.85938 0.185547 8 0.185547C8.14062 0.185547 8.28345 0.251465 8.42847 0.383301L10.5906 2.40698C10.6521 2.46411 10.6982 2.52563 10.729 2.59155C10.7598 2.65308 10.7751 2.72339 10.7751 2.80249C10.7751 2.9563 10.7224 3.08374 10.6169 3.18481C10.5159 3.28149 10.3862 3.32983 10.228 3.32983C10.1577 3.32983 10.0874 3.31445 10.0171 3.28369C9.95117 3.25293 9.89185 3.21118 9.83911 3.15845L9.0481 2.33447L8.54053 1.78076L8.58667 2.86841V4.94482C8.58667 5.10303 8.52954 5.23926 8.41528 5.35352C8.30103 5.46777 8.1626 5.5249 8 5.5249Z"})}),K=(0,k().vU)({moreLabel:{id:"automationBaseStepElement.moreActionsMenu.title",defaultMessage:"More"},collapseLabel:{id:"automationBaseStepElement.moreActionsMenu.collapseLabel",defaultMessage:"Collapse"},expandLabel:{id:"automationBaseStepElement.moreActionsMenu.expandLabel",defaultMessage:"Expand"}});function O(e){const{actionMenu:t,disabled:o,buttonPopupStore:r}=e,{device:n}=(0,a().O7)(),i=(0,k().YB)(),l=(0,u().yK)((e=>({container:{display:"flex",gap:1,padding:2,borderRadius:6,boxShadow:`0px 0px 0px 1px ${e.stroke.secondary}, 0px 2px 4px 0px rgba(0, 0, 0, ${"dark"===e.mode?.08:.04})`,backgroundColor:e.surface.elevated},iconButton:{height:24,width:24,flexShrink:0,borderRadius:4},icon:{height:16,width:16}})),[]);return(0,P.jsxs)("div",{style:l.container,children:[e.collapsible&&(0,P.jsx)(y().Z,{renderTooltip:()=>(0,P.jsx)(k()._H,{...L(e.isCollapsed)}),render:t=>(0,P.jsx)(R().Z,{...t,ariaLabel:i.formatMessage(L(e.isCollapsed)),disabled:o,disabledFeedback:o,hasBackground:!0,icon:e.isCollapsed?E:Z,iconStyle:l.icon,style:l.iconButton,onClick:e.onCollapseToggled})}),(0,P.jsx)(I().ZP,{alignmentToOrigin:I().vR.Center,buttonPopupStore:r,originGap:0,placementToOrigin:I().pO.Bottom,popupType:n.isMobile?F().kQ.SlideUp:F().kQ.Popup,render:()=>t,renderOrigin:e=>(0,P.jsx)(R().Z,{...e,ariaLabel:i.formatMessage(K.moreLabel),disabled:o,disabledFeedback:o,hasBackground:!0,icon:N().O,iconStyle:l.icon,style:l.iconButton})})]})}function L(e){return e?K.expandLabel:K.collapseLabel}const D="automation-list-item-base-step",H="automation-list-item-base-step--drag-disabled",W="automation-list-item-icon",U="automation-list-item-drag-handle";function q(e){const{actionMenu:t,buttonPopupStore:o,children:r,disabled:i,icon:u,onClick:c,onMouseDown:d,onMouseEnter:m,onMouseLeave:g,subtitle:y,styles:h}=e,{isMobile:f}=(0,a().Fy)(),v=(0,s().qz)(o,b().Z),[S,C]=(0,l().Z)(),[k,T]=(0,x().C)(),M=(0,s().VK)((()=>v.getState()),[v]),_=!i&&(f||T||C||M.open),j=X({disabled:i,hasActionMenu:Boolean(t),isActionMenuVisible:_,overrideStyles:h}),V=(0,p().lq)(S,k),w=(0,n.useMemo)((()=>({...j.componentWrap,...j.border})),[j.border,j.componentWrap]);return(0,P.jsxs)("div",{className:D,onClick:c,onMouseDown:d,onMouseEnter:m,onMouseLeave:g,ref:V,style:w,children:[(0,P.jsxs)("div",{style:j.headerWrap,children:[u&&(0,P.jsx)("div",{"aria-hidden":"true",style:j.iconContainer,children:(0,P.jsx)("div",{style:j.iconWrap,children:u(j.icon)})}),(0,P.jsx)("div",{style:j.titleWrap,children:r})]}),y&&(0,P.jsx)("div",{style:j.subtitleWrap,children:y}),t&&(0,P.jsx)("div",{style:j.actionMenuWrap,children:(0,P.jsx)(O,{actionMenu:t,buttonPopupStore:v,disabled:i})})]})}function Y(e){const{actionMenu:t,buttonPopupStore:o,children:u,disabled:c,icon:y,onBlur:h,onClick:f,onFocus:v,onMouseDown:S,onMouseEnter:C,onMouseLeave:k,styles:T,subtitle:M,hideDragHandle:_}=e,{isMobile:j}=(0,a().Fy)(),[V,w]=(0,i().Z)(),[I,R]=(0,l().Z)(),[F,N]=(0,x().C)(),B=(0,s().qz)(o,b().Z),Z=(0,s().VK)((()=>B.getState().open),[B]),E=(0,p().lq)(F,I),K=!c&&(j||N||w||R||Z);(0,n.useEffect)((()=>{function e(e){e.state.open||d().blurActiveElement()}return B.addListener(e),()=>{B.removeListener(e)}}),[B]);const L=X({disabled:c,hasActionMenu:Boolean(t),isActionMenuVisible:K,overrideStyles:T}),q=A({disabled:c}),Y=Boolean(_||q);return(0,P.jsxs)("div",{className:r()(D,{[H]:c||j||Y}),ref:E,style:L.buttonWrap,children:[(0,P.jsxs)(m().Z,{disabled:c,disabledFeedback:c,ignoreLocalHoverState:!0,ignoreLocalPressedState:!0,onBlur:h,onClick:f,onFocus:v,onMouseDown:S,onMouseEnter:C,onMouseLeave:k,ref:V,style:L.componentWrap,children:[(0,P.jsxs)("div",{style:L.headerWrap,children:[y&&(0,P.jsxs)("div",{"aria-hidden":"true",style:L.iconContainer,children:[(0,P.jsx)("div",{className:W,style:L.iconWrap,children:y(L.icon)}),!Y&&(0,P.jsx)("div",{className:U,style:L.iconWrap,children:(0,P.jsx)(g().Z,{width:20,height:20,hideClickMessage:!0})})]}),(0,P.jsx)("div",{style:L.titleWrap,children:u})]}),M&&(0,P.jsx)("div",{style:L.subtitleWrap,children:M})]}),t&&(0,P.jsx)("div",{style:L.actionMenuWrap,children:(0,P.jsx)(O,{actionMenu:t,buttonPopupStore:B,disabled:c})})]})}function $(e){return(0,P.jsx)(oe,{actionId:e.actionId,canCollapse:e.canCollapse,children:(0,P.jsx)(z,{...e})})}function z(e){const{actionId:t,actionMenu:o,buttonPopupStore:i,children:u,disabled:c,forceShowActionMenu:m,onMouseEnter:g,onMouseLeave:y,styles:h,hideDragHandle:f}=e,{hasTypecheckErrors:v}=V({actionId:t}),S=A({disabled:c}),k=Boolean(f||S),{isMobile:T}=(0,a().Fy)(),[M,_]=(0,l().Z)(),[j,w]=(0,x().C)(),I=(0,s().qz)(i,b().Z),R=(0,s().VK)((()=>I.getState().open),[I]),{currentDraggingActionId:F}=(0,C().i)(),{isCollapsed:N,canCollapse:B,toggleCollapsed:Z}=te(),E=(0,p().lq)(j,M),K=!c&&(m||T||w||_||R);(0,n.useEffect)((()=>{function e(e){e.state.open||d().blurActiveElement()}return I.addListener(e),()=>{I.removeListener(e)}}),[I]);const L=X({disabled:c,hasActionMenu:Boolean(o),isActionMenuVisible:K,overrideStyles:h}),W=(0,n.useMemo)((()=>({...L.componentWrap,...L.border,...F&&!k?{cursor:"grabbing"}:{}})),[F,L.border,L.componentWrap,k]);return(0,P.jsxs)("div",{className:r()(D,{[H]:c||T||k||v}),onMouseEnter:g,onMouseLeave:y,ref:E,style:W,children:[o&&(0,P.jsx)("div",{style:L.actionMenuWrap,children:(0,P.jsx)(O,{actionMenu:o,buttonPopupStore:I,disabled:c,...B?{collapsible:!0,isCollapsed:N,onCollapseToggled:Z}:{collapsible:!1}})}),u]})}function G(e){const{actionId:t,actionRegistryItem:o,children:r,disabled:a,errorMessage:i,onMouseEnter:l,onMouseLeave:s,styles:u}=e,{typecheckErrorMessage:p}=V({actionId:t}),d=i||p,m=A({disabled:a}),h=Boolean(d||m),{canCollapse:f,toggleCollapsed:v}=te(),x=X({disabled:a,hasActionMenu:!1,isActionMenuVisible:!1,overrideStyles:{...u,...f?{headerWrap:{cursor:"pointer"}}:{}}}),b=(0,n.useCallback)((()=>{!a&&f&&v()}),[f,a,v]),C=(0,c().Xp)(o)?o.display:void 0;return(0,P.jsx)(y().Z,{disableTooltip:!d,renderTooltip:()=>d,render:e=>(0,P.jsxs)("header",{onClick:b,onMouseEnter:l,onMouseLeave:s,...e,onFocus:e=>e.stopPropagation(),style:x.headerWrap,role:"button",children:[C&&(0,P.jsxs)("div",{"aria-hidden":"true",style:x.iconContainer,children:[(0,P.jsx)("div",{className:W,style:x.iconWrap,children:(0,P.jsx)(J,{display:C,isError:Boolean(d),hasSideEffects:o.hasNewReversableEffect})}),!h&&(0,P.jsx)("div",{className:U,style:x.iconWrap,children:(0,P.jsx)(g().Z,{width:20,height:20,hideClickMessage:!0})})]}),(0,P.jsx)("div",{style:x.titleWrap,children:r})]}),placement:S().Placement.Bottom,delayThreshold:0})}function Q(e){const{children:t,disabled:o,styles:r}=e,{isCollapsed:a}=te(),{value:i}=(0,v().XJ)(h().io),l=X({disabled:o,hasActionMenu:!1,isActionMenuVisible:!1,overrideStyles:r}),[s,u]=(0,n.useState)(!1);if((0,n.useEffect)((()=>{u(!0)}),[a]),!i)return null;const{AnimatePresence:c,motion:p}=i;return(0,P.jsx)(c,{children:!a&&(0,P.jsxs)(p.div,{style:{display:"flex",flexDirection:"column"},initial:!!s&&{height:0},animate:{height:"auto"},exit:{height:0},children:[(0,P.jsx)("div",{style:l.collapsedDivider}),(0,P.jsx)("div",{style:l.bodyWrap,children:t})]})})}function X(e){const{disabled:t,hasActionMenu:o,isActionMenuVisible:r,overrideStyles:n}=e;return(0,u().yK)((e=>({border:{border:"unset",boxShadow:`0px 0px 0px 1px ${e.stroke.secondary}, 0px 2px 4px 0px rgba(0, 0, 0, ${"dark"===e.mode?.08:.04})`},buttonWrap:{background:e.surface.elevated,border:"unset",boxShadow:`0px 0px 0px 1px ${e.stroke.secondary}, 0px 2px 4px 0px rgba(0, 0, 0, ${"dark"===e.mode?.08:.04})`,overflow:"hidden",position:"relative",...null==n?void 0:n.buttonWrap},componentWrap:{background:e.surface.elevated,display:"flex",flexDirection:"column",paddingInline:12,paddingBlock:12,position:"relative",overflow:"hidden",...t?{cursor:"default",pointerEvents:"none"}:{},...null==n?void 0:n.componentWrap},headerWrap:{display:"flex",flexDirection:"row",gap:8,marginInlineEnd:o?64:0,...t?{opacity:.4}:{},...null==n?void 0:n.headerWrap},iconContainer:{width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",flexShrink:0},iconWrap:{display:"flex",justifyContent:"center",alignItems:"center",width:20,height:20,...null==n?void 0:n.iconWrap},icon:{fill:e.text.secondary,height:"auto",width:16,...null==n?void 0:n.icon},titleWrap:{display:"flex",alignItems:"start",flex:"1 1 auto",fontSize:14,lineHeight:"20px",minWidth:0,whiteSpace:"pre",flexWrap:"wrap",...null==n?void 0:n.titleWrap},subtitleWrap:{...null==n?void 0:n.subtitleWrap},bodyWrap:{fontSize:14,marginBlockStart:12,marginBlockEnd:2,marginInline:2,marginTop:22,...null==n?void 0:n.bodyWrap},collapsedDivider:{borderTop:`1px solid ${e.stroke.secondary}`,left:0,marginTop:12,position:"absolute",width:"100%"},actionMenuWrap:{flex:"0 0 auto",height:26,position:"absolute",right:8,top:8,zIndex:2,...r?{}:f().jy}})),[12,t,o,r,n])}function J(e){const{display:t,hasSideEffects:o,isError:r}=e,n=(0,u().yK)((e=>({iconWrap:{width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,background:r?e.tint.uiRed:o?e.tint.uiBlue:e.tint.regular,flexShrink:0},icon:{width:14,height:14,fill:r?e.icon.uiRedPrimary:o?e.icon.uiBluePrimary:e.icon.secondary,margin:"0 auto"}})),[o,r]);return(0,P.jsx)("div",{style:n.iconWrap,children:t.icon(n.icon)})}const ee=(0,n.createContext)({canCollapse:!1,isCollapsed:!1,toggleCollapsed:()=>{}});function te(){return(0,n.useContext)(ee)}function oe(e){const{actionId:t,children:o,canCollapse:r}=e,{collapsedActionIds:a,toggleActionIdCollapsed:i}=(0,C().i)(),l=(0,n.useMemo)((()=>a.includes(t)),[t,a]),s=(0,n.useCallback)((()=>{i(t)}),[t,i]);return(0,P.jsx)(ee.Provider,{value:{canCollapse:r,isCollapsed:l,toggleCollapsed:s},children:o})}ee.displayName="BaseStepElementCollapseContext"},253783:(e,t,o)=>{o.d(t,{Z:()=>p});o(667294);var r=()=>o(219727),n=()=>o(846550),a=()=>o(38883),i=()=>o(788860),l=()=>o(78014),s=()=>o(735501),u=()=>o(361726),c=o(785893);function p(e){let{key:t,tokenFormat:o=a().lo.Medium,isSingle:p,showRemoveButton:d,onClickRemove:m}=e;const{isMobile:g}=(0,r().Fy)(),y=(0,i().YB)(),h=(0,n().yK)((e=>{const t="light"===e.mode?400:800,o="light"===e.mode?50:200,r="light"===e.mode?700:900;return{tokenValueWrap:{display:"inline-flex",gap:"4px",alignItems:"baseline"},warning:{color:e.accentColors.orange[t],height:"auto",width:g?16:14},warningWrap:{alignSelf:"center"},token:{backgroundColor:e.accentColors.yellow[o]},textWrap:{color:e.accentColors.yellow[r]}}}),[g]);return(0,c.jsx)(l().Z,{format:o,isSingle:p??!0,showRemoveButton:d??!1,onClickRemove:m,style:h.token,value:(0,c.jsxs)("span",{style:h.tokenValueWrap,children:[(0,c.jsx)("span",{style:h.warningWrap,children:(0,s().t)(h.warning)}),(0,c.jsx)("span",{style:h.textWrap,children:(0,u().ST)(y)})]})},t)}},957250:(e,t,o)=>{o.d(t,{Ox:()=>v,PO:()=>h,RN:()=>f,Si:()=>x,fX:()=>S,rV:()=>y});var r=o(667294),n=()=>o(142735),a=()=>o(846550),i=()=>o(788860),l=()=>o(448419),s=()=>o(466970),u=()=>o(998901),c=()=>o(529048),p=()=>o(676279),d=()=>o(414412),m=()=>o(152557),g=o(785893);function y(e){const{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:n,propertySchema:i}=e,l=(0,s().E)("automation_updated_error_states"),c=(0,a().yK)((e=>({icon:{fill:e.text.uiRedPrimary},iconWrap:{...l&&{background:e.tint.uiRed,borderRadius:4}},propertyType:{color:e.accentColors.red[700]}})),[l]),p=v({propertySchema:i,styles:c,hasAutomationUpdatedErrorStatesEnabled:l}),d=x({propertySchema:i,hasAutomationUpdatedErrorStatesEnabled:l});return(0,g.jsx)(m().gq,{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:n,propertyType:i.type,styles:c,tooltip:d,tooltipPlacement:l?u().Placement.Bottom:u().Placement.Left,children:p})}function h(e){const{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:n}=e,i=(0,a().yK)((e=>({icon:{fill:e.text.uiRedPrimary},propertyType:{color:e.accentColors.red[700]}})),[]),l=S();return(0,g.jsx)(m().gq,{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:n,styles:i,tooltip:l,children:l})}function f(e){const{actionId:t,propertyId:o,renderOrigin:a}=e,i=(0,p().d)(),s=(0,n().qz)(void 0,c().Z),u=(0,r.useCallback)((()=>s.reset()),[s]);return(0,g.jsx)(l().ZP,{buttonPopupStore:s,popupType:i,render:()=>(0,g.jsx)(d().k,{actionId:t,closeMenu:u,propertyId:o}),renderOrigin:a})}function v(e){const{propertySchema:t,styles:o,hasAutomationUpdatedErrorStatesEnabled:r}=e;return r?(0,g.jsx)(i()._H,{defaultMessage:'"{propertyName}" property was deleted',id:"updateThisPageUnsupportedPropertyAction.updatedDeletedProperty.elementTitleText",values:{propertyName:t.name}}):(0,g.jsx)(i()._H,{defaultMessage:"{propertyName} property was deleted",id:"updateThisPageUnsupportedPropertyAction.deletedProperty.title",values:{propertyName:(0,g.jsx)("span",{style:o.propertyType,children:t.name})}})}function x(e){const{propertySchema:t,hasAutomationUpdatedErrorStatesEnabled:o}=e;return o?(0,g.jsx)(i()._H,{defaultMessage:"Restore property or delete to enable this automation",id:"updateThisPageUnsupportedPropertyAction.updatedDeletedProperty.title"}):(0,g.jsx)(i()._H,{defaultMessage:"{propertyName} property was deleted",id:"updateThisPageUnsupportedPropertyAction.deletedProperty.title",values:{propertyName:t.name}})}function S(){return(0,g.jsx)(i()._H,{defaultMessage:"The property was permanently deleted",id:"updateThisPageUnsupportedPropertyAction.permanentlyDeleted.title"})}},415764:(e,t,o)=>{o.d(t,{K:()=>c,b:()=>u});o(667294);var r=()=>o(846550),n=()=>o(243532),a=()=>o(177634),i=()=>o(788860),l=()=>o(361726),s=o(785893);function u(e){const{returnType:t}=e,o=(0,r().Fg)(),u=(0,r().yK)((e=>({iconWrap:{display:"inline-block",fill:e.icon.secondary,height:"1em",position:"relative",verticalAlign:"-0.15em",width:"1em"},icon:{width:"100%"}})),[]),c=(0,a().RX)(t);return(0,s.jsx)(n().Q,{icon:(0,s.jsx)("span",{style:u.iconWrap,children:c(u.icon)}),index:0,theme:o,children:(0,s.jsx)(i()._H,{...l().Bo.inlineCustomFormulaDefaultName})})}function c(){return(0,s.jsx)(i()._H,{...l().Bo.inlineCustomFormulaDefaultName})}},152557:(e,t,o)=>{o.d(t,{JS:()=>k,K1:()=>T,OZ:()=>S,gq:()=>b,l6:()=>C});var r=o(667294),n=()=>o(142735),a=()=>o(846550),i=()=>o(766933),l=()=>o(788860),s=()=>o(696459),u=()=>o(707513),c=()=>o(448419),p=()=>o(270315),d=()=>o(466970),m=()=>o(735501),g=()=>o(529048),y=()=>o(676279),h=()=>o(239869),f=()=>o(982614),v=()=>o(49952),x=o(785893);function S(e){const{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:n,propertySchema:i}=e,l=(0,d().E)("automation_updated_error_states"),s=(0,a().yK)((e=>({icon:{fill:e.text.uiRedPrimary},propertyType:{color:e.accentColors.red[700]}})),[]),u=k({propertySchema:i,styles:s,hasAutomationUpdatedErrorStatesEnabled:l}),c=T({propertySchema:i,hasAutomationUpdatedErrorStatesEnabled:l});return(0,x.jsx)(b,{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:n,propertyType:i.type,styles:s,tooltip:c,children:u})}function b(e){const{actionMenu:t,buttonPopupStore:o,children:n,disabled:l,onClick:c,propertyType:p,styles:g,tooltip:y,tooltipPlacement:v}=e,S=(0,d().E)("automation_updated_error_states"),b=(0,a().yK)((e=>({content:{color:e.text.uiRedPrimary,fontWeight:S?u().Ue.regular:u().Ue.medium,whiteSpace:"normal"}})),[S]),C=(0,r.useCallback)((e=>(0,x.jsx)(f().YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:l,icon:S&&(0,s().$K)(p)?i().wG[p]:m().t,onClick:c,styles:g,hideDragHandle:!0,children:(0,x.jsx)("div",{style:b.content,children:n})})),[t,o,n,l,S,c,g,p,b]);return(0,x.jsx)(h().y,{renderOrigin:C,title:y,tooltipPlacement:v})}function C(e){const{actionId:t,propertyId:o,renderOrigin:a}=e,i=(0,y().d)(),l=(0,n().qz)(void 0,g().Z),s=(0,r.useCallback)((()=>l.reset()),[l]);return(0,x.jsx)(c().ZP,{buttonPopupStore:l,popupType:i,render:()=>(0,x.jsx)(v().qO,{actionId:t,closeMenu:s,propertyId:o}),renderOrigin:a})}function k(e){const{propertySchema:t,styles:o,hasAutomationUpdatedErrorStatesEnabled:r}=e,n=t.type,a=p().SO[n];return r?(0,x.jsx)(l()._H,{defaultMessage:'"{propertyTypeDisplayName}" property type is not supported',id:"updateThisPageUnsupportedPropertyAction.updatedUnsupportedProperty.titleElement",values:{propertyTypeDisplayName:a}}):(0,x.jsx)(l()._H,{defaultMessage:"{propertyTypeDisplayName} property type is not supported",id:"updateThisPageUnsupportedPropertyAction.unsupportedProperty.title",values:{propertyTypeDisplayName:(0,x.jsx)("span",{style:o.propertyType,children:a})}})}function T(e){const{propertySchema:t,hasAutomationUpdatedErrorStatesEnabled:o}=e,r=t.type,n=p().SO[r];return o?(0,x.jsx)(l()._H,{defaultMessage:"Change property type or delete to enable this automation",id:"updateThisPageUnsupportedPropertyAction.updatedUnsupportedProperty.title"}):(0,x.jsx)(l()._H,{defaultMessage:"{propertyTypeDisplayName} property type is not supported",id:"updateThisPageUnsupportedPropertyAction.unsupportedProperty.title",values:{propertyTypeDisplayName:n}})}},414412:(e,t,o)=>{o.d(t,{_:()=>x,k:()=>v});o(267602),o(470928);var r=o(667294),n=()=>o(219727),a=()=>o(142735),i=()=>o(788860),l=()=>o(285755),s=()=>o(125659),u=()=>o(141735),c=()=>o(677559),p=()=>o(49396),d=()=>o(637118),m=()=>o(195245),g=()=>o(809638),y=()=>o(552245),h=()=>o(49952),f=o(785893);function v(e){const{actionId:t,closeMenu:o,propertyId:s}=e,{maybePersistedTransactionActions:g}=(0,m().i)(),{automationStore:v,contextType:x}=(0,d().YC)(),S=(0,n().O7)(),b=(0,i().YB)(),{value:C}=(0,c().XJ)(u().F.formulas),{value:k}=(0,c().XJ)(l().Sm.automationTypecheck),T=(0,a().VK)((()=>{const e=v.getActionStores().find((e=>e.id===t));if(null!=e&&e.isDefined())return e}),[v,t]),M=(0,r.useCallback)((()=>{T&&C&&k&&(g.createAndCommit({perform:e=>{p().removeAutomationAction({actionStore:T,automationStore:v,automationTypecheckModule:k,contextType:x,environment:S,formulasModule:C,intl:b,transaction:e})},userAction:"UnsupportedPropertyMenu.removeAction"}),null==o||o())}),[T,v,k,o,x,S,C,b,g]),_=(0,y().Z)(),j=(0,r.useMemo)((()=>()=>{_&&_(s),null==o||o()}),[o,_,s]);return(0,f.jsx)(h().PO,{onDelete:M,onRestore:j,stepType:"action"})}function x(e){const{closeMenu:t,propertyId:o}=e,n=(0,s().DK)(),{removePropertyTrigger:i}=(0,g().i)(),l=(0,a().VK)((()=>null==n?void 0:n.settingsStore),[n]),u=(0,a().VK)((()=>{const e=null==n?void 0:n.collectionStore();return Boolean(!(null!=e&&e.getSchema()[o]))&&Boolean(!(null!=e&&e.getDeletedSchema()[o]))}),[n,o]),c=(0,r.useCallback)((()=>{i(o),null==t||t()}),[t,o,i]),p=(0,y().Z)(),d=(0,r.useMemo)((()=>()=>{l&&!u&&(p&&p(o),null==t||t())}),[t,l,p,u,o]);return(0,f.jsx)(h().PO,{onDelete:c,onRestore:d,stepType:"trigger"})}},49952:(e,t,o)=>{o.d(t,{Iw:()=>w,PO:()=>A,qO:()=>V});o(267602),o(653476),o(470928);var r=o(667294),n=()=>o(219727),a=()=>o(142735),i=()=>o(846550),l=()=>o(788860),s=()=>o(696459),u=()=>o(285755),c=()=>o(139224),p=()=>o(827973),d=()=>o(198829),m=()=>o(255577),g=()=>o(388284),y=()=>o(125659),h=()=>o(71194),f=()=>o(141735),v=()=>o(347577),x=()=>o(677559),S=()=>o(263758),b=()=>o(739479),C=()=>o(491174),k=()=>o(49396),T=()=>o(637118),M=()=>o(195245),_=()=>o(918745),j=()=>o(809638),P=o(785893);function V(e){const{actionId:t,closeMenu:o,propertyId:i}=e,{maybePersistedTransactionActions:s}=(0,M().i)(),{automationStore:p,contextType:d}=(0,T().YC)(),m=(0,y().DK)(),g=(0,n().O7)(),S=(0,l().YB)(),{value:b}=(0,x().XJ)(f().F.formulas),{value:C}=(0,x().XJ)(u().Sm.automationTypecheck),_=(0,a().VK)((()=>null==m?void 0:m.settingsStore),[m]),j=(0,a().VK)((()=>m&&(0,v().jI)({collectionContextStore:m,timelineViewTab:"timeline"})),[m]),V=(0,a().VK)((()=>p.getName()??""),[p]),w=(0,a().VK)((()=>{const e=p.getActionStores().find((e=>e.id===t));if(null!=e&&e.isDefined())return e}),[p,t]),I=(0,r.useCallback)((()=>{w&&b&&C&&(s.createAndCommit({perform:e=>{k().removeAutomationAction({actionStore:w,automationStore:p,automationTypecheckModule:C,contextType:d,environment:g,formulasModule:b,intl:S,transaction:e})},userAction:"UnsupportedPropertyMenu.removeAction"}),null==o||o())}),[w,p,o,d,g,S,s,b,C]),R=(0,r.useMemo)((()=>{if(_&&j&&i)return async function(){await(0,h().hL)({automationName:V,hasPendingChanges:!0})&&c().H4({collectionSettingsStore:_,item:{type:"property",formatKey:j,property:i}}),null==o||o()}}),[V,o,_,j,i]);return(0,P.jsx)(A,{onDelete:I,onEdit:R,stepType:"action"})}function w(e){const{closeMenu:t,propertyId:o}=e,{automationStore:n}=(0,T().YC)(),i=(0,y().DK)(),{removePropertyTrigger:l}=(0,j().i)(),s=(0,a().VK)((()=>null==i?void 0:i.settingsStore),[i]),u=(0,a().VK)((()=>i&&(0,v().jI)({collectionContextStore:i,timelineViewTab:"timeline"})),[i]),p=(0,a().VK)((()=>n.getName()??""),[n]),d=(0,r.useCallback)((()=>{l(o),null==t||t()}),[t,o,l]),m=(0,r.useMemo)((()=>{if(s&&u&&o)return async function(){await(0,h().hL)({automationName:p,hasPendingChanges:!0})&&c().H4({collectionSettingsStore:s,item:{type:"property",formatKey:u,property:o}}),null==t||t()}}),[p,t,s,u,o]);return(0,P.jsx)(A,{onDelete:d,onEdit:m,stepType:"trigger"})}function A(e){const{onDelete:t,onEdit:o,onRestore:a,stepType:u}=e,c=(0,_().F)({width:266}),y=(0,n().Fy)().isMobile,h=(0,i().yK)((e=>({icon:{color:e.accentColors.gray[600],height:"auto",width:y?"12px":"16px"}})),[y]),f=(0,r.useMemo)((()=>(0,s().$K)(o)?{action:o,key:"edit-property-menu-item",render:e=>(0,P.jsx)(p().Z,{...e,icon:(0,S().E)(h.icon),title:(0,P.jsx)(l()._H,{defaultMessage:"Edit property",id:"unsupportedPropertyMenu.editMenuItem.title"})})}:void 0),[o,h.icon]),v=(0,r.useMemo)((()=>(0,s().$K)(a)?{action:a,key:"restore-property-menu-item",render:e=>(0,P.jsx)(p().Z,{...e,icon:(0,C().s)(h.icon),title:(0,P.jsx)(l()._H,{defaultMessage:"Restore property",id:"unsupportedPropertyMenu.restoreMenuItem.title"})})}:void 0),[a,h.icon]),x=(0,r.useMemo)((()=>(0,s().$K)(t)?{action:t,key:"delete-property-menu-item",render:e=>(0,P.jsx)(p().Z,{...e,icon:(0,b().y)(h.icon),title:"action"===u?(0,P.jsx)(l()._H,{id:"automationUnsupportedPropertyMenu.deleteAction.title",defaultMessage:"Delete action"}):(0,P.jsx)(l()._H,{id:"automationUnsupportedPropertyMenu.deleteTrigger.title",defaultMessage:"Delete trigger"})})}:void 0),[t,u,h.icon]);return(0,P.jsx)(d().Z,{...c,children:(0,P.jsx)(m().Z,{initialFocus:0,sections:[{key:"actions-section",items:[f,v,x].filter(s().$K),render:e=>(0,P.jsx)(g().Z,{...e})}],type:m().i.Vertical})})}},188301:(e,t,o)=>{o.d(t,{Z:()=>d});o(241792),o(667294);var r=()=>o(219727),n=()=>o(846550),a=()=>o(473304),i=()=>o(788860),l=()=>o(827973),s=()=>o(448419),u=()=>o(388284),c=()=>o(522319),p=o(785893);function d(e){let{action:t,handleOnChange:o}=e;const d=(0,r().Fy)(),m=(0,n().yK)((e=>({buttonStyle:{fontSize:d.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,color:d.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[d.isMobile]),y=g[t||a().z8];return(0,p.jsx)(c().Z,{alignmentToOrigin:s().vR.Start,innerButtonStyle:m.buttonStyle,selectedTitle:(0,p.jsx)(i()._H,{...y.text}),renderMenuSections:e=>[{key:"ReplaceAddRemoveToggleOperator",render:e=>(0,p.jsx)(u().Z,{...e}),items:Object.values(g).map((t=>({key:t.value,action:()=>{e.close(),o(void 0,t.value)},render:e=>(0,p.jsx)(l().Z,{...e,title:(0,p.jsx)(i()._H,{...t.text})})})))}]})}const m=(0,i().vU)({replace:{id:"automations.propertyAction.button.replaceWith",defaultMessage:"Replace with..."},append:{id:"automations.propertyAction.button.add",defaultMessage:"Add..."},remove:{id:"automations.propertyAction.button.remove",defaultMessage:"Remove..."},toggle:{id:"automations.propertyAction.button.toggle",defaultMessage:"Toggle..."}}),g={replace:{text:m.replace,value:"replace"},append:{text:m.append,value:"append"},remove:{text:m.remove,value:"remove"},toggle:{text:m.toggle,value:"toggle"}}},874101:(e,t,o)=>{o.d(t,{Z:()=>u});o(667294);var r=()=>o(38883),n=()=>o(177634),a=()=>o(955620),i=()=>o(696459),l=()=>o(772265),s=o(785893);function u(e){let{formulaTypecheckContextValues:t,handleRemoveToken:o,isDisabled:u,token:c,style:p,iconSize:d,preventOnClickPropagation:m}=e;const g=(0,a().vmO)(c).id,y=(0,i().$K)(t)?(0,n().vx)(t,g):void 0;return y?(0,s.jsx)(l().F,{value:y,format:r().lo.Small,isSingle:!1,shouldShrink:!0,showRemoveButton:!u,style:p,onClickRemove:e=>{m&&(null==e||e.stopPropagation()),o(c,e)}}):null}},96735:(e,t,o)=>{o.d(t,{Z:()=>m});var r=o(667294),n=()=>o(219727),a=()=>o(142735),i=()=>o(816512),l=()=>o(907874),s=()=>o(989478),u=()=>o(955620),c=()=>o(864832),p=()=>o(637118),d=o(785893);function m(e){let{handleRemoveToken:t,token:o,style:m,isDisabled:g,preventOnClickPropagation:y}=e;const h=(0,n().Fy)(),{automationStore:f}=(0,p().YC)(),v=(0,a().VK)((()=>{if((0,l().isAnnotationSimpleValueToken)(o)&&(0,u().IWo)(o)){const e=(0,u().zEN)(o);if(e)return(0,i().Hl)({pointer:{table:s().KJ,id:e},getRecordValue:f.getRecordModel})}}),[f.getRecordModel,o]),x=(0,r.useCallback)((()=>{t&&t(o)}),[t,o]);return null!=v&&v.asActor&&v.table===s().KJ?(0,d.jsx)(c().ZP,{actor:v,format:h.isMobile?c().ZP.Format.Medium:c().ZP.Format.Small,showRemoveButton:!!t&&!g,onClickRemove:e=>{y&&(null==e||e.stopPropagation()),x()},shouldShrink:!0,isSingle:!1,style:m},v.id):null}},40696:(e,t,o)=>{o.d(t,{F:()=>k,Z:()=>x});var r=o(667294),n=()=>o(219727),a=()=>o(142735),i=()=>o(846550),l=()=>o(788860),s=()=>o(707513),u=()=>o(1910),c=()=>o(198829),p=()=>o(255577),d=()=>o(470386),m=()=>o(92175),g=()=>o(352230),y=()=>o(880556),h=()=>o(861050),f=o(785893);const v=(0,l().vU)({backButtonAriaLabel:{id:"notificationRuleSettingsMenu.backButton.ariaLabel",defaultMessage:"Back to previous step"}});function x(e){const{automationTriggerActionMenuStore:t,customMenuProps:o,headerTitle:r,onClose:n,onDone:a,subHeaderComponent:i,type:l,width:s}=e,u=k({automationTriggerActionMenuStore:t,customMenuProps:o,onClose:n,onDone:a,subHeaderComponent:i,title:r,width:s});return"custom"===l?(0,f.jsx)(b,{...e,menuProps:u}):(0,f.jsx)(S,{...e,menuProps:u})}function S(e){const{sections:t,menuProps:o}=e;return(0,f.jsx)(c().Z,{...o,children:(0,f.jsx)(p().Z,{type:p().i.Vertical,initialFocus:0,sections:t})})}function b(e){const{children:t,menuProps:o}=e;return(0,f.jsx)(c().Z,{...o,children:t})}function C(e){const{automationActionMenuStore:t,menuHeaderTitle:o,onDone:r,subHeaderComponent:n}=e,c=(0,l().YB)(),p=(0,a().VK)((()=>t.state.stack.length>1),[t]),d=(0,i().yK)((e=>({header:{display:"flex",alignItems:"center",margin:8,color:e.mediumTextColor,fontWeight:s().Ue.medium,fontSize:s().JB.UISmall.desktop},iconButtonStyle:{marginRight:8,marginLeft:-2,height:22},iconButtonIconStyle:{width:16,height:16},doneButtonStyle:{marginLeft:"auto"}})),[]);return void 0!==o||p?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{style:d.header,children:[p&&(0,f.jsx)(u().Z,{ariaLabel:c.formatMessage(v.backButtonAriaLabel),icon:y().W,style:d.iconButtonStyle,iconStyle:d.iconButtonIconStyle,onClick:()=>{t.popSettingsItem()}}),o,r&&(0,f.jsx)(m().Z,{onClick:r,isBlue:!0,style:d.doneButtonStyle,children:(0,f.jsx)(l()._H,{id:"automationTriggerActionMenu.doneButton.title",defaultMessage:"Done"})})]}),n]}):null}function k(e){const{automationTriggerActionMenuStore:t,customMenuProps:o={},onClose:a,onDone:i,subHeaderComponent:s,title:c,width:p}=e,{isMobile:m}=(0,n().Fy)(),y=(0,l().YB)(),x=(0,r.useCallback)((()=>{1===t.getState().stack.length?a():t.popSettingsItem()}),[t,a]);return(0,r.useMemo)((()=>{let e;return e=m?{...o,minWidth:260,menuType:g().o.Modal,title:c,left:(0,f.jsx)(u().Z,{ariaLabel:y.formatMessage(v.backButtonAriaLabel),icon:h().S,onClick:x}),right:(0,f.jsx)(d().DoneMenuText,{}),onClickRight:()=>{null==i||i(),a()},header:s}:{width:p??266,menuType:g().o.Popup,maxHeight:"50vh",header:(0,f.jsx)(C,{automationActionMenuStore:t,menuHeaderTitle:c,subHeaderComponent:s,onDone:i})},e}),[t,o,y,m,a,i,x,s,c,p])}},70753:(e,t,o)=>{o.d(t,{R:()=>C});o(821057),o(267602),o(653476);var r=o(667294),n=()=>o(142735),a=()=>o(846550),i=()=>o(788860),l=()=>o(696459),s=()=>o(827973),u=()=>o(198829),c=()=>o(255577),p=()=>o(388284),d=()=>o(953293),m=()=>o(739479),g=()=>o(998901),y=()=>o(529048),h=()=>o(195245),f=()=>o(918745),v=()=>o(196007),x=()=>o(239869),S=()=>o(982614),b=o(785893);function C(e){const{onDelete:t,styles:o}=e,{disabled:i}=(0,h().i)(),s=Boolean(i),u=(0,n().qz)(void 0,y().Z),c=(0,r.useCallback)((()=>{if(!t)throw new Error("onDelete is not implemented for trigger");t(),u.setState({open:!1})}),[u,t]),p=(0,r.useMemo)((()=>t?(0,b.jsx)(k,{onDelete:c}):null),[t,c]),d=(0,a().yK)((e=>({componentWrap:{borderRadius:10},buttonWrap:{borderRadius:10}})),[]),m=(0,r.useCallback)((t=>{const r=e.onClick?S().YG:S()._S;return(0,b.jsx)(r,{...t,actionMenu:p,buttonPopupStore:u,disabled:s,icon:e.icon,onClick:e.onClick,styles:{...o,...d},hideDragHandle:!0,children:e.children})}),[e.onClick,e.icon,e.children,p,u,s,o,d]);return(0,b.jsx)(v().HC,{children:(0,b.jsx)(x().y,{disable:s,renderOrigin:m,title:e.tooltip,tooltipPlacement:e.tooltipPlacement||g().Placement.Bottom,disableTooltip:!(0,l().$K)(e.tooltip)})})}function k(e){const{onClose:t,onEdit:o,onDelete:r}=e,n=(0,f().F)(),a=[o?{action:()=>{null==t||t(),o()},key:"edit",render:e=>(0,b.jsx)(s().Z,{...e,icon:(0,d().R)({height:16,width:16}),title:(0,b.jsx)(i()._H,{id:"automationBaseStepElement.moreActionsMenu.edit",defaultMessage:"Edit"})})}:void 0,r?{action:()=>{null==t||t(),r()},key:"delete",render:e=>(0,b.jsx)(s().Z,{...e,icon:(0,m().y)({height:16,width:16}),title:(0,b.jsx)(i()._H,{id:"automationBaseStepElement.moreActionsMenu.delete",defaultMessage:"Delete"})})}:void 0].filter(l().$K);return(0,b.jsx)(u().Z,{...n,children:(0,b.jsx)(c().Z,{type:c().i.Vertical,sections:[{items:a,key:"items",render:e=>(0,b.jsx)(p().Z,{enableActionSheetTitle:!0,topBorder:!0,...e})}],initialFocus:0})})}},867624:(e,t,o)=>{o.d(t,{Z:()=>Be});var r=o(667294),n=()=>o(142735),a=()=>o(696459),i=()=>o(414108),l=(o(267602),o(653476),o(470928),o(241792),o(228244),o.n(o(443261))),s=()=>o(219727),u=()=>o(846550),c=()=>o(912203),p=()=>o(226413),d=()=>o(766933),m=()=>o(788860),g=()=>o(513670),y=()=>o(308186),h=()=>o(827973),f=()=>o(740046),v=()=>o(198829),x=()=>o(255577),S=()=>o(388284),b=()=>o(867601),C=()=>o(466970),k=()=>o(696347),T=()=>o(953293),M=()=>o(521777),_=()=>o(749826),j=()=>o(965014),P=()=>o(150275),V=()=>o(195245),w=()=>o(918745),A=()=>o(809638),I=o(785893);const R=(0,m().vU)({searchInputPlaceholder:{id:"automationEventTriggerMenu.searchInputPlaceholder.label",defaultMessage:"Search triggers…"},pageAddedCopy:{id:"automationEventTriggerMenu.pageAdded.title",defaultMessage:"Page added"},pagePropertiesEditedCopy:{id:"automationEventTriggerMenu.anyPropertyEdited.title",defaultMessage:"Any property edited"},recurrenceCopy:{id:"automationEventTriggerMenu.recurrence.title",defaultMessage:"Every…"}});function F(e){const{automationTriggerMenuStore:t,onClose:o}=e,{automationStore:i,collectionStore:j}=(0,V().P)(),P=(0,u().Fg)(),F=(0,m().YB)(),Z=(0,A().i)(),K=(0,C().E)("collections_xws"),O=(0,r.useMemo)((()=>({...Z,closeMenu:o})),[Z,o]),[L,D]=r.useState(""),H=(0,n().VK)((()=>j.getSpaceId()),[j]),W=(0,n().VK)((()=>j.getSchema()),[j]),U=(0,n().VK)((()=>i.getTrigger()),[i]),q=(0,n().VK)((()=>("event"===(null==U?void 0:U.type)||"notification_event"===(null==U?void 0:U.type))&&U.event.pagesAdded),[U]),Y=(0,n().VK)((()=>{if(K)return e=>{const t=e[1];return!(0,p().p_)(t)||!(0,p().Qh)(H,t)}}),[K,H]),$=(0,n().VK)((()=>(0,c().XO)({collectionFormat:j.getFormat(),collectionSchema:W,filter:Y})),[j,W,Y]),z=(0,b().EF)({collectionSchema:W,propertyIds:$,searchTerm:L}),G=(0,n().VK)((()=>("event"===(null==U?void 0:U.type)||"notification_event"===(null==U?void 0:U.type))&&(q||"none"!==U.event.pagePropertiesEdited.type)),[U,q]),Q=N(),X=(0,w().F)({maxHeight:"50vh",width:266}),J=(0,s().O7)(),{isMobile:ee}=(0,s().Fy)(),te=(0,I.jsx)(f().ZP,{focus:!ee,style:{marginTop:12,marginBottom:6},value:L,onChange:e=>{D(e.target.value)},placeholder:F.formatMessage(R.searchInputPlaceholder)}),oe=(0,n().VK)((()=>function(e){const{environment:t,intl:o,searchInput:r,styles:n,actions:a,hasPageAddedTrigger:i,hasAnyEventConditions:s,automationStore:u}=e,c=u.getTrigger(),p=o.formatMessage(R.pageAddedCopy),d=o.formatMessage(R.recurrenceCopy),f=o.formatMessage(R.pagePropertiesEditedCopy),{hasAnyPageEditedTrigger:v,specificPropertyChangedFilters:x}=E(c),b=g().oA([v||!l().test(r,f)?void 0:{key:"any_property_edited",action:async()=>{const e=await async function(e){const{hasSpecificPropertyChangedFilters:t}=e;if(!t)return!0;return await y().gt({message:(0,I.jsx)(m()._H,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.message",defaultMessage:"Replace other triggers?"}),description:(0,I.jsx)(m()._H,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.description",defaultMessage:"Adding the 'Any property edited' trigger will replace all other property triggers."}),acceptLabel:(0,I.jsx)(m()._H,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.acceptLabel",defaultMessage:"Replace"})}).then((e=>e.accept))}({hasSpecificPropertyChangedFilters:x.length>0});e&&(a.addAnyPropertyEditedTrigger(),a.closeMenu())},render:e=>(0,I.jsx)(h().Z,{...e,icon:(0,T().R)(n.propertyIcon),title:f})},!i&&l().test(r,p)?{key:"page_added",action(){a.addPageAddedTrigger(),a.closeMenu()},render:e=>(0,I.jsx)(h().Z,{...e,icon:(0,M().R)(n.propertyIcon),title:p})}:void 0,_().default.checkGate({gateName:"automation_generalized_recurrence"})&&!s&&l().test(r,d)?B({actions:a,environment:t,automationStore:u}):void 0]);return b.length>0?{key:"event_section",items:b,render:e=>(0,I.jsx)(S().Z,{...e,title:(0,I.jsx)(m()._H,{id:"automationEventTriggerMenu.eventSection.title",defaultMessage:"Event"})})}:void 0}({environment:J,intl:F,searchInput:L,actions:O,styles:Q,hasPageAddedTrigger:q,hasAnyEventConditions:G,automationStore:i})),[q,G,F,O,L,Q,J,i]),re=(0,n().VK)((()=>function(e){const{automationTriggerValue:t,automationTriggerMenuStore:o,showTopBorder:r,properties:n,collectionSchema:i,theme:l,actions:s}=e,{specificPropertyChangedFilters:u}=E(t),p=n.map((e=>{if(!u.find((t=>t.property===e)))return function(e){const{automationTriggerMenuStore:t,propertyId:o,collectionSchema:r,theme:n,actions:a}=e,i=r[o];if(!i)return;const l=(0,c().bD)(i);return{key:o,action:()=>{l?t.pushSettingsItem({type:"propertyChangedFilter",property:o}):(a.addPropertyTrigger({property:o,filter:{operator:"changes_to_any"}}),a.closeMenu())},render:e=>(0,I.jsx)(h().Z,{...e,icon:(0,I.jsx)(d().ZP,{icon:i.icon,type:i.type,size:16,theme:n,style:{overflow:"visible"}}),title:i.name,right:l?(0,k().o)({marginLeft:6,width:12,height:"auto",color:n.icon.secondary}):void 0})}}({propertyId:e,collectionSchema:i,theme:l,automationTriggerMenuStore:o,actions:s})})).filter(a().$K);if(0===p.length)return;return{key:"property_section",items:p,render:e=>(0,I.jsx)(S().Z,{...e,topBorder:r,title:(0,I.jsx)(m()._H,{id:"automationEventTriggerMenu.pagePropertiesEditedSection.title",defaultMessage:"Property"})})}}({automationTriggerValue:U,automationTriggerMenuStore:t,showTopBorder:Boolean(oe),properties:z,collectionSchema:W,theme:P,actions:O})),[U,t,oe,z,W,P,O]),ne=r.useMemo((()=>{const e=[oe,re].filter(a().$K);return 0===e.length?[{key:"none",items:[{key:"none-item",action:()=>{},render:e=>(0,I.jsx)(h().Z,{...e,disabled:!0,disabledFeedback:!0,title:(0,I.jsx)(m()._H,{id:"automations.eventTriggerMenu.noResultsItem",defaultMessage:"No results"})})}],render:e=>(0,I.jsx)(S().Z,{...e})}]:e}),[oe,re]);return(0,I.jsx)(v().Z,{...X,header:te,children:(0,I.jsx)(x().Z,{type:x().i.Vertical,sections:ne,initialFocus:0})})}function N(){return(0,u().yK)((e=>({propertyIcon:{width:16,height:16,color:e.mediumIconColor}})),[])}function B(e){const{actions:t,environment:o,automationStore:r}=e,n=(0,P().n)({environment:o,automationStore:r,triggerType:"recurrence"});return{key:"recurrence",action(){n?t.addEmptyRecurrenceTrigger():j().y(o,{upsell:{type:"product",product:"plus",limit:{type:"none"}},from:"recurrence_automation"}),t.closeMenu()},render:e=>(0,I.jsx)(Z,{...e,automationStore:r})}}const Z=r.forwardRef((function(e,t){var r;const{automationStore:a,...i}=e,l=N(),c=(0,u().yK)((()=>({wrap:{display:"flex",alignItems:"center"},upsellWrap:{marginLeft:6}})),[]),p=(0,s().O7)(),d=(0,n().VK)((()=>(0,P().n)({triggerType:"recurrence",automationStore:a,environment:p})),[a,p]),{spaceId:g,userId:y}=(0,n().VK)((()=>{var e;return{spaceId:a.getSpaceId(),userId:null===(e=o(876822).default.state.currentUserStore)||void 0===e?void 0:e.id}}),[a]),f=null===(r=(0,o(815277).oo)({name:"premium_automations",spaceId:g,userId:y}))||void 0===r?void 0:r.upsell;return(0,I.jsx)(h().Z,{...i,ref:t,icon:(0,o(960852).N)(l.propertyIcon),title:(0,I.jsxs)("div",{style:c.wrap,children:[(0,I.jsx)(m()._H,{...R.recurrenceCopy}),d?(0,I.jsx)(o(989377).Z,{newBadgeKey:"generalized_recurrence_automations",didUserEngage:!1}):f?(0,I.jsx)("div",{style:c.upsellWrap,children:(0,I.jsx)(o(385337).R,{upsell:f,analyticsName:"recurrence_automation"})}):null]})})}));function E(e){let t=!1,o=[];return"event"!==(null==e?void 0:e.type)&&"notification_event"!==(null==e?void 0:e.type)||(t="any"===e.event.pagePropertiesEdited.type,t||("some"===e.event.pagePropertiesEdited.type?o=e.event.pagePropertiesEdited.some||[]:"all"===e.event.pagePropertiesEdited.type&&(o=e.event.pagePropertiesEdited.all||[]))),{hasAnyPageEditedTrigger:t,specificPropertyChangedFilters:o}}var K=()=>o(455947),O=()=>o(40696);function L(e){const{propertyId:t,automationTriggerMenuStore:o,propertySchema:a,propertyChangedFilter:i,onClose:l}=e,{updatePropertyTrigger:s}=(0,A().i)(),u=(0,n().VK)((()=>"changes_to_any"===i.operator?[{type:"exact",value:!0},{type:"exact",value:!1}]:(0,K().XA)(i)&&(0,K().vR)(i)?Array.isArray(i.value)?i.value:[i.value]:[]),[i]),[c,p]=(0,r.useState)(u),d=(0,r.useMemo)((()=>1===c.length?{operator:"checkbox_is",value:c[0]}:{operator:"changes_to_any"}),[c]),g=(0,r.useMemo)((()=>2===c.length||1===c.length&&"partial"),[c]),y=(0,r.useCallback)((e=>{const t=Boolean(c.find((t=>t.value===e)));p(t?c.filter((t=>t.value!==e)):[...c,{type:"exact",value:e}])}),[c]),f=(0,r.useCallback)((()=>{s({anyOptionCheckState:g,propertyId:t,currentFilter:d}),l()}),[g,d,l,t,s]),v=Boolean(c.find((e=>!0===e.value))),x=Boolean(c.find((e=>!1===e.value)));return(0,I.jsx)(O().Z,{type:"default",automationTriggerActionMenuStore:o,onDone:f,onClose:l,sections:[{key:"select",render:e=>(0,I.jsx)(S().Z,{...e,topBorder:!0}),items:[{key:"unchecked",render:e=>(0,I.jsx)(h().Z,{...e,checkState:x,isTokenTitle:!0,title:(0,I.jsx)(m()._H,{defaultMessage:"Unchecked",id:"automations.propertyTrigger.checkbox.unchecked"})}),action:()=>y(!1)},{key:"checked",render:e=>(0,I.jsx)(h().Z,{...e,checkState:v,isTokenTitle:!0,title:(0,I.jsx)(m()._H,{defaultMessage:"Checked",id:"automations.propertyTrigger.checkbox.checked"})}),action:()=>y(!0)}]}],headerTitle:(0,I.jsx)(m()._H,{id:"automations.propertyTrigger.checkbox.title",defaultMessage:"{propertyName} set to",values:{propertyName:a.name}})})}var D=()=>o(752348),H=()=>o(532850),W=()=>o(707513),U=()=>o(654133),q=()=>o(278129),Y=()=>o(522319);function $(e){let{handleSelectOperator:t,selectedItem:o}=e;const r=(0,s().Fy)(),n=(0,u().yK)((e=>({buttonStyle:{fontSize:r.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,textTransform:"lowercase",color:r.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[r.isMobile]);return(0,I.jsx)(Y().Z,{innerButtonStyle:n.buttonStyle,selectedTitle:(0,I.jsx)(m()._H,{...o.text}),renderMenuSections:e=>[{key:"selectNumberOperator",render:e=>(0,I.jsx)(S().Z,{...e}),items:Object.values(q().eY).map((o=>({key:o.value,action:()=>{t(o),e.close()},render:e=>(0,I.jsx)(h().Z,{...e,title:(0,I.jsx)(m()._H,{...o.text})})})))}]})}var z=()=>o(311281),G=()=>o(998901),Q=()=>o(637118);function X(e){let{automationTriggerMenuStore:t,onClose:o,propertyChangedFilter:i,propertySchema:l,propertyId:s,shouldUseDefaultPropertyOperator:c}=e;const p=(0,r.useMemo)((()=>{if(c)return"number"===l.type?"number_equals":"changes_to_any"}),[l.type,c]),d=(0,n().VK)((()=>{if("changes_to_any"!==i.operator&&(0,K().h6)(i)&&"is_empty"!==i.operator)return(0,K().vR)(i)?i.value.value:void 0}),[i]),[m,g]=(0,r.useState)((0,q().Fl)(p||i.operator)),[y,h]=(0,r.useState)(d),f=(0,r.useMemo)((()=>{if((0,a().$K)(y))return{type:"simple",value:(0,H().eP)(y)}}),[y]),{updatePropertyTrigger:v}=(0,A().i)(),{typecheckResult:x,automationStore:b}=(0,Q().YC)(),C=(0,r.useMemo)((()=>(0,D().getAllContextValues)(x)),[x]),k=(0,r.useCallback)((e=>{const t=(0,H().VY)(null==e?void 0:e.value);h(t)}),[]),T=(0,r.useCallback)((e=>{g(e.value),q().eY[e.value].hasInput||h(void 0)}),[]),M=(0,r.useCallback)((()=>{const e=(0,a().$K)(y)?{operator:m,value:{type:"exact",value:y}}:{operator:"is_empty"};let t="partial";"changes_to_any"===m?t=!0:"is_empty"===m&&(t=!1),v({anyOptionCheckState:t,propertyId:s,currentFilter:e,propertySchema:l}),o()}),[m,y,o,s,l,v]),_=q().eY[m],j=(0,u().yK)((e=>({header:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"4px",alignItems:"center"},propertyName:{...W().Yu},input:{marginTop:"2px"}})),[]),{headerDiv:P}=(0,z().Z)({currentSimpleFormulaValueTokens:[],formulaTypecheckContextValues:C,onChange:k,onClose:M,value:f,parentRecordStore:b});return(0,I.jsx)(O().Z,{type:"custom",automationTriggerActionMenuStore:t,onDone:M,onClose:o,headerTitle:(0,I.jsxs)("div",{style:j.header,children:[(0,I.jsx)(U().Z,{placement:G().Placement.Bottom,render:e=>(0,I.jsx)("div",{...e,style:j.propertyName,children:l.name}),renderTooltip:()=>l.name}),(0,I.jsx)($,{selectedItem:_,handleSelectOperator:T})]}),subHeaderComponent:_.hasInput&&(0,I.jsx)(S().Z,{children:P}),customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}}})}var J=()=>o(907874),ee=()=>o(801812),te=()=>o(715139);const oe=["person_contains","person_does_not_contain","is_empty","changes_to_any"];const re=(0,m().vU)({changesToAny:{id:"automations.propertyTrigger.personField.changesToAnyOption",defaultMessage:"Is edited"},isEmpty:{id:"automations.propertyTrigger.personField.isEmpty",defaultMessage:"Is cleared"},personContains:{id:"automations.propertyTrigger.personField.personContainsOption",defaultMessage:"Contains"},personDoesNotContain:{id:"automations.propertyTrigger.personField.personDoesNotContainOption",defaultMessage:"Does not contain"}}),ne={person_contains:{hasInput:!0,text:re.personContains,labelText:re.personContains,value:"person_contains"},person_does_not_contain:{hasInput:!0,labelText:re.personDoesNotContain,text:re.personDoesNotContain,value:"person_does_not_contain"},changes_to_any:{hasInput:!1,text:re.changesToAny,labelText:re.changesToAny,value:"changes_to_any"},is_empty:{hasInput:!1,labelText:re.isEmpty,text:re.isEmpty,value:"is_empty"}};function ae(e){let{handleSelectOperator:t,selectedItem:o}=e;const r=(0,s().Fy)(),n=(0,u().yK)((e=>({buttonStyle:{fontSize:r.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,textTransform:"lowercase",color:r.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[r.isMobile]);return(0,I.jsx)(Y().Z,{innerButtonStyle:n.buttonStyle,selectedTitle:(0,I.jsx)(m()._H,{...o.text}),renderMenuSections:e=>[{key:"selectPersonOperator",render:e=>(0,I.jsx)(S().Z,{...e}),items:Object.values(ne).map((o=>({key:o.value,action:()=>{t(o),e.close()},render:e=>(0,I.jsx)(h().Z,{...e,title:(0,I.jsx)(m()._H,{...o.text})})})))}]})}var ie=()=>o(44317),le=()=>o(828946),se=()=>o(98228);function ue(e){var t,o;let{automationTriggerMenuStore:i,collectionStore:l,onClose:c,propertyChangedFilter:p,propertySchema:d,propertyId:g,shouldUseDefaultPropertyOperator:y}=e;const f=(0,r.useMemo)((()=>{if(y&&"person"===d.type)return"person_contains"}),[d.type,y]),v=(0,n().VK)((()=>{if("changes_to_any"!==p.operator)return(0,K().Gb)(p)&&"is_empty"!==p.operator&&(0,K().vR)(p)?(0,K().R8)(p):[]}),[p]),[x,b]=(0,r.useState)((()=>{if(v){const e=v.map((e=>{if("exact"===e.type)return e.value})).filter(a().$K);return{action:"replace",value:{type:"simple",value:(0,H().C1)(e)}}}})),[C,k]=(0,r.useState)(function(e){const t=e;return oe.includes(t)?t:"person_contains"}(f||p.operator)),T=(0,s().O7)(),M=(0,s().Fy)(),[_]=(0,ee().r5)((async()=>{const e=await le().x.searchActions.load();return(await e.searchVisibleSpaceUsers({environment:T,query:"",membersOnly:!1})).length}),[T],{debounce:se().vp}),j=(0,r.useRef)(),P=(0,r.useRef)(),[V,w]=(0,r.useState)(!v),R=(0,r.useMemo)((()=>{var e;return(0,J().fromSimpleFormulaArrayValue)(null==x||null===(e=x.value)||void 0===e?void 0:e.value)}),[null==x||null===(t=x.value)||void 0===t?void 0:t.value]),F=(0,n().VK)((()=>{var e;return function(e){const{formulaValue:t,allChecked:o,numTotalActors:r}=e;if(t&&t.length>0){return(0,J().fromSimpleFormulaArrayValue)(t).length===r||"partial"}if(o)return!0;return!1}({propertySchema:d,formulaValue:null==x||null===(e=x.value)||void 0===e?void 0:e.value,allChecked:V,numTotalActors:_.value||0})}),[d,null==x||null===(o=x.value)||void 0===o?void 0:o.value,V,_.value]),{typecheckResult:N,automationStore:B}=(0,Q().YC)(),Z=(0,r.useMemo)((()=>({collectionStore:l,property:g,type:"collection"})),[l,g]),E=(0,r.useMemo)((()=>(0,D().getAllContextValues)(N)),[N]),{updatePropertyTrigger:L}=(0,A().i)(),q=(0,r.useCallback)((()=>{const e=j.current||(null==x?void 0:x.value),t=P.current||C,o=e?(0,H().DW)({textValue:null==e?void 0:e.value,propertySchema:d,blockCreatorPointer:void 0}):void 0,r=o&&0!==o.length?{operator:t,value:o.map((e=>({type:"exact",value:e})))}:{operator:"person_contains"===t&&V?"changes_to_any":"is_empty"};let n="partial";"changes_to_any"===t?n=!0:"is_empty"===t&&(n=!1),L({anyOptionCheckState:n,propertyId:g,currentFilter:r,propertySchema:d}),c()}),[null==x?void 0:x.value,C,d,V,L,g,c]),Y=(0,r.useCallback)((e=>{j.current=e,b({action:"replace",value:e}),1===d.limit&&q()}),[q,d.limit]),$=(0,r.useCallback)((()=>{F?(w(!1),R.length>0&&Y(void 0)):w(!0)}),[F,R.length,Y]),z=(0,r.useCallback)((e=>{P.current=e.value,k(e.value),ne[e.value].hasInput||Y(void 0)}),[Y]),X=ne[C],re=(0,u().yK)((e=>({header:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"4px",alignItems:"center"},propertyName:{...W().Yu},any:{marginTop:"6px"}})),[]),ue=X.hasInput,ce=!V||R.length>0,{headerDiv:pe,innerComponents:de}=(0,ie().Z)({currentSimpleFormulaValueTokens:R,formulaTypecheckContextValues:E,formulaValueContext:Z,isDisabled:!ce,limit:void 0,onChange:Y,onClose:c,showClearButton:!0,showGenericHeader:!1,showInputMenuItem:!0,value:null==x?void 0:x.value,parentRecordStore:B});if(!Z)return null;const me=[X.hasInput?{key:"any",items:[{key:"any-option-item",action:$,render:e=>(0,I.jsxs)(I.Fragment,{children:[pe,(0,I.jsx)("div",{style:re.any,children:(0,I.jsx)(h().Z,{onClick:$,focused:!0,icon:(0,I.jsx)(te().Z,{checked:F,size:14,onClick:$}),title:(0,I.jsx)(m()._H,{id:"automationEventTriggerPropertyChangedFilterMenu.anyOption.title",defaultMessage:"Any option"})})})]})}],render:e=>(0,I.jsx)(S().Z,{...e,topBorder:!1})}:void 0,ue?{key:"inner-components",items:[{key:"inner-components-item",action:$,render:e=>de}],render:e=>M.isMobile?de:(0,I.jsx)(S().Z,{...e,topBorder:!0})}:void 0].filter(a().$K);return(0,I.jsx)(O().Z,{type:"default",automationTriggerActionMenuStore:i,onDone:q,onClose:c,headerTitle:(0,I.jsxs)("div",{style:re.header,children:[(0,I.jsx)(U().Z,{placement:G().Placement.Bottom,render:e=>(0,I.jsx)("div",{...e,style:re.propertyName,children:d.name}),renderTooltip:()=>d.name}),(0,I.jsx)(ae,{selectedItem:X,handleSelectOperator:z})]}),sections:me,customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}}})}var ce=()=>o(827370),pe=()=>o(396136);const de=["relation_contains","relation_does_not_contain","is_empty","changes_to_any"];const me=(0,m().vU)({changesToAny:{id:"automations.propertyTrigger.relationOperator.changesToAnyOption",defaultMessage:"Is edited"},isEmpty:{id:"automations.propertyTrigger.relationOperator.isEmpty",defaultMessage:"Is cleared"},relationContains:{id:"automations.propertyTrigger.relationOperator.relationContainsOption",defaultMessage:"Contains"},relationDoesNotContain:{id:"automations.propertyTrigger.relationOperator.relationDoesNotContain",defaultMessage:"Does not contain"}}),ge={relation_contains:{hasInput:!0,labelText:me.relationContains,text:me.relationContains,value:"relation_contains"},relation_does_not_contain:{hasInput:!0,labelText:me.relationDoesNotContain,text:me.relationDoesNotContain,value:"relation_does_not_contain"},changes_to_any:{hasInput:!1,text:me.changesToAny,labelText:me.changesToAny,value:"changes_to_any"},is_empty:{text:me.isEmpty,labelText:me.isEmpty,value:"is_empty",hasInput:!1}};function ye(e){let{handleSelectOperator:t,selectedItem:o}=e;const r=(0,s().Fy)(),n=(0,u().yK)((e=>({buttonStyle:{fontSize:r.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,textTransform:"lowercase",color:r.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[r.isMobile]);return(0,I.jsx)(Y().Z,{innerButtonStyle:n.buttonStyle,selectedTitle:(0,I.jsx)(m()._H,{...o.text}),renderMenuSections:e=>[{key:"selectRelationOperator",render:e=>(0,I.jsx)(S().Z,{...e}),items:Object.values(ge).map((o=>({key:o.value,action:()=>{t(o),e.close()},render:e=>(0,I.jsx)(h().Z,{...e,title:(0,I.jsx)(m()._H,{...o.text})})})))}]})}var he=()=>o(749515);function fe(e){var t;let{automationTriggerMenuStore:o,collectionStore:i,onClose:l,propertyChangedFilter:s,propertySchema:c,propertyId:p,shouldUseDefaultPropertyOperator:d}=e;const m=(0,r.useMemo)((()=>{if(d)return"relation"===c.type?"relation_contains":"changes_to_any"}),[c.type,d]),g=(0,n().VK)((()=>"changes_to_any"===s.operator?[]:(0,K().e)(s)&&"is_empty"!==s.operator&&(0,K().vR)(s)?(0,K().YO)(s):[]),[s]),y=(0,n().VK)((()=>{if(i&&c)return(0,J().setPropertyValueToSimpleFormulaReturnType)(i.getSpaceShardedPointer(),p,c)}),[i,c,p]),h=(0,n().VK)((()=>i.getSpaceId()),[i]),[f,v]=(0,r.useState)(function(e){const t=e;return de.includes(t)?t:"relation_contains"}(m||s.operator)),[x,b]=(0,r.useState)((()=>{const e=g.map((e=>{if(e.value&&"string"==typeof e.value)return ce().dr.fromSpaceShardRecordId({id:e.value,spaceId:h},pe().iU)})).filter(a().$K);return{action:"replace",value:{type:"simple",value:(0,H().ow)(e)}}})),C=(0,r.useMemo)((()=>{var e;return(0,J().fromSimpleFormulaArrayValue)(null==x||null===(e=x.value)||void 0===e?void 0:e.value)}),[null==x||null===(t=x.value)||void 0===t?void 0:t.value]),k=(0,r.useRef)(),{updatePropertyTrigger:T}=(0,A().i)(),{typecheckResult:M,automationStore:_}=(0,Q().YC)(),j=(0,r.useMemo)((()=>({collectionStore:i,property:p,type:"collection"})),[i,p]),P=(0,r.useMemo)((()=>(0,D().getAllContextValues)(M)),[M]),V=(0,r.useCallback)((e=>{v(e.value),ge[e.value].hasInput||b(void 0)}),[]),w=ge[f],R=(0,r.useCallback)((()=>{const e=k.current||(null==x?void 0:x.value),t=(0,a().$K)(null==e?void 0:e.value)?(0,H().rq)(null==e?void 0:e.value):void 0,o=t&&0!==t.length?{operator:w.value,value:t.map((e=>({type:"exact",value:e.id})))}:{operator:"is_empty"};T({anyOptionCheckState:"changes_to_any"===w.value,currentFilter:o,propertyId:p,propertySchema:c}),l()}),[null==x?void 0:x.value,l,p,c,w.value,T]),F=(0,r.useCallback)((e=>{k.current=e,b({action:"replace",value:e}),1===c.limit&&R()}),[R,c.limit]),N=(0,u().yK)((e=>({header:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"2px",alignItems:"center"},propertyName:{...W().Yu},input:{marginTop:"2px"}})),[]),{headerDiv:B,innerComponents:Z}=(0,he().Z)({currentSimpleFormulaValueTokens:C,formulaTypecheckContextValues:P,formulaValueContext:j,onChange:F,onClose:l,showClearButton:!0,showInputMenuItem:!0,collection:"block_array"===(null==y?void 0:y.type)?y.collection:void 0,value:null==x?void 0:x.value,parentRecordStore:_});return(0,I.jsx)(O().Z,{type:"custom",automationTriggerActionMenuStore:o,onDone:R,onClose:l,headerTitle:(0,I.jsxs)("div",{style:N.header,children:[(0,I.jsx)(U().Z,{placement:G().Placement.Bottom,render:e=>(0,I.jsx)("div",{...e,style:N.propertyName,children:c.name}),renderTooltip:()=>c.name}),(0,I.jsx)(ye,{selectedItem:w,handleSelectOperator:V})]}),subHeaderComponent:w.hasInput&&(0,I.jsx)(S().Z,{children:B}),customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}},children:w.hasInput&&Z})}var ve=()=>o(38883),xe=()=>o(780550);const Se=["enum_contains","enum_does_not_contain","enum_is","enum_is_not","is_empty","changes_to_any"];const be=(0,m().vU)({changesToAny:{id:"automations.propertyTrigger.selectOperator.changesToAnyOption",defaultMessage:"Is edited"},isEmpty:{id:"automations.propertyTrigger.selectOperator.isEmpty",defaultMessage:"Is cleared"},enumContains:{id:"automations.propertyTrigger.selectOperator.enumContainsOption",defaultMessage:"Contains"},enumDoesNotContain:{id:"automations.propertyTrigger.selectOperator.enumDoesNotContain",defaultMessage:"Does not contain"},enumIs:{id:"automations.propertyTrigger.selectOperator.enumIs",defaultMessage:"Is"},enumIsNot:{id:"automations.propertyTrigger.selectOperator.enumIsNot",defaultMessage:"Is not"}}),Ce={enum_contains:{hasInput:!0,isMulti:!0,isSingle:!1,labelText:be.enumContains,text:be.enumContains,value:"enum_contains"},enum_does_not_contain:{hasInput:!0,isMulti:!0,isSingle:!1,labelText:be.enumDoesNotContain,text:be.enumDoesNotContain,value:"enum_does_not_contain"},enum_is:{hasInput:!0,isMulti:!1,isSingle:!0,labelText:be.enumIs,text:be.enumIs,value:"enum_is"},enum_is_not:{hasInput:!0,isMulti:!1,isSingle:!0,labelText:be.enumIsNot,text:be.enumIsNot,value:"enum_is_not"},changes_to_any:{hasInput:!1,isMulti:!0,isSingle:!0,labelText:be.changesToAny,text:be.changesToAny,value:"changes_to_any"},is_empty:{hasInput:!1,isMulti:!0,isSingle:!0,labelText:be.isEmpty,text:be.isEmpty,value:"is_empty"}};function ke(e){let{handleSelectOperator:t,selectedItem:o,type:n}=e;const a=(0,s().Fy)(),i=(0,u().yK)((e=>({buttonStyle:{fontSize:a.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,textTransform:"lowercase",color:a.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[a.isMobile]),l=(0,r.useMemo)((()=>{const e="multi_select"===n,t="select"===n;return Object.values(Ce).filter((o=>e?o.isMulti:t?o.isSingle:void 0))}),[n]);return(0,I.jsx)(Y().Z,{innerButtonStyle:i.buttonStyle,selectedTitle:(0,I.jsx)(m()._H,{...o.text}),renderMenuSections:e=>[{key:"selectSelectOperator",render:e=>(0,I.jsx)(S().Z,{...e}),items:l.map((o=>({key:o.value,action:()=>{t(o),e.close()},render:e=>(0,I.jsx)(h().Z,{...e,title:(0,I.jsx)(m()._H,{...o.text})})})))}]})}var Te=()=>o(246471),Me=()=>o(122671);function _e(e){const{automationTriggerMenuStore:t,onClose:o,propertyChangedFilter:i,propertyId:l,propertySchema:c,shouldUseDefaultPropertyOperator:p}=e,{isMobile:d,isAndroid:y}=(0,s().Fy)(),f=(0,m().YB)(),{updatePropertyTrigger:v}=(0,A().i)(),x=(0,r.useMemo)((()=>{if(p)return"select"===c.type?"enum_is":"multi_select"===c.type?"enum_contains":"changes_to_any"}),[c.type,p]),b=(0,n().VK)((()=>{if("changes_to_any"===i.operator){return(c.options??[]).map((e=>({type:"exact",value:e.value})))}if(!(0,K().dx)(i)&&!(0,K().NU)(i))return[];if((0,K().vR)(i)){const e=(c.options??[]).map((e=>e.value));return(Array.isArray(i.value)?i.value:[i.value]).filter((t=>(0,a().$K)(t.value)&&e.includes(t.value)))}return[]}),[c,i]),[C,k]=r.useState(b),[T,M]=(0,r.useState)(function(e){const t=e;return Se.includes(t)?t:"enum_contains"}(x||i.operator)),_=(0,r.useCallback)((e=>{M(e.value)}),[]),j=Ce[T],P=(0,n().VK)((()=>function(e){const{propertySchema:t,selectedOptions:o}=e;let r=!1,n=!0;const a=t.options??[];for(const i of a){const e=o.some((e=>e.value===i.value));r||=e,n&&=e}return!!n||!!r&&"partial"}({propertySchema:c,selectedOptions:C})),[c,C]),V=r.useMemo((()=>(c.options??[]).map((e=>({type:"exact",value:e.value})))),[c]),w=!0===P?[]:C.map((e=>{if(!e.value||!c.options)return;const t=(0,H().i7)(c.options,e.value);return t?(0,I.jsx)(Te().a,{format:d?ve().lo.Large:ve().lo.Small,isSingle:!1,value:t.value,color:t.color,showRemoveButton:!0,onClickRemove:()=>{const t=g().zu(C,e);k(t)}},t.id):void 0})),[R,F]=r.useState(""),N=(0,xe().I4)({query:R,propertySchema:c,selectedValues:C,updateValue:e=>{F(""),k(e)},isMobile:d,styles:{}}),B=(0,u().yK)((e=>({header:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"2px",alignItems:"center"},propertyName:{...W().Yu}})),[]),Z=(0,r.useCallback)((()=>{let e,t="partial";if("changes_to_any"===T)t=!0,e={operator:T};else if("is_empty"===T)t=!1,e={operator:T};else{const o=Array.isArray(C)?C:[C];0===o.length?(t=!1,e={operator:"is_empty"}):e={operator:T,value:o}}v({anyOptionCheckState:t,propertyId:l,currentFilter:e,propertySchema:c}),o()}),[o,l,c,T,C,v]),E=[{key:"search",items:[{key:"input",action:()=>{},render:e=>(0,I.jsx)(Me().ZP,{...e,focusInitial:!0,onClick:void 0,focusAfterAnimation:!0,format:Me().UR.FilterValue,tokens:w,placeholder:P?f.formatMessage({defaultMessage:"Any option",id:"automations.selectPropertyChangedFilter.inputPlaceholder.anyOption"}):f.formatMessage({defaultMessage:"Select one or more options…",id:"automations.selectPropertyChangedFilter.inputPlaceholder.searchPlaceholder"}),onRemoveLastToken:()=>{const e=C.slice(0,C.length-1);k(e)},onClearButtonClick:()=>{k([])},value:R,onChange:e=>{F(e.target.value)},dontShowBorderBottom:y,showClearButton:!0})}],render:e=>(0,I.jsx)(S().Z,{...e})},{key:"any",items:[{key:"any-option-item",action:()=>{!0===P?k([]):!1===P||"partial"===P?k(V):(0,a().t1)(P),F("")},render:e=>(0,I.jsx)(h().Z,{...e,icon:(0,I.jsx)(te().Z,{checked:P,size:14,onClick:e.onClick}),title:(0,I.jsx)(m()._H,{id:"automations.selectPropertyChangedFilter.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,I.jsx)(S().Z,{...e,topBorder:!0})},N.length>0?{key:"items",items:N,render:e=>(0,I.jsx)(S().Z,{...e,topBorder:!0})}:void 0].filter(a().$K);return(0,I.jsx)(O().Z,{type:"default",automationTriggerActionMenuStore:t,onDone:Z,onClose:o,sections:j.hasInput?E:[],headerTitle:(0,I.jsxs)("div",{style:B.header,children:[(0,I.jsx)(U().Z,{placement:G().Placement.Bottom,render:e=>(0,I.jsx)("div",{...e,style:B.propertyName,children:c.name}),renderTooltip:()=>c.name}),(0,I.jsx)(ke,{handleSelectOperator:_,selectedItem:j,type:c.type})]}),customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}}})}o(916054);var je=()=>o(421619),Pe=()=>o(576868);function Ve(e){const{propertyId:t,automationTriggerMenuStore:o,propertySchema:i,propertyChangedFilter:l,onClose:u}=e,{isMobile:c}=(0,s().Fy)(),{updatePropertyTrigger:p}=(0,A().i)(),d=(0,n().VK)((()=>{if("changes_to_any"===l.operator){return(i.groups??[]).map((e=>({type:"is_group",value:e.name})))}return(0,K().r2)(l)&&(0,K().vR)(l)?(0,K().wB)(l):[]}),[i,l]),[g,y]=r.useState(d),f=(0,n().VK)((()=>function(e){const{propertySchema:t,selectedStatusOptions:o}=e,r=t.groups??[],n=t.options??[],a=r.map((e=>(0,Pe().IX)({group:e,options:n,filterValues:o}))),i=a.every((e=>!0===e.groupCheckState)),l=a.some((e=>!1!==e.groupCheckState));return!!i||!!l&&"partial"}({propertySchema:i,selectedStatusOptions:g})),[i,g]),v=r.useMemo((()=>(i.groups??[]).map((e=>({type:"is_group",value:e.name})))),[i]),x=(0,je().S)({propertySchema:i,statusFilterValues:g,updateValue:e=>{y(e)},isMobile:c,styles:{},visibleOptions:i.options??[]}),b=(0,r.useCallback)((()=>{const e=0===g.length?{operator:"is_empty"}:{operator:"status_is",value:g};p({anyOptionCheckState:f,propertyId:t,currentFilter:e,propertySchema:i}),u()}),[f,u,t,i,g,p]);return(0,I.jsx)(O().Z,{type:"default",automationTriggerActionMenuStore:o,onDone:b,onClose:()=>{u()},sections:[{key:"any",items:[{key:"any-option-item",action:()=>{!0===f?y([]):!1===f||"partial"===f?y(v):(0,a().t1)(f)},render:e=>(0,I.jsx)(h().Z,{...e,icon:(0,I.jsx)(te().Z,{checked:f,size:14,onClick:e.onClick}),title:(0,I.jsx)(m()._H,{id:"automationEventTriggerPropertyChangedFilterMenu.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,I.jsx)(S().Z,{...e})},{key:"items",items:x,render:e=>(0,I.jsx)(S().Z,{...e,topBorder:!0})}],headerTitle:(0,I.jsx)(m()._H,{id:"automations.propertyChangedFilterHeader.status.title",defaultMessage:"{propertyName} set to",values:{propertyName:i.name}}),customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}}})}var we=()=>o(955620),Ae=()=>o(149869);function Ie(e){let{handleSelectOperator:t,selectedItem:o}=e;const r=(0,s().Fy)(),n=(0,u().yK)((e=>({buttonStyle:{fontSize:r.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,textTransform:"lowercase",color:r.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[r.isMobile]);return(0,I.jsx)(Y().Z,{innerButtonStyle:n.buttonStyle,selectedTitle:(0,I.jsx)(m()._H,{...o.text}),renderMenuSections:e=>[{key:"selectTextOperator",render:e=>(0,I.jsx)(S().Z,{...e}),items:Object.values(Ae().xQ).map((o=>({key:o.value,action:()=>{t(o),e.close()},render:e=>(0,I.jsx)(h().Z,{...e,title:(0,I.jsx)(m()._H,{...o.text})})})))}]})}var Re=()=>o(303926);function Fe(e){let{automationTriggerMenuStore:t,onClose:o,propertyChangedFilter:i,propertySchema:l,propertyId:s,shouldUseDefaultPropertyOperator:c}=e;const p=(0,r.useMemo)((()=>{if(c)return(0,H().TN)(l.type)?"string_is":"changes_to_any"}),[l.type,c]),d=(0,n().VK)((()=>{if("changes_to_any"!==i.operator&&(0,K().Ly)(i)&&"is_empty"!==i.operator)return(0,K().vR)(i)?i.value.value:void 0}),[i]),[m,g]=(0,r.useState)((()=>(0,Ae().vy)(p||i.operator))),[y,h]=(0,r.useState)(d),f=(0,r.useMemo)((()=>{if(y)return{type:"simple",value:we().TPx(y)}}),[y]),{updatePropertyTrigger:v}=(0,A().i)(),{typecheckResult:x,automationStore:b}=(0,Q().YC)(),C=(0,r.useMemo)((()=>(0,D().getAllContextValues)(x)),[x]),k=(0,r.useCallback)((e=>{const t=we().Jcv(null==e?void 0:e.value);h(t.trim()?t:void 0)}),[]),T=(0,r.useCallback)((e=>{g(e.value),Ae().xQ[e.value].hasInput||h(void 0)}),[]),M=(0,r.useCallback)((()=>{const e=(0,a().$K)(y)?{operator:m,value:{type:"exact",value:y}}:{operator:"is_empty"};let t="partial";"changes_to_any"===m?t=!0:"is_empty"===m&&(t=!1),v({anyOptionCheckState:t,propertyId:s,currentFilter:e,propertySchema:l}),o()}),[m,y,o,s,l,v]),_=Ae().xQ[m],j=(0,u().yK)((e=>({header:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"2px",alignItems:"center"},propertyName:{...W().Yu},input:{marginTop:"2px"},mobileInputWrapper:{marginLeft:"2px",marginRight:"2px"}})),[]),{headerDiv:P}=(0,Re().Z)({currentSimpleFormulaValueTokens:[],disableEmojiCommands:!0,disableFormulas:!0,disableFormattingAndMentions:!0,disableMobileActionBar:!0,disableTemplateVariableMentions:!0,formulaTypecheckContextValues:C,onChange:k,onClose:M,value:f,parentRecordStore:b});return(0,I.jsx)(O().Z,{type:"custom",automationTriggerActionMenuStore:t,onDone:M,onClose:o,headerTitle:(0,I.jsxs)("div",{style:j.header,children:[(0,I.jsx)(U().Z,{placement:G().Placement.Bottom,render:e=>(0,I.jsx)("div",{...e,style:j.propertyName,children:l.name}),renderTooltip:()=>l.name}),(0,I.jsx)(Ie,{selectedItem:_,handleSelectOperator:T})]}),subHeaderComponent:_.hasInput&&(0,I.jsx)(S().Z,{desktopStyle:j.mobileInputWrapper,children:P}),customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}}})}function Ne(e){const{propertyId:t,automationTriggerMenuStore:o,onClose:r}=e,{automationStore:i,collectionStore:l}=(0,V().P)(),s=(0,n().VK)((()=>l.getSchema()),[l])[t],u=(0,n().VK)((()=>i.getTrigger()),[i]);let p=[];"event"!==(null==u?void 0:u.type)&&"notification_event"!==(null==u?void 0:u.type)||("some"===u.event.pagePropertiesEdited.type?p=u.event.pagePropertiesEdited.some||[]:"all"===u.event.pagePropertiesEdited.type&&(p=u.event.pagePropertiesEdited.all||[]));const d=p.find((e=>e.property===t)),m=d??{property:t,filter:{operator:"changes_to_any"}};if(!s)return null;if(!(0,c().bD)(s))return null;const g=!(0,a().$K)(d);return"multi_select"===s.type||"select"===s.type?(0,I.jsx)(_e,{automationTriggerMenuStore:o,onClose:r,propertyChangedFilter:m.filter,propertyId:t,propertySchema:s,shouldUseDefaultPropertyOperator:g}):"status"===s.type?(0,I.jsx)(Ve,{propertyId:t,automationTriggerMenuStore:o,propertySchema:s,propertyChangedFilter:m.filter,onClose:r}):"checkbox"===s.type?(0,I.jsx)(L,{automationTriggerMenuStore:o,onClose:r,propertyChangedFilter:m.filter,propertyId:t,propertySchema:s}):"person"===s.type?(0,I.jsx)(ue,{automationTriggerMenuStore:o,collectionStore:l,onClose:r,propertyChangedFilter:m.filter,propertyId:t,propertySchema:s,shouldUseDefaultPropertyOperator:g}):"number"===s.type?(0,I.jsx)(X,{automationTriggerMenuStore:o,onClose:r,propertyChangedFilter:m.filter,propertyId:t,propertySchema:s,shouldUseDefaultPropertyOperator:g}):"email"===s.type||"phone_number"===s.type||"text"===s.type||"title"===s.type||"url"===s.type?(0,I.jsx)(Fe,{automationTriggerMenuStore:o,onClose:r,propertyChangedFilter:m.filter,propertyId:t,propertySchema:s,shouldUseDefaultPropertyOperator:g}):"relation"===s.type?(0,I.jsx)(fe,{automationTriggerMenuStore:o,collectionStore:l,onClose:r,propertyChangedFilter:m.filter,propertyId:t,propertySchema:s,shouldUseDefaultPropertyOperator:g}):null}function Be(e){const{initialState:t,buttonPopupParent:o}=e,l=(0,n().VK)((()=>{const e=new(i().Bh);return e.setState({insertionPoint:void 0,stack:[t]}),e}),[t]),s=(0,n().VK)((()=>l.getCurrentTab()),[l]),u=(0,r.useCallback)((()=>o.close()),[o]);return s?"eventTriggers"===s.type?(0,I.jsx)(F,{automationTriggerMenuStore:l,onClose:u}):"propertyChangedFilter"===s.type?(0,I.jsx)(Ne,{propertyId:s.property,automationTriggerMenuStore:l,onClose:u}):(0,a().t1)(s):null}},906022:(e,t,o)=>{o.d(t,{Dl:()=>he,ew:()=>ye,Zr:()=>fe});o(267602),o(653476),o(241792),o(228244);var r=o(667294),n=()=>o(142735),a=()=>o(637118),i=()=>o(339352),l=()=>o(846550),s=()=>o(788860),u=()=>o(707513),c=()=>o(953293),p=()=>o(361726),d=()=>o(809638),m=()=>o(70753),g=o(785893);function y(){const{removeAnyPropertyEditedTrigger:e}=(0,d().i)(),t=(0,s().YB)(),o=(0,l().yK)((()=>({title:{fontWeight:u().Ue.medium}})),[]),r=p().c5(t);return(0,g.jsx)(m().R,{icon:c().R,onDelete:e,tooltip:r,children:(0,g.jsx)("div",{style:o.title,children:r})})}var h=()=>o(912203),f=()=>o(455947),v=()=>o(226413),x=()=>o(466970),S=()=>o(605252),b=()=>o(195245),C=()=>o(448419),k=()=>o(676279),T=()=>o(867624);function M(e){const{renderOrigin:t,property:o}=e,r=(0,k().d)();return(0,g.jsx)(C().ZP,{popupType:r,renderOrigin:t,render:e=>(0,g.jsx)(T().Z,{initialState:{type:"propertyChangedFilter",property:o},buttonPopupParent:e})})}var _=()=>o(492120),j=()=>o(882701),P=()=>o(394166),V=()=>o(14938);function w(e){let{propertySchema:t,onClick:o}=e;return(0,g.jsx)(V().n,{onClick:o,icon:e=>(0,g.jsx)(P().Y,{propertySchema:t,style:e}),tooltip:(0,g.jsx)(I,{propertyName:t.name}),children:(0,g.jsx)(A,{propertyName:t.name})})}function A(e){let{propertyName:t}=e;const o=(0,s().YB)(),r=(0,l().yK)((()=>({propertyName:{...u().Yu,fontWeight:u().Ue.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),n=p().Vf(o,{propertyName:(0,g.jsx)("span",{style:r.propertyName,children:t})});return(0,g.jsx)("span",{style:r.wrap,children:n})}function I(e){let{propertyName:t}=e;const o=(0,s().YB)();return(0,g.jsx)(g.Fragment,{children:p().Vf(o,{propertyName:t})})}function R(e){let{propertySchema:t,onClick:o}=e;return(0,g.jsx)(V().n,{onClick:o,icon:e=>(0,g.jsx)(P().Y,{propertySchema:t,style:e}),tooltip:(0,g.jsx)(N,{propertyName:t.name}),children:(0,g.jsx)(F,{propertyName:t.name})})}function F(e){let{propertyName:t}=e;const o=(0,s().YB)(),r=(0,l().yK)((()=>({propertyName:{...u().Yu,fontWeight:u().Ue.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),n=p().$G(o,{propertyName:(0,g.jsx)("span",{style:r.propertyName,children:t})});return(0,g.jsx)("span",{style:r.wrap,children:n})}function N(e){let{propertyName:t}=e;const o=(0,s().YB)();return(0,g.jsx)(g.Fragment,{children:p().$G(o,{propertyName:t})})}var B=()=>o(194930);function Z(e){const{filter:t,propertySchema:o,onClick:r}=e,{title:n,tooltipTitle:a,styles:i}=(0,B().Kk)({numberValue:t.value.value,operator:t.operator,propertySchema:o,messageType:"trigger"});return(0,g.jsx)(V().n,{onClick:r,tooltip:(0,g.jsx)("span",{children:a}),children:(0,g.jsx)("div",{style:i.content,children:n})})}var E=()=>o(236647),K=()=>o(766933),O=()=>o(696459),L=()=>o(735501),D=()=>o(529048),H=()=>o(957250),W=()=>o(414412);function U(e){const{deletedPropertySchema:t}=e,o=null==t?void 0:t.type,{property:a}=(0,r.useContext)(ye),{removePropertyTrigger:i}=(0,d().i)(),s=(0,x().E)("automation_updated_error_states"),c=(0,l().yK)((e=>({content:{color:e.text.uiRedPrimary,fontWeight:s?u().Ue.regular:u().Ue.medium,whiteSpace:"normal"},icon:{fill:e.text.uiRedPrimary},iconWrap:{...s&&{background:e.tint.uiRed,borderRadius:4}},propertyType:{color:e.accentColors.red[700]}})),[s]),p=(0,k().d)(),y=(0,n().qz)(void 0,D().Z),h=(0,r.useCallback)((()=>y.reset()),[y]),f=(0,r.useCallback)((()=>{i(a)}),[a,i]),v=(0,O().$K)(t)?(0,H().Ox)({propertySchema:t,styles:c,hasAutomationUpdatedErrorStatesEnabled:s}):(0,H().fX)(),S=(0,O().$K)(t)?(0,H().Si)({propertySchema:t,hasAutomationUpdatedErrorStatesEnabled:s}):(0,H().fX)();return(0,g.jsx)(C().ZP,{buttonPopupStore:y,popupType:p,render:()=>(0,g.jsx)(W()._,{closeMenu:h,propertyId:a}),renderOrigin:e=>(0,g.jsx)(m().R,{...e,icon:s&&(0,O().$K)(o)?K().wG[o]:L().t,onDelete:f,styles:c,tooltip:S,children:(0,g.jsx)("div",{style:c.content,children:v})})})}var q=()=>o(903098),Y=()=>o(317632);function $(e){const{filter:t,propertySchema:o,onClick:r}=e,a=(0,q().z)(),{collectionStore:i}=(0,b().P)(),l=(0,x().E)("collections_xws"),s=(0,n().VK)((()=>i.getSpaceId()),[i]),u=(0,n().VK)((()=>l&&(0,v().Qh)(s,o)),[l,o,s]),c=(0,n().VK)((()=>(0,Y().RX)({collectionStore:i,filter:t})),[i,t]),{title:p,tooltipTitle:d,styles:m}=(0,Y().lr)({automationContextValues:a,filter:t,collectionStore:i,operator:t.operator,propertySchema:o,messageType:"trigger",value:null==c?void 0:c.value});return u?(0,g.jsx)(j().uZ,{propertySchema:o}):(0,g.jsx)(V().n,{onClick:r,tooltip:(0,g.jsx)("span",{children:d}),children:(0,g.jsx)("div",{style:m.content,children:p})})}var z=()=>o(344470),G=()=>o(823718),Q=()=>o(796675);function X(e){const{filter:t,propertySchema:o,onClick:r}=e,{title:n,tooltipTitle:a,styles:i}=(0,Q().ui)({textValue:t.value.value,operator:t.operator,propertySchema:o,messageType:"trigger"});return(0,g.jsx)(V().n,{onClick:r,tooltip:(0,g.jsx)("span",{children:a}),children:(0,g.jsx)("div",{style:i.content,children:n})})}var J=()=>o(270315),ee=()=>o(219727),te=()=>o(827973),oe=()=>o(198829),re=()=>o(255577),ne=()=>o(388284),ae=()=>o(739479),ie=()=>o(918745);function le(e){const{closeMenu:t,propertyId:o}=e,{removePropertyTrigger:n}=(0,d().i)(),a=(0,r.useCallback)((()=>{n(o),null==t||t()}),[t,o,n]),i=(0,ie().F)({width:266}),u=(0,ee().Fy)().isMobile,c=(0,l().yK)((e=>({icon:{color:e.accentColors.gray[600],height:"auto",width:u?"12px":"16px"}})),[u]),p=(0,r.useMemo)((()=>({action:a,key:"delete-property-menu-item",render:e=>(0,g.jsx)(te().Z,{...e,icon:(0,ae().y)(c.icon),title:(0,g.jsx)(s()._H,{id:"automationUnsupportedOperatorMenu.deleteTrigger.title",defaultMessage:"Delete trigger"})})})),[a,c.icon]);return(0,g.jsx)(oe().Z,{...i,children:(0,g.jsx)(re().Z,{initialFocus:0,sections:[{key:"actions-section",items:[p],render:e=>(0,g.jsx)(ne().Z,{...e})}],type:re().i.Vertical})})}function se(e){let{filter:t,propertySchema:o}=e;const a=(0,s().YB)(),{property:i}=(0,r.useContext)(ye),{removePropertyTrigger:c}=(0,d().i)(),p=(0,x().E)("automation_updated_error_states"),y=(0,l().yK)((e=>({content:{color:e.text.uiRedPrimary,fontWeight:p?u().Ue.regular:u().Ue.medium,whiteSpace:"normal"},icon:{fill:e.text.uiRedPrimary},iconWrap:{...p&&{background:e.tint.uiRed,borderRadius:4}},propertyType:{color:e.accentColors.red[700]}})),[p]),h=(0,k().d)(),f=(0,n().qz)(void 0,D().Z),v=(0,r.useCallback)((()=>f.reset()),[f]),b=(0,r.useCallback)((()=>{c(i)}),[i,c]),T=function(e){const{propertySchema:t,styles:o,hasAutomationUpdatedErrorStatesEnabled:r}=e,n=t.type,a=t.name||J().SO[n];if(r)return(0,g.jsx)(s()._H,{defaultMessage:'"{propertyTypeDisplayName}" property type is incompatible with this step',id:"updateThisPageUnsupportedOperatorAction.updatedUnsupportedOperator.title",values:{propertyTypeDisplayName:a}});return(0,g.jsx)(s()._H,{defaultMessage:"{propertyTypeDisplayName} property type is incompatible with this step",id:"updateThisPageUnsupportedOperatorAction.unsupportedOperator.title",values:{propertyTypeDisplayName:(0,g.jsx)("span",{style:o.propertyType,children:a})}})}({propertySchema:o,styles:y,hasAutomationUpdatedErrorStatesEnabled:p}),M=function(e){const{filter:t,intl:o}=e,r=S().f9[t.operator],n=(S().Uo[r]||[]).map((e=>J().SO[e])),a=o.formatList(n,{style:"long",type:"disjunction"});return(0,g.jsx)(s()._H,{defaultMessage:"Remove step or restore property to a valid type: {propertiesSupportedList}",id:"updateThisPageUnsupportedOperatorAction.unsupportedOperator.titleList",values:{propertiesSupportedList:a}})}({intl:a,filter:t}),_=o.type;return(0,g.jsx)(C().ZP,{buttonPopupStore:f,popupType:h,render:()=>(0,g.jsx)(le,{closeMenu:v,propertyId:i}),renderOrigin:e=>(0,g.jsx)(m().R,{...e,icon:p&&(0,O().$K)(_)?K().wG[_]:L().t,onDelete:b,styles:y,tooltip:M,children:(0,g.jsx)("div",{style:y.content,children:T})})})}var ue=()=>o(152557),ce=()=>o(49952);function pe(e){let{propertySchema:t}=e;const{property:o}=(0,r.useContext)(ye),{removePropertyTrigger:a}=(0,d().i)(),i=(0,x().E)("automation_updated_error_states"),s=(0,l().yK)((e=>({content:{color:e.text.uiRedPrimary,fontWeight:i?u().Ue.regular:u().Ue.medium,whiteSpace:"normal"},icon:{fill:e.text.uiRedPrimary},iconWrap:{...i&&{background:e.tint.uiRed,borderRadius:4}},propertyType:{color:e.accentColors.red[700]}})),[i]),c=(0,k().d)(),p=(0,n().qz)(void 0,D().Z),y=(0,r.useCallback)((()=>p.reset()),[p]),h=(0,r.useCallback)((()=>{a(o)}),[o,a]),f=(0,ue().JS)({propertySchema:t,styles:s,hasAutomationUpdatedErrorStatesEnabled:i}),v=(0,ue().K1)({propertySchema:t,hasAutomationUpdatedErrorStatesEnabled:i}),S=t.type;return(0,g.jsx)(C().ZP,{buttonPopupStore:p,popupType:c,render:()=>(0,g.jsx)(ce().Iw,{closeMenu:y,propertyId:o}),renderOrigin:e=>(0,g.jsx)(m().R,{...e,icon:i&&(0,O().$K)(S)?K().wG[S]:L().t,onDelete:h,styles:s,tooltip:v,children:(0,g.jsx)("div",{style:s.content,children:f})})})}function de(e){const{collectionStore:t}=(0,b().P)(),{property:o,filter:r}=e,[a,i]=(0,n().VK)((()=>{var e,r;return[null===(e=t.getSchema())||void 0===e?void 0:e[o],null===(r=t.getDeletedSchema())||void 0===r?void 0:r[o]]}),[t,o]);if(!a)return(0,g.jsx)(U,{deletedPropertySchema:i});if(!(0,h().$M)(a))return(0,g.jsx)(pe,{propertySchema:a});const l=S().vf[a.type]||a.type;return"changes_to_any"!==r.operator&&"is_empty"!==r.operator&&r.operator&&S().f9[r.operator]!==l?(0,g.jsx)(se,{propertySchema:a,filter:r}):(0,h().bD)(a)?(0,g.jsx)(ge,{property:o,propertySchema:a,filter:r}):(0,g.jsx)(R,{propertySchema:a})}function me(e){const{filter:t,onClick:o,propertySchema:r}=e,{collectionStore:a}=(0,b().P)(),i=(0,x().E)("collections_xws"),l=(0,n().VK)((()=>i&&(0,v().p_)(r)&&(0,v().Qh)(a.getSpaceId(),r)),[a,r,i]);return(0,v().p_)(r)&&l?(0,g.jsx)(j().uZ,{propertySchema:r}):"is_empty"===t.operator?(0,g.jsx)(w,{...e,propertySchema:r}):"changes_to_any"!==t.operator&&(0,f().vR)(t)?"checkbox"===r.type&&(0,f().XA)(t)?(0,g.jsx)(_().Ij,{filter:t,onClick:o,propertySchema:r}):"status"===r.type&&(0,f().r2)(t)?(0,g.jsx)(G().V,{filter:t,onClick:o,propertySchema:r}):"select"===r.type&&(0,f().dx)(t)||"multi_select"===r.type&&(0,f().NU)(t)?(0,g.jsx)(z().vX,{filter:t,onClick:o,propertySchema:r}):"person"===r.type&&(0,f().Gb)(t)?(0,g.jsx)(E().u,{filter:t,onClick:o,propertySchema:r}):"number"===r.type&&(0,f().h6)(t)?(0,g.jsx)(Z,{filter:t,onClick:o,propertySchema:r}):"email"!==r.type&&"phone_number"!==r.type&&"text"!==r.type&&"title"!==r.type&&"url"!==r.type||!(0,f().Ly)(t)?"relation"===r.type&&(0,f().e)(t)?(0,g.jsx)($,{filter:t,onClick:o,propertySchema:r}):(0,g.jsx)(R,{onClick:o,propertySchema:r}):(0,g.jsx)(X,{filter:t,onClick:o,propertySchema:r}):(0,g.jsx)(R,{onClick:o,propertySchema:r})}function ge(e){const{filter:t,propertySchema:o,property:n}=e,a=(0,r.useCallback)((e=>(0,g.jsx)(me,{filter:t,onClick:e.onClick,propertySchema:o})),[t,o]);return(0,g.jsx)(M,{renderOrigin:a,property:n})}const ye=(0,r.createContext)({pagePropertiesEdited:[],property:""});function he(){const{automationStore:e,contextType:t}=(0,a().YC)(),o=(0,i().w)(e,t),r=fe(e),l=(0,n().VK)((()=>{var t;if(!e||!e.isTriggerType("event")&&!e.isTriggerType("notification_event"))return;const o=null===(t=e.getEventConfiguration())||void 0===t?void 0:t.pagePropertiesEdited;return"none"===(null==o?void 0:o.type)?void 0:o}),[e]),s=(0,n().VK)((()=>null==o?void 0:o.getSchema()),[o]);if(!r||!l)return null;if("any"===l.type)return(0,g.jsx)(y,{});if(!s)return null;let u=[];return"all"===l.type?u=l.all??[]:"some"===l.type&&(u=l.some??[]),u?(0,g.jsx)(g.Fragment,{children:u.map((e=>{let{property:t,filter:o}=e;return(0,g.jsx)(ye.Provider,{value:{property:t,pagePropertiesEdited:u},children:(0,g.jsx)(de,{property:t,filter:o})},t)}))}):null}function fe(e){return(0,n().VK)((()=>{if(!(null!=e&&e.isTriggerType("event")||null!=e&&e.isTriggerType("notification_event")))return!1;const t=e.getEventConfiguration(),o=Boolean("none"!==(null==t?void 0:t.pagePropertiesEdited.type)),r=Boolean("all"===(null==t?void 0:t.pagePropertiesEdited.type)&&!(null==t||!t.pagePropertiesEdited.all)),n=Boolean("some"===(null==t?void 0:t.pagePropertiesEdited.type)&&!(null==t||!t.pagePropertiesEdited.some)),a=Boolean("any"===(null==t?void 0:t.pagePropertiesEdited.type));return o&&(r||n||a)}),[e])}ye.displayName="PropertyEditedTriggerContext"},492120:(e,t,o)=>{o.d(t,{Ij:()=>d,l4:()=>g});o(267602),o(653476),o(667294);var r=()=>o(846550),n=()=>o(788860),a=()=>o(707513),i=()=>o(972350),l=()=>o(231750),s=()=>o(282628),u=()=>o(361726),c=()=>o(14938),p=o(785893);function d(e){const t=(0,n().YB)(),{propertySchema:o,filter:r,onClick:a}=e;return(0,p.jsx)(c().n,{onClick:a,tooltip:g({filter:r,intl:t,propertySchema:o}),children:(0,p.jsx)(m,{propertySchema:o,filter:r})})}function m(e){let{propertySchema:t,filter:o}=e;const i=(0,n().YB)(),l=(0,r().yK)((()=>({propertyName:{...a().Yu,fontWeight:a().Ue.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),s=function(e){const{filter:t,intl:o,propertySchema:r,styles:n}=e,a=r.name,i=t.value,l={propertyName:(0,p.jsx)("span",{style:n.propertyName,children:a}),propertyValues:(0,p.jsx)(y,{checkboxValue:i.value??!1})};return(0,u().vz)(o,l)}({filter:o,intl:i,propertySchema:t,styles:l});return(0,p.jsx)("span",{style:l.wrap,children:s})}function g(e){const{filter:t,intl:o,propertySchema:r}=e,a={propertyName:r.name,propertyValues:!0===t.value.value?(0,p.jsx)(n()._H,{...u().Bo.actionCheckboxPropertyChecked}):(0,p.jsx)(n()._H,{...u().Bo.actionCheckboxPropertyUnchecked})};return(0,u().vz)(o,a)}function y(e){const{checkboxValue:t}=e,o=!0===t?(0,s().V)({width:12}):(0,l().z)({width:10}),r=!0===t?(0,p.jsx)(n()._H,{...u().Bo.actionCheckboxPropertyChecked}):(0,p.jsx)(n()._H,{...u().Bo.actionCheckboxPropertyUnchecked});return(0,p.jsx)(i().o,{icon:o,children:r})}},882701:(e,t,o)=>{o.d(t,{Jw:()=>x,uZ:()=>f});var r=o(667294),n=()=>o(142735),a=()=>o(846550),i=()=>o(788860),l=()=>o(707513),s=()=>o(448419),u=()=>o(735501),c=()=>o(529048),p=()=>o(676279),d=()=>o(809638),m=()=>o(49952),g=()=>o(70753),y=()=>o(906022),h=o(785893);function f(e){const{propertySchema:t}=e,{property:o}=(0,r.useContext)(y().ew),{removePropertyTrigger:m}=(0,d().i)(),f=(0,a().yK)((e=>({content:{...l().Yu,color:e.text.uiRedPrimary,fontWeight:l().Ue.medium,whiteSpace:"normal"},icon:{fill:e.text.uiRedPrimary},propertyName:{color:e.accentColors.red[700],fontWeight:l().Ue.semibold,whiteSpace:"nowrap"}})),[]),x=(0,p().d)(),b=(0,n().qz)(void 0,c().Z),C=(0,r.useCallback)((()=>b.reset()),[b]),k=(0,r.useCallback)((()=>{m(o)}),[o,m]),T=function(e){const{propertySchema:t,styles:o}=e;return(0,h.jsx)(i()._H,{defaultMessage:"{propertyName} property is a cross-workspace relation",id:"crossWorkspaceRelationPropertyTrigger.title",values:{propertyName:(0,h.jsx)("span",{style:o.propertyName,children:t.name})}})}({propertySchema:t,styles:f}),M=function(e){const{propertySchema:t}=e;return(0,h.jsx)(i()._H,{defaultMessage:"{propertyName} property is a cross-workspace relation. Cross-workspace features are restricted in automations and will not work.",id:"crossWorkspaceRelationPropertyTrigger.tooltip",values:{propertyName:S({maxLength:20,text:t.name})}})}({propertySchema:t});return(0,h.jsx)(s().ZP,{buttonPopupStore:b,popupType:x,render:()=>(0,h.jsx)(v,{closeMenu:C,propertyId:o}),renderOrigin:e=>(0,h.jsx)(g().R,{...e,icon:u().t,onDelete:k,styles:f,tooltip:M,children:(0,h.jsx)("div",{style:f.content,children:T})})})}function v(e){const{closeMenu:t,propertyId:o}=e,{removePropertyTrigger:n}=(0,d().i)(),a=(0,r.useCallback)((()=>{n(o),null==t||t()}),[t,o,n]);return(0,h.jsx)(m().PO,{onDelete:a,stepType:"trigger"})}function x(e){const{propertySchema:t}=e;return(0,h.jsx)(i()._H,{defaultMessage:"{propertyName} property is a cross-workspace relation",id:"crossWorkspaceRelationPropertyTrigger.title",values:{propertyName:t.name}})}function S(e){const{maxLength:t,text:o,truncateCharacter:r}=e,n=r??"…",a=Array.from(o);return a.length<=t?o:`${a.slice(0,t-1).join("")}${n}`}},236647:(e,t,o)=>{o.d(t,{S:()=>p,u:()=>c});o(670560),o(267602),o(653476),o(731107),o(667294);var r=()=>o(142735),n=()=>o(816512),a=()=>o(455947),i=()=>o(637118),l=()=>o(116291),s=()=>o(14938),u=o(785893);function c(e){const{filter:t,propertySchema:o,onClick:n}=e,{automationStore:a}=(0,i().YC)(),c=(0,r().VK)((()=>p(t,a.getRecordModel)),[a.getRecordModel,t]),{title:d,tooltipTitle:m,styles:g}=(0,l().TY)({actorModels:c,messageType:"trigger",operator:t.operator,propertySchema:o});return(0,u.jsx)(s().n,{onClick:n,tooltip:(0,u.jsx)("span",{children:m}),children:(0,u.jsx)("div",{style:g.content,children:d})})}function p(e,t){return(0,a().R8)(e).reduce(((e,o)=>("exact"===o.type&&o.value&&e.push((0,n().Hl)({pointer:o.value,getRecordModel:t})),e)),[])}},14938:(e,t,o)=>{o.d(t,{n:()=>p});var r=o(667294),n=()=>o(142735),a=()=>o(195245),i=()=>o(809638),l=()=>o(70753),s=()=>o(394166),u=()=>o(906022),c=o(785893);function p(e){const{property:t}=(0,r.useContext)(u().ew),{collectionStore:o}=(0,a().P)(),{removePropertyTrigger:p}=(0,i().i)(),d=(0,r.useCallback)((()=>{p(t)}),[t,p]),m=(0,n().VK)((()=>o.getSchema()),[o])[t],g=m?e=>(0,c.jsx)(s().Y,{propertySchema:m,style:e}):void 0;return(0,c.jsx)(l().R,{icon:g,onDelete:d,...e,children:e.children})}},344470:(e,t,o)=>{o.d(t,{JT:()=>x,O1:()=>b,vX:()=>f,zI:()=>S});o(267602),o(653476),o(241792),o(667294);var r=()=>o(846550),n=()=>o(532850),a=()=>o(38883),i=()=>o(788860),l=()=>o(696459),s=()=>o(707513),u=()=>o(246471),c=()=>o(78014),p=()=>o(682108),d=()=>o(361726),m=()=>o(253783),g=()=>o(14938),y=o(785893);const h=5;function f(e){const t=(0,i().YB)(),{filter:o,propertySchema:r,onClick:n}=e,a={...s().Yu,fontWeight:s().Ue.medium},u=o.value,c=r.name,d=(Array.isArray(u)?u:[u]).map((e=>e.value)).filter(l().$K),m=S({intl:t,isText:!0,limit:h,optionValues:d,propertySchema:r}),f=t.formatList(m,{style:"long",type:"disjunction"}),C=b({filter:o,propertySchema:r});if(!C)return null;const k=x(C)(t,{propertyName:(0,y.jsx)("span",{style:a,children:c}),propertyValues:(0,p().H)(f)});return(0,y.jsx)(g().n,{tooltip:k,onClick:n,children:(0,y.jsx)(v,{...C})})}function v(e){const{filter:t,propertySchema:o}=e,n=(0,i().YB)(),a=t.value,u=o.name,c=(Array.isArray(a)?a:[a]).map((e=>e.value)).filter(l().$K),d=S({intl:n,limit:h,optionValues:c,propertySchema:o}),m=n.formatList(d,{style:"long",type:"disjunction"}),g=(0,r().yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...s().Yu,fontWeight:s().Ue.medium}})),[]),f=b({filter:t,propertySchema:o});if(!f)return null;const v=x(f)(n,{propertyName:(0,y.jsx)("span",{style:g.propertyName,children:u}),propertyValues:(0,p().H)(m)});return(0,y.jsx)("div",{style:g.content,children:v})}function x(e){let{filter:t,propertySchema:o}=e;return"select"===o.type?"enum_is"===t.operator?d().LY:d().VH:"enum_contains"===t.operator?d().iP:d().RP}function S(e){let{intl:t,isText:o,limit:r,optionValues:i,propertySchema:l,tokenFormat:s=a().lo.Medium}=e;const p=l.options??[],g=i.map((e=>{const r=(0,n().i7)(p,e);return r?o?r.value:(0,y.jsx)(u().a,{value:r.value,color:r.color,format:s,isSingle:!0,showRemoveButton:!1},r.id):o?(0,d().ST)(t):(0,y.jsx)(m().Z,{tokenFormat:s},`missing_option_value_${e}`)}));let h;if(void 0!==r&&g.length>r){const e=g.length-r,t=o?`+${e}`:(0,y.jsx)(c().Z,{format:a().lo.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");h=[...g.slice(0,r),t]}else h=g;return h}function b(e){const{filter:t,propertySchema:o}=e;if("select"===o.type){if("enum_is"===t.operator||"enum_is_not"===t.operator)return{filter:t,propertySchema:o}}else if("multi_select"===o.type&&("enum_contains"===t.operator||"enum_does_not_contain"===t.operator))return{filter:t,propertySchema:o};return!1}},823718:(e,t,o)=>{o.d(t,{L:()=>b,V:()=>v});o(267602),o(653476),o(470928),o(241792),o(667294);var r=()=>o(846550),n=()=>o(455947),a=()=>o(532850),i=()=>o(38883),l=()=>o(788860),s=()=>o(696459),u=()=>o(707513),c=()=>o(246471),p=()=>o(78014),d=()=>o(682108),m=()=>o(361726),g=()=>o(253783),y=()=>o(14938),h=o(785893);const f=5;function v(e){const t=(0,l().YB)(),{filter:o,limit:r=f,propertySchema:a,onClick:i}=e,u=a.name,c=(0,n().wB)(o),p=c.map((e=>"is_group"===e.type?e.value:void 0)).filter(s().$K),d=c.map((e=>"is_option"===e.type?e.value:void 0)).filter(s().$K),m=b({intl:t,groupValues:p,limit:r,optionValues:d,propertySchema:a}),g=b({intl:t,isText:!0,groupValues:p,limit:r,optionValues:d,propertySchema:a});return(0,h.jsx)(y().n,{onClick:i,tooltip:(0,h.jsx)(S,{propertyName:u,statusValues:g}),children:(0,h.jsx)(x,{propertyName:u,statusValues:m})})}function x(e){let{propertyName:t,statusValues:o}=e;const n=(0,l().YB)(),a=(0,r().yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...u().Yu,fontWeight:u().Ue.medium}})),[]),i=n.formatList(o,{style:"long",type:"disjunction"});return(0,h.jsx)("div",{style:a.content,children:(0,m().VO)(n,{propertyName:(0,h.jsx)("span",{style:a.propertyName,children:t}),propertyValues:(0,d().H)(i)})})}function S(e){let{propertyName:t,statusValues:o}=e;const n=(0,l().YB)(),a=(0,r().yK)((()=>({propertyName:{...u().Yu,fontWeight:u().Ue.medium}})),[]),i=n.formatList(o,{style:"long",type:"disjunction"});return(0,h.jsx)(h.Fragment,{children:(0,m().VO)(n,{propertyName:(0,h.jsx)("span",{style:a.propertyName,children:t}),propertyValues:(0,d().H)(i)})})}function b(e){let{groupValues:t,intl:o,isText:r,limit:n,optionValues:l,propertySchema:u,tokenFormat:d=i().lo.Medium}=e;const y=u.groups||[],f=u.options||[],v=t.map((e=>{const t=y.find((t=>t.name===e));if(t)return r?t.name:(0,h.jsx)(c().F,{format:d,isSingle:!0,value:t.name,color:t.color,groupColor:null==t?void 0:t.color,showRemoveButton:!1,showEllipsis:!1},t.id)})).filter(s().$K),x=l.map((e=>{const t=(0,a().i7)(f,e);if(void 0===t)return r?(0,m().ST)(o):(0,h.jsx)(g().Z,{tokenFormat:d},`missing_option_value_${e}`);if(r)return t.value;const n=y.find((e=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return(0,h.jsx)(c().F,{format:d,isSingle:!0,value:t.value,color:t.color,groupColor:null==n?void 0:n.color,showRemoveButton:!1,showEllipsis:!0},t.id)})),S=[...v,...x];let b=[];if(void 0!==n&&S.length>n){const e=x.length-n,t=r?`+${e}`:(0,h.jsx)(p().Z,{format:i().lo.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");b=[...x.slice(0,n),t]}else b=S;return b}},394166:(e,t,o)=>{o.d(t,{Y:()=>i});o(667294);var r=()=>o(846550),n=()=>o(766933),a=o(785893);function i(e){let{style:t={},propertySchema:o}=e;const i=(0,r().Fg)();return(0,a.jsx)(n().ZP,{size:16,theme:i,icon:o.icon,style:{...t,overflow:"visible"},type:o.type})}},166312:(e,t,o)=>{o.d(t,{De:()=>y,HH:()=>h,WP:()=>m,dF:()=>g,mq:()=>c,wo:()=>p,z$:()=>d});o(670560);var r=()=>o(730120),n=(o(667294),()=>o(157955)),a=()=>o(874459),i=()=>o(788860),l=()=>o(696459),s=()=>o(239482),u=o(785893);const c=[{frequency:"day",interval:1},{frequency:"week",interval:1},{frequency:"month",interval:1},{frequency:"year",interval:1}];function p(e){const t=s().eG(e)??[],o=[];for(const r of t){if(!("block"===r.table&&!0===r.isTemplate()&&r.getFormat().automation_id&&r.id!==e.id))continue;const t=r.getAutomationStore();if(t){if(!t.isReady())return{automationStoresReady:!1};void 0!==t.getRecurrence()&&t.isDefined()&&o.push(t.getModel())}}return{automationStoresReady:!0,...(0,n().templateAncestorsViolateRecurrenceNesting)(o)}}function d(e){switch(e){case"day":return(0,u.jsx)(i()._H,{defaultMessage:"Repeat daily",id:"database.templatePickerItem.recurrenceFrequency.daily"});case"week":return(0,u.jsx)(i()._H,{defaultMessage:"Repeat weekly",id:"database.templatePickerItem.recurrenceFrequency.weekly"});case"month":return(0,u.jsx)(i()._H,{defaultMessage:"Repeat monthly",id:"database.templatePickerItem.recurrenceFrequency.monthly"});case"year":return(0,u.jsx)(i()._H,{defaultMessage:"Repeat yearly",id:"database.templatePickerItem.recurrenceFrequency.yearly"});default:(0,l().t1)(e)}}function m(e,t){const o="week"!==t||void 0!==e.weekdays&&0!==e.weekdays.length?e.weekdays:[(a=e.start_date,(0,l().Yd)(n().RRULE_WEEKDAYS_MAP)[r().ou.fromMillis(a).weekday-1])];var a;return{...e,weekdays:o,frequency:t}}function g(){return{start_date:r().ou.local().plus({days:1}).set({hour:0,minute:0,second:0,millisecond:0}).toMillis(),timezone:(0,a().Sv)(),hour:0,minute:0,frequency:"day",interval:1}}function y(e){const{recurrence:t,intl:o,leadingPhrase:r}=e;return(0,n().rruleFromRecurrence)({..."month"===t.frequency?{...t,monthly_restriction:void 0}:t,weekdays:void 0,hour:0,minute:0,end_condition:void 0}).toText((e=>{switch(e){case"every":if(void 0===r)return"";if("every"===r)return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.every",defaultMessage:"every"});if("repeat every"===r)return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.repeatEvery",defaultMessage:"repeat every"});(0,l().t1)(r);break;case"day":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.day",defaultMessage:"day"});case"days":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.days",defaultMessage:"days"});case"week":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.week",defaultMessage:"week"});case"weeks":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.weeks",defaultMessage:"weeks"});case"month":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.month",defaultMessage:"month"});case"months":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.months",defaultMessage:"months"});case"year":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.year",defaultMessage:"year"});case"years":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.years",defaultMessage:"years"});default:return e.toString()}})).trim()}function h(e){const t=e.getRecurrence();return Boolean(e.isTriggerType("recurrence")&&t&&"disabled_recurrence_ended"===e.getStatus())}},682108:(e,t,o)=>{o.d(t,{H:()=>n});o(670560),o(667294);var r=o(785893);function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Array.isArray(e))return[e];const o=[];for(const n of e)if("string"==typeof n&&" "!==n[0]){const e=o.pop();o.push((0,r.jsxs)("div",{style:t,children:[e,n]}))}else o.push(n);return o}},361726:(e,t,o)=>{o.d(t,{$G:()=>j,Bo:()=>a,D6:()=>u,DM:()=>m,Gx:()=>l,I4:()=>c,Ig:()=>b,It:()=>p,LY:()=>I,Lu:()=>g,MB:()=>h,Mz:()=>T,P:()=>v,P5:()=>f,RP:()=>N,S0:()=>y,ST:()=>Z,VH:()=>R,VO:()=>B,Vf:()=>V,Wd:()=>x,Y6:()=>E,a5:()=>A,aD:()=>k,c5:()=>M,hW:()=>i,iP:()=>F,mP:()=>K,nf:()=>_,oJ:()=>D,rf:()=>S,s_:()=>w,tl:()=>O,vE:()=>C,vz:()=>P,wE:()=>d,yH:()=>L,zU:()=>s});o(267602),o(653476),o(241792);var r=()=>o(532850),n=()=>o(682108);const a=(0,o(788860).vU)({actionCheckboxPropertyChecked:{defaultMessage:"checked",id:"automations.action.checkboxProperty.checked"},actionCheckboxPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.checkboxProperty.single"},actionCheckboxPropertyUnchecked:{defaultMessage:"unchecked",id:"automations.action.checkboxProperty.unchecked"},actionDatePropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.dateProperty.single"},actionNumberPropertySet:{defaultMessage:"{propertyName} {operator} {propertyValues}",id:"automations.action.numberPropertySet.title"},actionTextPropertySet:{defaultMessage:"{propertyName} {operator} {propertyValues}",id:"automations.action.textPropertySet.title"},actionPersonPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.personProperty.single"},actionPropertyReplaceWith:{defaultMessage:"Replace {propertyName} with {propertyValue}",id:"automations.action.property.replaceWith"},actionPropertyReplaceWithOthers:{defaultMessage:"Replace {propertyName} with {propertyValue} and {numOthers} {numOthers, plural, one {other} other {others}}",id:"automations.action.property.replaceWithOthers"},actionPropertyAdd:{defaultMessage:"Add {propertyValue} to {propertyName}",id:"automations.action.property.add"},actionPropertyAddWithOthers:{defaultMessage:"Add {propertyValue} and {numOthers} {numOthers, plural, one {other} other {others}} to {propertyName}",id:"automations.action.property.addWithOthers"},actionPropertyRemove:{defaultMessage:"Remove {propertyValue} from {propertyName}",id:"automations.action.property.remove"},actionPropertyRemoveWithOthers:{defaultMessage:"Remove {propertyValue} and {numOthers} {numOthers, plural, one {other} other {others}} from {propertyName}",id:"automations.action.property.removeWithOthers"},actionPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.property.clear"},actionPropertyToggle:{defaultMessage:"Toggle {propertyValue} in {propertyName}",id:"automations.action.property.toggle"},actionPropertyToggleWithOthers:{defaultMessage:"Toggle {propertyValue} and {numOthers} {numOthers, plural, one {other} other {others}} in {propertyName}",id:"automations.action.property.toggleWithOthers"},actionRelationPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.relationProperty.single"},actionSelectPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.selectProperty.single"},actionStatusPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.statusProperty.single"},actionTextPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.textProperty.single"},actionDeletedProperty:{defaultMessage:"Edit a deleted property",id:"automations.action.deletedProperty"},triggerAnyPageAdded:{defaultMessage:"Page added",id:"automations.trigger.pageAdded.title"},triggerAnyPagePropertyEdit:{defaultMessage:"Any property edited",id:"automations.trigger.anyPagePropertyEdited.title"},triggerAnyPropertyEdit:{defaultMessage:"{propertyName} is edited",id:"automations.trigger.propertyChangesToAny.title"},triggerAnyPropertyClear:{defaultMessage:"{propertyName} is cleared",id:"automations.trigger.propertyCleared.title"},triggerButtonClicked:{defaultMessage:"<b>Button</b> is clicked",id:"automations.trigger.button.clicked"},triggerCheckboxPropertyChecked:{defaultMessage:"checked",id:"automations.trigger.checkboxProperty.checked"},triggerCheckboxPropertySet:{defaultMessage:"{propertyName} set to {propertyValues}",id:"automations.trigger.checkboxPropertySet.title"},triggerCheckboxPropertyUnchecked:{defaultMessage:"unchecked",id:"automations.trigger.checkboxProperty.unchecked"},triggerNumberPropertySet:{defaultMessage:"{propertyName} {operator} {propertyValues}",id:"automations.trigger.numberPropertySet.title"},triggerTextPropertySet:{defaultMessage:"{propertyName} {operator} {propertyValues}",id:"automations.trigger.textPropertySet.title"},triggerSelectPropertyIs:{id:"automations.trigger.selectPropertyIs.title",defaultMessage:"{propertyName} is set to {propertyValues}"},triggerSelectPropertyIsNot:{id:"automations.trigger.selectPropertyIsNot.title",defaultMessage:"{propertyName} is not set to {propertyValues}"},triggerMultiSelectPropertyContains:{id:"automations.trigger.multiSelectPropertyContains.title",defaultMessage:"{propertyName} contains {propertyValues}"},triggerMultiSelectPropertyDoesNotContain:{id:"automations.trigger.multiSelectPropertyDoesNotContain.title",defaultMessage:"{propertyName} does not contain {propertyValues}"},triggerStatusPropertySet:{defaultMessage:"{propertyName} set to {propertyValues}",id:"automations.trigger.statusPropertySet.singleProperty"},triggerPersonPropertyContainsSingle:{defaultMessage:"{propertyName} contains {propertyValue}",id:"automations.trigger.personPropertySet.singleProperty"},triggerPersonPropertyContainsMultiple:{defaultMessage:"{propertyName} contains any of {propertyValues}",id:"automations.trigger.personPropertySet.multipleProperties"},triggerPersonPropertyDoesNotContainSingle:{defaultMessage:"{propertyName} does not contain {propertyValue}",id:"automations.trigger.personPropertyDoesNotContain.singleProperty"},triggerPersonPropertyDoesNotContainMultiple:{defaultMessage:"{propertyName} does not contain any of {propertyValues}",id:"automations.trigger.personPropertyDoesNotContain.multipleProperties"},triggerRelationPropertyDoesNotContainSingle:{defaultMessage:"{propertyName} does not contain {propertyValue}",id:"automations.trigger.relationProperty.singleDoesNotContain"},triggerRelationPropertyDoesNotContainMultiple:{defaultMessage:"{propertyName} does not contain any of {propertyValue}",id:"automations.trigger.relationProperty.multipleDoesNotContain"},triggerRelationPropertyContainsMultiple:{defaultMessage:"{propertyName} contains any of {propertyValue}",id:"automations.trigger.relationProperty.multiple"},triggerRelationPropertyContainsSingle:{defaultMessage:"{propertyName} contains {propertyValue}",id:"automations.trigger.relationProperty.single"},triggerDeletedPropertyEdit:{defaultMessage:"Deleted property is edited",id:"automations.trigger.deletedPropertyEdited"},deletedPropertyOption:{defaultMessage:"Deleted option",id:"automations.values.deletedPropertyOption"},unknownValue:{defaultMessage:"Unknown value",id:"automations.values.unknownValue"},unknownPropertyTitle:{defaultMessage:"a property",id:"database.viewSettings.automationTab.unknownPropertyTitle"},triggerInvalidConfigurationTitle:{defaultMessage:"Invalid {propertyName} property configuration",id:"automations.trigger.invalidConfiguration"},inlineCustomFormulaDefaultName:{defaultMessage:"My value",id:"automations.formulas.inlineCustomFormulaDefaultName"}});function i(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionCheckboxPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function l(e){const{propertyName:t}=e;return{...a.actionPropertyClear,values:{propertyName:t}}}function s(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionDatePropertySetSingle,values:{propertyName:t,propertyValue:o}}}function u(e){const{propertyName:t,propertyValues:o,operator:r}=e;return{...a.actionNumberPropertySet,values:{propertyName:t,propertyValues:o,operator:r}}}function c(e){const{propertyName:t}=e;return{...a.triggerInvalidConfigurationTitle,values:{propertyName:t}}}function p(e){const{propertyName:t,propertyValues:o,operator:r}=e;return{...a.actionTextPropertySet,values:{propertyName:t,propertyValues:o,operator:r}}}function d(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionPersonPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function m(e){let{elements:t,intl:o}=e;const r=t.length>3?t.length-2:0,a=r>0?2:3,i=o.formatList(t.slice(0,a),{style:"long",type:r>0?"unit":"conjunction"});return{numOthers:r,propertyValue:(0,n().H)(i,{display:"flex"})}}function g(e){const{numOthers:t=0,operator:o,propertyName:r,propertyValue:n}=e;let i;return i=!n||Array.isArray(n)&&0===n.filter((e=>!!e)).length?a.actionPropertyClear:"append"===o?t>0?a.actionPropertyAddWithOthers:a.actionPropertyAdd:"remove"===o?t>0?a.actionPropertyRemoveWithOthers:a.actionPropertyRemove:"toggle"===o?t>0?a.actionPropertyToggleWithOthers:a.actionPropertyToggle:t>0?a.actionPropertyReplaceWithOthers:a.actionPropertyReplaceWith,{...i,values:{propertyName:r,propertyValue:n,numOthers:t}}}function y(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionRelationPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function h(e){const{propertyName:t,propertyValue:o}=e;return{...a.triggerRelationPropertyContainsSingle,values:{propertyName:t,propertyValue:o}}}function f(e){const{propertyName:t,propertyValue:o}=e;return{...a.triggerRelationPropertyContainsMultiple,values:{propertyName:t,propertyValue:o}}}function v(e){const{propertyName:t,propertyValue:o}=e;return{...a.triggerRelationPropertyDoesNotContainSingle,values:{propertyName:t,propertyValue:o}}}function x(e){const{propertyName:t,propertyValue:o}=e;return{...a.triggerRelationPropertyDoesNotContainMultiple,values:{propertyName:t,propertyValue:o}}}function S(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionSelectPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function b(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionStatusPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function C(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionTextPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function k(e){return e.formatMessage(a.actionDeletedProperty)}function T(e){return e.formatMessage(a.triggerAnyPageAdded)}function M(e){return e.formatMessage(a.triggerAnyPagePropertyEdit)}function _(e){return e.formatMessage(a.triggerDeletedPropertyEdit)}function j(e,t){const{propertyName:o}=t;return e.formatMessage(a.triggerAnyPropertyEdit,{propertyName:o})}function P(e,t){return e.formatMessage(a.triggerCheckboxPropertySet,t)}function V(e,t){const{propertyName:o}=t;return e.formatMessage(a.triggerAnyPropertyClear,{propertyName:o})}function w(e){const{propertyName:t,propertyValues:o,operator:r}=e;return{...a.triggerNumberPropertySet,values:{propertyName:t,propertyValues:o,operator:r}}}function A(e){const{propertyName:t,propertyValues:o,operator:r}=e;return{...a.triggerTextPropertySet,values:{propertyName:t,propertyValues:o,operator:r}}}function I(e,t){return e.formatMessage(a.triggerSelectPropertyIs,t)}function R(e,t){return e.formatMessage(a.triggerSelectPropertyIsNot,t)}function F(e,t){return e.formatMessage(a.triggerMultiSelectPropertyContains,t)}function N(e,t){return e.formatMessage(a.triggerMultiSelectPropertyDoesNotContain,t)}function B(e,t){return e.formatMessage(a.triggerStatusPropertySet,t)}function Z(e){return e.formatMessage(a.deletedPropertyOption)}function E(e){const{propertyName:t,propertyValues:o}=e;return{...a.triggerPersonPropertyContainsSingle,values:{propertyName:t,propertyValue:o}}}function K(e){const{propertyName:t,propertyValues:o}=e;return{...a.triggerPersonPropertyContainsMultiple,values:{propertyName:t,propertyValues:o}}}function O(e){const{propertyName:t,propertyValues:o}=e;return{...a.triggerPersonPropertyDoesNotContainSingle,values:{propertyName:t,propertyValue:o}}}function L(e){const{propertyName:t,propertyValues:o}=e;return{...a.triggerPersonPropertyDoesNotContainMultiple,values:{propertyName:t,propertyValues:o}}}function D(e){const{limit:t,optionValues:o,propertySchema:n}=e,a=n.options??[],i=a.length>0,l=o.map((e=>{const t=i?(0,r().i7)(a,e):void 0;return t?{type:"option",value:t}:{type:"deleted",value:e}}));let s=l;if(void 0!==t&&l.length>t){const e=l.length-t;s=[...l.slice(0,t),{type:"truncation",value:`+${e}`}]}return s}},150275:(e,t,o)=>{o.d(t,{n:()=>l});o(267602),o(653476),o(241792);var r=()=>o(227666),n=()=>o(696459),a=()=>o(876822),i=()=>o(815277);function l(e){var t,o;const{triggerType:l,environment:s,automationStore:u}=e;if(null==u||!u.isDefined())return!0;const c=(0,r().o)(l),p=a().default.state,d=(0,i().DE)(s,{name:"premium_automations",spaceId:null===(t=p.currentSpaceStore)||void 0===t?void 0:t.id,userId:null===(o=p.currentUserStore)||void 0===o?void 0:o.id});return c.isAvailableForContext({automation:u.getModel(),automationActions:u.getActionStores().map((e=>e.getModel())).filter(n().$K),hasPremiumAutomations:d})}},278129:(e,t,o)=>{o.d(t,{Fl:()=>n,eY:()=>i});const r=["number_does_not_equal","number_equals","number_greater_than","number_greater_than_or_equal_to","number_less_than","number_less_than_or_equal_to","is_empty","changes_to_any"];function n(e){const t=e;return r.includes(t)?t:"number_equals"}const a=(0,o(788860).vU)({changesToAny:{id:"automations.propertyTrigger.numberField.changesToAnyOption",defaultMessage:"Is edited"},numberEquals:{id:"automations.propertyTrigger.numberField.equalsOption",defaultMessage:"="},numberGreaterThanOrEqualTo:{id:"automations.propertyTrigger.numberField.greaterThanOrEqualTo",defaultMessage:"≥"},numberLessThanOrEqualTo:{id:"automations.propertyTrigger.numberField.lessThanOrEqualTo",defaultMessage:"≤"},isEmpty:{id:"automations.propertyTrigger.numberField.isEmpty",defaultMessage:"Is cleared"},numberGreaterThan:{id:"automations.propertyTrigger.numberField.greaterThan",defaultMessage:">"},numberLessThan:{id:"automations.propertyTrigger.numberField.lessThan",defaultMessage:"<"},numberDoesNotEqual:{id:"automations.propertyTrigger.numberField.doesNotEqualOption",defaultMessage:"≠"}}),i={number_equals:{hasInput:!0,text:a.numberEquals,value:"number_equals"},number_does_not_equal:{hasInput:!0,text:a.numberDoesNotEqual,value:"number_does_not_equal"},number_greater_than:{hasInput:!0,text:a.numberGreaterThan,value:"number_greater_than"},number_less_than:{hasInput:!0,text:a.numberLessThan,value:"number_less_than"},number_greater_than_or_equal_to:{hasInput:!0,text:a.numberGreaterThanOrEqualTo,value:"number_greater_than_or_equal_to"},number_less_than_or_equal_to:{hasInput:!0,text:a.numberLessThanOrEqualTo,value:"number_less_than_or_equal_to"},changes_to_any:{hasInput:!1,text:a.changesToAny,value:"changes_to_any"},is_empty:{text:a.isEmpty,value:"is_empty",hasInput:!1}}},149869:(e,t,o)=>{o.d(t,{vy:()=>n,xQ:()=>i});const r=["string_is","string_is_not","string_contains","string_does_not_contain","string_starts_with","string_ends_with","is_empty","changes_to_any"];function n(e){const t=e;return r.includes(t)?t:"string_is"}const a=(0,o(788860).vU)({changesToAny:{id:"automations.propertyTrigger.textField.changesToAnyOption",defaultMessage:"Is edited"},isEmpty:{id:"automations.propertyTrigger.textField.isEmpty",defaultMessage:"Is cleared"},stringIs:{id:"automations.propertyTrigger.textField.stringIsOption",defaultMessage:"Is set to"},stringIsNot:{id:"automations.propertyTrigger.textField.stringIsNotOption",defaultMessage:"Is not set to"},stringContains:{id:"automations.propertyTrigger.textField.stringContainsOption",defaultMessage:"Contains"},stringDoesNotContain:{id:"automations.propertyTrigger.textField.stringDoesNotContain",defaultMessage:"Does not contain"},stringStartsWith:{id:"automations.propertyTrigger.textField.stringStartsWithOption",defaultMessage:"Starts with"},stringEndsWith:{id:"automations.propertyTrigger.textField.stringEndsWithOption",defaultMessage:"Ends with"}}),i={string_is:{hasInput:!0,text:a.stringIs,value:"string_is"},string_is_not:{hasInput:!0,text:a.stringIsNot,value:"string_is_not"},string_contains:{hasInput:!0,text:a.stringContains,value:"string_contains"},string_does_not_contain:{hasInput:!0,text:a.stringDoesNotContain,value:"string_does_not_contain"},string_starts_with:{hasInput:!0,text:a.stringStartsWith,value:"string_starts_with"},string_ends_with:{hasInput:!0,text:a.stringEndsWith,value:"string_ends_with"},changes_to_any:{hasInput:!1,text:a.changesToAny,value:"changes_to_any"},is_empty:{text:a.isEmpty,value:"is_empty",hasInput:!1}}},605252:(e,t,o)=>{o.d(t,{Tt:()=>u,Uo:()=>s,f9:()=>i,vf:()=>l});o(667294);var r=()=>o(788860),n=()=>o(361726),a=o(785893);const i={checkbox_is_not:"checkbox",checkbox_is:"checkbox",enum_contains:"multi_select",enum_does_not_contain:"multi_select",enum_is_not:"select",enum_is:"select",number_does_not_equal:"number",number_equals:"number",number_greater_than_or_equal_to:"number",number_greater_than:"number",number_less_than_or_equal_to:"number",number_less_than:"number",person_contains:"person",person_does_not_contain:"person",relation_contains:"relation",relation_does_not_contain:"relation",status_is_not:"status",status_is:"status",string_contains:"text",string_does_not_contain:"text",string_ends_with:"text",string_is_not:"text",string_is:"text",string_starts_with:"text"},l={phone_number:"text",title:"text",url:"text",email:"text"},s={relation:["relation"],checkbox:["checkbox"],number:["number"],person:["person"],multi_select:["multi_select"],select:["select"],status:["status"],text:["email","phone_number","text","url"]};function u(e){return(0,a.jsx)(r()._H,{...n().I4({propertyName:e.name})})}},339352:(e,t,o)=>{o.d(t,{w:()=>u});var r=()=>o(142735),n=()=>o(396136),a=()=>o(696459),i=()=>o(125659),l=()=>o(239482),s=()=>o(826955);function u(e,t){const o=(0,i().DK)();return(0,r().VK)((()=>{const r=e.getParentStore();if("button_block"===t){const t=function(e){const t=(0,l().eG)(e);for(const o of t)if(o.table===n().iU&&o.isPageBlock())return o;return}(e);return null==t?void 0:t.getAssociatedCollectionStore()}if("button_property"===t)return null==o?void 0:o.collectionStore();if("event"===t){if(r&&r instanceof s().NW)return r}else{if("recurrence"===t)return;if("assistant"===t){if(r&&r instanceof s().NW)return r}else(0,a().t1)(t)}}),[e,t,o])}},195245:(e,t,o)=>{o.d(t,{P:()=>s,i:()=>l});o(821057);var r=o(667294),n=()=>o(142735),a=()=>o(637118),i=()=>o(486896);function l(){return(0,r.useContext)(i().Z)}function s(){const{automationStore:e}=(0,a().YC)(),{collectionStore:t,...o}=l(),r=(0,n().VK)((()=>{if(!(null!=e&&e.isTriggerType("event")||null!=e&&e.isTriggerType("notification_event")||null!=e&&e.isTriggerType("recurrence")))throw new Error("automationStore is wrong type. Is this called in the wrong type of automation?");return e}),[e]);if(!t)throw new Error("collectionStore is undefined. Is this rendered inside an AutomationEditorContext.Provider?");return{...o,collectionStore:t,automationStore:r}}},903098:(e,t,o)=>{o.d(t,{z:()=>l});var r=o(667294),n=()=>o(752348),a=()=>o(696459),i=()=>o(637118);function l(e){const{actionId:t}=e??{},o=(0,i().DZ)();return(0,r.useMemo)((()=>{if(!o.defined)return[];return(0,a().$K)(t)?(0,n().getContextValuesForAction)(o.typecheckResult,t):(0,n().getAllContextValues)(o.typecheckResult)}),[o.defined,o.typecheckResult,t])}},809638:(e,t,o)=>{o.d(t,{i:()=>S});o(670560),o(267602),o(653476),o(470928),o(241792),o(228244);var r=o(667294),n=()=>o(219727),a=()=>o(157955),i=()=>o(226413),l=()=>o(956057),s=()=>o(788860),u=()=>o(696459),c=()=>o(285755),p=()=>o(636340),d=()=>o(269299),m=()=>o(141735),g=()=>o(594546),y=()=>o(867601),h=()=>o(677559),f=()=>o(49396),v=()=>o(195245);const x="all";function S(){const{automationStore:e,collectionStore:t,maybePersistedTransactionActions:o}=(0,v().P)(),{value:S}=(0,h().XJ)(c().Sm.automationTypecheck),{value:C}=(0,h().XJ)(m().F.formulas),k=(0,n().O7)(),T=(0,s().YB)(),M=(0,r.useMemo)((()=>({automation_id:e.id,collection_id:t.id,builder_type:"modal"})),[e.id,t.id]),_=(0,r.useCallback)((()=>{var t;if(e.isTriggerType("recurrence"))return{currentPropertyTriggers:[],triggerOperator:x};const o=null===(t=e.getTrigger())||void 0===t?void 0:t.event.pagePropertiesEdited,r="some"===(null==o?void 0:o.type)&&o.some,n="all"===(null==o?void 0:o.type)&&o.all,a=(null==o?void 0:o.type)||"some";return r||n?{currentPropertyTriggers:r||n||[],triggerOperator:a}:{currentPropertyTriggers:[],triggerOperator:a}}),[e]),j=(0,r.useCallback)((function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x,n=r||x;("none"===r||"any"===r&&t.length>0)&&(n=x),o.createAndCommit({userAction:"automations.removePropertyTrigger",perform:o=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagePropertiesEdited:0===t.length?{type:"none"}:{type:n,[n]:t}}},transaction:o})}})}),[e,o]),P=(0,r.useCallback)((t=>{const{currentPropertyTriggers:r}=_();o.createAndCommit({userAction:"automations.updatePropertyTriggerOperator",perform:o=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagePropertiesEdited:{type:t,[t]:r}}},transaction:o})}})}),[e,_,o]);return{addPropertyTrigger:(0,r.useCallback)((e=>{const{currentPropertyTriggers:o,triggerOperator:r}=_();j([...o,e],r);const n=t.getSchema()[e.property];(0,g().j)({environment:k,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"property",condition:r,property_types:null!=n&&n.type?[n.type]:[],property_configs:(0,u().$K)(e.filter.operator)&&(0,u().$K)(null==n?void 0:n.type)?[{operator:e.filter.operator,type:null==n?void 0:n.type}]:[]},...M}}})}),[M,t,k,_,j]),updatePropertyTrigger:(0,r.useCallback)((e=>{const{anyOptionCheckState:o,propertyId:r,currentFilter:n,propertySchema:a}=e,{currentPropertyTriggers:l,triggerOperator:s}=_();j((()=>{switch(o){case"partial":return b(l,(e=>e.property===r),(e=>({...e,filter:n})),{property:r,filter:n});case!0:return b(l,(e=>e.property===r),(e=>({...e,filter:{operator:"changes_to_any"}})),{property:r,filter:{operator:"changes_to_any"}});case!1:return(0,i().Pr)(a)?b(l,(e=>e.property===r),(e=>({...e,filter:n})),{property:r,filter:n}):l.filter((e=>e.property!==r))}})(),s);const c=t.getSchema()[r];(0,g().j)({environment:k,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"property",condition:s,property_types:null!=c&&c.type?[c.type]:[],property_configs:(0,u().$K)(n.operator)&&(0,u().$K)(null==c?void 0:c.type)?[{operator:n.operator,type:null==c?void 0:c.type}]:[]},...M}}})}),[M,t,k,_,j]),removePropertyTrigger:(0,r.useCallback)((e=>{const{currentPropertyTriggers:o,triggerOperator:r}=_();j(o.filter((t=>t.property!==e)),r);const n=t.getSchema()[e],a=o.find((t=>t.property===e));(0,g().j)({environment:k,event:{eventName:"automation_trigger_delete",eventProperties:{automation_trigger:{type:"property",condition:r,property_types:null!=n&&n.type?[n.type]:[],property_configs:(0,u().$K)(a)&&(0,u().$K)(a.filter.operator)&&(0,u().$K)(null==n?void 0:n.type)?[{operator:a.filter.operator,type:null==n?void 0:n.type}]:[]},...M}}})}),[M,t,k,_,j]),addPageAddedTrigger:(0,r.useCallback)((()=>{o.createAndCommit({userAction:"automations.addPageAddedTrigger",perform:t=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagesAdded:!0}},transaction:t})}}),(0,g().j)({environment:k,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"page"},...M}}})}),[M,e,k,o]),removePageAddedTrigger:(0,r.useCallback)((()=>{o.createAndCommit({userAction:"automations.removePageAddedTrigger",perform:t=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagesAdded:!1}},transaction:t})}}),(0,g().j)({environment:k,event:{eventName:"automation_trigger_delete",eventProperties:{automation_trigger:{type:"page"},...M}}})}),[M,e,k,o]),addAnyPropertyEditedTrigger:(0,r.useCallback)((()=>{o.createAndCommit({userAction:"automations.addAnyPagePropertyEditedTrigger",perform:t=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagePropertiesEdited:{type:"any"}}},transaction:t})}}),(0,g().j)({environment:k,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"property",condition:"any"},...M}}})}),[M,e,k,o]),removeAnyPropertyEditedTrigger:(0,r.useCallback)((()=>{o.createAndCommit({userAction:"automations.removeAnyPropertyEditedTrigger",perform:t=>{d().applyOperation({store:e,operation:{path:["trigger","event"],args:{pagePropertiesEdited:{type:"none"}},pointer:e.pointer,command:"update"},transaction:t})}}),(0,g().j)({environment:k,event:{eventName:"automation_trigger_delete",eventProperties:{automation_trigger:{type:"property",condition:"any"},...M}}})}),[M,e,k,o]),updateTriggerOperator:P,addEmptyRecurrenceTrigger:(0,r.useCallback)((()=>{o.createAndCommit({userAction:"automations.addEmptyRecurrenceTrigger",perform:t=>{p().sO({transaction:t,store:e.getKeyStore("trigger"),value:{type:"recurrence",id:l().Il()}}),S&&C&&(0,f().clearInvalidVariables)({automationStore:e,automationTypecheckModule:S,contextType:"recurrence",formulasModule:C,intl:T,transaction:t}),(0,g().j)({environment:k,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"recurrence"},...M}}})}})}),[e,S,C,T,o,M,k]),changeRecurrenceSchedule:(0,r.useCallback)((t=>{o.createAndCommit({userAction:"automations.changeRecurrenceSchedule",perform:o=>{p().sW({store:e.getKeyStore("trigger"),data:{recurrence:t?(0,a().convertFromUnpersistedRecurrenceConfig)(t):void 0},transaction:o})}})}),[e,o]),removeRecurrenceTrigger:(0,r.useCallback)((()=>{o.createAndCommit({userAction:"automations.removeRecurrenceTrigger",perform:o=>{p().sO({transaction:o,store:e.getKeyStore("trigger"),value:{type:"event",id:l().Il(),event:(0,y().pw)(t)}})}}),(0,g().j)({environment:k,event:{eventName:"automation_trigger_delete",eventProperties:{automation_trigger:{type:"recurrence"},...M}}})}),[M,e,t,k,o])}}function b(e,t,o,r){let n=!1;const a=e.map((e=>t(e)?(n=!0,o(e)):e));return n||a.push(r),a}},194930:(e,t,o)=>{o.d(t,{Kk:()=>m,MT:()=>g});o(667294);var r=()=>o(142735),n=()=>o(846550),a=()=>o(38883),i=()=>o(788860),l=()=>o(696459),s=()=>o(707513),u=()=>o(78014),c=()=>o(361726),p=()=>o(278129),d=o(785893);function m(e){const{numberValue:t,operator:o,propertySchema:m,messageType:y}=e,h=(0,i().YB)(),f=(0,n().yK)((()=>({content:{alignItems:"center",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...s().Yu,fontWeight:s().Ue.medium},propertyValue:{...s().Yu,paddingBlockStart:4}})),[]),v=(0,r().VK)((()=>function(e){const{numberValue:t,operator:o,propertySchema:r,styles:n,messageType:s,intl:m}=e,g=(0,d.jsx)("span",{style:n.propertyName,children:r.name});let y;const h=m.formatMessage(p().eY[o].text).toLocaleLowerCase();"action"===s?y=c().D6({propertyName:g,propertyValues:(0,d.jsx)(u().Z,{format:a().lo.Medium,isRound:!0,isSingle:!0,value:t,showRemoveButton:!1,style:{flex:"none"}}),operator:h}):"trigger"===s?y=c().s_({propertyName:g,propertyValues:(0,d.jsx)(u().Z,{format:a().lo.Medium,isRound:!0,isSingle:!0,value:t,showRemoveButton:!1,style:{flex:"none"}}),operator:h}):(0,l().t1)(s);return(0,d.jsx)(i()._H,{...y})}({intl:h,messageType:y,numberValue:t,operator:o,propertySchema:m,styles:f})),[y,t,o,m,f,h]);return{tooltipTitle:(0,r().VK)((()=>g({intl:h,messageType:y,numberValue:t,operator:o,propertySchema:m})),[h,y,t,o,m]),title:v,styles:f}}function g(e){const{numberValue:t,operator:o,propertySchema:r,messageType:n,intl:a}=e,s=r.name;let u;const m=a.formatMessage(p().eY[o].text).toLocaleLowerCase();return"action"===n?u=c().D6({propertyName:s,propertyValues:t,operator:m}):"trigger"===n?u=c().s_({propertyName:s,propertyValues:t,operator:m}):(0,l().t1)(n),(0,d.jsx)(i()._H,{...u})}},116291:(e,t,o)=>{o.d(t,{Nv:()=>b,TY:()=>v,y3:()=>S});o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(653476),o(241792),o(667294);var r=()=>o(142735),n=()=>o(846550),a=()=>o(816512),i=()=>o(532850),l=()=>o(38883),s=()=>o(92960),u=()=>o(955620),c=()=>o(788860),p=()=>o(696459),d=()=>o(707513),m=()=>o(864832),g=()=>o(772265),y=()=>o(415764),h=()=>o(361726),f=o(785893);function v(e){const{messageType:t}=e,o=(0,c().YB)(),a=(0,n().yK)((()=>({content:{display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...d().Yu,fontWeight:d().Ue.medium},propertyValue:{...d().Yu},propertyValueList:{display:"flex",flexBasis:"100%",listStyle:"none",margin:0,padding:0,width:"100%",columnGap:4,rowGap:4},inlineActorTokenContainer:{...d().Yu,paddingBlockStart:1},inlineActorToken:{margin:0,paddingRight:0}})),[]),i=(0,r().VK)((()=>"action"===t?function(e){const{getRecordModel:t,contextValues:o,intl:r,operator:n,propertySchema:a,styles:i,value:l}=e;let s;const u=(0,f.jsx)("span",{style:i.propertyName,children:a.name});if("formula"===(null==l?void 0:l.type))s=n?h().Lu({operator:n,propertyName:u,propertyValue:(0,f.jsx)(y().b,{returnType:{type:"person"}})}):h().wE({propertyName:u,propertyValue:(0,f.jsx)(y().b,{returnType:{type:"person"}})});else{const e=x({getRecordModel:t,propertySchema:a,value:l}),c=k(l,o),p=C({actors:e,values:c,showAsList:!1,styles:i}),d=e.length+c.length;s=n?h().Lu({...h().DM({elements:Array.isArray(p)?p:[p],intl:r}),operator:n,propertyName:u}):0===d?h().Gx({propertyName:u}):h().wE({propertyName:u,propertyValue:p})}return(0,f.jsx)(c()._H,{...s})}({getRecordModel:e.getRecordModel,contextValues:e.contextValues,intl:o,propertySchema:e.propertySchema,styles:a,value:e.value,operator:e.operator}):"trigger"===t?function(e){const{actorModels:t,propertySchema:o,styles:r,operator:n}=e;if(!t)return null;const a=(0,f.jsx)("span",{style:r.propertyName,children:o.name}),i=C({actors:t,values:[],styles:r,showAsList:!0});let l;if(1===t.length){l=("person_contains"===n?h().Y6:h().tl)({propertyName:a,propertyValues:i})}else{l=("person_contains"===n?h().mP:h().yH)({propertyName:a,propertyValues:i})}return(0,f.jsx)(c()._H,{...l})}({actorModels:e.actorModels,propertySchema:e.propertySchema,operator:e.operator,styles:a}):void(0,p().t1)(t)),[t,e,o,a]);return{tooltipTitle:(0,r().VK)((()=>"action"===t?S({getRecordModel:e.getRecordModel,contextValues:e.contextValues,intl:o,propertySchema:e.propertySchema,styles:a,value:e.value}):"trigger"===t?b({actorModels:e.actorModels,intl:o,operator:e.operator,propertySchema:e.propertySchema,styles:a}):void(0,p().t1)(t)),[t,e,o,a]),title:i,styles:a}}function x(e){const{getRecordModel:t,propertySchema:o,value:r}=e;return(0,i().DW)({blockCreatorPointer:void 0,propertySchema:o,textValue:null==r?void 0:r.value}).map((e=>(0,a().Hl)({getRecordModel:t,pointer:e}))).filter(p().$K)}function S(e){const{getRecordModel:t,contextValues:o,intl:r,operator:n,propertySchema:i,styles:l,value:s}=e;let u;const p=(0,f.jsx)("span",{style:null==l?void 0:l.propertyName,children:i.name});if("formula"===(null==s?void 0:s.type))u=n?h().Lu({operator:n,propertyName:p,propertyValue:(0,f.jsx)(y().K,{})}):h().wE({propertyName:p,propertyValue:(0,f.jsx)(y().K,{})});else{const e=x({getRecordModel:t,propertySchema:i,value:s}),l=e.map((e=>(0,a().$4)(r,e))),c=k(s,o),d=c.map((e=>e.tooltipName??e.name)),m=r.formatList([...l,...d],{style:"long",type:"conjunction"}),g=e.length+c.length;u=n?h().Lu({propertyName:p,propertyValue:m,operator:n}):0===g?h().Gx({propertyName:p}):h().wE({propertyName:p,propertyValue:m})}return(0,f.jsx)(c()._H,{...u})}function b(e){const{actorModels:t,intl:o,propertySchema:r,styles:n,operator:i}=e;if(!t)return null;const l=(0,f.jsx)("span",{style:null==n?void 0:n.propertyName,children:r.name}),s=t.map((e=>(0,a().$4)(o,e))),u=o.formatList(s,{style:"long",type:"conjunction"});let p;if(1===t.length){p=("person_contains"===i?h().Y6:h().tl)({propertyName:l,propertyValues:u})}else{p=("person_contains"===i?h().mP:h().yH)({propertyName:l,propertyValues:u})}return(0,f.jsx)(c()._H,{...p})}function C(e){const{actors:t,styles:o,showAsList:r=!0,values:n}=e,a=[...t.map(((e,t)=>(0,f.jsx)(m().ZP,{style:o.inlineActorToken,actor:e,showRemoveButton:!1,format:l().lo.Medium,isSingle:!1},t))),...n.map(((e,t)=>(0,f.jsx)(g().F,{style:o.inlineFormulaValue,format:l().lo.Medium,isSingle:!1,value:e},t)))];return 1===a.length?(0,f.jsx)("div",{style:o.propertyValue,children:a[0]}):r?(0,f.jsx)("ul",{style:o.propertyValueList,children:a.map(((e,t)=>(0,f.jsx)("li",{children:(0,f.jsx)("div",{style:o.propertyValue,children:e},t)},t)))}):a.map(((e,t)=>(0,f.jsx)("div",{style:o.inlineActorTokenContainer,children:e},t)))}function k(e,t){const o=new Set(u().oOk(null==e?void 0:e.value).map((e=>e.id))),r=s().FormulaContextValueKind.ContextValue;return t.filter((e=>e.kind===r)).filter((e=>o.has(e.id)))}},317632:(e,t,o)=>{o.d(t,{F2:()=>V,OI:()=>j,RX:()=>I,lr:()=>M,vt:()=>A,wr:()=>_});o(267602),o(653476),o(241792),o(228244),o(667294);var r=()=>o(219727),n=()=>o(142735),a=()=>o(846550),i=()=>o(455947),l=()=>o(532850),s=()=>o(38883),u=()=>o(177634),c=()=>o(907874),p=()=>o(396136),d=()=>o(955620),m=()=>o(788860),g=()=>o(696459),y=()=>o(707513),h=()=>o(772265),f=()=>o(328094),v=()=>o(549813),x=()=>o(749826),S=()=>o(826955),b=()=>o(415764),C=()=>o(253783),k=()=>o(361726),T=o(785893);function M(e){const{automationContextValues:t,messageType:o,propertySchema:i,value:l}=e,s=(0,m().YB)(),u=(0,r().O7)(),c=(0,n().VK)((()=>l?V({automationContextValues:t,limit:i.limit,value:l}):[]),[t,i.limit,l]),p=(0,a().yK)((()=>({content:{alignItems:"center",display:"flex",flex:"1 1 auto",flexWrap:"wrap",minWidth:0,whiteSpace:"pre",lineHeight:1.6},operatorContent:{alignItems:"center",flexWrap:"wrap",gridGap:"1px"},propertyName:{...y().Yu,fontWeight:y().Ue.semibold,minWidth:20},propertyValue:{...y().Yu,minWidth:40},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:10,width:"100%"},propertyValueListItem:{display:"flex"},and:{marginRight:"4px",marginLeft:"4px"}})),[]),d=(0,n().VK)((()=>{if("action"===o)return function(e){const{intl:t,collectionStore:o,operator:r,propertySchema:n,relationPages:a,styles:i,value:l}=e,s=(0,T.jsx)("span",{style:i.propertyName,children:n.name});let u;const c="formula"===(null==l?void 0:l.type);u=c?(0,T.jsx)("div",{style:i.content,children:(0,T.jsx)(m()._H,{...k().S0({propertyName:s,propertyValue:(0,T.jsx)("span",{style:i.propertyValue,children:(0,T.jsx)(b().b,{returnType:{type:"block"}})})})})}):"replace"===r||"append"===r||"remove"===r||"toggle"===r?(0,T.jsx)("div",{style:{...i.content,...i.operatorContent},children:(0,T.jsx)(m()._H,{...k().Lu({...k().DM({elements:a.map(((e,t)=>(0,T.jsx)(P,{propertySchema:n,collectionStore:o,value:e},t))),intl:t}),operator:r,propertyName:s})})}):0===a.length?(0,T.jsx)("div",{style:i.content,children:(0,T.jsx)(m()._H,{...k().Gx({propertyName:s})})}):(0,T.jsx)("div",{style:i.content,children:(0,T.jsx)(m()._H,{...k().S0({propertyName:s,propertyValue:(0,T.jsx)("span",{style:i.propertyValue,children:(0,T.jsx)(P,{collectionStore:o,value:a[0],propertySchema:n})})})})});return u}({collectionStore:e.collectionStore,intl:s,operator:e.operator,propertySchema:e.propertySchema,relationPages:c,styles:p,value:e.value});if("trigger"===o){const{collectionStore:t,filter:o,propertySchema:r}=e;return function(e){const{availableTokens:t,collectionStore:o,operator:r,propertySchema:n,relationPages:a,styles:i}=e,l=(0,T.jsx)("span",{style:i.propertyName,children:n.name});let s;if(1===a.length){const e="relation_contains"===r?k().MB:k().P;s=(0,T.jsx)("div",{style:i.content,children:(0,T.jsx)(m()._H,{...e({propertyName:l,propertyValue:(0,T.jsx)("span",{style:i.propertyValue,children:(0,T.jsx)(P,{availableTokens:t,collectionStore:o,propertySchema:n,value:a[0]})})})})})}else{const e="relation_contains"===r?k().P5:k().Wd;s=(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("div",{style:i.content,children:(0,T.jsx)(m()._H,{...e({propertyName:l,propertyValue:[]})})}),(0,T.jsx)("ul",{style:i.propertyValueList,children:a.map(((e,r)=>(0,T.jsx)("li",{style:i.propertyValueListItem,children:(0,T.jsx)(P,{availableTokens:t,collectionStore:o,propertySchema:n,value:e})},r)))})]})}return s}({availableTokens:o?A({collectionStore:t,filter:o,propertySchema:r}):void 0,collectionStore:e.collectionStore,operator:e.operator,propertySchema:e.propertySchema,relationPages:c,styles:p})}(0,g().t1)(o)}),[e,s,o,c,p]);return{tooltipTitle:(0,n().VK)((()=>{if("action"===o)return _({collectionStore:e.collectionStore,environment:u,intl:s,operator:e.operator,propertySchema:i,relationPages:c,value:e.value});if("trigger"===o){const{collectionStore:t,filter:o,propertySchema:r}=e;return j({availableTokens:o?A({collectionStore:t,filter:o,propertySchema:r}):void 0,collectionStore:e.collectionStore,environment:u,intl:s,operator:e.operator,propertySchema:e.propertySchema,relationPages:c})}(0,g().t1)(o)}),[e,u,s,o,i,c]),title:d,styles:p}}function _(e){const{collectionStore:t,environment:o,intl:r,operator:n,propertySchema:a,relationPages:i,value:l}=e,s=a.name;if("formula"===(null==l?void 0:l.type))return(0,T.jsx)(m()._H,{...k().S0({propertyName:s,propertyValue:(0,T.jsx)(b().K,{})})});const c=i.map((e=>{if("string"==typeof e){const n=S().G.createChildStore(t,{id:e,table:p().iU});return(0,v().vU)({environment:o,intl:r,store:n})}return(0,u().NP)(e)})).filter(g().$K),d=1===c.length?c[0]:r.formatList(c,{style:"long",type:"conjunction"});let y;return y="replace"===n||"append"===n||"remove"===n||"toggle"===n?k().Lu({propertyName:s,propertyValue:d,operator:n}):0===c.length?k().Gx({propertyName:s}):k().S0({propertyName:s,propertyValue:d}),(0,T.jsx)(m()._H,{...y})}function j(e){const{availableTokens:t,collectionStore:o,environment:r,intl:n,operator:a,propertySchema:i,relationPages:l}=e,s=l.map((e=>{if("string"==typeof e){if(!t||t.some((t=>t.id===e))){const t=S().G.createChildStore(o,{id:e,table:p().iU});return(0,v().vU)({environment:r,intl:n,store:t})}return k().ST(n)}return(0,u().NP)(e)})).filter(g().$K),c=i.name,d=1===s.length?s[0]:n.formatList(s,{style:"long",type:"conjunction"});let y;if(1===s.length){y=("relation_contains"===a?k().MB:k().P)({propertyName:c,propertyValue:d})}else{y=("relation_contains"===a?k().P5:k().Wd)({propertyName:c,propertyValue:d})}return(0,T.jsx)(m()._H,{...y})}function P(e){const{availableTokens:t,collectionStore:o,propertySchema:r,value:n}=e;return!t||t.some((e=>e.id===n))?"string"==typeof n?(0,T.jsx)(f().Z,{blockId:n,format:s().lo.Medium,isSingle:!0,noUnderline:!0,parentStore:o,relationPropertySchema:r,shouldShrink:!0}):(0,T.jsx)(h().F,{format:s().lo.Medium,isSingle:!0,shouldShrink:!0,value:n}):(0,T.jsx)(C().Z,{tokenFormat:s().lo.Medium},`missing_option_value_${n}`)}function V(e){const{automationContextValues:t,limit:o,value:r}=e;if(!r)return[];return(0,c().fromSimpleFormulaArrayValue)(r.value).slice(0,o).map((e=>{if("string"!=typeof e&&"boolean"!=typeof e){if((0,d().wjk)(e)){const o=(0,d().vmO)(e).id,r=(0,u().vx)(t,o);if(!r)return;return r}if((0,d().STW)(e)){var o;const t=null===(o=(0,d().yrl)(e))||void 0===o?void 0:o.id;if(!t)return;return t}}})).filter(g().$K)}function w(e){const{collectionStore:t,filter:o}=e,r=(0,i().YO)(o),n=t.getSpaceId();return r.map((e=>{if(e.value&&"string"==typeof e.value)return{table:"block",id:e.value,spaceId:n}})).filter(g().$K)}function A(e){const{collectionStore:t,filter:o,propertySchema:r}=e,n=w({collectionStore:t,filter:o});return(0,l().j$)({getRecordModel:t.getRecordModel,propertySchema:r,relationValue:n,includeDeleted:x().default.checkGate({gateName:"relations_show_deleted"}),includeInvalidCollection:x().default.checkGate({gateName:"relations_show_invalid_collection"}),includeNoAccess:x().default.checkGate({gateName:"relations_show_no_access"})})}function I(e){const{collectionStore:t,filter:o}=e,r=w({collectionStore:t,filter:o});return{action:"replace",value:{type:"simple",value:(0,l().ow)(r)}}}},796675:(e,t,o)=>{o.d(t,{Sm:()=>g,ui:()=>m});o(667294);var r=()=>o(142735),n=()=>o(846550),a=()=>o(38883),i=()=>o(788860),l=()=>o(696459),s=()=>o(707513),u=()=>o(78014),c=()=>o(361726),p=()=>o(149869),d=o(785893);function m(e){const{textValue:t,operator:o,propertySchema:m,messageType:y}=e,h=(0,i().YB)(),f=(0,n().yK)((()=>({content:{alignItems:"center",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...s().Yu,fontWeight:s().Ue.medium},propertyValue:{...s().Yu,paddingBlockStart:4}})),[]),v=(0,r().VK)((()=>function(e){const{textValue:t,operator:o,propertySchema:r,styles:n,messageType:s,intl:m}=e,g=(0,d.jsx)("span",{style:n.propertyName,children:r.name});let y;const h=m.formatMessage(p().xQ[o].text).toLocaleLowerCase();"action"===s?y=c().It({operator:h,propertyName:g,propertyValues:(0,d.jsx)(u().Z,{format:a().lo.Medium,isRound:!0,isSingle:!0,value:t,showRemoveButton:!1})}):"trigger"===s?y=c().a5({operator:h,propertyName:g,propertyValues:(0,d.jsx)(u().Z,{format:a().lo.Medium,isRound:!0,isSingle:!0,value:t,showRemoveButton:!1})}):(0,l().t1)(s);return(0,d.jsx)(i()._H,{...y})}({messageType:y,operator:o,propertySchema:m,styles:f,textValue:t,intl:h})),[y,t,o,m,f,h]);return{tooltipTitle:(0,r().VK)((()=>g({messageType:y,operator:o,propertySchema:m,textValue:t,intl:h})),[y,o,m,t,h]),title:v,styles:f}}function g(e){const{textValue:t,operator:o,propertySchema:r,messageType:n,intl:a}=e,s=r.name;let u;const m=a.formatMessage(p().xQ[o].text).toLocaleLowerCase();return"action"===n?u=c().It({operator:m,propertyName:s,propertyValues:t}):"trigger"===n?u=c().a5({operator:m,propertyName:s,propertyValues:t}):(0,l().t1)(n),(0,d.jsx)(i()._H,{...u})}},687626:(e,t,o)=>{o.d(t,{Z:()=>p});var r=o(667294),n=()=>o(568017),a=()=>o(696459),i=o(785893);function l(e,t){switch(e){case"primary":return{background:n().ZP.frontBlueButtonBackground,boxShadow:t.buttonBoxShadow,color:"white"};case"secondary":return{background:n().ZP.frontSecondaryButtonBackground,boxShadow:`\n\t\t\t\t\t0 1px 2px rgba(15, 15, 15, 0.1),\n\t\t\t\t\tinset 0 0 0 1px ${n().ZP.redWithAlpha(.3)}`,color:n().ZP.red};case"tertiary":case"aiTertiary":return{background:n().ZP.white,color:n().ZP.frontTextDark,border:"1px solid rgba(15, 15, 15, 0.15)",width:"100%",boxShadow:"0 1px 2px rgba(15, 15, 15, 0.05)"};case"quaternary":return{background:n().ZP.frontQuaternaryButtonBackground,border:`1px solid ${n().ZP.frontQuaternaryButtonBorder}`,boxShadow:"0 1px 2px rgba(15, 15, 15, 0.1)",color:"white"};case"aiPrimary":return{background:"#CA59FF",color:"white"};case"lightGray":return{background:t.tint.regular,color:t.text.secondary};default:(0,a().t1)(e)}}function s(e,t){switch(e){case"primary":return{background:n().ZP.frontBlueButtonHoveredBackground};case"secondary":return{background:n().ZP.frontSecondaryButtonBackgroundHovered};case"tertiary":return{background:"light"===t.mode?t.buttonHoveredBackground:n().ZP.whiteWithAlpha(.8)};case"quaternary":return{background:n().ZP.frontQuaternaryButtonBackgroundHovered};case"aiPrimary":case"aiTertiary":return{background:"#C592DD"};case"lightGray":return{background:t.tint.regular,color:t.text.primary};default:(0,a().t1)(e)}}function u(e,t){switch(e){case"primary":return{background:n().ZP.frontBlueButtonPressedBackground};case"secondary":return{background:t.buttonPressedBackground};case"tertiary":return{background:"light"===t.mode?t.buttonPressedBackground:n().ZP.whiteWithAlpha(.85)};case"quaternary":return{background:n().ZP.frontQuaternaryButtonBackgroundPressed};case"aiPrimary":case"aiTertiary":return{background:"#946EA6"};case"lightGray":return{background:t.state.pressed,color:t.text.primary};default:(0,a().t1)(e)}}function c(e,t){const{id:r,children:n,disabledFeedback:a,isFullWidth:c,isLoading:p,onClick:d,style:m,variant:g,...y}=e,h=(0,o(846550).Fg)(),f={display:"inline-grid",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",height:36,borderRadius:4,fontSize:14,lineHeight:1,paddingLeft:12,paddingRight:12,fontWeight:o(707513).Ue.medium,...p&&{gridTemplateColumns:"1fr auto 1fr"},transition:"background-color color 150ms ease"};return(0,i.jsx)(o(154186).Z,{ref:t,id:r,onClick:d,style:{...f,...l(g,h),...m,...c&&{width:"100%",justifyContent:"center"}},hoveredStyle:s(g,h),pressedStyle:u(g,h),loadingSpinnerStyle:{marginLeft:"auto"},isLoading:p,disabledFeedback:a,...y,children:(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",textAlign:"center",justifyContent:"center"},children:n})})}const p=r.memo(r.forwardRef(c),o(632314).Z)},772265:(e,t,o)=>{o.d(t,{F:()=>p});o(667294);var r=()=>o(846550),n=()=>o(223506),a=()=>o(92960),i=()=>o(177634),l=()=>o(696459),s=()=>o(657581),u=()=>o(793041),c=o(785893);function p(e){const{value:t,style:o}=e,p=(0,r().Fg)(),d=e.iconStyle??{width:12,height:12,marginRight:4},m=(0,i().NP)(t);let g;if(t.kind===a().FormulaContextValueKind.ContextValue&&(0,l().$K)(t.stepNumberForDisplay)){const e=t.stepNumberForDisplay;g=()=>(0,c.jsx)(s().E,{size:n().$.ExtraSmall,number:e,style:{marginRight:4}})}else{const e=(0,i().RX)(t.type);if(e){const t=e;g=()=>t(d)}}return(0,c.jsx)(u().ZP,{...e,title:m,renderAvatar:g,shouldShrink:!0,style:{background:p.outlineBlueButtonPressedBackground,color:p.blueColor,padding:"2px 4px",margin:0,...o}})}},3425:(e,t,o)=>{o.d(t,{I:()=>f});var r=o(667294),n=()=>o(146947),a=()=>o(219727),i=()=>o(142735),l=()=>o(846550),s=()=>o(696459),u=()=>o(707513),c=()=>o(315605),p=()=>o(718611),d=()=>o(641702),m=()=>o(677559),g=()=>o(663132),y=()=>o(37623),h=o(785893);function f(e){const{formulaTypecheckContextValues:t,parentRecordStore:o,spaceId:f,value:v}=e,x=(0,l().yK)((()=>({overflowWrap:{whiteSpace:"inherit"},textWrap:{alignItems:"center",display:"flex",fontFamily:u().F5(n().locale).githubMono}})),[]),S=function(e){const{formulaTypecheckContextValues:t,parentRecordStore:o,spaceId:n,value:u}=e,f=(0,a().O7)(),v=(0,a().Fy)(),x=(0,i().VK)((()=>f.KatexStore.getKatex()),[f]),S=(0,p().kw)(),b=(0,l().Fg)(),{value:C}=(0,m().XJ)(c().o),[k,T]=(0,r.useMemo)((()=>[null==u?void 0:u.value,(null==u?void 0:u.type)??"simple"]),[u]);return(0,i().VK)((()=>{if(!k)return"";if("simple"===T)return(0,d().IY)({disabled:!0,disableDateStyleAnnotations:!1,disableHover:!1,disableInsertedDeletedAnnotations:!1,disableStyleAnnotations:!1,disableSuggestionAnnotations:!1,emojiType:S,environment:f,formulaValueTypes:t,katex:x,parentBlockId:void 0,parentStore:o,renderedPageBlockId:void 0,textValue:{value:k,spaceId:n},theme:b});if("formula"===T){if(C){const e=(0,y().r)({currentUserId:f.currentUser.id,errorRanges:[],getPublicBaseUrlForPage:g().aR(f),isAndroid:v.isAndroid,isMobileNative:v.isMobileNative,isSafariOrIOS:v.isSafari||v.isIOS,isWindows:v.isWindows,parentSpaceId:n,Prism:C,store:o,textValue:k,theme:b,valueTypes:t});return(0,h.jsx)("div",{dangerouslySetInnerHTML:{__html:e}})}return""}(0,s().t1)(T)}),[C,v.isAndroid,v.isIOS,v.isMobileNative,v.isSafari,v.isWindows,S,f,t,x,o,n,b,T,k])}({formulaTypecheckContextValues:t??[],parentRecordStore:o,spaceId:f,value:v});return(0,h.jsx)("div",{style:x.textWrap,children:(0,h.jsx)("div",{style:x.overflowWrap,children:S})})}},400836:(e,t,o)=>{o.d(t,{p:()=>d});var r=o(667294),n=()=>o(846550),a=()=>o(788860),i=()=>o(382047),l=()=>o(998901),s=()=>o(1910),u=()=>o(654133),c=o(785893);const p=(0,a().vU)({simpleFormulaFormulaActionButtonAriaLabel:{id:"formulas.simpleFormulaFormulaActionButton.ariaLabel",defaultMessage:"Formulas"},simpleFormulaFormulaActionButtonFormulaTooltip:{id:"formulas.simpleFormulaFormulaActionButton.formula.tooltip",defaultMessage:"Edit as formula"},simpleFormulaFormulaActionButtonSimpleFormulaTooltip:{id:"formulas.simpleFormulaFormulaActionButton.simpleFormula.tooltip",defaultMessage:"Edit as text"}});function d(e){const{disabled:t,onClick:o,value:d}=e,m="formula"===(null==d?void 0:d.type),g=(0,a().YB)(),y=(0,n().yK)((e=>({formulaIcon:{fill:m?e.icon.uiBluePrimary:e.mediumIconColor,height:16,width:16},button:{height:20,width:20}})),[m]),h=(0,r.useCallback)((()=>m?g.formatMessage(p.simpleFormulaFormulaActionButtonSimpleFormulaTooltip):g.formatMessage(p.simpleFormulaFormulaActionButtonFormulaTooltip)),[g,m]),f=(0,r.useCallback)((e=>(0,c.jsx)(s().Z,{...e,ariaLabel:g.formatMessage(p.simpleFormulaFormulaActionButtonAriaLabel),disabled:t,disabledFeedback:t,icon:i().D,iconStyle:y.formulaIcon,onClick:o,style:y.button})),[t,g,o,y]);return(0,c.jsx)(u().Z,{renderTooltip:h,placement:l().Placement.Bottom,render:f})}},585270:(e,t,o)=>{o.d(t,{w:()=>S});var r=o(667294),n=()=>o(492788),a=()=>o(219727),i=()=>o(142735),l=()=>o(846550),s=()=>o(513670),u=()=>o(696459),c=()=>o(627817),p=()=>o(990966),d=()=>o(466970),m=()=>o(127519),g=()=>o(212493),y=()=>o(448419),h=()=>o(788860),f=o(785893);const v=(0,h().vU)({simpleFormulaMentionActionButtonAriaLabel:{id:"formulas.simpleFormulaMentionActionButton.ariaLabel",defaultMessage:"Mentions"},simpleFormulaMentionActionButtonTooltip:{id:"formulas.simpleFormulaMentionActionButton.tooltip",defaultMessage:"Mention a person, page, or date"}});function x(e){const{disabled:t,onClick:n}=e,a=(0,h().YB)(),i=(0,l().yK)((e=>({formulaIcon:{fill:e.mediumIconColor,height:16,width:16},button:{height:20,width:20,borderRadius:4}})),[]),s=(0,r.useCallback)((()=>a.formatMessage(v.simpleFormulaMentionActionButtonTooltip)),[a]),u=(0,r.useCallback)((e=>(0,f.jsx)(o(1910).Z,{...e,ariaLabel:a.formatMessage(v.simpleFormulaMentionActionButtonAriaLabel),disabled:t,disabledFeedback:t,icon:o(318142).O,iconStyle:i.formulaIcon,onClick:n,style:i.button})),[t,a,n,i]);return(0,f.jsx)(o(654133).Z,{disableTooltip:t,renderTooltip:s,placement:o(998901).Placement.Bottom,render:u})}const S=r.forwardRef((function(e,t){const{allowedReturnTypes:h,disabled:v,disabledMentionTypes:S,disableEmojiCommands:b,disableFilters:C,disableFormulas:k,disableInsertedDeletedAnnotations:T,disableMentions:M,disableMobileActionBar:_,disableNewLines:j,disableStyleAnnotations:P,formulaInputButtonPopupStore:V,formulaTypecheckContextValues:w,onChange:A,onTextEnter:I,onTextStoreSelect:R,onTextStoreUnselect:F,onTextEsc:N,parentRecordStore:B,placeholder:Z,rows:E,shouldShowErrorStyles:K,spaceId:O,style:L,value:D}=e,H=Boolean(v),W=(0,a().O7)(),{isMobile:U}=(0,a().Fy)(),q=(0,r.useRef)(null),Y=(0,d().E)("automation_updated_error_states"),$=(0,i().qz)(V,o(529048).Z),[z,G,Q]=r.useMemo((()=>{var e;const t=(null==D?void 0:D.type)??"simple",r=null==D?void 0:D.value;return[t,r,(0,u().$K)(r)?(null===(e=o(955620).QaF(r).match(/\n/g))||void 0===e?void 0:e.length)??0:0]}),[null==D?void 0:D.type,null==D?void 0:D.value]),X="formula"===z,J=(0,r.useMemo)((()=>Q>0||void 0!==E&&E>1),[Q,E]),ee=r.useRef(!1),te=(0,r.useMemo)((()=>{if(A)return function(e){ee.current?ee.current=!1:A({type:z,value:e})}}),[A,z]),{automationStore:oe}=(0,o(637118).DZ)(),re=(0,r.useMemo)((()=>oe?{automation_id:[[oe.id]]}:void 0),[oe]),{setValue:ne,store:ae}=(0,o(57687).Cl)({initialValue:G,onChange:te,properties:re}),ie=(0,i().VK)((()=>ae.getValue()),[ae]);r.useEffect((()=>{(0,s().Xy)(G,ie)||(ee.current=!0,ne(G))}),[ie,ne,G]);const le=r.useRef(w);r.useEffect((()=>{(0,s().Xy)(w,le.current)||(le.current=w,(0,s().Xy)(G,ie)||(ee.current=!0),ne(G))}),[w,ie,ne,G]);const se=(0,i().VK)((()=>!1!==(0,o(550054).J5)(ae)),[ae]);r.useEffect((()=>{if(se)return null==R||R(),function(){null==F||F()}}),[se,R,F]);const ue=(0,r.useMemo)((()=>({...S,reminder:!0})),[S]),ce=(0,r.useMemo)((()=>j?I:function(){const e=m().default.state;"editing"===e.mode&&o(269299).createAndCommit({userAction:"SimpleFormulaValueTextInput.handleEnter",environment:W,canUndo:!0,perform:t=>{o(970105).hJ({disableEmojiCommands:!0,disableMentions:!0,disableSlashCommands:!0,editorMode:"default",environment:W,multiSelection:e.multiSelection,string:"\n",transaction:t})}}),null==I||I()}),[W,j,I]),pe=(0,r.useCallback)((()=>{const e=m().default.state;"editing"===e.mode&&(0,o(191003).qS)(e.multiSelection)&&e.multiSelection.start.store===ae||(p().setSelectionAtEnd({store:ae}),n().default.afterNextFlush((()=>{const e=null==q?void 0:q.current,t=null==e?void 0:e.getNode();t&&t.scrollTo({top:t.scrollHeight})})))}),[q,ae]),de=r.useRef(!1),me=r.useCallback((()=>{de.current||(c().xv(),o(543934).xv({dismissed:!1}),o(295703).xv()),de.current=!1,pe()}),[pe]),ge=(0,r.useCallback)((e=>null==A?void 0:A(e)),[A]),ye=(0,r.useCallback)((e=>{e.stopPropagation(),async function(){de.current=!0,c().xv(),null==R||R(),pe(),await n().default.afterNextFlush(),c().lZ({environment:W,mentionSectionOrdering:["custom-formula","formula"],mentionTypes:{bot:!0,createPage:!1,date:!0,formulaContextVariable:!0,group:!0,team:!0,heading:!0,inviteUserToPage:!1,inviteUserToWorkspace:!1,page:!0,reminder:!1,templateVariable:!1,user:!0}})}()}),[W,R,pe]),he=(0,r.useCallback)((e=>{pe(),e.stopPropagation()}),[pe]),fe=(0,r.useCallback)((e=>{if(e.relatedTarget&&(e.currentTarget.contains(e.relatedTarget)||(0,o(565276).yT)(e.relatedTarget)))return;const t=m().default.getState();if("editing"!==t.mode)return;t.multiSelection.start.store.id===ae.id&&p().clear({environment:W})}),[W,ae.id]),ve=r.useCallback((async()=>{if("formula"===z){await(0,o(214206).bs)()&&(null==A||A({type:"simple",value:null==D?void 0:D.value}))}else"simple"===z?$.setState({open:!0}):(0,u().t1)(z)}),[$,A,null==D?void 0:D.value,z]),xe=(0,r.useCallback)((()=>$.setState({open:!1})),[$]),Se=(0,r.useCallback)((()=>pe()),[pe]),be=(0,r.useCallback)((()=>{se&&p().clear({environment:W})}),[W,se]);r.useImperativeHandle(t,(()=>({blur:be,focus:Se})),[be,Se]);const Ce=(0,d().E)("collections_xws"),ke=(0,l().yK)((e=>{const t={whiteSpace:"pre-wrap",lineHeight:"20px",padding:"2px 4px"};return{buttonWrap:{alignSelf:"end"},containerWrap:{width:200,...L},formulaIcon:{fill:X?e.icon.uiBluePrimary:e.mediumIconColor},formulaText:{...t,cursor:"pointer"},scroller:{flexGrow:1,height:void 0!==E?`calc(1em * ${1.5*E})`:void 0,maxHeight:"calc(1em * 6)",width:void 0!==E&&E>1||J?"100%":"auto"},text:{...t},textWrap:{cursor:"text",display:"flex",flexWrap:"wrap",justifyContent:"end",opacity:H?.4:void 0,width:"100%"},wrap:{background:e.inputBackground,borderRadius:6,boxShadow:e.inputBoxShadow,boxSizing:"border-box",cursor:"text",padding:2,...K&&Y&&{border:`1px solid ${e.text.uiRedPrimary}`,boxShadow:"none"}},actionButtonGroup:{alignSelf:"end",cursor:"unset",justifyContent:"end",padding:"2px 2px 2px 0px"}}}),[Y,H,J,X,E,K,L]),Te=!M||!k,Me=M||X,_e=Ce?"cross_space_and_read_permissions":"read_permissions_only";return(0,f.jsx)(y().ZP,{buttonPopupStore:$,popupType:U?y().Z4.SlideUp:y().Z4.Popup,render:()=>(0,f.jsx)(o(209956).Z,{allowedReturnTypes:h,disabled:H,formulaTypecheckContextValues:w??[],onChange:ge,onClose:xe,parentRecordStore:B,restrictUnaccessibleProperties:_e,spaceId:O,value:D}),renderOrigin:e=>(0,f.jsx)("div",{onClick:he,style:ke.containerWrap,onBlur:fe,children:(0,f.jsx)(g().jX,{align:"center",className:o(247724).Wh_,direction:"column",gap:4,style:ke.wrap,children:(0,f.jsxs)("div",{style:ke.textWrap,children:[(0,f.jsx)(o(842574).Z,{ref:q,style:ke.scroller,type:o(520849).Z.Y,children:"simple"===z?(0,f.jsx)(o(345837).Z,{disableComment:!0,disabled:H,disabledMentionTypes:ue,disableEmbedMenu:!0,disableEmojiCommands:b,disableFilters:C,disableInsertedDeletedAnnotations:T,disableMentions:M,disableMobileActionBar:_,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableShiftEnter:j,disableSlashCommands:!0,disableStyleAnnotations:P,formulaValueTypes:w??[],inPageFind:o(12512).B3.none,mentionSectionOrdering:["custom-formula","formula"],onDown:s().yR,onEnter:ce,onFocus:me,onTab:s().yR,onUntab:s().yR,onUp:s().yR,onEsc:N,pasteBehavior:"inline",placeholder:Z,store:ae,style:ke.text}):(0,f.jsx)("div",{...e,style:ke.formulaText,children:(0,f.jsx)(o(3425).I,{formulaTypecheckContextValues:w,parentRecordStore:B,spaceId:O,value:D})})}),Te&&(0,f.jsx)("div",{children:(0,f.jsxs)(g().jX,{direction:"row",gap:2,style:ke.actionButtonGroup,children:[!Me&&(0,f.jsx)(x,{disabled:H,onClick:ye}),!k&&(0,f.jsx)(o(400836).p,{disabled:H,onClick:ve,value:D})]})})]})})})})}))},209956:(e,t,o)=>{o.d(t,{Z:()=>s});var r=o(667294),n=()=>o(142735),a=()=>o(352230),i=()=>o(214206),l=o(785893);const s=(0,o(677559).o3)(o(141735).F.formulas,((e,t)=>(0,l.jsx)(u,{...t,formulas:e})));function u(e){const{allowedReturnTypes:t,disabled:s,formulas:u,formulaTypecheckContextValues:c,onBack:p,onChange:d,onClose:m,parentRecordStore:g,restrictUnaccessibleProperties:y,spaceId:h,value:f}=e,v=(0,o(219727).Fy)(),x=(0,r.useCallback)((async()=>{if(p)return void p();if("simple"===(null==f?void 0:f.type))return void m();await(0,i().bs)()?(d({type:"simple",value:null==f?void 0:f.value}),m()):m()}),[m,d,p,f]),S=(0,r.useCallback)((e=>{void 0!==e&&e[0][0].length?d({type:"formula",value:e}):d(void 0),m()}),[d,m]),b=(0,n().VK)((()=>{const e=(0,o(615676).W)(),r=(0,o(520509).yf)(g.getRecordModel,g.loadRecordModel,o(749826).default,e);return{allowedReturnTypes:t,handleDataRequest:r,restrictUnaccessibleProperties:y,spaceId:h,valueTypes:c,featureGates:e}}),[t,c,g.getRecordModel,g.loadRecordModel,h,y]),C=(0,n().VK)((()=>(0,i().ne)(f)),[f]);return b?(0,l.jsx)(o(198829).Z,{disableBottomPadding:!0,disableHeaderBorder:!0,disableScroller:!0,hideMobileTopbar:!0,maxHeight:"unset",menuType:v.isMobile?a().o.Modal:a().o.Popup,width:v.isMobile?void 0:740,children:(0,l.jsx)(o(418297).a,{formulas:u,initialCode:C,typecheckContext:b,handleClose:S,handleCancel:x,parentSpaceId:h,disabled:s,focus:!0,evaluationErrors:[],getRecordModel:g.getRecordModel})}):null}},836:(e,t,o)=>{o.d(t,{Z:()=>u});var r=o(667294),n=()=>o(788860),a=()=>o(382047),i=()=>o(815325),l=()=>o(213715),s=o(785893);function u(e){const{value:t,onChange:o}=e,u=(0,r.useCallback)((()=>{o({type:"formula",value:null==t?void 0:t.value})}),[t,o]);return(0,s.jsx)(l().Z,{icon:a().D,title:(0,s.jsx)(n()._H,{...i().s.customFormula}),onClick:u})}},213715:(e,t,o)=>{o.d(t,{Z:()=>l});o(667294);var r=()=>o(846550),n=()=>o(696347),a=()=>o(827973),i=o(785893);function l(e){const t=(0,r().yK)((e=>({icon:{width:14,fill:e.mediumIconColor},chevronRight:{width:12,fill:e.mediumIconColor}})),[]);return(0,i.jsx)(a().Z,{icon:e.icon(t.icon),title:e.title,focused:!1,right:(0,n().o)(t.chevronRight),onClick:e.onClick})}},214206:(e,t,o)=>{o.d(t,{Mv:()=>y,_7:()=>h,bs:()=>v,ne:()=>f});o(670560),o(267602),o(653476),o(731107);var r=o(667294),n=()=>o(142735),a=()=>o(226413),i=()=>o(803021),l=()=>o(995867),s=()=>o(955620),u=()=>o(788860),c=()=>o(696459),p=()=>o(707513),d=()=>o(308186),m=()=>o(963966),g=o(785893);function y(e){const t=(0,n().VK)((()=>{if("collection"!==e.type)return;const t=e.collectionStore.getSchema()[e.property];let o;return t&&(0,a().en)(t)&&(o=t.limit),o}),[e]);return(0,r.useCallback)(((e,o)=>(0,c().$K)(t)?"first"===o?e.slice(0,t):"last"===o?e.slice(-t):void(0,c().t1)(o):e),[t])}function h(e){var t;const o=null===(t=e.collectionStore.getSchema())||void 0===t?void 0:t[e.property];return o&&"date"===o.type?{dateFormat:o.date_format||i().sF,timeFormat:o.time_format||i().c_}:{dateFormat:i().sF,timeFormat:i().c_}}function f(e){if("simple"===(null==e?void 0:e.type)&&e.value){const t=e.value.reduce(((e,t)=>{const o=e.length>0;if((0,s().QJH)(t))!o&&(0,s().I2I)(t)||e.push((0,s().V3y)(`"${t[0]}"`));else if((0,s().AJd)(t))e.push((0,s().V3y)(`"${t[0]}"`));else if((0,s().km_)(t)){const o=(0,s().hDy)(t),r=(0,s().I$B)(o);if(r){const t=o.filter((e=>!(0,s().inx)(e)));e.push((0,s().YCD)(r,t))}}return e}),[]),o=(0,s().Zxt)((0,l().Z)(t,(()=>(0,s().V3y)(" + "))));return o.length>0?o:void 0}return null==e?void 0:e.value}async function v(){const{accept:e}=await d().gt({acceptButtonType:"outline",acceptColor:void 0,acceptLabel:(0,g.jsx)(u()._H,{id:"formulaInputMenu.handleBack.convert",defaultMessage:"Convert"}),cancelButtonType:"outline",description:(0,g.jsx)(u()._H,{id:"formulaInputMenu.handleBack.description",defaultMessage:"Existing formula content will be lost"}),icon:(0,m().p)({fontWeight:p().Ue.semibold,height:36,width:36}),message:(0,g.jsx)(u()._H,{id:"formulaInputMenu.handleBack.message",defaultMessage:"Convert this variable from a formula to plain text?"})});return e}},122890:(e,t,o)=>{o.d(t,{Z:()=>x});o(667294);var r=()=>o(219727),n=()=>o(223506),a=()=>o(177634),i=()=>o(955620),l=()=>o(788860),s=()=>o(696459),u=()=>o(657581),c=()=>o(164079),p=()=>o(998901),d=()=>o(826955),m=()=>o(827973),g=()=>o(384241),y=()=>o(654133),h=()=>o(37849),f=()=>o(879931),v=o(785893);function x(e){var t;const{checkState:o=!1,disabled:x,menuArgs:S,parentRecordStore:b}=e,{isMobile:C}=(0,r().Fy)(),k=(0,f().L)();let T;if("annotation"in e){const{annotation:t,formulaTypecheckContextValues:o}=e,r=(0,i().vmO)(t).id;T=(0,s().$K)(o)?(0,a().vx)(o,r):void 0}else T=e.contextValue;const M=(null===(t=T)||void 0===t?void 0:t.associatedCollectionForDisplay)&&d().NW.createChildStore(b,T.associatedCollectionForDisplay),_=T&&(0,a().RX)(T.type),j=C?24:20;return T?(0,v.jsx)(y().Z,{renderTooltip:()=>x?(0,v.jsx)(l()._H,{...h().f.maximumPeopleSelectedTooltip}):(0,a().WT)(T),placement:p().Placement.Right,render:e=>(0,v.jsx)(m().Z,{checkState:o,title:(0,v.jsx)("div",{style:{display:"flex"},children:T.name}),disabled:x,style:x?k.disabledMenuItem:void 0,icon:(0,s().$K)(T.stepNumberForDisplay)?(0,v.jsx)(u().E,{number:T.stepNumberForDisplay,size:n().$.Medium}):_?_({width:j,height:j,padding:2}):void 0,caption:M&&(0,v.jsx)(l()._H,{defaultMessage:"to {database}",id:"automations.AutomationTargetPickerMenu.VariableMenuItem.databaseCaption",values:{database:(0,v.jsx)(g().Z,{store:M,style:{display:"inline"}})}}),...(0,c().Z)(S,e)})}):null}},534801:(e,t,o)=>{o.d(t,{A:()=>i});o(821057),o(267602),o(470928);var r=()=>o(92960),n=()=>o(907874),a=()=>o(955620);function i(e){const{action:t,currentSimpleFormulaValueTokens:o,onCheckboxClick:i,setCurrentTokens:l,value:s}=e;if(s.kind!==r().FormulaContextValueKind.ContextValue)throw new Error("Not implemented yet.");const u=Boolean(o.find((e=>(0,n().isAnnotationSimpleValueToken)(e)&&(0,a().wjk)(e)&&(0,a().vmO)(e).id===s.id))),c=(0,a()._QF)({id:s.id});return{annotation:c,checkState:u,itemAction:()=>{l("append"===t?u?(0,n().simpleFormulaValueWithoutToken)(o,c):[...o,c]:[c]),null==i||i()}}}},37849:(e,t,o)=>{o.d(t,{f:()=>r});const r=(0,o(788860).vU)({maximumPeopleSelectedTooltip:{defaultMessage:"Maximum people selected",id:"valuePickerItem.maximumSelectedReached"}})},311281:(e,t,o)=>{o.d(t,{Z:()=>C});o(670560),o(241792);var r=o(667294),n=()=>o(219727),a=(o(267602),o(653476),()=>o(846550)),i=()=>o(92960),l=()=>o(907874),s=()=>o(955620),u=()=>o(788860),c=()=>o(513670),p=()=>o(740046),d=()=>o(815325),m=()=>o(836),g=o(785893);var y=()=>o(352230),h=()=>o(198829),f=()=>o(255577),v=()=>o(470386),x=()=>o(388284),S=()=>o(122890),b=()=>o(534801);function C(e){const{currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,menuProps:C,onChange:k,onClose:T,showGenericHeader:M=!1,value:_,parentRecordStore:j}=e,P=(0,n().Fy)(),{footer:V,header:w,numberInput:A,valueItems:I}=function(e){const{currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,onChange:y,onClose:h,value:f}=e,v=(0,u().YB)(),{isMobile:x}=(0,n().Fy)(),S=(0,a().yK)((e=>({inputOuterStyle:{fontSize:"12px",...x?{boxShadow:"none",background:"light"===e.mode?e.white:e.selectLightGray[200],borderRadius:0,minHeight:"45px"}:{}}})),[x]),b=o.filter((e=>"number"===e.type.type)),C=(0,r.useCallback)((e=>{y({type:"simple",value:e})}),[y]),k=(0,r.useCallback)((e=>{C(e),h()}),[C,h]),T=(0,r.useCallback)((e=>{const t=e.target.value;let o;o=""===t?void 0:[[t]],C(o)}),[C]),M=(0,r.useCallback)((e=>{const t=void 0!==e[0]?(0,l().toSimpleFormulaSingleValue)(e[0]):void 0;k(t)}),[k]),_=c().oA(b.map((e=>{if(e.kind===i().FormulaContextValueKind.ContextValue)return{action:"replace",currentSimpleFormulaValueTokens:t,id:e.id||"",setCurrentTokens:M,value:e}}))),j=(0,r.useMemo)((()=>{const e=t[0],o="string"==typeof e?e:(0,s().QaF)(null==f?void 0:f.value);return(0,g.jsx)(p().ZP,{focusInitial:!x,onChange:T,value:o,type:"number",inputOuterStyle:S.inputOuterStyle,placeholder:v.formatMessage(d().s.propertyValuePlaceholder)})}),[t,T,v,x,S.inputOuterStyle,null==f?void 0:f.value]);return{footer:(0,g.jsx)(m().Z,{value:f,onChange:y}),header:v.formatMessage(d().s.genericMenuHeader),numberInput:j,valueItems:_}}({formulaTypecheckContextValues:o,onChange:k,onClose:T,currentSimpleFormulaValueTokens:t,value:_})||{},R=(0,r.useMemo)((()=>I.map((e=>{const{annotation:t,itemAction:r}=(0,b().A)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:e=>(0,g.jsx)(S().Z,{annotation:t,disabled:!1,formulaTypecheckContextValues:o,menuArgs:e,parentRecordStore:j}),action:r}}))),[o,I,j]),F=[];let N;R.length>0&&F.push({key:"textbox",render:e=>(0,g.jsx)(x().Z,{...e}),items:R}),N=P.isMobile?{menuType:y().o.Modal,minWidth:260,onClickRight:T,right:(0,g.jsx)(v().DoneMenuText,{})}:{menuType:y().o.Popup,maxHeight:"50vh",width:260,footer:V&&(0,g.jsx)(x().Z,{topBorder:!0,children:V}),disableHeaderBorder:!0};const B=M&&(0,g.jsx)(x().Z,{style:{paddingBottom:0},title:w}),Z=(0,g.jsxs)("div",{style:{paddingBlockEnd:P.isMobile?0:6},children:[!P.isMobile&&((null==C?void 0:C.header)||B),A]}),E=(0,g.jsx)(f().Z,{initialFocus:0,sections:F,type:f().i.Vertical});return{headerDiv:Z,innerComponents:E,numberMenu:(0,g.jsx)(h().Z,{...N,...C,header:Z,children:E})}}},44317:(e,t,o)=>{o.d(t,{Z:()=>z});o(670560),o(241792);var r=o(667294),n=()=>o(219727),a=()=>o(846550),i=()=>o(568017),l=(o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(653476),o(731107),()=>o(492788)),s=()=>o(142735),u=()=>o(226413),c=()=>o(92960),p=()=>o(177634),d=()=>o(907874),m=()=>o(619186),g=()=>o(801812),y=()=>o(530980),h=()=>o(955620),f=()=>o(788860),v=()=>o(513670),x=()=>o(214206),S=()=>o(815325),b=()=>o(836),C=()=>o(122671),k=()=>o(828946),T=()=>o(98228),M=()=>o(692304),_=()=>o(188301),j=()=>o(874101),P=()=>o(96735),V=o(785893);var w=()=>o(352230),A=()=>o(198829),I=()=>o(255577),R=()=>o(838367),F=()=>o(470386),N=()=>o(388284),B=()=>o(497459),Z=()=>o(122890),E=()=>o(534801),K=()=>o(816512),O=()=>o(989478),L=()=>o(998901),D=()=>o(827973),H=()=>o(715139),W=()=>o(654133),U=()=>o(864832),q=()=>o(37849),Y=()=>o(879931);function $(e){let{annotation:t,disabled:o,getRecordModel:r,isSelected:a,menuArgs:i,showPersonCheckbox:l}=e;const u=(0,n().Fy)(),c=(0,Y().L)(),p=(0,s().VK)((()=>{if((0,d().isAnnotationSimpleValueToken)(t)&&(0,h().IWo)(t)){const e=(0,h().zEN)(t);return e?(0,K().Hl)({pointer:{table:O().KJ,id:e},getRecordValue:r}):void 0}}),[t,r]);return null!=p&&p.asActor&&p.table===O().KJ?(0,V.jsx)(D().Z,{...i,...l?{icon:(0,V.jsx)(H().Z,{checked:a,size:14,onClick:i.onClick})}:{},title:o?(0,V.jsx)(W().Z,{renderTooltip:()=>(0,V.jsx)(f()._H,{...q().f.maximumPeopleSelectedTooltip}),placement:L().Placement.Right,render:e=>(0,V.jsx)("div",{style:{width:"100%"},...e,children:(0,V.jsx)(U().vw,{isSingle:!0,shouldShrink:!0,format:u.isMobile?U().vw.Format.Large:U().vw.Format.Medium,userValue:p.asActor})})}):(0,V.jsx)(U().vw,{isSingle:!0,shouldShrink:!0,format:u.isMobile?U().vw.Format.Large:U().vw.Format.Medium,userValue:p.asActor}),disabled:o,style:o?c.disabledMenuItem:void 0,isTokenTitle:!0}):null}function z(e){const{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:K,formulaValueContext:O,getRecordModel:L,isDisabled:D,limit:H,menuProps:W,onChange:U,onClose:q,showClearButton:Y=!1,showFormulaValueItems:z=!1,showGenericHeader:G=!1,showInputMenuItem:Q=!1,showPersonCheckbox:X=!1,showReplaceAddRemoveToggle:J=!1,value:ee,parentRecordStore:te}=e,oe=(0,n().Fy)(),re=(0,a().yK)((e=>({genericHeader:{paddingBottom:0},headerDiv:{paddingBlockEnd:oe.isMobile?0:6,borderBlockEnd:oe.isMobile?"none":`1px solid ${i().ZP.dividerColor}`},replaceAddRemoveToggleButton:{marginLeft:"8px",marginRight:"8px",marginTop:"8px"}})),[oe.isMobile]),{errorMessage:ne,footer:ae,header:ie,isLoading:le,menuListStore:se,noResultsMessage:ue,replaceAddRemoveToggleButton:ce,searchInput:pe,userItems:de,valueItems:me}=function(e){var t,o;const{action:a,formulaTypecheckContextValues:i,formulaValueContext:w,isDisabled:A=!1,limit:I,onChange:R,onClose:F,showClearButton:N,showReplaceAddRemoveToggle:B,showSelectedPeople:Z,unlimitedCurrentSimpleFormulaValueTokens:E,value:K}=e,O=(0,n().O7)(),L=(0,n().Fy)(),D=(0,f().YB)(),H="collection"===(null==w?void 0:w.type)?w.collectionStore.getRecordModel:y().omK.constant(void 0),W=(0,x().Mv)(w),U=W(E,"first"),q=(0,r.useMemo)((()=>i.filter((e=>(0,p().uy)(e.type,{type:"person"})))),[i]),[Y,$]=(0,r.useState)(""),z=(0,s().qz)(void 0,M().Z),G=(0,s().VK)((()=>{if("collection"!==w.type)return!1;const e=w.collectionStore.getSchema()[w.property];return e&&(0,u().en)(e)?1===e.limit:void 0}),[w]),[Q]=(0,g().r5)((async()=>{const e=Y?(0,m().ZP)(Y,q,(e=>e.kind===c().FormulaContextValueKind.ContextValue?e.name:"")):q,t=await k().x.searchActions.load(),o=await t.searchVisibleSpaceUsers({environment:O,query:Y,membersOnly:!1}),r=(0,d().fromSimpleFormulaArrayValue)(null==K?void 0:K.value).reduce(((e,t)=>(t&&(0,d().isAnnotationSimpleValueToken)(t)&&(0,h().IWo)(t)&&e.push(t[1]),e)),[]);let n=0,a=o[n];const i=[];for(;a&&i.length<20;)r.includes(a.id)&&!Z||i.push(a.id),n+=1,a=o[n];return{valueResults:e,userResults:i}}),[O,Y,Z,q,null==K?void 0:K.value],{debounce:T().vp}),X=(0,r.useCallback)((()=>{$(""),z.setState({...z.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[z]),J=(0,r.useCallback)(((e,t)=>{R(e||K,t||a)}),[a,R,K]),ee=(0,r.useCallback)((e=>{const t=W(e,"last");J({type:"simple",value:(0,d().toSimpleFormulaArrayValue)(t)}),X()}),[W,J,X]),te=(0,r.useCallback)((()=>{ee(U.slice(0,U.length-1))}),[U,ee]),oe=(0,r.useCallback)((e=>{null==ee||ee((0,d().simpleFormulaValueWithoutToken)(U,e))}),[U,ee]),re=Boolean(I&&U.length>=I),ne=v().oA(U.map(((e,t)=>"string"==typeof e||"boolean"==typeof e?null:(0,h().IWo)(e)?(0,V.jsx)(P().Z,{handleRemoveToken:oe,token:e},t):(0,h().wjk)(e)?(0,V.jsx)(j().Z,{formulaTypecheckContextValues:i,handleRemoveToken:oe,isDisabled:A||re,token:e},t):null))),ae=new Set(v().oA(U.map((e=>(0,d().isAnnotationSimpleValueToken)(e)&&(0,h().wjk)(e)&&(0,h().vmO)(e).id)))),ie=new Set(v().oA(U.map((e=>(0,d().isAnnotationSimpleValueToken)(e)&&(0,h().IWo)(e)&&(0,h().zEN)(e))))),le=v().oA(((null===(t=Q.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>{const t=e.kind===c().FormulaContextValueKind.ContextValue&&e.id||"";if(!t||!ae.has(t)||Z)return{action:"append",currentSimpleFormulaValueTokens:U,isDisabled:A||re,id:t,getRecordModel:H,setCurrentTokens:ee,value:e}}))),se=v().oA(((null===(o=Q.value)||void 0===o?void 0:o.userResults)||[]).map((e=>{const t=ie.has(e);if(t&&!Z)return;const o=(0,h().tEo)(e);return{action:()=>{t?oe(o):ee([...U,o]),G&&l().default.afterNextFlush((()=>{F()}))},annotation:o,getRecordModel:H,id:e,isDisabled:A||re,userId:e,isSelected:t}}))),ue=[...le,...se],ce=(0,V.jsx)(C().ZP,{style:{maxHeight:6*parseInt(C().go,10)},disabled:A||re,dontShowBorderBottom:L.isAndroid,focus:!L.isMobile||void 0,focusAfterAnimation:!0,format:C().UR.FilterValue,onChange:e=>$(e.target.value),onClearButtonClick:()=>ee([]),onRemoveLastToken:te,placeholder:D.formatMessage(S().s.personSearchPlaceholder),showClearButton:N,tokens:ne,value:Y}),pe=(0,V.jsx)(b().Z,{value:K,onChange:J}),de=(0,V.jsx)(_().Z,{action:a,handleOnChange:J});return{errorMessage:Q.error&&D.formatMessage(S().s.somethingWentWrong),footer:pe,header:D.formatMessage(S().s.genericMenuHeader),isLoading:!Q.value&&!Q.error,menuListStore:z,noResultsMessage:0===ue.length&&Q.value&&D.formatMessage(S().s.noResults),replaceAddRemoveToggleButton:!!B&&de,searchInput:ce,userItems:se,valueItems:le}}({action:t,formulaTypecheckContextValues:K,formulaValueContext:O,isDisabled:D,limit:H,onChange:U,onClose:q,showClearButton:Y,showReplaceAddRemoveToggle:J,showSelectedPeople:X,unlimitedCurrentSimpleFormulaValueTokens:o,value:ee})||{},ge=[...(0,r.useMemo)((()=>me&&z?me.map((e=>{const{annotation:t,itemAction:o}=(0,E().A)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:o=>(0,V.jsx)(Z().Z,{annotation:t,disabled:e.isDisabled,formulaTypecheckContextValues:K,menuArgs:o,parentRecordStore:te}),action:o}})):[]),[K,z,me,te]),...(0,r.useMemo)((()=>de?de.map((e=>({key:e.userId,render:t=>(0,V.jsx)($,{annotation:e.annotation,disabled:e.isDisabled,getRecordModel:L||e.getRecordModel,isSelected:e.isSelected,menuArgs:t,showPersonCheckbox:X}),action:e.action}))):[]),[L,X,de])],ye=[];let he;ge.length>0&&ye.push({key:"users",render:e=>(0,V.jsx)(N().Z,{...e}),items:ge}),he=oe.isMobile?{menuType:w().o.Modal,minWidth:260,right:(0,V.jsx)(F().DoneMenuText,{}),onClickRight:q,footer:ae&&(0,V.jsx)(N().Z,{topBorder:!0,children:ae})}:{menuType:w().o.Popup,maxHeight:"50vh",width:260,footer:ae&&(0,V.jsx)(N().Z,{topBorder:!0,children:ae}),disableHeaderBorder:!0};const fe=G&&(0,V.jsx)(N().Z,{style:re.genericHeader,title:ie}),ve=(0,V.jsxs)("div",{style:re.headerDiv,children:[!oe.isMobile&&((null==W?void 0:W.header)||fe),Q&&pe]}),xe=(0,V.jsxs)(V.Fragment,{children:[ne&&(0,V.jsx)(N().Z,{children:(0,V.jsx)(R().Z,{title:ne})}),!le&&!ne&&ce&&(0,V.jsx)("div",{style:re.replaceAddRemoveToggleButton,children:ce}),ue&&(0,V.jsx)(N().Z,{children:(0,V.jsx)(R().Z,{title:ue})}),le&&(0,V.jsx)(N().Z,{children:(0,V.jsx)(B().Z,{})}),ge.length>0&&(0,V.jsx)(I().Z,{type:I().i.Vertical,initialFocus:0,sections:ye,store:se})]});return{headerDiv:ve,innerComponents:xe,personArrayMenu:(0,V.jsx)(A().Z,{...he,...W,header:ve,children:xe})}}},749515:(e,t,o)=>{o.d(t,{Z:()=>W});o(670560),o(241792);var r=o(667294),n=()=>o(219727),a=()=>o(846550),i=()=>o(568017),l=(o(267602),o(653476),o(470928),()=>o(142735)),s=()=>o(226413),u=()=>o(92960),c=()=>o(177634),p=()=>o(907874),d=()=>o(619186),m=()=>o(801812),g=()=>o(955620),y=()=>o(788860),h=()=>o(513670),f=()=>o(214206),v=()=>o(815325),x=()=>o(836),S=()=>o(122671),b=()=>o(677559),C=()=>o(828946),k=()=>o(98228),T=()=>o(692304),M=()=>o(188301),_=()=>o(874101),j=()=>o(38883),P=()=>o(328094),V=()=>o(637118),w=o(785893);function A(e){let{handleRemoveToken:t,isDisabled:o,token:a}=e;const i=(0,n().Fy)(),{automationStore:l}=(0,V().YC)(),s=(0,r.useCallback)((()=>{t&&t(a)}),[t,a]),u=(0,g().yrl)(a);if(!u)return null;const c=u.id;return(0,w.jsx)(P().Z,{blockId:c,relationPropertySchema:void 0,format:i.isMobile?j().lo.Medium:j().lo.Small,isSingle:!1,onClickRemove:s,parentStore:l,shouldShrink:!0,shouldWrap:!1,showRemoveButton:!o},c)}var I=()=>o(352230),R=()=>o(198829),F=()=>o(255577),N=()=>o(838367),B=()=>o(470386),Z=()=>o(388284),E=()=>o(122890),K=()=>o(534801),O=()=>o(396136),L=()=>o(826955),D=()=>o(231219);function H(e){let{annotation:t,checkState:o,menuArgs:r}=e;const{automationStore:n}=(0,V().YC)(),a=(0,l().VK)((()=>{if((0,p().isAnnotationSimpleValueToken)(t)&&(0,g().STW)(t))return(0,g().yrl)(t)}),[t]);if(!a)return null;const i=a.id,s=L().G.createChildStore(n,{id:i,table:O().iU});return(0,w.jsx)(D().Z,{store:s,checkState:o,hidePath:!0,...r})}function W(e){const{action:t,collection:o,currentSimpleFormulaValueTokens:j,formulaTypecheckContextValues:P,formulaValueContext:V,menuProps:O,onChange:L,onClose:D,showClearButton:W=!1,showFormulaValueItems:U=!1,showGenericHeader:q=!1,showInputMenuItem:Y=!1,showReplaceAddRemoveToggle:$=!1,value:z,parentRecordStore:G}=e,Q=(0,n().Fy)(),X=(0,a().yK)((e=>({genericHeader:{paddingBottom:0},headerDiv:{paddingBlockEnd:Q.isMobile?0:6,borderBlockEnd:Q.isMobile?"none":`1px solid ${i().ZP.dividerColor}`},replaceAddRemoveToggleButton:{marginLeft:"8px",marginRight:"8px",marginTop:"8px"}})),[Q.isMobile]),{footer:J,header:ee,menuListStore:te,noResultsMessage:oe,searchInput:re,pageItems:ne,replaceAddRemoveToggleButton:ae,valueItems:ie}=function(e){var t,o;const{action:a,collection:i,formulaTypecheckContextValues:j,formulaValueContext:P,onChange:V,onClose:I,showClearButton:R,showReplaceAddRemoveToggle:F,unlimitedCurrentSimpleFormulaValueTokens:N,value:B}=e,Z=(0,n().O7)(),E=(0,n().Fy)(),K=(0,y().YB)(),{collectionStore:O,property:L}=P,D=(0,f().Mv)(P),H=(0,l().VK)((()=>O.getSchema()[L]),[O,L]),W=(0,r.useMemo)((()=>{const e="relation"===(null==H?void 0:H.type)?(0,s().j0)(H):void 0;return j.filter((t=>(0,c().uy)(t.type,{type:"block",collection:e},!0)))}),[j,H]),[U,q]=(0,r.useState)(""),Y=(0,l().qz)(void 0,T().Z),$=(0,l().VK)((()=>!!(O&&L&&H&&(0,s().en)(H))&&1===H.limit),[O,L,H]),z=(0,b().XJ)(C().x.searchActions),[G]=(0,m().r5)((async()=>{const e=U?(0,d().ZP)(U,W,(e=>e.kind===u().FormulaContextValueKind.ContextValue?e.name:"")):W;if("resolved"!==z.status||!i)return;const t=z.value,{results:o}=await t.searchPagesInCollection({environment:Z,query:U,collectionId:i.id,limit:20,spaceId:i.spaceId,excludeTemplates:!0,source:"simple_formula_value_page_search",includePublicPagesWithoutExplicitAccess:!0,boostRecentlyViewedPages:!1});return{valueResults:e,pageResults:o}}),[U,W,z.status,z.value,i,Z],{debounce:k().vp}),Q=D(N,"first").filter((e=>{if("string"!=typeof e&&"boolean"!=typeof e&&(0,g().STW)(e)){var t,o;const r=null===(t=(0,g().yrl)(e))||void 0===t?void 0:t.id;if(r&&null!=G&&null!==(o=G.value)&&void 0!==o&&o.pageResults.includes(r))return!0}return!0})),X=(0,r.useCallback)((()=>{q(""),Y.setState({...Y.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[Y]),J=(0,r.useCallback)(((e,t)=>{V(e||B,t||a)}),[a,V,B]),ee=(0,r.useCallback)((e=>{const t=D(e,"last");J({type:"simple",value:(0,p().toSimpleFormulaArrayValue)(t)}),X(),$&&I()}),[D,J,X,$,I]),te=(0,r.useCallback)((()=>{ee(Q.slice(0,Q.length-1))}),[Q,ee]),oe=(0,r.useCallback)((e=>{null==ee||ee((0,p().simpleFormulaValueWithoutToken)(Q,e))}),[Q,ee]),re=h().oA(Q.map(((e,t)=>"string"==typeof e||"boolean"==typeof e?null:(0,g().wjk)(e)?(0,w.jsx)(_().Z,{formulaTypecheckContextValues:j,handleRemoveToken:oe,isDisabled:!1,token:e},t):(0,g().STW)(e)?(0,w.jsx)(A,{handleRemoveToken:oe,isDisabled:!1,token:e},t):null))),ne=(0,w.jsx)(S().ZP,{focus:!E.isMobile||void 0,focusAfterAnimation:!0,format:S().UR.FilterValue,tokens:re,placeholder:K.formatMessage(v().s.pageSearchPlaceholder),onRemoveLastToken:te,onClearButtonClick:()=>ee([]),value:U,onChange:e=>q(e.target.value),dontShowBorderBottom:E.isAndroid,showClearButton:R}),ae=(0,w.jsx)(x().Z,{value:B,onChange:J}),ie=(0,w.jsx)(M().Z,{action:a,handleOnChange:J}),le=h().oA(((null===(t=G.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>{const t=e.kind===u().FormulaContextValueKind.ContextValue&&e.id||"",o=Boolean(Q.find((e=>(0,p().isAnnotationSimpleValueToken)(e)&&(0,g().wjk)(e)&&(0,g().vmO)(e).id===t)));return{action:"append",checkType:$?"single":"multi",checkState:o,currentSimpleFormulaValueTokens:Q,id:t,setCurrentTokens:ee,value:e}}))),se=h().oA(((null===(o=G.value)||void 0===o?void 0:o.pageResults)||[]).map((e=>{const t=Boolean(Q.find((t=>{var o;return(0,p().isAnnotationSimpleValueToken)(t)&&(0,g().STW)(t)&&(null===(o=(0,g().yrl)(t))||void 0===o?void 0:o.id)===e})));if(i){const o=(0,g().$0A)(e,i.spaceId);return{action:()=>{ee(t?(0,p().simpleFormulaValueWithoutToken)(Q,o):[...Q,o])},checkState:t,checkType:$?"single":"multi",annotation:o,id:e}}}))),ue=[...le,...se];return{footer:ae,header:K.formatMessage(v().s.genericMenuHeader),menuListStore:Y,noResultsMessage:0===ue.length&&G.value&&K.formatMessage(v().s.noResults),replaceAddRemoveToggleButton:!!F&&ie,searchInput:ne,pageItems:se,valueItems:le}}({action:t,collection:o,formulaTypecheckContextValues:P,formulaValueContext:V,onChange:L,onClose:D,showClearButton:W,showReplaceAddRemoveToggle:$,unlimitedCurrentSimpleFormulaValueTokens:j,value:z})||{},le=[...(0,r.useMemo)((()=>U?ie.map((e=>{const{annotation:t,itemAction:o}=(0,K().A)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:o=>(0,w.jsx)(E().Z,{annotation:t,checkState:e.checkState,disabled:!1,formulaTypecheckContextValues:P,menuArgs:o,parentRecordStore:G}),action:o}})):[]),[P,U,ie,G]),...(0,r.useMemo)((()=>ne?ne.map((e=>({key:e.id,render:t=>(0,w.jsx)(H,{annotation:e.annotation,checkState:e.checkState,menuArgs:t}),action:e.action}))):[]),[ne])],se=[];let ue;le.length>0&&se.push({key:"values",render:e=>(0,w.jsx)(Z().Z,{...e}),items:le}),ue=Q.isMobile?{menuType:I().o.Modal,right:(0,w.jsx)(B().DoneMenuText,{}),onClickRight:D,minWidth:260,footer:J&&(0,w.jsx)(Z().Z,{topBorder:!0,children:J})}:{menuType:I().o.Popup,maxHeight:"50vh",width:260,footer:J&&(0,w.jsx)(Z().Z,{topBorder:!0,children:J}),disableHeaderBorder:!0};const ce=q&&(0,w.jsx)(Z().Z,{style:X.genericHeader,title:ee}),pe=(0,w.jsxs)("div",{style:X.headerDiv,children:[!Q.isMobile&&((null==O?void 0:O.header)||ce),Y&&re]}),de=(0,w.jsxs)(w.Fragment,{children:[ae&&(0,w.jsx)("div",{style:X.replaceAddRemoveToggleButton,children:ae}),oe&&(0,w.jsx)(Z().Z,{children:(0,w.jsx)(N().Z,{title:oe})}),le.length>0&&(0,w.jsx)(F().Z,{type:F().i.Vertical,initialFocus:0,sections:se,store:te})]});return{headerDiv:pe,innerComponents:de,relationMenu:(0,w.jsx)(R().Z,{...ue,...O,header:pe,children:de})}}},303926:(e,t,o)=>{o.d(t,{Z:()=>_});o(670560),o(241792);var r=o(667294),n=()=>o(219727),a=()=>o(846550),i=(o(267602),o(653476),()=>o(142735)),l=()=>o(92960),s=()=>o(907874),u=()=>o(788860),c=()=>o(513670),p=()=>o(247724),d=()=>o(585270),m=()=>o(815325),g=()=>o(345837),y=()=>o(57687),h=()=>o(12512),f=()=>o(876822),v=o(785893);var x=()=>o(352230),S=()=>o(198829),b=()=>o(255577),C=()=>o(470386),k=()=>o(388284),T=()=>o(122890),M=()=>o(534801);function _(e){const{currentSimpleFormulaValueTokens:t,disableEmojiCommands:o,disableFormulas:_,disableFormattingAndMentions:j,disableMobileActionBar:P,disableTemplateVariableMentions:V,formulaTypecheckContextValues:w,menuProps:A,onChange:I,onClose:R,parentRecordStore:F,showGenericHeader:N=!1,value:B}=e,{isMobile:Z}=(0,n().Fy)(),{header:E,textInput:K,valueItems:O}=function(e){const{currentSimpleFormulaValueTokens:t,disableEmojiCommands:o,disableFormattingAndMentions:x,disableFormulas:S,disableMobileActionBar:b,disableTemplateVariableMentions:C,formulaTypecheckContextValues:k,onChange:T,onClose:M,parentRecordStore:_,value:j}=e,P=(0,u().YB)(),V=(0,r.useMemo)((()=>k.filter((e=>"text"===e.type.type))),[k]),w=(0,i().VK)((()=>{var e;return null===(e=f().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),A=(0,r.useCallback)((e=>{T({type:"simple",value:e})}),[T]),I=(0,r.useCallback)((e=>{A(e),M()}),[A,M]),R=(0,r.useCallback)((e=>{const t=void 0!==e[0]?(0,s().toSimpleFormulaSingleValue)(e[0]):void 0;I(t)}),[I]),{store:F}=(0,y().Cl)({initialValue:null==j?void 0:j.value,onChange:A}),{isMobile:N}=(0,n().Fy)(),B=(0,a().yK)((e=>({textWrap:{borderRadius:6,lineHeight:"24px",padding:1,...N?{boxShadow:"unset"}:{boxShadow:e.inputBoxShadow,margin:"0 12px"}},simpleFormulaText:{fontSize:12,width:"100%",...N?{padding:"10px"}:{padding:"4px 10px"}},text:{fontSize:12,maxHeight:120,overflow:"auto",...N?{background:"light"===e.mode?e.white:e.selectLightGray[200],margin:0,padding:"10px"}:{background:e.inputBackground,padding:"4px 10px"}}})),[N]),Z=c().oA(V.map((e=>{if(e.kind===l().FormulaContextValueKind.ContextValue)return{action:"replace",currentSimpleFormulaValueTokens:t,id:e.id||"",setCurrentTokens:R,value:e}})));let E;return E=w&&_?(0,v.jsx)(d().w,{...x?{disableDateMentions:!0,disableDateReminderMentions:!0,disableMentions:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0}:{},disabled:!1,disableEmojiCommands:o,disableFormulas:S,disableMobileActionBar:b,disableTemplateVariableMentions:C,formulaTypecheckContextValues:k,onChange:T,onTextEnter:M,parentRecordStore:_,spaceId:w,placeholder:P.formatMessage(m().s.propertyValuePlaceholder),style:B.simpleFormulaText,value:j}):(0,v.jsx)("div",{className:p().Wh_,style:B.textWrap,children:(0,v.jsx)(g().Z,{disableComment:!0,disabled:!1,disableEmbedMenu:!0,disableEmojiCommands:o,disableMobileActionBar:b,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableSlashCommands:!0,disableTemplateVariableMentions:C,...x?{disableDateMentions:!0,disableDateReminderMentions:!0,disableMentions:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0}:{},onEnter:M,pasteBehavior:"inline",store:F,style:B.text,inPageFind:h().B3.none,placeholder:P.formatMessage(m().s.propertyValuePlaceholder)})}),{header:P.formatMessage(m().s.genericMenuHeader),textInput:E,valueItems:Z}}({currentSimpleFormulaValueTokens:t,disableFormulas:_,disableEmojiCommands:o,disableFormattingAndMentions:j,disableMobileActionBar:P,disableTemplateVariableMentions:V,formulaTypecheckContextValues:w,onChange:I,onClose:R,parentRecordStore:F,value:B})||{},L=(0,a().yK)((e=>({header:{...Z?{borderBlockEnd:`1px solid ${e.lightDividerColor}`}:{paddingBlockEnd:6}}})),[Z]),D=(0,r.useMemo)((()=>O.map((e=>{const{annotation:t,itemAction:o}=(0,M().A)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:e=>(0,v.jsx)(T().Z,{annotation:t,disabled:!1,menuArgs:e,parentRecordStore:F}),action:o}}))),[O,F]),H=[];let W;D.length>0&&H.push({key:"textbox",render:e=>(0,v.jsx)(k().Z,{...e}),items:D}),W=Z?{menuType:x().o.Modal,right:(0,v.jsx)(C().DoneMenuText,{}),onClickRight:R,minWidth:260}:{menuType:x().o.Popup,maxHeight:"50vh",width:260,disableHeaderBorder:!0};const U=N&&(0,v.jsx)(k().Z,{style:{paddingBottom:0},title:E}),q=(0,v.jsxs)("div",{style:L.header,children:[!Z&&((null==A?void 0:A.header)||U),K]}),Y=(0,v.jsx)(b().Z,{initialFocus:0,sections:H,type:b().i.Vertical});return{headerDiv:q,innerComponents:Y,textMenu:(0,v.jsx)(S().Z,{...W,...A,header:q,children:Y})}}},879931:(e,t,o)=>{o.d(t,{L:()=>n});var r=()=>o(846550);function n(){return(0,r().yK)((e=>({disabledMenuItem:{cursor:"not-allowed",opacity:.4}})),[])}},815325:(e,t,o)=>{o.d(t,{s:()=>r});const r=(0,o(788860).vU)({back:{defaultMessage:"Back",id:"formulas.SimpleFormulaValuePicker.back"},valuesFromThisAutomation:{defaultMessage:"From this automation",id:"formulas.SimpleFormulaValuePicker.valuesFromThisAutomation"},pickADate:{defaultMessage:"Pick a date",id:"formulas.SimpleFormulaValuePicker.pickADate"},clear:{defaultMessage:"Clear",id:"formulas.SimpleFormulaValuePicker.clear"},unchecked:{defaultMessage:"Unchecked",id:"formulas.SimpleFormulaValuePicker.checkbox.unchecked"},checked:{defaultMessage:"Checked",id:"formulas.SimpleFormulaValuePicker.checkbox.checked"},checkboxOptions:{defaultMessage:"Checkbox options",id:"formulas.SimpleFormulaValuePicker.checkbox.sectionHeader"},searchPlaceHolder:{defaultMessage:"Select one or more options…",id:"formulas.SimpleFormulaValuePicker.select.searchPlaceholder"},selectOptionsSectionHeader:{defaultMessage:"Select an option",id:"formulas.SimpleFormulaValuePicker.select.sectionHeader"},noResults:{defaultMessage:"No results",id:"formulas.simpleValuePicker.noResults"},pageSearchPlaceholder:{defaultMessage:"Search for one or more pages…",id:"formulas.SimpleFormulaValuePicker.pages.searchPlaceholder"},pages:{defaultMessage:"Pages",id:"formulas.SimpleFormulaValuePicker.pages.sectionHeader"},somethingWentWrong:{defaultMessage:"Something went wrong.",id:"formulas.simpleValuePicker.errorMessage"},personSelect:{defaultMessage:"Select...",id:"formulas.SimpleFormulaValuePicker.chooseAValue"},personSearchPlaceholder:{defaultMessage:"Search for one or more people…",id:"formulas.SimpleFormulaValuePicker.people.searchPlaceholder"},propertyValuePlaceholder:{defaultMessage:"Enter a value",id:"formulas.SimpleFormulaValuePicker.general.propertyValuePlaceholder"},customFormula:{defaultMessage:"Custom formula",id:"formulas.SimpleFormulaValuePicker.customFormula"},peopleInWorkspace:{defaultMessage:"People",id:"formulas.SimpleFormulaValuePicker.people.sectionHeader"},genericMenuHeader:{defaultMessage:"Set property to",id:"formulas.SimpleFormulaValuePicker.genericMenuHeader"}})},953349:(e,t,o)=>{o.d(t,{IH:()=>F,MF:()=>K,N_:()=>N,U7:()=>Z,ZP:()=>I,uV:()=>E});o(670560),o(267602),o(653476),o(470928),o(241792),o(228244);var r=o(667294),n=()=>o(219727),a=()=>o(142735),i=()=>o(846550),l=()=>o(714230),s=()=>o(235484),u=()=>o(788860),c=()=>o(513670),p=()=>o(855741),d=()=>o(696459),m=()=>o(824462),g=()=>o(388915),y=()=>o(527278),h=()=>o(762300),f=()=>o(729201),v=()=>o(624778),x=()=>o(15409),S=()=>o(821149),b=()=>o(270820),C=()=>o(947189),k=()=>o(876822),T=()=>o(138912),M=()=>o(385010),_=()=>o(827973),j=()=>o(740046),P=()=>o(312578),V=()=>o(388284),w=o(785893);const A=(0,u().vU)({channelSearchPlaceholder:{id:"notificationRuleSettings.selectChannelView.searchInput.placeholder",defaultMessage:"Search…"}});function I(e){const{currentNotificationChannels:t,onNotificationChannelSelect:o,onClose:i,onNewSlackAccountAdded:m,renderMenu:v,channelFilter:S,workflowExternalAuthenticationPointer:C,isMultiSelectMode:M,shouldHideSlackAccountSection:I}=e,B=(0,n().O7)(),{isMobile:K}=(0,n().Fy)(),O=(0,a().Kw)(T().default.completeSlackAuthentications),L=e.currentExternalAuthentication??c().Ps(O),D=(0,r.useMemo)((()=>C?{type:"workflow",workflowExternalAuthenticationId:C.id}:L?{type:"external",botId:L.id}:void 0),[C,L]);r.useEffect((()=>{const e=C?null==C?void 0:C.spaceId:null==L?void 0:L.space_id;D&&e&&E({environment:B,spaceId:e,externalAuthConfig:D})}),[B,D,L,C]);const H=(null==C?void 0:C.id)??(null==L?void 0:L.id),[W,U]=r.useState(""),{loadedChannelsForAccount:q,isLoading:Y}=Z(D),$=(0,a().VK)((()=>T().default.integrations.state.find((e=>e.id===s().nO))),[]),z=(0,a().VK)((()=>{var e;return null===(e=k().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),G=r.useCallback((e=>{L?o(e,L.parent_id):C&&o(e,C.id),M||i()}),[o,L,C,i,M]),Q=R(),X=r.useCallback((e=>{const{channel:o}=e;return{key:o.id,render:e=>(0,w.jsx)(_().Z,{...e,icon:N({channel:o,styles:Q.icon}),desktopIconStyle:{width:8},title:o.name,right:(null==t?void 0:t.some((e=>e.id===o.id)))&&(0,x().e)(Q.icon)}),action:()=>{G(o)}}}),[G,Q.icon,t]),{publicChannels:J,privateChannels:ee,personalChannels:te}=r.useMemo((()=>function(e,t){const o=[],r=[],n=[];for(const a of e)t&&!t(a)||("public"===a.type?o.push(a):"private"===a.type?r.push(a):"me"===a.type?n.push(a):(0,d().t1)(a.type));return{publicChannels:o,privateChannels:r,personalChannels:n}}(q,S)),[S,q]),oe=r.useCallback((()=>J.map((e=>({menuListItem:X({channel:e}),channelName:e.name})))),[J,X]),re=r.useCallback((()=>ee.map((e=>({menuListItem:X({channel:e}),channelName:e.name})))),[ee,X]),ne=r.useCallback((()=>te.map((e=>({menuListItem:X({channel:e}),channelName:e.name})))),[te,X]),ae=r.useCallback((()=>oe().map((e=>{let{menuListItem:t,channelName:o}=e;if(F({channelName:o,query:W}))return t})).filter(d().$K)),[oe,W]),ie=r.useCallback((()=>re().map((e=>{let{menuListItem:t,channelName:o}=e;if(F({channelName:o,query:W}))return t})).filter(d().$K)),[re,W]),le=r.useCallback((()=>ne().map((e=>{let{menuListItem:t,channelName:o}=e;if(F({channelName:o,query:W}))return t})).filter(d().$K)),[ne,W]),se=r.useCallback((()=>L?(0,h().jg)(L).organizationName:"Workflows organization"),[L]),ue=r.useCallback((()=>{if(!H)return[];const e=[],t=ae(),o=ie(),r=le();return r.length>0&&e.push({key:"personal-channels",render:e=>(0,w.jsx)(V().Z,{...e,title:se()}),items:r}),t.length>0&&e.push({key:"public-channels",render:e=>(0,w.jsx)(V().Z,{...e,topBorder:r.length>0,title:0===r.length&&se()}),items:t}),o.length>0&&e.push({key:"private-channels",render:e=>(0,w.jsx)(V().Z,{...e,topBorder:t.length>0,title:0===r.length&&t.length>0&&se()}),items:o}),e}),[H,ae,ie,le,se]),ce=(0,f().Z)(Y,500,300);if(!H||!$)return null;const pe=[{key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,w.jsx)("div",{children:(0,w.jsx)(j().ZP,{...e,inputLeft:(0,w.jsx)(j().f_,{icon:b().R}),inputRight:ce&&(0,w.jsx)(P().Z,{style:{marginRight:2}}),showClearButton:!0,placeholder:y().Z.formatMessage(A.channelSearchPlaceholder),focusInitial:!K,value:W,onChange:e=>{U(e.target.value)}})})}],render:e=>(0,w.jsx)(V().Z,{...e})},...ue()];return t||I||pe.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!z)return;const e=await g().hM({environment:B,integration:$,spaceId:z,from:"collection_view_settings"});p().x.isFail(e)||m()},render:e=>(0,w.jsx)(_().Z,{...e,icon:(0,w.jsx)("img",{src:l().Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,w.jsx)(u()._H,{id:"notificationRuleSettings.selectChannelView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,w.jsx)(V().Z,{...e,topBorder:!0})}),(0,w.jsx)(w.Fragment,{children:v(pe)})}function R(){return(0,i().yK)((e=>({icon:{marginLeft:8,width:12,height:12,color:e.lightTextColor},container:{backgroundColor:e.popoverBackground,marginTop:12,marginBottom:6},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:e.regularIconColor}})),[])}function F(e){const{channelName:t,query:o}=e;return 0===o.length||t.toLocaleLowerCase().indexOf(o.trim().toLocaleLowerCase())>=0}function N(e){const{channel:t,styles:o}=e;return"private"===t.type?(0,S().b)(o):"me"===t.type?(0,v().p)(o):(0,C().J)(o)}const B=15e3;function Z(e){return(0,a().VK)((()=>{if(!e)return{loadedChannelsForAccount:[],isLoading:!1};const t=M().l.getStateForBot(e);return{loadedChannelsForAccount:Object.values(t.channels),isLoading:t.fetching}}),[e])}async function E(e){const{environment:t,externalAuthConfig:o,spaceId:r}=e,n=M().l.getStateForBot(o);if(n.fetching||Date.now()-n.lastRefreshed<B)return;let a;for(M().l.updateStateForBot(o,{fetching:!0,lastRefreshed:Date.now()});;){const e=await m().callApi({eventName:"getExternalNotificationChannels",environment:t,data:{spaceId:r,cursor:a,...o}});if("success"!==e.type){console.error(e.error);break}{const t={};for(const o of e.data.channels)t[o.id]=o;if(M().l.addChannelsForBot(o,t),a=e.data.cursor,!a)break}}M().l.updateStateForBot(o,{fetching:!1})}const K=r.forwardRef(((e,t)=>{const{channel:o,currentNotificationChannels:r,...n}=e,a=R();return(0,w.jsx)(_().Z,{ref:t,...n,icon:N({channel:o,styles:a.icon}),desktopIconStyle:{width:8},title:o.name,right:(null==r?void 0:r.some((e=>e.id===o.id)))&&(0,x().e)(a.icon)})}));K.displayName="SlackChannelMenuItem"},71194:(e,t,o)=>{o.d(t,{$K:()=>j,HF:()=>P,SC:()=>M,aO:()=>k,hL:()=>V,hY:()=>T,j3:()=>_,n8:()=>w});o(821057),o(670560);var r=()=>o(271896),n=()=>o(956057),a=()=>o(494616),i=()=>o(855741),l=()=>o(696459),s=()=>o(308186),u=()=>o(636340),c=()=>o(269299),p=()=>o(49396),d=()=>o(637118),m=()=>o(309841),g=()=>o(594546),y=()=>o(615676),h=()=>o(712334),f=()=>o(487270),v=()=>o(527278),x=()=>o(739479),S=()=>o(749826),b=()=>o(826955);const C=(0,o(788860).vU)({automationDeleteConfirmationMessage:{id:"slackAutomations.remove.confirmation.message",defaultMessage:"Delete {automationName}?"},automationDeleteAcceptLabel:{id:"slackAutomations.remove.confirmation.acceptLabel",defaultMessage:"Delete"},confirmDiscardChangesMessage:{id:"automations.confirmDiscardChanges.message",defaultMessage:"Discard unsaved changes to this automation?"},confirmDiscardChangesAccept:{defaultMessage:"Discard",id:"automations.confirmDiscardChanges.acceptLabel"},confirmDiscardOptionalFieldChangesMessage:{id:"automations.confirmDiscardToggleFieldChangesMessage.message",defaultMessage:"{hasName, select, true {Discard {fieldName} field?} other {Discard field?}}"}});function k(e){const{automationStore:t,collectionStore:o,environment:s,intl:h,from:f,builderType:v}=e;c().createAndCommit({environment:s,userAction:"collectionSettingsAutomationsActions.createDatabaseAutomation",canUndo:!0,perform:e=>{c().applyOperation({store:o,operation:{pointer:o.pointer,path:["format","automation_ids"],command:"listAfter",args:{id:t.id}},transaction:e});const r=b().Mz.createChildStore(o,t.pointer),i=t.getActionStores();for(const t of i){const o=t.getType();o&&p().addAutomationAction({actionId:t.id,actionType:o,automationStore:r,config:t.getConfig(),environment:s,intl:h,transaction:e})}let d;const m=t.getTrigger();(0,l().$K)(m)&&"event"!==m.type&&"notification_event"!==m.type?"recurrence"===m.type?d={id:n().Il(),type:"recurrence",recurrence:m.recurrence}:(0,l().t1)(m):d={id:n().Il(),type:"event",event:(null==m?void 0:m.event)??{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:o.getSpaceShardedPointer(),type:"collection"}}},u().ae({environment:s,inMemoryRecordCache:o.inMemoryRecordCache,table:a().cv,transaction:e,value:{action_ids:t.getActionIds(),alive:!0,id:t.id,parent_id:o.id,parent_table:o.table,properties:{name:t.getName()},space_id:o.getSpaceId(),status:"active",trigger:d}})}});const x=t.getModel();if((0,l().$K)(x)){const e=(0,d().Ep)(t);let o=[];e&&i().x.isSuccess(e)&&(o=e.value.valueTypes),(0,m().GV)(((e,n,a)=>{const i=(0,g().mc)(s),l=r().TY({automationModel:x,builderType:v,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:o,getRecordModel:t.getRecordModel,featureGates:(0,y().W)(),simpleFormulasModule:a}),u=f?{feature:{id:l.automation_id,from:f,type:"automation"}}:{};r().T0(i,{...l,...u}),S().default.logEvent("automation_create")}))}}function T(e){const{automationStore:t,collectionStore:o,environment:n,builderType:a,source:s}=e;c().createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.saveDatabaseAutomation",canUndo:!0,perform:e=>{const r=b().Mz.createChildStore(o,t.pointer),n=t.getName(),a=r.getKeyStore("properties");u().sW({store:a,data:{name:n},transaction:e});const i=t.getActionStores();if((0,h().Xd)(r)&&(0,h().Xd)(t))if(t.isTriggerType("event")||t.isTriggerType("notification_event"))r.isTriggerType("event")||u().sW({store:r.getTriggerStore(),data:{type:"event"},transaction:e}),r.verifyTriggerType("event"),u().sW({store:r.getTriggerStore().getKeyStore("event"),data:t.getTriggerStore().getKeyStore("event").getValue(),transaction:e});else{if(!t.isTriggerType("recurrence"))throw new Error("Unexpected trigger type for automationStore");r.isTriggerType("recurrence")||u().sW({store:r.getTriggerStore(),data:{type:"recurrence"},transaction:e}),r.verifyTriggerType("recurrence"),u().sW({store:r.getTriggerStore().getKeyStore("recurrence"),data:t.getTriggerStore().getKeyStore("recurrence").getValue(),transaction:e})}const l=[];for(const t of i){const o=t.getModel();if(!o)continue;const n=b().zq.createChildStore(r,t.pointer);u().sO({store:n,value:{alive:!0,config:o.getConfig(),id:o.id,parent_id:r.id,parent_table:r.table,space_id:r.getSpaceId(),type:o.type},transaction:e}),l.push(t.id)}u().sW({store:r,data:{action_ids:l},transaction:e})}});const p=t.getModel();(0,l().$K)(p)&&(0,m().GV)(((e,o,l)=>{const u=(0,d().Ep)(t);let c=[];u&&i().x.isSuccess(u)&&(c=u.value.valueTypes);const m=(0,g().mc)(n),h=r().TY({automationModel:p,builderType:a,formulaAnalyticsModule:o,formulasModule:e,formulaTypecheckContextValues:c,getRecordModel:t.getRecordModel,featureGates:(0,y().W)(),simpleFormulasModule:l,source:s});r().r4(m,h),S().default.logEvent("automation_update")}))}async function M(e){const{intl:t,environment:o,collectionStore:r,existingAutomationStore:n,onDelete:a}=e,i=n.getNameWithDefault(t);(await s().gt({message:t.formatMessage(C.automationDeleteConfirmationMessage,{automationName:i}),acceptLabel:t.formatMessage(C.automationDeleteAcceptLabel)})).accept&&(!function(e){const{environment:t,collectionStore:o,existingAutomationStore:r}=e;c().createAndCommit({environment:t,userAction:"collectionSettingsAutomationsActions.deleteAutomation",canUndo:!0,perform:e=>{const n=o.getFormatStore().getKeyStore("automation_ids"),a=b().Mz.createChildStore(o,r.pointer);c().applyOperation({store:n,operation:{pointer:n.pointer,path:n.path,command:"listRemove",args:{id:a.id}},transaction:e}),p().deleteAutomation({automationStore:a,environment:t,transaction:e})}})}({environment:o,collectionStore:r,existingAutomationStore:n}),null==a||a())}function _(e){const{automationStore:t,collectionStore:o,environment:r}=e;c().createAndCommit({environment:r,userAction:"collectionSettingsAutomationsActions.disableAutomation",canUndo:!0,perform:e=>{const n=b().Mz.createChildStore(o,t.pointer);p().disableAutomation({automationStore:n,environment:r,transaction:e})}})}function j(e){const{automationStore:t,collectionStore:o,environment:r}=e;c().createAndCommit({environment:r,userAction:"collectionSettingsAutomationsActions.enableAutomation",canUndo:!0,perform:e=>{const n=b().Mz.createChildStore(o,t.pointer);p().enableAutomation({automationStore:n,environment:r,transaction:e})}})}function P(e){const{automationStore:t,collectionStore:o,environment:r}=e,n=o.getFormatStore().getKeyStore("automation_ids"),i=(0,f().TS)({environment:r,table:a().cv,spaceId:t.getSpaceId()});c().createAndCommit({environment:r,userAction:"",canUndo:!0,perform:e=>{p().duplicateAutomation({environment:r,sourceAutomationStore:t,targetAutomationId:i,transaction:e}),c().applyOperation({store:n,operation:{pointer:n.pointer,path:n.path,command:"listAfter",args:{id:i}},transaction:e})}})}async function V(e){const{hasPendingChanges:t}=e;if(!t)return!0;return(await s().gt({acceptLabel:v().Z.formatMessage(C.confirmDiscardChangesAccept),message:v().Z.formatMessage(C.confirmDiscardChangesMessage),icon:(0,x().y)({height:24,width:24})})).accept}async function w(e){const{fieldName:t}=e;return(await s().gt({acceptLabel:v().Z.formatMessage(C.confirmDiscardChangesAccept),message:v().Z.formatMessage(C.confirmDiscardOptionalFieldChangesMessage,{fieldName:t,hasName:Boolean(t)}),icon:(0,x().y)({height:24,width:24})})).accept}},972350:(e,t,o)=>{o.d(t,{o:()=>l});o(667294);var r=()=>o(846550),n=()=>o(568017),a=()=>o(707513),i=o(785893);function l(e){const{children:t,icon:o,shouldTruncateChildren:l}=e,s=(0,r().yK)((e=>{const t=(0,n().KR)(e,void 0);return{iconWrap:{flex:"0 0 auto"},textWrap:{...l?a().Yu:{},flex:"1 1 auto"},wrap:{backgroundColor:t.backgroundColor,borderRadius:12,color:t.textColor,display:"inline-flex",gap:4,minWidth:l?50:void 0,padding:"0 8px"}}}),[l]);return(0,i.jsxs)("span",{style:s.wrap,children:[o&&(0,i.jsx)("span",{"aria-hidden":"true",style:s.iconWrap,children:o}),(0,i.jsx)("span",{style:s.textWrap,children:t})]})}},867601:(e,t,o)=>{o.d(t,{Cf:()=>B,EF:()=>R,JO:()=>T,Li:()=>_,cB:()=>I,i1:()=>j,pw:()=>F,qM:()=>P,qk:()=>k,rU:()=>A,sA:()=>N,sM:()=>w,vM:()=>V,wB:()=>M});o(821057),o(267602),o(916054),o(653476),o(241792),o(228244);var r=o.n(o(443261)),n=()=>o(912203),a=()=>o(473304),i=()=>o(455947),l=()=>o(226413),s=()=>o(871379),u=()=>o(177634),c=()=>o(956057),p=()=>o(528514),d=()=>o(752778),m=()=>o(955620),g=()=>o(513670),y=()=>o(855741),h=()=>o(696459),f=()=>o(960597),v=()=>o(749826),x=()=>o(826955),S=()=>o(815277),b=()=>o(270315),C=()=>o(122479);function k(e){const{automationStore:t,collectionStore:o,typecheckResult:r}=e,a=o.getSchema(),i=t.getKeyStore("properties").getKeyStore("name").getValue();if(null==i||!i.trim())return!1;if(!(0,n().Of)({automationTrigger:t.getTrigger(),collectionSchema:a}))return!1;const l=t.getActionStores().filter((e=>e.isDefined()));return 0!==l.length&&l.every((e=>T({actionStore:e,collectionStore:o,typecheckResult:r})))}function T(e){const{actionStore:t,collectionStore:o,typecheckResult:r}=e;if((0,f().pM)(r,t.id).length>0)return!1;if(t.isType("slack_notification"))return(0,h().$K)(t.getConfigStore().getKeyStore("external_bot_id").getValue())&&(0,h().$K)(t.getConfigStore().getKeyStore("target").getValue());if(t.isType("send_gmail_notification")){const e=t.getConfigStore(),o=e.getKeyStore("to").getValue(),r=e.getKeyStore("email_subject").getValue(),n=e.getKeyStore("email_body").getValue();return!(!r||!n||(0,m().PgY)(r.value)||(0,m().PgY)(n.value))&&!(!(o&&o.value&&o.value.value)||g().xb(o.value.value))}if(t.isType("update_pages")){const e=t.getConfigStore().getKeyStore("target").getValue(),a=t.getConfigStore().getKeyStore("properties").getValue()??[];if(!(0,h().$K)(e)||0===a.length)return!1;if("collection"===e.type){const t=x().NW.createChildStore(o,e.collection).getSchema();if(a.some((e=>(0,n().LF)({property:e,collectionSchema:t})||(0,n().Jy)({collectionSchema:t,property:e,type:"action"}))))return!1}else if("variable"===e.type){const i=(0,u().MY)(e.id);if("global"===i.source&&"button_page"===i.global){const e=o.getSchema();if(a.some((t=>(0,n().LF)({property:t,collectionSchema:e})||(0,n().Jy)({collectionSchema:e,property:t,type:"action"}))))return!1}else{if(y().x.isFail(r))return!1;const o=(0,u().vx)(r.value.valueTypes,e.id),i=o?M(o,t):void 0;if(!i)return!1;const l=i.getSchema();if(a.some((e=>(0,n().LF)({property:e,collectionSchema:l})||(0,n().Jy)({collectionSchema:l,property:e,type:"action"}))))return!1}}else{if("page"===e.type)return!1;(0,h().t1)(e)}return!0}if(t.isType("create_page")){const e=t.getConfigStore().getKeyStore("collection").getValue();if(!(0,h().$K)(e))return!1;const r=x().NW.createChildStore(o,e).getSchema();return!(t.getConfigStore().getKeyStore("properties").getValue()??[]).some((e=>(0,n().LF)({property:e,collectionSchema:r})||(0,n().Jy)({collectionSchema:r,property:e,type:"action"})))}if(t.isType("send_in_app_notification")){const e=t.getConfigStore(),o=e.getKeyStore("target").getValue(),r=e.getKeyStore("notification_message").getValue();if(!o||!r||(0,m().PgY)(r.value))return!1;switch(o.type){case"property":if(!o.propertyId||!o.collectionPointer)return!1;break;case"formula":if(!o.value||!o.value.value||g().xb(o.value.value))return!1}return!0}if(t.isType("define_variables"))return!0;if(t.isType("http_request"))return!0;if(t.isType("publish_site")){const e=t.getConfigStore().getKeyStore("target").getValue();return!!(0,h().$K)(e)}throw new Error(`isActionStoreComplete not implemented for ${t.getType()}`)}function M(e,t){let o;return"block"===e.type.type&&e.type.collection?o=x().NW.createChildStore(t,e.type.collection):"array"===e.type.type&&"block"===e.type.of.type&&e.type.of.collection&&(o=x().NW.createChildStore(t,e.type.of.collection)),o}function _(e){const{collectionStore:t}=e;if(!t||(0,C().EY)(t)||(0,C().Aw)(t))return!1;const o=(0,S().DE)(t.environment,{name:"premium_automations",spaceId:t.getSpaceId(),userId:t.userId});if((t.getFormat().automation_ids??[]).length>=a().ss&&!o)return!1;const r=t.pointer,n=t.getSpaceId();return(0,s().IC)({targetTriggerType:"event",targetParentPointer:r,targetSpaceId:n}).every((e=>{let{pointer:o,minimumRequiredRole:r}=e;const n=t.getRecordRole(o);return!!n&&(0,p().yY)(n,r)}))}function j(e){const{automationStore:t,actionStores:o,collectionStore:r}=e,n=t.getParentStore();if(!n||(0,C().EY)(n)||(0,C().Aw)(r))return!1;const a=t.getMinimumFieldsForPermissions();if(!a)return!1;if(!o.every((e=>e.isDefined())))return!1;const i=o.some((e=>!e.isType("slack_notification")));if(!(0,S().DE)(r.environment,{name:"premium_automations",spaceId:r.getSpaceId(),userId:r.userId})&&i)return!1;return(0,s().fz)({automationValue:a,actionValues:o.map((e=>({config:e.getConfig(),type:e.getType()})))}).every((e=>{let{pointer:o,minimumRequiredRole:r}=e;const n=t.getRecordRole(o);return!!n&&(0,p().yY)(n,r)}))}function P(e){const{automationStore:t,collectionStore:o}=e,r=t.getParentStore();if(!r||(0,C().EY)(r)||(0,C().Aw)(o))return!1;const n=t.getMinimumFieldsForPermissions();if(!n)return!1;return(0,s().bM)(n).every((e=>{let{pointer:o,minimumRequiredRole:r}=e;const n=t.getRecordRole(o);return!!n&&(0,p().yY)(n,r)}))}function V(e){const{automationStore:t,collectionStore:o}=e;if(!t.isTriggerType("event")&&!t.isTriggerType("notification_event"))return!1;const r=t.getEventConfiguration();if(!r||void 0===r.source||r.source.type===d().vF||"filter"===r.source.type)return!1;const n=x().Xr.createChildStore(o,r.source.pointer);return function(e){const t=A(e),o=w(e);return(0,h().$K)(t)||(0,h().$K)(o)}({collectionSchema:o.getSchema(),collectionViewStore:n})}function w(e){var t;if(!v().default.checkGate({gateName:"collections_xws"}))return;const{collectionViewStore:o,collectionSchema:r}=e,n=o.getPropertyFiltersStore().getValue()??[],a=null===(t=o.getQuery(r))||void 0===t?void 0:t.filter,s={operator:"and",filters:(0,i().OH)({propertyFilters:n,combinatorFilter:a,schema:r})},u=(0,i().SH)(s,(e=>{if((0,i().aN)(e)){const t=r[e.property];return!!t&&(0,l().W2)(o.getSpaceId(),t,r)}return!1}));return u&&(0,i().aN)(u)?u.property:void 0}function A(e){var t;const{collectionViewStore:o,collectionSchema:r}=e,a=o.getPropertyFiltersStore().getValue()??[],l=null===(t=o.getQuery(r))||void 0===t?void 0:t.filter,s={operator:"and",filters:(0,i().OH)({propertyFilters:a,combinatorFilter:l,schema:r})},u=(0,i().SH)(s,(e=>{if((0,i().aN)(e)){const t=r[e.property];return!!t&&!(0,n().TX)(t)}return!1}));if(u)return(0,i().aN)(u)?u.property:(0,i().Mm)(u)?u.timestamp:void 0}function I(e){if("collectionTypedView"===e.contextType)return!1;const t=e.collectionStore();return!!t&&(!(t.isSyncedCollection()&&!v().default.checkGate({gateName:"support_synced_database_automations"}))&&void 0===e.viewsModuleContextStore.state)}function R(e){const{collectionSchema:t,propertyIds:o,searchTerm:n}=e;if(!n)return o.slice(0);const a=new Map,i=o.map((e=>{const o=t[e],r=o?`${o.name} ${b().SO[o.type]}`:"";return a.set(e,r),r})),l=r().filter(n,i).map((e=>{let{original:t}=e;return t}));return o.filter((e=>l.includes(a.get(e)??"")))}function F(e){return{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:e.getSpaceShardedPointer(),type:d().vF}}}function N(e){const{automationId:t,automationName:o,collectionStore:r,userId:n}=e;return function(e){const{actionIds:t,automationId:o,collectionStore:r,eventConfiguration:n,lastEditedTime:a,properties:i,userId:l}=e,s=Date.now();return{action_ids:t,alive:!0,created_by_id:l,created_by_table:"notion_user",created_time:s,id:o,last_edited_by_id:l,last_edited_by_table:"notion_user",last_edited_time:a??s,parent_id:r.id,parent_table:d().vF,properties:i??{},space_id:r.getSpaceId(),status:"active",trigger:{event:n,id:c().Il(),type:"event"},version:1}}({actionIds:[],automationId:t,collectionStore:r,eventConfiguration:F(r),properties:{name:o},userId:n})}function B(e){const{tab:t}=e;return"automationSettings"===(null==t?void 0:t.type)||"automationCreateSettings"===(null==t?void 0:t.type)||"automationEditSettings"===(null==t?void 0:t.type)}},762300:(e,t,o)=>{o.d(t,{P9:()=>s,YJ:()=>u,jc:()=>l,jg:()=>i});o(670560),o(267602),o(653476);var r=()=>o(235484),n=()=>o(530980),a=()=>o(525807);function i(e){if(e.integration_id!==r().nO)throw"Cannot render account for integration.";const t=/(.+) - (.+)/.exec(e.account_name);if(!t)return{accountName:e.account_name};const[,o,n]=t;return{organizationName:o,accountName:n}}function l(e){return n().kk5.fromValue(a().PJ,e).getSlackWorkspaceId()}function s(e,t){return t?e.filter((e=>{const o=l(e);return!!o&&t(o)})):e}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const o={};for(const r of e){const{accountName:e,organizationName:n}=i(r);c({query:t,accountName:e,organizationName:n})&&(o[e]||(o[e]=[]),o[e].push({externalAuthentication:r,workspaceName:n}))}return o}function c(e){const{accountName:t,organizationName:o,query:r}=e;if(0===r.length)return!0;const n=t.toLocaleLowerCase().indexOf(r.trim().toLocaleLowerCase())>=0,a=!!o&&o.toLocaleLowerCase().indexOf(r.trim().toLocaleLowerCase())>=0;return n||a}},624778:(e,t,o)=>{o.d(t,{p:()=>r().p});var r=()=>o(775404)},382047:(e,t,o)=>{o.d(t,{D:()=>r().D});var r=()=>o(2403)},414108:(e,t,o)=>{o.d(t,{Bh:()=>n,H0:()=>a});class r extends(()=>o(263184))().default{getInitialState(){return{insertionPoint:void 0,stack:[]}}getCurrentTab(){return o(513670).Z$(this.getState().stack)}getInsertionPoint(){return this.getState().insertionPoint}pushSettingsItem(e){this.update((t=>({...t,stack:[...t.stack,e]})))}popSettingsItem(){this.update((e=>({...e,stack:e.stack.slice(0,e.stack.length-1)})))}replaceSettingsItem(e){this.update((t=>{const o=[...t.stack.slice(0,t.stack.length-1),e];return{...t,stack:o}}))}setInsertionPoint(e){this.update((t=>({...t,insertionPoint:e})))}}class n extends r{}class a extends r{}},385010:(e,t,o)=>{o.d(t,{l:()=>i,w:()=>n});function r(e){switch(e.type){case"external":return`external-${e.botId}`;case"workflow":return`workflow-${e.workflowExternalAuthenticationId}`;case"universal":return`universal-${e.app}-${e.spaceId}`;default:throw(0,o(696459).t1)(e)}}const n={channels:{},fetching:!1,lastRefreshed:0};class a extends(()=>o(263184))().default{getStateForBot(e){const t=r(e);return this.state[t]??n}updateStateForBot(e,t){this.setState({...this.state,[r(e)]:{...this.getStateForBot(e),...t}})}addChannelsForBot(e,t){const o=this.getStateForBot(e);this.setState({...this.state,[r(e)]:{...o,channels:{...o.channels,...t}}})}}const i=new a;(0,o(947115).exposeDebugValue)("ExternalNotificationChannelsStore",i)},752348:(e,t,o)=>{o.r(t),o.d(t,{getAllContextValues:()=>d,getContextValueForActionById:()=>g,getContextValuesForAction:()=>m,typecheckAutomation:()=>c,typecheckAutomationAsync:()=>p});o(670560),o(267602),o(241792),o(228244);var r=()=>o(513670),n=()=>o(855741),a=()=>o(696459),i=()=>o(870910),l=()=>o(177634),s=()=>o(360517),u=()=>o(227666);const{sync:c,async:p}=i().R.makeRunners((function*(e){const{actionModels:t,automationModel:c,contextType:p,formulasModule:d,runtimeStats:m}=e,g={valueTypes:e.valueTypes,actionInputValueTypes:{},actionValidationFailures:{}},y=performance.now();let h,f,v;if("button_block"===p||"button_property"===p){if(!c.isButtonType())return{error:new(s().MO)(`Automation trigger (${c.getTriggerType()}) does not match context type (${p}).`)};const t=c.getTrigger();v=(0,u().o)(c.getTriggerType()).typecheck(e,t)}else if("event"===p){if(!c.isEventType()&&!c.isNotificationType())return{error:new(s().MO)(`Automation trigger (${c.getTriggerType()}) does not match context type (${p}).`)};const t=c.getTrigger();v=(0,u().o)(c.getTriggerType()).typecheck(e,t)}else if("recurrence"===p){if(!c.isRecurrenceType())return{error:new(s().MO)(`Automation trigger (${c.getTriggerType()}) does not match context type (${p}).`)};const t=c.getTrigger();v=(0,u().o)(c.getTriggerType()).typecheck(e,t)}else(0,a().t1)(e);if(n().x.isFail(v))return v;g.valueTypes.push(...r().d9(v.value.valueTypes));for(const a of t){h=void 0,m&&(h=o(870691).Fv.getOrCreateAction(m,a.pointer,a.getType()));const t=(0,o(969583).getActionRegistryItem)(a.getType());if(!t){f={error:new(s().EP)({actionId:a.id,message:`Unsupported action type: ${a.getType()}`})};break}const u=performance.now(),p=(0,o(782827).C)({automationModel:c,formulasModule:d,formulaValueTypes:g.valueTypes}),y=(0,o(750239).xg)(yield*t.resolveExecutionDependencies(p,a));yield*i().R.fetchRecords(y.map((e=>e.pointer))),h&&(h.totalDependencies=y.length,h.getDependenciesDurationMs=Math.trunc(performance.now()-u));const v=t.typecheck(e,a),x=r().d9(g.valueTypes);if(g.actionInputValueTypes[a.id]=x,n().x.isFail(v)){f=v;break}for(const e of v.value.valueTypes??[]){g.valueTypes.some((t=>(0,l().Fl)(e,t)))||g.valueTypes.push(e)}v.value.validationFailures&&v.value.validationFailures.length>0&&(g.actionValidationFailures[a.id]=v.value.validationFailures)}const x=Math.trunc(performance.now()-y);return m&&(m.typecheckStartTime=y,m.typecheckDurationMs=x,m.typecheckSuccess=!(0,a().$K)(f)),f??{value:g}}));function d(e){return n().x.isFail(e)?[]:e.value.valueTypes.slice(0)}function m(e,t){return n().x.isFail(e)?[]:e.value.actionInputValueTypes[t]??[]}function g(e,t,o){const r=m(e,t);return(0,l().vx)(r,o)}},227666:(e,t,o)=>{o.d(t,{o:()=>p});var r=()=>o(513670),n=()=>o(696459),a=()=>o(998411),i=()=>o(752778),l=()=>o(309968);const s={type:"button",getCreatePermissions(e){const{parentPointer:t}=e;return[{minimumRole:"read_and_write",pointer:t,type:"record_permission"}]},getEditPermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getManagePermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getExecutePermissions(e){const{automationModel:t}=e;return[{minimumRole:"reader",pointer:t.getParentPointer(),type:"record_permission"}]},typecheck(e){const{automationModel:t,contextType:a,getRecordModel:s,intl:u}=e,c=l().q6.compile(u),p=l()._V.compile(u),d=l().ZH.compile(u),m=t.getParentPointer();let g,y;if("button_block"===a){if(e.pageBlockModel){const t=(0,o(942275).J2)({block:e.pageBlockModel,getRecordModel:s});t&&(g=l().xL.compile(u,t.pointer),y=l().lg.compile(u))}}else if("button_property"===a){const e=s(m);if((null==e?void 0:e.table)!==i().vF)return{error:new(o(360517).MO)(`Unable to load automation parent: ${o(827370).dr.toKey(m)}`)};g=l().xL.compile(u,e.pointer),y=l().lg.compile(u)}else(0,n().t1)(a);return{value:{valueTypes:(0,r().oA)([c,p,d,g,y])}}},execute(e){const{formulaVariableResolution:t}=e,{executingUserPointer:o,executingUserTimeZone:n,thisPageBlockModel:i}=t??{},s=i?l().xL.evaluate(i.pointer):void 0,u=null==i?void 0:i.getCreatedByPointer(),c=u?l().lg.evaluate(u):void 0,p=o?l().q6.evaluate(o):void 0,d=(0,a().r)(),m=l()._V.evaluate(n??d),g=l().ZH.evaluate(n??d);return{value:{values:(0,r().oA)([s,c,p,m,g])}}},isAvailableForContext:e=>!0};o(670560);const u={type:"event",getCreatePermissions(e){const{parentPointer:t,spacePointer:o}=e;return[{minimumRole:"editor",pointer:t,type:"record_permission"},{minimumRole:"read_and_write",pointer:o,type:"record_permission"}]},getEditPermissions(e){const{automationModel:t}=e,r=[{minimumRole:"editor",pointer:t.getParentPointer(),type:"record_permission"},{minimumRole:"read_and_write",pointer:t.getSpacePointer(),type:"record_permission"}],a=t.getTrigger();if("event"===a.type){const e=a.event;(0,n().$K)(e.source)&&"filter"!==e.source.type&&(e.source.type===i().vF||e.source.type===o(139978).np?r.push({minimumRole:"reader",pointer:e.source.pointer,type:"record_permission"}):(0,n().t1)(e.source))}return r},getManagePermissions(e){const{automationModel:t}=e;return[{minimumRole:"editor",pointer:t.getParentPointer(),type:"record_permission"},{minimumRole:"read_and_write",pointer:t.getSpacePointer(),type:"record_permission"}]},getExecutePermissions(e){const{automationModel:t}=e;return[{minimumRole:"reader",pointer:t.getParentPointer(),type:"record_permission"}]},typecheck(e){const{automationModel:t,intl:o}=e,n=l().TW.compile(o),a=l().Nq.compile(o),s=l()._V.compile(o),u=l().ZH.compile(o),c=t.getParentPointer();let p;return c.table===i().vF&&(p=l().Hr.compile(o,c)),{value:{valueTypes:(0,r().oA)([n,a,s,u,p])}}},execute(e){const{formulaVariableResolution:t}=e,{executingUserPointer:o,executingUserTimeZone:i,thisPageBlockModel:s}=t??{},u=s?l().Hr.evaluate(s.pointer):void 0,c=o?l().TW.evaluate(o):void 0,p=(0,a().r)(),d=l()._V.evaluate(i??p),m=null==s?void 0:s.getCreatedByPointer(),g=(0,n().$K)(m)?l().Nq.evaluate(m):void 0,y=l().ZH.evaluate(i??p);return{value:{values:(0,r().oA)([u,c,d,y,g])}}},isAvailableForContext:e=>!0};const c={button:s,event:u,notification_event:u,recurrence:{type:"recurrence",getCreatePermissions(e){const{parentPointer:t}=e;return[{minimumRole:"read_and_write",pointer:t,type:"record_permission"}]},getEditPermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getManagePermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getExecutePermissions(e){const{automationModel:t}=e;return[{minimumRole:"reader",pointer:t.getParentPointer(),type:"record_permission"}]},typecheck(e){const{intl:t}=e;return{value:{valueTypes:[l()._V.compile(t),l().ZH.compile(t)]}}},execute(e){const{formulaVariableResolution:t}=e,{executingUserTimeZone:o}=t??{},r=(0,a().r)();return{value:{values:[l()._V.evaluate(o??r),l().ZH.evaluate(o??r)]}}},isAvailableForContext(e){const{automation:t,automationActions:r,hasPremiumAutomations:a}=e;if(t.parent_table===o(396136).iU)return!0;if(t.parent_table===i().vF){const e=o(217465).RecordMap.create();for(const t of r)e.addModel(t);return!!t.isCompleteSprintAutomation({getRecordModel:o(530980).omK.fromRecordMap(e)})||a}(0,n().t1)(t.parent_table)}}};function p(e){return c[e]}},775404:(e,t,o)=>{o.d(t,{p:()=>n});o(667294);var r=o(785893);const n=(0,o(827282).IU)("at",{viewBox:"0 0 16 16",svg:(0,r.jsx)("path",{d:"M.911 8.034c0 4.505 3.049 7.24 7.246 7.24 1.135 0 2.215-.158 2.885-.376.472-.15.622-.397.622-.65a.44.44 0 00-.451-.444 1.3 1.3 0 00-.321.048c-.834.205-1.552.341-2.516.341-3.74 0-6.29-2.255-6.29-6.118 0-3.698 2.407-6.275 6.03-6.275 3.206 0 5.886 1.975 5.886 5.523 0 2.072-.697 3.466-1.825 3.466-.752 0-1.176-.437-1.176-1.183V4.972c0-.37-.205-.595-.554-.595-.341 0-.553.226-.553.595v.779h-.062c-.349-.84-1.203-1.374-2.222-1.374-1.77 0-3.014 1.51-3.014 3.678 0 2.187 1.237 3.712 3.042 3.712 1.06 0 1.88-.575 2.276-1.545h.062c.13.963.943 1.551 2.023 1.551 1.907 0 3.09-1.873 3.09-4.498 0-3.971-2.92-6.548-6.96-6.548C3.886.727.912 3.632.912 8.034zm6.911 2.652c-1.223 0-2.003-1.018-2.003-2.638 0-1.593.786-2.611 2.01-2.611 1.258 0 2.05.998 2.05 2.584 0 1.62-.813 2.665-2.057 2.665z"})})}}]);