"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[40205],{253458:(e,t,n)=>{n.r(t),n.d(t,{default:()=>se});n(267602),n(653476);var i=n(667294),a=()=>n(219727),s=()=>n(142735),o=()=>n(846550),r=()=>n(714230),l=()=>n(956057),d=()=>n(788860),c=()=>n(707513),u=()=>n(148976),h=()=>n(10271),p=()=>n(985481),g=()=>n(688049),m=()=>n(965910),x=()=>n(876822),f=()=>n(308939),v=()=>n(853648),j=(n(470928),n(241792),()=>n(235484)),y=()=>n(799891),w=()=>n(705214),C=()=>n(513670),S=()=>n(308186),I=()=>n(205228),A=()=>n(594546),k=()=>n(709344),b=()=>n(527278),T=()=>n(138912),Z=()=>n(824462),D=()=>n(423402);const P=(0,d().vU)({dismissButtonLabel:{defaultMessage:"OK",id:"dialog.dismissButton.label"},pleaseTryAgainMsg:{defaultMessage:"Please try again",id:"dialog.pleaseTryAgainMsg"},AuthenticationFailedMsg:{defaultMessage:"Authentication failed. Please try again.",id:"jiraDCAuthActions.authenticationFailedMsg"}});var B=()=>n(352230),M=()=>n(15409),H=()=>n(615634),U=()=>n(858856),J=()=>n(998901),L=()=>n(827973),_=()=>n(448419),z=()=>n(666414),V=()=>n(1910),F=()=>n(206352),R=()=>n(291198),O=()=>n(198829),E=()=>n(255577),K=()=>n(661297),N=()=>n(92175),q=()=>n(906651),W=()=>n(388284),G=()=>n(654133),Y=()=>n(251932),$=n(785893);function Q(e){const{site:t,APIToken:n,username:i,password:a,jiraDataCenterBasicAuthEnabled:r,jiraDCVersion:l,formValues:{site:u,token:h,username:p,password:g},onChange:m,invalidFields:x,hidePopup:v,environment:B}=e,M=(0,s().Kw)(f().ZP),H=(0,o().yK)((e=>({title:{fontWeight:c().Ue.semibold},inputLabels:{fontSize:c().JB.UISmall.desktop,fontWeight:c().Ue.semibold,font:"SF Pro",lineHeight:c().Nv.UISmall.desktop,color:e.lightTextColor},placeHolder:{font:"SF Pro",fontWeight:c().Ue.regular,fontSize:c().JB.UIRegular.desktop,lineHeight:c().Nv.UISmall.desktop},captionText:{font:"SF Pro",fontWeight:c().Ue.regular,lineHeight:c().Nv.UISmall.desktop,fontSize:c().JB.UISmall.desktop,color:e.lightTextColor},inputBox:{width:"100%",height:28,padding:4,gap:4,radius:"default"},invalidInput:{boxShadow:e.outlineRedInputBoxShadow}})),[]);return(0,$.jsx)(F().Z,{debugName:"AtlassianAPIAuthContentPopup",capture:!0,children:(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%",width:"100%"},children:[(0,$.jsx)("div",{style:{overflowY:"scroll"},children:(0,$.jsxs)("div",{style:{padding:2},children:[(0,$.jsx)("div",{children:r&&(0,$.jsx)("div",{children:(0,$.jsxs)("div",{children:[(0,$.jsx)("label",{htmlFor:"jiraDCVersion",style:{...H.inputLabels},children:l}),(0,$.jsx)(X,{onSelectOption:e=>{f().ZP.setState({...f().ZP.state,authenticationType:e})},options:[{key:f().P.Bearer,label:(0,$.jsx)(d()._H,{id:"jiraAuthentication.jiraDCNewerVersionOption.label",defaultMessage:"8.14 or later"})},{key:f().P.Basic,label:(0,$.jsx)(d()._H,{id:"jiraAuthentication.jiraDCOlderVersionOption.label",defaultMessage:"Prior to 8.14"})}],currentOption:M.authenticationType??f().P.Bearer})]})})}),(0,$.jsx)(z().Z,{size:14,isHidden:!0}),(0,$.jsxs)("div",{children:[(0,$.jsx)("label",{htmlFor:"site",style:H.inputLabels,children:t}),(0,$.jsx)(z().Z,{size:8,isHidden:!0}),(0,$.jsx)(R().Z,{id:"site",value:u,onChange:e=>m("site",e.target.value),showClearButton:!0,placeholder:"https://domain.com",inputElementAttributes:{minLength:4},style:{...H.inputBox,...x.includes("site")&&H.invalidInput}})]}),(0,$.jsx)(z().Z,{size:14,isHidden:!0}),(0,$.jsx)("div",{children:r&&M.authenticationType===f().P.Basic?(0,$.jsxs)("div",{children:[(0,$.jsxs)("div",{children:[(0,$.jsx)("label",{htmlFor:"username",style:H.inputLabels,children:i}),(0,$.jsx)(z().Z,{size:8,isHidden:!0}),(0,$.jsx)(R().Z,{id:"username",type:"username",value:p,onChange:e=>{m("username",e.target.value)},showClearButton:!0,placeholder:"Enter your username",inputElementAttributes:{minLength:4},style:{...H.inputBox,...x.includes("username")&&H.invalidInput}}),(0,$.jsx)(z().Z,{size:8,isHidden:!0})]}),(0,$.jsx)(z().Z,{size:14,isHidden:!0}),(0,$.jsxs)("div",{children:[(0,$.jsx)("label",{htmlFor:"password",style:H.inputLabels,children:a}),(0,$.jsx)(z().Z,{size:8,isHidden:!0}),(0,$.jsx)(R().Z,{id:"password",type:"password",value:g,onChange:e=>{m("password",e.target.value)},showClearButton:!0,placeholder:"Enter your password",inputElementAttributes:{minLength:4},style:{...H.inputBox,...x.includes("password")&&H.invalidInput}}),(0,$.jsx)(z().Z,{size:8,isHidden:!0})]}),(0,$.jsx)(z().Z,{size:14,isHidden:!0})]}):(0,$.jsxs)("div",{children:[(0,$.jsxs)("div",{children:[(0,$.jsx)("label",{htmlFor:"APIToken",style:H.inputLabels,children:n}),(0,$.jsx)(z().Z,{size:8,isHidden:!0}),(0,$.jsx)(R().Z,{id:"AccessToken",type:"password",value:h,onChange:e=>{m("token",e.target.value)},showClearButton:!0,placeholder:"Paste your token here",inputElementAttributes:{minLength:4},style:{...H.inputBox,...(M.adminTokenError||x.includes("token"))&&H.invalidInput}}),(0,$.jsx)(z().Z,{size:8,isHidden:!0})]}),(0,$.jsx)(z().Z,{size:14,isHidden:!0})]})})]})}),(0,$.jsxs)("div",{style:{display:"flex",justifyContent:"normal"},children:[(0,$.jsx)(q().Z,{isLarge:!0,disabled:"Basic"===M.authenticationType&&r?!u||!p||!g:!u||!h,onClick:async()=>{await async function(e){const{environment:t,siteValue:n,tokenValue:i,usernameValue:a,passwordValue:s}=e,o=f().ZP.getFlowId(),r=f().ZP.state;(0,A().j)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira-dc",actionType:"auth_initiated",flowId:o}}});const l=T().default.integrations.state.find((e=>e.id===j().Gl));if(!l||!r.spaceId||!t.currentUser.id)return S().vC({message:b().Z.formatMessage(P.pleaseTryAgainMsg),showCancel:!1,keepFocus:!1,items:[{label:b().Z.formatMessage(P.pleaseTryAgainMsg),onAccept:C().yR}]}),void y().log({level:"info",from:"jiraDCAuthActions",type:"authenticateWithJiraDC",data:{message:"Missing required data to authenticate with Jira DC",miscDataToConvertToString:{siteValue:n,userId:t.currentUser.id,spaceId:r.spaceId}}});const d=l.id,c=(0,w().lT)(I().default.domainBaseUrl),u=l.redirect_uris.includes(c)?c:l.redirect_uris[0],h=await Z().callApi({eventName:"createOauthAuthorizationCode",environment:t,data:{integrationId:d,spaceId:r.spaceId,redirectUri:u}});if("failed"===h.type)return S().x2(h),y().log({level:"error",from:"jiraDCAuthActions",type:"authenticateWithJiraDC",data:{message:"Unexpected error creating authorization code",miscDataToConvertToString:{response:h,siteValue:n,userId:t.currentUser.id,spaceId:r.spaceId}}}),(0,A().j)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira-dc",actionType:"auth_status",flowId:o,status:"failed"}}}),{error:`Unexpected error creating authorization code: ${(0,k().p)(h)}`};const p=h.data.code;let g;if(g="Basic"===r.authenticationType?await Z().callApi({eventName:"authenticateJiraDCUser",environment:t,data:{domain:n,userId:t.currentUser.id,spaceId:r.spaceId,notionAuthorizationCode:p,username:a,password:s,authType:"Basic"}}):await Z().callApi({eventName:"authenticateJiraDCUser",environment:t,data:{domain:n,userId:t.currentUser.id,spaceId:r.spaceId,personalAccessToken:i,notionAuthorizationCode:p}}),(0,A().j)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira-dc",actionType:"auth_status",flowId:o,status:"success"===g.type?"success":"failed"}}}),"failed"===g.type||"AUTHENTICATION_FAILED"===g.data.code){const e="failed"===g.type?(0,k().p)(g):P.AuthenticationFailedMsg.defaultMessage;S().vC({message:e,showCancel:!1,keepFocus:!1,items:[{label:b().Z.formatMessage(P.dismissButtonLabel),onAccept:C().yR}]}),y().log({level:"error",from:"jiraDCAuthActions",type:"authenticateWithJiraDC",data:{message:"Failed to authenticate with Jira DC",miscDataToConvertToString:{errorStatus:g.status,siteValue:n,userId:t.currentUser.id,spaceId:r.spaceId}}})}else{y().log({level:"info",from:"jiraDCAuthActions",type:"authenticateWithJiraDC",data:{message:"Authentication with Jira DC is successful",miscDataToConvertToString:{siteValue:n,userId:t.currentUser.id,spaceId:r.spaceId}}}),await D().pJ({environment:t});const e=r.notionState;f().ZP.setState({...f().ZP.state,open:!1,isMemberAuthSuccessForDataCenter:!0,notionState:void 0}),e&&await D().FD({environment:t,notionState:e})}}({environment:B,siteValue:u,tokenValue:h,usernameValue:p,passwordValue:g})},children:(0,$.jsx)(d()._H,{id:"JiraDCAuthentication.authenticateButton.label",defaultMessage:"Authenticate"})}),(0,$.jsx)(K().Z,{isLarge:!0,style:{marginLeft:12},onClick:()=>{v()},children:(0,$.jsx)(d()._H,{id:"JiraDCAuthentication.cancelButton.label",defaultMessage:"Cancel"})})]})]})})}function X(e){var t;const{onSelectOption:n,options:i,currentOption:a}=e,s=null===(t=i.find((e=>{let{key:t}=e;return t===a})))||void 0===t?void 0:t.label,r=(0,o().yK)((e=>({icon:{marginLeft:4,fill:e.lightIconColor,width:16,height:16,padding:"0.5px, 0px, 0px, 0px",gap:10,fontSize:c().JB.UISmall.desktop},dropdownLabel:{font:"SF Pro",fontSize:c().JB.UIRegular.desktop,fontWeight:c().Ue.regular,lineHeight:c().Nv.UISmall.desktop}})),[]);return(0,$.jsx)(_().ZP,{popupType:_().Z4.Popup,placementToOrigin:_().pO.Left,renderOrigin:e=>(0,$.jsxs)(N().Z,{...e,isLarge:!0,style:r.dropdownLabel,disabled:!1,hoveredStyle:{background:"rgba(0, 0, 0, 0)"},children:[s,(0,H().i)(r.icon)]}),render:e=>{const t={menuType:B().o.Popup,width:250,left:50},a=[{key:"settings-item-section",render:e=>(0,$.jsx)(W().Z,{...e}),items:i.map((t=>{let{key:i,label:a}=t;return{key:i,action:()=>{n(i),e.close()},render:e=>(0,$.jsx)(L().Z,{...e,title:a,shouldWrapCaption:!0,right:s===a?(0,$.jsx)("div",{style:{width:14},children:(0,M().e)()}):void 0})}}))}];return(0,$.jsx)(O().Z,{...t,children:(0,$.jsx)(E().Z,{type:E().i.Vertical,sections:a,initialFocus:void 0,style:{position:"relative",alignItems:"flex-end"}})})}})}const ee=function(e){return(0,$.jsx)(Q,{hidePopup:()=>{!function(e){const{key:t,value:n}=e;f().ZP.setState({...f().ZP.state,[t]:n})}({key:"open",value:!1})},site:(0,$.jsxs)(Y().gq,{style:{alignItems:"center",gap:2},children:[(0,$.jsx)(d()._H,{id:"AtlassianApiTokenAuthentication.siteMessage",defaultMessage:"Jira site url"}),(0,$.jsx)(G().Z,{style:{width:300,whiteSpace:"normal"},placement:J().Placement.Right,renderTooltip:()=>(0,$.jsx)(d()._H,{id:"jiraDataCenterAuth.siteHelperText",defaultMessage:"The base URL that is used to access Jira. If you are running on a non-standard port, please provide the input in host:port format"}),render:e=>(0,$.jsx)(V().Z,{ariaLabel:"Jira DC site help text button",disableBackground:!0,icon:U().D,...e})})]}),APIToken:(0,$.jsxs)(Y().gq,{style:{alignItems:"center",gap:2},children:[(0,$.jsx)(d()._H,{id:"AtlassianDCApiTokenAuthentication.apiTokenMessage",defaultMessage:"API token"}),(0,$.jsx)(G().Z,{placement:J().Placement.Right,renderTooltip:()=>(0,$.jsx)(d()._H,{id:"jiraDataCenterAuth.stepsToGetPAT.caption",defaultMessage:"Click to learn how to get personal authentication token from Jira server"}),render:e=>(0,$.jsx)(V().Z,{ariaLabel:"Jira personal access token help text button",onClick:()=>{window.open("https://confluence.atlassian.com/enterprise/using-personal-access-tokens-1026032365.html","_blank")},icon:U().D,...e})})]}),username:(0,$.jsx)(Y().gq,{style:{alignItems:"center",gap:2},children:(0,$.jsx)(d()._H,{id:"AtlassianDCApiTokenAuthentication.usernameMessage",defaultMessage:"Jira username"})}),password:(0,$.jsx)(Y().gq,{style:{alignItems:"center",gap:2},children:(0,$.jsx)(d()._H,{id:"AtlassianDCApiTokenAuthentication.passwordMessage",defaultMessage:"Jira password"})}),jiraDCVersion:(0,$.jsxs)(Y().gq,{style:{alignItems:"center",gap:2},children:[(0,$.jsx)(d()._H,{id:"AtlassianApiTokenAuthentication.DCVersion",defaultMessage:"Jira version"}),(0,$.jsx)(G().Z,{style:{width:300,whiteSpace:"normal"},placement:J().Placement.Right,renderTooltip:()=>(0,$.jsx)(d()._H,{id:"AtlassianApiTokenAuthentication.stepsToGetDCVersion.captions",defaultMessage:"Click to learn how to know the version of DC Server you are running"}),render:e=>(0,$.jsx)(V().Z,{ariaLabel:"Jira DC version help text button",onClick:()=>{window.open("https://community.atlassian.com/t5/Jira-questions/Re-where-can-i-check-jira-version-am-using-how-to-check/qaq-p/664639/comment-id/218177#M218177","_blank")},icon:U().D,...e})})]}),...e})};var te=()=>n(154186),ne=()=>n(573357),ie=()=>n(708518);const ae=(0,d().vU)({headerTitle:{id:"jiraDCAuthModal.header.title",defaultMessage:"Authenticate your account"}});function se(){const e=(0,a().O7)(),t=(0,s().Kw)(f().ZP),{open:n,type:i}=t,o=()=>{const e=f().ZP.getInitialState();f().ZP.setState({...e,open:!1})},r=(0,s().qz)(void 0,v().Z),d=(0,s().Kw)(x().default).currentSpaceStore,c=t.flowId||l().Il(),u=!!i&&!!d&&t.instanceValue!==f().LT.Cloud&&"dc-auth"===t.type;if((0,h().Z)({shouldPreserveTextSelection:n&&u,shouldPreserveBlockSelection:n&&u,shouldRestoreSelection:!0}),!u)return null;const{height:p,width:g}="auth"===i?{width:450,height:"fit-content"}:{width:400,height:"fit-content"};return(0,$.jsx)(ie().Z,{open:n,innerStyle:{width:g,height:p,overflow:"scroll",borderRadius:5,maxHeight:675,minHeight:300,padding:6},render:()=>(0,$.jsx)(ne().Z,{capture:!0,allowEsc:!0,render:()=>(0,$.jsx)(oe,{type:i,handleModalClose:o,environment:e,requestStore:r,spaceStore:d,flowId:c})}),onDismiss:o})}function oe(e){const{environment:t,requestStore:n,spaceStore:a}=e,r=e.flowId||l().Il(),d=(0,s().Kw)(f().ZP);(0,i.useEffect)((()=>{d.flowId||f().ZP.setState({...d,flowId:r})}),[d,r]);const c=(0,o().yK)((e=>({wrapper:{padding:"20px 14px 10px 14px",height:"100%",display:"flex",flexDirection:"column"}})),[]);return(0,$.jsx)("div",{style:c.wrapper,children:(0,$.jsx)(le,{handleModalClose:e.handleModalClose,environment:t,requestStore:n,spaceStore:a,flowId:r})})}function re(e){let{handleModalClose:t,caption:n,title:i}=e;const a=(0,o().yK)((e=>({wrapper:{marginBottom:18},header:{fontWeight:c().Ue.medium,fontSize:17,textAlign:"center",marginTop:8},description:{fontWeight:c().Ue.regular,color:e.mediumTextColor,fontSize:c().JB.UIRegular.desktop,maxHeight:72,textAlign:"center",padding:"0px 68px",marginBottom:24},icon:{height:40,width:40},iconGroup:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gridColumnGap:9,marginBottom:9},arrowRight:{width:20,height:20,opacity:.4,fontWeight:c().Ue.bold,padding:3},notionLogo:{height:40,width:40,color:e.regularIconColor},closeButton:{position:"absolute",top:14,right:14,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:e.buttonHoveredBackground,width:20,height:20},closeButtonHover:{background:e.buttonPressedBackground},closeButtonIcon:{width:14,fill:e.mediumTextColor}})),[]),s=i||ae.headerTitle;return(0,$.jsxs)("div",{style:a.wrapper,children:[(0,$.jsx)(te().Z,{onClick:t,style:a.closeButton,hoveredStyle:a.closeButtonHover,children:(0,g().D)(a.closeButtonIcon)}),(0,$.jsxs)("div",{style:a.iconGroup,children:[(0,$.jsx)("img",{style:a.icon,src:r().Z.images.externalIntegrations.jiraPng,alt:"Jira Icon"}),(0,p().k)(a.arrowRight),(0,m().h)(a.notionLogo)]}),(0,$.jsx)("div",{style:a.header,children:(0,$.jsx)(d()._H,{...s})}),n]})}function le(e){let{environment:t,handleModalClose:n}=e;const[a,o]=(0,i.useState)([]),r=(0,s().Kw)(f().ZP),[l,d]=i.useState({site:r.site||"",token:"",username:"",password:""}),c=(0,s().VK)((()=>(0,u().uY)()),[]);return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(re,{handleModalClose:n}),(0,$.jsx)(ee,{formValues:l,onChange:(e,t)=>{d({...l,[e]:t}),o((t=>t.filter((t=>t!==e))))},invalidFields:a,environment:t,jiraDataCenterBasicAuthEnabled:c})]})}},10271:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(667294),a=()=>n(965903),s=()=>n(127519);const o=function(e){let{shouldPreserveTextSelection:t,shouldPreserveBlockSelection:o,shouldRestoreSelection:r,onClearSelection:l}=e;const d=(0,n(219727).O7)(),c=(0,i.useRef)(t),u=(0,i.useRef)(""),h=(0,i.useRef)({selectionState:null,textSelectionState:null}),p=(0,i.useCallback)((()=>h.current),[]),g=(0,i.useCallback)((()=>{u.current=window.location.href,s().default.hasSelection()&&(h.current.textSelectionState=s().default.cloneState()),n(990966).clear({preventDismissMobileKeyboard:!0,environment:d}),o&&(a().default.isSelected()&&(h.current.selectionState=a().default.cloneState()),n(879952).ZH({preventDismissMobileKeyboard:!0,environment:d}))}),[d,o]),m=(0,i.useCallback)((()=>{h.current={selectionState:null,textSelectionState:null},u.current="",null==l||l()}),[l]),x=(0,i.useCallback)((()=>{const{selectionState:e,textSelectionState:t}=h.current;window.location.href===u.current&&(t&&"mode"in t&&"editing"===t.mode&&s().default.setState({...s().default.state,...t}),o&&e&&a().default.setState({...a().default.state,...e})),m()}),[m,o]);return(0,n(732811).K)((()=>{c.current=t,t&&g()})),(0,i.useEffect)((()=>(c.current&&!t?r?x():m():!c.current&&t&&g(),c.current=t,()=>{r?x():m()})),[t,m,x,g,r]),{clearSavedSelection:m,restoreSavedSelection:x,getSavedSelection:p}}},985481:(e,t,n)=>{n.d(t,{k:()=>a});n(667294);var i=n(785893);const a=(0,n(827282).IU)("arrowRightSmaller",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M15.383 8.352a.877.877 0 01-.274.64l-5.156 5.14a.864.864 0 01-.617.266.831.831 0 01-.602-.234.795.795 0 01-.234-.586c0-.12.02-.232.063-.336a.912.912 0 01.187-.273l1.75-1.766 2.914-2.656.274.5-2.711.156H1.484c-.26 0-.471-.078-.632-.234a.851.851 0 01-.235-.617c0-.256.078-.461.235-.618a.856.856 0 01.632-.242h9.493l2.71.164-.273.508L10.5 5.5 8.75 3.727a.946.946 0 01-.188-.266.917.917 0 01-.062-.344c0-.234.078-.43.234-.586a.831.831 0 01.602-.234.79.79 0 01.328.07c.104.047.203.117.297.211l5.148 5.133a.877.877 0 01.274.64z"})})},965910:(e,t,n)=>{n.d(t,{h:()=>i().h});var i=()=>n(968061)}}]);