"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[53190],{907573:(e,t,o)=>{o.d(t,{BO:()=>y,Ft:()=>g,YG:()=>S,y$:()=>f});o(670560),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(653476),o(30005),o(241792);var n=()=>o(730120),r=()=>o(721927),i=()=>o(803021),l=()=>o(874459),s=()=>o(998411),a=()=>o(530980),c=()=>o(513670),d=()=>o(718959),u=()=>o(412511),p=()=>o(615676),m=()=>o(749826);function g(e){const{collectionContextStore:t}=e,o=t.collectionViewStore();if(!o)return;const n=t.normalizedSchemaStore.state,r=o.getQuery(n);if(!r||!r.calendar_by)return;const i=t.dateRangeStartStore.state,a=t.dateRangeEndStore.state,c=(0,l().hT)(i,(0,s().r)()),d=(0,l().hT)(a,(0,s().r)());return h({calendarBy:r.calendar_by,dateRangeStartDate:c,dateRangeEndDate:d})}function S(e){const{collectionContextStore:t,startOfDay:o}=e,r=t.collectionViewStore();if(!r)return;const i=t.normalizedSchemaStore.state,a=r.getQuery(i);if(!a||!a.calendar_by)return;const c=n().ou.fromMillis(o).endOf("day").valueOf(),d=(0,l().hT)(o,(0,s().r)()),u=(0,l().hT)(c,(0,s().r)());return h({calendarBy:a.calendar_by,dateRangeStartDate:d,dateRangeEndDate:u})}function h(e){const{dateRangeStartDate:t,dateRangeEndDate:o,calendarBy:n}=e;return{type:"results",filter:{operator:"and",filters:[{property:n,filter:{operator:"date_is_on_or_after",use_end:!0,value:{type:"exact",value:t}}},{property:n,filter:{operator:"date_is_on_or_before",value:{type:"exact",value:o}}}]},limit:5e3}}function f(e){var t;const{collectionContextStore:o,results:n,getRecordValue:r,intl:a,formulasModule:p}=e,m=o.collectionViewStore(),g=o.normalizedQueryStore.state,S=o.normalizedSchemaStore.state,h=g?g.calendar_by:void 0,f=o.dateRangeStartStore.state,x=o.dateRangeEndStore.state,b=(null===(t=o.collectionViewStore())||void 0===t?void 0:t.getFormat().calendar_show_weekends)??!0,C=d().AK.state,w=(0,s().r)(),k=o.getCurrentUserId();if(!(m&&g&&h&&S))return;const V=new Map,T=new Map,j=c().oA(n.map((e=>y({blockStore:e,calendarBy:h,schema:S,getRecordValue:r,userId:k,intl:a,resultCache:V,regExpCache:T,formulasModule:p})))),R={};n.forEach(((e,t)=>{R[e.id]=t}));0===(g.sort||[]).length&&j.sort(((e,t)=>{const o=e.start.valueOf(),n=t.start.valueOf();if(o===n){return R[e.id]-R[t.id]}return o-n}));const P=b?(0,l().em)(f,C,w):(0,l().Ty)(f,C,w),I=b?(0,l().gQ)(x,C,w):(0,l().Kw)(x,C,w);let _=P;const M=[];do{const e=b?(0,l().gQ)(_.valueOf(),C,w):(0,l().Kw)(_.valueOf(),C,w),t={},o=j.filter((t=>(0,i().b8)(_.valueOf(),e.valueOf(),t.start.valueOf(),t.end?t.end.valueOf():void 0))).map((o=>{const{id:n,start:r,end:i,includeTime:l,timeZone:s}=o,{startColumn:a,columnCount:c}=(0,u().du)({startUnixTimestampMS:r.valueOf(),endUnixTimestampMS:i?i.valueOf():void 0,startOfWeekUnixTimestampMS:_.valueOf(),endOfWeekUnixTimestampMS:e.valueOf()}),d=v(a,c,t);return{id:n,start:r.valueOf(),end:i?i.valueOf():void 0,row:d,includeTime:l,timeZone:s}}));M.push({start:_.valueOf(),end:e.valueOf(),items:o}),_=b?(0,l().em)(_.plus({week:1}).plus({hour:25}).valueOf(),C,w):(0,l().Ty)(_.plus({week:1}).plus({hour:25}).valueOf(),C,w)}while(_<I);return M}function y(e){const{blockStore:t,calendarBy:o,schema:n,getRecordValue:i,intl:c,userId:d,resultCache:u,regExpCache:g,formulasModule:S}=e,h=t.getAssociatedCollectionStore(),f=t.getModel();if(!f)return;const y=(0,r().FT)({property:o,schema:n,block:f,getRecordModel:a().omK.fromGetRecordValueFn(i),propertyMapping:null==h?void 0:h.getPropertyMapping(),collectionRequestContext:{userId:d,userTimeZone:(0,s().r)(),depth:0,intl:c,visitedProperties:new Set,resultCache:u,regExpCache:g,experimentService:m().default,collectionFeatureGates:(0,p().W)()},formulasModule:S}).next().value;if("date"!==(null==y?void 0:y.type))return;const v=y.value;if(!v)return;const x=(0,l().NK)(v,(0,s().r)());if(!x)return;return{id:f.id,start:x.start,end:x.end,includeTime:"datetime"===v.type||"datetimerange"===v.type,timeZone:"datetime"===v.type||"datetimerange"===v.type?v.time_zone:void 0}}function v(e,t,o){let n=0;for(;;){let r=!1;for(let i=0;i<t;i++)x(o,e+i,n)&&(r=!0);if(!r)break;n++}for(let r=0;r<t;r++)b(o,e+r,n);return n}function x(e,t,o){return Boolean(e[o]&&e[o][t])}function b(e,t,o){e[o]||(e[o]={}),e[o][t]=!0}(0,o(788860).vU)({week:{defaultMessage:"Week",id:"calendar.viewRanges.week"},month:{defaultMessage:"Month",id:"calendar.viewRanges.month"}})},5317:(e,t,o)=>{o.d(t,{Z:()=>g});o(667294);var n=()=>o(219727),r=()=>o(846550),i=()=>o(788860),l=()=>o(250303),s=()=>o(269299),a=()=>o(827973),c=()=>o(663631),d=()=>o(677559),u=()=>o(909679),p=()=>o(688725),m=o(785893);function g(e){const{collectionContextStore:t,onClose:o,focused:g,isCompact:S}=e,h=(0,n().O7)(),{value:f}=(0,d().XJ)(p().formsEditorDependency),y=(0,r().yK)((e=>({newFormButton:{color:e.mediumTextColor,display:"flex",flexDirection:"row"}})),[]);function v(){s().createAndCommit({userAction:"CollectionViewTabBar.createGenericViewType",environment:h,canUndo:!0,perform:e=>{f&&f.formEditorActions.createAndFocusCollectionFormEditorView({environment:h,collectionContextStore:t,transaction:e})}}),o(),l().xb({environment:h,collectionContextStore:t,view_type:"form_editor"})}if(!f)return null;const x=(0,m.jsx)(a().Z,{focused:g,onClick:v,title:(0,m.jsxs)("div",{style:y.newFormButton,children:[(0,m.jsx)(i()._H,{defaultMessage:"New form",id:"database.collectionViewSelect.newFormButtonTitle"}),(0,m.jsx)(c().Z,{})]}),style:{padding:"1 0"},icon:(0,u().E)({width:14,fill:y.newFormButton.color,marginRight:2})}),b=(0,m.jsx)(a().Z,{focused:g,onClick:v,title:(0,m.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,m.jsx)(i()._H,{defaultMessage:"Form",id:"CollectionViewTabBar.newFormItem.title"}),(0,m.jsx)(c().Z,{})]}),icon:(0,u().E)({width:16}),shouldWrapCaption:!0,caption:(0,m.jsx)(i()._H,{defaultMessage:"Create a form to input data directly into this database",id:"CollectionViewTabBar.newFormItem.description"})});return S?x:b}},23862:(e,t,o)=>{o.d(t,{h:()=>c});o(241792),o(667294);var n=()=>o(142735),r=()=>o(513670),i=()=>o(717940),l=()=>o(125659),s=()=>o(729201),a=o(785893);function c(e){const{isFullScreen:t,hasGroups:o,hasPartialResults:c,hasSearchQuery:d,overrideNumShimmerRows:u}=e,p=(0,l().DK)(),m=(0,n().VK)((()=>null==p?void 0:p.isInHomeWidgetStore.state),[p]);if(!(0,s().Z)(!0,0,100))return null;let g=1;void 0!==u?g=u:o||c||d||(g=t?10:3);const S=g>1?["50%","30%","40%","40%","30%","30%","40%","40%","30%","30%"]:["35%"],h=r().DZ(g).map((e=>(0,a.jsx)(i().G,{isInHomeWidget:m,widthPercentage:e<S.length?S[e]:void 0},e)));return(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginLeft:m?8:3},children:h})}},94130:(e,t,o)=>{o.d(t,{m:()=>s});var n=()=>o(250303),r=()=>o(497065),i=()=>o(250625),l=()=>o(887430);function s(e){const{environment:t,collectionContextStore:o,event:s,buttonPopupParent:a}=e,c=(0,l().ay)(o);if(!c)return null;const d=i().DJ(s);r().c4({environment:t,url:c,openInNew:d}),d||null==a||a.close(),n().wd({environment:t,collectionContextStore:o,action:"click_source_view"})}},672526:(e,t,o)=>{o.d(t,{a:()=>a});o(667294);var n=()=>o(219727),r=()=>o(138555),i=()=>o(448419),l=()=>o(998901),s=o(785893);function a(e){let{collectionContextStore:t,groupFormat:o,renderLinkButton:a,onAddOrLink:c,...d}=e;const u=(0,n().Fy)();return(0,s.jsx)(i().ZP,{popupType:u.isMobile?i().Z4.BottomSheet:i().Z4.Popup,alignmentToOrigin:l().Alignment.Start,disableFlippingPlacement:!0,...d,renderOrigin:a,render:e=>(0,s.jsx)(r().mN,{collectionContextStore:t,groupFormat:o,onClose:()=>e.close(),onAddOrLink:c})})}},894704:(e,t,o)=>{o.d(t,{x:()=>Y,Z:()=>z});var n=o(667294),r=()=>o(219727),i=()=>o(142735),l=()=>o(846550),s=()=>o(788860),a=()=>o(513670),c=()=>o(707513),d=()=>o(250303),u=()=>o(421654),p=()=>o(636340),m=()=>o(879952),g=()=>o(990966),S=()=>o(269299),h=o(785893);const f=function(e){const{store:t,titleStyle:n,actionButton:r}=e,l=(0,i().VK)((()=>t.getParentBlockStore()),[t]);return(0,h.jsx)("div",{children:(0,h.jsxs)("div",{style:{display:"flex"},children:[(0,h.jsx)(o(732388).v,{step:"demo_collection",store:l,children:(0,h.jsx)(o(384241).Z,{store:t,style:n})}),r]})})};var y=()=>o(628370),v=()=>o(827973),x=()=>o(448419),b=()=>o(1910),C=()=>o(729775),w=()=>o(198829),k=()=>o(255577),V=()=>o(967092),T=()=>o(943620),j=()=>o(388284),R=()=>o(345837),P=()=>o(473244),I=()=>o(12512),_=()=>o(352230),M=()=>o(550054),B=()=>o(338217),F=()=>o(314379),K=()=>o(681245),O=()=>o(965913),L=()=>o(953293),D=()=>o(94130),E=()=>o(887430),A=()=>o(583632);const H=22;function Z(e){let{store:t,collectionContextStore:n,isFullScreen:l,canEdit:s,showHoverActionsStore:a}=e;const c=(0,r().O7)(),d=(0,i().VK)((()=>{const e=o(482162).default.state;return(0,E().Ks)(t)||!(0,o(942226).wq)(t)&&e.open&&e.isClosing}),[t]),u=(0,i().VK)((()=>n.collectionStore()),[n]),p=(0,i().VK)((()=>n.collectionViewBlockStore()),[n]),m=(0,i().VK)((()=>Boolean(null==u?void 0:u.isSyncedCollection())),[u]),{WindowSizeStore:g}=c,S=(0,i().VK)((()=>Math.min(o(191586).zL,g.state.width)),[g]);return u&&p?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{style:{...(l||d)&&(0,o(275200).eA)(c)&&{position:"sticky",left:0},paddingTop:8,boxSizing:d?"content-box":void 0,width:d?S:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,h.jsx)(Y,{collectionContextStore:n,showHoverActionsStore:a}),m&&(0,h.jsx)("div",{style:{display:"flex"},children:(0,h.jsx)(o(989560).Z,{canEdit:s,store:p,buttonStyle:{margin:0}})})]}),(0,h.jsx)(o(160740).Z,{collectionStore:u,collectionContextStore:n}),(0,h.jsx)(o(986286).yY,{store:u})]}):null}const z=n.memo(Z);function G(e){return{fontWeight:c().Ue.bold,fontSize:22,...e?{}:{display:"-webkit-box",lineClamp:1,WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden"}}}function W(e,t){return{width:24,height:t?24:16,fill:e.regularIconColor}}function N(e){let{parent:t,collectionContextStore:o}=e;const n=(0,l().Fg)(),c=(0,r().O7)(),p=(0,r().Fy)(),m=(0,i().Kw)(o.permissionScopesStore),f=(0,i().VK)((()=>o.collectionStore()),[o]),y=(0,i().VK)((()=>null==f?void 0:f.isSyncedCollection()),[f]),x=(0,i().VK)((()=>Boolean(null==f?void 0:f.isSystemCollection())),[f]);if(!f)return null;const b=a().oA([!x&&{key:"view",render:e=>(0,h.jsx)(v().Z,{...e,title:(0,h.jsx)(s()._H,{id:"database.source.viewDatabase.title",defaultMessage:"View database"}),icon:(0,B().J)(W(n))}),action:e=>{(0,D().m)({environment:c,collectionContextStore:o,event:e.event,buttonPopupParent:t})}},m.canConfigureCollection&&!y&&{key:"edit_name",render:e=>(0,h.jsx)(v().Z,{...e,title:(0,h.jsx)(s()._H,{id:"database.source.editTitle.title",defaultMessage:"Edit database title"}),icon:(0,L().R)(W(n))}),action:()=>{g().selectAllText({environment:c,store:f.getNameStore(),canSelectAllBlocks:!1}),t.close(),d().wd({environment:c,collectionContextStore:o,action:"click_source_edit_title"})}}]),C={key:"show_title",render:e=>(0,h.jsx)(v().Z,{...e,icon:(0,K().D)(W(n,!0)),title:(0,h.jsx)(s()._H,{id:"database.source.hideTitle.title",defaultMessage:"Hide database title"})}),action:()=>{const e=o.collectionViewStore();if(!e)return null;S().createAndCommit({userAction:"CollectionViewBlockSource.showTitleItem",environment:c,canUndo:!0,perform:t=>{u().FH({stores:[e],update:{hide_linked_collection_name:!0},transaction:t})}}),t.close(),d().wd({environment:c,collectionContextStore:o,action:"click_source_hide_title"})}};return(0,h.jsx)(w().Z,{menuType:p.isMobile?_().o.ActionSheet:_().o.Popup,children:(0,h.jsx)(k().Z,{type:k().i.Vertical,onAccept:t.close,sections:a().oA([b.length>0&&{key:"actions",render:e=>(0,h.jsx)(j().Z,{...e}),items:b},m.canConfigureBlock&&{key:"show_title",render:e=>(0,h.jsx)(j().Z,{...e,topBorder:!0}),items:[C]}]),initialFocus:void 0})})}function U(e){let{showHoverActionsStore:t,collectionContextStore:o}=e;const n=(0,r().O7)(),l=(0,i().Kw)(t);return(0,h.jsx)(y().Z,{visible:l,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center",marginLeft:4},children:(0,h.jsx)(x().ZP,{popupType:n.device.isMobile?V().kQ.SlideUp:V().kQ.Popup,render:e=>(0,h.jsx)(N,{parent:e,collectionContextStore:o}),renderOrigin:e=>(0,h.jsx)(b().Z,{icon:F().o,...e}),style:{width:240},originGap:4})})}function $(e){m().ZH({environment:e})}function q(e){let{disabled:t,collectionContextStore:o}=e;const n=(0,l().Fg)(),s=(0,r().O7)(),a=(0,i().VK)((()=>o.collectionStore()),[o]),c=(0,i().VK)((()=>o.collectionViewBlockStore()),[o]),d=(0,i().VK)((()=>null==a?void 0:a.getIcon()),[a]),u=(0,i().VK)((()=>{var e;return Boolean((null==a||null===(e=a.getParentBlockStore())||void 0===e?void 0:e.id)===(null==c?void 0:c.id))}),[a,c]),m=(0,i().VK)((()=>null==c?void 0:c.getType()),[c]),g=(0,l().yK)((e=>({iconStyle:{width:H,height:H,marginRight:4}})),[]);return a&&c?d?(0,h.jsxs)("div",{style:{position:"relative",width:H+2,height:H+2,marginRight:4},children:[t?(0,h.jsx)(T().Z,{disabled:!0,bucket:"secure",store:a,icon:d,isEmptyPage:!1,style:g.iconStyle,size:H}):(0,h.jsx)(T().Z,{disabled:!1,bucket:"secure",store:a,icon:d,isEmptyPage:!1,style:g.iconStyle,size:H,iconLoggingData:{recordTable:a.table,source:"inline_collection",block_type:m,collection_id:a.id},onChange:e=>function(e,t,o){const n=o.collectionStore();if(!n)return;const r=n&&n.getIconStore();r&&S().createAndCommit({userAction:"CollectionViewBlockSource.handleRecordIconChange",environment:t,canUndo:!0,perform:t=>{p().sO({store:r,value:e,transaction:t})}})}(e,s,o)}),!u&&(0,O().Y)({position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===n.mode?n.regularTextColor:"#3E3C38",stroke:"dark"===n.mode?n.surface.wash:"white",strokeWidth:"dark"===n.mode?"1.85px":"1.5px"})]}):u?null:(0,h.jsx)("div",{style:{width:20,marginRight:4},children:(0,B().J)({width:20})}):null}function Y(e){let{collectionContextStore:t,showHoverActionsStore:o,titleStyle:n}=e;const[r,l,s]=(0,i().VK)((()=>[t.collectionStore(),t.collectionViewBlockStore(),t.permissionScopesStore.state]),[t]),a=(0,i().VK)((()=>r&&(0,P().AO)(r.inMemoryRecordCache)),[r]),d=(0,i().VK)((()=>t.viewsModuleContextStore.isInLayoutBuilder()),[t]),u=(0,i().VK)((()=>{const e=t.collectionStore();if(!e)return!1;const o=e.getNameStore();return Boolean((0,M().J5)(o))}),[t]),p=(0,i().VK)((()=>{var e;return Boolean((null==r||null===(e=r.getParentBlockStore())||void 0===e?void 0:e.id)===(null==l?void 0:l.id))}),[r,l]),m=(0,i().VK)((()=>Boolean(null==r?void 0:r.isSyncedCollection())),[r]),g=(p||u)&&s.canConfigureCollection&&!m;return r&&(a||d)?(0,h.jsxs)("div",{style:{width:"max-content",maxWidth:"100%",marginRight:4,display:"flex",alignItems:"center",...c().Yu},children:[(0,h.jsx)(q,{collectionContextStore:t,disabled:!0}),(0,h.jsx)(f,{store:r,titleStyle:{...G(),...n}})]}):g?(0,h.jsx)(X,{collectionContextStore:t,showHoverActionsStore:o,titleStyle:{...G(u),...n}}):(0,h.jsx)(Q,{collectionContextStore:t,showHoverActionsStore:o,titleStyle:{...G(),...n}})}function Q(e){let{collectionContextStore:t,showHoverActionsStore:o,titleStyle:n}=e;const l=(0,r().O7)(),s=(0,i().VK)((()=>t.collectionStore()),[t]),a=(0,i().VK)((()=>t.collectionViewBlockStore()),[t]),u=(0,i().VK)((()=>Boolean(null==s?void 0:s.isSystemCollection())),[s]),p=(0,i().VK)((()=>{if(!u)return(0,E().ay)(t)}),[t,u]);return s&&a?(0,h.jsxs)(C().Z,{disabled:u,style:{width:"max-content",maxWidth:"100%",marginRight:4,...c().Yu},innerStyle:{paddingLeft:4,paddingRight:4,display:"flex",alignItems:"center",borderRadius:4},href:p,onClick:()=>function(e,t){d().wd({environment:e,collectionContextStore:t,action:"click_collection_name_link_button"})}(l,t),children:[(0,h.jsx)(q,{collectionContextStore:t,disabled:!0}),(0,h.jsx)(f,{actionButton:(0,h.jsx)(U,{showHoverActionsStore:o,collectionContextStore:t}),store:s,titleStyle:n})]}):null}function X(e){let{collectionContextStore:t,showHoverActionsStore:o,titleStyle:n}=e;const l=(0,r().O7)(),a=(0,s().YB)(),c=(0,i().VK)((()=>t.collectionStore()),[t]),u=(0,i().VK)((()=>t.collectionViewBlockStore()),[t]),p=(0,i().VK)((()=>null==c?void 0:c.getNameStore()),[c]),m=(0,i().VK)((()=>{var e;return(null==c||null===(e=c.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({intl:a}))||a.formatMessage(A().i.titlePlaceholder)}),[c,a]);return c&&u&&p?(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:4,marginRight:4},children:[(0,h.jsx)(q,{collectionContextStore:t,disabled:!1}),(0,h.jsx)(R().Z,{store:p,style:{...n,marginRight:4},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableMobileActionBar:!1,disableComment:!0,placeholder:m,onEnter:()=>$(l),onEsc:()=>$(l),onClick:()=>function(e,t){d().wd({environment:e,collectionContextStore:t,action:"click_collection_name_input"})}(l,t),disableShiftEnter:!0,pasteBehavior:"inline",inPageFind:I().B3.none},p.id),(0,h.jsx)(U,{showHoverActionsStore:o,collectionContextStore:t})]}):null}},105348:(e,t,o)=>{o.d(t,{Z:()=>V,f:()=>k});o(821057),o(492176),o(7961);var n=o(667294),r=()=>o(219727),i=()=>o(142735),l=()=>o(846550),s=()=>o(492522),a=()=>o(139224),c=()=>o(990966),d=()=>o(765458),u=()=>o(830700),p=()=>o(628370),m=()=>o(573357),g=()=>o(967092),S=()=>o(247724),h=()=>o(347577),f=()=>o(706363),y=()=>o(949842),v=()=>o(164079),x=()=>o(466970),b=()=>o(128119),C=o(785893);function w(e){const{collectionContextStore:t,headerSizeObserver:o,contentSizeObserver:n,paddingRight:a,shouldScrollIntoView:d,settingsOpen:u}=e,g=(0,r().O7)(),h=(0,i().VK)((()=>{const e=o.rect.state;return g.WindowSizeStore.state.height-(e.top+f().LO)}),[g.WindowSizeStore,o.rect]),x=(0,i().VK)((()=>n.rect.state.height),[n.rect]),b=(0,i().VK)((()=>t.isInPeekRendererStore.state),[t.isInPeekRendererStore]),w=(0,i().Kw)(e.headerHeightStore),k=(0,i().VK)((()=>t.allowScrollingWhenCollectionSettingsSidebarOpen()),[t]),V=(0,l().yK)((e=>({topLevelDiv:{position:"absolute",top:w,right:-a,background:b?e.cardContentBackground:e.contentBackground,borderLeft:`1px solid ${e.tableDividerColor}`,paddingRight:a,zIndex:s().Nm,...k?{height:x,minHeight:h}:{height:h}},nestedDiv:{boxShadow:`inset 0 1px 0 ${e.tableDividerColor}`}})),[w,a,b,k,x,h]);return u?(0,C.jsx)(m().Z,{capture:!0,allowMobileAutoScroll:!0,allowUndo:!0,render:e=>(0,C.jsx)(p().Z,{initial:{opacity:0,translateX:12},animate:{opacity:1,translateX:0},exit:{opacity:0,translateX:12},style:V.topLevelDiv,className:S().Dkf,...(0,v().Z)({onMouseDown:e=>function(e,t){(0,y().ZP)({event:e,context:y().Af.EditorMouseDown,callback:()=>{c().clear({environment:t})}})}(e,g)},e),children:(0,C.jsxs)("div",{style:{display:"flex",...k?{height:"fit-content",position:"sticky",top:0}:{height:"100%"}},children:[(0,C.jsx)("div",{style:V.nestedDiv,children:(0,C.jsx)(T,{collectionContextStore:t,shouldScrollIntoView:d,isSidebar:!0})}),(0,C.jsx)("div",{style:{width:a}})]})})}):null}function k(e){const{collectionContextStore:t,placementToOrigin:o,alignmentToOrigin:l,originGap:s,marginTop:c,settingsOpen:d,shouldScrollIntoView:p,originRect:m}=e,f=(0,i().VK)((()=>t.settingsStore.state.stack.at(-1)),[t.settingsStore]),v=(0,r().O7)(),b=(0,n.useCallback)((e=>(0,C.jsx)(T,{collectionContextStore:t,shouldScrollIntoView:p,isSidebar:e})),[t,p]),w=(0,u().o)({collectionContextStore:t}),k=(0,x().E)("mobile_use_bottom_sheet_popup_container");return(0,C.jsx)(g().ZP,{popupType:v.device.isMobile?k?g().kQ.BottomSheet:g().kQ.SlideUp:g().kQ.Popup,bottomSheetInitialState:w?"half":"full",className:`${S().Dkf} ${S().D4r}`,open:d,placementToOrigin:o,alignmentToOrigin:l,style:{marginTop:c,...w&&!k&&{maxHeight:h().DQ,height:h().DQ,position:"inherit"}},origin:(0,C.jsx)("div",{}),originGap:s,render:b,onDismiss:t=>{!function(e,t){(0,y().ZP)({event:e,context:y().Af.CollectionSettingsClick,callback:()=>{a().E3({collectionSettingsStore:t.settingsStore})}})}(t,e.collectionContextStore),"createViewSource"===(null==f?void 0:f.type)&&a().YN({environment:v,collectionContextStore:e.collectionContextStore})},originRect:m,keepFocus:!0,trapFocus:!0,preventScaleTransition:!0,preventOpacityTransition:!0})}const V=function(e){const{collectionContextStore:t,headerSizeObserver:l,contentSizeObserver:s,settingsHeaderSizeObserver:a,placementStore:c,placementToOrigin:d=b().Iw.Bottom,alignmentToOrigin:u=b().lU.Start,marginTop:p=-1,originGap:m,headerRef:g}=e,S=(0,r().O7)(),f=(0,i().Kw)(c),[y,v]=(0,n.useState)(!1),x=(0,i().VK)((()=>t.isInPeekRendererStore.state),[t.isInPeekRendererStore]),V=(0,i().Kw)(t.isFullScreenStore),[T,j]=(0,n.useState)(!1),R=(0,i().VK)((()=>function(e){const t=e.settingsStore.state;return t.open&&!0!==t.hideSettingsPopup}(t)),[t]),P=(0,i().VK)((()=>function(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}(e.collectionContextStore)),[e.collectionContextStore]),I=(0,i().VK)((()=>{const e=l.rect.state;return 0!==e.width?(0,h().GC)(t,S.device.isMobile,e.width):"popup"}),[t,S.device.isMobile,l.rect]);(0,n.useEffect)((()=>{R&&(l.recompute(),a.recompute(),c.setState(I)),R&&!V&&"form_editor"!==P&&v(!0)}),[R,V,c,l,a,P,I]);const _=(0,i().VK)((()=>function(e){var t;return null===(t=e.settingsStore.state.ref)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect()}(t)||DOMRect.fromRect({x:a.rect.state.right-2,y:a.rect.state.y-2,width:0,height:a.rect.state.height})),[t,a.rect]);return(0,n.useEffect)((()=>{if(y){const e=null==g?void 0:g.current;if(e){const t=e.getBoundingClientRect();S.WindowSizeStore.state.height-t.top<o(205951).Lm&&((0,o(275200).Wr)(e,{edgeDist:0,animate:!1}),l.recompute(),a.recompute())}v(!1)}}),[t,S.WindowSizeStore,l,a,x,y,g]),(0,n.useEffect)((()=>{j(!!R)}),[R]),"sidebar"===f?(0,C.jsx)(w,{collectionContextStore:t,headerSizeObserver:l,contentSizeObserver:s,paddingRight:e.paddingRight,shouldScrollIntoView:y,headerHeightStore:e.headerHeightStore,settingsOpen:T,isInPeekRenderer:x}):(0,C.jsx)(k,{collectionContextStore:t,placementToOrigin:d,alignmentToOrigin:u,originGap:m??0,marginTop:p,settingsOpen:T,shouldScrollIntoView:y,originRect:_})};function T(e){let{isSidebar:t,collectionContextStore:o,shouldScrollIntoView:n}=e;return n?null:(0,C.jsx)(d().PJ,{context:h().HV.ViewSettings,collectionContextStore:o,collectionSettingsStore:o.settingsStore,fullHeight:t})}},583632:(e,t,o)=>{o.d(t,{i:()=>n});const n=(0,o(788860).vU)({titlePlaceholder:{defaultMessage:"Untitled",id:"database.source.titlePlaceholder"}})},138555:(e,t,o)=>{o.d(t,{_:()=>s,mN:()=>l,vE:()=>i});var n=()=>o(677559);const r={CollectionNewViewsPopupComponent:new(n().Ss)("CollectionNewViewsPopupComponent",(async()=>await Promise.all([o.e(62743),o.e(90698),o.e(2971),o.e(80741),o.e(72586),o.e(54940),o.e(49396),o.e(98721),o.e(98032),o.e(57229),o.e(63707),o.e(92329),o.e(59822)]).then(o.bind(o,368199)))),CollectionLinkExistingModal:new(n().Ss)("CollectionLinkExistingModal",(async()=>await Promise.all([o.e(62743),o.e(90698),o.e(2971),o.e(80741),o.e(72586),o.e(46616),o.e(54940),o.e(49396),o.e(98721),o.e(98032),o.e(57229),o.e(63707),o.e(91253),o.e(5006),o.e(6612),o.e(73682),o.e(58565),o.e(34291),o.e(9587)]).then(o.bind(o,10053)))),ModalOverlayCollectionView:new(n().Ss)("ModalOverlayCollectionView",(async()=>await o.e(41926).then(o.bind(o,366005))))},i=(0,n().kF)(r.CollectionNewViewsPopupComponent,(e=>e.CollectionNewViewsPopupComponent)),l=(0,n().kF)(r.CollectionLinkExistingModal,(e=>e.CollectionLinkExistingModal)),s=(0,n().kF)(r.ModalOverlayCollectionView,(e=>e.ModalOverlayCollectionView))},775316:(e,t,o)=>{o.d(t,{J:()=>g,ZP:()=>S});o(667294);var n=()=>o(142735),r=()=>o(506347),i=()=>o(788860),l=()=>o(491927),s=()=>o(384667),a=()=>o(47443),c=()=>o(879952),d=()=>o(718959),u=()=>o(949842),p=()=>o(154186),m=o(785893);const g=33;const S=function(e){const{style:t,iconStyle:g,store:S,format:f,collectionContextStore:y,groupsPointer:v,incrementLimitsInRelatedGroups:x,isFullScreen:b}=e,C=(0,o(219727).O7)(),w=(0,n().VK)((()=>y.groupsStore.getGroupState(v)),[y,v]),k=(0,n().VK)((()=>(0,o(57649).$t)({collectionContextStore:y,groupsPointer:v})),[y,v]),V=(0,n().Kw)(y.isInHomeWidgetStore),T=(0,o(846550).yK)((e=>({homeContainer:{display:"flex",alignItems:"center",justifyContent:"center"},button:{display:"flex",alignItems:"center",justifyContent:"center",height:30,borderRadius:6,whiteSpace:"break-spaces",fontSize:14,...V?{textAlign:"center",width:"fit-content",marginLeft:12,marginBottom:0,padding:4}:{},...t},loadingContainer:{marginTop:1,marginLeft:8,marginRight:8},loadingSpinner:{width:12,height:12},icon:{...h(e),...g},text:{color:e.lightTextColor,width:"100%",fontSize:V?14:void 0},hoveredStyle:{...k?{background:e.whiteButtonBackground}:{}}})),[V,t,k,g]),j=(0,n().VK)((()=>S.canEdit()),[S]);return w?V?(0,m.jsx)("div",{style:T.homeContainer,children:(0,m.jsx)(p().Z,{onClick:e=>function(e,t,o){const n=e.metaKey||e.ctrlKey?"tab":void 0,i=(0,d().qG)(o.id)?r().tY.PersonalHomeTileTasks:r().tY.PersonalHomeTileCustomDb;a()._c({environment:t,store:o,pageVisitSource:i,openInNew:n})}(e,C,S),onMouseDown:u().$0,style:T.button,children:(0,m.jsx)("div",{style:T.text,children:(0,m.jsx)(i()._H,{id:"database.viewAllButtonTitle",defaultMessage:"View all"})})})}):(0,m.jsxs)(p().Z,{onClick:e=>function(e,t,o,n,r,i){const a=o.groupsStore.getGroupState(n);if(!a)return;const d=a.reducerResultStore.state;(0,u().Wi)(e),c().ZH({environment:t}),d&&s().ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:i,currentResultCount:d.blockIds.length,groupsPointer:a.groupsPointer,incrementLimitsInRelatedGroups:r}});l().uD(t)}(e,C,y,v,x,b),onMouseDown:u().$0,disabled:k,hoveredStyle:T.hoveredStyle,style:T.button,children:[(0,o(404553).M)(T.icon),(0,m.jsx)("div",{style:T.text,children:(0,m.jsx)(i()._H,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),k?(0,m.jsx)("div",{style:T.loadingContainer,children:(0,m.jsx)(o(312578).Z,{style:T.loadingSpinner})}):j&&(0,m.jsx)(o(269932).Z,{collectionContextStore:y,format:f})]}):null};function h(e){return{width:14,height:14,marginLeft:4,marginRight:6,fill:e.lightIconColor}}},344927:(e,t,o)=>{o.d(t,{E:()=>r});var n=()=>o(635596);class r{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=(e,t,o)=>{let n=!0;this.didEmit||(this.didEmit=!0,n=!1),this.lastValue===t?n=!1:this.lastValue=t,n&&this.onEmit(t,o)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=n().ZP.addListener(this.listenerEventKey,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&n().ZP.removeListener(this.listener,this.environment)}}},501287:(e,t,o)=>{o.r(t),o.d(t,{CollectionViewBlockErrorBoundary:()=>rh,CollectionViewBlockWithErrorBoundary:()=>ih});var n=o(667294),r=(o(267602),o(241792),o(731107),o(228244),()=>o(730120)),i=()=>o(504008),l=()=>o(492788),s=()=>o(219727),a=()=>o(142735),c=()=>o(846550),d=()=>o(263184),u=()=>o(569427),p=()=>o(35980),m=()=>o(183922),g=()=>o(523733),S=()=>o(513670),h=()=>o(696459),f=()=>o(250303),y=()=>o(139224),v=()=>o(82937),x=()=>o(658325),b=()=>o(879952),C=()=>o(990966),w=()=>o(269299),k=()=>o(324877),V=()=>o(932753),T=(o(492176),o(7961),o(470928),o(30005),()=>o(396136)),j=()=>o(491927),R=()=>o(217465),P=()=>o(921995);const I=new(o(41158).D)({key:"notion/async_clipboard_store",namespace:"AsyncClipboardStore",important:!0,trackingType:"necessary"});async function _(e,t){let{lastActionWasCut:o,valuePromise:n}=t;const r=(0,P().tt)(e);I.setState({eventId:r,waitingForCopy:!0,lastActionWasCut:void 0,value:void 0});const i=await n;if(!i)return void I.setState({});const{recordMaps:l,...s}=i;I.setState({eventId:r,waitingForCopy:!1,lastActionWasCut:o,value:{...s,recordMapsJson:F(l)}})}function M(e){const t=I.getState(),o=(0,P().tt)(e);if(!t||!o||t.eventId!==o)return Promise.resolve(void 0);const{waitingForCopy:n,value:r,lastActionWasCut:i}=t;return n?new Promise((e=>{I.addListener(function(e,t){return function o(n){const r=n.getState();if(!r)return void n.removeListener(o);const{waitingForCopy:i,value:l,lastActionWasCut:s}=r;i||r.eventId!==e||(n.removeListener(o),t(l?{lastActionWasCut:s||!1,value:{...l,recordMaps:B(l.recordMapsJson)}}:void 0))}}(o,e))})):r?Promise.resolve({lastActionWasCut:i||!1,value:{...r,recordMaps:B(r.recordMapsJson)}}):Promise.resolve(void 0)}function B(e){return new Map(e.map((e=>{let[t,o]=e;return[t,R().RecordMap.create(o)]})))}function F(e){return[...e.entries()].map((e=>{let[t,o]=e;return[t,o.toJson()]}))}var K=()=>o(959137),O=()=>o(236087),L=()=>o(453999),D=()=>o(94967),E=()=>o(125659),A=()=>o(964433),H=()=>o(542058),Z=()=>o(582835),z=()=>o(148976),G=()=>o(677559),W=()=>o(826955),N=()=>o(965903),U=()=>o(127519),$=o(785893);const q=n.memo((function(){const e=(0,s().O7)(),t=(0,E().Y$)(),{value:r}=(0,G().XJ)(A().p),{value:i}=(0,G().XJ)(H().m),c=(0,a().VK)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.id}),[t]),d=(0,a().VK)((()=>{if(U().default.isEditingStore.state)return!1;const e=N().default.state.stores.at(0),t=null==e?void 0:e.getModel();if(void 0===e||void 0===t)return!1;if(void 0===(0,Z().g0)(e))return!1;const n=(0,o(942275).ky)({block:t,getRecordModel:e.getRecordModel});return void 0!==n&&n.id===c}),[c]),u=n.useCallback((async o=>{(await K().F.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:r});const n=N().default.state.stores;_(o,{lastActionWasCut:!1,valuePromise:Y(e).then((o=>{for(const n of o){var r;j().dh(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:n.id,block_type:n.getType(),isBulk:!0,collection_id:null===(r=t.collectionStore())||void 0===r?void 0:r.id})}const i=o.length>0;for(const s of n){var l;j().dh(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:s.id,block_type:s.getType(),isBulk:i,collection_id:null===(l=t.collectionStore())||void 0===l?void 0:l.id})}return Q({environment:e,subitems:o})}))})}),[t,e,r]),p=n.useCallback((async o=>{(await K().F.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:r});const n=t.collectionStore();if(null!=n&&n.isExternallyImportedAndSyncedCollection()&&(0,z().K6)())return;const i=N().default.state.stores,l=Y(e),s=Y(e).then((t=>{for(const n of t)j().dh(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:n.id,block_type:n.getType(),isBulk:!0,collection_id:c});const o=t.length>0;for(const n of i)j().dh(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:n.id,block_type:n.getType(),isBulk:o,collection_id:c});return Q({environment:e,subitems:t})}));await _(o,{lastActionWasCut:!0,valuePromise:s});const a=N().default.getState().stores,d=await l;await O().VP({blocks:a,subitems:d,environment:e,canUndo:!0,skipConfirmation:!0})}),[t,c,e,r]),m=n.useCallback((async n=>{var s,a,d,u;const p=await K().F.clipboardActions.load(),m=await M(n),g=await o(577041).j3.duplicateActions.load();if(I.setState({...I.getState(),lastActionWasCut:!1}),!m){w().createAndCommit({userAction:"CollectionViewKeyboardArea.defaultPaste",environment:e,canUndo:!0,perform:t=>{p.paste({environment:e,event:n,disableEmbedMenu:!0,transaction:t,onPasteFiles:p.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i})}});const t=N().default.state.stores[0];if(void 0===t)return;return void j().dh(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:!1,collection_id:c})}const S=t.collectionViewBlockStore();if(!S)return;const h=t.collectionStore();if(!h)return;if(h.isExternallyImportedAndSyncedCollection()&&(0,z().K6)())return;const{recordMaps:f,subitemFormat:y,childRelationSchema:v,parentRelationSchema:x}=m.value;if(!(f&&y&&v&&x))return;const C=[...f.entries()].map((e=>{let[t]=e;return W().G.createChildStore(h,{table:T().iU,id:t})}));await Promise.all(C.map((e=>e.load())));const k=N().default.getState().stores,V=!(m.lastActionWasCut&&function(e,t){const o=t.map((t=>W().G.createChildStore(e,t.pointer)));if(o.find((e=>!e.isReady)))return!1;return!o.find((e=>e.getAlive()))}(h,C));let R=[],P=Z().JR(t),_=null===(s=P)||void 0===s?void 0:s.parentRelationProperty,B=null===(a=P)||void 0===a?void 0:a.childRelationSchema,F=null===(d=P)||void 0===d?void 0:d.parentRelationSchema,D=null===(u=P)||void 0===u?void 0:u.subitemFormat;const E=t.permissionScopesStore.state.canConfigureCollection;for(const t of C)j().dh(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:m.value.isBulk,collection_id:c});if(w().createAndCommit({userAction:"CollectionViewKeyboardArea.pasteWithSubitems",environment:e,canUndo:!0,perform:l=>{if(!D&&E){O().Bb({transaction:l,collectionContextStore:t,environment:e})&&(P=Z().JR(t),P&&(_=P.parentRelationProperty,B=P.childRelationSchema,F=P.parentRelationSchema,D=P.subitemFormat))}if(!(_&&B&&F&&D))return void p.paste({environment:e,event:n,disableEmbedMenu:!0,transaction:l,onPasteFiles:p.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i});const s=V?O().R2({blocks:C,environment:e,transaction:l,recordMaps:f,migrateSubitemFormat:{from:y,to:D},collectionContextStore:t,originalSubitemSchemas:{subitemRelationSchema:v,parentRelationSchema:x},analyticsFrom:m.lastActionWasCut?"cut":"copy",duplicateActionsModule:g}):O().cI({blocks:C,transaction:l,from:y,to:D,environment:e,originAction:"paste"});!function(e){const{environment:t,selectedBlocks:n,blocksToInsert:r,subitemFormat:i,collectionContextStore:l,transaction:s}=e,a=l.collectionStore();if(!a)return;const c=n.at(-1),d=Z().qb(r,i);if(0===d.length)return;if(c){const e=Z().nK(l,c),n=function(e,t){if(e)return t;if(t.recordStoreUIParentStore instanceof W().G&&t.recordStoreUIParentStore.isPageBlock())return t.recordStoreUIParentStore}(Boolean(null==e?void 0:e.isExpanded),c);d.forEach((e=>{O().Cz({environment:t,blockStore:e,collectionStore:a,subitemFormat:i,transaction:s}),n&&o(531515).hE({environment:t,sourceStore:e,destStore:n,propertyWithInverse:{property:i.inverse,inverse:i.property},transaction:s,position:{type:"after"}})}))}else d.forEach((e=>{O().Cz({environment:t,blockStore:e,collectionStore:a,subitemFormat:i,transaction:s})}))}({environment:e,selectedBlocks:k,blocksToInsert:s,subitemFormat:D,collectionContextStore:t,transaction:l}),L().BM({environment:e,blocksToInsert:s,target:k,transaction:l,replaceEmptyTextBlock:!1,preventSetSelection:!0}),R=s}}),!(_&&B&&F&&D))return;const A=Z().T2({blocks:R,parentRelationProperty:_,parentRelationSchema:F,collectionViewBlockStore:S});l().default.afterNextFlush((()=>{l().default.afterNextFlush((()=>{b().Z5({environment:e,stores:A})}))}))}),[t,c,e,r,i]);return(0,$.jsx)(D().Z,{debugName:`CollectionViewKeyboardArea-${c}`,capture:!0,priority:d?0:-1,onCopy:u,onCut:p,onPaste:m})}));function Y(e){const t=N().default.getState().stores;return O().xr({environment:e,blocks:t})}function Q(e){let{subitems:t,environment:n}=e;const r=N().default.getState().stores,i=r.at(0);if(!i)return;const l=(0,Z().g0)(i);if(!l)return;const s=[...r,...t],a=S().oA(s.map((e=>{const t=o(872308).loadLocalSubtree(n,{blockId:e.id,inMemoryRecordCache:e.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0}).recordMap;return t&&[e.id,t]}))),c=new Map(a),{subitemFormat:d,childRelationSchema:u,parentRelationSchema:p}=l;return{recordMaps:c,subitemFormat:d,childRelationSchema:u,parentRelationSchema:p,isBulk:t.length>0}}var X=()=>o(887430),J=()=>o(954452),ee=()=>o(566937),te=()=>o(939513),oe=()=>o(141735),ne=()=>o(594546),re=()=>o(718959),ie=()=>o(247724),le=()=>o(861026),se=()=>o(706363),ae=()=>o(989134),ce=()=>o(250625),de=()=>o(949842),ue=()=>o(512258),pe=()=>o(154057),me=()=>o(191586),ge=()=>o(138892),Se=()=>o(275200),he=()=>o(480089),fe=()=>o(466970),ye=()=>o(620218),ve=()=>o(284047),xe=()=>o(772529),be=()=>o(170210),Ce=()=>o(589525),we=()=>o(998901),ke=()=>o(529048),Ve=()=>o(505121),Te=()=>o(972776),je=()=>o(749826),Re=()=>o(197666),Pe=()=>o(601952),Ie=()=>o(308939),_e=()=>o(235044),Me=()=>o(842918),Be=()=>o(660293),Fe=()=>o(482162),Ke=()=>o(200936),Oe=()=>o(807230),Le=()=>o(153694),De=()=>o(795910),Ee=()=>o(957042);class Ae{constructor(e,t){this.queuedCollectionEmit=void 0,this.queuedBlockIdsToRefetch=void 0,this.isServerRequestRequired=void 0,this.collectionContextStore=void 0,this.environment=void 0,this.isServerQueryCollectionRequired=(e,t)=>{const o=this.collectionContextStore.isClientModeEnabledStore.state;if(o&&t&&"collectionTypedView"===this.collectionContextStore.contextType)return!0;const n=Boolean(e&&(0,Ee().P9)(De().yd,e)&&e.hasMore);if(o&&!n)return!1;const r=this.collectionContextStore.remoteRequestStore.state;if(!r)return!0;return!!(0,h().qP)(r.loader.reducers||{}).some((e=>{let[t,o]=e;return"results"!==o.type}))||!(e&&(0,Ee().P9)(De().yd,e)&&!e.hasMore)},this.throttledRefetch=(0,o(924665).Z)((e=>this.refetchFromRemote({...e,queuedTimestamp:Date.now()}))),this.processCollectionRefetch=async e=>{const t=this.queuedBlockIdsToRefetch,o=this.isServerRequestRequired;if(this.reset(),o){var n;const o=null===(n=(0,h().Yd)(t))||void 0===n?void 0:n[0],r=t[o];this.throttledRefetch({src:e,trigger:`${o}:${r}`})}t&&await V().fI({environment:this.environment,collectionContextStore:this.collectionContextStore,blockIdToMinimumVersion:t})},this.refetchFromRemote=async e=>{const t=this.collectionContextStore.throttleMsStore.state;await Promise.all([V().dj(this.environment,this.collectionContextStore,e,!1),(0,o(839002).Vs)(t)])},this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={},this.collectionContextStore=e,this.environment=t}reset(){this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={}}addBlockIdToRefetch(e,t){this.queuedBlockIdsToRefetch[e]=Math.max(this.queuedBlockIdsToRefetch[e]??0,t)}async handleCollectionEmit(e){const{src:t,passThroughData:o,shouldQueueCollectionEmit:n,isCollectionTypeChange:r}=e;if((0,Ee().P9)(De().yd,o)&&null!=o&&o.blockIdToVersion&&(0,h().qP)(o.blockIdToVersion).forEach((e=>{let[t,o]=e;return this.addBlockIdToRefetch(t,o)})),this.isServerRequestRequired=this.isServerRequestRequired||this.isServerQueryCollectionRequired(o,r),!n)return await this.processCollectionRefetch(t);this.queuedCollectionEmit=!0}async maybeProcessQueuedCollectionEmit(e){if(this.queuedCollectionEmit)return await this.processCollectionRefetch(e)}}var He=()=>o(58836),Ze=()=>o(573357),ze=()=>o(307369),Ge=()=>o(344927),We=(o(653476),()=>o(926724)),Ne=()=>o(992205),Ue=()=>o(532850),$e=()=>o(492522),qe=()=>o(788860),Ye=()=>o(38562),Qe=()=>o(820185),Xe=()=>o(384667),Je=()=>o(71410),et=()=>o(233417),tt=()=>o(270315);o(670560);function ot(e){let{collectionContextStore:t,property:o,blockStores:n}=e;const r=t.normalizedFormatStore.state.collection_group_by;if((null==r?void 0:r.property)!==o)return;const i=function(e,t){const o=new Map,n=t.groupsStore.getAllGroupStates(),r=(0,S().jV)(e,N().default.state.stores);if(!r.length)return o;for(const i of r){const e=n.find((e=>e.groupUiParentStore===i.getRecordStoreUIParent()));e&&o.set(i,e.resultsStore)}return o}(n,t),l=[];for(const[s,a]of i.entries())a.state.includes(s)||l.push(s);l.length&&b().Af({stores:(0,S().e5)(N().default.state.stores,l)})}var nt=()=>o(527278),rt=()=>o(739479),it=()=>o(955620);class lt extends d().default{getInitialState(){return{textStoresBeingEdited:[]}}getNumberOfTextStoresBeingEdited(){return this.state.textStoresBeingEdited.length}textStoresWithEmptyProperty(e){return this.state.textStoresBeingEdited.filter((t=>{const o=t.getPropertyValue(e);return""===it().QaF(o)}))}}const st=lt;var at=()=>o(279386),ct=()=>o(79555),dt=()=>o(356321),ut=()=>o(628370),pt=()=>o(154186),mt=()=>o(1910),gt=()=>o(654133),St=()=>o(899316);const ht=32;function ft(e){return{boxShadow:`1px 0 0 ${e.regularDividerColor}`,marginRight:1}}const yt=(0,qe().vU)({delete:{id:"CollectionsBulkActionsToolbar.deleteButton.tooltip",defaultMessage:"Delete"}});function vt(e){const t=(0,E().Y$)(),o=(0,a().VK)((()=>t.collectionViewBlockStore()),[t]),{marginLeft:r}=e,i=(0,s().O7)(),l=(0,a().qz)(void 0,st),d=(0,n.useRef)(null),[u,p]=(0,n.useState)(!1),m=(0,a().VK)((()=>N().default.state.stores),[]),g=m.length,S=(0,a().VK)((()=>l.getNumberOfTextStoresBeingEdited()),[l]),h=(0,a().VK)((()=>{var e;return!!(0,X().fk)({environment:i,collectionContextStore:t})&&(!m.some((e=>{var t;return null===(t=e.getAssociatedCollectionStore())||void 0===t?void 0:t.isExternallyImportedAndSyncedCollection()}))&&(S>0||m.length>=1&&(0,X().v_)(m,null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id)))}),[t,i,S,m]),f=(0,n.useRef)(void 0);(0,a().VK)((()=>{const e=re()._H().state;e.isOpen?f.current=e.property:f.current&&ot({collectionContextStore:t,property:f.current,blockStores:m})}),[t,m],{debugName:"cleanUpSelection"});const y=(0,a().VK)((()=>o&&"suggest"!==at().MT.getMode(o)),[o]),v=(0,c().yK)((e=>({inner:{display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:5,background:e.popoverBackground,boxShadow:e.lightBoxShadow,height:ht},outer:{position:"sticky",top:1,left:0+(r??0),zIndex:$e().mJ,visibility:u?"visible":"hidden"},outerLayoutAdjust:{marginBottom:-ht},blockActionMenuButton:{width:30,height:"100%",borderRadius:void 0,borderTopRightRadius:5,borderBottomRightRadius:5},blockActionMenuButtonIcon:{fill:e.regularTextColor},trashButton:{borderRadius:0,height:"100%",border:0,...ft(e),width:28},trashButtonIcon:{width:16},trashButtonIconHovered:{fill:e.accentColors.red[500]}})),[u,r]);return(0,$.jsx)(Je().Z,{capture:h,render:e=>(0,$.jsxs)(ut().Z,{visible:h,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onAnimationEnd:e=>{e||p(!1)},ref:d,...e,style:v.outer,children:[(0,$.jsx)(He().p,{allowSelectionWithin:!1,children:(0,$.jsxs)("div",{style:v.inner,children:[(0,$.jsx)(xt,{selectedItemCount:g,collectionsBulkActionsToolbarStore:l}),(0,$.jsx)(jt,{collectionsBulkActionsToolbarStore:l,selectedItems:m,marginLeft:r,setIsReadyToRender:p,outerContainerRef:d}),y&&(0,$.jsx)(gt().Z,{renderTooltip:()=>(0,$.jsx)("div",{children:nt().Z.formatMessage(yt.delete)}),render:e=>(0,$.jsx)(mt().Z,{...e,ariaLabel:nt().Z.formatMessage(yt.delete),icon:()=>(0,rt().y)(v.trashButtonIcon),style:v.trashButton,hoveredStyle:v.trashButtonIconHovered,hasBackground:!0,isDarkIconColor:!0,showShadow:!0,onClick:async()=>{var e;j().dh(i,{analyticsName:Ye().RE.deleteName.defaultMessage,from:"bulk_actions_toolbar",block_type:"page",collection_id:null===(e=t.collectionStore())||void 0===e?void 0:e.id}),await L().Qw({environment:i,blocks:m,shouldCheckSuggestEdit:!0,overrideRemoveBlockFunc:(e,o)=>{var n,r;(null===(n=e.getAssociatedCollectionStore())||void 0===n?void 0:n.id)===(null===(r=t.collectionStore())||void 0===r?void 0:r.id)&&Xe().Od({store:e,transaction:o})}})}}),placement:we().Placement.Top}),(0,$.jsx)(ct().Z,{store:m[0],fadeIn:!1,style:v.blockActionMenuButton,hoveredStyle:v.blockActionMenuButton,iconStyle:v.blockActionMenuButtonIcon,extraAnalyticsData:{isFromBulkActionsToolbar:!0},isFromCollectionView:!0})]})}),(0,$.jsx)("div",{style:v.outerLayoutAdjust})]})})}function xt(e){const{collectionsBulkActionsToolbarStore:t,selectedItemCount:o}=e,n=(0,s().O7)(),r=(0,a().VK)((()=>t.getNumberOfTextStoresBeingEdited()),[t]),i=(0,a().VK)((()=>r>0?r:Math.max(1,o)),[r,o]),l=(0,c().yK)((e=>({button:{color:e.blueColor,fontSize:14,whiteSpace:"nowrap",height:"100%",alignItems:"center",display:"flex",paddingRight:10,paddingLeft:10,borderTopLeftRadius:5,borderBottomLeftRadius:5,fontVariantNumeric:"tabular-nums",...ft(e)}})),[]);return(0,$.jsx)(pt().Z,{style:l.button,onClick:()=>b().ZH({environment:n}),children:(0,$.jsx)(qe()._H,{id:"SelectedItemCountWidget.numItemsSelected",defaultMessage:"{itemsSelectedCount} selected",values:{itemsSelectedCount:i}})})}const bt=6,Ct=450,wt=2,kt=32,Vt=150,Tt=["title","rollup","formula","button"];function jt(e){const{outerContainerRef:t,collectionsBulkActionsToolbarStore:o,selectedItems:r,marginLeft:i,setIsReadyToRender:l}=e,s=(0,E().Y$)(),c=(0,a().Kw)(s.normalizedSchemaStore),d=(0,n.useRef)(null),u=(0,a().VK)((()=>s.databaseType===We().Fi&&r.some((e=>e.getPropertyValue(Ne().C.MeetingNoteToCalendarEventRelation)))),[s,r]),p=(0,a().VK)((()=>{var e;const t=s.normalizedFormatStore.state;return(null==t||null===(e=t.table_properties)||void 0===e?void 0:e.filter((e=>{const t=s.collectionStore();if((0,Ue().LC)(null==t?void 0:t.getModel(),e.property))return!u;const o=c[e.property];return e.visible&&o&&!Tt.includes(o.type)&&(0,tt().Sb)({propertySchema:o,property:e.property,blockStores:r,collectionSchema:c})})))??[]}),[s,c,r,u]).slice(0,bt),m=(0,n.useRef)([]),[g,h]=(0,n.useState)(bt),[f,y]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{m.current.length>0&&m.current.forEach((e=>{var t;e&&(e.rightEdge=(null===(t=e.element)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect().right)??0)}))}),[m]),function(e){let{outerContainerRef:t,propertyButtonsContainerRef:o,propertyButtonRefs:r,marginLeft:i,setIsReadyToRender:l,setShowIconsOnly:s,setHiddenButtonsIndex:a}=e;(0,n.useEffect)((()=>{const e=S().Ds((()=>{var e,n,c;const d=(null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect().right)??window.innerWidth,u=((null===(n=t.current)||void 0===n?void 0:n.getBoundingClientRect().width)??window.innerWidth)-(i??0),p=(null===(c=o.current)||void 0===c?void 0:c.getBoundingClientRect().left)??0,m=d-Vt;let g=r.current.findIndex((e=>e.rightEdge>m));g=-1!==g?g:bt;let S=r.current.findIndex(((e,t)=>p+t*kt>m));S=-1!==S?S:bt;const h=g<wt||u<=Ct;s(h),a(h?S:g),l(!0)}),150,{maxWait:150,leading:!0,trailing:!1});if(t.current){const o=new ResizeObserver((t=>{e()}));return e(),o.observe(t.current),()=>{o.disconnect()}}}),[i,t,r,o,a,l,s])}({propertyButtonsContainerRef:d,propertyButtonRefs:m,outerContainerRef:t,marginLeft:i,setIsReadyToRender:l,setHiddenButtonsIndex:h,setShowIconsOnly:y}),(0,$.jsx)("div",{ref:d,style:{display:"flex"},children:p.map(((e,t)=>{var r;let i=null===(r=m.current[t])||void 0===r?void 0:r.element;if(!i){const e=n.createRef();m.current[t]={element:e,rightEdge:0},i=e}const l=t>=g;return(0,$.jsx)("div",{ref:i,children:(0,$.jsx)(Rt,{collectionsBulkActionsToolbarStore:o,schema:c,property:e.property,isHidden:l,showIconsOnly:f},e.property)},e.property)}))})}function Rt(e){const{property:t,schema:o,collectionsBulkActionsToolbarStore:r,isHidden:i,showIconsOnly:l}=e,d=(0,E().Y$)(),u=o[t],p=(0,s().O7)(),m=(0,a().VK)((()=>!(d.permissionScopesStore.state.canEditContent||"collectionTypedView"===d.contextType)),[d]),g=(0,c().yK)((e=>({button:{display:i?"none":"flex",paddingLeft:8,paddingRight:8,height:ht,alignItems:"center",...ft(e)}})),[i]),S=(0,n.useRef)(null),h=(0,a().qz)(void 0,et().Z),f=(0,n.useCallback)((async e=>{var o,n;if(!S.current)return;const i=N().default.state.stores;e.stopPropagation(),e.preventDefault();const l=null===(o=S.current)||void 0===o?void 0:o.getBoundingClientRect(),s=i[0].getAssociatedCollectionStore();d&&l&&s&&await Qe().z({environment:p,store:i[0],additionalStores:i.slice(1),property:t,rect:l,format:dt().C.Table,collectionStore:s,blockPropertyValueOverlayStore:re()._H(),collectionContextStore:d,statusSetCheckbox:"checkbox"===(null===(n=d.getPropertyFormat(t))||void 0===n?void 0:n.statusShowAs),mouseStore:h,preventClearSelection:!0,collectionsBulkActionsToolbarStore:r})}),[S,d,p,t,h,r]),y=(0,c().Fg)();return u?(0,$.jsx)(gt().Z,{renderTooltip:()=>u.name,render:e=>(0,$.jsx)(pt().Z,{...e,ariaLabel:u.name,ref:S,style:g.button,disabled:m,onClick:f,children:(0,$.jsx)(St().ZP,{style:{maxWidth:"250px",textOverflow:"ellipsis"},propertySchema:u,hideName:l,showIcon:!0,property:t,iconStyle:{fill:y.regularTextColor}})}),disableTooltip:!l,placement:we().Placement.Top}):null}function Pt(e){let{isFullScreen:t,leftRightPaddingStore:o,leftRightMarginStore:n,overrideViewType:r}=e;const i=(0,s().O7)(),l=(0,E().Y$)(),c=(0,a().VK)((()=>(0,X().fk)({environment:i,collectionContextStore:l,overrideViewType:r})),[i,l,r]),d=(0,a().VK)((()=>{var e;if(!c)return 0;return(t?(null===(e=o.state)||void 0===e?void 0:e.paddingLeft)??0:0)+(n.state.marginLeft??0)}),[c,n,o,t]);return c?(0,$.jsx)(vt,{marginLeft:d}):null}const It=n.memo(Pt);var _t=()=>o(844085),Mt=()=>o(205951),Bt=()=>o(203890),Ft=()=>o(701182),Kt=()=>o(520849),Ot=()=>o(842574);function Lt(e){const{style:t,children:o}=e,n=(0,c().yK)((()=>({scroller:{height:"100%",maxHeight:"inherit",...t}})),[t]);return(0,$.jsx)(Ot().Z,{type:Kt().Z.Y,style:n.scroller,children:o})}const Dt=function(e){let{store:t,children:o,isFullScreen:r,currentViewType:i,isInPeek:l,isInHomeWidget:c,handleEditorClick:d,isRootOrDirectChild:u,leftRightPaddingStore:p,paddingBottom:m,viewSettingsPlacementStore:g,paddingLeft:S,format:f,isMyTasksEmpty:y,isHomeCustomDbEmpty:v,isInFrameWhenSidePeekOpen:x,handleHorizontalScrollerMount:b,handleEditorMouseDown:C,isUnlistedView:w}=e;const V=(0,E().Y$)(),T=(0,s().O7)(),j=(0,a().VK)((()=>function(e){const{environment:t,isFullScreen:o,isInPeek:n,isUnlistedView:r,isSettingsView:i}=e;return r?Kt().Z.All:n?Kt().Z.X:i?Kt().Z.All:o&&(0,Se().eA)(t)?Kt().Z.None:Kt().Z.X}({environment:T,isFullScreen:r,isInPeek:l,isUnlistedView:Boolean(w),isSettingsView:"collectionSettings"===V.contextType})),[w,T,r,l,V]),R=(0,a().VK)((()=>!("collectionSystemView"===V.contextType)&&c&&function(e){switch(e){case"table":case"board":case"gallery":case"list":case"timeline":case"chart":case"page":case"form_editor":case"feed":case"chat":return!0;case"calendar":return!1;default:return(0,h().t1)(e)}}(i)),[V,c,i]),P=(0,a().VK)((()=>k().H2({blockStore:t,isFullScreen:r,environment:T,collectionContextStore:V})),[t,r,T,V]),I=(0,a().VK)((()=>{const e=p.state,o=V.settingsStore.state.open,n=V.isInHomeWidgetStore.state&&V.isEditableHomeCollectionStore.state;return{flexGrow:1,flexShrink:0,...t.isNonEditableState()&&{cursor:"default"},..."timeline"===i&&V.collectionStore()&&!r&&!(0,Ft().fj)({environment:T,format:f,isFullScreen:r,isRootChild:u})&&e&&{marginLeft:e.paddingLeft,marginRight:e.paddingRight,marginBottom:m},...o&&!r&&"sidebar"===g.state&&{minHeight:Mt().Lm},...n?{paddingRight:8,paddingLeft:"list"===i?8:16}:{},...c&&!R?{maxHeight:"inherit"}:{},...y||v||!R?{height:"100%"}:{},...!x||"timeline"===i||c||w?{}:{position:"sticky",left:0,paddingLeft:S,width:(0,Ce().$3)(T)},..."chart"===i&&x&&!c?{paddingLeft:S}:{},..."page"===i?{zIndex:$e().y}:{},...P&&{marginLeft:-Bt().Xx},...w&&{height:Bt().Ze,width:void 0}}}),[p,V,u,t,i,r,T,f,m,g,c,R,y,v,x,S,P,w]),_=(0,a().VK)((()=>l||c?Kt().Z.None:_t().Q7(T)),[T,l,c]),M=(0,n.useCallback)((e=>{d(e,i)}),[d,i]),B=(0,$.jsx)(Ot().Z,{type:j,className:ie().x9t,onMouseDown:C,preventType:_,onClick:M,style:I,ref:b,children:o});return R?(0,$.jsx)(Lt,{style:{..."list"===i?{paddingBottom:8}:"timeline"===i?{paddingBottom:0}:{paddingBottom:16},...c&&"feed"!==i?{paddingTop:12}:{}},children:B}):B};var Et=()=>o(128119);function At(e){let{store:t,leftRightPaddingStore:n,viewSettingsPlacementStore:r,headerHeightStore:i,headerSizeObserver:l,contentSizeObserver:s,settingsHeaderSizeObserver:c,currentViewType:d,isInHomeWidget:u,placementToOrigin:p,alignmentToOrigin:m,headerRef:g}=e;const f=(0,E().DK)(),y=(0,a().VK)((()=>(0,X().Ks)(t)?{paddingLeft:0,paddingRight:0}:n.state),[n,t]),v=(0,a().VK)((()=>null==f?void 0:f.viewsModuleContextStore.isInLayoutBuilder()),[null==f?void 0:f.viewsModuleContextStore]),x="form_editor"===d,b=(0,a().VK)((()=>{var e;if(p)return p;if(!x)return;return!(null==f||!f.settingsStore.state.open)&&(0,h().DE)(["formQuestionCreateSettings","formQuestionEditSettings"],null===(e=(0,S().Ps)(null==f?void 0:f.settingsStore.state.stack))||void 0===e?void 0:e.type)?Et().Iw.Right:Et().Iw.Bottom}),[p,x,null==f?void 0:f.settingsStore]),C=m??(u?Et().lU.End:void 0),w=x?b===Et().Iw.Right?24:12:void 0,k=(0,a().VK)((()=>(null==f?void 0:f.isInlineViewStore.state)&&(null==f?void 0:f.isUnlistedViewStore.state)),[null==f?void 0:f.isInlineViewStore,null==f?void 0:f.isUnlistedViewStore]);return v?null:y&&f?(0,$.jsx)(o(105348).Z,{collectionContextStore:f,headerSizeObserver:l,contentSizeObserver:s,settingsHeaderSizeObserver:c,headerHeightStore:i,placementStore:r,marginTop:k?-10:void 0,placementToOrigin:b,alignmentToOrigin:C,originGap:w,headerRef:g,...y}):null}const Ht=n.memo(At);var Zt=()=>o(707513),zt=()=>o(608352),Gt=()=>o(226413),Wt=()=>o(956057),Nt=()=>o(632314),Ut=()=>o(775316),$t=()=>o(790424),qt=()=>o(577223),Yt=()=>o(998411),Qt=()=>o(308186),Xt=()=>o(67901);var Jt=()=>o(559729),eo=(o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),()=>o(801812)),to=()=>o(426546),oo=()=>o(576868),no=()=>o(404553),ro=()=>o(885610),io=()=>o(54512),lo=()=>o(175113),so=()=>o(909240),ao=()=>o(605890),co=()=>o(419380),uo=()=>o(960562);function po(e){const{store:t,resultProps:o,resultComponent:r,collectionContextStore:i,canDrag:l,canDrop:d,getItemSelectableStyle:u,belowDropZoneMargin:p,analyticsName:m,disabled:g,direction:S,onSelectableEnter:h,disableScrollToRevealHorizontal:f,touchDragOnly:y,isLast:x,groupsPointer:b,toggleButton:C,subitemPath:k,disableSelectable:V,itemSelectableHaloStyle:T,passesFilter:j,onSelectableInsertRow:R,blockPropertyValueOverlayStore:P,dropzoneGap:I}=e,_=(0,s().O7)(),M=(0,a().VK)((()=>t.canEdit()),[t]),B=(0,a().VK)((()=>t.getAssociatedCollectionStore()),[t]),F=(0,a().VK)((()=>"collectionTypedView"===i.contextType),[i]),K=(0,a().VK)((()=>{const e=i.groupsStore.getGroupState(b);return null==e?void 0:e.resultsStore}),[i,b]),O=(0,a().VK)((()=>X().Ts(t)),[t]),L=(0,a().VK)((()=>X().fk({environment:_,collectionContextStore:i})?60:void 0),[i,_]),D=(0,a().VK)((()=>{const e=co().Z.state;return e.isActive&&e.store===t}),[t]),E=(0,a().VK)((()=>!g&&M),[g,M]),A=(0,a().VK)((()=>e.shouldShowHoverMenu&&E),[e.shouldShowHoverMenu,E]),H=S!==yo.Vertical&&d,Z=S!==yo.Vertical&&d,z=S===yo.Vertical&&d,G=(0,a().VK)((()=>{var e;return null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType()}),[i]),W=(0,c().yK)((e=>({haloStyle:{...X().pB(e,O),...("board"===G||"gallery"===G)&&{borderRadius:nl},...T}})),[G,T,O]),N=(0,n.useCallback)((e=>{const{insertStores:o,transaction:n}=e;return B?Xe().$T({environment:_,collectionStore:B,collectionContextStore:i,groupsPointer:b,insertStores:o,store:t,before:!1,transaction:n}):[]}),[B,i,_,b,t]),U=(0,n.useCallback)((e=>{const{insertStores:o,transaction:n}=e;return B?Xe().$T({environment:_,collectionStore:B,collectionContextStore:i,groupsPointer:b,insertStores:o,store:t,before:!0,transaction:n}):[]}),[B,i,_,b,t]),q=(0,n.useCallback)((async e=>{const{droppedDirection:o,duplicate:n}=e;if(!B)return[];const r=ye().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");ye().default.DO_NOT_USE_measureAfterNextFlushLegacy(r,{environment:_,getData:()=>le().yr({collectionContextStore:i,is_native_drop:!1,is_empty:!1})});const l=o!==uo().v.Onto?(0,Jt().F6)({stores:e.droppedStores,collectionContextStore:i}):e.droppedStores;if(0===l.length&&F)return void Qt().UW((0,$.jsx)(qe()._H,{...Jt().nX.unsupportedGroupAction}));const s=await oe().F.formulas.load();w().createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:_,canUndo:!0,perform:e=>{!Xe().by({environment:_,collectionStore:F?void 0:B,targetStore:t,droppedDirection:o,collectionContextStore:i,groupsPointer:b,droppedStores:l,duplicate:n,transaction:e,subitemPath:k,collapsedGroup:!1,formulasModule:s})&&F&&Qt().UW((0,$.jsx)(qe()._H,{...Jt().nX.unsupportedGroupAction}))}})}),[B,i,_,b,F,t,k]),Y=(0,n.useCallback)((async e=>{const{files:o,droppedDirection:n}=e;if(!B)return[];const r=ye().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");ye().default.DO_NOT_USE_measureAfterNextFlushLegacy(r,{environment:_,getData:()=>le().yr({collectionContextStore:i,is_native_drop:!0,is_empty:!1})});const l=await oe().F.formulas.load();w().createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:_,canUndo:!0,perform:e=>{Xe().tQ({environment:_,collectionStore:B,targetStore:t,droppedDirection:n,collectionContextStore:i,groupsPointer:b,files:o,transaction:e,formulasModule:l})}})}),[B,i,_,b,t]),Q=(0,n.useCallback)((e=>o=>{let{transaction:n}=o;if(!B)return[];const r=Xe().yk({environment:_,collectionContextStore:i,groupsPointer:b,store:t,before:"above"===e,collectionStore:B,transaction:n,subitemPath:k,subitemInsertDirection:"below"});if(io().W(_,{...le().Pn(i),type:"page",from:"below"===e?"table_insert_below":"table_insert_above",new_page_id:null==r?void 0:r.id,creating_block_id:null==r?void 0:r.id}),r&&R&&R(t,r),r&&P){const e=()=>{so().bA({isNewBlock:!0,environment:_,blockPropertyValueOverlayStore:P,store:r,property:"title",format:dt().C.Table,collectionContextStore:i})};i.registerCallbackForItemMounted(r,e)}}),[B,P,i,_,b,R,t,k]),J=e.handleOpenPeekPage,ee=(0,n.useCallback)((()=>{const e=i.collectionViewStore();ye().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),J&&J(),v().Xd({collectionContextStore:i,resultsStore:K});const t=null==e?void 0:e.getType();if(t){const e=i.normalizedFormatStore.state.collection_peek_mode,o=e||ao().Ls[t];lo().hy(_,{is_peek:!0,from:t,peek_mode:o})}}),[i,_,J,K]),te=(0,a().VK)((()=>u?u(x):void 0),[u,x]);(0,n.useEffect)((()=>{i.onItemMount(t)}),[t,i]);const ne=n.createElement(r,{handleOpenPeekPage:ee,collectionContextStore:i,...o,store:t,key:t.id,isLast:x,toggleButton:C,subitemPath:k,passesFilter:j});return V?ne:(0,$.jsx)(ze().Z,{style:te,store:t,canSelect:E,shouldShowHalo:!D,shouldForceRenderSelectionHalo:O,haloStyle:W.haloStyle,canDrag:l,canDropBelow:z,canDropLeft:H,canDropRight:Z,canNativeDropBelow:z&&!F,canNativeDropLeft:H&&!F,canNativeDropRight:Z&&!F,canDropOnto:d,canTriggerContextMenu:E,isLastItem:x,showBlockMenuInput:!0,shouldShowHoverMenu:A,shouldShowCommentMenu:!1,onSelectableDrop:q,onNativeDrop:Y,onInsertBelow:N,onInsertAbove:U,onRemove:e=>function(e,t,o,n,r){const{transaction:i}=e;r.length>0&&Xe().BN({store:o,transaction:i,groupsPointer:r,collectionContextStore:n,environment:t});Xe().Od({store:o,transaction:i})}(e,_,t,i,b),canInsertAbove:d,canInsertBelow:d,onInsertRowBelow:Q("below"),onInsertRowAbove:Q("above"),belowDropZoneMargin:p,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:m,shouldShowDropZone:d,dropzoneGap:I,onEnter:h,className:ie().K4T,disableScrollToRevealHorizontal:f,touchDragOnly:y,groupsPointer:b,verticalDropZoneExtraLeftEdgeOffset:L,children:ne})}const mo=n.memo(po,Nt().Z);var go=()=>o(167705);function So(e){const{store:t,collectionContextStore:r,subitemPath:i,titleColumnIndex:l,nestedCreateSubitemButton:d,getItemSelectableStyle:u}=e,p=(0,s().O7)(),{isMobile:m}=(0,s().Fy)(),g=(0,c().Fg)(),{currentSubitemFormatStoreForUiDisplayStore:h,subitemExpandedStore:f,subitemTreeStore:y}=r,v=(0,a().VK)((()=>X().Bm({store:t,collectionContextStore:r})),[r,t]),x=(0,a().VK)((()=>{var e;return null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType()}),[r]),{value:C}=(0,G().XJ)(oe().F.formulas),w=(0,a().VK)((()=>i&&i.length>0?i:(0,to().DY)(y.state.children,(e=>e.value.store===t))),[i,y,t],{useDeepEqual:!0}),k=(0,n.useMemo)((()=>w?(0,Z().Af)(w.map((e=>e.value.store))):""),[w]),V=(0,a().VK)((()=>f.state.get(k)),[f,k]),T=Boolean(null==V?void 0:V.isExpanded),R=(0,a().Kw)(h),P=(0,a().VK)((()=>{if(!v||!R)return;const e=v.getSchema()[R.property];return void 0!==e&&(0,Gt().p_)(e)?e:void 0}),[v,R]),I=(0,a().VK)((()=>{var e;return P&&"relation"===P.type&&(0,Gt().F0)(P)===(null===(e=r.collectionStore())||void 0===e?void 0:e.id)&&P.property}),[r,P]),_=(0,a().VK)((()=>{const e=!I||x&&(0,Z().Av)(x)?void 0:{property:I,filter:{operator:"is_empty"}};return!(!R||!v)&&(0,Z().kC)({store:t,collectionStore:v,subitemFormat:R,subitemPathKey:k,collectionContextStore:r,propertyFilters:[...e&&I?[{id:I,filter:e}]:[],...r.currentPropertyFiltersStore.state],combinatorFilter:r.currentCombinatorFilterStore.state,currentUserId:p.currentUser.id,resultCache:new Map,regExpCache:new Map,formulasModule:C}).length>0}),[r,x,p.currentUser.id,I,v,k,t,R,C]),M=(0,a().VK)((()=>!(!v||!R)&&(_||T||m||"timeline"===x)),[v,R,_,T,m,x]),B=(0,a().VK)((()=>!(!v||!R)&&ro().Z.getState().hoveredStore===t),[v,t,R]),F=(0,a().VK)((()=>{const e=(0,oo().m1)({collectionContextStore:r,collectionStore:v,environment:p});if(e)return(0,o(455947).q)(e)}),[r,v,p]),K=(0,n.useCallback)((()=>{const e=f.state;if(T){e.delete(k);const o=N().default.state.stores.filter((e=>t.uiContains(e)));o.length>0&&b().Af({stores:(0,S().e5)(N().default.state.stores,o)}),j().a_(p,{...(0,le().Pn)(r),depth:(null==w?void 0:w.length)||0}),f.emit()}else e.set(k,{isExpanded:!0,limit:20}),j()._k(p,{...(0,le().Pn)(r),depth:(null==w?void 0:w.length)||0}),F&&e&&P&&R?(0,Z().fd)({blockStore:t,subitemExpandedStore:f,subitemFormat:R,propertySchema:P,compiledFilter:F,pathKey:k,forceStoresToLoad:!1,visitedIds:new Set,resultCache:new Map,regExpCache:new Map}).then((()=>{f.emit()})):f.emit()}),[f,T,k,p,r,null==w?void 0:w.length,t,F,P,R]),O=(0,a().VK)((()=>{const o=y.state;return o&&w&&o.children.length>0?(0,Z().Ns)(o).value.store===t:e.isLast}),[y,e.isLast,t,w]),L=(0,o(817606)._)(),D=(0,a().VK)((()=>{var e;const o=t.getModel();if(!F||!o)return!0;const n=null===(e=t.getAssociatedCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return F({block:o,getRecordModel:t.getRecordModel,propertyMapping:n,formulaTimeoutTimestampMs:Date.now()+L,resultCache:new Map,regExpCache:new Map,experimentService:je().default,formulasModule:C})}),[t,F,L,C]),E=(0,a().VK)((()=>u&&!D?()=>({...u?u(O):{},...D?{}:{opacity:.5}}):u),[u,D,O]);(0,eo().r5)((async()=>{const e=t.getModel();await t.load();const o=t.getRecordModel;if(!M||!e||!F||!P||!o||!R||D)return;(0,Z().xb)({store:t,subitemFormat:R,propertySchema:P}).length>0||(await(0,Z().fd)({blockStore:t,subitemExpandedStore:f,subitemFormat:R,propertySchema:P,compiledFilter:F,pathKey:k,forceStoresToLoad:!0,visitedIds:new Set,resultCache:new Map,regExpCache:new Map}),f.emit())}),[M,F,D,k,t,f,R,P]);const A=(0,$.jsx)(mo,{...e,passesFilter:D,isLast:O,getItemSelectableStyle:E,subitemPath:w,toggleButton:M||B?(0,$.jsx)(go().Z,{isSidebar:!1,open:T,fill:!0,onClick:K,color:_||T?g.regularIconColor:g.mediumIconColor,disabled:w&&w.length>=Z().F0}):void 0});if(!T||!w||0===w.length||w.length>=Z().F0)return A;const H=w[w.length-1].children;return(0,$.jsxs)($.Fragment,{children:[A,H.map((t=>{const o=t.value.store;return(0,n.createElement)(fo,{...e,key:o.id,store:o,subitemPath:[...w,t]})})),v&&d&&d({store:t,parentStore:v,subitemPath:w,indentLevel:w.length,titleColumnIndex:l}),V&&H.length>0&&H.length===V.limit&&(0,$.jsx)(ho,{collectionContextStore:e.collectionContextStore,pathKey:k,titleColumnIndex:l,limit:V.limit,indentLevel:w.length})]})}const ho=n.memo((function(e){const{collectionContextStore:t,pathKey:o,titleColumnIndex:r,limit:i,indentLevel:l}=e,s=(0,n.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:i+20}),e.emit()}),[t,i,o]),d=(0,a().VK)((()=>{var e;return"title"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[t]),u=(0,c().yK)((e=>({button:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:(0,k().lZ)({columnIndex:0,titleColumnIndex:r,indentLevel:l,isSubitemToggleOnTitleColumn:d}),fontSize:14,lineHeight:Zt().Nv.UIRegular.desktop,borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,background:e.cardContentBackground},icon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},label:{color:e.lightTextColor}})),[r,l,d]);return(0,$.jsxs)(pt().Z,{onClick:s,onMouseDown:de().$0,style:u.button,children:[(0,no().M)(u.icon),(0,$.jsx)("span",{style:u.label,children:(0,$.jsx)(qe()._H,{defaultMessage:"Load more",id:"database.loadMoreButtonTitle"})})]})})),fo=n.memo(So);let yo=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});function vo(e){const{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,disableRequest:l,onSelectableEnter:c,canDrop:d,canDrag:u,groupsPointer:p,loadContentCover:m,emptyDroppableSize:g,emptyDroppableStyle:h,virtualizeResults:f}=e,y=(0,s().O7)(),v=(0,fe().E)("drag_respects_relation_limits"),x=(0,a().VK)((()=>t.collectionViewBlockStore()),[t]),b=(0,n.useMemo)((()=>{if(x)return new(W().G)(y,x.pointer)}),[x,y]),C=(0,a().VK)((()=>{const e=t.groupsStore.getGroupState(p);if(!e)return;const o=e.currentLimit.state,n=t.normalizedSchemaStore.state,r=S().oA(p.map((e=>(0,qt().Ko)({schema:n,propertyMapping:void 0,groupBy:t.getGroupByAndGroupFormats().groupBy,group:e,timeZone:(0,Yt().r)(),experimentService:je().default}))));return{type:"results",filter:r.length>0?{operator:"and",filters:r}:void 0,limit:o,loadContentCover:m}}),[t,p,m]),w=(0,a().VK)((()=>{if(t.shouldDelayRenderStore.state)return[];const e=t.groupsStore.getGroupState(p);return(null==e?void 0:e.resultsStore.state)??[]}),[t.groupsStore,t.shouldDelayRenderStore,p]),k=(0,a().VK)((()=>"collectionTypedView"===t.contextType?void 0:t.collectionStore()),[t]),V=(0,a().VK)((()=>{if(!v)return!1;const e=t.normalizedSchemaStore.state;return p.some((t=>{const o=e[t.property];if("relation"===(null==o?void 0:o.type)&&null!=o&&o.property){const t=e[o.property];if("relation"===(null==t?void 0:t.type)&&1===t.limit)return!0}return!1}))}),[t,p,v]),T=i===yo.Vertical;var j;w.length>0&&(null===(j=t.databaseItemsVisibleTracker)||void 0===j||j.handleItemsRenderStart());(0,n.useEffect)((()=>t.renderEmitter.emit()));const R=g||void 0;return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("div",{style:{...T?{height:R}:{width:R},...h},children:(0,$.jsx)(bo,{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,canDrop:d,groupsPointer:p,instanceCollectionViewBlockStore:b,resultStores:w,droppedIntoCollectionStore:k,onSelectableEnter:c})}),f?(0,$.jsx)(wo,{collectionContextStore:t,groupsPointer:p,resultComponentProps:{...e,canDrag:u&&!V}}):w.map(((t,o,n)=>(0,$.jsx)(Vo,{store:t,isLast:o===n.length-1,...e,canDrag:u&&!V},t.id))),(0,$.jsx)(To,{collectionContextStore:t,groupsPointer:p,disableRequest:l,resultsReducer:C})]})}const xo=n.memo(vo);function bo(e){const{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,onSelectableEnter:l,canDrop:c,groupsPointer:d,instanceCollectionViewBlockStore:u,resultStores:p,droppedIntoCollectionStore:m}=e,g=(0,s().O7)(),S=(0,a().VK)((()=>"collectionTypedView"===t.contextType),[t]),h=(0,a().Kw)(t.isInHomeWidgetStore),f=(0,a().VK)((()=>X().fk({environment:g,collectionContextStore:t})?60:void 0),[t,g]),y=(0,n.useCallback)((async e=>{const o=await oe().F.formulas.load();return function(e,t,o,n,r,i){const{droppedDirection:l,duplicate:s}=e,a=o.collectionViewBlockStore();if(!a)return;const c=ye().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");ye().default.DO_NOT_USE_measureAfterNextFlushLegacy(c,{environment:t,getData:()=>le().yr({collectionContextStore:o,is_native_drop:!1,is_empty:!0})});const d="collectionTypedView"===o.contextType,u=(0,Jt().F6)({stores:e.droppedStores,collectionContextStore:o});if(0===u.length&&d)return void Qt().UW(nt().Z.formatMessage(Jt().nX.unsupportedGroupAction));w().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:t,canUndo:!0,perform:e=>{!Xe().by({environment:t,collectionStore:i,targetStore:a,droppedDirection:l,collectionContextStore:o,groupsPointer:n,droppedStores:u,duplicate:s,transaction:e,collapsedGroup:!1,formulasModule:r})&&d&&Qt().UW(nt().Z.formatMessage(Jt().nX.unsupportedGroupAction))}})}(e,g,t,d,o,m)}),[t,m,g,d]),v=(0,n.useCallback)((async t=>{const o=await oe().F.formulas.load();return function(e,t,o,n,r,i){const{files:l,droppedDirection:s}=e;if(!i)return;const a=o.collectionViewBlockStore();if(!a)return;const c=ye().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");ye().default.DO_NOT_USE_measureAfterNextFlushLegacy(c,{environment:t,getData:()=>le().yr({collectionContextStore:o,is_native_drop:!0,is_empty:!0})}),w().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:t,canUndo:!0,perform:e=>{Xe().tQ({environment:t,collectionStore:i,targetStore:a,droppedDirection:s,collectionContextStore:o,groupsPointer:n,files:l,transaction:e,formulasModule:r})}})}(t,g,e.collectionContextStore,e.groupsPointer,o,m)}),[m,g,e.collectionContextStore,e.groupsPointer]);if(!u)return null;const x=i!==yo.Vertical&&(!o&&0===p.length),b=i===yo.Vertical&&!o;return(0,$.jsx)(ze().Z,{store:u,canSelect:!1,canEditText:!1,shouldShowHalo:!h,canDrag:!1,canDropLeft:c&&x,canNativeDropLeft:c&&x&&!S,canDropBelow:c&&b,canNativeDropBelow:c&&b&&!S,canTriggerContextMenu:!1,isLastItem:0===p.length,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:y,onNativeDrop:v,analyticsName:r,shouldShowDropZone:c,onEnter:l,groupsPointer:d,verticalDropZoneExtraLeftEdgeOffset:f,style:i===yo.Vertical?void 0:{width:"100%",height:"100%"}})}function Co(e){let{collectionContextStore:t,groupsPointer:r,resultComponentProps:i}=e;const l=(0,a().VK)((()=>t.groupsStore.getGroupState(r)),[t,r]),c=(0,a().VK)((()=>(null==l?void 0:l.resultsStore.state)??[]),[null==l?void 0:l.resultsStore]),d=(0,a().VK)((()=>{const e=t.collectionViewBlockStore();return Fe().default.peekTargetStore.state===e&&(Fe().default.isSidePeekOpen()||Fe().default.isCenterPeekOpen())?"PeekViewScroller":"PageScroller"}),[t]),[u,p]=(0,n.useState)(0),m=(0,n.useCallback)((e=>{if(0===u){var t;const o=(null==e||null===(t=e.getBoundingClientRect())||void 0===t?void 0:t.top)??0;o!==u&&p(o)}}),[u]),g=(0,n.useCallback)((e=>c[e].id),[c]),S=(0,$t().MG)({count:c.length,estimateSize:()=>34,scrollMargin:u,getScrollElement:()=>{var e;return null===(e=o(832924).default[d])||void 0===e?void 0:e.getNode()},getItemKey:g,overscan:10});return function(e){let{virtualizer:t,resultsStores:o,collectionContextStore:r,groupState:i}=e;const l=(0,n.useRef)({fetching:!1,previousTotal:0}),c=(0,s().O7)(),d=t.getVirtualItems(),u=o.length+1,p=(0,a().VK)((()=>{var e;return(null==i||null===(e=i.reducerResultStore)||void 0===e||null===(e=e.state)||void 0===e?void 0:e.hasMore)??!1}),[null==i?void 0:i.reducerResultStore]);(0,n.useEffect)((()=>{const{fetching:e,previousTotal:t}=l.current;e&&t!==u&&(l.current={fetching:!1,previousTotal:0})}),[u]),(0,n.useEffect)((()=>{if(!p||null==i||!i.groupsPointer||l.current.fetching)return;const[e]=d.slice(-1);!e||u<=0||e.index-t.options.overscan>.67*u&&(l.current={fetching:!0,previousTotal:u},r.infiniteScrollLongTaskObserver.observe(),Xe().ID({collectionContextStore:r,environment:c,incrementLimitArgs:{isFullScreen:!0,currentResultCount:o.length,groupsPointer:null==i?void 0:i.groupsPointer,incrementLimitsInRelatedGroups:!1}}))}),[r,c,null==i?void 0:i.groupsPointer,p,o.length,u,d,t.options.overscan])}({virtualizer:S,resultsStores:c,collectionContextStore:t,groupState:l}),(0,n.useEffect)((()=>{t.virtualizedModule.setRowVirtualizer(S)}),[t,S]),c.length<=0?null:(0,$.jsx)("div",{ref:m,style:{height:S.getTotalSize(),width:"100%",position:"relative"},children:S.getVirtualItems().map((e=>{const t=c[e.index],o=c.length-1===e.index;return(0,$.jsx)("div",{"data-index":e.index,ref:S.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${(e.start??0)-S.options.scrollMargin}px)`},children:(0,$.jsx)(Vo,{store:t,isLast:o,...i},t.id)},e.key)}))})}const wo=n.memo(Co,Nt().Z);function ko(e){const{isLast:t,collectionContextStore:o,dropzoneGap:r,resultProps:i,resultComponent:l,groupsPointer:s,shouldShowHoverMenu:c,canDrag:d,disabled:u,format:p,getItemSelectableStyle:m,handleOpenPeekPage:g,belowDropZoneMargin:S,analyticsName:h,direction:f,onSelectableEnter:y,canDrop:v,disableScrollToRevealHorizontal:x,touchDragOnly:b,blockPropertyValueOverlayStore:C,onSelectableInsertRow:w,disableSelectable:k,titleColumnIndex:V,nestedCreateSubitemButton:T,itemSelectableHaloStyle:j}=e,R=(0,a().VK)((()=>X().Bm({store:e.store,collectionContextStore:o})),[o,e.store]),P=(0,n.useMemo)((()=>[]),[]);return R?(0,$.jsx)(fo,{getItemSelectableStyle:m,itemSelectableHaloStyle:j,store:e.store,canDrag:d,resultProps:i,resultComponent:l,collectionContextStore:o,groupsPointer:s,shouldShowHoverMenu:c,canDrop:v&&!u,format:p,handleOpenPeekPage:g,belowDropZoneMargin:S,analyticsName:h,disabled:u,direction:f,dropzoneGap:r,onSelectableEnter:y,disableScrollToRevealHorizontal:x,touchDragOnly:b,isLast:t,subitemPath:P,titleColumnIndex:V,blockPropertyValueOverlayStore:C,onSelectableInsertRow:w,disableSelectable:k,nestedCreateSubitemButton:T}):null}const Vo=n.memo(ko,Nt().Z);function To(e){let{collectionContextStore:t,groupsPointer:o,disableRequest:n,resultsReducer:r}=e;const i=(0,a().VK)((()=>t.groupsStore.getGroupState(o)),[t,o]),l=(0,a().VK)((()=>je().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]);return!n&&r&&i?(0,$.jsx)(Xt().Z,{id:o.length>0?`results:${(0,zt().KW)(o)}`:"collection_group_results",reducer:r,groupsPointer:o,collectionContextStore:t,resultStore:i.reducerResultStore,debounceWait:l}):null}var jo=()=>o(906769),Ro=()=>o(57649),Po=()=>o(506347),Io=()=>o(47443),_o=()=>o(794586);function Mo(e){var t;const{transaction:o,environment:n,collectionContextStore:r,isFullScreen:i,groupsPointer:l,insertAtIndex:s,from:a,transient:c}=e,d=null===(t=r.groupsStore.getGroupState(l))||void 0===t?void 0:t.resultsStore;if(!d)return;r.searchQueryStore.state&&V().Ug({searchQuery:"",collectionContextStore:r,isFullScreen:i});const u=Xe().IW({environment:n,collectionContextStore:r,groupsPointer:l,insertAtIndex:s,shouldCoerce:!0,templateStore:r.defaultPageTemplateStore.state,transaction:o,from:{createBlock:a},inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache});if(!u)return;const p=u.coercionSucceeded,m=u.newStore;if(n.device.isMobile)Io()._c({environment:n,store:m,pageVisitSource:Po().tY.Create});else if(p){const e=m.getBlockTitleStore();b().eP({environment:n,store:m}),C().setSelectionAtEnd({store:e}),V().Z5({store:m,transient:c})}else{const e="collectionTypedView"===r.contextType;_o().CH({environment:n,store:m,peekMode:(0,X().kr)(r),showMoveTo:e,resultsStore:d,collectionContextStore:r,pageVisitSource:Po().tY.Create})}io().W(n,{from:a,type:"page",new_page_id:m.id,creating_block_id:m.id,...(0,le().Pn)(r)})}var Bo=()=>o(568017),Fo=()=>o(197874);function Ko(e){const{collectionContextStore:t}=e,o=(0,qe().YB)(),n=(0,a().VK)((()=>{var e;return t.databaseType?(0,Fo()._M)(o,t.databaseType):(0,Fo().es)(o,null===(e=t.collectionStore())||void 0===e?void 0:e.getModel())}),[t,o]);return(0,$.jsx)($.Fragment,{children:n})}var Oo=()=>o(941310),Lo=()=>o(615676);const Do={fontSize:14,lineHeight:1.5,minHeight:21,fontWeight:Zt().Ue.medium,width:"auto"},Eo={fontSize:16,lineHeight:1.5,minHeight:24,fontWeight:Zt().Ue.medium,width:"auto"};function Ao(e,t,o,n,r){const i=o.getViewType();if(!t.isDefined()||!i)return[];return(0,tt().eI)({viewType:i,format:o.normalizedFormatStore.state,visible:!0}).filter((i=>n&&i.property!==Gt().iw||(0,Oo().X)({block:t.getModel(),property:i.property,schema:o.normalizedSchemaStore.state,getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,Yt().r)(),intl:nt().Z.getIntl(),experimentService:je().default,collectionFeatureGates:(0,Lo().W)(),formulasModule:r})))}function Ho(e){const t=e.getViewType();if("board"===t||"gallery"===t){const o=e.normalizedFormatStore.state;return(0,tt().K8)(o,t)}return!1}var Zo=()=>o(312578),zo=()=>o(92175),Go=()=>o(521777);const Wo=function(e){let{shouldShowSpinner:t,color:o,collectionContextStore:n,isFullScreen:r,groupsPointer:i}=e;const l=(0,s().O7)(),{isMobile:a}=(0,s().Fy)(),d=(0,c().yK)((e=>{const t=o||e.lightTextColor,n=a?Eo.fontSize:Do.fontSize;return{addItemButton:{width:"100%",color:t,borderRadius:nl,boxShadow:"dark"===e.mode?`${Bo().ZP.whiteWithAlpha(.05)} 0px 0px 0px 1px`:`${e.regularDividerColor} 0px 0px 0px 1px`,padding:"12px 16px 12px 16px",minHeight:(0,X().ml)({isMobile:a}),fontSize:n},plusIcon:{width:n,height:n,fill:t},spinner:{margin:"0 0 0 auto"}}}),[o,a]);return(0,$.jsxs)(zo().Z,{icon:e=>(0,Go().R)({...e,...d.plusIcon}),isLightGray:!0,isLarge:!0,style:d.addItemButton,onClick:e=>function(e,t,o,n){if(!(0,Oe().ww)(n))return void(0,Oe().eD)(n);w().createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:n,canUndo:!0,perform:r=>{Mo({transaction:r,environment:n,collectionContextStore:e,isFullScreen:t,groupsPointer:o,from:"board_group_add_item_bottom",transient:!1})}})}(n,r,i,l),onMouseDown:de().$0,children:[(0,$.jsx)(Ko,{collectionContextStore:n}),t&&(0,$.jsx)("div",{style:d.spinner,children:(0,$.jsx)(Zo().Z,{style:{width:12,height:12}})})]})};var No=()=>o(672526),Uo=()=>o(848854);function $o(e){let{color:t,collectionContextStore:o,groupFormat:n,isHovered:r}=e;const{isMobile:i}=(0,s().Fy)(),l=(0,c().yK)((e=>{const o=t||e.lightTextColor,n=i?Eo.fontSize:Do.fontSize;return{linkButton:{visibility:r?"visible":"hidden",marginTop:8,width:"100%",color:o,borderRadius:nl,padding:"12px 16px 12px 16px",fontSize:n},icon:{width:n,height:n,fill:o}}}),[t,i,r]);return(0,$.jsx)(No().a,{collectionContextStore:o,groupFormat:n,renderLinkButton:e=>(0,$.jsx)(zo().Z,{icon:e=>(0,Uo().v)({...e,...l.icon}),isLightGray:!0,isLarge:!0,style:l.linkButton,...e,children:(0,$.jsx)(qe()._H,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})})})}var qo=()=>o(629013),Yo=()=>o(732811),Qo=()=>o(511115),Xo=()=>o(421654),Jo=()=>o(497065),en=()=>o(280080),tn=()=>o(50272),on=()=>o(596324),nn=()=>o(973509),rn=()=>o(729775),ln=()=>o(429725),sn=()=>o(191003),an=()=>o(876822),cn=()=>o(337897);function dn(e,t,o,n,r){const i=o.getViewType();if("board"===i||"gallery"===i){const l=(0,tt().JI)(t);b().eP({environment:e,store:t}),C().setSelectionAtEnd({store:l}),V().Z5({store:t}),r&&j().sd(e,"board_item_edit_mode_enter",{...(0,le().Pn)(o),block_id:t.id,from:r,view_type:i}),n.setState("existing")}}function un(e,t,o,n,r,i,s,a){const c=r.normalizedSchemaStore.state,d=n.state;if(!d.isOpen)return;const u=Ao(t,o,r,s,a).map((e=>e.property)),p=u.findIndex((e=>e===d.property));let m;if("tab"===e){const e=u.find(((e,t)=>t>p&&(0,cn().AB)(c[e])))||u.find(((e,t)=>!s&&(0,cn().AB)(c[e])));m=e}else{const e=S().dF(u,((e,t)=>t<p&&(0,cn().AB)(c[e])))||S().dF(u,((e,t)=>!s&&(0,cn().AB)(c[e])));m=e}m?l().default.afterNextFlush((()=>{so().bA({environment:t,blockPropertyValueOverlayStore:n,store:o,property:m,format:dt().C.Page,collectionContextStore:r})})):s&&l().default.afterNextFlush((()=>{dn(t,o,r,i)})),so().xv({environment:t,blockPropertyValueOverlayStore:n}),i.preventEmptyDelete()}function pn(e,t,o,n,r,i,l,s){const a=n.normalizedSchemaStore.state,c=Ao(t,o,n,l,s).map((e=>e.property));let d;if("tab"===e){d=c.length>0?c[0]:void 0}else{d=S().dF(c,((e,t)=>{const o=a[e];return(0,cn().AB)(o)}))}d&&so().bA({environment:t,blockPropertyValueOverlayStore:r,store:o,property:d,format:dt().C.Page,collectionContextStore:n}),i.preventEmptyDelete()}class mn extends d().default{getInitialState(){return"existing"}preventEmptyDelete(){"new_empty"===this.state&&(this.setState("new"),co().Z.state.isActive&&co().Z.setState({...co().Z.state,transient:!1}))}}const gn=mn;var Sn=()=>o(242619),hn=()=>o(904912),fn=()=>o(314379);function yn(e){const t=(0,s().O7)(),n=(0,s().Fy)(),{value:r}=(0,G().XJ)(oe().F.formulas),i=(0,a().VK)((()=>e.collectionContextStore.normalizedFormatStore.state),[e.collectionContextStore.normalizedFormatStore]),l=(0,a().VK)((()=>e.collectionContextStore.getViewType()),[e.collectionContextStore]),c=(0,a().VK)((()=>e.collectionContextStore.permissionScopesStore.state),[e.collectionContextStore.permissionScopesStore]),d=(0,a().VK)((()=>co().Z.state.isActive&&co().Z.state.store===e.store),[e.store]),u=(0,a().VK)((()=>c.canEditContent&&e.store.canEdit()),[c.canEditContent,e.store]),p=(0,a().VK)((()=>Fe().default.state.open&&Fe().default.state.targetStore.id===e.store.id),[e.store.id]),m=(0,a().VK)((()=>{const t=(0,X().kr)(e.collectionContextStore);return(0,cn().X9)(t,!1)}),[e.collectionContextStore]),g=(0,a().VK)((()=>(0,X().mb)({environment:t,store:e.store,mainEditorCurrentBlockStore:an().default.state.mainEditorCurrentBlockStore,collectionContextStore:e.collectionContextStore,fullyQualified:!1})),[t,e.store,e.collectionContextStore]),S=(0,a().VK)((()=>Ho(e.collectionContextStore)),[e.collectionContextStore]),h=(0,a().VK)((()=>{const o=l?(0,tt().eI)({viewType:l,format:i,visible:!0}):[],n=Ao(t,e.store,e.collectionContextStore,d,r);return o.length>0&&o.length!==n.length}),[t,i,d,e.collectionContextStore,e.store,l,r]),f=(0,a().VK)((()=>{var t;const o=U().default.state;return!("editing"!==o.mode||!e.blockPropertyValueOverlayStore.state.isOpen)&&(null===(t=(0,sn().QY)(o.multiSelection))||void 0===t?void 0:t.store)===(0,tt().JI)(e.store)}),[e.store,e.blockPropertyValueOverlayStore]),y=(0,a().VK)((()=>!(c.isLocked||!c.canEditContent||c.isSyncedCollection||c.isExternallyImportedAndSyncedCollection)&&("collectionTypedView"===e.collectionContextStore.contextType||e.store.canEdit())),[c.canEditContent,c.isExternallyImportedAndSyncedCollection,c.isLocked,c.isSyncedCollection,e.collectionContextStore,e.store]),v=e.lastProxiedUrl&&e.coverFormat&&"contain"!==e.coverAspectFormat&&u,x=y&&!d&&!f&&(S||h),C=d&&!p,w=!e.controlArgs.isRepositioning;return n.isMobile?null:(0,$.jsxs)(o(397174).Z,{isVisible:e.controlArgs.isVisible,position:"top",children:[v&&!e.controlArgs.isRepositioning&&(0,$.jsx)(pt().Z,{style:hn().ar,onClick:t=>e.controlArgs.handleRepositionClick(t,e.lastProxiedUrl),children:(0,$.jsx)(qe()._H,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})}),v&&e.controlArgs.isRepositioning&&(0,$.jsx)(pt().Z,{style:hn().ar,onClick:e.controlArgs.handleSavePositionClick,children:(0,$.jsx)(qe()._H,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})}),v&&e.controlArgs.isRepositioning&&(0,$.jsx)(pt().Z,{style:hn().ar,onClick:e.controlArgs.handleCancelClick,children:(0,$.jsx)(qe()._H,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})}),x&&(0,$.jsx)(gt().Z,{renderTooltip:()=>(0,$.jsx)(qe()._H,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:n=>(0,$.jsx)(pt().Z,{style:hn().ar,onClick:()=>{dn(t,e.store,e.collectionContextStore,e.editModeStore,"click")},...n,children:(0,o(953293).R)({width:16,height:16})})}),C&&(0,$.jsx)(gt().Z,{renderTooltip:()=>m.tooltip,render:o=>(0,$.jsx)(pt().Z,{style:hn().ar,onClick:()=>{g&&(Jo().c4({environment:t,url:g}),e.editModeStore.preventEmptyDelete())},...o,children:m.icon({width:14,height:14})})}),w&&(0,$.jsx)(gt().Z,{renderTooltip:()=>(0,$.jsx)(qe()._H,{defaultMessage:"Rename, delete, move to and more",id:"collectionViewCardItem.repositionAction.tooltip"}),render:o=>(0,$.jsx)(pt().Z,{style:hn().ar,onClick:o=>{b().Ys({environment:t,store:e.store}),Sn().Qn({environment:t,stores:N().default.state.stores,left:o.clientX,top:o.clientY,showInput:!0,actionSectionGroupKey:"block_in_collection",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:e.collectionContextStore}})},...o,children:(0,fn().o)({width:14,height:14})})})]})}const vn=n.memo(yn);var xn=()=>o(768826);function bn(e){let{propertyFormat:t,store:o,blockPropertyValueOverlayStore:r,collectionContextStore:i,disabled:l,editModeStore:c,isCardSelected:d}=e;const u=(0,s().O7)(),{value:p}=(0,G().XJ)(oe().F.formulas),{collectionStore:m,canEdit:g}=(0,a().VK)((()=>({collectionStore:o.getAssociatedCollectionStore(),canEdit:o.canEdit()})),[o]),{viewType:S,collectionViewStore:h,isTableWrapped:f}=(0,a().VK)((()=>({viewType:i.getViewType(),collectionViewStore:i.collectionViewStore(),isTableWrapped:Boolean(i.normalizedFormatStore.state.table_wrap)})),[i]),y=(0,a().VK)((()=>i.permissionScopesStore.state.isLocked||!i.permissionScopesStore.state.canEditContent),[i.permissionScopesStore]),v=(0,n.useCallback)((()=>un("tab",u,o,r,i,c,d,p)),[u,o,r,i,c,d,p]),x=(0,n.useCallback)((()=>un("untab",u,o,r,i,c,d,p)),[u,o,r,i,c,d,p]),C=(0,n.useCallback)((()=>function(e,t,o,n){so().xv({environment:e,blockPropertyValueOverlayStore:t}),b().Ys({environment:e,store:o}),n.preventEmptyDelete()}(u,r,o,c)),[u,r,o,c]);if(!m)return null;const w="gallery"===S?dt().C.GalleryView:dt().C.Board;return(0,$.jsx)(xn().m,{store:o,property:t.property,disabled:l||!g,locked:y,format:w,tableWrap:f||Boolean(t.wrap),blockPropertyValueOverlayStore:r,collectionStore:m,showIfEmpty:d,onEnter:C,onEsc:C,onBgClick:C,onTab:v,onUntab:x,collectionViewStore:h},t.property)}const Cn=n.memo(bn);var wn=()=>o(636340),kn=()=>o(943620),Vn=()=>o(735501);const Tn=(0,qe().vU)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a name",id:"collectionViewCardItem.itemName.placeholder"}});function jn(e){const{store:t,collectionContextStore:r,editModeStore:i,onTextEsc:l,onTextEnter:d,blockPropertyValueOverlayStore:u,isCardSelected:p}=e,m=(0,s().O7)(),g=(0,s().Fy)().isMobile,S=(0,qe().YB)(),{value:h}=(0,G().XJ)(oe().F.formulas),{collectionViewBlockId:y,collectionViewId:v,viewType:x}=(0,a().VK)((()=>{var t,o;return{collectionViewId:null===(t=e.collectionContextStore.collectionViewStore())||void 0===t?void 0:t.id,collectionViewBlockId:null===(o=e.collectionContextStore.collectionViewBlockStore())||void 0===o?void 0:o.id,viewType:e.collectionContextStore.getViewType()}}),[e.collectionContextStore]),k=(0,a().VK)((()=>Ao(m,t,r,p,h)),[m,t,r,p,h]),T=(0,a().VK)((()=>(0,Z().wI)({collectionContextStore:r,blockStore:t})),[t,r]),{titleStore:j,icon:R,isEmptyPage:P,hasError:I}=(0,a().VK)((()=>({titleStore:(0,tt().JI)(t),icon:t.getIcon(),isEmptyPage:t.isEmptyPage(),hasError:t.hasError()})),[t]),_=(0,a().VK)((()=>(t.hasIcon()||!t.isEmptyPage())&&r.shouldShowPageIcon()),[t,r]),M=(0,a().VK)((()=>{var e;return p?S.formatMessage(Tn.typeAName):(null===(e=t.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,Yt().r)(),intl:S}))||S.formatMessage(Tn.untitledBlock)}),[p,S,t]),B=(0,a().VK)((()=>t.canEdit()&&r.permissionScopesStore.state.canEditContent),[t,r]),F=(0,n.useCallback)((()=>{pn("tab",m,t,r,u,i,p,h)}),[m,t,r,i,u,p,h]),K=(0,n.useCallback)((()=>{pn("untab",m,t,r,u,i,p,h)}),[m,t,r,i,u,p,h]),O=(0,n.useCallback)((()=>{V().MO(),C().clear({environment:m});t.canEdit()&&r.permissionScopesStore.state.canEditContent&&("new_empty"===i.state?l(t):"new"===i.state?d(t):b().Ys({environment:m,store:t}),i.preventEmptyDelete())}),[m,t,r.permissionScopesStore,i,l,d]),L=(0,n.useCallback)((()=>{V().MO();t.canEdit()&&r.permissionScopesStore.state.canEditContent&&("new_empty"===i.state?l(t):b().Ys({environment:m,store:t}),i.preventEmptyDelete())}),[t,r.permissionScopesStore,i,l,m]),D=(0,n.useCallback)((()=>{!function(e,t,o,n){const r=t.getViewType();"board"!==r&&"gallery"!==r||(f().rv({environment:e,collectionContextStore:t,block_id:o.id,property:"title",property_type:"text",from:r}),n.preventEmptyDelete())}(m,r,t,i)}),[m,t,r,i]),E=(0,n.useCallback)((e=>{const o=t.getIconStore();o&&w().createAndCommit({userAction:"CollectionViewCardItemTitle.handleRecordIconChange",environment:m,canUndo:!0,perform:t=>{wn().sO({store:o,value:e,transaction:t})}})}),[m,t]),A=(0,c().yK)((e=>{const t=k.length>0;return{titleWrap:{position:"relative",width:"gallery"===x?"100%":"auto",display:"flex",paddingLeft:10,paddingRight:10,paddingBottom:t?6:g?12:8,paddingTop:T?4:g?12:8},recordIcon:{float:"left",borderRadius:5,width:24,height:24,marginLeft:-2,...g?{marginTop:0,marginRight:4}:{marginTop:2,marginRight:4}},warningIcon:{fill:e.accentColors.orange[500],paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom",...g?{width:20,marginLeft:2,marginRight:4}:{width:16,marginLeft:4,marginRight:6}},text:{pointerEvents:p?void 0:"none",cursor:p?"text":void 0,flexGrow:1,padding:"2px 1px",whiteSpace:"pre-wrap",...g?Eo:Do}}}),[p,g,T,k.length,x]),H=(0,n.useMemo)((()=>({type:"page_property_value_match",propertyId:"title",collectionViewId:v,collectionViewBlockId:y})),[y,v]),z=(_||p)&&!I;return(0,$.jsxs)("div",{style:A.titleWrap,children:[z&&(0,$.jsx)(kn().Z,{disabled:!1,bucket:"secure",style:A.recordIcon,progressContainerStyle:A.recordIcon,icon:R,store:t,size:g?24:B?20:18,isEmptyPage:P,onChange:E}),I&&(0,Vn().t)(A.warningIcon),(0,$.jsx)(o(345837).Z,{store:j,disabled:!p,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:O,onEsc:L,onTab:F,onUntab:K,onChange:D,placeholder:M,style:A.text,disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:H})]})}const Rn=n.memo(jn);function Pn(e,t){const{store:o,onTextEsc:r,onTextEnter:i,onShiftEnter:l,handleOpenPeekPage:c,collectionContextStore:d,blockPropertyValueOverlayStore:u}=e,p=(0,s().O7)(),m=(0,n.useRef)(null),{value:g}=(0,G().XJ)(oe().F.formulas),S=(0,a().qz)(void 0,et().Z),h=(0,a().qz)(void 0,gn),f=(0,a().SI)((()=>{const t=co().Z.state;return t.isActive&&t.store===e.store}),[e.store]),y=(0,a().Kw)(f),v=(0,a().VK)((()=>N().default.state.stores.includes(o)),[o]),x=(0,a().VK)((()=>{var e,t,n;return!(o.getSpaceId()!==(null===(e=an().default.state.currentSpaceStore)||void 0===e?void 0:e.id))&&((null===(t=d.collectionViewStore())||void 0===t?void 0:t.getFormat().app_config_uri)===We().g3&&o.getFormat().app_config_uri===We().z3&&"sprint_board"===(null===(n=an().default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.getFormat().special_page_for_pm_launch))}),[o,d]),b=(0,a().VK)((()=>{const e=an().default.state.mainEditorCurrentBlockStore;return(0,X().mb)({environment:p,store:o,mainEditorCurrentBlockStore:e,collectionContextStore:d,fullyQualified:!1})}),[p,d,o]),C=(0,n.useCallback)((()=>{dn(p,o,d,h,"space")}),[p,o,d,h]),k=(0,n.useCallback)((()=>{(0,V().MO)(),h.preventEmptyDelete()}),[h]),T=(0,n.useCallback)((()=>{i(o)}),[i,o]),j=(0,n.useCallback)((()=>{un("tab",p,o,u,d,h,y,g)}),[p,o,u,d,h,y,g]),R=(0,n.useCallback)((()=>{un("untab",p,o,u,d,h,y,g)}),[p,o,u,d,h,y,g]),P=(0,n.useCallback)((()=>{w().createAndCommit({userAction:"CollectionViewCardItem.handleShiftEnter",environment:p,canUndo:!0,perform:e=>{l({blocks:N().default.state.stores,transaction:e})}})}),[p,l]),I=(0,n.useCallback)((()=>{"new_empty"!==h.state||y||d.defaultPageTemplateStore.state||(r(o),f.removeListener(I))}),[d.defaultPageTemplateStore,h,y,f,r,o]);return(0,Yo().K)((()=>{var t;const o=U().default.state,n=co().Z.state,r=n.isActive&&n.transient,i="editing"===o.mode&&(null===(t=(0,sn().QY)(o.multiSelection))||void 0===t?void 0:t.store)===(0,tt().JI)(e.store);i&&r?h.setState("new_empty"):i?h.setState("new"):h.setState("existing")})),(0,n.useEffect)((()=>(f.state&&"new_empty"===h.state&&f.addListener(I),()=>{f.removeListener(I)})),[h,f,I]),(0,he().ez)(o,t,(0,n.useMemo)((()=>({renderedType:"page",getBlockStore:()=>o,getNode:()=>m.current,activate:()=>{b&&(c(),Jo().c4({environment:p,url:b}))}})),[p,c,b,o]),(0,$.jsx)(D().Z,{debugName:"CollectionViewCardItem",capture:y,onEsc:k,onEnter:T,onSpace:C,onTab:j,onUntab:R,children:(0,$.jsxs)(D().Z,{debugName:"CollectionViewCardItem",capture:v,onShiftEnter:P,children:[(0,$.jsx)(_n,{...e,ref:m,mouseStore:S,editModeStore:h,isCardSelected:y,peekUrl:b}),x&&(0,$.jsx)(tn().bZ,{origin:m})]})}))}const In=n.memo(n.forwardRef(Pn)),_n=n.memo(n.forwardRef((function(e,t){const{store:r,disabled:i,peekUrl:l,editModeStore:d,handleOpenPeekPage:u,collectionContextStore:p,blockPropertyValueOverlayStore:m,mouseStore:g,isCardSelected:S,coverFormat:h,coverAspectFormat:f,colorStyle:y,coverSizeFormat:v,coverWidth:x,coverHeight:b}=e,C=(0,s().O7)(),k=(0,s().Fy)().isMobile,V=(0,ee().Dq)(),{value:T}=(0,G().XJ)(oe().F.formulas),[j,R]=(0,n.useState)(void 0),P=(0,a().VK)((()=>g.state.mouseEntered),[g]),{viewType:I,isInHomeWidget:_}=(0,a().VK)((()=>({viewType:p.getViewType(),isInHomeWidget:p.isInHomeWidgetStore.state})),[p]),M=(0,a().VK)((()=>(0,ln().ZP)({store:r,fullyQualified:!1,pageVisitSource:Po().tY.LinkInPage})),[r]),B=(0,a().VK)((()=>Ho(p)),[p]),F=(0,a().VK)((()=>Ao(C,r,p,S,T)),[C,r,p,S,T]),K=(0,a().VK)((()=>(0,Z().Cr)({collectionContextStore:p,blockStore:r})),[p,r]),O=(0,a().VK)((()=>(0,Z().wI)({collectionContextStore:p,blockStore:r})),[p,r]),L=(0,a().VK)((()=>(0,o(852465).Xp)(r,{recursivelyLoadAllDiscussions:!1})>0),[r]),D=(0,n.useCallback)((e=>{R(e)}),[R]),E=(0,n.useCallback)((e=>{u(),d.preventEmptyDelete()}),[d,u]),A=(0,n.useCallback)((()=>{Re().Z.state||g.setState({...g.state,mouseEntered:!0})}),[g]),H=(0,Qo().z)(A,100),z=(0,n.useCallback)((()=>{g.setState({...g.state,mouseEntered:!1})}),[g]),W=(0,qo().y)(z,100),N=(0,n.useCallback)((e=>{w().createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:C,canUndo:!0,perform:t=>{Xo().bf({store:r,coverPosition:e.imagePosition,transaction:t}),e.reset()}})}),[C,r]),U=(0,n.useCallback)((e=>null!=V&&V.isPreviewing?null:(0,$.jsx)(vn,{store:r,collectionContextStore:p,blockPropertyValueOverlayStore:m,coverFormat:h,coverAspectFormat:f,lastProxiedUrl:j,editModeStore:d,controlArgs:e})),[m,p,V,f,h,d,j,r]),q=(0,c().yK)((e=>{const t="board"===I?(null==y?void 0:y.cardBackgroundColor)||e.boardItemDefaultBackground:e.collectionGalleryPreviewCardBackground,o={background:t,boxShadow:e.homeShadow.card.base};return{linkBox:{borderRadius:nl,position:P?"relative":"static",overflow:"hidden",transition:"background 100ms ease-out",background:t,..."board"===I?{marginBottom:k?10:8}:{height:"100%"},..._?{boxShadow:e.homeShadow.card.base}:{boxShadow:e.collectionCardShadow}},linkBoxInner:{userSelect:S?void 0:"none",height:"100%",..."board"===I?{minHeight:40}:{display:"flex",flexDirection:"column"}},linkBoxHomeWidget:{background:t,boxShadow:e.homeShadow.card.base},linkBoxHovered:_?o:{background:(null==y?void 0:y.cardHoveredBackgroundColor)||e.cardHoveredBackground},linkBoxPressed:_?o:{background:(null==y?void 0:y.cardPressedBackgroundColor)||e.cardPressedBackground},propertiesWrapper:{paddingTop:B?0:8,lineHeight:1.5,display:"flex",flexDirection:"column",..."board"===I?{paddingBottom:6}:{paddingBottom:8,..._&&{flexWrap:"wrap"}}},iconsWrapper:{display:"flex",alignItems:"center",paddingRight:10,paddingBottom:L?4:8,paddingLeft:!L||O||B?10:4,paddingTop:"gallery"===I&&0===F.length?8:0,marginTop:"board"===I&&L?-2:0},commentsIndicatorWrapper:{display:"flex",alignItems:"center",color:e.lightTextColor,fill:e.lightTextColor,fontWeight:Zt().Ue.medium,fontSize:12}}}),[I,y,P,k,_,S,L,O,B,F.length]);return"board"!==I&&"gallery"!==I?null:(0,$.jsxs)(rn().Z,{ref:t,href:M,metaHref:k?M:l,onMouseEnter:H,onMouseMove:H,onMouseLeave:W,onClick:E,style:q.linkBox,innerStyle:q.linkBoxInner,hoveredStyle:S?{background:q.linkBox.background}:q.linkBoxHovered,pressedStyle:S?{background:q.linkBox.background}:q.linkBoxPressed,children:[(0,$.jsx)(o(910293).Z,{store:r,source:I,mouseStore:g,renderControl:U,small:"small"===v,onFlushTemporaryPosition:N,render:e=>{let{imagePosition:t}=e;return h&&(0,$.jsx)(o(681035).S,{variant:"gallery",store:r,coverWidth:x,coverHeight:b,coverFormat:h,coverAspectFormat:f,coverSizeFormat:v,coverPosition:t,showEmptyGalleryCover:"gallery"===I,onLoadProxiedImage:D,isInHomeWidget:p.isInHomeWidgetStore.state})}}),K&&(0,$.jsx)("div",{style:{paddingRight:6,paddingTop:8,paddingBottom:0,paddingLeft:6,maxWidth:"100%"},children:(0,$.jsx)(on().O,{blockStore:r,collectionContextStore:p})}),B&&(0,$.jsx)(Rn,{collectionContextStore:p,store:r,blockPropertyValueOverlayStore:m,onTextEsc:e.onTextEsc,onTextEnter:e.onTextEnter,editModeStore:e.editModeStore,isCardSelected:e.isCardSelected}),F.length>0&&(0,$.jsx)("div",{style:q.propertiesWrapper,children:F.map((e=>(0,$.jsx)(Cn,{store:r,disabled:i,blockPropertyValueOverlayStore:m,collectionContextStore:p,editModeStore:d,isCardSelected:S,propertyFormat:e},e.property)))}),(L||O)&&(0,$.jsxs)("div",{style:q.iconsWrapper,children:[O&&(0,$.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,$.jsx)(nn().B,{blockStore:r,collectionContextStore:p})}),(0,$.jsx)(en().s,{store:r,iconStyle:q.commentsIndicatorWrapper,buttonStyle:{position:"relative",marginLeft:O?-3:0}})]})]})})));const Mn=function(e){let{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:S,coverSizeFormat:h,colorStyle:f,onTextEnter:y,onTextEsc:v,onShiftEnter:x,blockPropertyValueOverlayStore:b,handleOpenPeekPage:C,collectionContextStore:w}=e;return(0,$.jsx)(In,{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:S,coverSizeFormat:h,coverHeight:void 0,coverWidth:void 0,colorStyle:f,onTextEnter:y,onTextEsc:v,onShiftEnter:x,blockPropertyValueOverlayStore:b,handleOpenPeekPage:C,collectionContextStore:w})};var Bn=()=>o(729201),Fn=()=>o(84080);class Kn extends d().default{getInitialState(){return{}}}const On=Kn;var Ln=()=>o(41340),Dn=()=>o(732388);const En=function(e){let{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:S,coverSizeFormat:h,coverHeight:f,coverWidth:y,onTextEnter:v,onTextEsc:x,onShiftEnter:b,blockPropertyValueOverlayStore:C,handleOpenPeekPage:w,collectionContextStore:k}=e;return(0,$.jsx)(Dn().v,{store:t,step:"demo_collection_record",children:(0,$.jsx)(In,{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:S,coverSizeFormat:h,coverHeight:f,coverWidth:y,colorStyle:void 0,onTextEnter:v,onTextEsc:x,onShiftEnter:b,blockPropertyValueOverlayStore:C,handleOpenPeekPage:w,collectionContextStore:k})})};function An(e){let{collectionContextStore:t,groupFormat:o,format:r,schema:i,disabled:l,store:c,blockPropertyValueOverlayStore:d,collectionGalleryViewStore:u,isSingleColumn:p}=e;const m=(0,s().O7)(),g=(0,n.useMemo)((()=>o?[o]:[]),[o]),S=(0,a().Kw)(t.permissionScopesStore),h=(0,a().VK)((()=>c.canEdit()&&("collectionTypedView"===t.contextType||S.canEditContent)),[t,S.canEditContent,c]),f=(0,n.useCallback)((e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();b().eP({environment:m,store:e}),C().setSelectionAtEnd({store:o}),V().Z5({store:e})}}),[m]),y=(0,n.useCallback)((e=>{const o=t.collectionStore(),n=e.getTitleStore();if(!n)return;it().QaF(n.getValue())?b().Ys({environment:m,store:e}):o&&w().createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:m,canUndo:!0,perform:t=>{Xe().Od({store:e,transaction:t})}})}),[t,m]),v=(0,n.useMemo)((()=>p?{position:"absolute",top:6,left:0,right:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}),[p]),{gallery_cover:x,gallery_cover_aspect:k,gallery_cover_size:T}=r,j=!l&&h&&!S.isSyncedCollection,{coverHeight:R,coverWidth:P}=(0,a().VK)((()=>{const{coverHeight:e,coverWidth:t}=u.state;return{coverHeight:e,coverWidth:t}}),[u]),I=(0,n.useMemo)((()=>({format:r,schema:i,onTextEnter:y,onTextEsc:y,onShiftEnter:f,disabled:l,coverFormat:x,coverAspectFormat:k,coverSizeFormat:T,coverHeight:R,coverWidth:P,blockPropertyValueOverlayStore:d,collectionContextStore:t})),[d,t,R,P,k,x,T,l,r,f,y,i]);return(0,$.jsx)(xo,{collectionContextStore:t,groupsPointer:g,format:r,canDrag:j,onSelectableEnter:f,resultProps:I,resultComponent:En,canDrop:!0,disabled:l,shouldShowHoverMenu:!1,direction:p?yo.Vertical:yo.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:v,loadContentCover:x&&"page_content"===x.type})}const Hn=n.memo(An);var Zn=()=>o(384510),zn=()=>o(668001);function Gn(e){const t=e.minHeight||Qi,o=(0,c().yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:e.largeShimmerColor,minHeight:t}})),[t]);return(0,$.jsx)(zn().Z,{style:o.card})}function Wn(e){const{hasPartialResults:t}=e;if(!(0,Bn().Z)(!0,0,100))return null;const o=e.coverHeight??Zn().Z.card.desktop.medium.height,n=t?void 0:o+40,r=t?1:3,i=S().DZ(r,(e=>(0,$.jsx)(Gn,{minHeight:n},e)));return(0,$.jsx)($.Fragment,{children:i})}function Nn(e){var t;let{groupFormat:o,store:r,format:i,disabled:l,collectionContextStore:d,schema:u,blockPropertyValueOverlayStore:p,isFullScreen:m,collectionGalleryViewStore:g}=e;const S=(0,s().O7)(),{isMobile:h}=(0,s().Fy)(),f=(0,n.useMemo)((()=>o?[o]:[]),[o]),y=(0,a().VK)((()=>S.WindowSizeStore.state.width<=Yi),[S.WindowSizeStore]),v=(0,a().VK)((()=>d.groupsStore.anyGroupHasResults()),[d]),x=(0,a().VK)((()=>d.groupsStore.getGroupState(f)),[d,f]),b=(0,a().VK)((()=>g.state.coverHeight),[g]),{reducerResult:C,hasPartialResults:w}=(0,a().VK)((()=>{const e=null==x?void 0:x.reducerResultStore.state;return{reducerResult:e,hasPartialResults:void 0!==e&&(null==e?void 0:e.blockIds.length)>0}}),[x]),k=(0,a().VK)((()=>(0,Ro().H0)({collectionContextStore:d,groupsPointer:f,hasPartialResults:w})),[d,f,w]),V=(0,a().VK)((()=>X().VM({collectionContextStore:d,reducerResult:C,isFullScreen:m})),[d,C,m]),{canEditContent:T,isSyncedCollection:j}=(0,a().VK)((()=>{const e=d.permissionScopesStore.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[d]),R=(0,a().VK)((()=>r.canEdit()&&("collectionTypedView"===d.contextType||T)),[r,d,T]),P=(0,a().Kw)(d.isInHomeWidgetStore),I=(0,c().yK)((e=>{const t=i.collection_group_by,n=i.gallery_cover_size,r=h?Eo.fontSize:Do.fontSize;return{container:{paddingBottom:o?16:void 0},resultsWrapper:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${y?"100%":`${X().rD(n)}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:t?1:16,paddingBottom:4,...P?{paddingLeft:8,paddingRight:8}:{}},loadMoreButton:{fontSize:r},loadMoreButtonIcon:{width:r,height:r},renderLoadMoreButtonDivider:{width:"100%",borderTop:o?void 0:`1px solid ${e.tableDividerColor}`,marginTop:4,marginBottom:4}}}),[i.collection_group_by,i.gallery_cover_size,o,P,h,y]);if(!x)return null;const _=void 0!==o,M=!P&&v&&!l&&R&&!j&&(w||!k),B=Boolean(null===(t=i.gallery_properties)||void 0===t||null===(t=t.filter((e=>e.visible)))||void 0===t?void 0:t.length);return(0,$.jsxs)("div",{style:I.container,children:[(0,$.jsxs)("div",{style:I.resultsWrapper,children:[(0,$.jsx)(Hn,{collectionContextStore:d,groupFormat:o,format:i,schema:u,disabled:l,store:r,blockPropertyValueOverlayStore:p,collectionGalleryViewStore:g,isSingleColumn:y}),k&&(0,$.jsx)(Wn,{hasGroups:_,hasPartialResults:w,coverHeight:b}),M&&(0,$.jsx)($n,{collectionContextStore:d,groupsPointer:f,groupFormat:o,isSingleColumn:y,coverHeight:i.gallery_cover&&b?b:0,isFullScreen:m,hasVisibleProperties:B})]}),V&&(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("div",{style:I.renderLoadMoreButtonDivider}),(0,$.jsx)(Ut().ZP,{groupsPointer:f,store:r,collectionContextStore:d,format:i,isFullScreen:m,incrementLimitsInRelatedGroups:!1,style:I.loadMoreButton,iconStyle:I.loadMoreButtonIcon})]})]})}const Un=n.memo(Nn);function $n(e){let{groupsPointer:t,groupFormat:o,collectionContextStore:r,isSingleColumn:i,coverHeight:l,isFullScreen:d,hasVisibleProperties:u}=e;const p=(0,s().O7)(),m=(0,qe().YB)(),{isMobile:g}=(0,s().Fy)(),S=(0,n.useContext)(Ln().Z),h=(0,a().VK)((()=>X().Il({collectionContextStore:r,environment:p,intl:m})),[r,p,m]),f=(0,n.useCallback)((e=>{S?S(e):Jo().c4({environment:p,url:e})}),[p,S]),y=(0,n.useCallback)((e=>{if(!(0,Oe().ww)(p))return void(0,Oe().eD)(p);const o=r.groupsStore.getGroupState(t);o&&w().createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:p,canUndo:!0,perform:e=>{const{mainEditorCurrentBlockStore:n}=an().default.state,i=Xe().IW({environment:p,collectionContextStore:r,groupsPointer:t,shouldCoerce:!0,templateStore:r.defaultPageTemplateStore.state,transaction:e,from:{createBlock:"gallery"},inMemoryRecordCache:p.defaultRecordCache.inMemoryRecordCache});if(!i)return;const l=X().mb({environment:p,store:i.newStore,mainEditorCurrentBlockStore:n,collectionContextStore:r})??(0,ln().ZP)({store:i.newStore,pageVisitSource:Po().tY.Create});f(l),v().Xd({collectionContextStore:r,resultsStore:o.resultsStore}),io().W(p,{from:"gallery_view_add_item_bottom",type:"page",new_page_id:i.newStore.id,creating_block_id:i.newStore.id,...(0,le().Pn)(r)})}})}),[p,r,t,f]),x=(0,c().yK)((e=>{const t=g?Eo.fontSize:Do.fontSize,o=X().ml({isMobile:g}),n=d&&l&&!i?u?l+o:l:o;return{wrapper:{display:"flex",flexDirection:"column",alignItems:"stretch"},addItemButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:g?Eo.fontSize:Do.fontSize,borderRadius:nl,boxShadow:"dark"===e.mode?`${e.darkDividerColor} 0px 0px 0px 1px`:`${e.regularDividerColor} 0px 0px 0px 1px`,padding:g?"12px 14px 12px 14px":"9px 14px 8px",minHeight:n,height:"100%"},linkExistingButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:g?Eo.fontSize:Do.fontSize,borderRadius:nl,padding:g?"12px 14px 12px 14px":"9px 14px 8px",marginTop:8},buttonContent:{display:"flex",alignItems:"center",marginLeft:-6,color:e.lightIconColor},buttonIcon:{width:t,height:t,marginLeft:i?void 0:-1,marginRight:6,fill:e.lightIconColor}}}),[g,i,l,d,u]);return(0,$.jsxs)("div",{style:x.wrapper,children:[(0,$.jsx)(pt().Z,{onClick:y,onMouseDown:de().$0,style:x.addItemButton,children:(0,$.jsxs)("div",{style:x.buttonContent,children:[(0,Go().R)(x.buttonIcon),(0,$.jsx)(Ko,{collectionContextStore:r})]})}),h&&(0,$.jsx)(No().a,{collectionContextStore:r,groupFormat:o,renderLinkButton:e=>(0,$.jsx)(pt().Z,{style:x.linkExistingButton,...e,children:(0,$.jsxs)("div",{style:x.buttonContent,children:[(0,Uo().v)(x.buttonIcon),(0,$.jsx)(qe()._H,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})})]})}var qn=()=>o(260799),Yn=()=>o(352230),Qn=()=>o(676214),Xn=()=>o(992024),Jn=()=>o(855238),er=()=>o(198829),tr=()=>o(255577),or=()=>o(470386),nr=()=>o(388284),rr=()=>o(129636);const ir="color";const lr=function(e){let{parent:t,groupFormat:o,collectionContextStore:r,groupsFormatKey:i,format:l,query:c,currentGroups:d,groupsLimitStore:u,schema:p}=e;const m=(0,s().O7)(),g=(0,qe().YB)(),{device:h}=m,f=(0,a().VK)((()=>S().oA([cr(m,o,r,i,l,c,d,u,g),sr(m,p,o,r)])),[m,o,r,i,l,c,d,u,g,p]),y=(0,n.useCallback)((e=>{"string"==typeof e.key&&e.key.includes(ir)||t.close()}),[t]);let v;return v=h.isMobile?{menuType:Yn().o.Modal,title:(0,$.jsx)(qe()._H,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:(0,$.jsx)(or().DoneMenuText,{}),onClickRight:t.close}:{menuType:Yn().o.Popup},(0,$.jsx)(er().Z,{...v,children:(0,$.jsx)(tr().Z,{type:tr().i.Vertical,initialFocus:0,sections:f,onAccept:y})})};function sr(e,t,o,n){const r=o.value;if(void 0===r.value)return;const i=t[o.property];if(!i)return;if("select"!==i.type&&"multi_select"!==i.type)return;if(r.type!==i.type)return;const l=(i.options||[]).find((e=>e.value===r.value));if(!l)return;const s=Bo().AP.map((r=>{const i={key:`${ir}_${r}`,render:e=>(0,$.jsx)(rr().Z,{...e,color:r,checkState:l.color===r}),action:()=>{!function(e,t,o,n,r){const i=n[o.property];if(!i)return;if(!Gt().cu(i))return;const l=r.collectionStore();if(!l)return;const s=o.value;if(s.type!==i.type)return;const a=(i.options||[]).map((t=>t.value===s.value?{...t,color:e}:t)),c={...i,options:a},d={...n,[o.property]:c};w().createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:t,canUndo:!0,perform:e=>{V().Rm({environment:t,collectionStore:l,update:{schema:d},transaction:e})}}),f().wd({environment:t,collectionContextStore:r,action:"group_change_color"})}(r,e,o,t,n)}};return i}));return{key:"collection color section",render:e=>(0,$.jsx)(nr().Z,{...e,title:(0,$.jsx)(qe()._H,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0}),items:s}}function ar(e,t,o,n,r,i){Qt().vC({message:(0,$.jsx)(qe()._H,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:()=>async function(e,t,o,n,r,i){const l=t.collectionStore();if(!l)return;const s=n.value;if("relation"===s.type&&(0,zt().RA)(s.value)){const e=W().G.createChildStore(l,{id:s.value.id,table:T().iU});await e.load();const t=e.getAssociatedCollectionStore();await(null==t?void 0:t.load())}w().createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:e,canUndo:!0,perform:s=>{Xe().iE({environment:e,collectionStore:l,property:n.property,groupFormat:n,currentGroups:o,groupsFormatKey:r,collectionContextStore:t,transaction:s,intl:i})}}),f().wd({environment:e,collectionContextStore:t,action:"delete_group"})}(e,t,o,n,r,i)}]})}function cr(e,t,o,n,r,i,l,s,a){const c=[],d=t.value,u=o.permissionScopesStore.state;("board_columns"===n?void 0===i.aggregations:void 0===r.collection_group_aggregation)?c.push({key:"addAggregation",render:e=>(0,$.jsx)(Jn().Z,{...e,title:(0,$.jsx)(qe()._H,{defaultMessage:"Show aggregation",id:"database.collectionGroupActionMenu.addAggregationTitle"}),svg:Xn().g}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:[zt().Vb]};w().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{V().iG({collectionViewStore:r,update:{query2:t},transaction:e})}})}else w().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{Xo().FH({stores:[r],update:{collection_group_aggregation:zt().Vb},transaction:e})}})}(e,n,i,o)}):c.push({key:"removeAggregation",render:e=>(0,$.jsx)(Jn().Z,{...e,title:(0,$.jsx)(qe()._H,{defaultMessage:"Hide aggregation",id:"database.collectionGroupActionMenu.removeAggregationTitle"}),svg:Qn().p}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:void 0};w().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{V().iG({collectionViewStore:r,update:{query2:t},transaction:e})}})}else w().createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,canUndo:!0,perform:e=>{Xo().FH({stores:[r],update:{collection_group_aggregation:void 0},transaction:e})}})}(e,n,i,o)}),(0,zt().eF)(t)?c.push({key:"show",render:e=>(0,$.jsx)(Jn().Z,{...e,title:(0,$.jsx)(qe()._H,{defaultMessage:"Show group",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:Xn().g}),action:()=>function(e,t,o,n,r,i){const l={...t,hidden:!1},s=(0,Jt().nr)(r,l,i.state);w().createAndCommit({userAction:"CollectionGroupActionMenu.handleShow",environment:e,canUndo:!0,perform:e=>{Xe().A6({collectionContextStore:o,newGroups:s,groupsFormatKey:n,transaction:e})}}),f().wd({environment:e,collectionContextStore:o,action:"show_group"})}(e,t,o,n,l,s)}):c.push({key:"hide",render:e=>(0,$.jsx)(Jn().Z,{...e,title:(0,$.jsx)(qe()._H,{defaultMessage:"Hide group",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:Qn().p}),action:()=>function(e,t,o,n,r){const i={...t,hidden:!0},l=(0,Jt().ar)(r,i);w().createAndCommit({userAction:"CollectionGroupActionMenu.handleHide",environment:e,canUndo:!0,perform:e=>{Xe().A6({collectionContextStore:o,newGroups:l,groupsFormatKey:n,transaction:e})}}),f().wd({environment:e,collectionContextStore:o,action:"hide_group"})}(e,t,o,n,l)}),void 0===d.value||!u.canEditContent||u.isSyncedCollection||"collectionTypedView"===o.contextType||u.isExternallyImportedAndSyncedCollection||c.push({key:"delete",render:e=>(0,$.jsx)(Jn().Z,{...e,title:(0,$.jsx)(qe()._H,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:rt().y}),action:()=>ar(e,o,l,t,n,a)});return{key:"collection group",render:e=>(0,$.jsx)(nr().Z,{...e}),items:c}}var dr=()=>o(332143),ur=()=>o(921743),pr=()=>o(667247),mr=()=>o(164079);function gr(e,t){const{calculating:o,aggregation:n}=e.asyncAggregationStatusStore.state;return n?o&&(0,S().Xy)(t,n):o}function Sr(e){let{collectionContextStore:t,aggregation:o,children:r}=e;const{isCalculating:i,changingType:l}=(0,a().VK)((()=>({isCalculating:gr(t,o),changingType:t.asyncAggregationStatusStore.state.changingType})),[t,o]),s=function(e,t){const o=(0,n.useRef)(e);return(0,n.useEffect)((()=>{t||void 0===e&&"-"===e||(o.current=e)}),[t,e]),o.current}(r,i);return i?l?(0,$.jsx)(Zo().Z,{}):(0,$.jsx)("span",{style:{opacity:.5},children:s??r}):(0,$.jsx)($.Fragment,{children:r})}var hr=()=>o(461843);const fr=(0,qe().vU)({propertyAggregation:{id:"collection.aggregation.propertyType",defaultMessage:"{aggregationType} in {propertyName}{calculating, select, true { (Calculating)} other {}}"},aggregationType:{id:"collection.aggregation.aggregationType",defaultMessage:"{aggregationType}{calculating, select, true { (Calculating)} other {}}"},aggregationCalculating:{id:"collection.aggregation.calculating",defaultMessage:"Calculating"}});var yr=()=>o(827973),vr=()=>o(448419),xr=()=>o(868744);function br(e){let{schema:t,groupFormat:o,format:n,groupAggregationKey:r,collectionContextStore:i,disabled:l}=e;const d=(0,c().Fg)(),u=(0,s().Fy)(),p=(0,a().VK)((()=>n[r]||{aggregator:"count"}),[n,r]),m=(0,a().VK)((()=>({type:"aggregation",filter:(0,qt().zk)({schema:t,group:o,groupBy:i.getGroupByAndGroupFormats().groupBy,propertyMapping:void 0,timeZone:(0,Yt().r)(),experimentService:je().default}),aggregation:p})),[i,t,o,p]);return(0,$.jsx)(gt().Z,{renderTooltip:()=>(0,$.jsx)(Ir,{schema:t,collectionContextStore:i,aggregation:p}),render:e=>(0,$.jsx)(vr().ZP,{popupType:u.isMobile?vr().Z4.SlideUp:vr().Z4.Popup,renderOrigin:n=>(0,$.jsx)(zo().Z,{disabled:l,style:{fontWeight:Zt().Ue.medium,color:d.lightTextColor,height:24},...(0,mr().Z)((0,mr().Z)(e,n),{onClick:de().Wi}),children:(0,$.jsx)(Pr,{schema:t,collectionContextStore:i,groupFormat:o,aggregation:p,reducer:m})}),disabled:l,render:e=>(0,$.jsx)(Rr,{aggregation:p,parent:e,collectionContextStore:i,format:n,groupAggregationKey:r,schema:t})})})}function Cr(e){let{aggregationType:t,isSelected:o,label:n,props:r}=e;const i=pr().Sn[t];return(0,$.jsx)(gt().Z,{placement:we().Placement.Right,delayThreshold:0,render:e=>(0,$.jsx)(yr().Z,{title:n,checkState:o,...(0,mr().Z)(e,r)}),renderTooltip:()=>(0,$.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[i&&(0,$.jsx)("img",{src:(0,ur().D)(i),style:{borderRadius:6,width:140,marginTop:4}}),pr().BG[t]]})},r.key)}function wr(e,t,o,n,r){const i=o.collectionViewStore();i&&(o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),w().createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:t,canUndo:!0,perform:t=>{V().iG({collectionViewStore:i,update:{format:{...n,[r]:e}},transaction:t})}})),f().wd({environment:t,collectionContextStore:o,action:"change_aggregation"})}function kr(e,t,o,n,r,i,l){const s=pr().VN[o];return{key:o,render:t=>(0,$.jsx)(Cr,{isSelected:e,aggregationType:o,label:s,props:t}),action:()=>{wr({aggregator:o,enforceMaxAggregationLimit:t},n,r,i,l)}}}function Vr(e,t,o,n,r){const i=e.enforceMaxAggregationLimit??!1,l={...e,enforceMaxAggregationLimit:!i};return{key:"aggregationLimitToggle",render:e=>(0,$.jsx)(hr().Z,{on:i,menuListItemProps:e}),action:()=>wr(l,t,o,n,r)}}function Tr(e,t,o,n,r,i,l,s){const{device:a}=n,c=pr().VN[t],d=S().oA(o.map((o=>function(e,t,o,n,r,i,l,s,a){const c=i[t];if(!c)return;const d=c.name;return{key:`${t}${o}`,render:t=>(0,$.jsx)(Cr,{isSelected:e,aggregationType:o,label:d,props:t}),action:()=>{wr({aggregator:o,property:t,enforceMaxAggregationLimit:n},r,l,s,a)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,e.enforceMaxAggregationLimit??!1,n,r,i,l,s)))),u=d.findIndex((o=>o.key===`${e.property}${t}`));return{key:t+c,render:(e,t)=>(0,$.jsx)(xr().Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,$.jsx)(yr().Z,{...e,ref:t,title:c}),renderExtension:(e,o)=>{let n;return n=a.isMobile?{menuType:Yn().o.Modal,title:c,right:a.isPhone?(0,$.jsx)(or().DoneMenuText,{}):void 0,onClickRight:o.close,...e}:{menuType:Yn().o.Popup,width:200,...e},(0,$.jsx)(er().Z,{...n,children:(0,$.jsx)(tr().Z,{type:tr().i.Vertical,initialFocus:u,sections:[{key:"results",render:e=>(0,$.jsx)(nr().Z,{...e}),items:d}],onAccept:t.onAccept})})}}),action:()=>null}}function jr(e,t,o,n,r,i){const l={};for(const u of dr().o5)l[u]=kr(e.aggregator===u,e.enforceMaxAggregationLimit??!1,u,t,o,n,r);const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,dr().iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(i);if(s.length>0)for(const u of dr().Sy)"show_unique"!==u&&(l[u]=Tr(e,u,s,t,i,o,n,r));const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,dr().O4)(o)}))}(i);if(a.length>0)for(const u of dr().k$)l[u]=Tr(e,u,a,t,i,o,n,r);const c=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,dr().dN)(o)}))}(i);if(c.length>0)for(const u of dr().f8)l[u]=Tr(e,u,c,t,i,o,n,r);const d=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,dr().Mv)(o)}))}(i);if(d.length>0)for(const u of dr().gC)l[u]=Tr(e,u,d,t,i,o,n,r);return l}function Rr(e){let{aggregation:t,parent:o,collectionContextStore:n,format:r,groupAggregationKey:i,schema:l}=e;const a=(0,s().O7)(),{device:c}=a,{actions:d,initialFocus:u}=function(e,t,o,n,r,i){const{device:l}=t,s=[];let a=0,c=0;const d=jr(e,t,o,n,r,i);let u=0;return Object.entries(dr().cY).forEach((i=>{let[p,m]=i;const g=[];for(const t of m)d[t]&&(g.push(d[t]),e.aggregator===t&&(a=u,c=g.length-1));const S=[];if("count_aggregations"===p&&S.push({key:"limitToggleSection",render:e=>(0,$.jsx)(nr().Z,{...e}),items:[Vr(e,t,o,n,r)]}),S.push({key:"aggregations",render:e=>(0,$.jsx)(nr().Z,{topBorder:!0,...e}),items:g}),g.length>0){u++;const e=pr().nL[p],t={key:e,render:(t,o)=>(0,$.jsx)(xr().Z,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,$.jsx)(yr().Z,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=l.isMobile?{menuType:Yn().o.Modal,title:e,right:(0,$.jsx)(or().DoneMenuText,{}),onClickRight:n.close,...t}:{menuType:Yn().o.Popup,width:250,...t},(0,$.jsx)(er().Z,{...r,children:(0,$.jsx)(tr().Z,{type:tr().i.Vertical,initialFocus:c,sections:S,onAccept:(e,t,r)=>{n.close(),o.onAccept&&o.onAccept(e,t,r)}})})}}),action:()=>null};s.push(t)}})),{actions:s,initialFocus:a}}(t,a,n,r,i,l);let p;return p=c.isMobile?{menuType:Yn().o.Modal,title:(0,$.jsx)(qe()._H,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:(0,$.jsx)(or().DoneMenuText,{}),onClickRight:o.close}:{menuType:Yn().o.Popup,width:200},(0,$.jsx)(er().Z,{...p,children:(0,$.jsx)(tr().Z,{type:tr().i.Vertical,initialFocus:u,sections:[{key:"aggregation section",render:e=>(0,$.jsx)(nr().Z,{...e}),items:d}],onAccept:o.close})})}function Pr(e){let{schema:t,collectionContextStore:o,groupFormat:n,aggregation:r,reducer:i}=e;return i?(0,$.jsx)(Xt().Z,{id:`group_aggregation:${(0,zt().mD)(n)}`,collectionContextStore:o,reducer:i,groupsPointer:[n],render:e=>{const n=e.state;let i,l;if((0,dr().pK)(r)){const e=t[r.property];!e||"formula"!==e.type&&"number"!==e.type||(i=e.number_format),e&&"date"===e.type&&(l=e.date_format)}return(0,$.jsx)(Sr,{aggregation:r,collectionContextStore:o,children:n?(0,pr().Zy)({numberFormat:i,dateFormat:l,aggregation:r,userTimeZone:(0,Yt().r)(),value:n.aggregationResult,numberPrecision:void 0}):""})}}):null}function Ir(e){let{schema:t,collectionContextStore:o,aggregation:n}=e;const r=(0,qe().YB)(),i=pr().VN[(0,dr().OV)(n)],l=(0,a().VK)((()=>gr(o,n)),[o,n]);if((0,dr().pK)(n)){const e=t[n.property];if(e){const t=e.name;return(0,$.jsx)($.Fragment,{children:r.formatMessage(fr.propertyAggregation,{aggregationType:i,propertyName:t,calculating:l})})}}return(0,$.jsx)($.Fragment,{children:r.formatMessage(fr.aggregationType,{aggregationType:i,calculating:l})})}var _r=()=>o(157593),Mr=()=>o(439320);function Br(e){const{onMount:t,isInPeekRenderer:o,style:r,paddingTop:i,disabled:d,stickyStyle:u,transitionStickyStyle:p,groupFormat:m,collectionContextStore:g,format:S,groupAggregationKey:h,stickyWrapStyle:f}=e,[y,v]=(0,n.useState)(void 0),x=(0,s().O7)(),C=(0,c().Fg)(),k=(0,n.useRef)(null);(0,n.useEffect)((()=>{null==t||t()}),[t]),(0,n.useEffect)((()=>{const e=g.collectionViewBlockStore();e&&v(new(W().G)(x,{table:T().iU,id:e.id}))}),[g,x]);const V=(0,a().VK)((()=>g.groupsStore.getGroupState(m)),[g.groupsStore,m]),j=(0,a().VK)((()=>null==V?void 0:V.toggleStateStore.state),[V]),R=(0,a().Kw)(g.permissionScopesStore),P=(0,a().VK)((()=>!d&&g.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[g,d]),I=(0,a().Kw)(g.isInHomeWidgetStore),_=(0,a().VK)((()=>void 0!==S[h]),[S,h]),M=(0,X().jw)(g,C),B=(0,a().VK)((()=>I?"transparent":(null==M?void 0:M.background)||void 0),[M,I]),F=(0,c().yK)((t=>{const n=o?t.cardContentBackground:t.contentBackground;return{topLevelDiv:{position:"relative",zIndex:$e().sL,width:"100%",background:void 0===B?n:B,fontSize:14,overflow:e.stickyLeft?void 0:"auto",...r},stickyWrapStyle:{display:"flex",alignItems:"center",height:e.height??33,paddingTop:i,...e.stickyLeft&&{position:"sticky",left:e.isFullScreen||e.isRootChild?e.paddingLeft:0},...!j&&{marginBottom:e.toggleClosedMarginBottom},...f}}}),[B,o,j,i,e.height,e.isFullScreen,e.isRootChild,e.paddingLeft,e.stickyLeft,e.toggleClosedMarginBottom,r,f]),K=(0,a().VK)((()=>x.WindowSizeStore.state.height),[x.WindowSizeStore]),O=(0,n.useCallback)((()=>{if(!V)return;b().ZH({environment:x});const e=!j;if(Xe().uo({environment:x,groupFormat:m,toggleStateStore:V.toggleStateStore,newValue:e,collectionContextStore:g}),!e){const e=k.current,t=null==e?void 0:e.parentElement;t&&l().default.afterNextFlush((()=>{(0,Se().Oc)({environment:x,el:t,windowHeight:K,minEdgeDist:50}),g.renderEmitter.emit()}))}}),[g,x,m,V,j,K]),L=(0,n.useCallback)((()=>(0,$.jsx)(go().Z,{isSidebar:!1,open:j??!1,fill:!0,onClick:O,onMouseDown:de().$0,style:{flexShrink:0}})),[O,j]),D=(0,n.useCallback)((async e=>{const{droppedStores:t,duplicate:o}=e,n=k.current;if(!(n&&n instanceof Element))return;const r=await oe().F.formulas.load();w().createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:x,canUndo:!0,perform:e=>Xe().by({environment:x,collectionContextStore:g,groupsPointer:[m],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:r})})}),[g,x,m]),E=(0,n.useMemo)((()=>({...u,paddingLeft:e.paddingLeft})),[u,e.paddingLeft]);return V&&y?(0,$.jsx)(Mr().u,{stickyAttachPoint:I?"no-stick":"ceiling",stickyStyle:E,transitionStickyStyle:p,nodeRef:k,children:(0,$.jsxs)("div",{style:F.topLevelDiv,ref:k,children:[(0,$.jsx)("div",{style:F.stickyWrapStyle,children:(0,$.jsx)("div",{style:{display:"flex",alignItems:"center",position:e.stickyLeft?"sticky":void 0,left:e.paddingLeft,overflow:"hidden"},children:(0,$.jsxs)(ze().Z,{store:y,canDropOnto:!d&&!j,onSelectableDrop:D,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[m],style:{display:"flex",alignItems:"center",height:"100%",overflow:"hidden"},canSelect:!1,children:[L(),(0,$.jsx)(Lr,{collectionGroupHeaderProps:e}),_&&(0,$.jsx)(Kr,{disabled:e.disabled,format:e.format,schema:e.schema,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,groupAggregationKey:e.groupAggregationKey}),!d&&R.canConfigureBlock&&(0,$.jsx)(Or,{groupFormat:e.groupFormat,currentGroups:e.currentGroups,format:e.format,schema:e.schema,query:e.query,collectionContextStore:e.collectionContextStore,groupsFormatKey:e.groupsFormatKey,isGroupHoveredStore:e.isGroupHoveredStore}),P&&(0,$.jsx)(Dr,{collectionGroupHeaderProps:e,isGroupHoveredStore:e.isGroupHoveredStore})]})})}),e.children]})}):null}const Fr=n.memo(Br);function Kr(e){let{disabled:t,format:o,schema:n,collectionContextStore:r,groupFormat:i,groupAggregationKey:l}=e;const s=(0,a().VK)((()=>r.permissionScopesStore.state.canConfigureBlock),[r]);return(0,$.jsx)(br,{groupFormat:i,disabled:t||!s,groupAggregationKey:l,format:o,schema:n,collectionContextStore:r})}function Or(e){let{groupFormat:t,currentGroups:o,format:n,schema:r,query:i,collectionContextStore:l,groupsFormatKey:d,isGroupHoveredStore:u}=e;const p=(0,qe().YB)(),m=(0,s().Fy)(),g=(0,a().VK)((()=>l.groupsLimitStore),[l]),S=(0,a().Kw)(u),[h,f]=(0,qn().Z)(),y=(0,c().yK)((()=>({button:{transition:m.isMobile?void 0:"opacity 100ms ease-in-out",opacity:m.isMobile?void 0:S||f?1:0}})),[m.isMobile,f,S]);return(0,$.jsx)(vr().ZP,{popupType:m.isMobile?vr().Z4.SlideUp:vr().Z4.Popup,renderOrigin:e=>(0,$.jsx)(mt().Z,{ariaLabel:p.formatMessage({id:"actionButtonComponent.ariaLabel",defaultMessage:"Show group options"}),ref:h,icon:fn().o,style:y.button,...e}),onClick:de().Wi,render:e=>(0,$.jsx)(lr,{parent:e,groupFormat:t,currentGroups:o,format:n,schema:r,query:i,collectionContextStore:l,groupsFormatKey:d,groupsLimitStore:g})})}function Lr(e){let{collectionGroupHeaderProps:t}=e;const o=(0,s().O7)(),{groupFormat:n,schema:r,disabled:i,currentGroups:l,groupBy:c,collectionContextStore:d}=t,u=(0,a().Kw)(d.permissionScopesStore);return(0,$.jsx)(_r().Z,{groupBy:c,groupFormat:n,currentGroups:l,schema:r,disabled:i||!u.canConfigureCollection||u.isSyncedCollection,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:n}=o,r=n.collectionStore();r&&(Xe().w$({...e,environment:t,collectionStore:r,...o}),f().wd({environment:t,collectionContextStore:n,action:"rename_group"}))}(e,o,t),style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginLeft:2},collectionContextStore:d})}function Dr(e){let{collectionGroupHeaderProps:t,isGroupHoveredStore:o}=e;const n=(0,qe().YB)(),r=(0,s().Fy)(),i=(0,s().O7)(),l=(0,a().Kw)(o),[d,u]=(0,qn().Z)(),p=(0,c().yK)((()=>({button:{transition:r.isMobile?void 0:"opacity 100ms ease-in-out",opacity:r.isMobile?void 0:l||u?1:0}})),[r.isMobile,u,l]);return(0,$.jsx)(gt().Z,{renderTooltip:()=>(0,$.jsx)(qe()._H,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:e=>(0,$.jsx)(mt().Z,{ariaLabel:n.formatMessage({id:"collectionGroupHeader.actions.addNewPage.ariaLabel",defaultMessage:"Add new page in group"}),ref:d,icon:Go().R,onClick:()=>function(e,t){const{groupFormat:o,collectionContextStore:n,isFullScreen:r,onGroupHeaderAddItem:i}=t;n.groupsStore.getGroupState(o)&&(0,Oe().ww)(e)&&(n.searchQueryStore.state&&V().Ug({searchQuery:"",collectionContextStore:n,isFullScreen:r}),w().createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:e,canUndo:!0,perform:r=>{const l=Xe().IW({environment:e,collectionContextStore:n,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,templateStore:n.defaultPageTemplateStore.state,transaction:r,from:{createBlock:"group_header"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});l&&(i(l.newStore,l.coercionSucceeded,t),io().W(e,{from:"group_add_item_top",type:"page",new_page_id:l.newStore.id,creating_block_id:l.newStore.id,...(0,le().Pn)(n)}))}}))}(i,t),style:p.button,...e})})}class Er extends d().default{getInitialState(){return!1}}const Ar=Er;class Hr extends d().default{getInitialState(){}}const Zr=Hr;var zr=()=>o(814058);const Gr=d().default.createClass(!1,{name:"IsGroupHoveredStore"});function Wr(e){let{renderGroup:t,groupFormat:o,groupsDisplayState:r,disabled:i,groupsFormatKey:l,groupAggregationKey:c,format:d,schema:u,query:p,collectionContextStore:m,onGroupHeaderAddItem:g,renderHeader:S,getGroupStyle:h,stickyLeft:f,paddingLeft:y,isFullScreen:v,index:x,isRootChild:b,isInPeekRenderer:C,groupBy:w,isLast:k}=e;const V=(0,s().O7)();(0,n.useEffect)((()=>{Xe().V$({environment:V,collectionContextStore:m,groupFormat:o})}),[]);const T=(0,a().qz)(void 0,Gr),[j,R,P,I,_]=(0,a().VK)((()=>{const e=m.groupsStore.getGroupState(o),n=e?e.toggleStateStore:null,s=!!n&&n.state?t(o):null,a={groupFormat:o,currentGroups:r.currentGroups,disabled:i,groupsFormatKey:l,groupAggregationKey:c,format:d,schema:u,query:p,collectionContextStore:m,isFullScreen:v,isInPeekRenderer:C,onGroupHeaderAddItem:g,stickyLeft:f,index:x,paddingLeft:y,isRootChild:b,groupBy:w,isGroupHoveredStore:T},V=S?S(a):(0,$.jsx)(Fr,{...a});return[e,n,h&&n?h({groupFormat:o,...r,index:x,isLast:k,toggleStateStore:n,isFullScreen:v}):void 0,s,V]}),[m,o,t,r,i,l,c,d,u,p,v,C,g,f,x,y,b,w,T,S,h,k]),M=(0,n.useCallback)((()=>{T.setState(!0)}),[T]),B=(0,n.useCallback)((()=>{T.setState(!1)}),[T]),F=(0,n.useRef)(null);if(!j||!R)return null;const K=0===x;return(0,$.jsx)("div",{style:{width:"100%",position:"relative",...P},onMouseEnter:M,onMouseLeave:B,ref:F,children:(0,$.jsxs)(zr().Q,{nodeRef:F,isFirst:K,children:[_,I]})})}const Nr=n.memo(Wr);var Ur=()=>o(360240);const $r=n.memo((function(e){const{selectedAggregation:t,parent:o,onChange:r,collectionContextStore:i,schema:l}=e,a=(0,s().O7)(),{isMobile:c}=(0,s().Fy)(),d=c?{menuType:Yn().o.Modal,title:(0,$.jsx)(qe()._H,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:(0,$.jsx)(or().DoneMenuText,{}),onClickRight:o.close}:{menuType:Yn().o.Popup,width:200},{sections:u,initialFocus:p}=(0,n.useMemo)((()=>{const{actions:e,initialFocus:o}=function(e,t,o,n,r){const{device:i}=t,l=[];let s=0,a=0;const c=function(e,t,o,n,r){const i={};for(const s of dr().o5)i[s]=Jr(e.aggregator===s,e.enforceMaxAggregationLimit??!1,s,o,n,t);const l=Object.keys(r).filter((e=>{const t=r[e];return t&&(0,dr().iV)(t)&&!("rollup"===t.type&&"status"===t.target_property_type)}));if(l.length>0)for(const s of dr().Sy)"show_unique"!==s&&(i[s]=Xr(e,s,l,t,r,o,n));return Yr.forEach((l=>{let{supportCheck:s,aggregationTypes:a}=l;const c=Object.keys(r).filter((e=>{const t=r[e];return t&&s(t)}));if(c.length>0)for(const d of a)i[d]=Xr(e,d,c,t,r,o,n)})),i}(e,t,o,n,r);let d=0;return Object.entries(dr().cY).forEach((t=>{let[n,r]=t;const u=[];for(const o of r)c[o]&&(u.push(c[o]),e.aggregator===o&&(s=d,a=u.length-1));const p=[];if("count_aggregations"===n&&p.push({key:"limitToggleSection",render:e=>(0,$.jsx)(nr().Z,{...e}),items:[Qr(e,o)]}),p.push({key:"aggregations",render:e=>(0,$.jsx)(nr().Z,{topBorder:!0,...e}),items:u}),u.length>0){d++;const e=pr().nL[n],t={key:e,render:(t,o)=>(0,$.jsx)(xr().Z,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,$.jsx)(yr().Z,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=i.isMobile?{menuType:Yn().o.Modal,title:e,right:(0,$.jsx)(or().DoneMenuText,{}),onClickRight:n.close,...t}:{menuType:Yn().o.Popup,width:250,...t},(0,$.jsx)(er().Z,{...r,children:(0,$.jsx)(tr().Z,{type:tr().i.Vertical,initialFocus:a,sections:p,onAccept:(e,t,r)=>{n.close(),o.onAccept&&o.onAccept(e,t,r)}})})}}),action:()=>null};l.push(t)}})),{actions:l,initialFocus:s}}(t,a,r,i,l);return{sections:[{key:"aggregation section",render:e=>(0,$.jsx)(nr().Z,{...e}),items:e}],initialFocus:o}}),[i,a,r,l,t]);return(0,$.jsx)(er().Z,{...d,children:(0,$.jsx)(tr().Z,{type:tr().i.Vertical,initialFocus:p,sections:u,onAccept:o.close})})})),qr=n.memo((function(e){const{aggregationType:t,isSelected:o,label:r,innerProps:i}=e,l=pr().Sn[t],s=(0,c().yK)((()=>({container:{width:140,whiteSpace:"normal"},image:{borderRadius:6,width:140,marginTop:4}})),[]),a=(0,n.useCallback)((e=>(0,$.jsx)(yr().Z,{title:r,checkState:o,...(0,mr().Z)(e,i)})),[o,i,r]),d=(0,n.useCallback)((()=>(0,$.jsxs)("div",{style:s.container,children:[l&&(0,$.jsx)("img",{src:(0,ur().D)(l),style:s.image}),pr().BG[t]]})),[l,s.container,s.image,t]);return(0,$.jsx)(gt().Z,{placement:we().Placement.Right,delayThreshold:0,render:a,renderTooltip:d})}));const Yr=[{supportCheck:dr().O4,aggregationTypes:dr().k$},{supportCheck:dr().dN,aggregationTypes:dr().f8},{supportCheck:dr().Mv,aggregationTypes:dr().gC}];function Qr(e,t){const o=e.enforceMaxAggregationLimit??!1,n={...e,enforceMaxAggregationLimit:!o};return{key:"aggregationLimitToggle",render:e=>(0,$.jsx)(hr().Z,{on:o,menuListItemProps:e}),action:()=>{t(n)}}}function Xr(e,t,o,n,r,i,l){const{device:s}=n,a=pr().VN[t],c=S().oA(o.map((o=>function(e,t,o,n,r,i,l,s){const a=r[t];if(!a)return;const c=a.name;return{key:`${t}${o}`,render:t=>(0,$.jsx)(qr,{isSelected:e,aggregationType:o,label:c,innerProps:t}),action:()=>{ei({aggregator:o,property:t,enforceMaxAggregationLimit:n},i,l,s)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,e.enforceMaxAggregationLimit??!1,r,i,l,n)))),d=c.findIndex((o=>o.key===`${e.property}${t}`));return{key:`${t}${a}`,render:(e,t)=>(0,$.jsx)(xr().Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,$.jsx)(yr().Z,{...e,ref:t,title:a}),renderExtension:(e,o)=>{let n;return n=s.isMobile?{menuType:Yn().o.Modal,title:a,right:(0,$.jsx)(or().DoneMenuText,{}),onClickRight:o.close,...e}:{menuType:Yn().o.Popup,width:200,...e},(0,$.jsx)(er().Z,{...n,children:(0,$.jsx)(tr().Z,{type:tr().i.Vertical,initialFocus:d,sections:[{key:"results",render:e=>(0,$.jsx)(nr().Z,{...e}),items:c}],onAccept:(e,n,r)=>{o.close(),t.onAccept&&t.onAccept(e,n,r)}})})}}),action:()=>null}}function Jr(e,t,o,n,r,i){const l=pr().VN[o];return{key:o,render:t=>(0,$.jsx)(qr,{isSelected:e,aggregationType:o,label:l,innerProps:t}),action:()=>{ei({aggregator:o,enforceMaxAggregationLimit:t},n,r,i)}}}function ei(e,t,o,n){o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),t(e),f().wd({environment:n,collectionContextStore:o,action:"board_change_aggregation"})}const ti=n.memo((function(e){const{aggregation:t,schema:o,groupFormat:r,collectionContextStore:i,disabled:l,color:a,onChange:d}=e,{isMobile:u}=(0,s().Fy)(),p=(0,c().yK)((e=>({button:{fontWeight:Zt().Ue.regular,color:a||e.lightTextColor,paddingTop:4,paddingBottom:4,height:void 0,lineHeight:void 0}})),[a]),m=(0,n.useCallback)((()=>(0,$.jsx)(oi,{aggregation:t,schema:o,collectionContextStore:i})),[t,i,o]),g=(0,n.useCallback)((e=>(0,$.jsx)(vr().ZP,{popupType:u?vr().Z4.SlideUp:vr().Z4.Popup,renderOrigin:n=>(0,$.jsx)(zo().Z,{disabled:l,style:p.button,...(0,mr().Z)(e,n),children:(0,$.jsx)(ni,{schema:o,aggregation:t,collectionContextStore:i,groupFormat:r})}),disabled:l,render:e=>(0,$.jsx)($r,{parent:e,selectedAggregation:t,onChange:d,collectionContextStore:i,schema:o})})),[t,i,l,r,u,d,o,p.button]);return(0,$.jsx)(gt().Z,{renderTooltip:m,render:g})}));function oi(e){let{aggregation:t,schema:o,collectionContextStore:n}=e;const r=(0,a().VK)((()=>!!t&&gr(n,t)),[n,t]);if(t){const e=pr().VN[(0,dr().OV)(t)];if((0,dr().pK)(t)){const n=o[t.property];if(n){const t=n.name;return(0,$.jsx)($.Fragment,{children:nt().Z.formatMessage(fr.propertyAggregation,{aggregationType:e,propertyName:t,calculating:r})})}}return(0,$.jsx)($.Fragment,{children:nt().Z.formatMessage(fr.aggregationType,{aggregationType:e,calculating:r})})}return(0,$.jsx)(qe()._H,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}function ni(e){const{schema:t,aggregation:o,collectionContextStore:r,groupFormat:i}=e,l=(0,a().VK)((()=>({type:"aggregation",filter:(0,qt().zk)({schema:t,group:i,groupBy:r.getGroupByAndGroupFormats().groupBy,propertyMapping:void 0,timeZone:(0,Yt().r)(),experimentService:je().default}),aggregation:o})),[r,o,t,i]),{numberFormat:s,numberPrecision:c}=(0,n.useMemo)((()=>{if(!(0,dr().pK)(o))return{};const e=t[o.property];if(e&&("formula"===e.type||"number"===e.type)){const t=e.number_format,n=e.number_precision;return{numberFormat:t,numberPrecision:(0,dr().nC)(o)?n:void 0}}return{}}),[o,t]),d=(0,n.useMemo)((()=>{if(!(0,dr().pK)(o))return;const e=t[o.property];return e&&"date"===e.type?e.date_format:void 0}),[o,t]),u=(0,n.useCallback)((e=>{const t=e.state;return(0,$.jsx)(Sr,{aggregation:o,collectionContextStore:r,children:t?(0,pr().Zy)({numberFormat:s,dateFormat:d,aggregation:o,userTimeZone:(0,Yt().r)(),value:t.aggregationResult,numberPrecision:c}):"-"})}),[o,r,d,s,c]);return l?(0,$.jsx)(Xt().Z,{id:`board:${(0,zt().mD)(i)}`,collectionContextStore:r,reducer:l,groupsPointer:[i],render:u}):null}function ri(e){return(0,X().rD)(e.board_cover_size)}const ii=function(e){const{hoveredGroupStore:t,groupFormat:o,schema:n,format:r,collectionContextStore:i,disabled:l,hidden:d,isPopup:u,isInPeekRenderer:p,query:m,currentGroups:g,isFullScreen:S}=e,h=(0,c().Fg)(),f=(0,s().O7)(),y=(0,qe().YB)(),v=(0,ee().Dq)(),x=(0,a().VK)((()=>!!f.device.isMobile||(0,zt().ZH)(t.state,o)),[f,t,o]),b=(0,a().VK)((()=>(0,Jt().II)({environment:f,groupFormat:o,schema:n,format:r,theme:h})),[o,n,r,f,h]),C=(0,a().Kw)(i.permissionScopesStore),w=(0,a().VK)((()=>i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[i]),k=(0,a().VK)((()=>(0,X().Il)({collectionContextStore:i,environment:f,intl:y})),[i,f,y]),V=(0,a().VK)((()=>{const e=i.collectionStore();return(!(null==e?void 0:e.inMemoryRecordCache.isTemporaryData)||null==v||!v.isPreviewing)&&(m.aggregations&&m.aggregations.length>0)}),[i,m,v]),T=(0,a().VK)((()=>function(e,t,o,n,r,i){const{device:l}=e,s=ri(o),a=Boolean(o.collection_group_by);return{display:"flex",alignItems:"center",fontSize:14,width:s,paddingLeft:rl,paddingRight:rl,marginRight:2*ol,marginBottom:t?4:0,boxSizing:"content-box",flexShrink:0,...n&&{padding:l.isMobile?"6px 16px":"8px 12px 4px",width:"none",minWidth:s},...i&&!t&&{backgroundColor:i.backgroundColor,...a?{borderRadius:nl}:{borderTopLeftRadius:nl,borderTopRightRadius:nl}}}}(f,d,r,u,0,b)),[f,d,r,u,p,b]);return(0,$.jsxs)("div",{style:T,onMouseMove:()=>function(e,t){e.state!==t&&e.setState(t)}(t,o),children:[(0,$.jsx)(si,{boardGroupHeaderProps:e}),V&&(0,$.jsx)(ui,{disabled:l,query:m,schema:n,collectionContextStore:i,groupFormat:o,hidden:d,boardSelectStyle:b}),(0,$.jsx)("div",{style:{flexGrow:1}}),!l&&C.canConfigureBlock&&(0,$.jsx)(pi,{hidden:d,groupFormat:o,currentGroups:g,format:r,schema:n,query:m,collectionContextStore:i,boardSelectStyle:b,isHovered:x}),w&&(0,$.jsx)(mi,{format:r,groupFormat:o,collectionContextStore:i,isFullScreen:S,hidden:d,isHovered:x,boardSelectStyle:b}),k&&(0,$.jsx)(gi,{groupFormat:o,collectionContextStore:i,hidden:d,isHovered:x,boardSelectStyle:b})]})};function li(e){let{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:s}=e;const a=s.boardColumnsLimitStore;return(0,$.jsx)(lr,{parent:t,groupFormat:o,currentGroups:n,format:r,query:l,schema:i,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:a})}function si(e){let{boardGroupHeaderProps:t}=e;const{groupFormat:o,schema:n,disabled:r,currentGroups:i,format:l,groupBy:c,collectionContextStore:d}=t,u=(0,s().O7)(),p=ri(l),m=(0,a().Kw)(d.permissionScopesStore);return(0,a().VK)((()=>d.groupsStore.getGroupState(o)),[d,o])?(0,$.jsx)(_r().Z,{groupBy:c,groupFormat:o,currentGroups:i,schema:n,disabled:r||!m.canConfigureBlock,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:n}=o,r=n.collectionStore();r&&(Xe().w$({...e,environment:t,groupsFormatKey:"board_columns",collectionStore:r,...o}),f().wd({environment:t,collectionContextStore:n,action:"rename_group"}))}(e,u,t),style:{maxWidth:p-70},collectionContextStore:d}):null}function ai(e,t,o){return!t&&o?o.textColor:e.lightTextColor}function ci(e,t){if(!e)return{transition:"opacity 100ms ease-in-out",opacity:t?1:0}}function di(e,t,o,n,r,i){const{device:l}=e;if(!(0,Oe().ww)(e))return;const s="collectionTypedView"===n.contextType,a=Boolean(t.collection_group_by);n.searchQueryStore.state&&V().Ug({searchQuery:"",collectionContextStore:n,isFullScreen:r});const c=n.groupsStore.getGroupState(o);if(!c)return;const d=c.resultsStore;w().createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:e,canUndo:!0,perform:t=>{const r=Xe().IW({environment:e,collectionContextStore:n,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,templateStore:n.defaultPageTemplateStore.state,transaction:t,from:{createBlock:"board_group_header"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(!r)return;const c=r.coercionSucceeded,u=r.newStore;if(l.isMobile){!function(e,t,o){o?o(e):Jo().c4({environment:t,url:e})}((0,ln().ZP)({store:u,pageVisitSource:Po().tY.Create}),e,i)}else if(c&&!a){const t=u.getBlockTitleStore();b().eP({environment:e,store:u}),C().setSelectionAtEnd({store:t}),V().Z5({store:u})}else _o().CH({environment:e,store:u,peekMode:(0,X().kr)(n),showMoveTo:s,resultsStore:d,collectionContextStore:n,pageVisitSource:Po().tY.Create});io().W(e,{from:"board_group_add_item_top",type:"page",new_page_id:u.id,creating_block_id:u.id,...(0,le().Pn)(n)})}})}function ui(e){let{disabled:t,query:o,schema:n,collectionContextStore:r,groupFormat:i,hidden:l,boardSelectStyle:d}=e;const u=(0,c().Fg)(),p=(0,s().O7)(),m=o.aggregations?o.aggregations[0]:void 0,g=(0,a().Kw)(r.permissionScopesStore);if(!m)return null;const S=ai(u,l,d);return(0,$.jsx)(ti,{groupFormat:i,disabled:t||!g.canConfigureBlock,aggregation:m,schema:n,collectionContextStore:r,color:S,onChange:e=>function(e,t,o,n){const r=t.collectionViewStore(),i={...o,aggregations:e?[e]:[]};r&&w().createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:n,canUndo:!0,perform:e=>{V().iG({collectionViewStore:r,update:{query2:i},transaction:e})}})}(e,r,o,p)})}function pi(e){let{hidden:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:a,boardSelectStyle:d,isHovered:u}=e;const p=(0,c().Fg)(),m=(0,s().O7)(),{device:g}=m,S=ai(p,t,d),h=ci(t,u);return(0,$.jsx)(vr().ZP,{popupType:g.isMobile?vr().Z4.SlideUp:vr().Z4.Popup,renderOrigin:e=>(0,$.jsx)(mt().Z,{icon:fn().o,iconStyle:{fill:S},style:h,...e}),render:e=>(0,$.jsx)(li,{parent:e,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:a})})}function mi(e){let{format:t,groupFormat:o,collectionContextStore:r,isFullScreen:i,hidden:l,isHovered:d,boardSelectStyle:u}=e;const p=(0,c().Fg)(),m=(0,s().O7)(),g=(0,qe().YB)(),S=(0,n.useContext)(Ln().Z),h=(0,n.useCallback)((()=>di(m,t,o,r,i,S)),[m,t,o,r,i,S]),f=(0,a().VK)((()=>{var e;return null===(e=r.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[r]),y=ai(p,l,u),v=ci(l,d),x=(0,Ur().sN)(f),b=g.formatMessage({defaultMessage:"Create new {newItemName}",id:"database.boardView.actions.addNewItem.tooltip"},{newItemName:x});return(0,$.jsx)(gt().Z,{renderTooltip:()=>b,render:e=>(0,$.jsx)(mt().Z,{icon:Go().R,onClick:h,style:v,iconStyle:{fill:y},ariaLabel:b,...e})})}function gi(e){let{groupFormat:t,collectionContextStore:o,hidden:n,isHovered:r,boardSelectStyle:i}=e;const l=(0,c().Fg)(),s=(0,qe().YB)(),d=(0,a().VK)((()=>{var e;return null===(e=o.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[o]),u=ai(l,n,i),p=ci(n,r),m=(0,Ur().sN)(d),g=s.formatMessage({defaultMessage:"Link existing {newItemName}",id:"database.boardView.actions.linkExistingItem.tooltip"},{newItemName:m});return(0,$.jsx)(No().a,{collectionContextStore:o,groupFormat:t,renderLinkButton:e=>(0,$.jsx)(gt().Z,{renderTooltip:()=>g,render:t=>(0,$.jsx)(mt().Z,{icon:Uo().v,style:p,iconStyle:{fill:u},...t,...e,ariaLabel:g})})})}var Si=()=>o(615634);const hi=30,fi=4,yi=10;function vi(e){const{hiddenGroupsVisibleStore:t}=e,o=(0,a().Kw)(t);return(0,$.jsx)(zo().Z,{onClick:function(){t.setState(!t.state)},onMouseDown:de().$0,style:{height:hi,marginBottom:fi,...e.style},icon:e=>(0,Si().i)({...e,...o&&{transform:"rotate(180deg)"}}),isLightGray:!0,children:(0,$.jsx)(qe()._H,{id:"collectionHiddenGroupsButton.hiddenGroupsButton.text",defaultMessage:"{numberOfHiddenGroups, plural, one {{numberOfHiddenGroups} hidden group} other {{numberOfHiddenGroups} hidden groups}}",values:{numberOfHiddenGroups:e.hiddenGroups.length}})})}function xi(e){const t=(0,a().VK)((()=>e.columnsDisplayState.visibleGroups.length*(ri(e.format)+2*rl+2*ol)),[e.columnsDisplayState.visibleGroups,e.format]);return(0,$.jsx)("div",{style:{display:"flex",minWidth:t},children:(0,$.jsx)(vi,{...e})})}const bi=30,Ci=4;function wi(e){let{type:t,visibleGroups:o,hiddenGroups:n,total:r,groupsLimitStore:i,schema:l,collectionContextStore:d,style:u}=e;const p=(0,s().O7)(),m=(0,c().Fg)(),g=(0,a().Kw)(d.normalizedFormatStore),S=(0,a().VK)((()=>(0,Ro().gf)({collectionContextStore:d,isForColumnGroups:"board"===t})),[d,t]),h=(0,a().VK)((()=>"board"===t?(0,Jt().II)({environment:p,groupFormat:void 0,schema:l,format:g,theme:m}):void 0),[p,g,l,m,t]),y=(0,c().yK)((e=>({hovered:{background:e.whiteButtonBackground},dots:{width:14,fill:e.mediumTextColor,marginLeft:4,marginTop:1,..."default"===t?{marginRight:8}:{}},..."board"===t?{button:{background:null==h?void 0:h.backgroundColor,color:e.mediumTextColor,fontWeight:Zt().Ue.medium,paddingLeft:8,paddingRight:8,height:33,marginRight:2*ol,borderRadius:nl,width:90,...u}}:{}})),[h,u,t]),v=Math.min(Jt().kW,r-n.length-o.length);return"default"===t?(0,$.jsxs)(zo().Z,{onClick:()=>function(e,t,o){o.setState(o.state+Jt().kW),t.loadingDetailsStore.setState({type:"load_more_groups"}),f().tf(e)}(p,d,i),onMouseDown:de().$0,disabled:S,hoveredStyle:S?y.hovered:{},style:{display:"flex",alignItems:"center",fontSize:14,borderRadius:4,height:bi,marginTop:Ci,marginBottom:Ci,paddingLeft:2,paddingTop:2,paddingBottom:2,paddingRight:8,...u},children:[(0,fn().o)(y.dots),(0,$.jsx)(qe()._H,{id:"database.groups.loadMoreButtonDefault.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:v}}),S&&(0,$.jsx)("div",{style:{marginTop:1,marginLeft:8},children:(0,$.jsx)(Zo().Z,{style:{width:12,height:12}})})]}):(0,$.jsxs)(zo().Z,{onClick:()=>function(e,t,o){o.setState(o.state+Jt().kW),t.loadingDetailsStore.setState({type:"load_more_columns"}),f().tf(e)}(p,d,i),onMouseDown:de().$0,disabled:S,hoveredStyle:S?y.hovered:{},style:y.button,children:[(0,$.jsx)("span",{style:{flexGrow:1},children:(0,$.jsx)(qe()._H,{id:"database.groups.loadMoreButton.text",defaultMessage:"{loadMoreAmount} more",values:{loadMoreAmount:v}})}),S?(0,$.jsx)("div",{style:{marginLeft:4},children:(0,$.jsx)(Zo().Z,{style:{width:12,height:12}})}):(0,fn().o)(y.dots)]})}const ki=n.memo(wi,Nt().Z);function Vi(e){const{format:t,isFullScreen:o,paddingLeft:n,isRootChild:r}=e,i=(0,s().O7)(),l=(0,a().VK)((()=>(0,Ft().C1)({environment:i,format:t,isFullScreen:o,isRootChild:r})),[i,t,o,r]),c=(0,a().VK)((()=>"collectionTypedView"===e.collectionContextStore.contextType),[e.collectionContextStore]),d=(0,a().VK)((()=>(0,Ft().fj)({environment:i,isRootChild:r,isFullScreen:o,format:t})?Ft().Qw:n),[i,t,o,r,n]);return l||c?null:(0,$.jsx)("div",{style:{width:"100%",height:hl+yl+fl,display:"flex"},children:(0,$.jsx)(bl,{type:"default",groupBy:e.groupBy,currentGroups:e.currentGroups,schema:e.schema,groupsLimitStore:e.groupsLimitStore,collectionContextStore:e.collectionContextStore,onAccept:e.onAccept,parentStore:e.parentStore,style:{position:"sticky",left:e.isFullScreen?d:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function Ti(e){const{format:t,isFullScreen:o,isRootChild:n,paddingLeft:r,hiddenGroups:i,hiddenGroupsVisibleStore:l,style:c}=e,d=(0,s().O7)(),u=(0,a().VK)((()=>(0,Ft().C1)({environment:d,format:t,isFullScreen:o,isRootChild:n})),[d,t,o,n]),p=(0,a().VK)((()=>(0,Ft().fj)({environment:d,isRootChild:n,isFullScreen:o,format:t})?Ft().Qw:r),[d,t,o,n,r]);return u?null:(0,$.jsx)("div",{style:{width:"100%",height:hi+fi+yi,display:"flex"},children:(0,$.jsx)(vi,{hiddenGroupsVisibleStore:l,hiddenGroups:i,style:{position:"sticky",left:o?p:3,width:"max-content",paddingLeft:4,paddingRight:8,...c}})})}function ji(e){const{format:t,isFullScreen:o,isRootChild:n}=e,r=(0,s().O7)(),i=(0,a().VK)((()=>(0,Ft().C1)({environment:r,format:t,isFullScreen:o,isRootChild:n})),[r,t,o,n]),l=(0,a().VK)((()=>(0,Ft().fj)({environment:r,isRootChild:n,isFullScreen:o,format:t})?Ft().Qw:e.paddingLeft),[r,t,o,n,e.paddingLeft]);return i?null:(0,$.jsx)("div",{style:{width:"100%",height:bi+2*Ci,display:"flex"},children:(0,$.jsx)(ki,{type:"default",visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:e.groupsLimitStore,schema:e.schema,collectionContextStore:e.collectionContextStore,style:{position:"sticky",left:o?l:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}var Ri=()=>o(827282);const Pi=(0,Ri().IU)("collectionGroupAccordion",{svg:(0,$.jsx)("path",{d:"M6.741 0a1 1 0 01.875 1.485l-2.742 4.94a1 1 0 01-1.748 0L.384 1.485A1 1 0 011.26 0h5.48z"}),viewBox:"0 0 8 7"});function Ii(e){const{width:t}=e,o=(0,s().O7)(),n=(0,a().VK)((()=>o.WindowSizeStore.state.width<=Yi),[o]),r=(0,c().yK)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:t},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${n?"100%":`${t}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,marginLeft:8,borderRadius:12,backgroundColor:e.lightDividerColor}})),[t,n]);return(0,$.jsxs)("div",{style:r.container,children:[(0,$.jsxs)("div",{style:r.groupContainer,children:[(0,$.jsx)("div",{style:r.iconContainer,children:Pi(r.icon)}),(0,$.jsx)(zn().Z,{style:r.groupShimmer})]}),(0,$.jsxs)("div",{style:r.itemsContainer,children:[(0,$.jsx)(Gn,{}),(0,$.jsx)(Gn,{}),(0,$.jsx)(Gn,{})]})]})}function _i(e){const{isFullScreen:t,galleryCoverSize:o}=e,n=t?2:1,r=(0,X().rD)(o),i=S().DZ(n,(e=>(0,$.jsx)(Ii,{width:r},e)));return(0,$.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:i})}function Mi(){const e=(0,c().yK)((e=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingLeft:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return(0,$.jsxs)("div",{style:e.container,children:[(0,$.jsxs)("div",{style:e.groupContainer,children:[(0,$.jsx)("div",{style:e.iconContainer,children:Pi(e.icon)}),(0,$.jsx)(zn().Z,{style:e.groupShimmer})]}),(0,$.jsxs)("div",{style:e.rowsContainer,children:[(0,$.jsxs)("div",{style:e.rowContainer,children:[(0,$.jsxs)("div",{style:e.firstColumn,children:[(0,$.jsx)(zn().Z,{style:e.circleShimmer}),(0,$.jsx)(zn().Z,{style:e.rowShimmerShort})]}),(0,$.jsx)("div",{style:e.column,children:(0,$.jsx)(zn().Z,{style:e.rowShimmerShort})}),(0,$.jsx)("div",{style:e.column,children:(0,$.jsx)(zn().Z,{style:e.rowShimmerShort})}),(0,$.jsx)("div",{style:e.column,children:(0,$.jsx)(zn().Z,{style:e.rowShimmerShort})})]}),(0,$.jsxs)("div",{style:e.rowContainer,children:[(0,$.jsxs)("div",{style:e.firstColumn,children:[(0,$.jsx)(zn().Z,{style:e.circleShimmer}),(0,$.jsx)(zn().Z,{style:e.rowShimmerLong})]}),(0,$.jsx)("div",{style:e.column,children:(0,$.jsx)(zn().Z,{style:e.rowShimmer})}),(0,$.jsx)("div",{style:e.column,children:(0,$.jsx)(zn().Z,{style:e.rowShimmer})}),(0,$.jsx)("div",{style:e.column,children:(0,$.jsx)(zn().Z,{style:e.rowShimmer})})]}),(0,$.jsxs)("div",{style:e.lastRowContainer,children:[(0,$.jsxs)("div",{style:e.firstColumn,children:[(0,$.jsx)(zn().Z,{style:e.circleShimmer}),(0,$.jsx)(zn().Z,{style:e.rowShimmerLong})]}),(0,$.jsx)("div",{style:e.column,children:(0,$.jsx)(zn().Z,{style:e.rowShimmer})}),(0,$.jsx)("div",{style:e.column,children:(0,$.jsx)(zn().Z,{style:e.rowShimmer})}),(0,$.jsx)("div",{style:e.column,children:(0,$.jsx)(zn().Z,{style:e.rowShimmer})})]})]})]})}function Bi(e){const{isFullScreen:t}=e,o=t?2:1,n=S().DZ(o,(e=>(0,$.jsx)(Mi,{},e)));return(0,$.jsx)("div",{style:{display:"flex",paddingTop:8,paddingLeft:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"},children:n})}function Fi(){const e=(0,c().yK)((e=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,$.jsxs)("div",{style:e.rowsContainer,children:[(0,$.jsx)("div",{style:e.rowContainer,children:(0,$.jsx)(zn().Z,{style:e.rowShimmerShort})}),(0,$.jsx)("div",{style:e.rowContainer,children:(0,$.jsx)(zn().Z,{style:e.rowShimmer})})]})}var Ki=()=>o(717940);function Oi(){const e=(0,c().yK)((e=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor}})),[]),t=(0,E().DK)(),o=(0,a().VK)((()=>null==t?void 0:t.isInHomeWidgetStore.state),[t]),n=["50%","30%","40%"].map(((e,t)=>(0,$.jsx)(Ki().G,{widthPercentage:e,isInHomeWidget:o},t)));return(0,$.jsxs)("div",{style:e.container,children:[(0,$.jsxs)("div",{style:e.groupContainer,children:[(0,$.jsx)("div",{style:e.iconContainer,children:Pi(e.icon)}),(0,$.jsx)(zn().Z,{style:e.groupShimmer})]}),(0,$.jsx)("div",{style:e.rowsContainer,children:n})]})}function Li(e){const{isFullScreen:t}=e,o=t?2:1,n=S().DZ(o,(e=>(0,$.jsx)(Oi,{},e)));return(0,$.jsx)("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},children:n})}function Di(e){const{viewType:t,isFullScreen:o,galleryCoverSize:n}=e;if(!(0,Bn().Z)(!0,0,100))return null;switch(t){case"table":return(0,$.jsx)(Bi,{isFullScreen:o});case"list":return(0,$.jsx)(Li,{isFullScreen:o});case"gallery":return(0,$.jsx)(_i,{isFullScreen:o,galleryCoverSize:n});case"timeline":return(0,$.jsx)(Fi,{});default:return null}}const Ei=new Set(["dropzone","table"]),Ai=new Set(["item","table"]);function Hi(e){const{collectionContextStore:t,timelineProps:r}=e,i=(0,s().O7)(),l=(0,fe().E)("collection_test_removing_hidden_groups"),{collectionViewBlockStore:c,viewType:d}=(0,a().VK)((()=>{var e;return{collectionViewBlockStore:t.collectionViewBlockStore(),viewType:null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()}}),[t]),u=(0,a().Kw)(t.permissionScopesStore),p=(0,a().Kw)(t.normalizedFormatStore),m=null==p?void 0:p.app_config_uri,g=null==p?void 0:p.collection_group_by,S=null==p?void 0:p.board_columns_by,h=(0,a().Kw)(t.groupsLimitStore),f=(0,a().Kw)(t.boardColumnsLimitStore),y=(0,a().Kw)(t.normalizedSchemaStore),v=(0,a().VK)((()=>t.normalizedQueryStore.state??{}),[t.normalizedQueryStore]),x=(0,a().VK)((()=>{if(g)return(0,zt().Qq)({schema:y,groupBy:g})}),[g,y]),b=(0,a().Kw)(t.relativeVariableStore),C=(0,a().VK)((()=>{if(g&&p&&(null==r||!r.type||!Ei.has(null==r?void 0:r.type)))return(0,Jt().ej)({groupBy:g,schema:y,format:p,groupsFormatKey:zt().Uh,limit:h})}),[g,p,r,y,h]),w=(0,a().qz)(null==r?void 0:r.reducerResultStore,Zr),k=(0,a().qz)(null==r?void 0:r.hiddenGroupsVisibleStore,Ar),V=(0,a().Kw)(k),T=(0,a().SI)((()=>{if(!c||!g)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const e=w.state;if("v2"===(null==e?void 0:e.version)){const t=e.results.filter((e=>e.visible)).map((e=>({property:g.property,value:e.value})));return{currentGroups:t,visibleGroups:t,hiddenGroups:[],total:t.length}}const o=(0,Jt().Cz)({groupBy:g,schema:y,schemaGroups:x,formatGroups:(null==p?void 0:p[zt().Uh])||[],reducerResults:null==e?void 0:e.results,getRecordModel:c.getRecordModel,relativeVariableResult:b,viewAppConfigUri:m,allowedCollectionStores:t.collectionStoresStore.state}),n=o.filter((e=>!(0,zt().eF)(e))).slice(0,h),r=o.filter((e=>(0,zt().eF)(e))),i=e?e.total:0;return{currentGroups:[...n,...r],visibleGroups:n,hiddenGroups:r,total:i}}),[c,t,p,g,h,w,b,y,x,m],{useDeepEqual:!0}),j=(0,a().Kw)(T,{debugName:"groupsDisplayState"}),R=(0,a().VK)((()=>{const e=w.state;if(!c||!S)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};if("v2"===(null==e?void 0:e.version)){const t=e.results.filter((e=>e.visible)).map((e=>({property:S.property,value:e.value})));return{currentGroups:t,visibleGroups:t,hiddenGroups:[],total:t.length}}const o=(0,Jt().Cz)({groupBy:g,schema:y,schemaGroups:x,formatGroups:(null==p?void 0:p.board_columns)||[],reducerResults:null==e?void 0:e.results,getRecordModel:c.getRecordModel,relativeVariableResult:b,viewAppConfigUri:m,allowedCollectionStores:t.collectionStoresStore.state}),n=o.filter((e=>!(0,zt().eF)(e))).slice(0,f),r=o.filter((e=>(0,zt().eF)(e))),i=e?e.total:0;return{currentGroups:[...n,...r],visibleGroups:n,hiddenGroups:r,total:i}}),[f,c,t,p,g,S,w,b,y,x,m],{useDeepEqual:!0}),P=n.useCallback((()=>{const e=t.normalizedFormatStore.state;if(""!==t.searchQueryStore.state)return;(0,oo().yU)(t)||Xe().$D({environment:i,format:e,groupsFormatKey:zt().Uh,collectionContextStore:t,currentGroups:T.state.currentGroups})}),[t,i,T]),I=(0,qo().v)(P,5e3);n.useEffect((()=>{if(null==r||!r.type||!Ei.has(null==r?void 0:r.type))return T.addListener(I),()=>{T.removeListener(I),I.cancel()}}),[T,I,r]);const _=(0,a().VK)((()=>T.state.hiddenGroups.slice(0,Jt().ew)),[T]),M=(0,a().VK)((()=>!(null!=r&&r.type&&Ai.has(null==r?void 0:r.type))&&(0,Ro().vq)({collectionContextStore:t,displayState:j})),[t,j,r]),B=(0,a().VK)((()=>{const{visibleGroups:e}=j;return 0===e.length&&!t.shouldShowSpinnerStore.state||e.length>0}),[t,j]),F=(0,a().VK)((()=>{const{total:e,hiddenGroups:o}=j;return h<e-o.length&&B||(0,Ro().gf)({collectionContextStore:t,isForColumnGroups:!1})}),[B,t,j,h]),K=(0,a().VK)((()=>!e.disabled&&!u.isLocked&&u.canConfigureBlock&&!M&&g&&(0,zt().Wz)(g,u.canConfigureCollection)&&"collectionTypedView"!==t.contextType&&!(0,o(15607).w)(g.property)&&B),[B,t,u.canConfigureBlock,u.canConfigureCollection,u.isLocked,e.disabled,g,M]),O=(0,a().VK)((()=>je().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]);if(!p)return null;const L=(0,$.jsxs)("div",{style:{position:"relative"},children:[(0,$.jsx)(zi,{groups:j.visibleGroups,groupBy:g,groupsDisplayState:j,format:p,schema:y,query:v,reducerId:e.reducerId,store:e.store,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,timelineProps:r}),M&&(0,$.jsx)(Di,{viewType:d,isFullScreen:e.isFullScreen,galleryCoverSize:p.gallery_cover_size}),F&&(0,$.jsx)(Gi,{timelineType:null==r?void 0:r.type,collectionContextStore:e.collectionContextStore,schema:y,format:p,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,groupsDisplayState:j}),_.length>0&&!l&&(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(Ni,{reducerId:e.reducerId,timelineType:null==r?void 0:r.type,format:p,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,columnsDisplayState:R,hiddenGroups:_,hiddenGroupsVisibleStore:k}),V&&(0,$.jsx)(zi,{groups:_,groupBy:g,groupsDisplayState:j,format:p,schema:y,query:v,reducerId:e.reducerId,store:e.store,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,timelineProps:r})]}),K&&(0,$.jsx)(Wi,{timelineType:null==r?void 0:r.type,store:e.store,collectionContextStore:e.collectionContextStore,schema:y,format:p,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,groupsDisplayState:j,groupBy:g})]});return C?(0,$.jsx)(Xt().Z,{id:e.reducerId,reducer:C,collectionContextStore:e.collectionContextStore,resultStore:w,render:()=>L,debounceWait:O}):L}const Zi=n.memo(Hi,Nt().Z);function zi(e){const t=(0,a().VK)((()=>e.collectionContextStore.groupsStore.getGroupState),[e.collectionContextStore.groupsStore]),o=(0,a().Kw)(e.collectionContextStore.isInPeekRendererStore);return(0,$.jsx)($.Fragment,{children:e.groups.map(((n,r)=>t&&e.groupBy?(0,$.jsx)(Nr,{collectionContextStore:e.collectionContextStore,groupsDisplayState:e.groupsDisplayState,groupFormat:n,groupBy:e.groupBy,disabled:e.disabled,groupsFormatKey:zt().Uh,groupAggregationKey:zt().dQ,format:e.format,schema:e.schema,query:e.query,isInPeekRenderer:o,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,getGroupStyle:e.getGroupStyle,index:r,isLast:r===e.groups.length-1},(0,zt().mD)(n)):null))})}function Gi(e){const t=(0,a().VK)((()=>e.collectionContextStore.groupsLimitStore),[e.collectionContextStore]);return"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,$.jsx)(ji,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:t,visibleGroups:e.groupsDisplayState.visibleGroups,hiddenGroups:e.groupsDisplayState.hiddenGroups,total:e.groupsDisplayState.total,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft}):(0,$.jsx)("div",{style:{display:"flex"},children:(0,$.jsx)(ki,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:t,visibleGroups:e.groupsDisplayState.visibleGroups,hiddenGroups:e.groupsDisplayState.hiddenGroups,total:e.groupsDisplayState.total,style:e.stickyLeft?{position:"sticky",left:e.paddingLeft}:void 0})})}function Wi(e){const t=(0,s().O7)(),o=(0,a().VK)((()=>e.collectionContextStore.groupsLimitStore),[e.collectionContextStore]),r=n.useCallback(((e,t,o,n,r)=>{const i=o.collectionStore();i&&Xe().tH({update:e,collectionContextStore:o,groupsFormatKey:zt().Uh,collectionStore:i,environment:t,groupBy:n,schema:r})}),[]);return"dropzone"!==e.timelineType&&e.groupBy?"item"===e.timelineType?(0,$.jsx)(Vi,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):(0,$.jsx)(bl,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,paddingLeft:e.paddingLeft,stickyLeft:!0,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):null}function Ni(e){return"board_collection_groups"===e.reducerId?(0,$.jsx)(xi,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,format:e.format,columnsDisplayState:e.columnsDisplayState}):"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,$.jsx)(Ti,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,style:{marginTop:yi}}):(0,$.jsx)("div",{style:{display:"flex"},children:(0,$.jsx)(vi,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,style:{marginTop:yi,...e.stickyLeft?{position:"sticky",left:e.paddingLeft}:{}}})})}function Ui(e){let{collectionContextStore:t,store:o,format:r,disabled:i,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:d,paddingLeft:u,isRootChild:p,collectionGalleryViewStore:m}=e;const g=(0,c().Fg)(),S=(0,s().O7)(),{isMobile:h}=(0,s().Fy)(),f=(0,n.useCallback)((e=>(0,$.jsx)(qi,{args:e})),[]),y=(0,n.useCallback)((e=>{if(h)Io()._c({environment:S,store:e,pageVisitSource:Po().tY.Create});else{const o="collectionTypedView"===t.contextType;_o().CH({environment:S,store:e,peekMode:X().kr(t),showMoveTo:o,resultsStore:void 0,collectionContextStore:t,pageVisitSource:Po().tY.Create})}}),[t,S,h]),v=(0,n.useCallback)((e=>(0,$.jsx)(Un,{store:o,format:r,disabled:i,collectionContextStore:t,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:d,collectionGalleryViewStore:m,groupFormat:e})),[o,r,i,t,l,a,d,m]),x=(0,n.useCallback)((e=>0===e.index?{}:{borderTop:`1px solid ${g.tableDividerColor}`}),[g]);return(0,$.jsx)(Zi,{reducerId:"gallery_groups",store:o,collectionContextStore:t,disabled:i,isFullScreen:d,isRootChild:p,paddingLeft:u,stickyLeft:!1,renderHeader:f,onGroupHeaderAddItem:y,renderGroup:v,getGroupStyle:x})}const $i=n.memo(Ui);function qi(e){let{args:t}=e;const o=(0,a().Kw)(t.collectionContextStore.isInHomeWidgetStore),{stickyStyle:n}=(0,c().yK)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${e.contentBackground}`}})),[]);return(0,$.jsx)(Fr,{...t,height:o?tt().yZ:48,stickyStyle:n})}const Yi=480,Qi=40;function Xi(e){const{store:t,format:o,collectionContextStore:r,isFullScreen:i,isPreviewing:l,isRootChild:d,blockPropertyValueOverlayStore:u,disabled:p,schema:m,paddingBottom:g,paddingLeft:S,paddingRight:h,minWidth:f}=e,y=(0,s().O7)(),{isMobile:v}=(0,s().Fy)(),x=(0,n.useRef)(null),b=(0,a().qz)(void 0,On);(0,a().Kw)(b);const{coverWidth:C,coverHeight:w}=(0,a().Kw)(b),k=(0,a().VK)((()=>X().az(r,i)),[r,i]),V=(0,a().Kw)(r.isInHomeWidgetStore),T=(0,a().VK)((()=>!!r.viewsModuleContextStore.getViewModuleType()),[r]),j=(0,n.useCallback)((()=>{if(x.current){const e=x.current.getNode();if(e){const t=e.querySelector(`.${ie().K4T}`);if(null!==t&&t instanceof HTMLDivElement)return t.offsetWidth}}return X().rD(o.gallery_cover_size)}),[o.gallery_cover_size]),R=(0,n.useCallback)((e=>{b.setState({coverHeight:w,coverWidth:e||j()})}),[b,w,j]),P=(0,n.useCallback)((()=>j()*(9/16)),[j]),I=(0,n.useCallback)((e=>{b.setState({coverWidth:C,coverHeight:e||P()})}),[b,C,P]),_=(0,n.useCallback)((e=>{var t;const o=r.isLoadingStore.state,n=null===(t=r.groupsStore.getGroupState([]))||void 0===t||null===(t=t.reducerResultStore)||void 0===t?void 0:t.state;e<Te().Z.incrementScrollOffset&&n&&!o&&null!=n&&n.hasMore&&Xe().ID({collectionContextStore:r,environment:y,incrementLimitArgs:{isFullScreen:i,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[r,y,i]),M=(0,n.useCallback)((()=>{const e=P(),t=j();w!==e&&I(e),C!==t&&R(t)}),[P,j,w,C,I,R]),B=(0,qo().y)(M,100),F=(0,Qo().z)(M,100);(0,n.useEffect)((()=>{R(j()),I()}),[j,I,R,null==o?void 0:o.gallery_cover_size]),(0,n.useEffect)((()=>((0,ce().lj)(window,"resize",F),v&&(0,ce().lj)(window,"orientationchange",B),()=>{(0,ce().ZV)(window,"resize",F),v&&(0,ce().ZV)(window,"orientationchange",B)})),[B,F,v]);const K=(0,c().yK)((()=>({container:{paddingBottom:g,paddingLeft:S,paddingRight:h,minWidth:f}})),[f,g,S,h]),O=o.collection_group_by;return(0,Fn().Z)((e=>(0,$.jsxs)("div",{style:K.container,className:ie().sbt,children:[(0,$.jsx)(ze().Z,{store:t,shouldShowHalo:!i&&!V,canSelect:!i&&!T,disablePointerEvents:l,analyticsName:"gallery",...e,ref:x,children:O?(0,$.jsx)($i,{blockPropertyValueOverlayStore:u,collectionContextStore:r,collectionGalleryViewStore:b,disabled:p,format:o,isFullScreen:i,isRootChild:d,paddingLeft:S,schema:m,store:t}):(0,$.jsx)(Un,{blockPropertyValueOverlayStore:u,collectionContextStore:r,collectionGalleryViewStore:b,disabled:p,format:o,groupFormat:void 0,isFullScreen:i,schema:m,store:t})}),!k&&(0,$.jsx)(jo().Z,{onChange:_})]})))}const Ji=n.memo(Xi);function el(e){const t=e.minHeight||Qi,o=(0,c().yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:nl,backgroundColor:e.largeShimmerColor,minHeight:t,width:"100%",marginBottom:4}})),[t]);return(0,$.jsx)(zn().Z,{style:o.card})}function tl(){return(0,Bn().Z)(!0,0,100)?(0,$.jsx)(el,{}):null}const ol=5,nl=10,rl=7,il=rl+32;function ll(e,t){return t?0:e?8:12}const sl=function(e){let{groupsPointer:t,schema:o,format:n,collectionContextStore:r,store:i,disabled:l,blockPropertyValueOverlayStore:d,isFullScreen:u,anyGroupHasResults:p,isInPeekRenderer:m,hoveredGroupStore:g}=e;const h=(0,c().Fg)(),f=(0,s().O7)(),y=(0,qe().YB)(),{isMobile:v}=(0,s().Fy)(),b=(0,a().VK)((()=>{const e=S().Z$(t);return(0,Jt().II)({environment:f,groupFormat:e,schema:o,format:n,theme:h})}),[t,o,n,f,h]),C=(0,a().VK)((()=>{const e=r.groupsStore.getGroupState(t);return Boolean(null==e?void 0:e.reducerResultStore.state)}),[t,r]),k=(0,a().VK)((()=>r.groupsStore.getGroupState(t)),[r,t]),V=(0,a().VK)((()=>(0,X().az)(r,u)),[r,u]),T=(0,a().VK)((()=>null==k?void 0:k.reducerResultStore.state),[k]),j=(0,a().Kw)(r.permissionScopesStore),R=(0,a().Kw)(r.isInHomeWidgetStore),P=(0,a().VK)((()=>!l&&C&&r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!R})),[l,C,r,R]),I=(0,a().VK)((()=>(0,X().VM)({reducerResult:T,collectionContextStore:r,isFullScreen:u})),[T,r,u]),_=(0,a().VK)((()=>(0,Ro().H0)({collectionContextStore:r,groupsPointer:t,hasPartialResults:p})),[r,t,p]),M=(0,a().VK)((()=>p&&r.shouldShowSpinnerStore.state&&"load_general"===r.loadingDetailsStore.state.type),[r,p]),B=(0,a().VK)((()=>(0,X().Il)({collectionContextStore:r,environment:f,intl:y})),[f,r,y]),F=(0,a().VK)((()=>f.device.isMobile||(0,zt().ZH)(g.state,S().Z$(t))),[g,t,f]),K=(0,c().yK)((e=>({loadMoreButton:{borderRadius:nl,fontSize:v?16:14,padding:"5px 4px 5px 11px",height:void 0},loadMoreButtonIcon:{width:v?16:14,height:v?16:14}})),[v]);if(!k)return null;const O=function(e){return e?e.board_cover:void 0}(n),L=!l&&!j.isSyncedCollection,D=Boolean(n.collection_group_by),E=!p&&D&&_;return(0,$.jsxs)("div",{style:Sl(n,m,C,b),onMouseDown:e=>function(e,t){const{device:o}=t,{target:n}=e;!o.isMobile&&n instanceof HTMLElement&&(0,de().ZP)({event:e,context:de().Af.EditorMouseDown,callback:()=>{e.preventDefault(),x().AI({environment:t,target:n,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,f),onClick:pl,className:ie().GfL,onMouseMove:()=>function(e,t){const o=S().Z$(e);o&&t.state!==o&&t.setState(o)}(t,g),children:[(0,$.jsx)(xo,{collectionContextStore:r,groupsPointer:t,format:n,canDrag:L,onSelectableEnter:e=>ml(e,t,r,u,f),resultProps:{format:n,schema:o,onTextEnter:e=>function(e,t,o,n,r,i){if(!(0,Oe().ww)(i)||!o.collectionStore())return gl(e,o,r,t,i);const l=ul(t,o);if(!l)return;const s=l.state.findIndex((t=>t===e))+1;w().createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:i,canUndo:!0,perform:e=>{Mo({transaction:e,environment:i,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:s,from:"board_group_enter_add_item",transient:!0})}})}(e,t,r,u,i,f),onShiftEnter:e=>ml(e,t,r,u,f),coverFormat:O,coverAspectFormat:al(n),coverSizeFormat:cl(n),colorStyle:b,onTextEsc:e=>gl(e,r,i,t,f),disabled:l,blockPropertyValueOverlayStore:d,collectionContextStore:r},canDrop:!0,resultComponent:Mn,disabled:l,direction:yo.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:D?rl:3,analyticsName:"board",loadContentCover:O&&"page_content"===O.type}),E&&(0,$.jsx)(tl,{}),I&&(0,$.jsx)(Ut().ZP,{groupsPointer:t,store:i,collectionContextStore:r,format:n,isFullScreen:u,incrementLimitsInRelatedGroups:!0,style:K.loadMoreButton,iconStyle:K.loadMoreButtonIcon}),P&&(0,$.jsxs)($.Fragment,{children:[I&&(0,$.jsx)("div",{style:{width:"100%",borderTop:`1px solid ${h.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,$.jsx)(Wo,{groupsPointer:t,collectionContextStore:r,isFullScreen:u,color:null==b?void 0:b.textColor,shouldShowSpinner:M})]}),B&&(0,$.jsx)($o,{groupFormat:S().Z$(t),collectionContextStore:r,color:null==b?void 0:b.textColor,isHovered:F}),!V&&(0,$.jsx)(jo().Z,{onChange:e=>function(e,t,o,n,r){const i=t.isLoadingStore.state,l=t.groupsStore.getGroupState(n),s=null==l?void 0:l.reducerResultStore.state;e<Te().Z.incrementScrollOffset&&!i&&s&&s.hasMore&&(Xe().ID({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:o,currentResultCount:s.blockIds.length,groupsPointer:n,incrementLimitsInRelatedGroups:!1}}),t.loadingDetailsStore.setState({type:"load_general"}))}(e,r,u,t,f)})]})};function al(e){return e?e.board_cover_aspect:void 0}function cl(e){return e?e.board_cover_size:void 0}function dl(e){const t=e.board_cover_size;return(0,X().rD)(t)}function ul(e,t){const o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}function pl(e){(0,de().ZP)({event:e,context:de().Af.EditorClick,callback:()=>{}})}function ml(e,t,o,n,r){const{blocks:i,transaction:l}=e;if(0===i.length)return;const s=i[0];if(!(0,Oe().ww)(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const a=ul(t,o);if(!a)return;Mo({transaction:l,environment:r,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:a.state.findIndex((e=>e===s))+1,from:"board_group_enter_add_item",transient:!0})}function gl(e,t,o,n,r){const i=t.collectionStore(),l=e.getTitleStore();if(!l)return;if(it().QaF(l.getValue()))b().Ys({environment:r,store:e});else if(i){const i=ul(n,t);if(!i)return;const l=i.state.findIndex((t=>t===e))-1,s=t.collectionViewStore(),a=t.collectionViewBlockStore();if(s&&a&&j().sG(r,{...(0,le().Pn)(t),block_id:o.id}),w().createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:r,canUndo:!0,perform:t=>{Xe().Od({store:e,transaction:t})}}),l>=0){const e=i.state[l];b().Ys({environment:r,store:e})}}}function Sl(e,t,o,n){const r=Boolean(e.collection_group_by);return{flex:"none",paddingLeft:rl,paddingRight:rl,paddingBottom:rl,marginRight:2*ol,boxSizing:"content-box",width:dl(e),height:r?void 0:"max-content",...n&&o&&{backgroundColor:n.backgroundColor,...r?{borderRadius:nl}:{borderBottomLeftRadius:nl,borderBottomRightRadius:nl}}}}const hl=28,fl=12,yl=4,vl=(0,qe().vU)({iconAriaLabel:{defaultMessage:"Add a group",id:"database.collectionAddGroupButton.ariaLabel"}});function xl(e){let{type:t,style:r,groupBy:i,currentGroups:l,schema:d,groupsLimitStore:u,collectionContextStore:p,parentStore:m,onAccept:g,paddingLeft:S,stickyLeft:y}=e;const v=(0,s().O7)(),x=(0,c().Fg)(),b=(0,a().qz)(void 0,ke().Z),C=d[i.property],w=(0,a().VK)((()=>(0,Jt().II)({environment:v,groupFormat:void 0,schema:d,format:p.normalizedFormatStore.state,theme:x})),[p,v,d,x]),k=(0,c().yK)((e=>({plusIcon:{fill:e.mediumTextColor},iconButton:{width:35,background:null==w?void 0:w.backgroundColor,paddingLeft:10,paddingRight:10,paddingTop:rl,paddingBottom:rl,marginRight:ol,borderRadius:nl,height:33,...r}})),[w,r]),V=(0,n.useCallback)((e=>{!function(e){let{schema:t,groupBy:o,currentGroups:n,groupsLimitStore:r,collectionContextStore:i,onAccept:l,environment:s,buttonPopupStore:a,update:c}=e;const{newGroupValue:d}=c,u=t[o.property],p=r.state;if(!u||!(0,zt().LG)(u))return;if(f().wd({environment:s,collectionContextStore:i,action:"board_add_group"}),a.reset(),Gt().cu(u)){if(u.type!==d.type)return;if(void 0===d.value)return;const e=u.options||[],r={id:Wt().Il(),value:d.value,color:(0,Gt().TL)(e)},i=[...e,r],s={...u,options:i},a={...t,[o.property]:s},c={property:o.property,value:d,hidden:!1};return void l({newGroups:(0,Jt().nr)(n,c,p),newSchema:a})}if("person"===u.type||"relation"===u.type||(0,zt().HB)(u.type)){const e={property:o.property,value:d,hidden:!1};return void l({newGroups:(0,Jt().nr)(n,e,p),newPage:c.newPage})}if((0,zt().A1)(u.type)||"status"===u.type||"number"===u.type||"created_by"===u.type||"last_edited_by"===u.type||"formula"===u.type||"checkbox"===u.type||"location"===u.type)return;(0,h().t1)(u.type)}({schema:d,groupBy:i,currentGroups:l,groupsLimitStore:u,collectionContextStore:p,onAccept:g,environment:v,buttonPopupStore:b,update:e})}),[b,p,l,v,i,u,g,d]),T=(0,n.useCallback)((()=>{!function(e){e.reset()}(b)}),[b]),j=(0,n.useCallback)((()=>(0,$.jsx)(o(69222).Q,{groupFormat:void 0,groupBy:i,currentGroups:l,schema:d,onChange:V,onClose:T,parentStore:m})),[l,i,V,T,m,d]);return C&&(0,zt().LG)(C)?(0,$.jsx)(vr().ZP,{render:j,buttonPopupStore:b,popupType:v.device.isMobile?vr().Z4.SlideUp:vr().Z4.Popup,renderOrigin:e=>"default"===t?(0,$.jsx)(zo().Z,{isLightGray:!0,icon:Go().R,style:{display:"flex",height:hl,marginTop:fl,marginBottom:yl,width:"max-content",position:y?"sticky":void 0,left:y&&S?S:0,...r},...e,children:(0,$.jsx)(qe()._H,{defaultMessage:"Add a group",id:"database.boardView.addGroupButtonTitle"})}):(0,$.jsx)(mt().Z,{ariaLabel:nt().Z.formatMessage(vl.iconAriaLabel),icon:e=>(0,Go().R)({...e,...k.plusIcon}),style:k.iconButton,...e})}):null}const bl=n.memo(xl,Nt().Z);var Cl=()=>o(119891);const wl=n.memo((function(e){let{render:t,collectionContextStore:o,groupsResultStore:n,groupsReducer:r}=e;return r?(0,$.jsx)(Xt().Z,{id:"board_columns",reducer:r,collectionContextStore:o,resultStore:n,render:t}):(0,$.jsx)($.Fragment,{children:t()})}));var kl=()=>o(661297);const Vl=16;function Tl(e){const t=(0,c().yK)((()=>({button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[]);return(0,$.jsx)(pt().Z,{style:t.button,onClick:e.onClick,children:e.children})}const jl=function(e){const{title:t,description:o,icon:n,style:r,buttonText:i,buttonOnClick:l}=e,s=(0,Bn().Z)(!0,300,0),a=(0,c().yK)((e=>({wrapper:{minHeight:250,height:1,display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center",padding:Vl,...r},title:{fontSize:17,fontWeight:Zt().Ue.medium,color:e.lightTextColor,textAlign:"center",marginBottom:-2},description:{margin:"0 auto",fontSize:14,color:e.lightTextColor},button:{marginTop:12,fontSize:14,fontWeight:Zt().Ue.medium,color:e.regularTextColor}})),[r]);return s?(0,$.jsxs)("div",{style:a.wrapper,children:[n,(0,$.jsx)("div",{style:a.title,children:t}),o?(0,$.jsx)("div",{style:a.description,children:o}):void 0,i?(0,$.jsx)(kl().Z,{onClick:l,style:a.button,children:i}):void 0]}):null},Rl=n.memo((function(e){const{collectionContextStore:t,isFullScreen:o,paddingLeft:r,paddingRight:i,paddingBottom:l}=e,s=(0,a().Kw)(t.permissionScopesStore),c=t.settingsStore,d=(0,n.useCallback)((()=>{y().r$({collectionContextStore:t,collectionSettingsStore:c}),y().H4({collectionSettingsStore:c,item:{type:"properties",timelineViewTab:"table"}})}),[t,c]);return(0,$.jsx)(jl,{title:(0,$.jsx)(qe()._H,{defaultMessage:"No group by property",id:"database.boardView.missingSelectPropertyTitle"}),description:s.canConfigureBlock?(0,$.jsx)(qe()._H,{defaultMessage:"<opensettingslink>Add a property to group by</opensettingslink> to your database in order to display a Board view.",id:"database.boardView.missingSelectProperty",values:{opensettingslink:e=>(0,$.jsx)(Tl,{onClick:d,children:e})}}):(0,$.jsx)(qe()._H,{defaultMessage:"Board views require a property to group by in order to display.",id:"database.boardView.missingSelectPropertyNoPermissions"}),style:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:l}})}));function Pl(e){const{height:t,boardCoverSize:o,showGroupHeader:n,areColumnsColored:r}=e,i=e.numBoardColumns||3,l=function(e){const t=2*rl;return(0,X().rD)(e)+t}(o),s=(0,c().yK)((e=>({container:{display:"flex",alignItems:"flex-start",paddingTop:n?10:0},groupHeader:{backgroundColor:e.largeShimmerColor,height:16,marginBottom:10,borderRadius:12,width:"50%"},group:{marginTop:n?r?20:8:0,marginRight:10,width:"100%",minWidth:l}})),[r,n,l]),a=S().DZ(i,(e=>(0,$.jsxs)("div",{style:s.group,children:[(0,$.jsx)(zn().Z,{style:s.groupHeader}),(0,$.jsx)(el,{minHeight:t})]},e)));return(0,$.jsx)("div",{style:s.container,children:a})}const Il=n.memo((function(e){let{format:t,schema:o,collectionContextStore:n,store:r,columnsDisplayStateForCurrentGroups:i}=e;const l=(0,s().O7)(),c=(0,a().VK)((()=>n.contextType),[n]);return t.board_columns_by?"collectionTypedView"===c?null:(0,$.jsx)(bl,{groupBy:t.board_columns_by,schema:o,currentGroups:i,onAccept:e=>function(e,t,o,n,r){const i=t.collectionStore();if(!i)return;const l=n.board_columns_by;if(!l)return;Xe().tH({update:e,collectionContextStore:t,groupsFormatKey:"board_columns",collectionStore:i,schema:o,groupBy:l,environment:r})}(e,n,o,t,l),groupsLimitStore:n.boardColumnsLimitStore,parentStore:r,type:"board",collectionContextStore:n}):null}));var _l=()=>o(543172);function Ml(e,t){const{visibleGroups:o,hiddenGroups:n,total:r}=e,i=0===o.length&&!t.shouldShowSpinnerStore.state||o.length>0,l=(0,Ro().gf)({collectionContextStore:t,isForColumnGroups:!0}),s=t.boardColumnsLimitStore.state<r-n.length;return i&&s||l}function Bl(e,t,o){const{visibleGroups:n}=e,r=t.board_columns_by,i=o.permissionScopesStore.state,l=0===n.length&&!o.shouldShowSpinnerStore.state||n.length>0;return i.canConfigureBlock&&r&&(0,zt().Wz)(r,i.canConfigureCollection)&&!i.isSyncedCollection&&l}function Fl(e,t,o){return{marginLeft:e,marginRight:t,float:"left",minWidth:"100%",paddingBottom:o}}function Kl(e){return{display:"flex",position:"relative",flexGrow:1,paddingBottom:e}}function Ol(e){return{marginTop:4,...e.isLast&&{paddingBottom:12}}}function Ll(e,t,o){return{height:"calc(100% + 17px)",...o?{}:{background:e?t.cardContentBackground:t.contentBackground},width:20,marginLeft:-20,marginTop:-17}}const Dl=n.memo((function(e){const{collectionContextStore:t,columnsDisplayState:o,currentGroups:r,disableBoardColorColumns:i,disabled:l,format:d,headerPlaceholderHeight:u,hiddenGroups:p,hiddenGroupsHeaderRef:m,hoveredGroupStore:g,isFullScreen:S,isInPeekRenderer:h,isRootChild:f,paddingLeft:y,paddingRight:v,query:x,schema:b,store:C,visibleGroups:w}=e,k=(0,s().O7)(),V=(0,c().Fg)(),T=(0,fe().E)("collection_test_removing_hidden_groups"),j=(0,n.useRef)(null),R=(0,a().VK)((()=>(0,Jt().qW)({device:k.device,isFullScreen:S,isRootChild:f})),[k.device,S,f]),P=function(e,t,o,n){const r=(0,X().jw)(t,e);return(0,a().VK)((()=>{const i=t.isInHomeWidgetStore.state,l=i?"transparent":(null==r?void 0:r.background)||(o?e.cardContentBackground:e.contentBackground),s=ll(n,i);return{position:"absolute",background:l,height:il+s,paddingTop:s,zIndex:$e().LN,display:"flex",boxShadow:`-3px 0 0 ${l}`,minWidth:"100%"}}),[t,null==r?void 0:r.background,o,e.cardContentBackground,e.contentBackground,n])}(V,t,h,i),I=(0,c().yK)((()=>({stickyHeader:{paddingLeft:y,paddingRight:v},stickyHeaderTransition:{paddingLeft:y}})),[y,v]),_=(0,a().Kw)(t.permissionScopesStore).canConfigureBlock,M=(0,a().Kw)(t.isInHomeWidgetStore),B=(0,n.useCallback)(((e,o)=>(0,$.jsx)(El,{schema:b,collectionContextStore:t,format:d,query:x,disabled:l,isFullScreen:S,isInPeekRenderer:h,hoveredGroupStore:g,groupFormat:w[o],currentGroups:r})),[t,r,l,d,g,S,h,x,b,w]),F=(0,n.useCallback)((e=>{Xe().Zv({environment:k,collectionContextStore:t,isHidden:!1,groupsFormatKey:"board_columns",groupByKey:"board_columns_by",currentGroups:r,newGroupIds:e})}),[t,r,k]),K=(0,a().VK)((()=>Ml(o,t)),[t,o]),O=(0,a().VK)((()=>Bl(o,d,t)),[t,o,d]);if(0===w.length&&0===p.length)return null;const L=w.map((e=>(0,zt().mD)(e)));return d.board_columns_by?(0,$.jsx)(Mr().u,{stickyAttachPoint:M?"no-stick":"ceiling",absoluteHeight:u,nodeRef:j,stickyStyle:I.stickyHeader,transitionStickyStyle:I.stickyHeaderTransition,children:(0,$.jsxs)("div",{style:P,ref:j,children:[R&&(0,$.jsx)("div",{style:Ll(h,V,M)}),_?(0,$.jsx)(Cl().ZP,{direction:"horizontal",keys:L,renderKey:B,onDrop:F}):L.map(((e,o)=>(0,$.jsx)(El,{schema:b,collectionContextStore:t,format:d,query:x,disabled:l,isFullScreen:S,isInPeekRenderer:h,hoveredGroupStore:g,groupFormat:w[o],currentGroups:r},(0,zt().mD)(w[o])))),K&&(0,$.jsx)(ki,{visibleGroups:o.visibleGroups,hiddenGroups:o.hiddenGroups,total:o.total,groupsLimitStore:t.boardColumnsLimitStore,type:"board",schema:b,collectionContextStore:t}),O&&(0,$.jsx)("div",{style:{height:"100%",display:"flex",alignItems:"center"},children:(0,$.jsx)(Il,{format:d,schema:b,collectionContextStore:t,store:C,columnsDisplayStateForCurrentGroups:r})}),p.length>0&&!T&&(0,$.jsx)("div",{style:{position:"relative",width:220,flexShrink:0,display:"flex",alignItems:"center",fontSize:14,color:V.lightTextColor,marginLeft:20},ref:m,children:(0,$.jsx)(qe()._H,{defaultMessage:"Hidden groups",id:"collection.boardView.hiddenGroups.label"})})]})}):null})),El=n.memo((function(e){let{groupFormat:t,currentGroups:o,schema:n,collectionContextStore:r,format:i,query:l,disabled:s,isFullScreen:c,isInPeekRenderer:d,hoveredGroupStore:u}=e;return(0,a().VK)((()=>r.groupsStore.getGroupState([t])),[r,t])&&i.board_columns_by?(0,$.jsx)(ii,{currentGroups:o,groupFormat:t,query:l,schema:n,format:i,groupBy:i.board_columns_by,collectionContextStore:r,hoveredGroupStore:u,disabled:s,hidden:!1,isPopup:!1,isInPeekRenderer:d,isFullScreen:c}):null}));var Al=()=>o(740046),Hl=()=>o(838367),Zl=()=>o(967092);class zl extends d().default{getInitialState(){return{searchQuery:"",limit:zl.defaultLimit}}}zl.defaultLimit=20,zl.loadMoreScrollOffset=200,zl.loadMoreIncrement=20;const Gl=zl,Wl={display:"flex",alignItems:"center",justifyContent:"flex-start",height:32,padding:4,borderRadius:6},Nl=(0,qe().vU)({searchPlaceholder:{defaultMessage:"Search for a page",id:"boardHiddenGroup.searchPlaceholder"}}),Ul=n.memo((function(e){const{device:t}=(0,s().O7)(),r=(0,s().O7)(),i=(0,c().Fg)(),{groupBy:l,groupFormat:d,disabled:u,format:p,query:m,schema:g,currentGroups:S,collectionContextStore:h,blockPropertyValueOverlayStore:f,isFullScreen:y,hoveredGroupStore:v,isInPeekRenderer:x}=e,b=(0,a().qz)(void 0,ke().Z),C=(0,a().qz)(void 0,Gl),k=n.useRef(null),V=(0,a().VK)((()=>{var e;return null===(e=m.aggregations)||void 0===e?void 0:e[0]}),[m]),j=(0,a().Kw)(h.isInHomeWidgetStore),R=(0,a().VK)((()=>h.collectionViewBlockStore()),[h]),P=(0,n.useMemo)((()=>R?new(W().G)(r,{table:T().iU,id:R.id}):null),[r,R]),I=(0,n.useCallback)((()=>(0,$.jsx)(is,{groupFormat:d,disabled:u,format:p,collectionContextStore:h,schema:g,blockPropertyValueOverlayStore:f,isFullScreen:y,buttonPopupStore:b})),[f,b,h,u,p,d,y,g]),{searchQuery:_,limit:M}=(0,a().Kw)(C),B=(0,a().VK)((()=>{const e=(0,qt().zk)({schema:g,group:d,groupBy:p.board_columns_by,propertyMapping:void 0,timeZone:(0,Yt().r)(),experimentService:je().default});if(!e)return;return{type:"results",filter:e,limit:M,searchQuery:_,loadContentCover:Boolean(p&&p.board_cover&&"page_content"===p.board_cover.type)}}),[d,g,p,_,M]),F=(0,n.useCallback)((e=>function(e,t,o){o.setState({searchQuery:e.target.value,limit:Gl.defaultLimit}),es(t)}(e,r,C)),[r,C]),K=(0,n.useCallback)((()=>function(e,t){t.reset(),es(e)}(r,C)),[r,C]),O=(0,n.useCallback)((()=>(0,$.jsxs)(n.Fragment,{children:[!t.isMobile&&(0,$.jsx)(ii,{groupBy:l,currentGroups:S,groupFormat:d,query:m,schema:g,format:p,collectionContextStore:h,disabled:u||Boolean(_),hidden:!0,isPopup:!0,isFullScreen:y,hoveredGroupStore:v,isInPeekRenderer:x},(0,zt().mD)(d)),(0,$.jsx)("div",{style:{margin:t.isMobile?0:"6px 0"},children:(0,$.jsx)(Je().Z,{capture:!0,render:e=>(0,$.jsx)(Al().ZP,{value:_,placeholder:nt().Z.formatMessage(Nl.searchPlaceholder),autoFocus:!t.isMobile,showClearButton:!0,onChange:F,onClearButtonClick:K,...e})})})]})),[h,S,t.isMobile,u,p,l,d,K,F,v,y,x,m,g,_]),L=(0,n.useCallback)((e=>function(e,t,o,n){var r;const i=n.state,l=null===(r=Xl(t,o))||void 0===r||null===(r=r.state)||void 0===r?void 0:r.blockIds,s=t.isLoadingStore.state;e<Gl.loadMoreScrollOffset&&!s&&l&&i.limit<=l.length&&n.setState({...i,limit:i.limit+Gl.loadMoreIncrement})}(e,h,d,C)),[h,d,C]),D=(0,n.useCallback)((e=>(0,$.jsx)("div",{...e,children:(0,fn().o)({width:18,height:18,color:i.lightTextColor})})),[i.lightTextColor]),E=(0,n.useCallback)((e=>(0,$.jsx)(ts,{parent:e,groupFormat:d,currentGroups:S,format:p,schema:g,query:m,collectionContextStore:h})),[d,S,p,g,m,h]),A=(0,n.useCallback)((e=>{let o,{selectableEvents:n}=e;return o=t.isMobile?{menuType:Yn().o.Modal,title:(0,$.jsx)(_r().Z,{groupBy:l,groupFormat:d,currentGroups:S,schema:g,disabled:!0,isHiddenGroup:!0,collectionContextStore:h}),left:(0,$.jsx)(vr().ZP,{popupType:Zl().kQ.SlideUp,renderOrigin:D,render:E}),right:(0,$.jsx)(or().DoneMenuText,{}),onClickRight:()=>rs(b),header:O()}:{menuType:Yn().o.Popup,header:O(),width:(0,X().rD)(Ql(p))+20},B?(0,$.jsxs)(er().Z,{...o,...n,children:[(0,$.jsx)(Xt().Z,{id:`board_hidden_group:${(0,zt().mD)(d)}`,reducer:B,groupsPointer:[d],collectionContextStore:h,resultStore:Xl(h,d),render:I}),(0,$.jsx)(jo().Z,{onChange:L})]}):null}),[t.isMobile,B,d,h,I,L,l,S,g,D,E,O,b,p]),H=(0,n.useCallback)((()=>{if(P)return(0,$.jsx)(o(299519).Z,{store:P,isDefaultContainer:!0,droppable:!0,render:A})}),[P,A]),Z=(0,n.useCallback)((()=>function(e,t){t.reset(),es(e)}(r,C)),[r,C]),z=(0,n.useCallback)((async e=>{const{droppedStores:t,duplicate:o}=e,n=k.current;if(!n)return;if(!(n instanceof Element))return;const i=await oe().F.formulas.load();w().createAndCommit({userAction:"BoardHiddenGroup.handleDrop",environment:r,canUndo:!0,perform:e=>Xe().by({environment:r,collectionContextStore:h,groupsPointer:[d],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:i})})}),[h,d,r]),G=(0,n.useCallback)((e=>(0,$.jsx)($l,{buttonPopupEvents:e,aggregation:V,schema:g,collectionContextStore:h,query:m,groupFormat:d,groupBy:l,currentGroups:S,isInHomeWidget:j})),[g,h,m,d,l,S,j,V]);return P?(0,$.jsx)("div",{ref:k,children:(0,$.jsx)(ze().Z,{store:P,canDropOnto:!u,onSelectableDrop:z,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,children:(0,$.jsx)(vr().ZP,{popupType:t.isMobile?Zl().kQ.SlideUp:Zl().kQ.Popup,renderOrigin:G,render:H,buttonPopupStore:b,onClick:Z})})}):null}));function $l(e){let{query:t,aggregation:o,buttonPopupEvents:r,groupFormat:i,groupBy:l,currentGroups:a,schema:d,collectionContextStore:u,isInHomeWidget:p}=e;const m=(0,s().O7)(),g=(0,c().yK)((e=>({button:{...Wl,...p?{fontSize:14}:{}}})),[p]),S=(0,n.useCallback)((e=>function(e,t,o,n){const r=t.collectionViewStore(),i=e?[e]:[],l={...o,aggregations:i};r&&w().createAndCommit({userAction:"BoardHiddenGroup.handleBoardAggregationChange",environment:n,canUndo:!0,perform:e=>{V().iG({collectionViewStore:r,update:{query2:l},transaction:e})}})}(e,u,t,m)),[u,t,m]);return(0,$.jsxs)(pt().Z,{style:g.button,...r,children:[(0,$.jsx)(_r().Z,{groupBy:l,groupFormat:i,currentGroups:a,schema:d,disabled:!0,isHiddenGroup:!0,collectionContextStore:u}),o&&(0,$.jsx)(ti,{groupFormat:i,aggregation:o,schema:d,collectionContextStore:u,disabled:!0,onChange:S})]},(0,zt().mD)(i))}function ql(e){return e?e.board_cover:void 0}function Yl(e){return e?e.board_cover_aspect:void 0}function Ql(e){return e?e.board_cover_size:void 0}function Xl(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.reducerResultStore}function Jl(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore}function es(e){N().default.state.stores.length>0&&b().ZH({environment:e})}function ts(e){let{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:s}=e;const c=(0,a().VK)((()=>s.collectionStore()),[s]),d=s.boardColumnsLimitStore;return c?(0,$.jsx)(lr,{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:d}):null}function os(e,t,o,n,r){const{blocks:i,transaction:l}=e,s=o.groupsStore.getGroupState(t);if(!s)return;const a=s.resultsStore;if(i.length>0&&a.state.length>0){const e=i[0];if(!(0,Oe().ww)(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;Mo({transaction:l,environment:r,collectionContextStore:o,isFullScreen:n,groupsPointer:[t],insertAtIndex:a.state.findIndex((t=>t===e))+1,from:"board_group_enter_add_item",transient:!0})}}function ns(e,t,o,n){const r=t.collectionStore(),i=e.getTitleStore();if(it().QaF(null==i?void 0:i.getValue()))return void b().Ys({environment:n,store:e});if(!r)return;const l=Jl(t,o);if(!l)return;const s=l.state.findIndex((t=>t===e))-1,a=t.collectionViewStore(),c=t.collectionViewBlockStore();if(a&&c&&j().sG(n,{...(0,le().Pn)(t),block_id:e.id}),w().createAndCommit({userAction:"BoardHiddenGroup.handleBoardItemTextEsc",environment:n,canUndo:!0,perform:t=>{Xe().Od({store:e,transaction:t})}}),s>=0){const e=l.state[s];b().Ys({environment:n,store:e})}}function rs(e){e.setState({open:!1})}function is(e){let{groupFormat:t,disabled:o,format:r,collectionContextStore:i,schema:l,blockPropertyValueOverlayStore:c,isFullScreen:d,buttonPopupStore:u}=e;const p=(0,s().O7)(),m=(0,n.useCallback)((()=>rs(u)),[u]),g=(0,n.useCallback)((e=>os(e,t,i,d,p)),[t,i,d,p]),{device:S}=p,h=(0,a().VK)((()=>{var e;return null===(e=Xl(i,t))||void 0===e?void 0:e.state}),[i,t]),f=(0,a().VK)((()=>{var e;return null===(e=Jl(i,t))||void 0===e?void 0:e.state}),[i,t]),y=(0,a().VK)((()=>Fe().default.isSidePeekOpen()),[]);return h&&f?0===f.length?(0,$.jsx)(nr().Z,{children:(0,$.jsx)(Hl().Z,{title:(0,$.jsx)(qe()._H,{defaultMessage:"No results",id:"database.boardView.searchResults.noResults.label"})})}):(0,$.jsx)("div",{style:{padding:S.isMobile?"8px 16px":"6px 14px 8px"},children:(0,$.jsx)(xo,{collectionContextStore:i,groupsPointer:[t],format:r,canDrag:!o,onSelectableEnter:g,disableRequest:!0,resultProps:{format:r,schema:l,disabled:o,coverFormat:ql(r),coverAspectFormat:Yl(r),coverSizeFormat:Ql(r),colorStyle:void 0,blockPropertyValueOverlayStore:c,onTextEnter:e=>function(e,t,o,n,r){const i=Jl(t,n);if(!i)return;if(!(0,Oe().ww)(r)||!t.collectionStore())return ns(e,t,n,r);const l=i.state.findIndex((t=>t===e))+1;w().createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:r,canUndo:!0,perform:e=>{Mo({transaction:e,environment:r,collectionContextStore:t,isFullScreen:o,groupsPointer:[n],insertAtIndex:l,from:"board_group_enter_add_item",transient:!0})}})}(e,i,d,t,p),onTextEsc:e=>ns(e,i,t,p),onShiftEnter:e=>os(e,t,i,d,p),collectionContextStore:i},resultComponent:Mn,handleOpenPeekPage:y?void 0:m,canDrop:!0,disabled:o,shouldShowHoverMenu:!1,direction:yo.Vertical,belowDropZoneMargin:2,emptyDroppableSize:4,analyticsName:"board"})}):(0,$.jsx)(nr().Z,{children:(0,$.jsx)(Hl().Z,{title:(0,$.jsx)(Zo().Z,{})})})}const ls=Ul,ss=n.memo(n.forwardRef((function(e,t){const{collectionContextStore:o,disabled:r,disableBoardColorColumns:i,hiddenGroups:l,store:c,format:d,query:u,schema:p,isFullScreen:m,isInPeekRenderer:g,blockPropertyValueOverlayStore:S,columnsDisplayStateForCurrentGroups:h,hoveredGroupStore:f}=e,y=(0,s().O7)(),v=(0,s().Fy)(),x=(0,he().PE)(c,r),b=(0,a().VK)((()=>x&&!v.isMobile&&!o.permissionScopesStore.state.isLocked&&o.permissionScopesStore.state.canEditContent),[x,o,v]),C=(0,n.useMemo)((()=>l.slice(0,Jt().ew)),[l]),w=(0,n.useMemo)((()=>C.map((e=>(0,zt().mD)(e)))),[C]),k=(0,a().Kw)(o.permissionScopesStore),V=(0,n.useCallback)((e=>{if(d.board_columns_by)return(0,$.jsx)(ls,{query:u,schema:p,format:d,groupFormat:e,groupBy:d.board_columns_by,currentGroups:h,collectionContextStore:o,disabled:r||!x||!k.canEditContent&&"collectionTypedView"!==o.contextType,blockPropertyValueOverlayStore:S,isFullScreen:m,hoveredGroupStore:f,isInPeekRenderer:g},(0,zt().mD)(e))}),[S,x,o,h,r,d,f,m,g,k.canEditContent,u,p]),T=(0,n.useCallback)(((e,t)=>V(C[t])),[C,V]),j=(0,n.useCallback)((e=>Xe().Zv({environment:y,collectionContextStore:o,isHidden:!0,groupsFormatKey:"board_columns",groupByKey:"board_columns_by",currentGroups:h,newGroupIds:e})),[o,h,y]),R=(0,a().VK)((()=>function(e,t){const o=e.isInHomeWidgetStore.state;return{width:220,flexShrink:0,marginTop:il+ll(t,o),marginLeft:12}}(o,i)),[o,i]);return(0,$.jsx)("div",{style:R,ref:t,children:C.length>0&&(b?(0,$.jsx)(Cl().ZP,{direction:"vertical",keys:w,renderKey:T,onDrop:j}):(0,$.jsx)("div",{children:C.map(V)}))})})));const as=n.memo((function(e){let{args:t,collectionContextStore:o,isInPeekRenderer:n,format:r,setSubgroupsMounted:i,columnsDisplayStateStore:l}=e;const s=(0,a().Kw)(o.isInHomeWidgetStore),d=(0,a().VK)((()=>function(e,t){return t.state.visibleGroups.length*(ri(e)+2*rl+2*ol)}(r,l)),[r,l]),{stickyStyle:u}=(0,c().yK)((e=>s?{stickyStyle:{}}:{stickyStyle:{background:n?e.cardContentBackground:e.contentBackground,boxShadow:`0 1px 0 ${n?e.cardContentBackground:e.contentBackground}`}}),[s,n]);return(0,$.jsx)(Fr,{...t,height:s?tt().yZ:36,stickyStyle:u,style:{...t.style,minWidth:d},onMount:i})})),cs=d().default.createClass(void 0,{name:"GroupsReducerResultStore"}),ds=d().default.createClass(void 0,{name:"HoveredGroupStore"}),us=n.memo((function(e){const{store:t,format:r,schema:i,collectionContextStore:d,isFullScreen:u,isPreviewing:p,paddingLeft:m,paddingRight:g,paddingBottom:h,disabled:f,query:y,blockPropertyValueOverlayStore:v,isInPeekRenderer:b,isRootChild:C}=e,k=(0,s().O7)(),T=(0,c().Fg)(),j=(0,qe().YB)(),R=(0,fe().E)("collection_test_removing_hidden_groups"),P=(0,n.useRef)(null),I=(0,n.useRef)(null),_=(0,n.useRef)(0),M=(0,n.useRef)(null),B=(0,a().qz)(void 0,cs),F=(0,a().qz)(void 0,ds),[K,O]=(0,n.useState)(!1),L=(0,a().SI)((()=>{var e,t;const o=d.collectionViewStore();if(!o)return[void 0,void 0];return[null==o||null===(e=o.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_group_by").getValue(),null==o||null===(t=o.getFormatStore())||void 0===t?void 0:t.getKeyStore("board_columns_by").getValue()]}),[d],{useDeepEqual:!0}),D=(0,a().VK)((()=>{const e=r.board_columns_by;if(e)return(0,zt().Qq)({schema:i,groupBy:e})}),[r.board_columns_by,i],{useDeepEqual:!0}),E=(0,a().VK)((()=>!Boolean((0,Jt().II)({environment:k,groupFormat:void 0,schema:i,format:r,theme:T}))),[k,r,i,T]),[A,H]=(0,a().yR)((()=>{const e=r.board_columns_by;if(!e)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const t=d.collectionViewBlockStore();if(!t)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const o=d.collectionViewStore(),n=d.boardColumnsLimitStore.state,l=B.state;if("v2"===(null==l?void 0:l.version)){const t=l.results.filter((e=>e.visible)).map((t=>({property:e.property,value:t.value})));return{currentGroups:t,visibleGroups:t,hiddenGroups:[],total:t.length}}const s=l?l.total:0,a=(0,Jt().Cz)({groupBy:e,schema:i,formatGroups:r.board_columns||[],schemaGroups:D,reducerResults:null==l?void 0:l.results,getRecordModel:t.getRecordModel,relativeVariableResult:d.relativeVariableStore.state,viewAppConfigUri:null==o?void 0:o.getFormat().app_config_uri,allowedCollectionStores:d.collectionStoresStore.state}),c=a.filter((e=>!(0,zt().eF)(e))).slice(0,n),u=a.filter((e=>(0,zt().eF)(e)));return{currentGroups:[...c,...u],visibleGroups:c,hiddenGroups:u,total:s}}),[d,r.board_columns,r.board_columns_by,B,i,D],{useDeepEqual:!0}),Z=(0,a().VK)((()=>{const{visibleGroups:e}=A,t=r.collection_group_by,o=d.collectionViewBlockStore(),n=B.state;if(!o||!t)return!1;let l=[];var s;n&&"v2"===n.version?l=n.results.map((e=>({property:t.property,value:e.value}))):l=(0,Jt().Cz)({groupBy:t,schema:i,formatGroups:r.collection_groups||[],schemaGroups:D,reducerResults:null==n?void 0:n.results,getRecordModel:o.getRecordModel,relativeVariableResult:d.relativeVariableStore.state,viewAppConfigUri:null===(s=d.collectionViewStore())||void 0===s?void 0:s.getFormat().app_config_uri,allowedCollectionStores:d.collectionStoresStore.state});if(0===l.length){if(void 0!==t)return!1;for(const t of e){const e=d.groupsStore.getGroupState(t);if(null!=e&&e.reducerResultStore.state)return!0}}else for(const r of l)for(const t of e){const e=[r,t],o=d.groupsStore.getGroupState(e);if(null!=o&&o.reducerResultStore.state)return!0}return!1}),[d,A,r,B,i,D]),z=(0,a().VK)((()=>{const e=r.board_columns_by;if(e)return(0,Jt().ej)({groupBy:e,schema:i,format:r,groupsFormatKey:"board_columns",limit:d.boardColumnsLimitStore.state})}),[d,r,i]),G=(0,he().PE)(t,f),W=(0,a().VK)((()=>{const e=d.permissionScopesStore.state;return G&&("collectionTypedView"===d.contextType||e.canEditContent)}),[G,d]);(0,n.useEffect)((()=>{const e=d.collectionStore();e&&(!r.board_columns_by&&t.isDefined()&&e.isDefined()&&function(e,t,o,n){const r=e.collectionStore(),i=e.permissionScopesStore.state;if(!r||!r.isDefined())return;const l=e.collectionViewStore();l&&i.canConfigureBlock&&w().createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:n,canUndo:!0,perform:s=>{let a,c=X().Se(t);if(!c&&i.canConfigureCollection&&(c=(0,_l().ZP)(),a={[c]:{name:o.formatMessage({id:"collection.boardView.selectProperty.defaultName",defaultMessage:"Status"}),type:"select",options:[]}}),!c)return;const d=(a||t)[c];d&&(0,zt().LG)(d)&&(Xo().FH({stores:[l],update:{board_columns_by:(0,zt().fw)({property:c,propertySchema:d,isCollectionTypedView:"collectionTypedView"===e.contextType})},transaction:s}),wn().sW({store:l,data:{type:"board"},transaction:s}),a&&V().xO({environment:n,collectionStore:r,update:a,transaction:s}))}})}(d,i,j,k),l().default.afterNextFlush((()=>{if(!I.current||!P.current)return;let e=0;if(P.current){const t=I.current.getBoundingClientRect().left;e=P.current.getBoundingClientRect().left-t+8}const t=e+_.current;_.current=t,I.current.style.left=`${t}px`})))}),[d,k,r.board_columns_by,j,i,t]);const N=(0,n.useMemo)((()=>S().Ds((()=>function(e,t,o,n){const r=n.state.currentGroups;Xe().$D({environment:e,format:t,groupsFormatKey:"board_columns",collectionContextStore:o,currentGroups:r})}(k,r,d,H)),5e3)),[d,H,k,r]);(0,n.useEffect)((()=>(H.addListener(N),()=>{H.removeListener(N),N.cancel()})),[H,N]),(0,n.useEffect)((()=>{const e=()=>O(!1);return L.addListener(e),()=>L.removeListener(e)}),[L]);const U=(0,n.useCallback)((()=>F.setState(void 0)),[F]),q=(0,n.useCallback)((e=>{const o=A.visibleGroups;return(0,$.jsx)("div",{style:Cl().l8,children:o.map(((n,l)=>{const s=l===o.length-1,a=e?[e,n]:[n],c=0!==A.hiddenGroups.length;return d.groupsStore.getGroupState(a)?(0,$.jsx)(sl,{store:t,hoveredGroupStore:F,query:y,schema:i,format:r,groupsPointer:a,collectionContextStore:d,isFullScreen:u,isInPeekRenderer:b,disabled:f||!W,isLast:s&&!c,blockPropertyValueOverlayStore:v,anyGroupHasResults:Z},(0,zt().KW)(a)):null}))})}),[Z,v,W,d,A.hiddenGroups.length,A.visibleGroups,f,r,F,u,b,y,i,t]),Y=(0,n.useCallback)((()=>{O(!0)}),[O]),Q=(0,n.useCallback)((e=>(0,$.jsx)(as,{collectionContextStore:d,isInPeekRenderer:b,format:r,setSubgroupsMounted:Y,columnsDisplayStateStore:H,args:e})),[d,H,r,b,Y]),J=(0,n.useCallback)((e=>function(e,t,o){const{device:n}=o;if(n.isMobile)Io()._c({environment:o,store:e,pageVisitSource:Po().tY.Create});else{const n="collectionTypedView"===t.contextType;_o().CH({environment:o,store:e,peekMode:X().kr(t),showMoveTo:n,resultsStore:void 0,collectionContextStore:t,pageVisitSource:Po().tY.Create})}}(e,d,k)),[d,k]),ee=Z,te=K,oe=(0,a().Kw)(d.shouldShowSpinnerStore)&&!te&&!ee,ne=(0,a().Kw)(d.isInHomeWidgetStore),re=(0,a().VK)((()=>!!d.viewsModuleContextStore.getViewModuleType()),[d]),{visibleGroups:le,hiddenGroups:se,currentGroups:ae}=A,ce=r.collection_group_by,ue=u?480:ne?220:360,pe=il+ll(E,ne),me=(0,n.useCallback)((()=>(0,Fn().Z)((e=>(0,$.jsx)("div",{style:Fl(m,g,le.length>0?pe:0),className:ie().EGJ,...e,ref:M,children:(0,$.jsx)(zr().Q,{nodeRef:M,children:(0,$.jsxs)(ze().Z,{style:Kl(h),store:t,shouldShowHalo:!u&&!ne,canSelect:!u&&!re,disablePointerEvents:p,onMouseDown:e=>function(e,t){const{device:o}=t,{target:n}=e;!o.isMobile&&0===e.button&&n instanceof HTMLElement&&(0,de().ZP)({event:e,context:de().Af.EditorMouseDown,callback:()=>{e.preventDefault(),x().AI({environment:t,target:n,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,k),analyticsName:"board",onMouseLeave:U,children:[(!oe||!ne)&&(0,$.jsx)(Dl,{collectionContextStore:d,columnsDisplayState:A,currentGroups:ae,disableBoardColorColumns:E,disabled:f,format:r,headerPlaceholderHeight:pe,hiddenGroups:se,hiddenGroupsHeaderRef:I,hoveredGroupStore:F,isFullScreen:u,isInPeekRenderer:b,isRootChild:C,paddingLeft:m,paddingRight:g,query:y,schema:i,store:t,visibleGroups:le}),oe&&(0,$.jsx)(Pl,{height:ue,numBoardColumns:le.length,boardCoverSize:r.board_cover_size,areColumnsColored:!E,showGroupHeader:!0}),le.length>0&&(0,$.jsx)("div",{style:{display:"flex",flexDirection:"column",position:"relative",top:pe},children:ce?(0,$.jsx)(Zi,{reducerId:o(56718).M9,store:t,collectionContextStore:d,disabled:f,isFullScreen:u,isRootChild:C,paddingLeft:m,stickyLeft:!k.device.isMobile,renderGroup:q,getGroupStyle:Ol,renderHeader:Q,onGroupHeaderAddItem:J}):q(void 0)}),Ml(A,d)&&(0,$.jsx)("div",{style:{width:90,marginLeft:ol,marginRight:ol,pointerEvents:"none"}}),Bl(A,r,d)&&(0,$.jsx)("div",{style:{width:35,marginLeft:ol,marginRight:ol,pointerEvents:"none"}}),se.length>0&&!R&&(0,$.jsx)(ss,{ref:I,collectionContextStore:d,store:t,disabled:f,hiddenGroups:se,disableBoardColorColumns:E,format:r,schema:i,query:y,blockPropertyValueOverlayStore:v,isFullScreen:u,isInPeekRenderer:b,columnsDisplayStateForCurrentGroups:A.currentGroups,hoveredGroupStore:F})]})})})))),[v,d,A,ae,E,f,k,r,ce,U,pe,se,F,u,ne,b,p,C,re,J,h,m,g,y,q,Q,i,ue,oe,t,R,le]);return r.board_columns_by?(0,$.jsx)(wl,{collectionContextStore:d,groupsResultStore:B,groupsReducer:z,render:me}):(0,$.jsx)(Rl,{collectionContextStore:d,isFullScreen:u,paddingLeft:m,paddingRight:g,paddingBottom:h})}));o(749411);var ps=()=>o(70186),ms=()=>o(874459),gs=()=>o(32969),Ss=()=>o(35982),hs=()=>o(907573),fs=()=>o(526243),ys=()=>o(803021);function vs(e){const{blockPropertyValueOverlayStore:t,calendarBy:r,calendarViewRange:i,canEditCalendar:l,collectionContextStore:s,columnIndex:a,currentlyViewedMonth:d,endOfDay:u,format:p,items:m,query:g,sortedResultsStore:S,schema:h,shouldShowShimmer:f,startOfDay:y}=e,v=(0,ms().Bn)({firstDate:y,secondDate:d}),x=(0,ms().Y3)(y),b=!v&&!x&&"week"!==i,C=(0,c().yK)((e=>({button:{width:"100%",height:44,borderRadius:6},dayNumber:{height:28,color:b?e.lightTextColor:x?e.white:void 0,...x?{width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",background:Bo().ZP.red,marginLeft:"auto",marginRight:"auto"}:{display:"flex",alignItems:"center",justifyContent:"center"}},eventDot:{width:8,height:8,background:e.mediumIconColor,borderRadius:"100%",marginTop:2,marginLeft:"auto",marginRight:"auto"}})),[x,b]),w=(0,n.useMemo)((()=>m.find((e=>(0,ys().b8)(y,u,e.start,e.end?e.end:void 0)))),[m,y,u]),k=(0,ms().TE)(y),V=(0,n.useCallback)((e=>(0,$.jsxs)(pt().Z,{style:C.button,...e,children:[(0,$.jsx)("div",{style:C.dayNumber,className:f?`notion-shimmer-calendar-transition notion-shimmer-text animation-delay-${a}`:"notion-shimmer-calendar-transition",children:k}),w&&(0,$.jsx)("div",{style:C.eventDot})]})),[C,f,a,k,w]),T=(0,n.useCallback)((e=>(0,$.jsx)(o(770455).r4,{collectionContextStore:s,initialStartOfDay:y,format:p,schema:h,query:g,calendarBy:r,disabled:!l,onDismiss:e.close,blockPropertyValueOverlayStore:t,resultsStore:S})),[s,y,p,h,g,r,l,t,S]);return(0,$.jsx)(vr().ZP,{popupType:vr().Z4.SlideUp,renderOrigin:V,render:T},k.toString())}const xs=(0,n.memo)(vs);function bs(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarViewRange:r,canEditCalendar:i,collectionContextStore:l,currentlyViewedMonth:s,format:a,items:d,query:u,sortedResultsStore:p,schema:m,shouldShowShimmer:g,showWeekends:S,startOfWeek:h}=e,f=(0,c().yK)((e=>({container:{display:"flex",boxShadow:`0 -1px 0 ${e.tableDividerColor}`,paddingTop:8,paddingBottom:8,fontSize:14}})),[]),y=S?7:5,v=(0,n.useMemo)((()=>[...Array(y).keys()].map((e=>{const t=(0,ms().Xz)({date:h,daysToAdd:e});return{startOfDay:t,endOfDay:(0,ms().us)(t)}}))),[y,h]);return(0,$.jsx)("div",{style:f.container,children:v.map(((e,n)=>(0,$.jsx)(xs,{blockPropertyValueOverlayStore:t,calendarBy:o,canEditCalendar:i,collectionContextStore:l,columnIndex:n,currentlyViewedMonth:s,endOfDay:e.endOfDay,format:a,items:d,query:u,sortedResultsStore:p,schema:m,shouldShowShimmer:g,startOfDay:e.startOfDay,calendarViewRange:r},e.startOfDay.toString())))},h.toString())}const Cs=(0,n.memo)(bs);var ws=()=>o(661727),ks=()=>o(23151);const Vs=30,Ts=(0,qe().vU)({addItemLabel:{defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"},linkExistingLabel:{defaultMessage:"Link an existing item",id:"database.calendarView.linkExistingButtonTooltip"},linkExistingCompleteToast:{defaultMessage:"{pageTitle} linked and {numUpdates, plural, one {{numUpdates} property} other {{numUpdates} properties}} updated",id:"database.calendarView.linkExistingToast"}});function js(e){const{blockStore:t,calendarStore:r,collectionContextStore:i,columnIndex:l,startOfDay:d,canEditCalendar:u,isInHomeWidget:p,isInPeekRenderer:m,isTypedMsvCollection:g,currentlyViewedMonth:S,calendarBy:h,propertySchema:f,calendarViewRange:y,shouldShowShimmer:x}=e,b=(0,s().O7)(),C=(0,qe().YB)(),k=(0,n.useContext)(Ln().Z),{mainEditorCurrentBlockStore:V}=(0,a().Kw)(an().default),T=(0,a().VK)((()=>i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[i]),{dayStoreMap:j,isDragging:R,hoveredDay:P}=(0,a().VK)((()=>({dayStoreMap:r.state.dayStoreMap,isDragging:r.state.isDragging,hoveredDay:r.state.isDragging?void 0:r.state.hoveredDay})),[r]),{pointer:I,userId:_,inMemoryRecordCache:M}=(0,a().VK)((()=>t),[t]),B=(0,n.useMemo)((()=>{const e=j.get(d);if(e)return e;const t=new(o(128076).G)(b,I,{userId:_,inMemoryRecordCache:M});return j.set(d,t),t}),[j,b,M,I,d,_]),F=(0,ms().Bn)({firstDate:d,secondDate:S}),K=(0,ms().Y3)(d),O=(0,ms().LY)(d),L="date"===f.type,D=!F&&!K&&"week"!==y,E=!R&&P===d&&(L||K)&&T&&u,A=(0,n.useMemo)((()=>1!==(0,ms().TE)(d)||K?(0,ms().TE)(d):`${new Intl.DateTimeFormat(C.locale,{month:"short",day:"numeric"}).format(new Date(d))} `),[C.locale,K,d]),H=(0,n.useCallback)((e=>{k?k(e):Jo().c4({environment:b,url:e})}),[b,k]),Z=(0,n.useCallback)((()=>{const{performResult:e}=w().createAndCommit({userAction:"Calendar.createBlockInDay",environment:b,canUndo:!0,perform:e=>{const t=Xe().IW({environment:b,collectionContextStore:i,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:e,from:{createBlock:"calendar"},inMemoryRecordCache:b.defaultRecordCache.inMemoryRecordCache});if(!t)return;const o=t.newStore.getAssociatedCollectionStore(),n=(null==o?void 0:o.getMappedProperty(h))??h;ks().xD({type:"timestamp",environment:b,store:t.newStore,propertyId:n,timestampMs:d,transaction:e});const r=X().mb({environment:b,store:t.newStore,mainEditorCurrentBlockStore:V,collectionContextStore:i,showMoveTo:g})??(0,ln().ZP)({store:t.newStore,pageVisitSource:Po().tY.Create});return H(r),v().Xd({collectionContextStore:i,resultsStore:void 0}),t.newStore}});return e}),[h,i,b,g,V,H,d]),z=(0,n.useCallback)(((e,t,n)=>{const r=t.getAssociatedCollectionStore(),i=(null==r?void 0:r.getMappedProperty(h))??h;if(ks().xD({type:"timestamp",environment:b,store:t,propertyId:i,timestampMs:d,transaction:e}),n){var l;const e=Object.keys(n).length+(i in n?0:1),r=(null===(l=t.getModel())||void 0===l?void 0:l.getRenderTitleWithEmojiOrPlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,Yt().r)(),intl:C}))||"",s=r.length>53?`${r.slice(0,50)}`:r;o(102182).d4({item:{label:C.formatMessage(Ts.linkExistingCompleteToast,{pageTitle:s,numUpdates:e})},undoFunc:()=>{}})}}),[h,b,d,C]),G=(0,n.useCallback)((e=>{w().createAndCommit({userAction:"Calendar.renderDay",environment:b,canUndo:!0,perform:t=>{const o=i.collectionStore();if(!o&&"collectionTypedView"!==i.contextType)return;const n=ye().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");ye().default.DO_NOT_USE_measureAfterNextFlushLegacy(n,{environment:b,getData:()=>le().yr({collectionContextStore:i,is_native_drop:!1,is_empty:!1})}),ks().JN({...e,environment:b,startOfDay:d,calendarBy:h,collectionStore:o,collectionContextStore:i,transaction:t})}})}),[h,i,b,d]),W=(0,n.useCallback)((()=>{if(u&&(0,Oe().ww)(b)&&T){const e=Z();io().W(b,{type:"page",from:"calendar_day_double_click",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,le().Pn)(i)})}}),[u,b,T,Z,i]),N=(0,c().yK)((e=>{const t=(()=>{if(O)return p?(0,ws().Fq)(e.tableHomeDividerColor,.05):m?e.cardSidebarBackground:e.surface.wash})(),o=D?e.lightTextColor:K?e.white:void 0;return{selectable:{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderRight:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,cursor:"default",background:t},dayNumber:{position:"absolute",fontSize:14,top:4,height:24,lineHeight:"24px",color:o,...K?{right:4,width:24,borderRadius:"100%",textAlign:"center",background:e.calendarTodayBackground}:{right:10,textAlign:"right",transition:"color 100ms ease-out"}}}}),[p,m,K,O,D]);return(0,$.jsxs)(ze().Z,{style:N.selectable,store:B,canDropOnto:u&&L,onSelectableDrop:G,onDoubleClick:W,analyticsName:"calendar_day",shouldShowDropZone:!0,children:[E&&(0,$.jsx)(Rs,{collectionContextStore:i,createBlockFunc:Z,updateBlockDayProperty:z}),(0,$.jsx)("div",{style:N.dayNumber,className:x?`${ie().irE} notion-shimmer-text animation-delay-${l} notion-shimmer-calendar-transition`:`${ie().irE} notion-shimmer-calendar-transition`,children:A})]},d.toString())}function Rs(e){let{collectionContextStore:t,createBlockFunc:o,updateBlockDayProperty:r}=e;const i=(0,s().O7)(),l=(0,qe().YB)(),d=(0,a().VK)((()=>X().Il({collectionContextStore:t,environment:i,intl:l})),[t,i,l]),u=(0,n.useCallback)((()=>{if((0,Oe().ww)(i)){const e=o();io().W(i,{type:"page",from:"calendar_day_add_button",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,le().Pn)(t)})}else(0,Oe().eD)(i)}),[i,o,t]),p=(0,c().yK)((e=>({iconToolbar:{position:"absolute",display:"flex",top:6,left:6,padding:2,borderRadius:8,background:e.popoverBackground,boxShadow:e.aiBarShadow},iconButton:{width:20,height:20}})),[]),m=(0,n.useCallback)(((e,t)=>(0,$.jsx)(mt().Z,{ariaLabel:l.formatMessage(Ts.addItemLabel),icon:Go().R,style:p.iconButton,onClick:u,...(0,mr().Z)(e,{onMouseDown:de().$0})})),[u,l,p.iconButton]);return(0,$.jsxs)("div",{style:p.iconToolbar,children:[(0,$.jsx)(gt().Z,{renderTooltip:()=>l.formatMessage(Ts.addItemLabel),render:m}),d?(0,$.jsx)(gt().Z,{renderTooltip:()=>l.formatMessage(Ts.linkExistingLabel),render:e=>(0,$.jsx)(No().a,{collectionContextStore:t,renderLinkButton:t=>(0,$.jsx)(mt().Z,{ariaLabel:l.formatMessage(Ts.linkExistingLabel),icon:Uo().v,style:p.iconButton,...t,...(0,mr().Z)(e,{onMouseDown:de().$0})}),onAddOrLink:r})}):null]})}const Ps=(0,n.memo)(js);var Is=()=>o(646574),_s=()=>o(603885),Ms=()=>o(790964),Bs=()=>o(384241),Fs=()=>o(412511),Ks=()=>o(670320);const Os=2,Ls=3;function Ds(e,t){const{store:o,collectionContextStore:r,handleOpenPeekPage:i}=e,l=(0,s().O7)(),c=(0,n.useRef)(null),d=(0,n.useCallback)((()=>{const e=function(e){const{environment:t,store:o,collectionContextStore:n}=e,{mainEditorCurrentBlockStore:r}=an().default.state;return X().mb({environment:t,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:n,fullyQualified:!1})}({environment:l,store:o,collectionContextStore:r});e&&(i(),Jo().c4({environment:l,url:e}))}),[r,l,i,o]),u=(0,n.useMemo)((()=>({store:o,renderedType:"page",getNode:()=>c.current,getBlockStore:()=>o,activate:d})),[d,o]);(0,a().VK)((()=>{r.onItemMount(o)}),[r,o]);const p=(0,$.jsx)("div",{ref:c,children:(0,$.jsx)(As,{...e})});return(0,he().ez)(o,t,u,p)}const Es=n.forwardRef(Ds);function As(e){const{store:t,row:o,schema:n,format:r,disabled:i,calendarBy:l,showWeekends:c,collectionContextStore:d,includeTime:u,handleOpenPeekPage:p,blockPropertyValueOverlayStore:m,calendarStore:g}=e,h=(0,s().O7)(),{value:f}=(0,G().XJ)(oe().F.formulas),y=n[l],v=(0,a().VK)((()=>!i&&"date"===(null==y?void 0:y.type)&&!d.permissionScopesStore.state.isSyncedCollection),[d.permissionScopesStore,i,null==y?void 0:y.type]),{start:x,end:b,startOfWeek:C,endOfWeek:w,startColumn:k,columnCount:V}=(0,Fs().du)({startUnixTimestampMS:e.start,endUnixTimestampMS:e.end,startOfWeekUnixTimestampMS:e.startOfWeek,endOfWeekUnixTimestampMS:e.endOfWeek}),T=(0,a().VK)((()=>{const e=r.calendar_properties?r.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[],o=e.filter((e=>(0,Oo().X)({block:t.getModel(),property:e,schema:n,getRecordModel:t.getRecordModel,userId:h.currentUser.id,userTimeZone:(0,Yt().r)(),intl:nt().Z.getIntl(),experimentService:je().default,collectionFeatureGates:(0,Lo().W)(),formulasModule:f})));return o.concat(S().e5(e,o))}),[h.currentUser.id,r.calendar_properties,n,t,f]),j=(0,a().VK)((()=>(0,Z().ls)({collectionContextStore:d})),[d]);if(!y||!Gt().Lt(y))return null;const R=T.length+(j?1:0),P=x<C,I=void 0!==b&&b>w;return(0,$.jsxs)(Hs,{store:t,row:o,numRows:R,columnCount:V,startIsBeforeStartOfWeek:P,endIsAfterEndOfWeek:I,startColumn:k,disabled:i,isEditableDate:v,calendarBy:l,showWeekends:c,handleOpenPeekPage:p,children:[j&&(0,$.jsx)("span",{style:{paddingRight:4,paddingLeft:8,maxWidth:"100%",overflowX:"hidden",textOverflow:"ellipsis"},children:(0,$.jsx)(on().O,{blockStore:t,collectionContextStore:d})}),(0,$.jsx)(Ws,{store:t,collectionContextStore:d,disabled:i,start:x,startOfWeek:C,end:b,endOfWeek:w,includeTime:u,propertySchema:y}),(0,$.jsx)(Us,{store:t,sortedProperties:T,startIsBeforeStartOfWeek:P,disabled:i,blockPropertyValueOverlayStore:m}),v&&(0,$.jsx)($s,{store:t,start:x,startOfWeek:C,end:b,endOfWeek:w,calendarBy:l,calendarStore:g})]})}function Hs(e){const{store:t,children:o,columnCount:r,row:i,numRows:l,startColumn:d,disabled:u,isEditableDate:p,calendarBy:m,showWeekends:g,handleOpenPeekPage:S,startIsBeforeStartOfWeek:h,endIsAfterEndOfWeek:f}=e,y=(0,s().O7)(),v=(0,E().Y$)(),x=(0,a().VK)((()=>X().Ts(t)),[t]),b=Gs(l,(0,a().VK)((()=>{var e;return null===(e=v.collectionViewStore())||void 0===e?void 0:e.getFormat()}),[v])),C=Vs+b*i,w=(0,a().qz)(void 0,Ks().Z),k=(0,a().VK)((()=>Re().Z.state?!0===w.state.dragging:ro().Z.state.hoveredStore===t),[t,w]),V=g?7:5,T=(0,c().yK)((e=>({selectable:{position:"absolute",paddingTop:3,paddingBottom:3,paddingLeft:h?0:6,paddingRight:f?0:6,width:f?`calc(100% / ${V} * ${r} - 1px)`:`calc(100% / ${V} * ${r})`,left:`calc(100% / ${V} * ${d})`,height:b,top:C},haloStyle:{...X().pB(e,x),borderRadius:6,marginTop:2,marginBottom:2,marginLeft:h?0:5,marginRight:f?0:5},linkBoxStyle:{height:"100%",background:e.calendarItemBackground,borderTopLeftRadius:6,borderTopRightRadius:6,borderBottomLeftRadius:6,borderBottomRightRadius:6,boxShadow:e.lightBoxShadow,...f&&{borderTopRightRadius:0,borderBottomRightRadius:0},...h&&{borderTopLeftRadius:0,borderBottomLeftRadius:0}},linkBoxHoveredStyle:{opacity:1,background:e.calendarItemHoveredBackground},linkBoxInnerStyle:{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}})),[r,f,b,V,x,d,h,C]),j=(0,n.useCallback)((e=>{const o=t.getAssociatedCollectionStore();return o?ks().QG({environment:y,collectionStore:o,collectionContextStore:v,store:t,insertStores:e.insertStores,calendarBy:m,transaction:e.transaction}):[]}),[m,v,y,t]),R=(0,n.useCallback)((e=>{const{transaction:o}=e;t.getAssociatedCollectionStore()&&Xe().Od({store:t,transaction:o})}),[t]),[P,I]=(0,a().VK)((()=>{const{mainEditorCurrentBlockStore:e}=an().default.state,o=X().mb({environment:y,store:t,mainEditorCurrentBlockStore:e,collectionContextStore:v,fullyQualified:!1});return[(0,ln().ZP)({store:t,fullyQualified:!1,pageVisitSource:Po().tY.LinkInPage}),o]}),[y,v,t]),_=(0,a().Kw)(v.isInHomeWidgetStore);return(0,$.jsx)(ze().Z,{store:t,style:T.selectable,canSelect:!u,shouldShowHalo:!_,shouldForceRenderSelectionHalo:x,haloStyle:T.haloStyle,canTriggerContextMenu:!u,showBlockMenuInput:!0,canDrag:p,onInsertAbove:j,onInsertBelow:j,onRemove:R,canInsertAbove:p,canInsertBelow:p,analyticsName:"calendar",shouldShowDropZone:!0,className:ie().K4T,draggableStore:w,children:(0,$.jsx)(rn().Z,{style:T.linkBoxStyle,hoveredStyle:T.linkBoxHoveredStyle,pressedStyle:T.linkBoxHoveredStyle,innerStyle:T.linkBoxInnerStyle,onClick:S,href:P,metaHref:I,hovered:k,children:o})},t.id)}const Zs=24,zs=36;function Gs(e,t){var o;return((null==t?void 0:t.table_wrap)||!0===(null==t||null===(o=t.calendar_properties)||void 0===o||null===(o=o.find((e=>"title"===e.property)))||void 0===o?void 0:o.wrap)?zs:Zs)+e*_s().ch+2*Os+2*Ls}function Ws(e){const{store:t,collectionContextStore:o,disabled:i,start:l,startOfWeek:d,end:u,endOfWeek:p,includeTime:m,propertySchema:g}=e,S=(0,s().O7)(),h=l<d,f=u&&u>p,y=(0,a().VK)((()=>(0,Z().wI)({collectionContextStore:o,blockStore:t})),[o,t]),v="time_format"in g?g.time_format:ys().c_,[x,b,C]=(0,a().VK)((()=>[t.getIcon(),t.isEmptyPage(),t.hasError()]),[t]),k=(0,n.useCallback)((e=>{const o=t.getIconStore();o&&w().createAndCommit({userAction:"CalendarItem.handleRecordIconChange",environment:S,canUndo:!0,perform:t=>{wn().sO({store:o,value:e,transaction:t})}})}),[S,t]),V=(0,a().VK)((()=>{var e,t,n;const r=null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().calendar_properties;return(null===(t=o.collectionViewStore())||void 0===t?void 0:t.getFormat().table_wrap)||!0===(null==r||null===(n=r.find((e=>"title"===e.property)))||void 0===n?void 0:n.wrap)}),[o]),T=(0,c().yK)((e=>({titleContainer:{paddingLeft:6,paddingRight:6,overflow:"hidden",...h&&{paddingLeft:12},...f&&{paddingRight:11},width:"100%",...V?{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"17px",height:zs,paddingTop:2}:{height:Zs,whiteSpace:"nowrap"},overflowWrap:"break-word",textOverflow:"ellipsis",fontSize:14,fontWeight:Zt().Ue.semibold},recordIconStyle:{display:"inline",float:"left",marginRight:3,paddingTop:V?2:4},iconWarningStyle:{display:"inline",float:"left",marginLeft:1,marginRight:5,width:10,height:16,paddingTop:V?2:4,fill:e.accentColors.orange[500]},subitemCountIndicatorContainer:{display:"flex",alignItems:"center",float:"right",paddingTop:V?2:4},timeStyle:{color:e.mediumTextColor,float:"right",fontSize:10,marginLeft:4,height:14,paddingTop:V?2:4},subitemsWrapperStyle:{paddingRight:0,paddingLeft:4}})),[f,h,V]),j=m&&u&&r().Xp.fromDateTimes(d,p).contains(u)&&l.day!==u.day,R=(0,a().VK)((()=>o.shouldShowPageIcon()&&(void 0!==x||!b)&&!C),[o,x,b,C]);return(0,$.jsxs)("div",{style:T.titleContainer,children:[R&&(i?(0,$.jsx)(kn().Z,{disabled:!0,icon:x,isEmptyPage:b,size:14,style:T.recordIconStyle}):(0,$.jsx)(kn().Z,{disabled:!1,store:t,bucket:"secure",icon:x,isEmptyPage:b,size:14,style:T.recordIconStyle,onChange:k})),C&&(0,Vn().t)(T.iconWarningStyle),(0,$.jsx)(Ns,{store:t,titlePropertyIsWrapped:V}),y&&(0,$.jsx)("div",{style:T.subitemCountIndicatorContainer,children:(0,$.jsx)(nn().B,{blockStore:t,collectionContextStore:o,wrapperStyle:T.subitemsWrapperStyle})}),m&&r().Xp.fromDateTimes(d,p).contains(l)&&(0,$.jsxs)("div",{style:T.timeStyle,children:[(0,Is().xE)({dateTime:l,humanReadable:!1,timeFormat:v}),j&&(0,$.jsxs)("span",{children:["  ",(0,Is().xE)({dateTime:u,humanReadable:!1,timeFormat:v})]})]}),(0,$.jsx)(Bs().Z,{store:t,shouldWrap:V})]})}function Ns(e){const{store:t,titlePropertyIsWrapped:o}=e,n=(0,c().yK)((e=>({discussionIndicatorStyle:{display:"flex",alignItems:"center",color:e.lightTextColor,fontSize:12,flexShrink:0},discussionIndicatorContainerStyle:{float:"right",marginLeft:4,marginTop:o?-2:1}})),[o]);return(0,$.jsx)(en().s,{store:t,iconStyle:n.discussionIndicatorStyle,buttonStyle:n.discussionIndicatorContainerStyle,size:12})}function Us(e){const{store:t,sortedProperties:o,startIsBeforeStartOfWeek:n,disabled:r,blockPropertyValueOverlayStore:i}=e,l=(0,E().Y$)(),s=(0,a().VK)((()=>l.permissionScopesStore.state.isLocked||!l.permissionScopesStore.state.canEditContent),[l.permissionScopesStore]),[c,d]=(0,a().VK)((()=>[X().Bm({store:t,collectionContextStore:l}),l.collectionViewStore()]),[t,l]);return c?(0,$.jsx)("div",{style:{paddingLeft:6,paddingRight:6,overflow:"hidden",width:"100%",...n&&{paddingLeft:12}},children:o.map((e=>(0,$.jsx)(xn().m,{store:t,property:e,disabled:r,locked:s,format:dt().C.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:c,collectionViewStore:d},e)))}):null}function $s(e){const{store:t,calendarStore:o,start:r,startOfWeek:i,end:l,endOfWeek:a,calendarBy:d}=e,u=(0,s().O7)(),p=(0,c().yK)((()=>({leftDragHandle:{position:"absolute",top:0,left:-4,height:"100%",width:12,cursor:"col-resize"},rightDragHandle:{position:"absolute",top:0,right:-4,height:"100%",width:12,cursor:"col-resize"}})),[]),m=(0,n.useCallback)((e=>{ks().td({calendarStore:o,x:e.currentX,y:e.currentY,calendarBy:d})}),[o,d]),g=(0,n.useCallback)((()=>{w().createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:u,canUndo:!0,perform:e=>{ks().fX({environment:u,transaction:e,calendarStore:o,calendarBy:d})}})}),[d,o,u]),S=(0,n.useCallback)((()=>{ks().cQ({calendarStore:o})}),[o]),h=r>=i&&(0,$.jsx)(Ms().Z,{render:e=>(0,$.jsx)("div",{style:p.leftDragHandle,...e}),onDraggableDragStart:()=>{ks().f$({calendarStore:o,targetStore:t,direction:fs().to.Left})},onDraggableDragMove:m,onDraggableDragEnd:g,onDraggableDragCancel:S}),f=(!l||l&&l<a)&&(0,$.jsx)(Ms().Z,{render:e=>(0,$.jsx)("div",{style:p.rightDragHandle,...e}),onDraggableDragStart:e=>{ks().f$({calendarStore:o,targetStore:t,direction:fs().to.Right})},onDraggableDragMove:m,onDraggableDragEnd:g,onDraggableDragCancel:S});return(0,$.jsxs)($.Fragment,{children:[h,f]})}function qs(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:r,calendarStore:i,calendarViewRange:l,canEditCalendar:d,collectionContextStore:u,collectionViewStore:p,currentlyViewedMonth:m,endOfWeek:g,format:S,isInHomeWidget:h,isInPeekRenderer:f,isTypedMsvCollection:y,items:x,propertySchema:b,schema:C,shouldShowShimmer:w,showWeekends:k,sortedResultsStore:V,startOfWeek:j}=e,R=(0,s().O7)(),{isDragging:P,targetStore:I,temporaryValue:_}=(0,a().VK)((()=>{const{isDragging:e}=i.state;return{isDragging:e,targetStore:e?i.state.targetStore:void 0,temporaryValue:e?i.state.temporaryValue:void 0}}),[i]),{targetStoreCollectionStoreSchema:M,targetStoreCollectionStoreCalendarBy:B}=(0,a().VK)((()=>{const e=null==I?void 0:I.getAssociatedCollectionStore();return{targetStoreCollectionStoreSchema:null==e?void 0:e.getSchema(),targetStoreCollectionStoreCalendarBy:null==e?void 0:e.getMappedProperty(r)}}),[I,r]),F=(0,n.useCallback)((()=>{ye().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),v().Xd({collectionContextStore:u,resultsStore:V});const e=u.normalizedFormatStore.state.collection_peek_mode,t=e||ao().Ls.calendar;lo().hy(R,{is_peek:!0,from:"calendar",peek_mode:t})}),[u,R,V]),K=k?7:5,O=(0,n.useMemo)((()=>{const e=[];x.forEach((o=>{const n=W().G.createChildStore(p,{table:T().iU,id:o.id});P&&I===n&&_||e.push((0,$.jsx)(Ys,{blockPropertyValueOverlayStore:t,calendarBy:r,calendarStore:i,collectionContextStore:u,endOfWeek:g,format:S,handleOpenPeekPage:F,item:o,schema:C,showWeekends:k,startOfWeek:j,store:n},o.id))}));const o=P&&_&&(0,ms().Y_)(_,(0,Yt().r)());if(P&&_&&o&&(0,ys().b8)(j,g,o.start,o.end)&&I&&null!=I&&I.id){const n=x.find((e=>e.id===I.id));e.push((0,$.jsx)(Ys,{blockPropertyValueOverlayStore:t,calendarBy:B??r,calendarStore:i,collectionContextStore:u,endOfWeek:g,format:S,handleOpenPeekPage:F,schema:M??C,showWeekends:k,startOfWeek:j,store:I,item:{id:I.id,start:o.start,end:o.end,row:n?n.row:0,includeTime:"datetime"===_.type||"datetimerange"===_.type}},I.id))}return e}),[t,r,i,u,p,g,S,F,P,x,C,k,j,I,B,M,_]),L=(0,n.useMemo)((()=>Math.max(0,...x.map((e=>e.row)))),[x]),D=(0,a().VK)((()=>(0,Z().ls)({collectionContextStore:u})),[u]),E=(0,c().yK)((()=>{const e=(S.calendar_properties?S.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[]).length+(D?1:0),t="week"===l?372:124,o=Gs(e,S);return{container:{position:"relative",display:"flex",height:Math.max((L+1)*o+Vs+4,t)}}}),[l,S,L,D]);return(0,$.jsxs)("div",{style:E.container,children:[[...Array(K).keys()].map((e=>{const t=(0,ms().Xz)({date:j,daysToAdd:e});return(0,$.jsx)(Ps,{blockStore:o,calendarStore:i,collectionContextStore:u,columnIndex:e,startOfDay:t,calendarBy:r,currentlyViewedMonth:m,canEditCalendar:d,isInHomeWidget:h,isInPeekRenderer:f,isTypedMsvCollection:y,propertySchema:b,calendarViewRange:l,shouldShowShimmer:w},e)})),O]},j.toString())}function Ys(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarStore:n,collectionContextStore:r,endOfWeek:i,format:l,handleOpenPeekPage:s,item:c,schema:d,showWeekends:u,startOfWeek:p,store:m}=e,{canEdit:g,collectionStore:S}=(0,a().VK)((()=>({canEdit:m.canEdit(),collectionStore:m.getAssociatedCollectionStore()})),[m]),{collectionStoreSchema:h,collectionStoreCalendarBy:f}=(0,a().VK)((()=>({collectionStoreSchema:null==S?void 0:S.getSchema(),collectionStoreCalendarBy:null==S?void 0:S.getMappedProperty(o)})),[S,o]);return S?(0,$.jsx)(Es,{collectionContextStore:r,store:m,startOfWeek:p,endOfWeek:i,showWeekends:u,start:c.start,end:c.end,row:c.row,includeTime:c.includeTime,format:l,schema:h??d,calendarBy:f??o,disabled:!g,calendarStore:n,blockPropertyValueOverlayStore:t,handleOpenPeekPage:s},m.id):null}const Qs=(0,n.memo)(qs);function Xs(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarStore:n,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:d,isInHomeWidget:u,isInPeekRenderer:p,isTypedMsvCollection:m,query:g,resultStore:S,schema:h,sortedResultsStore:f,weeks:y}=e,{isPhone:v}=(0,s().Fy)(),x=(0,a().VK)((()=>{var e,t;return(void 0===(null===(e=S.getState())||void 0===e?void 0:e.blockIds)||0===(null===(t=S.getState())||void 0===t?void 0:t.blockIds.length))&&(0,Ro().H0)({collectionContextStore:i,groupsPointer:[],hasPartialResults:!1})}),[i,S]),{collectionViewStore:b,calendarViewRange:C,showWeekends:w}=(0,a().VK)((()=>{const e=i.collectionViewStore(),t=null==e?void 0:e.getFormatStore();return{collectionViewStore:e,calendarViewRange:(null==t?void 0:t.getKeyStore("calendar_view_range").getValue())??"month",showWeekends:(null==t?void 0:t.getKeyStore("calendar_show_weekends").getValue())??!0}}),[i]);var k;y&&y.length>0&&(null===(k=i.databaseItemsVisibleTracker)||void 0===k||k.handleItemsRenderStart());const V=(0,c().yK)((e=>({container:v?{}:{boxShadow:`-1px 0 0 ${e.tableDividerColor}`,marginTop:1,overflow:"hidden"}})),[v]),{calendar_by:T}=g;if(!T)return null;const j=h[T];return j&&b?(0,$.jsx)("div",{style:V.container,children:y&&y.map((e=>v?(0,$.jsx)(Cs,{blockPropertyValueOverlayStore:t,calendarBy:T,calendarViewRange:C,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:d,items:e.items,query:g,schema:h,shouldShowShimmer:x,showWeekends:w,sortedResultsStore:f,startOfWeek:e.start},e.start):(0,$.jsx)(Qs,{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:T,calendarStore:n,calendarViewRange:C,canEditCalendar:r,collectionContextStore:i,collectionViewStore:b,currentlyViewedMonth:l,endOfWeek:e.end,format:d,isInHomeWidget:u,isInPeekRenderer:p,isTypedMsvCollection:m,items:e.items,propertySchema:j,schema:h,shouldShowShimmer:x,showWeekends:w,sortedResultsStore:f,startOfWeek:e.start},e.start)))}):null}const Js=(0,n.memo)(Xs);var ea=()=>o(146947),ta=()=>o(756085),oa=()=>o(696347),na=()=>o(909859),ra=()=>o(61951),ia=()=>o(880026),la=()=>o(803728),sa=()=>o(878797),aa=()=>o(138912),ca=()=>o(838266),da=()=>o(827510),ua=()=>o(904255),pa=()=>o(905263);const ma=(0,qe().vU)({defaultTitle:{id:"openInNotionCalendarOnboardingTooltip.header",defaultMessage:"Get Notion Calendar"},defaultContent:{id:"openInNotionCalendarOnboardingTooltip.content",defaultMessage:"View any Notion database with calendar and timeline views with your Google Calendar events"},connectCalendarTitle:{id:"openInNotionCalendarOnboardingTooltip.connectCalendarTitle",defaultMessage:"Connect Calendar"},successTitle:{id:"openInNotionCalendarOnboardingTooltip.success.header",defaultMessage:"Successfully connected"},successContent:{id:"openInNotionCalendarOnboardingTooltip.success.content",defaultMessage:"You can now view any database with calendar and timeline views in Notion Calendar"}});function ga(e){let{variant:t,origin:o,onCloseClick:n,onConnectCalendarClick:r}=e;const i=(0,c().yK)((e=>({tooltip:{width:233},content:{opacity:1},contentInner:{display:"flex",flexDirection:"column",gap:14},contentMessage:{opacity:.8,color:e.regularInvertedTextColor},footer:{display:"flex",alignItems:"center",gap:12},primaryButton:{display:"flex",alignItems:"center",height:24,padding:"0 12px",marginLeft:"auto",borderRadius:4,background:"#FFF",color:"#1D1B16",fontSize:12,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},primaryButtonHover:{background:"rgba(255,255,255,0.9)"},primaryButtonPressed:{background:"rgba(255,255,255,0.8)"}})),[]);return(0,$.jsx)(pa().U,{origin:o,placementToOrigin:"bottom",header:(0,$.jsx)(qe()._H,{..."success"===t?ma.successTitle:ma.defaultTitle}),content:(0,$.jsxs)("div",{style:i.contentInner,children:[(0,$.jsx)("div",{style:i.contentMessage,children:(0,$.jsx)(qe()._H,{..."success"===t?ma.successContent:ma.defaultContent})}),"default"===t&&(0,$.jsx)("div",{style:i.footer,children:(0,$.jsx)(pt().Z,{style:i.primaryButton,hoveredStyle:i.primaryButtonHover,pressedStyle:i.primaryButtonPressed,onClick:r,children:(0,$.jsx)(qe()._H,{...ma.connectCalendarTitle})})})]}),contentStyle:i.content,onCloseClick:n,shouldDismissUponOutsideClick:!1,enableMouseCapture:!1,pointerPosition:"33%",style:{...i.tooltip}})}function Sa(e){let{collectionContextStore:t}=e;const o=(0,n.useRef)(null),[r,i]=(0,n.useState)(!1),l=(0,s().O7)(),d=(0,a().VK)((()=>an().default.state.currentSpaceStore),[]),u=(0,a().VK)((()=>(0,na().tE)()),[]),p=(0,a().VK)((()=>sa().default.isVisible("open_in_calendar_tooltip")),[]),m=(0,a().VK)((()=>{const e=ca().default.state.open||t.settingsStore.state.open,o=t.isFullScreenStore.state,n=Fe().default.state.open;return o&&!e&&!n&&aa().default.state.loaded}),[t]);(0,ra().Z)((()=>{la().yM(l,"open_in_calendar_tooltip")}),m);const g=(0,n.useCallback)((()=>{const e=t.collectionViewStore(),o=t.collectionStore(),n=null==o?void 0:o.getParentBlockStore();e&&o&&n&&d&&(ia().QK(l,{is_calendar_connected:u,collection_id:o.id,collection_view_id:e.id,collection_view_block_id:n.id}),da().sh({environment:l,collectionViewStore:e,spaceStore:d,from:"openInCalendarButton"}))}),[l,t,d,u]),S=(0,n.useCallback)((()=>{la().Gi(l,"open_in_calendar_tooltip")}),[l]),h=(0,n.useCallback)((()=>{i(!0),g()}),[g]),f=(0,c().yK)((e=>({button:{marginRight:8,paddingRight:12,fontSize:14,fontWeight:500,height:26},calendarIcon:{marginLeft:4},calendarIconSvg:{fill:e.timelineRed}})),[]);return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(kl().Z,{ref:o,style:f.button,iconStyle:f.calendarIconSvg,icon:e=>(0,$.jsx)(ua().Z,{style:{...e,...f.calendarIcon}}),onClick:g,children:(0,$.jsx)(qe()._H,{id:"openInNotionCalendarButton.label",defaultMessage:"Open in Calendar"})}),p&&(0,$.jsx)(ga,{variant:r||u?"success":"default",origin:o,onCloseClick:S,onConnectCalendarClick:h})]})}function ha(e){const t=(0,s().O7)();return(0,a().VK)((()=>(0,na().ZH)({environment:t,collectionContextType:e.collectionContextStore.contextType,spaceStore:an().default.state.currentSpaceStore})),[t,e.collectionContextStore])?(0,$.jsx)(Sa,{...e}):null}const fa=(0,qe().vU)({previousMonthButtonAriaLabel:{id:"database.calendarViewHeader.previousMonthButton.ariaLabel",defaultMessage:"Previous Month"},nextMonthButtonAriaLabel:{id:"database.calendarViewHeader.nextMonthButton.ariaLabel",defaultMessage:"Next Month"},todayButtonLabel:{id:"database.calendarViewHeader.todayButton.label",defaultMessage:"Today"}});function ya(e){const{currentlyViewedMonth:t,calendarViewRange:o,setNewCalendarStart:r,isInHomeWidget:i,dateRangeStart:l,isInPeekRenderer:d,stickyStyle:u,collectionContextStore:p,weeks:m,startOfWeek:g}=e,S=(0,qe().YB)(),{isPhone:h,isMobile:f}=(0,s().Fy)(),y=(0,n.useRef)(null),v=(0,c().Fg)(),x=(0,X().jw)(p,v),b=(0,a().VK)((()=>{const e=p.collectionViewStore(),t=null==e?void 0:e.getFormatStore();return(null==t?void 0:t.getKeyStore("calendar_show_weekends").getValue())??!0}),[p]),C=(0,n.useMemo)((()=>{const e=(0,Is().Yx)(t,"month_year_long",ea().locale);if("month"===o)return e;if(!m||void 0===m[0])return"";const n=m[0];if((0,ms().Bn)({firstDate:n.start,secondDate:n.end}))return e;return`${(0,Is().Yx)(n.start,(0,ms().Xh)({firstDate:n.start,secondDate:n.end})?"month_short":"month_year_short",ea().locale)} - ${(0,Is().Yx)(n.end,"month_year_short",ea().locale)}`}),[t,o,m]),w=(0,n.useCallback)((()=>{const e="month"===o?(0,ms().IS)((0,ms().kl)(Date.now()),g):(0,ms().IS)(Date.now(),g);r(e,o)}),[o,r,g]),k=(0,n.useCallback)((e=>{const t=(0,ms().V7)(l,g);if("month"===o){const n="left"===e?-1:1,i=(0,ms().IS)((0,ms().kl)((0,ms()._)({date:t,monthsToAdd:n})),g);r(i,o)}else{const t="left"===e?-7:7,n=(0,ms().IS)((0,ms().Xz)({date:l,daysToAdd:t}),g);r(n,o)}}),[l,g,o,r]),V=(0,c().yK)((e=>{const t=h?e.contentBackground:(null==x?void 0:x.background)||(d?e.cardContentBackground:e.contentBackground);return{container:i?{}:{position:"absolute",left:0,right:0,zIndex:$e().VT,background:t},monthSwitcher:{display:"flex",height:42,alignItems:"center",marginBottom:2},monthHeader:{fontWeight:Zt().Ue.semibold,marginLeft:8,marginRight:8,lineHeight:1,fontSize:h?16:14},spacer:{flexGrow:1},weekdayNamesContainer:{display:"flex",marginTop:h?8:0,boxShadow:`0 1px 0 ${e.tableDividerColor}`},weekdayName:{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,color:e.lightTextColor,height:24}}}),[x,i,d,h]),T=b?(0,Is().kv)(g,ea().locale):(0,Is().vI)(ea().locale);return(0,$.jsx)(Mr().u,{stickyAttachPoint:i?"no-stick":"ceiling",nodeRef:y,stickyStyle:u,transitionStickyStyle:u,absoluteHeight:98,children:(0,$.jsxs)("div",{style:V.container,ref:y,children:[(0,$.jsxs)("div",{style:V.monthSwitcher,children:[(0,$.jsx)("div",{style:V.monthHeader,children:C}),(0,$.jsx)("div",{style:V.spacer}),(0,$.jsx)(ha,{collectionContextStore:p}),(0,$.jsx)(mt().Z,{ariaLabel:S.formatMessage(fa.previousMonthButtonAriaLabel),mobileFeedback:f,icon:ta().f,onClick:()=>k("left")}),(0,$.jsx)(zo().Z,{isSmall:!0,onClick:w,children:(0,$.jsx)(qe()._H,{...fa.todayButtonLabel})}),(0,$.jsx)(mt().Z,{ariaLabel:S.formatMessage(fa.nextMonthButtonAriaLabel),mobileFeedback:f,icon:oa().o,onClick:()=>k("right")})]}),(0,$.jsx)("div",{style:V.weekdayNamesContainer,className:ie().GNl,children:T.map((e=>{let[t,o]=e;return(0,$.jsx)("div",{style:V.weekdayName,children:o},t)}))})]})})}const va=(0,n.memo)(ya),xa=n.memo((function(e){const{blockPropertyValueOverlayStore:t,collectionContextStore:r,store:i,format:l,query:u,schema:p,isFullScreen:m,isInPeekRenderer:g,maxHeight:h,minWidth:f,paddingBottom:y,paddingLeft:v,paddingRight:C}=e,k=(0,qe().YB)(),j=(0,s().O7)(),{isPhone:R,isMobile:P}=(0,s().Fy)(),I=j.currentUser.id,{value:_}=(0,G().XJ)(oe().F.formulas),M=(0,n.useRef)(null),B=(0,n.useRef)(null),F=(0,o(794623).Z)(B,M),K=(0,a().qz)(void 0,fs().ZP),O=(0,a().qz)(void 0,d().default),L=(0,he().PE)(i,!1),D=(0,a().VK)((()=>Re().Z.state),[]),E=(0,a().VK)((()=>re().AK.state),[]),A=(0,a().VK)((()=>r.collectionViewStore()),[r]),H=(0,a().VK)((()=>r.collectionStore()),[r]),Z=null==A?void 0:A.id,z=(0,a().Kw)(r.isLoadingStore),N=(0,a().VK)((()=>"collectionTypedView"===r.contextType),[r]),U=(0,a().Kw)(r.isInHomeWidgetStore),q=(0,a().VK)((()=>!!r.viewsModuleContextStore.getViewModuleType()),[r]),Y=(0,a().Kw)(r.dateRangeStartStore),Q=(0,a().Kw)(r.dateRangeEndStore),J=(0,a().Kw)(r.permissionScopesStore),{calendarStoreState:ee,dayStoreMap:te,startingMonth:ne,hoveredDay:le}=(0,a().VK)((()=>({calendarStoreState:K.state,dayStoreMap:K.state.dayStoreMap,startingMonth:K.state.startingMonth,hoveredDay:K.state.isDragging?void 0:K.state.hoveredDay})),[K]),se=(0,a().VK)((()=>L&&(J.canEditContent||N)),[L,J.canEditContent,N]),ae=(0,a().VK)((()=>{var e;return(null==A||null===(e=A.getFormatStore())||void 0===e?void 0:e.getKeyStore("calendar_view_range").getValue())??"month"}),[A]),ue=(0,a().VK)((()=>m&&!P&&"month"===ae),[m,P,ae]),pe=(0,a().VK)((()=>ue||!Y?ne:(0,ms().kl)((0,ms().V7)(Y,E))),[ue,Y,ne,E]),me=(0,a().VK)((()=>(0,hs().Ft)({collectionContextStore:r})),[r],{useDeepEqual:!0}),ge=(0,a().VK)((()=>{if(!A)return[];const e=O.state;if(!e||!e.blockIds)return[];const t=e.blockIds.map((e=>W().G.createChildStore(A,{id:e,table:T().iU})))||[];return(0,hs().y$)({collectionContextStore:r,results:t,getRecordValue:i.getRecordValue,intl:k,formulasModule:_})}),[A,O,r,i.getRecordValue,k,_],{useDeepEqual:!0}),fe=(0,a().SI)((()=>A&&ge&&(null==ge?void 0:ge.flatMap((e=>e.items.map((e=>W().G.createChildStore(A,{table:T().iU,id:e.id}))))))||[]),[A,ge],{useDeepEqual:!0,debugName:"sortedResultsStore"});(0,a().Kw)(fe);const[ye,ve]=(0,n.useState)();(0,n.useEffect)((()=>{var e;null!==(e=M.current)&&void 0!==e&&e.parentElement&&ve((0,Se().VW)(M.current.parentElement))}),[]);const xe=(0,n.useCallback)(((e,t)=>{const o=(0,ms().V7)(e,E);let n;"month"===t?(n=ue?(0,ms().V7)((0,ms()._)({date:o,monthsToAdd:1}),E):(0,ms().V7)((0,ms().RN)(o),E),ye&&ue&&(ye.scrollTop=0)):n=o,V().t5({dateRangeStart:e,dateRangeEnd:n,collectionContextStore:r}),K.update((t=>({...t,startingMonth:(0,ms().kl)((0,ms().V7)(e,E))})))}),[E,r,K,ue,ye]),be=(0,n.useCallback)((()=>{H&&H.isDefined()&&A&&J.canConfigureBlock&&w().createAndCommit({userAction:"Calendar.updateOrCreateCalendarProperty",environment:j,canUndo:!0,perform:e=>{let t,o=X().PD(p);if(!o&&J.canConfigureCollection){o=(0,_l().ZP)();t={[o]:{name:k.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}o&&(V().Es({collectionViewStore:A,update:{calendar_by:o},transaction:e}),wn().sW({store:A,data:{type:"calendar"},transaction:e}),t&&V().xO({environment:j,collectionStore:H,update:t,transaction:e}))}})}),[H,A,j,k,J.canConfigureBlock,J.canConfigureCollection,p]),Ce=(0,n.useCallback)((e=>{if(!A||!Z)return;const t=fs().ZP.getLocalDateRangeStart({collectionViewId:Z,currentUserId:I}),o=e.state,n=(0,ms().IS)(t,o),r=(0,ms().IS)(new Date((0,ms().V7)(t,o)).getDate()>7?(0,ms().kl)(t):t,o),i="month"===ae?r:n;K.update((e=>({...e,startingMonth:r.valueOf()}))),xe(i,ae)}),[A,Z,I,ae,K,xe]),we=(0,n.useCallback)((()=>{if(!B.current||!ue)return;const e=S().MR(Array.from(te.entries()).map((e=>{let[t,o]=e;return{store:o,timestamp:t}})),(e=>{let{timestamp:t}=e;return t})),t=B.current.getBoundingClientRect(),o=e.find((e=>{let{store:o}=e;const n=gs().C.getRectFromStore(o);if(!n)return;const r=(null==ye?void 0:ye.scrollTop)??0,i=n.top<=t.top+r,l=n.bottom>=t.top+r;return i&&l}));if(o){const e=(0,ms().kl)((0,ms().Xz)({date:(0,ms().V7)(o.timestamp,E),daysToAdd:1}));e!==ne&&K.update((t=>({...t,startingMonth:e})))}}),[K,te,ue,E,ne,null==ye?void 0:ye.scrollTop]),ke=(0,Qo().z)(we,100),Ve=(0,n.useCallback)((e=>{if(e<Te().Z.incrementScrollOffset&&!z&&ue){const e=(0,ms().V7)((0,ms()._)({date:Q,monthsToAdd:2}),E);V().t5({dateRangeStart:Y,dateRangeEnd:e,collectionContextStore:r})}}),[r,Q,Y,z,ue,E]),je=(0,n.useCallback)((e=>{const{target:t}=e;!R&&t instanceof HTMLElement&&(0,de().ZP)({event:e,context:de().Af.EditorMouseDown,callback:()=>{e.preventDefault(),x().AI({environment:j,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[i],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})}),[j,R,i]),Pe=(0,n.useCallback)((e=>{if(!D&&(0,fs().wY)(ee)){const t=function(e,t){b().Ch();const{selectableRectMap:n}=o(797522).default.state,r=Array.from(te.keys()),i=Array.from(te.values());for(const[o,l]of n.entries())if(l&&Ss().uh(l,e,t)&&i.indexOf(o.props.store)>=0)return r.find((e=>te.get(e)===o.props.store))}(e.clientX,e.clientY);le!==t&&K.update((e=>({...e,hoveredDay:t})))}}),[K,ee,te,le,D]),Ie=(0,Qo().z)(Pe,100);(0,Yo().K)((()=>{Ce(re().AK),re().AK.addListener(Ce)})),(0,ps().L)((()=>{re().AK.removeListener(Ce)})),(0,n.useEffect)((()=>{D&&(0,fs().wY)(ee)&&K.update((e=>({...e,hoveredDay:void 0}))),u.calendar_by||be()}),[K,ee,D,u.calendar_by,be]),(0,n.useEffect)((()=>{const e=M.current,t=null==e?void 0:e.parentElement,o=ye;return t&&(ce().lj(t,"mousemove",Ie),o&&ce().lj(o,"scroll",ke)),()=>{t&&ce().ZV(t,"mousemove",Ie),o&&ce().ZV(o,"scroll",ke)}}),[Ie,ke,ye]);const _e=(0,c().yK)((()=>({scroller:{height:"calc(100% - 66px)",maxHeight:h?h-(R?74:66):"inherit",paddingBottom:16,maskImage:"none",WebkitMaskImage:"none",...U?{paddingTop:12}:{}},scrollOffset:U?{height:"100%",maxHeight:"inherit"}:{},selectable:{position:"relative",paddingLeft:1,...U&&{height:"100%",maxHeight:"inherit"}},container:{paddingBottom:y,paddingLeft:v,paddingRight:C,minWidth:f,...U&&{height:"100%",maxHeight:"inherit"}},sticky:{paddingLeft:v,paddingRight:C,minWidth:f}})),[U,R,h,f,y,v,C]),Me=(0,n.useCallback)((()=>(0,Fn().Z)((e=>(0,$.jsx)(zr().Q,{nodeRef:B,children:(0,$.jsx)(jo().Z,{onChange:Ve,style:_e.scrollOffset,children:(0,$.jsx)("div",{ref:F,style:_e.container,className:ie().c7X,children:(0,$.jsxs)(ze().Z,{store:i,onMouseDown:je,style:_e.selectable,shouldShowHalo:!m&&!U,canSelect:!m&&!q,analyticsName:"calendar",...e,children:[(0,$.jsx)(va,{collectionContextStore:r,weeks:ge,startOfWeek:E,dateRangeStart:Y,currentlyViewedMonth:pe,setNewCalendarStart:xe,calendarViewRange:ae,isInHomeWidget:U,isInPeekRenderer:g,stickyStyle:_e.sticky}),U?(0,$.jsx)(Lt,{style:_e.scroller,children:(0,$.jsx)(Js,{blockPropertyValueOverlayStore:t,collectionContextStore:r,blockStore:i,calendarStore:K,resultStore:O,sortedResultsStore:fe,format:l,query:u,schema:p,weeks:ge,isInPeekRenderer:g,currentlyViewedMonth:pe,canEditCalendar:se,isInHomeWidget:U,isTypedMsvCollection:N})}):(0,$.jsx)(Js,{blockPropertyValueOverlayStore:t,collectionContextStore:r,blockStore:i,calendarStore:K,resultStore:O,sortedResultsStore:fe,format:l,query:u,schema:p,weeks:ge,isInPeekRenderer:g,currentlyViewedMonth:pe,canEditCalendar:se,isInHomeWidget:U,isTypedMsvCollection:N})]})})})})))),[t,i,K,ae,se,r,pe,Y,l,je,Ve,m,U,g,q,N,F,u,O,p,xe,fe,E,_e.container,_e.scrollOffset,_e.scroller,_e.selectable,_e.sticky,ge]),{calendar_by:Be}=u;if(!Be)return(0,$.jsx)(ba,{collectionContextStore:r,isFullScreen:m,paddingBottom:y,paddingLeft:v,paddingRight:C});const Fe=p[Be];return Fe&&Gt().Lt(Fe)?me?(0,$.jsx)(Xt().Z,{id:"calendar_results",resultStore:O,collectionContextStore:r,reducer:me,render:Me}):null:(0,$.jsx)(ba,{collectionContextStore:r,isFullScreen:m,paddingBottom:y,paddingLeft:v,paddingRight:C})}));function ba(e){const{collectionContextStore:t,isFullScreen:o,paddingBottom:n,paddingLeft:r,paddingRight:i}=e,l=t.settingsStore,s=(0,a().VK)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),d=(0,c().yK)((()=>({container:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:n}})),[o,n,r,i]);return(0,$.jsx)(jl,{style:d.container,title:(0,$.jsx)(qe()._H,{defaultMessage:"No date property",id:"database.calendarView.missingDatePropertyTitle"}),description:s?(0,$.jsx)(qe()._H,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Calendar view.",id:"database.calendarView.missingDateProperty",values:{opensettingslink:e=>(0,$.jsx)(Tl,{onClick:()=>{y().r$({collectionContextStore:t,collectionSettingsStore:l}),y().H4({collectionSettingsStore:l,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,$.jsx)(qe()._H,{defaultMessage:"Calendar views require a date property in order to display.",id:"database.calendarView.missingDatePropertyNoPermissions"})})}var Ca=()=>o(341374);function wa(e,t){return(0,cn().AB)(t[e])}function ka(e){const{environment:t,store:o,collectionContextStore:n}=e,{mainEditorCurrentBlockStore:r}=an().default.state;return X().mb({environment:t,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:n,fullyQualified:!1})}function Va(e,t,o,n,r,i){return t.isDefined()?n.filter((n=>{const l="title"!==n&&r;return!Ue().wV({property:n,schema:o,block:t.getModel(),getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,Yt().r)(),intl:nt().Z.getIntl(),experimentService:je().default,collectionFeatureGates:(0,Lo().W)(),formulasModule:i})||l})):[]}function Ta(e,t,o,n,r,i,l){const s=t.state,a=s.isOpen?s.property:"title",c=Va(e,o,n,r,i,l),d=c.findIndex((e=>e===a)),u=S().dF(c,((e,t)=>t<d&&wa(e,n)));return u||(i?"title":function(e,t){return S().dF(e,(e=>wa(e,t)))}(c,n))}function ja(e,t,o,n,r,i,l){const s=t.state,a=s.isOpen?s.property:"title",c=Va(e,o,n,r,i,l),d=c.findIndex((e=>e===a)),u=c.find(((e,t)=>t>d&&wa(e,n)));return u||(i?"title":function(e,t){return e.find((e=>wa(e,t)))}(c,n))}function Ra(e){V().IH({store:e})}function Pa(e,t,o,n,r){if("title"===e){so().xv({environment:r,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();b().eP({environment:r,store:t}),V().Z5({store:t}),C().setSelectionAtEnd({store:e})}else e?(so().xv({environment:r,blockPropertyValueOverlayStore:o}),so().bA({environment:r,blockPropertyValueOverlayStore:o,store:t,property:e,format:dt().C.ListView,collectionContextStore:n})):so().xv({environment:r,blockPropertyValueOverlayStore:o});Ra(t)}function Ia(e,t,o){so().xv({environment:e,blockPropertyValueOverlayStore:t}),b().Ys({environment:e,store:o}),Ra(o)}function _a(e){const{environment:t,newStore:o,previousStore:n}=e;b().eP({environment:t,store:o}),V().Z5({store:o}),Ca().Z.setState({store:o,editMode:"new",previousStore:n})}var Ma=()=>o(309797);function Ba(e){const t=(0,s().O7)(),{store:o,collectionContextStore:r,disabled:i,groupsPointer:l,collectionStore:d,subitemPath:u,indentLevel:p,onSubitemCreate:m}=e,g=(0,a().VK)((()=>{var e;return"timeline"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType())}),[r]),S=(0,a().VK)((()=>{var e;return"title"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[r]),h=(0,Ma().L2)(o),f=(0,a().VK)((()=>(0,k().lZ)({columnIndex:0,titleColumnIndex:0,indentLevel:p,isSubitemToggleOnTitleColumn:S})),[p,S]),y=(0,c().yK)((t=>({newRowButton:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:f,fontSize:14,lineHeight:Zt().Nv.UIRegular.desktop,borderBottom:`1px solid ${t.tableDividerColor}`,left:0,right:0,...g&&{borderTop:"none"},...e.styles},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",left:f+8,color:t.lightTextColor},newIcon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor},newText:{color:t.lightTextColor}})),[f,g,e.styles]),v=(0,a().VK)((()=>{const e=r.permissionScopesStore.state,t=d.isSyncedCollection();return!i&&e.canEditContent&&!t}),[r,i,d]),x=(0,n.useCallback)((e=>{w().createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,canUndo:!0,perform:n=>{const i=Xe().yk({environment:t,collectionContextStore:r,groupsPointer:l,store:o,before:!1,collectionStore:d,transaction:n,subitemPath:u,subitemInsertDirection:"into",from:"cvb_new_subitem",event:e});i&&m(i)}}),j().JE(t,{...(0,le().Pn)(r)})}),[r,t,l,d,o,u,m]);return!v||h?null:(0,$.jsx)(pt().Z,{onClick:x,onMouseDown:de().$0,style:y.newRowButton,children:(0,$.jsxs)("span",{style:y.newRowContainer,children:[(0,Go().R)(y.newIcon),(0,$.jsx)("span",{style:y.newText,children:(0,$.jsx)(qe()._H,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})})]})})}var Fa=()=>o(985481);function Ka(e){let{property:t,propertyIndex:o,showProperties:r,blockPropertyValueOverlayStore:i,store:l,schema:c,collectionContextStore:d,disabled:u,isEditing:p,mouseIsEntered:m}=e;const g=(0,s().O7)(),S=(0,n.useCallback)((async()=>async function(e,t,o,n,r,i,l){Pa(Ta(e,t,o,n,r,l,await oe().F.formulas.load()),o,t,i,e)}(g,i,l,c,r,d,p)),[g,i,l,c,r,d,p]),h=(0,n.useCallback)((async()=>async function(e,t,o,n,r,i,l){Pa(ja(e,t,o,n,r,l,await oe().F.formulas.load()),o,t,i,e)}(g,i,l,c,r,d,p)),[g,i,l,c,r,d,p]),f=(0,a().VK)((()=>X().Bm({store:l,collectionContextStore:d})),[l,d]),y=(0,a().VK)((()=>d.collectionViewStore()),[d]),v=(0,a().VK)((()=>{const e=d.isInHomeWidgetStore.state,o=d.isUnlistedViewStore.state&&d.isInlineViewStore.state;return"title"===t&&m&&!e&&!o}),[d,m,t]),x=(0,a().VK)((()=>l.canEdit()),[l]),b=(0,a().VK)((()=>p||d.isInHomeWidgetStore.state),[p,d]),C=(0,a().VK)((()=>d.permissionScopesStore.state.isLocked||!d.permissionScopesStore.state.canEditContent),[d]);return f?(0,$.jsx)(xn().m,{store:l,property:t,propertyIndex:o,disabled:u||!x,locked:C,format:dt().C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:f,collectionViewStore:y,forceMouseEntered:v,showIfEmpty:b,onBgClick:()=>Ia(g,i,l),onEnter:()=>Ia(g,i,l),onEsc:()=>Ia(g,i,l),onTab:h,onUntab:S,onClick:()=>Ra(l)},t):null}function Oa(e){let{collectionContextStore:t,toggleButton:o,subitemPath:n}=e;const r=(0,a().Kw)(t.currentSubitemFormatStoreForUiDisplayStore),i=(null==n?void 0:n.length)??0;if(!r)return null;const l=Math.max((i-1)*Z().Hw,0)+Z().gY;return o?(0,$.jsxs)("div",{style:{paddingTop:4,display:"flex"},children:[(0,$.jsx)("div",{style:{width:l}}),o]}):(0,$.jsx)("div",{style:{minWidth:l+Z().Hw}})}const La=n.memo(n.forwardRef((function(e,t){const{store:o,schema:r,blockPropertyValueOverlayStore:i,handleOpenPeekPage:l,collectionContextStore:d,onShiftEnter:u,toggleButton:p,subitemPath:m,showProperties:g,disabled:S}=e,h=(0,s().O7)(),{isMobile:f,isPhone:y}=(0,s().Fy)(),v=(0,n.useRef)(null),x=(0,n.useRef)(null),[b,w]=(0,n.useState)(!1),[k,V]=(0,n.useState)(!1),[T,j]=(0,n.useState)(!1),R=(0,a().qz)(void 0,et().Z),P=(0,a().VK)((()=>{const e=co().Z.state;return Boolean(e.isActive&&e.store.id===o.id)}),[o.id]),I=(0,a().VK)((()=>{const e=Ca().Z.state;return e.store&&e.store.id===o.id?e.editMode:void 0}),[o.id]),_=(0,Qo().z)((()=>{Re().Z.state||R.setState({...R.state,mouseEntered:!0})}),100),M=(0,qo().y)((()=>{R.setState({...R.state,mouseEntered:!1})}),100),B=(0,a().VK)((()=>R.state.mouseEntered),[R]),F=(0,Qo().z)((()=>{j(!0)}),100),K=(0,Qo().z)((()=>{V(!0)}),100),O=(0,a().VK)((()=>N().default.state.stores.length>0&&N().default.state.stores[0].id===o.id),[o.id]),L=(0,n.useCallback)((()=>{const e=ka({environment:h,store:o,collectionContextStore:d});e&&(l(),Jo().c4({environment:h,url:e}))}),[h,l,o,d]),E=(0,a().VK)((()=>o.getBlockTitleStore()),[o]),A=(0,a().VK)((()=>function(e){return(0,ln().ZP)({store:e,fullyQualified:!1,pageVisitSource:Po().tY.LinkInPage})}(o)),[o]),H=(0,a().VK)((()=>ka({environment:h,store:o,collectionContextStore:d})),[h,o,d]),Z=(0,a().VK)((()=>g.map((e=>o.getPropertyValue(e)))),[g,o]),z=(0,n.useCallback)((()=>{!function(e,t){Ra(e),t()}(o,l)}),[o,l]),G=(0,n.useCallback)((()=>{x.current&&w(x.current.scrollWidth>x.current.clientWidth)}),[]),W=(0,Qo().z)(G,100),U=(0,c().yK)((e=>{return{container:{display:"flex",position:"relative"},linkBox:{position:"relative",...(t=P?"multi":"single",{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:6,..."single"===t?{height:30}:{minHeight:30}})},mobileLinkBox:{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:`1px solid ${e.tableDividerColor}`},linkBoxInner:{display:"flex",alignItems:"center",paddingLeft:4,userSelect:P?void 0:"none"},mobileLinkBoxInner:{paddingLeft:4,paddingRight:4,paddingBottom:4,paddingTop:4},propertiesWithTitleContainer:{display:"flex",alignItems:"center"},propertiesAfterTitleContainer:{display:"flex",alignItems:"center",paddingLeft:f?0:6,paddingBottom:f?0:4},hoveredStyle:{background:P?"transparent":e.buttonHoveredBackground},pressedStyle:{background:P?"transparent":e.buttonPressedBackground},overflowButtonArea:{position:"absolute",right:-28,top:"50%",transform:"translateY(-50%)",width:28,height:"100%",cursor:"pointer"},overflowButton:{position:"absolute",right:0,top:"50%",transform:"translateY(-50%)",display:"flex",width:20,height:20,borderRadius:4,justifyContent:"center",alignItems:"center",isolation:"isolate",zIndex:2,backdropFilter:"blur(8px)",background:e.buttonBackground,transition:"none",paddingLeft:2,paddingRight:0},overflowIcon:{width:12,height:12,fill:e.lightIconColor,marginLeft:-2}};var t}),[P,f]);(0,n.useEffect)((()=>{P&&"new"===I&&C().setSelectionAtEnd({store:E})}),[P,I,E]),(0,n.useEffect)((()=>(window.addEventListener("resize",W),()=>window.removeEventListener("resize",W))),[W]),(0,n.useEffect)((()=>{W()}),[W,Z]),(0,ps().L)((()=>{Ca().Z.reset(),co().Z.reset()}));const q=(0,n.useMemo)((()=>g.indexOf("title")),[g]),Y=y&&g.length>0,Q=(0,$.jsx)(Oa,{collectionContextStore:d,toggleButton:p,subitemPath:m}),X=(e,t)=>(0,$.jsx)(Ka,{blockPropertyValueOverlayStore:i,collectionContextStore:d,disabled:S,isEditing:P,mouseIsEntered:B,property:e,propertyIndex:t,showProperties:g,schema:r,store:o},e);let J;if(Y){const[e,t]=[g.slice(0,q+1),g.slice(q+1)];J=(0,$.jsxs)("div",{style:U.container,dir:"ltr",ref:v,children:[Q,(0,$.jsxs)(rn().Z,{ref:x,href:A,metaHref:H,external:!1,style:U.mobileLinkBox,innerStyle:U.mobileLinkBoxInner,children:[(0,$.jsx)("div",{style:U.propertiesWithTitleContainer,children:e.map(X)}),t.length>0&&(0,$.jsx)("div",{style:U.propertiesAfterTitleContainer,children:t.map(X)})]})]})}else J=(0,$.jsx)(D().Z,{debugName:"CollectionListViewItem",capture:O,onShiftEnter:u,children:(0,$.jsxs)("div",{style:U.container,dir:"ltr",ref:v,onMouseEnter:K,onMouseLeave:()=>V(!1),children:[Q,(0,$.jsx)(rn().Z,{ref:x,href:A,metaHref:H,altHref:H,onClick:z,external:!1,style:U.linkBox,innerStyle:U.linkBoxInner,hoveredStyle:U.hoveredStyle,pressedStyle:U.pressedStyle,onMouseEnter:_,onMouseMove:_,onMouseLeave:M,children:g.map(X)}),b&&(0,$.jsx)("div",{style:U.overflowButtonArea,children:(T||k)&&(0,$.jsx)(gt().Z,{renderTooltip:()=>(0,$.jsx)(qe()._H,{defaultMessage:"See all properties",id:"collectionList.overflow.tooltip"}),placement:we().Placement.Bottom,render:e=>(0,$.jsx)(mt().Z,{icon:Fa().k,iconStyle:U.overflowIcon,ariaLabel:"See all properties",style:U.overflowButton,onClick:L,onMouseEnter:F,onMouseLeave:()=>j(!1),...e})})})]})});return(0,he().ez)(o,t,(0,n.useMemo)((()=>({renderedType:"page",getBlockStore:()=>o,getNode:()=>v.current,activate:L})),[o,L]),J)})));function Da(){return{marginTop:1,marginBottom:1}}const Ea=n.memo((function(e){let{groupFormat:t,store:o,format:r,disabled:i,collectionContextStore:l,schema:c,blockPropertyValueOverlayStore:d}=e;const u=(0,s().O7)(),p=(0,n.useMemo)((()=>t?[t]:[]),[t]),m=(0,n.useMemo)((()=>(r.list_properties?r.list_properties:[]).filter((e=>e.visible)).map((e=>{let{property:t}=e;return t}))),[r]),{permissionScopes:g}=(0,a().VK)((()=>({permissionScopes:l.permissionScopesStore.state})),[l]),S=(0,a().VK)((()=>l.groupsStore.getGroupState(p)),[p,l]),h=(0,a().VK)((()=>!i&&o.canEdit()&&g.canEditContent&&!g.isSyncedCollection),[i,o,g]),f=(0,n.useCallback)((()=>{if(!S)return;const e=l.collectionStore();if(!e||!l.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=N().default.state.stores[0];if(!t)return;const o=l.subitemTreeStore.state,n=(0,to().DY)(o.children,(e=>e.value.store===t));if(!n)return;const r=n?(0,Z().Af)(n.map((e=>e.value.store))):"",i=l.subitemExpandedStore.state.get(r),s=Boolean(null==i?void 0:i.isExpanded);w().createAndCommit({userAction:"CollectionListView.onItemShiftEnter",environment:u,canUndo:!0,perform:o=>{const r=Xe().yk({environment:u,collectionContextStore:l,groupsPointer:S.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:n,subitemInsertDirection:s?"into":"below",from:"list_selection_overlay_shift_enter"});r&&_a({environment:u,newStore:r,previousStore:t})}}),j().sd(u,"list_item_edit_mode_enter",{...(0,le().Pn)(l),block_id:t.id,from:"shiftEnter",view_type:"list"})}),[l,u,S]),y=(0,n.useCallback)(((e,t)=>{_a({environment:u,newStore:t,previousStore:e})}),[u]),v=(0,n.useMemo)((()=>({blockPropertyValueOverlayStore:d,collectionContextStore:l,disabled:i,onShiftEnter:f,schema:c,showProperties:m,collectionViewBlockStore:o})),[d,l,i,f,c,m,o]),x=(0,n.useCallback)((e=>{const{store:t,parentStore:o,subitemPath:n,indentLevel:r}=e;if(o)return(0,$.jsx)(Ba,{store:t,collectionStore:o,subitemPath:n,indentLevel:r,collectionContextStore:l,disabled:i,groupsPointer:p,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{V().Z5({store:e,transient:!1}),Ca().Z.setState({store:e,editMode:"new",previousStore:void 0})}})}),[l,i,p]);return S?(0,$.jsx)(xo,{collectionContextStore:l,groupsPointer:p,format:r,canDrag:h,resultProps:v,canDrop:!0,resultComponent:La,disabled:i,shouldShowHoverMenu:!0,direction:yo.Vertical,analyticsName:"list",getItemSelectableStyle:Da,emptyDroppableSize:0,onSelectableInsertRow:y,nestedCreateSubitemButton:x}):null}));const Aa=n.memo((function(e){const{store:t,format:o,paddingBottom:r,paddingLeft:i,paddingRight:l,isFullScreen:d,isPreviewing:u,isRootChild:p,minWidth:m,disabled:g,collectionContextStore:S}=e,h=(0,s().O7)(),{isMobile:f}=(0,s().Fy)(),y=(0,c().Fg)(),v=(0,a().VK)((()=>X().az(S,d)),[S,d]),x=(0,a().VK)((()=>null==S?void 0:S.isInHomeWidgetStore.state),[S]),b=(0,a().VK)((()=>"collectionSystemView"===(null==S?void 0:S.contextType)),[S]),C=(0,a().VK)((()=>!!S.viewsModuleContextStore.getViewModuleType()),[S]),w=o.collection_group_by,k=(0,n.useCallback)(((e,t,o)=>{if(f)Io()._c({environment:h,store:e,pageVisitSource:Po().tY.Create});else if(t)_a({environment:h,newStore:e,previousStore:void 0});else{const{groupFormat:t}=o,n=t?[t]:[],r=S.groupsStore.getGroupState(n),i="collectionTypedView"===S.contextType;_o().CH({environment:h,store:e,peekMode:X().kr(S),showMoveTo:i,resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:S,pageVisitSource:Po().tY.Create})}}),[S,h,f]),V=(0,n.useCallback)((e=>0===e.index?{}:{borderTop:`1px solid ${y.tableDividerColor}`}),[y]),T=(0,n.useCallback)((o=>(0,$.jsx)(Zi,{reducerId:"list_groups",store:t,collectionContextStore:S,disabled:g,isFullScreen:d,isRootChild:p,paddingLeft:i,stickyLeft:!1,renderGroup:t=>(0,$.jsx)(Za,{...e,groupFormat:t}),getGroupStyle:V,renderHeader:e=>(0,$.jsx)(Ha,{args:e}),onGroupHeaderAddItem:k})),[S,g,V,k,d,p,i,e,t]),j=(0,n.useCallback)((e=>{const t=S.isLoadingStore.state,o=S.groupsStore.getGroupState([]);if(!o)return;if("collectionSystemView"===S.contextType)return;const n=o.reducerResultStore.state;e<Te().Z.incrementScrollOffset&&n&&!t&&n.hasMore&&Xe().ID({collectionContextStore:S,environment:h,incrementLimitArgs:{isFullScreen:d,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[S,h,d]),R=(0,c().yK)((()=>({container:{paddingBottom:x?0:r,paddingLeft:i,paddingRight:l,minWidth:m},selectable:{display:"flex",flexDirection:"column",paddingTop:w||x||b?void 0:4,paddingBottom:4}})),[r,i,l,m,w,x,b]);return(0,Fn().Z)((o=>(0,$.jsxs)("div",{style:R.container,className:ie().nM$,children:[(0,$.jsx)(ze().Z,{store:t,shouldShowHalo:!d&&!x,canSelect:!d&&!C,disablePointerEvents:u,analyticsName:"list",style:R.selectable,...o,children:w?T(w):(0,$.jsx)(Za,{...e,groupFormat:w})}),!v&&(0,$.jsx)(jo().Z,{onChange:j})]})))}));function Ha(e){const{args:t}=e,{collectionContextStore:o}=t,n=(0,a().Kw)(o.isInHomeWidgetStore),{stickyStyle:r}=(0,c().yK)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${e.contentBackground}`}})),[]);return(0,$.jsx)(Fr,{...t,height:n?tt().yZ:48,stickyStyle:r})}const Za=n.memo((function(e){const{store:t,format:r,schema:i,disabled:l,groupFormat:d,isFullScreen:u,collectionContextStore:p,blockPropertyValueOverlayStore:m}=e,{isMobile:g}=(0,s().Fy)(),S=void 0!==d,h=(0,n.useMemo)((()=>d?[d]:[]),[d]),f=(0,a().VK)((()=>p.groupsStore.getGroupState(h)),[p,h]),y=(0,a().VK)((()=>null==f?void 0:f.reducerResultStore.state),[f]),v=(0,a().VK)((()=>p.groupsStore.anyGroupHasResults()),[p]),{canEditContent:x,isSyncedCollection:b}=(0,a().VK)((()=>{const e=p.permissionScopesStore.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[p]),C=(0,a().VK)((()=>"collectionTypedView"===p.contextType),[p]),w=(0,a().Kw)(p.isInHomeWidgetStore),k=(0,a().VK)((()=>v&&!l&&t.canEdit()&&(x||C)&&!b),[v,l,t,x,C,b]),V=(0,a().VK)((()=>""!==p.searchQueryStore.state),[p]),T=(0,a().VK)((()=>void 0!==y&&(null==y?void 0:y.blockIds.length)>0),[y]),j=(0,a().VK)((()=>(0,Ro().H0)({collectionContextStore:p,groupsPointer:h,hasPartialResults:T})),[p,h,T]),R=(0,a().VK)((()=>X().VM({collectionContextStore:p,reducerResult:y,isFullScreen:u})),[p,y,u]),P=(0,c().yK)((e=>({container:{paddingBottom:d?w?8:16:void 0},groupLoadMoreButton:{fontSize:16,marginTop:g?4:void 0,paddingLeft:3},groupLoadMoreIcon:{width:16,height:16,marginRight:8},spacer:{width:"100%",borderTop:d||w?void 0:`1px solid ${e.tableDividerColor}`,marginTop:4,marginBottom:4}})),[d,w,g]);return f?(0,$.jsxs)("div",{style:P.container,children:[(0,$.jsx)(Ea,{groupFormat:d,store:t,format:r,disabled:l,collectionContextStore:p,schema:i,blockPropertyValueOverlayStore:m}),j&&(0,$.jsx)(o(23862).h,{isFullScreen:u,hasGroups:S,hasPartialResults:T,hasSearchQuery:V,overrideNumShimmerRows:w&&!T?6:void 0}),k&&(0,$.jsxs)($.Fragment,{children:[R&&(0,$.jsx)("div",{style:P.spacer}),(0,$.jsx)(za,{collectionContextStore:p,isFullScreen:u,groupState:f,groupFormat:d})]}),R&&(0,$.jsx)(Ut().ZP,{groupsPointer:h,store:t,collectionContextStore:p,format:r,isFullScreen:u,incrementLimitsInRelatedGroups:!1,style:P.groupLoadMoreButton,iconStyle:P.groupLoadMoreIcon})]}):null})),za=n.memo((function(e){const{groupState:t,groupFormat:o,collectionContextStore:r,isFullScreen:i}=e,l=(0,s().O7)(),d=(0,qe().YB)(),{isMobile:u}=(0,s().Fy)(),p=(0,a().Kw)(r.isInHomeWidgetStore),m=(0,a().VK)((()=>X().Il({collectionContextStore:r,environment:l,intl:d})),[r,l,d]),g=(0,n.useCallback)((()=>{if(!(0,Oe().ww)(l))return void(0,Oe().eD)(l);const e=r.currentSubitemFormatStoreForUiDisplayStore.state;w().createAndCommit({userAction:"CollectionListView.handleAddItemClick",environment:l,canUndo:!0,perform:o=>{!function(e){var t;const{transaction:o,environment:n,results:r,collectionContextStore:i,isFullScreen:l,groupsPointer:s,insertAtIndex:a,from:c}=e;i.searchQueryStore.state&&V().Ug({searchQuery:"",collectionContextStore:i,isFullScreen:l});const d=null===(t=i.groupsStore.getGroupState(s))||void 0===t?void 0:t.resultsStore;if(!d)return;let u;a>0&&(u=r[a]);const p=Xe().IW({environment:n,collectionContextStore:i,groupsPointer:s,insertAtIndex:a,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:o,from:{createBlock:c},inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache});if(!p)return;const m=p.coercionSucceeded,g=p.newStore;n.device.isMobile?Io()._c({environment:n,store:g,pageVisitSource:Po().tY.Create}):m?_a({environment:n,newStore:g,previousStore:u}):_o().CH({environment:n,store:g,peekMode:(0,X().kr)(i),resultsStore:d,collectionContextStore:i,pageVisitSource:Po().tY.Create}),io().W(n,{from:c,type:"page",new_page_id:g.id,creating_block_id:g.id,...(0,le().Pn)(i)})}({transaction:o,environment:l,results:t.resultsStore.state,collectionContextStore:r,isFullScreen:i,groupsPointer:t.groupsPointer,insertAtIndex:t.resultsStore.state.length,from:e?"list_view_add_parent_item_bottom":"list_view_add_item_bottom"})}})}),[l,t,r,i]),S=(0,c().yK)((e=>({button:{display:"flex",alignItems:"center",height:(0,k().rM)({isMobile:u}),borderRadius:6,fontSize:p?14:16,color:e.lightTextColor,paddingLeft:4,paddingRight:12},icon:{width:p?12:16,height:p?12:16,marginLeft:p?10:3,marginRight:p?6:8,fill:e.lightIconColor},buttonContainer:{display:"flex"}})),[p,u]);return m?(0,$.jsxs)("div",{style:S.buttonContainer,children:[(0,$.jsxs)(pt().Z,{onClick:g,onMouseDown:de().$0,style:S.button,children:[(0,Go().R)(S.icon),(0,$.jsx)(Ko,{collectionContextStore:r})]}),(0,$.jsx)(No().a,{collectionContextStore:r,groupFormat:o,renderLinkButton:e=>(0,$.jsxs)(pt().Z,{style:S.button,...e,children:[(0,Uo().v)(S.icon),(0,$.jsx)(qe()._H,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})]}):(0,$.jsxs)(pt().Z,{onClick:g,onMouseDown:de().$0,style:S.button,children:[(0,Go().R)(S.icon),(0,$.jsx)(Ko,{collectionContextStore:r})]})}));class Ga extends d().default{getInitialState(){return{}}getCurrentFormat(e){return this.state.temporaryFormat?this.state.temporaryFormat:e}getCurrentProperties(e,t){return this.getCurrentFormat(t)[e]||[]}}const Wa=Ga;var Na=()=>o(928459);const Ua=n.memo((function(e){let{collectionContextStore:t,tableProperties:o,paddingLeft:r,paddingRight:i,children:l}=e;const c=(0,s().O7)(),d=(0,n.useMemo)((()=>o.filter((e=>e.visible))),[o]),u=(0,a().VK)((()=>{var e;const o=null===(e=t.virtualizedModule.getHorizontalScrollerRefStore())||void 0===e||null===(e=e.state)||void 0===e?void 0:e.current;return o?o.getStore().state.elementRef.current:null}),[t]),p=(0,a().VK)((()=>{const e=t.frozoneStore.state.frozenIndex;return void 0===e?0:e+1}),[t]),m=(0,a().VK)((()=>d.map((e=>(0,k().vf)({environment:c,propertyFormat:e})))),[c,d]),g=(0,n.useCallback)((e=>e+p>m.length-1?35:m[e+p]??35),[m,p]),S=(0,$t().MG)({count:d.length,estimateSize:g,scrollMargin:r,getScrollElement:()=>u,getItemKey:e=>d[e].property||e,scrollPaddingStart:r,scrollPaddingEnd:i,overscan:1,horizontal:!0}),h=S.getVirtualItems(),[f,y]=(0,n.useMemo)((()=>h.length>0?[h[0].start-r,S.getTotalSize()-h[h.length-1].end]:[0,0]),[h,S,r]),{propertiesInRange:v,propertiesInRangeIndices:x}=(0,n.useMemo)((()=>{if(0===h.length)return{propertiesInRange:[],propertiesInRangeIndices:[]};const e=p+h[0].index,t=h[h.length-1].index+1;return{propertiesInRange:d.slice(e,t),propertiesInRangeIndices:Array.from({length:t-e},((t,o)=>e+o))}}),[h,p,d]);return(0,$.jsx)(Na().Q.Provider,{value:{columnVirtualizer:S,propertiesInRange:v,propertiesInRangeIndices:x,beforeWidth:f,afterWidth:y},children:l})}));var $a=()=>o(109477),qa=()=>o(269932),Ya=()=>o(339523);const Qa={display:"flex",width:32,height:"100%",alignItems:"center",justifyContent:"center"};function Xa(e){(0,de().ZP)({event:e,context:de().Af.EditorMouseDown,callback:()=>{}})}function Ja(e,t){return!e&&t}var ec=()=>o(759005);const tc=n.memo((function(e){const{disabled:t,property:r,schema:i,collectionContextStore:l,groupFormat:d,propertyFormat:u,isHovered:p,aggregation:m,onChange:g}=e,h=(0,s().O7)(),y=(0,qe().YB)(),{isMobile:v}=(0,s().Fy)(),[x,b]=(0,n.useState)(void 0),C=(0,n.useMemo)((()=>Boolean((null==u?void 0:u.width)&&u.width<100)),[u]),w=(0,a().VK)((()=>gr(l,m)),[l,m]),k=(0,a().VK)((()=>{if(!m)return;return{type:"aggregation",filter:d?(0,qt().zk)({schema:i,propertyMapping:void 0,groupBy:l.getGroupByAndGroupFormats().groupBy,group:d,timeZone:(0,Yt().r)(),experimentService:je().default}):void 0,aggregation:m}}),[i,d,m,l]),V=(0,n.useCallback)(((e,t)=>{if(e){const o={aggregator:e,property:r,enforceMaxAggregationLimit:t};g(r,o),b(o),f().wd({environment:h,collectionContextStore:l,action:"table_change_aggregation"})}else g(r,void 0),f().wd({environment:h,collectionContextStore:l,action:"table_remove_aggregation"})}),[h,g,r,l]),T=(0,c().yK)((()=>({buttonStyle:{display:"flex",alignItems:"center",justifyContent:"flex-end",width:"100%",height:32,paddingRight:8,overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",transition:"background 0.2s ease"}})),[]);(0,n.useEffect)((()=>{x&&!gr(l,x)&&(0,S().Xy)(m,x)&&b(void 0)}),[w,x,l,m]);const j=(0,n.useMemo)((()=>C&&null!=m&&m.aggregator?pr().VN[(0,dr().OV)(m)]:void 0),[C,m]),R=(0,n.useMemo)((()=>{const e=null==k?void 0:k.aggregation;if(!e)return"";let t=`${e.aggregator}`;return"object"==typeof e.aggregator&&"operator"in e.aggregator&&(t=`${e.aggregator.operator}:${e.aggregator.groupName}`),`table:${(0,zt().mD)(d)}:${r}:${t}`}),[d,r,null==k?void 0:k.aggregation]),P=(0,n.useCallback)((e=>k?(0,$.jsx)(Xt().Z,{id:R,collectionContextStore:l,reducer:k,groupsPointer:d?[d]:void 0,render:o=>(0,$.jsx)(gt().Z,{alignment:C?we().Alignment.Center:we().Alignment.End,disableTooltip:!w&&!j,renderTooltip:()=>w?y.formatMessage(fr.aggregationCalculating):j,render:n=>(0,$.jsx)(pt().Z,{disabled:t,style:T.buttonStyle,...(0,mr().Z)(n,e),children:(0,$.jsx)(oc,{resultStore:o,aggregation:m,schema:i,property:r,hideLabelText:C})})})}):(0,$.jsx)(pt().Z,{disabled:t,style:T.buttonStyle,...e,children:(0,$.jsx)(nc,{disabled:t,isHovered:p,hideLabelText:C})})),[k,R,l,d,t,T.buttonStyle,p,C,w,j,y,m,i,r]),I=(0,n.useCallback)((e=>{let{close:t}=e;return(0,$.jsx)(o(103163).Z,{currentAggregation:m,property:r,schema:i,onChange:V,onClose:t,source:"tableAggregation"})}),[V,m,r,i]);return(0,$.jsx)(vr().ZP,{popupType:v?vr().Z4.SlideUp:vr().Z4.Popup,disabled:t,renderOrigin:P,render:I})})),oc=n.memo((function(e){const{aggregation:t,resultStore:r,schema:i,property:l,hideLabelText:d}=e,u=(0,E().Y$)(),{isMobile:p}=(0,s().Fy)(),m=(0,c().yK)((e=>({valueStyle:{display:"flex",alignItems:"center",height:"100%"},aggregationTypeNameStyle:{fontSize:p?12:10,textTransform:"uppercase",letterSpacing:1,color:e.mediumTextColor,marginTop:p?0:2,marginRight:4,userSelect:"none"}})),[p]),g=(0,a().Kw)(r),S=(0,n.useMemo)((()=>{if(!t)return;let e=pr().v6[(0,dr().OV)(t)];return(0,dr().en)(t.aggregator)&&(e=t.aggregator.groupName in ec().ZA?ec().ZA[t.aggregator.groupName]:t.aggregator.groupName),e}),[t]),{numberFormat:h,numberPrecision:f}=(0,a().VK)((()=>{const e=i[l];if(!e)return{};if(e&&("formula"===e.type||"number"===e.type)){const o=e.number_format,n=e.number_precision;return{numberFormat:o,numberPrecision:t?(0,pr().WD)(t.aggregator,n):n}}if("rollup"===e.type&&e.relation_property&&e.target_property&&"number"===e.target_property_type&&void 0!==i[e.relation_property]){var n;const r=i[e.relation_property],l=(0,o(129338).ny)(u,r),s=null==l||null===(n=l.getModel())||void 0===n?void 0:n.getNormalizedSchema(),a=null==s?void 0:s[e.target_property];if("number"===(null==a?void 0:a.type)){const e=a.number_format,o=a.number_precision;return{numberFormat:e,numberPrecision:t?(0,pr().WD)(t.aggregator,o):o}}}return{}}),[i,l,t,u]);if(!S)return null;const y=(0,$.jsx)("span",{style:m.valueStyle,children:t&&(0,$.jsx)(Sr,{aggregation:t,collectionContextStore:u,children:g?(0,pr().Zy)({numberFormat:h,dateFormat:void 0,aggregation:t,userTimeZone:(0,Yt().r)(),value:g.aggregationResult,numberPrecision:f}):void 0})},"value");return d?y:(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("span",{style:m.aggregationTypeNameStyle,children:S},"type"),y]})})),nc=n.memo((function(e){const{disabled:t,isHovered:n,hideLabelText:r}=e,{isMobile:i}=(0,s().Fy)(),l=(0,c().yK)((e=>({placeholderWrapper:{display:"flex",alignItems:"center"},placeholderText:{color:e.lightTextColor},chevronIcon:{width:10,marginLeft:r?1:4,marginTop:1,fill:e.lightIconColor},summationIcon:{width:12,marginTop:1,fill:e.lightIconColor}})),[r]);return t||!n&&!i?null:(0,$.jsx)(ut().Z,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:l.placeholderWrapper,children:(0,$.jsxs)("div",{style:l.placeholderWrapper,children:[r?(0,$.jsx)("span",{style:l.placeholderText,children:(0,o(382047).D)(l.summationIcon)},"placeholder"):(0,$.jsx)("span",{style:l.placeholderText,children:(0,$.jsx)(qe()._H,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})},"placeholder"),(0,Si().i)(l.chevronIcon)]})})})),rc=n.memo((function(e){let{collectionContextStore:t,disabled:o,groupFormat:r,isFullScreen:i,isInPeekRenderer:l,query:d,schema:u,showPropertyFormats:p,showRightActionsSpacer:m,style:g,paddingLeft:S,paddingRight:h,onMouseEnter:f,onMouseLeave:y,disableSticky:v}=e;const x=(0,s().O7)(),{isPhone:b,isMobile:C}=(0,s().Fy)(),w=(0,c().Fg)(),[V,T]=(0,n.useState)(!1),j=(0,a().VK)((()=>t.frozoneStore.state.frozenIndex),[t.frozoneStore]),{unfrozenIndexAddendum:R,frozenPropertyFormats:P,unfrozenPropertyFormats:I}=(0,a().VK)((()=>{const e=p;let t=[],o=e;const n=(0,X().bW)(j);return void 0!==j&&(t=e.slice(0,n),o=e.slice(n)),{unfrozenIndexAddendum:n,frozenPropertyFormats:t,unfrozenPropertyFormats:o}}),[j,p]),_=(0,a().Kw)(t.isInHomeWidgetStore),M=(0,X().jw)(t,w),B=(0,a().VK)((()=>{const e=_?void 0:(null==M?void 0:M.background)||(l?w.cardContentBackground:w.contentBackground);return{borderTop:`1px solid ${w.tableDividerColor}`,display:"flex",background:e,zIndex:$e().RJ,fontSize:14,height:(0,k().rM)({isMobile:C})+(i&&!r?Ve().Z.state:0),minWidth:"100%",clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",left:0,boxSizing:"border-box",...g}}),[i,l,g,w,_,C,r,null==M?void 0:M.background]),F=(0,a().VK)((()=>void 0!==j&&(0,k().oc)({environment:x,collectionContextStore:t,isPhone:b,theme:w})),[j,x,t,b,w]),K=(0,a().VK)((()=>{var e;return((null==d||null===(e=d.aggregations)||void 0===e?void 0:e.length)??0)>0}),[null==d?void 0:d.aggregations]),O=(0,n.useCallback)((()=>{T(!0),null==f||f()}),[T,f]),L=(0,n.useCallback)((()=>{T(!1),null==y||y()}),[T,y]),D=(0,n.useCallback)((e=>{(0,de().ZP)({event:e,context:de().Af.EditorMouseDown,callback:()=>{}})}),[]),E=(0,c().yK)((()=>({stickyStyle:{paddingLeft:S,paddingRight:h,fontVariantNumeric:"lining-nums tabular-nums"},container:{display:"flex",paddingRight:!o&&m?32:0},innerContainer:{display:"flex"}})),[o,S,h,m]),A=(0,n.useCallback)(((e,n)=>(0,$.jsx)(ic,{propertyFormat:e,groupFormat:r,disabled:o,mouseEntered:V,collectionContextStore:t,schema:u,query:d},e.property)),[t,o,r,V,d,u]),H=!_&&(K||i),Z=(0,n.useRef)(null),z=(0,$.jsx)(He().p,{allowSelectionWithin:!1,style:B,onMouseMove:O,onMouseLeave:L,onMouseDown:D,ref:Z,children:(0,$.jsx)("div",{style:E.container,children:(0,$.jsxs)("div",{style:E.innerContainer,children:[void 0!==j&&(0,$.jsx)("div",{style:{...F,display:"flex"},children:P.map(A)}),I.map(((e,t)=>A(e,t+R)))]})})});return H?(0,$.jsx)(Mr().u,{stickyAttachPoint:v?"no-stick":"floor",stickyStyle:E.stickyStyle,nodeRef:Z,children:z}):z})),ic=n.memo((function(e){var t;let{propertyFormat:o,groupFormat:r,disabled:i,mouseEntered:l,collectionContextStore:d,query:u,schema:p}=e;const m=(0,s().O7)(),g=(0,c().yK)((()=>({wrapper:{display:"flex",width:o.width}})),[o.width]),h=(0,n.useCallback)(((e,t)=>{const o=d.collectionViewStore();if(!o)return;let n=u.aggregations?[...u.aggregations]:[];const r=(u.aggregations||[]).findIndex((t=>t.property===e));n=r<0?S().oA([...n,t]):S().oA(n.map(((e,o)=>r===o?t:e)));const i={...u,aggregations:n};!d.isClientModeEnabledStore.state&&t&&d.asyncAggregationStatusStore.setState({calculating:!0,aggregation:t,changingType:!0}),w().createAndCommit({userAction:"TableAggregationRow.handleTableAggregationChange",environment:m,canUndo:!0,perform:e=>{V().iG({collectionViewStore:o,update:{query2:i},transaction:e})}})}),[d,u,m]),f=(0,a().VK)((()=>!i&&!!l),[l,i]);return(0,$.jsx)("div",{style:g.wrapper,children:(0,$.jsx)(tc,{groupFormat:r,propertyFormat:o,disabled:i,isHovered:f,aggregation:null===(t=u.aggregations)||void 0===t?void 0:t.find((e=>e.property===o.property)),property:o.property,collectionContextStore:d,schema:p,onChange:h})})})),lc=n.memo(n.forwardRef((function(e,t){const{collectionContextStore:o,handleAddRowClick:r,numberOfBlankRows:i,isBlockPropertyValueOverlayOpen:l,hideDefaultButtonText:d}=e,{isMobile:u}=(0,s().Fy)(),[p,m]=(0,n.useState)(0),g=(0,a().Kw)(o.isInHomeWidgetStore),S=(0,c().yK)((e=>{const t=g?e.tableHomeDividerColor:e.tableDividerColor,{button:o,buttonInner:n,icon:r}=(0,k().UD)({theme:e,isMobile:u,hideTextWithTransition:d,hideTextWithoutTransition:l});return{button:{...o,transition:"background 0.2s ease",borderBottom:`1px solid ${t}`},buttonInner:n,icon:r}}),[g,u,d,l]);return(0,$.jsxs)("div",{onMouseLeave:()=>m(0),ref:t,children:[(0,$.jsx)(pt().Z,{className:ie().tfM,onClick:r,onMouseDown:de().$0,style:S.button,onMouseEnter:()=>m(0),children:(0,$.jsxs)("span",{style:{...S.buttonInner,opacity:0!==p||d?0:1},children:[(0,Go().R)(S.icon),(0,$.jsx)(Ko,{collectionContextStore:o})]})},"add-row-button-default"),Array.from({length:i}).map(((e,t)=>{const n=t+1,l=n===i,s=p===n?1:0;return(0,$.jsx)(pt().Z,{className:ie().Gcz,onClick:r,onMouseDown:de().$0,style:{...S.button,...l&&{borderBottom:"none"}},onMouseEnter:()=>m(n),children:(0,$.jsxs)("span",{style:{...S.buttonInner,opacity:s},children:[(0,Go().R)(S.icon),(0,$.jsx)(Ko,{collectionContextStore:o})]})},n)}))]})})));function sc(e){const{collectionContextStore:t,shouldShowAddRowButton:o,handleAddRowClick:n}=e,{isMobile:r}=(0,s().Fy)(),i=(0,a().VK)((()=>Boolean(t.currentCombinatorFilterStore.state||t.currentPropertyFiltersStore.state.length>0)),[t]),l=(0,a().Kw)(t.isInHomeWidgetStore),d=(0,c().yK)((e=>{const t=l?e.tableHomeDividerColor:e.tableDividerColor,{button:o,buttonInner:n}=(0,k().UD)({theme:e,isMobile:r});return{button:{...o,borderBottom:`1px solid ${t}`},buttonInner:n}}),[l,r]);return(0,$.jsx)(pt().Z,{className:ie().Gcz,onClick:n,onMouseDown:de().$0,disabled:!o,style:d.button,children:o?(0,$.jsx)("span",{style:d.buttonInner,children:i?(0,$.jsx)(qe()._H,{defaultMessage:"No filter results. Click to add a row.",id:"database.tableView.emptyTablePlaceholderWithFilters"}):(0,$.jsx)(qe()._H,{defaultMessage:"Empty. Click to add a row.",id:"database.tableView.emptyTablePlaceholder"})}):(0,$.jsx)("span",{style:d.buttonInner,children:i?(0,$.jsx)(qe()._H,{defaultMessage:"No filter results.",id:"database.tableView.cannotEdit.emptyTablePlaceholderWithFilters"}):(0,$.jsx)(qe()._H,{defaultMessage:"Empty.",id:"database.tableView.cannotEdit.emptyTablePlaceholder"})})})}function ac(e){let{collectionContextStore:t}=e;const r=(0,s().O7)(),i=(0,c().yK)((e=>({button:{display:"flex",justifyContent:"flex-start",width:32},icon:{width:12,fill:e.mediumIconColor}})),[]),l=(0,n.useCallback)((()=>{t.collectionStore()&&(C().clear({environment:r}),b().ZH({environment:r}),V().wG(),f().wd({environment:r,collectionContextStore:t,action:"click_new_property"}),y().wl({collectionSettingsStore:t.settingsStore,item:{type:"propertyType",onAccept:(e,n,i,l)=>{o(853292).PW({environment:r,collectionContextStore:t,propertyType:e,isSuggestedProperty:n,propertyName:i,selectOptions:l,from:"table"})}}}))}),[t,r]);return(0,$.jsx)(pt().Z,{style:i.button,onMouseDown:Xa,onClick:l,className:ie().V6y,children:(0,$.jsx)("div",{style:Qa,children:(0,Go().R)(i.icon)})})}function cc(e){let{collectionContextStore:t}=e;const o=(0,s().O7)(),r=(0,c().yK)((e=>({dotsIcon:{width:12,fill:e.mediumIconColor},button:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:32}})),[]),i=(0,n.useCallback)((()=>{y().r$({collectionContextStore:t,collectionSettingsStore:t.settingsStore}),f().wd({environment:o,collectionContextStore:t,action:"click_table_header_dot_menu"}),y().H4({collectionSettingsStore:t.settingsStore,item:{type:"properties",timelineViewTab:"timeline"}})}),[t,o]);return(0,$.jsx)(pt().Z,{style:r.button,onMouseDown:Xa,onClick:i,className:ie().V6y,children:(0,$.jsx)("div",{style:Qa,children:(0,fn().o)(r.dotsIcon)})})}var dc=()=>o(644235),uc=()=>o(645805);const pc=2,mc=3;function gc(e){const{isCollectionViewBlockSelected:t,passesFilter:o,isScrolled:r,isCheckbox:i,isShimmerRow:l}=e,s=(0,n.useCallback)((e=>"dark"===e.mode?"transparent":o&&!t?`linear-gradient(to right, ${(0,ws().Fq)(Bo().se[e.mode].gray,.15)},${(0,ws().Fq)(Bo().se[e.mode].gray,.1)},  transparent)`:`linear-gradient(to right, ${(0,ws().Fq)(Bo().se[e.mode].gray,.35)},${(0,ws().Fq)(Bo().se[e.mode].gray,.2)},  transparent)`),[o,t]),a=(0,c().yK)((e=>({border:{position:"absolute",right:0,width:pc,height:l?35:"100%",background:o&&!t||"dark"===e.mode?e.tableDividerColor:e.tableFrozenFilterDividerColor},shadow:{position:"absolute",top:0,right:-mc,width:mc,height:l?34:"100%",background:s(e)}})),[l,o,t,s]);return(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"row",height:"100%"},children:[i?null:(0,$.jsx)("div",{style:a.border}),(0,$.jsx)(ut().Z,{visible:!0,animate:{opacity:r?1:0},children:(0,$.jsx)("div",{style:a.shadow})})]})}function Sc(e){const{checkedState:t,onClick:o,checkboxType:r,collectionContextStore:i,isBlockHovered:l,passesFilter:d,disabled:u,frozoneProps:p}=e,m=(0,s().O7)(),g=(0,a().qz)(void 0,et().Z),S=(0,dc().hq)(),h=(0,a().VK)((()=>S&&uc().default.state.isOpen&&uc().default.state.isPlusButtonVisible),[S]),y=(0,a().VK)((()=>g.state.mouseEntered),[g]),v=(0,n.useRef)(null);(0,n.useEffect)((()=>{v.current&&(v.current.indeterminate="indeterminate"===t)}),[t]);const x=(0,a().VK)((()=>uo().default.state.isDragging),[]),b=(0,n.useCallback)((e=>{u||(o(e),f().Ac({environment:m,collectionContextStore:i,checkbox_type:r}))}),[u,r,i,m,o]),C=(0,a().VK)((()=>h?0:!1===t&&!y||x?l?.6:null!=p&&p.shouldShowStickyMultiSelectColumn?.4:0:1),[t,y,x,l,null==p?void 0:p.shouldShowStickyMultiSelectColumn,h]),w=(0,c().yK)((e=>({multiSelectCheckbox:{background:null!=p&&p.isScrolled?null==p?void 0:p.frozenStyles.background:void 0,borderBottom:e.tableDividerColor,height:"100%"},multiSelectCheckboxInner:{background:null!=p&&p.isCollectionViewBlockSelected?Bo().ZP.blueWithAlpha(.14):void 0,height:"100%"},checkBoxInput:{width:Bt().tA,height:Bt().tA,cursor:u?void 0:"pointer",accentColor:e.fill.uiBlue,position:"relative",right:2}})),[u,null==p?void 0:p.frozenStyles.background,null==p?void 0:p.isCollectionViewBlockSelected,null==p?void 0:p.isScrolled]),k=null!=p&&p.shouldShowStickyMultiSelectColumn?C>0?1:0:C;return(0,$.jsxs)(ut().Z,{animate:{opacity:k},style:w.multiSelectCheckbox,onMouseEnter:()=>g.enter(),onMouseLeave:()=>g.exit(),children:[(0,$.jsx)("div",{style:w.multiSelectCheckboxInner,children:(0,$.jsx)("label",{style:{height:"100%",alignItems:"flex-start",justifyContent:"center",display:"flex",cursor:u?void 0:"pointer",zIndex:1},onClick:de().Wi,onMouseDown:de().$0,children:(0,$.jsx)("div",{style:{width:`${Bt().bu}px`,height:`${Bt().bu}px`,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,$.jsx)("input",{type:"checkbox",style:w.checkBoxInput,ref:v,checked:!0===t,onChange:b,disabled:u})})})}),(null==p?void 0:p.shouldFreezeMultiSelectColumn)&&(0,$.jsx)(gc,{isCollectionViewBlockSelected:null==p?void 0:p.isCollectionViewBlockSelected,passesFilter:d,isCheckbox:!0,isScrolled:!0})]})}function hc(e){const{groupsPointer:t,collectionContextStore:o,hasMoreReducerResults:r,frozoneProps:i}=e,l=(0,s().O7)(),d=(0,n.useCallback)((()=>(0,Z().A7)(t[0],o).filter((e=>e.canEdit()))),[o,t]),u=(0,a().VK)((()=>0===d().length),[d]),{checkedState:p,allVisibleItemsChecked:m}=(0,a().VK)((()=>{const e=d(),t=e.length;if(0===t)return{checkedState:!1,allVisibleItemsChecked:!0};const o=N().default.state.stores.filter((t=>e.includes(t))).length;let n;return n=0!==o&&(o===t&&!r||"indeterminate"),{checkedState:n,allVisibleItemsChecked:o===t}}),[d,r]),g=(0,n.useCallback)((e=>{var t;const n=d(),r=N().default.state.stores,i=(0,k().vg)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:r;!1===p||"indeterminate"===p&&!m?b().Z5({environment:l,stores:S().G0(i,n)}):(!0===p||"indeterminate"===p&&m)&&b().Z5({environment:l,stores:S().zu(i,...n)}),e.stopPropagation(),e.preventDefault()}),[p,o,l,d,m]),h=(0,a().VK)((()=>(0,X().fk)({environment:l,collectionContextStore:o})),[l,o]),f=(0,c().yK)((()=>({wrapper:{...null==i?void 0:i.frozenStyles,...-1===(null==i?void 0:i.frozenIndex)&&{background:void 0}},checkboxContainer:h?{position:"absolute",left:-Bt().Xx,background:-1===(null==i?void 0:i.frozenIndex)||null==i?void 0:i.frozenStyles.background}:{display:"contents"}})),[null==i?void 0:i.frozenIndex,null==i?void 0:i.frozenStyles,h]);return(0,$.jsx)("div",{style:f.wrapper,children:(0,$.jsx)("div",{style:f.checkboxContainer,children:(0,$.jsx)(Sc,{passesFilter:!0,checkedState:p,onClick:g,checkboxType:"group",collectionContextStore:o,frozoneProps:i?{...i,isCollectionViewBlockSelected:!1}:void 0,disabled:u})})})}var fc=()=>o(536381),yc=()=>o(148126),vc=()=>o(455241),xc=()=>o(542649);function bc(e){const{origin:t,propertyType:o}=e,n=(0,s().O7)();return(0,$.jsx)(pa().U,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return(0,$.jsx)(qe()._H,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner"});case"verification":return(0,$.jsx)(qe()._H,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification"});case"tags":return(0,$.jsx)(qe()._H,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more"});default:(0,h().t1)(o)}}(),content:function(){switch(o){case"owner":return(0,$.jsx)(qe()._H,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty",values:{bold:e=>(0,$.jsx)("span",{style:{fontWeight:Zt().Ue.semibold},children:e})}});case"verification":return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(qe()._H,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty"}),(0,$.jsx)(vc().d,{href:(0,yc().UY)("guides.wikis"),style:{color:Bo().ZP.uiLightGray}})]});case"tags":return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(qe()._H,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty"}),(0,$.jsx)(vc().d,{href:(0,yc().UY)("guides.databaseProperties"),style:{color:Bo().ZP.uiLightGray}})]});default:(0,h().t1)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,h().t1)(o)}}(),onCloseClick:()=>{fc().nX(n)},onPrimaryButtonClick:()=>fc().Rg(n),onBackButtonClick:()=>fc().FO(n),enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerLength:xc().EZ,pointerOffset:xc().FD,style:{width:xc().G5}})}var Cc=()=>o(98642),wc=()=>o(494616);const kc=new(G().Ss)("TableHeaderCellMenu",(()=>Promise.all([o.e(62743),o.e(2971),o.e(80741),o.e(72586),o.e(54940),o.e(54041)]).then(o.bind(o,490875)))),Vc=(0,G().kF)(kc,(e=>e.TableHeaderCellMenu));var Tc=()=>o(269853),jc=()=>o(475692),Rc=()=>o(162109),Pc=()=>o(63562),Ic=()=>o(514),_c=()=>o(173113),Mc=()=>o(104088);const Bc=(0,qe().vU)({relation:{defaultMessage:"This relation links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceRelationError.message"},formula:{defaultMessage:"This formula links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceFormulaError.message"},linkedView:{defaultMessage:"This view references content from another workspace. Cross-workspace functionality is limited, so some content may not sync correctly.",id:"collection.tableHeaderCell.crossSpaceLinkedViewError.message"}}),Fc=n.memo((function(e){let{type:t}=e;const r=(0,s().O7)(),i=(0,qe().YB)(),l=(0,n.useRef)(null),a=(0,c().yK)((e=>({icon:{fill:e.icon.orangePrimary},text:{width:300,color:e.text.secondary,padding:"12px 16px",fontSize:14},footer:{display:"flex",justifyContent:"space-between",borderTop:`1px solid ${e.stroke.secondary}`},button:{width:"auto"},dismissButton:{color:e.text.uiBluePrimary},learnMoreButton:{color:e.text.secondary},learnMoreIcon:{width:14,height:14,marginRight:0}})),[]),d=(0,yc().UY)("guides.duplicateToSpace"),u=(0,n.useCallback)((()=>(0,$.jsxs)(er().Z,{menuType:Yn().o.Popup,children:[(0,$.jsx)(nr().Z,{style:a.text,children:i.formatMessage(Bc[t])}),(0,$.jsx)(tr().Z,{type:tr().i.Vertical,initialFocus:void 0,sections:[{key:"footer",items:[{key:"dismiss",action:()=>{var e;null===(e=l.current)||void 0===e||e.setOpen(!1)},render:e=>(0,$.jsx)(yr().Z,{...e,title:(0,$.jsx)(qe()._H,{defaultMessage:"Dismiss",id:"collection.tableHeaderCell.crossSpaceRelationError.dismiss"}),buttonStyle:{...a.button,...a.dismissButton}})},{key:"learn-more",action:e=>{var t,o,n;null===(t=(o=e.event).preventDefault)||void 0===t||t.call(o),null===(n=l.current)||void 0===n||n.setOpen(!1),Jo().c4({environment:r,url:d,openInNew:"tab"})},render:e=>(0,$.jsx)(yr().Z,{...e,title:(0,$.jsx)(qe()._H,{defaultMessage:"Learn more",id:"collection.tableHeaderCell.crossSpaceRelationError.learnMore"}),icon:(0,o(653457).m)(),desktopIconStyle:a.learnMoreIcon,buttonStyle:{...a.button,...a.learnMoreButton},href:d,external:!0})}],render:e=>(0,$.jsx)(nr().Z,{...e,style:a.footer})}]})]})),[a,i,r,d,t]),p=(0,n.useCallback)((e=>(0,$.jsx)(mt().Z,{icon:Vn().t,iconStyle:a.icon,ariaLabel:i.formatMessage(Bc[t]),...e})),[a,i,t]);return(0,$.jsx)(vr().ZP,{popupType:Mc().k.Popup,render:u,renderOrigin:p,ref:l})})),Kc=n.memo((function(e){const{allowHidingTitle:t,collectionContextStore:r,columnIndex:i,disableCellRightBorder:l,disabled:d,format:u,formatKey:p,isLast:m,paddingTop:g,property:S,renderSpacer:f,schema:y,width:v,collectionViewBlockStore:x}=e,w=(0,n.useRef)(null);(0,Cc().c)(o(804097).Z,(()=>({collectionContextStore:r,property:S,getNode:()=>w.current})),[r,S]);const k=(0,s().O7)(),{isMobile:T}=(0,s().Fy)(),{value:j}=(0,G().XJ)(oe().F.formulas),{value:R}=(0,G().XJ)(oe().F.formulaConstants),{value:P}=(0,G().XJ)(oe().F.formulaPermissions),[I,_]=(0,n.useState)(!1),M=(0,a().Kw)(r.permissionScopesStore),B=(0,a().qz)(void 0,ke().Z),F=(0,a().VK)((()=>o(658096).default.state.publicPageData),[]),{isRightMostFrozenColumn:K,isScrolled:O}=(0,a().VK)((()=>{const{frozenIndex:e,isScrolled:t}=r.frozoneStore.state;return{isRightMostFrozenColumn:e===i,isScrolled:t}}),[r.frozoneStore,i]),L=y[S],D=(0,a().VK)((()=>{var e;if("relation"!==(null==L?void 0:L.type))return!1;const t=null===(e=r.collectionStore())||void 0===e?void 0:e.getSpaceId();return(0,Gt().Qh)(t,L)}),[r,L]),[{value:E}]=(0,eo().r5)((async()=>{var e;if("formula"!==(null==L?void 0:L.type))return!1;const t=r.collectionStore(),n=null===(e=r.collectionStore())||void 0===e?void 0:e.pointer;if(!(t&&n&&j&&R&&P))return!1;const i=(0,Lo().W)(),l=(0,o(520509).yf)(t.getRecordModel,t.loadRecordModel,je().default,i),s={type:"block",collection:n},a={kind:R.FormulaContextValueKind.ThisRow,type:s},c={sourceProperty:S,valueTypes:[a],handleDataRequest:l,publicPageDataCollection:{id:null==F?void 0:F.collectionId,schema:null==F?void 0:F.collectionSchema},spaceId:t.getSpaceId(),featureGates:i};return!(await P.hasAccessToProperty({collectionPointer:n,collectionSchema:y,context:c,propertyId:S,hasAccessFn:P.hasSameSpaceAccess}))}),[r,L,S,y,j,R,P,F]),A=(0,fe().E)("collections_xws"),H=D&&A,Z=E&&A,z=(0,_c().a)(L),W=(0,n.useCallback)((()=>{C().clear({environment:k}),b().ZH({environment:k}),V().wG()}),[k]),N=(0,n.useCallback)((e=>{T||(e.preventDefault(),(0,de().ZP)({event:e,context:de().Af.EditorContextMenu,callback:()=>{W(),B.setState({open:!0})}}))}),[T,W,B]),U=(0,n.useCallback)((e=>{_(e)}),[_]),q=(0,c().yK)((e=>({container:{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:v,borderRight:l?void 0:`1px solid ${e.tableDividerColor}`},button:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:8,paddingRight:8,paddingTop:g},property:{fontSize:14,flex:"1 1 auto"},enabledIcon:{width:20,height:20,marginLeft:4}})),[v,l,g]),Y=(0,n.useCallback)((e=>L?(0,$.jsx)(Oc,{propertySchema:L,tooltipEvents:e,propertyId:S,collectionViewBlockStore:x}):null),[L,S,x]),Q=(0,n.useCallback)(((e,t)=>{var n;return L?(0,$.jsxs)(pt().Z,{style:q.button,disabled:d,...(0,mr().Z)(e,t),children:[f&&f(m),(0,$.jsx)(St().ZP,{propertySchema:L,showIcon:!0,badge:(0,$.jsxs)($.Fragment,{children:["relation"===L.type&&z&&(0,$.jsx)(Rc().R,{style:q.enabledIcon}),"button"===L.type&&(0,h().$K)(L.automation_id)&&(0,$.jsx)(Ec,{propertyId:S,propertySchema:L,automationId:L.automation_id,collectionViewBlockStore:x}),!(null===(n=L.description)||void 0===n||!n.length)&&!T&&(0,$.jsx)(o(143695).Z,{setIsHovered:U}),(0,$.jsx)(St().oV,{propertySchema:L})]}),style:q.property,property:S}),H&&(0,$.jsx)(Fc,{type:"relation"}),Z&&(0,$.jsx)(Fc,{type:"formula"}),K&&(0,$.jsx)(gc,{isCollectionViewBlockSelected:!1,passesFilter:!0,isScrolled:Boolean(O)})]}):null}),[L,q.button,q.enabledIcon,q.property,d,f,m,z,S,x,T,U,H,Z,K,O]),X=(0,n.useCallback)((e=>L?(0,$.jsx)(gt().Z,{disableTooltip:H||Z,delayThreshold:I?0:500,placement:we().Placement.Right,renderTooltip:Y,render:t=>Q(t,e)}):null),[L,H,Z,Y,I,Q]),J=(0,n.useCallback)((e=>(0,$.jsx)(Vc,{allowHidingTitle:t,collectionContextStore:r,columnIndex:i,format:u,formatKey:p,parent:e,property:S,schema:y})),[t,r,i,u,p,S,y]);return L?(0,$.jsxs)("div",{ref:w,style:q.container,className:ie().VMO,onContextMenu:N,children:[(0,$.jsx)(Pc().BB,{origin:w,store:r}),(0,$.jsx)(vr().ZP,{popupType:T?Zl().kQ.SlideUp:Zl().kQ.Popup,disabled:!M.canConfigureBlock,originGap:1,alignmentToOrigin:vr().vR.Start,buttonPopupStore:B,renderOrigin:X,render:J,onClick:W})]}):null}));function Oc(e){const{propertyId:t,propertySchema:o,tooltipEvents:n,collectionViewBlockStore:r}=e,i=(0,c().yK)((e=>({description:{color:e.mediumInvertedTextColor},sharingEnabledTooltip:{marginTop:8,color:e.mediumInvertedTextColor},aiUpdate:{color:e.mediumInvertedTextColor}})),[]),l=(0,a().VK)((()=>(0,Gt().qQ)(o)&&(0,Gt().q3)(o)),[o]),s=(0,_c().a)(o),d=(0,a().VK)((()=>r.getCollectionStore()),[r]);return(0,$.jsxs)("div",{...n,style:Ic().F6,children:[(0,$.jsx)("div",{children:o.name}),void 0!==(null==o?void 0:o.description)&&o.description.length>0?(0,$.jsx)("div",{style:i.description,children:o.description}):null,d&&"relation"===o.type&&s&&(0,$.jsx)(Rc().e,{propertySchema:o,collectionStore:d,style:i.sharingEnabledTooltip}),l&&l.auto_update_on_edit&&(0,$.jsx)("div",{style:i.aiUpdate,children:(0,$.jsx)(qe()._H,{...jc().Z.keptUpToDateWithNotionAITooltip})}),"button"===o.type&&(0,h().$K)(o.automation_id)&&(0,$.jsx)(Dc,{propertyId:t,propertySchema:o,automationId:o.automation_id,collectionViewBlockStore:r})]})}function Lc(e){const{automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r}=e,i=(0,a().VK)((()=>o.getSpaceId()),[o]),l=W().Mz.createChildStore(o,{id:t,table:wc().cv,spaceId:i});return(0,Tc().l$)({automationStore:l,propertyId:n,propertySchema:r})}function Dc(e){const{automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r}=e,i=(0,c().yK)((e=>({wrap:{color:e.mediumInvertedTextColor}})),[]);return Lc({automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r})?(0,$.jsx)("div",{style:i.wrap,children:(0,$.jsx)(qe()._H,{...jc().Z.buttonPropertyErrorTooltip})}):null}function Ec(e){const{automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r}=e,i=(0,c().yK)((e=>({icon:{width:14,height:14,marginLeft:5,fill:e.mediumIconColor}})),[]);return Lc({automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r})?(0,Vn().t)(i.icon):null}var Ac=()=>o(834458),Hc=()=>o(983993);const Zc={position:"absolute",right:0,width:0,flexGrow:0,zIndex:1},zc=n.memo((function(e){let{leftFormat:t,height:o,onTemporaryResize:r,onAccept:i,onCancel:l,propertySchema:a,resultStore:c}=e;const d=(0,n.useRef)(void 0),{isPhone:u}=(0,s().Fy)(),[p,m]=(0,n.useState)(!1),[g,h]=(0,n.useState)(!1),f=!u&&(g||p),y=(0,n.useCallback)((e=>{const o=d.current;if(!o||!o.width)return;const n=Math.max(o.width+e.diffX,Uc(a,t,o.width,e.optionKey));return{...o,width:n}}),[t,a]),v=(0,n.useCallback)((e=>{e.preventDefault(),d.current=t,h(!0)}),[t]),x=(0,n.useCallback)((e=>{const t=y(e);t&&r(t)}),[y,r]),b=(0,n.useCallback)((e=>{const t=y(e);t&&i(t),h(!1)}),[y,i]),C=(0,n.useCallback)((()=>{l(),d.current=void 0,h(!1)}),[l]),w=(0,n.useCallback)((e=>{const o=c.state?c.state.blockIds:[],n=S().oA(o.map((e=>{const o=Hc().Z.findBlockPropertyValueByBlockId(e,t.property),n=null==o?void 0:o.getNode();if(n)return function(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const n=getComputedStyle(e);for(let l=0;l<n.length;l++){const e=n[l],o=n.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative");t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const r=t.querySelectorAll("*");for(const l of r)l.style&&(l.style.pointerEvents="none",l.style.width="auto");document.body.appendChild(t);const i=t.getBoundingClientRect();return t.remove(),null!=i&&i.width?Math.ceil(i.width)+1:void 0}(n)})));if(t.width){const e={...t,width:Math.min(800,Math.max(Math.max(...n),Uc(a,t,t.width)))};i(e)}}),[t,i,a,c]),k=(0,n.useCallback)((e=>(0,$.jsx)("div",{style:f?qc(o):$c(o),onDoubleClick:w,...e})),[w,o,f]);return(0,$.jsx)("div",{style:Zc,onMouseMove:()=>m(!0),onMouseLeave:()=>m(!1),children:(0,$.jsx)(Ms().Z,{onDraggableDragStart:v,onDraggableDragMove:x,onDraggableDragEnd:b,onDraggableDragCancel:C,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:k})})}));const Gc=32,Wc=64,Nc=100;function Uc(e,t,o){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3])return Gc;const n=function(e,t){var o;if("checkbox"===(null==e?void 0:e.type))return Gc;if("status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return Gc;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,Ac().getFormulaPropertySchemaResultType)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return Gc;if("auto_increment_id"===(null==e?void 0:e.type))return Wc;return Nc}(e,t);return o&&o<n?Gc:n}function $c(e){return{width:5,marginLeft:-3,marginTop:-1,height:e,transition:"background 200ms ease-out",background:Bo().ZP.blueWithAlpha(0),cursor:"col-resize"}}function qc(e){return{...$c(e),background:Bo().ZP.blueWithAlpha(.8)}}const Yc=n.memo((function(e){let{store:t,collectionContextStore:r,schema:i,query:l,disabled:d,formatKey:u,disableCellRightBorder:p,renderSpacer:m,allowHidingTitle:g,paddingTop:S,showRightActions:h,showPropertyFormats:y,resultStore:v,format:x,tableStore:b,height:C,groupsPointer:T,property:j,index:R,isLast:P}=e;const I=(0,s().O7)(),{isMobile:_,isPhone:M}=(0,s().Fy)(),B=(0,n.useRef)(null),F=(0,a().VK)((()=>b.getCurrentFormat(x)),[x,b]),K=y[R],{wikiOnboardingPhase:O,showWikiTooltip:L}=(0,a().VK)((()=>{var e,n,l,s;const a=fc().B1(),c="notion://wiki_collection"===(null===(e=r.collectionStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("app_config_uri").getValue())&&t.isCollectionViewPageWithContent()&&t.id===(null===(n=r.collectionViewBlockStore())||void 0===n?void 0:n.id),d=c&&("notion://wiki/owner_property"===j||j===o(496205).EI.Owner)&&"owner"===a,u=c&&"verification"===(null===(l=i[j])||void 0===l?void 0:l.type)&&"verification"===a,p=c&&"multi_select"===(null===(s=i[j])||void 0===s?void 0:s.type)&&"tags"===a;return{wikiOnboardingPhase:a,showWikiTooltip:!_&&(d||u||p)}}),[r,_,j,i,t]),D=(0,a().VK)((()=>p||P&&!Ja(d,h)),[p,d,P,h]),E=(0,a().VK)((()=>(0,k().vf)({environment:I,propertyFormat:K})),[I,K]),A=(0,n.useCallback)((e=>{const t=b.getCurrentFormat(F),o=b.getCurrentProperties(u,t).map((t=>t.property===e.property?e:t)),n={...t,[u]:o};b.setState({...b.state,temporaryFormat:n})}),[b,u,F]),H=(0,n.useCallback)((e=>{const t=r.collectionViewStore();if(!t)return;const o=b.getCurrentFormat(F),n=b.getCurrentProperties(u,F).map((t=>t.property===e.property?e:t)),i={...o,[u]:n};w().createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:I,canUndo:!0,perform:e=>{V().iG({collectionViewStore:t,update:{format:i},transaction:e})}}),b.setState({...b.state,temporaryFormat:void 0}),f().wd({environment:I,collectionContextStore:r,action:"table_resize_columns"})}),[r,I,F,u,b]),Z=(0,n.useCallback)((()=>{b.setState({...b.state,temporaryFormat:void 0})}),[b]),z=(0,c().yK)((()=>({container:{display:"flex",position:"relative"}})),[]);return(0,$.jsxs)("div",{style:z.container,ref:L?B:null,children:[L&&(0,$.jsx)(bc,{origin:B,propertyType:O}),K&&E&&(0,$.jsx)(Kc,{format:F,schema:i,query:l,property:j,width:E,collectionViewBlockStore:t,collectionContextStore:r,disabled:d,formatKey:u,isLast:P,disableCellRightBorder:D,allowHidingTitle:g,renderSpacer:m,paddingTop:S,columnIndex:R,groupsPointer:T}),!d&&!M&&(0,$.jsx)(zc,{leftFormat:K,onTemporaryResize:A,onAccept:H,onCancel:Z,height:C,propertySchema:i[j],resultStore:v})]},j)}));function Qc(e,t,o,n,r,i){const l=t.collectionViewStore();if(!l)return;const s={...r.getCurrentFormat(n),[o]:S().MR(r.getCurrentProperties(o,n),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0}))};w().createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:i,canUndo:!0,perform:e=>{V().iG({collectionViewStore:l,update:{format:s},transaction:e})}}),f().wd({environment:i,collectionContextStore:t,action:"table_reorder_columns"})}const Xc=d().default.createClass(void 0,{name:"ReducerResultStore"}),Jc=n.memo((function(e){let{store:t,disabled:o,showRightActions:r,disableCellRightBorder:i,disableHorizontalEdgeScroll:l,collectionContextStore:d,frozoneProps:u,height:p,minWidth:m,isInPeekRenderer:g,isInHomeWidget:S,disableTopBorder:h,showHoverActionsStore:f,groupFormat:y,showPropertyFormats:v,format:x,formatKey:b,tableStore:C,resultStore:w,allowHidingTitle:k,renderSpacer:V,paddingTop:T,paddingLeft:j,paddingRight:R,query:P,schema:I,children:_,hasMoreReducerResults:M}=e;const B=(0,s().O7)(),F=(0,c().Fg)(),K=(0,a().VK)((()=>(0,X().fk)({environment:B,collectionContextStore:d})),[d,B]),O=(0,a().qz)(w,Xc),L=(0,a().VK)((()=>y?[y]:[]),[y],{useDeepEqual:!0}),D=(0,X().jw)(d,F),E=S?"transparent":(null==D?void 0:D.background)||(g?F.cardContentBackground:F.contentBackground),A=(0,a().VK)((()=>function(e,t,o,n,r,i,l){const s=e.collectionViewStore();if(!s)return{};const a=s.getType(),c=i?n.tableHomeDividerColor:n.tableDividerColor;return{display:"flex",background:r,zIndex:$e().bF,height:t,color:n.mediumTextColor,boxShadow:`-3px 0 0 ${r}, inset 0 -1px 0 ${c}${l?"":`, inset 0 1px 0 ${c}`}`,minWidth:o,left:"timeline"===a?void 0:0,right:"timeline"===a?void 0:0,position:"relative",boxSizing:"border-box"}}(d,p,m,F,E,S,h)),[d,E,h,p,S,m,F]),H=(0,a().VK)((()=>Ja(o,r)),[o,r]),Z=(0,a().VK)((()=>f&&f.state),[f]),z=(0,n.useRef)(null),G=(0,a().VK)((()=>{var e;return null===(e=d.collectionViewStore())||void 0===e?void 0:e.getType()}),[d]),W=(0,c().yK)((e=>({stickyStyle:{paddingLeft:j,paddingRight:R,minWidth:m,background:A.background,borderRight:"timeline"===G?`1px solid ${e.tableDividerColor}`:void 0,"--timeline-box-shadow":"timeline"===G?"0px":void 0},transitionStickyStyle:"timeline"===G?{borderRight:void 0}:{}})),[j,R,m,A.background,G]);return(0,$.jsx)(Mr().u,{stickyAttachPoint:S?"no-stick":"ceiling",absoluteHeight:A.height,nodeRef:z,stickyStyle:W.stickyStyle,transitionStickyStyle:W.transitionStickyStyle,children:(0,$.jsxs)("div",{className:ie().kUP,style:A,dir:"ltr",ref:z,children:[K&&(0,$.jsx)(hc,{groupsPointer:L,collectionContextStore:d,frozoneProps:u,hasMoreReducerResults:!!M}),(0,$.jsx)(ed,{showRightActions:r,store:t,collectionContextStore:d,schema:I,query:P,disabled:o,formatKey:b,disableCellRightBorder:i,renderSpacer:V,allowHidingTitle:k,paddingTop:T,frozoneProps:u,disableTopBorder:h,backgroundColor:E,disableHorizontalEdgeScroll:l,showPropertyFormats:v,format:x,height:p,tableStore:C,groupsPointer:L,resultStore:O}),(0,$.jsxs)(ut().Z,{visible:H,animate:{opacity:Z?1:0},style:{display:"flex"},children:[(0,$.jsx)(ac,{collectionContextStore:d}),(0,$.jsx)(cc,{collectionContextStore:d})]}),_]})})}));function ed(e){let{disabled:t,collectionContextStore:r,disableCellRightBorder:i,disableHorizontalEdgeScroll:l,disableTopBorder:d,backgroundColor:u,formatKey:p,format:m,schema:g,query:S,tableStore:h,showPropertyFormats:f,allowHidingTitle:y,showRightActions:v,height:x,frozoneProps:b,groupsPointer:C,resultStore:w,paddingTop:k,renderSpacer:V,store:T}=e;const j=(0,s().O7)(),{canConfigureBlock:R,isInHomeWidget:P}=(0,a().VK)((()=>({canConfigureBlock:r.permissionScopesStore.state.canConfigureBlock,isInHomeWidget:r.isInHomeWidgetStore.state})),[r]),I=(0,a().VK)((()=>f.map((e=>e.property))),[f],{useDeepEqual:!0}),_=(0,n.useCallback)(((e,o,n)=>(0,$.jsx)(Yc,{collectionContextStore:r,store:T,schema:g,query:S,disabled:t,format:m,formatKey:p,allowHidingTitle:y,showPropertyFormats:f,resultStore:w,showRightActions:v,disableCellRightBorder:i,renderSpacer:V,paddingTop:k,tableStore:h,groupsPointer:C,height:x,property:e,index:o,isLast:n},e)),[y,r,i,t,m,p,C,x,k,S,V,w,g,f,v,T,h]),M=null==b?void 0:b.frozenIndex,B=(0,X().bW)(M),F=null==b?void 0:b.frozenStyles.left,K=(0,c().yK)((e=>{const t=P?e.tableHomeDividerColor:e.tableDividerColor;return{frozenStyle:{display:"flex",...null==b?void 0:b.frozenStyles,left:P?Bt().f_:F??0,boxShadow:`-3px 0 0 ${u}, inset 0 -1px 0 ${t}${d?"":`, inset 0 1px 0 ${t}`}`}}}),[u,d,null==b?void 0:b.frozenStyles,P,F]),O=I.slice(0,B),L=I.slice(B);return t||!R?(0,$.jsxs)("div",{style:Cl().l8,children:[(0,$.jsx)("div",{style:K.frozenStyle,children:O.map(((e,t)=>_(e,t,t===I.length-1)))}),L.map(((e,t)=>_(e,t+B,t===I.length-1)))]}):(0,X().Ql)(M)?(0,$.jsx)(o(164482).Z,{style:{display:"flex"},direction:"horizontal",keys:I,sectionedKeys:{frozen:O,unfrozen:L},sectionStyles:{frozen:K.frozenStyle,unfrozen:{display:"flex"}},renderKey:_,onDrop:e=>Qc(e,r,p,m,h,j),disableHorizontalEdgeScroll:l}):(0,$.jsx)(Cl().ZP,{direction:"horizontal",keys:I,renderKey:_,onDrop:e=>Qc(e,r,p,m,h,j),disableHorizontalEdgeScroll:l})}function td(e){const{children:t,isCollectionViewBlockSelected:o,passesFilter:n,shouldFreeze:r}=e,i=(0,c().yK)((()=>({container:{display:"flex",background:o&&n?Bo().ZP.blueWithAlpha(.14):void 0}})),[o,n]);return r?(0,$.jsx)(ut().Z,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:i.container,children:t},"halo"):(0,$.jsx)($.Fragment,{children:t})}var od=()=>o(173255),nd=()=>o(965865);function rd(e){let{store:t,collectionContextStore:o,children:n,anyWrapping:r}=e;return(0,fe().E)("collections_column_virtualization")&&r?(0,$.jsx)(id,{store:t,collectionContextStore:o,children:n}):(0,$.jsx)("div",{style:{display:"flex"},children:n})}function id(e){let{store:t,collectionContextStore:o,children:r}=e;const i=(0,n.useRef)(null),l=o.virtualizedModule.getBlockHeightsCache(),s=(0,n.useCallback)((e=>{l.cacheRowHeight(t.id,e.height)}),[l,t]);(0,nd().c7)(i,s);const d=(0,a().VK)((()=>{var e;return(null===(e=l.getBlockHeightStore(t.id))||void 0===e?void 0:e.state)??void 0}),[l,t]),u=(0,c().yK)((()=>({row:{display:"flex",...d?{height:Math.max(d,_s().nz),overflowY:"clip"}:{}}})),[d]);return(0,$.jsx)("div",{ref:i,style:u.row,children:r})}const ld=n.memo((function(e){const{store:t,passesFilter:o,canEdit:r,frozoneProps:i}=e,l=(0,E().Y$)(),c=(0,s().O7)(),d=(0,a().VK)((()=>N().default.state.stores.includes(t)),[t]),u=(0,a().VK)((()=>{var e;return uc().default.state.isOpen&&(null===(e=uc().default.state.currentStore)||void 0===e?void 0:e.id)===t.id}),[t]),p=(0,n.useCallback)((e=>{var o;(0,k().vg)({collectionViewBlockId:null===(o=l.collectionViewBlockStore())||void 0===o?void 0:o.id})?b().Z5({environment:c,stores:[t]}):b().Ys({environment:c,store:t,selectMode:b().BK()?b().W7.MULTI_SELECT_FROM_BOUNDARY:b().W7.TOGGLE}),e.stopPropagation()}),[l,c,t]);return(0,$.jsx)(Sc,{checkedState:d,onClick:p,checkboxType:"single_row",collectionContextStore:l,isBlockHovered:u,frozoneProps:i,passesFilter:o,disabled:!r})}));const sd=function(e){const{toggleButton:t,subitemPath:o,shouldShowMultiSelectCheckbox:n,propertyIndex:r}=e,i=(null==o?void 0:o.length)??0,l=Math.max((i-1)*Z().Hw,0)+Z().gY;return t?(0,$.jsxs)("div",{style:{paddingTop:4,display:"flex",...0===r&&n?{marginLeft:-8,marginRight:0,gap:4}:{}},children:[(0,$.jsx)("div",{style:{width:l}}),t]}):(0,$.jsx)("div",{style:{minWidth:l+Z().Hw,...0===r&&n?{marginLeft:-8,marginRight:4}:{}}})},ad=n.memo((function(e){const{propertyFormat:t,index:r,canEdit:i,isLastColumn:l,isRightMostFrozenColumn:d,store:u,schema:p,disabled:m,disableCellBorderRight:g,disableLastCellBorderRight:h,subitemPath:f,onShiftEnter:y,tableWrap:v,subitemFormat:x,forceMouseEntered:b,shouldCaptureKeyboard:C,isLocked:w,toggleButton:V,onPropertyClick:T,titleColumnIndex:j,isSubitemToggleOnTitleColumn:R,onPropertyTab:P,onPropertyUntab:I,onPropertyEnter:_,onPropertyEsc:M,onPropertyBgClick:B,onPropertyContextMenu:F,collectionViewStore:K,collectionStore:O,blockPropertyValueOverlayStore:L,shouldSetCellHeight:A,onOpenProperty:H,disableHorizontalEdgeScroll:Z,handleOpenPeekPage:z,groupFormat:G,rowIndex:W,isCollectionViewBlockSelected:N,passesFilter:U,isScrolled:q,shouldShowMultiSelectCheckbox:Y,isInHomeWidget:Q,normalizedTableSelection:X}=e,{property:J,wrap:ee}=t,te=(0,s().O7)(),oe=(0,a().VK)((()=>(0,k().vf)({environment:te,propertyFormat:t})),[te,t]),ne=(0,E().Y$)(),re=(null==f?void 0:f.length)??0,le=x&&(0,k().lO)({columnIndex:r,titleColumnIndex:j,isSubitemToggleOnTitleColumn:R}),se=(0,n.useMemo)((()=>{if(void 0!==oe){if(le){const e=(0,k().lZ)({columnIndex:r,indentLevel:re,titleColumnIndex:j,isSubitemToggleOnTitleColumn:R});return oe-e}return oe}}),[re,r,R,le,j,oe]),ae=(0,n.useMemo)((()=>le?(0,$.jsx)(sd,{subitemFormat:x,toggleButton:V,subitemPath:f,shouldShowMultiSelectCheckbox:Y,propertyIndex:r}):void 0),[le,x,f,V,Y,r]),ce=(0,n.useCallback)((()=>T(u,J,p)),[T,J,p,u]),de=m||!i,ue=(0,a().VK)((()=>{const e=ne.collectionViewBlockStore();if(!e)return!1;const t=od().Z.state;if(!t.isActive||!(0,od().N)(t.selectionKey,{collectionViewBlockStore:e,groupFormat:G})||!X)return!1;const o=X,{start:n,end:i}=o,l=W===n.row||W===i.row||S().Z2(W,n.row,i.row),s=r===n.col||r===i.col||S().Z2(r,n.col,i.col);return l&&s}),[ne,G,r,X,W]),pe=(0,a().VK)((()=>{const e=od().Z.state,t=ne.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,od().N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:G})||!X)return!1;const o=X,{start:n}=o;return W===n.row&&r===n.col}),[ne,G,r,X,W]),me=(0,a().VK)((()=>{const e=ne.frozoneStore.state.frozenIndex;return void 0!==e&&r<=e}),[ne,r]),ge=(0,fe().E)("collections_column_virtualization"),Se=(0,o(702466).p)({collectionContextStore:ne,blockId:u.id,property:J,featureEnabled:ge}),he=(0,c().yK)((e=>{const t=Q?e.tableHomeDividerColor:e.tableDividerColor,o=N?e.tableFrozenSelectedDividerColor:t;return{tableCell:{display:"flex",width:oe||void 0,height:Se?void 0:"100%",position:"relative",borderRight:g||d||l&&h?"none":`1px solid ${me?o:t}`},tableSelectionOverlay:{background:ue?Bo().ZP.blueWithAlpha(.07):void 0,borderRadius:pe?3:void 0,boxShadow:pe?e.collectionTableOutlineBlueInputBoxShadow:void 0,position:"absolute",pointerEvents:"none",top:0,height:"100%",zIndex:84,width:"100%",left:0},propertyValueContainer:{display:"flex",overflowX:"clip",height:"100%",width:se||void 0}}}),[Q,N,oe,Se,g,d,l,h,me,ue,pe,se]),ye=(0,$.jsxs)(D().Z,{debugName:"TableRow",capture:C,onShiftEnter:y,children:[(0,$.jsx)(xn().m,{collectionStore:O,store:u,property:J,disabled:de,locked:w,width:se,format:dt().C.Table,forceMouseEntered:b,tableWrap:Boolean(v||ee),isLast:l,indentLevel:0===r&&f?f.length:void 0,onTab:P,onUntab:I,onEnter:_,onClick:ce,onEsc:M,onBgClick:B,onContextMenu:F,collectionViewStore:K,shouldSetCellHeight:A,onOpenProperty:H,blockPropertyValueOverlayStore:L,disableHorizontalEdgeScroll:Z,handleOpenPeekPage:z,propertyIndex:r,shouldShowMultiSelectCheckbox:Y},J),d&&(0,$.jsx)(gc,{isCollectionViewBlockSelected:N,passesFilter:U,isScrolled:q})]}),ve=(0,n.useRef)(null);return(0,$.jsxs)("div",{ref:ve,className:ie().mWS,"data-row-index":W,"data-col-index":r,style:he.tableCell,children:[ae,(0,$.jsx)("div",{style:he.propertyValueContainer,children:ye}),ue&&(0,$.jsx)("div",{style:he.tableSelectionOverlay})]})})),cd=n.memo((function(e){const{blockPropertyValueOverlayStore:t,propertyFormats:o,propertyFormatsMap:n,visiblePropertiesLength:r,store:i,tableWrap:l,shouldSetCellHeight:s,indexAddendum:c,frozoneProps:d,normalizedTableSelection:u,canEdit:p,isInHomeWidget:m,...g}=e,S=(0,E().Y$)(),h=(0,a().VK)((()=>S.collectionViewStore()),[S]),f=(0,a().VK)((()=>X().Bm({store:i,collectionContextStore:S})),[i,S]),y=(0,a().VK)((()=>!t.state.isOpen&&N().default.state.stores.length>0&&N().default.state.stores[0].id===i.id),[i.id,t]),v=(0,a().Kw)(S.currentSubitemFormatStoreForUiDisplayStore),x=(0,a().VK)((()=>"title"===(null==h?void 0:h.getFormatStore().getKeyStore("table_subitem_toggle_column").getValue())),[h]),b=(0,a().VK)((()=>S.frozoneStore.state.frozenIndex),[S]),C=(0,a().VK)((()=>{if(!p)return;if(m)return;if(S.isInlineViewStore.state&&S.isUnlistedViewStore.state)return;const e=uc().default.state;return Boolean(e.isOpen&&e.currentStore===i)}),[p,S,m,i]),w=r??o.length;return(0,$.jsx)($.Fragment,{children:o.map(((e,o)=>{const r=(null==n?void 0:n[o])??o+(c??0);return(0,$.jsx)(ad,{index:r,store:i,propertyFormat:e,isLastColumn:r===w-1,isRightMostFrozenColumn:b===r,collectionViewStore:h,collectionStore:f,tableWrap:l,shouldSetCellHeight:s,forceMouseEntered:"title"===e.property?C:void 0,shouldCaptureKeyboard:y,subitemFormat:v,isSubitemToggleOnTitleColumn:x,blockPropertyValueOverlayStore:t,isScrolled:(null==d?void 0:d.isScrolled)??!1,normalizedTableSelection:u,canEdit:p,isInHomeWidget:m,...g},e.property)}))})})),dd=n.memo((function(e){let{propertyFormats:t,...o}=e;const{propertiesInRange:n,propertiesInRangeIndices:r,beforeWidth:i,afterWidth:l}=(0,Na().M)();return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("div",{style:{width:`${i}px`}}),(0,$.jsx)(cd,{...o,propertyFormats:n,propertyFormatsMap:r}),(0,$.jsx)("div",{style:{width:`${l}px`}})]})})),ud=n.memo(n.forwardRef((function(e,t){const{disabled:o,store:r,groupFormat:i,collectionContextStore:l,propertyFormats:d,disableTableWrap:u,frozoneProps:p,passesFilter:m,shouldShowMultiSelectCheckbox:g,isLast:S,isInHomeWidget:h,...f}=e,{handleOpenPeekPage:y}=e,v=(0,n.useRef)(null),x=(0,s().O7)(),b=(0,a().VK)((()=>!o&&r.canEdit()),[o,r]),C=(0,a().VK)((()=>(0,Z().A7)(i,l)),[i,l]),w=(0,a().VK)((()=>C.findIndex((e=>e===r))),[C,r]),V=(0,a().VK)((()=>{const e=l.collectionViewBlockStore();return!(!e||l.isFullScreenStore.state)&&(0,Ya().sY)(e)}),[l]),T=(0,a().VK)((()=>l.isUnlistedViewStore.state&&l.isInlineViewStore.state),[l]),j=(0,a().VK)((()=>{const e=od().Z.state;if(e.isActive)return(0,k().OG)(e.selection,d.length,C.length)}),[C,d]),R=null==p?void 0:p.frozenIndex,P=void 0!==R,I=(0,a().VK)((()=>{const e=od().Z.state,t=l.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,od().N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:i})||!j)return!1;const o=j,{start:n}=o;return void 0!==R&&w===n.row&&n.col<=R}),[i,l,j,R,w]),_=(0,a().VK)((()=>X().bW(R)),[R]),M=(0,n.useMemo)((()=>P?{...null==p?void 0:p.frozenStyles,...I?{zIndex:$e().mK}:{zIndex:$e().IK},...-1===R?{background:void 0}:{},...h?{left:Bt().f_}:{}}:{}),[P,null==p?void 0:p.frozenStyles,I,R,h]),[B,F]=(0,n.useMemo)((()=>P?[d.slice(0,R+1),d.slice(R+1)]:[[],d]),[R,d,P]),K=(0,a().VK)((()=>{var e;return Boolean(!u&&(null===(e=l.collectionViewStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("table_wrap").getValue()))}),[l,u]),O=(0,a().VK)((()=>{var e;return Boolean("timeline"===(null===(e=l.collectionViewStore())||void 0===e?void 0:e.getType())||!K&&!d.some((e=>e.wrap)))}),[l,d,K]),L=(0,a().VK)((()=>{const e=l.permissionScopesStore.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[l.permissionScopesStore]),D=(0,c().yK)((e=>{const t=h?e.tableHomeDividerColor:e.tableDividerColor;return{tableViewRowStyle:{display:"flex",...S&&h?{}:{borderBottom:`1px solid ${t}`},width:"100%"},checkboxContainer:{position:"absolute",left:-Bt().Xx,...-1!==(null==p?void 0:p.frozenIndex)&&{background:null==p?void 0:p.frozenStyles.background,height:"100%"}}}}),[null==p?void 0:p.frozenIndex,null==p?void 0:p.frozenStyles.background,h,S]),E=(0,a().VK)((()=>{var e;return!h&&"timeline"!==(null===(e=l.collectionViewStore())||void 0===e?void 0:e.getType())}),[l,h]),A=(0,n.useCallback)((()=>{const{mainEditorCurrentBlockStore:e}=an().default.state,t=X().mb({environment:x,store:r,mainEditorCurrentBlockStore:e,collectionContextStore:l,fullyQualified:!1,overridePeekMode:T?"center_peek":void 0});t&&(y(),Jo().c4({environment:x,url:t}))}),[l,x,y,T,r]),H=(0,fe().E)("collections_column_virtualization"),z=(0,a().VK)((()=>K||d.some((e=>e.wrap))),[d,K]),G=(0,$.jsxs)(n.Fragment,{children:[(0,$.jsx)("div",{className:ie().zwY,style:D.tableViewRowStyle,dir:"ltr",ref:v,children:(0,$.jsx)(Dn().v,{store:r,step:"demo_collection_record",children:(0,$.jsxs)(rd,{collectionContextStore:l,store:r,anyWrapping:z,children:[(0,$.jsx)("div",{style:M,children:(0,$.jsx)(td,{isCollectionViewBlockSelected:V,passesFilter:Boolean(m),shouldFreeze:-1!==R,children:(0,$.jsxs)($.Fragment,{children:[g&&(0,$.jsx)("div",{style:D.checkboxContainer,children:(0,$.jsx)(ld,{store:r,passesFilter:Boolean(m),frozoneProps:p,canEdit:b})}),(0,$.jsx)(cd,{store:r,canEdit:b,propertyFormats:B,visiblePropertiesLength:B.length,shouldSetCellHeight:O,indexAddendum:0,rowIndex:w,disabled:o,groupFormat:i,tableWrap:K,isLocked:L,isCollectionViewBlockSelected:V,passesFilter:Boolean(m),shouldShowMultiSelectCheckbox:g,frozoneProps:p,normalizedTableSelection:j,isInHomeWidget:h,...f})]})})}),H?(0,$.jsx)(dd,{store:r,canEdit:b,propertyFormats:F,visiblePropertiesLength:F.length,shouldSetCellHeight:O,indexAddendum:_,rowIndex:w,disabled:o,groupFormat:i,tableWrap:K,isLocked:L,isCollectionViewBlockSelected:V,passesFilter:!0,shouldShowMultiSelectCheckbox:g,frozoneProps:p,normalizedTableSelection:j,isInHomeWidget:h,...f}):(0,$.jsx)(cd,{store:r,canEdit:b,propertyFormats:F,visiblePropertiesLength:F.length,shouldSetCellHeight:O,indexAddendum:_,rowIndex:w,disabled:o,groupFormat:i,tableWrap:K,isLocked:L,isCollectionViewBlockSelected:V,passesFilter:!0,shouldShowMultiSelectCheckbox:g,frozoneProps:p,normalizedTableSelection:j,isInHomeWidget:h,...f})]})})}),E?(0,$.jsx)("div",{style:{...D.tableViewRowStyle,display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}}):null]});return(0,he().ez)(r,t,(0,n.useMemo)((()=>({renderedType:"table_row",getNode:()=>v.current,getBlockStore:()=>r,activate:A})),[A,r]),G)})));var pd=()=>o(435168);const md=function(e){const{frozenColumnRepositionStore:t,frozenIndex:o,maxFrozenIndex:r,xForFirstCellInRow:i,showPropertyFormats:l,frozenSectionWidth:d}=e,u=(0,s().O7)(),p=(0,E().DK)(),m=(0,n.useRef)(null),g=(0,n.useRef)(null),[h,f]=n.useState({x:0,y:0,width:0,maxY:0,isEntered:!1,isMouseDown:!1}),[y,v]=n.useState(0),[x,b]=n.useState(0),C=(0,a().VK)((()=>t.state.isRepositioning||h.isMouseDown),[t,h.isMouseDown]),w=(0,a().VK)((()=>t.state.newFrozenIndex),[t]),V=(0,a().VK)((()=>!!p&&(0,X().fk)({environment:u,collectionContextStore:p})),[u,p]),T=(0,a().VK)((()=>null==p?void 0:p.frozoneStore.state.isScrolled),[p]),j=(0,a().VK)((()=>!T&&-1===o&&V?-4:0),[o,T,V]),R=(0,a().VK)((()=>h.isEntered||C),[h.isEntered,C]),P=(0,a().VK)((()=>t.state.newFrozenColumnXPosition),[t]),I=(0,n.useContext)(te().U),_=null==I?void 0:I.horizontalScroller,M=(0,n.useCallback)((()=>{var e,t,o;if(!_||!m.current)return 0;const n=(null===(e=m.current.getBoundingClientRect())||void 0===e?void 0:e.top)??0,r=null===(t=_.getNode())||void 0===t?void 0:t.getElementsByClassName(ie().kUP);return(r&&r.length>0?null===(o=r[0].getBoundingClientRect())||void 0===o?void 0:o.top:0)-n}),[_]),B=(0,n.useCallback)((()=>{var e,t,o,n,r;if(!_||!m.current)return 0;const i=(null===(e=m.current)||void 0===e||null===(e=e.getBoundingClientRect())||void 0===e?void 0:e.bottom)??0,l=null===(t=_.getNode())||void 0===t?void 0:t.getElementsByClassName(ie().zwY),s=l&&l.length>0?null===(o=l[l.length-1].getBoundingClientRect())||void 0===o?void 0:o.bottom:0,a=null===(n=_.getNode())||void 0===n?void 0:n.getElementsByClassName(ie().Gcz),c=a&&a.length>0?null===(r=a[a.length-1].getBoundingClientRect())||void 0===r?void 0:r.bottom:0;return Math.max(s,c)-i}),[_]),F=(0,a().VK)((()=>{var e;const t=null===(e=m.current)||void 0===e?void 0:e.getBoundingClientRect();return t&&void 0!==d?new DOMRect(t.x+d+h.x+10,t.y+h.y+10,3,3):void 0}),[d,h]),K=(0,a().VK)((()=>{const e=(null==p?void 0:p.frozoneStore.state.scrollerLeftOffset)??0,t=(0,Ce().Wk)(u),o=Math.max(t-e,0);return p&&(0,k().iZ)(u,p)?o:0}),[p,u]),O=(0,a().VK)((()=>p&&(0,X().fk)({environment:u,collectionContextStore:p})),[p,u]),L=(0,n.useCallback)((e=>{if(void 0===o||void 0===r||void 0===d||null===m.current||null===g.current)return;const n=m.current.getBoundingClientRect(),s=e.clientX-n.x;if(null==p||p.frozoneStore.setState({...null==p?void 0:p.frozoneStore.state,tryShowHiddenFrozenColumn:s<42}),!R)return;const a=M();v(a);const c=B();b(c);const u=2+d,S=Math.max(s-u,-u),h=e.clientY-n.y-14,y=n.bottom-n.top-14+c,x=C?a:-14,w=Math.max(Math.min(h,y),x);if(f((e=>({...e,x:C?S:0,y:w}))),C){const e=l,n=g.current.getBoundingClientRect();let a=s,c=i,u=-1,p=c,m=Math.abs(c-a);for(let t=0;t<e.length&&!(t>r);t++){const r=e[t];c+=(null==r?void 0:r.width)??0,T&&t===o+1&&(a-=n.x);const i=Math.abs(c-a);i<m&&(m=i,p=c,u=t)}t.setState({...t.state,newFrozenIndex:u,newFrozenColumnXPosition:p-d-1})}}),[o,r,d,null==p?void 0:p.frozoneStore,R,M,B,C,l,i,t,T]);(0,n.useEffect)((()=>{const e=S().P2((e=>{L(e)}),25);return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[L]);const D=(0,n.useCallback)((e=>{C||(L(e.nativeEvent),f((e=>({...e,isEntered:!0,isMouseDown:!1}))))}),[C,L]),A=(0,n.useCallback)((e=>{C||f((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[C]),H=(0,n.useCallback)((e=>{f((e=>({...e,isMouseDown:!0})))}),[]),Z=(0,n.useCallback)((e=>{C&&f((e=>({...e,isEntered:!0})))}),[C]),z=(0,n.useCallback)((e=>{f((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[]),G=(0,n.useCallback)((e=>{C&&f((e=>({...e,x:0,isEntered:!1,isMouseDown:!1})))}),[C]),W=(0,c().yK)((e=>{const t=void 0!==w&&void 0!==o&&w<=o;return{repositionerContainer:{zIndex:$e().hc,display:"flex",position:"absolute",width:"100%",height:"100%",cursor:C?"grabbing":"grab",pointerEvents:C?void 0:"none"},repositionerOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)",height:"100%"},repositionerInsideStickyWrapper:{position:"sticky",left:K+(O?Bt().Xx:0),height:"100%"},tooltipContainer:{position:"absolute",left:-1!==d||T?d??0:5,zIndex:$e().xP,height:"100%"},tooltipOrigin:{position:"absolute",left:-3,top:0,width:8,pointerEvents:"auto",cursor:C?"grabbing":"grab",height:"100%"},tooltipColumn:{position:"absolute",left:C?h.x-1:-1,top:C?y:0,width:2,height:C?`calc(100% + ${x-y}px`:"100%",background:"dark"===e.mode?e.accentColors.gray[500]:e.accentColors.gray[200]},ghostColumnBase:{position:"absolute",top:C?y:0,width:1,height:C?`calc(100% + ${x-y}px`:"100%",background:e.accentColors.uiBlue[300]},frozenGhostColumn:{left:P,opacity:C&&t?1:0},unfrozenGhostColumn:{left:(d??0)+(P??0),opacity:R&&C&&!t?1:0},tooltipDraggable:{position:"absolute",left:C?h.x-2:-2,top:h.y,width:4,height:28,background:e.accentColors.uiBlue[600],borderRadius:4},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...Zt().Yu}}}),[w,o,C,K,O,d,T,h.x,h.y,y,x,P,R]);return(0,$.jsx)("div",{className:ie().wXs,style:W.repositionerContainer,onMouseEnter:Z,onMouseLeave:z,onMouseUp:G,children:(0,$.jsxs)("div",{style:W.repositionerOutsideStickyWrapper,ref:g,children:[(0,$.jsx)("div",{style:W.repositionerInsideStickyWrapper,ref:m,children:(0,$.jsx)(gt().Z,{renderTooltip:()=>C&&void 0!==w&&w!==o?(0,$.jsx)(qe()._H,{id:"tableView.selectionOverlay.repositioner.dynamicTooltip",defaultMessage:"Freeze {numColumns} {numColumns, select, 1 {column} other {columns}}",values:{numColumns:w+1}}):(0,$.jsx)(qe()._H,{id:"tableView.selectionOverlay.repositioner.tooltip",defaultMessage:"Drag horizontally to freeze columns"}),delayThreshold:300,forceVisibleState:C||void 0,placement:we().Placement.Right,originRect:F,render:e=>(0,$.jsxs)(ut().Z,{animate:{translateX:j,opacity:R?1:0},...e,style:W.tooltipContainer,children:[(0,$.jsx)("div",{style:W.tooltipOrigin,onMouseEnter:D,onMouseLeave:A,onMouseDown:H}),(0,$.jsx)("div",{style:{...W.ghostColumnBase,...W.frozenGhostColumn}}),(0,$.jsx)("div",{style:W.tooltipColumn}),(0,$.jsx)("div",{style:W.tooltipDraggable})]})})}),(0,$.jsx)("div",{style:{...W.ghostColumnBase,...W.unfrozenGhostColumn}})]})})};var gd=()=>o(525038),Sd=()=>o(970105),hd=()=>o(158083),fd=()=>o(475335);let yd=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e}({});function vd(e,t){const o=t.permissionScopesStore.state;return!e&&o.canEditContent}function xd(e,t){let o=e;for(;null!==o;){if(o.classList.contains(t))return o;o=o.parentElement}}function bd(e,t){return(0,X().fk)({environment:t,collectionContextStore:e})?Bt().Xx:0}function Cd(e){let t=e;for(;null!==t&&!t.classList.contains(ie().mWS);)t=t.parentElement;if(null===t)return;return{col:parseInt(t.getAttribute("data-col-index")??"0"),row:parseInt(t.getAttribute("data-row-index")??"0")}}function wd(e,t,o,n){return{col:o.findIndex((e=>e.property===t)),row:n.findIndex((t=>e===t))}}function kd(e){const t=e.state;return!t.isOpen||0===t.additionalStores.length}function Vd(e,t,o,n,r,i,l){const{selection:s,shouldNormalize:a}=e,c=o.collectionViewBlockStore();if(!c)return;const d=a?(0,k().OG)(s,r.length,i.length):s,u=i[d.start.row];pd().Z5({environment:t,selectionKey:{collectionViewBlockStore:c,groupFormat:n},selection:d,currentRowStore:u}),l.recompute()}function Td(e,t,o,n,r,i,l,s,a,c,d){if(e.preventDefault(),e.target instanceof Element){if(xd(e.target,ie().wXs))s.setState({isRepositioning:!0,newFrozenIndex:a,newFrozenColumnXPosition:void 0}),function(e,t,o,n,r){var i;if(!t.frozoneStore.state.isScrolled)return;const l=r[0],s=o[0].property,a=Hc().Z.findBlockPropertyValue(l,s),c=t.frozoneStore.state.scrollerLeftOffset??0,d=(0,Ce().Wk)(e),u=Math.max(d-c,0),p=(0,k().iZ)(e,t)?u:0;null==a||null===(i=a.getScrollerContext())||void 0===i||null===(i=i.horizontalScroller)||void 0===i||null===(i=i.getNode())||void 0===i||i.scrollTo({left:n-p})}(t,o,n,r,c),hd().Z.setState({...hd().Z.state,disableHorizontalEdgeScroll:!0,disableVerticalEdgeScroll:!0});else{const t=d;if(t&&vd(i,o)&&xd(e.target,ie().JR_))return void l.setState({...t})}V().wG()}}function jd(e,t,o,n,r,i,l,s){!function(e,t,o){const n=o.state.isRepositioning;if(!n)return;w().createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:e,canUndo:!0,perform:n=>{pd().oz({environment:e,collectionContextStore:t,currentIndex:o.state.newFrozenIndex,transaction:n,entrypoint:"TableSelectionOverlay.FrozenColumnRepositioner"}),o.reset()}})}(e,t,i),function(e,t,o,n,r,i,l){var s;const a=r.state;if(!a)return;const{start:c,end:d}=a;if(c.col!==d.col||c.row!==d.row)return;const u=t,p=u[c.col],m=null===(s=o[p.property])||void 0===s?void 0:s.type;if("verification"===m)return;const g=i;if(!g)return;w().createAndCommit({userAction:"TableSelectionOverlay.handleDragAndFill",environment:e,canUndo:!0,perform:e=>{Md({transaction:e,selection:g,start:c},t,l)}});const S=Math.min(g.start.row,g.end.row),h=Math.max(g.start.row,g.end.row);m&&h!==S&&f().qm({environment:e,collectionContextStore:n,property_type:m,num_rows:h-S});r.reset()}(e,o,n,t,r,l,s)}function Rd(e,t,o,n,r,i,l,s,a,c,d,u){var p;null===(p=e.preventDefault)||void 0===p||p.call(e),fd().default.setKeyboardMode(!0);const m=l;if(!m)return;const g=n.collectionViewBlockStore();if(!g)return;const S=void 0!==u?u:"shiftKey"in e&&e.shiftKey||!1,h={collectionViewBlockStore:g,groupFormat:r};let f=m;switch(t){case yd.Left:f=pd().e2({environment:o,selectionKey:h,selection:m,shiftKey:S,columnCount:i.length});break;case yd.Right:f=pd().FC({environment:o,selectionKey:h,selection:m,shiftKey:S,columnCount:i.length,rowCount:s.length});break;case yd.Up:f=pd().zJ({environment:o,selectionKey:h,selection:m,shiftKey:S});break;case yd.Down:f=pd().DI({environment:o,selectionKey:h,selection:m,shiftKey:S,rowCount:s.length})}Bd(t,i,f,s,a,c,d)}function Pd(e,t,n){const{device:r}=e;if(r.isMobile)return;if(t){const r=n[t.start.row],i=(0,ln().ZP)({store:r,fullyQualified:!1,pageVisitSource:Po().tY.LinkInPage});o(752127).D({environment:e,url:i})}}function Id(e,t,o,n,r,i,l,s,a,c,d,u){const p=o.state;if(!p.isOpen)return;const m=wd(p.store,p.property,n,l),g="tab"===e?{col:Math.min(m.col+1,n.length-1),row:m.row}:{col:Math.max(m.col-1,0),row:m.row};Vd({selection:{start:g,end:g},shouldNormalize:!0},t,r,i,n,l,s),Bd("tab"===e?yd.Right:yd.Left,n,a,l,c,d,u),so().xv({environment:t,blockPropertyValueOverlayStore:o})}function _d(e,t,n,r,i,l,s,a,c,d,u){Fd(e,n,r,t,i,l,s,a,c,d,u,(n=>{const{isNewBlock:r,store:i}=n;r&&i.isEmptyTitle()&&i.isEmptyPage()&&w().createAndCommit({userAction:"TableSelectionOverlay.handlePropertyEsc",environment:e,canUndo:!0,perform:n=>{o(663366).y8({environment:e,blocks:[i],transaction:n}),n.postSubmitCallbacks.push((o=>{if(!o){const o=t.collectionStore(),n=t.collectionViewBlockStore();j().dh(e,{analyticsName:"delete",from:"collection_esc_shortcut",block_id:i.id,block_type:"page",collection_id:null==o?void 0:o.id,collection_view_id:null==n?void 0:n.id})}}))}})}))}function Md(e,t,o){const{transaction:n,selection:r,start:i}=e,l=t[i.col],s=o[i.row].getPropertyValue(l.property)||[],a=Math.min(r.start.row,r.end.row),c=Math.max(r.start.row,r.end.row);o.slice(a,c+1).forEach((e=>{e.pointer!==o[i.row].pointer&&Sd().sO({environment:e.environment,store:e.getPropertyStore(l.property),value:s,transaction:n})}))}function Bd(e,t,o,n,r,i,l){const s=o;if(!s)return;let a;a=e===yd.Down?s.start.row>s.end.row?s.start:s.end:e===yd.Up?s.start.row<s.end.row?s.start:s.end:e===yd.Right?s.start.col>s.end.row?s.start:s.end:s.start.col<s.end.row?s.start:s.end;const c=n[a.row],d=t[a.col].property,u=Hc().Z.findBlockPropertyValue(c,d),p=(null==u?void 0:u.getNode())??null;if(p){const e=r??0,t=l||i&&s.start.col<=i&&s.end.col<=i;_t().bx({element:p,vertical:{reveal:"closest",paddingToTopEdge:96,paddingToBottomEdge:48},horizontal:t?void 0:{reveal:"closest",paddingToLeftEdge:e},scrollerContext:null==u?void 0:u.getScrollerContext()})}}function Fd(e,t,o,n,r,i,l,s,a,c,d,u){const{device:p}=e,m=t.state;if(m.isOpen){const{store:g,property:S}=m,h=wd(g,S,o,i);p.isMobile?V().wG():kd(t)&&Vd({selection:{start:h,end:h},shouldNormalize:!0},e,n,r,o,i,l),Bd(yd.Down,o,s,i,a,c,d),so().xv({environment:e,blockPropertyValueOverlayStore:t}),null==u||u(m)}}class Kd extends d().default{getInitialState(){}}const Od=Kd;class Ld extends d().default{getInitialState(){return{isRepositioning:!1,newFrozenIndex:void 0,newFrozenColumnXPosition:void 0}}}const Dd=Ld;function Ed(e){var t;const{schema:o,selection:n,dragAndFillStore:r,showPropertyFormats:i,selectionStartRectStore:l,rowsWrapRect:d,frozenIndex:u}=e,p=(0,a().Kw)(r),m=(0,s().O7)(),g=(0,a().VK)((()=>{const e=(null==p?void 0:p.start)||n.start;return i[e.col]}),[p,n,i]),S=g?null===(t=o[g.property])||void 0===t?void 0:t.type:void 0,h=(0,a().Kw)(l),f=(0,a().VK)((()=>void 0!==u&&n.start.col<=u),[u,n]),y=(0,E().Y$)(),v=(0,a().VK)((()=>y.isInHomeWidgetStore.state),[y]),x=(0,a().VK)((()=>(0,X().fk)({environment:m,collectionContextStore:y})),[y,m]),b=(0,c().yK)((e=>({dragAndFillContainer:{zIndex:f?$e().hc+4:$e().IK,display:"flex",position:"relative"},dragAndFillOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)"},dragAndFillInsideStickyWrapper:{position:f?"sticky":void 0,left:v?Bt().f_:x?Bt().Xx:0},tooltipContainer:h?{position:"absolute",left:h.left+h.width-6-(x?Bt().Xx:0)}:{},tooltipOrigin:{position:"absolute",left:0,top:h?h.bottom-7:void 0,width:10,height:15,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",left:0,top:h?h.bottom-5:void 0,width:9,height:9,border:`2px solid ${Bo().ZP.blueWithAlpha(.57)}`,transform:p?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:e.contentBackground,borderRadius:"50%",cursor:"ns-resize"},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...Zt().Yu}})),[f,v,x,h,p]);if(!h)return null;if(!S||(0,Gt().ZY)(S)||"rollup"===S||"formula"===S||"verification"===S)return null;let C;return d&&(C=new DOMRect(h.x+d.x+h.width-4,h.y+d.y+h.height-4,7,7)),(0,$.jsx)(gt().Z,{renderTooltip:()=>(0,$.jsx)(qe()._H,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value"}),delayThreshold:300,forceVisibleState:!!p||void 0,originRect:C,placement:we().Placement.Right,render:e=>(0,$.jsx)("div",{...e,className:ie().JR_,style:b.dragAndFillContainer,children:(0,$.jsx)("div",{style:b.dragAndFillOutsideStickyWrapper,children:(0,$.jsx)("div",{style:b.dragAndFillInsideStickyWrapper,children:(0,$.jsxs)("div",{style:b.tooltipContainer,children:[(0,$.jsx)("div",{style:b.tooltipOrigin}),(0,$.jsx)("div",{style:b.tooltipCircle})]})})})})})}const Ad=n.memo((function(e){const{groupFormat:t}=e,o=(0,s().O7)(),r=(0,n.useContext)(Ln().Z),i=(0,n.useRef)(null),c=(0,n.useRef)(void 0),{value:d}=(0,G().XJ)(A().p),{value:u}=(0,G().XJ)(H().m),{value:p}=(0,G().XJ)(oe().F.formulas),m=(0,a().qz)(void 0,Od),g=(0,a().qz)(void 0,Dd),S=(0,a().SI)((()=>(0,Z().A7)(t,e.collectionContextStore)),[t,e.collectionContextStore]),h=(0,a().VK)((()=>(0,X().fk)({environment:o,collectionContextStore:e.collectionContextStore})),[o,e.collectionContextStore]),f=(0,a().VK)((()=>e.collectionContextStore.normalizedSchemaStore.state),[e.collectionContextStore]),y=(0,a().SI)((()=>{const o=e.collectionContextStore.collectionViewBlockStore();if(!o)return;const n=od().Z.state;if(!n.isActive||!(0,od().N)(n.selectionKey,{collectionViewBlockStore:o,groupFormat:t}))return;const r=(0,k().OG)(n.selection,e.showPropertyFormats.length,S.state.length);return pd().YY(S.state[r.start.row]),r}),[e.collectionContextStore,e.showPropertyFormats.length,t,S]),v=(0,a().Kw)(y),x=(0,a().VK)((()=>{const e=y.state;return e&&e.start.col===e.end.col&&e.start.row===e.end.row}),[y]),C=(0,a().SI)((()=>{const t=y.state;if(!t)return;if(!i.current)return;const n=t.start,r=e.showPropertyFormats,l=function(e,t){if(!t)return;const o=gs().C.findSelectablesFromStore(e).map((e=>e.getNode())).find((e=>t.contains(e)));return o?o.getBoundingClientRect():void 0}(S.state[n.row],i.current);if(!l)return;const s=i.current.getBoundingClientRect(),a=l.height,c=l.top-s.top-1,d=r[n.col].width||0,u=a+1;let p=bd(e.collectionContextStore,o);for(let e=0;e<n.col;e++){const t=r[e];t.width&&(p+=t.width)}return new DOMRect(p-1,c,d+1,u)}),[S,o,y,e.collectionContextStore,e.showPropertyFormats]),T=(0,a().SI)((()=>e.collectionContextStore.frozoneStore.state.frozenIndex),[e.collectionContextStore]),j=(0,a().VK)((()=>{const t=e.collectionContextStore,o=t.collectionViewStore(),n=t.frozoneStore.state.scrollerWidth;return null==o?void 0:o.getTableMaxFrozenColumnIndex(n,t.normalizedFormatStore.state)}),[e.collectionContextStore]),R=(0,a().SI)((()=>{const t=T.state;if(void 0!==t){let n=bd(e.collectionContextStore,o);const r=e.showPropertyFormats;for(let e=0;e<=t&&!(e>=r.length);e++){const t=r[e];t.width&&(n+=t.width)}return n-1-(h?Bt().Xx:0)}}),[T,h,e.collectionContextStore,e.showPropertyFormats,o]),P=(0,a().VK)((()=>bd(e.collectionContextStore,o)-(h?Bt().Xx:0)),[e.collectionContextStore,o,h]),I=(0,a().VK)((()=>{let t=!1;const o=function(e,t){const o=t?[t]:[];return(0,Z().A7)(o[0],e)}(e.collectionContextStore,e.groupFormat),n=o.length,r=N().default.state.stores.filter((e=>o.includes(e))).length;return t=0!==n&&0!==r&&(r===n||"indeterminate"),void 0!==T.state&&!m.state&&!t&&!od().Z.state.isActive&&void 0===e.tableStore.state.temporaryFormat&&e.collectionContextStore.permissionScopesStore.state.canConfigureBlock}),[m,T,e.collectionContextStore,e.groupFormat,e.tableStore]);(0,n.useEffect)((()=>{i.current&&(c.current=new MutationObserver((()=>{C.recompute()})),c.current.observe(i.current,{attributes:!0,childList:!0,characterData:!0,subtree:!0}));const e=c.current;return()=>{e&&e.disconnect()}}),[C]);const _=(0,n.useCallback)((t=>{Rd(t,yd.Left,o,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,y.state,S.state,R.state,T.state,e.disableHorizontalEdgeScroll)}),[S,o,T,R,y,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),M=(0,n.useCallback)((t=>{Rd(t,yd.Right,o,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,y.state,S.state,R.state,T.state,e.disableHorizontalEdgeScroll)}),[S,o,T,R,y,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),B=(0,n.useCallback)((t=>{Rd(t,yd.Up,o,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,y.state,S.state,R.state,T.state,e.disableHorizontalEdgeScroll)}),[S,o,T,R,y,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),F=(0,n.useCallback)((t=>{Rd(t,yd.Down,o,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,y.state,S.state,R.state,T.state,e.disableHorizontalEdgeScroll)}),[S,o,T,R,y,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),O=(0,n.useCallback)((t=>{!function(e,t,o,n,r,i,l,s,a,c){e.preventDefault&&e.preventDefault(),fd().default.setKeyboardMode(!0);const d=s;if(!d)return;const u=a[d.start.row],p=n[d.start.col].property,m=o[p];if(m&&!r)if((0,cn().AB)(m))so().bA({environment:t,blockPropertyValueOverlayStore:i,store:u,property:p,format:dt().C.Table,disableHorizontalEdgeScroll:c,collectionContextStore:l}),V().wG();else if("checkbox"===m.type){const e=u.getPropertyStore(p),o=Ue().Ml(e.getValue()),n=a.slice(d.start.row,d.end.row+1);w().createAndCommit({userAction:"TableSelectionOverlay.handleEnter",environment:t,canUndo:!0,perform:e=>{for(const r of n)Sd().sO({environment:t,store:r.getPropertyStore(p),value:Ue()._I(!o),transaction:e})}})}}(t,o,f,e.showPropertyFormats,e.disabled,e.blockPropertyValueOverlayStore,e.collectionContextStore,y.state,S.state,e.disableHorizontalEdgeScroll)}),[S,o,y,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,f]),L=(0,n.useCallback)((t=>{Rd(t,yd.Right,o,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,y.state,S.state,R.state,T.state,e.disableHorizontalEdgeScroll,!1)}),[S,o,T,R,y,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),E=(0,n.useCallback)((t=>{Rd(t,yd.Left,o,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,y.state,S.state,R.state,T.state,e.disableHorizontalEdgeScroll,!1)}),[S,o,T,R,y,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),z=(0,n.useCallback)((e=>{!function(e,t,o,n){if(t.device.isMobile)return;e.preventDefault(),fd().default.setKeyboardMode(!0);const r=o;if(V().wG(),r){const e=(0,k().AV)(r),o=n.slice(e.minRow,e.maxRow+1);b().Z5({environment:t,stores:o})}}(e,o,y.state,S.state)}),[S,o,y]),W=(0,n.useCallback)((()=>{!function(e,t,o,n,r,i){const l=r,s=t.normalizedSchemaStore.state;l&&!o&&w().createAndCommit({userAction:"TableSelectionOverlay.handleDelete",environment:e,canUndo:!0,perform:e=>{pd().NE({selection:l,schema:s,currentPropertyFormats:n,currentRows:i,transaction:e})}})}(o,e.collectionContextStore,e.disabled,e.showPropertyFormats,y.state,S.state)}),[S,o,y,e.collectionContextStore,e.disabled,e.showPropertyFormats]),U=(0,n.useCallback)((t=>{!function(e,t,o,n,r,i,l,s,a){const c=l,d=o.normalizedSchemaStore.state,u=o.collectionViewBlockStore();u&&c&&!n&&w().createAndCommit({userAction:"TableSelectionOverlay.handleCut",environment:t,canUndo:!0,perform:t=>{pd().nA({selectionKey:{collectionViewBlockStore:u,groupFormat:r},schema:d,selection:c,currentPropertyFormats:i,currentRows:s,event:e,transaction:t,formulasModule:a})}})}(t,o,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,y.state,S.state,p)}),[S,o,y,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,p]),q=(0,n.useCallback)((t=>{!function(e,t,o,n,r,i,l){const s=r,a=t.normalizedSchemaStore.state,c=t.collectionViewBlockStore();c&&s&&pd().qn({selectionKey:{collectionViewBlockStore:c,groupFormat:o},schema:a,selection:s,currentPropertyFormats:n,currentRows:i,event:e,formulasModule:l})}(t,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,y.state,S.state,p)}),[S,y,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,p]),Y=(0,n.useCallback)((async t=>{const n=await K().F.clipboardActions.load();!function(e,t,o,n,r,i,l,s,a,c,d,u){const p=c,m=o.collectionViewBlockStore();m&&p&&!a&&w().createAndCommit({userAction:"TableSelectionOverlay.handlePaste",environment:t,canUndo:!0,perform:a=>{pd().j0({environment:t,collectionContextStore:o,clipboardActions:u,selectionKey:{collectionViewBlockStore:m,groupFormat:n},selection:p,currentPropertyFormats:i,currentRows:d,event:e,transaction:a,schema:r,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:s})}})}(t,o,e.collectionContextStore,e.groupFormat,f,e.showPropertyFormats,d,u,e.disabled,y.state,S.state,n)}),[S,o,d,y,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,f,u]),Q=(0,n.useCallback)((()=>{!function(e,t,o,n,r){const{device:i}=e,l=o;if(i.isMobile||!l)return;const s=n[l.start.row],{mainEditorCurrentBlockStore:a}=an().default.state,c=(0,X().mb)({environment:e,store:s,mainEditorCurrentBlockStore:a,collectionContextStore:t,fullyQualified:!1});c&&(r?r(c):Jo().c4({environment:e,url:c}))}(o,e.collectionContextStore,y.state,S.state,r)}),[S,o,y,r,e.collectionContextStore]),J=(0,n.useCallback)((()=>{!function(e,t,o,n,r,i,s,a,c,d,u){const{device:p}=e;if(p.isMobile)return;const m=i;if(!m)return;if(!(0,Oe().ww)(e))return;if(!t.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const g=s[m.start.row],S=t.subitemTreeStore.state,h=(0,to().DY)(S.children,(e=>e.value.store===g)),f="table_selection_overlay_shift_enter";if(h){const i=h?(0,Z().Af)(h.map((e=>e.value.store))):"",c=t.subitemExpandedStore.state.get(i),d=Boolean(null==c?void 0:c.isExpanded),u=[...h].splice(0,h.length-1),p=u?(0,Z().Af)(u.map((e=>e.value.store))):"",S=t.subitemExpandedStore.state.get(p),y=Boolean(null==S?void 0:S.isExpanded);if(d||y)w().createAndCommit({userAction:"TableSelectionOverlay.handleNestedItemShiftEnter",environment:e,canUndo:!0,perform:r=>{const i=t.collectionStore();if(!i)return;const l=Xe().yk({environment:e,collectionContextStore:t,groupsPointer:o?[o]:[],store:g,before:!1,collectionStore:i,transaction:r,subitemPath:h,subitemInsertDirection:y&&!d?"below":"into",from:f});if(l&&n){const o=()=>{so().bA({isNewBlock:!0,environment:e,blockPropertyValueOverlayStore:n,store:l,property:"title",format:dt().C.Table,collectionContextStore:t})};t.registerCallbackForItemMounted(l,o)}}});else{const n={col:m.end.col,row:t.currentViewHasSort()?s.length:m.end.row+1};w().createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:e,canUndo:!0,perform:r=>{const i=Xe().IW({environment:e,collectionContextStore:t,groupsPointer:o?[o]:[],insertAtIndex:n.row,shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:r,from:{createBlock:f},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(i&&!i.coercionSucceeded){const n=o?[o]:[],r=t.groupsStore.getGroupState(n);_o().CH({environment:e,store:i.newStore,peekMode:(0,X().kr)(t),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t,pageVisitSource:Po().tY.Create})}}}),l().default.afterNextFlush((()=>{Vd({selection:{start:n,end:n},shouldNormalize:!1},e,t,o,r,s,a)}))}}else{const n={col:m.end.col,row:t.currentViewHasSort()?s.length:m.end.row+1};w().createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:e,canUndo:!0,perform:r=>{const i=Xe().IW({environment:e,collectionContextStore:t,groupsPointer:o?[o]:[],insertAtIndex:n.row,shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:r,from:{createBlock:f},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(i&&!i.coercionSucceeded){const n=o?[o]:[],r=t.groupsStore.getGroupState(n);_o().CH({environment:e,store:i.newStore,peekMode:(0,X().kr)(t),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t,pageVisitSource:Po().tY.Create})}}}),l().default.afterNextFlush((()=>{Vd({selection:{start:n,end:n},shouldNormalize:!1},e,t,o,r,s,a)}))}Bd(yd.Down,r,i,s,c,d,u),so().xv({environment:e,blockPropertyValueOverlayStore:n})}(o,e.collectionContextStore,e.groupFormat,e.blockPropertyValueOverlayStore,e.showPropertyFormats,y.state,S.state,C,R.state,T.state,e.disableHorizontalEdgeScroll)}),[S,o,T,R,y,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,C]),ee=(0,n.useCallback)((()=>{Pd(o,y.state,S.state)}),[S,o,y]),te=(0,n.useCallback)((t=>{!function(e,t,o,n,r,i){const{device:l}=t;if(l.isMobile)return;const s=r;s&&s.start.col===s.end.col&&!o&&(0,Oe().ww)(t)&&(e.preventDefault(),w().createAndCommit({userAction:"TableSelectionOverlay.handleDuplicate",environment:t,canUndo:!0,perform:e=>{Md({transaction:e,selection:s,start:s.start},n,i)}}))}(t,o,e.disabled,e.showPropertyFormats,y.state,S.state)}),[S,o,y,e.disabled,e.showPropertyFormats]),ne=(0,n.useCallback)((t=>{!function(e,t,o,n,r,i,l,s,a,c){if(!e.key||e.metaKey||e.ctrlKey)return;e.preventDefault(),fd().default.setKeyboardMode(!0);const d=s;if(!d)return;const u=a[d.start.row],p=n[d.start.col].property,m=o[p];m&&!r&&Gt().ub.includes(m.type)&&e.key&&1===e.key.length&&(so().bA({environment:t,blockPropertyValueOverlayStore:i,store:u,property:p,format:dt().C.Table,disableHorizontalEdgeScroll:c,insertChar:e.key,collectionContextStore:l}),V().wG())}(t,o,f,e.showPropertyFormats,e.disabled,e.blockPropertyValueOverlayStore,e.collectionContextStore,y.state,S.state,e.disableHorizontalEdgeScroll)}),[S,o,y,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,f]),re=(0,n.useCallback)((e=>{!function(e,t,o,n){e.preventDefault&&e.preventDefault(),fd().default.setKeyboardMode(!0);const r=o;if(V().wG(),r){const e=(0,k().AV)(r),o=n.slice(e.minRow,e.maxRow+1);if(0===o.length)return;b().Z5({environment:t,stores:o});const i=gs().C.getRectFromStore(o[0]);gd().bA({environment:t,blocks:o,originRect:i,moveToContext:"action_menu"})}}(e,o,y.state,S.state)}),[S,o,y]),ie=(0,n.useCallback)((t=>{Td(t,o,e.collectionContextStore,e.showPropertyFormats,e.paddingLeft,e.disabled,m,g,T.state,S.state,y.state)}),[S,m,o,g,T,y,e]),le=(0,n.useCallback)((t=>{!function(e,t,o,n,r,i,l,s,a,c){if(!(e.target instanceof Element))return;if(l.state.isRepositioning);else if((0,pe().X9)()){const l=Cd(e.target);if(!l)return;const d=i.state,u=(null==d?void 0:d.start)??(null==s?void 0:s.start)??l;if(!u)return;const p=l;if(i.state&&u.col!==p.col)return;Vd({selection:{start:u,end:p},shouldNormalize:!0},t,o,n,r,a,c)}}(t,o,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,m,g,y.state,S.state,C)}),[S,m,o,g,y,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,C]),se=(0,n.useCallback)((()=>{jd(o,e.collectionContextStore,e.showPropertyFormats,f,m,g,y.state,S.state)}),[S,m,o,g,y,e.collectionContextStore,e.showPropertyFormats,f]),ae=(0,n.useCallback)((()=>{!function(e,t){e.reset(),t.reset(),V().wG()}(m,g)}),[m,g]);return(0,$.jsx)(D().Z,{debugName:"TableSelectionOverlay",capture:void 0!==v,onLeft:_,onRight:M,onUp:B,onDown:F,onEnter:O,onTab:L,onUntab:E,onEsc:z,onDelete:W,onBackspace:W,onCut:U,onCopy:q,onPaste:Y,onCommandEnter:Q,onShiftEnter:J,onCommandShiftEnter:ee,onDuplicate:te,onKeypress:ne,onMoveTo:re,children:(0,$.jsx)(Ms().Z,{disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,onDraggableDragStart:ie,onDraggableDragMove:le,onDraggableDragEnd:se,onDraggableDragCancel:ae,render:t=>{var o;return(0,$.jsxs)("div",{ref:i,style:{position:"relative",minWidth:e.minWidth,isolation:"auto"},...t,children:[vd(Boolean(e.disableHorizontalEdgeScroll),e.collectionContextStore)&&v&&(x||m.state)?(0,$.jsx)(Ed,{schema:f,selection:v,dragAndFillStore:m,showPropertyFormats:e.showPropertyFormats,selectionStartRectStore:C,rowsWrapRect:null===(o=i.current)||void 0===o?void 0:o.getBoundingClientRect(),frozenIndex:T.state}):null,I&&(0,$.jsx)(md,{frozenColumnRepositionStore:g,xForFirstCellInRow:P,maxFrozenIndex:j,showPropertyFormats:e.showPropertyFormats,frozenIndex:T.state,frozenSectionWidth:R.state}),(0,$.jsx)(Hd,{...e,allRowsStore:S,selectionStartRectStore:C,normalizedTableSelectionStore:y,frozenSectionWidthStore:R,frozenIndexStore:T})]})}})})}),Nt().Z),Hd=n.memo((function(e){const t=(0,s().O7)(),o=(0,n.useMemo)((()=>({onPropertyTab:()=>{Id("tab",t,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state)},onPropertyUntab:()=>{Id("untab",t,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state)},onPropertyEnter:()=>{!function(e,t,o,n,r,i,s,a,c,d,u){const p=t.state;if(!p.isOpen)return;const{store:m,property:g}=p;if(e.device.isMobile){const t=n.normalizedSchemaStore.state[g],o=U().default.state;return void("text"===(null==t?void 0:t.type)&&"editing"===o.mode&&w().createAndCommit({userAction:"TableSelectionOverlay.mobileEnter",environment:e,canUndo:!0,perform:t=>{Sd().hJ({environment:e,editorMode:"default",multiSelection:o.multiSelection,string:"\n",disableMentions:!0,disableEmojiCommands:!0,disableSlashCommands:!0,transaction:t})}}))}const S=wd(m,g,o,i),h={col:S.col,row:S.row+1};l().default.afterNextFlush((()=>{kd(t)&&Vd({selection:{start:h,end:h},shouldNormalize:!0},e,n,r,o,i,s)})),Bd(yd.Down,o,a,i,c,d,u),so().xv({environment:e,blockPropertyValueOverlayStore:t})}(t,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state)},onPropertyClick:(o,n,r)=>{!function(e,t,o,n,r,i,l,s,a){var c;const{device:d}=n;if("checkbox"!==(null===(c=o[t])||void 0===c?void 0:c.type)||d.isMobile)V().wG();else{const o=wd(e,t,r,s);Vd({selection:{start:o,end:o},shouldNormalize:!0},n,i,l,r,s,a)}}(o,n,r,t,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore)},onPropertyEsc:()=>{_d(t,e.collectionContextStore,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state,e.disableHorizontalEdgeScroll)},onPropertyBgClick:()=>{!function(e,t,o,n,r,i,l,s,a,c,d){Fd(e,t,o,n,r,i,l,s,a,c,d)}(t,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state,e.disableHorizontalEdgeScroll)},onPropertyContextMenu:o=>{!function(e,t,o,n,r){if(e.preventDefault(),!(e.target instanceof Element))return;const i=r,l=Cd(e.target);let s=!1;if(i&&l){const r=Math.min(i.start.row,i.end.row),a=Math.max(i.start.row,i.end.row);if(l.row>=r&&l.row<=a){const i=n.slice(r,a+1);i.length>0&&(b().Z5({environment:t,stores:i}),b().Ys({environment:t,store:i[0]}),Sn().Qn({environment:t,stores:N().default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:"block_in_collection",showInput:!0,analyticsFrom:"content_block_menu",optionalAnalyticsProperties:{collectionContextStore:o}}),s=!0)}}if(!s&&l){const r=n[l.row];r&&(b().Ys({environment:t,store:r}),Sn().Qn({environment:t,stores:N().default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:"block_in_collection",showInput:!0,analyticsFrom:"content_block_menu",optionalAnalyticsProperties:{collectionContextStore:o}}))}}(o,t,e.collectionContextStore,e.allRowsStore.state,e.normalizedTableSelectionStore.state)},onOpenProperty:o=>{!function(e,t,o,n,r){const i=t.state;if(i.isOpen){const{store:l}=i;so().bA({environment:r,blockPropertyValueOverlayStore:t,store:l,property:e,format:dt().C.Table,disableHorizontalEdgeScroll:o,collectionContextStore:n})}}(o,e.blockPropertyValueOverlayStore,Boolean(e.disableHorizontalEdgeScroll),e.collectionContextStore,t)},onSelectableEnter:o=>{!function(e,t,o,n,r,i,l){const s=e.blocks.map((e=>i.indexOf(e))),a=S().VV(s)||0,c=S().Fp(s)||0;a>=0&&c>=0&&Vd({selection:{start:{col:0,row:a},end:{col:0,row:c}},shouldNormalize:!0},t,o,n,r,i,l)}(o,t,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,e.allRowsStore.state,e.selectionStartRectStore)}})),[t,e.allRowsStore,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.frozenIndexStore,e.frozenSectionWidthStore,e.groupFormat,e.normalizedTableSelectionStore,e.selectionStartRectStore,e.showPropertyFormats]);return(0,$.jsx)($.Fragment,{children:e.render(o)})}),Nt().Z);function Zd(e){const{isFullScreen:t,hasGroups:o,propertyWidths:n,hasPartialResults:r,hasSearchQuery:i,frozoneProps:l}=e,d=(0,s().O7)(),u=(0,c().Fg)(),p=(0,s().Fy)().isPhone,m=(0,E().DK)(),g=(0,Bn().Z)(!0,0,100),S=(0,a().VK)((()=>Boolean(null==m?void 0:m.normalizedFormatStore.state.hide_table_vertical_lines)),[m]),h=l.isScrolled,f=l.frozenIndex,y=void 0!==f,v=(0,a().VK)((()=>{if(!m)return!1;const e=m.collectionViewBlockStore();return!!e&&(0,Ya().sY)(e)}),[m]),x=(0,a().VK)((()=>m?(0,k().oc)({environment:d,collectionContextStore:m,isPhone:p,theme:u}):{}),[m,d,p,u]),b=(0,a().VK)((()=>Boolean(null==m?void 0:m.isInHomeWidgetStore.state)),[null==m?void 0:m.isInHomeWidgetStore]),C=(0,c().yK)((e=>{let t="0x 16px";return y?t=void 0:b&&(t=0),{container:{display:"flex",flexDirection:"row",alignItems:"flex-start"},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},frozenColumnsContainer:{display:"flex",flexDirection:"row",...x,...-1===f?{background:void 0}:{}},multiselectCheckbox:{display:"flex",flexDirection:"row",pointerEvents:"none",cursor:"pointer",...x},rowContainer:{display:"flex",alignItems:"flex-start",padding:t,borderBottom:`1px solid ${e.tableDividerColor}`,width:"100%"},rowShimmer:{height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor,marginLeft:y?0:8},column:{display:"flex",height:32,padding:"0px 8px",alignItems:"center",borderRight:S?void 0:`1px solid ${e.tableDividerColor}`}}}),[y,b,x,f,S]);if(!g||!m)return null;const w=n.map(((e,t)=>(0,$.jsx)("div",{style:{...C.column,width:e},children:(0,$.jsx)(zn().Z,{style:{...C.rowShimmer,width:.6*(e-16)}})},t)));let V=null,T=[];if(y&&void 0!==f){const e=w.slice(0,f+1);V=(0,$.jsxs)("div",{style:C.frozenColumnsContainer,children:[(0,$.jsx)(td,{isCollectionViewBlockSelected:v,passesFilter:!0,shouldFreeze:-1!==f,children:e}),e.length>0?(0,$.jsx)(gc,{isCollectionViewBlockSelected:v,passesFilter:!0,isShimmerRow:!0,isScrolled:h}):null]}),T=w.slice(f+1,w.length)}else T=w;let j=1;o||r||i||(j=t?10:3);const R=[...Array(j)].map(((e,t)=>(0,$.jsxs)("div",{style:C.rowContainer,children:[V,T]},t)));return(0,$.jsx)("div",{style:C.container,children:(0,$.jsx)("div",{style:C.rowsContainer,children:R})})}const zd=n.memo((function(e){const{groupFormat:t,store:r,format:i,schema:l,query:d,collectionContextStore:u,showHoverActionsStore:p,isFullScreen:m,isInPeekRenderer:g,disabled:S,blockPropertyValueOverlayStore:h,minWidth:f,paddingBottom:y,paddingLeft:v,paddingRight:x,tableStore:b}=e,C=(0,s().O7)(),T=(0,qe().YB)(),R=(0,c().Fg)(),P=(0,s().Fy)(),I=(0,n.useContext)(Ln().Z),_=(0,a().VK)((()=>{const e=t?[t]:[];return u.groupsStore.getGroupState(e)}),[t,u]),M=(0,a().VK)((()=>{const e=(0,k().ZH)(i,b).filter((e=>e.visible));return P.isMobile?e.slice(0,20):e}),[P.isMobile,i,b],{useDeepEqual:!0}),B=(0,a().VK)((()=>null==_?void 0:_.reducerResultStore.state),[_]),F=(0,a().VK)((()=>void 0!==B),[B]),K=(0,a().Kw)(u.permissionScopesStore),O=(0,he().PE)(e.store,e.disabled),L=(0,a().VK)((()=>!!O&&(!K.isSyncedCollection&&K.canEditContent)),[O,K]),D=(0,a().VK)((()=>"collectionTypedView"===u.contextType),[u]),E=(0,a().Kw)(u.isInHomeWidgetStore),A=(0,a().Kw)(u.isUnlistedViewStore),H=(0,a().VK)((()=>X().Il({collectionContextStore:u,environment:C,intl:T})),[u,C,T]),z=(0,a().VK)((()=>Boolean(!E&&F&&(L||D)&&u.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))),[L,u,F,D,E]),G=(0,ee().Dq)(),W=(0,a().VK)((()=>!(A||null!=G&&G.hideTableAggregationRow)),[A,G]),U=(0,a().VK)((()=>M.reduce(((e,t)=>e+(t.width||0)),0)+(K.canEditContent?32:0)),[M,K]),q=(0,a().VK)((()=>M.map((e=>e.width||$a().Nx))),[M]),Y=(0,a().VK)((()=>M.findIndex((e=>"title"===e.property))),[M]),Q=(0,a().VK)((()=>{const e=t?[t]:[],o=(0,Z().A7)(e[0],u);return N().default.state.stores.filter((e=>o.includes(e))).length>0}),[t,u]),J=(0,a().VK)((()=>{const{device:e}=C,{isScrolled:t,frozenIndex:o,tryShowHiddenFrozenColumn:n}=u.frozoneStore.state;if(void 0===o)return{isScrolled:!1,frozenIndex:void 0,frozenStyles:{},shouldFreezeMultiSelectColumn:!1,shouldShowStickyMultiSelectColumn:!1,isCollectionViewBlockSelected:!1};const r={...(0,k().oc)({environment:C,collectionContextStore:u,isPhone:e.isPhone,theme:R}),display:"flex",...t&&-1===o&&{height:"calc(100% - 1px)",borderBottom:`1px solid ${R.tableDividerColor}`}},i=Boolean(t&&-1===o),l=Boolean(i&&(n||Q)),s=u.collectionViewBlockStore(),a=!!s&&(0,Ya().sY)(s);return{isScrolled:Boolean(t),frozenIndex:o,frozenStyles:r,shouldFreezeMultiSelectColumn:i,shouldShowStickyMultiSelectColumn:l,isCollectionViewBlockSelected:a}}),[Q,u,C,R],{useDeepEqual:!0}),te=(0,a().VK)((()=>X().VM({collectionContextStore:u,reducerResult:B,isFullScreen:m})),[u,m,B]),oe=(0,n.useMemo)((()=>t?[t]:[]),[t]),ne=(0,n.useMemo)((()=>void 0!==B&&B.blockIds.length>0),[B]),se=(0,a().VK)((()=>""!==u.searchQueryStore.state),[u]),ae=(0,a().VK)((()=>(0,Ro().H0)({collectionContextStore:u,groupsPointer:oe,hasPartialResults:ne})),[u,oe,ne]),ce=(null==B?void 0:B.blockIds.length)||0,ue=F&&!ae&&0===ce,pe=Boolean(t),me=(0,a().VK)((()=>{const e=Boolean(u.currentCombinatorFilterStore.state||u.currentPropertyFiltersStore.state.length>0);return F&&!ae&&!(m&&ce>0)&&ce<2&&z&&!e&&!pe&&"on"===je().default.getEligibleGroup({experimentId:"packaging_db_empty_states"})}),[F,ae,m,ce,z,u,pe]),ge=(0,a().VK)((()=>u.viewIsFlushToTopbar()),[u]),Se=(0,a().VK)((()=>Boolean(u.normalizedFormatStore.state.hide_table_vertical_lines)),[u]),fe=(0,a().VK)((()=>{const e=u.collectionViewStore();return L&&P.isMobile&&!(null!=e&&e.isSyncedCollection())}),[L,u,P.isMobile]),ye=(0,a().VK)((()=>(0,Ro().$t)({collectionContextStore:u,groupsPointer:oe})),[u,oe]),ve=(0,a().VK)((()=>(0,k().zp)(i,b)),[i,b]),xe=(0,a().VK)((()=>(0,re().qG)(r.id)),[r]),be=(0,a().Kw)(u.defaultPageTemplateStore),[Ce,we]=n.useState(!1),ke=(0,n.useCallback)((()=>{if(!_)return;const e=u.collectionStore();if(!e||!u.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=N().default.state.stores[0];if(!t)return;const o=u.subitemTreeStore.state,n=(0,to().DY)(o.children,(e=>e.value.store===t));if(!n)return;const r=n?(0,Z().Af)(n.map((e=>e.value.store))):"",i=u.subitemExpandedStore.state.get(r);Boolean(null==i?void 0:i.isExpanded)&&w().createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:C,canUndo:!0,perform:o=>{const r=Xe().yk({environment:C,collectionContextStore:u,groupsPointer:_.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:n,subitemInsertDirection:"into",from:"table_group_results_shift_enter"});if(r&&h){const e=()=>{so().bA({isNewBlock:!0,environment:C,blockPropertyValueOverlayStore:h,store:r,property:"title",format:dt().C.Table,collectionContextStore:u})};u.registerCallbackForItemMounted(r,e)}}})}),[h,u,C,_]),Ve=(0,n.useCallback)((e=>{const n=new(o(188517).sA)(C,"handleAddRowClick"),r=t?[t]:[],i=u.groupsStore.getGroupState(r);if(!(0,Oe().ww)(C)||!i)return n.fail("invalid_state"),void(0,Oe().eD)(C);u.searchQueryStore.state&&V().Ug({searchQuery:"",collectionContextStore:u,isFullScreen:m}),w().createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:C,canUndo:!0,perform:e=>{const o=Xe().IW({environment:C,collectionContextStore:u,groupsPointer:t?[t]:[],shouldCoerce:!0,templateStore:be,transaction:e,from:{createBlock:"table_group_results"},tracker:n,inMemoryRecordCache:C.defaultRecordCache.inMemoryRecordCache});if(!o)return;const l=o.newStore;if(P.isMobile){const e=(0,ln().ZP)({store:l,fullyQualified:!1,pageVisitSource:Po().tY.Create});I?I(e):Jo().c4({environment:C,url:e})}else{if(o.coercionSucceeded){const t=()=>{so().bA({isNewBlock:!0,environment:C,blockPropertyValueOverlayStore:h,store:l,property:"title",format:dt().C.Table,collectionContextStore:u})};u.registerCallbackForItemMounted(l,t),e.postSubmitCallbacks.push((async e=>{if(!e)return u.virtualizedModule.waitToScrollToBlock(r,l)}))}else _o().CH({environment:C,store:l,peekMode:X().kr(u),resultsStore:i.resultsStore,collectionContextStore:u,pageVisitSource:Po().tY.Create});const t=u.currentSubitemFormatStoreForCollectionStore.state;io().W(C,{from:t?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",new_page_id:l.id,creating_block_id:l.id,...(0,le().Pn)(u)})}}})}),[h,u,P.isMobile,C,t,m,I,be]),Te=(0,n.useCallback)((e=>{const o=u.groupsStore.getGroupState(t);if(!o)return;const n=o.reducerResultStore.state;(0,de().Wi)(e),n&&Xe().ID({collectionContextStore:u,environment:C,incrementLimitArgs:{isFullScreen:m,currentResultCount:n.blockIds.length,groupsPointer:o.groupsPointer,incrementLimitsInRelatedGroups:!1}}),j().uD(C)}),[u,C,t,m]),Re=(0,X().jw)(u,R),Pe=(0,a().VK)((()=>{var e,t;const o=null===(e=u.collectionStore())||void 0===e?void 0:e.id;return(h.state.isOpen&&(null===(t=h.state.collectionContextStore)||void 0===t||null===(t=t.collectionStore())||void 0===t?void 0:t.id))===o}),[h,u]),Ie=(0,c().yK)((e=>{const{button:t,buttonInner:o,icon:n}=(0,k().UD)({theme:e,isMobile:P.isMobile,hideTextWithTransition:me&&Ce,hideTextWithoutTransition:me&&Pe});return{iconStyle:n,viewAllButton:{borderTop:`1px solid ${e.tableDividerColor}`,paddingTop:6,paddingBottom:6},loadMoreButton:{...t,borderBottom:`1px solid ${e.tableDividerColor}`,whiteSpace:"break-spaces"},loadMoreButtonHovered:{...ye?{background:e.whiteButtonBackground}:{}},loadMoreButtonInner:o,text:{color:e.lightTextColor,flexGrow:1},addRowButton:{...t,background:(null==Re?void 0:Re.background)||(g?e.cardContentBackground:e.contentBackground)},addRowButtonInner:o,linkExistingButton:{marginLeft:12,paddingLeft:6,paddingRight:6,borderRadius:6},linkExistingButtonInner:{display:"flex",alignItems:"center",fontSize:14,height:26},linkExistingIcon:{width:14,height:14,marginLeft:1,marginRight:5,fill:e.lightIconColor},aggregationRow:{...(!F||E)&&{opacity:0,pointerEvents:"none",left:0,right:0}}}}),[P.isMobile,ye,Re,g,F,E,Pe,me,Ce]),_e=(0,a().VK)((()=>u.isUnlistedViewStore.state&&u.isInlineViewStore.state),[u]),Me=(0,n.useCallback)((e=>(0,$.jsx)(Gd,{args:e,store:r,collectionContextStore:u,collectionViewFormat:ve,blockPropertyValueOverlayStore:h,groupFormat:t,propertyFormats:M,schema:l,canDrag:fe,disabled:S,titleColumnIndex:Y,onShiftEnter:ke,frozoneProps:J,isInHomeWidget:E,isFullScreen:m})),[r,u,ve,h,t,M,l,fe,S,Y,ke,J,E,m]);return _?(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(Jc,{store:r,format:ve,groupFormat:t,schema:l,query:d,collectionContextStore:u,isInPeekRenderer:g,minWidth:f,paddingBottom:y,paddingLeft:v,paddingRight:x,blockPropertyValueOverlayStore:h,resultStore:_.reducerResultStore,showPropertyFormats:M,showRightActions:K.canConfigureCollection&&K.canConfigureBlock&&!_e&&!xe,showHoverActionsStore:p,allowHidingTitle:!1,tableStore:b,formatKey:"table_properties",disabled:S||!K.canConfigureBlock,disableTopBorder:!ge||pe,disableCellRightBorder:!ge||pe||Se,height:Bt().aF,frozoneProps:J,isInHomeWidget:E,hasMoreReducerResults:!(null==B||!B.hasMore)}),(0,$.jsx)(Ad,{store:r,collectionContextStore:u,minWidth:f,blockPropertyValueOverlayStore:h,showPropertyFormats:M,disabled:!L,groupFormat:t,tableStore:b,paddingLeft:v,render:Me}),ae&&(0,$.jsx)(Zd,{isFullScreen:m,hasGroups:void 0!==t,propertyWidths:q,hasPartialResults:ne,hasSearchQuery:se,frozoneProps:J}),ue&&!me&&(0,$.jsx)(sc,{collectionContextStore:u,shouldShowAddRowButton:z,handleAddRowClick:Ve}),me&&(0,$.jsx)(lc,{collectionContextStore:u,handleAddRowClick:Ve,numberOfBlankRows:2-ce,hideDefaultButtonText:Ce,isBlockPropertyValueOverlayOpen:Pe}),(0,$.jsx)("div",{style:{width:U}}),te&&(E?(0,$.jsx)(Ut().ZP,{groupsPointer:oe,store:r,collectionContextStore:u,format:i,isFullScreen:m,incrementLimitsInRelatedGroups:!1,style:Ie.viewAllButton}):(0,$.jsx)(pt().Z,{onMouseDown:de().$0,onClick:Te,disabled:ye,hoveredStyle:Ie.loadMoreButtonHovered,style:Ie.loadMoreButton,children:(0,$.jsxs)("span",{style:Ie.loadMoreButtonInner,children:[(0,no().M)(Ie.iconStyle),(0,$.jsx)("div",{style:Ie.text,children:(0,$.jsx)(qe()._H,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),ye?(0,$.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,$.jsx)(Zo().Z,{style:{width:12,height:12}})}):L&&(0,$.jsx)(qa().Z,{collectionContextStore:u,format:i})]})})),z&&!me&&(0,$.jsx)(pt().Z,{onClick:Ve,onMouseDown:de().$0,style:Ie.addRowButton,className:ie().tfM,children:(0,$.jsxs)("span",{style:Ie.addRowButtonInner,children:[(0,Go().R)(Ie.iconStyle),(0,$.jsx)(Ko,{collectionContextStore:u}),H&&(0,$.jsx)(No().a,{collectionContextStore:u,groupFormat:t,renderLinkButton:e=>(0,$.jsx)(pt().Z,{style:Ie.linkExistingButton,...e,children:(0,$.jsxs)("span",{style:Ie.linkExistingButtonInner,children:[(0,Uo().v)(Ie.linkExistingIcon),(0,$.jsx)(qe()._H,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})})]})}),W&&(0,$.jsx)(rc,{groupFormat:t,disabled:S||!K.canConfigureBlock,schema:l,query:d,collectionContextStore:u,isInPeekRenderer:g,isFullScreen:m,showPropertyFormats:M,showRightActionsSpacer:K.canConfigureCollection,style:Ie.aggregationRow,paddingLeft:v,paddingRight:x,onMouseEnter:()=>we(!0),onMouseLeave:()=>we(!1)})]}):null})),Gd=n.memo((function(e){const t=(0,s().O7)(),{args:o,store:r,collectionContextStore:i,collectionViewFormat:l,blockPropertyValueOverlayStore:d,groupFormat:u,propertyFormats:p,schema:m,canDrag:g,disabled:S,titleColumnIndex:h,onShiftEnter:f,frozoneProps:y,isInHomeWidget:v,isFullScreen:x}=e,b=(0,n.useMemo)((()=>u?[u]:[]),[u]),C=(0,a().VK)((()=>Boolean(i.normalizedFormatStore.state.hide_table_vertical_lines)),[i.normalizedFormatStore]),w=(0,a().VK)((()=>X().fk({environment:t,collectionContextStore:i})),[i,t]),k=(0,a().VK)((()=>r.isNonEditableState()),[r]),V=(0,c().yK)((e=>({itemSelectableHalo:{borderRadius:3,zIndex:$e().iO},itemSelectableStyle:{display:"flex",height:"calc(100% + 2px)"}})),[]),T=(0,n.useCallback)((()=>V.itemSelectableStyle),[V]),j=(0,n.useCallback)((e=>{const{store:o,parentStore:n,subitemPath:r,indentLevel:l}=e;if(n)return(0,$.jsx)(Ba,{store:o,collectionStore:n,subitemPath:r,indentLevel:l,collectionContextStore:i,disabled:S,groupsPointer:b,onSubitemCreate:e=>{if(d){const o=()=>{so().bA({isNewBlock:!0,environment:t,blockPropertyValueOverlayStore:d,store:e,property:"title",format:dt().C.Table,collectionContextStore:i})};i.registerCallbackForItemMounted(e,o)}}})}),[d,i,S,t,b]),R=(0,n.useMemo)((()=>({schema:m,collectionContextStore:i,propertyFormats:p,onPropertyTab:o.onPropertyTab,onPropertyUntab:o.onPropertyUntab,onPropertyEnter:o.onPropertyEnter,onPropertyClick:o.onPropertyClick,onPropertyEsc:o.onPropertyEsc,onPropertyBgClick:o.onPropertyBgClick,onPropertyContextMenu:o.onPropertyContextMenu,onOpenProperty:o.onOpenProperty,disabled:S,blockPropertyValueOverlayStore:d,disableCellBorderRight:C,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:k,disableTableWrap:!1,onShiftEnter:f,titleColumnIndex:h,groupFormat:u,frozoneProps:y,shouldShowMultiSelectCheckbox:w,isInHomeWidget:v})),[o.onOpenProperty,o.onPropertyBgClick,o.onPropertyClick,o.onPropertyContextMenu,o.onPropertyEnter,o.onPropertyEsc,o.onPropertyTab,o.onPropertyUntab,d,i,S,C,f,p,m,h,u,y,w,k,v]);return(0,$.jsx)(xo,{collectionContextStore:i,groupsPointer:b,format:l,canDrag:g,resultProps:R,canDrop:!0,resultComponent:ud,disabled:S,direction:yo.Vertical,getItemSelectableStyle:T,itemSelectableHaloStyle:V.itemSelectableHalo,shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:o.onSelectableEnter,blockPropertyValueOverlayStore:d,titleColumnIndex:h,nestedCreateSubitemButton:j,virtualizeResults:0===b.length&&x})}),Nt().Z),Wd=n.memo((function(e){const{store:t,paddingBottom:o,paddingLeft:r,paddingRight:i,collectionContextStore:l,format:d,schema:u,disabled:p,isFullScreen:m,isRootChild:g,isInPeekRenderer:S,isPreviewing:h,query:f,showHoverActionsStore:y,blockPropertyValueOverlayStore:v,minWidth:x,placementStore:b}=e,C=(0,s().O7)(),w=(0,a().qz)(void 0,Wa),V=(0,n.useRef)(null),T=(0,fe().E)("collections_column_virtualization"),j=d.collection_group_by,R=m&&!j,P=(0,a().VK)((()=>(0,k().ZH)(d,w)),[d,w]),I=(0,a().VK)((()=>(0,X().az)(l,m)),[l,m]),_=(0,a().VK)((()=>l.isInHomeWidgetStore.state),[l.isInHomeWidgetStore]),M=(0,a().VK)((()=>!!l.viewsModuleContextStore.getViewModuleType()),[l]),B=(0,a().VK)((()=>{const e=l.settingsStore.state.open,t=l.settingsStore.state.hideSettingsSidebar||!1,o="sidebar"===b.state;return e&&o&&!t}),[l.settingsStore,b]),F=n.useCallback((e=>{const t=l.isLoadingStore.state,o=l.groupsStore.getGroupState([]),n=null==o?void 0:o.reducerResultStore.state;e<Te().Z.incrementScrollOffset&&n&&!t&&n.hasMore&&(l.infiniteScrollLongTaskObserver.observe(),Xe().ID({collectionContextStore:l,environment:C,incrementLimitArgs:{isFullScreen:m,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}}))}),[l,C,m]),K=(0,c().yK)((()=>({selectable:{position:"relative",marginRight:B?Mt().P4:void 0},container:{position:"relative",float:"left",minWidth:"100%",userSelect:"none",fontVariantNumeric:"lining-nums tabular-nums",paddingBottom:o,paddingLeft:r,paddingRight:i}})),[o,r,i,B]);return(0,Fn().Z)((e=>{const n=(0,$.jsx)(ze().Z,{store:t,shouldShowHalo:!m&&!_,canSelect:!m&&!M,disablePointerEvents:h,analyticsName:"table",style:K.selectable,...e,children:j?(0,$.jsx)(Nd,{collectionContextStore:l,store:t,format:d,schema:u,query:f,isFullScreen:m,isRootChild:g,isInPeekRenderer:S,paddingLeft:r,paddingBottom:o,paddingRight:i,minWidth:x,tableStore:w,showHoverActionsStore:y,blockPropertyValueOverlayStore:v,disabled:p}):(0,$.jsx)($d,{collectionContextStore:l,store:t,format:d,schema:u,query:f,isFullScreen:m,isInPeekRenderer:S,paddingLeft:r,paddingRight:i,paddingBottom:o,minWidth:x,tableStore:w,showHoverActionsStore:y,blockPropertyValueOverlayStore:v,disabled:p,groupFormat:void 0})});return(0,$.jsxs)("div",{className:ie()._so,style:K.container,ref:V,children:[j?T?(0,$.jsx)(Ua,{collectionContextStore:l,tableProperties:P,paddingLeft:r,paddingRight:i,children:n}):n:(0,$.jsx)(zr().Q,{nodeRef:V,children:T?(0,$.jsx)(Ua,{collectionContextStore:l,tableProperties:P,paddingLeft:r,paddingRight:i,children:n}):n}),!I&&!R&&(0,$.jsx)(jo().Z,{onChange:e=>F(e)})]})}))})),Nd=n.memo((function(e){let{collectionContextStore:t,store:o,format:r,schema:i,query:l,disabled:a,isFullScreen:d,paddingLeft:u,paddingRight:p,isRootChild:m,isInPeekRenderer:g,showHoverActionsStore:S,blockPropertyValueOverlayStore:h,minWidth:f,paddingBottom:y,tableStore:v}=e;const x=(0,s().O7)(),b=(0,c().yK)((e=>({groupDivider:{borderTop:`1px solid ${e.tableDividerColor}`}})),[]),C=(0,n.useCallback)(((e,t)=>t.isInHomeWidgetStore.state?{}:0!==e.index||t.viewIsFlushToTopbar()?e.index>0&&t.shouldShowSpinnerStore.state?{}:b.groupDivider:{}),[b.groupDivider]),w=(0,n.useCallback)(((e,o)=>{if(x.device.isMobile)Io()._c({environment:x,store:e,pageVisitSource:Po().tY.Create});else{const{groupFormat:n}=o,r=n?[n]:[],i=t.groupsStore.getGroupState(r),l="collectionTypedView"===t.contextType;_o().CH({environment:x,store:e,peekMode:(0,X().kr)(t),showMoveTo:l,resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:Po().tY.Create})}}),[t,x]);return(0,$.jsx)(Zi,{reducerId:"table_groups",store:o,collectionContextStore:t,disabled:a,isFullScreen:d,isRootChild:m,paddingLeft:u,stickyLeft:!0,renderGroup:e=>(0,$.jsx)($d,{store:o,format:r,schema:i,query:l,collectionContextStore:t,showHoverActionsStore:S,isFullScreen:d,isInPeekRenderer:g,disabled:a,blockPropertyValueOverlayStore:h,minWidth:f,paddingBottom:y,paddingLeft:u,paddingRight:p,tableStore:v,groupFormat:e}),getGroupStyle:e=>C(e,t),renderHeader:e=>(0,$.jsx)(Ud,{args:e,isInPeekRenderer:g}),onGroupHeaderAddItem:(e,t,o)=>{w(e,o)}})})),Ud=n.memo((function(e){let{args:t,isInPeekRenderer:o}=e;const{collectionContextStore:n}=t,r=(0,a().Kw)(n.isInHomeWidgetStore),i=(0,c().yK)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${o?e.cardContentBackground:e.contentBackground}`}})),[o]);return(0,$.jsx)(Fr,{...t,height:r?tt().yZ:Bt().dv,paddingTop:8,toggleClosedMarginBottom:8,stickyStyle:i.stickyStyle})})),$d=n.memo((function(e){let{groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,showHoverActionsStore:s,isFullScreen:c,isInPeekRenderer:d,disabled:u,blockPropertyValueOverlayStore:p,minWidth:m,paddingBottom:g,paddingLeft:S,paddingRight:h,tableStore:f}=e;const y=(0,a().qz)(f,Wa);return(0,a().VK)((()=>l.groupsStore.getGroupState(t?[t]:[])),[l,t])?(0,$.jsx)(zd,{tableStore:y,groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,showHoverActionsStore:s,isFullScreen:c,isInPeekRenderer:d,disabled:u,blockPropertyValueOverlayStore:p,minWidth:m,paddingBottom:g,paddingLeft:S,paddingRight:h}):null}));var qd=()=>o(493843),Yd=()=>o(645843);class Qd extends d().default{constructor(){super("groupsReducerResultStore")}getInitialState(){}}class Xd extends d().default{constructor(){super("hiddenGroupsVisibleStore")}getInitialState(){return!1}}class Jd extends d().default{getInitialState(){return new Set}}class eu extends(()=>o(442))().Z{constructor(){super(...arguments),this.itemsRefStore=new Jd}findCollectionTimelineViewItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}register(e){const t=super.register(e);return this.itemsRefStore.state.has(e)||this.itemsRefStore.setState(new Set(this.itemsRefStore.state).add(e)),t}unregister(e){if(super.unregister(e),this.itemsRefStore.state.has(e)){const t=new Set(this.itemsRefStore.state);t.delete(e),this.itemsRefStore.setState(t)}}getItemsRefStore(){return this.itemsRefStore}}const tu=new eu;(0,o(947115).exposeDebugValue)("GlobalCollectionTimelineViewItemRegistry",tu);var ou=()=>o(992231),nu=()=>o(473604),ru=()=>o(654723);const iu=15,lu=33,su=12,au={position:"absolute",left:0,top:0,zIndex:$e().Gt,width:"100%",height:"100%",pointerEvents:"none"};function cu(e){const{startItemPosition:t,value:o}=e;return t&&o?(o&&t&&o.left<=t.left&&(o.right<t.left?o.left=o.right:(o.left=t.left+su,o.top=o.top-iu)),o):o}function du(e){const{startItem:t,endItem:o,endRelationPointer:r,timelineState:i,disabled:d,isFullScreen:u,isRootChild:p,relationType:m,isUserDrawnTemp:g,isNewSubitemPlaceholder:S,renderEmitter:h}=e,f=(0,E().Y$)(),y=(0,s().O7)(),v=(0,ou().k)(),[x,b]=(0,n.useState)(!1),C=(0,c().Fg)(),[w,k]=(0,n.useState)(null),[V,T]=(0,n.useState)(null),j=(0,n.useCallback)((e=>{k(e.state)}),[]),R=(0,n.useCallback)((e=>{T(e.state)}),[]),P=(0,n.useCallback)((()=>{l().default.afterNextFlush((()=>{v()}))}),[v]);(0,n.useEffect)((()=>(k(t.stores.nodeStore.state),T(o?o.stores.nodeStore.state:null),t.stores.nodeStore.addListener(j),null==o||o.stores.nodeStore.addListener(R),null==h||h.addListener(P),f.filtersBarOpenStore.addListener(P),()=>{t.stores.nodeStore.removeListener(j),null==o||o.stores.nodeStore.removeListener(R),null==h||h.removeListener(P),f.filtersBarOpenStore.removeListener(P)})),[t,o,h,j,R,P,f.filtersBarOpenStore]);const I=(0,a().VK)((()=>uo().default.state.isDragging&&uo().default.state.draggedStores.includes(t.props.store)),[t]),_=(0,a().VK)((()=>o&&uo().default.state.isDragging&&uo().default.state.draggedStores.includes(o.props.store)),[o]),M=(0,a().VK)((()=>{const e=uo().default.state;return e.isDragging?e.currentY-e.startY:0}),[]),B=w&&w.getBoundingClientRect().y+(I?M:0),F=(0,a().VK)((()=>{const e=t.itemPositionStore.state;return B&&e?{left:e.left,right:"subitem"===m?e.left+su:e.right,top:"subitem"===m?B+iu:B}:void 0}),[m,t.itemPositionStore,B]),K=V&&V.getBoundingClientRect().y+(_?M:0),O=(0,a().VK)((()=>{const e=K&&null!=o&&o.itemPositionStore.state?{...o.itemPositionStore.state,top:K}:void 0;return"subitem"===m?cu({startItemPosition:t.itemPositionStore.state,value:e}):e}),[o,K,m,t.itemPositionStore]),L=(0,a().Kw)(t.dateValueStore),D=(0,a().VK)((()=>null==o?void 0:o.dateValueStore.state),[o]),A=(0,a().VK)((()=>void 0!==i.dragState.state),[i]),H=(0,a().VK)((()=>void 0!==i.drawState.state),[i]),Z=(0,a().Kw)(i.hoveredItem),z=x&&!A&&!H,G=(0,n.useCallback)((()=>{r&&!d&&qd().IL({dependency:{store:t.props.store,relationPointer:r},collectionContextStore:f,environment:y,timelineState:i,isFullScreen:u,isRootChild:p})}),[t,d,r,f,y,i,u,p]),W=(0,n.useCallback)((()=>{b(!0)}),[b]),N=(0,n.useCallback)((()=>{b(!1)}),[b]),U=(0,n.useCallback)((e=>{if(O)return(0,$.jsx)(uu,{topOffset:e,endPosition:O,handleCloseButtonClick:G})}),[O,G]),q=(0,a().Kw)(f.permissionScopesStore),Y=Z===t.props.store,Q=o&&Z===o.props.store,X=Y||Q||z||"subitem"===m?1:.7;let J;const ee=(0,a().VK)((()=>t.props.store.canEdit()),[t.props.store]),te=(0,a().VK)((()=>"subitem"!==m&&(ee&&("collectionTypedView"===f.contextType||q.canEditContent))),[m,ee,f,q.canEditContent]);"subitem"===m?J=C.collectionUnsetDependencyArrow:L&&D&&(J=L<=D?C.collectionValidDependencyArrow:C.collectionInvalidDependencyArrow);const oe=(0,c().yK)((()=>({svgStyle:{zIndex:"dependency"===m&&(z||Q)?$e().Gt:$e().wx}})),[m,z,Q]);return F?g?(0,$.jsx)(pu,{startPosition:F,timelineState:i}):S?(0,$.jsx)(mu,{startPosition:F,timelineState:i}):t!==o&&O?(0,$.jsx)(gu,{startPosition:F,endPosition:O,strokeOpacity:X,strokeColorOverride:J,svgStyle:oe.svgStyle,cornerRadiusOverride:"subitem"===m?8:void 0,relationType:m,handleMouseMove:W,handleMouseLeave:N,renderChildren:te&&z?U:void 0}):null:null}function uu(e){const{topOffset:t,endPosition:o,handleCloseButtonClick:n}=e,r=(0,c().yK)((e=>({icon:{background:e.white,borderRadius:5,fill:e.accentColors.red[500],height:14,width:14}})),[]);return(0,$.jsx)($.Fragment,{children:(0,$.jsx)("foreignObject",{width:16,height:16,x:o.left-16,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:n,children:(0,ru().X)(r.icon)})})}function pu(e){const{startPosition:t,timelineState:o}=e,n=(0,a().VK)((()=>{const e=o.drawState.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;return{left:t.right+e.xOffsetPx+18,top:t.top+e.yOffsetPx}}),[t,o.drawState]);return n?(0,$.jsx)(gu,{startPosition:t,endPosition:n,strokeOpacity:1,relationType:"dependency"}):null}function mu(e){var t;const{startPosition:o,timelineState:n}=e,r=(0,c().Fg)(),i=(0,a().Kw)(n.dateRangePlaceholder),l=(0,a().VK)((()=>null!=i&&i.active?i.date:void 0),[i]),s=null!=i&&i.active?null===(t=i.newTimelineItemProps)||void 0===t?void 0:t.subitemPath:void 0,d=s?s[s.length-1].children.length:0,u=o.top+d*lu+iu+5,p=(0,a().VK)((()=>{const e=(0,Ft().HZ)({timelineState:n,dateValue:l,placeholderDate:l,subitemPlaceholderDate:void 0}),t=u&&e?{...e,top:u}:void 0;return cu({startItemPosition:o,value:t})}),[l,u,o,n]);return p?(0,$.jsx)(gu,{startPosition:o,endPosition:p,strokeOpacity:1,strokeColorOverride:r.collectionUnsetDependencyArrow,relationType:"subitem"}):null}function gu(e){const{startPosition:t,endPosition:o,strokeColorOverride:r,cornerRadiusOverride:i,strokeOpacity:l,relationType:s,svgStyle:d,handleMouseMove:u,handleMouseLeave:p}=e,m=(0,E().Y$)(),g=(0,c().Fg)(),[S,h]=(0,n.useState)(0),f=t.right,y=t.top+iu-S,v=o.left-3,x=o.top+iu-S,b=(0,a().VK)((()=>{if(r)return r;return(0,Ft().H5)(m)&&t.right&&o.left?t.right<o.left?g.collectionValidDependencyArrow:g.collectionInvalidDependencyArrow:g.collectionUnsetDependencyArrow}),[m,o.left,t.right,r,g]);return(0,$.jsx)("svg",{style:{...au,...d},ref:e=>{e&&h(e.getBoundingClientRect().top)},children:(0,$.jsx)(nu().Z,{startPoint:{x:f,y},endPoint:{x:v,y:x},style:{stroke:b,strokeWidth:Ft().lf,strokeOpacity:l},useRightAngles:"subitem"===s,showArrowHead:"dependency"===s&&!e.renderChildren,cornerRadiusOverride:i,handleMouseMove:u,handleMouseLeave:p,children:e.renderChildren&&e.renderChildren(S)})})}function Su(e){const{timelineState:t,disabled:o,isReady:r,isFullScreen:i,isRootChild:l,renderEmitter:s}=e,c=(0,E().Y$)(),d=(0,n.useCallback)((()=>{t.drawState.setState(void 0)}),[t.drawState]),u=(0,a().VK)((()=>c.collectionViewBlockStore()),[c]),p=(0,a().VK)((()=>c.settingsStore.state.open),[c]);if((0,n.useEffect)((()=>{var e;!p&&null!==(e=t.drawState.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&d()}),[p,t.drawState,d]),!r||!u)return null;const m=tu.findCollectionTimelineViewItems(u);return(0,$.jsx)($.Fragment,{children:m.map((e=>{const{store:r,groupFormat:a}=e.props,c=null==a?void 0:a.value,d=c?(0,zt().Hd)(c):"noGroup";return(0,$.jsxs)(n.Fragment,{children:[(0,$.jsx)(hu,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:s,relationType:"dependency"},`${r.id}-${d}-${r.key}-dependency`),(0,$.jsx)(hu,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:s,relationType:"subitem"},`${r.id}-${d}-${r.key}-subitem`)]},`${r.id}-${d}-${r.key}`)}))})}function hu(e){const{startItem:t,timelineState:o,disabled:r,isFullScreen:i,isRootChild:l,relationType:s,renderEmitter:c}=e,{store:d,schema:u}=t.props,p=(0,E().Y$)(),m=(0,a().VK)((()=>"dependency"===s?o.drawState.state:void 0),[o.drawState,s]),g=(0,a().VK)((()=>(null==m?void 0:m.startStore)===d),[d,m]),S=(0,a().VK)((()=>g&&!(null!=m&&m.tryToCompleteDrawnArrow)),[m,g]),h=(0,a().VK)((()=>"dependency"===s?g&&m?m.temporaryDependencyRelationPointers:(0,Ft().YE)(p,d,u):"subitem"===s?(0,Ft().ph)(p,d,u):[]),[s,g,m,p,d,u]),f=(0,a().VK)((()=>p.collectionViewBlockStore()),[p]),y=(0,a().VK)((()=>{var e;const n=o.dateRangePlaceholder.state;if("subitem"!==s||null==n||!n.active||!n.newTimelineItemProps)return;const r=n.newTimelineItemProps.subitemPath;return(r?null===(e=r[r.length-1])||void 0===e?void 0:e.value.store:void 0)===t.props.store?n:void 0}),[s,t.props.store,o.dateRangePlaceholder]),v=(0,a().VK)((()=>[...tu.getItemsRefStore().state]),[]);return f?(0,$.jsxs)($.Fragment,{children:[h.map((e=>{if(d.id===e.id)return null;const a=v.filter((t=>t.props.store.id===e.id));return(0,$.jsx)(n.Fragment,{children:a.map((n=>{const a=n.props.store,d=n.props.groupFormat;return(0,$.jsx)(du,{startItem:t,endItem:n,endRelationPointer:e,timelineState:o,disabled:r,isFullScreen:i,isRootChild:l,renderEmitter:c,relationType:s},`${a.id}-${null==d?void 0:d.value.value}-${a.key}`)}))},e.id)})),"dependency"===s&&S&&(0,$.jsx)(du,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"dependency"}),"subitem"===s&&y&&(0,$.jsx)(du,{isNewSubitemPlaceholder:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"subitem"})]}):null}const fu=function(e){let{zoomLevel:t,onChange:o}=e;const n=(0,c().Fg)(),r=(0,s().O7)(),{device:i}=r;return(0,$.jsx)(vr().ZP,{popupType:i.isMobile?Zl().kQ.SlideUp:Zl().kQ.Popup,renderOrigin:e=>(0,$.jsxs)(zo().Z,{isSmall:!0,isGray:!0,...e,children:[(0,$.jsx)(yu,{zoomLevel:t}),(0,Si().i)({width:10,marginLeft:4,fill:n.mediumIconColor})]}),originGap:8,render:e=>(0,$.jsx)(vu,{parent:e,zoomLevel:t,onChange:o})})};function yu(e){let{zoomLevel:t}=e;return"hours"===t?(0,$.jsx)(qe()._H,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours"}):"day"===t?(0,$.jsx)(qe()._H,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day"}):"week"===t?(0,$.jsx)(qe()._H,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week"}):"bi_week"===t?(0,$.jsx)(qe()._H,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week"}):"month"===t?(0,$.jsx)(qe()._H,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month"}):"quarter"===t?(0,$.jsx)(qe()._H,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter"}):"year"===t?(0,$.jsx)(qe()._H,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year"}):void(0,h().t1)(t)}function vu(e){let{parent:t,zoomLevel:o,onChange:n}=e;const r=(0,s().O7)(),{device:i}=r,l=[{key:"calendar by section",render:e=>(0,$.jsx)(nr().Z,{...e}),items:$a().H.map((e=>({key:e,render:t=>(0,$.jsx)(yr().Z,{...t,title:(0,$.jsx)(yu,{zoomLevel:e})}),action:()=>{n(e),t.close()}})))}];return(0,$.jsx)(Ze().Z,{capture:!0,allowEsc:!0,render:e=>{let n;return n=i.isMobile?{menuType:Yn().o.Modal,title:(0,$.jsx)(qe()._H,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:(0,$.jsx)(or().DoneMenuText,{}),onClickRight:t.close,...e}:{menuType:Yn().o.Popup,width:180,...e},(0,$.jsx)(er().Z,{...n,children:(0,$.jsx)(tr().Z,{type:tr().i.Vertical,sections:l,initialFocus:$a().H.indexOf(o)})})}})}const xu=6,bu=Ft().Zn+Ft().xd;function Cu(e){let{timelineState:t,scrollerLeftOffset:i,paddingLeft:l,showTable:d,isFullScreen:u,isRootChild:p,isReady:m,collectionContextStore:g,isInPeekRenderer:S,format:h,paddingRight:f}=e;const y=(0,c().Fg)(),v=(0,s().O7)(),x=(0,a().VK)((()=>{const e=t.zoomLevel.state,{primaryDisplayUnit:o,secondaryDisplayUnit:n}=Ft().BJ[e],s=t.scrollLeft.state,{startTimestamp:a}=t.currentRange.state;if(void 0!==s){const t=a+(0,Ft().x2)(e,s+i+(!d&&u?l:0));return(0,Ft().DS)(r().ou.fromMillis(t),o).startOf(n).valueOf()}}),[t,i,l,d,u]),b=(0,s().Fy)(),C=(0,a().Kw)(t.zoomLevel),k=(0,a().VK)((()=>t.outerSizeObserver.rect.state.width),[t]),{secondaryDisplayUnit:V}=Ft().BJ[C],T=(0,a().VK)((()=>(0,Ft().d$)({environment:v,isFullScreen:u,isRootChild:p})),[v,u,p]),j=(0,a().Kw)(g.permissionScopesStore),R=!d&&T&&j.canConfigureBlock,P=(0,X().jw)(g,y),I=(null==P?void 0:P.background)||(S?y.cardContentBackground:y.contentBackground),_=S?y.cardContentBackgroundTransparent:y.contentBackgroundTransparent,M=(0,c().yK)((()=>({secondaryDisplayUnit:{position:"absolute",top:1,left:"calc(-1 * var(--sticky-horizontal-offset, 0px))",paddingLeft:u&&!d?i+l:i,display:"flex",alignItems:"center",height:bu,paddingTop:xu+(b.isMobile?2:0),background:I,fontSize:14,fontWeight:Zt().Ue.medium},outerContainer:{position:"sticky",left:0,width:k,zIndex:$e().Qm,height:0},controlBarRight:{position:"absolute",top:1,right:"var(--sticky-horizontal-offset, 0px)",paddingRight:f,display:"flex",alignItems:"center",height:bu,paddingTop:xu+1,background:I},hideTableIcon:{paddingLeft:4,paddingRight:4,marginLeft:2,marginRight:4,marginTop:b.isIOS?0:1,height:22,fill:y.lightIconColor}})),[I,b.isIOS,b.isMobile,u,k,l,f,i,d,y.lightIconColor]),B=(0,n.useRef)(null);return(0,$.jsx)(Mr().u,{stickyAttachPoint:"ceiling",nodeRef:B,noPlaceholder:!0,children:(0,$.jsxs)("div",{style:M.outerContainer,ref:B,children:[x&&(0,$.jsxs)("div",{style:M.secondaryDisplayUnit,children:[R&&(0,$.jsx)(gt().Z,{render:e=>(0,$.jsx)(zo().Z,{isSmall:!0,onClick:()=>function(e,t,o,n,r,i){const l=n.collectionViewStore();if(!l)return;w().createAndCommit({userAction:"CollectionTimelineViewControlBar.handleShowTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,Ft().YP)(t,!0);Xo().FH({stores:[l],update:o,transaction:e})}}),(0,Yd().CB)(e,{...(0,Yd().Ii)({environment:e,collectionContextStore:n,timelineState:o,isFullScreen:r,isRootChild:i}),show:!0})}(v,h,t,g,u,p),style:M.hideTableIcon,...e,children:(0,o(68744).t)({width:14})}),renderTooltip:()=>(0,$.jsx)(qe()._H,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}),(0,$.jsx)("span",{style:{paddingLeft:R||b.isPhone?0:u||d?16:2},children:(0,Ft().qG)(x,V)}),!m&&!d&&(0,$.jsx)(ku,{}),(0,$.jsx)("div",{style:{width:30,marginRight:-30,height:"100%",backgroundImage:`linear-gradient(to right, ${I} 20%, ${_} 100%)`}})]}),(0,$.jsxs)("div",{style:M.controlBarRight,children:[(0,$.jsx)("div",{style:{width:30,marginLeft:-30,height:"100%",backgroundImage:`linear-gradient(to left, ${I} 20%, ${_} 100%)`}}),(0,$.jsx)(ha,{collectionContextStore:g}),(0,$.jsx)(fu,{zoomLevel:C,onChange:e=>function(e,t,o,n,r,i){qd().Nf({timelineState:o,environment:t,zoomLevel:e,centerTimestamp:(0,Ft().al)(o)}),(0,Yd().zI)(t,(0,Yd().Ii)({environment:t,collectionContextStore:n,timelineState:o,isFullScreen:r,isRootChild:i}))}(e,v,t,g,u,p)}),(0,$.jsx)(zo().Z,{isSmall:!0,isGray:!0,onClick:()=>function(e,t,o,n,r,i,l){const s=t.zoomLevel.state,a=t.outerSizeObserver.rect.state.width,c=(0,Ft().xI)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(a-c)/2,u=(0,Ft().al)(t),p=u-(0,Ft().x2)(s,d);qd().Nf({timelineState:t,environment:e,zoomLevel:s,centerTimestamp:p}),(0,Yd().Al)(e,{...(0,Yd().Ii)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"left"})}(v,t,l,h,u,p,g),style:{marginLeft:4,paddingLeft:4,paddingRight:4},children:(0,ta().f)({width:12,fill:y.mediumIconColor})}),(0,$.jsx)(zo().Z,{isSmall:!0,onClick:()=>function(e,t,o,n,r,i,l){const s=t.zoomLevel.state,a=(0,Ft().bK)({timestamp:Date.now(),environment:e,timelineState:t,paddingLeft:o,format:n});qd().Nf({timelineState:t,environment:e,zoomLevel:s,centerTimestamp:a}),(0,Yd().H6)(e,{...(0,Yd().Ii)({environment:e,collectionContextStore:r,timelineState:t,isFullScreen:i,isRootChild:l})})}(v,t,l,h,g,u,p),children:(0,$.jsx)(qe()._H,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today"})}),(0,$.jsx)(zo().Z,{isSmall:!0,isGray:!0,onClick:()=>function(e,t,o,n,r,i,l){const s=t.zoomLevel.state,a=t.outerSizeObserver.rect.state.width,c=(0,Ft().xI)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(a-c)/2,u=(0,Ft().al)(t),p=u+(0,Ft().x2)(s,d);qd().Nf({timelineState:t,environment:e,zoomLevel:s,centerTimestamp:p}),(0,Yd().Al)(e,{...(0,Yd().Ii)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"right"})}(v,t,l,h,u,p,g),style:{paddingLeft:4,paddingRight:4},children:(0,oa().o)({width:12,fill:y.mediumIconColor})})]})]})})}const wu=n.memo(Cu);function ku(){return(0,Bn().Z)(!0,400,0)?(0,$.jsx)(Zo().Z,{style:{marginLeft:8,marginTop:1}}):null}var Vu=()=>o(435308),Tu=()=>o(578292);function ju(e){const{shouldShowShimmer:t,children:o}=e,n=(0,Bn().Z)(t,0,100)?"notion-shimmer-timeline-transition notion-shimmer-timeline":"notion-shimmer-timeline-transition";return(0,$.jsx)("div",{className:n,style:{height:"100%"},children:o})}const Ru=4,Pu=22,Iu=110,_u=7,Mu=22,Bu=12,Fu=4,Ku=32;function Ou(e){var t;const{collectionContextStore:o,isInPeekRenderer:i,timelineState:l,query:d,schema:u}=e,p=(0,c().Fg)(),m=(0,s().Fy)(),g=(0,qe().YB)(),{value:h}=(0,G().XJ)(oe().F.formulas),f=(0,ou().k)(),y=(0,n.useCallback)((()=>{0===(new Date).getSeconds()&&f()}),[f]);(0,n.useEffect)((()=>{const e=setInterval(y,1e3);return()=>clearInterval(e)}),[y]);const{primaryDisplayUnit:v,activeRangeType:x}=(0,a().VK)((()=>{const e=l.zoomLevel.state;return Ft().BJ[e]}),[l]),b=(0,Ft().ST)(v),C=r().ou.now(),w=b?C.startOf("minute"):C.startOf("day"),k=C.startOf("minute"),V=(0,a().VK)((()=>!o.groupsStore.anyGroupHasNonEmptyResults()&&(0,Ro().H0)({collectionContextStore:o,groupsPointer:[],hasPartialResults:!1})),[o]),T=null===(t=(0,X().jw)(o,p))||void 0===t?void 0:t.background,j=(0,a().VK)((()=>o.viewIsFlushToTopbar()),[o]),R=(0,c().yK)((e=>({wrapper:{position:"absolute",left:0,top:0,width:"100%",background:T||(i?e.cardContentBackground:e.contentBackground),boxSizing:"border-box",boxShadow:j?`inset 0 var(--timeline-box-shadow, 1px) 0 0 ${e.tableDividerColor}`:void 0},controlBar:{height:bu,position:"relative",overflow:"hidden"},primaryTimeBar:{height:Ku,boxShadow:`inset 0 -1px 0 0 ${e.tableDividerColor}`,boxSizing:"border-box",position:"relative",overflow:"hidden"},stickyStyle:{outline:void 0,"--timeline-box-shadow":"0px"},transitionStickyStyle:{display:"none"}})),[T,i,j]),P=new(Vu().default)((()=>{const e=o.collectionStore();if(!e)return;const t=l.dragState.state,n=l.zoomLevel.state,r=l.hoveredItem.state,i=l.dateRangePlaceholder.state,{activeRangeType:s}=Ft().BJ[n];if(!s)return;let a;if(t)a=t.temporaryValues.map((e=>(0,Ft().XO)(e,"day")));else if(i.active)a=[(0,Ft().XO)(i.date,"day")];else{const{stores:t}=N().default.state,n=t.filter((t=>t.getAssociatedCollectionId()===e.id)),i=S().jj(S().oA([...n,r]));a=S().oA(i.map((e=>{const t=(0,Ft().bk)({store:e,query:d,schema:u,userId:o.getCurrentUserId(),intl:g,formulasModule:h});if(t)return(0,Ft().XO)(t,"day")})))}const c=S().F(a,(e=>{let{start:t}=e;return t.valueOf()})),p=S().UT(a,(e=>{let{end:t}=e;return t.valueOf()}));return c&&p?{start:c.start.valueOf(),end:p.end.valueOf()}:void 0}),{debugName:"activeRangeStore"}),I=(0,n.useRef)(null);return(0,$.jsx)(Mr().u,{stickyAttachPoint:"ceiling",nodeRef:I,stickyStyle:R.stickyStyle,transitionStickyStyle:R.transitionStickyStyle,noPlaceholder:!0,children:(0,$.jsxs)("div",{style:R.wrapper,ref:I,children:[(0,$.jsx)("div",{style:R.controlBar,children:!m.isPhone&&(0,$.jsx)(Uu,{timelineState:l})}),(0,$.jsxs)("div",{style:R.primaryTimeBar,children:[(0,$.jsx)(ju,{shouldShowShimmer:V,children:(0,$.jsx)(Nu,{timelineState:l,nowTimeStartOfPrimaryDisplayUnit:w})}),"highlight_days"===x&&(0,$.jsx)(qu,{timelineState:l,activeRangeStore:P}),(0,$.jsx)($u,{timelineState:l,time:w}),"display_range"===x&&(0,$.jsx)(qu,{timelineState:l,activeRangeStore:P})]}),(0,$.jsx)(Zu,{timelineState:l,time:k})]})})}function Lu(e,t,o){const n=o.zoomLevel.state,{startTimestamp:r}=o.currentRange.state,{primaryDisplayUnit:i,primaryDisplayUnitAlignment:l}=Ft().BJ[n],s=(0,Ft().DS)(e,i),a=(0,Ft().Ip)(e,i),c=(0,Ft().e$)(n,s.valueOf()-r),d=(0,Ft().e$)(n,e.valueOf()-r),u=(0,Ft().e$)(n,a.valueOf()-r)-c,p=t?Fu:0;return{left:("range_start"===l?d-u/2:d)-p,width:u+2*p}}function Du(e,t,o,n,r){const i=e.setLocale(ea().locale),l=(0,Ft().xJ)(),s=n?r.regularTextColor:r.lightTextColor,a=n?r.regularTextColor:r.mediumTextColor,c=n?r.mediumTextColor:r.lightTextColor,d=i.toFormat("t").startsWith(i.toFormat("a"));if("fifteen_minutes"===o){if(l)return(0,$.jsx)("span",{style:{color:s},children:i.toFormat("H:mm")});{const e=(0,$.jsx)("span",{style:{color:a,paddingRight:d?void 0:3},children:i.toFormat("h:mm")}),t=(0,$.jsx)("span",{style:{color:c,paddingRight:d?3:void 0},children:i.toFormat("a")});return d?(0,$.jsxs)($.Fragment,{children:[t,e]}):(0,$.jsxs)($.Fragment,{children:[e,t]})}}if("hour"===o){if(l)return(0,$.jsx)("span",{style:{color:s},children:i.toFormat("H:mm")});{const e=(0,$.jsx)("span",{style:{color:a,paddingRight:d?void 0:3},children:i.toFormat("h")}),t=(0,$.jsx)("span",{style:{color:c,paddingRight:d?3:void 0},children:i.toFormat("a")});return d?(0,$.jsxs)($.Fragment,{children:[t,e]}):(0,$.jsxs)($.Fragment,{children:[e,t]})}}if("day"===o||"week"===o)return"week"===t||"bi_week"===t?(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("span",{style:{color:c,paddingRight:3},children:i.toFormat("ccccc")}),(0,$.jsx)("span",{style:{color:a,padding:"2px 7px"},children:i.toFormat("d")})]}):(0,$.jsx)("span",{style:{color:s},children:i.toFormat("d")});(0,h().t1)(o)}function Eu(e){return{color:e.regularTextColor,fontSize:Bu}}function Au(e){return{background:e.timelineRed,width:Mu,height:Mu,borderRadius:Mu/2,position:"absolute",left:`calc(50% - ${Mu/2}px)`,top:`calc(50% - ${Mu/2}px)`}}function Hu(e){let{time:t,accent:o,timelineState:n}=e;const r=(0,c().Fg)(),i=(0,a().Kw)(n.zoomLevel),{primaryDisplayUnit:l}=Ft().BJ[i],{left:s,width:d}=(0,a().VK)((()=>Lu(t,!1,n)),[t,n]);return(0,$.jsx)("div",{style:{position:"absolute",top:0,left:s,width:d,height:Ku-4,display:"flex",alignItems:"start",lineHeight:Ku-4+"px"},children:(0,$.jsx)("div",{style:{fontSize:Bu,margin:"0 auto"},children:Du(t,i,l,o,r)})})}function Zu(e){let{time:t,timelineState:o}=e;const n=(0,c().Fg)(),r=(0,a().Kw)(o.zoomLevel),{startTimestamp:i}=(0,a().Kw)(o.currentRange),l=Math.floor((0,Ft().e$)(r,t.valueOf()-i));return(0,$.jsx)("div",{style:{position:"absolute",left:l-_u/2+.5,top:Math.floor(Ku+bu-_u/2+.5),width:_u,height:_u,background:n.timelineRed,borderRadius:"100%"}})}function zu(e){let{time:t,timelineState:o,intl:n}=e;const r=(0,c().Fg)(),i=(0,s().O7)(),l=(0,a().Kw)(o.zoomLevel),{startTimestamp:d}=(0,a().Kw)(o.currentRange),{secondaryDisplayUnit:u}=Ft().BJ[l],p=(0,Ft().e$)(l,t.valueOf()-d);return(0,$.jsx)("div",{style:{position:"absolute",top:0,left:p,height:Ku,color:r.regularTextColor,fontSize:14,fontWeight:Zt().Ue.medium,verticalAlign:"middle",paddingTop:xu+(i.device.isMobile?2:0),display:"flex",alignItems:"center"},children:(0,Ft().EW)((0,Tu().E2)(n),t.valueOf(),u)},p)}function Gu(e){let{start:t,end:o,rangeWidth:n}=e;const r=(0,c().Fg)();return t&&o?n>=Iu?(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("div",{style:Eu(r),children:(0,Is().Yx)(t.valueOf(),"month_day",ea().locale)}),(0,$.jsx)("div",{style:{flexGrow:1}}),(0,$.jsx)("div",{style:Eu(r),children:(0,Is().Yx)(o.valueOf(),"month_day",ea().locale)})]}):(0,$.jsxs)("div",{style:Eu(r),children:[(0,Is().Yx)(t.valueOf(),"month_day",ea().locale),"  ",t.month===o.month?(0,Is().Yx)(o.valueOf(),"day",ea().locale):(0,Is().Yx)(o.valueOf(),"month_day",ea().locale)]}):(0,$.jsx)("div",{style:Eu(r),children:(0,Is().Yx)(t.valueOf(),"month_day",ea().locale)})}function Wu(e,t,o,n){const r=e.setLocale(ea().locale),i=(0,Ft().ST)(o),l=(0,Ft().xJ)();return i?l?(0,$.jsx)("span",{style:{color:n.timelineRed},children:r.toFormat("H:mm")}):(0,$.jsx)("span",{style:{color:n.timelineRed,paddingRight:3},children:r.toFormat("t")}):"week"===t||"bi_week"===t?(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("span",{style:{color:n.lightTextColor,paddingRight:3},children:r.toFormat("ccccc")}),(0,$.jsxs)("div",{style:{position:"relative"},children:[(0,$.jsx)("div",{style:Au(n)}),(0,$.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})]}):(0,$.jsxs)("div",{style:{position:"relative"},children:[(0,$.jsx)("div",{style:Au(n)}),(0,$.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})}function Nu(e){let{nowTimeStartOfPrimaryDisplayUnit:t,timelineState:o}=e;const n=(0,a().Kw)(o.zoomLevel),{startTimestamp:i,endTimestamp:l}=(0,a().Kw)(o.currentRange),s=Ft().BJ[n],{primaryDisplayUnit:c,hidePrimaryIndicatorIntersectionOffset:d}=s,u=d||0,p=(0,a().VK)((()=>Lu(t,!1,o)),[t,o]),m=p.left+u,g=p.left+p.width-u,S=[];let h=(0,Ft().DS)(r().ou.fromMillis(i),c);const f=(0,a().VK)((()=>Lu(h,!1,o)),[h,o]);for(;h.valueOf()<l;){const e=f.left+u,t=f.left+f.width-u;void 0!==d&&(m>=e&&m<=t||g>=e&&g<=t)||S.push((0,$.jsx)(Hu,{timelineState:o,time:h,accent:!1},h.valueOf()));const n=(0,Ft().Ip)(h,c);h=n}return(0,$.jsx)($.Fragment,{children:S})}function Uu(e){let{timelineState:t}=e;const o=(0,qe().YB)(),n=(0,a().Kw)(t.zoomLevel),{startTimestamp:i,endTimestamp:l}=(0,a().Kw)(t.currentRange),s=Ft().BJ[n],{primaryDisplayUnit:c,secondaryDisplayUnit:d}=s,u=[];let p=(0,Ft().DS)(r().ou.fromMillis(i),d);for(;p.valueOf()<l;){u.push((0,$.jsx)(zu,{timelineState:t,intl:o,time:p},p.valueOf()));const e=(0,Ft().Ip)(p,d);p=(0,Ft().xP)(e,c)}return(0,$.jsx)($.Fragment,{children:u})}function $u(e){let{time:t,timelineState:o}=e;const n=(0,c().Fg)(),r=(0,a().Kw)(o.zoomLevel),{primaryDisplayUnit:i}=Ft().BJ[r],{left:l,width:s}=(0,a().VK)((()=>Lu(t,!0,o)),[t,o]);return(0,$.jsx)("div",{style:{position:"absolute",top:0,left:l,width:s,height:Ku-4,display:"flex",alignItems:"center",fontWeight:500},children:(0,$.jsx)("div",{style:{fontSize:Bu,margin:"0 auto",display:"flex"},children:Wu(t,r,i,n)})},l)}function qu(e){let{timelineState:t,activeRangeStore:o}=e;const n=(0,c().Fg)(),i=(0,a().Kw)(t.zoomLevel),{startTimestamp:l,endTimestamp:s}=(0,a().Kw)(t.currentRange),d=Ft().BJ[i],{activeRangeType:u}=d,p=(0,a().Kw)(o);if(p){const e=(0,Ft().DS)(r().ou.fromMillis(p.start),"day"),o=(0,Ft().e$)(i,e.valueOf()-l);if("highlight_days"===u){const a=[];let c=r().ou.fromMillis(Math.max(e.valueOf(),(0,Ft().DS)(r().ou.fromMillis(l),"day").valueOf()));for(;c.valueOf()<p.end&&c.valueOf()<s;){a.push(c);c=(0,Ft().Ip)(c,"day")}const d=(0,Ft().e$)(i,c.valueOf()-l)-o+2*Ru,u=a.map(((e,o)=>(0,$.jsx)(Hu,{timelineState:t,time:e,accent:0===o||o===a.length-1},`${e.toString()}-${o}`)));return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("div",{style:{position:"absolute",top:0,left:o-Ru,width:d,marginTop:(Ku-Pu)/2-2,height:Pu,background:n.timelineDarkerBackground,borderRadius:Pu/2}}),u]})}{const t=(0,Ft().DS)(r().ou.fromMillis(p.end),"day"),s=(0,Ft().cK)(r().ou.fromMillis(p.end),"day"),a=(0,Ft().e$)(i,t.valueOf()-l)-o+2*Ru;return(0,$.jsx)("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:0,left:o-Ru,minWidth:a,marginTop:(Ku-Pu)/2-2,height:Pu,background:n.timelineDarkerBackground,borderRadius:Pu/2,paddingLeft:6,paddingRight:6},children:(0,$.jsx)(Gu,{start:e,end:e.valueOf()!==s.valueOf()?s:void 0,rangeWidth:a})})}}return null}function Yu(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:n}=e;const r=(0,a().VK)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),i=t.settingsStore;return(0,$.jsx)(jl,{title:(0,$.jsx)(qe()._H,{defaultMessage:"No date property",id:"database.timelineView.missingDatePropertyTitle"}),description:r?(0,$.jsx)(qe()._H,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Timeline view.",id:"database.timelineView.missingDateProperty",values:{opensettingslink:e=>(0,$.jsx)(Tl,{onClick:()=>{y().r$({collectionContextStore:t,collectionSettingsStore:i}),y().H4({collectionSettingsStore:i,item:{type:"properties",timelineViewTab:"timeline"}})},children:e})}}):(0,$.jsx)(qe()._H,{defaultMessage:"Timeline views require a date property in order to display.",id:"database.timelineView.missingDatePropertyNoPermissions"}),style:{paddingBottom:o?void 0:n}})}function Qu(e){let{timelineState:t}=e;const o=(0,ou().k)(),r=(0,n.useCallback)((()=>{0===(new Date).getSeconds()&&o()}),[o]);(0,n.useEffect)((()=>{const e=setInterval(r,1e3);return()=>clearInterval(e)}),[r]);const i=(0,a().Kw)(t.zoomLevel),{startTimestamp:l,endTimestamp:s}=(0,a().Kw)(t.currentRange);return(0,$.jsxs)("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"},children:[(0,$.jsx)(op,{zoomLevel:i,startTimestamp:l,endTimestamp:s}),(0,$.jsx)(np,{zoomLevel:i,startTimestamp:l,endTimestamp:s}),(0,$.jsx)(tp,{zoomLevel:i,startTimestamp:l})]})}const Xu=n.memo(Qu,Nt().Z),Ju=n.memo((function(e){let{start:t,zoomLevel:o,startTimestamp:n}=e;const r=(0,c().yK)((e=>{const r=t.plus({day:2}).startOf("day"),i=(0,Ft().e$)(o,t.valueOf()-n);return{weekendIndicator:{position:"absolute",left:i,width:(0,Ft().e$)(o,r.valueOf()-n)-i,height:"100%",background:e.timelineDarkerBackground}}}),[t,n,o]);return(0,$.jsx)("div",{style:r.weekendIndicator},t.valueOf())}),Nt().Z),ep=n.memo((function(e){let{time:t,zoomLevel:o,startTimestamp:n}=e;const r=(0,c().yK)((e=>({verticalDivider:{position:"absolute",left:(0,Ft().e$)(o,t-n),height:"100%",borderRight:`1px solid ${e.regularDividerColor}`}})),[n,t,o]);return(0,$.jsx)("div",{style:r.verticalDivider},t)}),Nt().Z),tp=n.memo((function(e){let{zoomLevel:t,startTimestamp:o}=e;const n=(0,c().yK)((e=>{const n=r().ou.now().startOf("minute");return{nowVerticalDivider:{position:"absolute",left:Math.floor((0,Ft().e$)(t,n.valueOf()-o)),height:"100%",borderRight:`1px solid ${e.timelineRed}`}}}),[o,t]);return(0,$.jsx)("div",{style:n.nowVerticalDivider})}),Nt().Z),op=n.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:n}=e;const{showWeekendIndicators:i}=Ft().BJ[t];if(!i)return null;let l=(0,Ft().DS)(r().ou.fromMillis(o),"day");const s=[];for(;l.valueOf()<n;)6===l.weekday&&s.push((0,$.jsx)(Ju,{start:l,zoomLevel:t,startTimestamp:o},l.valueOf())),l=(0,Ft().Ip)(l,"day");return(0,$.jsx)($.Fragment,{children:s})}),Nt().Z),np=n.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:n}=e;const{verticalDividerUnit:i}=Ft().BJ[t];if(!i)return null;const l=[];let s=(0,Ft().DS)(r().ou.fromMillis(o),i);for(;s.valueOf()<n;)l.push((0,$.jsx)(ep,{time:s.valueOf(),zoomLevel:t,startTimestamp:o},s.valueOf())),s=(0,Ft().Ip)(s,i);return(0,$.jsx)($.Fragment,{children:l})}),Nt().Z);var rp=()=>o(760536);function ip(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:s,canEditCollectionTimeline:a}=e;return(0,n.useCallback)((e=>{const{groupFormat:n,currentGroups:c,visibleGroups:d,hiddenGroups:u,total:p}=e,m=i.collection_group_by,g=t.groupsStore.getGroupState(n),S=Boolean(n&&!(null!=g&&g.toggleStateStore.state)),h=function(e,t,o,n){if(!e)return!0;const r=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<r){const t=n.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.state}return!1}))}(n,S,c,t),f=null==g?void 0:g.reducerResultStore.state,y=X().VM({collectionContextStore:t,reducerResult:f,isFullScreen:o}),v=n===u[u.length-1],x=n===d[d.length-1],b=0===d.length&&!t.shouldShowSpinnerStore.state||d.length>0,C=d.length<p-u.length&&b||(0,Ro().gf)({collectionContextStore:t,isForColumnGroups:!1}),w=l.state?v:x,k=t.permissionScopesStore.state,V=w&&!r&&k.canConfigureBlock&&m&&(0,zt().Wz)(m,k.canConfigureCollection),T=f&&0===f.blockIds.length;return{groupHeader:Boolean(n&&(!s||!h)),tableHeaderRow:Boolean(s&&!S&&!h),tableAggregationRow:Boolean(s&&!S),addItemRow:Boolean(a&&!S),hiddenGroupsButton:Boolean(x&&u.length>0),groupsLoadMoreButton:Boolean(x&&C),loadMoreButton:Boolean(!S&&y),tableEmptyRow:Boolean(s&&!S&&T),extraGroupMarginBottom:Boolean(s&&S),addGroupButton:Boolean(V)}}),[a,t,r,i.collection_group_by,l,o,s])}const lp=function(e){let{store:t,collectionContextStore:o,groupFormat:n}=e;const r=(0,s().O7)(),i=(0,a().VK)((()=>sp(t)),[t]),{value:l}=(0,G().XJ)(oe().F.formulas);return(0,$.jsx)(ze().Z,{store:t,style:{width:"100%",height:rp().Z+1},canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:i?ap(i,r,t,o,n):void 0,onInsertAbove:i?cp(i,r,t,o,n):void 0,onSelectableDrop:e=>function(e,t,o,n,r,i){const{droppedDirection:l,droppedStores:s,duplicate:a}=e,c=sp(o);if(!c)return;const d=n.subitemTreeStore.state,u=(0,to().DY)(d.children,(e=>e.value.store===o)),p=ye().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");ye().default.DO_NOT_USE_measureAfterNextFlushLegacy(p,{environment:t,getData:()=>le().yr({collectionContextStore:n,is_native_drop:!1,is_empty:!1})});const m="collectionTypedView"===n.contextType;w().createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleDrop",environment:t,canUndo:!0,perform:e=>{Xe().by({environment:t,collectionStore:m?void 0:c,targetStore:o,droppedDirection:l,collectionContextStore:n,groupsPointer:r?[r]:[],droppedStores:s,duplicate:a,transaction:e,subitemPath:u,collapsedGroup:!1,formulasModule:i})}})}(e,r,t,o,n,l),onNativeDrop:e=>function(e,t,o,n,r,i){const{files:l,droppedDirection:s}=e,a=sp(r);if(!a)return;const c=o.collectionViewBlockStore(),d=ye().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");ye().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:t,getData:()=>le().yr({collectionContextStore:o,is_native_drop:!0,is_empty:!1})}),c&&w().createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleNativeDrop",environment:t,canUndo:!0,perform:e=>{Xe().tQ({environment:t,collectionStore:a,targetStore:c,droppedDirection:s,collectionContextStore:o,groupsPointer:n?[n]:[],files:l,transaction:e,formulasModule:i})}})}(e,r,o,n,t,l),onRemove:e=>function(e,t){const{transaction:o}=e,n=sp(t);if(!n)return;Xe().Od({store:t,transaction:o})}(e,t),analyticsName:"timeline"},t.id)};function sp(e){return e.getAssociatedCollectionStore()}function ap(e,t,o,n,r){return i=>{const{insertStores:l,transaction:s}=i,a="collectionTypedView"===n.contextType;return Xe().$T({environment:t,collectionStore:a?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!1,transaction:s})}}function cp(e,t,o,n,r){return i=>{const{insertStores:l,transaction:s}=i,a="collectionTypedView"===n.contextType;return Xe().$T({environment:t,collectionStore:a?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!0,transaction:s})}}function dp(e){let{store:t,groupFormat:o,collectionContextStore:r,canEdit:i,disabled:l,format:c}=e;const d=(0,s().O7)(),{value:u}=(0,G().XJ)(oe().F.formulas),[p]=(0,n.useState)((()=>new(W().G)(d,t.pointer))),m=(0,a().VK)((()=>r.groupsStore.getGroupState(o)),[r,o]),g=(0,a().Kw)(r.permissionScopesStore),h=(0,a().VK)((()=>r.collectionViewStore()),[r]),f=(0,a().VK)((()=>i&&g.canEditContent&&!g.isSyncedCollection&&d.device.isMobile&&!(null!=h&&h.isSyncedCollection())),[i,h,d,g]),y=(0,n.useMemo)((()=>{if(p)return(0,$.jsx)(ze().Z,{store:p,shouldShowDropZone:i,canDropBelow:i,canNativeDropBelow:i,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:e=>function(e,t,o,n,r){const{droppedDirection:i,droppedStores:l,duplicate:s}=e,a=o.collectionStore();if(!a)return;const c=o.groupsStore.getGroupState(t);if(!c)return;const d=o.collectionViewBlockStore(),u=ye().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");ye().default.DO_NOT_USE_measureAfterNextFlushLegacy(u,{environment:n,getData:()=>le().yr({collectionContextStore:o,is_native_drop:!1,is_empty:!0})}),d&&w().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:n,canUndo:!0,perform:e=>{Xe().by({environment:n,collectionStore:a,targetStore:d,droppedDirection:i,collectionContextStore:o,groupsPointer:c.groupsPointer,droppedStores:l,duplicate:s,transaction:e,collapsedGroup:!1,formulasModule:r})}})}(e,o,r,d,u),onNativeDrop:e=>function(e,t,o,n,r){const{files:i,droppedDirection:l}=e,s=t.collectionStore();if(!s)return;const a=t.collectionViewBlockStore(),c=ye().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");ye().default.DO_NOT_USE_measureAfterNextFlushLegacy(c,{environment:n,getData:()=>le().yr({collectionContextStore:t,is_native_drop:!0,is_empty:!0})}),a&&w().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:n,canUndo:!0,perform:e=>{Xe().tQ({environment:n,collectionStore:s,targetStore:a,droppedDirection:l,collectionContextStore:t,groupsPointer:o?[o]:[],files:i,transaction:e,formulasModule:r})}})}(e,r,o,d,u),analyticsName:"timeline",style:{width:"100%"}})}),[i,r,d,o,p,u]);return m?(0,$.jsxs)($.Fragment,{children:[y,(0,$.jsx)(xo,{collectionContextStore:r,groupsPointer:m.groupsPointer,format:c,canDrag:f,disableRequest:!0,resultProps:{groupFormat:o,collectionContextStore:r,isLast:!1,handleOpenPeekPage:S().ZT},canDrop:!0,resultComponent:lp,disabled:l,direction:yo.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:pp})]}):null}const up=n.memo(dp,Nt().Z);function pp(e){return(0,$.jsx)("div",{style:{width:"100%",height:rp().Z+1}})}const mp=n.memo((function(e){let{store:t,collectionContextStore:o,disabled:r,isFullScreen:i,isRootChild:l,paddingLeft:a,onGroupHeaderAddItem:c,format:d,groupsReducerResultStore:u,hiddenGroupsVisibleStore:p,canEditCollectionTimeline:m,showTable:g}=e;const S=(0,n.useMemo)((()=>({type:"dropzone",reducerResultStore:u,hiddenGroupsVisibleStore:p})),[u,p]),h=(0,n.useCallback)((()=>null),[]),f=function(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:c}=e;const d=(0,s().Fy)(),u=ip({collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:c});return(0,n.useCallback)((e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=u(e),o=(0,k().rM)({isMobile:d.isMobile})-1;let n=0,r=0;return t.groupHeader&&(n+=Ft().Zn+Ft().xd-1),t.tableHeaderRow&&(n+=Ft().pe),t.tableEmptyRow&&(n+=o),t.addItemRow&&(r+=rp().Z),t.loadMoreButton&&(r+=Ut().J),t.tableAggregationRow&&(r+=o-1),t.addItemRow||(r-=1),t.hiddenGroupsButton&&(r+=hi+fi+yi),t.groupsLoadMoreButton&&(r+=bi+2*Ci),t.addGroupButton&&(r+=hl+yl+fl),{paddingTop:n,paddingBottom:r}}),[d,u])}({collectionContextStore:o,isFullScreen:i,disabled:r,format:d,hiddenGroupsVisibleStore:p,showTable:g,canEditCollectionTimeline:m}),y=(0,n.useCallback)((e=>(0,$.jsx)(up,{store:t,groupFormat:e,collectionContextStore:o,canEdit:m,format:d,disabled:r&&m})),[o,t,d,r,m]);return d.collection_group_by?(0,$.jsx)(Zi,{reducerId:"timeline_groups",store:t,collectionContextStore:o,disabled:r,isFullScreen:i,isRootChild:l,paddingLeft:a,stickyLeft:!1,renderGroup:y,getGroupStyle:f,renderHeader:h,onGroupHeaderAddItem:c,timelineProps:S}):(0,$.jsx)("div",{style:f(void 0),children:y(void 0)})}));function gp(e){let{timelineState:t,...o}=e;const{collectionContextStore:n,isFullScreen:r,paddingLeft:i,isInPeekRenderer:l}=o,s=(0,a().Kw)(n.isInHomeWidgetStore),d=(0,a().VK)((()=>t.outerSizeObserver.rect.state.width),[t]),u=(0,c().yK)((e=>({outerDiv:{position:"sticky",left:0,width:d,height:Ft().Zn,zIndex:$e().sL},headerStyle:{width:"100%",height:"100%",paddingLeft:r?i:32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},stickyStyle:{...s?{}:{background:e.contentBackground,boxShadow:`0 -1px 0 ${e.tableDividerColor}`}}})),[r,s,d,i]);return(0,$.jsx)("div",{style:u.outerDiv,children:(0,$.jsx)(Fr,{...o,style:u.headerStyle,stickyStyle:u.stickyStyle,preventToggleBackground:l})})}const Sp=new(G().Ss)("TimelineItemDateRange",(async()=>await o.e(67197).then(o.bind(o,41384)))),hp=(0,G().kF)(Sp,(e=>e.TimelineItemDateRange));var fp=function(e){return e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined",e}(fp||{});function yp(e){let{store:t,type:r,timelineState:i,scrollerLeftOffset:l,paddingLeft:d,format:u,itemPositionStore:p,dateValueStore:m,isDraggingViaTimelineItemStore:g,collectionContextStore:S,isFullScreen:h,isInPeekRenderer:f,isRootChild:y}=e;const v=(0,s().O7)(),x=(0,n.useRef)(fp.NotDefined),C=(0,n.useRef)(null),w=(0,n.useRef)(null),[k,V]=(0,n.useState)(!1),T="left"===r?o(225808).Y:o(840628).n,j=(0,a().Kw)(i.outerSizeObserver.rect),R=(0,a().SI)((()=>{const e=p.state;if(e){const{left:t,right:o}=e;if(g.state)return fp.Hidden;const n=i.scrollLeft.state;if(void 0!==n){if("left"===r){const e=n+l;if(e-o>0)return fp.VisibleOutOfItem;if(e-t>0)return fp.VisibleInItem}else{const e=n+j.width;if(t-e>0)return fp.VisibleOutOfItem;if(o-e>0)return fp.VisibleInItem}return fp.Hidden}}return fp.NotDefined}),[g,p,j,l,i,r]),P=(0,c().yK)((e=>({arrow:{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:k?e.regularIconColor:e.mediumIconColor,borderRadius:4,border:`1px solid ${e.contentBackground}`,..."left"===r&&{marginLeft:8,marginRight:4},..."right"===r&&{marginRight:8,marginLeft:4}},icon:{height:6,fill:f?e.cardContentBackground:e.contentBackground},wrap:{position:"sticky",left:"left"===r?l:j.width-220,width:220,height:Bt().aF-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===r?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis"}})),[k,f,j,l,r]);(0,n.useLayoutEffect)((()=>{I()}),[]),(0,n.useEffect)((()=>(R.addListener(I),()=>{R.removeListener(I)})),[]),(0,n.useEffect)((()=>{R.enqueueRecompute()}));const I=(0,n.useCallback)((()=>{const e=C.current,t=w.current;if(e&&t){const o=R.state,n=o===fp.VisibleInItem||o===fp.VisibleOutOfItem;e.style.opacity=""+(n?1:0),e.style.transform=`scale(${n?1:.3})`,t.style.pointerEvents=o===fp.VisibleOutOfItem?"":"none";x.current!==fp.NotDefined&&o!==fp.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),x.current=o}}),[R]),_=(0,n.useCallback)((()=>{const e=m.state,o=i.zoomLevel.state,{snapUnit:n}=Ft().BJ[o],l=(0,Ft().x2)(o,200);if(e)if("left"===r){const{start:t}=(0,Ft().XO)(e,n),r=(0,Ft().GK)({timestamp:t.valueOf(),environment:v,timelineState:i,paddingLeft:d,format:u})-l;qd().Nf({timelineState:i,environment:v,zoomLevel:o,centerTimestamp:r})}else{const{end:t}=(0,Ft().XO)(e,n),r=(0,Ft().PF)({timestamp:t.valueOf(),timelineState:i})+l;qd().Nf({timelineState:i,environment:v,zoomLevel:o,centerTimestamp:r})}V(!1),b().Ys({environment:v,store:t}),(0,Yd().gw)(v,{...(0,Yd().Ii)({environment:v,collectionContextStore:S,timelineState:i,isFullScreen:h,isRootChild:y}),type:r})}),[S,m,v,u,h,y,d,t,i,r]),M=(0,n.useCallback)((()=>{v.device.isPhone||Re().Z.state||V(!0)}),[v]),B=(0,n.useCallback)((()=>{v.device.isPhone||V(!1)}),[v]);return(0,$.jsxs)("div",{style:P.wrap,onMouseOver:M,onMouseOut:B,onMouseDown:de().$0,onClick:_,ref:w,children:[(0,$.jsx)("div",{style:P.arrow,ref:C,children:T(P.icon)}),k&&(0,$.jsx)(xp,{dateValueStore:m,timelineState:i,isInPeekRenderer:f})]})}const vp=n.memo(yp,Nt().Z);function xp(e){let{dateValueStore:t,timelineState:o,isInPeekRenderer:n}=e;const r=(0,c().yK)((e=>({dateRange:{fontSize:12,paddingLeft:4,paddingRight:4,borderRadius:4,background:n?e.peekTimelineBackground:e.timelineBackground,pointerEvents:"none"}})),[n]),i=(0,a().Kw)(t),l=(0,a().Kw)(o.zoomLevel);return i?(0,$.jsx)("span",{style:r.dateRange,children:(0,Ft()._Q)(i,l)}):null}class bp extends d().default{getInitialState(){return null}}function Cp(e){let{store:t,timelineState:o,scrollerLeftOffset:i,paddingLeft:l,format:d,query:u,schema:p,blockPropertyValueOverlayStore:m,disabled:g,showProperties:S,collectionContextStore:h,isFullScreen:f,isRootChild:y,toggleButton:v,groupFormat:b,subitemPath:C,isInPeekRenderer:k,handleOpenPeekPage:V}=e;const T=(0,s().O7)(),{value:j}=(0,G().XJ)(oe().F.formulas),R=(0,n.useRef)(null),[P]=(0,n.useState)((()=>t.clone())),I=(0,n.useRef)(null),_=(0,a().VK)((()=>{const e=o.dateRangePlaceholder.state;if(e.active&&e.store===t&&!e.newTimelineItemProps&&(0,zt().ZH)(e.groupFormat,b))return e.date}),[b,t,o]),M=(0,a().SI)((()=>{const e=o.dragState.state;if(_)return _;if(e){const o=e.stores.indexOf(t);if(o>=0)return e.temporaryValues[o]}return wp(t,u,p,T,j)}),[T,_,u,p,t,o,j],{useDeepEqual:!0}),B=(0,a().Kw)(M),F=(0,a().VK)((()=>{const e=(0,to().ub)(C);if(!e||Boolean(B))return;const t=e.value.store,o=tu.findCollectionTimelineViewItems(t);if(o.length>0){return o[0].dateValueStore.state}}),[B,C]),K=(0,a().SI)((()=>(0,Ft().HZ)({timelineState:o,dateValue:B,placeholderDate:_,subitemPlaceholderDate:F})),[B,_,F,o]),O=(0,a().qz)(void 0,bp);(0,Cc().c)(tu,(()=>({getNode:()=>R.current,props:{store:t,groupFormat:b,schema:p},stores:{nodeStore:O},dateValueStore:M,itemPositionStore:K})),[t,R,M,b,p,K,O]);const L=(0,a().Kw)(K),D=(0,a().VK)((()=>{var e;return null===(e=h.groupsStore.getGroupState(b))||void 0===e?void 0:e.reducerResultStore}),[b,h]),E=Boolean(L&&!L.isPlaceholder),A=(0,a().SI)((()=>{const e=o.dragState.state,n=uo().default.state;return Boolean(e&&e.stores.includes(t)&&n.isDragging&&n.draggedStores.includes(t))}),[t,o]);(0,a().Kw)(A);const H=(0,a().VK)((()=>t.getAssociatedCollectionStore()),[t]),Z=(0,n.useCallback)((e=>{const n=o.dateRangePlaceholder.state,r=h.groupsStore.getGroupState(b);if(r)if(n.active){const{date:e}=n;w().createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:T,canUndo:!0,perform:o=>{qd().oP({environment:T,store:t,query:u,schema:p,date:e,transaction:o})}}),o.dateRangePlaceholder.setState({active:!1})}else{const{horizontalScroller:n}=o,i=o.scrollLeft.state,l=K.state,s=I.current;if(!n||void 0===i||!l||!s)return;const a=n.getBoundingClientRect(),c=i+(e.clientX-a.left),d=I.current;if(!d)return;const u=d.lastElementChild;if(!u)return;const p=i+(u.getBoundingClientRect().right-a.left);c>l.right&&c<=p&&(0,de().ZP)({event:e,context:de().Af.EditorClick,callback:()=>{(0,pe().X9)()||_o().CH({environment:T,store:t,openInNew:ce().DJ(e),peekMode:(0,X().kr)(h),resultsStore:r.resultsStore,collectionContextStore:h,pageVisitSource:Po().tY.PeekOpen})}})}}),[h,T,b,K,u,p,t,o]),z=(0,n.useCallback)((()=>{o.dateRangePlaceholder.setState({active:!1})}),[o]),W=(0,n.useCallback)((e=>{const{target:t}=e;!T.device.isMobile&&t instanceof HTMLElement&&(0,de().ZP)({event:e,context:de().Af.EditorMouseDown,callback:()=>{e.preventDefault(),x().AI({environment:T,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}),[T]),N=(0,n.useCallback)((e=>{const n=o.dragState.state,i=o.drawState.state,{horizontalScroller:l}=o,s=o.scrollLeft.state,a=o.zoomLevel.state,c=o.currentRange.state,{snapUnit:d,getDateRangePlaceholderDuration:m}=Ft().BJ[a];if(!i&&Re().Z.state||n||wp(t,u,p,T,j)||!l||void 0===s||g)return;const S=l.getBoundingClientRect(),h=s+(e.clientX-S.left),f=(0,Ft().x2)(a,h),y=r().ou.fromMillis(c.startTimestamp+f),v=(0,Ft().DS)(y,d),x=(0,Ft().DS)(m(y),d),C=(0,ms().hT)(v.valueOf(),(0,Yt().r)()),w=(0,Ft().AZ)({startValue:C,snapUnit:d,desiredStart:v,desiredEnd:x});o.dateRangePlaceholder.setState({active:!0,store:t,parentStore:H,groupFormat:b,date:w,newTimelineItemProps:void 0,existingTimelineItemProps:{query:u,schema:p}})}),[T,o,t,b,g,u,p,H,j]),U=(0,n.useCallback)((e=>{O.setState(e)}),[O]),q=(0,c().yK)((()=>({scrollArrows:{display:"flex",height:0,position:"relative",zIndex:$e().fQ},dateRange:{display:"flex",height:rp().Z+1,width:"100%",cursor:"default",isolation:"auto"}})),[]);if(!D)return null;const Y=Boolean(L);return(0,$.jsxs)($.Fragment,{children:[(0,$.jsxs)("div",{ref:R,style:q.scrollArrows,children:[E&&(0,$.jsx)(vp,{store:t,type:"left",timelineState:o,scrollerLeftOffset:i,itemPositionStore:K,dateValueStore:M,paddingLeft:l,format:d,isDraggingViaTimelineItemStore:A,collectionContextStore:h,isFullScreen:f,isInPeekRenderer:k,isRootChild:y}),E&&(0,$.jsx)(vp,{store:t,type:"right",timelineState:o,scrollerLeftOffset:i,itemPositionStore:K,dateValueStore:M,paddingLeft:l,format:d,isDraggingViaTimelineItemStore:A,collectionContextStore:h,isInPeekRenderer:k,isFullScreen:f,isRootChild:y})]}),(0,$.jsx)("div",{style:q.dateRange,onMouseDown:W,onMouseMove:N,onMouseLeave:z,onClick:Z,className:ie().o4s,ref:U,children:Y&&(0,$.jsx)(hp,{store:t,parentStore:H,toggleButton:v,clonedStore:P,itemPositionStore:K,dateValueStore:M,query:u,schema:p,timelineState:o,blockPropertyValueOverlayStore:m,disabled:g,showProperties:S,scrollerLeftOffset:i,isDraggingViaTimelineItemStore:A,collectionContextStore:h,isFullScreen:f,isInPeekRenderer:k,isRootChild:y,intl:nt().Z.getIntl(),propertiesWrapElementRef:I,resultStore:D,handleOpenPeekPage:V})})]})}function wp(e,t,o,n,r){return(0,Ft().bk)({store:e,query:t,schema:o,userId:n.currentUser.id,intl:nt().Z.getIntl(),formulasModule:r})}function kp(e){const{store:t,parentStore:o,timelineState:i,scrollerLeftOffset:l,query:d,schema:u,blockPropertyValueOverlayStore:p,disabled:m,showProperties:g,collectionContextStore:S,isFullScreen:h,isRootChild:f,toggleButton:y,groupFormat:v,canEditTimelineItems:b,subitemPath:C,paddingLeft:V,showTable:T}=e,j=(0,s().O7)(),[R,P]=(0,n.useState)(),I=(0,c().yK)((()=>({container:{display:"flex",height:(0,k().rM)({isMobile:j.device.isMobile})+1,width:"100%",cursor:"default",isolation:"auto"}})),[j.device]);(0,n.useEffect)((()=>{P(null==t?void 0:t.clone())}),[t]);const _=(0,a().VK)((()=>{var e;return null===(e=S.groupsStore.getGroupState(v))||void 0===e?void 0:e.reducerResultStore}),[S.groupsStore,v]),M=(0,a().VK)((()=>{const e=i.dateRangePlaceholder.state;if(e.active&&e.store===t&&e.newTimelineItemProps&&e.parentStore===o&&(0,zt().ZH)(e.groupFormat,v))return e.date}),[v,o,t,i.dateRangePlaceholder]),B=(0,a().VK)((()=>M),[M],{useDeepEqual:!0}),F=(0,a().VK)((()=>(0,Ft().HZ)({timelineState:i,dateValue:B,placeholderDate:M,subitemPlaceholderDate:void 0})),[B,M,i]),K=(0,a().VK)((()=>Boolean(F)),[F]),O=(0,a().VK)((()=>!S.isInHomeWidgetStore.state&&!t&&!K&&S.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[S,K,t]),L=(0,a().VK)((()=>S.isInPeekRendererStore.state),[S.isInPeekRendererStore]),D=(0,n.useMemo)((()=>new(Vu().default)((()=>F),{debugName:"itemPositionStore"})),[F]),E=(0,n.useMemo)((()=>new(Vu().default)((()=>B),{debugName:"dateValueStore"})),[B]),A=(0,n.useMemo)((()=>new(Vu().default)((()=>!1),{debugName:"isDraggingViaTimelineItemStore"})),[]);return _?(0,$.jsxs)("div",{style:I.container,onMouseDown:e=>function(e,t){const{target:o}=e;if(t.device.isMobile||!(o instanceof HTMLElement))return;(0,de().ZP)({event:e,context:de().Af.EditorMouseDown,callback:()=>{e.preventDefault(),x().AI({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,j),onMouseMove:e=>function(e,t,o,n,i,l,s,a,c,d,u,p){var m;const g=t.drawState.state,S=t.dragState.state,{horizontalScroller:h}=t,f=t.scrollLeft.state,y=t.zoomLevel.state,v=t.currentRange.state,{snapUnit:x,getDateRangePlaceholderDuration:b}=Ft().BJ[y];if(!g&&Re().Z.state||S||!h||void 0===f||i)return;const C=null===(m=d.groupsStore.getGroupState(n))||void 0===m?void 0:m.resultsStore;if(!C)return;const w=h.getBoundingClientRect(),k=f+(e.clientX-w.left),V=(0,Ft().x2)(y,k),T=r().ou.fromMillis(v.startTimestamp+V),j=(0,Ft().DS)(T,x),R=(0,Ft().DS)(b(T),x),P=(0,ms().hT)(j.valueOf(),(0,Yt().r)()),I=(0,Ft().AZ)({startValue:P,snapUnit:x,desiredStart:j,desiredEnd:R});t.dateRangePlaceholder.setState({active:!0,store:o,parentStore:u,groupFormat:n,date:I,newTimelineItemProps:{query:l,schema:s,resultsStore:C,isFullScreen:a,canEditTimelineItems:c,subitemPath:p},existingTimelineItemProps:void 0})}(e,i,t,v,m,d,u,h,b,S,o,C),onMouseLeave:()=>function(e){e.dateRangePlaceholder.setState({active:!1})}(i),onClick:e=>function(e,t,o,n,r,i,l,s,a,c,d,u){const p=r.dateRangePlaceholder.state;if(p.active){const{date:e}=p,m=u?u.length>0?"timeline_add_subitem_bottom":"timeline_add_parent_item_bottom":"timeline_add_item_bottom";if(!(0,Oe().ww)(t))return void(0,Oe().eD)(t);w().createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:t,canUndo:!0,perform:r=>{const p=qd().mg({environment:t,transaction:r,date:e,store:c,parentStore:d,query:o,schema:n,isFullScreen:i,groupFormat:l,canEditTimelineItems:s,collectionContextStore:a,subitemPath:u,from:m});io().W(t,{from:m,type:"page",new_page_id:null==p?void 0:p.id,creating_block_id:null==p?void 0:p.id,...(0,le().Pn)(a)})}}),r.dateRangePlaceholder.setState({active:!1})}}(0,j,d,u,i,h,v,b,S,t,o,C),className:ie().o4s,children:[K&&(0,$.jsx)(hp,{store:o?void 0:t,parentStore:o,toggleButton:y,clonedStore:R,itemPositionStore:D,dateValueStore:E,query:d,schema:u,timelineState:i,blockPropertyValueOverlayStore:p,disabled:m,showProperties:g,scrollerLeftOffset:l,isDraggingViaTimelineItemStore:A,collectionContextStore:S,isFullScreen:h,isInPeekRenderer:L,isRootChild:f,intl:nt().Z.getIntl(),resultStore:_,handleOpenPeekPage:Tp}),O&&(0,$.jsx)(Ip,{parentStore:o,collectionContextStore:S,paddingLeft:V,isFullScreen:h,showTable:T})]}):null}const Vp=n.memo(kp);function Tp(){}function jp(e){let{isMobile:t}=e;return{display:"flex",alignItems:"center",paddingBottom:2,fontSize:14,height:(0,k().rM)({isMobile:t}),lineHeight:Zt().Nv.UIRegular.desktop}}function Rp(e,t,o){return{position:"sticky",left:t&&!o?e+8:8,display:"flex",alignItems:"center"}}function Pp(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.mediumIconColor}}function Ip(e){let{parentStore:t,collectionContextStore:o,paddingLeft:n,isFullScreen:r,showTable:i}=e;const l=(0,c().Fg)(),{isMobile:d}=(0,s().Fy)(),u=(0,a().Kw)(o.currentSubitemFormatStoreForUiDisplayStore),p=(0,a().VK)((()=>{var e;return u&&t?null===(e=t.getSchema()[u.property])||void 0===e?void 0:e.name:""}),[u,t]);return(0,$.jsx)("div",{style:Rp(n,r,i),children:(0,$.jsxs)("div",{style:jp({isMobile:d}),children:[(0,Go().R)(Pp(l)),(0,$.jsx)("span",{style:{color:l.mediumTextColor},children:t&&p?(0,$.jsx)(qe()._H,{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",values:{propertyName:p}}):(0,$.jsx)(qe()._H,{defaultMessage:"New",id:"database.timelineView.item.addRowButton"})})]})})}function _p(e){const{store:t,parentStore:o,subitemPath:n,timelineState:r,disabled:i,query:l,format:s,schema:c,collectionContextStore:d,blockPropertyValueOverlayStore:u,isFullScreen:p,isRootChild:m,groupFormat:g,paddingLeft:S,showTimelineProperties:h,scrollerLeftOffset:f,showTable:y,canEditTimelineItems:v,isInPeekRenderer:x,isReady:b,canEdit:C}=e,w=(0,a().VK)((()=>d.groupsStore.getGroupState(g)),[d,g]),k=(0,a().Kw)(d.permissionScopesStore),V=(0,a().VK)((()=>"collectionTypedView"===d.contextType),[d]);return(0,a().Kw)(d.isInHomeWidgetStore)||!w||!b||!C&&!V||k.isSyncedCollection?null:(0,$.jsx)(Vp,{store:t,disabled:i||!k.canEditContent&&!V,timelineState:r,schema:c,query:l,format:s,scrollerLeftOffset:f,paddingLeft:S,showProperties:h,blockPropertyValueOverlayStore:u,collectionContextStore:d,isFullScreen:p,showTable:y,isRootChild:m,groupFormat:g,canEditTimelineItems:v,isInPeekRenderer:x,parentStore:o,subitemPath:n})}const Mp=function(e){const{collectionContextStore:t,schema:o,groupFormat:n,query:r,showTable:i,store:l,format:c,isFullScreen:d,paddingLeft:u,isInPeekRenderer:p,timelineState:m,blockPropertyValueOverlayStore:g,isRootChild:h,isReady:f,canEdit:y,disabled:v,scrollerLeftOffset:x}=e,b=(0,s().O7)(),C=(0,a().VK)((()=>{if(!r.timeline_by)return null;const e=t.groupsStore.getGroupState(n);if(!e)return null;const l=e.currentLimit.state,s=S().oA([n&&(0,qt().Ko)({schema:o,propertyMapping:void 0,groupBy:t.getGroupByAndGroupFormats().groupBy,group:n,timeZone:(0,Yt().r)(),experimentService:je().default}),!i&&{property:r.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:s.length>0?{operator:"and",filters:s}:void 0,limit:l}}),[t,o,n,r,i]),w=(0,a().VK)((()=>t.groupsStore.getGroupState(n)),[t,n]),k=n?[n]:[],V=(0,a().VK)((()=>null==w?void 0:w.reducerResultStore.state),[null==w?void 0:w.reducerResultStore]),T=(0,a().VK)((()=>X().VM({collectionContextStore:t,reducerResult:V,isFullScreen:d})),[t,V,d]),j=(0,a().VK)((()=>X().D2({query:r,schema:o})),[r,o]),R=(0,a().VK)((()=>(c.timeline_properties||[]).filter((e=>{let{visible:t}=e;return t})).map((e=>{let{property:t}=e;return t}))),[c]);return w?(0,$.jsxs)($.Fragment,{children:[C&&(0,$.jsx)(Xt().Z,{id:k.length>0?`results:${(0,zt().KW)(k)}`:"timeline_results",reducer:C,groupsPointer:k,collectionContextStore:t,resultStore:w.reducerResultStore}),(0,$.jsx)(Fp,{groupFormat:n,format:c,collectionContextStore:t,store:l,schema:o,query:r,isInPeekRenderer:p,timelineState:m,blockPropertyValueOverlayStore:g,showTimelineProperties:R,paddingLeft:u,isFullScreen:d,isRootChild:h,isReady:f,canEdit:y,canEditTimelineItems:j,disabled:v,showTable:i,scrollerLeftOffset:x}),T&&(0,$.jsx)("div",{style:{width:"100%"},children:i?(0,$.jsx)("div",{style:{height:Ut().J}}):(0,$.jsx)(Ut().ZP,{style:{position:"sticky",left:d?u:3,width:"max-content",height:Ut().J},groupsPointer:k,store:l,collectionContextStore:t,format:c,isFullScreen:d,incrementLimitsInRelatedGroups:!1})}),(0,$.jsx)(_p,{...e,store:void 0,indentLevel:0,handleOpenPeekPage:()=>Bp(t,n,b),canEditTimelineItems:j,showTimelineProperties:R})]}):null};function Bp(e,t,o){const n=e.groupsStore.getGroupState(t);if(!n)return;ye().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag");const r=e.collectionViewStore();v().Xd({collectionContextStore:e,resultsStore:n.resultsStore});const i=null==r?void 0:r.getFormat().collection_peek_mode,l=i||ao().Ls.timeline;lo().hy(o,{is_peek:!0,from:"timeline",peek_mode:l})}function Fp(e){const t=(0,s().O7)(),{groupFormat:o,format:n,collectionContextStore:r,disabled:i,query:l,schema:c,blockPropertyValueOverlayStore:d,isFullScreen:u,isRootChild:p,showTable:m,canEditTimelineItems:g,scrollerLeftOffset:S,timelineState:h,paddingLeft:f,showTimelineProperties:y,isInPeekRenderer:v}=e,x=(0,a().VK)((()=>{const e=r.permissionScopesStore.state;return{disabled:i||!("collectionTypedView"===r.contextType||e.canEditContent),timelineState:h,schema:c,query:l,format:n,scrollerLeftOffset:S,paddingLeft:f,showProperties:y,blockPropertyValueOverlayStore:d,collectionContextStore:r,isFullScreen:u,showTable:m,isRootChild:p,groupFormat:o,canEditTimelineItems:g,isInPeekRenderer:v,handleOpenPeekPage:()=>Bp(r,o,t),isLast:!1}}),[r,o,n,t,i,l,c,d,u,p,m,g,S,h,f,y,v]),b=(0,a().VK)((()=>r.groupsStore.getGroupState(o)),[r,o]);return b?(0,$.jsx)(xo,{disableSelectable:!0,collectionContextStore:r,groupsPointer:b.groupsPointer,format:n,canDrag:!1,disableRequest:!0,resultProps:x,canDrop:!1,resultComponent:Cp,disabled:!0,direction:yo.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:o=>function(e,t,o){return(0,$.jsx)(_p,{...o,store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:()=>Bp(o.collectionContextStore,o.groupFormat,t),canEditTimelineItems:o.canEditTimelineItems,showTimelineProperties:o.showTimelineProperties})}(o,t,e)}):null}const Kp=n.memo((function(e){let{store:t,collectionContextStore:o,timelineState:r,disabled:i,isFullScreen:l,isInPeekRenderer:d,paddingLeft:u,isRootChild:p,format:m,schema:g,query:S,showTable:h,groupsReducerResultStore:f,hiddenGroupsVisibleStore:y,canEditCollectionTimeline:v,isReady:x,blockPropertyValueOverlayStore:b,tableStore:C,scrollerLeftOffset:w,onGroupHeaderAddItem:V}=e;const T=(0,n.useMemo)((()=>({type:"item",reducerResultStore:f,hiddenGroupsVisibleStore:y})),[f,y]),j=(0,n.useCallback)((e=>{if(!h)return(0,$.jsx)(gp,{timelineState:r,...e})}),[h,r]),R=(0,a().VK)((()=>(0,k().zp)(m,C)),[m,C]),P=(0,n.useCallback)((e=>(0,$.jsx)(Mp,{store:t,groupFormat:e,schema:g,query:S,isInPeekRenderer:d,timelineState:r,collectionContextStore:o,blockPropertyValueOverlayStore:b,paddingLeft:u,format:R,isFullScreen:l,isRootChild:p,isReady:x,canEdit:v,disabled:i,showTable:h,scrollerLeftOffset:w})),[b,v,o,R,i,l,d,x,p,u,S,g,w,h,t,r]),I=function(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:d}=e;const u=(0,s().Fy)(),p=(0,c().Fg)(),m=ip({collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:d});return(0,n.useCallback)((e=>{const t=m(e),o=(0,k().rM)({isMobile:u.isMobile});let n=0,r=0;return t.groupHeader&&a&&(n+=Ft().Zn+Ft().xd),t.tableHeaderRow&&(n+=Ft().pe-1),t.tableAggregationRow&&(r+=o),t.addItemRow||(r+=1),t.tableEmptyRow&&(r+=o),t.hiddenGroupsButton&&a&&(r+=hi+fi+yi),t.groupsLoadMoreButton&&a&&(r+=bi+2*Ci),t.addGroupButton&&a&&(r+=hl+yl+fl),{paddingTop:n,paddingBottom:r,minHeight:Ft().Zn,boxShadow:e.index>0&&(!a||t.tableHeaderRow)?`inset 0 -1px 0 ${p.tableDividerColor}`:void 0}}),[u,m,a,p])}({collectionContextStore:o,isFullScreen:l,disabled:i,format:m,hiddenGroupsVisibleStore:y,showTable:h,canEditCollectionTimeline:v});return m.collection_group_by?(0,$.jsx)(Mr().F,{children:(0,$.jsx)(Zi,{reducerId:"timeline_groups",store:t,collectionContextStore:o,disabled:i,isFullScreen:l,isRootChild:p,paddingLeft:u,stickyLeft:!1,renderGroup:P,getGroupStyle:I,renderHeader:j,onGroupHeaderAddItem:V,timelineProps:T})}):P()}));const Op=function(e){let{isGrouped:t,format:n,collectionContextStore:r,isFullScreen:i,isRootChild:l,timelineState:a}=e;const d=(0,c().Fg)(),u=(0,s().O7)(),{device:p}=u;return(0,$.jsx)(gt().Z,{render:e=>(0,$.jsx)(zo().Z,{isSmall:!0,onClick:()=>function(e,t,o,n,r,i){const l=o.collectionViewStore();if(!l)return;w().createAndCommit({userAction:"CollectionTimelineViewHideTableButton.handleHideTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,Ft().YP)(t,!1);Xo().FH({stores:[l],update:o,transaction:e})}}),(0,Yd().CB)(e,{...(0,Yd().Ii)({environment:e,collectionContextStore:o,timelineState:i,isFullScreen:n,isRootChild:r}),show:!1})}(u,n,r,i,l,a),style:{position:"absolute",top:t?p.isIOS?3:4:p.isIOS?7:8,right:t?6:8,zIndex:$e().MC,fill:d.lightIconColor},...e,children:(0,o(52446).D)({width:14})}),renderTooltip:()=>(0,$.jsx)(qe()._H,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})};function Lp(){const e=(0,c().yK)((e=>({rowContainer:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0",borderBottom:`1px solid ${e.regularDividerColor}`},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,$.jsx)("div",{style:e.rowContainer,children:(0,$.jsx)(zn().Z,{style:e.rowShimmer})})}const Dp=function(e){let{showTablePropertyFormatsStore:t,groupFormat:o,isFullScreen:r,collectionContextStore:i,blockPropertyValueOverlayStore:l,isReady:s,store:c,disabled:d,format:u,schema:p,isInPeekRenderer:m,query:g,showHoverActionsStore:S,paddingBottom:h,tableStore:f,timelineState:y,isRootChild:v,canEdit:x,paddingLeft:b,paddingRight:C}=e;const w=(0,a().VK)((()=>t.state.findIndex((e=>"title"===e.property))),[t]),k=(0,n.useMemo)((()=>o?[o]:[]),[o]),V=(0,a().VK)((()=>i.groupsStore.getGroupState(k)),[i,k]),T=(0,a().VK)((()=>null==V?void 0:V.reducerResultStore.state),[V]),j=(0,a().VK)((()=>(0,X().VM)({collectionContextStore:i,reducerResult:T,isFullScreen:r})),[i,T,r]),R=(0,a().Kw)(i.shouldShowSpinnerStore),P=(0,a().Kw)(i.permissionScopesStore),I=(0,a().Kw)(t),_=(0,a().Kw)(i.isInHomeWidgetStore),M=(0,a().VK)((()=>function(e,t,o){const n=e.permissionScopesStore.state,r="collectionTypedView"===e.contextType;return Boolean(!e.isInHomeWidgetStore.state&&t&&(o||r)&&!n.isSyncedCollection)}(i,s,x)),[i,s,x]);if(!V)return null;const B=s&&0===(null==T?void 0:T.blockIds.length)&&!R;return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(Hp,{store:c,format:u,schema:p,query:g,collectionContextStore:i,disabled:d,paddingBottom:h,isInPeekRenderer:m,blockPropertyValueOverlayStore:l,tableStore:f,showTablePropertyFormats:I,timelineState:y,isFullScreen:r,isRootChild:v,groupFormat:o,isInHomeWidget:_,paddingLeft:b,paddingRight:C}),B&&(0,$.jsx)(Wp,{collectionContextStore:i,isFullScreen:r,groupFormat:o,blockPropertyValueOverlayStore:l,canEdit:x}),(0,$.jsx)(Yp,{store:c,schema:p,query:g,collectionContextStore:i,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:t,canEdit:x,format:u,tableStore:f,paddingLeft:b,disabled:d,groupFormat:o,titleColumnIndex:w,groupsPointer:k}),R&&(0,$.jsx)(Lp,{}),j&&(0,$.jsx)(Up,{collectionContextStore:i,format:u,canEdit:x,groupFormat:o,isFullScreen:r,groupsPointer:k}),M&&(0,$.jsx)(Np,{collectionContextStore:i,isFullScreen:r,groupFormat:o,blockPropertyValueOverlayStore:l,isInPeekRenderer:m}),(0,$.jsx)(rc,{groupFormat:o,style:Ap(s,o,r,b),disabled:d||!P.canConfigureBlock,schema:p,query:g,collectionContextStore:i,isInPeekRenderer:m,isFullScreen:r,showPropertyFormats:I,showRightActionsSpacer:!1,paddingLeft:b,paddingRight:C,disableSticky:!0})]})};function Ep(){}function Ap(e,t,o,n){return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",left:n},...o&&!t&&{left:n}}}function Hp(e){let{groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,disabled:s,paddingBottom:c,isInPeekRenderer:d,blockPropertyValueOverlayStore:u,tableStore:p,showTablePropertyFormats:m,timelineState:g,isFullScreen:S,isRootChild:h,isInHomeWidget:f,paddingLeft:y,paddingRight:v}=e;const x=(0,a().VK)((()=>l.groupsStore.getGroupState(t)),[l,t]),b=(0,a().Kw)(l.permissionScopesStore),C=(0,a().VK)((()=>l.viewIsFlushToTopbar()),[l]);if(!x)return null;const w=Boolean(t);return(0,$.jsx)(Jc,{store:o,format:n,schema:r,query:i,collectionContextStore:l,isInPeekRenderer:d,minWidth:void 0,paddingBottom:c,blockPropertyValueOverlayStore:u,showPropertyFormats:m,showRightActions:!1,allowHidingTitle:!0,tableStore:p,formatKey:"timeline_table_properties",disabled:s||!b.canConfigureBlock,disableHorizontalEdgeScroll:!0,height:(0,Ft().vX)(w),paddingTop:w?0:Ft().Ne-Ft().pe,disableTopBorder:!C||w,disableCellRightBorder:!0,groupFormat:t,isInHomeWidget:f,hasMoreReducerResults:!1,paddingLeft:y,paddingRight:v,children:!w&&b.canConfigureBlock&&(0,$.jsx)(Op,{isGrouped:!1,format:n,collectionContextStore:l,timelineState:g,isFullScreen:S,isRootChild:h})})}function Zp(e,t,o){return{display:"flex",alignItems:"center",height:(0,k().rM)({isMobile:o}),width:"100%",paddingLeft:8,fontSize:14,lineHeight:Zt().Nv.UIRegular.desktop,background:e?t.cardContentBackground:t.contentBackground}}function zp(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor}}function Gp(e,t,o,n,r,i){const{device:l}=e,s=n?[n]:[],a=t.groupsStore.getGroupState(s);if(!(0,Oe().ww)(e)||!a)return;t.searchQueryStore.state&&V().Ug({searchQuery:"",collectionContextStore:t,isFullScreen:o});const c=t.currentSubitemFormatStoreForCollectionStore.state;w().createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:e,canUndo:!0,perform:o=>{const s=Xe().IW({environment:e,collectionContextStore:t,groupsPointer:n?[n]:[],shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:o,from:{createBlock:"timeline_table_group_results"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(s){if(l.isMobile){!function(e,t,o){o?o(e):Jo().c4({environment:t,url:e})}((0,ln().ZP)({store:s.newStore,fullyQualified:!1,pageVisitSource:Po().tY.Create}),e,i)}else if(s.coercionSucceeded){const o=()=>{so().bA({environment:e,blockPropertyValueOverlayStore:r,store:s.newStore,property:"title",format:dt().C.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(s.newStore,o)}else{const o=n?[n]:[],r=t.groupsStore.getGroupState(o);_o().CH({environment:e,store:s.newStore,peekMode:(0,X().kr)(t),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t,pageVisitSource:Po().tY.Create})}io().W(e,{from:c?"timeline_add_parent_item_bottom":"timeline_add_item_bottom",type:"page",new_page_id:s.newStore.id,creating_block_id:s.newStore.id,...(0,le().Pn)(t)})}}})}function Wp(e){let{collectionContextStore:t,isFullScreen:o,groupFormat:r,blockPropertyValueOverlayStore:i,canEdit:l}=e;const a=(0,c().Fg)(),d=(0,s().O7)(),u=(0,n.useContext)(Ln().Z),p=(0,n.useCallback)((()=>Gp(d,t,o,r,i,u)),[d,t,o,r,i,u]);return(0,$.jsx)(pt().Z,{onClick:p,onMouseDown:de().$0,disabled:!l,style:{display:"flex",alignItems:"center",height:(0,k().rM)({isMobile:d.device.isMobile}),width:"100%",paddingLeft:8,fontSize:14,lineHeight:Zt().Nv.UIRegular.desktop,background:a.contentBackground,left:0,right:0,borderBottom:`1px solid ${a.tableDividerColor}`},children:l?(0,$.jsx)("span",{style:{color:a.lightTextColor},children:(0,$.jsx)(qe()._H,{defaultMessage:"Empty. Click to add a row.",id:"database.timelineView.emptyTablePlaceholder"})}):(0,$.jsx)("span",{style:{color:a.lightTextColor},children:(0,$.jsx)(qe()._H,{defaultMessage:"Empty.",id:"database.timelineView.cannotEdit.emptyTablePlaceholder"})})})}function Np(e){let{collectionContextStore:t,isFullScreen:o,groupFormat:r,blockPropertyValueOverlayStore:i,isInPeekRenderer:l}=e;const a=(0,c().Fg)(),d=(0,s().O7)(),u=(0,n.useContext)(Ln().Z),p=(0,n.useCallback)((()=>Gp(d,t,o,r,i,u)),[d,t,o,r,i,u]);return(0,$.jsxs)(pt().Z,{onClick:p,style:Zp(l,a,d.device.isMobile),className:ie().tfM,onMouseDown:de().$0,children:[(0,Go().R)(zp(a)),(0,$.jsx)("span",{style:{color:a.lightTextColor},children:(0,$.jsx)(qe()._H,{defaultMessage:"New",id:"database.timelineView.addRowButton"})})]})}function Up(e){let{groupsPointer:t,collectionContextStore:o,format:n,canEdit:r,groupFormat:i,isFullScreen:l}=e;const d=(0,c().Fg)(),u=(0,s().O7)(),p=(0,a().VK)((()=>o.groupsStore.getGroupState(t)),[o,t]),m=(0,a().VK)((()=>(0,Ro().$t)({collectionContextStore:o,groupsPointer:t})),[o,t]);return p?(0,$.jsxs)(pt().Z,{onMouseDown:de().$0,onClick:e=>function(e,t,o,n,r){const i=t.groupsStore.getGroupState(o);if(!i)return;const l=i.reducerResultStore.state;(0,de().Wi)(e),b().ZH({environment:r}),l&&Xe().ID({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:n,currentResultCount:l.blockIds.length,groupsPointer:i.groupsPointer,incrementLimitsInRelatedGroups:!1}}),j().uD(r)}(e,o,i,l,u),disabled:m,hoveredStyle:m?{background:d.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:Ut().J,width:"100%",paddingLeft:8,paddingBottom:2,fontSize:14,lineHeight:Zt().Nv.UIRegular.desktop,boxShadow:`0 -1px 0 ${d.tableDividerColor}`,borderBottom:`1px solid ${d.tableDividerColor}`,whiteSpace:"break-spaces"},children:[(0,no().M)(zp(d)),(0,$.jsx)("span",{style:{color:d.lightTextColor,flexGrow:1},children:(0,$.jsx)(qe()._H,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),m?(0,$.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,$.jsx)(Zo().Z,{style:{width:12,height:12}})}):r&&(0,$.jsx)(qa().Z,{collectionContextStore:o,format:n})]}):null}function $p(e){const t=(0,s().O7)(),{isMobile:o}=(0,s().Fy)(),{store:n,parentStore:r,subitemPath:i,indentLevel:l,groupsPointer:a,collectionContextStore:c,disabled:d,blockPropertyValueOverlayStore:u}=e;return r?(0,$.jsx)(Ba,{store:n,collectionStore:r,subitemPath:i,indentLevel:l,collectionContextStore:c,disabled:d,groupsPointer:a,onSubitemCreate:e=>function(e,t,o,n){if(o){const r=()=>{so().bA({isNewBlock:!0,environment:n,blockPropertyValueOverlayStore:o,store:e,property:"title",format:dt().C.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(e,r)}}(e,c,u,t),styles:{height:(0,k().rM)({isMobile:o})+1}}):null}function qp(e){let{args:t,schema:o,disabled:n,collectionContextStore:r,blockPropertyValueOverlayStore:i,showTablePropertyFormatsStore:l,canEdit:d,format:u,groupFormat:p,titleColumnIndex:m}=e;(0,c().Fg)();const g=(0,s().Fy)(),S=(0,a().VK)((()=>r.collectionViewStore()),[r]),{groupsPointer:h}=t,f=(0,a().VK)((()=>r.groupsStore.getGroupState(h)),[r,h]),y=(0,a().Kw)(l),v=(0,a().VK)((()=>!d&&g.isMobile&&!(null!=S&&S.isSyncedCollection())),[d,g,S]),x=(0,a().Kw)(r.isInHomeWidgetStore);if(!S||!f)return null;return(0,$.jsx)(xo,{collectionContextStore:r,groupsPointer:h,disableRequest:!0,format:u,canDrag:v,resultProps:{schema:o,collectionContextStore:r,propertyFormats:y,onPropertyTab:t.onPropertyTab,onPropertyUntab:t.onPropertyUntab,onPropertyEnter:t.onPropertyEnter,onPropertyClick:t.onPropertyClick,onPropertyEsc:t.onPropertyEsc,onPropertyBgClick:t.onPropertyBgClick,onPropertyContextMenu:t.onPropertyContextMenu,onOpenProperty:t.onOpenProperty,disabled:n,blockPropertyValueOverlayStore:i,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableTableWrap:!0,disableCellBorderRight:!1,disableLastCellBorderRight:!0,onShiftEnter:Ep,titleColumnIndex:m,groupFormat:p,shouldShowMultiSelectCheckbox:!1,isInHomeWidget:x},resultComponent:ud,canDrop:!1,disabled:n,direction:yo.Vertical,getItemSelectableStyle:()=>({display:"flex",width:"fit-content",height:33}),shouldShowHoverMenu:!0,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:t.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:i,titleColumnIndex:m,nestedCreateSubitemButton:e=>{let{store:t,parentStore:o,subitemPath:l,indentLevel:s}=e;return(0,$.jsx)($p,{collectionContextStore:r,disabled:n,blockPropertyValueOverlayStore:i,store:t,parentStore:o,subitemPath:l,indentLevel:s,groupsPointer:h})}})}function Yp(e){let{groupFormat:t,groupsPointer:o,store:r,schema:i,query:l,collectionContextStore:s,blockPropertyValueOverlayStore:c,showTablePropertyFormatsStore:d,canEdit:u,format:p,tableStore:m,paddingLeft:g,disabled:S,titleColumnIndex:h}=e;const f=(0,a().VK)((()=>s.collectionViewStore()),[s]),y=(0,a().VK)((()=>s.groupsStore.getGroupState(t)),[s,t]),v=(0,a().Kw)(d),x=(0,n.useCallback)((e=>(0,$.jsx)(qp,{schema:i,disabled:S,collectionContextStore:s,blockPropertyValueOverlayStore:c,showTablePropertyFormatsStore:d,canEdit:u,format:p,groupFormat:t,titleColumnIndex:h,args:{...e,groupsPointer:o}})),[i,S,s,c,d,u,p,t,h,o]);return f&&y?(0,$.jsx)(Ad,{store:r,collectionContextStore:s,minWidth:void 0,blockPropertyValueOverlayStore:c,showPropertyFormats:v,disabled:!u,disableHorizontalEdgeScroll:!0,groupFormat:t,render:x,tableStore:m,paddingLeft:g}):null}const Qp=n.memo((function(e){let{store:t,tableStore:r,collectionContextStore:i,timelineState:l,format:s,schema:d,query:u,isFullScreen:p,groupBy:m,paddingLeft:g,paddingRight:S,paddingBottom:h,scrollerLeftOffset:f,isInPeekRenderer:y,isInHomeWidget:v,computedOuterHeight:x,showHoverActionsStore:b,blockPropertyValueOverlayStore:C,isRootChild:w,isReady:V,disabled:T,canEditCollectionTimeline:j,viewIsFlushToTopbar:R,groupsReducerResultStore:P,hiddenGroupsVisibleStore:I,onGroupHeaderAddItem:_}=e;const M=n.useRef(null),B=(0,a().SI)((()=>{const e=(0,k().zp)(s,r);return(e&&e.timeline_table_properties?e.timeline_table_properties:[]).filter((e=>e.visible))}),[s,r],{useDeepEqual:!0});(0,a().Kw)(B);const F=(0,a().VK)((()=>B.state.reduce(((e,t)=>e+(t.width||0)),0)),[B]),K=(0,c().yK)((e=>({selectable:{whiteSpace:"nowrap",...v?{}:{background:y?e.cardContentBackground:e.contentBackground},paddingLeft:g,boxSizing:"border-box",borderRight:`1px solid ${e.tableDividerColor}`,boxShadow:e.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:F+g,height:v?"100%":x},tableGroupHeaderSticky:{borderRight:`1px solid ${e.tableDividerColor}`,"--timeline-box-shadow":"0px"},tableGroupHeaderTransition:{borderRight:void 0},tableGroupHeader:{boxShadow:`inset 0 var(--timeline-box-shadow, 1px) 0 ${e.tableDividerColor}`}})),[F,g,v,y,x]),O=(0,a().VK)((()=>(0,k().zp)(s,r)),[s,r]),L=(0,n.useCallback)((e=>(0,$.jsx)(Dp,{store:t,groupFormat:e,schema:d,query:u,isInPeekRenderer:y,timelineState:l,collectionContextStore:i,blockPropertyValueOverlayStore:C,showTablePropertyFormatsStore:B,showHoverActionsStore:b,tableStore:r,paddingLeft:g,paddingRight:S,paddingBottom:h,format:O,isFullScreen:p,isRootChild:w,isReady:V,canEdit:j,disabled:T&&j})),[C,j,i,T,O,p,y,V,w,h,g,S,u,d,b,B,t,r,l]),D=(0,n.useCallback)((e=>{const t=i.permissionScopesStore.state;return(0,$.jsx)(Fr,{...e,height:Ft().Zn,paddingTop:Ft().xd,stickyStyle:K.tableGroupHeaderSticky,transitionStickyStyle:K.tableGroupHeaderTransition,style:0!==e.index||R?K.tableGroupHeader:{},stickyWrapStyle:{marginBottom:Ft().xd},children:0===e.index&&t.canConfigureBlock&&(0,$.jsx)(Op,{isGrouped:!0,format:s,collectionContextStore:i,timelineState:l,isFullScreen:p,isRootChild:w})})}),[i,s,p,w,K.tableGroupHeader,K.tableGroupHeaderSticky,K.tableGroupHeaderTransition,l,R]),E=(0,n.useCallback)((()=>({})),[]),A=(0,n.useCallback)((()=>(0,$.jsx)(Zi,{reducerId:"timeline_groups",store:t,collectionContextStore:i,disabled:T,isFullScreen:p,isRootChild:w,paddingLeft:g,stickyLeft:!1,renderGroup:L,getGroupStyle:E,renderHeader:D,onGroupHeaderAddItem:_,timelineProps:{type:"table",reducerResultStore:P,hiddenGroupsVisibleStore:I}})),[i,T,E,P,I,p,w,_,g,D,L,t]);return(0,$.jsx)("div",{style:{position:"sticky",left:0,height:0,width:F,zIndex:$e().eU},children:(0,$.jsx)(ze().Z,{style:K.selectable,store:t,shouldShowHalo:!1,canSelect:!p,analyticsName:"timeline",children:(0,$.jsx)(o(854021).i,{name:"timeline-side-table",stickyHorizontally:!0,horizontalWidthLimiter:f,children:m?A():(0,$.jsx)(zr().Q,{nodeRef:M,children:(0,$.jsx)("div",{ref:M,children:L(void 0)})})})})})})),Xp=Qp,Jp=n.memo(n.forwardRef((function(e,t){let{store:r,collectionContextStore:i,query:l,schema:d,format:u,paddingLeft:p,paddingRight:m,isFullScreen:g,isPreviewing:S,isRootChild:h,disabled:f,isInPeekRenderer:y,paddingBottom:v,showHoverActionsStore:x,blockPropertyValueOverlayStore:b}=e;const C=function(e){let{isFullScreen:t,isRootChild:o}=e;const[r]=(0,n.useState)((()=>(0,Ft().Gz)({isFullScreen:t,isRootChild:o})));return r}({isFullScreen:g,isRootChild:h}),k=(0,s().O7)(),T=(0,s().Fy)();(0,Yo().K)((()=>{const e=i.collectionViewStore();e&&qd().j2({timelineState:C,environment:k,collectionViewStore:e,collectionContextStore:i}),(0,Yd().iR)(k,(0,Yd().Ii)({environment:k,collectionContextStore:i,timelineState:C,isFullScreen:g,isRootChild:h}))})),function(e){let{collectionContextStore:t,query:o,schema:r,environment:i}=e;(0,n.useEffect)((()=>{const e=t.collectionStore();if(e&&!o.timeline_by&&e.isDefined()){const e=t.permissionScopesStore.state,o=t.collectionStore();if(!o||!o.isDefined())return;const n=t.collectionViewStore();if(!n||!e.canConfigureBlock)return;const l=(0,qe().vU)({date:{id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}});w().createAndCommit({userAction:"CollectionTimelineView.updateOrCreateTimelineProperty",environment:i,canUndo:!0,perform:t=>{let s,a=X().HI(r);if(!a&&e.canConfigureCollection){a=(0,_l().ZP)();s={[a]:{name:nt().Z.formatMessage(l.date),type:"date"}}}a&&(V().Es({collectionViewStore:n,update:{timeline_by:a},transaction:t}),wn().sW({store:n,data:{type:"timeline"},transaction:t}),s&&V().xO({environment:i,collectionStore:o,update:s,transaction:t}))}})}}),[o,t,r,i])}({collectionContextStore:i,query:l,schema:d,environment:k}),function(e){(0,n.useEffect)((()=>{const t=()=>{Re().Z.state&&e.hoveredItem.setState(void 0)};return Re().Z.addListener(t),()=>{Re().Z.removeListener(t)}}),[e])}(C),function(e){let{environment:t,collectionContextStore:o,timelineState:r,isFullScreen:i,isRootChild:l}=e;(0,n.useEffect)((()=>{const e=r.drawState.state;if(null!=e&&e.tryToCompleteDrawnArrow){(0,Ft().H5)(o)&&w().createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:t,canUndo:!0,perform:e=>{qd().$o({timelineState:r,environment:t,transaction:e,collectionContextStore:o,isFullScreen:i,isRootChild:l})}})}}))}({environment:k,collectionContextStore:i,timelineState:C,isFullScreen:g,isRootChild:h}),(0,ps().L)((()=>{C.destroyed=!0,C.outerSizeObserver.destroy(),C.timelineSizeObserver.destroy(),C.horizontalScroller&&(C.horizontalScroller.scrollLeft=0,(0,ce().ZV)(C.horizontalScroller,"scroll",M))}));const j=(0,a().qz)(void 0,Wa),R=(0,a().qz)(void 0,Xd),P=(0,a().qz)(void 0,Qd),I=(0,n.useCallback)((()=>{const{horizontalScroller:e,outerSizeObserver:t}=C;if(!e)return;const o=C.zoomLevel.state,{startTimestamp:n,endTimestamp:r}=C.currentRange.state,i=e.scrollLeft,l=t.rect.state.width,s=(0,Ft().e$)(o,r-n),a=(0,Ft().al)(C);if(i<Ft().lx){const e=-(0,Ft().x2)(o,Ft().Ge);C.currentRange.setState({startTimestamp:n+e,endTimestamp:r+e}),qd().Nf({timelineState:C,environment:k,zoomLevel:o,centerTimestamp:a})}else if(i+l>s-Ft().lx){const e=(0,Ft().x2)(o,Ft().Ge);C.currentRange.setState({startTimestamp:n+e,endTimestamp:r+e}),qd().Nf({timelineState:C,environment:k,zoomLevel:o,centerTimestamp:a})}}),[C,k]),_=(0,qo().v)(I,200),M=(0,n.useCallback)((()=>{const{horizontalScroller:e,savePreference:t}=C;if(!e)return;const o=e.scrollLeft,n=C.scrollLeft.state;k.device.isIOS&&void 0!==n&&0===o&&n>Ft().lx?e.scrollLeft=n:(t&&t(),C.scrollLeft.setState(o),(0,Ft().rr)(k)?_():I())}),[C,k,_,I]),B=(0,n.useCallback)((()=>{const{startTimestamp:e,endTimestamp:t}=C.currentRange.state;qd().KA({timelineState:C,centerTimestamp:(e+t)/2})}),[C]),F=(0,n.useRef)(null),K=(0,n.useCallback)((e=>{if(e){F.current=e;const{outerSizeObserver:t}=C;t.observe(e);const o=(0,Se().xH)(e);o&&(C.horizontalScroller=o,(0,ce().lj)(o,"scroll",M),B())}}),[M,B,C]),O=(0,a().VK)((()=>i.viewIsFlushToTopbar()),[i]),L=(0,n.useRef)(null),D=(0,a().VK)((()=>{const e=C.zoomLevel.state,{startTimestamp:t,endTimestamp:o}=C.currentRange.state;return(0,Ft().e$)(e,o-t)}),[C]),E=(0,a().VK)((()=>(0,Ft().fj)({environment:k,isRootChild:h,isFullScreen:g,format:u})?Ft().Qw:p),[h,g,u,p,k]),A=(0,a().VK)((()=>(0,Ft().xI)({environment:k,paddingLeft:E,format:u,isFullScreen:g,isRootChild:h})),[k,u,g,h,E]);(0,Cc().c)(o(984933).Z,(()=>({getNode:()=>L.current,customizeEdgeScrollRect(e){const t=A;return Ss().iL.from({top:e.top,height:e.height,left:e.left+t,width:e.width-t})}})),[A]),(0,n.useImperativeHandle)(t,(()=>({addBlockToView(e){let{store:t,transaction:o}=e;const n=t.getAssociatedCollectionStore()??i.collectionStore();if(n)return qd().Fv({environment:k,store:t,timelineState:C,query:l,collectionStore:n,collectionContextStore:i,groupFormat:void 0,transaction:o})}})));const H=(0,a().VK)((()=>(0,Ft().C1)({environment:k,format:u,isFullScreen:g,isRootChild:h})),[k,u,g,h]),Z=(0,a().VK)((()=>i.groupsStore.anyGroupHasResults()),[i]),z=(0,a().Kw)(i.isInHomeWidgetStore),G=(0,a().VK)((()=>!!i.viewsModuleContextStore.getViewModuleType()),[i]),W=(0,a().VK)((()=>X().az(i,g)),[i,g]),N=(0,a().VK)((()=>{const{timelineSizeObserver:e}=C;return(e.rect.state.height||120)+v+(g?0:72)+(!g&&H?28:0)+(g&&T.isMobile?72:0)}),[C,v,g,H,T.isMobile]),U=function(e,t){const o=(0,he().PE)(e,!1);return(0,a().VK)((()=>{const e=t.permissionScopesStore.state;return o&&e.canEditContent&&!e.isSyncedCollection}),[o,t])}(r,i),q=(0,n.useCallback)((e=>{if(e){const{timelineSizeObserver:t}=C;t.observe(e)}}),[C]),Y=(0,n.useCallback)(((e,t,o)=>{if(k.device.isMobile)Io()._c({environment:k,store:e,pageVisitSource:Po().tY.Create});else{const{groupFormat:t}=o,n=t?[t]:[],r=i.groupsStore.getGroupState(n),l="collectionTypedView"===i.contextType;_o().CH({environment:k,store:e,peekMode:X().kr(i),showMoveTo:l,resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:i,pageVisitSource:Po().tY.Create})}}),[k,i]),Q=(0,n.useCallback)((e=>{const t=i.isLoadingStore.state,o=i.groupsStore.getGroupState([]);if(!o)return;const n=o.reducerResultStore.state;e<Te().Z.incrementScrollOffset&&n&&!t&&n.hasMore&&Xe().ID({collectionContextStore:i,environment:k,incrementLimitArgs:{isFullScreen:g,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[i,k,g]),J=(0,c().yK)((e=>({container:{position:"relative",float:"left",minWidth:"100%",width:D,...z?{}:{background:y?e.peekTimelineBackground:e.timelineBackground},...!g&&!H&&!z&&{borderBottom:`1px solid ${e.tableDividerColor}`},...(!Z||z)&&{minHeight:150},...g&&{paddingBottom:v},height:z?"100%":N}})),[N,g,z,y,Z,v,D,H]),{timeline_by:ee}=l;if(!ee)return(0,$.jsx)(Yu,{collectionContextStore:i,isFullScreen:g,paddingBottom:v});const te=d[ee];return te&&Gt().Lt(te)?(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("div",{ref:K}),!O&&(0,$.jsx)("div",{style:{height:4}}),(0,Fn().Z)((e=>(0,$.jsx)(zr().Q,{nodeRef:L,width:D,clipLeftExtra:A||(g?0:E),children:(0,$.jsx)("div",{style:J.container,className:ie().kDE,ref:L,...e,children:(0,$.jsxs)(ze().Z,{store:r,analyticsName:"timeline",shouldShowHalo:!g&&!z,canSelect:!g&&!G,disablePointerEvents:S,style:z?{height:"100%"}:{},children:[(0,$.jsx)(Xu,{timelineState:C}),(0,$.jsxs)("div",{style:{position:"absolute",width:"100%",zIndex:0,top:Ft().Ne},ref:q,children:[(0,$.jsx)(Kp,{store:r,schema:d,query:l,showTable:H,collectionContextStore:i,timelineState:C,disabled:f,isFullScreen:g,isRootChild:h,isInPeekRenderer:y,paddingLeft:E,groupsReducerResultStore:P,hiddenGroupsVisibleStore:R,format:u,canEditCollectionTimeline:U,isReady:Z,blockPropertyValueOverlayStore:b,tableStore:j,scrollerLeftOffset:A,onGroupHeaderAddItem:Y}),(0,$.jsx)(Su,{timelineState:C,disabled:f,isReady:Z,renderEmitter:i.renderEmitter,isFullScreen:g,isRootChild:h})]}),(0,$.jsx)(Ou,{isInPeekRenderer:y,timelineState:C,query:l,schema:d,scrollerLeftOffset:A,collectionContextStore:i,showTable:H}),(0,$.jsx)(wu,{timelineState:C,isInPeekRenderer:y,paddingLeft:E,paddingRight:!g&&h?8:m,format:u,scrollerLeftOffset:A,isFullScreen:g,isRootChild:h,showTable:H,collectionContextStore:i,isReady:Z}),H&&(0,$.jsx)(Xp,{store:r,collectionContextStore:i,groupBy:u.collection_group_by,paddingLeft:E,disabled:f,isFullScreen:g,isRootChild:h,format:u,schema:d,query:l,tableStore:j,scrollerLeftOffset:A,isInPeekRenderer:y,paddingRight:m,paddingBottom:v,isInHomeWidget:z,computedOuterHeight:N,timelineState:C,showHoverActionsStore:x,blockPropertyValueOverlayStore:b,viewIsFlushToTopbar:O,isReady:Z,canEditCollectionTimeline:U,groupsReducerResultStore:P,hiddenGroupsVisibleStore:R,onGroupHeaderAddItem:Y}),(0,$.jsx)("div",{style:{paddingTop:Ft().Ne,pointerEvents:"none"},children:(0,$.jsx)(mp,{store:r,collectionContextStore:i,disabled:f,isFullScreen:g,paddingLeft:E,isRootChild:h,format:u,groupsReducerResultStore:P,hiddenGroupsVisibleStore:R,canEditCollectionTimeline:U,onGroupHeaderAddItem:Y,showTable:H})}),!W&&(0,$.jsx)(jo().Z,{onChange:Q})]})})})))]}):(0,$.jsx)(Yu,{collectionContextStore:i,isFullScreen:g,paddingBottom:v})}))),em=Jp;const tm=new(G().Ss)("CollectionChartView",(async()=>await Promise.all([o.e(94556),o.e(78701),o.e(38804),o.e(27856),o.e(62789),o.e(92341),o.e(38632),o.e(48005),o.e(79308)]).then(o.bind(o,998621)))),om=(0,G().kF)(tm,(e=>e.CollectionChartView)),nm=new(G().Ss)("CollectionFormEditorView",(async()=>await Promise.all([o.e(37358),o.e(7312),o.e(2971),o.e(80741),o.e(72586),o.e(25265),o.e(61651),o.e(8564),o.e(15746)]).then(o.bind(o,637677)))),rm=(0,G().kF)(nm,(e=>e.CollectionFormEditorView));var im=()=>o(763266);const lm=(0,Ri().IU)("folderUnknownLarge",{viewBox:"0 0 48 48",svg:(0,$.jsx)("path",{d:"M39.1702 25.1855C43.1252 25.1855 46.4504 21.8896 46.4504 17.9053C46.4504 13.9062 43.1692 10.625 39.1702 10.625C35.1858 10.625 31.8899 13.9209 31.8899 17.9053C31.8899 21.9189 35.1858 25.1855 39.1702 25.1855ZM11.6604 37.5195H36.1379C38.7014 37.5195 40.1663 36.0547 40.1663 33.2422V26.8408C39.6829 26.9141 38.9504 26.9141 38.3498 26.8408V33.1543C38.3498 34.8389 37.427 35.7178 35.801 35.7178H11.6897C10.0491 35.7178 9.15551 34.8389 9.15551 33.1543V21.1133H30.7327C30.5276 20.5713 30.3811 20 30.3079 19.3994H9.15551V15.3125C9.15551 13.7598 9.94652 12.9834 11.4553 12.9834H14.8391C15.9084 12.9834 16.4797 13.2031 17.2707 13.9062L18.1057 14.6387C19.0286 15.4443 19.761 15.708 21.2405 15.708H30.4543C30.6008 15.0635 30.7766 14.5215 31.0842 13.8916H21.6799C20.5666 13.8916 19.9807 13.6865 19.219 13.0127L18.3694 12.2803C17.4172 11.4307 16.7434 11.1963 15.2786 11.1963H11.1038C8.67211 11.1963 7.3391 12.5293 7.3391 15.21V33.2422C7.3391 36.084 8.80395 37.5195 11.6604 37.5195ZM39.053 19.6924C38.5989 19.6924 38.3352 19.4287 38.3352 18.9746V18.916C38.3352 18.0811 38.76 17.6416 39.4485 17.1582C40.2248 16.6162 40.7375 16.2793 40.7375 15.5615C40.7375 14.9023 40.1955 14.4775 39.3606 14.4775C38.6575 14.4775 38.1741 14.8145 37.8664 15.166C37.6174 15.4297 37.4416 15.6934 37.0608 15.6934C36.6653 15.6934 36.4016 15.4297 36.4016 15.0195C36.4016 14.0088 37.8079 13.1299 39.3606 13.1299C41.133 13.1299 42.2463 14.1699 42.2463 15.4883C42.2463 16.5869 41.6164 17.0557 40.7815 17.6709C40.1077 18.1689 39.844 18.4473 39.7854 19.0479C39.7414 19.4434 39.5071 19.6924 39.053 19.6924ZM39.053 22.5195C38.4817 22.5195 38.0129 22.0508 38.0129 21.4795C38.0129 20.9229 38.4817 20.4541 39.053 20.4541C39.6243 20.4541 40.093 20.9229 40.093 21.4795C40.0784 22.0508 39.6243 22.5195 39.053 22.5195Z"})}),sm=(0,Ri().IU)("formBuilderDisabled",{viewBox:"0 0 72 72",svg:(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.77344 41.6953V17.2031H53.4922V22.6875H57.2656V13.2656C57.2656 10.8594 56.6562 9.04688 55.4375 7.82812C54.2188 6.60938 52.375 6 49.9062 6H9.35938C6.90625 6 5.0625 6.60938 3.82812 7.82812C2.60938 9.03125 2 10.8438 2 13.2656V41.9062C2 44.3125 2.60938 46.1172 3.82812 47.3203C5.0625 48.5391 6.90625 49.1484 9.35938 49.1484H40.4062V45.375H9.40625C8.23438 45.375 7.33594 45.0703 6.71094 44.4609C6.08594 43.8359 5.77344 42.9141 5.77344 41.6953ZM53.4922 13.4766V13.8984H5.77344V13.4766C5.77344 12.2578 6.08594 11.3359 6.71094 10.7109C7.33594 10.0859 8.23438 9.77344 9.40625 9.77344H49.8594C51.0156 9.77344 51.9062 10.0859 52.5312 10.7109C53.1719 11.3359 53.4922 12.2578 53.4922 13.4766Z"}),(0,$.jsx)("path",{d:"M14.1641 34.0781H40.4062V41.6719H14.1641C13.5391 41.6719 13.0312 41.4844 12.6406 41.1094C12.2656 40.7344 12.0781 40.2422 12.0781 39.6328V36.1172C12.0781 35.5078 12.2656 35.0156 12.6406 34.6406C13.0312 34.2656 13.5391 34.0781 14.1641 34.0781Z"}),(0,$.jsx)("path",{d:"M63.5781 34.5C63.8594 34.5 64.0938 34.5938 64.2812 34.7812C64.4792 34.9688 64.5781 35.2031 64.5781 35.4844C64.5781 35.776 64.4792 36.0208 64.2812 36.2188C64.0938 36.4167 63.8594 36.5156 63.5781 36.5156H52.4375C52.1458 36.5156 51.901 36.4167 51.7031 36.2188C51.5156 36.0208 51.4219 35.776 51.4219 35.4844C51.4219 35.2031 51.5156 34.9688 51.7031 34.7812C51.901 34.5938 52.1458 34.5 52.4375 34.5H63.5781Z"}),(0,$.jsx)("path",{d:"M63.5781 39.75C63.8594 39.75 64.0938 39.849 64.2812 40.0469C64.4792 40.2344 64.5781 40.4688 64.5781 40.75C64.5781 41.0417 64.4792 41.2865 64.2812 41.4844C64.0938 41.6823 63.8594 41.7812 63.5781 41.7812H52.4375C52.1458 41.7812 51.901 41.6823 51.7031 41.4844C51.5156 41.2865 51.4219 41.0417 51.4219 40.75C51.4219 40.4688 51.5156 40.2344 51.7031 40.0469C51.901 39.849 52.1458 39.75 52.4375 39.75H63.5781Z"}),(0,$.jsx)("path",{d:"M51.875 45.173C52.0377 45.0681 52.2252 45.0156 52.4375 45.0156H57.9062C58.1979 45.0156 58.4375 45.1146 58.625 45.3125C58.8229 45.5104 58.9219 45.7552 58.9219 46.0469C58.9219 46.3177 58.8229 46.5521 58.625 46.75C58.4375 46.9375 58.1979 47.0312 57.9062 47.0312H55.244C55.2387 47.0458 55.2332 47.0605 55.2276 47.0751C55.2093 47.1229 55.1899 47.1699 55.1695 47.216C55.1592 47.1922 55.1491 47.168 55.1392 47.1437C55.124 47.106 55.1097 47.0685 55.0963 47.0312H52.4375C52.2252 47.0312 52.0377 46.9816 51.875 46.8822C51.8142 46.845 51.757 46.801 51.7031 46.75C51.5156 46.5521 51.4219 46.3177 51.4219 46.0469C51.4219 45.9193 51.4398 45.8008 51.4756 45.6912C51.5218 45.5501 51.5976 45.4239 51.7031 45.3125C51.757 45.2587 51.8142 45.2122 51.875 45.173Z"}),(0,$.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M44.4062 31.9844C44.4062 30.2656 44.849 28.9531 45.7344 28.0469C46.6302 27.1406 47.9375 26.6875 49.6562 26.6875H66.3438C68.0521 26.6875 69.3542 27.1406 70.25 28.0469C71.1458 28.9531 71.5938 30.2656 71.5938 31.9844V55.4688C71.5938 57.1979 71.1458 58.5104 70.25 59.4062C69.3542 60.3021 68.0521 60.75 66.3438 60.75H49.6562C47.9375 60.75 46.6302 60.3021 45.7344 59.4062C44.849 58.5104 44.4062 57.1979 44.4062 55.4688V31.9844ZM47.875 55.1719C47.875 55.8594 48.0521 56.3802 48.4062 56.7344C48.7604 57.099 49.2969 57.2812 50.0156 57.2812H65.9844C66.7031 57.2812 67.2344 57.099 67.5781 56.7344C67.9323 56.3802 68.1094 55.8594 68.1094 55.1719V32.2812C68.1094 31.6042 67.9323 31.0833 67.5781 30.7188C67.2344 30.3542 66.7031 30.1719 65.9844 30.1719H50.0156C49.2969 30.1719 48.7604 30.3542 48.4062 30.7188C48.0521 31.0833 47.875 31.6042 47.875 32.2812V55.1719Z"})]})}),am=(0,G().kF)(new(G().Ss)("posts",(()=>Promise.all([o.e(62743),o.e(66287)]).then(o.bind(o,305172)))),(e=>e.default));const cm=new(G().Ss)("CollectionTasksEmptyStateModal",(async()=>await Promise.all([o.e(62743),o.e(27039),o.e(36751)]).then(o.bind(o,727039)))),dm=(0,G().kF)(cm,(e=>e.CollectionTasksEmptyStateModal));var um=()=>o(380920),pm=()=>o(384334),mm=()=>o(452404),gm=()=>o(392192),Sm=()=>o(396439);const hm=32,fm="noWritableDbs";function ym(e){const{collectionContextStore:t,onAddTaskClick:o,from:r}=e,i=(0,s().O7)(),l=(0,n.useRef)(null),d=(0,a().Kw)(t.isInHomeWidgetStore),u=(0,a().VK)((()=>t.collectionStoresStore.state.length>0),[t.collectionStoresStore]),p=(0,a().VK)((()=>{const e=t.collectionStoresStore.state;return Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())))}),[t.collectionStoresStore]),m=(0,a().VK)((()=>(0,X().PI)(t)),[t]),g=(0,a().VK)((()=>!t.isFullScreenStore.state),[t]),S=(0,n.useCallback)((e=>{var t;const n=null===(t=l.current)||void 0===t?void 0:t.getBoundingClientRect();n&&gd().Pz({environment:i,originRect:n,moveToContext:"aggregated_type",overrideDatabaseType:"notion://tasks_collection",onAccept:()=>{o(e)}})}),[i,o]),h=(0,c().yK)((e=>({container:{width:"100%",height:g?"calc(100% - 4px)":void 0,paddingTop:g?32:120,paddingBottom:32,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",fontSize:14,color:e.lightTextColor},desktopInner:{width:800,minWidth:800,padding:hm},icon:(0,be().jO)(e)})),[g]),f=(0,n.useMemo)((()=>u?(0,$.jsx)(gt().Z,{disableTooltip:p,placement:we().Placement.Bottom,renderTooltip:()=>(0,$.jsx)(qe()._H,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"tasksEmptyState.addTask.tooltip.noWritableDbs",values:{br:(0,$.jsx)("br",{})}}),render:e=>(0,$.jsx)(gm().Z,{...e,isBlue:!0,ref:l,disabled:!p,disabledFeedback:!p,onClick:e=>{(0,pm().Aq)({environment:i,from:r}),S(e)},icon:e=>(0,Go().R)(e),children:m})}):(0,$.jsx)(gm().Z,{isBlue:!0,onClick:()=>{(0,pm().Aq)({environment:i,from:r}),mm().Z.setState(!0)},children:(0,$.jsx)(qe()._H,{defaultMessage:"Don't see your tasks?",id:"tasksEmptyState.noDatabases.title"})})),[u,p,m,i,r,S]);return d&&!u?(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(dm,{from:r}),(0,$.jsx)(ve().Qi,{feature:"tasks",onSetup:()=>{(0,pm().Aq)({environment:i,from:r}),mm().Z.setState(!0)}})]}):(0,$.jsxs)("div",{style:h.container,children:[(0,$.jsx)(dm,{from:r}),(0,um().K)(h.icon),(0,$.jsx)(Sm().Z,{size:16}),p?(0,$.jsx)(qe()._H,{defaultMessage:"No matching tasks.",id:"tasksEmptyState.noMatchingTasks.title"}):(0,$.jsx)(qe()._H,{defaultMessage:"See all tasks assigned to you here.",id:"tasksEmptyState.noTasks.title"}),(0,$.jsx)(Sm().Z,{size:16}),f]})}const vm=new(G().Ss)("views-main-builder-modules",(()=>Promise.all([o.e(37358),o.e(7312),o.e(2971),o.e(80741),o.e(72586),o.e(25265),o.e(61651),o.e(8564),o.e(54308)]).then(o.bind(o,343642)))),xm=(0,G().kF)(vm,(e=>e.ViewsMainBuilderModules));var bm=()=>o(582025),Cm=()=>o(639708),wm=()=>o(441530),km=()=>o(138196),Vm=()=>o(311562),Tm=()=>o(551242),jm=()=>o(293936),Rm=()=>o(618827),Pm=()=>o(133049),Im=()=>o(965631),_m=()=>o(305128),Mm=()=>o(494630);function Bm(e){const{modules:t,store:o,collectionStore:r,context:i,disabled:l,templatePickerMenuListStore:s,pageViewBlockAccessor:d}=e,u=n.useRef(null),p=(0,a().VK)((()=>r.getSchema()),[r]),m=(0,c().yK)((e=>({container:{position:"relative",minWidth:"100%",minHeight:0,display:"flex",flexDirection:"column",pointerEvents:"auto",height:"100%"},scroller:{position:"relative",display:"flex",flexDirection:"column",pointerEvents:"auto",overflow:"auto",minHeight:"100%"}})),[]);return(0,$.jsx)("div",{style:m.container,ref:u,children:(0,$.jsx)(Ot().Z,{type:Kt().Z.Y,style:m.scroller,children:t.map((e=>(0,$.jsx)(Fm,{module:e,store:o,context:i,disabled:l,collectionSchema:p,collectionStore:r,modules:t,templatePickerMenuListStore:s,pageViewBlockAccessor:d},e.id)))})})}function Fm(e){let{module:t,store:o,context:r,disabled:i,collectionSchema:l,collectionStore:c,modules:d,templatePickerMenuListStore:u,pageViewBlockAccessor:p}=e;const m=(0,s().O7)(),g=(0,Mm().du)({layoutModule:t,area:"views_main_tab_modules",collectionSchema:l,collectionStore:c,pageMainModules:d,showDetailsPanelToggleButtonBelowTitle:!1}),S=(0,a().VK)((()=>(0,km().Z)({environment:m,store:o,pageViewBlockStore:void 0})),[m,o]),f=(0,Mm().wV)({layoutModule:t,area:"views_main_tab_modules",collectionSchema:l,collectionStore:c,showDetailsPanelToggleButtonBelowTitle:!1,modules:d}),y=(0,a().VK)((()=>{if("properties"!==t.type)return!0;return!(0,Tm().D)({environment:m,layoutArea:"views_main_tab_modules",moduleType:t.type,pageViewBlockContext:r})}),[m,t.type,r]);return(0,bm().B)(t,"views_main_tab_modules")?(0,Cm().f)(t)?(0,$.jsx)(Im()._,{context:r,disabled:i,propertyId:t.propertyId,store:o,pageModule:t,wrapper:f,stackPropertyLabelAndValue:y},`${t.id}-${o.id}`):(0,Cm().z1)(t)?(0,$.jsx)(n.Fragment,{children:(0,$.jsx)(Pm().V,{context:r,disabled:i,store:o,wrapper:f,layoutModule:t,customization:{neverShowPropertiesElsewhereInLayout:!0,stackPropertyLabelAndValue:y,disableContainerPadding:!0,disableLastRowBottomPadding:y},showDefaultTitle:!0})},`${t.id}-${o.id}`):"editor"===t.type?(0,$.jsx)(Rm().H,{context:r,disabled:i,handlePlaceholderWrapClick:e=>wm().og(e,o,m),pageBlockStore:o,pathToBlockId:t.pathToBlockId,templatePickerMenuListStore:u,pageViewBlockAccessor:p,editorWrapper:r===Vm().S.Post?void 0:f}):"relationsGroup"===t.type?(0,$.jsx)(_m().T,{pageStore:o,wrapper:f,disabled:i,context:r,showDefaultTitle:g}):"deleted_property"===t.type?null:"discussions"===t.type?(0,$.jsx)(jm().s,{store:o,wrapper:f,showDefaultTitle:g,discussionLocation:"page_discussion",pageDiscussionsRenderState:S}):void(0,h().t1)(t):null}var Km=()=>o(857719),Om=()=>o(254805);function Lm(e){const{store:t,disabled:r,paddingLeft:i,paddingRight:l,setRef:d,templatePickerMenuListStore:u}=e,p=(0,s().O7)(),m=(0,a().VK)((()=>{const e=t.getFormat();return{pageFont:e.page_font,pageSmallText:e.page_small_text}}),[t]),g=(0,a().VK)((()=>(0,me().CX)(t)),[t]),S=(0,Ma().Nr)(t),h=(0,a().VK)((()=>(0,me().a_)(t)||(0,me().Wt)(t)),[t]),f=(0,a().VK)((()=>t.isNonEditableState()),[t]),{safePaddingLeft:y,safePaddingRight:v}=(0,a().VK)((()=>({safePaddingLeft:p.WindowSizeStore.getSafePaddingLeftCSS(i),safePaddingRight:p.WindowSizeStore.getSafePaddingRightCSS(l)})),[p.WindowSizeStore,i,l]),x=(0,a().VK)((()=>Boolean((0,o(644329).RR)(o(845622).default.state))),[]),b=(0,a().VK)((()=>t.getContentStore()),[t]),C=(0,a().VK)((()=>(0,Om().ww)(p.device)),[p.device]),w=(0,n.useCallback)((e=>{g&&wm().og(e,t,p)}),[g,t,p]),k=(0,Ma().mj)(t,Vm().S.CollectionPageView)&&Boolean(u),V=(0,c().yK)((()=>{const{device:e}=p,t=m.pageFont||Om().rk,o=Om().sL[t];let n;if(e.isMobile)n=e.isAndroid?Om().pE:Om().tb;else{n=m.pageSmallText?Om().Pc[t]||Om().ZY:Om().TE[t]||Om().jo}let r={paddingTop:6};r=x?{...r,paddingBottom:"600px"}:g?{...r,paddingBottom:"15vh"}:{...r,paddingBottom:0},C||(r={...r,paddingLeft:y,paddingRight:v});const i=Om().VN[t],l=Om().n5[t]||1.5,s={flexShrink:0,flexGrow:1,display:"grid",maxWidth:"100%",width:"100%",gridTemplateColumns:`${y} calc(100% - ${y} - ${v}) ${v}`};return{body:C?{display:"flex",alignItems:"flexstart",flexDirection:"column",fontFamily:o,fontSize:n,letterSpacing:i?`${i}em`:void 0,lineHeight:l,zIndex:$e().ke,...r}:{flexShrink:0,flexGrow:1,maxWidth:"100%",display:"flex",alignItems:"flexstart",flexDirection:"column",fontFamily:o,fontSize:n,letterSpacing:i?`${i}em`:void 0,lineHeight:l,width:"100%",zIndex:$e().ke,...r},iOSWrapper:s,iOSLeftPadding:{},iOSRightPadding:{},emptyDroppableStyle:{width:"100%"}}}),[p,m.pageFont,m.pageSmallText,C,x,g,y,v]),T=(0,o(238936).D)({environment:p,pageFont:m.pageFont,pageSmallText:m.pageSmallText}),j=(0,n.useMemo)((()=>(0,$.jsxs)("div",{style:V.body,ref:e=>{e&&d(e)},className:T,onClick:w,children:[!h&&(0,$.jsx)(o(98275).Z,{store:b,emptyDroppableStyle:V.emptyDroppableStyle,disabled:r||f,forceIsInsideMarginCollapseContainer:!0}),S&&(0,$.jsx)(Zo().Z,{}),k&&u&&(0,$.jsx)(o(607526).Z,{store:t,menuListStore:u})]})),[T,b,r,w,h,f,d,S,k,t,V.body,V.emptyDroppableStyle,u]);return C?(0,$.jsxs)("div",{style:V.iOSWrapper,children:[V.iOSLeftPadding&&(0,$.jsx)(He().p,{allowSelectionWithin:!1,style:V.iOSLeftPadding,onClick:w}),j,V.iOSRightPadding&&(0,$.jsx)(He().p,{allowSelectionWithin:!1,style:V.iOSRightPadding,onClick:w})]}):j}const Dm=n.memo(Lm,Nt().Z),Em=n.memo((function(e){const{store:t,style:r,canEdit:i,padding:l,templatePickerMenuListStore:c,layoutStore:d,collectionStore:u,collectionViewStore:p}=e,m=(0,s().O7)(),S=(0,n.useRef)(null),h=(0,a().VK)((()=>t.isNonEditableState()),[t]),f=(0,o(291848).w)(),{layoutTabModules:y,viewsMainTabId:v}=(0,a().VK)((()=>{var e;const t=null==d||null===(e=d.getModules())||void 0===e?void 0:e.views_main_tab_modules;if(!t)return{layoutTabModules:void 0,viewsMainTabId:void 0};const o=null==p?void 0:p.getFormat().page_layout_pointer;if(!o)return{layoutTabModules:void 0,viewsMainTabId:void 0};return{layoutTabModules:t[o.views_main_tab_id],viewsMainTabId:o.views_main_tab_id}}),[p,d]),x=(0,a().VK)((()=>J().fg(m,t)),[t,m]),b=(0,Ma().n1)(),C=(0,n.useMemo)((()=>({width:(0,me().du)(t,Vm().S.CollectionPageView,m)})),[t,m]),w=!i||h||f,k=x?16:l.paddingRight,V=f&&v?(0,$.jsx)(xm,{viewsMainTabId:v}):y&&u?(0,$.jsx)(Km().Xg,{type:"default",style:{display:"flex",width:"100%",justifyContent:"center",paddingTop:5,paddingBottom:b,paddingLeft:l.paddingLeft,paddingRight:l.paddingRight,...r},children:(0,$.jsx)(Bm,{context:Vm().S.CollectionPageView,modules:y,store:t,disabled:w,collectionStore:u,templatePickerMenuListStore:c,pageViewBlockAccessor:()=>S.current})}):(0,$.jsx)(o(28832).O,{displayName:"PageContent",style:r,disabled:w,children:(0,$.jsxs)(Km().Xg,{type:"default",style:{display:"flex",width:"100%",justifyContent:"center",paddingTop:5,paddingBottom:b},children:[(0,$.jsx)(ut().Z,{tag:Km().Pb,animate:C,children:(0,$.jsx)(Dm,{paddingLeft:l.paddingLeft,paddingRight:k,disabled:w,store:t,setRef:e=>{(0,g().k$)(S,e)},templatePickerMenuListStore:c})}),!m.device.isMobile&&x&&(0,$.jsx)(Km().Vw,{children:(0,$.jsx)(o(203119).Z,{pageBlockStore:t,isVisible:x,context:Vm().S.CollectionPageView,pageViewBlockAccessor:()=>S.current})})]})});return!f||V||v?V:(0,$.jsx)("div",{inert:"true",style:{userSelect:"none"},children:V})}));var Am=()=>o(963310);function Hm(e){let{store:t,collectionStore:r,collectionViewStore:i,isDisabled:l,isFullScreen:d,isInPeekRenderer:u,isPreviewing:p,isRootChild:m,paddingLeft:g,paddingRight:S,paddingBottom:h,headerSizeObserver:f,viewType:y,timelineViewRef:v,showHoverActionsStore:x,handleAddItemClick:b,isPlaceholderExternalCollection:C,isEmptyMyTasks:w,isInFrameWhenSidePeekOpen:k,query:V,schema:T,format:j,isCustomDbEmptyState:R,maxHeight:P,placementStore:I,templatePickerMenuListStore:_}=e;const M=(0,E().Y$)(),[B,F,K]=(0,a().VK)((()=>[Boolean(M.hasSingleCollection()),"collectionSystemView"===M.contextType,M.isInHomeWidgetStore.state]),[M]),O=!(0,he().PE)(t,F||l);(0,n.useEffect)((()=>{"rendered"!==an().default.state.renderPhase&&an().default.setState({...an().default.state,renderPhase:"rendered"})}),[]);const L=function(e){let{store:t,isFullScreen:o,viewType:n,isInFrameWhenSidePeekOpen:r,isInHomeWidget:i,isInPeekRenderer:l,isPreviewing:c,isRootChild:d}=e;const u=(0,s().O7)();return(0,a().VK)((()=>{const{device:e}=u,s=e.isPhone,a=("gallery"===n||("calendar"===n||"list"===n)&&o)&&r,p=(0,Ce().ll)(u,l),m=Fe().default.state;return i||c?void 0:o||d?s?`calc(100% - ${2*(0,re().ui)(u)}px - ${p}px)`:l?`calc(100% - ${2*Fe().PeekModePadding.horizontal[m.mode]}px - ${p}px)`:r?(0,Ce().$3)(u)+(a?(0,Ce().vJ)(u):0):o?`calc(100% - ${2*(0,re().CP)(u)}px - ${p}px)`:(0,X()._5)(t)?`calc(100% - ${2*(0,re().ui)(u)}px - ${p}px)`:me().zL-2*(0,re().ui)(u)-p:`calc(100% - ${p}px)`}),[i,u,o,r,l,c,d,t,n])}({store:t,isFullScreen:d,viewType:y,isInFrameWhenSidePeekOpen:k,isInHomeWidget:K,isInPeekRenderer:u,isPreviewing:p,isRootChild:m}),D=u?o(27475).Z:o(121700).Z,[A,H,Z]=(0,a().VK)((()=>[null==r?void 0:r.isReady(),null==r?void 0:r.isDefined(),null==r?void 0:r.canRead()]),[r]),z=(0,c().yK)((e=>({container:{display:"flex",alignItems:"flex-start",paddingLeft:g,paddingRight:S,paddingTop:8},shimmer:{backgroundColor:e.largeShimmerColor,height:48,marginBottom:10,width:"100%"}})),[g,S]);if(B){if(!r)return(0,$.jsx)(Wm,{viewType:y,isFullScreen:d,paddingLeft:g,paddingRight:S,paddingBottom:h});if(!A)return(0,$.jsx)("div",{style:z.container,children:(0,$.jsx)(zn().Z,{emphasized:!1,style:z.shimmer})});if(!H)return Z?(0,$.jsx)(Wm,{viewType:y,isFullScreen:d,paddingLeft:g,paddingRight:S,paddingBottom:h}):(0,$.jsx)(Am().S2,{collectionStore:r,paddingLeft:g,paddingRight:S,isFullScreen:d})}return C?(0,$.jsx)(Nm,{isFullScreen:d,paddingLeft:g,paddingRight:S,paddingBottom:h}):w&&"calendar"!==y?(0,$.jsx)(ym,{collectionContextStore:M,onAddTaskClick:b,from:K?"home_tile_tasks":"home_tasks"}):R?(0,$.jsx)(ve().sg,{collectionContextStore:M,onAddItemClick:b,from:K?"home_tile_custom_db":"home_custom_db"}):"table"===y?(0,$.jsx)(Wd,{schema:T,format:j,query:V,store:t,collectionContextStore:M,showHoverActionsStore:x,isFullScreen:d,isInPeekRenderer:u,isPreviewing:p,paddingLeft:g,paddingRight:S,minWidth:L,paddingBottom:h,disabled:O,blockPropertyValueOverlayStore:D,isRootChild:m,placementStore:I},i.id):"board"===y?(0,$.jsx)(us,{schema:T,format:j,query:V,store:t,collectionContextStore:M,isFullScreen:d,isInPeekRenderer:u,isPreviewing:p,paddingLeft:g,paddingRight:S,paddingBottom:h,disabled:O,blockPropertyValueOverlayStore:D,isRootChild:m},i.id):"page"===y?(0,$.jsx)(Zm,{store:t,collectionViewStore:i,disabled:O,paddingLeft:g,paddingRight:S,templatePickerMenuListStore:_}):"calendar"===y?(0,$.jsx)(xa,{schema:T,format:j,query:V,store:t,collectionContextStore:M,isFullScreen:d,isInPeekRenderer:u,isPreviewing:p,paddingLeft:g,paddingRight:S,maxHeight:P,minWidth:L,paddingBottom:h,disabled:O,blockPropertyValueOverlayStore:D,isRootChild:m},i.id):"list"===y?(0,$.jsx)(Aa,{schema:T,format:j,query:V,store:t,collectionContextStore:M,isFullScreen:d,isInPeekRenderer:u,isPreviewing:p,paddingLeft:g,paddingRight:k&&!K?24:S,minWidth:L,paddingBottom:h,disabled:O,blockPropertyValueOverlayStore:D,isRootChild:m},i.id):"gallery"===y?(0,$.jsx)(Ji,{schema:T,format:j,query:V,store:t,collectionContextStore:M,isFullScreen:d,isInPeekRenderer:u,isPreviewing:p,paddingLeft:g,paddingRight:S,minWidth:L,paddingBottom:h,disabled:O,blockPropertyValueOverlayStore:D,isRootChild:m},i.id):"timeline"===y?(0,$.jsx)(em,{schema:T,format:j,query:V,store:t,collectionContextStore:M,isFullScreen:d,isRootChild:m,isInPeekRenderer:u,isPreviewing:p,minWidth:L,paddingBottom:h,disabled:O,blockPropertyValueOverlayStore:D,showHoverActionsStore:x,ref:v,paddingLeft:g,paddingRight:S},i.id):"form_editor"===y?(0,$.jsx)(zm,{collectionViewStore:i,collectionContextStore:M,headerSizeObserver:f,paddingLeft:g,paddingRight:S},i.id):"chart"===y?(0,$.jsx)(Gm,{collectionViewStore:i,isPreviewing:p,paddingLeft:g,paddingRight:S,headerSizeObserver:f,collectionContextStore:M}):"feed"===y?(0,$.jsx)(am,{collectionViewStore:i,collectionContextStore:M,paddingLeft:g,paddingRight:S}):"chat"===y?(0,$.jsx)(o(662807).tC,{collectionViewStore:i,collectionContextStore:M,paddingLeft:g,paddingRight:S}):null}function Zm(e){let{store:t,collectionViewStore:o,disabled:n,paddingLeft:r,paddingRight:i,templatePickerMenuListStore:l}=e;const c=(0,s().O7)(),d=(0,E().Y$)(),u=(0,a().VK)((()=>{let e,n=o.getFormat().page_pointer;const r=d.viewsModuleContextStore;if(!n&&"viewsMain"===(null==r?void 0:r.getViewModuleType())){const t=r.currentPageInRelatedCollectionStore();t&&(n=t.pointer,e=t)}if(n)return e??=t.id===n.id?t:W().G.createChildStore(t,{table:n.table,id:n.id,spaceId:n.spaceId}),e.isPageBlock()||e.isCollectionView()?e:void 0}),[d.viewsModuleContextStore,o,t]),{layoutStore:p,collectionStore:m}=(0,a().VK)((()=>{var e;return{layoutStore:null===(e=d.collectionStore())||void 0===e?void 0:e.getLayoutStore(),collectionStore:d.collectionStore()}}),[d]),g=(0,a().VK)((()=>{const e=(0,re().ui)(c);return{paddingBottom:(0,Om().EA)(c),paddingLeft:r??e,paddingRight:i??e}}),[c,r,i]);return u?(0,$.jsx)(Em,{canEdit:!n,disabled:n,padding:g,store:u,style:Om().d$,collectionViewStore:o,templatePickerMenuListStore:l,layoutStore:p,collectionStore:m}):null}function zm(e){let{collectionViewStore:t,collectionContextStore:o,headerSizeObserver:n,paddingLeft:r,paddingRight:i}=e;const l=(0,s().Fy)(),d=(0,c().yK)((e=>({disabledBuilderWrapper:{minHeight:void 0,height:void 0,marginTop:120-Vl,marginBottom:120-Vl,padding:0,paddingLeft:r,paddingRight:i},disabledBuilderTitle:{fontSize:14,fontWeight:Zt().Ue.regular},disabledBuilderIcon:{fill:e.lightIconColor,height:72,margin:"0 auto"}})),[r,i]),u=(0,a().VK)((()=>n.rect.state.width),[n]);return l.isMobile?(0,$.jsx)(jl,{style:d.disabledBuilderWrapper,title:(0,$.jsx)("span",{style:d.disabledBuilderTitle,children:(0,$.jsx)(qe()._H,{id:"formsInner.disabledBuilder.title",defaultMessage:"Forms can only be edited on desktop"})}),icon:sm(d.disabledBuilderIcon)}):(0,$.jsx)(rm,{collectionContextStore:o,headingWidth:u,paddingLeft:r,paddingRight:i},t.id)}function Gm(e){let{collectionViewStore:t,isPreviewing:o,paddingLeft:n,paddingRight:r,headerSizeObserver:i,collectionContextStore:l}=e;const s=(0,a().VK)((()=>i.rect.state.width),[i]);return(0,$.jsx)(om,{collectionContextStore:l,isPreviewing:o,headingWidth:s,paddingLeft:n,paddingRight:r},t.id)}function Wm(e){let{viewType:t,isFullScreen:o,paddingLeft:r,paddingRight:i,paddingBottom:l}=e;const d=(0,s().O7)(),u=(0,E().Y$)(),p=(0,a().Kw)(u.permissionScopesStore),m=(0,c().Fg)(),g=(0,n.useMemo)((()=>({style:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:l},icon:lm({height:48,fill:m.lightIconColor,margin:"0 auto"})})),[o,l,r,i,m.lightIconColor]),S=(0,n.useCallback)((()=>{!function(e,t){const o=e.settingsStore;y().r$({collectionContextStore:e,collectionSettingsStore:o}),f().wd({environment:t,collectionContextStore:e,action:"click_select_data_source"})}(u,d)}),[u,d]),h=(0,a().VK)((()=>"linked"===u.getCollectionViewBlockSourceState()||"chart"===t),[u,t]);return p.canConfigureBlock?(0,$.jsx)(jl,{title:t?(0,$.jsx)(qe()._H,{defaultMessage:"New {viewType}",id:"database.viewSettings.createView.newViewType",values:{viewType:tt().Bh[t].toLocaleLowerCase()}}):(0,$.jsx)(qe()._H,{defaultMessage:"New view",id:"database.viewSettings.createView.newView"}),buttonText:h?(0,$.jsx)(qe()._H,{defaultMessage:"Link a database",id:"collectionViewBlock.linkDatabase"}):(0,$.jsx)(qe()._H,{defaultMessage:"Link or create a database",id:"collectionViewBlock.linkOrCreateDatabase"}),buttonOnClick:S,...g}):(0,$.jsx)(jl,{title:(0,$.jsx)(qe()._H,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"}),description:(0,$.jsx)(qe()._H,{defaultMessage:"This block is not connected to any data source.",id:"collectionViewBlock.noSourcePlaceholder.description"}),...g})}function Nm(e){let{isFullScreen:t,paddingLeft:o,paddingRight:n,paddingBottom:r}=e;const i=(0,c().Fg)(),l=(0,E().Y$)(),[d,u,p]=(0,a().VK)((()=>[l.permissionScopesStore.state,l.settingsStore,l.collectionStore()]),[l]),m=(0,a().VK)((()=>u.state.open),[u]),g=(0,a().VK)((()=>{if(p)return p.getIcon()}),[p]),{isMobileBrowser:S}=(0,s().Fy)(),h=(0,a().VK)((()=>{if(p)return p.getFormat().integration_id}),[p]),f=(0,a().VK)((()=>{if(!p)return!1;const e=p.getFormat().integration_id,t=aa().default.integrations.state.find((t=>t.id===e));return!(!e||!t)&&(0,im().NP)(e).length>0}),[p]),v=(0,a().VK)((()=>aa().default.integrations.state.find((e=>e.id===h))),[h]);if(!v)return null;const x=!(S&&!f);return(0,$.jsx)("div",{style:{paddingLeft:o,paddingRight:n,paddingTop:8,paddingBottom:t?void 0:r,height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,$.jsxs)("div",{style:{paddingRight:m?Mt().P4:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,$.jsx)(kn().Z,{icon:g,size:48,disabled:!0,isEmptyPage:!1}),(0,$.jsx)("div",{style:{fontSize:17,fontWeight:Zt().Ue.medium,color:i.lightTextColor,textAlign:"center",marginBottom:-2},children:(0,$.jsx)(qe()._H,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",values:{integrationName:v.name}})}),d.canConfigureBlock&&(0,$.jsx)("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:i.lightTextColor},children:x&&(0,$.jsx)(qe()._H,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",values:{integrationName:v.name,button:e=>(0,$.jsx)(pt().Z,{style:{display:"inline",padding:"1px 2px",borderRadius:4,textDecoration:"underline"},onClick:()=>{y().NG({collectionSettingsStore:u})},children:e})}})})]})})}const Um=n.memo(Hm);var $m=()=>o(259314),qm=()=>o(239730),Ym=()=>o(138555),Qm=()=>o(986286);function Xm(e){const{origin:t}=e,o=(0,s().O7)();return(0,$.jsx)(pa().U,{origin:t,placementToOrigin:"bottom",header:(0,$.jsx)(qe()._H,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!"}),content:(0,$.jsx)(qe()._H,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content"}),onCloseClick:()=>{fc().Rg(o)},enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:xc().EZ,pointerOffset:xc().rK,style:{width:xc().G5}})}function Jm(e){const{origin:t}=e,o=(0,s().O7)();return(0,$.jsx)(pa().U,{origin:t,placementToOrigin:"right",header:(0,$.jsx)(qe()._H,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views"}),content:(0,$.jsx)(qe()._H,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",values:{bold:e=>(0,$.jsx)("span",{style:{fontWeight:Zt().Ue.semibold},children:e})}}),onCloseClick:()=>{fc().Rg(o)},pointerPosition:"50%",pointerLength:xc().EZ,pointerOffset:xc().FD,enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,style:{width:xc().G5}})}let eg;class tg{constructor(e){this.style=void 0,this.lastResult=void 0,this.style=e.style}measure(e){var t;if(e===(null===(t=this.lastResult)||void 0===t?void 0:t.text))return this.lastResult.rect;eg||(eg=document.createElement("div"),eg.style.position="absolute",eg.style.left="0",eg.style.top="0",eg.style.pointerEvents="none",eg.style.opacity="0",document.body.appendChild(eg)),S().M6(this.style,((e,t)=>{eg&&(eg.style[t]=e)})),eg.textContent=e;const o=eg.getBoundingClientRect();return this.lastResult={text:e,rect:o},o}}const og={ConfigureViewsMainModuleAddNewViewButtonWrapper:new(G().Ss)("ConfigureViewsMainModuleAddNewViewButtonWrapper",(async()=>await Promise.all([o.e(62743),o.e(90698),o.e(94556),o.e(78701),o.e(38804),o.e(2971),o.e(80741),o.e(72586),o.e(46616),o.e(54940),o.e(49396),o.e(98721),o.e(98032),o.e(57229),o.e(63707),o.e(91253),o.e(5006),o.e(6612),o.e(73682),o.e(58565),o.e(38739),o.e(34291),o.e(92341),o.e(46945),o.e(10553),o.e(27039),o.e(25265),o.e(92329),o.e(38632),o.e(54307),o.e(75861),o.e(51140)]).then(o.bind(o,533622))))},ng=(0,G().kF)(og.ConfigureViewsMainModuleAddNewViewButtonWrapper,(e=>e.ConfigureViewsMainModuleAddNewViewButtonWrapper));var rg=()=>o(716025),ig=()=>o(292612),lg=()=>o(437187),sg=()=>o(641702),ag=()=>o(110232),cg=()=>o(338217),dg=()=>o(802600),ug=()=>o(85876),pg=()=>o(599631),mg=()=>o(209078),gg=()=>o(502893),Sg=()=>o(94130),hg=()=>o(583632);const fg={svgIcon:{width:24,height:16},svgIconPadded:{width:24,height:24}};function yg(e){let{collectionViewStore:t,collectionContextStore:o,onClose:n}=e;const r=(0,s().O7)(),i=(0,qe().YB)(),l=(0,a().VK)((()=>{if("form_editor"===(null==t?void 0:t.getType())){const e=t.getFormBlockStore();if(e)return[e]}return[]}),[t]),c=(0,a().VK)((()=>function(e){var t;let{collectionViewStore:o,collectionContextStore:n,formBlockStore:r,onClose:i,environment:l,intl:s,styles:a}=e;const c=n.permissionScopesStore.state,d=n.collectionViewStore(),u=n.collectionViewBlockStore();if(!d||!u)return[];const p=(0,xe().Kj)(u.id),m=(0,re().qG)(u.id),g=d.id===o.id,S=o.getAppConfigUri(),h=n.normalizedFormatStore.state.hide_linked_collection_name,v=!S||(0,ag().R8)(S),x=n.collectionStore(),b=Boolean((null==x||null===(t=x.getParentBlockStore())||void 0===t?void 0:t.id)===u.id),C=void 0!==x||"page"===o.getType(),k=b&&n.isFullScreenStore.state,T=o.getType(),j=n.viewsModuleContextStore.state,R=c.canConfigureBlock&&C&&!j,P=!m&&"form_editor"!==T&&"page"!==T&&C&&c.canConfigureBlock,I=u.getCollectionViewIds().length>1,_=n.isEditableHomeCollectionStore.state,M=!m&&(I||_)&&"page"!==T,B=x&&!k&&!j,F=!j&&C,K=h&&!p&&c.canConfigureBlock&&void 0!==x&&!("page"===T&&void 0===o.getFormat().page_pointer),O=[];if(O.push([]),R){if(O[0].push({key:"rename",render:e=>(0,$.jsx)(gt().Z,{placement:we().Placement.Left,disableTooltip:v,render:t=>(0,$.jsx)(yr().Z,{...e,disabled:!v,disabledFeedback:!0,title:(0,$.jsx)(qe()._H,{defaultMessage:"Rename",id:"database.viewSettings.viewActionMenu.rename"}),icon:(0,gg().H)(a.svgIcon),...t}),renderTooltip:()=>(0,$.jsx)(qe()._H,{id:"database.viewSettings.viewActionMenu.cannotRename",defaultMessage:"This view cant be renamed."})}),action:()=>{f().wd({environment:l,collectionContextStore:n,action:"view_action_menu_rename"}),null==i||i(!0),g||V().f8({environment:l,collectionContextStore:n,collectionViewId:o.id,isFullScreen:n.isFullScreenStore.state,isRootChild:n.isRootChildStore.state,isInPeekRenderer:n.isInPeekRendererStore.state}),y().r$({collectionContextStore:n,collectionSettingsStore:n.settingsStore,selectViewNameInitial:!0})}}),"page"===T)return O;O[0].push({key:"edit",render:e=>(0,$.jsx)(yr().Z,{...e,title:(0,$.jsx)(qe()._H,{defaultMessage:"Edit view",id:"database.viewSettings.viewActionMenu.editView"}),icon:(0,mg().W)(a.svgIcon)}),action:()=>{f().wd({environment:l,collectionContextStore:n,action:"view_action_menu_edit"}),null==i||i(!0),g||V().f8({environment:l,collectionContextStore:n,collectionViewId:o.id,isFullScreen:n.isFullScreenStore.state,isRootChild:n.isRootChildStore.state,isInPeekRenderer:n.isInPeekRendererStore.state}),y().r$({collectionContextStore:n,collectionSettingsStore:n.settingsStore})}})}O.push([]),F&&O[1].push({key:"copyLink",render:e=>(0,$.jsx)(yr().Z,{...e,title:(0,$.jsx)(qe()._H,{defaultMessage:"Copy link to view",id:"database.viewSettings.viewActionMenu.copyLink"}),icon:(0,pg().N)(a.svgIcon)}),action:async()=>{f().wd({environment:l,collectionContextStore:n,action:"view_action_menu_copy_link"}),await y().Ol({environment:l,collectionContextStore:n,collectionViewStore:o}),null==i||i(!1)}});B&&O[1].push({key:"openSourceDb",render:e=>(0,$.jsx)(gt().Z,{placement:we().Placement.Right,render:t=>(0,$.jsx)(yr().Z,{title:b?(0,$.jsx)(qe()._H,{defaultMessage:"Open as full page",id:"database.viewSettings.viewActionMenu.openAsFullPage"}):(0,$.jsx)(qe()._H,{defaultMessage:"Open source database",id:"database.viewSettings.viewActionMenu.openSourceDb"}),icon:(0,cg().J)(a.svgIcon),...(0,mr().Z)(e,t)}),renderTooltip:()=>(0,$.jsx)(xg,{collectionStore:x})}),action:e=>{(0,Sg().m)({environment:l,collectionContextStore:n,event:e.event})}});K&&O[1].push({key:"showDatabaseTitle",render:e=>(0,$.jsx)(yr().Z,{...e,title:(0,$.jsx)(qe()._H,{defaultMessage:"Show database title",id:"database.viewSettings.viewActionMenu.showDatabaseTitle"}),icon:(0,ug().N)(a.svgIconPadded)}),action:()=>{f().wd({environment:l,collectionContextStore:n,action:"click_source_show_title"}),w().createAndCommit({userAction:"CollectionViewActionMenu.getMenuSections",environment:l,canUndo:!0,perform:e=>{Xo().FH({stores:[o],update:{hide_linked_collection_name:!1},transaction:e})}}),null==i||i(!1)}});O.push([]),P&&O[2].push({key:"duplicate",render:e=>(0,$.jsx)(yr().Z,{...e,title:(0,$.jsx)(qe()._H,{defaultMessage:"Duplicate",id:"database.viewSettings.viewActionMenu.duplicate"}),icon:(0,dg().a)(a.svgIcon)}),action:()=>{f().wd({environment:l,collectionContextStore:n,action:"view_action_menu_duplicate"}),y().zt({environment:l,collectionContextStore:n,collectionViewStore:o,collectionSettingsStore:n.settingsStore,intl:s,from:"view_action_menu_duplicate"}),null==i||i(!0)}});c.canConfigureBlock&&M&&O[2].push({key:"delete",render:e=>(0,$.jsx)(yr().Z,{...e,title:(0,$.jsx)(qe()._H,{defaultMessage:"Delete",id:"database.viewSettings.viewActionMenu.delete"}),icon:(0,rt().y)(a.svgIcon),isRedOnHover:!0}),action:async()=>{f().wd({environment:l,collectionContextStore:n,action:"view_action_menu_delete"});await y().TT({environment:l,collectionContextStore:n,collectionViewStore:o,collectionSettingsStore:n.settingsStore,additionalBlocksToDelete:r,from:"view_action_menu"})&&(null==i||i(!1))}});return O}({collectionViewStore:t,collectionContextStore:o,formBlockStore:l,onClose:n,environment:r,intl:i,styles:fg})),[o,l,t,r,i,n]);return(0,$.jsx)(tr().Z,{type:tr().i.Vertical,initialFocus:void 0,sections:S().oA(c.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,$.jsx)(nr().Z,{...e,topBorder:0!==t}),items:e}})))})}const vg=n.memo(yg,Nt().Z);function xg(e){const{collectionStore:t}=e,o=(0,qe().YB)(),n=(0,a().VK)((()=>{var e;const n=t.getNameStore();return(0,sg().Xh)(n.getValue(),n)||(null===(e=t.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({intl:o}))||o.formatMessage(hg().i.titlePlaceholder)}),[t,o]);return(0,$.jsx)(qe()._H,{id:"database.viewSettings.viewActionMenu.openDbTooltip",defaultMessage:"Opens {dbName}",values:{dbName:n}})}var bg=()=>o(900596);function Cg(e){const{collectionContextStore:t,collectionViewStore:o,menuListItemProps:r,onClose:i}=e,{device:l}=(0,s().O7)(),d=(0,c().yK)((e=>({tooltipMessage:{color:e.mediumInvertedTextColor}})),[]),u=(0,qe().YB)(),p=(0,a().qz)(void 0,ke().Z),[m,g,S,h,f,y]=(0,a().VK)((()=>[o.getName(),o.getType(),o.getFormat().collection_view_icon,o.getFormat().description,o.getCollectionStore(),t.permissionScopesStore.state.canConfigureBlock]),[o,t]),v=(0,a().VK)((()=>null!=f&&f.isDefined()?(0,sg().Xh)(f.getName(),f)||f.getModel().getEmptyTitlePlaceholder({intl:u}):(0,lg().Q2)(u)),[f,u]),x=(0,n.useCallback)((e=>{p.setState({open:!1}),e&&i()}),[p,i]),b=(0,n.useCallback)((()=>{const t=l.isMobile?{menuType:Yn().o.ActionSheet}:{menuType:Yn().o.Popup,width:220};return(0,$.jsx)(er().Z,{...t,children:(0,$.jsx)(vg,{...e,onClose:x})})}),[l.isMobile,x,e]);return void 0===g?null:(0,$.jsx)(gt().Z,{renderTooltip:e=>(0,$.jsxs)("div",{...e,style:Ic().F6,children:[(0,$.jsx)("div",{children:(0,X().Cc)({collectionViewName:m,collectionViewType:g})}),void 0!==f&&(0,$.jsx)("div",{style:d.tooltipMessage,children:h||(0,$.jsx)(qe()._H,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} Form {Form} Chart {Chart view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:tt().Bh[g],collection:v}})})]}),placement:we().Placement.Left,render:e=>(0,$.jsx)(yr().Z,{title:(0,$.jsx)(bg().Z,{collectionViewType:g,collectionViewName:m}),icon:(0,$.jsx)(rg().F,{color:"regular",viewIcon:S,viewType:g}),showDragHandle:!l.isMobile&&y,right:y?(0,$.jsx)(vr().ZP,{popupType:l.isMobile?vr().Z4.SlideUp:vr().Z4.Popup,renderOrigin:e=>(0,$.jsx)(mt().Z,{icon:fn().o,ariaLabel:u.formatMessage({id:"collectionViewSelectItem.viewSettings.ariaLabel",defaultMessage:"Database view settings"}),...e}),render:b,buttonPopupStore:p}):null,rightStyle:{marginRight:8},...(0,mr().Z)(e,r)})})}function wg(e){const{collectionContextStore:t,onAddViewClick:r,onClose:i,onViewClick:l}=e,c=(0,qe().YB)(),d=(0,s().Fy)(),[u,p]=n.useState(0),[m,g]=n.useState(""),S=(0,a().qz)(void 0,o(692304).Z),h=(0,a().VK)((()=>{var e;return!(d.isMobile||null!==(e=t.collectionViewBlockStore())&&void 0!==e&&e.isCollectionViewPageWithContent())}),[t,d.isMobile]),f=(0,a().VK)((()=>{var e;return((null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]).filter((e=>(0,X().D)(e,m)))}),[t,m]),y=(0,a().VK)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),v=(0,a().VK)((()=>(0,X().kn)(t,d)),[t,d]),x=n.useCallback((e=>{g(e.target.value),S.setState({...S.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[S]);n.useEffect((()=>{var e,o;const n=null===(e=t.collectionViewStore())||void 0===e?void 0:e.id,r=((null===(o=t.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())||[]).findIndex((e=>e.id===n));r>=0&&p(r)}),[t]);const b=!d.isMobile&&y;return(0,$.jsx)(Ze().Z,{capture:!0,allowEsc:!0,render:e=>{let n;return n=d.isPhone?{menuType:Yn().o.Modal,title:(0,$.jsx)(Vg,{collectionContextStore:t}),right:(0,$.jsx)(or().DoneMenuText,{}),onClickRight:i}:{menuType:Yn().o.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh"},(0,$.jsxs)(er().Z,{...n,...e,header:h?(0,$.jsx)(Al().ZP,{value:m,focus:!0,style:{marginTop:8,marginBottom:4},textWrapperStyle:{marginLeft:8,marginRight:8},onChange:x,placeholder:c.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})}):null,footer:b&&(0,$.jsxs)(nr().Z,{topBorder:!0,children:[(0,$.jsx)(Pg,{collectionContextStore:t,onClose:i,onAddViewClick:r}),v?null:(0,$.jsx)(o(5317).Z,{collectionContextStore:t,onClose:i,focused:!1,isCompact:!0})]}),children:[(0,$.jsx)(Tg,{collectionContextStore:t,filteredViewStores:f,isDraggable:b&&""===m,menuListStore:S,initialMenuListFocus:u,onClose:i,onViewClick:l}),m&&0===f.length&&(0,$.jsx)(o(178498).Z,{caption:(0,$.jsx)(qe()._H,{defaultMessage:"No results",id:"database.collectionViewSelect.noResultsTitle"})}),d.isMobile?(0,$.jsx)(Pg,{collectionContextStore:t,onClose:i,onAddViewClick:r}):null]})}})}const kg=n.memo(wg);function Vg(e){let{collectionContextStore:t}=e;const o=(0,a().VK)((()=>{var e;return(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]}),[t]);return(0,$.jsx)(qe()._H,{defaultMessage:"{numberOfViews, plural, one {{numberOfViews} view} other {{numberOfViews} views}}",id:"database.mobileSelectViewMenu.title",values:{numberOfViews:o.length}})}function Tg(e){const{collectionContextStore:t,onViewClick:o,onClose:r}=e,i=(0,s().O7)(),l=n.useCallback(((e,n)=>{const l=t.collectionViewStore(),s=ce().DJ(e);l&&o({currentCollectionViewStore:l,newCollectionViewStore:n,openInNew:s});const a=t.isFullScreenStore.state,c=t.isRootChildStore.state,d=t.isInPeekRendererStore.state;V().f8({environment:i,collectionContextStore:t,collectionViewId:n.id,openInNew:s,isFullScreen:a,isRootChild:c,isInPeekRenderer:d}),f().wd({environment:i,collectionContextStore:t,action:"click_view_in_dropdown",new_view_type:n.getType(),new_view_id:n.id}),s||r()}),[t,i,o,r]);if(0===e.filteredViewStores.length)return null;const a={key:"views",render:t=>(0,$.jsx)(jg,{menuListSectionProps:t,collectionContextStore:e.collectionContextStore,filteredViewStores:e.filteredViewStores,isDraggable:e.isDraggable,menuListStore:e.menuListStore}),items:e.filteredViewStores.map((t=>({key:t.id,render:o=>(0,$.jsx)(Rg,{collectionContextStore:e.collectionContextStore,onClose:e.onClose,collectionViewStore:t,props:o}),action:e=>{let{event:o}=e;l(o,t)}})))};return(0,$.jsx)(tr().Z,{type:tr().i.Vertical,initialFocus:e.initialMenuListFocus,sections:[a],store:e.menuListStore})}function jg(e){const t=(0,s().O7)(),o=(0,a().VK)((()=>e.filteredViewStores.map((e=>e.id))),[e.filteredViewStores]),r=n.useCallback(((o,n)=>{const r=e.collectionContextStore.collectionViewBlockStore();r&&(w().createAndCommit({userAction:"CollectionViewSelect2.handleViewsDrop",environment:t,canUndo:!0,perform:e=>{V().Wu({collectionViewBlockStore:r,newViewIds:o,transaction:e})}}),e.menuListStore.reset())}),[t,e.collectionContextStore,e.menuListStore]);return e.isDraggable?(0,$.jsx)(nr().Z,{...e.menuListSectionProps,children:(0,$.jsx)(Cl().ZP,{direction:"vertical",keys:o,renderKey:t=>e.menuListSectionProps.children[o.indexOf(t)],onDrop:r})}):(0,$.jsx)(nr().Z,{...e.menuListSectionProps})}function Rg(e){let{collectionViewStore:t,props:o,collectionContextStore:n,onClose:r}=e;return(0,$.jsx)(Cg,{collectionContextStore:n,collectionViewStore:t,onClose:r,menuListItemProps:o})}function Pg(e){const t=(0,s().O7)(),o=(0,a().VK)((()=>{var t;if(!e.collectionContextStore.permissionScopesStore.state.canConfigureBlock)return!1;return!(0,re().qG)((null===(t=e.collectionContextStore)||void 0===t||null===(t=t.collectionViewBlockStore())||void 0===t?void 0:t.id)??"")}),[e.collectionContextStore]),n=(0,a().VK)((()=>"viewsMain"===e.collectionContextStore.viewsModuleContextStore.getViewModuleType()),[e.collectionContextStore]);if(!o)return null;const r=(0,$.jsx)(qe()._H,{defaultMessage:"New view",id:"database.collectionViewSelect.newViewButtonTitle"});return n?(0,$.jsx)(ng,{renderOrigin:e=>(0,$.jsx)(ig().Z,{onClick:()=>{e.onClick()},title:r,focused:!1}),onClose:e.onClose}):(0,$.jsx)(vr().ZP,{popupType:t.device.isMobile?Zl().kQ.SlideUp:Zl().kQ.Popup,alignmentToOrigin:vr().vR.Center,placementToOrigin:vr().pO.Right,renderOrigin:e=>(0,$.jsx)(ig().Z,{...e,title:r,focused:!1}),render:t=>(0,$.jsx)(Ym().vE,{collectionContextStore:e.collectionContextStore,onClose:()=>{e.onClose(),t.close()},showNewViewItems:!1})})}var Ig=()=>o(253335),_g=()=>o(521045),Mg=()=>o(641506);const Bg=n.memo((function(e){var t,r;let{collectionViewStore:i,collectionContextStore:l,hideUnderline:d,onViewClick:u,disabled:p,variant:m="default"}=e;const g=(0,s().O7)(),S=(0,s().MO)(),h=(0,c().Fg)(),[v,x]=(0,n.useState)(!1),b=(0,o(162178).oR)(),C=(0,ee().Dq)(),[w,k]=(0,a().VK)((()=>{var e;return["layoutBuilder"===l.viewsModuleContextStore.type,null===(e=l.viewsModuleContextStore.viewsModule())||void 0===e?void 0:e.getId()]}),[l.viewsModuleContextStore]),T=(0,n.useCallback)((()=>{C||x(!0)}),[C]),j=(0,n.useCallback)((e=>{e.preventDefault(),(0,de().ZP)({event:e,context:de().Af.EditorContextMenu,callback:T})}),[T]),R=(0,n.useCallback)((e=>{const t=l.collectionViewStore();if(!t)return;const o=ce().DJ(e);if(u({currentCollectionViewStore:t,newCollectionViewStore:i,openInNew:o}),t.id===i.id?T():function(e,t,o,n){V().f8({environment:o,collectionContextStore:t,collectionViewId:e,openInNew:n,isFullScreen:t.isFullScreenStore.state,isRootChild:t.isRootChildStore.state,isInPeekRenderer:t.isInPeekRendererStore.state})}(i.id,l,g,o),w&&b){var n;const e=null===(n=l.viewsModuleContextStore.viewsModule())||void 0===n?void 0:n.getId();e&&(b.setModuleSelection({type:"existing_module",moduleId:e,isDragging:!1}),y().r$({collectionContextStore:l,collectionSettingsStore:l.settingsStore,closeOnEscape:!1}))}f().wd({environment:g,collectionContextStore:l,action:"click_view_tab",new_view_type:i.getType(),new_view_id:i.id})}),[l,u,T,i,w,b,g]),P=(0,n.useCallback)((()=>{x(!1)}),[]),I=(0,n.useCallback)((()=>{let e;return e=S?{menuType:Yn().o.Modal,right:(0,$.jsx)(or().DoneMenuText,{}),onClickRight:P}:{menuType:Yn().o.Popup,minWidth:220},(0,$.jsx)(er().Z,{...e,children:(0,$.jsx)(vg,{collectionContextStore:l,collectionViewStore:i,onClose:P})})}),[l,i,S,P]),{currentViewStore:_,collectionViewBlockStore:M}=(0,a().VK)((()=>({currentViewStore:l.collectionViewStore(),collectionViewBlockStore:l.collectionViewBlockStore()})),[l]),{isDefinedCollectionViewStore:B,viewIcon:F,viewType:K}=(0,a().VK)((()=>({isDefinedCollectionViewStore:null==i?void 0:i.isDefined(),viewIcon:null==i?void 0:i.getFormat().collection_view_icon,viewType:null==i?void 0:i.getType()})),[i]),O=(null===(t=(0,X().jw)(l,h))||void 0===t?void 0:t.background)??"none",L=(0,n.useRef)(null),D=(0,a().VK)((()=>{var e,t;return!((null==M?void 0:M.getSpaceId())!==(null===(e=an().default.state.currentSpaceStore)||void 0===e?void 0:e.id))&&i.getFormat().app_config_uri===We().g3&&"sprint_board"===(null===(t=an().default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.getFormat().special_page_for_pm_launch)}),[i,M]),E=(0,a().VK)((()=>{var e;return!0===(null===(e=an().default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.getFormat().is_asana_imported_project)&&l.isInPeekRendererStore.state}),[l]),A=(0,a().VK)((()=>{var e;const t=null===(e=l.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores();return t&&t.length>1}),[l]),H=(null==_?void 0:_.id)===i.id,Z="pills"!==m&&!d&&H&&A,z=H&&w&&"existing_module"===(null==b||null===(r=b.currentModuleSelection)||void 0===r?void 0:r.type)&&b.currentModuleSelection.moduleId===k;return B&&_&&M?(0,$.jsx)(Zl().ZP,{popupType:S?Zl().kQ.SlideUp:Zl().kQ.Popup,alignmentToOrigin:we().Alignment.Start,open:v,render:I,onDismiss:P,origin:(0,$.jsxs)("div",{className:ie().rTm,style:{display:"flex",alignItems:"center",background:w?void 0:O,height:"100%",...Z&&{borderBottom:`2px solid ${h.regularTextColor}`,paddingTop:2},..."pills"===m?{marginRight:2}:void 0},onContextMenu:j,children:[D&&(0,$.jsx)(tn().FF,{origin:L}),E&&(0,$.jsx)(Pc().LS,{origin:L,store:l}),(0,$.jsx)(Fg,{collectionViewStore:i,render:e=>(0,$.jsxs)(zo().Z,{"aria-selected":H,role:"tab",ref:L,isLarge:"pills"===m,style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:Zt().Ue.medium,color:H?h.regularTextColor:h.mediumTextColor,maxWidth:Lg,..."pills"===m?{borderRadius:20,padding:"6px 12px"}:{},...w?z?(0,Mg().x6)({width:3,color:h.stroke.uiBluePrimary}):(0,Mg().x6)({width:1.5,color:h.stroke.uiBlueSecondary}):void 0,...w?{marginRight:4,transition:"box-shadow 0.3s"}:void 0},hovered:w?H&&!z:"pills"===m?v||H:v,hoveredStyle:w?{...(0,Mg().x6)({width:3,color:h.stroke.uiBlueSecondary}),background:"none"}:void 0,pressedStyle:w?{...(0,Mg().x6)({width:3,color:h.stroke.uiBluePrimary}),background:"none"}:void 0,onClick:R,disabled:p,...e,children:[(0,$.jsx)(rg().F,{color:H?"regular":"light",viewIcon:F,viewType:K,style:{marginRight:6}}),(0,$.jsx)("span",{style:{...Zt().Yu,marginTop:1},children:(0,$.jsx)(Og,{collectionContextStore:l,collectionViewStore:i})})]},i.id)})]})}):null}));function Fg(e){const t=(0,c().Fg)(),{collectionViewStore:o,render:n}=e,r=(0,E().Y$)(),i=(0,a().VK)((()=>{var e;const t=null===(e=o.getParentBlockStore())||void 0===e?void 0:e.id;return!!t&&((0,re().qG)(t)&&r.isInHomeWidgetStore.state)}),[r.isInHomeWidgetStore,o]),[l,s]=(0,a().VK)((()=>{const e=o.getName(),t=o.getType(),n=(0,X().Cc)({collectionViewName:e,collectionViewType:t});if(!t)return[n,void 0];const r=o.getFormat().description;if(r)return[n,r];const i=o.getCollectionStore(),l=null==i?void 0:i.getName();if(i&&l){var s,a;if((null==i||null===(s=i.getParentBlockStore())||void 0===s?void 0:s.id)===(null===(a=o.getParentBlockStore())||void 0===a?void 0:a.id))return[n,(0,$.jsx)(qe()._H,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} Form {Form} Chart {Chart view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:tt().Bh[t],collection:(0,sg().Xh)(l,i)}},"viewTab.tooltip.2")]}return[n,(0,$.jsx)(qe()._H,{id:"collectionTabBar.viewTab.tooltip.default",defaultMessage:"{viewType} view",values:{viewType:tt().Bh[t]}},"viewTab.tooltip.2")]}),[o]);return l?(0,$.jsx)(gt().Z,{placement:i?we().Placement.Top:we().Placement.Bottom,originGap:i?0:void 0,alignment:we().Alignment.Start,delayThreshold:500,style:i?{marginBottom:-5,marginLeft:8}:{},render:e=>i?(0,$.jsx)("div",{style:{marginLeft:-8},children:n(e)}):n(e),renderTooltip:e=>i?(0,$.jsx)(qe()._H,{id:"collectionTabBar.myTasksWidget.tooltip",defaultMessage:"See all your tasks in one place"}):(0,$.jsxs)("div",{...e,style:Ic().F6,children:[l,(0,$.jsx)("div",{style:{color:t.mediumInvertedTextColor},children:s})]})}):null}function Kg(e,t,o){var n;const r=e.collectionStore();if(!r)return t.getName();const i=r.getPropertyMapping(),l=t.getName(),s=null==i?void 0:i[We().Es.TaskToSprintRelation];if(!o||!s||l!==nt().Z.formatMessage(Ig().sY.tasksCurrentSprintV2ViewName))return t.getName();const a=o[s];if(!a||"relation"!==a.type||!a.collection_pointer)return t.getName();const c=null===(n=(0,_g().As)(e,"current",a.collection_pointer,r))||void 0===n?void 0:n.getBlockTitleStore().getValue();return c?`${nt().Z.formatMessage(Ig().sY.tasksCurrentSprintV2ViewNamePrefix)}: ${c[0]}`:t.getName()}function Og(e){const{collectionViewStore:t,collectionContextStore:o}=e,[n,r]=(0,a().VK)((()=>{const e=o.settingsStore.state;return[e.open,S().Z$(e.stack)]}),[o.settingsStore]),i=(0,a().VK)((()=>o.viewsModuleContextStore.state),[o.viewsModuleContextStore]),l=(0,a().VK)((()=>o.collectionViewStore()),[o]),s=(0,a().VK)((()=>t.getCollectionStore()),[t]),c=(0,a().VK)((()=>{if(t.isDefined()){return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===We().g3&&null!=s&&s.isDefined()?{name:Kg(o,t,s.getSchema()),type:t.getType()}:{name:t.getName(),type:t.getType()}}}),[t,s,o]),d=n&&r&&("duplicateExistingView"===r.type||"createView"===r.type);return!c||(null==l?void 0:l.id)===t.id&&d&&!i?(0,$.jsx)(qe()._H,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):(0,$.jsx)(bg().Z,{collectionViewName:c.name,collectionViewType:c.type})}const Lg=220,Dg=n.memo((function(e){const{collectionContextStore:t,showHoverActionsStore:r,isPlaceholderExternalCollection:i,showOnlyCurrentView:l,onViewClick:d,disabled:u,variant:p="default"}=e,m=(0,n.useRef)(new(Ke().E)({throttleMs:50})),g=(0,n.useRef)(new Map),S=(0,s().O7)(),h=(0,s().MO)(),y=(0,c().Fg)(),v=(0,n.useRef)(null),x=(0,n.useRef)(null),b=(0,a().Kw)(r),C=(0,ee().Dq)(),k=(0,n.useRef)(null),{permissionScopes:T,isFullScreen:j,isInHomeWidget:R,isInCollectionViewPageWithContent:P,isEditingViewsModuleInPageBuilder:I}=(0,a().VK)((()=>{var e;return{permissionScopes:t.permissionScopesStore.state,isFullScreen:t.isFullScreenStore.state,isInHomeWidget:t.isInHomeWidgetStore.state,isInCollectionViewPageWithContent:null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent(),isEditingViewsModuleInPageBuilder:"layoutBuilder"===t.viewsModuleContextStore.type}}),[t]),_=(0,a().VK)((()=>{var e;return l?[]:(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[t,l]),M=(0,a().VK)((()=>Boolean(Ie().ZP.state.showOnboardingTour&&"database-views-and-filters-tooltip"===(0,o(731322).wF)(an().default.state.currentUserSettingsStore,"jira-sync-onboarding"))),[]);(0,n.useEffect)((()=>{const e=m.current;return()=>{e.destroy()}}),[m]);const B=(0,n.useCallback)((e=>{let t=g.current.get(e.id);t||(t=new tg({style:{fontSize:`${Zt().JB.UIRegular.desktop}px`,fontWeight:Zt().Ue.medium}}),g.current.set(e.id,t));const o=(0,X().Cc)({collectionViewName:e.getName(),collectionViewType:e.getType()}),n=t.measure(o);return Math.min(40+n.width,Lg)}),[g]),F=(0,a().VK)((()=>function(e,t,o,n){var r;if("collectionSettings"===e.contextType)return!1;if(n||t||o)return!1;if(!e.permissionScopesStore.state.canConfigureBlock)return!1;const i=null===(r=e.collectionViewBlockStore())||void 0===r?void 0:r.id;if(i&&(0,re().qG)(i))return!1;return!0}(t,i,(null==C?void 0:C.isPreviewing)??!1,l)),[t,i,null==C?void 0:C.isPreviewing,l]),K=(0,a().VK)((()=>{const e=t.collectionViewStore();if(!e)return;if("collectionSettings"===t.contextType)return[];const o=Math.max(100,F?105:0);let n=m.current.rect.state.width-o;const r=[],i=B(e);if(!(i<n))return r;r.push(e),n-=i;for(const t of _){if(t.id===e.id)continue;const o=B(t);if(!(o<n))break;r.push(t),n-=o}const l=r.filter((t=>t.id!==e.id)),s=_.findIndex((t=>t.id===e.id));return l.splice(s,0,e),l}),[t,F,B,_]),O=(0,a().VK)((()=>"collectionSettings"===t.contextType),[t]),L=(0,n.useMemo)((()=>{const e=(null==K?void 0:K.length)||0,t=_.length-e,o=K&&(0===e||1===e&&_.length>1)||h||P||R,n=O?"allTabsVisible":o?"dropdown":t>0?"someTabsNotVisible":"allTabsVisible";return{showMoreViewsButton:"someTabsNotVisible"===n||"dropdown"===n,showAddViewButton:F&&"allTabsVisible"===n,addViewButtonAnimatedIn:j||b||I,viewSelectState:n,moreViewsCount:t}}),[K,_,h,P,R,F,j,b,I,O]),D=(0,n.useCallback)((e=>{e&&m.current.observe(e)}),[m]),E=(0,n.useMemo)((()=>{if(K&&"dropdown"!==L.viewSelectState)return!T.canConfigureBlock||null!=C&&C.isPreviewing?K.map(((e,o)=>{const r=n.createRef();return 0===o&&M?(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("div",{ref:r,style:{boxShadow:qm().v.outlineBlueInputBoxShadow.light,borderRadius:6},children:(0,$.jsx)(Ag,{collectionContextStore:t,onViewClick:d,disabled:u,collectionViewStore:e,showOnlyCurrentView:l,variant:p},e.id)}),(0,$.jsx)(Qm().Pe,{origin:r})]}):(0,$.jsx)(Ag,{collectionContextStore:t,onViewClick:d,disabled:u,collectionViewStore:e,showOnlyCurrentView:l,variant:p},e.id)})):(0,$.jsx)(Cl().ZP,{direction:"horizontal",keys:K.map((e=>e.id)),style:{height:"100%"},disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:(e,o)=>{const r=K.find((t=>t.id===e));if(r){const e=n.createRef();return 0===o&&M?(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("div",{ref:e,style:{boxShadow:qm().v.outlineBlueInputBoxShadow.light,borderRadius:6},children:(0,$.jsx)(Ag,{collectionContextStore:t,onViewClick:d,disabled:u,collectionViewStore:r,showOnlyCurrentView:l,variant:p},r.id)}),(0,$.jsx)(Qm().Pe,{origin:e})]}):(0,$.jsx)(Ag,{collectionContextStore:t,onViewClick:d,disabled:u,collectionViewStore:r,showOnlyCurrentView:l,variant:p})}},onDrop:e=>function(e,t,o){const n=o.collectionViewBlockStore();if(!n)return;w().createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:t,canUndo:!0,perform:t=>{V().Wu({collectionViewBlockStore:n,newViewIds:e,transaction:t})}})}(e,S,t)})}),[K,L.viewSelectState,T.canConfigureBlock,t,d,u,C,l,S,M,p]),A=(0,n.useCallback)((e=>{const{device:o}=S,n=t.collectionViewStore();if(null!=n&&n.isDefined()){if("dropdown"===L.viewSelectState){var r;const i=n.getType(),l=n.getFormat().collection_view_icon,s=u||R,a="page"===n.getType()&&(null===(r=t.collectionStore())||void 0===r?void 0:r.getFormat().app_config_uri)===We().GZ;return(0,$.jsxs)($.Fragment,{children:[!o.isMobile&&a&&"home"===fc().B1()&&(0,$.jsx)(Xm,{origin:v}),(0,$.jsx)(Fg,{collectionViewStore:n,render:r=>(0,$.jsxs)(zo().Z,{ref:v,style:{display:"flex",alignItems:"center",fontSize:s?Zt().JB.UISmall.desktop:Zt().JB.UIRegular.desktop,fontWeight:Zt().Ue.semibold,color:s?y.mediumTextColor:y.regularTextColor,maxWidth:"form_editor"===i&&o.isMobile?120:Lg,paddingRight:s?0:void 0,..."pills"===p?{borderRadius:20}:void 0},hovered:"pills"===p||void 0,isLarge:"pills"===p,disabled:u,...(0,mr().Z)(e,r),children:[(0,$.jsx)(rg().F,{color:s?"lightGray":"regular",viewType:i,viewIcon:l,style:{marginRight:s?8:6,marginLeft:s?0:5},size:s?14:void 0}),(0,$.jsx)("span",{style:{...Zt().Yu,marginRight:6,marginTop:1},children:(0,$.jsx)(Og,{collectionContextStore:t,collectionViewStore:n})}),!u&&(0,Si().i)({marginTop:2,width:10,height:10,fill:y.lightIconColor,marginRight:6})]})})]})}return"someTabsNotVisible"===L.viewSelectState?(0,$.jsx)(zo().Z,{style:{display:"flex",alignItems:"center",fontSize:Zt().JB.UIRegular.desktop,color:y.mediumTextColor,..."pills"===p?{borderRadius:20}:{}},isLarge:"pills"===p,...e,children:(0,$.jsx)("span",{style:{marginTop:1},children:(0,$.jsx)(qe()._H,{defaultMessage:"{moreViewsCount} more",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:L.moreViewsCount}})})}):void 0}}),[t,u,S,R,L.moreViewsCount,L.viewSelectState,y,p]),H=(0,n.useCallback)((e=>{var o;const{device:n}=S,r=(null===(o=t.collectionStore())||void 0===o?void 0:o.getFormat().app_config_uri)===We().GZ;return(0,$.jsxs)($.Fragment,{children:[!n.isMobile&&"views"===fc().B1()&&r&&(0,$.jsx)(Jm,{origin:x}),(0,$.jsx)("div",{ref:x,children:(0,$.jsx)(kg,{collectionContextStore:t,onClose:e.close,onViewClick:d,onAddViewClick:e=>function(e,t,o){w().createAndCommit({userAction:e,environment:t,canUndo:!0,perform:e=>{V().ME({environment:t,collectionContextStore:o,newViewType:"table",transaction:e})}}),f().xb({environment:t,collectionContextStore:o,view_type:"table"})}(e,S,t)})})]})}),[t,S,d]),Z=(0,n.useCallback)((e=>{(0,de().ZP)({event:e,context:de().Af.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]);return(0,$.jsx)(Le().D1,{collectionContextStore:t,step:"views",containerRef:k,children:(0,$.jsx)("div",{role:"tablist",style:{display:"flex",alignItems:"center",height:"100%",flexGrow:1,overflow:"hidden",...I?{paddingLeft:2}:{}},ref:D,children:(0,$.jsxs)("div",{ref:k,style:{display:"flex",alignItems:"center",flexShrink:1,height:"100%"},children:[E,L.showMoreViewsButton&&(0,$.jsx)("div",{onMouseDown:Z,children:(0,$.jsx)(vr().ZP,{popupType:h?Zl().kQ.SlideUp:Zl().kQ.Popup,render:e=>H(e),renderOrigin:A,onClick:()=>function(e,t){f().wd({environment:e,collectionContextStore:t,action:"click_views_dropdown"})}(S,t)})}),(0,$.jsx)(Eg,{renderState:L,collectionContextStore:t,preventRectangularSelection:Z,variant:p,theme:y})]})})})}));function Eg(e){let{renderState:t,collectionContextStore:n,preventRectangularSelection:r,variant:i,theme:l}=e;const s=(0,a().VK)((()=>"viewsMain"===n.viewsModuleContextStore.getViewModuleType()),[n]);if(!t.showAddViewButton)return null;let c=null;return c=s?(0,$.jsx)(ng,{renderOrigin:e=>(0,$.jsx)(mt().Z,{ariaLabel:"Add view",className:ie().rVO,icon:Go().R,...e,style:{..."pills"===i?{height:32,width:32,borderRadius:"100%"}:void 0,background:"light"===l.mode?l.accentColors.uiBlue[100]:l.accentColors.uiBlue[200]},hoveredStyle:{color:l.accentColors.uiBlue[600],background:"light"===l.mode?l.accentColors.uiBlue[200]:l.accentColors.uiBlue[300]},pressedStyle:{color:l.accentColors.uiBlue[600],background:"light"===l.mode?l.accentColors.uiBlue[300]:l.accentColors.uiBlue[400]},iconStyle:{fill:l.accentColors.uiBlue[600]}})}):(0,$.jsx)(vr().ZP,{popupType:vr().Z4.Popup,alignmentToOrigin:o(627990).v2.Center,render:e=>(0,$.jsx)(Ym().vE,{collectionContextStore:n,onClose:e.close,showNewViewItems:!0}),renderOrigin:e=>(0,$.jsx)(mt().Z,{ariaLabel:"Add view",className:ie().rVO,icon:Go().R,...e,style:{..."pills"===i?{height:32,width:32,borderRadius:"100%"}:void 0}})},"suggested-views"),(0,$.jsx)(ut().Z,{visible:t.addViewButtonAnimatedIn,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},onMouseDown:r,children:c})}function Ag(e){let{collectionViewStore:t,collectionContextStore:o,onViewClick:n,disabled:r,showOnlyCurrentView:i,variant:l="default"}=e;return(0,$.jsx)(Bg,{collectionContextStore:o,collectionViewStore:t,onViewClick:n,disabled:r,hideUnderline:i,variant:l},t.id)}var Hg=()=>o(560287),Zg=()=>o(511614),zg=()=>o(251932);function Gg(e){const{collectionContextStore:t}=e,o=(0,a().VK)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getParentBlockStore();return o&&o.pathIsDead()}),[t]),{parentBlockStore:n,isParentCollectionDead:r}=(0,a().VK)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getParentBlockStore(),n=o&&(null==o?void 0:o.pathIsDead());return{parentBlockStore:o,isParentCollectionDead:n}}),[t]);return n&&(!o&&r)?(0,$.jsx)(Wg,{parentBlockStore:n}):null}function Wg(e){let{parentBlockStore:t}=e;const o=(0,s().O7)(),{isMobile:r}=(0,s().Fy)(),i=r?zg().Ht:zg().gq,l=(0,c().yK)((e=>({layoutComponent:{color:e.text.secondary,background:e.accentColors.gray[30],padding:"16px 16px 16px 12px",borderRadius:4,fontSize:14},trashIcon:{width:24,height:24,flexShrink:0,marginRight:10,padding:2},viewCollectionButton:{fontWeight:Zt().Ue.semibold},arrowIcon:{width:16,height:16,flexShrink:0,padding:2,marginLeft:4}})),[]),a=(0,n.useCallback)((()=>{(0,ne().K4)(o,"view_deleted_database_from_deleted_collection_view_banner"),Zg().r({environment:o,store:t,pageVisitSource:Po().tY.LinkInPage})}),[o,t]);return(0,$.jsxs)(i,{style:l.layoutComponent,alignItems:"center",justifyContent:r?"":"space-between",children:[(0,$.jsxs)(zg().gq,{alignItems:"center",children:[(0,rt().y)(l.trashIcon),(0,$.jsx)(qe()._H,{id:"collectionViewBlock.deletedContainerBanner.collectionInTrash",defaultMessage:"The original database has been deleted and cannot be edited"})]}),(0,$.jsxs)(zo().Z,{style:l.viewCollectionButton,onClick:a,isLightGray:!0,children:[(0,$.jsx)(qe()._H,{id:"collectionViewBlock.deletedContainerBanner.collection.viewCollectionButton",defaultMessage:"View database"}),(0,Fa().k)(l.arrowIcon)]})]})}const Ng=n.memo(Gg);var Ug=()=>o(650996);const $g=new(G().Ss)("formEditorActionButtons",(()=>Promise.all([o.e(62743),o.e(52774),o.e(90698),o.e(37358),o.e(5242),o.e(7312),o.e(81580),o.e(84325),o.e(31189),o.e(69343),o.e(46293),o.e(2971),o.e(80741),o.e(72586),o.e(46616),o.e(54940),o.e(49396),o.e(98721),o.e(98032),o.e(57229),o.e(63707),o.e(91253),o.e(4642),o.e(5006),o.e(6612),o.e(75377),o.e(31020),o.e(2942),o.e(73682),o.e(54803),o.e(1953),o.e(10216),o.e(58565),o.e(69197),o.e(42055),o.e(38739),o.e(44751),o.e(81567),o.e(34291),o.e(95076),o.e(82658),o.e(77404),o.e(78),o.e(22122)]).then(o.bind(o,771692)))),qg=(0,G().iS)($g,(e=>e.default));var Yg=()=>o(867601),Qg=()=>o(720029),Xg=()=>o(115098);function Jg(){const e=(0,E().DK)(),t=(0,a().VK)((()=>Boolean(null==e?void 0:e.shouldShowSpinnerStore.state)),[null==e?void 0:e.shouldShowSpinnerStore]);return(0,Bn().Z)(t,500,100)?(0,$.jsx)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginRight:4},children:(0,$.jsx)(Zo().Z,{style:{width:14,height:14}})}):null}const eS=n.memo(Jg);var tS=()=>o(735957),oS=()=>o(291198);const nS=(0,qe().vU)({searchLabel:{defaultMessage:"Search",id:"database.searchButton.tooltip"},searchInputPlaceholder:{defaultMessage:"Type to search...",id:"database.searchInputPlaceholder"}}),rS=n.memo((function(e){let{collectionContextStore:t,isFullScreen:o,currentViewType:r,topbarIconButtonStyle:i}=e;const l=(0,s().O7)(),d=(0,a().Kw)(t.searchOpenStore),u=(0,a().VK)((()=>0===t.collectionStoresStore.state.length),[t]),p=(0,a().Kw)(t.searchQueryStore),m=(0,c().yK)((e=>({iconButton:{width:14,height:void 0,fill:e.mediumIconColor},input:{fontSize:14,lineHeight:1,paddingRight:4,color:e.regularTextColor,marginBottom:1},ignoreArea:{display:"flex",alignItems:"center",overflow:"hidden"}})),[]),g=(0,n.useCallback)((()=>{N().default.reset(),U().default.reset(),od().Z.reset()}),[]),S=(0,n.useCallback)((()=>{t.searchQueryStore.setState(""),t.searchOpenStore.setState(!1)}),[t]),h=(0,n.useCallback)((()=>{t.searchQueryStore.state||S()}),[t,S]),y=(0,n.useCallback)((e=>{27===e.keyCode&&S()}),[S]),v=(0,n.useCallback)((()=>{t.searchOpenStore.update((e=>!e)),f().wd({environment:l,collectionContextStore:t,action:"click_topbar_search"})}),[t,l]),x=(0,n.useCallback)((e=>{V().Ug({searchQuery:e.target.value,collectionContextStore:t,isFullScreen:Boolean(o)}),j().ik(l,{view_type:r})}),[t,r,l,o]),b=(0,qo().y)(x,250);return(0,$.jsx)(gt().Z,{renderTooltip:()=>nt().Z.formatMessage(nS.searchLabel),render:e=>(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(mt().Z,{...e,icon:tS().e,iconStyle:m.iconButton,style:i,disabled:u,onClick:v,ariaLabel:nt().Z.formatMessage(nS.searchLabel)}),(0,$.jsx)(ut().Z,{visible:d,animate:{width:150,opacity:1},initial:{width:0,opacity:0},exit:{width:0,opacity:0},children:(0,$.jsx)(Ze().Z,{capture:d,allowEsc:!0,render:e=>(0,$.jsx)("div",{...e,style:m.ignoreArea,children:(0,$.jsx)(oS().Z,{style:m.input,right:(0,$.jsx)(Ug().LazyAssistantCollectionSearchInputButton,{collectionContextStore:t}),format:oS().B.Transparent,value:p,onChange:b,placeholder:nt().Z.formatMessage(nS.searchInputPlaceholder),focusInitial:d,showClearButton:!0,onFocus:g,onBlur:h,onCancel:S,onClick:de().Wi,onClearButtonClick:S,onKeyDown:y})})})})]})})}),Nt().Z),iS=rS;const lS={CollectionViewAddItemButtonTooltip:new(G().Ss)("CollectionViewAddItemButtonTooltip",(async()=>Promise.all([o.e(62743),o.e(52774),o.e(73298)]).then(o.bind(o,253602))))},sS=(0,G().kF)(lS.CollectionViewAddItemButtonTooltip,(e=>e.CollectionViewAddItemButtonTooltip)),aS=n.memo((function(e){let{store:t,settingsHeaderSizeObserver:r,handleAddItemClick:i,isTooltipVisible:l,collectionModel:d}=e;const u=(0,s().O7)(),{isMobile:p}=(0,s().Fy)(),m=(0,fe().E)("packaging_m3.1"),g=(0,n.useRef)(null),S=(0,E().Y$)(),h=(0,a().VK)((()=>S.isMultiSourceView),[S]),y=(0,a().VK)((()=>(0,X().PI)(S)),[S]),v=(0,a().qz)(void 0,ke().Z),x=(0,a().VK)((()=>r.rect.state.width<=eh),[r]),b=(0,a().VK)((()=>{if(!S.isMultiSourceView)return;const e=S.collectionStoresStore.state;if(!e)return"loading";if(0===e.length)return"noDbs";const t=Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));return t?void 0:fm}),[S]),C=!p&&x,k=h,T=(0,c().yK)((e=>({buttonWrapper:{position:"relative",marginLeft:C?4:2},buttonStyle:{fontSize:14,height:28},mainButtonStyle:C?{width:28}:{},iconStyle:C?{width:15,marginRight:0}:{},offlineMessage:{fontSize:14,color:e.mediumTextColor,width:280,padding:8}})),[C]),j=(0,n.useCallback)((()=>{l&&((0,o(110372).bl)(u,{callout_key:"collection_add_item_button_tooltip",dismiss_type:"tooltip_dismiss"}),(0,la().Gi)(u,"collection_add_item_button_tooltip"))}),[u,l]),R=(0,n.useCallback)((()=>{f().wd({environment:u,collectionContextStore:S,action:"click_topbar_templates_dropdown"}),j()}),[S,u,j]),P=(0,a().VK)((()=>{const e=S.collectionStore();if(!e)return null;if(o(804217).default.state.online){const n=S.permissionScopesStore.state,r=e=>{w().createAndCommit({userAction:"CollectionViewBlock.handleTemplateEmptyPageClick",environment:u,canUndo:!0,perform:e=>{(0,V().NZ)({transaction:e,store:t,collectionContextStore:S,environment:u,shouldCoerce:!1,from:{createBlock:"cvb_template_empty_page"}})}}),v.reset()},i=e=>{o(295274).S6({environment:u,collectionContextStore:S,collectionViewBlockStore:t,templateStore:e.templateStore,useCrdt:e.useCrdt,isKeyboard:e.isKeyboard,from:{createBlock:"cvb_template",initCollection:"collection_view_block"},shouldCoerce:!0}),v.reset()},l=()=>{v.reset()};return(0,$.jsx)(o(39607).Z,{isOverlay:!0,collectionStore:e,canConfigureCollection:n.canConfigureCollection,onEmptyPageClick:r,onEmptyEnter:r,onTemplateClick:i,onCancelClick:l,locked:t.isNonEditableState()})}return(0,$.jsx)("div",{style:T.offlineMessage,children:(0,$.jsx)(qe()._H,{defaultMessage:"Please go online to use a template.",id:"collectionViewBlock.actionBar.offlineTemplatePicker.message"})})}),[S,u,t,T.offlineMessage,v]),I=(0,n.useCallback)((e=>{var t;const o=null===(t=g.current)||void 0===t?void 0:t.getBoundingClientRect();o&&gd().Pz({environment:u,originRect:o,moveToContext:"aggregated_type",overrideDatabaseType:"notion://tasks_collection",onAccept:()=>{i(e)}})}),[u,i]),_=(0,n.useCallback)((e=>(0,$.jsx)(o(542401).Z,{ref:g,title:C?null:y,icon:C?o(419273).f:void 0,color:"blue",onClick:e=>{h?I(e):i(e),j()},mainButtonTooltip:b===fm?(0,$.jsx)(qe()._H,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"collectionViewBlock.addItem.tooltip.noWritableDbs",values:{br:(0,$.jsx)("br",{})}}):C?y:null,onDropdownClick:e.onClick,style:T.buttonStyle,mainButtonStyle:T.mainButtonStyle,iconStyle:T.iconStyle,className:ie().sqL,disabled:Boolean(b),disableDropdown:k})),[y,k,j,i,h,b,I,C,T.buttonStyle,T.iconStyle,T.mainButtonStyle]),M=(0,n.useRef)(null),B=(0,n.useCallback)((e=>m?(0,$.jsx)(Le().D1,{collectionContextStore:S,containerRef:M,step:"new_page",children:_(e)}):l?(0,$.jsx)(sS,{collectionModel:d,onDismiss:j,children:_(e)}):_(e)),[S,d,j,l,_,m]);return(0,$.jsx)(vr().ZP,{popupType:p?Mc().k.SlideUp:Mc().k.Popup,render:()=>P,originGap:4,onClick:R,renderOrigin:e=>(0,$.jsx)("div",{style:T.buttonWrapper,ref:M,children:B(e)}),buttonPopupStore:v})}));var cS=()=>o(642966),dS=()=>o(887330);function uS(){const e=(0,E().Y$)(),t=(0,a().VK)((()=>e.settingsStore.state.open&&Yg().Cf({tab:(0,cS().n)(e.settingsStore)})),[e]),r=(0,a().Kw)(e.isInHomeWidgetStore),i=(0,a().VK)((()=>e.aliveAutomationCountStore.state>0),[e]),l=(0,a().VK)((()=>e.collectionViewBlockStore()),[e]),s=(0,a().VK)((()=>{var e;return null===(e=an().default.getState().mainEditorCurrentBlockStore)||void 0===e?void 0:e.pathIsDead()}),[]),d=(0,a().VK)((()=>{const t=e.collectionStore(),o=null==t?void 0:t.getParentBlockStore();return null==o?void 0:o.pathIsDead()}),[e]),u=(0,a().VK)((()=>null==l?void 0:l.isLocked()),[l]),p=(0,n.useMemo)((()=>(d||s)&&!i),[i,s,d]),m=(0,c().yK)((e=>({buttonStyle:(0,dS().C)({theme:e,isInHomeWidget:r}),iconStyle:{width:void 0,height:14,fill:i?e.icon.uiBluePrimary:e.mediumIconColor}})),[i,r]),g=(0,a().VK)((()=>Yg().Li({collectionStore:e.collectionStore()})),[e]),S=(0,n.useCallback)((t=>{(0,de().ZP)({event:t,context:de().Af.CollectionAutomationSettingsClick,callback:()=>{const t=e.settingsStore,o=t.state.open,n=(0,cS().n)(t);o&&"automationSettings"===(null==n?void 0:n.type)?y().E3({collectionSettingsStore:t}):(y().r$({collectionContextStore:e,collectionSettingsStore:t}),y().wl({collectionSettingsStore:t,item:{source:"collection_thunderbolt_icon",type:"automationSettings"}}),i||u||s||d||!g||y().Uk(t))}})}),[e,i,u,s,d,g]);return(0,$.jsx)(gt().Z,{renderTooltip:()=>p?nt().Z.formatMessage(pS.disableAutomationsSettingsButtonTooltip):nt().Z.formatMessage(pS.openAutomationsSettingsButtonTooltip),render:e=>(0,$.jsx)(mt().Z,{ariaLabel:p?nt().Z.formatMessage(pS.disableAutomationsSettingsButtonAriaLabel):nt().Z.formatMessage(pS.openAutomationsSettingsButtonAriaLabel),className:ie().RIA,icon:o(850790).K,style:m.buttonStyle,iconStyle:m.iconStyle,hovered:t,onClick:S,disabled:p,...e})})}const pS=(0,qe().vU)({openAutomationsSettingsButtonTooltip:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.tooltip"},openAutomationsSettingsButtonAriaLabel:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.ariaLabel"},disableAutomationsSettingsButtonTooltip:{defaultMessage:"Can't add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.tooltip"},disableAutomationsSettingsButtonAriaLabel:{defaultMessage:"Can't add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.ariaLabel"}}),mS=n.memo(uS);var gS=()=>o(931756),SS=()=>o(765458),hS=()=>o(347577);const fS=(0,qe().vU)({filterLabel:{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"}});function yS(e){let{createFilterSettingsStore:t}=e;const r=(0,E().Y$)(),i=(0,s().O7)(),{isMobile:l,isPhone:d}=(0,s().Fy)(),u=(0,a().VK)((()=>t.state.open),[t]),p=(0,a().VK)((()=>(0,oo().RL)({collectionContextStore:r,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}).length>0),[r]),m=(0,a().VK)((()=>(0,oo().yU)(r)),[r]),g=nt().Z.formatMessage(fS.filterLabel),S=(0,a().Kw)(r.isInHomeWidgetStore),h=(0,n.useCallback)((()=>{var e;const o=null===(e=r.collectionViewStore())||void 0===e?void 0:e.id,n=r.permissionScopesStore.state,l=r.isUnlistedViewStore.state&&r.isInlineViewStore.state,s=n.canConfigureBlock||l?r.currentCombinatorFilterStore.state:void 0,a=r.currentPropertyFiltersStore.state,c=r.filtersBarOpenStore.state;o&&!d&&((0,V().E7)({userId:i.currentUser.id,collectionViewId:o,isOpen:!c}),r.filtersBarOpenStore.setState(c)),S||l?c||a.length>0||s?y().wl({collectionSettingsStore:r.settingsStore,item:{type:"filters"}}):(y().wl({collectionSettingsStore:r.settingsStore,item:{type:"createFilter"}}),gS()._7(r)):c||a.length>0||s?r.filtersBarOpenStore.setState(!c):(y().wl({collectionSettingsStore:t,item:{type:"createFilter"}}),gS()._7(r)),f().wd({environment:i,collectionContextStore:r,action:"click_topbar_filter"})}),[r,t,i,S,d]),v=(0,n.useCallback)((()=>{y().E3({collectionSettingsStore:t})}),[t]),x=(0,c().yK)((e=>({buttonStyle:(0,dS().C)({theme:e,isInHomeWidget:S}),iconStyle:{width:16,height:void 0,fill:p?e.icon.uiBluePrimary:e.mediumIconColor},searchIcon:{width:14,fill:e.mediumIconColor,marginRight:6},tempFilterIndicator:{position:"absolute",top:3,right:2,background:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[300],border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9}})),[S,p]);return(0,$.jsx)(Zl().ZP,{popupType:l?vr().Z4.SlideUp:vr().Z4.Popup,open:u,origin:(0,$.jsx)(gt().Z,{renderTooltip:()=>g,render:e=>(0,$.jsxs)("div",{style:{position:"relative"},children:[(0,$.jsx)(mt().Z,{...e,ariaLabel:g,icon:o(547430).Q,iconStyle:x.iconStyle,style:x.buttonStyle,onClick:h}),m&&(0,$.jsx)("div",{style:x.tempFilterIndicator})]})}),onDismiss:v,originGap:4,render:()=>(0,$.jsx)(SS().PJ,{context:hS().HV.TopbarFilterPopup,collectionContextStore:r,collectionSettingsStore:t,hideDesktopHeader:!0})})}const vS=n.memo(yS);const xS=(0,qe().vU)({openFullscreenPageButtonTooltip:{id:"database.collectionViewBlock.openFullscreenPageButton.tooltip",defaultMessage:"Open as full page"}});function bS(e){let{store:t,viewType:r}=e;const i=(0,s().O7)(),l=(0,E().Y$)(),d=(0,a().VK)((()=>(0,ln().ZP)({store:t,fullyQualified:!1,pageVisitSource:Po().tY.Expand,demoSettingsStore:Qg().Z})),[t]),u=(0,c().Fg)(),p=(0,a().VK)((()=>{const e=l.isInHomeWidgetStore.state;return(0,dS().C)({theme:u,isInHomeWidget:e})}),[l,u]),m=(0,n.useCallback)((()=>j().Ji(i,{view_type:r})),[i,r]),g=nt().Z.formatMessage(xS.openFullscreenPageButtonTooltip);return(0,$.jsx)(gt().Z,{renderTooltip:()=>g,render:e=>(0,$.jsx)(mt().Z,{ariaLabel:g,href:d,onClick:m,icon:o(998215).Z,style:p,iconStyle:{width:16},...e})})}const CS=n.memo(bS);var wS=()=>o(552221),kS=()=>o(574089);class VS extends d().default{getInitialState(){return{query:"",limit:20}}}const TS=VS;var jS=()=>o(231219);const RS=(0,qe().vU)({searchPlaceholder:{defaultMessage:"Search for a page",id:"collectionNoDateMenu.searchPlaceholder"}}),PS=d().default.createClass(void 0,{name:"ResultStore"});function IS(e){let{collectionViewBlockStore:t,collectionViewType:r,property:i,collectionContextStore:l,onClose:c,onAddPage:d}=e;const u=(0,s().O7)(),p=(0,s().Fy)(),m=(0,a().qz)(void 0,TS),g=(0,a().qz)(void 0,PS),S=(0,a().VK)((()=>m.state.query),[m]),h=(0,a().Kw)(g),f=(0,a().VK)((()=>{const{query:e,limit:t}=m.state;return{type:"results",filter:{operator:"and",filters:[{property:i,filter:{operator:"is_empty"}}]},limit:t,searchQuery:e}}),[i,m]),y=(0,n.useCallback)((e=>{m.setState({query:e.target.value,limit:BS})}),[m]),v=(0,n.useCallback)((e=>{const t=m.state.limit,o=l.isLoadingStore.state;e<MS&&h&&h.hasMore&&!o&&m.setState({...m.state,limit:t+BS})}),[l,h,m]),x=(0,n.useCallback)((()=>{let e;return e="calendar"===r?p.isMobile?(0,$.jsx)(qe()._H,{defaultMessage:"Click to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt.basic"}):(0,$.jsx)(qe()._H,{defaultMessage:"Click or drag to calendar to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt"}):(0,$.jsx)(qe()._H,{defaultMessage:"Click to add to the timeline",id:"collectionNoDateMenu.addResultToTimeline.prompt"}),h?h&&0===h.blockIds.length?(0,$.jsx)(nr().Z,{title:e,children:(0,$.jsx)(Hl().Z,{title:(0,$.jsx)(qe()._H,{defaultMessage:"No results",id:"collectionNoDateMenu.noResults.title"})})}):(0,$.jsx)(tr().Z,{type:tr().i.Vertical,sections:[{key:"results",render:t=>(0,$.jsx)(nr().Z,{...t,title:e}),items:OS(h.blockIds,l,t,i,d,u,r)}],initialFocus:S?0:void 0}):(0,$.jsx)(nr().Z,{children:(0,$.jsx)(KS,{})})}),[t,r,h,l,i,d,u,S,p.isMobile]);return(0,$.jsxs)(o(788899).Tp,{title:void 0,onCancel:c,desktopWidth:320,children:[(0,$.jsx)(nr().Z,{isInput:!0,children:(0,$.jsx)(Al().ZP,{placeholder:nt().Z.formatMessage(RS.searchPlaceholder),focus:!p.isMobile||void 0,focusAfterAnimation:!0,value:S,onChange:y})}),(0,$.jsx)(Xt().Z,{id:"no_date_results",reducer:f,collectionContextStore:l,render:x,resultStore:g}),(0,$.jsx)(jo().Z,{onChange:v})]})}const _S=n.memo(IS,Nt().Z),MS=200,BS=20;function FS(e){let{props:t,store:o,disabled:r,url:i,collectionViewType:l}=e;const a=(0,s().O7)(),c=(0,s().Fy)(),d=n.useRef(null),u=(0,$.jsx)(jS().Z,{...t,ref:d,store:o,hidePath:!0,disabled:r,right:void 0!==i?(0,$.jsx)(zo().Z,{isSmall:!0,href:i,disabled:r,onClick:()=>{j().tM(a)},children:(0,$.jsx)(qe()._H,{defaultMessage:"Open",id:"collectionNoDateMenu.view.button.label"})},o.id):void 0,dontShrinkRight:!0});return"calendar"!==l||c.isMobile?u:(0,$.jsx)(ze().Z,{canSelect:!1,canDrag:!r,canEditText:!1,store:o,shouldShowDropZone:!0,getGhostElement:()=>function(e){if(e.current){return[kS().eN(e.current)]}return[]}(d),analyticsName:"calendar_no_date_item",children:u})}function KS(){return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(zn().Z,{style:{display:"flex",height:16,marginTop:4,marginLeft:12,marginRight:12,borderRadius:12,width:"50%"}}),(0,$.jsx)(zn().Z,{style:{display:"flex",height:16,marginTop:6,marginLeft:12,marginRight:12,marginBottom:6,borderRadius:12,width:"75%"}})]})}function OS(e,t,o,n,r,i,l){const s=e.map((e=>W().G.createChildStore(o,{table:T().iU,id:e}))).filter((e=>!(0,wS().G)(e.getPropertyStore(n).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:o}=an().default.state;if(!o)return;const n=(0,X().mb)({environment:i,store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1});return{key:e.id,render:t=>(0,$.jsx)(FS,{props:t,store:e,disabled:!e.canEdit(),url:n,collectionViewType:l}),action:()=>{e.canEdit()&&(r(e),j().ze(i))}}}));return S().oA(s)}function LS(e){let{noDateTotal:t,noDateProperty:o,collectionViewType:r,timelineViewRef:i}=e;const l=(0,s().O7)(),{isMobile:d}=(0,s().Fy)(),u=(0,E().Y$)(),p=(0,a().VK)((()=>u.collectionViewBlockStore()),[u]),m=(0,n.useCallback)((()=>{f().wd({environment:l,collectionContextStore:u,action:"click_topbar_no_date"})}),[u,l]),g=(0,c().yK)((e=>({buttonStyle:(0,dS().L)({theme:e})})),[]),S=(0,n.useCallback)((e=>{const t=e.getAssociatedCollectionStore(),o=null==i?void 0:i.current;if(!t)return;const{performResult:n}=w().createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:l,canUndo:!0,perform:n=>"calendar"===r?(0,ks().Fv)({environment:l,store:e,collectionStore:t,collectionContextStore:u,startDayOfWeek:re().AK.state,transaction:n}):o?o.addBlockToView({store:e,transaction:n}):void 0});n&&b().Z5({environment:l,stores:[n]})}),[u,r,l,i]),h=(0,n.useCallback)((e=>p?(0,$.jsx)(_S,{collectionViewBlockStore:p,property:o,onClose:e.close,onAddPage:S,collectionViewType:r,collectionContextStore:u}):null),[u,p,r,o,S]);return(0,$.jsx)(vr().ZP,{popupType:d?Mc().k.SlideUp:Mc().k.Popup,render:h,onClick:m,renderOrigin:e=>(0,$.jsx)(zo().Z,{isGray:!0,style:g.buttonStyle,...e,children:(0,$.jsx)(qe()._H,{defaultMessage:"No date ({noDateTotal})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{noDateTotal:t>=dr().GW?dr().GW-1+"+":t}})})})}const DS=n.memo(LS);const ES=(0,qe().vU)({sortLabel:{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"}});function AS(e){let{createSortSettingsStore:t}=e;const r=(0,E().Y$)(),{isMobile:i}=(0,s().Fy)(),l=(0,s().O7)(),d=(0,a().VK)((()=>t.state.open),[t]),u=(0,a().VK)((()=>r.currentSortsStore.state.length>0),[r]),p=(0,a().VK)((()=>(0,oo().Mj)(r)),[r]),m=(0,a().Kw)(r.isInHomeWidgetStore),g=(0,n.useCallback)((()=>{const e=r.permissionScopesStore.state.canConfigureBlock?r.currentCombinatorFilterStore.state:void 0,o=r.currentPropertyFiltersStore.state,n=r.filtersBarOpenStore.state,i=u||n||o.length>0||e;m&&y().wl({collectionSettingsStore:r.settingsStore,item:{type:u?"sort":"createSort"}}),i?m||(r.filtersBarOpenStore.setState(!n),u?y().wl({collectionSettingsStore:r.filterBarSortSettingsStore,item:{type:"sort"}}):y().wl({collectionSettingsStore:t,item:{type:"createSort"}})):m||y().wl({collectionSettingsStore:t,item:{type:"createSort"}}),f().wd({environment:l,collectionContextStore:r,action:"click_topbar_sort"})}),[r,t,l,u,m]),S=(0,n.useCallback)((()=>{y().E3({collectionSettingsStore:t})}),[t]),h=nt().Z.formatMessage(ES.sortLabel),v=(0,c().yK)((e=>({iconStyle:{width:21,height:void 0,fill:u?e.icon.uiBluePrimary:e.mediumIconColor},buttonStyle:(0,dS().C)({theme:e,isInHomeWidget:m}),tempSortIndicator:{position:"absolute",top:3,right:2,background:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[300],border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9}})),[u,m]);return(0,$.jsx)(Zl().ZP,{popupType:i?vr().Z4.SlideUp:vr().Z4.Popup,open:d,origin:(0,$.jsx)(gt().Z,{renderTooltip:()=>h,render:e=>(0,$.jsxs)("div",{style:{position:"relative"},children:[(0,$.jsx)(mt().Z,{...e,ariaLabel:h,icon:o(911206).j,iconStyle:v.iconStyle,style:v.buttonStyle,onClick:g}),p&&(0,$.jsx)("div",{style:v.tempSortIndicator})]})}),onDismiss:S,originGap:4,render:()=>(0,$.jsx)(SS().PJ,{context:hS().HV.TopbarSortPopup,collectionContextStore:r,collectionSettingsStore:t,hideDesktopHeader:!0})})}const HS=n.memo(AS);function ZS(){const e=(0,s().O7)(),t=(0,E().Y$)(),r=(0,a().VK)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id}),[t]),i=(0,c().yK)((e=>({button:{display:"flex",alignItems:"center",fontSize:14,fontWeight:Zt().Ue.medium,color:e.mediumTextColor},searchIcon:{width:14,fill:e.mediumIconColor,marginRight:6}})),[]),l=(0,n.useCallback)((()=>{o(278275).Kf({environment:e,analyticsFrom:"wiki-home-collection-view"}),r&&o(625820).ZP.updateFilters({ancestors:[r]})}),[e,r]);return r?(0,$.jsxs)(zo().Z,{style:i.button,onClick:l,children:[(0,tS().e)(i.searchIcon),(0,$.jsx)(qe()._H,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search"})]}):null}const zS=n.memo(ZS);function GS(e){let{showHoverActionsStore:t,isFullScreen:r,store:i,currentViewType:l,collectionContextStore:u,isPlaceholderExternalCollection:p,settingsHeaderSizeObserver:m,createFilterSettingsStore:g,createSortSettingsStore:S,isInHomeWidget:h,handleAddItemClick:f,headerSizeObserver:y,timelineViewRef:v,allowedActions:x}=e;const b=(0,s().O7)(),C=(0,c().Fg)(),{isPhone:w,isMobile:k}=(0,s().Fy)(),V=(0,o(657320).l)(),T=(0,fe().E)("packaging_m3.1"),j=(0,a().VK)((()=>u.collectionViewStore()),[u]),R=(0,a().VK)((()=>"view"===o(890324).Z.getMode(b,i).permission),[b,i]),P=(0,a().VK)((()=>(void 0!==u.collectionStore()||"collectionTypedView"===u.contextType)&&!p&&m.rect.state.width>=eh),[u,p,m]),I=(0,a().VK)((()=>({blockId:Qg().Z.getCurrentStepBlockId(),subStep:Qg().Z.getCurrentStepSubStep()??""})),[]),_=(0,a().VK)((()=>{const e=V&&V.publicEditModeStore.state.hasPublicPermission;return!(!Qg().Z.isActiveDemo()||!e)&&(!k&&I.blockId===i.id)}),[I.blockId,k,V,i.id]),M=(0,a().VK)((()=>!!_||t.state),[_,t]),B=(0,a().VK)((()=>{const e=y.rect.state;return!k&&e.width>0&&e.width<400}),[k,y.rect]),F=(0,n.useCallback)((e=>{(0,de().ZP)({event:e,context:de().Af.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]),K=(0,a().VK)((()=>{const e=null==j?void 0:j.getUnlistedStatus();return!0===(null==e?void 0:e.isUnlisted)&&!0===(null==e?void 0:e.isUnlistedFromSemanticQuery)}),[j]),O=(0,a().VK)((()=>{if(B||r||w||!i.canEditCollection())return null;const e=m.rect.state.width<=eh;return(0,$.jsx)(o(44105).Z,{store:i,isInlineCollection:!0,hideText:e,buttonStyle:{marginLeft:4}})}),[r,w,m.rect,B,i]),L=(0,a().VK)((()=>{var e,t;if(!x||x.includes("noDate"))return"timeline"===l?null===(e=u.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by:"calendar"===l?null===(t=u.normalizedQueryStore.state)||void 0===t?void 0:t.calendar_by:void 0}),[x,u.normalizedQueryStore,l]),D=(0,a().qz)(void 0,d().default),E=(0,a().VK)((()=>{if(L)return{type:"aggregation",aggregation:{property:L,aggregator:"empty",enforceMaxAggregationLimit:!0}}}),[L]),A=(0,a().VK)((()=>{if(E){const e=D.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}}),[E,D]),H=(0,a().VK)((()=>{if(!L||!A||!P||B||"calendar"!==l&&"timeline"!==l)return null;const e=u.permissionScopesStore.state,t=u.collectionStore();return"collectionTypedView"===u.contextType||t&&e.canEditContent?(0,$.jsx)(DS,{noDateTotal:A,noDateProperty:L,collectionViewType:l,timelineViewRef:v}):null}),[u,l,L,A,P,B,v]),Z=(0,n.useMemo)((()=>!P||"page"===l||"form_editor"===l||x&&!x.includes("filter")?null:_&&"filter"===I.subStep?(0,$.jsx)(Xg().u,{subStep:"filter",step:"demo_collection",children:(0,$.jsx)(vS,{createFilterSettingsStore:g})}):(0,$.jsx)(vS,{createFilterSettingsStore:g})),[P,l,x,_,I.subStep,g]),z=(0,a().VK)((()=>{if(!P||"page"===l||"form_editor"===l||x&&!x.includes("sort"))return null;if("chart"===l){var e,t;const o=null===(e=u.collectionViewStore())||void 0===e?void 0:e.getChartConfig();if("placeholder"===(null==o?void 0:o.type)||"results-advanced"!==(null==o||null===(t=o.chartFormat)||void 0===t?void 0:t.mainSort))return null}return _&&"sort"===I.subStep?(0,$.jsx)(Xg().u,{subStep:"sort",step:"demo_collection",children:(0,$.jsx)(HS,{createSortSettingsStore:S})}):(0,$.jsx)(HS,{createSortSettingsStore:S})}),[P,l,x,_,S,u,I]),G=(0,a().VK)((()=>!P||"chart"===l||"page"===l||p||!(0,Yg().cB)(u)||R||x&&!x.includes("automations")?null:_&&"automations"===I.subStep?(0,$.jsx)(Xg().u,{subStep:"automations",step:"demo_collection",children:(0,$.jsx)(mS,{})}):(0,$.jsx)(mS,{})),[u,l,p,P,x,I,_,R]),W=(0,a().VK)((()=>{return!P||"form_editor"===l||"chart"===l||B||x&&!x.includes("search")||p?null:"page"===l?null!==(e=u.collectionViewBlockStore())&&void 0!==e&&e.isCollectionViewPageWithContent()?(0,$.jsx)(zS,{}):null:(0,$.jsx)(iS,{collectionContextStore:u,isFullScreen:Boolean(r),currentViewType:l,topbarIconButtonStyle:(0,dS().C)({theme:C,isInHomeWidget:Boolean(h)})});var e}),[u,l,r,h,p,P,B,C,x]),N=(0,a().VK)((()=>{var e;return!P||x&&!x.includes("ai")||p||null!=u&&null!==(e=u.collectionStore())&&void 0!==e&&e.isSyncedCollection()?null:(0,$.jsx)(Ug().LazyAssistantCollectionViewButton,{collectionContextStore:u})}),[u,p,P,x]),U=(0,n.useMemo)((()=>r||R||x&&!x.includes("fullScreen")?null:(0,$.jsx)(CS,{store:i,viewType:l})),[r,i,l,x,R]),q=(0,a().VK)((()=>R||x&&!x.includes("viewSettings")||p?null:_&&"settings"===I.subStep?(0,$.jsx)(Xg().u,{subStep:"settings",step:"demo_collection",children:(0,$.jsx)(Am().kE,{collectionContextStore:u,style:(0,dS().C)({theme:C,isInHomeWidget:Boolean(h)})})}):(0,$.jsx)("div",{style:{position:"relative"},children:(0,$.jsx)(Am().kE,{collectionContextStore:u,style:(0,dS().C)({theme:C,isInHomeWidget:Boolean(h)})})})),[u,h,p,C,x,_,I,R]),Y=(0,a().VK)((()=>P&&null!=x&&x.includes("saveOrOpenOverflow")?(0,$.jsx)(Am().CI,{collectionContextStore:u,shouldHideSaveViewOption:K}):null),[P,x,u,K]),Q=(0,a().VK)((()=>{var e,t;if("page"===l||"form_editor"===l||p||!u.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})||x&&!x.includes("addItem"))return null;const o=sa().default.isVisible("collection_add_item_button_tooltip")&&!(null===(e=u.collectionStore())||void 0===e||!e.getWorkflowTemplateId())&&(null==u?void 0:u.isEmptyStore.state)&&!T;return(0,$.jsx)(aS,{store:i,settingsHeaderSizeObserver:m,handleAddItemClick:f,isTooltipVisible:o,collectionModel:null===(t=u.collectionStore())||void 0===t?void 0:t.getModel()})}),[l,p,u,x,T,i,m,f]),X=(0,n.useMemo)((()=>"form_editor"!==l||x&&!x.includes("formActionButtons")?null:(0,$.jsx)(qg,{showCompactDesktopHeader:B,collectionContextStore:u})),[l,x,B,u]),J=(0,a().VK)((()=>null!=x&&x.includes("closeCollectionViewInModal")&&u.isUnlistedViewStore.state?(0,$.jsx)(Am().sr,{}):null),[x,u]),ee=(0,a().VK)((()=>{const e=u.collectionViewStore(),t=u.collectionStore();return!(!e||!t)&&t.getSpaceId()!==e.getSpaceId()}),[u]),te=(0,a().VK)((()=>ee&&je().default.checkGate({gateName:"collections_xws"})),[ee]);return w?(0,$.jsxs)(ut().Z,{visible:M,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center"},children:[(0,$.jsx)(eS,{}),U,q,Q,X,Y]}):(0,$.jsxs)(ut().Z,{visible:M,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center",gap:2},onMouseDown:F,children:[(0,$.jsx)(eS,{}),te&&(0,$.jsx)(Fc,{type:"linkedView"}),O,E&&(0,$.jsx)(Xt().Z,{id:"no_date_count",collectionContextStore:u,reducer:E,resultStore:D}),H,Z,z,G,N,W,U,q,Y,Q,X,J]})}const WS=n.memo(GS);function NS(e){let{currentViewType:t,store:r,isFullScreen:i,hideViewTabBar:l,collectionViewHeaderText:s,headerActionsBehavior:u,allowedActions:p,isInHomeWidget:m,isMyTasksPage:S,isHomeCustomDbPage:h,showHoverActionsStore:f,headerSizeObserver:v,isPlaceholderExternalCollection:x,handleEditorMouseDown:b,handleHeaderMouseMove:C,handleHeaderMouseLeave:w,handleHeaderMount:k,handleSettingsHeaderMount:V,leftRightPaddingStore:T,headerHeightStore:j,canEdit:R,contentSizeObserver:P,settingsHeaderSizeObserver:I,viewSettingsPlacementStore:_,showOnlyCurrentView:M,switchViewMetric:B,handleAddItemClick:F,timelineViewRef:K,createFilterSettingsStore:O,filterBarCreateFilterSettingsStore:L,headerWrapStyle:D,headerRef:A,headerStyleOverrides:H}=e;const Z=(0,E().Y$)(),z=(0,ee().Dq)(),G=(0,a().qz)(void 0,d().default),W=(0,a().VK)((()=>{if(S){return{type:"results",filter:{operator:"and",filters:[]},limit:1}}}),[S]),N=(0,a().qz)(void 0,d().default),U=(0,a().VK)((()=>{if(h)return{type:"results",filter:{operator:"and",filters:[]},limit:1}}),[h]),q=(0,a().qz)(void 0,ke().Z),Y=(0,a().qz)(void 0,d().default.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"})),Q=(0,a().VK)((()=>T.state),[T]),J=(0,c().Fg)(),te=(0,a().VK)((()=>{const e=T.state,o=Z.viewIsFlushToTopbar(),n=("timeline"===t||"table"===t)&&o||m||Z.isUnlistedViewStore.state,r={left:null==e?void 0:e.paddingLeft,paddingLeft:m?be().pW:void 0,width:"100%"};return{headerPositioningStyle:r,headerStyle:{display:"flex",alignItems:"center",height:j.state,boxShadow:n?void 0:`0 1px 0 ${J.tableDividerColor}`,marginBottom:n?void 0:1,...r,...H},selectableStyle:{position:"relative"}}}),[Z,t,j,m,T,J.tableDividerColor,H]),oe=(0,a().VK)((()=>r.isNonEditableState()),[r]),ne=(0,a().VK)((()=>{var e;return"viewsMain"===(null===(e=Z.viewsModuleContextStore)||void 0===e?void 0:e.getViewModuleType())}),[Z.viewsModuleContextStore]),re=(0,a().VK)((()=>{var e;return!x&&!(null!=z&&z.hideViewBlockSource)&&Z.shouldShowSourceStore.state&&!Z.isUnlistedViewStore.state&&(null===(e=Z.collectionStore())||void 0===e?void 0:e.canRead())}),[Z,z,x]),ie=(0,n.useCallback)((e=>{let{currentCollectionViewStore:t,newCollectionViewStore:o,openInNew:n}=e;if(t.id!==o.id&&!n){const e=t.getType(),n=o.getType();if(e&&n){var r;if(B)B.current={from:e,to:n,metric:ye().default.DO_NOT_USE_markLegacy("collections.switch_view_lag"),sizeHintAtStart:null===(r=Z.remoteResultStore.state)||void 0===r?void 0:r.sizeHint};"form_editor"===e&&Z.isClientModeEnabledStore.setState(!1),"form_editor"===n&&y().E3({collectionSettingsStore:Z.settingsStore})}}}),[Z.isClientModeEnabledStore,Z.remoteResultStore,Z.settingsStore,B]),le=(0,n.useMemo)((()=>"hidden"===u?null:(0,$.jsx)(WS,{showHoverActionsStore:f,isFullScreen:i,store:r,currentViewType:t,collectionContextStore:Z,isPlaceholderExternalCollection:x,settingsHeaderSizeObserver:I,createFilterSettingsStore:O,createSortSettingsStore:Y,isInHomeWidget:m,handleAddItemClick:F,headerSizeObserver:v,timelineViewRef:K,allowedActions:p})),[u,f,i,r,t,Z,x,I,O,Y,m,F,v,K,p]),se=(0,n.useMemo)((()=>{if(!l)return(0,$.jsx)(Dg,{collectionContextStore:Z,showHoverActionsStore:f,isPlaceholderExternalCollection:x,showOnlyCurrentView:M??!1,onViewClick:ie,disabled:S,variant:ne?"pills":"default"})}),[l,Z,f,x,M,ie,S,ne]);return(0,$.jsxs)(He().p,{allowSelectionWithin:!0,style:D,onMouseDown:b,onMouseMove:C,onMouseLeave:w,ref:(0,g().lq)(k,A),children:[i&&(0,$.jsx)(Ht,{currentViewType:t,headerSizeObserver:v,contentSizeObserver:P,settingsHeaderSizeObserver:I,headerHeightStore:j,viewSettingsPlacementStore:_,store:r,leftRightPaddingStore:T,isInHomeWidget:m,headerRef:A}),Q&&(0,$.jsxs)(ze().Z,{store:r,shouldShowCopyLinkButton:oe,analyticsName:(0,X().$l)(t),style:te.selectableStyle,shouldShowHalo:!(i||m||null!=z&&z.isPreviewing),children:[(0,$.jsxs)("div",{style:te.headerStyle,ref:V,children:[se,s,le]}),W&&(0,$.jsx)(Xt().Z,{id:"tasks_results",collectionContextStore:Z,reducer:W,resultStore:G}),U&&(0,$.jsx)(Xt().Z,{id:"custom_db_results",collectionContextStore:Z,reducer:U,resultStore:N})]}),(0,$.jsxs)("div",{style:te.headerPositioningStyle,dir:"ltr",children:[re&&(0,$.jsx)(o(894704).Z,{store:r,collectionContextStore:Z,isFullScreen:i,showHoverActionsStore:f,canEdit:R}),(0,$.jsx)(Ng,{collectionContextStore:Z}),(0,$.jsx)(US,{collectionContextStore:Z,showHoverActionsStore:f,filterBarCreateFilterSettingsStore:L,saveControlMoreActionsButtonPopupStore:q,currentViewType:t,isInHomeWidget:m})]})]})}function US(e){let{collectionContextStore:t,showHoverActionsStore:o,filterBarCreateFilterSettingsStore:n,saveControlMoreActionsButtonPopupStore:r,currentViewType:i,isInHomeWidget:l}=e;const c=(0,s().O7)(),d=(0,s().MO)(),u=(0,a().VK)((()=>(0,yc().rs)(c)),[c]),p=(0,a().Kw)(t.filtersBarOpenStore),m=(0,a().Kw)(t.shouldShowSourceStore),g=(0,a().Kw)(t.completeSprintButtonContextStore),S=m?8:12;return"page"===i||"form_editor"===i||"feed"===i&&u||l?null:p?(0,$.jsx)($m().ZP,{collectionContextStore:t,showHoverActionsStore:o,createFilterSettingsStore:n,saveControlMoreActionsButtonPopupStore:r}):g?(0,$.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:d?12:8,paddingTop:S},children:[(0,$.jsx)("div",{style:{flex:1}}),(0,$.jsx)(Hg().Z,{collectionContextStore:t})]}):null}const $S=n.memo(NS);class qS extends d().default{getInitialState(){return{databaseLoadCompleted:!1}}}const YS=new qS;function QS(e){const{subMetricsTimes:t}=e,{cvbBlockRenderStart:o,cvbBlockRenderMount:n,itemsStart:r,itemsVisible:i}=t,l={"collections.await_page_chunk_end_to_cvb_start":void 0,"collections.cvb_start_to_cvb_mount":void 0,"collections.cvb_mount_to_items_start":void 0,"collections.items_start_to_items_visible":void 0},{await_page_chunk_start_to_await_page_chunk_end:s}=Pe().default.state.subMetricsStore.state,a=t=>{let{startTime:o,endTime:n}=t;if(e.isPrewarmedTab){if(n<=e.prewarmedTabNavigationStart)return 0;if(o<e.prewarmedTabNavigationStart&&n>e.prewarmedTabNavigationStart)return n-e.prewarmedTabNavigationStart}return n-o};return o&&s&&(l["collections.await_page_chunk_end_to_cvb_start"]=a({startTime:s.endTime,endTime:o})),o&&n&&(l["collections.cvb_start_to_cvb_mount"]=a({startTime:o,endTime:n})),n&&r&&(l["collections.cvb_mount_to_items_start"]=a({startTime:n,endTime:r})),r&&i&&(l["collections.items_start_to_items_visible"]=a({startTime:r,endTime:i})),l}class XS extends d().default{getInitialState(){return{stage:"NOT_TRACKING"}}}function JS(e){const{collectionContextStore:t,collectionViewBlockRenderStartTime:o,didDelayOffscreenRenderRef:r,mountedBeforeInitialPageRender:i}=e,{handleInitialDatabaseRender:c,tempPreviousInlineInitialRender:d,handleNavigationDatabaseRender:u,handleItemMount:p,handleItemsRenderStart:m}=function(e,t,o,r){const i=(0,s().O7)(),c=(0,a().qz)(void 0,XS),d=(0,a().qz)(void 0,XS),u=(0,n.useRef)(0),p=(0,n.useRef)(t),m=(0,n.useRef)(),g=(0,n.useRef)(void 0),S=(0,n.useRef)(void 0),f=(0,n.useRef)(!0),y=(0,n.useRef)(!1),v=(0,n.useCallback)((()=>{"NOT_TRACKING"===c.state.stage&&(c.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"INITIAL"}),g.current=performance.now())}),[c]),x=(0,n.useCallback)((()=>{"NOT_TRACKING"===d.state.stage&&(d.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"INITIAL"}),g.current=performance.now())}),[d]),b=(0,n.useCallback)((e=>{"NOT_TRACKING"===c.state.stage&&(c.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"NAVIGATION"}),e&&(m.current=e))}),[c]),C=(0,n.useCallback)((()=>{if(o.current)return;const t=c.state.stage;if("COUNTING_VISIBLE_ITEMS"===t){if(u.current++,1===u.current){const e=performance.now();l().default.afterNextFlush((()=>{"COUNTING_VISIBLE_ITEMS"===c.state.stage&&c.setState({stage:"SHOULD_TRACK",endTime:e,source:c.state.source}),"COUNTING_VISIBLE_ITEMS"===d.state.stage&&d.setState({stage:"SHOULD_TRACK",endTime:e,source:d.state.source})}))}}else"NOT_TRACKING"===t&&f.current&&(f.current=!1,ye().default.DO_NOT_USE_measureFromPageOriginLegacy({metricName:"missed_database_items_visible",endTime:performance.now()},{environment:i,data:le().Pp({environment:i,collectionContextStore:e,visibleItemsCount:1,wasInitialRenderEmpty:y.current,isPrewarmedTab:(0,ue().isPrewarmedTabInitialRender)(i)})}))}),[e,o,i,c,d]),w=(0,n.useCallback)((()=>{S.current||(S.current=performance.now())}),[]),k=(0,n.useCallback)((t=>{t.state&&"COUNTING_VISIBLE_ITEMS"===c.state.stage&&(y.current=!0,e.isEmptyStore.removeListener(k),C())}),[e.isEmptyStore,C,c]),V=(0,n.useCallback)((t=>{if(!o.current&&"SHOULD_TRACK"===t.state.stage){const o=(0,ue().isPrewarmedTabInitialRender)(i),s=o?Pe().default.state.prewarmedTabAppStartTimeOverride:void 0,a=le().Pp({environment:i,collectionContextStore:e,visibleItemsCount:u.current||0,wasInitialRenderEmpty:y.current,isPrewarmedTab:o});if("INITIAL"===t.state.source){var n,l;const c=(0,ge().Z)(null===(n=e.collectionViewStore())||void 0===n?void 0:n.id),d=null===(l=i.prefetchCache)||void 0===l?void 0:l.getPrefetchAnalytic(c),u={cvbBlockRenderStart:p.current,cvbBlockRenderMount:g.current,itemsStart:S.current,itemsVisible:t.state.endTime},m=QS(o&&"number"==typeof s?{subMetricsTimes:u,isPrewarmedTab:!0,prewarmedTabNavigationStart:s}:{subMetricsTimes:u,isPrewarmedTab:!1}),h={...a,sub_metrics:m,initial_render_timings:e.timingTracker.getMetrics(u),includes_page_origin_to_app_start:!0};r&&ye().default.measureFromPageOrigin({metricName:"initial_database_items_visible",endTime:t.state.endTime},{environment:i,data:h,shouldSendIfStatsigNotInitialized:!0}),p.current&&(ye().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_to_items_visible",startTime:p.current,endTime:t.state.endTime},{environment:i,data:h,shouldSendIfStatsigNotInitialized:!0}),"hit-match"===(null==d?void 0:d.type)&&void 0!==d.finishedTimeMs&&d.finishedTimeMs>p.current&&ye().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_waiting_for_api",startTime:p.current,endTime:d.finishedTimeMs},{environment:i,data:a})),YS.state.databaseLoadCompleted||YS.setState({databaseLoadCompleted:!0})}else if("NAVIGATION"===t.state.source){if(m.current){const e={...a,wasm_sqlite_initialized:Pe().default.state.metricDataStore.state.wasm_sqlite_initialized,wasm_sqlite_storage:Pe().default.state.metricDataStore.state.wasm_sqlite_storage,...Me().Z.getDatabaseNavigationMetrics(m.current)};ye().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_items_visible",startTime:m.current,endTime:t.state.endTime},{environment:i,data:e})}p.current&&ye().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_mount_to_items_visible",startTime:p.current,endTime:t.state.endTime},{environment:i,data:a})}else(0,h().P)(t.state.source);t.setState({stage:"COMPLETED"}),u.current=0}}),[e,o,i,r]),T=(0,n.useCallback)((t=>{if(!o.current&&"SHOULD_TRACK"===t.state.stage){const o=(0,ue().isPrewarmedTabInitialRender)(i),n=o?Pe().default.state.prewarmedTabAppStartTimeOverride:void 0,r=le().Pp({environment:i,collectionContextStore:e,visibleItemsCount:u.current||0,wasInitialRenderEmpty:y.current,isPrewarmedTab:o});if("INITIAL"===t.state.source){const l={cvbBlockRenderStart:p.current,cvbBlockRenderMount:g.current,itemsStart:S.current,itemsVisible:t.state.endTime},s={...r,sub_metrics:QS(o&&"number"==typeof n?{subMetricsTimes:l,isPrewarmedTab:!0,prewarmedTabNavigationStart:n}:{subMetricsTimes:l,isPrewarmedTab:!1}),initial_render_timings:e.timingTracker.getMetrics(l)};p.current&&ye().default.DO_NOT_USE_measureLegacy({metricName:"temp_collections.temp_initial_mount_to_items_visible",startTime:p.current,endTime:t.state.endTime},{environment:i,data:s,shouldSendIfStatsigNotInitialized:!0}),YS.state.databaseLoadCompleted||YS.setState({databaseLoadCompleted:!0})}}}),[e,o,i]);return(0,n.useEffect)((()=>(c.addListener(V),d.addListener(T),()=>{c.removeListener(V),d.removeListener(T)})),[V,T,c,d]),(0,n.useEffect)((()=>(e.isEmptyStore.addListener(k),()=>{e.isEmptyStore.removeListener(k)})),[e.isEmptyStore,k]),{handleInitialDatabaseRender:v,tempPreviousInlineInitialRender:x,handleNavigationDatabaseRender:b,handleItemMount:C,handleItemsRenderStart:w}}(t,o,r,i);return t.databaseItemsVisibleTracker||(t.databaseItemsVisibleTracker={handleInitialDatabaseRender:c,tempPreviousInlineInitialRender:d,handleNavigationDatabaseRender:u,handleItemMount:p,handleItemsRenderStart:m}),null}const eh=480,th=n.memo(n.forwardRef((function(e,t){const{store:T,isFullScreen:j,viewsModuleContextType:R,overrideViewType:P,headerActionsBehavior:I="default",overridePaddingLeft:_,overridePaddingRight:M,fullWidth:B,headerText:F,hideViewTabBar:K,headerAllowedActions:O,maxHeight:L,disabled:D,forceLocalQueryCollection:A,isUnlistedView:H,viewId:Z,onMount:z,setCollectionContextStore:N,showOnlyCurrentView:U,additionalCollectionViewInnerHorizontalPadding:Y,templatePickerMenuListStore:Q,mountedBeforeInitialPageRender:De}=e,Ee=(0,c().Fg)(),We=(0,s().MO)(),Ne=(0,n.useRef)(null),Ue=(0,s().O7)(),$e=(0,ee().Dq)(),qe=(null==$e?void 0:$e.isPreviewing)??!1,Ye=(0,n.useMemo)((()=>new(Te().Z)(Ue,{isPreviewing:qe})),[Ue,qe]),Qe=(0,n.useContext)(te().U),Xe=Boolean(j)||qe,{didDelayOffscreenRenderRef:Je}=function(e){let{collectionContextStore:t,isFullScreen:r,rootRef:i}=e;const l=(0,fe().E)("collections_delay_render_offscreen"),s=(0,n.useRef)(r),c=(0,n.useRef)(!1),d=(0,a().VK)((()=>o(158429).default.isOpen()),[]);return(0,n.useEffect)((()=>{if(!i.current||!l)return;if(s.current)return;if(d)return s.current=!0,void t.shouldDelayRenderStore.setState(!1);if(!i.current.parentElement)return;const e=new IntersectionObserver((o=>{const n=!o.reduce(((e,t)=>t.time>e.time?t:e),o[0]).isIntersecting;n?c.current=!0:(s.current=!0,e.disconnect()),t.shouldDelayRenderStore.setState(n)}));return e.observe(i.current.parentElement),()=>e.disconnect()}),[t,l,d,i]),{didDelayOffscreenRenderRef:c}}({collectionContextStore:Ye,isFullScreen:j,rootRef:Ne}),et=(0,a().qz)(void 0,o(619384).Z),tt=(0,n.useMemo)((()=>new(Ke().E)),[]),ot=(0,n.useMemo)((()=>new(Ke().E)),[]),nt=(0,n.useMemo)((()=>new(Ke().E)),[]),rt=(0,n.useRef)(null),it=(0,n.useRef)(),lt=(0,n.useRef)(null),[st]=(0,n.useState)((()=>performance.now())),at=(0,n.useRef)(new Map),ct=(0,n.useRef)(),dt=(0,n.useMemo)((()=>new Ae(Ye,Ue)),[Ye,Ue]),ut=(0,n.useRef)(),pt=(0,n.useRef)(),mt=(0,a().VK)((()=>Ye.collectionStore()),[Ye]),[gt,St]=(0,n.useState)(!1),[ht,ft]=(0,n.useState)(!1),[yt,vt]=(0,n.useState)(!1),xt=(0,a().qz)(void 0,d().default.createClass({open:!1,stack:[]},{name:"createFilterSettingsStore"})),bt=(0,a().qz)(void 0,d().default.createClass({open:!1,stack:[]},{name:"filterBarCreateFilterSettingsStore"})),Ct=(0,a().qz)(void 0,d().default.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"})),wt=(0,a().qz)(void 0,d().default.createClass(void 0,{name:"viewSettingsPlacementStore"})),kt=(0,a().qz)(void 0,ke().Z);(0,o(932200).Y)(Ye);const Vt=(0,n.useCallback)((()=>{var e;return P??(null===(e=Ye.collectionViewStore())||void 0===e?void 0:e.getType())}),[P,Ye]),Tt=(0,a().SI)((()=>(0,o(942226).wq)(T)),[T]),jt=(0,a().Kw)(Tt),Rt=(0,a().Kw)(Ye.isInHomeWidgetStore),Pt=(0,a().VK)((()=>!!Ye.viewsModuleContextStore.getViewModuleType()),[Ye]),_t=(0,a().VK)((()=>(0,X().Ks)(T)),[T]),Mt=(0,a().SI)((()=>{const e=(0,Ce().$3)(Ue)-me().zL;if(_t&&!j&&!(0,X()._5)(T)&&e>0&&!Rt)return e/2}),[Ue,_t,j,T,Rt]),Bt=(0,a().Kw)(Mt),Ft=(0,a().VK)((()=>{var e;return(null===(e=rt.current)||void 0===e?void 0:e.getStore().state.elementRef)??{current:null}}),[rt]),Kt=(0,n.useCallback)((e=>{var t,o;if(Ye.isInHomeWidgetStore.state)return;const n=Ye.normalizedFormatStore.state,r=null===(t=Ft.current)||void 0===t?void 0:t.clientWidth;Ye.frozoneStore.setState({isScrolled:!1,scrollerWidth:r,scrollerLeftOffset:(null==rt||null===(o=rt.current)||void 0===o||null===(o=o.getClientRect())||void 0===o?void 0:o.left)??0,scrollerLeftPadding:Mt.state,frozenIndex:null==e?void 0:e.getTableFrozenColumnIndex(r,n),tryShowHiddenFrozenColumn:!1})}),[Ye,Ft,Mt]),Ot=(0,a().VK)((()=>T.isRootOrDirectChild()),[T]),Lt=(0,a().VK)((()=>(0,J().fg)(Ue,T)),[Ue,T]),Et=(0,a().SI)((()=>{const e=Vt(),t=(0,X().Bs)({environment:Ue,store:T,isFullScreen:j,sizeObserver:tt,viewType:e,collectionContextStore:Ye});return t&&void 0!==_&&(t.paddingLeft=_),t&&void 0!==M&&(t.paddingRight=M),t&&Ot&&Lt&&(0,X()._5)(T)&&"page"!==e&&(t.paddingRight+=J().QB),t}),[Ue,T,j,tt,Vt,Ye,_,M,Ot,Lt]);(0,a().Kw)(Et);const At=(0,a().VK)((()=>{var e,t;const o=Y??0;return{paddingLeft:((null===(e=Et.state)||void 0===e?void 0:e.paddingLeft)??0)+o,paddingRight:((null===(t=Et.state)||void 0===t?void 0:t.paddingRight)??0)+o}}),[Et,Y]),Zt=(0,n.useCallback)((e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,o(474788).E)(t)&&vt(!0)}),[vt]),zt=(0,n.useCallback)((()=>{vt(!1)}),[vt]),Gt=(0,n.useCallback)((()=>{Re().Z.state||St(!0)}),[St]),Wt=(0,n.useCallback)((()=>{St(!1)}),[St]),Nt=(0,n.useCallback)((()=>{var e,t;if(Rt)return;const o=null===(e=rt.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.getBoundingClientRect().width,n=Ye.frozoneStore.state.scrollerWidth,r=null===(t=rt.current)||void 0===t||null===(t=t.getNode())||void 0===t?void 0:t.getBoundingClientRect().left,i=Ye.frozoneStore.state.scrollerLeftOffset;if(o===n&&r===i)return;const l=Ye.collectionViewStore(),s=Ye.normalizedFormatStore.state;Ye.frozoneStore.update((e=>({...e,scrollerWidth:o,scrollerLeftOffset:r,scrollerLeftPadding:Mt.state,frozenIndex:null==l?void 0:l.getTableFrozenColumnIndex(o,s),tryShowHiddenFrozenColumn:!1})))}),[Ye,rt,Mt,Rt]),Ut=(0,n.useCallback)((()=>{var e,t;const o=null===(e=rt.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.scrollLeft,n=null===(t=Et.state)||void 0===t?void 0:t.paddingLeft;if(void 0===o||void 0===n)return;const r=o>n;r!==Ye.frozoneStore.state.isScrolled&&(Ye.frozoneStore.setState({...Ye.frozoneStore.state,isScrolled:r}),Nt())}),[Ye,Nt,Et]);(0,a().VK)((()=>{var e;const t=Ye.collectionViewStore(),n=Ye.collectionStore(),r=Ue.currentUser.id,i=null==t?void 0:t.id,l=null==n?void 0:n.id,s=T.getCollectionViewStores(),a=s.map((e=>e.id)),c=null!==(e=s[0])&&void 0!==e&&e.isDefined()?s[0]:void 0,d=T.id,u=p().Z.get({userId:r,key:(0,ae().oi)(d)});let m;const g=e=>!!H||(!!a.includes(e)||"collectionSettings"===Ye.contextType);if("collectionSettings"===Ye.contextType&&t?m=t.id:Z&&g(Z)?m=Z:t&&g(t.id)?m=t.id:u&&g(u)?m=u:c&&g(c.id)&&(m=c.id),m){const e=W().Xr.createChildStore(t??T,{table:o(139978).np,id:m});if(e.isDefined()){m!==u&&p().Z.set({userId:r,key:(0,ae().oi)(d),value:m});const t=e.getCollectionStore();e&&(m!==i||t&&t.id!==l)&&(0,V().mc)({environment:Ue,collectionViewBlockStore:T,collectionViewStore:e,collectionStore:t,collectionContextStore:Ye,isFullScreen:j??!1,isRootChild:T.isRootOrDirectChild(),isInPeekRenderer:jt,viewsModuleContextType:R,forceLocalQueryCollection:Boolean(A)})}}}),[T,Ye,Ue,j,jt,R,A,H,Z]),(0,a().VK)((()=>{void 0===Ye.frozoneStore.state.frozenIndex&&Ye.collectionViewStore()&&Kt(Ye.collectionViewStore())}),[Ye,Kt]);const $t=(0,n.useRef)(!1);(0,n.useEffect)((()=>($t.current=!0,()=>{$t.current=!1})),[]);const qt=(0,n.useRef)(!0);(0,n.useEffect)((()=>{if(qt.current){const e=Vt();e&&(i().Z.withListenerIgnored((()=>{const t=Ye.collectionStore(),o=Ye.collectionViewStore(),n=null==o?void 0:o.getChartType(),r=null==o?void 0:o.getChartPlaceholderType();(0,ne().K4)(Ue,"database_visit",{collection_id:null==t?void 0:t.id,collection_view_id:null==o?void 0:o.id,collection_view_block_id:T.id,type:e,is_full_screen:j,is_peek:Tt.state,peek_mode:Fe().default.state.mode,database_visit_id:Ye.visitSessionId,chart_type:"placeholder"===n?r:n,is_chart_placeholder:"placeholder"===n})})),qt.current=!1)}}),[]);const{value:Yt}=(0,G().XJ)(oe().F.formulas);(0,n.useEffect)((()=>{(0,h().$K)(Yt)&&Ye.formulasCodeStore.setState(Yt)}),[Yt,Ye.formulasCodeStore]),(0,n.useEffect)((()=>{i().Z.withListenerIgnored((()=>{const e=Ye.collectionViewStore();if(e&&"collectionTypedView"===Ye.contextType){const t=Ye.databaseType,o=Vt();t&&o&&(0,ne().lu)(Ue,"type_aggregated_database_visit",`type_aggregated_database_visit-${t}`,60,{collection_view_id:e.id,collection_view_block_id:T.id,type:o,databaseType:t,is_my_tasks:(0,xe().Ep)("myTasks")===T.id})}}))}),[]),(0,n.useEffect)((()=>{const e=ye().default.DO_NOT_USE_markLegacy("collections.collection_view_block_render");ye().default.DO_NOT_USE_measureAfterNextFlushLegacy(e,{environment:Ue,getData:()=>({...(0,le().vS)(Ye),is_first_render:qt.current})})})),pt.current&&i().Z.withListenerIgnored((()=>{if(!pt.current)return;const{from:e,to:t,metric:o,sizeHintAtStart:n}=pt.current;ye().default.DO_NOT_USE_measureAfterNextFlushLegacy(o,{environment:Ue,getData:()=>{const o=(0,le().vS)(Ye),{view_type:r,row_count_category:i,...l}=o;return{from:e,to:t,did_trigger_fetch:Ye.isLoadingStore.state,row_count_category:(0,le().ZO)(n),...l}}}),pt.current=void 0})),(0,n.useEffect)((()=>{const e=()=>{if(!Ye.isLoadedStore.state||!$t.current||Ye.wasCreatedThisSessionStore.state||Ye.didFireLoadEventsStore.state)return;Ye.didFireLoadEventsStore.setState(!0);const e=Ue.RouterStore.state;let t;"page"===e.route.name&&(t=e.route.mobileData);const n=Ye.isFullScreenStore.state;if(n){var i;const e=null===(i=Ye.collectionViewStore())||void 0===i?void 0:i.getType();if(!Pe().default.state.initialRenderCompleted&&De){var l;o(418216).setInitialRenderCompleted(),r().vF.hackyOffsetParsesCorrectly()||(0,ne().K4)(Ue,"luxon_hacky_offset_parses_correctly_false");const i=()=>{var n,r;const i=(0,le().vS)(Ye),l=Ye.collectionViewStore(),s=null==l?void 0:l.id,a=(0,ge().Z)(s),c=Ye.requestBackend;return{...i,is_push:(null===(n=t)||void 0===n?void 0:n.isPush)??!1,collectionViewType:e,initial_route:Ue.RouterStore.state.initialRoute.name,prefetchCache:null===(r=Ue.prefetchCache)||void 0===r||null===(r=r.getPrefetchAnalytic(a))||void 0===r?void 0:r.type,wasm_sqlite_initialized:Pe().default.state.metricDataStore.state.wasm_sqlite_initialized,wasm_sqlite_storage:Pe().default.state.metricDataStore.state.wasm_sqlite_storage,is_mobile_background_launch:(0,o(683938).Z)(),collection_request_backend:c,sub_metrics:ue().getSubMetricsAndMetricDataForTracking({isPrewarmedTab:!1}).sub_metrics,includes_page_origin_to_app_start:!0}};ye().default.measureFromPageOriginAfterNextFlush("initial_database_render",{environment:Ue,getData:i,shouldSendIfStatsigNotInitialized:!0});const c=Am().Xm.CollectionViewBlock.getLoadingMetrics();var s,a;if(null!=c&&c.startedAt)ye().default.DO_NOT_USE_measureLegacy({metricName:"collection_view_block_bundle_load_and_parse",startTime:c.startedAt,endTime:c.resolvedAt},{environment:Ue,data:{did_prefetch:"hit-match"===(null===(s=Ue.prefetchCache)||void 0===s||null===(s=s.getPrefetchAnalytic((0,ge().Z)(null===(a=Ye.collectionViewStore())||void 0===a?void 0:a.id)))||void 0===s?void 0:s.type),is_full_screen:n}});null===(l=Ye.databaseItemsVisibleTracker)||void 0===l||l.handleInitialDatabaseRender()}else{var c;const t=Me().Z.popTimings(),o=()=>({...(0,le().vS)(Ye),wasm_sqlite_initialized:Pe().default.state.metricDataStore.state.wasm_sqlite_initialized,wasm_sqlite_storage:Pe().default.state.metricDataStore.state.wasm_sqlite_storage,collectionViewType:e,...Me().Z.getDatabaseNavigationMetrics(null==t?void 0:t.navigationStart),is_load_cached_page_chunk_v2:je().default.checkGate({gateName:"load_cached_page_chunk_multi_cell_enabled"})});t&&ye().default.DO_NOT_USE_measureAfterNextFlushLegacy({metricName:"navigation_database_render",startTime:t.navigationStart},{environment:Ue,getData:o}),_e().Z.state.isMeasuring&&_e().Z.update((e=>({...e,isMeasuring:!1}))),null===(c=Ye.databaseItemsVisibleTracker)||void 0===c||c.handleNavigationDatabaseRender(null==t?void 0:t.navigationStart)}}else{var d,u,p;if(De)null===(d=Ye.databaseItemsVisibleTracker)||void 0===d||d.handleInitialDatabaseRender();else null===(u=Ye.databaseItemsVisibleTracker)||void 0===u||u.handleNavigationDatabaseRender();if(!YS.state.databaseLoadCompleted)null===(p=Ye.databaseItemsVisibleTracker)||void 0===p||p.tempPreviousInlineInitialRender()}};return Ye.isLoadedStore.addListener(e),e(),()=>{Ye.isLoadedStore.removeListener(e)}}),[Ye,Ue,De]),(0,a().VK)((()=>{for(const t of T.getCollectionViewStores())t.getValue();const e=Ye.collectionStore();if(e){e.getTemplatePageStores().map((e=>e.getValue()))}}),[T,Ye]),(0,n.useEffect)((()=>{const e=()=>!Fe().default.isCenterPeekOpen()&&Be().Z.state.isVisible,t=()=>{e()&&dt.maybeProcessQueuedCollectionEmit("page_show")},o=()=>{e()&&dt.maybeProcessQueuedCollectionEmit("exit_peek")};return Be().Z.addListener(t),Fe().default.addListener(o),()=>{Be().Z.removeListener(t),Fe().default.removeListener(o)}}),[dt]),(0,n.useEffect)((()=>{const e=e=>{o(86609).Wu({environment:Ue,sprintSettingsContext:e.state})};return Ye.sprintSettingsContextStore.addListener(e),()=>{Ye.sprintSettingsContextStore.removeListener(e)}}),[Ye,Ue]),(0,n.useEffect)((()=>{const e=async e=>{if(e.state){const e=Ye.collectionViewBlockStore(),t=Ye.collectionViewStore(),o=Ye.collectionStore();if(!e||!t||!o)return;await(0,V().dj)(Ue,Ye,{src:"relative_variables_stale",queuedTimestamp:Date.now()},Boolean(A))}};return Ye.relativeVariablesAreStaleStore.addListener(e),()=>{Ye.relativeVariablesAreStaleStore.removeListener(e)}}),[Ye,Ue,A]);const{contextType:Qt,databaseType:Xt,remoteCollectionIds:Jt}=(0,a().VK)((()=>({contextType:Ye.contextType,databaseType:Ye.databaseType,remoteCollectionIds:Ye.remoteCollectionIdsStore.state})),[Ye]);(0,n.useEffect)((()=>{if(ct.current)return;if("collectionTypedView"!==Qt||!Xt)return;const e=new(Ge().E)(Ue,(0,m().JY)({spaceId:T.getSpaceId(),databaseType:Xt}),((e,t)=>{dt.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:oh(T),isCollectionTypeChange:!0})}));e.subscribe(),ct.current=e;const t=ct.current;return()=>{t.unsubscribe()}}),[Ye,Ue,dt,T,Qt,Xt]),(0,n.useEffect)((()=>{null==N||N(Ye)}),[N,Ye]),(0,n.useEffect)((()=>{null==z||z(Vt())}),[]),(0,a().VK)((()=>{var e;const t=Ye.frozoneStore.state.scrollerWidth,o=null===(e=Ye.collectionViewStore())||void 0===e?void 0:e.getTableFrozenColumnIndex(t,Ye.normalizedFormatStore.state);void 0===o||Ye.isInHomeWidgetStore.state||Ye.frozoneStore.setState({...Ye.frozoneStore.state,frozenIndex:o})}),[Ye]),(0,n.useEffect)((()=>{const e=e=>{const t=Array.from(at.current.keys()??[]),o=S().e5(t,e),n=S().e5(e,t);for(const i of o){var r;null===(r=at.current.get(i))||void 0===r||r.unsubscribe(),at.current.delete(i)}for(const i of n){const e=new(Ge().E)(Ue,(0,m().jY)(i),((e,t)=>{dt.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:oh(T),isCollectionTypeChange:!1})}));e.subscribe(),at.current.set(i,e)}};if(mt)e([mt.id]);else if("collectionTypedView"===Qt){e(Jt??[]);const t=t=>{e(t.state)};return Ye.remoteCollectionIdsStore.addListener(t),()=>{Ye.remoteCollectionIdsStore.removeListener(t)}}}),[Ye.remoteCollectionIdsStore,dt,mt,Qt,Ue,Jt,T]),(0,n.useEffect)((()=>{const e=at.current;return()=>{if(e)for(const t of e.values())t.unsubscribe()}}),[]);const eo=(0,n.useMemo)((()=>({onFocus:Zt,onBlur:zt,onMouseMove:Gt,onMouseLeave:Wt})),[Zt,zt,Gt,Wt]);(0,n.useEffect)((()=>{var e;const t=null===(e=rt.current)||void 0===e?void 0:e.getNode();return t&&(0,ce().lj)(t,"scroll",Ut),()=>{t&&(0,ce().ZV)(t,"scroll",Ut)}}),[Ut]),(0,n.useEffect)((()=>()=>{(0,V().ob)({collectionContextStore:Ye})}),[Ye]),(0,n.useEffect)((()=>()=>{tt.destroy(),ot.destroy(),nt.destroy()}),[tt,ot,nt]),(0,n.useEffect)((()=>()=>{var e;null==it||null===(e=it.current)||void 0===e||e.disconnect()}),[]),(0,o(22648).$W)({collectionContextStore:Ye,isFullScreen:Boolean(j),wasCreatedThisSessionStore:Ye.wasCreatedThisSessionStore,environment:Ue}),(0,n.useEffect)((()=>{var e;const t=null===(e=Ye.collectionStore())||void 0===e?void 0:e.getFormat();if(!t)return;const o=Ye.settingsStore;"Jira"===t.external_collection_type&&t.synced_collection_external_url&&Ie().ZP.state.defaultExternalCollectionSetting&&(y().Qu({collectionSettingsStore:o,source:Ie().ZP.state.defaultExternalCollectionSetting}),Ie().ZP.setState({...Ie().ZP.state,open:!1,defaultExternalCollectionSetting:void 0}))}),[Ye]);const to=(0,a().SI)((()=>{var e;const t=null==mt?void 0:mt.isSyncedCollection(),o=!0===(null==mt||null===(e=mt.getFormat().sync_state)||void 0===e?void 0:e.syncing),n=Ue.device.isMobile;return Boolean(t&&o&&!n)}),[mt,Ue]);(0,a().Kw)(to),(0,n.useEffect)((()=>{const e=async t=>{const n=await o(824462).callApi({eventName:"getExternalCollectionSyncState",environment:Ue,data:t});if("success"===n.type&&n.data.result){const o=n.data.result,r=Ye.numberChildrenReceivedStore,i=Ye.numberChildrenUnfurledStore;r.setState(o.numberChildrenReceived),i.setState(o.numberChildrenUnfurled),i.state/r.state<1&&(ut.current=setTimeout((async()=>{await e(t)}),1e4))}},t=async()=>{if(to){const t=Ye.collectionStore(),o=null==t?void 0:t.getFormat().uri,n=null==t?void 0:t.getFormat().bot_id,r=null==t?void 0:t.id;if(!o||!n||!r)return;await e({uri:o,botId:n,collectionId:r})}};return to.addListener(t),()=>{to.removeListener(t),clearTimeout(ut.current)}}),[to,Ye,Ue]);const oo=(0,a().VK)((()=>Ye.collectionViewStore()),[Ye]),no=(0,a().VK)((()=>{const e=Vt();return j?"timeline"===e?96:180:"timeline"===e||"gallery"===e?0:H?16:Ve().Z.state}),[j,Vt,H]),ro=(0,he().PE)(T,D),io=(0,a().VK)((()=>!!mt&&(0,u().OY)(mt.getValue())),[mt]),lo=(0,a().VK)((()=>(0,re().qG)(T.id)),[T]),so=(0,a().VK)((()=>(0,re().X)(T.id)),[T]),ao=(0,a().VK)((()=>!!lo&&Ye.isEmptyStore.state),[lo,Ye]),co=(0,a().VK)((()=>!!so&&Ye.isEmptyStore.state),[so,Ye]),uo=(0,a().VK)((()=>Rt&&lo&&0===Ye.collectionStoresStore.state.length&&Ye.isLoadedStore.state),[Rt,lo,Ye]),po=(0,a().VK)((()=>Rt&&so&&0===Ye.collectionStoresStore.state.length&&T.getCollectionViewStores().length<=1),[Rt,so,Ye,T]),mo=(0,a().SI)((()=>{if(!Ot||!Lt||!(0,X()._5)(T)||T.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};return{marginLeft:void 0,marginRight:-(J().QB/2)}}),[Ot,Lt,T]);(0,a().Kw)(mo);const go=(0,a().SI)((()=>{var e;if(uo||po)return 0;const t="viewsMain"===(null===(e=Ye.viewsModuleContextStore)||void 0===e?void 0:e.getViewModuleType());return F||"hidden"!==I||!K?t?se().iN:H||Ye.isInHomeWidgetStore.state?se().Ct:se().LO:0}),[uo,po,Ye,F,I,K,H]);(0,a().Kw)(go);const So=(0,a().VK)((()=>{var e,t;const o=_t&&!Fe().default.isSidePeekOpeningStore.state&&!H,n=o?j?{paddingLeft:(null==Et||null===(e=Et.state)||void 0===e?void 0:e.paddingLeft)??0,paddingRight:16}:{paddingLeft:0,paddingRight:((null==Et||null===(t=Et.state)||void 0===t?void 0:t.paddingRight)??0)+16}:null==Et?void 0:Et.state,r=(0,Ce().$3)(Ue),i=(0,X()._5)(T)||j?r:Math.min(me().zL,r);return{minHeight:go.state,paddingLeft:null==n?void 0:n.paddingLeft,paddingRight:null==n?void 0:n.paddingRight,width:B,position:"relative",left:-((null==n?void 0:n.paddingLeft)??0),flexShrink:0,...(Xe||o)&&{position:"sticky",zIndex:86,left:0,width:_t&&n&&!Xe&&!H?i-n.paddingLeft/2:void 0},...T.isNonEditableState()&&{cursor:"default"},...mo.state}}),[_t,j,Xe,Et,Ue,T,go,B,mo,H]),ho=(0,a().SI)((()=>{if(gt||ht||yt||j)return!0;if("always_show"===I)return!0;if(Ue.device.isMobile)return!0;if("form_editor"===Vt())return!0;if(Ye.settingsStore.state.open)return!0;if(Ye.searchOpenStore.state)return!0;if(Ct.state.open)return!0;if(xt.state.open)return!0;if(bt.state.open)return!0;if(Ye.filterBarSortSettingsStore.state.open)return!0;if(Array.from(Ye.filterBarItemSettingsStoreMap.values()).some((e=>e.state.open)))return!0;return!!kt.state.open}),[Ue.device,gt,ht,yt,j,I,Vt,Ye,Ct,xt,bt,kt]);(0,a().Kw)(ho);const fo=(0,n.useCallback)((e=>{if(!Ye.collectionViewBlockStore()||!(0,Oe().ww)(Ue))return;const t=Ye.isMultiSourceView;w().createAndCommit({userAction:"CollectionViewBlock.handleAddItemClick",environment:Ue,canUndo:!0,perform:e=>{(0,V().NZ)({store:T,collectionContextStore:Ye,environment:Ue,transaction:e,shouldCoerce:!0,templateStore:Ye.defaultPageTemplateStore.state,showMoveTo:t,peekModeOverride:Rt?"center_peek":void 0,from:{createBlock:"cvb_add_item"}})}}),f().wd({environment:Ue,collectionContextStore:Ye,action:"click_topbar_new_item"})}),[Ye,Ue,T,Rt]),yo=(0,n.useCallback)((e=>{const{device:t}=Ue,{target:o}=e;if(!oo||t.isMobile||!(o instanceof HTMLElement))return;const n=Vt();n&&0===e.button&&"form_editor"!==n&&(0,de().ZP)({event:e,context:de().Af.EditorMouseDown,callback:()=>{e.preventDefault(),x().AI({environment:Ue,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===n||"table"===n})}})}),[Ue,oo,Vt]),vo=(0,n.useCallback)(((e,t)=>{(0,de().ZP)({event:e,context:de().Af.EditorClick,callback:()=>{if(Tt.state||v().E5(Ue),"page"===t&&!(0,pe().X9)()){const{clientX:t,clientY:o,target:n}=e;l().default.afterNextFlush((()=>{w().createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:Ue,canUndo:!0,perform:e=>{C().editNearestBlockOrInsertIfAtBottomOfPage(Ue,{x:t,y:o,target:n instanceof Element?n:void 0},e)}})}))}}})}),[Ue,Tt]),xo=(0,n.useMemo)((()=>S().Ds(Nt,100)),[Nt]),bo=(0,n.useCallback)((()=>{Re().Z.state||ft(!0)}),[ft]),Co=(0,n.useCallback)((()=>{ft(!1)}),[ft]),wo=(0,n.useCallback)((e=>{e&&tt.observe(e)}),[tt]),ko=(0,n.useCallback)((e=>{e&&nt.observe(e)}),[nt]),Vo=(0,n.useCallback)((e=>{e&&ot.observe(e)}),[ot]),To=(0,n.useCallback)((e=>{var t,o;const n=null==e||null===(t=e.getNode())||void 0===t?void 0:t.classList.contains(ie().PBs);rt.current=n?e:(null==Qe?void 0:Qe.horizontalScroller)||null;const r=Ye.collectionViewStore();Kt(r);const i=null===(o=rt.current)||void 0===o?void 0:o.getNode();"undefined"!=typeof ResizeObserver&&i&&(it.current=new ResizeObserver(xo),it.current.observe(i)),rt.current?Ye.virtualizedModule.setHorizontalScrollerRefStore(rt):Ye.virtualizedModule.setHorizontalScrollerRefStore(void 0)}),[Ye,xo,Kt,Qe]),jo=(0,a().VK)((()=>{if("form_editor"!==Vt()&&Ye.settingsStore.state.open&&"sidebar"===wt.state)return(0,$.jsx)("div",{style:{...Et.state,...mo.state,borderTop:`1px solid ${Ee.tableDividerColor}`,height:12}})}),[Ye,mo,Et,Ee,wt,Vt]),Ro=(0,a().VK)((()=>{const e=null==mt?void 0:mt.getValue();return Boolean(e&&(0,u().Ev)(e))}),[mt]),Po=(0,a().VK)((()=>{var e;if(Vt())return(0,k().H2)({blockStore:T,isFullScreen:Boolean(j),environment:Ue,collectionContextStore:Ye})?0:-((null===(e=Et.state)||void 0===e?void 0:e.paddingLeft)??0)}),[Vt,T,j,Et,Ue,Ye]),[Io,_o,Mo]=(0,a().VK)((()=>[Ye.normalizedSchemaStore.state,Ye.normalizedQueryStore.state,Ye.normalizedFormatStore.state]),[Ye]),Bo=(0,a().VK)((()=>{if("collectionTypedView"===Ye.contextType)return I;if("collectionSystemView"===Ye.contextType){const e=Ye.collectionViewStore(),t=null==e?void 0:e.getCollectionSource();return(0,o(336860).WW)(t)?"default":"hidden"}return!mt||mt&&!1===mt.canRead()||!mt.isDefined()?"hidden":I??"default"}),[Ye,mt,I]),Fo=(0,n.useRef)(null),Ko=(0,a().VK)((()=>{var e;const t=Vt();if(!(oo&&Io&&_o&&Mo&&t))return null;if(Ro)return(0,$.jsx)(E().L1,{value:Ye,children:(0,$.jsx)(He().p,{allowSelectionWithin:!0,style:So,onMouseDown:yo,onMouseMove:bo,onMouseLeave:Co,onClick:vo,ref:(0,g().lq)(wo,Ne),children:(0,$.jsx)(ze().Z,{store:T,shouldShowHoverMenu:!0,analyticsName:(0,X().$l)(t),shouldShowHalo:!Xe&&!Rt,canSelect:!Xe&&!Rt&&!Pt,children:(0,$.jsx)(o(311598).Z,{store:T,style:{width:"auto"},disabled:!1})})})});if(po)return(0,$.jsx)(E().L1,{value:Ye,children:(0,$.jsx)("div",{ref:Ne,...eo,style:{display:"contents"},children:(0,$.jsxs)("div",{style:(0,be().KI)({isPhone:We,theme:Ee}),ref:Fo,children:[(0,$.jsx)("div",{style:{position:"relative"},children:(0,$.jsx)(Ht,{currentViewType:t,headerSizeObserver:tt,contentSizeObserver:nt,settingsHeaderSizeObserver:ot,headerHeightStore:go,viewSettingsPlacementStore:wt,store:T,leftRightPaddingStore:Et,isInHomeWidget:Rt,placementToOrigin:we().Placement.Right,alignmentToOrigin:we().Alignment.Center,headerRef:Fo})}),(0,$.jsx)(ve().Qi,{feature:"custom_db",onSetup:e=>{y().r$({collectionContextStore:Ye,collectionSettingsStore:Ye.settingsStore,hideSettingsHeader:!0,ref:e})}})]})})});const n=(0,$.jsx)(Um,{store:T,collectionStore:mt,collectionViewStore:oo,viewType:t,isDisabled:D,isFullScreen:Boolean(j),isInPeekRenderer:jt,isPreviewing:qe,isRootChild:Ot,paddingLeft:At.paddingLeft,paddingRight:At.paddingRight,paddingBottom:no,headerSizeObserver:tt,timelineViewRef:lt,showHoverActionsStore:ho,handleAddItemClick:fo,isPlaceholderExternalCollection:io,isEmptyMyTasks:ao,isInFrameWhenSidePeekOpen:_t,query:_o,schema:Io,format:Mo,isCustomDbEmptyState:po,maxHeight:L,placementStore:wt,templatePickerMenuListStore:Q}),r=uo?n:(0,$.jsx)(Dt,{store:T,paddingLeft:Bt,isFullScreen:Boolean(j),currentViewType:t,isInPeek:jt,isInHomeWidget:Rt,isUnlistedView:H,viewSettingsPlacementStore:wt,format:Mo,isMyTasksEmpty:ao,isHomeCustomDbEmpty:co,isInFrameWhenSidePeekOpen:_t,handleEditorMouseDown:yo,isRootOrDirectChild:Ot,leftRightPaddingStore:Et,paddingBottom:no,handleHorizontalScrollerMount:To,handleEditorClick:vo,children:n}),i={flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",position:"relative",...mo.state},l=Xe?(0,$.jsx)(He().p,{ref:(0,g().lq)(ko,Ne),allowSelectionWithin:!0,style:i,children:r}):(0,$.jsx)(He().p,{ref:ko,allowSelectionWithin:!0,style:{...i,...Bt&&{marginLeft:-Bt},maxHeight:L?L-go.state:"inherit",...Rt&&Ye.isEditableHomeCollectionStore.state?(0,be().KI)({isPhone:We,theme:Ee}):{},width:B,left:Po},children:(0,$.jsx)("div",{style:{position:"relative",...Rt?{height:"100%",maxHeight:"inherit"}:{}},children:r})});return(0,$.jsx)(E().L1,{value:Ye,children:(0,$.jsx)(o(817870).C,{value:et,children:(0,$.jsxs)("div",{ref:Ne,...eo,style:{display:"contents"},children:[j?void 0:(0,$.jsx)("div",{style:{position:"relative"},children:(0,$.jsx)(Ht,{currentViewType:t,headerSizeObserver:tt,contentSizeObserver:nt,settingsHeaderSizeObserver:ot,headerHeightStore:go,viewSettingsPlacementStore:wt,store:T,leftRightPaddingStore:Et,isInHomeWidget:Rt,headerRef:Fo})}),(0,$.jsx)(q,{}),(0,$.jsx)(It,{isFullScreen:Boolean(j),leftRightPaddingStore:Et,leftRightMarginStore:mo,overrideViewType:P}),(0,$.jsx)($S,{currentViewType:t,store:T,headerWrapStyle:So,headerActionsBehavior:Bo,allowedActions:O,hideViewTabBar:K??!1,showHoverActionsStore:ho,headerSizeObserver:tt,isFullScreen:Boolean(j),isInHomeWidget:Rt,isMyTasksPage:lo,isHomeCustomDbPage:so,isPlaceholderExternalCollection:io,collectionViewHeaderText:F,handleEditorMouseDown:yo,handleHeaderMouseMove:bo,handleHeaderMouseLeave:Co,handleHeaderMount:wo,handleSettingsHeaderMount:Vo,leftRightPaddingStore:Et,headerHeightStore:go,canEdit:ro,viewSettingsPlacementStore:wt,contentSizeObserver:nt,settingsHeaderSizeObserver:ot,handleAddItemClick:fo,timelineViewRef:lt,filterBarCreateFilterSettingsStore:bt,createFilterSettingsStore:xt,switchViewMetric:pt,showOnlyCurrentView:Boolean(U),headerRef:Fo,headerStyleOverrides:{...H&&{paddingLeft:24,paddingRight:24,paddingTop:12}}}),"form_editor"===t?(0,$.jsx)(Ze().Z,{capture:!0,allowSearch:!0,allowEsc:!0,allowUndo:!0,allowOpenLinkMenu:!0,allowBackspace:!0,allowMenuList:!0,render:e=>(0,$.jsx)("div",{...e,children:l})}):l,jo,(0,$.jsx)(Le().Qm,{collectionContextStore:Ye,paddingLeft:null===(e=Et.state)||void 0===e?void 0:e.paddingLeft}),(0,$.jsx)(JS,{collectionContextStore:Ye,collectionViewBlockRenderStartTime:st,didDelayOffscreenRenderRef:Je,mountedBeforeInitialPageRender:De})]})})})}),[Vt,oo,Io,_o,Mo,Ro,po,T,mt,D,j,jt,qe,Ot,At.paddingLeft,At.paddingRight,no,tt,ho,fo,io,ao,_t,L,wt,Q,uo,Bt,Rt,H,co,yo,Et,To,vo,mo,Xe,ko,go,Ye,We,Ee,B,Po,et,eo,nt,ot,P,So,Bo,O,K,lo,so,F,bo,Co,wo,Vo,ro,bt,xt,U,jo,st,Je,De,Pt]);return(0,he().ez)(T,t,(0,a().VK)((()=>({renderedType:"collection_view_page"===T.getType()?"collection_view_page":"collection_view",getBlockStore:()=>T,getNode:()=>Ne.current,collectionContextStore:Ye,resetLeftScrollAfterFlush:()=>{l().default.afterNextFlush((()=>{var e;const t=null===(e=rt.current)||void 0===e?void 0:e.getNode();if(t){t.scrollLeft=0;const e=(0,Se().xH)(t);e&&(e.scrollLeft=0)}}))},handleCreated:()=>function(e,t){b().ZH({environment:t}),l().default.afterNextFlush((()=>{const n=e.collectionStore(),r=e.collectionViewBlockStore(),i=e.settingsStore;if(!r)return;const l=r.getCollectionViewSourceCollectionStore();if(n&&(0,u().OY)(n.getValue()))y().NG({collectionSettingsStore:i});else if(l)(0,V().W1)({environment:t,collectionContextStore:e});else if(n){const l=null==e?void 0:e.collectionViewStore();l?(0,V().K_)({collectionStore:n,collectionViewStore:l,collectionViewBlockStore:r,collectionContextStore:e,environment:t}):(0,o(594134).V)({environment:t,collectionStore:n,collectionContextStore:e,collectionSettingsStore:i}),y().r$({collectionContextStore:e,collectionSettingsStore:i})}else{const t=null==e?void 0:e.collectionViewStore();let n;var s;if(t)n=null===(s=(0,o(714966).x)(t.id))||void 0===s?void 0:s.viewSettingsStack;y().r$({collectionContextStore:e,collectionSettingsStore:i,initialStack:n})}}))}(Ye,Ue)})),[T,Ye,Ue]),Ko)})));function oh(e){var t;return!Be().Z.state.isVisible||!(!Fe().default.isCenterPeekOpen()||null!==(t=Fe().default.peekTargetStore.state)&&void 0!==t&&t.uiContains(e))}const nh=th;class rh extends n.Component{componentDidCatch(e){throw o(680146).vd("collections"),e}render(){const{collectionViewBlockRef:e,...t}=this.props;return(0,$.jsx)(nh,{...t,ref:e})}}const ih=n.forwardRef(((e,t)=>(0,$.jsx)(rh,{...e,collectionViewBlockRef:t})))},269932:(e,t,o)=>{o.d(t,{Z:()=>f});o(667294);var n=()=>o(219727),r=()=>o(109477),i=()=>o(250303),l=()=>o(421654),s=()=>o(269299),a=()=>o(448419),c=()=>o(967092),d=(o(241792),()=>o(788860)),u=()=>o(513670),p=()=>o(352230),m=()=>o(255577),g=o(785893);const S=(0,d().XN)((function(e){const{limit:t}=e;return(0,g.jsx)(d()._H,{defaultMessage:"{limit} pages",values:{limit:t.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})}));const h=(0,d().XN)((function(e){const t=(0,n().O7)(),{device:i}=t,{currentLimit:l,onAccept:s,onClose:a,showTitle:c}=e,h=[{key:0,render:e=>(0,g.jsx)(o(388284).Z,{enableActionSheetTitle:!0,title:c&&(0,g.jsx)(d()._H,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"}),...e}),items:u().oA(r().jk.map(((e,t)=>{const n={key:t,render:t=>(0,g.jsx)(o(827973).Z,{...t,disabled:!1,title:(0,g.jsx)(S,{limit:e}),checkState:u().Xy(l,e)}),action:()=>s(e)};return n})))}];let f;return f=i.isMobile?{menuType:p().o.ActionSheet}:{menuType:p().o.Popup,width:200},(0,g.jsx)(o(198829).Z,{...f,children:(0,g.jsx)(m().Z,{type:m().i.Vertical,sections:h,onAccept:a,initialFocus:void 0})})}));const f=function(e){let{format:t,collectionContextStore:r}=e;const i=(0,n().O7)(),{device:l}=i;return(0,g.jsx)(a().ZP,{popupType:l.isMobile?c().kQ.SlideUp:c().kQ.Popup,renderOrigin:e=>(0,g.jsx)(o(1910).Z,{icon:o(314379).o,style:{marginLeft:4,marginRight:4},...e}),alignmentToOrigin:a().vR.End,placementToOrigin:a().pO.Bottom,originGap:8,render:e=>(0,g.jsx)(v,{parent:e,format:t,collectionContextStore:r})})};function y(e){return(0,r().rx)(e.inline_collection_first_load_limit,Boolean(e.collection_group_by))}function v(e){let{parent:t,format:o,collectionContextStore:r}=e;const a=(0,n().O7)();return(0,g.jsx)(h,{currentLimit:y(o),onAccept:e=>function(e,t,o){const n=t.collectionViewStore();if(!n)return;n.getType()&&(s().createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:o,canUndo:!0,perform:t=>{l().FH({stores:[n],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),i().wd({environment:o,collectionContextStore:t,action:"set_first_load_limit"}))}(e,r,a),onClose:t.close,showTitle:!0})}},455241:(e,t,o)=>{o.d(t,{d:()=>s});o(667294);var n=()=>o(846550),r=()=>o(788860),i=()=>o(653457),l=o(785893);function s(e){const{href:t,style:o}=e,s=(0,n().yK)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.mediumTextColor}})),[]);return(0,l.jsxs)("a",{href:t,target:"_blank",style:{...s.default,...o},children:[(0,i().m)({width:14,marginRight:4}),(0,l.jsx)(r()._H,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}},717940:(e,t,o)=>{o.d(t,{G:()=>l});o(667294);var n=()=>o(846550),r=()=>o(668001),i=o(785893);function l(e){const{widthPercentage:t,isInHomeWidget:o}=e,l=(0,n().yK)((e=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:o?12:16,height:o?12:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:t||"35%",height:10,flexShrink:0,borderRadius:12,marginLeft:2,backgroundColor:e.lightDividerColor},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[t,o]);return(0,i.jsx)("div",{style:l.rowContainer,children:(0,i.jsxs)("div",{style:l.column,children:[(0,i.jsx)(r().Z,{style:l.circleShimmer}),(0,i.jsx)(r().Z,{style:l.rowShimmer})]})})}},542649:(e,t,o)=>{o.d(t,{EZ:()=>r,FD:()=>i,G5:()=>n,rK:()=>l});const n=220,r=24,i=-7,l=-3},57649:(e,t,o)=>{o.d(t,{$t:()=>s,H0:()=>r,gf:()=>l,vq:()=>i});var n=()=>o(513670);function r(e){const{collectionContextStore:t,groupsPointer:o,hasPartialResults:r}=e,i=t.shouldShowSpinnerStore.state,l="load_general"===t.loadingDetailsStore.state.type&&!r||"load_more_blocks"===t.loadingDetailsStore.state.type&&n().Xy(t.loadingDetailsStore.state.group,o);return i&&l}function i(e){const{collectionContextStore:t,displayState:o}=e;return t.shouldShowSpinnerStore.state&&0===o.visibleGroups.length}function l(e){const{collectionContextStore:t,isForColumnGroups:o}=e,n=o?"load_more_columns":"load_more_groups";return t.isLoadingStore.state&&t.loadingDetailsStore.state.type===n}function s(e){const{collectionContextStore:t,groupsPointer:o}=e;return t.shouldShowSpinnerStore.state&&"load_more_blocks"===t.loadingDetailsStore.state.type&&n().Xy(t.loadingDetailsStore.state.group,o)}},382047:(e,t,o)=>{o.d(t,{D:()=>n().D});var n=()=>o(2403)},904255:(e,t,o)=>{o.d(t,{Z:()=>c});var n=o(667294),r=()=>o(846550),i=()=>o(326966),l=()=>o(677559);const s=new(l().Ss)("notionCalendarIcons",(async()=>o.e(192).then(o.bind(o,912320))));var a=()=>o(910746);function c(e){const t=(0,l().XJ)(s),o=function(){const[e,t]=(0,n.useState)(new Date),o=(0,n.useRef)();return(0,n.useEffect)((()=>{const n=()=>{const o=new Date;o.getDate()!==e.getDate()&&t(o)},r=new Date,l=new Date(r);l.setHours(r.getHours()+1),l.setMinutes(0),l.setSeconds(0),l.setMilliseconds(0);const s=l.getTime()-r.getTime(),a=setTimeout((()=>{n(),o.current=window.setInterval(n,i().U6)}),s);return()=>{clearTimeout(a),clearInterval(o.current)}}),[e]),e}(),c=e.dateNumber??o.getDate(),d=(0,r().yK)((t=>({icon:{width:16,height:16,color:t.mediumIconColor,...e.style}})),[e.style]),u=(0,n.useCallback)((e=>{if(e<1||e>31)return(0,a().s)(d.icon);if("resolved"!==t.status)return(0,a().s)(d.icon);const o=`calendarDate${e<10?`0${e}`:`${e}`}Icon`;return(0,t.value[o])(d.icon)}),[d,t]);return u(c)}},619384:(e,t,o)=>{o.d(t,{Z:()=>r});class n extends(()=>o(263184))().default{constructor(){super(...arguments),this.updatePreviewState=e=>{this.update((t=>({...t,previewCanvasState:e(t.previewCanvasState)})))}}getInitialState(){return{chart:void 0,responsiveChartOptions:void 0,previewCanvasState:void 0,exportBackgroundColor:"gradient"}}}const r=n},153694:(e,t,o)=>{o.d(t,{D1:()=>i,Qm:()=>l});var n=()=>o(677559);const r={postInstallTourTooltip:new(n().Ss)("workflowTemplateTourTooltip",(()=>o.e(20550).then(o.bind(o,976690)))),onboardingPills:new(n().Ss)("onboardingPills",(()=>o.e(31257).then(o.bind(o,130347))))},i=(0,n().kF)(r.postInstallTourTooltip,(e=>e.WorkflowTemplateTourTooltip)),l=(0,n().kF)(r.onboardingPills,(e=>e.PostInstallPills))},941310:(e,t,o)=>{o.d(t,{X:()=>r});var n=()=>o(532850);function r(e){const{block:t,property:o,schema:r,getRecordModel:i,userId:l,userTimeZone:s,intl:a,experimentService:c,collectionFeatureGates:d,formulasModule:u}=e;if(!t)return!1;if("title"===o)return!1;const p=r[o];return!(!p||"checkbox"!==p.type)||(!(!p||"button"!==p.type)||(!(!p||"status"!==p.type)||!n().wV({property:o,schema:r,block:t,getRecordModel:i,userId:l,userTimeZone:s,intl:a,experimentService:c,collectionFeatureGates:d,formulasModule:u})))}},910746:(e,t,o)=>{o.d(t,{s:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("calendarDate31",{viewBox:"0 0 20 20",svg:(0,n.jsxs)("g",{children:[(0,n.jsx)("path",{d:"M7.565 10.164c0-.753-.429-1.246-1.104-1.246-.649 0-.87.467-.87 1.207v.13c-.077.013-.142.026-.22.026-.468 0-.805-.39-.805-1.052 0-1.012.935-1.908 2.713-1.908 1.584 0 2.596.805 2.596 2.116 0 .987-.843 1.636-1.674 1.804 1.558.17 2.207 1.052 2.207 2.13 0 1.843-1.39 2.803-3.531 2.803h-.052c-1.61 0-2.74-.662-2.74-1.687 0-.584.442-1.052 1.104-1.052.052 0 .104.013.156.013.13 1.052.857 1.48 1.584 1.48.7 0 1.194-.428 1.194-1.077v-.026c0-1.013-.87-1.117-2.181-1.246l-.208-1.22c1.22-.144 1.83-.494 1.83-1.195zm4.95 4.66v-6.05c-1.298.286-1.583-.285-1.44-.856.779-.13 2.804-.597 3.57-.818v7.776l1.415.286c0 .506-.299.805-.831.805-.442 0-1.467-.026-1.96-.026-.766 0-2.168.026-2.168.026a.851.851 0 01-.052-.299c0-.246.104-.493.441-.584l1.026-.26z"}),(0,n.jsx)("path",{d:"M16.664 0H3.334A3.333 3.333 0 000 3.334v13.332A3.333 3.333 0 003.334 20h13.332A3.333 3.333 0 0020 16.666V3.334A3.333 3.333 0 0016.666 0h-.002zm-.525 17.932H3.861a1.797 1.797 0 01-1.797-1.797V5.485h15.872v10.652c0 .993-.804 1.797-1.797 1.797v-.002z"})]})})}}]);