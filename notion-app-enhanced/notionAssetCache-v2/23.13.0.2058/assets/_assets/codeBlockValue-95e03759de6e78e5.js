"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[84753],{729185:(e,t,n)=>{n.r(t),n.d(t,{CodeBlockValueWithDeps:()=>T});n(492176),n(7961),n(241792);var o=n(667294),i=()=>n(142735),a=()=>n(381839),l=()=>n(582900),r=()=>n(955620),s=()=>n(463212),d=()=>n(513670),c=()=>n(959137),u=()=>n(970105),m=()=>n(491308),g=()=>n(269299),p=()=>n(964433),v=()=>n(315605),f=()=>n(542058),k=()=>n(641702),b=()=>n(435441),h=()=>n(191003),S=()=>n(179809),C=()=>n(677559),x=()=>n(279386),y=()=>n(158429),M=()=>n(645805),w=n(785893);const A=o.memo((function(e){const{disabled:t,store:p,blockStore:v,markdownLinkifyIt:f,codeWrap:b,wrapStyle:C,tinyMceMicrosoftWordPasteFilter:A,language:T,Prism:N,parentSpaceId:B,isQuickFind:R,style:P}=e,U=(0,n(219727).O7)(),j=(0,n(846550).Fg)(),_=(0,n(657320).l)(),H=(0,o.useRef)(null),K=(0,n(527327).sH)(),L=(0,i().Kw)(n(127519).default),O=(0,i().Kw)(n(958783).default),W=(0,i().Kw)(n(8208).Z),Q=(0,i().Kw)(y().l),Y=(0,i().Kw)(y().V),G=(0,i().VK)((()=>_&&_.publicEditModeStore.state),[_]),X=(0,i().VK)((()=>_&&_.pageStore?x().MT.getMode(_.pageStore):"default"),[_]),J=(0,i().VK)((()=>p.canEdit()),[p]),Z=(0,i().VK)((()=>p.canComment()),[p]),q=(0,o.useMemo)((()=>{var e;return"editing"===L.mode&&(null===(e=(0,h().QY)(L.multiSelection))||void 0===e?void 0:e.store)===p}),[p,L]),z=(0,o.useCallback)((()=>{var e;null===(e=H.current)||void 0===e||null===(e=e.getNode())||void 0===e||e.blur()}),[H]),$=(0,o.useMemo)((()=>{var e;return O.open&&"inline"===O.type&&(null===(e=(0,h().QY)(O.multiSelection))||void 0===e?void 0:e.store)===p}),[O,p]),ee=(0,o.useCallback)((()=>{if((0,n(122479).Ix)(G))return!1;const e=null!=_&&_.pageStore?X:"default";return!(t||"suggest"!==e||!Z)||Boolean(!t&&J)}),[t,null==_?void 0:_.pageStore,G,X,J,Z]),te=(0,o.useMemo)((()=>!ee()),[ee]),ne=(0,i().VK)((()=>{if(!W.isHovered||"right_margin_button"!==W.hoverEntryPoint)return!1;const e=M().default.state.isOpen?M().default.state.currentStore:void 0;return p&&(null==e?void 0:e.id)===p.id}),[p,W]),oe=(0,o.useMemo)((()=>{const e=(0,n(12512).yy)(Y)&&Y.id===p.id;return{query:Q,focusedResult:e?Y:void 0}}),[Y,Q,p.id]),ie=(0,o.useCallback)((e=>{var t,o;if(!ee)return;if(D("typing_enter",v,p,U),null===(t=e.preventDefault)||void 0===t||t.call(e),H&&null!==(o=H.current)&&void 0!==o&&o.isComposing())return;const i="editing"===L.mode&&(0,h().QY)(L.multiSelection);if(i){const e=null!=_&&_.pageStore?X:"default";!function(e){const{environment:t,editorMode:o,store:i,selection:a}=e;let l="";if(n(749826).default.checkGate({gateName:"code_block_preserve_indent"})){const e=r().KU1(i.getValue(),0,a.startIndex),t=r().QaF(e).split("\n").at(-1),n=null==t?void 0:t.match(/^[ \t]+/);n&&(l=n[0])}g().createAndCommit({userAction:"CodeBlockValue.handleEnter",environment:t,canUndo:!0,perform:e=>{u().hJ({environment:t,editorMode:o,store:i,string:`\n${l}`,selection:a,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e})}})}({environment:U,store:p,editorMode:e,selection:i.selection})}}),[p,U,v,_,H,ee,L,X]),ae=(0,o.useCallback)((e=>{var t;k().SD({environment:U,event:e,textValue:E({store:p,blockStore:v,inPageFindDetails:oe,isNewDiscussionMenuTarget:$,isRightMarginCommentActionHovered:ne}),editorNode:(null===(t=H.current)||void 0===t?void 0:t.getNode())||void 0,store:p,canEdit:ee()})}),[p,U,v,ee,oe,H,$,ne]),le=(0,o.useCallback)((e=>{if(ee()&&(D("typing_delete",v,p,U),"editing"===L.mode&&L.multiSelection.start.store===p)){const t=null!=_&&_.pageStore?X:"default";g().createAndCommit({userAction:"CodeBlockValue.handleDelete",environment:U,canUndo:!0,perform:n=>{m().as({environment:U,multiSelection:L.multiSelection,deleteForwards:!0,transaction:n,event:e,editorMode:t})}})}}),[U,p,v,ee,_,L,X]),re=(0,o.useCallback)((e=>{if(ee()&&(D("typing_backspace",v,p,U),"editing"===L.mode&&L.multiSelection.start.store===p)){if(m().YV({device:U.device,event:e,multiSelection:L.multiSelection}))return;const t=null!=_&&_.pageStore?X:"default";g().createAndCommit({userAction:"CodeBlockValue.handleBackspace",environment:U,canUndo:!0,perform:n=>{m().as({environment:U,multiSelection:L.multiSelection,deleteForwards:!1,transaction:n,event:e,editorMode:t})}})}}),[U,p,v,ee,_,L,X]),se=(0,o.useCallback)((e=>{var t;if(ee()&&(D("typing_enter",v,p,U),null===(t=e.preventDefault)||void 0===t||t.call(e),"editing"===L.mode)){const e=null!=_&&_.pageStore?X:"default";g().createAndCommit({userAction:"CodeBlockValue.handleShiftEnter",environment:U,canUndo:!0,perform:t=>{n(346839).IO({environment:U,editorMode:e,multiSelection:L.multiSelection,transaction:t})}}),V()}}),[U,p,v,ee,null==_?void 0:_.pageStore,L,X]),de=(0,o.useCallback)((e=>{if(!ee())return;D("typing_tab",v,p,U),e.preventDefault();const t="editing"===L.mode&&(0,h().QY)(L.multiSelection);if(t){const e=null!=_&&_.pageStore?X:"default";g().createAndCommit({userAction:"CodeBlockValue.handleTab",environment:U,canUndo:!0,perform:n=>{u().wA({environment:U,editorMode:e,store:p,selection:t.selection,transaction:n,shouldStripTokens:!0})}})}}),[U,p,v,ee,null==_?void 0:_.pageStore,L,X]),ce=(0,o.useCallback)((e=>{if(!ee())return;D("typing_untab",v,p,U),e.preventDefault();const t="editing"===L.mode&&(0,h().QY)(L.multiSelection);if(t){const e=null!=_&&_.pageStore?X:"default";g().createAndCommit({userAction:"CodeBlockValue.handleUntab",environment:U,canUndo:!0,perform:n=>{u().O5({environment:U,editorMode:e,store:p,selection:t.selection,transaction:n,shouldStripTokens:!0})}})}}),[U,p,v,ee,_,L,X]),ue=(0,o.useCallback)((async e=>{if(!ee())return void e.preventDefault();(await c().F.clipboardActions.load()).cutWithMaybeConfirmation({environment:U,event:e,markdownLinkifyIt:f})}),[U,f,ee]),me=(0,o.useCallback)((async e=>{if(!ee())return void e.preventDefault();const t=await c().F.clipboardActions.load();g().createAndCommit({userAction:"CodeBlockValue.handlePaste",environment:U,canUndo:!0,perform:n=>{t.paste({environment:U,event:e,disableEmbedMenu:!0,transaction:n,onPasteFiles:t.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:f,tinyMceMicrosoftWordPasteFilter:A})}})}),[U,f,A,ee]),ge=(0,o.useCallback)((e=>{var t;k().vO({environment:U,event:e,textValue:E({store:p,blockStore:v,inPageFindDetails:oe,isNewDiscussionMenuTarget:$,isRightMarginCommentActionHovered:ne}),editorNode:(null===(t=H.current)||void 0===t?void 0:t.getNode())||void 0,store:p,canEdit:ee()})}),[ee,U,oe,H,p,v,$,ne]),pe=(0,o.useCallback)((e=>{var t;k().kV({environment:U,event:e,textValue:E({store:p,blockStore:v,inPageFindDetails:oe,isNewDiscussionMenuTarget:$,isRightMarginCommentActionHovered:ne}),editorNode:(null===(t=H.current)||void 0===t?void 0:t.getNode())||void 0,store:p,canEdit:ee()})}),[oe,p,v,$,ne,H,ee,U]),ve=(0,o.useCallback)((()=>{if(q)return(0,n(550054).HE)(p)}),[q,p]),fe=(0,o.useCallback)((()=>{const e=n(659278).p4(r().QaF(E({store:p,blockStore:v,inPageFindDetails:oe,isNewDiscussionMenuTarget:$,isRightMarginCommentActionHovered:ne})));return{startIndex:e.length,endIndex:e.length}}),[p,v,oe,$,ne]),ke=(0,o.useCallback)((()=>{const e=E({store:p,blockStore:v,inPageFindDetails:oe,isNewDiscussionMenuTarget:$,isRightMarginCommentActionHovered:ne}),t=r().QaF(e),n=N.languages[T];if(T!==a().PrismLanguages.html&&T!==a().PrismLanguages.markup||(N.languages.markup.tag.addInlined("style","css"),N.languages.markup.tag.addInlined("script","javascript")),t&&n&&t.length<1e4){const i=document.createElement("div"),a=N.highlight(t,n,T);i.innerHTML=S().g7(a);const c=Array.from(i.childNodes).map(F),u=function(e){let{syntaxTokens:t,textValue:n,parentSpaceId:o,store:i,theme:a}=e;const l=s().Mw(n&&{value:n,spaceId:o},i.getRecordModel),d=S().kF(l,t),c=l.map(r().hDy).map((e=>s().fn({annotations:e,theme:a,spaceId:o,getRecordModel:i.getRecordModel})));return d.map(((e,t)=>(0,w.jsx)("span",{className:[e.classNames||"",...c[e.textTokenIndex].classNames].join(" "),style:c[e.textTokenIndex].style,"data-token-index":e.textTokenIndex,children:e.value},t)))}({parentSpaceId:B,store:p,syntaxTokens:d().oA(c),textValue:e,theme:j}),m=(0,w.jsxs)(o.Fragment,{children:[u,(0,w.jsx)("span",{children:"\n"})]});return l().Z.renderToStaticMarkup(m)}{const t=k().IY({environment:U,textValue:e&&{value:e,spaceId:B},parentStore:p,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!0,disableSuggestionAnnotations:!1,disabled:!ee(),theme:j,emojiType:"raw",katex:void 0,formulaValueTypes:[]});return l().Z.renderToStaticMarkup((0,w.jsx)(w.Fragment,{children:t}))}}),[oe,p,v,$,ne,U,ee,B,N,T,j]),be=(0,o.useCallback)((()=>{g().createAndCommit({userAction:"CodeBlockValue.handleMoveUp",environment:U,canUndo:!0,perform:e=>{u().fs({environment:U,transaction:e,direction:"up"})}})}),[U]),he=(0,o.useCallback)((()=>{g().createAndCommit({userAction:"CodeBlockValue.handleMoveDown",environment:U,canUndo:!0,perform:e=>{u().fs({environment:U,transaction:e,direction:"down"})}})}),[U]),Se=(0,o.useCallback)(((e,t)=>{ee()&&(t.preventDefault(),n(940417).aS({environment:U,annotation:e}),V())}),[ee,U]),Ce=(0,o.useCallback)((e=>{const{newValue:t}=e;D("typing_lag",v,p,U);const n=null!=_&&_.pageStore?x().MT.getMode(null==_?void 0:_.pageStore):"default";g().createAndCommit({userAction:"CodeBlockValue.handleMutation",environment:U,canUndo:!0,perform:e=>{u().aS({environment:U,editorMode:n,store:p,newValue:t,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableFilters:!0,transaction:e})}})}),[v,U,p,null==_?void 0:_.pageStore]),xe=(0,o.useCallback)((async e=>{(await c().F.clipboardActions.load()).copy({environment:U,event:e,markdownLinkifyIt:f})}),[U,f]),ye=(0,o.useCallback)(((e,t,o)=>{let{leafRef:i,wrapperRef:a,...l}=e;if(H)return(0,w.jsx)("div",{ref:a,style:{display:"flex",...!b&&{overflowX:"auto",WebkitOverflowScrolling:"touch"},...C},className:"line-numbers notion-code-block",...l,children:(0,w.jsx)(n(24216).X,{leafRef:K(H,i),style:{...I(j,P),...R&&{paddingTop:12},...b?{whiteSpace:"pre-wrap",wordBreak:"break-all",minWidth:0}:{whiteSpace:"pre"}},debugName:"CodeBlockValue",store:p,isDisabled:te,getHtml:ke,getSelection:ve,onMutation:e=>Ce(e),spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onSelect:t,onMouseOver:ge,onMouseOut:pe,suppressNewlineEvents:!1,placeholder:" ",disableContentEditableWhenNotEditingTextOnMobile:!0,expandSelectionOnTripleClick:!1})})}),[R,b,C,j,P,te,ke,ve,Ce,ge,pe,K,H,p]);return(0,w.jsx)(n(129301).C,{store:p,disabled:t,clearBrowserSelection:z,onBlur:z,getEndSelection:fe,onClick:ae,onDelete:le,onBackspace:re,onEnter:ie,onShiftEnter:se,onCommandEnter:d().yR,onCommandShiftEnter:d().yR,onTab:de,onUntab:ce,onToggleHighlight:e=>Se(["h",n(872430).Z.getMostRecentlyUsedColor()],e),onToggleBold:e=>Se(["b"],e),onToggleItalics:e=>Se(["i"],e),onToggleUnderline:e=>Se(["_"],e),onToggleStrike:e=>Se(["s"],e),onToggleCode:d().yR,onCopy:e=>xe(e),onCut:ue,onPaste:me,onMoveUp:be,onMoveDown:he,render:ye,disableMentions:!0,disableSlashCommands:!0,canSelectAllBlocks:!0,canInsertText:!0,canSelectionDrag:!0,topBottomPadding:40,pasteBehavior:"inline"})}));function T(e){const{value:t}=(0,C().XJ)(v().o),{value:n}=(0,C().XJ)(p().p),{value:o}=(0,C().XJ)(f().m);return t?(0,w.jsx)(A,{...e,Prism:t,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:o}):null}function V(){n(492788).default.flush()}function D(e,t,o,i){(0,n(984975).u)({type:e,environment:i,blockStore:t,store:o,isInCollectionView:!1})}function F(e){return b().Gs(e)?[e.data]:b().kK(e)?[e.textContent||"",e.className]:void 0}function I(e,t){return{flexGrow:1,flexShrink:1,textAlign:"left",fontFamily:n(707513).F5(n(146947).locale).githubMono,fontSize:"85%",tabSize:2,minHeight:"1em",color:e.regularTextColor,...t}}function E(e){const{store:t,blockStore:n,inPageFindDetails:o,isNewDiscussionMenuTarget:i,isRightMarginCommentActionHovered:a}=e;let l=t.getValue();if(o.query&&(l=k().cD({textValue:l,blockId:null==n?void 0:n.id,find:o.query,textProps:{type:"block_match"},currentFocusedResult:o.focusedResult})),a){const e=r().eeV(l);return k().fm({store:t,temporaryAnnotation:r().GKr.TemporarySelection,multiSelection:{start:{store:t,index:0},end:{store:t,index:e.length}}})}return i?k().Gj({store:t}):l}},179809:(e,t,n)=>{n.d(t,{g7:()=>l,kF:()=>s});n(670560),n(122556),n(582845),n(250570),n(533019),n(721473),n(788208),n(22624),n(267602),n(30005),n(241792),n(731107);var o=()=>n(955620),i=()=>n(513670),a=()=>n(435441);function l(e){let t="";const n=document.createElement("div");n.innerHTML=e;const o=a().kd(n);for(const a of o){const e=i().YU(a.data);if(null!==a.parentElement&&a.parentElement!==n){t+=`<span class="${r({parent:a.parentElement,root:n}).join(" ")}">${e}</span>`}else t+=e}return t}function r(e){const{parent:t,root:n}=e,o=new Set;let i=t;for(;i&&i!==n;)i.classList.forEach((e=>{o.add(e)})),i=i.parentElement??void 0;return Array.from(o)}function s(e,t){const n={text:d(e),syntax:d(t)},i=function(e){let t=0;return e.reduce(((e,n)=>(e.push([t,n]),t+=n,e)),[])}(function(e,t){const n=e.slice(),o=t.slice(),i=[];let a=0,l=0;for(;a<n.length&&l<o.length;){const e=n[a],t=o[l];e===t?(i.push(e),a+=1,l+=1):e<t?(i.push(e),a+=1,o[l]-=e):(i.push(t),n[a]-=t,l+=1)}return i}(n.text,n.syntax)),a={text:0,syntax:0},l={text:0,syntax:0},r=[],s=e.map(o().WiV).join("");for(const[o,d]of i){const e=o+d,i=t[a.syntax],u={value:s.substring(o,e),textTokenIndex:a.text,classNames:(c=i,c&&c[1])};r.push(u);const m=n.text[a.text],g=n.syntax[a.syntax];e>=l.text+m&&(a.text+=1,l.text+=m),e>=l.syntax+g&&(a.syntax+=1,l.syntax+=g)}var c;return r}function d(e){return e.map((e=>e[0].length))}}}]);