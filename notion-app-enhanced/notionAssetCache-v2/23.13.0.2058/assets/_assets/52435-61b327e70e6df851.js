"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[52435],{922065:(e,t,o)=>{o.d(t,{r:()=>n});class r extends(()=>o(263184))().default{getInitialState(){return{showHistory:!1,showDebug:!1,previewingStepId:void 0,config:o(923301).t8[0],debugOverrides:{},acceptedInferenceKeys:[],inferenceKeysToAnnotations:{},inferenceKeysToMemories:{},tags:[],abortController:void 0,loading:!1,stopInferencePromise:void 0,temporarySteps:[],inferences:[],allFeaturesEnabled:!1,model:void 0,traceId:void 0,requestInfo:void 0}}}const n=new r},352701:(e,t,o)=>{o.d(t,{n:()=>u});o(670560),o(267602),o(470928);var r=()=>o(459264),n=()=>o(926724),a=()=>o(714230),i=()=>o(235484),s=()=>o(253335),l=()=>o(749826),d=()=>o(138912),c=()=>o(338855);const p=[i().U9,i().f3,i().mQ,i().Dv,i().Nw,i().nO];function u(e,t){if(!e)return[];const o=l().default.checkGate({gateName:"cron_connected_relation"}),u=l().default.checkGate({gateName:"connected_relation"}),f=l().default.checkGate({gateName:"slack_connected_relation"}),y=l().default.checkGate({gateName:"salesforce_connected_relation_database_actions_enabled"}),m=e.getDatabaseType()===n().Ym,_=d().default.state;if(!_.loaded)return[];const w=_.integrations,v={};if(!m){const e=w.find((e=>e.id===i().U9)),t=(0,s().GT)();var g;if(e)v[t.name]={name:t.name,pattern:r().x,integration:e,tooltipImage:{img:a().Z.images.tooltips.properties.githubSyncPullStatusPng,scale:.5},description:t.description,canOnlyAdminAuth:{disabledPropertyTooltipMessage:null===(g=t.canOnlyAdminAuth)||void 0===g?void 0:g.disabledPropertyTooltipMessage}}}const h=[];if(t&&(h.push(i().f3,i().mQ,i().Nw),f&&h.push(i().nO)),o&&h.push(i().Dv),h.forEach((e=>{const t=w.find((t=>t.id===e));if(null!=t&&t.info.original_url_patterns)for(const r of t.info.original_url_patterns){var o;null!==(o=r.additional_types)&&void 0!==o&&o.connectedRelation&&(v[r.name]||(v[r.name]={name:(0,c().ni)({pattern:r,integration:t}),pattern:r,integration:t}))}})),!u)return Object.values(v);for(const r of w)if(r.info.original_url_patterns&&t&&![...p,i().Ff].includes(r.id))for(const e of r.info.original_url_patterns){var b;null!==(b=e.additional_types)&&void 0!==b&&b.connectedRelation&&(v[e.name]||(r.id===i().aW&&y?v[r.name]={name:r.name,pattern:e,integration:r}:v[e.name]={name:(0,c().ni)({pattern:e,integration:r}),pattern:e,integration:r}))}return Object.values(v)}},814866:(e,t,o)=>{o.d(t,{Hi:()=>m,c_:()=>c,mS:()=>f,oD:()=>u,r3:()=>y});var r=()=>o(219727),n=()=>o(142735),a=()=>o(506347),i=()=>o(342792),s=()=>o(696459),l=()=>o(497065),d=()=>o(429725);const c={route:{type:"configure"},chatThreadId:void 0};function p(e){const{RouterStore:t}=e;if("page"!==t.state.route.name)return;const{workflowViewType:o,workflowViewKey:r,chatThreadId:n}=t.state.route;return function(e){const{workflowViewType:t,workflowViewKey:o}=e,r=(0,i().xP)(e.chatThreadId);switch(t){case"configure":case"debug":case"preview":case"runtime_actor":return{route:{type:t},chatThreadId:r};case"function":case"module":case"trigger":case"view_settings":case"view":return o?{route:{type:t,key:o},chatThreadId:r}:c;case"chat":return{route:{type:"chat",transcriptId:r},chatThreadId:r};case"runs":return{route:{type:"runs",runId:(0,i().xP)(o)},chatThreadId:r};case"test":if(!o)return c;const[e,n]=o.split(",");return e&&n?{route:{type:"test",name:n,functionKey:e},chatThreadId:r}:c;default:return}}({workflowViewType:o,workflowViewKey:r,chatThreadId:n})}function u(){const e=(0,r().O7)();return(0,n().VK)((()=>p(e)),[e])}function f(e){const{store:t,environment:o,navigationState:r}=e,n=p(o)??c,i={...n,...r};if(i===n)return;const{workflowViewType:u,workflowViewKey:f,chatThreadId:y}=function(e){const{route:t,chatThreadId:o}=e,r=t.type;switch(r){case"configure":case"debug":case"preview":case"runtime_actor":return{workflowViewType:r,chatThreadId:o};case"function":case"module":case"trigger":case"view_settings":case"view":return{workflowViewType:r,workflowViewKey:t.key,chatThreadId:o};case"chat":return{workflowViewType:r,workflowViewKey:t.transcriptId,chatThreadId:o};case"runs":return{workflowViewType:r,workflowViewKey:t.runId,chatThreadId:o};case"test":return{workflowViewType:r,workflowViewKey:`${t.functionKey},${t.name}`,chatThreadId:o};default:(0,s().t1)(r)}}(i),m=(0,d().Hu)({store:t,pageVisitSource:a().tY.Workflows,workflowViewType:u,workflowViewKey:f,chatThreadId:y});l().c4({environment:o,url:m})}function y(e){const{store:t,environment:o}=e,r=(0,d().Hu)({store:t,pageVisitSource:a().tY.Workflows});l().c4({environment:o,url:r})}function m(e){return void 0!==p(e)}},187435:(e,t,o)=>{o.d(t,{LU:()=>V,P4:()=>M,TR:()=>x,iU:()=>I,pX:()=>P,tO:()=>K,v8:()=>T});o(821057),o(670560),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(653476),o(470928),o(241792);var r=()=>o(530980),n=()=>o(396136),a=()=>o(752778),i=()=>o(139978),s=()=>o(955620),l=()=>o(335696),d=()=>o(470090),c=()=>o(513670),p=()=>o(342792),u=()=>o(543172),f=()=>o(696459),y=()=>o(450048),m=()=>o(332542),_=()=>o(636340),w=()=>o(269299),v=()=>o(276124),g=()=>o(352701),h=()=>o(138912),b=()=>o(826955),S=()=>o(10986),k=()=>o(530924);function M(e){const{environment:t,store:o,workflowStore:r,transaction:d}=e,{inMemoryRecordCache:c}=r,f=r.getSpaceId();if(!f)throw new Error("Space ID not found");const y=(0,S().xI)(r),w=(y.modules||[]).filter((e=>"database"===e.type));if(0===w.length)return;const g={},h=[];for(const n of w){const{key:e,state:t}=n;if(!t||!t.schema)throw new Error("Database state not found");if(t.pointer&&t.propertyKeyToIdMap)g[e]={collectionPointer:t.pointer,propertyKeyToIdMap:t.propertyKeyToIdMap};else{const o={table:a().vF,id:(0,p().ZP)(),spaceId:f};g[e]={collectionPointer:o,propertyKeyToIdMap:{}};for(const[r,n]of Object.entries(t.schema))g[e].propertyKeyToIdMap[r]="title"===n.type?"title":(0,u().ZP)();h.push(n)}}for(const p of h){const{key:e,name:u,state:h}=p;if(!h)throw new Error("Database state not found");const{collectionPointer:S,propertyKeyToIdMap:k}=g[e];if(!h||!h.schema)throw new Error("Database state not found");const M=D({schema:h.schema,environment:t,transaction:d,collectionPointer:S}),x=b().NW.createChildStore(o,S),{schema:I,deletedSchema:K}=(0,l().yr)({databaseKey:e,databaseKeyMap:g,workflowSchema:h.schema,notionSchema:x.getSchema(),connectedRelationCollections:M,databaseModules:w});if(o.isCollectionView())_().ae({environment:t,table:a().vF,value:{id:S.id,schema:I,deleted_schema:K,name:(0,s().TPx)(u),parent_table:n().iU,parent_id:o.id,space_id:f,alive:!0},transaction:d,inMemoryRecordCache:c}),(0,v().z)({collectionViewBlockStore:o,collectionPointer:S,transaction:d});else{const e=_().j4({environment:t,type:"collection_view_page",inMemoryRecordCache:c,transaction:d});_().sW({store:e,data:{parent_id:o.id,parent_table:n().iU,space_id:f,alive:!0},transaction:d}),m().jG({parentStore:o,childStore:e,transaction:d}),_().ae({environment:t,table:a().vF,value:{id:S.id,schema:I,deleted_schema:K,name:(0,s().TPx)(u),parent_table:n().iU,parent_id:e.id,space_id:f,alive:!0},transaction:d,inMemoryRecordCache:c}),(0,v().z)({collectionViewBlockStore:e,collectionPointer:S,transaction:d});const r=_().ae({environment:t,table:i().np,value:{type:"table",format:{collection_pointer:S},parent_table:n().iU,parent_id:e.id,space_id:f,alive:!0},transaction:d,inMemoryRecordCache:c});_().sW({store:e,data:{view_ids:[r.id]},transaction:d})}const T=(y.modules||[]).findIndex((t=>t.key===e));if(-1===T)throw new Error("Module not found");_().sW({store:r.getDataStore().getKeyStore("modules").getKeyStore(T).getKeyStore("state"),data:{pointer:S,propertyKeyToIdMap:k},transaction:d})}}function x(e){const{workflowStore:t,pointer:o,transaction:r}=e,n=(0,S().xI)(t),a=(n.modules||[]).filter((e=>"database"===e.type)),i=b().NW.createChildStore(t,o),s=(0,k().F)({collectionStore:i,databaseModules:a}),l=[...n.modules||[],s];_().sO({store:t.getDataStore().getKeyStore("modules"),value:l,transaction:r});const d=t.getParentStore();null!=d&&d.isCollectionView()&&(0,v().z)({collectionViewBlockStore:d,collectionPointer:o,transaction:r})}function I(e){const{workflowValue:t,workflowStore:o}=e,r=(t.modules||[]).filter((e=>"database"===e.type)),n=r.map((e=>{var t;if(null===(t=e.state)||void 0===t||!t.pointer)throw new Error("Database module pointer not found");return function(e){var t;const{dataBaseModule:o,workflowStore:r,databaseModules:n}=e;if(null===(t=o.state)||void 0===t||!t.pointer)throw new Error("Database pointer not found, must create and connect database before pulling from it");const a=b().NW.createChildStore(r,o.state.pointer);if(!o.state)throw new Error("Database state not found");const{schema:i,propertyKeyToIdMap:s}=(0,l().dw)({databaseKey:o.key,schema:a.getSchema(),databaseModules:n});return o.state.schema=i,o.state.propertyKeyToIdMap=s,o}({dataBaseModule:e,workflowStore:o,databaseModules:r})}));return c().MR([...(t.modules||[]).filter((e=>"database"!==e.type)),...n],(e=>e.key))}function K(e){const{workflowStore:t,transaction:o}=e,r=I({workflowValue:(0,S().xI)(t),workflowStore:t});_().sO({store:t.getDataStore().getKeyStore("modules"),value:r,transaction:o})}function T(e){const t={};for(const o of e){const{key:e,state:r}=o;if(!r||!r.schema||!r.pointer)throw new Error("Database state not found");const n=r.propertyKeyToIdMap||{},a={};t[e]={collectionPointer:r.pointer,propertyKeyToIdMap:a};for(const[t,o]of Object.entries(r.schema))a[t]="title"===o.type?"title":n[t]||(0,u().ZP)()}return t}function P(e){const{environment:t,workflowStore:o,transaction:r,store:n}=e;if(!o.getSpaceId())throw new Error("Space ID not found");const a=((0,S().xI)(o).modules||[]).filter((e=>"database"===e.type&&(0,k().f)({databaseModule:e,store:n})));if(0===a.length)return;const i=T(a);for(const s of a){const{key:e,state:n}=s;if(!n)throw new Error("Database state not found");const{collectionPointer:d,propertyKeyToIdMap:p}=i[e];if(!n||!n.schema)throw new Error("Database state not found");const u=b().NW.createChildStore(o,d),f=q({databaseKey:e,databaseKeyMap:i,schema:n.schema,environment:t,transaction:r,collectionStore:u}),{schema:y,deletedSchema:m}=(0,l().yr)({databaseKey:e,databaseKeyMap:i,workflowSchema:n.schema,notionSchema:u.getSchema(),connectedRelationCollections:f,databaseModules:a});c().Xy(y,u.getSchema())||_().sW({store:u,data:{schema:y,deleted_schema:{...u.getDeletedSchema(),...m}},transaction:r});const w=((0,S().xI)(o).modules||[]).findIndex((t=>t.key===e));if(-1===w)throw new Error("Module not found");_().sW({store:o.getDataStore().getKeyStore("modules").getKeyStore(w).getKeyStore("state"),data:{pointer:d,propertyKeyToIdMap:p},transaction:r})}}function q(e){const{schema:t,environment:o,transaction:r,collectionStore:n,databaseKey:a,databaseKeyMap:i}=e,s=(0,l().c1)({notionSchema:n.getSchema(),databaseKey:a,databaseKeyMap:i});return D({schema:t,environment:o,transaction:r,collectionPointer:n.pointer,existingConnectedRelations:s})}function D(e){const{schema:t,environment:o,transaction:n,collectionPointer:a,existingConnectedRelations:i}=e,s=i||{},d=(0,l().rl)(t);if(0===Object.entries(d).length)return s;const c=(0,g().n)({getDatabaseType:()=>{}},!0);for(const[l,p]of Object.entries(d))if(!s[l])switch(p){case"slack.message":{const e=c.find((e=>"slack_message"===e.pattern.name));if(!e){if(!h().default.state.loaded)throw new Error("External integration store has not been loaded");throw new Error("Slack message relation not found")}const t=r().kk5.fromIntegration(e.integration),i=y().cf({environment:o,pattern:e.pattern,integration:t,parentCollectionStore:{pointer:a,id:a.id},transaction:n});s[l]={collectionPointer:i.pointer,property:(0,u().ZP)(),externalRelationType:"slack.message"};break}default:(0,f().t1)(p)}return s}function V(e){const{environment:t,store:o,workflowStore:r,transaction:a}=e,{inMemoryRecordCache:s}=r,l=(0,S().xI)(r),c=l.views||[],p=(l.modules||[]).filter((e=>"database"===e.type)),u=p.map((e=>{var t;const o=null===(t=e.state)||void 0===t?void 0:t.pointer;if(!o)throw new Error("Database module pointer not found");return b().NW.createChildStore(r,o)})).map((e=>{const t=e.getSchema();if(!t)throw new Error("Collection value not found");return{id:e.id,schema:t}})),f=r.getSpaceId();if(!f)throw new Error("Space ID not found");const y=c.map((e=>{if(e.pointer)return{view:e,collectionViewStore:b().Xr.createChildStore(o,e.pointer)};return{view:e,collectionViewStore:_().ae({environment:t,table:i().np,value:{type:e.type,parent_table:n().iU,parent_id:o.id,space_id:f,alive:!0},transaction:a,inMemoryRecordCache:s})}}));for(const[g,{view:h,collectionViewStore:b}]of y.entries()){const e={id:b.id,table:i().np,spaceId:f},t=(0,d().rD)({workflowView:h,collectionView:void 0,collectionViewPointer:e,collectionViewBlockPointer:{id:o.id,table:n().iU,spaceId:f},databaseModules:p,collections:u});for(const o of t)w().applyOperation({store:b,operation:o,transaction:a});_().sW({store:r.getDataStore().getKeyStore("views").getKeyStore(g),data:{pointer:e},transaction:a})}const m=new Set(y.map((e=>e.collectionViewStore.id))),v=o.getCollectionViewStores().filter((e=>!m.has(e.id)));for(const n of v)_().sW({store:n,data:{alive:!1},transaction:a});_().sW({store:o,data:{view_ids:y.map((e=>e.collectionViewStore.id))},transaction:a})}},452435:(e,t,o)=>{o.r(t),o.d(t,{addModule:()=>O,createNewWorkflowValueWithDatabases:()=>Y,createWorkflowViews:()=>X,disconnectDatabase:()=>R,grantRuntimeActorSufficientAccess:()=>Z,migrateWorkflowBlockToCollectionViewBlock:()=>L,navigateToWorkflow:()=>B,openEditor:()=>Q,removeModule:()=>N,saveAsNewWorkflowFromInferenceTranscriptStep:()=>G,saveFunction:()=>F,saveModule:()=>A,saveTest:()=>U,saveTrigger:()=>W,saveTriggers:()=>j,saveWorkflow:()=>z,startEditWorkflow:()=>J,useInitializationOfExternalStores:()=>ee});o(821057),o(267602),o(653476),o(470928),o(749411),o(241792),o(228244);var r=o(667294),n=()=>o(506347),a=()=>o(933868),i=()=>o(396136),s=()=>o(139978),l=()=>o(325490),d=()=>o(28070),c=()=>o(361929),p=()=>o(955620),u=()=>o(470090),f=()=>o(513670),y=()=>o(342792),m=()=>o(421654),_=()=>o(282662),w=()=>o(784234),v=()=>o(636340),g=()=>o(47443),h=()=>o(145284),b=()=>o(970105),S=()=>o(269299),k=()=>o(423402),M=()=>o(298721),x=()=>o(922065),I=()=>o(487270),K=()=>o(876822),T=()=>o(826955),P=()=>o(10986),q=()=>o(530924),D=()=>o(814866),V=()=>o(187435);function B(e){const{environment:t,store:o}=e;g()._c({environment:t,store:o,pageVisitSource:n().tY.Workflows})}function C(e){const t=e.getParentStore();if(!t)throw new Error("Cannot save workflow without a parent store");if(t.isCollectionView())return t.id}function E(e,t,o){return e.map(((e,r)=>r===t?o:e))}function A(e){const{workflow:t,workflowStore:o,module:r,transaction:n,environment:a,threadStore:i}=e,s=t.modules||[],l=s.findIndex((e=>e.key===r.key));if(-1===l)throw new Error(`Module ${r.key} not found`);if(C(o))return(0,M().fS)({environment:a,threadStore:i,workflowStore:o,workflowData:{...t,modules:E(s,l,r)},transaction:n});{const e=o.getDataStore().getKeyStore("modules").getKeyStore(l);v().sO({store:e,value:r,transaction:n})}}function O(e){const{workflow:t,workflowStore:o,module:r,transaction:n,environment:a,threadStore:i}=e,s=t.modules||[];if(!C(o))throw new Error("Adding modules requires a collection view parent");return(0,M().fS)({environment:a,threadStore:i,workflowStore:o,workflowData:{...t,modules:[...s,r]},transaction:n})}function j(e){const{workflow:t,workflowStore:o,triggers:r,transaction:n,environment:a,threadStore:i}=e;if(!C(o))throw new Error("Saving multiple triggers requires a collection view parent");return(0,M().fS)({environment:a,threadStore:i,workflowStore:o,workflowData:{...t,triggers:r},transaction:n})}function W(e){const{workflow:t,workflowStore:o,trigger:r,transaction:n,environment:a,threadStore:i}=e,s=t.triggers||[],l=s.findIndex((e=>e.key===r.key));if(-1===l)throw new Error(`Trigger ${r.key} not found`);if(C(o))return(0,M().fS)({environment:a,threadStore:i,workflowStore:o,workflowData:{...t,triggers:E(s,l,r)},transaction:n});{const e=o.getDataStore().getKeyStore("triggers").getKeyStore(l);v().sO({store:e,value:r,transaction:n})}}function F(e){const{workflow:t,workflowStore:o,functionValue:r,transaction:n,environment:a,threadStore:i}=e,s=t.functions||[],l=s.findIndex((e=>e.key===r.key));if(-1===l)throw new Error(`Function ${r.key} not found`);if(C(o))return(0,M().fS)({environment:a,threadStore:i,workflowStore:o,workflowData:{...t,functions:E(s,l,r)},transaction:n});{const e=o.getDataStore().getKeyStore("functions").getKeyStore(l);v().sO({store:e,value:r,transaction:n})}}function U(e){const{workflowStore:t,functionKey:o,test:r,transaction:n,workflow:a,environment:i,threadStore:s}=e,l=a.functions||[],d=l.findIndex((e=>e.key===o));if(-1===d)throw new Error(`Function ${o} not found`);const c=l[d].tests||[],p=c.findIndex((e=>e.description.name===r.description.name));if(-1===p)throw new Error(`Test ${r.description.name} not found in function`);if(C(t))return(0,M().fS)({environment:i,threadStore:s,workflowStore:t,workflowData:{...a,functions:E(l,d,{...l[d],tests:c})},transaction:n});{const e=t.getDataStore().getKeyStore("functions").getKeyStore(d).getKeyStore("tests").getKeyStore(p);v().sO({store:e,value:r,transaction:n})}}function R(e){const{workflowStore:t,module:o,transaction:r}=e,n=((0,P().xI)(t).modules||[]).findIndex((e=>e.key===o.key));if(-1===n)throw new Error(`Module ${o.key} not found`);const a=t.getDataStore().getKeyStore("modules").getKeyStore(n).getKeyStore("state");v().sW({store:a,data:{pointer:null},transaction:r})}function N(e){const{workflowStore:t,module:o,transaction:r}=e,n=((0,P().xI)(t).modules||[]).filter((e=>e.key!==o.key));v().sO({store:t.getDataStore().getKeyStore("modules"),value:n,transaction:r})}function G(e){const{environment:t,workflow:o,transaction:r,step:n,threadStore:a,workflowBlockId:s,performPushToDatabases:l=!1}=e,{currentSpaceStore:d,currentSpaceViewStore:u}=K().default.state;if(!d||!u)throw new Error("No current space");let f;s?f=T().G.createChildStore(d,{table:i().iU,id:s,spaceId:d.id}):(f=v().j4({environment:t,type:"workflow",transaction:r,inMemoryRecordCache:d.inMemoryRecordCache}),h().Hj({environment:t,spaceStore:d,spaceViewStore:u,pageStore:f,isPrivate:!0,location:{type:"append"},transaction:r}));const y=f.getTitleStore();y&&(0,p().PgY)(y.getValue())&&b().sO({environment:t,store:y,value:(0,p().TPx)(o.name),transaction:r});const _=v().ae({environment:t,table:c().An,value:{data:o,parent_table:i().iU,parent_id:f.id,space_id:d.id},inMemoryRecordCache:d.inMemoryRecordCache,transaction:r});return m().FH({stores:[f],update:{workflow_id:_.id},transaction:r}),$({step:n,transaction:r,threadStore:a,parentBlockStore:f,spaceId:d.id}),H({environment:t,store:f,workflowStore:_,workflow:o,transaction:r,performPushToDatabases:l}),_}function z(e){const{environment:t,workflowStore:o,transaction:r,workflow:n,threadStore:a,step:i,performPushToDatabases:s=!1}=e;v().sO({store:o.getDataStore(),value:n,transaction:r});const l=o.getParentStore();if(!l)throw new Error("Workflow parent store not found");if(H({environment:t,store:l,workflowStore:o,workflow:n,transaction:r,performPushToDatabases:s}),i&&a){const e=o.getSpaceId();if(!e)throw new Error("Workflow space id not found");$({step:i,transaction:r,threadStore:a,parentBlockStore:l,spaceId:e})}}function $(e){const{step:t,transaction:o,threadStore:r,parentBlockStore:n,spaceId:a}=e,i=T().fI.createChildStore(r,{table:d().xu,id:t.id,spaceId:a});if(!i)throw new Error("Thread message store not found");v().sW({store:i.getStepStore(),data:{workflow_block_id:n.id,saved:!0},transaction:o})}function X(e){const{store:t,modules:o}=e;return f().oA(t.getCollectionViewStores().map((e=>{const t=e.getValue(),r=e.getCollectionStore();if(!r)throw new Error("Collection store not found");const n=r.getSchema(),a=o.find((e=>{var t;return"database"===e.type&&(null===(t=e.state)||void 0===t||null===(t=t.pointer)||void 0===t?void 0:t.id)===r.id}));if(t&&n&&a)return(0,u().u0)({collectionView:t,databaseModule:a,schema:n})})))}function Y(e){const{store:t}=e,o=t.getCollectionPointers()??[],{currentSpaceStore:r,currentSpaceViewStore:n}=K().default.state;if(!r||!n)throw new Error("No current space");return{modules:o.map((e=>{const t=T().NW.createChildStore(r,e);return(0,q().F)({collectionStore:t,databaseModules:[]})}))}}function H(e){const{environment:t,store:o,workflowStore:r,workflow:n,transaction:a,performPushToDatabases:i}=e;((null==n?void 0:n.modules)||[]).some((e=>{var t;return"database"===e.type&&!(null!==(t=e.state)&&void 0!==t&&t.pointer)}))&&(0,V().P4)({environment:t,store:o,workflowStore:r,transaction:a}),i&&(0,V().pX)({environment:t,workflowStore:r,transaction:a,store:o}),(0,V().LU)({environment:t,store:o,workflowStore:r,transaction:a})}function Z(e){const{runtimeActorStore:t,missingRoles:o,transaction:r,environment:n}=e,s=o.getPointersByTable(i().iU);for(const i of s){const e=T().G.createChildStore(t,i),s=o.getRole(i);if(!s)continue;let l;(0,a().J5)(s)?l={read_content:!0,insert_content:!0,update_content:!0,read_comment:!0,insert_comment:!0}:(0,a().YX)(s)&&(l={read_content:!0,read_comment:!0});const d={type:"bot_permission",bot_id:t.id,parent_id:t.getParentId(),parent_table:t.getParentTable(),role:l??"none"};w().l3({environment:n,store:e,permissionItems:[d],transaction:r})}}function J(e){const{environment:t,workflowStore:o,store:r,inputValue:n,additionalSteps:a=[]}=e,{currentSpaceStore:i}=K().default.state;if(!i)return;const s=(0,I().TS)({environment:t,table:l().kL,spaceId:i.id});return(0,M().cz)({environment:t,clientStore:x().r,threadStore:void 0,threadId:s,additionalSteps:[{id:(0,y().c9)(),type:"workflow",value:(0,P().xI)(o),workflow_block_id:r.id,traceId:(0,y().c9)(),saved:!0},...a],config:{type:"workflow",workflowBlockId:r.id},threadParentPointer:o.pointer,userStore:void 0,spaceStore:i,value:(0,p().TPx)(n)}),s}function Q(e){let{environment:t,store:o}=e;(0,D().mS)({store:o,environment:t,navigationState:{route:{type:"configure"}}})}function L(e){const{environment:t,store:o,workflowStore:r,workflow:n,transaction:a,workflowThreads:l}=e,d=o.inMemoryRecordCache,c=o.getSpaceId();if(!c)throw new Error("Space ID not found");v().sW({store:o,data:{type:"collection_view_page"},transaction:a});const f=o.getTitleStore();f&&(0,p().PgY)(f.getValue())&&b().sO({environment:t,store:f,value:(0,p().TPx)(n.name||""),transaction:a});const y=(n.modules||[]).filter((e=>"database"===e.type)),m=y.map((e=>{var t;const o=null===(t=e.state)||void 0===t?void 0:t.pointer;if(!o)throw new Error("Database module pointer not found");return T().NW.createChildStore(r,o)})).map((e=>{const t=e.getSchema();if(!t)throw new Error("Collection value not found");return{id:e.id,schema:t}})),w=y.flatMap((e=>{var t;const r=null===(t=e.state)||void 0===t?void 0:t.pointer;if(r){const e=T().NW.createChildStore(o,r),t=e.getParentStore();if(t&&t.table===i().iU&&t.getParentId()===o.id)return[{collectionStore:e,collectionParentStore:t}]}return[]}));for(const{collectionStore:s}of w)v().sW({store:s,data:{parent_id:o.id,parent_table:i().iU,alive:!0},transaction:a});v().sW({store:o.getFormatStore(),data:{collection_pointers:w.map((e=>{let{collectionStore:t}=e;return t.pointer}))},transaction:a}),w.length>0&&v().sW({store:o.getFormatStore(),data:{collection_pointer:w[0].collectionStore.pointer},transaction:a});const g=n.views||[];for(let p=0;p<g.length;p++){const e=g[p];if(e.pointer)continue;const n=v().ae({environment:t,table:s().np,value:{type:e.type,parent_table:i().iU,parent_id:o.id,space_id:c,alive:!0},transaction:a,inMemoryRecordCache:d}),l=(0,u().rD)({workflowView:e,collectionView:void 0,collectionViewPointer:{id:n.id,table:s().np,spaceId:c},collectionViewBlockPointer:{id:o.id,table:i().iU,spaceId:c},databaseModules:y,collections:m});for(const t of l)S().applyOperation({store:n,operation:t,transaction:a});_().R3({parentStore:o.getCollectionViewsStore(),appendStore:n,transaction:a}),v().sW({store:r.getDataStore().getKeyStore("views").getKeyStore(p),data:{pointer:{id:n.id,table:s().np,spaceId:c}},transaction:a})}for(const s of l)v().sW({store:s,data:{parent_table:i().iU,parent_id:o.id,space_id:o.getSpaceId()},transaction:a})}function ee(e){const{environment:t,spaceId:o}=e;(0,r.useEffect)((()=>{o&&k().pt({environment:t,spaceId:o,force:!1})}),[t,o])}},10986:(e,t,o)=>{o.d(t,{JC:()=>c,M_:()=>h,On:()=>v,a5:()=>u,h:()=>g,jI:()=>p,xI:()=>d});o(670560),o(267602),o(653476),o(241792),o(228244);var r=()=>o(59694),n=()=>o(513670),a=()=>o(144628),i=()=>o(826955),s=()=>o(530924),l=()=>o(735167);function d(e){var t;return(null===(t=e.getModel())||void 0===t?void 0:t.getData())||r().$A}function c(e){const{clientStore:t,threadStore:o}=e,r=(0,a().G)({clientStore:t,threadStore:o});for(let n=r.length-1;n>=0;n--){const e=r[n];if("workflow"===e.type)return e.completed&&!e.saved?e:void 0}}function p(e){const{workflowStore:t,threadStore:o,clientStore:r}=e;if(o&&r){const e=c({threadStore:o,clientStore:r});if(e)return e.value}return t?d(t):void 0}function u(e){return p(e)??d(e.workflowStore)}function f(e,t,o){if(!e)return(null==t?void 0:t.map((e=>({value:e,diff:"added"}))))||[];if(!t)return e.map((e=>({value:e,diff:"removed"})));const r=new Map(e.map((e=>[e[o],e]))),a=new Map(t.map((e=>[e[o],e]))),i=[];for(const[s,l]of a)if(r.has(s)){const e=r.get(s);n().Xy(e,l)||i.push({value:l,diff:"changed"})}else i.push({value:l,diff:"added"});for(const[n,s]of r)a.has(n)||i.push({value:s,diff:"removed"});return i}function y(e){return Object.entries(e).map((e=>{let[t,o]=e;return{key:t,property:(0,l().pf)(o)}}))}function m(e){const{oldSchema:t,newSchema:o}=e;return f(y(t),y(o),"key")}function _(e){const{savedModules:t,newModules:o,store:r}=e,a=t.filter((e=>(0,s().f)({databaseModule:e,store:r}))),i=o.filter((e=>(0,s().f)({databaseModule:e,store:r}))),l=new Map(a.map((e=>[e.key,e]))),d=new Map(i.map((e=>[e.key,e]))),c=[];for(const[s,p]of d)if(l.has(s)){const e=l.get(s),{schema:t,...o}=e.state||{},{schema:r,...a}=p.state||{},i=n().Xy(o,a)?"none":"changed",d=m({oldSchema:t||{},newSchema:r||{}});(d.length>0||"changed"===i)&&c.push({module:p,schemaChanges:d,metadataDiff:i,diff:"changed"})}else c.push({module:p,diff:"added",schemaChanges:[],metadataDiff:"none"});for(const[n,s]of l)d.has(n)||c.push({module:s,diff:"removed",schemaChanges:[],metadataDiff:"none"});return c}function w(e){return e.filter((e=>"database"!==e.type&&"users"!==e.type&&"files"!==e.type&&"recurrence"!==e.type&&"discussions"!==e.type&&"agent"!==e.type))}function v(e){var t,o;const{savedWorkflow:r,newWorkflow:n,store:a}=e;return{description:r.description===n.description?"none":"changed",databaseModules:_({store:a,savedModules:(null===(t=r.modules)||void 0===t?void 0:t.filter((e=>"database"===e.type)))||[],newModules:(null===(o=n.modules)||void 0===o?void 0:o.filter((e=>"database"===e.type)))||[]}),connections:f(w(r.modules||[]),w(n.modules||[]),"key"),triggers:f(r.triggers,n.triggers,"key"),functions:f(r.functions,n.functions,"key"),views:f(r.views,n.views,"key")}}function g(e){var t;const{module:o,store:r}=e,n=null===(t=o.state)||void 0===t?void 0:t.pointer;if(!n)return!1;return i().NW.createChildStore(r,n).getParentId()!==r.id}function h(e){const{diff:t,newWorkflow:o,isNewWorkflow:r,store:n}=e;return!!(t.functions.some((e=>"removed"===e.diff))||t.triggers.some((e=>"removed"===e.diff))||t.connections.some((e=>"removed"===e.diff))||t.views.some((e=>"removed"===e.diff))||t.databaseModules.some((e=>"removed"===e.diff)))||(r?!(null===(a=o.modules)||void 0===a||!a.some((e=>"database"===e.type&&g({module:e,store:n})))):t.databaseModules.some((e=>e.schemaChanges.length>0)));var a}},530924:(e,t,o)=>{o.d(t,{F:()=>l,f:()=>d});o(821057);var r=()=>o(933868),n=()=>o(955620),a=()=>o(335696),i=()=>o(594860),s=()=>o(826955);function l(e){const{collectionStore:t,databaseModules:o,collectionViewId:r}=e,s=(0,n().QaF)(t.getName())||"",l=(0,a().Gw)(s),d={type:"database",key:l,name:s,version:i().O.database.latestVersion,state:{schema:{},propertyKeyToIdMap:{},pointer:t.getSpaceShardedPointer(),collectionViewId:r,accessScope:"read"}},{schema:c,propertyKeyToIdMap:p}=(0,a().dw)({databaseKey:l,schema:t.getSchema(),databaseModules:[...o,d]}),u=d.state;if(!u)throw new Error("Database state not found");return u.schema=c,u.propertyKeyToIdMap=p,d}function d(e){const{databaseModule:t,store:o}=e;if(!t.state)return!1;if("read"===t.state.accessScope)return!1;const n=t.state.pointer;if(!n)return!1;const a=s().NW.createChildStore(o,n).getRole();return!!a&&r().zz(a)}},735167:(e,t,o)=>{o.d(t,{DS:()=>f,Dk:()=>p,N6:()=>s,VI:()=>c,_4:()=>l,ge:()=>u,pf:()=>d});o(821057),o(670560),o(267602),o(653476),o(30005),o(241792);var r=()=>o(335696),n=()=>o(513670),a=()=>o(543172),i=()=>o(826955);function s(e){var t,o,a;const{workflowValue:s,databaseModule:l,store:c}=e,p=null==l||null===(t=l.state)||void 0===t?void 0:t.pointer,u=Object.fromEntries(Object.entries((null==l||null===(o=l.state)||void 0===o?void 0:o.propertyKeyToIdMap)||{}).filter((e=>{let[t]=e;return"content"!==t}))),f=null==l||null===(a=l.state)||void 0===a?void 0:a.schema;if(!p||!f||!u)return null;const y=i().NW.createChildStore(c,p);if(!y)return null;const m=(s.modules||[]).filter((e=>"database"===e.type)),{schema:_,propertyKeyToIdMap:w}=(0,r().dw)({databaseKey:l.key,schema:y.getSchema(),databaseModules:m}),v=[],g=[],h=[];return Object.entries(_).forEach((e=>{let[t,o]=e;t in f?n().Xy(d(o),d(f[t]))||g.push({name:t,type:o.type}):v.push({name:t,type:o.type})})),Object.keys(f).forEach((e=>{e in _||h.push({name:e,type:f[e].type})})),{propertyMapChanged:!n().Xy(u,w),addedProperties:v,removedProperties:h,changedProperties:g}}function l(e){var t,o,n;const{workflowValue:a,databaseModule:s,store:l}=e,d=null==s||null===(t=s.state)||void 0===t?void 0:t.pointer,c=Object.fromEntries(Object.entries((null==s||null===(o=s.state)||void 0===o?void 0:o.propertyKeyToIdMap)||{}).filter((e=>{let[t]=e;return"content"!==t}))),p=null==s||null===(n=s.state)||void 0===n?void 0:n.schema;if(!d||!p||!c)return null;const u=i().NW.createChildStore(l,d);if(!u)return null;const f=(a.modules||[]).filter((e=>"database"===e.type)),{schema:y,propertyKeyToIdMap:m}=(0,r().dw)({databaseKey:s.key,schema:u.getSchema(),databaseModules:f});return{notionState:{schema:y,propertyKeyToIdMap:m},moduleState:{schema:p,propertyKeyToIdMap:c}}}function d(e){if(n().PO(e)){const t=Object.fromEntries(Object.entries(e).map((e=>{let[t,o]=e;return[t,d(o)]})).filter((e=>{let[t,o]=e;return void 0!==o})));return n().xb(t)?void 0:t}if(Array.isArray(e)){const t=n().oA(e.map(d));return n().xb(t)?void 0:t}if(null!=e&&("string"!=typeof e||""!==e))return e}function c(e){var t,o,n;const{databaseModule:i,workflowValue:s,getCollectionSchema:l}=e,c=null==i||null===(t=i.state)||void 0===t?void 0:t.pointer,p=null==i||null===(o=i.state)||void 0===o?void 0:o.propertyKeyToIdMap;if(!c||!p)return"needs-create";const u=l(c);if(!u)return"loading-database";if(!i.state)throw new Error("Database module state not found");const f=(null===(n=s.modules)||void 0===n?void 0:n.filter((e=>"database"===e.type)))||[],y={};for(const r of[...f,i]){const{state:e}=r.key===i.key?i:r;if(!e)throw new Error("Database state not found");if(e.pointer&&e.propertyKeyToIdMap){y[r.key]={collectionPointer:e.pointer,propertyKeyToIdMap:e.propertyKeyToIdMap};for(const t of Object.keys(e.schema))y[r.key].propertyKeyToIdMap[t]=e.propertyKeyToIdMap[t]||(0,a().ZP)()}}const m=(0,r().c1)({notionSchema:u,databaseKey:i.key,databaseKeyMap:y}),{schema:_}=(0,r().yr)({databaseKey:i.key,databaseKeyMap:y,workflowSchema:i.state.schema,notionSchema:u,connectedRelationCollections:m,databaseModules:f});return{workflowSchema:d(_),notionSchema:d(u)}}function p(e){const t=c({databaseModule:e.databaseModule,workflowValue:e.workflowValue,getCollectionSchema:e.getCollectionSchema});if("needs-create"===t||"loading-database"===t)return t;return n().Xy(d(t.workflowSchema),d(t.notionSchema))?"synced":"needs-update"}function u(e){return t=>{const o=i().NW.createChildStore(e,t);return null==o?void 0:o.getSchema()}}const f={getDescription:e=>e.formatMessage({defaultMessage:"This connection allows accessing and editing the connected Notion database.",id:"workflow.module.database.description"}),getName:(e,t)=>t.state?(0,n().kC)(t.name||"Untitled"):e.formatMessage({defaultMessage:"Database",id:"workflow.module.database.title"}),isValidAndConnected:(e,t,r)=>"synced"===p({databaseModule:e,workflowValue:(0,o(10986).xI)(t),getCollectionSchema:u(r)}),getMessageIfNotValid:e=>e.formatMessage({defaultMessage:"The workflow and database are out of sync. Sync them to continue using this workflow.",id:"workflow.module.database.notConnected"})}},923301:(e,t,o)=>{o.d(t,{Bc:()=>i,EX:()=>n,t8:()=>r,zF:()=>a});const r=[{type:"markdown-chat"},{type:"search"},{type:"workflow"},{type:"setup-generator"},{type:"researcher",maxIterations:3,ignoreUnverifiedClaims:!1,filterArtifacts:!1,filterToSpaceSharedResults:!1,fastMode:!0,evaluateAsync:!0,searchOriginalQueryFirst:!1,runInQueue:!1,skipAgentPostprocessing:!1,useWebSearch:!1,numSearchResultsMultiplier:1},{type:"fast-researcher"},{type:"tool-markdown-chat"}],n="unifiedFind",a={originalOutput:[],feedback:"",inputSummary:"",promptFeedback:"",testInstructions:"",originalOutputPassesTest:!1,originalOutputTestResults:[],correctedOutputs:[],verified:!1},i=["Eval","Prompt"]},470090:(e,t,o)=>{o.d(t,{rD:()=>w,u0:()=>u});o(821057),o(670560),o(267602),o(653476),o(470928),o(749411),o(241792);var r=()=>o(696459),n=()=>o(124199),a=()=>o(455947),i=()=>o(109477),s=()=>o(305580),l=()=>o(396136),d=()=>o(139978),c=()=>o(989478),p=()=>o(335696);n().union([n().object({required:{operator:n().literals("is_empty","is_not_empty")},optional:{},exact:!0}),n().object({required:{operator:n().literals("string_contains","string_does_not_contain","string_ends_with","string_is","string_is_not","string_starts_with"),value:n().object({required:{type:n().literal("exact"),value:n().union([n().isUndefined(),n().string()])},optional:{},exact:!0})},optional:{},exact:!0})]),n().union([n().object({required:{operator:n().literals("is_empty","is_not_empty")},optional:{},exact:!0}),n().object({required:{operator:n().literals("number_does_not_equal","number_equals","number_greater_than","number_greater_than_or_equal_to","number_less_than","number_less_than_or_equal_to"),value:n().object({required:{type:n().literal("exact"),value:n().union([n().isUndefined(),n().number()])},optional:{},exact:!0})},optional:{},exact:!0})]),n().union([n().object({required:{operator:n().literals("date_is","date_is_after","date_is_before","date_is_on_or_after","date_is_on_or_before"),value:n().union([n().object({required:{type:n().literal("exact"),value:n().union([n().isUndefined(),n().string()])},optional:{},exact:!0}),n().object({required:{type:n().literal("relative"),value:n().literals("one_month_ago","one_month_from_now","one_week_ago","one_week_from_now","today","tomorrow","yesterday")},optional:{},exact:!0})])},optional:{use_end:n().boolean()},exact:!0}),n().object({required:{operator:n().literals("is_empty","is_not_empty")},optional:{},exact:!0})]),n().union([n().object({required:{type:n().literal("exact"),value:n().union([n().isUndefined(),n().string()])},optional:{},exact:!0}),n().object({required:{type:n().literal("relative"),value:n().literals("one_month_ago","one_month_from_now","one_week_ago","one_week_from_now","today","tomorrow","yesterday")},optional:{},exact:!0})]),n().union([n().object({required:{operator:n().literals("enum_is","enum_is_not"),value:n().union([n().array(n().object({required:{type:n().literal("exact"),value:n().union([n().isUndefined(),n().string()])},optional:{},exact:!0})),n().object({required:{type:n().literal("exact"),value:n().union([n().isUndefined(),n().string()])},optional:{},exact:!0})])},optional:{},exact:!0}),n().object({required:{operator:n().literals("is_empty","is_not_empty")},optional:{},exact:!0})]),n().union([n().object({required:{operator:n().literals("enum_contains","enum_does_not_contain"),value:n().union([n().array(n().object({required:{type:n().literal("exact"),value:n().union([n().isUndefined(),n().string()])},optional:{},exact:!0})),n().object({required:{type:n().literal("exact"),value:n().union([n().isUndefined(),n().string()])},optional:{},exact:!0})])},optional:{},exact:!0}),n().object({required:{operator:n().literals("is_empty","is_not_empty")},optional:{},exact:!0})]),n().object({required:{operator:n().literals("checkbox_is","checkbox_is_not"),value:n().object({required:{type:n().literal("exact"),value:n().union([n().isUndefined(),n().literal(!1),n().literal(!0)])},optional:{},exact:!0})},optional:{},exact:!0}),n().union([n().object({required:{operator:n().literals("is_empty","is_not_empty")},optional:{},exact:!0}),n().object({required:{operator:n().literals("relation_contains","relation_does_not_contain"),value:n().union([n().array(n().object({required:{type:n().literal("exact"),value:n().union([n().isUndefined(),n().string()])},optional:{},exact:!0})),n().object({required:{type:n().literal("exact"),value:n().union([n().isUndefined(),n().string()])},optional:{},exact:!0})])},optional:{},exact:!0})]),n().object({required:{operator:n().literals("is_empty","is_not_empty")},optional:{},exact:!0}),n().union([n().object({required:{operator:n().literals("is_empty","is_not_empty")},optional:{},exact:!0}),n().object({required:{operator:n().literals("status_is","status_is_not"),value:n().union([n().array(n().object({required:{type:n().literals("is_group","is_option"),value:n().union([n().isUndefined(),n().string()])},optional:{},exact:!0})),n().object({required:{type:n().literals("is_group","is_option"),value:n().union([n().isUndefined(),n().string()])},optional:{},exact:!0})])},optional:{},exact:!0})]),n().union([n().object({required:{operator:n().literals("is_empty","is_not_empty")},optional:{},exact:!0}),n().object({required:{operator:n().literals("person_contains","person_does_not_contain"),value:n().union([n().array(n().union([n().object({required:{type:n().literal("exact"),value:n().union([n().isUndefined(),n().string()])},optional:{},exact:!0}),n().object({required:{type:n().literal("relative"),value:n().literal("me")},optional:{},exact:!0})])),n().object({required:{type:n().literal("exact"),value:n().union([n().isUndefined(),n().string()])},optional:{},exact:!0}),n().object({required:{type:n().literal("relative"),value:n().literal("me")},optional:{},exact:!0})])},optional:{},exact:!0})]),'\nIn addition to action: "update", key, name, and type, you must provide additional properties in order to match one of the following UpdateView types:\n\n// Defines how to filter items in a view. Can be nested.\nFilter = {\n\toperator: "and" | "or",\n\tfilters: Array<PropertyFilter | Filter>\n}\n\n// Defines how to filter by a specific property.\nPropertyFilter = {\n\tproperty: string,\n\tfilter: TextFilter | NumberFilter | DateFilter | SelectFilter | MultiSelectFilter | CheckboxFilter | RelationFilter | FileFilter | StatusFilter | PersonFilter\n}\n\n// Defines how to filter text properties.\nTextFilter = {\n\toperator: "string_is" | "string_is_not" | "string_contains" | "string_does_not_contain" | "string_starts_with" | "string_ends_with",\n\tvalue: { type: "exact", value: string | undefined }\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter number properties.\nNumberFilter = {\n\toperator: "number_equals" | "number_does_not_equal" | "number_greater_than" | "number_less_than" | "number_greater_than_or_equal_to" | "number_less_than_or_equal_to",\n\tvalue: { type: "exact", value: number | undefined }\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter date properties.\nDateFilter = {\n\toperator: "date_is" | "date_is_before" | "date_is_after" | "date_is_on_or_before" | "date_is_on_or_after",\n\tvalue:\n\t\t| { type: "exact", value: string | undefined } // ISO 8601 date string\n\t\t| { type: "relative", value: "today" | "tomorrow" | "yesterday" | "one_week_ago" | "one_week_from_now" | "one_month_ago" | "one_month_from_now" },\n\tuse_end?: boolean\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter select properties.\nSelectFilter = {\n\toperator: "enum_is" | "enum_is_not",\n\tvalue: { type: "exact", value: string | undefined } | Array<{ type: "exact", value: string | undefined }>\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter multi-select properties.\nMultiSelectFilter = {\n\toperator: "enum_contains" | "enum_does_not_contain",\n\tvalue: { type: "exact", value: string | undefined } | Array<{ type: "exact", value: string | undefined }>\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter checkbox properties.\nCheckboxFilter = {\n\toperator: "checkbox_is" | "checkbox_is_not",\n\tvalue: { type: "exact", value: boolean | undefined }\n}\n\n// Defines how to filter relation properties.\nRelationFilter = {\n\toperator: "relation_contains" | "relation_does_not_contain",\n\tvalue: { type: "exact", value: string | undefined } | Array<{ type: "exact", value: string | undefined }>\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter file properties.\nFileFilter = {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter status properties.\nStatusFilter = {\n\toperator: "status_is" | "status_is_not",\n\tvalue: { type: "is_group" | "is_option", value: string | undefined } | Array<{ type: "is_group" | "is_option", value: string | undefined }>\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to filter person properties.\nPersonFilter = {\n\toperator: "person_contains" | "person_does_not_contain",\n\tvalue: { type: "exact", value: string | undefined } | { type: "relative", value: "me" } | Array<{ type: "exact", value: string | undefined } | { type: "relative", value: "me" }> // String values are Notion user IDs\n} | {\n\toperator: "is_empty" | "is_not_empty"\n}\n\n// Defines how to sort items in a view.\nSort = {\n\t// Must be a valid property from the database schema that is not content.\n\tproperty: string,\n\tdirection: "ascending" | "descending"\n}\n\n// Defines how to group items in a view.\nGroupBy = {\n\tproperty: string,\n\thideEmptyGroups?: boolean\n} & (\n\t{\n\t\ttype: "title" | "text" | "url" | "email" | "phone_number",\n\t\tgroupBy: "exact" | "alphabet_prefix",\n\t\tsort: "manual" | "ascending" | "descending"\n\t} |\n\t{\n\t\ttype: "number",\n\t\tgroupBy?: { type: "unique", start?: number, end?: number },\n\t\tstart: number,\n\t\tend: number,\n\t\tsize: number,\n\t\tsort: "ascending" | "descending"\n\t} |\n\t{\n\t\ttype: "date" | "created_time" | "last_edited_time",\n\t\tgroupBy: "relative" | "day" | "week" | "month" | "year",\n\t\tsort: "ascending" | "descending",\n\t\tstartDayOfWeek?: 0 | 1\n\t} |\n\t{\n\t\ttype: "select" | "multi_select",\n\t\tsort: "manual" | "ascending" | "descending"\n\t} |\n\t{\n\t\ttype: "status",\n\t\tgroupBy: "group" | "option",\n\t\tsort: "manual" | "ascending" | "descending"\n\t} |\n\t{\n\t\ttype: "person",\n\t\tsort: "manual"\n\t} |\n\t{\n\t\ttype: "relation",\n\t\tsort: "manual" | "ascending" | "descending"\n\t} |\n\t{\n\t\ttype: "checkbox",\n\t\tsort: "manual"\n\t}\n)\n\n// Each updated view must match one of the following types:\nUpdateView = {\n\taction: "update",\n\tkey: string,\n\tname: string,\n\ttype: "table",\n\tdatabaseKey: string,\n\t// Properties from the database schema that should be shown as columns, excluding content type. Must include the title property.\n\tcolumns: Array<string>,\n\t// Optional property to group rows by, must be a valid property from schema that is not content.\n\tgroupBy?: GroupBy,\n\tfilter?: Filter,\n\tsorts?: Array<Sort>\n} | {\n\taction: "update",\n\tkey: string,\n\tname: string,\n\ttype: "board",\n\tdatabaseKey: string,\n\t// Required property to group cards by, must be a valid property from schema that is not content.\n\tgroupBy: GroupBy,\n\t// Optional properties to show on cards, excluding content and title.\n\tcardAdditionalProperties?: Array<string>,\n\t// Optional secondary grouping property, must be a valid property from schema that is not content.\n\tsubGroupBy?: GroupBy,\n\tfilter?: Filter,\n\tsorts?: Array<Sort>\n} | {\n\taction: "update",\n\tkey: string,\n\tname: string,\n\ttype: "calendar",\n\tdatabaseKey: string,\n\t// Required date property to use for calendar view (must be date, created_time, or last_edited_time).\n\tcalendarBy: string,\n\t// Optional properties to show on cards, excluding content and title.\n\tcardAdditionalProperties?: Array<string>,\n\tfilter?: Filter,\n\tsorts?: Array<Sort>\n} | {\n\taction: "update",\n\tkey: string,\n\tname: string,\n\ttype: "list",\n\tdatabaseKey: string,\n\t// Optional properties to show for each item, excluding content and title.\n\trowAdditionalProperties?: Array<string>,\n\t// Optional property to group items by, must be a valid property from schema that is not content.\n\tgroupBy?: GroupBy,\n\tfilter?: Filter,\n\tsorts?: Array<Sort>\n} | {\n\taction: "update",\n\tkey: string,\n\tname: string,\n\ttype: "gallery",\n\tdatabaseKey: string,\n\t// Optional properties to show on cards, excluding content and title.\n\tcardAdditionalProperties?: Array<string>,\n\t// Optional property to group cards by, must be a valid property from schema that is not content.\n\tgroupBy?: GroupBy,\n\tfilter?: Filter,\n\tsorts?: Array<Sort>\n} | {\n\taction: "update",\n\tkey: string,\n\tname: string,\n\ttype: "timeline",\n\tdatabaseKey: string,\n\t// Required date property to use for timeline (must be date, created_time, or last_edited_time).\n\ttimelineBy: string,\n\t// Optional properties to show on cards, excluding content and title\n\trowAdditionalProperties?: Array<string>,\n\t// Optional property to group items by, must be a valid property from schema that is not content.\n\tgroupBy?: GroupBy,\n\tfilter?: Filter,\n\tsorts?: Array<Sort>\n} | {\n\taction: "update",\n\tkey: string,\n\tname: string,\n\ttype: "chat"\n}\n'.trim();function u(e){const{collectionView:t,databaseModule:o,schema:n}=e,a={table:d().np,id:t.id,spaceId:t.space_id},l=t.name;if(!l)throw new Error("Collection view name is required");if("table"===t.type){var c,u;const e=(0,s().i)(t.format,n,t.query2,i().j5.Table);return{type:"table",key:(0,p().Gw)(l),name:l,databaseKey:o.key,columns:(e.table_properties||[]).map((e=>y({propertyId:e.property,databaseModule:o}))),groupBy:f({groupBy:e.collection_group_by,databaseModule:o}),filter:m({collectionView:t,filter:null===(c=t.query2)||void 0===c?void 0:c.filter,databaseModule:o}),sorts:_({sort:null===(u=t.query2)||void 0===u?void 0:u.sort,databaseModule:o}),pointer:a}}if("board"===t.type){var w,v,g,h;const e=null===(w=t.format)||void 0===w?void 0:w.board_columns_by;if(!e)throw new Error("Board group by property is required");const r=f({groupBy:e,databaseModule:o});if(!r)throw new Error("Board group by property is required");return{type:"board",key:(0,p().Gw)(l),name:l,databaseKey:o.key,groupBy:r,cardAdditionalProperties:null===(v=t.format)||void 0===v||null===(v=v.board_properties)||void 0===v?void 0:v.map((e=>y({propertyId:e.property,databaseModule:o}))),filter:m({collectionView:t,filter:null===(g=t.query2)||void 0===g?void 0:g.filter,databaseModule:o}),sorts:_({sort:null===(h=t.query2)||void 0===h?void 0:h.sort,databaseModule:o}),pointer:a}}if("calendar"===t.type){var b,S,k,M;const e=null===(b=t.query2)||void 0===b?void 0:b.calendar_by;if(!e)throw new Error("Calendar by property is required");return{type:"calendar",key:(0,p().Gw)(l),name:l,databaseKey:o.key,calendarBy:y({propertyId:e,databaseModule:o}),cardAdditionalProperties:null===(S=t.format)||void 0===S||null===(S=S.calendar_properties)||void 0===S?void 0:S.map((e=>y({propertyId:e.property,databaseModule:o}))),filter:m({collectionView:t,filter:null===(k=t.query2)||void 0===k?void 0:k.filter,databaseModule:o}),sorts:_({sort:null===(M=t.query2)||void 0===M?void 0:M.sort,databaseModule:o}),pointer:a}}var x,I,K,T,P,q,D,V;if("list"===t.type)return{type:"list",key:(0,p().Gw)(l),name:l,databaseKey:o.key,rowAdditionalProperties:null===(x=t.format)||void 0===x||null===(x=x.list_properties)||void 0===x?void 0:x.map((e=>y({propertyId:e.property,databaseModule:o}))),groupBy:null!==(I=t.format)&&void 0!==I&&I.collection_group_by?f({groupBy:t.format.collection_group_by,databaseModule:o}):void 0,filter:m({collectionView:t,filter:null===(K=t.query2)||void 0===K?void 0:K.filter,databaseModule:o}),sorts:_({sort:null===(T=t.query2)||void 0===T?void 0:T.sort,databaseModule:o}),pointer:a};if("gallery"===t.type)return{type:"gallery",key:(0,p().Gw)(l),name:l,databaseKey:o.key,cardAdditionalProperties:null===(P=t.format)||void 0===P||null===(P=P.gallery_properties)||void 0===P?void 0:P.map((e=>y({propertyId:e.property,databaseModule:o}))),groupBy:null!==(q=t.format)&&void 0!==q&&q.collection_group_by?f({groupBy:t.format.collection_group_by,databaseModule:o}):void 0,filter:m({collectionView:t,filter:null===(D=t.query2)||void 0===D?void 0:D.filter,databaseModule:o}),sorts:_({sort:null===(V=t.query2)||void 0===V?void 0:V.sort,databaseModule:o}),pointer:a};if("timeline"===t.type){var B,C,E,A,O;const e=null===(B=t.query2)||void 0===B?void 0:B.timeline_by;if(!e)throw new Error("Timeline by property is required");return{type:"timeline",key:(0,p().Gw)(l),name:l,databaseKey:o.key,timelineBy:y({propertyId:e,databaseModule:o}),rowAdditionalProperties:null===(C=t.format)||void 0===C||null===(C=C.timeline_properties)||void 0===C?void 0:C.map((e=>y({propertyId:e.property,databaseModule:o}))),groupBy:null!==(E=t.format)&&void 0!==E&&E.collection_group_by?f({groupBy:t.format.collection_group_by,databaseModule:o}):void 0,filter:m({collectionView:t,filter:null===(A=t.query2)||void 0===A?void 0:A.filter,databaseModule:o}),sorts:_({sort:null===(O=t.query2)||void 0===O?void 0:O.sort,databaseModule:o}),pointer:a}}if("chat"===t.type)return{type:"chat",key:(0,p().Gw)(l),name:l,pointer:a};"form_editor"!==t.type&&"feed"!==t.type&&"chart"!==t.type&&"page"!==t.type&&"map"!==t.type&&(0,r().t1)(t.type)}function f(e){const{groupBy:t,databaseModule:o}=e;if(!t)return;const r={property:y({propertyId:t.property,databaseModule:o}),hideEmptyGroups:t.hideEmptyGroups};switch(t.type){case"title":case"text":case"url":case"email":case"phone_number":return{...r,type:t.type,groupBy:t.groupBy||"exact",sort:t.sort.type||"manual"};case"number":return{...r,type:"number",start:t.start||0,end:t.end||100,size:t.size||10,sort:t.sort.type||"ascending",groupBy:t.groupBy};case"date":case"created_time":case"last_edited_time":return{...r,type:t.type,groupBy:t.groupBy||"relative",sort:t.sort.type||"ascending",startDayOfWeek:t.startDayOfWeek};case"select":case"multi_select":case"relation":return{...r,type:t.type,sort:t.sort.type||"manual"};case"status":return{...r,type:"status",groupBy:t.groupBy||"group",sort:t.sort.type||"manual"};case"person":return{...r,type:"person",sort:"manual"};case"checkbox":return{...r,type:"checkbox",sort:"manual"};default:return}}function y(e){var t;const{propertyId:o,databaseModule:r}=e,n=Object.entries((null===(t=r.state)||void 0===t?void 0:t.propertyKeyToIdMap)||{}).find((e=>{let[t,r]=e;return r===o}));if(!n)throw new Error("Property not found");return n[0]}function m(e){const{collectionView:t,filter:o,databaseModule:n}=e;if(o)return{operator:o.operator,filters:(o.filters||[]).flatMap((e=>{if((0,a().vA)(e)){const o=m({collectionView:t,filter:e,databaseModule:n});return o?[o]:[]}if((0,a().aN)(e)){const t=function(e){const{filter:t,databaseModule:o}=e,n=t.filter.operator,a=y({propertyId:t.property,databaseModule:o});if("string_is"===n||"string_is_not"===n||"string_contains"===n||"string_does_not_contain"===n||"string_starts_with"===n||"string_ends_with"===n)return{property:a,filter:{operator:n,value:t.filter.value}};if("checkbox_is"===n||"checkbox_is_not"===n)return{property:a,filter:{operator:n,value:t.filter.value}};if("enum_is"===n||"enum_is_not"===n||"enum_contains"===n||"enum_does_not_contain"===n)return{property:a,filter:{operator:n,value:t.filter.value}};if("status_is"===n||"status_is_not"===n)return{property:a,filter:{operator:n,value:t.filter.value}};if("relation_contains"===n||"relation_does_not_contain"===n){const e=t.filter.value,o=Array.isArray(e)?e.flatMap((e=>"exact"===e.type?[{type:"exact",value:e.value}]:[])):"exact"===e.type?{type:"exact",value:e.value}:void 0;if(!o||Array.isArray(o)&&0===o.length)return;return{property:a,filter:{operator:n,value:o}}}if("person_contains"===n||"person_does_not_contain"===n){var i;const e=t.filter.value,o=Array.isArray(e)?e.flatMap((e=>{var t;return"exact"===e.type&&null!==(t=e.value)&&void 0!==t&&t.id?[{type:"exact",value:e.value.id}]:[]})):"exact"===e.type?{type:"exact",value:null===(i=e.value)||void 0===i?void 0:i.id}:void 0;if(!o||Array.isArray(o)&&0===o.length)return;return{property:a,filter:{operator:n,value:o}}}if("number_equals"===n||"number_does_not_equal"===n||"number_greater_than"===n||"number_less_than"===n||"number_greater_than_or_equal_to"===n||"number_less_than_or_equal_to"===n){return{property:a,filter:{operator:n,value:t.filter.value}}}if("date_is"===n||"date_is_before"===n||"date_is_after"===n||"date_is_on_or_before"===n||"date_is_on_or_after"===n){var s;const e=t.filter.value;return{property:a,filter:{operator:n,value:"exact"===e.type?{type:"exact",value:null===(s=e.value)||void 0===s?void 0:s.start_date}:e}}}if("is_empty"===n||"is_not_empty"===n)return{property:a,filter:{operator:n}};if("string_has_no_alphabet_prefix"===n||"location_is"===n||"location_is_not"===n||"verification_is"===n||"verification_is_not"===n||"any"===n||"none"===n||"every"===n||"date_is_within"===n||"date_is_relative_to"===n||"geo_point_is_within"===n||"geo_point_is_not_within"===n)return;(0,r().t1)(n)}({filter:e,databaseModule:n});return t?[t]:[]}return[]}))}}function _(e){const{sort:t,databaseModule:o}=e;if(t&&0!==t.length)return t.map((e=>({property:y({propertyId:e.property,databaseModule:o}),direction:e.direction})))}function w(e){const{workflowView:t,databaseModules:o,collectionViewPointer:n,collectionViewBlockPointer:a,collections:i}=e,s=[],d={id:n.id,name:t.name,type:t.type,parent_id:a.id,parent_table:l().iU,space_id:n.spaceId,alive:!0};if(s.push({pointer:n,path:[],command:"update",args:d}),"table"===t.type){var c;if(!t.databaseKey)throw new Error(`DatabaseKey not found in: ${JSON.stringify(t)}`);const e=v({databaseModules:o,key:t.databaseKey}),r=null===(c=e.state)||void 0===c?void 0:c.pointer;if(!r)throw new Error("Collection pointer not found");if(!i.find((e=>e.id===r.id)))throw new Error("Collection not found");const a={collection_pointer:r,table_properties:t.columns.map((t=>({property:g({propertyKey:t,databaseModule:e}),visible:!0}))),collection_group_by:h({groupBy:t.groupBy,databaseModule:e})};s.push({pointer:n,path:["format"],command:"update",args:a});const l={filter:b({filter:t.filter,databaseModule:e}),sort:S({sorts:t.sorts,databaseModule:e})};s.push({pointer:n,path:["query2"],command:"update",args:l})}else if("board"===t.type){var p,u;const e=v({databaseModules:o,key:t.databaseKey}),r=null===(p=e.state)||void 0===p?void 0:p.pointer;if(!r)throw new Error("Collection pointer not found");const a={collection_pointer:r,board_columns_by:h({groupBy:t.groupBy,databaseModule:e}),collection_group_by:h({groupBy:t.subGroupBy,databaseModule:e}),board_properties:null===(u=t.cardAdditionalProperties)||void 0===u?void 0:u.map((t=>({property:g({propertyKey:t,databaseModule:e}),visible:!0})))};s.push({pointer:n,path:["format"],command:"update",args:a});const i={filter:b({filter:t.filter,databaseModule:e}),sort:S({sorts:t.sorts,databaseModule:e})};s.push({pointer:n,path:["query2"],command:"update",args:i})}else if("calendar"===t.type){var f,y;const e=v({databaseModules:o,key:t.databaseKey}),r=null===(f=e.state)||void 0===f?void 0:f.pointer;if(!r)throw new Error("Collection pointer not found");const a={collection_pointer:r,calendar_properties:null===(y=t.cardAdditionalProperties)||void 0===y?void 0:y.map((t=>({property:g({propertyKey:t,databaseModule:e}),visible:!0})))};s.push({pointer:n,path:["format"],command:"update",args:a});const i={filter:b({filter:t.filter,databaseModule:e}),sort:S({sorts:t.sorts,databaseModule:e}),calendar_by:g({propertyKey:t.calendarBy,databaseModule:e})};s.push({pointer:n,path:["query2"],command:"update",args:i})}else if("list"===t.type){var m,_;const e=v({databaseModules:o,key:t.databaseKey}),r=null===(m=e.state)||void 0===m?void 0:m.pointer;if(!r)throw new Error("Collection pointer not found");const a={collection_pointer:r,collection_group_by:h({groupBy:t.groupBy,databaseModule:e}),list_properties:null===(_=t.rowAdditionalProperties)||void 0===_?void 0:_.map((t=>({property:g({propertyKey:t,databaseModule:e}),visible:!0})))};s.push({pointer:n,path:["format"],command:"update",args:a});const i={filter:b({filter:t.filter,databaseModule:e}),sort:S({sorts:t.sorts,databaseModule:e})};s.push({pointer:n,path:["query2"],command:"update",args:i})}else if("gallery"===t.type){var w,k;const e=v({databaseModules:o,key:t.databaseKey}),r=null===(w=e.state)||void 0===w?void 0:w.pointer;if(!r)throw new Error("Collection pointer not found");const a={collection_pointer:r,collection_group_by:h({groupBy:t.groupBy,databaseModule:e}),gallery_properties:null===(k=t.cardAdditionalProperties)||void 0===k?void 0:k.map((t=>({property:g({propertyKey:t,databaseModule:e}),visible:!0})))};s.push({pointer:n,path:["format"],command:"update",args:a});const i={filter:b({filter:t.filter,databaseModule:e}),sort:S({sorts:t.sorts,databaseModule:e})};s.push({pointer:n,path:["query2"],command:"update",args:i})}else if("timeline"===t.type){var M,x;const e=v({databaseModules:o,key:t.databaseKey}),r=null===(M=e.state)||void 0===M?void 0:M.pointer;if(!r)throw new Error("Collection pointer not found");const a={collection_pointer:r,collection_group_by:h({groupBy:t.groupBy,databaseModule:e}),timeline_properties:null===(x=t.rowAdditionalProperties)||void 0===x?void 0:x.map((t=>({property:g({propertyKey:t,databaseModule:e}),visible:!0})))};s.push({pointer:n,path:["format"],command:"update",args:a});const i={filter:b({filter:t.filter,databaseModule:e}),sort:S({sorts:t.sorts,databaseModule:e}),timeline_by:g({propertyKey:t.timelineBy,databaseModule:e}),timeline_by_end:t.timelineByEnd?g({propertyKey:t.timelineByEnd,databaseModule:e}):void 0};s.push({pointer:n,path:["query2"],command:"update",args:i})}else"chat"===t.type||(0,r().t1)(t);return s}function v(e){const{databaseModules:t,key:o}=e,r=t.find((e=>e.key===o));if(!r)throw new Error(`Database module not found: ${o}`);return r}function g(e){var t;const{propertyKey:o,databaseModule:r}=e,n=null===(t=r.state)||void 0===t||null===(t=t.propertyKeyToIdMap)||void 0===t?void 0:t[o];if(!n)throw new Error(`Property not found: ${o}`);return n}function h(e){const{groupBy:t,databaseModule:o}=e;if(!t)return;const n={property:g({propertyKey:t.property,databaseModule:o}),hideEmptyGroups:t.hideEmptyGroups};return"title"===t.type||"text"===t.type||"url"===t.type||"email"===t.type||"phone_number"===t.type?{...n,type:t.type,groupBy:t.groupBy,sort:{type:t.sort}}:"number"===t.type?{...n,type:"number",groupBy:t.groupBy,start:t.start,end:t.end,size:t.size,sort:{type:t.sort}}:"date"===t.type||"created_time"===t.type||"last_edited_time"===t.type?{...n,type:t.type,groupBy:t.groupBy,sort:{type:t.sort},startDayOfWeek:t.startDayOfWeek}:"select"===t.type||"multi_select"===t.type?{...n,type:t.type,sort:{type:t.sort}}:"status"===t.type?{...n,type:"status",groupBy:t.groupBy,sort:{type:t.sort}}:"person"===t.type?{...n,type:"person",sort:{type:"manual"}}:"relation"===t.type?{...n,type:"relation",sort:{type:t.sort}}:"checkbox"===t.type?{...n,type:"checkbox",sort:{type:"manual"}}:void(0,r().t1)(t.type)}function b(e){const{filter:t,databaseModule:o}=e;if(t)return{operator:t.operator,filters:t.filters.flatMap((e=>{if("property"in e){const t=function(e){var t;const{filter:o,databaseModule:n}=e,a=g({propertyKey:o.property,databaseModule:n}),i=null===(t=n.state)||void 0===t?void 0:t.schema[o.property];if(!i)return;if("string_is"===o.filter.operator||"string_is_not"===o.filter.operator||"string_contains"===o.filter.operator||"string_does_not_contain"===o.filter.operator||"string_starts_with"===o.filter.operator||"string_ends_with"===o.filter.operator)return{property:a,filter:{operator:o.filter.operator,value:o.filter.value}};if("number_equals"===o.filter.operator||"number_does_not_equal"===o.filter.operator||"number_greater_than"===o.filter.operator||"number_less_than"===o.filter.operator||"number_greater_than_or_equal_to"===o.filter.operator||"number_less_than_or_equal_to"===o.filter.operator)return{property:a,filter:{operator:o.filter.operator,value:o.filter.value}};if("date_is"===o.filter.operator||"date_is_before"===o.filter.operator||"date_is_after"===o.filter.operator||"date_is_on_or_before"===o.filter.operator||"date_is_on_or_after"===o.filter.operator){const e=o.filter.value,t="relative"===e.type?{type:"relative",value:e.value}:e.value?{type:"exact",value:{type:"date",start_date:e.value}}:void 0;if(!t)return;return{property:a,filter:{operator:o.filter.operator,value:t,use_end:o.filter.use_end}}}if("enum_is"===o.filter.operator||"enum_is_not"===o.filter.operator)return{property:a,filter:{operator:o.filter.operator,value:o.filter.value}};if("enum_contains"===o.filter.operator||"enum_does_not_contain"===o.filter.operator)return{property:a,filter:{operator:o.filter.operator,value:o.filter.value}};if("checkbox_is"===o.filter.operator||"checkbox_is_not"===o.filter.operator)return{property:a,filter:{operator:o.filter.operator,value:o.filter.value}};if("relation_contains"===o.filter.operator||"relation_does_not_contain"===o.filter.operator)return{property:a,filter:{operator:o.filter.operator,value:o.filter.value}};if("is_empty"===o.filter.operator||"is_not_empty"===o.filter.operator)return{property:a,filter:{operator:o.filter.operator}};if("status_is"===o.filter.operator||"status_is_not"===o.filter.operator)return{property:a,filter:{operator:o.filter.operator,value:o.filter.value}};if("person_contains"===o.filter.operator||"person_does_not_contain"===o.filter.operator){const e=o.filter.value,t=Array.isArray(e)?e.map((e=>"relative"===e.type?{type:"relative",value:e.value}:{type:"exact",value:e.value?{table:c().KJ,id:e.value}:void 0})):{type:"exact",value:e.value?{table:c().KJ,id:e.value}:void 0};return{property:a,filter:{operator:o.filter.operator,value:t}}}(0,r().t1)(o.filter.operator)}({filter:e,databaseModule:o});return t?[t]:[]}{const t=b({filter:e,databaseModule:o});return t?[t]:[]}}))}}function S(e){const{sorts:t,databaseModule:o}=e;if(t)return t.map((e=>({property:g({propertyKey:e.property,databaseModule:o}),direction:e.direction})))}}}]);