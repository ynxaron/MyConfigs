"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[97583,95986],{832024:(e,t,o)=>{o.d(t,{AK:()=>m,Mc:()=>a,OS:()=>d,Td:()=>f,Uu:()=>s,XC:()=>l,ZK:()=>v,e8:()=>p,gV:()=>u,hc:()=>g,n0:()=>_,u0:()=>y,xi:()=>c});var n=()=>o(594546),i=()=>o(572623),r=()=>o(697623);function a(e){n().K4(e,"add_slack_integration")}function s(e){n().K4(e,"remove_slack_integration")}function l(e,t){n().K4(e,"slack_notification_create",t)}function c(e,t){n().K4(e,"slack_notification_delete",t)}function d(e,t){n().K4(e,"slack_notification_update",t)}function u(e,t){const o=r().zt(),a=i().JF();n().K4(e,"slack_imports_invite_render_button",{subscription_tier:o,domain_type:a,origin:t.origin,invite_flow_id:t.invite_flow_id})}function p(e,t){const o=r().zt(),a=i().JF();n().K4(e,"slack_imports_invite_render_invite_popup",{subscription_tier:o,domain_type:a,origin:t.origin,invite_flow_id:t.invite_flow_id})}function m(e,t){const o=r().zt(),a=i().JF();n().K4(e,"slack_imports_invite_click_invite_button",{subscription_tier:o,domain_type:a,invited_user_count:t.invited_user_count,origin:t.origin,invite_token_query:t.inviteTokenQuery,invite_targets:t.inviteTargets,invite_flow_id:t.invite_flow_id})}function y(e,t){const o=r().zt(),a=i().JF();n().K4(e,"slack_imports_invite_completed",{subscription_tier:o,domain_type:a,invited_user_count:t.invited_user_count,is_success:t.is_success,origin:t.origin,invite_flow_id:t.invite_flow_id,error:t.error,invite_stage:t.invite_stage})}function f(e,t){const o=r().zt(),a=i().JF();n().K4(e,"slack_imports_invite_dismiss_popup",{subscription_tier:o,domain_type:a,origin:t.origin,invite_flow_id:t.invite_flow_id})}function g(e,t){const o=r().zt(),a=i().JF();n().K4(e,"slack_imports_invite_click_select_all",{subscription_tier:o,domain_type:a,origin:t.origin,invite_flow_id:t.invite_flow_id,invited_user_count:t.invited_user_count,is_unselect:t.is_unselect,invite_token_query:t.invite_token_query})}function _(e,t){const o=r().zt(),a=i().JF();n().K4(e,"slack_imports_invite_start_slack_integration",{subscription_tier:o,domain_type:a,origin:t.origin,invite_flow_id:t.invite_flow_id,from:t.from})}function v(e,t){const o=r().zt(),a=i().JF();n().K4(e,"slack_imports_invite_complete_slack_integration",{subscription_tier:o,domain_type:a,origin:t.origin,invite_flow_id:t.invite_flow_id,from:t.from,is_success:t.is_success})}},501912:(e,t,o)=>{o.d(t,{T:()=>f});o(670560),o(667294);var n=()=>o(788860),i=()=>o(707513),r=()=>o(360746),a=()=>o(384241),s=()=>o(129338),l=()=>o(90065),c=()=>o(688745),d=()=>o(382474),u=()=>o(917881),p=()=>o(308186),m=()=>o(269299),y=o(785893);async function f(e){const{environment:t,collectionContextStore:o,property:f,handleDeleteAccept:g}=e,_=o.collectionStore();if(!_)return;if(_.isTypedProperty(f)){if(await r().w0({environment:t,property:f,collectionContextStore:o,theme:e.theme,from:e.from}))return}const v=(0,d()._U)({environment:t,collectionStore:_,propertyId:f});if(v.length>0){if((0,c().Ym)({environment:t,collectionStore:_,propertyId:f,compoundTemplateInstancesToDelete:v,collectionContextStore:o,from:e.from}))return}else if(((0,l().e_)(f)||(0,l().TJ)({collectionStore:_,propertyId:f}))&&(0,l().sA)(_)&&(0,l().tj)()){if((0,c().D5)({environment:t,collectionStore:_,propertyId:f,collectionContextStore:o,from:e.from}))return}const h=o.normalizedSchemaStore.state,S=h[f],b=s().ny(o,S);await(null==b?void 0:b.load());const M=b&&s().OP(o,f,b),C=b&&s().gZ(b),w=b&&_.id===b.id,A=[{label:(0,y.jsx)(n()._H,{id:"database.viewSettings.propertyTab.deleteProperty.modal.confirmButton",defaultMessage:"Delete"}),color:"red",onAccept:g}];let x;if(M&&_&&C&&!w&&A.push({label:(0,y.jsx)(n()._H,{id:"database.tableHeaderCell.deleteProperty.modal.inverseConfirmButton",defaultMessage:"Delete, but keep related property"}),color:"red",onAccept:()=>{m().createAndCommit({userAction:"collectionPropertyActions.showDeletePropertyDialog",environment:t,canUndo:!0,perform:e=>{if(S&&"relation"===S.type&&S.property&&b){const o=S.property,n=b.getSchema();u().q0({environment:t,collectionStore:b,propertySchema:n[o],property:o,targetPropertyID:void 0,autoRelate:_.isSyncedCollection()&&!b.isSyncedCollection()?{enabled:!1}:S.autoRelate,transaction:e})}u().kQ({environment:t,collectionStore:_,property:f,transaction:e})}})}}),"auto_increment_id"===(null==S?void 0:S.type))x=s().pR(h)?(0,y.jsx)(n()._H,{id:"database.tableHeaderCell.deleteUniqueIdWithGithubProperty.modal.prompt",defaultMessage:"You will no longer be able to link new GitHub PRs and status automations will stop working."}):(0,y.jsx)(n()._H,{id:"database.tableHeaderCell.deleteUniqueIdProperty.modal.prompt",defaultMessage:"The ID property will be permanently deleted."});else if("status"===(null==S?void 0:S.type)){const e=s().Pi(h);if(e){const t=e.connectedRelation.automation;t&&t[f]&&(x=(0,y.jsx)(n()._H,{id:"database.tableHeaderCell.deleteStatusProperty.modal.prompt",defaultMessage:"Deleting this status property will stop the GitHub Pull Requests status automation."}))}}else b&&C&&!w&&M&&(x=(0,y.jsx)(n()._H,{id:"database.tableHeaderCell.deleteRelatedProperty.modal.prompt",defaultMessage:"This property has a related property on {relationTargetName} which will also be deleted.",values:{relationTargetName:(0,y.jsx)(a().Z,{style:{display:"inline",fontWeight:i().Ue.medium},store:b})}}));p().vC({message:(0,y.jsx)("span",{children:(0,y.jsx)(n()._H,{id:"database.tableHeaderCell.deleteProperty.modal.prompt",defaultMessage:"Delete this property from {databaseName}? It will be removed from all views.",values:{databaseName:(0,y.jsx)(a().Z,{style:{display:"inline",fontWeight:i().Ue.bold},shouldWrap:!0,store:_})}})}),description:x,showCancel:!0,keepFocus:!0,items:A,mode:"wide"})}},49396:(e,t,o)=>{o.r(t),o.d(t,{addAutomationAction:()=>F,clearInvalidVariables:()=>$,createAutomation:()=>Z,deleteAutomation:()=>X,disableAutomation:()=>Y,duplicateAutomation:()=>N,duplicateAutomationAction:()=>W,enableAutomation:()=>q,insertEmptyTextInDuplicateBlockAction:()=>G,messages:()=>L,removeAutomationAction:()=>B,reorderAutomationActions:()=>O,restartAutomation:()=>U});o(821057),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(653476),o(470928),o(30005),o(241792);var n=o.n(o(369282)),i=()=>o(730120),r=()=>o(492788),a=()=>o(912203),s=()=>o(271896),l=()=>o(764052),c=()=>o(157955),d=()=>o(559102),u=()=>o(92960),p=()=>o(481529),m=()=>o(827370),y=()=>o(494616),f=()=>o(922713),g=()=>o(81954),_=()=>o(955620),v=()=>o(513670),h=()=>o(543172),S=()=>o(855741),b=()=>o(696459),M=()=>o(832024),C=()=>o(282662),w=()=>o(332542),A=()=>o(636340),x=()=>o(990966),P=()=>o(269299),T=()=>o(205228),k=()=>o(872308),I=()=>o(594546),R=()=>o(615676),j=()=>o(487270),E=()=>o(32969),V=()=>o(637118),H=()=>o(309841),D=()=>o(658517),K=()=>o(807629);const L=(0,o(788860).vU)({genericErrorMessage:{id:"automations.buttonTrigger.genericErrorMessage",defaultMessage:"Button failed to execute"},open:{defaultMessage:"Open",id:"automations.buttonTrigger.open"},undo:{defaultMessage:"Undo",id:"automations.buttonTrigger.undo"},defaultConfirmationWorkflowText:{defaultMessage:"Are you sure you want to continue?",id:"automations.buttonTrigger.defaultConfirmationWorkflowText"},defaultContinueWorkflowMessage:{defaultMessage:"Continue",id:"automations.buttonTrigger.defaultContinueWorkflowMessage"},defaultStopWorkflowMessage:{defaultMessage:"Cancel",id:"automations.buttonTrigger.defaultStopWorkflowMessage"},errorQueryCollectionTooManyPages:{defaultMessage:"Button impacts too many pages",id:"automations.buttonTrigger.errorQueryCollectionTooManyPages"},errorRecordInTrash:{id:"automations.buttonTrigger.errorRecordInTrash",defaultMessage:"Button is editing a page in trash"}});function Z(e){const{actionIds:t,automationId:o,automationName:i,environment:r,inMemoryRecordCache:a,parentPointer:s,transaction:l,trigger:c}=e,d=o??(0,j().TS)({environment:r,table:y().cv,spaceId:s.spaceId}),u=A().ae({environment:r,inMemoryRecordCache:a??r.defaultRecordCache.inMemoryRecordCache,table:y().cv,transaction:l,value:{action_ids:t,alive:!0,id:d,parent_id:s.id,parent_table:s.table,properties:{name:i},space_id:s.spaceId,status:"active",trigger:c}});return n()(u.isTriggerType(c.type),"Trigger type mismatch"),u}function F(e){const{actionId:t,environment:o,intl:i,automationStore:a,actionType:l,transaction:c,insertionPoint:d,config:u,createDuplicateBlocksContainer:p=!0,builderType:g="sidebar"}=e,v=a.getSpaceId();if(!v)return;let S;if("duplicate_blocks"===l&&p){S=A().j4({environment:o,inMemoryRecordCache:a.inMemoryRecordCache,transaction:c,type:"text"});const e=G({environment:o,contentStore:S.getContentStore(),transaction:c});r().default.afterNextFlush((()=>{const t=E().C.find((t=>m().dr.isEqual(t.props.store.pointer,e.pointer)));t&&x().setSelectionAtStart({store:t.props.store.getBlockTitleStore()})}))}const M=u??function(e){const{actionType:t,automationStore:o,intl:n}=e;if("modal_confirmation"===t)return{continue_button:{text:n.formatMessage(L.defaultContinueWorkflowMessage)},cancel_button:{text:n.formatMessage(L.defaultStopWorkflowMessage)},text:{type:"simple",value:(0,_().TPx)(n.formatMessage(L.defaultConfirmationWorkflowText))}};if("define_variables"===t){const e=(0,h().ZP)();return{values:{[e]:{name:(0,D().h)(o.getActionStores(),n.formatMessage(f().eC)),value:{type:"simple",value:[[""]]}}},variableIds:[e]}}}({actionType:l,automationStore:a,intl:i})??{},w=A().ae({environment:o,inMemoryRecordCache:a.inMemoryRecordCache,table:f().Xj,transaction:c,value:{id:t,type:l,parent_id:a.id,parent_table:y().cv,alive:!0,space_id:v,config:M,blocks:S?[S.id]:[]}});return S&&C().R3({transaction:c,parentStore:w.getKeyStore("blocks"),appendStore:S}),!d||"afterActionId"in d?C().R3({transaction:c,parentStore:a.getActionIdsStore(),appendStore:w,after:null==d?void 0:d.afterActionId}):"beforeActionId"in d?C().Ce({transaction:c,parentStore:a.getActionIdsStore(),prependStore:w,before:d.beforeActionId}):(0,b().t1)(d),z({transaction:c,automationStore:a}),(0,H().GV)(((e,t,n)=>{const i=(0,I().mc)(o),r=(0,H().TI)({automationActionStore:w,formulaAnalyticsModule:t,formulasModule:e,simpleFormulasModule:n});(0,b().$K)(r)&&(0,s().A2)(i,{automation_action:r,automation_action_id:w.id,automation_id:w.getParentId(),builder_type:g}),w.isDefined()&&(0,s().eI)(i,{automation_action_id:w.id,automation_action_type:w.getType(),automation_id:a.id,builder_type:g})})),n()(w.isType(l),"Action type mismatch"),w}function U(e){var t,o;const{automationStore:n,transaction:r}=e,a=n.getRecurrence();if(!a)return;const s=i().ou.now().plus({day:1}).startOf("day"),l={...a,start_date:s.toMillis(),end_condition:"date"===(null===(t=a.end_condition)||void 0===t?void 0:t.type)?{type:"date",end_at:(0,c().getNewEndTimestamp)(s,a.start_date,null===(o=a.end_condition)||void 0===o?void 0:o.end_at).toMillis()}:a.end_condition};A().sW({store:n,transaction:r,data:{status:"active"}}),A().sW({store:n.getKeyStore("trigger"),transaction:r,data:{recurrence:(0,c().convertFromUnpersistedRecurrenceConfig)(l)}})}function N(e){const{actorPointer:t,environment:o,includeParenting:n,sourceAutomationStore:i,targetAutomationId:r,transaction:a}=e,s=i.getParentStore();if(!s||!s.isReady())throw new Error("Automation parent store not ready");const l=i.getValue(),c=i.getSpaceId();if(!(0,b().$K)(l)||!(0,b().$K)(c))throw new Error("Undefined automation value or space id");const u={},p={...(0,v().Xh)(l),id:r??(0,j().TS)({environment:o,table:y().cv,spaceId:(0,g().J)(c)})};u[i.id]=p.id,(0,b().$K)(p.action_ids)&&(0,b().Of)(p.action_ids)&&p.action_ids.forEach((e=>u[e]=(0,j().TS)({environment:o,table:f().Xj,spaceId:(0,g().J)(c)})));const m=e=>{let{requested:t}=e;const o=u[t.id];return(0,b().$K)(o)?{...t,id:o}:t};(0,d().J_)({actor:t,duplicateRecord:p,options:{},mapper:m,originalRecord:l});const _=A().ae({environment:o,inMemoryRecordCache:i.inMemoryRecordCache,table:y().cv,transaction:a,value:p});n&&w().jG({childStore:_,parentStore:s,transaction:a});const h=i.getActionStores(),S=Promise.all(h.map((e=>{const t=u[e.id],{automationActionStore:n,onComplete:i}=W({environment:o,includeParenting:!1,mapper:m,sourceActionStore:e,targetAutomationActionId:t,transaction:a});return w().jG({childStore:n,parentStore:_,transaction:a}),i}))),M=S.then((e=>e.flat()));return{automationStore:_,onComplete:M}}function W(e){const{environment:t,includeParenting:o,insertionPoint:n,mapper:i,sourceActionStore:r,targetAutomationActionId:a,transaction:l}=e,c=r.getParentStore();if(!c||!c.isReady())throw new Error("Automation store is not ready");const u=r.getValue(),p=r.getSpaceId();if(!(0,b().$K)(u)||!(0,b().$K)(p))throw new Error("Undefined action value or space id");const m={...(0,v().Xh)(u),id:a??(0,j().TS)({environment:t,table:f().Xj,spaceId:(0,g().J)(p)})},y=t.currentUser.id,_=r.inMemoryRecordCache.makeGetRecordRoleFn(y);(0,d().XJ)({duplicateRecord:m,getRecordRole:_,originalRecord:u,mapper:e=>(null==i?void 0:i(e))??e.requested,options:{},originOptions:{baseUrl:T().default.domainBaseUrl,publicDomainName:T().default.publicDomainName},duplicateBlocks:!1});const h=A().ae({environment:t,inMemoryRecordCache:r.inMemoryRecordCache,table:f().Xj,transaction:l,value:m});o&&(!n||"afterActionId"in n?w().jG({after:null==n?void 0:n.afterActionId,childStore:h,parentStore:c,transaction:l}):"beforeActionId"in n?w().SH({before:null==n?void 0:n.beforeActionId,childStore:h,parentStore:c,transaction:l}):(0,b().t1)(n),z({transaction:l,automationStore:c}));const S=Promise.all(r.getBlockStores().map((e=>{const[o,n]=k().duplicateBlock({addCopyName:!1,baseUrl:T().default.domainBaseUrl,deepCopyTransclusionContainers:!1,environment:t,preferDuplicateLocation:"local",publicDomainName:T().default.publicDomainName,resolveTemplateVariables:!1,stores:[e],targetSpaceId:(0,g().J)(e.pointer.spaceId),transaction:l}),i=o[0];return w().jG({childStore:i,parentStore:h,transaction:l}),n}))),M=h.getModel();return(0,b().$K)(M)&&(0,H().GV)(((e,o,n)=>{const i=(0,I().mc)(t),r=(0,H().TI)({automationActionStore:h,formulaAnalyticsModule:o,formulasModule:e,simpleFormulasModule:n});(0,b().$K)(r)&&(0,s().A2)(i,{automation_action:r,automation_action_id:M.id,automation_id:M.parent_id,from:"duplicate"}),(0,s().eI)(i,{automation_action_id:M.id,automation_action_type:M.type,automation_id:c.id,from:"duplicate"})})),{automationActionStore:h,onComplete:S}}function O(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:r,intl:a,newActionIds:s,transaction:l,from:c,movedActionId:d}=e;A().sW({store:o,transaction:l,data:{action_ids:s}}),z({automationStore:o,transaction:l});J({automationStore:o,transaction:l,typecheckResult:(0,K().k)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:r,intl:a})}),(0,I().j)({environment:t,event:{eventName:"automation_action_move",eventProperties:{automation_id:o.id,automation_action_id:d,from:c}}})}function B(e){const{actionStore:t,automationStore:o,automationTypecheckModule:n,contextType:i,environment:r,formulasModule:a,intl:l,transaction:c}=e,d=(0,K().k)({environment:r,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:a,intl:l});!function(e){const{automationActionStore:t,automationStore:o,environment:n,transaction:i,hasError:r=!1}=e;let a=t.getParentStore();if((0,b().$K)(o)){const e=t.getParentPointer();if(!(0,b().$K)(e))throw new Error("Automation action does not have a parent pointer");if(!m().dr.isEqual(e,o.pointer))throw new Error(`Automation action parent pointer does not match argument: ${m().dr.toKey(e)}, ${m().dr.toKey(o.pointer)}`);a=o}else if(!(0,b().$K)(a))throw new Error("Automation store is undefined");w().hr({childStore:t,parentStore:a,transaction:i});const l=t.getModel();(0,b().$K)(l)&&(0,H().GV)(((e,o,i)=>{const c=(0,I().mc)(n),d=(0,H().TI)({automationActionStore:t,formulaAnalyticsModule:o,formulasModule:e,simpleFormulasModule:i});(0,b().$K)(d)&&(0,s().OK)(c,{automation_action:d,automation_action_id:l.id,automation_id:l.parent_id,has_error:r}),(0,s().co)(c,{automation_action_id:l.id,automation_action_type:l.type,automation_id:a.id,has_error:r})}))}({automationActionStore:t,environment:r,transaction:c,hasError:(S().x.isSuccess(d)&&d.value.actionValidationFailures[t.id]||[]).length>0}),J({automationStore:o,transaction:c,typecheckResult:d})}function $(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:r,intl:a,transaction:s}=e;J({automationStore:o,transaction:s,typecheckResult:(0,K().k)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:r,intl:a})})}function z(e){const{automationStore:t,transaction:o}=e;t.getSpaceId()&&t.getActionStores().forEach(((e,t)=>{var n;if(!e.isDefined())return;const i=e.getModel();i.isType("open_page")&&"url"===(null===(n=i.getConfig())||void 0===n||null===(n=n.target)||void 0===n?void 0:n.type)&&!(0,a().GQ)(t)&&A().sW({store:e.getConfigStore(),transaction:o,data:{target:null}})}))}function J(e){const{automationStore:t,transaction:o,typecheckResult:n}=e,i=t.getSpaceId(),r=t.getModel();if(i&&r&&!S().x.isFail(n))for(const a of r.getActionIds()){const e=t.getRecordStore(t,{table:f().Xj,id:a,spaceId:i});if(!e.isDefined())continue;const r=e.getModel(),s=new Set(n.value.actionInputValueTypes[a].map((e=>{if(e.kind===u().FormulaContextValueKind.Binding||e.kind===u().FormulaContextValueKind.ContextValue)return e.id;e.kind!==u().FormulaContextValueKind.ThisRow&&(0,b().t1)(e)})).filter(b().$K)),{value:c}=(0,l().e)({automationActionModel:r,baseUrl:T().default.domainBaseUrl,preventClearingConfig:!0,publicDomainName:T().default.publicDomainName,sourceSpaceId:i,visitors:{visitCollectionProperty:void 0,visitCollectionPropertyPointer:void 0,visitFormulaContextValue:e=>s.has(e)?{type:"keep"}:{type:"replace",value:void 0},visitFormulaPageProperty:void 0,visitRecordPointer:void 0}}),d=p().op.update({pointer:e.pointer,path:["config"],args:c.getConfig()??{}});P().applyOperation({store:e,operation:d,transaction:o})}}function G(e){const{environment:t,contentStore:o,transaction:n}=e,i=A().j4({environment:t,type:"text",inMemoryRecordCache:o.inMemoryRecordCache,transaction:n,spaceId:o.pointer.spaceId});return C().R3({parentStore:o,appendStore:i,transaction:n}).childStore}function q(e){const{automationStore:t,environment:o,transaction:n}=e;A().sW({store:t,data:{status:"active"},transaction:n});const i=t.getModel();(0,b().$K)(i)&&(0,H().GV)(((e,n,r)=>{const a=(0,V().Ep)(t);let l=[];a&&S().x.isSuccess(a)&&(l=a.value.valueTypes);const c=(0,I().mc)(o),d=(0,s().TY)({automationModel:i,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:l,getRecordModel:t.getRecordModel,featureGates:(0,R().W)(),simpleFormulasModule:r});(0,s().Rt)(c,d)}))}function Y(e){const{automationStore:t,environment:o,status:n,transaction:i}=e,r=n??"disabled";A().sW({store:t,data:{status:r},transaction:i}),t.isTriggerType("recurrence")&&A().sW({store:t,data:{run_at:void 0},transaction:i});const a=t.getModel();(0,b().$K)(a)&&(0,H().GV)(((e,n,i)=>{const r=(0,V().Ep)(t);let l=[];r&&S().x.isSuccess(r)&&(l=r.value.valueTypes);const c=(0,I().mc)(o),d=(0,s().TY)({automationModel:a,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:l,getRecordModel:t.getRecordModel,featureGates:(0,R().W)(),simpleFormulasModule:i});(0,s().ai)(c,d)}))}function X(e){const{automationStore:t,environment:o,transaction:n}=e;A().sW({store:t,data:{alive:!1},transaction:n});const i=t.getModel();(0,b().$K)(i)&&(0,H().GV)(((e,n,r)=>{const a=(0,V().Ep)(t);let l=[];a&&S().x.isSuccess(a)&&(l=a.value.valueTypes);const c=(0,I().mc)(o),d=(0,s().TY)({automationModel:i,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:l,getRecordModel:t.getRecordModel,featureGates:(0,R().W)(),simpleFormulasModule:r});(0,s().uO)(c,d),i.isNotificationType()&&M().xi(o,{type:"granular",source:"collection_view_settings",collection_id:i.parent_id})}))}},309841:(e,t,o)=>{o.d(t,{GV:()=>p,TI:()=>d,yE:()=>u});o(267602),o(653476),o(241792);var n=()=>o(271896),i=()=>o(855741),r=()=>o(696459),a=()=>o(141735),s=()=>o(594546),l=()=>o(615676),c=()=>o(637118);function d(e){const{automationActionStore:t,automationStore:o,formulaAnalyticsModule:a,formulasModule:s,simpleFormulasModule:d}=e,u=t.getModel(),p=o??t.getParentStore();if(!u||!p)return;const m=p.getActionStores().map((e=>e.getModel())).filter(r().$K),y=(0,c().Ep)(p);let f=[];return y&&i().x.isSuccess(y)&&(f=y.value.valueTypes),(0,n().Bj)({automationActionModel:u,automationActionModels:m,formulaAnalyticsModule:a,formulasModule:s,simpleFormulasModule:d,formulaTypecheckContextValues:f,getRecordModel:t.getRecordModel,featureGates:(0,l().W)()})}function u(e,t){const{automationStore:o,automationActionStore:n}=t;o.isTriggerType("event")||o.isTriggerType("notification_event")||p(((t,i,r)=>{const a=d({automationActionStore:n,automationStore:o,formulaAnalyticsModule:i,formulasModule:t,simpleFormulasModule:r});a&&(0,s().A3)(e,"automation_action_update",n.id,1,{automation_action:a,automation_action_id:n.id,automation_id:o.id})}))}function p(e){return Promise.all([a().F.formulas.load(),a().F.formulaAnalytics.load(),a().F.simpleFormulas.load()]).then((t=>{let[o,n,i]=t;e(o,n,i)})).catch((e=>{console.error("Error sending analytics for automations",e)}))}},658517:(e,t,o)=>{o.d(t,{h:()=>n});o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(731107);function n(e,t){const o=e.reduce(((e,t)=>{if(t.isType("define_variables")){var o;const n=null===(o=t.getModel())||void 0===o?void 0:o.getVariables();if(n)for(const t of Object.values(n))e.add(t.name)}return e}),new Set),n=t.replace(/\s*\d+$/,"");let i=1,r=`${n} ${i}`;for(;o.has(r);)r=`${n} ${i}`,i++;return r}},829563:(e,t,o)=>{o.r(t),o.d(t,{PagePropertiesRowNameMenu:()=>oe});o(821057),o(670560),o(267602),o(653476),o(470928),o(241792);var n=o(667294),i=()=>o(219727),r=()=>o(142735),a=()=>o(15607),s=()=>o(226413),l=()=>o(421551),c=()=>o(532850),d=()=>o(730398),u=()=>o(521573),p=()=>o(44037),m=()=>o(293641),y=()=>o(199264),f=()=>o(456524),g=()=>o(698763),_=()=>o(95886),v=()=>o(461613),h=()=>o(639708),S=()=>o(989478),b=()=>o(788860),M=()=>o(568017),C=()=>o(543172),w=()=>o(696459),A=()=>o(250303),x=()=>o(984871),P=()=>o(139224),T=()=>o(593515),k=()=>o(501912),I=()=>o(261930),R=()=>o(269299),j=()=>o(49396),E=()=>o(518645),V=()=>o(887430),H=()=>o(267191),D=()=>o(125659),K=()=>o(352230),L=()=>o(164079),Z=()=>o(99537),F=()=>o(528770),U=()=>o(142730),N=()=>o(162178),W=()=>o(242921),O=()=>o(983993),B=()=>o(998901),$=()=>o(876822),z=()=>o(482162),J=()=>o(855238),G=()=>o(827973),q=()=>o(255577),Y=()=>o(654133),X=()=>o(868744),Q=()=>o(550757),ee=o(785893);function te(e){const t=(0,D().Y$)(),T=(0,i().O7)(),Q=(0,o(846550).Fg)(),{permissionScopes:te,collectionSettingsStore:oe,collectionStore:ae,layoutStore:se}=(0,r().VK)((()=>{var e;return{permissionScopes:t.permissionScopesStore.state,collectionSettingsStore:t.settingsStore,collectionStore:t.collectionStore(),layoutStore:null===(e=t.collectionStore())||void 0===e?void 0:e.getLayoutStore()}}),[t]),{databaseType:le,collectionSchema:ce}=(0,r().VK)((()=>({databaseType:null==ae?void 0:ae.getDatabaseType(),collectionSchema:null==ae?void 0:ae.getSchema()})),[ae]),{property:de,schema:ue,blockStore:pe}=e,me=(0,c().Qm)({schema:ue,property:de}),ye=(0,r().VK)((()=>o(129338).ny(t,me)),[t,me]);(0,n.useEffect)((()=>{const e=ue[de];t&&"relation"===(null==e?void 0:e.type)&&(null==ye||ye.load())}),[t,de,ue,ye]);const fe=(0,r().VK)((()=>!!ae&&Boolean(le&&o(110232).cR((0,o(2971).appConfigs)(),le,de,ae))),[de,le,ae]),ge=(0,o(96778).yT)(pe,ce,de,me);let _e;const{device:ve}=T;_e=ve.isMobile?{menuType:K().o.ActionSheet}:{menuType:K().o.Popup,width:220};const he=Boolean((0,n.useContext)(N().eK)),{sessionId:Se,setModuleSelection:be}=(0,n.useContext)(N().Dt)||{},Me=(0,r().VK)((()=>!he&&!ge),[he,ge]),Ce=(0,r().VK)((()=>(0,o(378773).N)({environment:T,blockStore:pe})),[pe,T]),we=function(e){let{property:t,schema:o,format:n,blockStore:i,pagePropertiesStore:r,popupContainerRef:T,collectionContextStore:D,permissionScopes:K,collectionStore:N,collectionSettingsStore:q,isTypedProperty:Q,environment:te,theme:oe,layoutModule:ae,isInPageLayoutEditor:se,layoutSessionId:le,layoutStore:ce,isPropertyCommentsEnabled:de,canShowLayoutBuilderEntryPoint:ue,hideDuplicatePropertyOption:pe,setModuleSelection:me}=e;const{device:ye}=te,fe=(0,c().Qm)({schema:o,property:t});if(t===s().ow)return[[{key:"ai_summary",action:()=>{const e=$().default.state.currentSpaceViewStore;e&&I().ce(te,e)},render:e=>(0,ee.jsx)(G().Z,{title:(0,ee.jsx)(b()._H,{id:"AiSummaryTryOnThisPage.dimissButtonTooltip",defaultMessage:"Dismiss suggestion"}),...e})}]];if(!(D&&q&&fe&&N))return[];const ge=[],_e=se&&(0,h().Cj)(ae),ve=K.canConfigureCollection||K.canConfigureBlock;if(ve&&!(0,a().w)(t)&&!K.isExternallyImportedAndSyncedCollection){const e=se&&(_e||(0,h().z1)(ae)||(0,h().LP)(ae));if(_e){const e=[{key:"Show As Property Or Section",action:()=>{},render:(e,i)=>(0,ee.jsx)(X().Z,{...e,renderOrigin:e=>(0,ee.jsx)(J().Z,{...e,title:(0,ee.jsx)(b()._H,{defaultMessage:"Show as",id:"database.configureProperty.showAsAction"}),svg:u().g}),onFocus:i.onFocus,renderExtension:(e,i)=>(0,ee.jsx)(re,{popupEvents:e,extParent:i,property:t,schema:o,format:n,collectionStore:N,pagePropertiesStore:r})})}];ge.push(e)}const a=[];if(ge.push(a),a.push({key:"rename",render:e=>(0,ee.jsx)(G().Z,{...e,title:(0,ee.jsx)(b()._H,{defaultMessage:"Rename",id:"database.tableHeaderCell.rename"}),icon:(0,f().H)({width:14})}),action:()=>{P().r$({collectionContextStore:D,collectionSettingsStore:q,fromBlockStore:i}),P().FK({collectionSettingsStore:q,item:{type:"property",formatKey:"collection_page_properties",property:t,selectNameInitial:!ye.isMobile}})}}),a.push({key:"edit_property",render:e=>(0,ee.jsx)(Y().Z,{placement:B().Placement.Left,render:t=>(0,ee.jsx)(G().Z,{title:(0,ee.jsx)(b()._H,{defaultMessage:"Edit property",id:"database.tableHeaderCell.editProperty"}),icon:(0,y().W)({width:14}),...(0,L().Z)(e,t)}),style:{whiteSpace:"normal"},renderTooltip:()=>(0,ee.jsx)(b()._H,{defaultMessage:"Edit property name, type, and other options...",id:"database.tableHeaderCell.editPropertyTooltip"})}),action:()=>{P().r$({collectionContextStore:D,collectionSettingsStore:q,fromBlockStore:i,hideDuplicatePropertyOption:pe}),P().FK({collectionSettingsStore:q,item:{type:"property",formatKey:"collection_page_properties",property:t}})}}),ce&&e){const e=[{key:"Move to layout",action:()=>{if(!le)throw new Error("could not find session id for layouts logging");const e=(0,C().ZP)(),o=(0,v().e)(ce.getModules());(0,Z().sW)({position:{type:"area_relative",location:"end_moveable",..."views_main_tab_modules"===o.area?{area:o.area,viewId:o.viewsMainTabId}:{area:o.area}},layoutStore:ce,environment:te,module:{type:"property_relation",id:e,propertyId:t},sessionId:le,isPropertyCreation:!1}),null==me||me({type:"existing_module",moduleId:e,isDragging:!1}),ne(r,D)},render:e=>(0,ee.jsx)(G().Z,{...e,title:(0,ee.jsx)(b()._H,{defaultMessage:"Add to layout",id:"database.configureProperty.moveToLayout"}),icon:(0,m().J)({width:14})})}];ge.push(e)}de&&"formula"!==fe.type&&"rollup"!==fe.type&&"button"!==fe.type&&"auto_increment_id"!==fe.type&&"verification"!==fe.type&&!(0,s().ZY)(fe.type)&&a.push({key:"comment",render:e=>(0,ee.jsx)(G().Z,{...e,title:(0,ee.jsx)(b()._H,{defaultMessage:"Comment",id:"database.tableHeaderCell.comment"}),icon:(0,g().s)({width:14})}),action:async()=>{await(0,H().y)({environment:te,blockStore:i,rect:O().Z.getRect(i,t),property_id:t}),ne(r,D)}})}const he=[];ge.push(he);let Se=!0;if("relation"===fe.type){var be;const e=n.collection_page_sections||[],o=e.findIndex((e=>e.section===t)),i=null===(be=e[o])||void 0===be?void 0:be.visibility;!i||"inline"!==i&&"minimal"!==i||(Se=!1)}if("title"!==fe.type&&K.canConfigureBlock&&Se&&!((0,h().f)(ae)||(0,h().LP)(ae)||(0,h().Cj)(ae))){const e=n.property_visibility;if(e){const i=e.find((e=>e.property===t));he.push({key:"Property Visibility",action:()=>{},render:(e,a)=>(0,ee.jsx)(X().Z,{...e,renderOrigin:e=>(0,ee.jsx)(G().Z,{...e,title:(0,ee.jsx)(b()._H,{defaultMessage:"Property visibility",id:"database.configureProperty.propertyVisibilityAction"}),icon:"show"===(null==i?void 0:i.visibility)?(0,d().p)({width:14}):(0,u().g)({width:14})}),onFocus:a.onFocus,renderExtension:()=>(0,ee.jsx)(ie,{property:t,schema:o,format:n,collectionStore:N,pagePropertiesStore:r})})})}}s().Tr.includes(fe.type)&&K.canConfigureCollection&&!(0,a().w)(t)&&!K.isExternallyImportedAndSyncedCollection&&((0,s().g0)(fe)&&!pe&&he.push({key:"Duplicate Property",render:e=>(0,ee.jsx)(G().Z,{...e,title:(0,ee.jsx)(b()._H,{defaultMessage:"Duplicate property",id:"database.configureProperty.duplicateAction"}),icon:(0,p().a)({width:14})}),action:async()=>{ne(r,D),await async function(e,t,o,n,i){const r=o.collection_page_properties||[],a=null==t?void 0:t.getSpaceId();if(!t||!a)return;const s=t.getNormalizedPropertyGroups(),l=await V().xy({environment:i,schema:n,properties:r,property:e,propertyGroups:s,parentStore:t,spaceId:a});if(l){const e=i.currentUser.id,r=e?{id:e,table:S().KJ}:void 0;R().createAndCommit({userAction:"PagePropertiesRowName.handleDuplicate",environment:i,canUndo:!0,perform:e=>{(0,w().$K)(l.automationUpdate)&&j().duplicateAutomation({actorPointer:r,environment:i,sourceAutomationStore:l.automationUpdate.sourceAutomationStore,targetAutomationId:l.automationUpdate.targetAutomationId,transaction:e});const a={...n,[l.newProperty]:l.newPropertySchema},s={...o,collection_page_properties:l.newProperties,property_groups:l.newPropertyGroups};(0,E().R)({environment:i,collectionStore:t,update:{schema:a,format:s},transaction:e})}})}}(t,N,n,o,te)}}),Q||he.push({key:"delete",render:e=>(0,ee.jsx)(G().Z,{...e,title:(0,ee.jsx)(b()._H,{defaultMessage:"Delete property",id:"database.tableHeaderCell.deleteProperty"}),icon:(0,_().y)({width:14}),hoveredStyle:{color:M().ZP.red,fill:M().ZP.red}}),action:async()=>{const e=()=>{var e;if(!_e)return;const o=D.collectionStore(),n=null==o?void 0:o.getSchema(),i=null==o?void 0:o.getFormat();if(!(0===(n&&i?(0,l().n)({format:i,schema:n,visibilityLevels:["inline","minimal"]}):[]).filter((e=>e.section!==t)).length))return;const r=null==o||null===(e=o.getLayoutStore())||void 0===e?void 0:e.getModules().page_main.find((e=>"normalizedTitleWithIcon"===e.type));r&&(null==me||me({type:"existing_module",moduleId:r.id,isDragging:!1}))};ne(r,D),await async function(e){let{environment:t,theme:o,property:n,schema:i,collectionStore:r,collectionContextStore:a,onAccept:s}=e;if(!a)return;await k().T({environment:t,collectionContextStore:a,property:n,handleDeleteAccept:()=>(s(),function(e,t,o,n,i){if(!i)return;R().createAndCommitAsync({environment:e,userAction:"PagePropertiesRowName.handleDeleteAccept",waitForServerCommit:!1,perform:i=>x().yV({environment:e,collectionStore:n,schema:o,property:t,transaction:i})});const r=n.getSchema()[t];r&&A().y9({environment:e,collectionContextStore:i,property_type:r.type,from:"table_column",property:t});const a=n.getLayoutStore(),s=(0,W().xx)(n);z().default.state.open||!a||s||(0,F().n)({environment:e,from:"details_sidebar_empty",layoutStore:a,panelLocation:"mainPage",preventPeekWidthResize:!1})}(t,n,i,r,a)),theme:o,from:"table_column"})}({environment:te,theme:oe,property:t,schema:o,collectionStore:N,onAccept:e,collectionContextStore:D})}}));const Me=[];ue&&Me.push({key:"customizeLayout",action:()=>{ne(r,D);const e=D.collectionStore();e&&(0,U().IR)({environment:te,blockStore:i,collectionStore:e,from:"page_property_menu"})},render:(e,t)=>(0,ee.jsx)(G().Z,{...e,title:(0,ee.jsx)(b()._H,{defaultMessage:"Customize layout",id:"pageProperties.editProperty.customizeLayout.label"}),icon:(0,m().J)({width:14})})});se||ge.push(Me);return ge}({property:e.property,schema:e.schema,format:e.format,blockStore:e.blockStore,pagePropertiesStore:e.pagePropertiesStore,popupContainerRef:e.popupContainerRef,collectionContextStore:t,permissionScopes:te,collectionStore:ae,collectionSettingsStore:oe,isTypedProperty:fe,environment:T,theme:Q,layoutModule:e.layoutModule,layoutSessionId:Se,isInPageLayoutEditor:he,layoutStore:se,isPropertyCommentsEnabled:Me,hideDuplicatePropertyOption:Boolean(e.hideDuplicatePropertyOption),canShowLayoutBuilderEntryPoint:Ce,setModuleSelection:be});return(0,ee.jsx)(o(198829).Z,{..._e,children:(0,ee.jsx)(q().ZP,{type:q().iW.Vertical,initialFocus:void 0,sections:o(513670).oA(null==we?void 0:we.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,ee.jsx)(o(388284).Z,{...e,topBorder:0!==t}),items:e}})))})})}const oe=n.memo(te);function ne(e,t){e.setState({...e.state,openProperty:void 0});const o=null==t?void 0:t.settingsStore;o&&P().E3({collectionSettingsStore:o})}function ie(e){let{property:t,schema:o,format:r,collectionStore:a,pagePropertiesStore:s}=e;const l=(0,i().O7)(),c=(0,n.useContext)(D().cu),d=r.property_visibility;if(!d)return null;const u=o[t];if(!u)return null;const p=d.find((e=>e.property===t));return(0,ee.jsx)(Q().YV,{propertySchema:u,currentVisibility:(null==p?void 0:p.visibility)||"show",onSelect:e=>function(e,t,o,n,i){R().createAndCommit({userAction:"CustomizePageMenu.handleShowAsClick",environment:i,canUndo:!0,perform:i=>{T().M0({property:t,visibility:e,format:o,store:n,transaction:i})}})}(e,t,r,a,l),onClose:()=>{ne(s,c)}})}function re(e){let{popupEvents:t,extParent:o,property:r,schema:a,format:s,collectionStore:l,pagePropertiesStore:c}=e;const d=(0,i().O7)(),u=(0,n.useContext)(D().cu),p=s.collection_page_sections||[];if(!a[r])return null;const m=p.findIndex((e=>e.section===r)),y=p[m];return(0,ee.jsx)(Q().pb,{currentVisibility:(null==y?void 0:y.visibility)||"section_hide",onSelect:e=>{x().Ji({visibility:e,property:r,schema:a,collectionStore:l,format:s,environment:d}),ne(c,u)},onClose:()=>{o.close()}})}},259098:(e,t,o)=>{o.d(t,{IR:()=>m,Rc:()=>c,Wc:()=>s,eN:()=>u,nL:()=>r});var n=()=>o(788860);const i=(0,n().vU)({expanded:{id:"customizePageMenuVisibilitySelect.expanded.label",defaultMessage:"Expanded"},off:{id:"customizePageMenuVisibilitySelect.off.label",defaultMessage:"Off"}}),r={section_show:i.expanded,section_collapsed:i.expanded,section_hide:i.off},a=(0,n().vU)({default:{id:"customizePageMenuVisibilitySelect.default.label",defaultMessage:"Default"},minimal:{id:"customizePageMenuVisibilitySelect.minimal.label",defaultMessage:"Minimal"}}),s={inline:a.default,minimal:a.minimal},l=(0,n().vU)({showOnHover:{id:"visibilityLevelMessages.backlinksPageSection.showOnHover",defaultMessage:"Show on hover"},alwaysShow:{id:"visibilityLevelMessages.backlinksPageSection.alwaysShow",defaultMessage:"Always show"},off:{id:"customizePageMenuVisibilitySelect.off.label",defaultMessage:"Off"}}),c={always_show:l.alwaysShow,section_show:l.showOnHover,section_collapsed:l.showOnHover,section_hide:l.off,inline:l.off,minimal:l.off},d=(0,n().vU)({asPageSection:{id:"customizePageMenuVisibilitySelect.section.label",defaultMessage:"As page section"},minimal:{id:"visibilityLevelMessages.propertyPageSection.minimal",defaultMessage:"Minimal"}}),u={inline:d.asPageSection,minimal:d.minimal},p=(0,n().vU)({alwaysShow:{id:"customizePageMenuVisibilitySelect.show.label",defaultMessage:"Always show"},alwaysHide:{id:"customizePageMenuVisibilitySelect.hide.label",defaultMessage:"Always hide"},hideWhenEmpty:{id:"customizePageMenuVisibilitySelect.hideIfEmpty.label",defaultMessage:"Hide when empty"},asPageSection:{id:"customizePageMenuVisibilitySelect.section.label",defaultMessage:"As page section"}}),m={show:p.alwaysShow,hide:p.alwaysHide,hide_if_empty:p.hideWhenEmpty,section:p.asPageSection}},550757:(e,t,o)=>{o.d(t,{K1:()=>_,Xv:()=>S,YV:()=>g,h9:()=>h,pb:()=>v});o(267602),o(653476),o(241792),o(667294);var n=()=>o(219727),i=()=>o(846550),r=()=>o(109477),a=()=>o(286977),s=()=>o(788860),l=()=>o(670655),c=()=>o(352230),d=()=>o(827973),u=()=>o(198829),p=()=>o(255577),m=()=>o(388284),y=()=>o(259098),f=o(785893);function g(e){const{currentVisibility:t,propertySchema:o,onSelect:n,onClose:i}=e;let a=[...r().AX];a=a.filter((e=>"section"!==e)),(0,l().kq)({propertySchema:o})||(a=a.filter((e=>"hide_if_empty"!==e)));const c=a.map((e=>({visibility:e,label:(0,f.jsx)(s()._H,{...y().IR[e]})})));return(0,f.jsx)(b,{currentVisibility:t,visibilityLevelsWithLabels:c,onSelect:n,onClose:i})}function _(e){const{currentVisibility:t,onSelect:o,onClose:n}=e,i=(0,l().AN)(t),r=["always_show","section_collapsed","section_hide"].map((e=>({visibility:e,label:(0,f.jsx)(s()._H,{...y().Rc[e]})})));return(0,f.jsx)(b,{currentVisibility:i,visibilityLevelsWithLabels:r,onSelect:o,onClose:n})}function v(e){const{currentVisibility:t,onSelect:o,onClose:n}=e,i=r().UR.filter((e=>"section_hide"!==e)).map((e=>({visibility:e,label:(0,f.jsx)(s()._H,{...y().eN[e]})}))),a="section_hide"===t?void 0:t;return(0,f.jsx)(b,{currentVisibility:a,visibilityLevelsWithLabels:i,onSelect:o,onClose:n})}function h(e){const{currentVisibility:t,onSelect:o,onClose:n}=e,i=r().uH.filter((e=>"section_collapsed"!==e)).map((e=>({visibility:e,label:(0,f.jsx)(s()._H,{...y().nL[e]})}))),a="section_collapsed"===t?"section_show":t;return(0,f.jsx)(b,{currentVisibility:a,visibilityLevelsWithLabels:i,onSelect:o,onClose:n})}function S(e){const{currentVisibility:t,onSelect:o,onClose:n}=e,i=r().iK.map((e=>({visibility:e,label:(0,f.jsx)(s()._H,{...y().Wc[e]})})));return(0,f.jsx)(b,{currentVisibility:t,visibilityLevelsWithLabels:i,onSelect:o,onClose:n})}function b(e){const{currentVisibility:t,visibilityLevelsWithLabels:o,onSelect:i,onClose:r}=e,a=(0,n().Fy)(),l=o.map((e=>{let{visibility:o,label:n}=e;return{key:o,render:e=>(0,f.jsx)(M,{buttonMenuItemProps:e,isChecked:o===t,label:n}),action:()=>{i(o),r&&r()}}})),d=[{key:"visibilityLevels",render:e=>(0,f.jsx)(m().Z,{...e,topBorder:0!==e.index}),items:l}];let y;return y=a.isMobile?{menuType:c().o.Modal,title:(0,f.jsx)(s()._H,{id:"customizePageMenuVisibilitySelect.mobile.title",defaultMessage:"Select visibility"}),right:(0,f.jsx)(s()._H,{id:"customizePageMenuVisibilitySelect.mobile.doneButton.label",defaultMessage:"Done"}),onClickRight:()=>r&&r()}:{menuType:c().o.Popup,width:"auto",maxWidth:360},(0,f.jsx)(u().Z,{...y,children:(0,f.jsx)(p().ZP,{type:p().iW.Vertical,initialFocus:void 0,sections:d})})}function M(e){const{buttonMenuItemProps:t,label:o,isChecked:r}=e,{isMobile:s}=(0,n().Fy)(),l=(0,i().yK)((()=>({title:{display:"flex",alignItems:"center",width:150},checkedIcon:{width:s?16:14}})),[s]),c=(0,f.jsx)("div",{style:l.title,children:o}),u=(0,f.jsx)("div",{style:l.checkedIcon,children:(0,a().e)()});return(0,f.jsx)(d().Z,{...t,textWrapperStyle:{marginRight:0},title:c,right:r?u:void 0})}},688745:(e,t,o)=>{o.d(t,{D5:()=>A,Ym:()=>w,cP:()=>C});o(821057),o(267602),o(916054),o(653476),o(241792),o(667294);var n=()=>o(146947),i=()=>o(780741),r=()=>o(481529),a=()=>o(494616),s=()=>o(396136),l=()=>o(752778),c=()=>o(139978),d=()=>o(483791),u=()=>o(212360),p=()=>o(788860),m=()=>o(513670),y=()=>o(696459),f=()=>o(250303),g=()=>o(984871),_=()=>o(308186),v=()=>o(269299),h=()=>o(90065),S=()=>o(826955),b=()=>o(382474),M=o(785893);function C(e){let{transaction:t,collectionStore:o,templateId:n,instance:i,logger:p}=e;p.debug(`Creating/updating ${u().qB} record for "${n}".`);const m=o.getSpaceId(),f=i.id;if("automation"===i.type){const e={table:a().cv,id:f,spaceId:m};v().applyOperation({store:S().Mz.createChildStore(o,e),operation:r().op.set({pointer:e,path:["properties","workflow_template_instance"],args:{template_id:n}}),transaction:t})}else if("block"===i.type){const e={table:s().iU,id:f,spaceId:m};v().applyOperation({store:S().G.createChildStore(o,e),operation:r().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:n}}),transaction:t})}else if("collection"===i.type){const e={table:l().vF,id:f,spaceId:m};v().applyOperation({store:o,operation:r().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:n}}),transaction:t})}else if("collection_view"===i.type){const e={table:c().np,id:f,spaceId:m};v().applyOperation({store:S().Xr.createChildStore(o,e),operation:r().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:n}}),transaction:t})}else if("layout"===i.type){const e={table:d().Bh,id:f,spaceId:m};v().applyOperation({store:S().xj.createChildStore(o,e),operation:r().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:n}}),transaction:t})}else if("compound"===i.type){if(i.instancePointers.length<2)throw new Error(`Compound template instance ${i.id} must contain 2 or more instances`);const e=i.instancePointers.map((e=>{switch(e.type){case"automation":return{type:"automation",id:e.id};case"block":return{type:"block",id:e.id};case"collection_view":return{type:"collection_view",id:e.id};case"layout":return{type:"layout",id:e.id};case"property":return{type:"property",id:e.id}}(0,y().t1)(e)}));v().applyOperation({store:o,operation:{command:"keyedObjectListUpdate",pointer:o.pointer,path:["format","compound_workflow_template_instances"],args:{value:{template_id:n,id:i.id,instance_pointers:e}}},transaction:t})}else"property"===i.type?v().applyOperation({store:o,operation:r().op.update({pointer:o.pointer,path:["schema",i.id],args:{workflow_template_instance:{template_id:n}}}),transaction:t}):(0,y().t1)(i)}function w(e){let{environment:t,collectionStore:o,propertyId:n,compoundTemplateInstancesToDelete:r,collectionContextStore:a,from:s}=e;if(!r.every((e=>e.templateId===i()._5)))return!1;if(!(0,h().tj)())return!1;const l=(0,b().OA)({environment:t,collectionStore:o,compoundTemplateInstancesToDelete:r}),c=m().jj(l.filter((e=>"property"===e.type&&e.id!==n)).map((e=>e.id)));return x({environment:t,collectionStore:o,clickedPropertyId:n,otherPropertyIds:c,collectionContextStore:a,from:s}),!0}function A(e){let{environment:t,collectionStore:o,propertyId:n,collectionContextStore:i,from:r}=e;const a=o.getSchema(),s=Object.keys(a).filter((e=>e!==n&&((0,h().TJ)({collectionStore:o,propertyId:e})||(0,h().e_)(e))));return x({environment:t,collectionStore:o,clickedPropertyId:n,otherPropertyIds:s,collectionContextStore:i,from:r}),!0}function x(e){var t;let{environment:o,collectionStore:i,clickedPropertyId:r,otherPropertyIds:a,collectionContextStore:s,from:l}=e;const c=[r,...a],d=[{label:(0,M.jsx)(p()._H,{id:"workflowTemplateInstanceActions.deleteRequiredProperty.deleteOption",defaultMessage:"{count, plural, one {Delete {count} property} other {Delete {count} properties}}",values:{count:c.length}}),color:"red",onAccept:()=>function(e){let{environment:t,collectionStore:o,collectionContextStore:n,propertyIds:i,from:r}=e;v().createAndCommit({userAction:"workflowTemplateInstanceActions.handleDeleteAccept",environment:t,canUndo:!0,perform:e=>{const a=o.getSchema();for(const s of i){g().E2({environment:t,collectionStore:o,schema:a,property:s,transaction:e});const i=a[s];i&&f().y9({environment:t,collectionContextStore:n,property_type:i.type,from:r,property:s})}}})}({environment:o,collectionStore:i,collectionContextStore:s,propertyIds:c,from:l})}],u=i.getSchema(),m=a.map((e=>{if(e===r)return;const t=u[e];return null==t?void 0:t.name})).filter(y().$K),h=null===(t=u[r])||void 0===t?void 0:t.name,S=new Intl.ListFormat(n().locale,{style:"long",type:"conjunction"}),b=(0,M.jsx)(p()._H,{id:"workflowTemplateInstanceActions.deleteRequiredProperty.deletePropertyFromDb",defaultMessage:"{hasPropertyName, select, true {Delete {propertyName} from this database? This will also delete the following properties: {otherPropertyNames}} other {Delete this property from this database? This will also delete the following properties: {otherPropertyNames}}}",values:{hasPropertyName:Boolean(h),propertyName:h,otherPropertyNames:S.format(m)}});_().vC({message:(0,M.jsx)("span",{children:b}),showCancel:!0,keepFocus:!0,innerStyle:{width:400},items:d})}},999582:(e,t,o)=>{o.d(t,{Z:()=>r});class n extends(()=>o(263184))().default{getInitialState(){return{}}}const i=new n;o(947115).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",i);const r=i},29488:(e,t,o)=>{function n(e){return`${e.table}:${e.id}`}o.d(t,{O:()=>n})},157955:(e,t,o)=>{o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>k,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>M,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>b,MAX_RECURRENCE_INTERVAL:()=>g,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>_,RRULE_WEEKDAYS_MAP:()=>f,convertFromUnpersistedRecurrenceConfig:()=>E,convertToUnpersistedRecurrenceConfig:()=>I,getFormattedEndCondition:()=>T,getFormattedNextRecurrenceTime:()=>P,getNewEndTimestamp:()=>R,getNextDateUtc:()=>x,getRecurrenceAfter:()=>w,isRunningBetweenMidnightAnd3AM:()=>A,isValidRecurrenceInterval:()=>v,isValidRecurrenceNumberOfRuns:()=>h,rruleFromRecurrence:()=>S,templateAncestorsViolateRecurrenceNesting:()=>C});o(267602),o(653476),o(241792);var n=()=>o(730120);o(670560);function i(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];if(0===o.length)return e.map((e=>[e]));const r=[];for(const a of e)r.push(...i(o[0],...o.slice(1)).map((e=>[a,...e])));return r}var r=()=>o(696459),a=()=>o(326966),s=()=>o(803021),l=()=>o(646574),c=()=>o(998411),d=()=>o(578292);class u extends(()=>o(484885))().Ci{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var p=()=>o(494616);const m=(0,o(788860).vU)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12–3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),y={day:u.DAILY,week:u.WEEKLY,month:u.MONTHLY,year:u.YEARLY},f={MO:u.MO,TU:u.TU,WE:u.WE,TH:u.TH,FR:u.FR,SA:u.SA,SU:u.SU},g=99,_=999;function v(e){return(0,a().hj)(e)&&Number.isInteger(e)&&e>0&&e<=g}function h(e){return(0,a().hj)(e)&&Number.isInteger(e)&&e>0&&e<=_}function S(e){const{start_date:t,frequency:o,interval:n,weekdays:a,timezone:l,hour:c,minute:d}=e,p="week"===o&&a?a.map((e=>f[e])):void 0,m={};return(0,r().$K)(e.end_condition)&&("date"===e.end_condition.type?m.until=(0,s().pd)(e.end_condition.end_at):"number"===e.end_condition.type?m.count=e.end_condition.number_of_occurrences:(0,r().t1)(e.end_condition)),"month"===e.frequency&&(0,r().$K)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?m.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?m.byweekday=i(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,o]=e;return f[t].nth(o)})):(0,r().t1)(e.monthly_restriction)),new u({freq:y[o],dtstart:(0,s().pd)(t),interval:n,byweekday:p,tzid:l,byhour:c??0,byminute:d??0,bysecond:0,...m})}const b=1,M=1;function C(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const o=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),n=e.length,i=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,r=n>b,a=o.length>=M;return{violatesConstraint:r||a,templateNestingExceedsMaxDepth:r,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:n,immediateAncestorRecurrenceType:i}}function w(e){const{recurrence:t,afterDate:o}=e;if((0,p().nA)(t)){const e=(0,s().kq)(o);return t.start_date>=e?new Date(t.start_date):void 0}{const e=S(t).after((0,s().pd)(o));if(!e)return;return(0,s().YL)(e)}}function A(e){return 0===e.hour||1===e.hour||2===e.hour}function x(e){return S(e).after((0,s().pd)((0,s().Jh)()))||void 0}function P(e){const{recurrence:t,intl:o}=e,i=x(E(t));if(!i)return;const r=A(t),a=n().ou.fromJSDate(i).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,d().E2)(o)).setZone(t.timezone),s=(0,l().p6)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:o,shortenDate:!0});if(r)return o.formatMessage(m.dateBetweenMidnightAnd3AM,{date:s});{let e=a.toLocaleString(n().ou.TIME_SIMPLE);return t.timezone!==(0,c().r)()&&(e+=` ${a.toFormat("ZZZZ")}`),o.formatMessage(m.dateAtTime,{date:s,time:e})}}function T(e,t){return(0,r().$K)(e)?"number"===e.type?t.formatMessage(m.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,l().p6)({date:n().ou.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,r().t1)(e):t.formatMessage(m.noEndCondition)}const k=100;function I(e){return{...e,start_date:(0,s().kq)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,s().kq)(e.end_condition.end_at)}:(0,r().t1)(e.end_condition):void 0}}function R(e,t,o){return e.plus(o-t)}function j(e,t){const o=n().ou.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,s().Jh)(o.toJSDate())}}function E(e){return{...e,start_date:(0,s().Jh)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?j(e,e.end_condition):(0,r().t1)(e.end_condition):void 0}}},730398:(e,t,o)=>{o.d(t,{p:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("collectionHide",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M12.617 12.95a.46.46 0 0 0 .662 0 .46.46 0 0 0 0-.663L3.354 2.373a.465.465 0 1 0-.663.656l9.926 9.92ZM8 2.706c-1.02 0-1.945.176-2.807.457l.938.938A6.702 6.702 0 0 1 8 3.832c3.744 0 6.72 3.258 6.72 3.943 0 .463-.949 1.659-2.454 2.602l.867.873c1.84-1.207 2.912-2.783 2.912-3.475 0-1.2-3.24-5.068-8.045-5.068ZM8 12.85a9.022 9.022 0 0 0 2.97-.498l-.93-.932a7.175 7.175 0 0 1-2.04.305c-3.744 0-6.72-3.13-6.72-3.95 0-.392.995-1.664 2.6-2.648l-.884-.885C1.08 5.461-.05 7.072-.05 7.775-.05 8.977 3.26 12.85 8 12.85Zm2.924-3.944c.152-.345.24-.732.24-1.13A3.137 3.137 0 0 0 8 4.622c-.404 0-.785.076-1.137.223l4.06 4.06ZM8 10.934a2.93 2.93 0 0 0 1.266-.287L5.123 6.497a2.909 2.909 0 0 0-.293 1.283A3.172 3.172 0 0 0 8 10.934Z"})})},521573:(e,t,o)=>{o.d(t,{g:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("collectionShow",{viewBox:"0 0 30 30",svg:(0,n.jsx)("path",{d:"M15,4 C8.641,4 0,10.469 0,15 C0,19.531 8.641,26 15,26 C21.359,26 30,19.531 30,15 C30,10.469 21.359,4 15,4 Z M15,24 C9.149,24 2,17.975 2,15 C2,12.025 9.149,6 15,6 C20.851,6 28,12.025 28,15 C28,17.975 20.851,24 15,24 Z M15,8 C11.134,8 8,11.134 8,15 C8,18.866 11.134,22 15,22 C18.866,22 22,18.866 22,15 C22,11.134 18.866,8 15,8 Z M15,20 C12.238,20 10,17.761 10,15 C10,12.239 12.238,10 15,10 C17.762,10 20,12.239 20,15 C20,17.761 17.762,20 15,20 Z"})})},293641:(e,t,o)=>{o.d(t,{J:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("layout",{viewBox:"0 0 14 14",svg:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.39999 2.19999C2.28953 2.19999 2.19999 2.28953 2.19999 2.39998V11.5999C2.19999 11.7103 2.28953 11.7999 2.39999 11.7999H4.99997C5.11042 11.7999 5.19997 11.7103 5.19997 11.5999V2.39998C5.19997 2.28953 5.11042 2.19999 4.99997 2.19999H2.39999ZM1 2.39998C1 1.6268 1.62679 1 2.39999 1H4.99997C5.77316 1 6.39995 1.6268 6.39995 2.39998V11.5999C6.39995 12.3731 5.77316 12.9999 4.99997 12.9999H2.39999C1.62679 12.9999 1 12.3731 1 11.5999V2.39998ZM9 8.80036C8.88954 8.80036 8.8 8.88991 8.8 9.00036V11.6003C8.8 11.7108 8.88954 11.8003 9 11.8003H11.6C11.7105 11.8003 11.8 11.7108 11.8 11.6003V9.00036C11.8 8.88991 11.7105 8.80036 11.6 8.80036H9ZM7.60001 9.00036C7.60001 8.22717 8.2268 7.60037 9 7.60037H11.6C12.3731 7.60037 13 8.22717 13 9.00036V11.6003C13 12.3736 12.3731 13.0003 11.6 13.0003H9C8.2268 13.0003 7.60001 12.3736 7.60001 11.6003V9.00036ZM8.79994 2.39998C8.79994 2.28953 8.88949 2.19999 8.99994 2.19999H11.5999C11.7104 2.19999 11.7999 2.28953 11.7999 2.39998V4.99997C11.7999 5.11043 11.7104 5.19996 11.5999 5.19996H8.99994C8.88949 5.19996 8.79994 5.11043 8.79994 4.99997V2.39998ZM8.99994 1C8.22675 1 7.59995 1.6268 7.59995 2.39998V4.99997C7.59995 5.77316 8.22675 6.39995 8.99994 6.39995H11.5999C12.3731 6.39995 12.9999 5.77316 12.9999 4.99997V2.39998C12.9999 1.6268 12.3731 1 11.5999 1H8.99994Z"})})},199264:(e,t,o)=>{o.d(t,{W:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("options",{viewBox:"0 0 17 15",svg:(0,n.jsx)("path",{d:"M11.287 4.484c.844 0 1.57-.53 1.875-1.265h2.57c.391 0 .72-.344.72-.758 0-.414-.329-.75-.72-.75h-2.57A2.023 2.023 0 0 0 11.287.437c-.852 0-1.578.532-1.875 1.274H1.045a.744.744 0 0 0-.742.75.75.75 0 0 0 .742.758h8.367a2.044 2.044 0 0 0 1.875 1.265Zm0-1.062c-.539 0-.96-.43-.96-.961 0-.547.421-.969.96-.969.547 0 .961.422.961.969a.95.95 0 0 1-.96.96ZM1.021 6.586c-.39 0-.718.336-.718.75 0 .406.328.75.718.75h2.657A2.03 2.03 0 0 0 5.56 9.359c.843 0 1.57-.523 1.875-1.273h8.273a.744.744 0 0 0 .742-.75.744.744 0 0 0-.742-.75H7.436A2.032 2.032 0 0 0 5.56 5.32c-.852 0-1.579.524-1.883 1.266H1.02Zm4.54 1.719a.964.964 0 0 1-.97-.97c0-.546.43-.96.97-.96.539 0 .96.414.96.96 0 .54-.421.97-.96.97Zm5.726 5.93c.852 0 1.578-.532 1.875-1.274h2.57c.391 0 .72-.336.72-.75a.734.734 0 0 0-.72-.75h-2.57a2.023 2.023 0 0 0-1.875-1.274c-.844 0-1.578.532-1.875 1.274H1.045a.744.744 0 0 0-.742.75c0 .406.328.75.742.75h8.367a2.023 2.023 0 0 0 1.875 1.273Zm0-1.063c-.539 0-.96-.43-.96-.961 0-.547.421-.961.96-.961a.94.94 0 0 1 .961.96.95.95 0 0 1-.96.962Z"})})},456524:(e,t,o)=>{o.d(t,{H:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("rename",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M14.7881 2.5752L15.3008 2.04199C15.5605 1.76855 15.5742 1.39941 15.3213 1.13965L15.1436 0.955078C14.9111 0.722656 14.5283 0.763672 14.2754 1.00977L13.749 1.5293L14.7881 2.5752ZM6.68066 9.87598L8.0752 9.28809L14.2891 3.06738L13.25 2.03516L7.03613 8.25586L6.4209 9.60254C6.35254 9.75977 6.52344 9.9375 6.68066 9.87598ZM4.09668 14.4355H12.0674C13.373 14.4355 14.1387 13.6768 14.1387 12.2207V4.99512L12.7988 6.33496V12.1045C12.7988 12.7676 12.4434 13.1025 11.9854 13.1025H4.17871C3.54297 13.1025 3.19434 12.7676 3.19434 12.1045V4.49609C3.19434 3.83301 3.54297 3.49805 4.17871 3.49805H10.0234L11.3633 2.1582H4.09668C2.62695 2.1582 1.85449 2.91699 1.85449 4.37988V12.2207C1.85449 13.6836 2.62695 14.4355 4.09668 14.4355Z"})})}}]);