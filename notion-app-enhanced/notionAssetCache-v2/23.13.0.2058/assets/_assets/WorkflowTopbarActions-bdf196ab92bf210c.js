"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[17894,91200],{276124:(e,t,n)=>{n.d(t,{z:()=>a});n(267602),n(470928);var o=()=>n(421654),r=()=>n(636340),i=()=>n(749826);function a(e){const{collectionViewBlockStore:t,collectionPointer:n,transaction:a}=e;r().sW({store:t,data:{collection_id:null},transaction:a});if(i().default.checkGate({gateName:"workflow_container"})){const e=t.getCollectionPointers();(null==e?void 0:e.find((e=>e.id===n.id)))||o().FH({stores:[t],update:{collection_pointers:[...e??[],n]},transaction:a})}o().FH({stores:[t],update:{collection_pointer:n},transaction:a})}},504325:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var o=n(667294),r=()=>n(219727),i=()=>n(142735),a=()=>n(846550),d=()=>n(836273),c=()=>n(361929),s=()=>n(342792),u=()=>n(497065),l=()=>n(448419),m=()=>n(291198),p=()=>n(661297),_=()=>n(826955),f=()=>n(452435),h=n(785893);function g(e){const{store:t}=e,n=(0,i().VK)((()=>{var e;const n=null===(e=t.getFormat())||void 0===e?void 0:e.workflow_id;if(n)return _().hA.createChildStore(t,{table:c().An,id:n,spaceId:t.getSpaceId()})}),[t]),g=(0,r().Fy)(),y=(0,r().O7)(),[E,v]=o.useState(""),A=(0,a().yK)((e=>({wrap:{width:340,padding:8},button:{marginRight:8}})),[]),R=(0,o.useCallback)((()=>{if(!E||!t||!n)return;const e=(0,f().startEditWorkflow)({environment:y,workflowStore:n,store:t,inputValue:E});e&&u().c4({environment:y,url:`${d().VP.aiInferenceTranscript}?t=${(0,s().cj)(e)}`})}),[y,E,n,t]);return(0,h.jsx)(l().ZP,{popupType:g.isMobile?l().Z4.SlideUp:l().Z4.Popup,placementToOrigin:l().pO.Bottom,alignmentToOrigin:l().vR.Center,originGap:4,renderOrigin:e=>(0,h.jsx)(p().Z,{style:A.button,color:"uiBlue",...e,children:"Edit workflow"}),render:()=>(0,h.jsx)("div",{style:A.wrap,children:(0,h.jsx)(m().Z,{value:E,textarea:!0,autoFocus:!0,autosize:!0,autosizeMinHeight:200,autosizeMaxHeight:600,onChange:e=>v(e.target.value),textareaSubmitOnEnter:!0,onSubmit:R,placeholder:"What would you like me to do for you?"})})})}},157955:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>D,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>R,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>A,MAX_RECURRENCE_INTERVAL:()=>h,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>g,RRULE_WEEKDAYS_MAP:()=>f,convertFromUnpersistedRecurrenceConfig:()=>x,convertToUnpersistedRecurrenceConfig:()=>N,getFormattedEndCondition:()=>k,getFormattedNextRecurrenceTime:()=>T,getNewEndTimestamp:()=>U,getNextDateUtc:()=>C,getRecurrenceAfter:()=>w,isRunningBetweenMidnightAnd3AM:()=>b,isValidRecurrenceInterval:()=>y,isValidRecurrenceNumberOfRuns:()=>E,rruleFromRecurrence:()=>v,templateAncestorsViolateRecurrenceNesting:()=>M});n(267602),n(653476),n(241792);var o=()=>n(730120);n(670560);function r(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(0===n.length)return e.map((e=>[e]));const i=[];for(const a of e)i.push(...r(n[0],...n.slice(1)).map((e=>[a,...e])));return i}var i=()=>n(696459),a=()=>n(326966),d=()=>n(803021),c=()=>n(646574),s=()=>n(998411),u=()=>n(578292);class l extends(()=>n(484885))().Ci{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var m=()=>n(494616);const p=(0,n(788860).vU)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),_={day:l.DAILY,week:l.WEEKLY,month:l.MONTHLY,year:l.YEARLY},f={MO:l.MO,TU:l.TU,WE:l.WE,TH:l.TH,FR:l.FR,SA:l.SA,SU:l.SU},h=99,g=999;function y(e){return(0,a().hj)(e)&&Number.isInteger(e)&&e>0&&e<=h}function E(e){return(0,a().hj)(e)&&Number.isInteger(e)&&e>0&&e<=g}function v(e){const{start_date:t,frequency:n,interval:o,weekdays:a,timezone:c,hour:s,minute:u}=e,m="week"===n&&a?a.map((e=>f[e])):void 0,p={};return(0,i().$K)(e.end_condition)&&("date"===e.end_condition.type?p.until=(0,d().pd)(e.end_condition.end_at):"number"===e.end_condition.type?p.count=e.end_condition.number_of_occurrences:(0,i().t1)(e.end_condition)),"month"===e.frequency&&(0,i().$K)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?p.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?p.byweekday=r(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return f[t].nth(n)})):(0,i().t1)(e.monthly_restriction)),new l({freq:_[n],dtstart:(0,d().pd)(t),interval:o,byweekday:m,tzid:c,byhour:s??0,byminute:u??0,bysecond:0,...p})}const A=1,R=1;function M(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),o=e.length,r=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=o>A,a=n.length>=R;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:o,immediateAncestorRecurrenceType:r}}function w(e){const{recurrence:t,afterDate:n}=e;if((0,m().nA)(t)){const e=(0,d().kq)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=v(t).after((0,d().pd)(n));if(!e)return;return(0,d().YL)(e)}}function b(e){return 0===e.hour||1===e.hour||2===e.hour}function C(e){return v(e).after((0,d().pd)((0,d().Jh)()))||void 0}function T(e){const{recurrence:t,intl:n}=e,r=C(x(t));if(!r)return;const i=b(t),a=o().ou.fromJSDate(r).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().E2)(n)).setZone(t.timezone),d=(0,c().p6)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(i)return n.formatMessage(p.dateBetweenMidnightAnd3AM,{date:d});{let e=a.toLocaleString(o().ou.TIME_SIMPLE);return t.timezone!==(0,s().r)()&&(e+=` ${a.toFormat("ZZZZ")}`),n.formatMessage(p.dateAtTime,{date:d,time:e})}}function k(e,t){return(0,i().$K)(e)?"number"===e.type?t.formatMessage(p.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,c().p6)({date:o().ou.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,i().t1)(e):t.formatMessage(p.noEndCondition)}const D=100;function N(e){return{...e,start_date:(0,d().kq)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,d().kq)(e.end_condition.end_at)}:(0,i().t1)(e.end_condition):void 0}}function U(e,t,n){return e.plus(n-t)}function S(e,t){const n=o().ou.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,d().Jh)(n.toJSDate())}}function x(e){return{...e,start_date:(0,d().Jh)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?S(e,e.end_condition):(0,i().t1)(e.end_condition):void 0}}},519454:(e,t,n)=>{n.d(t,{R:()=>r});n(667294);var o=n(785893);const r=(0,n(827282).IU)("pencil",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M3.926 13.307H14.11c.183 0 .34-.066.472-.199a.644.644 0 00.198-.471.652.652 0 00-.198-.479.644.644 0 00-.472-.198H5.272l-1.346 1.347zm-.704-.636l7.683-7.684-1.312-1.319-7.69 7.684-.67 1.606c-.037.1-.017.191.06.273.083.082.174.105.274.069l1.655-.63zm8.34-8.326l.738-.732c.182-.187.278-.376.287-.567.009-.192-.068-.374-.232-.547l-.267-.267c-.169-.168-.351-.246-.547-.232-.196.014-.385.11-.567.287l-.739.732 1.327 1.326z"})})}}]);