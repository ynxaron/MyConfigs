"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[16982],{945272:(e,n,t)=>{t.r(n),t.d(n,{SlackConnectionOptions:()=>K});t(670560),t(267602),t(653476),t(241792);var s=t(667294),a=()=>t(219727),i=()=>t(732811),o=()=>t(142735),c=()=>t(846550),l=()=>t(801812),r=()=>t(952260),d=()=>t(261070),u=()=>t(35e3),p=()=>t(820717),v=()=>t(168741),g=()=>t(95886),k=()=>t(741633),h=()=>t(788860),f=()=>t(707513),m=()=>t(824462),_=()=>t(308186),y=()=>t(231077),w=()=>t(402269),S=()=>t(343353),b=()=>t(827973),x=()=>t(312578),M=()=>t(198829),j=()=>t(255577),I=()=>t(388284),C=()=>t(251932),A=()=>t(594546),O=()=>t(352230),H=()=>t(466970),U=()=>t(616433),Q=()=>t(876822),N=()=>t(749826),P=()=>t(993261),T=t(785893);const W=(0,h().vU)({userOverwritePopupTitle:{id:"slackConnectionOptions.overwriteEmail.title",defaultMessage:"User Authorization"}});function K(e){var n;let{parent:t,from:K}=e;const E=(0,a().O7)(),[D,z]=(0,s.useState)(),L=(0,H().E)("ingestion_mapped_child_spaces"),q=(0,U().J)(),Z=(0,c().yK)((e=>({icon:{width:16,height:16},caption:{color:e.lightTextColor,fontSize:12,textWrap:"wrap"},option:{paddingTop:4,paddingBottom:4},optionLabel:{fontSize:14,marginBottom:2},disabledOptionLabel:{color:e.lightTextColor,fontSize:14,marginBottom:2},iconWrapper:{paddingTop:4}})),[]),F=(0,o().VK)((()=>Q().default.state.currentSpaceStore),[]),Y=(0,o().VK)((()=>P().slackUniversalQnAConnectionStore.state.isPublicSync),[]),G=(0,o().VK)((()=>P().slackUniversalQnAConnectionStore.state.isPrivateSync),[]),J=(0,o().VK)((()=>P().slackUniversalQnAConnectionStore.state.isSyncCompleted),[]),R=(0,o().VK)((()=>P().slackUniversalQnAConnectionStore.state.sessionId),[]),[X,$]=s.useState(!0),[ee,ne]=s.useState(!1),[te,se]=s.useState([]),ae=(0,o().VK)((()=>{var e;return null===(e=Q().default.getState().currentSpaceStore)||void 0===e?void 0:e.getSpaceId()}),[]),ie=(0,o().VK)((()=>P().slackUniversalQnAConnectionStore.state.isDisconnecting),[]),oe=(0,o().VK)((()=>P().slackUniversalQnAConnectionStore.state.analyticsFrom),[]),[ce,le]=(0,s.useState)(!0),re=(0,o().VK)((()=>P().slackUniversalQnAConnectionStore.state.isSlackGridAiConnectorEnabled),[]);(0,i().K)((async()=>{const e=null==F?void 0:F.id;if(!e)return;if(L){const n=await m().callApi({eventName:"getMappedParentSpace",environment:E,data:{spaceId:e}});if("success"!==n.type)return;if(n.data.isMapped)return z(n.data),void $(!1)}const n=await m().callApi({eventName:"getSlackBulkIngestionStatus",environment:E,data:{spaceId:e},headers:(0,k().Bb)({spaceId:e})});"success"===n.type&&P().slackUniversalQnAConnectionStore.setState({...P().slackUniversalQnAConnectionStore.state,...n.data});const t=await m().callApi({eventName:"getConnectedAppsForUniversalQna",environment:E,data:{spaceId:e},headers:(0,k().Bb)({spaceId:e})});"success"===t.type&&se(t.data.connectedApps);const s=await m().callApi({eventName:"canUserQuerySlack",environment:E,data:{spaceId:e}});"success"===s.type&&(le(s.data.canQuery),P().slackUniversalQnAConnectionStore.setState({...P().slackUniversalQnAConnectionStore.state,canQuery:s.data.canQuery})),$(!1)})),(0,l().r5)((async()=>{if(!ae)return;const e=await m().callApi({eventName:"allowPrivateSlackIngestion",environment:E,data:{spaceId:ae}});"success"===e.type&&ne(e.data.allow)}),[E,ae]);const de=(0,o().VK)((()=>te.includes("slack-admin")),[te]),ue=(0,o().VK)((()=>te.includes("slack")),[te]),pe=(0,o().VK)((()=>{const e=N().default.getConfigKey("ingestion","slack");return(null==e?void 0:e.userScopes.length)>0}),[]),ve=[{key:"slack-connection-section",render:e=>(0,T.jsx)(I().Z,{...e}),items:(null!=D&&D.isMapped?[{key:"inherited-space",label:(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.connectionDisabled",defaultMessage:"Disabled"}),caption:(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.disabledDescription",defaultMessage:"Cannot connect Slack to this space. Slack connection is inherited from {parentSpaceName}",values:{parentSpaceName:(0,T.jsx)("u",{children:null===(n=D.spaceDetails)||void 0===n?void 0:n.spaceName})}}),icon:(0,u().I)(Z.icon),disabled:!0,connected:!1,hidden:!1,action:()=>{}}]:[{key:"slack-ingestion-admin-auth",label:B(te,J,Y,re),caption:V(q,te,Y,ie,J),icon:(0,u().I)(Z.icon),disabled:!0,connected:de,hidden:!1,action:()=>{ae&&((0,S().navigateToSlackUniversalQnAOnboarding)({analyticsFrom:K||"chat_menu"}),(0,A().j)({environment:E,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"connect_public_slack",integration_type:"slack",setup_session_id:R,from:K||oe}}}))}},{key:"slack-ingestion-user-auth",label:(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.userAuth",defaultMessage:"Private conversations"}),caption:G?(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.privateConnectionInProgress",defaultMessage:"Connecting. This can take up to 36 hours."}):ue?(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.connectedByYou",defaultMessage:"Connected by you"}):(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.userCaption",defaultMessage:"Connect to enhance your AI results"}),icon:(0,p().v)(Z.icon),disabled:!1,connected:ue,hidden:!!re||Boolean(!de||Boolean(te.includes("slack-admin")&&Y)||!ee||!pe||ie),action:async()=>{if(ae)if(ue){"success"===(await m().callApi({eventName:"disconnectSlackIngestion",environment:E,data:{spaceId:ae,disconnectForWorkspace:!1}})).type&&se((e=>e.filter((e=>"slack"!==e)))),(0,A().j)({environment:E,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"disconnect_private_slack",integration_type:"slack",setup_session_id:R,from:K||oe}}})}else{const e=await m().callApi({eventName:"getSlackIngestionAuthorizeUrl",environment:E,data:{spaceId:ae,isAdminAuth:!1,isDesktopApp:E.device.isElectron}});"success"===e.type&&window.open(e.data.url,"_blank"),(0,A().j)({environment:E,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"connect_private_slack",integration_type:"slack",setup_session_id:R,from:K||oe}}})}}},{key:"slack-overwrite-email",label:(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.overWriteEmail",defaultMessage:"Log in to Slack"}),caption:(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.overWriteEmailCaption",defaultMessage:"We couldn't verify your Slack e-mail. Click to authenticate."}),icon:(0,d().f)(Z.icon),disabled:!1,connected:ue,hidden:!!re||(!J||ce),action:async()=>{if(!ae)return;(0,A().j)({environment:E,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"connect_slack_user_mapping",integration_type:"slack",setup_session_id:R,from:K||oe}}});const e=await m().callApi({eventName:"getSlackIngestionAuthorizeUrl",environment:E,data:{spaceId:ae,isAdminAuth:!1,isDesktopApp:E.device.isElectron,isUserMapping:!0,sessionId:R}});"success"===e.type&&(E.device.isElectron?y().openExternalUrl(e.data.url):await w().M(E,{width:800,height:600,url:e.data.url,titleMessage:W.userOverwritePopupTitle}))}},{key:"slack-overwrite-email-logout",label:(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.overWriteEmailLogout",defaultMessage:"Disconnect your account"}),caption:(0,T.jsx)(T.Fragment,{}),icon:(0,g().y)(Z.icon),disabled:!1,connected:!1,hidden:!!re||!te.includes("slack-user-mapping"),action:async()=>{if(!ae)return;null==t||t.close();const{accept:e}=await _().gt({message:(0,T.jsxs)(C().Ht,{gap:8,children:[(0,T.jsx)("div",{style:{fontWeight:f().Ue.semibold,fontSize:18},children:(0,T.jsx)(h()._H,{id:"universalQna.slackChannelSelection.disconnectOverwriteHeader",defaultMessage:"Are you sure?"})}),(0,T.jsx)("div",{style:{fontWeight:f().Ue.regular},children:(0,T.jsx)(h()._H,{id:"universalQna.slackChannelSelection.disconnectOverwriteNote1",defaultMessage:"Your Slack data will be permanently deleted from Notion."})}),(0,T.jsx)("div",{style:{fontWeight:f().Ue.regular},children:(0,T.jsx)(h()._H,{id:"universalQna.slackChannelSelection.disconnectOverwriteNote2",defaultMessage:"This process can take up to 3 hours, and you'll only be able to reconnect after disconnecting is complete."})})]}),acceptLabel:(0,T.jsx)(h()._H,{id:"universalQna.slackChannelSelection.disconnectButtonLabel",defaultMessage:"Disconnect Slack"})});e&&((0,A().j)({environment:E,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"slack_user_mapping_disconnect",integration_type:"slack",setup_session_id:R,from:K||oe}}}),await m().callApi({eventName:"disconnectSlackIngestion",environment:E,data:{spaceId:ae,disconnectUserMapping:!0}}))}}]).filter((e=>!e.hidden)).map((e=>{let{key:n,label:s,caption:a,icon:i,disabled:o,connected:c,action:l}=e;return{key:n,action:async()=>{await l(),null==t||t.close()},render:e=>(0,T.jsx)(b().Z,{...e,title:(0,T.jsxs)(C().gq,{gap:4,children:[(0,T.jsx)("div",{style:Z.iconWrapper,children:i}),(0,T.jsxs)("div",{style:Z.option,children:[(0,T.jsx)("div",{style:o?Z.disabledOptionLabel:Z.optionLabel,children:s}),(0,T.jsx)("div",{style:Z.caption,children:a})]})]}),right:c&&(0,r().U)({width:12,height:12}),disabled:o})}}))}];return D||!te.includes("slack-admin")||!q||Y||ie||ve.push({key:"slack-settings-section",render:e=>(0,T.jsx)(I().Z,{...e,topBorder:!0}),items:[{key:"slack-settings",action:()=>{ae&&(P().slackUniversalQnAConnectionStore.setState({...P().slackUniversalQnAConnectionStore.state,currentScreen:"settings"}),null==t||t.close())},render:e=>(0,T.jsx)(b().Z,{...e,title:(0,T.jsxs)(C().gq,{gap:4,children:[(0,T.jsx)("div",{style:Z.iconWrapper,children:(0,v().H)(Z.icon)}),(0,T.jsx)("div",{style:Z.option,children:(0,T.jsx)("div",{style:Z.optionLabel,children:(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.settings",defaultMessage:"Settings"})})})]})})}]}),(0,T.jsx)(M().Z,{menuType:O().o.Popup,width:230,children:X?(0,T.jsx)(C().gq,{style:{padding:8,justifyContent:"center"},children:(0,T.jsx)(x().Z,{})}):(0,T.jsx)(j().ZP,{type:j().iW.Vertical,sections:ve,initialFocus:void 0})})}function B(e,n,t,s){return t||n||!e.includes("slack-admin")?(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.adminAuth",defaultMessage:"Public conversations"}):s?(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.noWorkspacesSelected",defaultMessage:"No workspaces selected"}):(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.noChannelsSelected",defaultMessage:"No channels selected"})}function V(e,n,t,s,a){return e?s?(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.disconnectingPublicSlack",defaultMessage:"Disconnecting. This can take up to 3 hours."}):t?(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.connectingPublicSlack",defaultMessage:"Connecting. This can take up to 36 hours."}):n.includes("slack-admin")?a?(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.connectedByWorkspaceOwner",defaultMessage:"Connected by workspace owner"}):(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.selectChannels",defaultMessage:"Your workspace owner hasn't completed the setup."}):(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.connectSlackToEnhanceResults",defaultMessage:"Connect to enhance your AI results"}):n.includes("slack-admin")?a?(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.connectedByWorkspaceOwner",defaultMessage:"Connected by workspace owner"}):t?(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.connectingPublicSlack",defaultMessage:"Connecting. This can take up to 36 hours."}):(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.selectChannels",defaultMessage:"Your workspace owner hasn't completed the setup."}):(0,T.jsx)(h()._H,{id:"assistantOverflowMenu.slackIngestion.contactAdmin",defaultMessage:"Contact your workspace owner to connect"})}},261070:(e,n,t)=>{t.d(n,{f:()=>a});t(667294);var s=t(785893);const a=(0,t(827282).IU)("key",{viewBox:"0 0 30 30",svg:(0,s.jsx)("path",{d:"M14.757 4A5.724 5.724 0 009 9.748c0 2.364 1.389 4.456 3.586 5.335V23.6c0 .255.079.483.272.676l1.53 1.477a.578.578 0 00.808-.009l2.769-2.768a.598.598 0 000-.87l-1.591-1.574 2.232-2.232a.602.602 0 00-.017-.861l-2.171-2.18c2.628-1.116 4.087-3.13 4.087-5.511A5.733 5.733 0 0014.757 4zm0 5.344a1.55 1.55 0 01-1.547-1.547c0-.861.685-1.547 1.547-1.547a1.55 1.55 0 011.547 1.547 1.55 1.55 0 01-1.547 1.547z"})})}}]);