"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[50801],{725819:(e,t,r)=>{r.r(t),r.d(t,{LinkPreviewLab:()=>K,default:()=>z});r(241792);var s=r(667294),i=()=>r(219727),n=()=>r(142735),o=()=>r(846550),a=()=>r(198690),l=()=>r(374289),d=()=>r(417387),u=()=>r(705214),g=()=>r(36588),c=()=>r(955620),x=()=>r(830968),p=()=>r(788860),v=()=>r(696459),h=()=>r(707513),j=()=>r(957042),m=()=>r(631986),b=()=>r(859193),f=()=>r(352230),y=()=>r(876822),S=()=>r(529048),w=()=>r(138912),T=()=>r(632599),A=()=>r(154186),R=()=>r(827973),U=()=>r(448419),I=()=>r(291198),M=()=>r(198829),P=()=>r(255577),k=()=>r(661641),L=()=>r(661297),C=()=>r(388284),Z=()=>r(615912),_=()=>r(311598),E=()=>r(878517),H=()=>r(42557),B=()=>r(877289),V=r(785893);function z(e){const{integrationPointer:t}=e,r=(0,n().VK)((()=>y().default.state.currentUserStore),[]),s=(0,n().VK)((()=>{if(r)return r.getRecordValue(t)}),[r,t]),i=(0,a().V)({value:s,waitTimeInMs:5e3}),l=(0,o().yK)((()=>({header:{marginBottom:24}})),[]);return"pending"===i.status?(0,V.jsx)(T().Z,{}):"rejected"!==i.status&&(0,u().VM)(i.value)?(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)("div",{style:l.header,children:[(0,V.jsx)(k().q,{styleName:"UITitle-30px/Semibold",children:(0,V.jsx)(p()._H,{id:"developerIntegrationLab.title.label",defaultMessage:"Link Preview Lab"})}),(0,V.jsx)(k().q,{styleName:"Heading-17px/Regular",children:(0,V.jsx)(p()._H,{id:"developerIntegrationLab.subtitle.label",defaultMessage:"Plan out preview URL regex patterns and API responses."})})]}),(0,V.jsx)(K,{starterIntegration:i.value})]}):(0,V.jsx)(Z().Z,{})}function K(e){let{starterIntegration:t}=e;const[r,i]=s.useState(""),[n,o]=s.useState(b().Az),[a,l]=s.useState(b().SV),[d,u]=s.useState(b().VR()),[g,c]=s.useState(b().nZ),[p,v]=s.useState(b().e_),[h,j]=s.useState(b().P4),[m,f]=s.useState(t);return s.useEffect((()=>{const{original_url_domains:e,development_url_domains:r,original_url_patterns:s}=t.info,i=(null==e?void 0:e[0])||(null==r?void 0:r[0]);if(i&&c(i),null!=s&&s[0]){const{regex:e,attributes:t,sample_urls:r}=null==s?void 0:s[0];v(e);const i=t.map(x().Ah);j(i);const n=null==r?void 0:r[0];n&&o(n)}}),[t]),s.useEffect((()=>{f((e=>b().Hx({domain:g,regex:p,attributes:h,currentIntegration:e})))}),[g,p,h]),s.useEffect((()=>{w().default.setState({loaded:!0,loading:!1,userId:void 0,spaceId:b().C,integrations:[m],externalAuthentications:[],bots:[],completeSlackAuthentications:[],twoWaySyncExternalEntities:[]})}),[m]),(0,V.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,V.jsx)(O,{style:{flex:1,marginRight:12},setErrorMessage:i,rootUrl:n,setRootUrl:o,relatedUrisToAttributes:d,setRelatedUrisToAttributes:u,domain:g,setDomain:c,regexPattern:p,setRegexPattern:v,regexAttributes:h,setRegexAttributes:j,rootAttributes:a,setRootAttributes:l}),(0,V.jsx)(D,{style:{flex:1},rootUrl:n,rootAttributes:a,relatedUrisToAttributes:d,integration:m,errorMessage:r})]})}function O(e){const{style:t,rootUrl:r,setRootUrl:s,domain:i,setDomain:o,regexPattern:a,setRegexPattern:l,regexAttributes:d,setRegexAttributes:u,rootAttributes:c,setRootAttributes:x,relatedUrisToAttributes:v,setRelatedUrisToAttributes:j,setErrorMessage:m}=e,f=(0,n().VK)((()=>b().TG(c)),[c]);return(0,V.jsxs)("div",{style:t,children:[(0,V.jsxs)("label",{children:[(0,V.jsx)("div",{style:{fontSize:15,fontWeight:h().Ue.medium},children:(0,V.jsx)(p()._H,{id:"developerIntegrationLab.rootUrl.label",defaultMessage:"Pasted URL to Preview"})}),(0,V.jsx)(I().Z,{value:r,onChange:e=>s(e.target.value)})]}),(0,V.jsxs)(N,{title:(0,V.jsx)(p()._H,{id:"developerIntegrationLab.regexConfiguration.label",defaultMessage:"Manage Regex Configuration"}),style:{marginTop:12},children:[(0,V.jsxs)("label",{style:{marginTop:12},children:[(0,V.jsx)("div",{style:{fontSize:15,fontWeight:h().Ue.medium},children:(0,V.jsx)(p()._H,{id:"developerIntegrationLab.domain.label",defaultMessage:"Domain"})}),(0,V.jsx)(I().Z,{value:i,onChange:e=>o(e.target.value)})]}),(0,V.jsx)(J,{regexPattern:a,setRegexPattern:l,setErrorMessage:m}),(0,V.jsxs)("label",{style:{marginTop:12},children:[(0,V.jsx)("div",{style:{fontSize:15,fontWeight:h().Ue.medium},children:(0,V.jsx)(p()._H,{id:"developerIntegrationLab.regexAttributes.label",defaultMessage:"Regex Attributes"})}),(0,V.jsx)($,{value:d,onChange:u,validationType:g().$1,setErrorMessage:m})]})]}),(0,V.jsx)(N,{title:(0,V.jsx)(p()._H,{id:"developerIntegrationLab.rootAttributes.label",defaultMessage:"Unfurl response payload"}),style:{marginTop:12},children:(0,V.jsx)($,{value:c,onChange:x,validationType:g().$1,setErrorMessage:m})}),(0,V.jsx)(N,{title:(0,V.jsx)(p()._H,{id:"developerIntegrationLab.relatedAttributes.label",defaultMessage:"Related unfurl response payloads"}),style:{marginTop:12},children:f.map((e=>{const t=v[e];return(0,V.jsx)(N,{title:e,style:{marginTop:12,marginLeft:12},children:t?(0,V.jsx)($,{value:t,onChange:t=>{j({...v,[e]:t})},validationType:g().$1,setErrorMessage:m}):(0,V.jsx)(p()._H,{id:"developerIntegrationLab.relatedAttributes.empty",defaultMessage:"No related attributes found."})},e)}))})]})}const W=["preview","mention","hover"],F=["authenticate","error","update","loaded"];function D(e){const{style:t,rootUrl:r,rootAttributes:i,relatedUrisToAttributes:n,integration:o,errorMessage:a}=e,[l,d]=s.useState("preview"),[u,g]=s.useState("loaded");return(0,V.jsxs)("div",{style:t,children:[(0,V.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,V.jsx)("div",{style:{marginRight:12},children:"Preview type:"}),(0,V.jsx)(q,{title:l,options:W,onSelectOption:e=>d(e)}),(0,V.jsx)("div",{style:{marginLeft:12,marginRight:12},children:"Preview state:"}),(0,V.jsx)(q,{title:u,options:F,onSelectOption:e=>g(e)})]}),(0,V.jsx)("div",{style:{marginTop:12,maxWidth:600},children:(0,V.jsx)(G,{previewType:l,previewState:u,rootUrl:r,rootAttributes:i,relatedUrisToAttributes:n,integration:o,errorMessage:a})})]})}function N(e){const[t,r]=s.useState(!1);return(0,V.jsxs)("div",{style:e.style,children:[(0,V.jsxs)(A().Z,{onClick:()=>r(!t),style:{display:"flex",alignItems:"center"},children:[(0,d().L)({width:"0.6875em",height:"0.6875em",transition:"transform 200ms ease-out",transform:`rotateZ(${t?180:90}deg)`,marginRight:4}),e.title]}),t&&e.children]})}function $(e){const{value:t,onChange:r,validationType:i,setErrorMessage:n}=e,[o,a]=s.useState(JSON.stringify(t,null,2));return(0,V.jsx)(I().Z,{format:I().B.ExtraLarge,inputStyle:{fontSize:14,lineHeight:"18px",height:500},textarea:!0,value:o,onChange:e=>{const t=e.target.value;a(t);const s=m().Jv(t);if(void 0===s)n("Could not parse JSON object input.");else{const e=(0,j().Gu)(i,s);e?n(e.message):(n(""),r(s))}}})}function J(e){const{regexPattern:t,setRegexPattern:r,setErrorMessage:i}=e,[n,o]=s.useState(t);return(0,V.jsxs)("label",{style:{marginTop:12},children:[(0,V.jsx)("div",{style:{fontSize:15,fontWeight:h().Ue.medium},children:"Regex Pattern"}),(0,V.jsx)(I().Z,{value:n,onChange:e=>{const t=e.target.value;o(t);try{new RegExp(t);r(t),i("")}catch(s){i("Invalid Regex.")}}})]})}function q(e){const{title:t,options:r,onSelectOption:s}=e,[i,o,a]=(0,n().AF)(void 0,S().Z);return(0,V.jsx)(U().ZP,{popupType:U().Z4.Popup,buttonPopupStore:a,renderOrigin:()=>(0,V.jsxs)(L().Z,{onClick:()=>o({...i,open:!0}),children:[t,(0,l().i)({width:10,marginTop:4,marginLeft:4})]}),render:()=>(0,V.jsx)(M().Z,{menuType:f().o.Popup,children:(0,V.jsx)(P().ZP,{type:P().iW.Vertical,sections:[{key:t,items:r.map((e=>({key:e,action:()=>{s(e),o({...i,open:!1})},render:t=>(0,V.jsx)(R().Z,{...t,title:e})}))),render:e=>(0,V.jsx)(C().Z,{...e})}],initialFocus:void 0})})})}function G(e){const{previewType:t,previewState:r,rootUrl:n,rootAttributes:a,relatedUrisToAttributes:l,integration:d,errorMessage:u}=e,[g,c]=s.useState(""),x=(0,i().O7)(),[p,v]=s.useState();s.useEffect((()=>{const e=b().rn({environment:x,rootUrl:n,rootAttributes:a,relatedUrisToAttributes:l,integration:d});"error"in e?c(e.error):(c(""),v(e))}),[x,n,a,l,d]),s.useEffect((()=>{c(u)}),[u]);const h=(0,o().yK)((e=>({error:{marginTop:12,marginBottom:12,padding:"12px 24px",marginRight:"auto",backgroundColor:e.accentColors.red[100]}})),[]);return(0,V.jsxs)(V.Fragment,{children:[g&&(0,V.jsxs)("div",{style:h.error,children:[g," "]}),p&&(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(B().wd,{isInverted:!1,showInsets:!1,showSize:!1,children:(0,V.jsx)(X,{previewType:t,previewState:r,previewStores:p})}),(0,V.jsx)(B().wd,{isInverted:!0,showInsets:!1,showSize:!1,children:(0,V.jsx)(X,{previewType:t,previewState:r,previewStores:p})})]})]})}function Q(e){const{previewStores:t}=e,r=(0,o().yK)((e=>({container:{borderRadius:6,boxShadow:e.shadowSM}})),[]),s=(0,n().VK)((()=>{const e=t.previewBlockStore.id;if(!e)return;return{annotation:(0,c().x36)(e),store:t.inlineBlockStore,token:void 0}}),[t.previewBlockStore,t.inlineBlockStore]);return s?(0,V.jsx)("div",{style:r.container,children:(0,V.jsx)(E().D5,{isHoveredTokenEditable:!0,state:s})}):null}function X(e){const{previewType:t,previewState:r,previewStores:s}=e;return"preview"===t?(0,V.jsx)(_().Z,{store:"authenticate"===r?s.emptyInstanceBlockStore:s.previewBlockStore,disabled:!1,forceActionForUIDoc:"loaded"===r?void 0:r}):"mention"===t?(0,V.jsx)(H().Z,{store:"authenticate"===r?s.emptyInlineBlockStore:s.inlineBlockStore,disabled:!1}):"hover"===t?(0,V.jsx)(Q,{...e}):void(0,v().t1)(t)}}}]);