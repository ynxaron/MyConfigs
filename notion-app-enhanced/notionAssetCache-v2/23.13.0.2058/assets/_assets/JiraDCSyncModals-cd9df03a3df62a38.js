"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[40205],{253458:(e,t,n)=>{n.r(t),n.d(t,{default:()=>se});n(267602),n(653476);var i=n(667294),a=()=>n(219727),s=()=>n(142735),o=()=>n(846550),r=()=>n(714230),l=()=>n(889919),d=()=>n(205248),c=()=>n(968061),u=()=>n(956057),h=()=>n(788860),p=()=>n(707513),g=()=>n(148976),m=()=>n(10271),x=()=>n(876822),f=()=>n(308939),v=()=>n(853648),j=(n(470928),n(241792),()=>n(286977)),y=()=>n(374289),w=()=>n(409873),C=()=>n(235484),S=()=>n(799891),I=()=>n(705214),A=()=>n(513670),k=()=>n(308186),b=()=>n(205228),T=()=>n(594546),Z=()=>n(709344),D=()=>n(527278),P=()=>n(138912),B=()=>n(824462),M=()=>n(423402);const H=(0,h().vU)({dismissButtonLabel:{defaultMessage:"OK",id:"dialog.dismissButton.label"},pleaseTryAgainMsg:{defaultMessage:"Please try again",id:"dialog.pleaseTryAgainMsg"},AuthenticationFailedMsg:{defaultMessage:"Authentication failed. Please try again.",id:"jiraDCAuthActions.authenticationFailedMsg"}});var U=()=>n(352230),z=()=>n(998901),J=()=>n(265640),_=()=>n(827973),L=()=>n(448419),V=()=>n(666414),F=()=>n(1910),R=()=>n(206352),O=()=>n(291198),E=()=>n(198829),K=()=>n(255577),N=()=>n(661297),W=()=>n(906651),q=()=>n(388284),G=()=>n(654133),Y=()=>n(251932),$=n(785893);function Q(e){const{site:t,APIToken:n,username:i,password:a,jiraDataCenterBasicAuthEnabled:r,jiraDCVersion:l,formValues:{site:d,token:c,username:u,password:g},onChange:m,invalidFields:x,hidePopup:v,environment:j}=e,y=(0,s().Kw)(f().ZP),w=(0,o().yK)((e=>({title:{fontWeight:p().Ue.semibold},inputLabels:{fontSize:p().JB.UISmall.desktop,fontWeight:p().Ue.semibold,font:"SF Pro",lineHeight:p().Nv.UISmall.desktop,color:e.lightTextColor},placeHolder:{font:"SF Pro",fontWeight:p().Ue.regular,fontSize:p().JB.UIRegular.desktop,lineHeight:p().Nv.UISmall.desktop},captionText:{font:"SF Pro",fontWeight:p().Ue.regular,lineHeight:p().Nv.UISmall.desktop,fontSize:p().JB.UISmall.desktop,color:e.lightTextColor},inputBox:{width:"100%",height:28,padding:4,gap:4,radius:"default"},invalidInput:{boxShadow:e.outlineRedInputBoxShadow}})),[]);return(0,$.jsx)(R().Z,{debugName:"AtlassianAPIAuthContentPopup",capture:!0,children:(0,$.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%",width:"100%"},children:[(0,$.jsx)("div",{style:{overflowY:"scroll"},children:(0,$.jsxs)("div",{style:{padding:2},children:[(0,$.jsx)("div",{children:r&&(0,$.jsx)("div",{children:(0,$.jsxs)("div",{children:[(0,$.jsx)("label",{htmlFor:"jiraDCVersion",style:{...w.inputLabels},children:l}),(0,$.jsx)(X,{onSelectOption:e=>{f().ZP.setState({...f().ZP.state,authenticationType:e})},options:[{key:f().P.Bearer,label:(0,$.jsx)(h()._H,{id:"jiraAuthentication.jiraDCNewerVersionOption.label",defaultMessage:"8.14 or later"})},{key:f().P.Basic,label:(0,$.jsx)(h()._H,{id:"jiraAuthentication.jiraDCOlderVersionOption.label",defaultMessage:"Prior to 8.14"})}],currentOption:y.authenticationType??f().P.Bearer})]})})}),(0,$.jsx)(V().Z,{size:14,isHidden:!0}),(0,$.jsxs)("div",{children:[(0,$.jsx)("label",{htmlFor:"site",style:w.inputLabels,children:t}),(0,$.jsx)(V().Z,{size:8,isHidden:!0}),(0,$.jsx)(O().Z,{id:"site",value:d,onChange:e=>m("site",e.target.value),showClearButton:!0,placeholder:"https://domain.com",inputElementAttributes:{minLength:4},style:{...w.inputBox,...x.includes("site")&&w.invalidInput}})]}),(0,$.jsx)(V().Z,{size:14,isHidden:!0}),(0,$.jsx)("div",{children:r&&y.authenticationType===f().P.Basic?(0,$.jsxs)("div",{children:[(0,$.jsxs)("div",{children:[(0,$.jsx)("label",{htmlFor:"username",style:w.inputLabels,children:i}),(0,$.jsx)(V().Z,{size:8,isHidden:!0}),(0,$.jsx)(O().Z,{id:"username",type:"username",value:u,onChange:e=>{m("username",e.target.value)},showClearButton:!0,placeholder:"Enter your username",inputElementAttributes:{minLength:4},style:{...w.inputBox,...x.includes("username")&&w.invalidInput}}),(0,$.jsx)(V().Z,{size:8,isHidden:!0})]}),(0,$.jsx)(V().Z,{size:14,isHidden:!0}),(0,$.jsxs)("div",{children:[(0,$.jsx)("label",{htmlFor:"password",style:w.inputLabels,children:a}),(0,$.jsx)(V().Z,{size:8,isHidden:!0}),(0,$.jsx)(O().Z,{id:"password",type:"password",value:g,onChange:e=>{m("password",e.target.value)},showClearButton:!0,placeholder:"Enter your password",inputElementAttributes:{minLength:4},style:{...w.inputBox,...x.includes("password")&&w.invalidInput}}),(0,$.jsx)(V().Z,{size:8,isHidden:!0})]}),(0,$.jsx)(V().Z,{size:14,isHidden:!0})]}):(0,$.jsxs)("div",{children:[(0,$.jsxs)("div",{children:[(0,$.jsx)("label",{htmlFor:"APIToken",style:w.inputLabels,children:n}),(0,$.jsx)(V().Z,{size:8,isHidden:!0}),(0,$.jsx)(O().Z,{id:"AccessToken",type:"password",value:c,onChange:e=>{m("token",e.target.value)},showClearButton:!0,placeholder:"Paste your token here",inputElementAttributes:{minLength:4},style:{...w.inputBox,...(y.adminTokenError||x.includes("token"))&&w.invalidInput}}),(0,$.jsx)(V().Z,{size:8,isHidden:!0})]}),(0,$.jsx)(V().Z,{size:14,isHidden:!0})]})})]})}),(0,$.jsxs)("div",{style:{display:"flex",justifyContent:"normal"},children:[(0,$.jsx)(W().Z,{isLarge:!0,disabled:"Basic"===y.authenticationType&&r?!d||!u||!g:!d||!c,onClick:async()=>{await async function(e){const{environment:t,siteValue:n,tokenValue:i,usernameValue:a,passwordValue:s}=e,o=f().ZP.getFlowId(),r=f().ZP.state;(0,T().j)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira-dc",actionType:"auth_initiated",flowId:o}}});const l=P().default.integrations.state.find((e=>e.id===C().Gl));if(!l||!r.spaceId||!t.currentUser.id)return k().vC({message:D().Z.formatMessage(H.pleaseTryAgainMsg),showCancel:!1,keepFocus:!1,items:[{label:D().Z.formatMessage(H.pleaseTryAgainMsg),onAccept:A().yR}]}),void S().log({level:"info",from:"jiraDCAuthActions",type:"authenticateWithJiraDC",data:{message:"Missing required data to authenticate with Jira DC",miscDataToConvertToString:{siteValue:n,userId:t.currentUser.id,spaceId:r.spaceId}}});const d=l.id,c=(0,I().lT)(b().default.domainBaseUrl),u=l.redirect_uris.includes(c)?c:l.redirect_uris[0],h=await B().callApi({eventName:"createOauthAuthorizationCode",environment:t,data:{integrationId:d,spaceId:r.spaceId,redirectUri:u}});if("failed"===h.type)return k().x2(h),S().log({level:"error",from:"jiraDCAuthActions",type:"authenticateWithJiraDC",data:{message:"Unexpected error creating authorization code",miscDataToConvertToString:{response:h,siteValue:n,userId:t.currentUser.id,spaceId:r.spaceId}}}),(0,T().j)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira-dc",actionType:"auth_status",flowId:o,status:"failed"}}}),{error:`Unexpected error creating authorization code: ${(0,Z().p)(h)}`};const p=h.data.code;let g;if(g="Basic"===r.authenticationType?await B().callApi({eventName:"authenticateJiraDCUser",environment:t,data:{domain:n,userId:t.currentUser.id,spaceId:r.spaceId,notionAuthorizationCode:p,username:a,password:s,authType:"Basic"}}):await B().callApi({eventName:"authenticateJiraDCUser",environment:t,data:{domain:n,userId:t.currentUser.id,spaceId:r.spaceId,personalAccessToken:i,notionAuthorizationCode:p}}),(0,T().j)({environment:t,event:{eventName:"external_sync_auth",eventProperties:{integration:"jira-dc",actionType:"auth_status",flowId:o,status:"success"===g.type?"success":"failed"}}}),"failed"===g.type||"AUTHENTICATION_FAILED"===g.data.code){const e="failed"===g.type?(0,Z().p)(g):H.AuthenticationFailedMsg.defaultMessage;k().vC({message:e,showCancel:!1,keepFocus:!1,items:[{label:D().Z.formatMessage(H.dismissButtonLabel),onAccept:A().yR}]}),S().log({level:"error",from:"jiraDCAuthActions",type:"authenticateWithJiraDC",data:{message:"Failed to authenticate with Jira DC",miscDataToConvertToString:{errorStatus:g.status,siteValue:n,userId:t.currentUser.id,spaceId:r.spaceId}}})}else{S().log({level:"info",from:"jiraDCAuthActions",type:"authenticateWithJiraDC",data:{message:"Authentication with Jira DC is successful",miscDataToConvertToString:{siteValue:n,userId:t.currentUser.id,spaceId:r.spaceId}}}),await M().pJ({environment:t});const e=r.notionState;f().ZP.setState({...f().ZP.state,open:!1,isMemberAuthSuccessForDataCenter:!0,notionState:void 0}),e&&await M().FD({environment:t,notionState:e})}}({environment:j,siteValue:d,tokenValue:c,usernameValue:u,passwordValue:g})},children:(0,$.jsx)(h()._H,{id:"JiraDCAuthentication.authenticateButton.label",defaultMessage:"Authenticate"})}),(0,$.jsx)(N().Z,{size:"lg",style:{marginLeft:12},onClick:()=>{v()},children:(0,$.jsx)(h()._H,{id:"JiraDCAuthentication.cancelButton.label",defaultMessage:"Cancel"})})]})]})})}function X(e){var t;const{onSelectOption:n,options:i,currentOption:a}=e,s=null===(t=i.find((e=>{let{key:t}=e;return t===a})))||void 0===t?void 0:t.label,r=(0,o().yK)((e=>({icon:{marginLeft:4,fill:e.lightIconColor,width:16,height:16,padding:"0.5px, 0px, 0px, 0px",gap:10,fontSize:p().JB.UISmall.desktop},dropdownLabel:{font:"SF Pro",fontSize:p().JB.UIRegular.desktop,fontWeight:p().Ue.regular,lineHeight:p().Nv.UISmall.desktop}})),[]);return(0,$.jsx)(L().ZP,{popupType:L().Z4.Popup,placementToOrigin:L().pO.Left,renderOrigin:e=>(0,$.jsxs)(J().D,{...e,size:"lg",style:r.dropdownLabel,disabled:!1,hoveredStyle:{background:"rgba(0, 0, 0, 0)"},children:[s,(0,y().i)(r.icon)]}),render:e=>{const t={menuType:U().o.Popup,width:250,left:50},a=[{key:"settings-item-section",render:e=>(0,$.jsx)(q().Z,{...e}),items:i.map((t=>{let{key:i,label:a}=t;return{key:i,action:()=>{n(i),e.close()},render:e=>(0,$.jsx)(_().Z,{...e,title:a,shouldWrapCaption:!0,right:s===a?(0,$.jsx)("div",{style:{width:14},children:(0,j().e)()}):void 0})}}))}];return(0,$.jsx)(E().Z,{...t,children:(0,$.jsx)(K().ZP,{type:K().iW.Vertical,sections:a,initialFocus:void 0,style:{position:"relative",alignItems:"flex-end"}})})}})}const ee=function(e){return(0,$.jsx)(Q,{hidePopup:()=>{!function(e){const{key:t,value:n}=e;f().ZP.setState({...f().ZP.state,[t]:n})}({key:"open",value:!1})},site:(0,$.jsxs)(Y().gq,{style:{alignItems:"center",gap:2},children:[(0,$.jsx)(h()._H,{id:"AtlassianApiTokenAuthentication.siteMessage",defaultMessage:"Jira site url"}),(0,$.jsx)(G().Z,{style:{width:300,whiteSpace:"normal"},placement:z().Placement.Right,renderTooltip:()=>(0,$.jsx)(h()._H,{id:"jiraDataCenterAuth.siteHelperText",defaultMessage:"The base URL that is used to access Jira. If you are running on a non-standard port, please provide the input in host:port format"}),render:e=>(0,$.jsx)(F().Z,{ariaLabel:"Jira DC site help text button",disableBackground:!0,icon:w().D,...e})})]}),APIToken:(0,$.jsxs)(Y().gq,{style:{alignItems:"center",gap:2},children:[(0,$.jsx)(h()._H,{id:"AtlassianDCApiTokenAuthentication.apiTokenMessage",defaultMessage:"API token"}),(0,$.jsx)(G().Z,{placement:z().Placement.Right,renderTooltip:()=>(0,$.jsx)(h()._H,{id:"jiraDataCenterAuth.stepsToGetPAT.caption",defaultMessage:"Click to learn how to get personal authentication token from Jira server"}),render:e=>(0,$.jsx)(F().Z,{ariaLabel:"Jira personal access token help text button",onClick:()=>{window.open("https://confluence.atlassian.com/enterprise/using-personal-access-tokens-1026032365.html","_blank")},icon:w().D,...e})})]}),username:(0,$.jsx)(Y().gq,{style:{alignItems:"center",gap:2},children:(0,$.jsx)(h()._H,{id:"AtlassianDCApiTokenAuthentication.usernameMessage",defaultMessage:"Jira username"})}),password:(0,$.jsx)(Y().gq,{style:{alignItems:"center",gap:2},children:(0,$.jsx)(h()._H,{id:"AtlassianDCApiTokenAuthentication.passwordMessage",defaultMessage:"Jira password"})}),jiraDCVersion:(0,$.jsxs)(Y().gq,{style:{alignItems:"center",gap:2},children:[(0,$.jsx)(h()._H,{id:"AtlassianApiTokenAuthentication.DCVersion",defaultMessage:"Jira version"}),(0,$.jsx)(G().Z,{style:{width:300,whiteSpace:"normal"},placement:z().Placement.Right,renderTooltip:()=>(0,$.jsx)(h()._H,{id:"AtlassianApiTokenAuthentication.stepsToGetDCVersion.captions",defaultMessage:"Click to learn how to know the version of DC Server you are running"}),render:e=>(0,$.jsx)(F().Z,{ariaLabel:"Jira DC version help text button",onClick:()=>{window.open("https://community.atlassian.com/t5/Jira-questions/Re-where-can-i-check-jira-version-am-using-how-to-check/qaq-p/664639/comment-id/218177#M218177","_blank")},icon:w().D,...e})})]}),...e})};var te=()=>n(154186),ne=()=>n(573357),ie=()=>n(708518);const ae=(0,h().vU)({headerTitle:{id:"jiraDCAuthModal.header.title",defaultMessage:"Authenticate your account"}});function se(){const e=(0,a().O7)(),t=(0,s().Kw)(f().ZP),{open:n,type:i}=t,o=()=>{const e=f().ZP.getInitialState();f().ZP.setState({...e,open:!1})},r=(0,s().qz)(void 0,v().Z),l=(0,s().Kw)(x().default).currentSpaceStore,d=t.flowId||u().Il(),c=!!i&&!!l&&t.instanceValue!==f().LT.Cloud&&"dc-auth"===t.type;if((0,m().Z)({shouldPreserveTextSelection:n&&c,shouldPreserveBlockSelection:n&&c,shouldRestoreSelection:!0}),!c)return null;const{height:h,width:p}="auth"===i?{width:450,height:"fit-content"}:{width:400,height:"fit-content"};return(0,$.jsx)(ie().Z,{open:n,innerStyle:{width:p,height:h,overflow:"scroll",borderRadius:5,maxHeight:675,minHeight:300,padding:6},render:()=>(0,$.jsx)(ne().Z,{capture:!0,allowEsc:!0,render:()=>(0,$.jsx)(oe,{type:i,handleModalClose:o,environment:e,requestStore:r,spaceStore:l,flowId:d})}),onDismiss:o})}function oe(e){const{environment:t,requestStore:n,spaceStore:a}=e,r=e.flowId||u().Il(),l=(0,s().Kw)(f().ZP);(0,i.useEffect)((()=>{l.flowId||f().ZP.setState({...l,flowId:r})}),[l,r]);const d=(0,o().yK)((e=>({wrapper:{padding:"20px 14px 10px 14px",height:"100%",display:"flex",flexDirection:"column"}})),[]);return(0,$.jsx)("div",{style:d.wrapper,children:(0,$.jsx)(le,{handleModalClose:e.handleModalClose,environment:t,requestStore:n,spaceStore:a,flowId:r})})}function re(e){let{handleModalClose:t,caption:n,title:i}=e;const a=(0,o().yK)((e=>({wrapper:{marginBottom:18},header:{fontWeight:p().Ue.medium,fontSize:17,textAlign:"center",marginTop:8},description:{fontWeight:p().Ue.regular,color:e.mediumTextColor,fontSize:p().JB.UIRegular.desktop,maxHeight:72,textAlign:"center",padding:"0px 68px",marginBottom:24},icon:{height:40,width:40},iconGroup:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gridColumnGap:9,marginBottom:9},arrowRight:{width:20,height:20,opacity:.4,fontWeight:p().Ue.bold,padding:3},notionLogo:{height:40,width:40,color:e.regularIconColor},closeButton:{position:"absolute",top:14,right:14,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:e.buttonHoveredBackground,width:20,height:20},closeButtonHover:{background:e.buttonPressedBackground},closeButtonIcon:{width:14,fill:e.mediumTextColor}})),[]),s=i||ae.headerTitle;return(0,$.jsxs)("div",{style:a.wrapper,children:[(0,$.jsx)(te().Z,{onClick:t,style:a.closeButton,hoveredStyle:a.closeButtonHover,children:(0,d().D)(a.closeButtonIcon)}),(0,$.jsxs)("div",{style:a.iconGroup,children:[(0,$.jsx)("img",{style:a.icon,src:r().Z.images.externalIntegrations.jiraPng,alt:"Jira Icon"}),(0,l().k)(a.arrowRight),(0,c().h)(a.notionLogo)]}),(0,$.jsx)("div",{style:a.header,children:(0,$.jsx)(h()._H,{...s})}),n]})}function le(e){let{environment:t,handleModalClose:n}=e;const[a,o]=(0,i.useState)([]),r=(0,s().Kw)(f().ZP),[l,d]=i.useState({site:r.site||"",token:"",username:"",password:""}),c=(0,s().VK)((()=>(0,g().uY)()),[]);return(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(re,{handleModalClose:n}),(0,$.jsx)(ee,{formValues:l,onChange:(e,t)=>{d({...l,[e]:t}),o((t=>t.filter((t=>t!==e))))},invalidFields:a,environment:t,jiraDataCenterBasicAuthEnabled:c})]})}},10271:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(667294),a=()=>n(965903),s=()=>n(127519);const o=function(e){let{shouldPreserveTextSelection:t,shouldPreserveBlockSelection:o,shouldRestoreSelection:r,onClearSelection:l}=e;const d=(0,n(219727).O7)(),c=(0,i.useRef)(t),u=(0,i.useRef)(""),h=(0,i.useRef)({selectionState:null,textSelectionState:null}),p=(0,i.useCallback)((()=>h.current),[]),g=(0,i.useCallback)((()=>{u.current=window.location.href,s().default.hasSelection()&&(h.current.textSelectionState=s().default.cloneState()),n(990966).clear({preventDismissMobileKeyboard:!0,environment:d}),o&&(a().default.isSelected()&&(h.current.selectionState=a().default.cloneState()),n(879952).ZH({preventDismissMobileKeyboard:!0,environment:d}))}),[d,o]),m=(0,i.useCallback)((()=>{h.current={selectionState:null,textSelectionState:null},u.current="",null==l||l()}),[l]),x=(0,i.useCallback)((()=>{const{selectionState:e,textSelectionState:t}=h.current;window.location.href===u.current&&(t&&"mode"in t&&"editing"===t.mode&&s().default.setState({...s().default.state,...t}),o&&e&&a().default.setState({...a().default.state,...e})),m()}),[m,o]);return(0,n(732811).K)((()=>{c.current=t,t&&g()})),(0,i.useEffect)((()=>(c.current&&!t?r?x():m():!c.current&&t&&g(),c.current=t,()=>{r?x():m()})),[t,m,x,g,r]),{clearSavedSelection:m,restoreSavedSelection:x,getSavedSelection:p}}},889919:(e,t,n)=>{n.d(t,{k:()=>a});n(667294);var i=n(785893);const a=(0,n(827282).IU)("arrowRightSmaller",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M15.383 8.352a.877.877 0 01-.274.64l-5.156 5.14a.864.864 0 01-.617.266.831.831 0 01-.602-.234.795.795 0 01-.234-.586c0-.12.02-.232.063-.336a.912.912 0 01.187-.273l1.75-1.766 2.914-2.656.274.5-2.711.156H1.484c-.26 0-.471-.078-.632-.234a.851.851 0 01-.235-.617c0-.256.078-.461.235-.618a.856.856 0 01.632-.242h9.493l2.71.164-.273.508L10.5 5.5 8.75 3.727a.946.946 0 01-.188-.266.917.917 0 01-.062-.344c0-.234.078-.43.234-.586a.831.831 0 01.602-.234.79.79 0 01.328.07c.104.047.203.117.297.211l5.148 5.133a.877.877 0 01.274.64z"})})}}]);