"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[10761,95986],{887330:(e,t,n)=>{n.d(t,{C:()=>i,L:()=>r});var o=()=>n(707513);function i(e){const{theme:t,isInHomeWidget:n}=e;return{display:"flex",alignItems:"center",fontSize:14,padding:6,...n?{height:24,width:24,color:t.lightTextColor,fill:t.lightIconColor}:{height:28,width:28,color:t.mediumIconColor,fill:t.mediumIconColor},fontWeight:o().Ue.regular,lineHeight:1,borderRadius:6}}function r(e){const{theme:t}=e;return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:t.mediumIconColor,fontWeight:o().Ue.regular,lineHeight:1,borderRadius:4}}},336795:(e,t,n)=>{n.r(t),n.d(t,{pauseTranscription:()=>I,runSummarization:()=>A,setToggleState:()=>w,startTranscribingBlockOnPage:()=>R,startTranscription:()=>k,stopTranscription:()=>C,updatePreferredSummarizationFormat:()=>j});n(492176),n(7961);var o=()=>n(730120),i=()=>n(803021),r=()=>n(874459),a=()=>n(998411),s=()=>n(396136),c=()=>n(989478),l=()=>n(955620),d=()=>n(342792),u=()=>n(959137),f=()=>n(421654),p=()=>n(332542),m=()=>n(970105),g=()=>n(269299),h=()=>n(254940),y=()=>n(298721),v=()=>n(964433),b=()=>n(876822),S=()=>n(852559),x=()=>n(648587),_=()=>n(874023);function w(e){const{blockId:t,state:n}=e;x().i.setOpen(t,n)}function k(e){var t;const{environment:n,blockStore:s,transaction:d}=e;x().i.setCurrentlyListeningBlockId(s.id),x().i.setSettingsOpenForBlockId(void 0);const u=s.getContentStores().at(-1)??s;_().DictationManager.startDictation({environment:n,blockStore:u,from:"transcription_block",preCreateDictationBlock:!0});const p=null===(t=b().default.state.currentUserStore)||void 0===t?void 0:t.id;if(!p)return;const h=s.getBlockTitleStore(),y=e=>{const t=o().ou.now(),d=[l().YCD(l().pZr({type:"datetime",start_date:t.toFormat(r().Iq),start_time:t.toFormat(i().jK),time_zone:(0,a().r)(),date_format:"relative"}))];m().sO({environment:n,store:h,value:d,transaction:e}),f().FH({stores:[s],update:{transcription_state:{state:"transcribing",transcriber_id:p,transcriber_table:c().KJ}},transaction:e})};d&&!d.committed?y(d):g().createAndCommit({userAction:"transcriptionBlockActions.initializeTitle",environment:n,canUndo:!0,perform:y})}async function C(e){await T({...e,state:{state:"idle"}})}async function I(e){await T({...e,disableSummarization:!0,state:{state:"paused"}})}async function T(e){const{environment:t,blockStore:n,state:o,disableSummarization:i}=e;x().i.setCurrentlyListeningBlockId(void 0),x().i.setSettingsOpenForBlockId(void 0),E({environment:t,blockStore:n,state:o}),_().DictationManager.stopDictation({environment:t,from:"transcription_block"}),i||await A({environment:t,blockStore:n})}async function A(e){const{environment:t,blockStore:n}=e;if(!b().default.state.mainEditorCurrentBlockStore)return;const o=n.pointer.spaceId;if(!o)return;const i=n.getParentStore();if((null==i?void 0:i.table)!==s().iU)return;let r=n;E({environment:t,blockStore:n,state:{state:"summarizing"}}),M({environment:t,blockStore:n});const a={...n.pointer,spaceId:o},c=await v().p.load(),l=await u().F.clipboardActions.load();await(0,y()._O)({environment:t,onResponse:e=>{if("summarize-transcript-response"!==e.type)return;M({environment:t,blockStore:n});const o=e.response;g().createAndCommit({userAction:"transcriptionBlockActions.summarizeTranscript",environment:t,canUndo:!0,perform:e=>{const a=l.markdownToBlocks({environment:t,text:o,inMemoryRecordCache:n.inMemoryRecordCache,transaction:e,markdownOptions:{},markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:void 0});if(a){(0,h().postProcessAICreatedStores)(t,a),f().FH({stores:a,update:{created_by_transcription_block_id:n.id},transaction:e});for(const t of a)p().jG({childStore:t,parentStore:i,transaction:e,after:r.id}),r=t}}})},data:{transcript:[{id:(0,d().ZP)(),type:"config",value:{type:"summarize-transcript",transcriptPointer:a}},{id:(0,d().ZP)(),type:"summarize-transcript"}],traceId:(0,d().ZP)(),spaceId:o,generateTitle:!1},upsellFrom:"transcription_block"}),E({environment:t,blockStore:n,state:{state:"idle"}})}function M(e){const{environment:t,blockStore:n}=e,o=(0,S().Sn)({blockStore:n});o.length>0&&g().createAndCommit({userAction:"transcriptionBlockActions.deletePreviousSummarizationBlocks",environment:t,canUndo:!0,perform:e=>{for(const t of o){const n=t.getParentStore();(null==n?void 0:n.table)===s().iU&&p().hr({childStore:t,parentStore:n,transaction:e})}}})}function R(e){const{environment:t}=e,n=b().default.state.mainEditorCurrentBlockStore;if(!n)return;const o=(0,S().mH)(n);o.sort(((e,t)=>t.getCreatedTime()-e.getCreatedTime()));const i=o[0];i&&k({environment:t,blockStore:i})}async function j(e){var t;const{environment:n,blockStore:o,format:i}=e;if((null===(t=o.getFormat())||void 0===t?void 0:t.transcription_summarization_format_type)===i)return;g().createAndCommit({userAction:"transcriptionBlockActions.updatePreferredSummarizationFormat",environment:n,canUndo:!0,perform:e=>{f().FH({stores:[o],update:{transcription_summarization_format_type:i},transaction:e})}});(0,S().Sn)({blockStore:o}).length>0&&await A({environment:n,blockStore:o})}function E(e){const{environment:t,blockStore:n,state:o}=e;g().createAndCommit({userAction:"transcriptionBlockActions.setTranscriptionState",environment:t,canUndo:!0,perform:e=>{f().FH({stores:[n],update:{transcription_state:o},transaction:e})}})}},492961:(e,t,n)=>{n.d(t,{h:()=>y});n(670560),n(409045),n(453627),n(994774),n(995194),n(520522),n(200082),n(379976),n(724224),n(761121),n(637133),n(267602),n(241792),n(731107);var o=n(667294),i=()=>n(142735),r=()=>n(846550),a=()=>n(283444),s=()=>n(201741),c=()=>n(360666),l=n(785893);const d=50,u=7e3,f=(d+u)/2,p=(d+f)/2,m=(f+u)/2,g=1.5,h=1.3;function y(e){const{fillWidth:t=!1,forceRender:n=!1}=e,f=(0,i().VK)((()=>s().default.state.audioRecorder),[]),y=(0,i().Kw)(c().Z),v=(0,o.useRef)(null),[b,S]=(0,o.useState)(8),[x,_]=(0,o.useState)([]),w=t?2*g:g,k=t?3*h:h;(0,o.useEffect)((()=>{if(!t||!f&&!n)return;const e=()=>{if(v.current){const e=v.current.clientWidth,t=w+k,n=Math.max(1,Math.floor(e/t));S(n),_(new Array(n).fill(1))}};e();const o=new ResizeObserver(e);return v.current&&o.observe(v.current),()=>o.disconnect()}),[f,t,w,k,n]),(0,o.useEffect)((()=>{if(f&&y){const e=new AbortController,t=e.signal,n=()=>{const{mediaStream:e}=f;if(e){const n=y.createAnalyser();n.fftSize=2048;const o=(()=>{const t=y.createMediaStreamSource(e),o=y.createBiquadFilter();o.type="highpass",o.frequency.setValueAtTime(p,y.currentTime);const i=y.createBiquadFilter();return i.type="lowpass",i.frequency.setValueAtTime(m,y.currentTime),[t,o,i,n]})();for(let e=0;e<o.length-1;e++)o[e].connect(o[e+1]);const i=()=>{for(const e of o)e.disconnect()};y.resume();const r=new Uint8Array(n.frequencyBinCount),a=()=>{if(t.aborted)return void i();n.getByteFrequencyData(r);const e=y.sampleRate/2/n.frequencyBinCount,o=Math.round(d/e),s=Math.round(u/e),c=r.slice(o,s+1),l=Math.floor(c.length/b),f=[];for(let t=0;t<b;t++){const e=c.slice(t*l,t<b-1?(t+1)*l:c.length+1),n=e.reduce(((e,t)=>e+t),0)/e.length,o=Math.max(3,Math.min(12,n/3));f.push(o)}_(f),requestAnimationFrame(a)},s=requestAnimationFrame(a);return()=>{cancelAnimationFrame(s),i()}}};let o=n();const i=()=>{"function"==typeof o&&o(),o=n()};return f.emitter.on(a().oF,i),()=>{f.emitter.off(a().oF,i),"function"==typeof o&&o(),e.abort()}}n&&_(new Array(b).fill(3))}),[f,b,y,n]);const C=(0,r().yK)((e=>({barStyle:{flexShrink:0,bottom:"0",width:`${w}px`,backgroundColor:e.icon.secondary,borderRadius:t?"4px":"1px"}})),[w,t]);return f||n?(0,l.jsx)("div",{ref:v,style:{height:"20px",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",gap:k,flex:t?1:void 0},children:x.map(((e,t)=>(0,l.jsx)("div",{style:{...C.barStyle,height:`${e}px`}},t)))}):(0,l.jsx)("div",{style:{fontSize:"8px",width:t?"100%":void 0},children:"No audio"})}},124333:(e,t,n)=>{n.d(t,{l:()=>I,$:()=>C});n(241792);var o=n(667294),i=()=>n(219727),r=()=>n(142735),a=()=>n(846550),s=()=>n(429600),c=()=>n(456681),l=()=>n(235605),d=()=>n(707513),u=()=>n(265640),f=()=>n(827973),p=()=>n(448419),m=()=>n(255577),g=()=>n(388284),h=()=>n(442531),y=()=>n(677559),v=()=>n(385485),b=()=>n(452701),S=()=>n(354986),x=()=>n(761588),_=()=>n(247724),w=n(785893);function k(e){const t=(0,i().O7)(),{parent:n}=e,o=(0,r().VK)((()=>Object.keys(x().jH).indexOf((0,S()._A)(t.currentUser.id))),[t.currentUser.id]),a=[{key:"languages",render:e=>(0,w.jsx)(g().Z,{...e,topBorder:0!==e.index}),items:(0,S().TG)().map((e=>{let[o,[i]]=e;const r={key:o,render:e=>(0,w.jsx)(f().Z,{...e,title:i}),action:()=>{(0,S().Yg)(t,o),n.close()}};return r}))}];return(0,w.jsx)("div",{className:_().tXr,style:{display:"flex",flexDirection:"column",width:150},children:(0,w.jsx)(m().ZP,{type:m().iW.Vertical,initialFocus:o,sections:a})})}function C(e){const{languagePopupStore:t}=e,n=(0,i().O7)(),l=(0,r().VK)((()=>(0,S()._A)(n.currentUser.id)),[n.currentUser.id]);(0,o.useEffect)((()=>{v().ZP.updateMediaDevices()}),[]);const f=(0,a().yK)((e=>({container:{padding:"8px 0px",display:"flex",flexDirection:"column",alignItems:"flex-start",width:300,gap:8},microphoneText:{marginLeft:12,fontSize:12,fontWeight:d().Ue.medium,color:e.text.secondary},microphoneSection:{display:"flex",flexDirection:"column",width:"100%"},languageText:{fontSize:14,color:e.text.primary},languageSection:{padding:"0px 14px",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},rightChevronStyle:{width:13,height:13,opacity:.5,color:e.icon.secondary},line:{width:"100%",height:1,backgroundColor:e.icon.tertiary,opacity:.3},languageButtonStyle:{fontSize:14,display:"flex",alignItems:"center",gap:10,color:e.text.secondary},helpSection:{padding:"5px 14px",display:"flex",alignItems:"center",justifyContent:"flex-start",gap:4,cursor:"pointer"},helpText:{fontSize:12,color:e.text.tertiary},helpIcon:{width:16,height:16,color:e.icon.tertiary}})),[]),m=(0,o.useMemo)((()=>(0,s().o)(f.rightChevronStyle)),[f.rightChevronStyle]),g=(0,o.useMemo)((()=>(0,c().m)(f.helpIcon)),[f.helpIcon]),{value:b}=(0,y().XJ)(h().io);if(!b)return null;const{motion:x}=b;return(0,w.jsxs)("div",{style:f.container,children:[(0,w.jsxs)("div",{style:f.microphoneSection,children:[(0,w.jsx)("div",{style:f.microphoneText,children:"Microphone"}),(0,w.jsx)(I,{})]}),(0,w.jsx)("div",{style:f.line}),(0,w.jsxs)("div",{style:f.languageSection,children:[(0,w.jsx)("div",{style:f.languageText,children:"Language"}),(0,w.jsx)(p().ZP,{buttonPopupStore:t,renderOrigin:e=>(0,w.jsxs)(u().D,{style:f.languageButtonStyle,...e,children:[l," ",m]}),stopClickPropagation:!0,popupType:p().Z4.Popup,render:e=>(0,w.jsx)(k,{parent:e})})]}),(0,w.jsx)("div",{style:f.line}),(0,w.jsxs)(x.div,{style:f.helpSection,onClick:()=>window.open("https://www.notion.so/help/audio-dictation","_blank"),variants:{hover:{opacity:.6},tap:{opacity:1}},whileHover:"hover",whileTap:"tap",transition:{duration:.2},children:[g,(0,w.jsx)("div",{style:f.helpText,children:"Learn about Dictation"})]})]})}function I(){const e=(0,r().Kw)(v().UR),t=(0,r().Kw)(v().TZ),n=(0,r().VK)((()=>e.findIndex((e=>e.deviceId===(null==t?void 0:t.deviceId)))),[e,t]),o=[{key:"devices",render:e=>(0,w.jsx)(g().Z,{...e,topBorder:0!==e.index}),items:e.map((e=>({key:e.deviceId,render:n=>(0,w.jsx)(f().Z,{...n,title:e.label,right:e.deviceId===(null==t?void 0:t.deviceId)?(0,l().k)({width:14,height:14}):void 0}),action:()=>{b().Z.setState(e)}})))}];return(0,w.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:(0,w.jsx)(m().ZP,{type:m().iW.Vertical,initialFocus:n,sections:o})})}},360372:(e,t,n)=>{n.r(t),n.d(t,{DictationAvatar:()=>x,DictationBubble:()=>j,StopDictationButton:()=>V,StopDictationButtonMobile:()=>oe,StopDictationListener:()=>le,dictationActions:()=>o(),hooks:()=>r(),transcriptionBlockActions:()=>i()});var o=()=>n(874023),i=()=>n(336795),r=()=>n(693026),a=n(667294),s=()=>n(142735),c=()=>n(442531),l=()=>n(677559),d=()=>n(201741),u=()=>n(219727),f=()=>n(846550),p=()=>n(788860),m=()=>n(844085),g=()=>n(576917),h=()=>n(154186),y=()=>n(654133),v=()=>n(259878),b=n(785893);const S=18;function x(e){let{enableClickToScroll:t=!1,rootStore:n,noMarginRight:o=!1,noOutline:i=!1,noTooltip:c=!1}=e;const l=(0,r().useIsDictatingToPage)(n),x=(0,u().O7)(),_=(0,a.useCallback)((e=>e.UIUserAvatarSelfBorder),[]),w=(0,v().dY)(_,!0),k=(0,f().yK)((e=>({tooltip:{color:e.mediumInvertedTextColor,minWidth:150,paddingTop:2,paddingBottom:2,lineHeight:1.3},avatarContainer:{width:S,height:S,borderRadius:S,backgroundColor:e.assistantCornerButtonBackground,display:"flex",alignItems:"center",justifyContent:"center"}})),[]),C=(0,s().VK)((()=>d().CX.state),[]);return!l&&n?null:(0,b.jsx)(y().Z,{textWrap:!0,disableTooltip:c,renderTooltip:()=>(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{children:(0,b.jsx)(p()._H,{defaultMessage:"Transcribing your words",id:"topbar.presenceIndicator.dictation.tooltip.description"})}),(0,b.jsx)("div",{style:k.tooltip,children:(0,b.jsx)(p()._H,{defaultMessage:"Click to see where",id:"topbar.presenceIndicator.dictation.tooltip.action"})})]}),render:e=>{const n=(0,b.jsx)("div",{style:{...w.avatarOuterOutline,...i?{outline:"none"}:{},...o?{marginRight:0}:{},width:S,height:S},children:(0,b.jsx)("div",{style:{...w.avatarBorder,...k.avatarContainer},children:(0,b.jsx)(g().P,{variant:"avatar",wrapWithPadding:!1,shadowVariant:"none"})})});return t&&C?(0,b.jsx)(h().Z,{...e,onClick:()=>m().hl([C],!0,x),style:w.button,hoveredStyle:w.buttonHovered,pressedStyle:w.buttonPressed,children:n}):(0,b.jsx)("div",{...e,style:{cursor:"default"},children:n})}})}n(670560),n(267602),n(30005);var _=()=>n(492522),w=()=>n(696459),k=()=>n(30840),C=()=>n(333264);function I(e){let t=[];return e.nodeType===Node.TEXT_NODE?t.push(e):e.childNodes.forEach((e=>{t=t.concat(I(e))})),t}function T(e){let{scrollerStore:t,children:n,framerMotion:o}=e;const i=(0,s().Kw)(d().CX),r=(0,s().VK)((()=>t.state.elementRef??{current:null}),[t]),c=(0,C().j)(r),[l,u]=(0,a.useState)(),[f,p]=(0,a.useState)(),m=(0,k().Si)(t),g=(0,k().nA)(t),h=null==m?void 0:m.getNode(),y=null==h?void 0:h.querySelector(".notion-page-content"),v=null==y?void 0:y.querySelector(`[data-block-id="${i}"]`);(0,a.useEffect)((()=>{d().default.setState({...d().default.state,dictationBubbleScrollPosition:null==f?void 0:f.top})}),[f]),(0,a.useEffect)((()=>{if(y){let e;const t=new MutationObserver((t=>{(0,w().$K)(e)&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>u(Date.now())))}));return t.observe(y,{subtree:!0,characterData:!0,childList:!0}),()=>{t.disconnect(),(0,w().$K)(e)&&cancelAnimationFrame(e)}}}),[y]),(0,a.useEffect)((()=>{if(h){let e;const t=new ResizeObserver((()=>{(0,w().$K)(e)&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>u(Date.now())))}));return t.observe(h),()=>{t.disconnect(),(0,w().$K)(e)&&cancelAnimationFrame(e)}}}),[h]),(0,a.useLayoutEffect)((()=>{if(!v||!h){const e=setTimeout((()=>{p(void 0)}),200);return()=>{clearTimeout(e)}}{const e=document.createRange(),t=v.querySelector('[data-content-editable-leaf="true"]')??v,n=I(t),o=h.getBoundingClientRect();if(n.length>0){const t=n[n.length-1];e.selectNodeContents(t),e.collapse(!1);const i=e.getBoundingClientRect(),r=i.top+c-o.top,a=i.right-o.left+5;p({top:r,left:a})}else{const e=t.getBoundingClientRect(),n=window.getComputedStyle(t),i=parseInt(n.paddingTop,10),r=isNaN(i)?0:i,a=parseInt(n.paddingBottom,10),s=isNaN(a)?0:a,l=parseInt(n.paddingRight,10),d=isNaN(l)?0:l,u=e.top+r+s+c-o.top,f=e.left-o.left+d+5;p({top:u,left:f})}}}),[v,h,l,c]);const S=(0,w().$K)(f);(0,a.useEffect)((()=>{if(g&&S)switch(g){case"Page":return d().default.setState({...d().default.state,blockRenderedInPage:!0}),()=>{d().default.setState({...d().default.state,blockRenderedInPage:!1})};case"PeekView":return d().default.setState({...d().default.state,blockRenderedInPeekView:!0}),()=>{d().default.setState({...d().default.state,blockRenderedInPeekView:!1})}}}),[g,S]);const x=(0,a.useRef)(null);(0,a.useEffect)((()=>{if(!f||!x.current)return;const e=new IntersectionObserver((e=>{const[t]=e;let n;n=t.isIntersecting?"inScreen":t.boundingClientRect.top<0?"above":"below",d().default.setState({...d().default.state,dictationBubbleRelativeToScreen:n})}),{root:h,rootMargin:"0px",threshold:[0,1]});x.current&&e.observe(x.current);const t=x.current;return()=>{t&&e.unobserve(t)}}),[h,f]);const{motion:T}=o;return f?(0,b.jsx)(T.div,{ref:x,initial:{transform:`translate(${f.left}px, ${f.top}px)`},animate:{transform:`translate(${f.left}px, ${f.top}px)`},transition:{duration:.2},style:{display:"block",position:"absolute",top:0,left:3,width:0,height:0,zIndex:_().lB-1},children:n}):null}function A(e){const{value:t}=(0,l().XJ)(c().io);return t?(0,b.jsx)(T,{...e,framerMotion:t}):null}n(241792);function M(e){const{framerMotion:t}=e,{motion:n}=t,o=(0,c()._7)(t);(0,a.useEffect)((()=>{(async()=>{await o.start((e=>({y:[0,-7,0],transition:{duration:.6,delay:.15*e,repeat:1/0,repeatDelay:1,ease:"easeInOut"}})))})()}),[o]);const i=(0,f().yK)((e=>({dotStyle:{width:6,height:6,flexShrink:0,backgroundColor:e.icon.quaternary,borderRadius:"50%"}})),[]);return(0,b.jsx)(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},style:{display:"flex",justifyContent:"center",alignItems:"center",gap:3},children:[...Array(3)].map(((e,t)=>(0,b.jsx)(n.div,{custom:t,animate:o,style:i.dotStyle},t)))})}function R(){const{value:e}=(0,l().XJ)(c().io);return e?(0,b.jsx)(M,{framerMotion:e}):null}function j(e){let{scrollerStore:t}=e;const n=(0,s().Kw)(d().TI),o=(0,s().Kw)(d().dg),{value:i}=(0,l().XJ)(c().io);if(!i)return null;const{AnimatePresence:r}=i;return n?(0,b.jsx)(A,{scrollerStore:t,children:(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,b.jsx)(x,{noMarginRight:!0,noOutline:!0,noTooltip:!0}),(0,b.jsx)(r,{children:o&&(0,b.jsx)(R,{})})]})}):null}var E=n(973935),B=()=>n(414294),D=()=>n(745740),F=()=>n(448419),P=()=>n(45909),K=()=>n(154057),z=()=>n(529048),O=()=>n(725751),L=()=>n(482162),N=()=>n(492961),U=()=>n(124333);const q=document.body;function Z(e){let{rootStore:t,framerMotion:n}=e;const i=(0,u().MO)(),c=(0,r().useIsDictatingToPage)(t),l=(0,u().O7)(),p=(0,s().VK)((()=>d().default.state.audioRecorder),[]),m=(0,s().qz)(void 0,z().Z),g=(0,s().qz)(void 0,z().Z),h=(0,s().VK)((()=>Boolean(O().default.state.isShowingTabBar)),[]),y=(0,a.useCallback)((()=>{(0,o().stopDictation)({environment:l,from:"button"})}),[l]),S=(0,a.useCallback)((e=>{null==e||e.stopPropagation(),e&&(0,K().uG)(e)||(g.state.open?g.reset():m.state.open?m.reset():m.setState({...m.state,open:!0}))}),[m,g]),x=(0,s().VK)((()=>"dark"===l.ThemeStore.state.mode),[l]),[w,k]=(0,a.useState)(!1),C=(0,a.useCallback)((()=>{k(!0)}),[]),I=(0,a.useCallback)((()=>{k(!1)}),[]),[T,A]=(0,a.useState)(!1),M=(0,a.useCallback)((()=>{A(!0)}),[]),R=(0,a.useCallback)((()=>{A(!1)}),[]),j=(0,f().yK)((e=>({dictationButtonStyle:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:25,gap:2,height:24,cursor:"pointer",padding:"6px 2px 6px 2px",backgroundColor:x?"#2D2D2D":"#F1F0EF",...(0,P().X)({noDrag:l.device.isElectron&&!h})},downChevronContainer:{display:"flex",alignItems:"center",justifyContent:"center",height:20,width:20,borderRadius:20},downIcon:{fill:T?e.icon.secondary:e.icon.tertiary,width:10,height:10},redSquare:{width:10,height:10,borderRadius:2,backgroundColor:w?x?e.accentColors.red[500]:"rgba(191, 67, 64, 1)":x?e.accentColors.red[700]:e.accentColors.red[500]},redSquareContainer:{width:20,height:20,borderRadius:20,display:"flex",alignItems:"center",justifyContent:"center"}})),[x,l.device.isElectron,h,T,w]),Z=(0,a.useMemo)((()=>(0,B().E)(j.downIcon)),[j.downIcon]),V=(0,s().VK)((()=>{var e;return L().default.isCenterPeekOpen()&&(null===(e=L().default.peekTargetStore.state)||void 0===e?void 0:e.id)!==(null==t?void 0:t.id)}),[null==t?void 0:t.id]),H=(0,a.useRef)(null),[W,$]=(0,a.useState)(null);(0,a.useEffect)((()=>{if(!H.current)return void $(null);const e=H.current.getBoundingClientRect();$({top:e.top+window.scrollY,left:e.left+window.scrollX})}),[V]);const X=(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(D().Z,{style:j.redSquareContainer,onClick:y,onMouseEnter:C,onMouseLeave:I,children:(0,b.jsx)("div",{style:j.redSquare})}),(0,b.jsx)(N().h,{}),(0,b.jsx)(D().Z,{className:"notion-dictation-button-up-chevron",style:j.downChevronContainer,onClick:S,onMouseEnter:M,onMouseLeave:R,children:Z})]}),Y=(0,v().qh)({environment:l,isShowingTabBar:h,isShowingInPostFeed:!1}),{motion:J}=n;return c&&p&&!i?(0,b.jsx)("div",{style:{marginLeft:Y.marginLeft,marginTop:Y.marginTop,marginRight:.5*Number(Y.marginLeft)*-1},children:(0,b.jsx)(F().ZP,{buttonPopupStore:m,renderOrigin:()=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(J.div,{ref:H,className:"notion-dictation-button",style:j.dictationButtonStyle,onClick:y,initial:{opacity:0,x:15},animate:{opacity:1,x:0},transition:{duration:.4},children:X}),V&&(0,E.createPortal)((0,b.jsx)("div",{className:"notion-dictation-button-duplicate",style:{...j.dictationButtonStyle,position:"fixed",top:(null==W?void 0:W.top)||0,left:(null==W?void 0:W.left)||0,zIndex:_().Wd+1},onClick:y,children:X}),q)]}),stopClickPropagation:!0,popupType:l.device.isMobile?F().Z4.SlideUp:F().Z4.Popup,popupWrapStyle:{top:6},render:()=>(0,b.jsx)(U().$,{languagePopupStore:g})})}):null}function V(e){const{value:t}=(0,l().XJ)(c().io);return t?(0,b.jsx)(Z,{...e,framerMotion:t}):null}n(409045),n(453627),n(994774),n(995194),n(520522),n(200082),n(379976),n(724224),n(761121),n(637133);const H=(0,n(827282).IU)("stopDictation",{viewBox:"0 0 36 36",svg:(0,b.jsxs)("svg",{width:"36",height:"36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,b.jsx)("rect",{width:"36",height:"36",rx:"18",fill:"#D34F43",fillOpacity:".1"}),(0,b.jsx)("path",{d:"M12.2 21.7v-8.3c0-.5.2-.9.5-1.2.3-.3.7-.4 1.2-.4h8.2c.5 0 .9.1 1.2.4.3.3.5.7.5 1.2v8.3c0 .5-.2.9-.5 1.2-.3.3-.7.4-1.2.4h-8.2c-.5 0-1-.1-1.2-.4-.3-.3-.5-.7-.5-1.2Z",fill:"#D44C47"})]})});var W=()=>n(236029),$=()=>n(76225),X=()=>n(707138),Y=()=>n(749826),J=()=>n(369320),G=()=>n(105381),Q=()=>n(283444),ee=()=>n(317924),te=()=>n(553848);var ne=()=>n(360666);function oe(){const e=(0,u().O7)(),{isMobileNative:t,isPhone:n}=(0,u().Fy)(),i=(0,s().VK)((()=>{const e=X().default.state.isOnboarding,t=G().Z.state.open,n=J().Z.hasOpenPopups();return e||t||n}),[]),r=(0,s().VK)((()=>!i&&d().default.getState().enabled&&!d().default.getState().loading),[i]),c=(0,a.useCallback)((()=>{(0,o().stopDictation)({environment:e,from:"mobile_bar_button"})}),[e]);return(0,a.useEffect)((()=>{i&&c()}),[i,c]),function(e){const t=(0,s().Kw)(te().Z);(0,a.useEffect)((()=>{t&&(e(),te().Z.reset())}),[t,e])}(c),function(e){const t=(0,u().O7)(),n=(0,s().VK)((()=>{const e=d().P7.state;if(e)return!e.isDictatableBlock()||e.pathIsDead()}),[]),o=(0,s().VK)((()=>!d().w7.state),[]),i=(0,a.useRef)(!0),r=(0,s().VK)((()=>(0,ee().w_)(t.TabbedRouterStore.state)),[t]);(0,a.useEffect)((()=>{(0,w().$K)(n)&&n&&e()}),[n,e]),(0,a.useEffect)((()=>{if(o){const t=setTimeout((()=>{e()}),250);return()=>{clearTimeout(t)}}}),[o,e]),(0,a.useEffect)((()=>{t.device.isMobileNative&&r&&(i.current?i.current=!1:e())}),[t,r,i,e])}(c),r&&t&&n?(0,b.jsx)(ie,{handleClick:c}):null}function ie(e){const{handleClick:t}=e,n=(0,u().O7)(),o=(0,W().Z)(!0);!function(){const{mobileNative:e}=(0,u().O7)();(0,a.useEffect)((()=>(null==e||e.requestKeepScreenOn(!0),()=>{null==e||e.requestKeepScreenOn(!1)})),[e])}();const i=(0,$().Ij)(),[r,c]=(0,s().VK)((()=>[n.WindowSizeStore.getSafePaddingLeftPx(16),n.WindowSizeStore.getSafePaddingRightPx(16)]),[n.WindowSizeStore]),l=(0,f().yK)((e=>({container:{position:"absolute",width:"100%",bottom:i,minHeight:50,paddingTop:"6px",paddingBottom:"6px",paddingRight:c,paddingLeft:r,border:`1px solid ${e.stroke.secondary}`,background:e.contentBackground},dictationButtonStyle:{display:"flex",justifyContent:"space-between",verticalAlign:"center",cursor:"pointer",gridAutoFlow:"column",placeItems:"center",gap:10,alignItems:"center"},icon:{color:e.redBadgeBackground},settingsContainer:{display:"flex",alignItems:"center",justifyContent:"center",height:25,width:25,borderRadius:25},settingsContainerHoveredStyle:{background:e.whiteButtonPressedBackground}})),[i,r,c]),d=(0,a.useMemo)((()=>H({width:36,height:36,...l.icon})),[l.icon]);return(0,b.jsx)("div",{style:{...l.container,zIndex:_().Wd+1},...o,children:(0,b.jsxs)("div",{className:"notion-dictation-button",style:{...l.dictationButtonStyle},children:[(0,b.jsx)("div",{style:{flexGrow:1,maxWidth:36}}),(0,b.jsx)("div",{style:{maxWidth:480,width:"100%",justifyContent:"center",display:"flex",verticalAlign:"middle"},children:(0,b.jsx)(re,{})}),(0,b.jsx)("div",{onClick:t,children:d})]})})}function re(){const e=(0,s().VK)((()=>d().default.state.audioRecorder),[]),t=(0,s().Kw)(ne().Z),n=(0,s().VK)((()=>({lowshelf_filter_frequency:Y().default.getConfigKey("mobile_dictation_visualizer","lowshelf_filter_frequency"),lowshelf_filter_gain:Y().default.getConfigKey("mobile_dictation_visualizer","lowshelf_filter_gain"),fft_size:Y().default.getConfigKey("mobile_dictation_visualizer","fft_size"),trim_threshold:Y().default.getConfigKey("mobile_dictation_visualizer","trim_threshold"),min_hz:Y().default.getConfigKey("mobile_dictation_visualizer","min_hz"),max_hz:Y().default.getConfigKey("mobile_dictation_visualizer","max_hz")})),[]),o=(0,a.useRef)(null);return(0,a.useEffect)((()=>{if(e&&t){const i=new AbortController,r=i.signal,a=()=>{const{mediaStream:i}=e;if(i){const e=t.createMediaStreamSource(i),a=t.createBiquadFilter();a.type="lowshelf",a.frequency.setValueAtTime(n.lowshelf_filter_frequency,t.currentTime),a.gain.setValueAtTime(n.lowshelf_filter_gain,t.currentTime);const s=t.createAnalyser();s.fftSize=n.fft_size,e.connect(a),a.connect(s),t.resume();const c=new Uint8Array(s.frequencyBinCount),l=()=>{if(r.aborted)return e.disconnect(),void a.disconnect();s.getByteFrequencyData(c);const i=t.sampleRate/2/s.frequencyBinCount,u=n.min_hz??0,f=n.max_hz?Math.round(n.max_hz/i):c.length,p=c.slice(u,f),m=o.current,g=null==m?void 0:m.getContext("2d");if(m&&g){const e=window.devicePixelRatio||1,t=m.getBoundingClientRect();m.width=t.width*e,m.height=t.height*e,g.scale(e,e);const o=4;m.height=30*o;const i=m.width,r=m.height,a=1*o;g.clearRect(0,0,i,r);const s=i/(a+o),c=Math.min(1,p.length/s);let l=0;for(let d=0;d<p.length;d++){const e=p[d*c],t=.05*Math.random(),s=(null==n?void 0:n.trim_threshold)??40,u=(Math.max(e,s)-s)/(255-s),f=Math.max(.05,u>0?u+t:0)*r;if(g.fillStyle="rgb(128,128,128)",l+a<=i&&g.fillRect(l,r/2-f/2,a,f),l+=a+o,l>=i)break}}d=requestAnimationFrame(l)};let d=requestAnimationFrame(l);return()=>{cancelAnimationFrame(d),e.disconnect(),a.disconnect()}}};let s=a();const c=()=>{"function"==typeof s&&s(),s=a()};return e.emitter.on(Q().oF,c),()=>{e.emitter.off(Q().oF,c),"function"==typeof s&&s(),i.abort()}}}),[e,t,n]),e?(0,b.jsx)("canvas",{ref:o,style:{width:"100%",height:30}}):(0,b.jsx)("div",{style:{fontSize:8},children:"No audio recorder available"})}n(470928);var ae=()=>n(156642),se=()=>n(396136),ce=()=>n(239482);function le(){const e=(0,u().O7)(),t=(0,s().VK)((()=>{const e=d().P7.state;if(!e)return;return(0,ce().eG)(e).find((e=>e.table===se().iU&&e.getType()===ae().Ti.transcription))}),[]),n=(0,s().VK)((()=>{const e=d().P7.state;if(e)return!e.isDictatableBlock()||e.pathIsDead()}),[]),r=(0,s().VK)((()=>!d().w7.state),[]);return(0,a.useEffect)((()=>{(0,w().$K)(n)&&n&&((0,o().stopDictation)({environment:e,from:"block_not_dictatable"}),t&&(0,i().stopTranscription)({environment:e,blockStore:t,disableSummarization:!0}))}),[n,e,t]),(0,a.useEffect)((()=>{if(r&&!t){const t=setTimeout((()=>{(0,o().stopDictation)({environment:e,from:"block_not_visible"})}),350);return()=>{clearTimeout(t)}}}),[r,t,e]),null}},852559:(e,t,n)=>{n.d(t,{MT:()=>i,Sn:()=>a,mH:()=>r,rU:()=>s});n(670560),n(267602),n(653476);var o=()=>n(852465);function i(e){const t=e.getContentStores().filter((e=>!e.isEmptyTitle()||e.hasContent()));return t.length>0}function r(e,t){const n=t??[];e.isType("transcription")&&n.push(e);const o=e.getContentStores();for(const i of o)r(i,n);return n}function a(e){const t=[];for(const n of c({blockStore:e.blockStore}))t.push(n);return t}function s(e){for(const t of c({blockStore:e.blockStore}))return!0;return!1}function*c(e){const{blockStore:t}=e,n=t.getNavigableBlockStore();if(!n)return;const i=(0,o().MI)({blockStore:n,transclusionReferences:"omit",childPages:"omit"});for(const o of i){const e=o.getFormatStore();(null==e?void 0:e.getKeyValue("created_by_transcription_block_id"))===t.id&&(yield o)}}},360666:(e,t,n)=>{n.d(t,{Z:()=>i});class o extends(()=>n(263184))().default{constructor(){super()}getInitialState(){}setState(e){this.instanceState&&this.instanceState.close(),super.setState(e)}addListener(e){super.addListener(e),this.instanceState||this.setState((0,n(982774).k)(24e3))}removeListener(e){super.removeListener(e),0===this.listenerCount()&&this.setState(void 0)}}const i=new o},648587:(e,t,n)=>{n.d(t,{i:()=>i});class o extends(()=>n(263184))().default{getInitialState(){return{toggleMap:{},currentlyListeningBlockId:void 0,settingsOpenForBlockId:void 0}}setOpen(e,t){this.setState({...this.state,toggleMap:{...this.state.toggleMap,[e]:t}})}isOpen(e){return!!this.state.toggleMap[e]}setCurrentlyListeningBlockId(e){this.setState({...this.state,currentlyListeningBlockId:e})}getCurrentlyListeningBlockId(){return this.state.currentlyListeningBlockId}setSettingsOpenForBlockId(e){this.setState({...this.state,settingsOpenForBlockId:e})}isSettingsOpenForBlockId(e){return this.state.settingsOpenForBlockId===e}}const i=new o},974442:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n(263184).default.createValue({open:!1},{name:"ConfirmOverwriteModalStore"})},877727:(e,t,n)=>{n.d(t,{QZ:()=>a,SV:()=>i,mq:()=>r});var o=()=>n(749826);function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o().default.checkGate({gateName:"workflow_templates_settings_dev",disableExposureLogging:e.disableExposureLogging})&&o().default.checkGate({gateName:"packaging_m3.1",disableExposureLogging:e.disableExposureLogging})}function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o().default.checkGate({gateName:"packaging_m3.1",disableExposureLogging:e.disableExposureLogging})}function a(e){return!e.device.isPhone}},999582:(e,t,n)=>{n.d(t,{Z:()=>r});class o extends(()=>n(263184))().default{getInitialState(){return{}}}const i=new o;n(947115).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",i);const r=i},29488:(e,t,n)=>{function o(e){return`${e.table}:${e.id}`}n.d(t,{O:()=>o})},157955:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>M,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>_,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>x,MAX_RECURRENCE_INTERVAL:()=>h,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>y,RRULE_WEEKDAYS_MAP:()=>g,convertFromUnpersistedRecurrenceConfig:()=>B,convertToUnpersistedRecurrenceConfig:()=>R,getFormattedEndCondition:()=>A,getFormattedNextRecurrenceTime:()=>T,getNewEndTimestamp:()=>j,getNextDateUtc:()=>I,getRecurrenceAfter:()=>k,isRunningBetweenMidnightAnd3AM:()=>C,isValidRecurrenceInterval:()=>v,isValidRecurrenceNumberOfRuns:()=>b,rruleFromRecurrence:()=>S,templateAncestorsViolateRecurrenceNesting:()=>w});n(267602),n(653476),n(241792);var o=()=>n(730120);n(670560);function i(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(0===n.length)return e.map((e=>[e]));const r=[];for(const a of e)r.push(...i(n[0],...n.slice(1)).map((e=>[a,...e])));return r}var r=()=>n(696459),a=()=>n(326966),s=()=>n(803021),c=()=>n(646574),l=()=>n(998411),d=()=>n(578292);class u extends(()=>n(484885))().Ci{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var f=()=>n(494616);const p=(0,n(788860).vU)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),m={day:u.DAILY,week:u.WEEKLY,month:u.MONTHLY,year:u.YEARLY},g={MO:u.MO,TU:u.TU,WE:u.WE,TH:u.TH,FR:u.FR,SA:u.SA,SU:u.SU},h=99,y=999;function v(e){return(0,a().hj)(e)&&Number.isInteger(e)&&e>0&&e<=h}function b(e){return(0,a().hj)(e)&&Number.isInteger(e)&&e>0&&e<=y}function S(e){const{start_date:t,frequency:n,interval:o,weekdays:a,timezone:c,hour:l,minute:d}=e,f="week"===n&&a?a.map((e=>g[e])):void 0,p={};return(0,r().$K)(e.end_condition)&&("date"===e.end_condition.type?p.until=(0,s().pd)(e.end_condition.end_at):"number"===e.end_condition.type?p.count=e.end_condition.number_of_occurrences:(0,r().t1)(e.end_condition)),"month"===e.frequency&&(0,r().$K)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?p.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?p.byweekday=i(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return g[t].nth(n)})):(0,r().t1)(e.monthly_restriction)),new u({freq:m[n],dtstart:(0,s().pd)(t),interval:o,byweekday:f,tzid:c,byhour:l??0,byminute:d??0,bysecond:0,...p})}const x=1,_=1;function w(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),o=e.length,i=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,r=o>x,a=n.length>=_;return{violatesConstraint:r||a,templateNestingExceedsMaxDepth:r,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:o,immediateAncestorRecurrenceType:i}}function k(e){const{recurrence:t,afterDate:n}=e;if((0,f().nA)(t)){const e=(0,s().kq)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=S(t).after((0,s().pd)(n));if(!e)return;return(0,s().YL)(e)}}function C(e){return 0===e.hour||1===e.hour||2===e.hour}function I(e){return S(e).after((0,s().pd)((0,s().Jh)()))||void 0}function T(e){const{recurrence:t,intl:n}=e,i=I(B(t));if(!i)return;const r=C(t),a=o().ou.fromJSDate(i).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,d().E2)(n)).setZone(t.timezone),s=(0,c().p6)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(r)return n.formatMessage(p.dateBetweenMidnightAnd3AM,{date:s});{let e=a.toLocaleString(o().ou.TIME_SIMPLE);return t.timezone!==(0,l().r)()&&(e+=` ${a.toFormat("ZZZZ")}`),n.formatMessage(p.dateAtTime,{date:s,time:e})}}function A(e,t){return(0,r().$K)(e)?"number"===e.type?t.formatMessage(p.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,c().p6)({date:o().ou.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,r().t1)(e):t.formatMessage(p.noEndCondition)}const M=100;function R(e){return{...e,start_date:(0,s().kq)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,s().kq)(e.end_condition.end_at)}:(0,r().t1)(e.end_condition):void 0}}function j(e,t,n){return e.plus(n-t)}function E(e,t){const n=o().ou.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,s().Jh)(n.toJSDate())}}function B(e){return{...e,start_date:(0,s().Jh)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?E(e,e.end_condition):(0,r().t1)(e.end_condition):void 0}}},984478:(e,t,n)=>{n.d(t,{f:()=>i});n(667294);var o=n(785893);const i=(0,n(827282).IU)("chevronLeft",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M3.61816 8.06445C3.61816 8.29688 3.70703 8.49512 3.8916 8.67285L9.22363 13.8887C9.36719 14.0391 9.55859 14.1143 9.77734 14.1143C10.2217 14.1143 10.5703 13.7725 10.5703 13.3213C10.5703 13.1025 10.4814 12.9043 10.3311 12.7539L5.52539 8.06445L10.3311 3.375C10.4814 3.21777 10.5703 3.01953 10.5703 2.80078C10.5703 2.35645 10.2217 2.01465 9.77734 2.01465C9.55859 2.01465 9.36719 2.08984 9.22363 2.24023L3.8916 7.45605C3.70703 7.63379 3.625 7.83203 3.61816 8.06445Z"})})}}]);