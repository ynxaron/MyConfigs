"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[31095],{594777:(e,n,t)=>{t.d(n,{U:()=>r});t(241792);var a=()=>t(219727),s=()=>t(142735),o=()=>t(779522);function r(e){const n=(0,a().O7)();return(0,s().VK)((()=>{var t;const a=null==e?void 0:e.id;if(a)return null===(t=o().Z.getData(n,{spaceId:a}))||void 0===t?void 0:t.map((e=>e.domain))}),[n,e])}},779522:(e,n,t)=>{t.d(n,{Z:()=>s});const a=new(t(168469).q)((e=>{let{spaceId:n}=e;return n}),(async function(e,n){var a;let{spaceId:s}=n;const o=await Promise.resolve().then(t.bind(t,824462)),r=await o.callApi({eventName:"getInternalDomains",environment:e,data:{spaceId:s}});return"success"===r.type?null===(a=r.data)||void 0===a?void 0:a.internalDomainsWithInfo:void 0}));t(947115).exposeDebugValue("InternalDomainsStore",a);const s=a},541616:(e,n,t)=>{t.r(n),t.d(n,{DowngradeModal:()=>ae});t(821057),t(241792);var a=t(667294),s=()=>t(146947),o=()=>t(219727),r=()=>t(142735),i=()=>t(846550),d=()=>t(646574),l=()=>t(956057),u=()=>t(629719),c=()=>t(893146),m=()=>t(381348),g=()=>t(681941),p=()=>t(122792),f=()=>t(788860),v=()=>t(513670),w=()=>t(979614),h=()=>t(102182),y=()=>t(661641),x=()=>t(659278),b=()=>t(311988),j=()=>t(212493),M=()=>t(265640),_=()=>t(830581),D=()=>t(661297),P=t(785893);function I(e){const{downgradeProduct:n,excessGuests:t,formattedPeriodEndDate:a,internalDomains:s,spaceStore:o,onClickContinue:i,onClickManageGuests:d}=e,l=(0,f().YB)(),u=(0,r().VK)((()=>o.getName()),[o]),c=l.formatMessage(k[n]);return u&&t.length?(0,P.jsx)(_().sR,{header:(0,P.jsx)(_().vI,{iconAndTitle:(0,P.jsx)(_().kC,{iconGroup:b().x,iconColorName:"redPrimary",title:l.formatMessage(G.title,{planName:c,spaceName:u})}),description:l.formatMessage(G.description,{domain:s[0].url,number:t.length,date:a})}),footer:(0,P.jsx)(S,{onClickContinue:i,onClickManageGuests:d}),children:(0,P.jsx)(N,{excessGuests:t,spaceName:u})}):null}function N(e){const{excessGuests:n,spaceName:t}=e,a=(0,f().YB)(),s=(0,i().yK)((()=>({wrapper:{background:"#FDF5F3",textAlign:"center"}})),[]),o=(0,r().VK)((()=>n.map((e=>e.getKeyStore("given_name").getValue()??e.getDisplayName(a)))),[n,a]);return(0,P.jsx)(j().jX,{align:"top-center",borderRadius:6,direction:"column",gap:10,padding:"14px 12px",style:s.wrapper,width:"fill",children:(0,P.jsxs)(j().jX,{direction:"column",gap:8,align:"top-center",children:[(0,P.jsx)(j().jX,{direction:"row",align:"center",style:{paddingLeft:4},children:o.slice(0,3).map(((e,n)=>(0,P.jsx)(C,{givenName:e},n)))}),(0,P.jsxs)(j().jX,{direction:"column",gap:4,align:"center",children:[(0,P.jsx)(y().q,{colorName:"uiRedPrimary",styleName:"Body-14px/Medium",children:(0,P.jsx)(R,{givenNames:o,spaceName:t})}),(0,P.jsx)(y().q,{colorName:"redPrimary",styleName:"Caption-12px/Regular",children:a.formatMessage(G.recommendation)})]})]})})}function R(e){const{givenNames:n,spaceName:t}=e,a=(0,f().YB)();return 1===n.length?(0,P.jsx)(P.Fragment,{children:a.formatMessage(G.oneRemovedGuest,{name1:n[0],spaceName:t})}):2===n.length?(0,P.jsx)(P.Fragment,{children:a.formatMessage(G.twoRemovedGuests,{name1:n[0],name2:n[1],spaceName:t})}):(0,P.jsx)(P.Fragment,{children:a.formatMessage(G.manyRemovedGuests,{name1:n[0],name2:n[1],count:n.length-2,spaceName:t})})}function C(e){const{givenName:n}=e,t=(0,i().yK)((e=>({circle:{borderRadius:14,border:`1px dashed ${e.stroke.uiRedSecondary}`,background:e.surface.elevated,marginLeft:-4}})),[]);return(0,P.jsx)(j().jX,{style:t.circle,width:28,height:28,align:"center",children:(0,P.jsx)(y().q,{styleName:"Body-14px/Semibold",colorName:"uiRedPrimary",children:(0,x().p4)(n)[0].toUpperCase()})})}function S(e){const{onClickContinue:n,onClickManageGuests:t}=e,a=(0,f().YB)();return(0,P.jsx)(j().jX,{gap:16,children:(0,P.jsxs)(j().jX,{gap:8,align:"center",children:[(0,P.jsx)(D().Z,{"aria-label":a.formatMessage(G.manageGuests),onClick:t,style:{width:"100%"},children:a.formatMessage(G.manageGuests)}),(0,P.jsx)(M().D,{"aria-label":a.formatMessage(G.continueWithDowngrade),onClick:n,style:{justifyContent:"center"},children:(0,P.jsx)(y().q,{colorName:"secondary",children:a.formatMessage(G.continueWithDowngrade)})})]})})}const G=(0,f().vU)({title:{id:"DowngradeWillRemoveGuestsModal.title",defaultMessage:"Downgrading to {planName} will remove guests from {spaceName}"},description:{id:"DowngradeWillRemoveGuestsModal.description",defaultMessage:"{number} of your guests with the email domain ‘@{domain}’ will be removed on {date} to align with your new plan's guest limit"},continueWithDowngrade:{id:"DowngradeWillRemoveGuestsModal.continueWithDowngrade",defaultMessage:"Continue with downgrade"},manageGuests:{id:"DowngradeWillRemoveGuestsModal.manageGuests",defaultMessage:"Manage guests"},manyRemovedGuests:{id:"DowngradeWillRemoveGuestsModal.manyRemovedGuests",defaultMessage:"{name1}, {name2}, and {count, plural, one {1 more guest} other {{count} more guests}} will be removed from {spaceName}"},twoRemovedGuests:{id:"DowngradeWillRemoveGuestsModal.twoRemovedGuests",defaultMessage:"{name1} and {name2} will be removed from {spaceName}"},oneRemovedGuest:{id:"DowngradeWillRemoveGuestsModal.oneRemovedGuest",defaultMessage:"{name1} will be removed from {spaceName}"},recommendation:{id:"DowngradeWillRemoveGuestsModal.recommendation",defaultMessage:"If you want them to retain access, we recommend upgrading them to members."}}),k={business:p().aw.business,enterprise:p().aw.enterprise,free:p().aw.free,personal:p().aw.personal,plus:p().aw.plus,student:p().aw.educationPlus};var T=()=>t(594777),B=()=>t(228772),O=()=>t(591914),K=()=>t(438665),U=()=>t(536155),W=()=>t(548812),F=()=>t(402421),V=()=>t(989478),q=(t(267602),t(653476),()=>t(703976));var A=()=>t(18281);var E=()=>t(779522);const Y=new(t(168469).q)((e=>{let{spaceId:n,inviteeIds:t}=e;return`${n}:${t.sort().join(",")}`}),(async function(e,n){const a=await Promise.resolve().then(t.bind(t,824462)),s=await a.callApi({eventName:"getInvitesForInvitees",environment:e,data:n});return"success"===s.type?s.data.invites.map((e=>t(530980).kk5.fromValue(t(126139).Tu,e))):void 0}));t(947115).exposeDebugValue("InvitesForInviteesStore",Y);const $=Y;var X=()=>t(277533),Z=()=>t(815277),L=()=>t(897257);function H(e){let{space:n,spaceUser:t,desiredState:a}=e;const s=(0,o().O7)(),i=(d=L().subscriptionDataStoreInstance,(0,r().VK)((()=>{const e=d.state;if(e)return(0,A().ND)(e)}),[d]));var d;const l=(0,r().VK)((()=>t.getUserId()),[t]),u=(0,Z().eB)({name:"internal_guests",spaceId:n.id,userId:l,amount:0,state:a});return(0,r().VK)((()=>{var e;const t=n.getModel();if(!t||!u)return[];const a=(i??[]).map((e=>function(e,n){return new(X().U)(e,{table:V().KJ,id:n})}(s,e.userId))).map((e=>e.getModel())),o=(0,v().oA)(a),r=t.id,d=o.map((e=>e.id)),l=$.getData(s,{spaceId:r,inviteeIds:d}),c=null===(e=E().Z.getData(s,{spaceId:r}))||void 0===e?void 0:e.map((e=>e.domain));return function(e){let{featureAvailability:n,guests:t,invites:a,domains:s}=e;const o=(0,v().vM)(a,(e=>e.invitee_id)),r=t.filter((e=>(0,q().is)(e.email,s))),i=(0,v().MR)(r,(e=>{const n=o[e.id]??[],t=(0,v().UT)(n,(e=>e.created_time));return null==t?void 0:t.created_time})),d=t.length,l=n.limit.total,u="unlimited"===l?0:Math.max(d-l,0);return i.slice(0,u)}({featureAvailability:u,guests:o,invites:l??[],domains:c??[]}).map((e=>new(X().U)(s,{table:V().KJ,id:e.id})))}),[s,n,u,i])}var z=()=>t(19072),J=()=>t(678231),Q=()=>t(419157),ee=()=>t(984529),ne=()=>t(865579),te=()=>t(663544);function ae(e){let{billingInterval:n,billingData:t,currentPeriodEnd:v,salesStatus:x,isOpen:b,onClose:j,onRequestDowngrade:M,onRequestUpgrade:_,onClickManageGuests:D}=e;const N=(0,g().KE)((0,u().wO)(null==t?void 0:t.subscription)),R=(0,J().Oi)({billingInterval:n,priceStore:Q().Z,products:z().cM}),C=(0,o().O7)(),S=(0,f().YB)(),G=(0,u().KU)(t),k=(0,B().r)(),V=(0,r().VK)((()=>Boolean(null==k?void 0:k.canAdmin())),[k]),q=(0,u().BU)({billingData:t,canUpdateBilling:V}),[A,E]=a.useState("plan_select"),[Y,$]=a.useState({newProduct:N,reasons:[],reasonOther:void 0,reasonOtherTools:void 0}),[X]=a.useState(l().Il()),[Z,L]=a.useState(void 0);(0,a.useEffect)((()=>w().j(C,{name:"churn_survey",args:{newProduct:Y.newProduct,churnType:N,reasons:Y.reasons,reasonOther:Y.reasonOther,reasonOtherTools:Y.reasonOtherTools,stage:A,churnSurveyId:X}})),[C,A,Y,X,N]);const ee=(0,O().r_)(),ae=(0,T().U)(k),oe=H({space:k,spaceUser:ee,desiredState:(0,u().oh)(Y.newProduct)}),re=(0,i().Fg)(),ie=(0,r().VK)((()=>{const e=Y.newProduct?(0,U().p)({highlightStyle:{color:re.text.uiRedPrimary},intl:S})[N][Y.newProduct]:void 0;return null==e?void 0:e.map((e=>({icon:e.icon,beforeMessage:e.beforeDowngrade,message:e.afterDowngrade?(0,P.jsx)(y().q,{styleName:"Body-14px/Regular",colorName:"primary",customStyles:{display:"inline"},children:e.afterDowngrade}):null})))}),[N,Y.newProduct,S,re]),de=a.useCallback((()=>{w().j(C,{name:"churn_survey_close",args:{churnSurveyId:X}}),j()}),[X,C,j]),le=a.useCallback((e=>{k&&("upgrade"===(0,p().NY)({oldTier:N,newTier:e})&&"free"!==e?(w().sA(C,{from:"downgrade_modal",for_subscription_tier:e}),_({environment:C,spaceStore:k,billingData:t,product:e,pageSection:"downgrade_modal",from:"downgrade_modal"}),de()):($((n=>({...n,newProduct:e}))),E("survey")))}),[t,N,C,de,_,k]),ue=v?(0,d().Yx)(v,"long",s().locale):void 0;return(0,P.jsx)(te().r,{step:A,isOpen:b,onClose:de,children:(()=>{switch(A){case"plan_select":return(0,P.jsx)(ne().ud,{initialPlan:Y.newProduct,asyncPriceByProduct:R,salesStatus:x,onSubmit:le});case"survey":return(0,P.jsx)(ne().tt,{options:se(),onSubmit:async e=>{w().j(C,{name:"churn_survey_submitted",args:{newProduct:Y.newProduct,churnType:N,reasons:e.reasons,reasonOther:e.customTextByReason.other??void 0,reasonOtherTools:e.customTextByReason.switching??void 0,stage:A,churnSurveyId:X}}),$((n=>({...n,reasons:e.reasons,reasonOther:e.customTextByReason.other??void 0,reasonOtherTools:e.customTextByReason.switching??void 0})));const n=await K().ZF(C,{spaceId:null==k?void 0:k.id,offerCampaign:(0,F().q)(C,null==k?void 0:k.id)}),t=(0,c().iQ)(n);if(t&&(0,m().$v)(t))return L(t),void E("offer");E("remove_guests")}});case"offer":return Z?(0,P.jsx)(ne().oR,{currentProduct:N,coupon:Z,newProduct:Y.newProduct,onSubmit:async e=>{if(e){w().j(C,{name:"offer_accepted",args:{coupon:Z}});const e=null==k?void 0:k.id,n=(0,F().q)(C,e);G&&e&&q&&(0,m().$v)(Z)&&((0,W().$u)()&&n?await K().zL({environment:C,spaceId:e,offerCampaign:n,entrypoint:"downgrade_flow"}):await K().lB(C,{customerId:G,offerType:"downgrade_flow",newPlan:N,coupon:Z}),h().oV({label:(0,P.jsx)(f()._H,{id:"applyCoupon.success",defaultMessage:"Coupon successfully applied"})})),de()}else E("remove_guests")}}):void E("remove_guests");case"remove_guests":const e=oe&&oe.length>0,n=ae&&ae.length>0;return e&&n&&ue&&k?(0,P.jsx)(I,{downgradeProduct:Y.newProduct,excessGuests:oe,formattedPeriodEndDate:ue,internalDomains:ae,spaceStore:k,onClickContinue:()=>E("downgrade"),onClickManageGuests:D}):void E("downgrade");case"downgrade":return(0,P.jsx)(ne().hy,{newProduct:Y.newProduct,title:(0,P.jsx)(f()._H,{id:"downgradeModal.header.downgrade.title",defaultMessage:"Continue downgrading to {planMessage}?",values:{planMessage:(0,p().v$)(Y.newProduct,S)}}),description:ue?(0,P.jsx)(f()._H,{id:"downgradeFlow.restrictionStep.description",defaultMessage:"You can still utilize all the features of your current plan until {date}. You can resubscribe or switch to another plan anytime.",values:{date:(0,P.jsx)("span",{style:{fontWeight:590},children:ue})}}):null,restrictionList:ie,onSubmit:async e=>{if(w().j(C,{name:"continue_downgrade_button_clicked"}),k&&t){if(!(await M({billingData:t,environment:C,product:Y.newProduct,spaceStore:k,from:"billing_page",churnState:null!=e&&e.churnImmediately?"churn_immediately":"churn_by_end_of_billing_period"})))return}E("confirmation")}});case"confirmation":if(t){if((0,u().wO)((0,u().Lg)(t))!==Y.newProduct)throw new Error("Subscription tier has not changed and is not scheduled to be changed.")}return(0,P.jsx)(ne().AF,{title:(0,P.jsx)(f()._H,{id:"downgradeFlow.confirmationStep.title",defaultMessage:"Thank you for switching to {plan}",values:{plan:(0,p().v$)(Y.newProduct,S)}}),formattedPeriodEndDate:ue})}})()})}function se(){return[...(0,v().TV)([ee().f.notUsingEnough,ee().f.switching,ee().f.tooExpensive,ee().f.tooDifficult,ee().f.missingFeatures,ee().f.upgradedByMistake,ee().f.consolidatingWorkspaces]),ee().f.other]}},402421:(e,n,t)=>{t.d(n,{q:()=>o});var a=()=>t(629719),s=()=>t(518019);function o(e,n){if(!n)return;const t=s().Z.getData(e,{spaceId:n});if(!t)return;const o=(0,a().wO)(t.subscription),r=(0,a().Tz)(t.subscription);if(o&&r&&"year"!==r)switch(o){case"plus":return"team_three_months";case"business":return"business_three_months";case"enterprise":return"enterprise_three_months";default:return}}},703976:(e,n,t)=>{t.d(n,{TC:()=>r,dr:()=>s,is:()=>o});t(267602),t(470928);var a=()=>t(446866);function s(e,n){return!!e&&o(e.getEmail(),n)}function o(e,n){return void 0!==r(e,n)}function r(e,n){if(!e)return;const t=(0,a().Gd)(e);return n.find((e=>e.url===t))}}}]);