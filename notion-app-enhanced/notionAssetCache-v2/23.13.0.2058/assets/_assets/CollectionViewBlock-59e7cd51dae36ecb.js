(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[53190,95986],{907573:(e,t,o)=>{"use strict";o.d(t,{BO:()=>y,Ft:()=>g,YG:()=>S,y$:()=>f});o(670560),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(653476),o(30005),o(241792);var n=()=>o(730120),r=()=>o(721927),i=()=>o(803021),l=()=>o(874459),s=()=>o(998411),a=()=>o(530980),c=()=>o(513670),d=()=>o(718959),u=()=>o(412511),p=()=>o(615676),m=()=>o(749826);function g(e){const{collectionContextStore:t}=e,o=t.collectionViewStore();if(!o)return;const n=t.normalizedSchemaStore.state,r=o.getQuery(n);if(!r||!r.calendar_by)return;const i=t.dateRangeStartStore.state,a=t.dateRangeEndStore.state,c=(0,l().hT)(i,(0,s().r)()),d=(0,l().hT)(a,(0,s().r)());return h({calendarBy:r.calendar_by,dateRangeStartDate:c,dateRangeEndDate:d})}function S(e){const{collectionContextStore:t,startOfDay:o}=e,r=t.collectionViewStore();if(!r)return;const i=t.normalizedSchemaStore.state,a=r.getQuery(i);if(!a||!a.calendar_by)return;const c=n().ou.fromMillis(o).endOf("day").valueOf(),d=(0,l().hT)(o,(0,s().r)()),u=(0,l().hT)(c,(0,s().r)());return h({calendarBy:a.calendar_by,dateRangeStartDate:d,dateRangeEndDate:u})}function h(e){const{dateRangeStartDate:t,dateRangeEndDate:o,calendarBy:n}=e;return{type:"results",filter:{operator:"and",filters:[{property:n,filter:{operator:"date_is_on_or_after",use_end:!0,value:{type:"exact",value:t}}},{property:n,filter:{operator:"date_is_on_or_before",value:{type:"exact",value:o}}}]},limit:5e3}}function f(e){var t;const{collectionContextStore:o,results:n,getRecordValue:r,intl:a,formulasModule:p}=e,m=o.collectionViewStore(),g=o.normalizedQueryStore.state,S=o.normalizedSchemaStore.state,h=g?g.calendar_by:void 0,f=o.dateRangeStartStore.state,x=o.dateRangeEndStore.state,b=(null===(t=o.collectionViewStore())||void 0===t?void 0:t.getFormat().calendar_show_weekends)??!0,C=d().AK.state,w=(0,s().r)(),k=o.getCurrentUserId();if(!(m&&g&&h&&S))return;const V=new Map,j=new Map,T=c().oA(n.map((e=>y({blockStore:e,calendarBy:h,schema:S,getRecordValue:r,userId:k,intl:a,resultCache:V,regExpCache:j,formulasModule:p})))),P={};n.forEach(((e,t)=>{P[e.id]=t}));0===(g.sort||[]).length&&T.sort(((e,t)=>{const o=e.start.valueOf(),n=t.start.valueOf();if(o===n){return P[e.id]-P[t.id]}return o-n}));const I=b?(0,l().em)(f,C,w):(0,l().Ty)(f,C,w),R=b?(0,l().gQ)(x,C,w):(0,l().Kw)(x,C,w);let _=I;const M=[];do{const e=b?(0,l().gQ)(_.valueOf(),C,w):(0,l().Kw)(_.valueOf(),C,w),t={},o=T.filter((t=>(0,i().b8)(_.valueOf(),e.valueOf(),t.start.valueOf(),t.end?t.end.valueOf():void 0))).map((o=>{const{id:n,start:r,end:i,includeTime:l,timeZone:s}=o,{startColumn:a,columnCount:c}=(0,u().du)({startUnixTimestampMS:r.valueOf(),endUnixTimestampMS:i?i.valueOf():void 0,startOfWeekUnixTimestampMS:_.valueOf(),endOfWeekUnixTimestampMS:e.valueOf()}),d=v(a,c,t);return{id:n,start:r.valueOf(),end:i?i.valueOf():void 0,row:d,includeTime:l,timeZone:s}}));M.push({start:_.valueOf(),end:e.valueOf(),items:o}),_=b?(0,l().em)(_.plus({week:1}).plus({hour:25}).valueOf(),C,w):(0,l().Ty)(_.plus({week:1}).plus({hour:25}).valueOf(),C,w)}while(_<R);return M}function y(e){const{blockStore:t,calendarBy:o,schema:n,getRecordValue:i,intl:c,userId:d,resultCache:u,regExpCache:g,formulasModule:S}=e,h=t.getAssociatedCollectionStore(),f=t.getModel();if(!f)return;const y=(0,r().FT)({property:o,schema:n,block:f,getRecordModel:a().omK.fromGetRecordValueFn(i),propertyMapping:null==h?void 0:h.getPropertyMapping(),collectionRequestContext:{userId:d,userTimeZone:(0,s().r)(),depth:0,intl:c,visitedProperties:new Set,resultCache:u,regExpCache:g,experimentService:m().default,collectionFeatureGates:(0,p().W)()},formulasModule:S}).next().value;if("date"!==(null==y?void 0:y.type))return;const v=y.value;if(!v)return;const x=(0,l().NK)(v,(0,s().r)());if(!x)return;return{id:f.id,start:x.start,end:x.end,includeTime:"datetime"===v.type||"datetimerange"===v.type,timeZone:"datetime"===v.type||"datetimerange"===v.type?v.time_zone:void 0}}function v(e,t,o){let n=0;for(;;){let r=!1;for(let i=0;i<t;i++)x(o,e+i,n)&&(r=!0);if(!r)break;n++}for(let r=0;r<t;r++)b(o,e+r,n);return n}function x(e,t,o){return Boolean(e[o]&&e[o][t])}function b(e,t,o){e[o]||(e[o]={}),e[o][t]=!0}(0,o(788860).vU)({week:{defaultMessage:"Week",id:"calendar.viewRanges.week"},month:{defaultMessage:"Month",id:"calendar.viewRanges.month"}})},5317:(e,t,o)=>{"use strict";o.d(t,{Z:()=>m});o(667294);var n=()=>o(219727),r=()=>o(846550),i=()=>o(64272),l=()=>o(788860),s=()=>o(250303),a=()=>o(269299),c=()=>o(827973),d=()=>o(677559),u=()=>o(688725),p=o(785893);function m(e){const{collectionContextStore:t,onClose:o,focused:m,isCompact:g}=e,S=(0,n().O7)(),{value:h}=(0,d().XJ)(u().formsEditorDependency),f=(0,r().yK)((e=>({newFormButton:{color:e.mediumTextColor,display:"flex",flexDirection:"row"}})),[]);function y(){a().createAndCommit({userAction:"CollectionViewTabBar.createGenericViewType",environment:S,canUndo:!0,perform:e=>{h&&h.formEditorActions.createAndFocusCollectionFormEditorView({environment:S,collectionContextStore:t,transaction:e})}}),o(),s().xb({environment:S,collectionContextStore:t,view_type:"form_editor"})}if(!h)return null;const v=(0,p.jsx)(c().Z,{focused:m,onClick:y,title:(0,p.jsx)("div",{style:f.newFormButton,children:(0,p.jsx)(l()._H,{defaultMessage:"New form",id:"database.collectionViewSelect.newFormButtonTitle"})}),style:{padding:"1 0"},icon:(0,i().E)({width:14,fill:f.newFormButton.color,marginRight:2})}),x=(0,p.jsx)(c().Z,{focused:m,onClick:y,title:(0,p.jsx)("div",{style:{display:"flex",flexDirection:"row"},children:(0,p.jsx)(l()._H,{defaultMessage:"Form",id:"CollectionViewTabBar.newFormItem.title"})}),icon:(0,i().E)({width:16}),shouldWrapCaption:!0,caption:(0,p.jsx)(l()._H,{defaultMessage:"Create a form to input data directly into this database",id:"CollectionViewTabBar.newFormItem.description"})});return g?v:x}},23862:(e,t,o)=>{"use strict";o.d(t,{h:()=>c});o(241792),o(667294);var n=()=>o(142735),r=()=>o(513670),i=()=>o(717940),l=()=>o(125659),s=()=>o(729201),a=o(785893);function c(e){const{isFullScreen:t,hasGroups:o,hasPartialResults:c,hasSearchQuery:d,overrideNumShimmerRows:u}=e,p=(0,l().DK)(),m=(0,n().VK)((()=>null==p?void 0:p.isInHomeWidgetStore.state),[p]);if(!(0,s().Z)(!0,0,100))return null;let g=1;void 0!==u?g=u:o||c||d||(g=t?10:3);const S=g>1?["50%","30%","40%","40%","30%","30%","40%","40%","30%","30%"]:["35%"],h=r().DZ(g).map((e=>(0,a.jsx)(i().G,{isInHomeWidget:m,widthPercentage:e<S.length?S[e]:void 0},e)));return(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginLeft:m?8:3},children:h})}},25594:(e,t,o)=>{"use strict";o.d(t,{Mj:()=>x,Vf:()=>f,ck:()=>v,gz:()=>h,iI:()=>g});o(267602),o(653476),o(470928);var n=()=>o(506347),r=()=>o(532850),i=()=>o(998411),l=()=>o(513670),s=()=>o(887430),a=()=>o(589024),c=()=>o(615676),d=()=>o(429725),u=()=>o(527278),p=()=>o(876822),m=()=>o(749826);function g(e){return{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:6,..."single"===e?{height:30}:{minHeight:30}}}function S(e,t){return(0,a().AB)(t[e])}function h(e){const{environment:t,store:o,collectionContextStore:n}=e,{mainEditorCurrentBlockStore:r}=p().default.state;return s().mb({environment:t,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:n,fullyQualified:!1})}function f(e){return(0,d().ZP)({store:e,fullyQualified:!1,pageVisitSource:n().tY.LinkInPage})}function y(e,t,o,n,l,s){return t.isDefined()?n.filter((n=>{const a="title"!==n&&l;return!r().wV({property:n,schema:o,block:t.getModel(),getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,i().r)(),intl:u().Z.getIntl(),experimentService:m().default,collectionFeatureGates:(0,c().W)(),formulasModule:s})||a})):[]}function v(e,t,o,n,r,i,s){const a=t.state,c=a.isOpen?a.property:"title",d=y(e,o,n,r,i,s),u=d.findIndex((e=>e===c)),p=l().dF(d,((e,t)=>t<u&&S(e,n)));return p||(i?"title":function(e,t){return l().dF(e,(e=>S(e,t)))}(d,n))}function x(e,t,o,n,r,i,l){const s=t.state,a=s.isOpen?s.property:"title",c=y(e,o,n,r,i,l),d=c.findIndex((e=>e===a)),u=c.find(((e,t)=>t>d&&S(e,n)));return u||(i?"title":function(e,t){return e.find((e=>S(e,t)))}(c,n))}},94130:(e,t,o)=>{"use strict";o.d(t,{m:()=>s});var n=()=>o(250303),r=()=>o(497065),i=()=>o(250625),l=()=>o(887430);function s(e){const{environment:t,collectionContextStore:o,event:s,buttonPopupParent:a}=e,c=(0,l().ay)(o);if(!c)return null;const d=i().DJ(s);r().c4({environment:t,url:c,openInNew:d}),d||null==a||a.close(),n().wd({environment:t,collectionContextStore:o,action:"click_source_view"})}},672526:(e,t,o)=>{"use strict";o.d(t,{a:()=>a});o(667294);var n=()=>o(219727),r=()=>o(138555),i=()=>o(448419),l=()=>o(998901),s=o(785893);function a(e){let{collectionContextStore:t,groupFormat:o,renderLinkButton:a,onAddOrLink:c,...d}=e;const u=(0,n().Fy)();return(0,s.jsx)(i().ZP,{popupType:u.isMobile?i().Z4.BottomSheet:i().Z4.Popup,alignmentToOrigin:l().Alignment.Start,disableFlippingPlacement:!0,...d,renderOrigin:a,render:e=>(0,s.jsx)(r().mN,{collectionContextStore:t,groupFormat:o,onClose:()=>e.close(),onAddOrLink:c})})}},894704:(e,t,o)=>{"use strict";o.d(t,{x:()=>Y,Z:()=>z});var n=o(667294),r=()=>o(219727),i=()=>o(142735),l=()=>o(846550),s=()=>o(843403),a=()=>o(641772),c=()=>o(259739),d=()=>o(811977),u=()=>o(519454),p=()=>o(788860),m=()=>o(513670),g=()=>o(707513),S=()=>o(250303),h=()=>o(421654),f=()=>o(636340),y=()=>o(879952),v=()=>o(990966),x=()=>o(269299),b=o(785893);const C=function(e){const{store:t,titleStyle:n,actionButton:r}=e,l=(0,i().VK)((()=>t.getParentBlockStore()),[t]);return(0,b.jsx)("div",{children:(0,b.jsxs)("div",{style:{display:"flex"},children:[(0,b.jsx)(o(732388).v,{step:"demo_collection",store:l,children:(0,b.jsx)(o(384241).Z,{store:t,style:n})}),r]})})};var w=()=>o(628370),k=()=>o(827973),V=()=>o(448419),j=()=>o(1910),T=()=>o(729775),P=()=>o(198829),I=()=>o(255577),R=()=>o(967092),_=()=>o(943620),M=()=>o(388284),B=()=>o(623498),F=()=>o(473244),K=()=>o(12512),L=()=>o(352230),O=()=>o(550054),D=()=>o(94130),E=()=>o(887430),A=()=>o(583632);const H=22;function Z(e){let{store:t,collectionContextStore:n,isFullScreen:l,canEdit:s,showHoverActionsStore:a}=e;const c=(0,r().O7)(),d=(0,i().VK)((()=>{const e=o(482162).default.state;return(0,E().Ks)(t)||!(0,o(942226).wq)(t)&&e.open&&e.isClosing}),[t]),u=(0,i().VK)((()=>n.collectionStore()),[n]),p=(0,i().VK)((()=>n.collectionViewBlockStore()),[n]),m=(0,i().VK)((()=>Boolean(null==u?void 0:u.isSyncedCollection())),[u]),{WindowSizeStore:g}=c,S=(0,i().VK)((()=>Math.min(o(191586).zL,g.state.width)),[g]);return u&&p?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{style:{...(l||d)&&(0,o(275200).eA)(c)&&{position:"sticky",left:0},paddingTop:8,boxSizing:d?"content-box":void 0,width:d?S:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,b.jsx)(Y,{collectionContextStore:n,showHoverActionsStore:a}),m&&(0,b.jsx)("div",{style:{display:"flex"},children:(0,b.jsx)(o(989560).Z,{canEdit:s,store:p,buttonStyle:{margin:0}})})]}),(0,b.jsx)(o(160740).Z,{collectionStore:u,collectionContextStore:n}),(0,b.jsx)(o(986286).yY,{store:u})]}):null}const z=n.memo(Z);function W(e){return{fontWeight:g().Ue.bold,fontSize:22,...e?{}:{display:"-webkit-box",lineClamp:1,WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden"}}}function G(e,t){return{width:24,height:t?24:16,fill:e.regularIconColor}}function N(e){let{parent:t,collectionContextStore:o}=e;const n=(0,l().Fg)(),a=(0,r().O7)(),d=(0,r().Fy)(),g=(0,i().Kw)(o.permissionScopesStore),f=(0,i().VK)((()=>o.collectionStore()),[o]),y=(0,i().VK)((()=>null==f?void 0:f.isSyncedCollection()),[f]),C=(0,i().VK)((()=>Boolean(null==f?void 0:f.isSystemCollection())),[f]);if(!f)return null;const w=m().oA([!C&&{key:"view",render:e=>(0,b.jsx)(k().Z,{...e,title:(0,b.jsx)(p()._H,{id:"database.source.viewDatabase.title",defaultMessage:"View database"}),icon:(0,s().J)(G(n))}),action:e=>{(0,D().m)({environment:a,collectionContextStore:o,event:e.event,buttonPopupParent:t})}},g.canConfigureCollection&&!y&&{key:"edit_name",render:e=>(0,b.jsx)(k().Z,{...e,title:(0,b.jsx)(p()._H,{id:"database.source.editTitle.title",defaultMessage:"Edit database title"}),icon:(0,u().R)(G(n))}),action:()=>{v().selectAllText({environment:a,store:f.getNameStore(),canSelectAllBlocks:!1}),t.close(),S().wd({environment:a,collectionContextStore:o,action:"click_source_edit_title"})}}]),V={key:"show_title",render:e=>(0,b.jsx)(k().Z,{...e,icon:(0,c().D)(G(n,!0)),title:(0,b.jsx)(p()._H,{id:"database.source.hideTitle.title",defaultMessage:"Hide database title"})}),action:()=>{const e=o.collectionViewStore();if(!e)return null;x().createAndCommit({userAction:"CollectionViewBlockSource.showTitleItem",environment:a,canUndo:!0,perform:t=>{h().FH({stores:[e],update:{hide_linked_collection_name:!0},transaction:t})}}),t.close(),S().wd({environment:a,collectionContextStore:o,action:"click_source_hide_title"})}};return(0,b.jsx)(P().Z,{menuType:d.isMobile?L().o.ActionSheet:L().o.Popup,children:(0,b.jsx)(I().ZP,{type:I().iW.Vertical,onAccept:t.close,sections:m().oA([w.length>0&&{key:"actions",render:e=>(0,b.jsx)(M().Z,{...e}),items:w},g.canConfigureBlock&&{key:"show_title",render:e=>(0,b.jsx)(M().Z,{...e,topBorder:!0}),items:[V]}]),initialFocus:void 0})})}function U(e){let{showHoverActionsStore:t,collectionContextStore:o}=e;const n=(0,r().O7)(),l=(0,i().Kw)(t);return(0,b.jsx)(w().Z,{visible:l,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center",marginLeft:4},children:(0,b.jsx)(V().ZP,{popupType:n.device.isMobile?R().kQ.SlideUp:R().kQ.Popup,render:e=>(0,b.jsx)(N,{parent:e,collectionContextStore:o}),renderOrigin:e=>(0,b.jsx)(j().Z,{icon:a().o,...e}),style:{width:240},originGap:4})})}function $(e){y().ZH({environment:e})}function q(e){let{disabled:t,collectionContextStore:o}=e;const n=(0,l().Fg)(),a=(0,r().O7)(),c=(0,i().VK)((()=>o.collectionStore()),[o]),u=(0,i().VK)((()=>o.collectionViewBlockStore()),[o]),p=(0,i().VK)((()=>null==c?void 0:c.getIcon()),[c]),m=(0,i().VK)((()=>{var e;return Boolean((null==c||null===(e=c.getParentBlockStore())||void 0===e?void 0:e.id)===(null==u?void 0:u.id))}),[c,u]),g=(0,i().VK)((()=>null==u?void 0:u.getType()),[u]),S=(0,l().yK)((e=>({iconStyle:{width:H,height:H,marginRight:4}})),[]);return c&&u?p?(0,b.jsxs)("div",{style:{position:"relative",width:H+2,height:H+2,marginRight:4},children:[t?(0,b.jsx)(_().Z,{disabled:!0,bucket:"secure",store:c,icon:p,isEmptyPage:!1,style:S.iconStyle,size:H}):(0,b.jsx)(_().Z,{disabled:!1,bucket:"secure",store:c,icon:p,isEmptyPage:!1,style:S.iconStyle,size:H,iconLoggingData:{recordTable:c.table,source:"inline_collection",block_type:g,collection_id:c.id},onChange:e=>function(e,t,o){const n=o.collectionStore();if(!n)return;const r=n&&n.getIconStore();r&&x().createAndCommit({userAction:"CollectionViewBlockSource.handleRecordIconChange",environment:t,canUndo:!0,perform:t=>{f().sO({store:r,value:e,transaction:t})}})}(e,a,o)}),!m&&(0,d().Y)({position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===n.mode?n.regularTextColor:"#3E3C38",stroke:"dark"===n.mode?n.surface.wash:"white",strokeWidth:"dark"===n.mode?"1.85px":"1.5px"})]}):m?null:(0,b.jsx)("div",{style:{width:20,marginRight:4},children:(0,s().J)({width:20})}):null}function Y(e){let{collectionContextStore:t,showHoverActionsStore:o,titleStyle:n}=e;const[r,l,s]=(0,i().VK)((()=>[t.collectionStore(),t.collectionViewBlockStore(),t.permissionScopesStore.state]),[t]),a=(0,i().VK)((()=>r&&(0,F().AO)(r.inMemoryRecordCache)),[r]),c=(0,i().VK)((()=>t.viewsModuleContextStore.isInLayoutBuilder()),[t]),d=(0,i().VK)((()=>{const e=t.collectionStore();if(!e)return!1;const o=e.getNameStore();return Boolean((0,O().J5)(o))}),[t]),u=(0,i().VK)((()=>{var e;return Boolean((null==r||null===(e=r.getParentBlockStore())||void 0===e?void 0:e.id)===(null==l?void 0:l.id))}),[r,l]),p=(0,i().VK)((()=>Boolean(null==r?void 0:r.isSyncedCollection())),[r]),m=(u||d)&&s.canConfigureCollection&&!p;return r&&(a||c)?(0,b.jsxs)("div",{style:{width:"max-content",maxWidth:"100%",marginRight:4,display:"flex",alignItems:"center",...g().Yu},children:[(0,b.jsx)(q,{collectionContextStore:t,disabled:!0}),(0,b.jsx)(C,{store:r,titleStyle:{...W(),...n}})]}):m?(0,b.jsx)(X,{collectionContextStore:t,showHoverActionsStore:o,titleStyle:{...W(d),...n}}):(0,b.jsx)(Q,{collectionContextStore:t,showHoverActionsStore:o,titleStyle:{...W(),...n}})}function Q(e){let{collectionContextStore:t,showHoverActionsStore:o,titleStyle:n}=e;const l=(0,r().O7)(),s=(0,i().VK)((()=>t.collectionStore()),[t]),a=(0,i().VK)((()=>t.collectionViewBlockStore()),[t]),c=(0,i().VK)((()=>Boolean(null==s?void 0:s.isSystemCollection())),[s]),d=(0,i().VK)((()=>{if(!c)return(0,E().ay)(t)}),[t,c]);return s&&a?(0,b.jsxs)(T().Z,{disabled:c,style:{width:"max-content",maxWidth:"100%",marginRight:4,...g().Yu},innerStyle:{paddingLeft:4,paddingRight:4,display:"flex",alignItems:"center",borderRadius:4},href:d,onClick:()=>function(e,t){S().wd({environment:e,collectionContextStore:t,action:"click_collection_name_link_button"})}(l,t),children:[(0,b.jsx)(q,{collectionContextStore:t,disabled:!0}),(0,b.jsx)(C,{actionButton:(0,b.jsx)(U,{showHoverActionsStore:o,collectionContextStore:t}),store:s,titleStyle:n})]}):null}function X(e){let{collectionContextStore:t,showHoverActionsStore:o,titleStyle:n}=e;const l=(0,r().O7)(),s=(0,p().YB)(),a=(0,i().VK)((()=>t.collectionStore()),[t]),c=(0,i().VK)((()=>t.collectionViewBlockStore()),[t]),d=(0,i().VK)((()=>null==a?void 0:a.getNameStore()),[a]),u=(0,i().VK)((()=>{var e;return(null==a||null===(e=a.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({intl:s}))||s.formatMessage(A().i.titlePlaceholder)}),[a,s]);return a&&c&&d?(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:4,marginRight:4},children:[(0,b.jsx)(q,{collectionContextStore:t,disabled:!1}),(0,b.jsx)(B().Z,{store:d,style:{...n,marginRight:4},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableMobileActionBar:!1,disableComment:!0,placeholder:u,onEnter:()=>$(l),onEsc:()=>$(l),onClick:()=>function(e,t){S().wd({environment:e,collectionContextStore:t,action:"click_collection_name_input"})}(l,t),disableShiftEnter:!0,pasteBehavior:"inline",inPageFind:K().B3.none},d.id),(0,b.jsx)(U,{showHoverActionsStore:o,collectionContextStore:t})]}):null}},788899:(e,t,o)=>{"use strict";o.d(t,{Tp:()=>g,cn:()=>d,fg:()=>p,l0:()=>u});o(667294);var n=()=>o(219727),r=()=>o(573357),i=()=>o(198829),l=()=>o(18748),s=()=>o(470386),a=()=>o(352230),c=o(785893);const d=8,u=8,p=32,m={height:p+d-2,paddingTop:d-2};function g(e){let{title:t,helpButton:o,onCancel:l,desktopMinWidth:d,desktopMaxWidth:u,desktopWidth:p,children:m}=e;const{device:g}=(0,n().O7)();return(0,c.jsx)(r().Z,{capture:!0,allowEsc:!0,allowUndo:!0,render:e=>{let n;return n=g.isMobile?{menuType:a().o.Modal,title:t,right:(0,c.jsx)(s().DoneMenuText,{}),onClickRight:l,...e}:{menuType:a().o.Popup,...d&&{minWidth:d},...u&&{maxWidth:u},...p&&{width:p},...e},(0,c.jsx)(i().Z,{...n,header:t&&(0,c.jsx)(S,{title:t,helpButton:o}),children:m})}})}function S(e){let{title:t,helpButton:o}=e;return(0,n().O7)().device.isMobile?null:(0,c.jsx)(l().ZP,{style:m,title:t,right:o})}},105348:(e,t,o)=>{"use strict";o.d(t,{Z:()=>V,f:()=>k});o(821057);var n=o(667294),r=()=>o(219727),i=()=>o(142735),l=()=>o(846550),s=()=>o(492522),a=()=>o(139224),c=()=>o(990966),d=()=>o(765458),u=()=>o(830700),p=()=>o(628370),m=()=>o(573357),g=()=>o(967092),S=()=>o(247724),h=()=>o(347577),f=()=>o(706363),y=()=>o(949842),v=()=>o(164079),x=()=>o(466970),b=()=>o(128119),C=o(785893);function w(e){const{collectionContextStore:t,headerSizeObserver:o,contentSizeObserver:n,paddingRight:a,shouldScrollIntoView:d,settingsOpen:u}=e,g=(0,r().O7)(),h=(0,i().VK)((()=>{const e=o.rect.state;return g.WindowSizeStore.state.height-(e.top+f().LO)}),[g.WindowSizeStore,o.rect]),x=(0,i().VK)((()=>n.rect.state.height),[n.rect]),b=(0,i().VK)((()=>t.isInPeekRendererStore.state),[t.isInPeekRendererStore]),w=(0,i().Kw)(e.headerHeightStore),k=(0,i().VK)((()=>t.allowScrollingWhenCollectionSettingsSidebarOpen()),[t]),V=(0,l().yK)((e=>({topLevelDiv:{position:"absolute",top:w,right:-a,background:b?e.cardContentBackground:e.contentBackground,borderLeft:`1px solid ${e.tableDividerColor}`,paddingRight:a,zIndex:s().Nm,...k?{height:x,minHeight:h}:{height:h}},nestedDiv:{boxShadow:`inset 0 1px 0 ${e.tableDividerColor}`}})),[w,a,b,k,x,h]);return u?(0,C.jsx)(m().Z,{capture:!0,allowMobileAutoScroll:!0,allowUndo:!0,render:e=>(0,C.jsx)(p().Z,{initial:{opacity:0,translateX:12},animate:{opacity:1,translateX:0},exit:{opacity:0,translateX:12},style:V.topLevelDiv,className:S().Dkf,...(0,v().Z)({onMouseDown:e=>function(e,t){(0,y().ZP)({event:e,context:y().Af.EditorMouseDown,callback:()=>{c().clear({environment:t})}})}(e,g)},e),children:(0,C.jsxs)("div",{style:{display:"flex",...k?{height:"fit-content",position:"sticky",top:0}:{height:"100%"}},children:[(0,C.jsx)("div",{style:V.nestedDiv,children:(0,C.jsx)(j,{collectionContextStore:t,shouldScrollIntoView:d,isSidebar:!0})}),(0,C.jsx)("div",{style:{width:a}})]})})}):null}function k(e){const{collectionContextStore:t,placementToOrigin:o,alignmentToOrigin:i,originGap:l,marginTop:s,settingsOpen:c,shouldScrollIntoView:d,originRect:p,origin:m=(0,C.jsx)("div",{})}=e,f=(0,r().O7)(),v=(0,n.useCallback)((e=>(0,C.jsx)(j,{collectionContextStore:t,shouldScrollIntoView:d,isSidebar:e})),[t,d]),b=(0,u().o)({collectionContextStore:t}),w=(0,x().E)("mobile_use_bottom_sheet_popup_container");return(0,C.jsx)(g().ZP,{popupType:f.device.isMobile?w?g().kQ.BottomSheet:g().kQ.SlideUp:g().kQ.Popup,bottomSheetInitialState:b?"half":"full",className:`${S().Dkf} ${S().D4r}`,open:c,placementToOrigin:o,alignmentToOrigin:i,style:{marginTop:s,...b&&!w&&{maxHeight:h().DQ,height:h().DQ,position:"inherit"}},origin:m,originGap:l,render:v,onDismiss:t=>{!function(e,t){(0,y().ZP)({event:e,context:y().Af.CollectionSettingsClick,callback:()=>{a().E3({collectionSettingsStore:t.settingsStore})}})}(t,e.collectionContextStore)},originRect:p,keepFocus:!0,trapFocus:!0,preventScaleTransition:!0,preventOpacityTransition:!0})}const V=function(e){const{collectionContextStore:t,headerSizeObserver:l,contentSizeObserver:s,settingsHeaderSizeObserver:a,placementStore:c,placementToOrigin:d=b().Iw.Bottom,alignmentToOrigin:u=b().lU.Start,marginTop:p=-1,originGap:m,headerRef:g}=e,S=(0,r().O7)(),f=(0,i().Kw)(c),[y,v]=(0,n.useState)(!1),x=(0,i().VK)((()=>t.isInPeekRendererStore.state),[t.isInPeekRendererStore]),V=(0,i().Kw)(t.isFullScreenStore),[j,T]=(0,n.useState)(!1),P=(0,i().VK)((()=>function(e){const t=e.settingsStore.state;return t.open&&!0!==t.hideSettingsPopup}(t)),[t]),I=(0,i().VK)((()=>function(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}(e.collectionContextStore)),[e.collectionContextStore]),R=(0,i().VK)((()=>{const e=l.rect.state;return 0!==e.width?(0,h().GC)(t,S.device.isMobile,e.width):"popup"}),[t,S.device.isMobile,l.rect]);(0,n.useEffect)((()=>{P&&(l.recompute(),a.recompute(),c.setState(R)),P&&!V&&"form_editor"!==I&&v(!0)}),[P,V,c,l,a,I,R]);const _=(0,i().VK)((()=>function(e){var t;return null===(t=e.settingsStore.state.ref)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect()}(t)||DOMRect.fromRect({x:a.rect.state.right-2,y:a.rect.state.y-2,width:0,height:a.rect.state.height})),[t,a.rect]);return(0,n.useEffect)((()=>{if(y){const e=null==g?void 0:g.current;if(e){const t=e.getBoundingClientRect();S.WindowSizeStore.state.height-t.top<o(205951).Lm&&((0,o(275200).Wr)(e,{edgeDist:0,animate:!1}),l.recompute(),a.recompute())}v(!1)}}),[t,S.WindowSizeStore,l,a,x,y,g]),(0,n.useEffect)((()=>{T(!!P)}),[P]),"sidebar"===f?(0,C.jsx)(w,{collectionContextStore:t,headerSizeObserver:l,contentSizeObserver:s,paddingRight:e.paddingRight,shouldScrollIntoView:y,headerHeightStore:e.headerHeightStore,settingsOpen:j,isInPeekRenderer:x}):(0,C.jsx)(k,{collectionContextStore:t,placementToOrigin:d,alignmentToOrigin:u,originGap:m??0,marginTop:p,settingsOpen:j,shouldScrollIntoView:y,originRect:_})};function j(e){let{isSidebar:t,collectionContextStore:o,shouldScrollIntoView:n}=e;return n?null:(0,C.jsx)(d().PJ,{context:h().HV.ViewSettings,collectionContextStore:o,collectionSettingsStore:o.settingsStore,fullHeight:t})}},583632:(e,t,o)=>{"use strict";o.d(t,{i:()=>n});const n=(0,o(788860).vU)({titlePlaceholder:{defaultMessage:"Untitled",id:"database.source.titlePlaceholder"}})},138555:(e,t,o)=>{"use strict";o.d(t,{_:()=>s,mN:()=>l,vE:()=>i});var n=()=>o(677559);const r={CollectionNewViewsPopupComponent:new(n().Ss)("CollectionNewViewsPopupComponent",(async()=>await Promise.all([o.e(62743),o.e(84885),o.e(90698),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(63707),o.e(92329),o.e(66123),o.e(59822)]).then(o.bind(o,368199)))),CollectionLinkExistingModal:new(n().Ss)("CollectionLinkExistingModal",(async()=>await Promise.all([o.e(62743),o.e(84885),o.e(90698),o.e(90424),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(7678),o.e(5006),o.e(18162),o.e(91752),o.e(80730),o.e(62084),o.e(66463),o.e(9587)]).then(o.bind(o,10053)))),ModalOverlayCollectionView:new(n().Ss)("ModalOverlayCollectionView",(async()=>await o.e(41926).then(o.bind(o,366005))))},i=(0,n().kF)(r.CollectionNewViewsPopupComponent,(e=>e.CollectionNewViewsPopupComponent)),l=(0,n().kF)(r.CollectionLinkExistingModal,(e=>e.CollectionLinkExistingModal)),s=(0,n().kF)(r.ModalOverlayCollectionView,(e=>e.ModalOverlayCollectionView))},775316:(e,t,o)=>{"use strict";o.d(t,{J:()=>g,ZP:()=>S});o(667294);var n=()=>o(142735),r=()=>o(506347),i=()=>o(788860),l=()=>o(491927),s=()=>o(384667),a=()=>o(47443),c=()=>o(879952),d=()=>o(718959),u=()=>o(949842),p=()=>o(154186),m=o(785893);const g=33;const S=function(e){const{style:t,iconStyle:g,store:S,format:f,collectionContextStore:y,groupsPointer:v,incrementLimitsInRelatedGroups:x,isFullScreen:b}=e,C=(0,o(219727).O7)(),w=(0,n().VK)((()=>y.groupsStore.getGroupState(v)),[y,v]),k=(0,n().VK)((()=>(0,o(57649).$t)({collectionContextStore:y,groupsPointer:v})),[y,v]),V=(0,n().Kw)(y.isInHomeWidgetStore),j=(0,o(846550).yK)((e=>({homeContainer:{display:"flex",alignItems:"center",justifyContent:"center"},button:{display:"flex",alignItems:"center",justifyContent:"center",height:30,borderRadius:6,whiteSpace:"break-spaces",fontSize:14,...V?{textAlign:"center",width:"fit-content",marginLeft:12,marginBottom:0,padding:4}:{},...t},loadingContainer:{marginTop:1,marginLeft:8,marginRight:8},icon:{...h(e),...g},text:{color:e.lightTextColor,width:"100%",fontSize:V?14:void 0},hoveredStyle:{...k?{background:e.whiteButtonBackground}:{}}})),[V,t,k,g]),T=(0,n().VK)((()=>S.canEdit()),[S]);return w?V?(0,m.jsx)("div",{style:j.homeContainer,children:(0,m.jsx)(p().Z,{onClick:e=>function(e,t,o){const n=e.metaKey||e.ctrlKey?"tab":void 0,i=(0,d().qG)(o.id)?r().tY.PersonalHomeTileTasks:r().tY.PersonalHomeTileCustomDb;a()._c({environment:t,store:o,pageVisitSource:i,openInNew:n})}(e,C,S),onMouseDown:u().$0,style:j.button,children:(0,m.jsx)("div",{style:j.text,children:(0,m.jsx)(i()._H,{id:"database.viewAllButtonTitle",defaultMessage:"View all"})})})}):(0,m.jsxs)(p().Z,{onClick:e=>function(e,t,o,n,r,i){const a=o.groupsStore.getGroupState(n);if(!a)return;const d=a.reducerResultStore.state;(0,u().Wi)(e),c().ZH({environment:t}),d&&s().ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:i,currentResultCount:d.blockIds.length,groupsPointer:a.groupsPointer,incrementLimitsInRelatedGroups:r}});l().uD(t)}(e,C,y,v,x,b),onMouseDown:u().$0,disabled:k,hoveredStyle:j.hoveredStyle,style:j.button,children:[(0,o(682890).M)(j.icon),(0,m.jsx)("div",{style:j.text,children:(0,m.jsx)(i()._H,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),k?(0,m.jsx)("div",{style:j.loadingContainer,children:(0,m.jsx)(o(312578).Z,{size:"sm"})}):T&&(0,m.jsx)(o(269932).Z,{collectionContextStore:y,format:f})]}):null};function h(e){return{width:14,height:14,marginLeft:4,marginRight:6,fill:e.lightIconColor}}},39607:(e,t,o)=>{"use strict";o.d(t,{Z:()=>z});o(267602),o(916054),o(653476),o(241792);var n=o(667294),r=()=>o(219727),i=()=>o(142735),l=()=>o(846550),s=()=>o(506347),a=()=>o(159732),c=()=>o(899548),d=()=>o(788860),u=()=>o(513670),p=()=>o(8101),m=()=>o(295274),g=()=>o(497065),S=()=>o(269299),h=()=>o(707513),f=()=>o(561933),y=o(785893);const v={...h().Yu,position:"absolute",left:0,right:0,top:0,bottom:0},x={marginLeft:4,fontWeight:h().Ue.semibold};function b(e){const{prefix:t,viewName:o,viewType:n}=e;return(0,y.jsxs)("div",{style:{position:"relative",width:"100%"},children:[" ",(0,y.jsxs)("div",{style:v,children:[t,n&&f().aW[n]({marginLeft:8,marginRight:2,width:"1em",display:"inline",verticalAlign:"bottom"}),(0,y.jsx)("span",{style:x,children:o})]})]})}var C=()=>o(125659),w=()=>o(41340),k=()=>o(718048),V=()=>o(641702),j=()=>o(861026),T=()=>o(429725),P=()=>o(352230),I=()=>o(148126),R=()=>o(876822),_=()=>o(826955),M=()=>o(807230),B=()=>o(292612);const F=function(e){const t=(0,r().O7)(),n=(0,l().Fg)();return(0,y.jsx)(o(108714).Z,{href:e.href,external:!0,onClick:()=>o(407391).Fs(t,{from:e.helpButtonContext}),children:(0,y.jsx)(o(1910).Z,{icon:o(456681).m,style:{height:24,width:24,marginRight:-6,fill:n.mediumIconColor}})})};var K=()=>o(953744),L=()=>o(119891),O=()=>o(740046),D=()=>o(18748),E=()=>o(255577),A=()=>o(388284),H=()=>o(710999);const Z=(0,d().vU)({filterPlaceholder:{id:"collectionPicker.searchBarFilter.text",defaultMessage:"Filter…"}});const z=function(e){let{collectionStore:t,isOverlay:s,onEmptyEnter:a,onEmptyPageClick:c,onCancelClick:u,canConfigureCollection:p,locked:m,onTemplateClick:g}=e;const S=(0,l().Fg)(),h=(0,r().Fy)(),[f,v]=(0,n.useState)(""),x=(0,i().qz)(void 0,o(692304).Z),b=(0,i().VK)((()=>t.getTemplatePageStores().filter((e=>e.getAlive()))),[t]),C=(0,i().VK)((()=>b.every((e=>e.isReady()))),[b]),w=(0,i().VK)((()=>s&&null!=f&&f.length?(0,o(619186).ZP)(f,b,(e=>String(e.getProperties().title)??"")):b),[b,f,s]);if(!C)return null;let k=(0,y.jsx)($,{collectionStore:t,onEmptyEnter:a,onEmptyPageClick:c,onCancelClick:u,canConfigureCollection:p,isOverlay:s,locked:m,onTemplateClick:g,menuListStore:x,templateInputValue:f,filteredTemplatePageStores:w,draggable:!0});const V=(0,y.jsx)(U,{templateInputValue:f,setTemplateInputValue:v});if(s){let e;return e=h.isMobile?{menuType:P().o.Modal,title:(0,y.jsx)(d()._H,{defaultMessage:"Database templates",id:"database.mobileTemplatesMenu.title"}),left:(0,y.jsx)(o(470386).CancelMenuText,{}),onClickLeft:u}:{menuType:P().o.Popup,width:360},b.length>6&&f&&(k=(0,y.jsx)($,{collectionStore:t,onEmptyEnter:a,onEmptyPageClick:c,onCancelClick:u,canConfigureCollection:p,isOverlay:s,locked:m,onTemplateClick:g,menuListStore:x,templateInputValue:f,filteredTemplatePageStores:w,draggable:!1})),(0,y.jsxs)(o(198829).Z,{...e,header:(0,y.jsx)(W,{collectionStore:t}),children:[0===b.length&&(0,y.jsx)(A().Z,{children:(0,y.jsx)("div",{style:{fontSize:14,padding:h.isMobile?"12px 16px":"0 14px 3px 14px",color:S.lightTextColor,wordBreak:"keep-all",...h.isMobile&&{background:S.contentBackground,boxShadow:`0 1px 0 ${S.regularDividerColor}`,marginBottom:1}},children:(0,y.jsx)(d()._H,{defaultMessage:"Replicate page formats inside this database with templates.",id:"database.emptyTemplatesList.info"})})}),b.length>6?V:void 0,k]})}return k};function W(e){let{collectionStore:t}=e;const o=(0,r().O7)(),n=(0,i().VK)((()=>t.getNameStore().getValue()),[t]);if(o.device.isMobile)return null;const l=n?(0,y.jsx)(y.Fragment,{children:(0,V().Xh)(n,t)}):(0,y.jsx)(d()._H,{defaultMessage:"Untitled",id:"database.templateList.UntitledDatabaseTitle"});return(0,y.jsx)(D().ZP,{style:{marginTop:6},title:(0,y.jsx)(b,{prefix:(0,y.jsx)(d()._H,{id:"database.templatesList.templatesFor",defaultMessage:"Templates for"}),viewName:l}),right:(0,y.jsx)(F,{helpButtonContext:"collection_templates_menu",href:(0,I().UY)("guides.databaseTemplates")})})}function G(e){let{props:{ref:t,...o},isOverlay:n,locked:i}=e;const s=(0,l().Fg)(),c=(0,r().O7)(),u=(0,y.jsx)(d()._H,{defaultMessage:"New template",id:"database.templateView.newTemplateButton"});return n?(0,y.jsx)(B().Z,{isBlue:c.device.isDesktop,title:u,...o}):(0,y.jsx)(H().Z,{title:u,icon:(0,a().R)({width:18,fill:s.lightIconColor,marginLeft:1,marginRight:11}),type:"new_template",format:n?"collection-overlay":"page-menu-item",locked:i,...o})}function N(e,t,o){const{mainEditorCurrentBlockStore:n}=R().default.state;!function(e,t,o){o?o(e):g().c4({environment:t,url:e})}(n?(0,T().ZP)({store:n,peekViewBlockId:e.id,fullyQualified:!1,pageVisitSource:s().tY.Create}):(0,T().ZP)({store:e,fullyQualified:!1,pageVisitSource:s().tY.Create}),t,o)}function U(e){let{templateInputValue:t,setTemplateInputValue:o}=e;const i=(0,d().YB)(),l=(0,r().O7)(),s=(0,n.useCallback)((e=>o(e.currentTarget.value)),[o]),{device:a}=l,u=!a.isMobile||void 0;return(0,y.jsx)("div",{style:{margin:a.isMobile?0:"10px 0"},children:(0,y.jsx)(O().ZP,{value:t,focusInitial:u,placeholder:i.formatMessage(Z.filterPlaceholder),showClearButton:!0,inputLeft:(0,y.jsx)(O().f_,{icon:c().R}),onChange:s,style:{...a.isAndroid&&{borderBottom:"none"}}})})}function $(e){let{filteredTemplatePageStores:t,draggable:o,collectionStore:l,onEmptyEnter:s,onEmptyPageClick:a,onCancelClick:c,canConfigureCollection:d,isOverlay:g,locked:h,onTemplateClick:f,menuListStore:v,templateInputValue:x}=e;const b=(0,r().O7)(),V=(0,n.useContext)(C().cu),T=(0,n.useContext)(w().Z),P=(0,n.useCallback)((e=>function(e,t,o,n){n.unsetFocus(),S().createAndCommit({userAction:"CollectionTemplatePicker.handleCollectionTemplatesReorder",environment:t,canUndo:!0,perform:t=>m().$p({collectionStore:o,newTemplateIds:e,transaction:t})})}(e,b,l,v)),[b,l,v]),I=(0,n.useCallback)((()=>function(e,t,o,n){var r;(0,M().ww)(e)&&(o(),p().rN(e,{template_type:"empty_page",from:"collections_template_picker",is_keyboard:!0,collection_id:t.id,collection_view_id:null==n||null===(r=n.collectionViewStore())||void 0===r?void 0:r.id}))}(b,l,s,V)),[b,l,s,V]),R=(0,n.useCallback)((e=>function(e,t,o,n){(0,M().ww)(t)&&(o(e.event),p().rN(t,{template_type:"empty_page",from:"collections_template_picker",is_keyboard:"keydown"===e.event.type,...n&&(0,j().Pn)(n)}))}(e,b,a,V)),[V,b,a]),B=(0,n.useCallback)((e=>function(e,t,o,n,r,i,l){if((0,M().ww)(t)){var s;const{performResult:e}=S().createAndCommit({userAction:"CollectionTemplatePicker.newPage",environment:t,canUndo:!0,perform:e=>m().nx({environment:t,collectionStore:o,transaction:e,title:n})});e&&N(e,t,i),p().dZ(t,{collection_id:o.id,collection_view_id:null==l||null===(s=l.collectionViewStore())||void 0===s?void 0:s.id})}null==r||r()}(0,b,l,x,c,T,V)),[b,l,x,c,T,V]),{device:F}=b,O=(0,n.useMemo)((()=>({key:"create-template",render:(e,t)=>(0,y.jsx)(G,{isOverlay:g,locked:h,props:e}),action:B})),[B,g,h]),D=(0,i().VK)((()=>null==V?void 0:V.defaultPageTemplateStore.state),[V]),H=(0,i().VK)((()=>({key:"empty",render:(e,o)=>{if(0!==t.length&&""===x)return(0,y.jsx)(K().Z,{collectionStore:l,canConfigureCollection:d,isOverlay:g,templateStore:void 0,isMobile:b.device.isMobile,locked:h||!d,draggable:!0,isDefault:void 0===(null==D?void 0:D.id),onCancelClick:c,...e})},action:R})),[d,l,null==D?void 0:D.id,b.device.isMobile,R,g,h,c,x,t.length]),Z=(0,i().VK)((()=>{const e=t.map((e=>e.id));return u().oA([0!==t.length&&{key:"templates",render:t=>{const r=t.children.slice(0,t.children.length-1),i=t.children[t.children.length-1];return(0,y.jsx)(A().Z,{...t,disableDesktopPadding:!g,disableMobileBorders:!0,children:(0,y.jsxs)(n.Fragment,{children:[F.isMobile||h||!d?r.map(((e,t)=>r[t])):(0,y.jsx)(L().ZP,{direction:"vertical",keys:e,disabled:!o,renderKey:(t,o)=>r[e.indexOf(t)],onDrop:P}),i]})})},items:[...t.map((e=>function(e,t,o,r,i,l,s,a,c,d){const{device:u}=e,p=null==d?void 0:d.defaultPageTemplateStore.state,m=_().Mz.fromBlockStore(t),g=null!=m&&m.isActive()?m.getRecurrence():void 0,S=m&&!m.canEdit(),h="disabled_duplication"===(null==m?void 0:m.getStatus())||"disabled_inactive_space"===(null==m?void 0:m.getStatus());return{key:t.id,render:e=>(0,n.createElement)(K().Z,{...e,key:t.id,isOverlay:s,collectionStore:r,canConfigureCollection:i,templateStore:t,isMobile:u.isMobile,locked:l,onCancelClick:a,draggable:o,isDefault:(null==p?void 0:p.id)===t.id,recurrence:g,recurrenceDisabled:h,recurrenceButtonDisabled:S}),action:o=>{(0,M().ww)(e)&&c({templateStore:t,isKeyboard:"keydown"===o.event.type,useCrdt:(0,k().WA)(r.getSpaceStore())})}}}(b,e,o,l,d,h,g,c,f,V))),H]},d?{key:"create-template",render:e=>(0,y.jsx)(A().Z,{topBorder:g,disableDesktopPadding:!g,disableMobileBorders:!0,...e}),items:[O]}:void 0])}),[d,V,l,O,F.isMobile,o,H,b,P,g,h,c,f,t]);return(0,y.jsx)(E().ZP,{type:E().iW.Vertical,store:v,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onEmptyEnter:I,sections:Z,resetFocusOnMouseOut:!0})}},344927:(e,t,o)=>{"use strict";o.d(t,{E:()=>r});var n=()=>o(635596);class r{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=(e,t,o)=>{let n=!0;this.didEmit||(this.didEmit=!0,n=!1),this.lastValue===t?n=!1:this.lastValue=t,n&&this.onEmit(t,o)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=n().ZP.addListener(this.listenerEventKey,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&n().ZP.removeListener(this.listener,this.environment)}}},891756:(e,t,o)=>{"use strict";o.r(t),o.d(t,{CollectionViewBlockErrorBoundary:()=>fh,CollectionViewBlockWithErrorBoundary:()=>yh});var n=o(667294),r=(o(267602),o(241792),o(731107),o(228244),()=>o(730120)),i=()=>o(504008),l=()=>o(492788),s=()=>o(219727),a=()=>o(142735),c=()=>o(846550),d=()=>o(263184),u=()=>o(569427),p=()=>o(827282),m=o(785893);const g=(0,p().IU)("shippingBox",{viewBox:"0 0 37 36",svg:(0,m.jsx)("path",{d:"M4.91749 27.6943C4.20931 27.2881 3.66776 26.8193 3.29285 26.2881C2.91793 25.7568 2.73047 24.9339 2.73047 23.8193V11.4443C2.73047 10.6318 2.88148 9.95996 3.1835 9.42871C3.49593 8.88704 3.9854 8.42871 4.65192 8.05371L15.6964 1.77246C16.6441 1.23079 17.5814 0.959961 18.5083 0.959961C19.4352 0.959961 20.3672 1.23079 21.3045 1.77246L32.3646 8.05371C33.0207 8.42871 33.4998 8.88704 33.8018 9.42871C34.1143 9.95996 34.2705 10.6318 34.2705 11.4443V23.8193C34.2705 24.9339 34.083 25.7568 33.7081 26.2881C33.3436 26.8193 32.802 27.2881 32.0834 27.6943L19.8049 34.6631C19.3571 34.9131 18.9196 35.0381 18.4927 35.0381C18.0761 35.0381 17.6491 34.9131 17.2117 34.6631L4.91749 27.6943ZM6.32344 25.6318L17.2742 31.8662V18.8975L5.10495 11.9443V23.7412C5.10495 24.1683 5.19347 24.5277 5.37052 24.8193C5.54756 25.111 5.8652 25.3818 6.32344 25.6318ZM30.6931 25.6318C31.1409 25.3818 31.4534 25.111 31.6304 24.8193C31.8075 24.5277 31.896 24.1683 31.896 23.7412V11.9443L19.7268 18.8975V31.8662L30.6931 25.6318ZM18.5083 16.71L23.3354 13.9756L11.2755 7.11621L6.44841 9.88184L18.5083 16.71ZM25.8504 12.5537L30.5682 9.88184L20.2735 4.00684C19.1071 3.32975 17.9303 3.32975 16.743 4.00684L13.7437 5.70996L25.8504 12.5537Z"})});var S=()=>o(35980),h=()=>o(183922),f=()=>o(523733),y=()=>o(139978),v=()=>o(513670),x=()=>o(696459),b=()=>o(707513),C=()=>o(788860),w=()=>o(250303),k=()=>o(139224),V=()=>o(82937),j=()=>o(658325),T=()=>o(879952),P=()=>o(990966),I=()=>o(269299),R=()=>o(324877),_=()=>o(324090),M=()=>o(583898),B=(o(470928),()=>o(714966)),F=()=>o(887430),K=()=>o(272597);o(492176),o(7961),o(30005);var L=()=>o(396136),O=()=>o(491927),D=()=>o(217465),E=()=>o(921995);const A=new(o(41158).D)({key:"notion/async_clipboard_store",namespace:"AsyncClipboardStore",important:!0,trackingType:"necessary"});async function H(e,t){let{lastActionWasCut:o,valuePromise:n}=t;const r=(0,E().tt)(e);A.setState({eventId:r,waitingForCopy:!0,lastActionWasCut:void 0,value:void 0});const i=await n;if(!i)return void A.setState({});const{recordMaps:l,...s}=i;A.setState({eventId:r,waitingForCopy:!1,lastActionWasCut:o,value:{...s,recordMapsJson:W(l)}})}function Z(e){const t=A.getState(),o=(0,E().tt)(e);if(!t||!o||t.eventId!==o)return Promise.resolve(void 0);const{waitingForCopy:n,value:r,lastActionWasCut:i}=t;return n?new Promise((e=>{A.addListener(function(e,t){return function o(n){const r=n.getState();if(!r)return void n.removeListener(o);const{waitingForCopy:i,value:l,lastActionWasCut:s}=r;i||r.eventId!==e||(n.removeListener(o),t(l?{lastActionWasCut:s||!1,value:{...l,recordMaps:z(l.recordMapsJson)}}:void 0))}}(o,e))})):r?Promise.resolve({lastActionWasCut:i||!1,value:{...r,recordMaps:z(r.recordMapsJson)}}):Promise.resolve(void 0)}function z(e){return new Map(e.map((e=>{let[t,o]=e;return[t,D().RecordMap.create(o)]})))}function W(e){return[...e.entries()].map((e=>{let[t,o]=e;return[t,o.toJson()]}))}var G=()=>o(959137),N=()=>o(236087),U=()=>o(453999),$=()=>o(94967),q=()=>o(125659),Y=()=>o(964433),Q=()=>o(542058),X=()=>o(582835),J=()=>o(148976),ee=()=>o(677559),te=()=>o(826955),oe=()=>o(965903),ne=()=>o(127519);const re=n.memo((function(){const e=(0,s().O7)(),t=(0,q().Y$)(),{value:r}=(0,ee().XJ)(Y().p),{value:i}=(0,ee().XJ)(Q().m),c=(0,a().VK)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.id}),[t]),d=(0,a().VK)((()=>{if(ne().default.isEditingStore.state)return!1;const e=oe().default.state.stores.at(0),t=null==e?void 0:e.getModel();if(void 0===e||void 0===t)return!1;if(void 0===(0,X().g0)(e))return!1;const n=(0,o(942275).ky)({block:t,getRecordModel:e.getRecordModel});return void 0!==n&&n.id===c}),[c]),u=n.useCallback((async o=>{(await G().F.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:r});const n=oe().default.state.stores;H(o,{lastActionWasCut:!1,valuePromise:ie(e).then((o=>{const{result:r,status:i}=o;if("failed"===i)return;for(const n of r){var l;O().dh(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:n.id,block_type:n.getType(),isBulk:!0,collection_id:null===(l=t.collectionStore())||void 0===l?void 0:l.id})}const s=r.length>0;for(const c of n){var a;O().dh(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:c.id,block_type:c.getType(),isBulk:s,collection_id:null===(a=t.collectionStore())||void 0===a?void 0:a.id})}return le({environment:e,subitems:r})}))})}),[t,e,r]),p=n.useCallback((async o=>{(await G().F.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:r});const n=t.collectionStore();if(null!=n&&n.isExternallyImportedAndSyncedCollection()&&(0,J().K6)())return;const i=oe().default.state.stores,l=ie(e),s=ie(e).then((t=>{const{result:o,status:n}=t;if("failed"===n)return;for(const i of o)O().dh(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:i.id,block_type:i.getType(),isBulk:!0,collection_id:c});const r=o.length>0;for(const l of i)O().dh(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:l.id,block_type:l.getType(),isBulk:r,collection_id:c});return le({environment:e,subitems:o})}));await H(o,{lastActionWasCut:!0,valuePromise:s});const a=oe().default.getState().stores,d=(await l).result;await N().VP({blocks:a,subitems:d,environment:e,canUndo:!0,skipConfirmation:!0})}),[t,c,e,r]),g=n.useCallback((async n=>{var s,a,d,u;const p=await G().F.clipboardActions.load(),m=await Z(n),g=await o(577041).j3.duplicateActions.load();if(A.setState({...A.getState(),lastActionWasCut:!1}),!m){I().createAndCommit({userAction:"CollectionViewKeyboardArea.defaultPaste",environment:e,canUndo:!0,perform:t=>{p.paste({environment:e,event:n,disableEmbedMenu:!0,transaction:t,onPasteFiles:p.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i})}});const t=oe().default.state.stores[0];if(void 0===t)return;return void O().dh(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:!1,collection_id:c})}const S=t.collectionViewBlockStore();if(!S)return;const h=t.collectionStore();if(!h)return;if(h.isExternallyImportedAndSyncedCollection()&&(0,J().K6)())return;const{recordMaps:f,subitemFormat:y,childRelationSchema:v,parentRelationSchema:x}=m.value;if(!(f&&y&&v&&x))return;const b=[...f.entries()].map((e=>{let[t]=e;return te().G.createChildStore(h,{table:L().iU,id:t})}));await Promise.all(b.map((e=>e.load())));const C=oe().default.getState().stores,w=!(m.lastActionWasCut&&function(e,t){const o=t.map((t=>te().G.createChildStore(e,t.pointer)));if(o.find((e=>!e.isReady)))return!1;return!o.find((e=>e.getAlive()))}(h,b));let k=[],V=X().JR(t),j=null===(s=V)||void 0===s?void 0:s.parentRelationProperty,P=null===(a=V)||void 0===a?void 0:a.childRelationSchema,R=null===(d=V)||void 0===d?void 0:d.parentRelationSchema,_=null===(u=V)||void 0===u?void 0:u.subitemFormat;const M=t.permissionScopesStore.state.canConfigureCollection;for(const t of b)O().dh(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:m.value.isBulk,collection_id:c});if(I().createAndCommit({userAction:"CollectionViewKeyboardArea.pasteWithSubitems",environment:e,canUndo:!0,perform:l=>{if(!_&&M){N().Bb({transaction:l,collectionContextStore:t,environment:e})&&(V=X().JR(t),V&&(j=V.parentRelationProperty,P=V.childRelationSchema,R=V.parentRelationSchema,_=V.subitemFormat))}if(!(j&&P&&R&&_))return void p.paste({environment:e,event:n,disableEmbedMenu:!0,transaction:l,onPasteFiles:p.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i});const s=w?N().R2({blocks:b,environment:e,transaction:l,recordMaps:f,migrateSubitemFormat:{from:y,to:_},collectionContextStore:t,originalSubitemSchemas:{subitemRelationSchema:v,parentRelationSchema:x},analyticsFrom:m.lastActionWasCut?"cut":"copy",duplicateActionsModule:g}):N().cI({blocks:b,transaction:l,from:y,to:_,environment:e,originAction:"paste"});!function(e){const{environment:t,selectedBlocks:n,blocksToInsert:r,subitemFormat:i,collectionContextStore:l,transaction:s}=e,a=l.collectionStore();if(!a)return;const c=n.at(-1),d=X().qb(r,i);if(0===d.length)return;if(c){const e=X().nK(l,c),n=function(e,t){if(e)return t;if(t.recordStoreUIParentStore instanceof te().G&&t.recordStoreUIParentStore.isPageBlock())return t.recordStoreUIParentStore}(Boolean(null==e?void 0:e.isExpanded),c);d.forEach((e=>{N().Cz({environment:t,blockStore:e,collectionStore:a,subitemFormat:i,transaction:s}),n&&o(531515).hE({environment:t,sourceStore:e,destStore:n,propertyWithInverse:{property:i.inverse,inverse:i.property},transaction:s,position:{type:"after"}})}))}else d.forEach((e=>{N().Cz({environment:t,blockStore:e,collectionStore:a,subitemFormat:i,transaction:s})}))}({environment:e,selectedBlocks:C,blocksToInsert:s,subitemFormat:_,collectionContextStore:t,transaction:l}),U().BM({environment:e,blocksToInsert:s,target:C,transaction:l,replaceEmptyTextBlock:!1,preventSetSelection:!0}),k=s}}),!(j&&P&&R&&_))return;const B=X().T2({blocks:k,parentRelationProperty:j,parentRelationSchema:R,collectionViewBlockStore:S});l().default.afterNextFlush((()=>{l().default.afterNextFlush((()=>{T().Z5({environment:e,stores:B})}))}))}),[t,c,e,r,i]);return(0,m.jsx)($().Z,{debugName:`CollectionViewKeyboardArea-${c}`,capture:!0,priority:d?0:-1,onCopy:u,onCut:p,onPaste:g})}));function ie(e){const t=oe().default.getState().stores;return N().xr({environment:e,blocks:t})}function le(e){let{subitems:t,environment:n}=e;const r=oe().default.getState().stores,i=r.at(0);if(!i)return;const l=(0,X().g0)(i);if(!l)return;const s=[...r,...t],a=v().oA(s.map((e=>{const t=o(872308).loadLocalSubtree(n,{blockId:e.id,inMemoryRecordCache:e.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0}).recordMap;return t&&[e.id,t]}))),c=new Map(a),{subitemFormat:d,childRelationSchema:u,parentRelationSchema:p}=l;return{recordMaps:c,subitemFormat:d,childRelationSchema:u,parentRelationSchema:p,isBulk:t.length>0}}var se=()=>o(954452),ae=()=>o(566937),ce=()=>o(939513),de=()=>o(141735),ue=()=>o(594546),pe=()=>o(718959),me=()=>o(247724),ge=()=>o(861026),Se=()=>o(706363),he=()=>o(989134),fe=()=>o(250625),ye=()=>o(949842),ve=()=>o(512258),xe=()=>o(154057),be=()=>o(191586),Ce=()=>o(942226),we=()=>o(138892),ke=()=>o(275200),Ve=()=>o(480089),je=()=>o(466970),Te=()=>o(620218),Pe=()=>o(284047),Ie=()=>o(772529),Re=()=>o(170210),_e=()=>o(589525),Me=()=>o(998901),Be=()=>o(529048),Fe=()=>o(505121),Ke=()=>o(985866),Le=()=>o(749826),Oe=()=>o(197666),De=()=>o(601952),Ee=()=>o(308939),Ae=()=>o(235044),He=()=>o(842918),Ze=()=>o(660293),ze=()=>o(482162),We=()=>o(200936),Ge=()=>o(807230),Ne=()=>o(662807),Ue=()=>o(153694),$e=()=>o(795910),qe=()=>o(957042),Ye=()=>o(143346);async function Qe(e){const{environment:t,collectionContextStore:o,blockIdToMinimumVersion:n}=e;await async function(e,t){return await Promise.all((0,x().qP)(t).map((async t=>{let[o,n]=t;return Ye().bG({environment:e,inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache,pointer:{table:L().iU,id:o},userId:e.currentUser.id,minimumVersion:n})})))}(t,n),o.resultSetStore.addLocalChange(Object.keys(n))}class Xe{constructor(e,t){this.queuedCollectionEmit=void 0,this.queuedBlockIdsToRefetch=void 0,this.isServerRequestRequired=void 0,this.collectionContextStore=void 0,this.environment=void 0,this.isServerQueryCollectionRequired=(e,t)=>{const o=this.collectionContextStore.isClientModeEnabledStore.state;if(o&&t&&"collectionTypedView"===this.collectionContextStore.contextType)return!0;const n=Boolean(e&&(0,qe().P9)($e().yd,e)&&e.hasMore);if(o&&!n)return!1;const r=this.collectionContextStore.remoteRequestStore.state;if(!r)return!0;return!!(0,x().qP)(r.loader.reducers||{}).some((e=>{let[t,o]=e;return"results"!==o.type}))||!(e&&(0,qe().P9)($e().yd,e)&&!e.hasMore)},this.throttledRefetch=(0,o(924665).Z)((e=>this.refetchFromRemote({...e,queuedTimestamp:Date.now()}))),this.processCollectionRefetch=async e=>{const t=this.queuedBlockIdsToRefetch,o=this.isServerRequestRequired;if(this.reset(),o){var n;const o=null===(n=(0,x().Yd)(t))||void 0===n?void 0:n[0],r=t[o];this.throttledRefetch({src:e,trigger:`${o}:${r}`})}t&&await Qe({environment:this.environment,collectionContextStore:this.collectionContextStore,blockIdToMinimumVersion:t})},this.refetchFromRemote=async e=>{const t=this.collectionContextStore.throttleMsStore.state;await Promise.all([(0,M().d)(this.environment,this.collectionContextStore,e,!1),(0,o(839002).Vs)(t)])},this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={},this.collectionContextStore=e,this.environment=t}reset(){this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={}}addBlockIdToRefetch(e,t){this.queuedBlockIdsToRefetch[e]=Math.max(this.queuedBlockIdsToRefetch[e]??0,t)}async handleCollectionEmit(e){const{src:t,passThroughData:o,shouldQueueCollectionEmit:n,isCollectionTypeChange:r}=e;if((0,qe().P9)($e().yd,o)&&null!=o&&o.blockIdToVersion&&(0,x().qP)(o.blockIdToVersion).forEach((e=>{let[t,o]=e;return this.addBlockIdToRefetch(t,o)})),this.isServerRequestRequired=this.isServerRequestRequired||this.isServerQueryCollectionRequired(o,r),!n)return await this.processCollectionRefetch(t);this.queuedCollectionEmit=!0}async maybeProcessQueuedCollectionEmit(e){if(this.queuedCollectionEmit)return await this.processCollectionRefetch(e)}}var Je=()=>o(58836),et=()=>o(265640),tt=()=>o(573357),ot=()=>o(307369),nt=()=>o(344927),rt=(o(653476),()=>o(926724)),it=()=>o(992205),lt=()=>o(532850),st=()=>o(95886),at=()=>o(492522),ct=()=>o(313351),dt=()=>o(820185),ut=()=>o(384667),pt=()=>o(71410),mt=()=>o(233417),gt=()=>o(561933);o(670560);function St(e){let{collectionContextStore:t,property:o,blockStores:n}=e;const r=t.normalizedFormatStore.state.collection_group_by;if((null==r?void 0:r.property)!==o)return;const i=function(e,t){const o=new Map,n=t.groupsStore.getAllGroupStates(),r=(0,v().jV)(e,oe().default.state.stores);if(!r.length)return o;for(const i of r){const e=n.find((e=>e.groupUiParentStore===i.getRecordStoreUIParent()));e&&o.set(i,e.resultsStore)}return o}(n,t),l=[];for(const[s,a]of i.entries())a.state.includes(s)||l.push(s);l.length&&T().Af({stores:(0,v().e5)(oe().default.state.stores,l)})}var ht=()=>o(527278),ft=()=>o(876822),yt=()=>o(955620);class vt extends d().default{getInitialState(){return{textStoresBeingEdited:[]}}getNumberOfTextStoresBeingEdited(){return this.state.textStoresBeingEdited.length}textStoresWithEmptyProperty(e){return this.state.textStoresBeingEdited.filter((t=>{const o=t.getPropertyValue(e);return""===yt().QaF(o)}))}}const xt=vt;var bt=()=>o(279386),Ct=()=>o(79555),wt=()=>o(356321),kt=()=>o(628370),Vt=()=>o(154186),jt=()=>o(1910),Tt=()=>o(654133),Pt=()=>o(899316);const It=32;function Rt(e){return{boxShadow:`1px 0 0 ${e.regularDividerColor}`,marginRight:1}}const _t=(0,C().vU)({delete:{id:"CollectionsBulkActionsToolbar.deleteButton.tooltip",defaultMessage:"Delete"}});function Mt(e){const t=(0,q().Y$)(),o=(0,a().VK)((()=>t.collectionViewBlockStore()),[t]),{marginLeft:r}=e,i=(0,s().O7)(),l=(0,a().qz)(void 0,xt),d=(0,n.useRef)(null),[u,p]=(0,n.useState)(!1),g=(0,a().VK)((()=>oe().default.state.stores),[]),S=g.length,h=(0,a().VK)((()=>l.getNumberOfTextStoresBeingEdited()),[l]),f=(0,a().VK)((()=>{var e;return!!(0,F().fk)({environment:i,collectionContextStore:t})&&(!g.some((e=>{var t;return null===(t=e.getAssociatedCollectionStore())||void 0===t?void 0:t.isExternallyImportedAndSyncedCollection()}))&&(h>0||g.length>=1&&(0,F().v_)(g,null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id)))}),[t,i,h,g]),y=(0,n.useRef)(void 0);(0,a().VK)((()=>{const e=pe()._H().state;e.isOpen?y.current=e.property:y.current&&St({collectionContextStore:t,property:y.current,blockStores:g})}),[t,g],{debugName:"cleanUpSelection"});const v=(0,a().VK)((()=>o&&"suggest"!==bt().MT.getMode(o)),[o]),x=(0,c().yK)((e=>({inner:{display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:5,background:e.popoverBackground,boxShadow:e.shadowSM,height:It},outer:{position:"sticky",top:1,left:0+(r??0),zIndex:at().mJ,visibility:u?"visible":"hidden"},outerLayoutAdjust:{marginBottom:-It},blockActionMenuButton:{width:30,height:"100%",borderRadius:void 0,borderTopRightRadius:5,borderBottomRightRadius:5},blockActionMenuButtonIcon:{fill:e.regularTextColor},trashButton:{borderRadius:0,height:"100%",border:0,...Rt(e),width:28},trashButtonIcon:{width:16},trashButtonIconHovered:{fill:e.accentColors.red[500]}})),[u,r]);return(0,m.jsx)(pt().Z,{capture:f,render:e=>(0,m.jsxs)(kt().Z,{visible:f,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onAnimationEnd:e=>{e||p(!1)},ref:d,...e,style:x.outer,children:[(0,m.jsx)(Je().p,{allowSelectionWithin:!1,children:(0,m.jsxs)("div",{style:x.inner,children:[(0,m.jsx)(Bt,{selectedItemCount:S,collectionsBulkActionsToolbarStore:l}),(0,m.jsx)(At,{collectionsBulkActionsToolbarStore:l,selectedItems:g,marginLeft:r,setIsReadyToRender:p,outerContainerRef:d}),v&&(0,m.jsx)(Tt().Z,{renderTooltip:()=>(0,m.jsx)("div",{children:ht().Z.formatMessage(_t.delete)}),render:e=>(0,m.jsx)(jt().Z,{...e,ariaLabel:ht().Z.formatMessage(_t.delete),icon:()=>(0,st().y)(x.trashButtonIcon),style:x.trashButton,hoveredStyle:x.trashButtonIconHovered,hasBackground:!0,isDarkIconColor:!0,showShadow:!0,onClick:async()=>{var e;O().dh(i,{analyticsName:ct().RE.deleteName.defaultMessage,from:"bulk_actions_toolbar",block_type:"page",collection_id:null===(e=t.collectionStore())||void 0===e?void 0:e.id}),await U().Qw({environment:i,blocks:g,shouldCheckSuggestEdit:!0,overrideRemoveBlockFunc:(e,o)=>{var n,r;(null===(n=e.getAssociatedCollectionStore())||void 0===n?void 0:n.id)===(null===(r=t.collectionStore())||void 0===r?void 0:r.id)&&ut().Od({store:e,transaction:o})}})}}),placement:Me().Placement.Top}),(0,m.jsx)(Ct().Z,{store:g[0],fadeIn:!1,style:x.blockActionMenuButton,hoveredStyle:x.blockActionMenuButton,iconStyle:x.blockActionMenuButtonIcon,extraAnalyticsData:{isFromBulkActionsToolbar:!0},isFromCollectionView:!0})]})}),(0,m.jsx)("div",{style:x.outerLayoutAdjust})]})})}function Bt(e){const{collectionsBulkActionsToolbarStore:t,selectedItemCount:o}=e,n=(0,s().O7)(),r=(0,a().VK)((()=>t.getNumberOfTextStoresBeingEdited()),[t]),i=(0,a().VK)((()=>r>0?r:Math.max(1,o)),[r,o]),l=(0,c().yK)((e=>({button:{color:e.blueColor,fontSize:14,whiteSpace:"nowrap",height:"100%",alignItems:"center",display:"flex",paddingRight:10,paddingLeft:10,borderTopLeftRadius:5,borderBottomLeftRadius:5,fontVariantNumeric:"tabular-nums",...Rt(e)}})),[]);return(0,m.jsx)(Vt().Z,{style:l.button,onClick:()=>T().ZH({environment:n}),children:(0,m.jsx)(C()._H,{id:"SelectedItemCountWidget.numItemsSelected",defaultMessage:"{itemsSelectedCount} selected",values:{itemsSelectedCount:i}})})}const Ft=6,Kt=450,Lt=2,Ot=32,Dt=150,Et=["title","rollup","formula","button"];function At(e){const{outerContainerRef:t,collectionsBulkActionsToolbarStore:o,selectedItems:r,marginLeft:i,setIsReadyToRender:l}=e,s=(0,q().Y$)(),c=(0,a().Kw)(s.normalizedSchemaStore),d=(0,n.useRef)(null),u=(0,a().VK)((()=>s.databaseType===rt().Fi&&r.some((e=>e.getPropertyValue(it().C.MeetingNoteToCalendarEventRelation)))),[s,r]),p=(0,a().VK)((()=>{var e;const t=s.normalizedFormatStore.state;return(null==t||null===(e=t.table_properties)||void 0===e?void 0:e.filter((e=>{const t=s.collectionStore();if((0,lt().LC)(null==t?void 0:t.getModel(),e.property))return!u;const o=c[e.property];return e.visible&&o&&!Et.includes(o.type)&&(0,gt().Sb)({propertySchema:o,property:e.property,blockStores:r,collectionSchema:c,collectionStore:t,spaceStore:ft().default.state.currentSpaceStore})})))??[]}),[s,c,r,u]).slice(0,Ft),g=(0,n.useRef)([]),[S,h]=(0,n.useState)(Ft),[f,y]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{g.current.length>0&&g.current.forEach((e=>{var t;e&&(e.rightEdge=(null===(t=e.element)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect().right)??0)}))}),[g]),function(e){let{outerContainerRef:t,propertyButtonsContainerRef:o,propertyButtonRefs:r,marginLeft:i,setIsReadyToRender:l,setShowIconsOnly:s,setHiddenButtonsIndex:a}=e;(0,n.useEffect)((()=>{const e=v().Ds((()=>{var e,n,c;const d=(null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect().right)??window.innerWidth,u=((null===(n=t.current)||void 0===n?void 0:n.getBoundingClientRect().width)??window.innerWidth)-(i??0),p=(null===(c=o.current)||void 0===c?void 0:c.getBoundingClientRect().left)??0,m=d-Dt;let g=r.current.findIndex((e=>e.rightEdge>m));g=-1!==g?g:Ft;let S=r.current.findIndex(((e,t)=>p+t*Ot>m));S=-1!==S?S:Ft;const h=g<Lt||u<=Kt;s(h),a(h?S:g),l(!0)}),150,{maxWait:150,leading:!0,trailing:!1});if(t.current){const o=new ResizeObserver((t=>{e()}));return e(),o.observe(t.current),()=>{o.disconnect()}}}),[i,t,r,o,a,l,s])}({propertyButtonsContainerRef:d,propertyButtonRefs:g,outerContainerRef:t,marginLeft:i,setIsReadyToRender:l,setHiddenButtonsIndex:h,setShowIconsOnly:y}),(0,m.jsx)("div",{ref:d,style:{display:"flex"},children:p.map(((e,t)=>{var r;let i=null===(r=g.current[t])||void 0===r?void 0:r.element;if(!i){const e=n.createRef();g.current[t]={element:e,rightEdge:0},i=e}const l=t>=S;return(0,m.jsx)("div",{ref:i,children:(0,m.jsx)(Ht,{collectionsBulkActionsToolbarStore:o,schema:c,property:e.property,isHidden:l,showIconsOnly:f},e.property)},e.property)}))})}function Ht(e){const{property:t,schema:o,collectionsBulkActionsToolbarStore:r,isHidden:i,showIconsOnly:l}=e,d=(0,q().Y$)(),u=o[t],p=(0,s().O7)(),g=(0,a().VK)((()=>!(d.permissionScopesStore.state.canEditContent||"collectionTypedView"===d.contextType)),[d]),S=(0,c().yK)((e=>({button:{display:i?"none":"flex",paddingLeft:8,paddingRight:8,height:It,alignItems:"center",...Rt(e)}})),[i]),h=(0,n.useRef)(null),f=(0,a().qz)(void 0,mt().Z),y=(0,n.useCallback)((async e=>{var o,n;if(!h.current)return;const i=oe().default.state.stores;e.stopPropagation(),e.preventDefault();const l=null===(o=h.current)||void 0===o?void 0:o.getBoundingClientRect(),s=i[0].getAssociatedCollectionStore();d&&l&&s&&await dt().z({environment:p,store:i[0],additionalStores:i.slice(1),property:t,rect:l,format:wt().C.Table,collectionStore:s,blockPropertyValueOverlayStore:pe()._H(),collectionContextStore:d,statusSetCheckbox:"checkbox"===(null===(n=d.getPropertyFormat(t))||void 0===n?void 0:n.statusShowAs),mouseStore:f,preventClearSelection:!0,collectionsBulkActionsToolbarStore:r})}),[h,d,p,t,f,r]),v=(0,c().Fg)();return u?(0,m.jsx)(Tt().Z,{renderTooltip:()=>u.name,render:e=>(0,m.jsx)(Vt().Z,{...e,ariaLabel:u.name,ref:h,style:S.button,disabled:g,onClick:y,children:(0,m.jsx)(Pt().ZP,{style:{maxWidth:"250px",textOverflow:"ellipsis"},propertySchema:u,hideName:l,showIcon:!0,property:t,iconStyle:{fill:v.regularTextColor}})}),disableTooltip:!l,placement:Me().Placement.Top}):null}function Zt(e){let{isFullScreen:t,leftRightPaddingStore:o,leftRightMarginStore:n,overrideViewType:r}=e;const i=(0,s().O7)(),l=(0,q().Y$)(),c=(0,a().VK)((()=>(0,F().fk)({environment:i,collectionContextStore:l,overrideViewType:r})),[i,l,r]),d=(0,a().VK)((()=>{var e;if(!c)return 0;return(t?(null===(e=o.state)||void 0===e?void 0:e.paddingLeft)??0:0)+(n.state.marginLeft??0)}),[c,n,o,t]);return c?(0,m.jsx)(Mt,{marginLeft:d}):null}const zt=n.memo(Zt);var Wt=()=>o(844085),Gt=()=>o(205951),Nt=()=>o(203890),Ut=()=>o(701182),$t=()=>o(291848),qt=()=>o(520849),Yt=()=>o(842574);function Qt(e){const{style:t,children:o}=e,n=(0,c().yK)((()=>({scroller:{height:"100%",maxHeight:"inherit",...t}})),[t]);return(0,m.jsx)(Yt().T,{type:qt().Z.Y,style:n.scroller,children:o})}const Xt=function(e){let{store:t,children:o,isFullScreen:r,currentViewType:i,isInPeek:l,isInHomeWidget:c,handleEditorClick:d,isRootOrDirectChild:u,leftRightPaddingStore:p,paddingBottom:g,viewSettingsPlacementStore:S,paddingLeft:h,format:f,isMyTasksEmpty:y,isHomeCustomDbEmpty:v,isInFrameWhenSidePeekOpen:b,handleHorizontalScrollerMount:C,handleEditorMouseDown:w,isUnlistedView:k}=e;const V=(0,q().Y$)(),j=(0,s().O7)(),T=(0,a().VK)((()=>function(e){const{environment:t,isFullScreen:o,isInPeek:n,isUnlistedView:r,isSettingsView:i,collectionViewType:l}=e;if("page"===l)return qt().Z.None;if(r)return qt().Z.All;if(n)return qt().Z.X;if(i)return qt().Z.All;if(!o||!(0,ke().eA)(t))return qt().Z.X;return qt().Z.None}({environment:j,isFullScreen:r,isInPeek:l,isUnlistedView:Boolean(k),isSettingsView:"collectionSettings"===V.contextType,collectionViewType:i})),[k,j,r,l,V,i]),P=(0,a().VK)((()=>!("collectionSystemView"===V.contextType)&&c&&function(e){switch(e){case"table":case"board":case"gallery":case"list":case"timeline":case"chart":case"page":case"form_editor":case"feed":case"chat":return!0;case"calendar":case"map":return!1;default:return(0,x().t1)(e)}}(i)),[V,c,i]),I=(0,a().VK)((()=>R().H2({blockStore:t,isFullScreen:r,environment:j,collectionContextStore:V})),[t,r,j,V]),_=(0,a().VK)((()=>{const e=p.state,o=V.settingsStore.state.open,n=V.isInHomeWidgetStore.state&&V.isEditableHomeCollectionStore.state;return{flexGrow:1,flexShrink:0,...t.isNonEditableState()&&{cursor:"default"},..."timeline"===i&&V.collectionStore()&&!r&&!(0,Ut().fj)({environment:j,format:f,isFullScreen:r,isRootChild:u})&&e&&{marginLeft:e.paddingLeft,marginRight:e.paddingRight,marginBottom:g},...o&&!r&&"sidebar"===S.state&&{minHeight:Gt().Lm},...n?{paddingRight:8,paddingLeft:"list"===i?8:16}:{},...c&&!P?{maxHeight:"inherit"}:{},...y||v||!P?{height:"100%"}:{},...!b||"timeline"===i||c||k?{}:{position:"sticky",left:0,paddingLeft:h,width:(0,_e().$3)(j)},..."chart"===i&&b&&!c?{paddingLeft:h}:{},..."page"===i?{zIndex:at().y}:{},...I&&{marginLeft:-Nt().Xx},...k&&{height:Nt().Ze,width:void 0}}}),[p,V,u,t,i,r,j,f,g,S,c,P,y,v,b,h,I,k]),M=(0,$t().w)(),B=(0,a().VK)((()=>M&&"page"===i?qt().Z.All:l||c?qt().Z.None:Wt().Q7(j)),[j,l,c,M,i]),F=(0,n.useCallback)((e=>{d(e,i)}),[d,i]),K=(0,m.jsx)(Yt().T,{type:T,className:me().x9t,onMouseDown:w,preventType:B,onClick:F,style:_,ref:C,children:o});return P?(0,m.jsx)(Qt,{style:{..."list"===i?{paddingBottom:8}:"timeline"===i?{paddingBottom:0}:{paddingBottom:16},...c&&"feed"!==i?{paddingTop:12}:{}},children:K}):K};var Jt=()=>o(128119);function eo(e){let{store:t,leftRightPaddingStore:n,viewSettingsPlacementStore:r,headerHeightStore:i,headerSizeObserver:l,contentSizeObserver:s,settingsHeaderSizeObserver:c,currentViewType:d,isInHomeWidget:u,placementToOrigin:p,alignmentToOrigin:g,headerRef:S}=e;const h=(0,q().DK)(),f=(0,a().VK)((()=>(0,F().Ks)(t)?{paddingLeft:0,paddingRight:0}:n.state),[n,t]),y=(0,a().VK)((()=>{var e;return void 0!==(null==h||null===(e=h.viewsModuleContextStore.getState())||void 0===e?void 0:e.viewsModule)}),[null==h?void 0:h.viewsModuleContextStore]),b="form_editor"===d,C=(0,a().VK)((()=>{var e;if(p)return p;if(!b)return;return!(null==h||!h.settingsStore.state.open)&&(0,x().DE)(["formQuestionCreateSettings","formQuestionEditSettings"],null===(e=(0,v().Ps)(null==h?void 0:h.settingsStore.state.stack))||void 0===e?void 0:e.type)?Jt().Iw.Right:Jt().Iw.Bottom}),[p,b,null==h?void 0:h.settingsStore]),w=g??(u?Jt().lU.End:void 0),k=b?C===Jt().Iw.Right?24:12:void 0,V=(0,a().VK)((()=>(null==h?void 0:h.isInlineViewStore.state)&&(null==h?void 0:h.isUnlistedViewStore.state)),[null==h?void 0:h.isInlineViewStore,null==h?void 0:h.isUnlistedViewStore]);return y?null:f&&h?(0,m.jsx)(o(105348).Z,{collectionContextStore:h,headerSizeObserver:l,contentSizeObserver:s,settingsHeaderSizeObserver:c,headerHeightStore:i,placementStore:r,marginTop:V?-10:void 0,placementToOrigin:C,alignmentToOrigin:w,originGap:k,headerRef:S,...f}):null}const to=n.memo(eo),oo=(0,p().IU)("folderUnknownLarge",{viewBox:"0 0 48 48",svg:(0,m.jsx)("path",{d:"M39.1702 25.1855C43.1252 25.1855 46.4504 21.8896 46.4504 17.9053C46.4504 13.9062 43.1692 10.625 39.1702 10.625C35.1858 10.625 31.8899 13.9209 31.8899 17.9053C31.8899 21.9189 35.1858 25.1855 39.1702 25.1855ZM11.6604 37.5195H36.1379C38.7014 37.5195 40.1663 36.0547 40.1663 33.2422V26.8408C39.6829 26.9141 38.9504 26.9141 38.3498 26.8408V33.1543C38.3498 34.8389 37.427 35.7178 35.801 35.7178H11.6897C10.0491 35.7178 9.15551 34.8389 9.15551 33.1543V21.1133H30.7327C30.5276 20.5713 30.3811 20 30.3079 19.3994H9.15551V15.3125C9.15551 13.7598 9.94652 12.9834 11.4553 12.9834H14.8391C15.9084 12.9834 16.4797 13.2031 17.2707 13.9062L18.1057 14.6387C19.0286 15.4443 19.761 15.708 21.2405 15.708H30.4543C30.6008 15.0635 30.7766 14.5215 31.0842 13.8916H21.6799C20.5666 13.8916 19.9807 13.6865 19.219 13.0127L18.3694 12.2803C17.4172 11.4307 16.7434 11.1963 15.2786 11.1963H11.1038C8.67211 11.1963 7.3391 12.5293 7.3391 15.21V33.2422C7.3391 36.084 8.80395 37.5195 11.6604 37.5195ZM39.053 19.6924C38.5989 19.6924 38.3352 19.4287 38.3352 18.9746V18.916C38.3352 18.0811 38.76 17.6416 39.4485 17.1582C40.2248 16.6162 40.7375 16.2793 40.7375 15.5615C40.7375 14.9023 40.1955 14.4775 39.3606 14.4775C38.6575 14.4775 38.1741 14.8145 37.8664 15.166C37.6174 15.4297 37.4416 15.6934 37.0608 15.6934C36.6653 15.6934 36.4016 15.4297 36.4016 15.0195C36.4016 14.0088 37.8079 13.1299 39.3606 13.1299C41.133 13.1299 42.2463 14.1699 42.2463 15.4883C42.2463 16.5869 41.6164 17.0557 40.7815 17.6709C40.1077 18.1689 39.844 18.4473 39.7854 19.0479C39.7414 19.4434 39.5071 19.6924 39.053 19.6924ZM39.053 22.5195C38.4817 22.5195 38.0129 22.0508 38.0129 21.4795C38.0129 20.9229 38.4817 20.4541 39.053 20.4541C39.6243 20.4541 40.093 20.9229 40.093 21.4795C40.0784 22.0508 39.6243 22.5195 39.053 22.5195Z"})}),no=(0,p().IU)("formBuilderDisabled",{viewBox:"0 0 72 72",svg:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.77344 41.6953V17.2031H53.4922V22.6875H57.2656V13.2656C57.2656 10.8594 56.6562 9.04688 55.4375 7.82812C54.2188 6.60938 52.375 6 49.9062 6H9.35938C6.90625 6 5.0625 6.60938 3.82812 7.82812C2.60938 9.03125 2 10.8438 2 13.2656V41.9062C2 44.3125 2.60938 46.1172 3.82812 47.3203C5.0625 48.5391 6.90625 49.1484 9.35938 49.1484H40.4062V45.375H9.40625C8.23438 45.375 7.33594 45.0703 6.71094 44.4609C6.08594 43.8359 5.77344 42.9141 5.77344 41.6953ZM53.4922 13.4766V13.8984H5.77344V13.4766C5.77344 12.2578 6.08594 11.3359 6.71094 10.7109C7.33594 10.0859 8.23438 9.77344 9.40625 9.77344H49.8594C51.0156 9.77344 51.9062 10.0859 52.5312 10.7109C53.1719 11.3359 53.4922 12.2578 53.4922 13.4766Z"}),(0,m.jsx)("path",{d:"M14.1641 34.0781H40.4062V41.6719H14.1641C13.5391 41.6719 13.0312 41.4844 12.6406 41.1094C12.2656 40.7344 12.0781 40.2422 12.0781 39.6328V36.1172C12.0781 35.5078 12.2656 35.0156 12.6406 34.6406C13.0312 34.2656 13.5391 34.0781 14.1641 34.0781Z"}),(0,m.jsx)("path",{d:"M63.5781 34.5C63.8594 34.5 64.0938 34.5938 64.2812 34.7812C64.4792 34.9688 64.5781 35.2031 64.5781 35.4844C64.5781 35.776 64.4792 36.0208 64.2812 36.2188C64.0938 36.4167 63.8594 36.5156 63.5781 36.5156H52.4375C52.1458 36.5156 51.901 36.4167 51.7031 36.2188C51.5156 36.0208 51.4219 35.776 51.4219 35.4844C51.4219 35.2031 51.5156 34.9688 51.7031 34.7812C51.901 34.5938 52.1458 34.5 52.4375 34.5H63.5781Z"}),(0,m.jsx)("path",{d:"M63.5781 39.75C63.8594 39.75 64.0938 39.849 64.2812 40.0469C64.4792 40.2344 64.5781 40.4688 64.5781 40.75C64.5781 41.0417 64.4792 41.2865 64.2812 41.4844C64.0938 41.6823 63.8594 41.7812 63.5781 41.7812H52.4375C52.1458 41.7812 51.901 41.6823 51.7031 41.4844C51.5156 41.2865 51.4219 41.0417 51.4219 40.75C51.4219 40.4688 51.5156 40.2344 51.7031 40.0469C51.901 39.849 52.1458 39.75 52.4375 39.75H63.5781Z"}),(0,m.jsx)("path",{d:"M51.875 45.173C52.0377 45.0681 52.2252 45.0156 52.4375 45.0156H57.9062C58.1979 45.0156 58.4375 45.1146 58.625 45.3125C58.8229 45.5104 58.9219 45.7552 58.9219 46.0469C58.9219 46.3177 58.8229 46.5521 58.625 46.75C58.4375 46.9375 58.1979 47.0312 57.9062 47.0312H55.244C55.2387 47.0458 55.2332 47.0605 55.2276 47.0751C55.2093 47.1229 55.1899 47.1699 55.1695 47.216C55.1592 47.1922 55.1491 47.168 55.1392 47.1437C55.124 47.106 55.1097 47.0685 55.0963 47.0312H52.4375C52.2252 47.0312 52.0377 46.9816 51.875 46.8822C51.8142 46.845 51.757 46.801 51.7031 46.75C51.5156 46.5521 51.4219 46.3177 51.4219 46.0469C51.4219 45.9193 51.4398 45.8008 51.4756 45.6912C51.5218 45.5501 51.5976 45.4239 51.7031 45.3125C51.757 45.2587 51.8142 45.2122 51.875 45.173Z"}),(0,m.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M44.4062 31.9844C44.4062 30.2656 44.849 28.9531 45.7344 28.0469C46.6302 27.1406 47.9375 26.6875 49.6562 26.6875H66.3438C68.0521 26.6875 69.3542 27.1406 70.25 28.0469C71.1458 28.9531 71.5938 30.2656 71.5938 31.9844V55.4688C71.5938 57.1979 71.1458 58.5104 70.25 59.4062C69.3542 60.3021 68.0521 60.75 66.3438 60.75H49.6562C47.9375 60.75 46.6302 60.3021 45.7344 59.4062C44.849 58.5104 44.4062 57.1979 44.4062 55.4688V31.9844ZM47.875 55.1719C47.875 55.8594 48.0521 56.3802 48.4062 56.7344C48.7604 57.099 49.2969 57.2812 50.0156 57.2812H65.9844C66.7031 57.2812 67.2344 57.099 67.5781 56.7344C67.9323 56.3802 68.1094 55.8594 68.1094 55.1719V32.2812C68.1094 31.6042 67.9323 31.0833 67.5781 30.7188C67.2344 30.3542 66.7031 30.1719 65.9844 30.1719H50.0156C49.2969 30.1719 48.7604 30.3542 48.4062 30.7188C48.0521 31.0833 47.875 31.6042 47.875 32.2812V55.1719Z"})]})});var ro=()=>o(608352),io=()=>o(226413),lo=()=>o(159732),so=()=>o(956057),ao=()=>o(632314),co=()=>o(775316),uo=()=>o(790424),po=()=>o(577223),mo=()=>o(998411),go=()=>o(308186),So=()=>o(67901);var ho=()=>o(559729),fo=(o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),()=>o(801812)),yo=()=>o(682890),vo=()=>o(426546),xo=()=>o(576868),bo=()=>o(885610),Co=()=>o(54512),wo=()=>o(175113),ko=()=>o(909240),Vo=()=>o(605890),jo=()=>o(419380),To=()=>o(960562);function Po(e){const{store:t,resultProps:o,resultComponent:r,collectionContextStore:i,canDrag:l,canDrop:d,getItemSelectableStyle:u,belowDropZoneMargin:p,analyticsName:g,disabled:S,direction:h,onSelectableEnter:f,disableScrollToRevealHorizontal:y,touchDragOnly:v,isLast:x,groupsPointer:b,toggleButton:w,subitemPath:k,disableSelectable:j,itemSelectableHaloStyle:T,passesFilter:P,onSelectableInsertRow:R,blockPropertyValueOverlayStore:_,dropzoneGap:M}=e,B=(0,s().O7)(),K=(0,a().VK)((()=>t.canEdit()),[t]),L=(0,a().VK)((()=>t.getAssociatedCollectionStore()),[t]),O=(0,a().VK)((()=>"collectionTypedView"===i.contextType),[i]),D=(0,a().VK)((()=>{const e=i.groupsStore.getGroupState(b);return null==e?void 0:e.resultsStore}),[i,b]),E=(0,a().VK)((()=>F().Ts(t)),[t]),A=(0,a().VK)((()=>F().fk({environment:B,collectionContextStore:i})?60:void 0),[i,B]),H=(0,a().VK)((()=>{const e=jo().Z.state;return e.isActive&&e.store===t}),[t]),Z=(0,a().VK)((()=>!S&&K),[S,K]),z=(0,a().VK)((()=>e.shouldShowHoverMenu&&Z),[e.shouldShowHoverMenu,Z]),W=h!==Fo.Vertical&&d,G=h!==Fo.Vertical&&d,N=h===Fo.Vertical&&d,U=(0,a().VK)((()=>{var e;return null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType()}),[i]),$=(0,c().yK)((e=>({haloStyle:{...F().pB(e,E),...("board"===U||"gallery"===U)&&{borderRadius:xl},...T}})),[U,T,E]),q=(0,n.useCallback)((e=>{const{insertStores:o,transaction:n}=e;return L?ut().$T({environment:B,collectionStore:L,collectionContextStore:i,groupsPointer:b,insertStores:o,store:t,before:!1,transaction:n}):[]}),[L,i,B,b,t]),Y=(0,n.useCallback)((e=>{const{insertStores:o,transaction:n}=e;return L?ut().$T({environment:B,collectionStore:L,collectionContextStore:i,groupsPointer:b,insertStores:o,store:t,before:!0,transaction:n}):[]}),[L,i,B,b,t]),Q=(0,n.useCallback)((async e=>{const{droppedDirection:o,duplicate:n}=e;if(!L)return[];const r=Te().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Te().default.DO_NOT_USE_measureAfterNextFlushLegacy(r,{environment:B,getData:()=>ge().yr({collectionContextStore:i,is_native_drop:!1,is_empty:!1})});const l=o!==To().v.Onto?(0,ho().F6)({stores:e.droppedStores,collectionContextStore:i}):e.droppedStores;if(0===l.length&&O)return void go().UW((0,m.jsx)(C()._H,{...ho().nX.unsupportedGroupAction}));const s=await de().F.formulas.load();I().createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:B,canUndo:!0,perform:e=>{!ut().by({environment:B,collectionStore:O?void 0:L,targetStore:t,droppedDirection:o,collectionContextStore:i,groupsPointer:b,droppedStores:l,duplicate:n,transaction:e,subitemPath:k,collapsedGroup:!1,formulasModule:s})&&O&&go().UW((0,m.jsx)(C()._H,{...ho().nX.unsupportedGroupAction}))}})}),[L,i,B,b,O,t,k]),X=(0,n.useCallback)((async e=>{const{files:o,droppedDirection:n}=e;if(!L)return[];const r=Te().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Te().default.DO_NOT_USE_measureAfterNextFlushLegacy(r,{environment:B,getData:()=>ge().yr({collectionContextStore:i,is_native_drop:!0,is_empty:!1})});const l=await de().F.formulas.load();I().createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:B,canUndo:!0,perform:e=>{ut().tQ({environment:B,collectionStore:L,targetStore:t,droppedDirection:n,collectionContextStore:i,groupsPointer:b,files:o,transaction:e,formulasModule:l})}})}),[L,i,B,b,t]),J=(0,n.useCallback)((e=>o=>{let{transaction:n}=o;if(!L)return[];const r=ut().yk({environment:B,collectionContextStore:i,groupsPointer:b,store:t,before:"above"===e,collectionStore:L,transaction:n,subitemPath:k,subitemInsertDirection:"below"});if(Co().W(B,{...ge().Pn(i),type:"page",from:"below"===e?"table_insert_below":"table_insert_above",new_page_id:null==r?void 0:r.id,creating_block_id:null==r?void 0:r.id}),r&&R&&R(t,r),r&&_){const e=()=>{ko().bA({isNewBlock:!0,environment:B,blockPropertyValueOverlayStore:_,store:r,property:"title",format:wt().C.Table,collectionContextStore:i})};i.registerCallbackForItemMounted(r,e)}}),[L,_,i,B,b,R,t,k]),ee=e.handleOpenPeekPage,te=(0,n.useCallback)((()=>{const e=i.collectionViewStore();Te().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),ee&&ee(),V().Xd({collectionContextStore:i,resultsStore:D});const t=null==e?void 0:e.getType();if(t){const e=i.normalizedFormatStore.state.collection_peek_mode,o=e||Vo().Ls[t];wo().hy(B,{is_peek:!0,from:t,peek_mode:o})}}),[i,B,ee,D]),oe=(0,a().VK)((()=>u?u(x):void 0),[u,x]);(0,n.useEffect)((()=>{i.onItemMount(t)}),[t,i]);const ne=n.createElement(r,{handleOpenPeekPage:te,collectionContextStore:i,...o,store:t,key:t.id,isLast:x,toggleButton:w,subitemPath:k,passesFilter:P});return j?ne:(0,m.jsx)(ot().Z,{style:oe,store:t,canSelect:Z,shouldShowHalo:!H,shouldForceRenderSelectionHalo:E,haloStyle:$.haloStyle,canDrag:l,canDropBelow:N,canDropLeft:W,canDropRight:G,canNativeDropBelow:N&&!O,canNativeDropLeft:W&&!O,canNativeDropRight:G&&!O,canDropOnto:d,canTriggerContextMenu:Z,isLastItem:x,showBlockMenuInput:!0,shouldShowHoverMenu:z,shouldShowCommentMenu:!1,onSelectableDrop:Q,onNativeDrop:X,onInsertBelow:q,onInsertAbove:Y,onRemove:e=>function(e,t,o,n,r){const{transaction:i}=e;r.length>0&&ut().BN({store:o,transaction:i,groupsPointer:r,collectionContextStore:n,environment:t});ut().Od({store:o,transaction:i})}(e,B,t,i,b),canInsertAbove:d,canInsertBelow:d,onInsertRowBelow:J("below"),onInsertRowAbove:J("above"),belowDropZoneMargin:p,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:g,shouldShowDropZone:d,dropzoneGap:M,onEnter:f,className:me().K4T,disableScrollToRevealHorizontal:y,touchDragOnly:v,groupsPointer:b,verticalDropZoneExtraLeftEdgeOffset:A,children:ne})}const Io=n.memo(Po,ao().Z);var Ro=()=>o(167705);function _o(e){const{store:t,collectionContextStore:r,subitemPath:i,titleColumnIndex:l,nestedCreateSubitemButton:d,getItemSelectableStyle:u}=e,p=(0,s().O7)(),{isMobile:g}=(0,s().Fy)(),S=(0,c().Fg)(),{currentSubitemFormatStoreForUiDisplayStore:h,subitemExpandedStore:f,subitemTreeStore:y}=r,x=(0,a().VK)((()=>F().Bm({store:t,collectionContextStore:r})),[r,t]),b=(0,a().VK)((()=>{var e;return null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType()}),[r]),{value:C}=(0,ee().XJ)(de().F.formulas),w=(0,a().VK)((()=>i&&i.length>0?i:(0,vo().DY)(y.state.children,(e=>e.value.store===t))),[i,y,t],{useDeepEqual:!0}),k=(0,n.useMemo)((()=>w?(0,X().Af)(w.map((e=>e.value.store))):""),[w]),V=(0,a().VK)((()=>f.state.get(k)),[f,k]),j=Boolean(null==V?void 0:V.isExpanded),P=(0,a().Kw)(h),I=(0,a().VK)((()=>{if(!x||!P)return;const e=x.getSchema()[P.property];return void 0!==e&&(0,io().p_)(e)?e:void 0}),[x,P]),R=(0,a().VK)((()=>{var e;return I&&"relation"===I.type&&(0,io().F0)(I)===(null===(e=r.collectionStore())||void 0===e?void 0:e.id)&&I.property}),[r,I]),_=(0,a().VK)((()=>{const e=!R||b&&(0,X().Av)(b)?void 0:{property:R,filter:{operator:"is_empty"}};return!(!P||!x)&&(0,X().kC)({store:t,collectionStore:x,subitemFormat:P,subitemPathKey:k,collectionContextStore:r,propertyFilters:[...e&&R?[{id:R,filter:e}]:[],...r.currentPropertyFiltersStore.state],combinatorFilter:r.currentCombinatorFilterStore.state,currentUserId:p.currentUser.id,resultCache:new Map,regExpCache:new Map,formulasModule:C}).length>0}),[r,b,p.currentUser.id,R,x,k,t,P,C]),M=(0,a().VK)((()=>!(!x||!P)&&(_||j||g||"timeline"===b)),[x,P,_,j,g,b]),B=(0,a().VK)((()=>!(!x||!P)&&bo().Z.getState().hoveredStore===t),[x,t,P]),K=(0,a().VK)((()=>{const e=(0,xo().m1)({collectionContextStore:r,collectionStore:x,environment:p});if(e)return(0,o(455947).q)(e)}),[r,x,p]),L=(0,n.useCallback)((()=>{const e=f.state;if(j){e.delete(k);const o=oe().default.state.stores.filter((e=>t.uiContains(e)));o.length>0&&T().Af({stores:(0,v().e5)(oe().default.state.stores,o)}),O().a_(p,{...(0,ge().Pn)(r),depth:(null==w?void 0:w.length)||0}),f.emit()}else e.set(k,{isExpanded:!0,limit:20}),O()._k(p,{...(0,ge().Pn)(r),depth:(null==w?void 0:w.length)||0}),K&&e&&I&&P?(0,X().fd)({blockStore:t,subitemExpandedStore:f,subitemFormat:P,propertySchema:I,compiledFilter:K,pathKey:k,forceStoresToLoad:!1,visitedIds:new Set,resultCache:new Map,regExpCache:new Map}).then((()=>{f.emit()})):f.emit()}),[f,j,k,p,r,null==w?void 0:w.length,t,K,I,P]),D=(0,a().VK)((()=>{const o=y.state;return o&&w&&o.children.length>0?(0,X().Ns)(o).value.store===t:e.isLast}),[y,e.isLast,t,w]),E=(0,o(817606)._)(),A=(0,a().VK)((()=>{var e;const o=t.getModel();if(!K||!o)return!0;const n=null===(e=t.getAssociatedCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return K({block:o,getRecordModel:t.getRecordModel,propertyMapping:n,formulaTimeoutTimestampMs:Date.now()+E,resultCache:new Map,regExpCache:new Map,experimentService:Le().default,formulasModule:C})}),[t,K,E,C]),H=(0,a().VK)((()=>u&&!A?()=>({...u?u(D):{},...A?{}:{opacity:.5}}):u),[u,A,D]);(0,fo().r5)((async()=>{const e=t.getModel();await t.load();const o=t.getRecordModel;if(!M||!e||!K||!I||!o||!P||A)return;(0,X().xb)({store:t,subitemFormat:P,propertySchema:I}).length>0||(await(0,X().fd)({blockStore:t,subitemExpandedStore:f,subitemFormat:P,propertySchema:I,compiledFilter:K,pathKey:k,forceStoresToLoad:!0,visitedIds:new Set,resultCache:new Map,regExpCache:new Map}),f.emit())}),[M,K,A,k,t,f,P,I]);const Z=(0,m.jsx)(Io,{...e,passesFilter:A,isLast:D,getItemSelectableStyle:H,subitemPath:w,toggleButton:M||B?(0,m.jsx)(Ro().Z,{isSidebar:!1,open:j,fill:!0,onClick:L,color:_||j?S.regularIconColor:S.mediumIconColor,disabled:w&&w.length>=X().F0}):void 0});if(!j||!w||0===w.length||w.length>=X().F0)return Z;const z=w[w.length-1].children;return(0,m.jsxs)(m.Fragment,{children:[Z,z.map((t=>{const o=t.value.store;return(0,n.createElement)(Bo,{...e,key:o.id,store:o,subitemPath:[...w,t]})})),x&&d&&d({store:t,parentStore:x,subitemPath:w,indentLevel:w.length,titleColumnIndex:l}),V&&z.length>0&&z.length===V.limit&&(0,m.jsx)(Mo,{collectionContextStore:e.collectionContextStore,pathKey:k,titleColumnIndex:l,limit:V.limit,indentLevel:w.length})]})}const Mo=n.memo((function(e){const{collectionContextStore:t,pathKey:o,titleColumnIndex:r,limit:i,indentLevel:l}=e,s=(0,n.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:i+20}),e.emit()}),[t,i,o]),d=(0,a().VK)((()=>{var e;return"title"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[t]),u=(0,c().yK)((e=>({button:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:(0,R().lZ)({columnIndex:0,titleColumnIndex:r,indentLevel:l,isSubitemToggleOnTitleColumn:d}),fontSize:14,lineHeight:b().Nv.UIRegular.desktop,borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,background:e.cardContentBackground},icon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},label:{color:e.lightTextColor}})),[r,l,d]);return(0,m.jsxs)(Vt().Z,{onClick:s,onMouseDown:ye().$0,style:u.button,children:[(0,yo().M)(u.icon),(0,m.jsx)("span",{style:u.label,children:(0,m.jsx)(C()._H,{defaultMessage:"Load more",id:"database.loadMoreButtonTitle"})})]})})),Bo=n.memo(_o);let Fo=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});function Ko(e){const{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,disableRequest:l,onSelectableEnter:c,canDrop:d,canDrag:u,groupsPointer:p,loadContentCover:g,emptyDroppableSize:S,emptyDroppableStyle:h,virtualizeResults:f}=e,y=(0,s().O7)(),x=(0,je().E)("drag_respects_relation_limits"),b=(0,a().VK)((()=>t.collectionViewBlockStore()),[t]),C=(0,n.useMemo)((()=>{if(b)return new(te().G)(y,b.pointer)}),[b,y]),w=(0,a().VK)((()=>{const e=t.groupsStore.getGroupState(p);if(!e)return;const o=e.currentLimit.state,n=t.normalizedSchemaStore.state,r=v().oA(p.map((e=>(0,po().Ko)({schema:n,propertyMapping:void 0,groupBy:t.getGroupByAndGroupFormats().groupBy,group:e,timeZone:(0,mo().r)(),experimentService:Le().default}))));return{type:"results",filter:r.length>0?{operator:"and",filters:r}:void 0,limit:o,loadContentCover:g}}),[t,p,g]),k=(0,a().VK)((()=>{if(t.shouldDelayRenderStore.state)return[];const e=t.groupsStore.getGroupState(p);return(null==e?void 0:e.resultsStore.state)??[]}),[t.groupsStore,t.shouldDelayRenderStore,p]),V=(0,a().VK)((()=>"collectionTypedView"===t.contextType?void 0:t.collectionStore()),[t]),j=(0,a().VK)((()=>{if(!x)return!1;const e=t.normalizedSchemaStore.state;return p.some((t=>{const o=e[t.property];if("relation"===(null==o?void 0:o.type)&&null!=o&&o.property){const t=e[o.property];if("relation"===(null==t?void 0:t.type)&&1===t.limit)return!0}return!1}))}),[t,p,x]),T=i===Fo.Vertical;var P;k.length>0&&(null===(P=t.databaseItemsVisibleTracker)||void 0===P||P.handleItemsRenderStart());(0,n.useEffect)((()=>t.renderEmitter.emit()));const I=S||void 0;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{style:{...T?{height:I}:{width:I},...h},children:(0,m.jsx)(Oo,{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,canDrop:d,groupsPointer:p,instanceCollectionViewBlockStore:C,resultStores:k,droppedIntoCollectionStore:V,onSelectableEnter:c})}),f?(0,m.jsx)(Eo,{collectionContextStore:t,groupsPointer:p,resultComponentProps:{...e,canDrag:u&&!j}}):k.map(((t,o,n)=>(0,m.jsx)(Ho,{store:t,isLast:o===n.length-1,...e,canDrag:u&&!j},t.id))),(0,m.jsx)(Zo,{collectionContextStore:t,groupsPointer:p,disableRequest:l,resultsReducer:w})]})}const Lo=n.memo(Ko);function Oo(e){const{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,onSelectableEnter:l,canDrop:c,groupsPointer:d,instanceCollectionViewBlockStore:u,resultStores:p,droppedIntoCollectionStore:g}=e,S=(0,s().O7)(),h=(0,a().VK)((()=>"collectionTypedView"===t.contextType),[t]),f=(0,a().Kw)(t.isInHomeWidgetStore),y=(0,a().VK)((()=>F().fk({environment:S,collectionContextStore:t})?60:void 0),[t,S]),v=(0,n.useCallback)((async e=>{const o=await de().F.formulas.load();return function(e,t,o,n,r,i){const{droppedDirection:l,duplicate:s}=e,a=o.collectionViewBlockStore();if(!a)return;const c=Te().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Te().default.DO_NOT_USE_measureAfterNextFlushLegacy(c,{environment:t,getData:()=>ge().yr({collectionContextStore:o,is_native_drop:!1,is_empty:!0})});const d="collectionTypedView"===o.contextType,u=(0,ho().F6)({stores:e.droppedStores,collectionContextStore:o});if(0===u.length&&d)return void go().UW(ht().Z.formatMessage(ho().nX.unsupportedGroupAction));I().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:t,canUndo:!0,perform:e=>{!ut().by({environment:t,collectionStore:i,targetStore:a,droppedDirection:l,collectionContextStore:o,groupsPointer:n,droppedStores:u,duplicate:s,transaction:e,collapsedGroup:!1,formulasModule:r})&&d&&go().UW(ht().Z.formatMessage(ho().nX.unsupportedGroupAction))}})}(e,S,t,d,o,g)}),[t,g,S,d]),x=(0,n.useCallback)((async t=>{const o=await de().F.formulas.load();return function(e,t,o,n,r,i){const{files:l,droppedDirection:s}=e;if(!i)return;const a=o.collectionViewBlockStore();if(!a)return;const c=Te().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Te().default.DO_NOT_USE_measureAfterNextFlushLegacy(c,{environment:t,getData:()=>ge().yr({collectionContextStore:o,is_native_drop:!0,is_empty:!0})}),I().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:t,canUndo:!0,perform:e=>{ut().tQ({environment:t,collectionStore:i,targetStore:a,droppedDirection:s,collectionContextStore:o,groupsPointer:n,files:l,transaction:e,formulasModule:r})}})}(t,S,e.collectionContextStore,e.groupsPointer,o,g)}),[g,S,e.collectionContextStore,e.groupsPointer]);if(!u)return null;const b=i!==Fo.Vertical&&(!o&&0===p.length),C=i===Fo.Vertical&&!o;return(0,m.jsx)(ot().Z,{store:u,canSelect:!1,canEditText:!1,shouldShowHalo:!f,canDrag:!1,canDropLeft:c&&b,canNativeDropLeft:c&&b&&!h,canDropBelow:c&&C,canNativeDropBelow:c&&C&&!h,canTriggerContextMenu:!1,isLastItem:0===p.length,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:v,onNativeDrop:x,analyticsName:r,shouldShowDropZone:c,onEnter:l,groupsPointer:d,verticalDropZoneExtraLeftEdgeOffset:y,style:i===Fo.Vertical?void 0:{width:"100%",height:"100%"}})}function Do(e){let{collectionContextStore:t,groupsPointer:o,resultComponentProps:r}=e;const i=(0,a().VK)((()=>t.groupsStore.getGroupState(o)),[t,o]),l=(0,a().VK)((()=>(null==i?void 0:i.resultsStore.state)??[]),[null==i?void 0:i.resultsStore]),[c,d]=(0,n.useState)(0),u=(0,n.useCallback)((e=>{if(0===c){var t;const o=(null==e||null===(t=e.getBoundingClientRect())||void 0===t?void 0:t.top)??0;o!==c&&d(o)}}),[c]),p=(0,n.useCallback)((e=>l[e].id),[l]),g=(0,n.useContext)(ce().U),S=(0,uo().MG)({count:l.length,estimateSize:()=>34,scrollMargin:c,getScrollElement:()=>{var e;return(null==g||null===(e=g.verticalScroller)||void 0===e?void 0:e.getNode())??null},getItemKey:p,overscan:10});return function(e){let{virtualizer:t,resultsStores:o,collectionContextStore:r,groupState:i}=e;const l=(0,n.useRef)({fetching:!1,previousTotal:0}),c=(0,s().O7)(),d=t.getVirtualItems(),u=o.length+1,p=(0,a().VK)((()=>{var e;return(null==i||null===(e=i.reducerResultStore)||void 0===e||null===(e=e.state)||void 0===e?void 0:e.hasMore)??!1}),[null==i?void 0:i.reducerResultStore]);(0,n.useEffect)((()=>{const{fetching:e,previousTotal:t}=l.current;e&&t!==u&&(l.current={fetching:!1,previousTotal:0})}),[u]),(0,n.useEffect)((()=>{if(!p||null==i||!i.groupsPointer||l.current.fetching)return;const[e]=d.slice(-1);!e||u<=0||e.index-t.options.overscan>.67*u&&(l.current={fetching:!0,previousTotal:u},r.infiniteScrollLongTaskObserver.observe(),ut().ID({collectionContextStore:r,environment:c,incrementLimitArgs:{isFullScreen:!0,currentResultCount:o.length,groupsPointer:null==i?void 0:i.groupsPointer,incrementLimitsInRelatedGroups:!1}}))}),[r,c,null==i?void 0:i.groupsPointer,p,o.length,u,d,t.options.overscan])}({virtualizer:S,resultsStores:l,collectionContextStore:t,groupState:i}),(0,n.useEffect)((()=>{t.virtualizedModule.setRowVirtualizer(S)}),[t,S]),l.length<=0?null:(0,m.jsx)("div",{ref:u,style:{height:S.getTotalSize(),width:"100%",position:"relative"},children:S.getVirtualItems().map((e=>{const t=l[e.index],o=l.length-1===e.index;return(0,m.jsx)("div",{"data-index":e.index,ref:S.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${(e.start??0)-S.options.scrollMargin}px)`},children:(0,m.jsx)(Ho,{store:t,isLast:o,...r},t.id)},e.key)}))})}const Eo=n.memo(Do,ao().Z);function Ao(e){const{isLast:t,collectionContextStore:o,dropzoneGap:r,resultProps:i,resultComponent:l,groupsPointer:s,shouldShowHoverMenu:c,canDrag:d,disabled:u,format:p,getItemSelectableStyle:g,handleOpenPeekPage:S,belowDropZoneMargin:h,analyticsName:f,direction:y,onSelectableEnter:v,canDrop:x,disableScrollToRevealHorizontal:b,touchDragOnly:C,blockPropertyValueOverlayStore:w,onSelectableInsertRow:k,disableSelectable:V,titleColumnIndex:j,nestedCreateSubitemButton:T,itemSelectableHaloStyle:P}=e,I=(0,a().VK)((()=>F().Bm({store:e.store,collectionContextStore:o})),[o,e.store]),R=(0,n.useMemo)((()=>[]),[]);return I?(0,m.jsx)(Bo,{getItemSelectableStyle:g,itemSelectableHaloStyle:P,store:e.store,canDrag:d,resultProps:i,resultComponent:l,collectionContextStore:o,groupsPointer:s,shouldShowHoverMenu:c,canDrop:x&&!u,format:p,handleOpenPeekPage:S,belowDropZoneMargin:h,analyticsName:f,disabled:u,direction:y,dropzoneGap:r,onSelectableEnter:v,disableScrollToRevealHorizontal:b,touchDragOnly:C,isLast:t,subitemPath:R,titleColumnIndex:j,blockPropertyValueOverlayStore:w,onSelectableInsertRow:k,disableSelectable:V,nestedCreateSubitemButton:T}):null}const Ho=n.memo(Ao,ao().Z);function Zo(e){let{collectionContextStore:t,groupsPointer:o,disableRequest:n,resultsReducer:r}=e;const i=(0,a().VK)((()=>t.groupsStore.getGroupState(o)),[t,o]),l=(0,a().VK)((()=>Le().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]);return!n&&r&&i?(0,m.jsx)(So().Z,{id:o.length>0?`results:${(0,ro().KW)(o)}`:"collection_group_results",reducer:r,groupsPointer:o,collectionContextStore:t,resultStore:i.reducerResultStore,debounceWait:l}):null}var zo=()=>o(906769),Wo=()=>o(57649),Go=()=>o(506347),No=()=>o(47443),Uo=()=>o(794586),$o=()=>o(191560),qo=()=>o(715146);function Yo(e){var t;const{transaction:o,environment:n,collectionContextStore:r,isFullScreen:i,groupsPointer:l,insertAtIndex:s,from:a,transient:c}=e,d=null===(t=r.groupsStore.getGroupState(l))||void 0===t?void 0:t.resultsStore;if(!d)return;r.searchQueryStore.state&&(0,qo().U)({searchQuery:"",collectionContextStore:r,isFullScreen:i});const u=ut().IW({environment:n,collectionContextStore:r,groupsPointer:l,insertAtIndex:s,shouldCoerce:!0,templateStore:r.defaultPageTemplateStore.state,transaction:o,from:{createBlock:a},inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache});if(!u)return;const p=u.coercionSucceeded,m=u.newStore;if(n.device.isMobile)No()._c({environment:n,store:m,pageVisitSource:Go().tY.Create});else if(p){const e=m.getBlockTitleStore();T().eP({environment:n,store:m}),P().setSelectionAtEnd({store:e}),(0,$o().v)({store:m,transient:c})}else{const e="collectionTypedView"===r.contextType;Uo().CH({environment:n,store:m,peekMode:(0,F().kr)(r),showMoveTo:e,resultsStore:d,collectionContextStore:r,pageVisitSource:Go().tY.Create})}Co().W(n,{from:a,type:"page",new_page_id:m.id,creating_block_id:m.id,...(0,ge().Pn)(r)})}var Qo=()=>o(568017),Xo=()=>o(197874);function Jo(e){const{collectionContextStore:t}=e,o=(0,C().YB)(),n=(0,a().VK)((()=>{var e;return t.databaseType?(0,Xo()._M)(o,t.databaseType):(0,Xo().es)(o,null===(e=t.collectionStore())||void 0===e?void 0:e.getModel())}),[t,o]);return(0,m.jsx)(m.Fragment,{children:n})}var en=()=>o(941310),tn=()=>o(615676);const on={fontSize:14,lineHeight:1.5,minHeight:21,fontWeight:b().Ue.medium,width:"auto"},nn={fontSize:16,lineHeight:1.5,minHeight:24,fontWeight:b().Ue.medium,width:"auto"};function rn(e,t,o,n,r){const i=o.getViewType();if(!t.isDefined()||!i)return[];return(0,gt().eI)({viewType:i,format:o.normalizedFormatStore.state,visible:!0}).filter((i=>n&&i.property!==io().iw||(0,en().X)({block:t.getModel(),property:i.property,schema:o.normalizedSchemaStore.state,getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,mo().r)(),intl:ht().Z.getIntl(),experimentService:Le().default,collectionFeatureGates:(0,tn().W)(),formulasModule:r})))}function ln(e){const t=e.getViewType();if("board"===t||"gallery"===t){const o=e.normalizedFormatStore.state;return(0,gt().K8)(o,t)}return!1}var sn=()=>o(312578);const an=function(e){let{shouldShowSpinner:t,color:o,collectionContextStore:n,isFullScreen:r,groupsPointer:i}=e;const l=(0,s().O7)(),{isMobile:a}=(0,s().Fy)(),d=(0,c().yK)((e=>{const t=o||e.lightTextColor,n=a?nn.fontSize:on.fontSize;return{addItemButton:{width:"100%",color:t,borderRadius:xl,boxShadow:"dark"===e.mode?`${Qo().ZP.whiteWithAlpha(.05)} 0px 0px 0px 1px`:`${e.regularDividerColor} 0px 0px 0px 1px`,padding:"12px 16px 12px 16px",minHeight:(0,F().ml)({isMobile:a}),fontSize:n},plusIcon:{width:n,height:n,fill:t},spinner:{margin:"0 0 0 auto"}}}),[o,a]);return(0,m.jsxs)(et().D,{icon:e=>(0,lo().R)({...e,...d.plusIcon}),isLightGray:!0,size:"lg",style:d.addItemButton,onClick:e=>function(e,t,o,n){if(!(0,Ge().ww)(n))return void(0,Ge().eD)(n);I().createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:n,canUndo:!0,perform:r=>{Yo({transaction:r,environment:n,collectionContextStore:e,isFullScreen:t,groupsPointer:o,from:"board_group_add_item_bottom",transient:!1})}})}(n,r,i,l),onMouseDown:ye().$0,children:[(0,m.jsx)(Jo,{collectionContextStore:n}),t&&(0,m.jsx)("div",{style:d.spinner,children:(0,m.jsx)(sn().Z,{size:"sm"})})]})};var cn=()=>o(545914),dn=()=>o(672526);function un(e){let{color:t,collectionContextStore:o,groupFormat:n,isHovered:r}=e;const{isMobile:i}=(0,s().Fy)(),l=(0,c().yK)((e=>{const o=t||e.lightTextColor,n=i?nn.fontSize:on.fontSize;return{linkButton:{visibility:r?"visible":"hidden",marginTop:8,width:"100%",color:o,borderRadius:xl,padding:"12px 16px 12px 16px",fontSize:n},icon:{width:n,height:n,fill:o}}}),[t,i,r]);return(0,m.jsx)(dn().a,{collectionContextStore:o,groupFormat:n,renderLinkButton:e=>(0,m.jsx)(et().D,{icon:e=>(0,cn().v)({...e,...l.icon}),isLightGray:!0,size:"lg",style:l.linkButton,...e,children:(0,m.jsx)(C()._H,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})})})}var pn=()=>o(629013),mn=()=>o(732811),gn=()=>o(511115),Sn=()=>o(421654),hn=()=>o(497065),fn=()=>o(280080),yn=()=>o(50272),vn=()=>o(596324),xn=()=>o(973509),bn=()=>o(729775),Cn=()=>o(429725),wn=()=>o(191003),kn=()=>o(155386),Vn=()=>o(589024);function jn(e,t,o,n,r){const i=o.getViewType();if("board"===i||"gallery"===i){const l=(0,gt().JI)(t);T().eP({environment:e,store:t}),P().setSelectionAtEnd({store:l}),(0,$o().v)({store:t}),r&&O().sd(e,"board_item_edit_mode_enter",{...(0,ge().Pn)(o),block_id:t.id,from:r,view_type:i}),n.setState("existing")}}function Tn(e,t,o,n,r,i,s,a){const c=r.normalizedSchemaStore.state,d=n.state;if(!d.isOpen)return;const u=rn(t,o,r,s,a).map((e=>e.property)),p=u.findIndex((e=>e===d.property));let m;if("tab"===e){const e=u.find(((e,t)=>t>p&&(0,Vn().AB)(c[e])))||u.find(((e,t)=>!s&&(0,Vn().AB)(c[e])));m=e}else{const e=v().dF(u,((e,t)=>t<p&&(0,Vn().AB)(c[e])))||v().dF(u,((e,t)=>!s&&(0,Vn().AB)(c[e])));m=e}m?l().default.afterNextFlush((()=>{ko().bA({environment:t,blockPropertyValueOverlayStore:n,store:o,property:m,format:wt().C.Page,collectionContextStore:r})})):s&&l().default.afterNextFlush((()=>{jn(t,o,r,i)})),ko().xv({environment:t,blockPropertyValueOverlayStore:n}),i.preventEmptyDelete()}function Pn(e,t,o,n,r,i,l,s){const a=n.normalizedSchemaStore.state,c=rn(t,o,n,l,s).map((e=>e.property));let d;if("tab"===e){d=c.length>0?c[0]:void 0}else{d=v().dF(c,((e,t)=>{const o=a[e];return(0,Vn().AB)(o)}))}d&&ko().bA({environment:t,blockPropertyValueOverlayStore:r,store:o,property:d,format:wt().C.Page,collectionContextStore:n}),i.preventEmptyDelete()}class In extends d().default{getInitialState(){return"existing"}preventEmptyDelete(){"new_empty"===this.state&&(this.setState("new"),jo().Z.state.isActive&&jo().Z.setState({...jo().Z.state,transient:!1}))}}const Rn=In;var _n=()=>o(641772),Mn=()=>o(242619),Bn=()=>o(710706);function Fn(e){const t=(0,s().O7)(),n=(0,s().Fy)(),{value:r}=(0,ee().XJ)(de().F.formulas),i=(0,a().VK)((()=>e.collectionContextStore.normalizedFormatStore.state),[e.collectionContextStore.normalizedFormatStore]),l=(0,a().VK)((()=>e.collectionContextStore.getViewType()),[e.collectionContextStore]),c=(0,a().VK)((()=>e.collectionContextStore.permissionScopesStore.state),[e.collectionContextStore.permissionScopesStore]),d=(0,a().VK)((()=>jo().Z.state.isActive&&jo().Z.state.store===e.store),[e.store]),u=(0,a().VK)((()=>c.canEditContent&&e.store.canEdit()),[c.canEditContent,e.store]),p=(0,a().VK)((()=>ze().default.state.open&&ze().default.state.targetStore.id===e.store.id),[e.store.id]),g=(0,a().VK)((()=>{const t=(0,F().kr)(e.collectionContextStore);return(0,Vn().X9)(t,!1)}),[e.collectionContextStore]),S=(0,a().VK)((()=>(0,F().mb)({environment:t,store:e.store,mainEditorCurrentBlockStore:ft().default.state.mainEditorCurrentBlockStore,collectionContextStore:e.collectionContextStore,fullyQualified:!1})),[t,e.store,e.collectionContextStore]),h=(0,a().VK)((()=>ln(e.collectionContextStore)),[e.collectionContextStore]),f=(0,a().VK)((()=>{const o=l?(0,gt().eI)({viewType:l,format:i,visible:!0}):[],n=rn(t,e.store,e.collectionContextStore,d,r);return o.length>0&&o.length!==n.length}),[t,i,d,e.collectionContextStore,e.store,l,r]),y=(0,a().VK)((()=>{var t;const o=ne().default.state;return!("editing"!==o.mode||!e.blockPropertyValueOverlayStore.state.isOpen)&&(null===(t=(0,wn().QY)(o.multiSelection))||void 0===t?void 0:t.store)===(0,gt().JI)(e.store)}),[e.store,e.blockPropertyValueOverlayStore]),v=(0,a().VK)((()=>!(c.isLocked||!c.canEditContent||c.isSyncedCollection||c.isExternallyImportedAndSyncedCollection)&&("collectionTypedView"===e.collectionContextStore.contextType||e.store.canEdit())),[c.canEditContent,c.isExternallyImportedAndSyncedCollection,c.isLocked,c.isSyncedCollection,e.collectionContextStore,e.store]),x=e.lastProxiedUrl&&e.coverFormat&&"contain"!==e.coverAspectFormat&&u,b=v&&!d&&!y&&(h||f),w=d&&!p,k=!e.controlArgs.isRepositioning;return n.isMobile?null:(0,m.jsxs)(o(397174).Z,{isVisible:e.controlArgs.isVisible,position:"top",children:[x&&!e.controlArgs.isRepositioning&&(0,m.jsx)(Vt().Z,{style:Bn().ar,onClick:t=>e.controlArgs.handleRepositionClick(t,e.lastProxiedUrl),children:(0,m.jsx)(C()._H,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})}),x&&e.controlArgs.isRepositioning&&(0,m.jsx)(Vt().Z,{style:Bn().ar,onClick:e.controlArgs.handleSavePositionClick,children:(0,m.jsx)(C()._H,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})}),x&&e.controlArgs.isRepositioning&&(0,m.jsx)(Vt().Z,{style:Bn().ar,onClick:e.controlArgs.handleCancelClick,children:(0,m.jsx)(C()._H,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})}),b&&(0,m.jsx)(Tt().Z,{renderTooltip:()=>(0,m.jsx)(C()._H,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:n=>(0,m.jsx)(Vt().Z,{style:Bn().ar,onClick:()=>{jn(t,e.store,e.collectionContextStore,e.editModeStore,"click")},...n,children:(0,o(519454).R)({width:16,height:16})})}),w&&(0,m.jsx)(Tt().Z,{renderTooltip:()=>g.tooltip,render:o=>(0,m.jsx)(Vt().Z,{style:Bn().ar,onClick:()=>{S&&(hn().c4({environment:t,url:S}),e.editModeStore.preventEmptyDelete())},...o,children:g.icon({width:14,height:14})})}),k&&(0,m.jsx)(Tt().Z,{renderTooltip:()=>(0,m.jsx)(C()._H,{defaultMessage:"Rename, delete, move to and more…",id:"collectionViewCardItem.repositionAction.tooltip"}),render:o=>(0,m.jsx)(Vt().Z,{style:Bn().ar,onClick:o=>{T().Ys({environment:t,store:e.store}),Mn().Qn({environment:t,stores:oe().default.state.stores,left:o.clientX,top:o.clientY,showInput:!0,actionSectionGroupKey:"block_in_collection",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:e.collectionContextStore}})},...o,children:(0,_n().o)({width:14,height:14})})})]})}const Kn=n.memo(Fn);var Ln=()=>o(679791);function On(e){let{propertyFormat:t,store:o,blockPropertyValueOverlayStore:r,collectionContextStore:i,disabled:l,editModeStore:c,isCardSelected:d}=e;const u=(0,s().O7)(),{value:p}=(0,ee().XJ)(de().F.formulas),{collectionStore:g,canEdit:S}=(0,a().VK)((()=>({collectionStore:o.getAssociatedCollectionStore(),canEdit:o.canEdit()})),[o]),{viewType:h,collectionViewStore:f,isTableWrapped:y}=(0,a().VK)((()=>({viewType:i.getViewType(),collectionViewStore:i.collectionViewStore(),isTableWrapped:Boolean(i.normalizedFormatStore.state.table_wrap)})),[i]),v=(0,a().VK)((()=>i.permissionScopesStore.state.isLocked||!i.permissionScopesStore.state.canEditContent),[i.permissionScopesStore]),x=(0,n.useCallback)((()=>Tn("tab",u,o,r,i,c,d,p)),[u,o,r,i,c,d,p]),b=(0,n.useCallback)((()=>Tn("untab",u,o,r,i,c,d,p)),[u,o,r,i,c,d,p]),C=(0,n.useCallback)((()=>function(e,t,o,n){ko().xv({environment:e,blockPropertyValueOverlayStore:t}),T().Ys({environment:e,store:o}),n.preventEmptyDelete()}(u,r,o,c)),[u,r,o,c]);if(!g)return null;const w="gallery"===h?wt().C.GalleryView:wt().C.Board;return(0,m.jsx)(Ln().m,{store:o,property:t.property,disabled:l||!S,locked:v,format:w,tableWrap:y||Boolean(t.wrap),blockPropertyValueOverlayStore:r,collectionStore:g,showIfEmpty:d,onEnter:C,onEsc:C,onBgClick:C,onTab:x,onUntab:b,collectionViewStore:f},t.property)}const Dn=n.memo(On);var En=()=>o(521913),An=()=>o(636340),Hn=()=>o(943620);const Zn=(0,C().vU)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a name…",id:"collectionViewCardItem.itemName.placeholder"}});function zn(e){const{store:t,collectionContextStore:r,editModeStore:i,onTextEsc:l,onTextEnter:d,blockPropertyValueOverlayStore:u,isCardSelected:p}=e,g=(0,s().O7)(),S=(0,s().Fy)().isMobile,h=(0,C().YB)(),{value:f}=(0,ee().XJ)(de().F.formulas),{collectionViewBlockId:y,collectionViewId:v,viewType:x}=(0,a().VK)((()=>{var t,o;return{collectionViewId:null===(t=e.collectionContextStore.collectionViewStore())||void 0===t?void 0:t.id,collectionViewBlockId:null===(o=e.collectionContextStore.collectionViewBlockStore())||void 0===o?void 0:o.id,viewType:e.collectionContextStore.getViewType()}}),[e.collectionContextStore]),b=(0,a().VK)((()=>rn(g,t,r,p,f)),[g,t,r,p,f]),k=(0,a().VK)((()=>(0,X().wI)({collectionContextStore:r,blockStore:t})),[t,r]),{titleStore:V,icon:j,isEmptyPage:R,hasError:_}=(0,a().VK)((()=>({titleStore:(0,gt().JI)(t),icon:t.getIcon(),isEmptyPage:t.isEmptyPage(),hasError:t.hasError()})),[t]),M=(0,a().VK)((()=>(t.hasIcon()||!t.isEmptyPage())&&r.shouldShowPageIcon()),[t,r]),B=(0,a().VK)((()=>{var e;return p?h.formatMessage(Zn.typeAName):(null===(e=t.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,mo().r)(),intl:h}))||h.formatMessage(Zn.untitledBlock)}),[p,h,t]),F=(0,a().VK)((()=>t.canEdit()&&r.permissionScopesStore.state.canEditContent),[t,r]),K=(0,n.useCallback)((()=>{Pn("tab",g,t,r,u,i,p,f)}),[g,t,r,i,u,p,f]),L=(0,n.useCallback)((()=>{Pn("untab",g,t,r,u,i,p,f)}),[g,t,r,i,u,p,f]),O=(0,n.useCallback)((()=>{(0,kn().b)(),P().clear({environment:g});t.canEdit()&&r.permissionScopesStore.state.canEditContent&&("new_empty"===i.state?l(t):"new"===i.state?d(t):T().Ys({environment:g,store:t}),i.preventEmptyDelete())}),[g,t,r.permissionScopesStore,i,l,d]),D=(0,n.useCallback)((()=>{(0,kn().b)();t.canEdit()&&r.permissionScopesStore.state.canEditContent&&("new_empty"===i.state?l(t):T().Ys({environment:g,store:t}),i.preventEmptyDelete())}),[t,r.permissionScopesStore,i,l,g]),E=(0,n.useCallback)((()=>{!function(e,t,o,n){const r=t.getViewType();"board"!==r&&"gallery"!==r||(w().rv({environment:e,collectionContextStore:t,block_id:o.id,property:"title",property_type:"text",from:r}),n.preventEmptyDelete())}(g,r,t,i)}),[g,t,r,i]),A=(0,n.useCallback)((e=>{const o=t.getIconStore();o&&I().createAndCommit({userAction:"CollectionViewCardItemTitle.handleRecordIconChange",environment:g,canUndo:!0,perform:t=>{An().sO({store:o,value:e,transaction:t})}})}),[g,t]),H=(0,c().yK)((e=>{const t=b.length>0;return{titleWrap:{position:"relative",width:"gallery"===x?"100%":"auto",display:"flex",paddingLeft:10,paddingRight:10,paddingBottom:t?6:S?12:8,paddingTop:k?4:S?12:8},recordIcon:{float:"left",borderRadius:5,width:24,height:24,marginLeft:-2,...S?{marginTop:0,marginRight:4}:{marginTop:2,marginRight:4}},warningIcon:{fill:e.accentColors.orange[500],paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom",...S?{width:20,marginLeft:2,marginRight:4}:{width:16,marginLeft:4,marginRight:6}},text:{pointerEvents:p?void 0:"none",cursor:p?"text":void 0,flexGrow:1,padding:"2px 1px",whiteSpace:"pre-wrap",...S?nn:on}}}),[p,S,k,b.length,x]),Z=(0,n.useMemo)((()=>({type:"page_property_value_match",propertyId:"title",collectionViewId:v,collectionViewBlockId:y})),[y,v]),z=(M||p)&&!_;return(0,m.jsxs)("div",{style:H.titleWrap,children:[z&&(0,m.jsx)(Hn().Z,{disabled:!1,bucket:"secure",style:H.recordIcon,progressContainerStyle:H.recordIcon,icon:j,store:t,size:S?24:F?20:18,isEmptyPage:R,onChange:A}),_&&(0,En().t)(H.warningIcon),(0,m.jsx)(o(623498).Z,{store:V,disabled:!p,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:O,onEsc:D,onTab:K,onUntab:L,onChange:E,placeholder:B,style:H.text,disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:Z})]})}const Wn=n.memo(zn);function Gn(e,t){const{store:o,onTextEsc:r,onTextEnter:i,onShiftEnter:l,handleOpenPeekPage:c,collectionContextStore:d,blockPropertyValueOverlayStore:u}=e,p=(0,s().O7)(),g=(0,n.useRef)(null),{value:S}=(0,ee().XJ)(de().F.formulas),h=(0,a().qz)(void 0,mt().Z),f=(0,a().qz)(void 0,Rn),y=(0,a().SI)((()=>{const t=jo().Z.state;return t.isActive&&t.store===e.store}),[e.store]),v=(0,a().Kw)(y),x=(0,a().VK)((()=>oe().default.state.stores.includes(o)),[o]),b=(0,a().VK)((()=>{var e,t,n;return!(o.getSpaceId()!==(null===(e=ft().default.state.currentSpaceStore)||void 0===e?void 0:e.id))&&((null===(t=d.collectionViewStore())||void 0===t?void 0:t.getFormat().app_config_uri)===rt().g3&&o.getFormat().app_config_uri===rt().z3&&"sprint_board"===(null===(n=ft().default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.getFormat().special_page_for_pm_launch))}),[o,d]),C=(0,a().VK)((()=>{const e=ft().default.state.mainEditorCurrentBlockStore;return(0,F().mb)({environment:p,store:o,mainEditorCurrentBlockStore:e,collectionContextStore:d,fullyQualified:!1})}),[p,d,o]),w=(0,n.useCallback)((()=>{jn(p,o,d,f,"space")}),[p,o,d,f]),k=(0,n.useCallback)((()=>{(0,kn().b)(),f.preventEmptyDelete()}),[f]),V=(0,n.useCallback)((()=>{i(o)}),[i,o]),j=(0,n.useCallback)((()=>{Tn("tab",p,o,u,d,f,v,S)}),[p,o,u,d,f,v,S]),T=(0,n.useCallback)((()=>{Tn("untab",p,o,u,d,f,v,S)}),[p,o,u,d,f,v,S]),P=(0,n.useCallback)((()=>{I().createAndCommit({userAction:"CollectionViewCardItem.handleShiftEnter",environment:p,canUndo:!0,perform:e=>{l({blocks:oe().default.state.stores,transaction:e})}})}),[p,l]),R=(0,n.useCallback)((()=>{"new_empty"!==f.state||v||d.defaultPageTemplateStore.state||(r(o),y.removeListener(R))}),[d.defaultPageTemplateStore,f,v,y,r,o]);return(0,mn().K)((()=>{var t;const o=ne().default.state,n=jo().Z.state,r=n.isActive&&n.transient,i="editing"===o.mode&&(null===(t=(0,wn().QY)(o.multiSelection))||void 0===t?void 0:t.store)===(0,gt().JI)(e.store);i&&r?f.setState("new_empty"):i?f.setState("new"):f.setState("existing")})),(0,n.useEffect)((()=>(y.state&&"new_empty"===f.state&&y.addListener(R),()=>{y.removeListener(R)})),[f,y,R]),(0,Ve().ez)(o,t,(0,n.useMemo)((()=>({renderedType:"page",getBlockStore:()=>o,getNode:()=>g.current,activate:()=>{C&&(c(),hn().c4({environment:p,url:C}))}})),[p,c,C,o]),(0,m.jsx)($().Z,{debugName:"CollectionViewCardItem",capture:v,onEsc:k,onEnter:V,onSpace:w,onTab:j,onUntab:T,children:(0,m.jsxs)($().Z,{debugName:"CollectionViewCardItem",capture:x,onShiftEnter:P,children:[(0,m.jsx)(Un,{...e,ref:g,mouseStore:h,editModeStore:f,isCardSelected:v,peekUrl:C}),b&&(0,m.jsx)(yn().bZ,{origin:g})]})}))}const Nn=n.memo(n.forwardRef(Gn)),Un=n.memo(n.forwardRef((function(e,t){const{store:r,disabled:i,peekUrl:l,editModeStore:d,handleOpenPeekPage:u,collectionContextStore:p,blockPropertyValueOverlayStore:g,mouseStore:S,isCardSelected:h,coverFormat:f,coverAspectFormat:y,colorStyle:v,coverSizeFormat:x,coverWidth:C,coverHeight:w}=e,k=(0,s().O7)(),V=(0,s().Fy)().isMobile,j=(0,ae().Dq)(),{value:T}=(0,ee().XJ)(de().F.formulas),[P,R]=(0,n.useState)(void 0),_=(0,a().VK)((()=>S.state.mouseEntered),[S]),{viewType:M,isInHomeWidget:B}=(0,a().VK)((()=>({viewType:p.getViewType(),isInHomeWidget:p.isInHomeWidgetStore.state})),[p]),F=(0,a().VK)((()=>(0,Cn().ZP)({store:r,fullyQualified:!1,pageVisitSource:Go().tY.LinkInPage})),[r]),K=(0,a().VK)((()=>ln(p)),[p]),L=(0,a().VK)((()=>rn(k,r,p,h,T)),[k,r,p,h,T]),O=(0,a().VK)((()=>(0,X().Cr)({collectionContextStore:p,blockStore:r})),[p,r]),D=(0,a().VK)((()=>(0,X().wI)({collectionContextStore:p,blockStore:r})),[p,r]),E=(0,a().VK)((()=>(0,o(852465).Xp)(r,{recursivelyLoadAllDiscussions:!1})>0),[r]),A=(0,n.useCallback)((e=>{R(e)}),[R]),H=(0,n.useCallback)((e=>{u(),d.preventEmptyDelete()}),[d,u]),Z=(0,n.useCallback)((()=>{Oe().Z.state||S.setState({...S.state,mouseEntered:!0})}),[S]),z=(0,gn().z)(Z,100),W=(0,n.useCallback)((()=>{S.setState({...S.state,mouseEntered:!1})}),[S]),G=(0,pn().y)(W,100),N=(0,n.useCallback)((e=>{I().createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:k,canUndo:!0,perform:t=>{Sn().bf({store:r,coverPosition:e.imagePosition,transaction:t}),e.reset()}})}),[k,r]),U=(0,n.useCallback)((e=>null!=j&&j.isPreviewing?null:(0,m.jsx)(Kn,{store:r,collectionContextStore:p,blockPropertyValueOverlayStore:g,coverFormat:f,coverAspectFormat:y,lastProxiedUrl:P,editModeStore:d,controlArgs:e})),[g,p,j,y,f,d,P,r]),$=(0,c().yK)((e=>{const t="board"===M?(null==v?void 0:v.cardBackgroundColor)||e.boardItemDefaultBackground:e.collectionGalleryPreviewCardBackground,o={background:t,boxShadow:e.homeShadow.card.base};return{linkBox:{borderRadius:xl,position:_?"relative":"static",overflow:"hidden",transition:"background 100ms ease-out",background:t,..."board"===M?{marginBottom:V?10:8}:{height:"100%"},...B?{boxShadow:e.homeShadow.card.base}:{boxShadow:e.shadowXS}},linkBoxInner:{userSelect:h?void 0:"none",WebkitUserSelect:h?void 0:"none",height:"100%",..."board"===M?{minHeight:40}:{display:"flex",flexDirection:"column"}},linkBoxHomeWidget:{background:t,boxShadow:e.homeShadow.card.base},linkBoxHovered:B?o:{background:(null==v?void 0:v.cardHoveredBackgroundColor)||e.cardHoveredBackground},linkBoxPressed:B?o:{background:(null==v?void 0:v.cardPressedBackgroundColor)||e.cardPressedBackground},propertiesWrapper:{paddingTop:K?0:8,lineHeight:1.5,display:"flex",flexDirection:"column",..."board"===M?{paddingBottom:6}:{paddingBottom:8,...B&&{flexWrap:"wrap"}}},iconsWrapper:{display:"flex",alignItems:"center",paddingRight:10,paddingBottom:E?4:8,paddingLeft:!E||D||K?10:4,paddingTop:"gallery"===M&&0===L.length?8:0,marginTop:"board"===M&&E?-2:0},commentsIndicatorWrapper:{display:"flex",alignItems:"center",color:e.lightTextColor,fill:e.lightTextColor,fontWeight:b().Ue.medium,fontSize:12}}}),[M,v,_,V,B,h,E,D,K,L.length]);return"board"!==M&&"gallery"!==M?null:(0,m.jsxs)(bn().Z,{ref:t,href:F,metaHref:V?F:l,onMouseEnter:z,onMouseMove:z,onMouseLeave:G,onClick:H,style:$.linkBox,innerStyle:$.linkBoxInner,hoveredStyle:h?{background:$.linkBox.background}:$.linkBoxHovered,pressedStyle:h?{background:$.linkBox.background}:$.linkBoxPressed,children:[(0,m.jsx)(o(910293).Z,{store:r,source:M,mouseStore:S,renderControl:U,small:"small"===x,onFlushTemporaryPosition:N,render:e=>{let{imagePosition:t}=e;return f&&(0,m.jsx)(o(681035).S,{variant:"gallery",store:r,coverWidth:C,coverHeight:w,coverFormat:f,coverAspectFormat:y,coverSizeFormat:x,coverPosition:t,showEmptyGalleryCover:"gallery"===M,onLoadProxiedImage:A,isInHomeWidget:p.isInHomeWidgetStore.state})}}),O&&(0,m.jsx)("div",{style:{paddingRight:6,paddingTop:8,paddingBottom:0,paddingLeft:6,maxWidth:"100%"},children:(0,m.jsx)(vn().O,{blockStore:r,collectionContextStore:p})}),K&&(0,m.jsx)(Wn,{collectionContextStore:p,store:r,blockPropertyValueOverlayStore:g,onTextEsc:e.onTextEsc,onTextEnter:e.onTextEnter,editModeStore:e.editModeStore,isCardSelected:e.isCardSelected}),L.length>0&&(0,m.jsx)("div",{style:$.propertiesWrapper,children:L.map((e=>(0,m.jsx)(Dn,{store:r,disabled:i,blockPropertyValueOverlayStore:g,collectionContextStore:p,editModeStore:d,isCardSelected:h,propertyFormat:e},e.property)))}),(E||D)&&(0,m.jsxs)("div",{style:$.iconsWrapper,children:[D&&(0,m.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,m.jsx)(xn().B,{blockStore:r,collectionContextStore:p})}),(0,m.jsx)(fn().s,{store:r,iconStyle:$.commentsIndicatorWrapper,buttonStyle:{position:"relative",marginLeft:D?-3:0}})]})]})})));const $n=function(e){let{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:g,coverFormat:S,coverAspectFormat:h,coverSizeFormat:f,colorStyle:y,onTextEnter:v,onTextEsc:x,onShiftEnter:b,blockPropertyValueOverlayStore:C,handleOpenPeekPage:w,collectionContextStore:k}=e;return(0,m.jsx)(Nn,{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:g,coverFormat:S,coverAspectFormat:h,coverSizeFormat:f,coverHeight:void 0,coverWidth:void 0,colorStyle:y,onTextEnter:v,onTextEsc:x,onShiftEnter:b,blockPropertyValueOverlayStore:C,handleOpenPeekPage:w,collectionContextStore:k})};var qn=()=>o(729201),Yn=()=>o(84080);class Qn extends d().default{getInitialState(){return{}}}const Xn=Qn;var Jn=()=>o(41340),er=()=>o(732388);const tr=function(e){let{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:g,coverFormat:S,coverAspectFormat:h,coverSizeFormat:f,coverHeight:y,coverWidth:v,onTextEnter:x,onTextEsc:b,onShiftEnter:C,blockPropertyValueOverlayStore:w,handleOpenPeekPage:k,collectionContextStore:V}=e;return(0,m.jsx)(er().v,{store:t,step:"demo_collection_record",children:(0,m.jsx)(Nn,{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:g,coverFormat:S,coverAspectFormat:h,coverSizeFormat:f,coverHeight:y,coverWidth:v,colorStyle:void 0,onTextEnter:x,onTextEsc:b,onShiftEnter:C,blockPropertyValueOverlayStore:w,handleOpenPeekPage:k,collectionContextStore:V})})};function or(e){let{collectionContextStore:t,groupFormat:o,format:r,schema:i,disabled:l,store:c,blockPropertyValueOverlayStore:d,collectionGalleryViewStore:u,isSingleColumn:p}=e;const g=(0,s().O7)(),S=(0,n.useMemo)((()=>o?[o]:[]),[o]),h=(0,a().Kw)(t.permissionScopesStore),f=(0,a().VK)((()=>c.canEdit()&&("collectionTypedView"===t.contextType||h.canEditContent)),[t,h.canEditContent,c]),y=(0,n.useCallback)((e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();T().eP({environment:g,store:e}),P().setSelectionAtEnd({store:o}),(0,$o().v)({store:e})}}),[g]),v=(0,n.useCallback)((e=>{const o=t.collectionStore(),n=e.getTitleStore();if(!n)return;yt().QaF(n.getValue())?T().Ys({environment:g,store:e}):o&&I().createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:g,canUndo:!0,perform:t=>{ut().Od({store:e,transaction:t})}})}),[t,g]),x=(0,n.useMemo)((()=>p?{position:"absolute",top:6,left:0,right:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}),[p]),{gallery_cover:b,gallery_cover_aspect:C,gallery_cover_size:w}=r,k=!l&&f&&!h.isSyncedCollection,{coverHeight:V,coverWidth:j}=(0,a().VK)((()=>{const{coverHeight:e,coverWidth:t}=u.state;return{coverHeight:e,coverWidth:t}}),[u]),R=(0,n.useMemo)((()=>({format:r,schema:i,onTextEnter:v,onTextEsc:v,onShiftEnter:y,disabled:l,coverFormat:b,coverAspectFormat:C,coverSizeFormat:w,coverHeight:V,coverWidth:j,blockPropertyValueOverlayStore:d,collectionContextStore:t})),[d,t,V,j,C,b,w,l,r,y,v,i]);return(0,m.jsx)(Lo,{collectionContextStore:t,groupsPointer:S,format:r,canDrag:k,onSelectableEnter:y,resultProps:R,resultComponent:tr,canDrop:!0,disabled:l,shouldShowHoverMenu:!1,direction:p?Fo.Vertical:Fo.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:x,loadContentCover:b&&"page_content"===b.type})}const nr=n.memo(or);var rr=()=>o(384510),ir=()=>o(668001);function lr(e){const t=e.minHeight||gl,o=(0,c().yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:e.largeShimmerColor,minHeight:t}})),[t]);return(0,m.jsx)(ir().Z,{style:o.card})}function sr(e){const{hasPartialResults:t}=e;if(!(0,qn().Z)(!0,0,100))return null;const o=e.coverHeight??rr().Z.card.desktop.medium.height,n=t?void 0:o+40,r=t?1:3,i=v().DZ(r,(e=>(0,m.jsx)(lr,{minHeight:n},e)));return(0,m.jsx)(m.Fragment,{children:i})}function ar(e){var t;let{groupFormat:o,store:r,format:i,disabled:l,collectionContextStore:d,schema:u,blockPropertyValueOverlayStore:p,isFullScreen:g,collectionGalleryViewStore:S}=e;const h=(0,s().O7)(),{isMobile:f}=(0,s().Fy)(),y=(0,n.useMemo)((()=>o?[o]:[]),[o]),v=(0,a().VK)((()=>h.WindowSizeStore.state.width<=ml),[h.WindowSizeStore]),x=(0,a().VK)((()=>d.groupsStore.anyGroupHasResults()),[d]),b=(0,a().VK)((()=>d.groupsStore.getGroupState(y)),[d,y]),C=(0,a().VK)((()=>S.state.coverHeight),[S]),{reducerResult:w,hasPartialResults:k}=(0,a().VK)((()=>{const e=null==b?void 0:b.reducerResultStore.state;return{reducerResult:e,hasPartialResults:void 0!==e&&(null==e?void 0:e.blockIds.length)>0}}),[b]),V=(0,a().VK)((()=>(0,Wo().H0)({collectionContextStore:d,groupsPointer:y,hasPartialResults:k})),[d,y,k]),j=(0,a().VK)((()=>F().VM({collectionContextStore:d,reducerResult:w,isFullScreen:g})),[d,w,g]),{canEditContent:T,isSyncedCollection:P}=(0,a().VK)((()=>{const e=d.permissionScopesStore.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[d]),I=(0,a().VK)((()=>r.canEdit()&&("collectionTypedView"===d.contextType||T)),[r,d,T]),R=(0,a().Kw)(d.isInHomeWidgetStore),_=(0,c().yK)((e=>{const t=i.collection_group_by,n=i.gallery_cover_size,r=f?nn.fontSize:on.fontSize;return{container:{paddingBottom:o?16:void 0},resultsWrapper:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${v?"100%":`${F().rD(n)}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:t?1:16,paddingBottom:4,...R?{paddingLeft:8,paddingRight:8}:{}},loadMoreButton:{fontSize:r},loadMoreButtonIcon:{width:r,height:r},renderLoadMoreButtonDivider:{width:"100%",borderTop:o?void 0:`1px solid ${e.tableDividerColor}`,marginTop:4,marginBottom:4}}}),[i.collection_group_by,i.gallery_cover_size,o,R,f,v]);if(!b)return null;const M=void 0!==o,B=!R&&x&&!l&&I&&!P&&(k||!V),K=Boolean(null===(t=i.gallery_properties)||void 0===t||null===(t=t.filter((e=>e.visible)))||void 0===t?void 0:t.length);return(0,m.jsxs)("div",{style:_.container,children:[(0,m.jsxs)("div",{style:_.resultsWrapper,children:[(0,m.jsx)(nr,{collectionContextStore:d,groupFormat:o,format:i,schema:u,disabled:l,store:r,blockPropertyValueOverlayStore:p,collectionGalleryViewStore:S,isSingleColumn:v}),V&&(0,m.jsx)(sr,{hasGroups:M,hasPartialResults:k,coverHeight:C}),B&&(0,m.jsx)(dr,{collectionContextStore:d,groupsPointer:y,groupFormat:o,isSingleColumn:v,coverHeight:i.gallery_cover&&C?C:0,isFullScreen:g,hasVisibleProperties:K})]}),j&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{style:_.renderLoadMoreButtonDivider}),(0,m.jsx)(co().ZP,{groupsPointer:y,store:r,collectionContextStore:d,format:i,isFullScreen:g,incrementLimitsInRelatedGroups:!1,style:_.loadMoreButton,iconStyle:_.loadMoreButtonIcon})]})]})}const cr=n.memo(ar);function dr(e){let{groupsPointer:t,groupFormat:o,collectionContextStore:r,isSingleColumn:i,coverHeight:l,isFullScreen:d,hasVisibleProperties:u}=e;const p=(0,s().O7)(),g=(0,C().YB)(),{isMobile:S}=(0,s().Fy)(),h=(0,n.useContext)(Jn().Z),f=(0,a().VK)((()=>F().Il({collectionContextStore:r,environment:p,intl:g})),[r,p,g]),y=(0,n.useCallback)((e=>{h?h(e):hn().c4({environment:p,url:e})}),[p,h]),v=(0,n.useCallback)((e=>{if(!(0,Ge().ww)(p))return void(0,Ge().eD)(p);const o=r.groupsStore.getGroupState(t);o&&I().createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:p,canUndo:!0,perform:e=>{const{mainEditorCurrentBlockStore:n}=ft().default.state,i=ut().IW({environment:p,collectionContextStore:r,groupsPointer:t,shouldCoerce:!0,templateStore:r.defaultPageTemplateStore.state,transaction:e,from:{createBlock:"gallery"},inMemoryRecordCache:p.defaultRecordCache.inMemoryRecordCache});if(!i)return;const l=F().mb({environment:p,store:i.newStore,mainEditorCurrentBlockStore:n,collectionContextStore:r})??(0,Cn().ZP)({store:i.newStore,pageVisitSource:Go().tY.Create});y(l),V().Xd({collectionContextStore:r,resultsStore:o.resultsStore}),Co().W(p,{from:"gallery_view_add_item_bottom",type:"page",new_page_id:i.newStore.id,creating_block_id:i.newStore.id,...(0,ge().Pn)(r)})}})}),[p,r,t,y]),x=(0,c().yK)((e=>{const t=S?nn.fontSize:on.fontSize,o=F().ml({isMobile:S}),n=d&&l&&!i?u?l+o:l:o;return{wrapper:{display:"flex",flexDirection:"column",alignItems:"stretch"},addItemButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:S?nn.fontSize:on.fontSize,borderRadius:xl,boxShadow:"dark"===e.mode?`${e.darkDividerColor} 0px 0px 0px 1px`:`${e.regularDividerColor} 0px 0px 0px 1px`,padding:S?"12px 14px 12px 14px":"9px 14px 8px",minHeight:n,height:"100%"},linkExistingButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:S?nn.fontSize:on.fontSize,borderRadius:xl,padding:S?"12px 14px 12px 14px":"9px 14px 8px",marginTop:8},buttonContent:{display:"flex",alignItems:"center",marginLeft:-6,color:e.lightIconColor},buttonIcon:{width:t,height:t,marginLeft:i?void 0:-1,marginRight:6,fill:e.lightIconColor}}}),[S,i,l,d,u]);return(0,m.jsxs)("div",{style:x.wrapper,children:[(0,m.jsx)(Vt().Z,{onClick:v,onMouseDown:ye().$0,style:x.addItemButton,children:(0,m.jsxs)("div",{style:x.buttonContent,children:[(0,lo().R)(x.buttonIcon),(0,m.jsx)(Jo,{collectionContextStore:r})]})}),f&&(0,m.jsx)(dn().a,{collectionContextStore:r,groupFormat:o,renderLinkButton:e=>(0,m.jsx)(Vt().Z,{style:x.linkExistingButton,...e,children:(0,m.jsxs)("div",{style:x.buttonContent,children:[(0,cn().v)(x.buttonIcon),(0,m.jsx)(C()._H,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})})]})}var ur=()=>o(260799),pr=()=>o(730398),mr=()=>o(521573),gr=()=>o(518645),Sr=()=>o(757216),hr=()=>o(392423),fr=()=>o(352230),yr=()=>o(855238),vr=()=>o(198829),xr=()=>o(255577),br=()=>o(470386),Cr=()=>o(388284),wr=()=>o(129636);const kr="color";const Vr=function(e){let{parent:t,groupFormat:o,collectionContextStore:r,groupsFormatKey:i,format:l,query:c,currentGroups:d,groupsLimitStore:u,schema:p}=e;const g=(0,s().O7)(),S=(0,C().YB)(),{device:h}=g,f=(0,a().VK)((()=>v().oA([Pr(g,o,r,i,l,c,d,u,S),jr(g,p,o,r)])),[g,o,r,i,l,c,d,u,S,p]),y=(0,n.useCallback)((e=>{"string"==typeof e.key&&e.key.includes(kr)||t.close()}),[t]);let x;return x=h.isMobile?{menuType:fr().o.Modal,title:(0,m.jsx)(C()._H,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:(0,m.jsx)(br().DoneMenuText,{}),onClickRight:t.close}:{menuType:fr().o.Popup},(0,m.jsx)(vr().Z,{...x,children:(0,m.jsx)(xr().ZP,{type:xr().iW.Vertical,initialFocus:0,sections:f,onAccept:y})})};function jr(e,t,o,n){const r=o.value;if(void 0===r.value)return;const i=t[o.property];if(!i)return;if("select"!==i.type&&"multi_select"!==i.type)return;if(r.type!==i.type)return;const l=(i.options||[]).find((e=>e.value===r.value));if(!l)return;const s=Qo().AP.map((r=>{const i={key:`${kr}_${r}`,render:e=>(0,m.jsx)(wr().Z,{...e,color:r,checkState:l.color===r}),action:()=>{!function(e,t,o,n,r){const i=n[o.property];if(!i)return;if(!io().cu(i))return;const l=r.collectionStore();if(!l)return;const s=o.value;if(s.type!==i.type)return;const a=(i.options||[]).map((t=>t.value===s.value?{...t,color:e}:t)),c={...i,options:a},d={...n,[o.property]:c};I().createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:t,canUndo:!0,perform:e=>{(0,gr().R)({environment:t,collectionStore:l,update:{schema:d},transaction:e})}}),w().wd({environment:t,collectionContextStore:r,action:"group_change_color"})}(r,e,o,t,n)}};return i}));return{key:"collection color section",render:e=>(0,m.jsx)(Cr().Z,{...e,title:(0,m.jsx)(C()._H,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0}),items:s}}function Tr(e,t,o,n,r,i){go().vC({message:(0,m.jsx)(C()._H,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:()=>async function(e,t,o,n,r,i){const l=t.collectionStore();if(!l)return;const s=n.value;if("relation"===s.type&&(0,ro().RA)(s.value)){const e=te().G.createChildStore(l,{id:s.value.id,table:L().iU});await e.load();const t=e.getAssociatedCollectionStore();await(null==t?void 0:t.load())}I().createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:e,canUndo:!0,perform:s=>{ut().iE({environment:e,collectionStore:l,property:n.property,groupFormat:n,currentGroups:o,groupsFormatKey:r,collectionContextStore:t,transaction:s,intl:i})}}),w().wd({environment:e,collectionContextStore:t,action:"delete_group"})}(e,t,o,n,r,i)}]})}function Pr(e,t,o,n,r,i,l,s,a){const c=[],d=t.value,u=o.permissionScopesStore.state;("board_columns"===n?void 0===i.aggregations:void 0===r.collection_group_aggregation)?c.push({key:"addAggregation",render:e=>(0,m.jsx)(yr().Z,{...e,title:(0,m.jsx)(C()._H,{defaultMessage:"Show aggregation",id:"database.collectionGroupActionMenu.addAggregationTitle"}),svg:mr().g}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:[ro().Vb]};I().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{(0,Sr().i)({collectionViewStore:r,update:{query2:t},transaction:e})}})}else I().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{Sn().FH({stores:[r],update:{collection_group_aggregation:ro().Vb},transaction:e})}})}(e,n,i,o)}):c.push({key:"removeAggregation",render:e=>(0,m.jsx)(yr().Z,{...e,title:(0,m.jsx)(C()._H,{defaultMessage:"Hide aggregation",id:"database.collectionGroupActionMenu.removeAggregationTitle"}),svg:pr().p}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:void 0};I().createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,canUndo:!0,perform:e=>{(0,hr().E)({collectionViewStore:r,update:t,transaction:e})}})}else I().createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,canUndo:!0,perform:e=>{Sn().FH({stores:[r],update:{collection_group_aggregation:void 0},transaction:e})}})}(e,n,i,o)}),(0,ro().eF)(t)?c.push({key:"show",render:e=>(0,m.jsx)(yr().Z,{...e,title:(0,m.jsx)(C()._H,{defaultMessage:"Show group",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:mr().g}),action:()=>function(e,t,o,n,r,i){const l={...t,hidden:!1},s=(0,ho().nr)(r,l,i.state);I().createAndCommit({userAction:"CollectionGroupActionMenu.handleShow",environment:e,canUndo:!0,perform:e=>{ut().A6({collectionContextStore:o,newGroups:s,groupsFormatKey:n,transaction:e})}}),w().wd({environment:e,collectionContextStore:o,action:"show_group"})}(e,t,o,n,l,s)}):c.push({key:"hide",render:e=>(0,m.jsx)(yr().Z,{...e,title:(0,m.jsx)(C()._H,{defaultMessage:"Hide group",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:pr().p}),action:()=>function(e,t,o,n,r){const i={...t,hidden:!0},l=(0,ho().ar)(r,i);I().createAndCommit({userAction:"CollectionGroupActionMenu.handleHide",environment:e,canUndo:!0,perform:e=>{ut().A6({collectionContextStore:o,newGroups:l,groupsFormatKey:n,transaction:e})}}),w().wd({environment:e,collectionContextStore:o,action:"hide_group"})}(e,t,o,n,l)}),void 0===d.value||!u.canEditContent||u.isSyncedCollection||"collectionTypedView"===o.contextType||u.isExternallyImportedAndSyncedCollection||c.push({key:"delete",render:e=>(0,m.jsx)(yr().Z,{...e,title:(0,m.jsx)(C()._H,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:st().y}),action:()=>Tr(e,o,l,t,n,a)});return{key:"collection group",render:e=>(0,m.jsx)(Cr().Z,{...e}),items:c}}var Ir=()=>o(332143),Rr=()=>o(921743),_r=()=>o(667247),Mr=()=>o(164079);function Br(e,t){const{calculating:o,aggregation:n}=e.asyncAggregationStatusStore.state;return n?o&&(0,v().Xy)(t,n):o}function Fr(e){let{collectionContextStore:t,aggregation:o,children:r}=e;const{isCalculating:i,changingType:l}=(0,a().VK)((()=>({isCalculating:Br(t,o),changingType:t.asyncAggregationStatusStore.state.changingType})),[t,o]),s=function(e,t){const o=(0,n.useRef)(e);return(0,n.useEffect)((()=>{t||void 0===e&&"-"===e||(o.current=e)}),[t,e]),o.current}(r,i);return i?l?(0,m.jsx)(sn().Z,{}):(0,m.jsx)("span",{style:{opacity:.5},children:s??r}):(0,m.jsx)(m.Fragment,{children:r})}var Kr=()=>o(461843);const Lr=(0,C().vU)({propertyAggregation:{id:"collection.aggregation.propertyType",defaultMessage:"{aggregationType} in {propertyName}{calculating, select, true { (Calculating…)} other {}}"},aggregationType:{id:"collection.aggregation.aggregationType",defaultMessage:"{aggregationType}{calculating, select, true { (Calculating…)} other {}}"},aggregationCalculating:{id:"collection.aggregation.calculating",defaultMessage:"Calculating…"}});var Or=()=>o(827973),Dr=()=>o(448419),Er=()=>o(868744);function Ar(e){let{schema:t,groupFormat:o,format:n,groupAggregationKey:r,collectionContextStore:i,disabled:l}=e;const d=(0,c().Fg)(),u=(0,s().Fy)(),p=(0,a().VK)((()=>n[r]||{aggregator:"count"}),[n,r]),g=(0,a().VK)((()=>({type:"aggregation",filter:(0,po().zk)({schema:t,group:o,groupBy:i.getGroupByAndGroupFormats().groupBy,propertyMapping:void 0,timeZone:(0,mo().r)(),experimentService:Le().default}),aggregation:p})),[i,t,o,p]);return(0,m.jsx)(Tt().Z,{renderTooltip:()=>(0,m.jsx)(qr,{schema:t,collectionContextStore:i,aggregation:p}),render:e=>(0,m.jsx)(Dr().ZP,{popupType:u.isMobile?Dr().Z4.SlideUp:Dr().Z4.Popup,renderOrigin:n=>(0,m.jsx)(et().D,{disabled:l,style:{fontWeight:b().Ue.medium,color:d.lightTextColor,height:24},...(0,Mr().Z)((0,Mr().Z)(e,n),{onClick:ye().Wi}),children:(0,m.jsx)($r,{schema:t,collectionContextStore:i,groupFormat:o,aggregation:p,reducer:g})}),disabled:l,render:e=>(0,m.jsx)(Ur,{aggregation:p,parent:e,collectionContextStore:i,format:n,groupAggregationKey:r,schema:t})})})}function Hr(e){let{aggregationType:t,isSelected:o,label:n,props:r}=e;const i=_r().Sn[t];return(0,m.jsx)(Tt().Z,{placement:Me().Placement.Right,delayThreshold:0,render:e=>(0,m.jsx)(Or().Z,{title:n,checkState:o,...(0,Mr().Z)(e,r)}),renderTooltip:()=>(0,m.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[i&&(0,m.jsx)("img",{src:(0,Rr().D)(i),style:{borderRadius:6,width:140,marginTop:4}}),_r().BG[t]]})},r.key)}function Zr(e,t,o,n,r){const i=o.collectionViewStore();i&&(o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),I().createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:t,canUndo:!0,perform:t=>{(0,Sr().i)({collectionViewStore:i,update:{format:{...n,[r]:e}},transaction:t})}})),w().wd({environment:t,collectionContextStore:o,action:"change_aggregation"})}function zr(e,t,o,n,r,i,l){const s=_r().VN[o];return{key:o,render:t=>(0,m.jsx)(Hr,{isSelected:e,aggregationType:o,label:s,props:t}),action:()=>{Zr({aggregator:o,enforceMaxAggregationLimit:t},n,r,i,l)}}}function Wr(e,t,o,n,r){const i=e.enforceMaxAggregationLimit??!1,l={...e,enforceMaxAggregationLimit:!i};return{key:"aggregationLimitToggle",render:e=>(0,m.jsx)(Kr().Z,{on:i,menuListItemProps:e}),action:()=>Zr(l,t,o,n,r)}}function Gr(e,t,o,n,r,i,l,s){const{device:a}=n,c=_r().VN[t],d=v().oA(o.map((o=>function(e,t,o,n,r,i,l,s,a){const c=i[t];if(!c)return;const d=c.name;return{key:`${t}${o}`,render:t=>(0,m.jsx)(Hr,{isSelected:e,aggregationType:o,label:d,props:t}),action:()=>{Zr({aggregator:o,property:t,enforceMaxAggregationLimit:n},r,l,s,a)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,e.enforceMaxAggregationLimit??!1,n,r,i,l,s)))),u=d.findIndex((o=>o.key===`${e.property}${t}`));return{key:t+c,render:(e,t)=>(0,m.jsx)(Er().Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,m.jsx)(Or().Z,{...e,ref:t,title:c}),renderExtension:(e,o)=>{let n;return n=a.isMobile?{menuType:fr().o.Modal,title:c,right:a.isPhone?(0,m.jsx)(br().DoneMenuText,{}):void 0,onClickRight:o.close,...e}:{menuType:fr().o.Popup,width:200,...e},(0,m.jsx)(vr().Z,{...n,children:(0,m.jsx)(xr().ZP,{type:xr().iW.Vertical,initialFocus:u,sections:[{key:"results",render:e=>(0,m.jsx)(Cr().Z,{...e}),items:d}],onAccept:t.onAccept})})}}),action:()=>null}}function Nr(e,t,o,n,r,i){const l={};for(const u of Ir().o5)l[u]=zr(e.aggregator===u,e.enforceMaxAggregationLimit??!1,u,t,o,n,r);const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ir().iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(i);if(s.length>0)for(const u of Ir().Sy)"show_unique"!==u&&(l[u]=Gr(e,u,s,t,i,o,n,r));const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ir().O4)(o)}))}(i);if(a.length>0)for(const u of Ir().k$)l[u]=Gr(e,u,a,t,i,o,n,r);const c=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ir().dN)(o)}))}(i);if(c.length>0)for(const u of Ir().f8)l[u]=Gr(e,u,c,t,i,o,n,r);const d=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ir().Mv)(o)}))}(i);if(d.length>0)for(const u of Ir().gC)l[u]=Gr(e,u,d,t,i,o,n,r);return l}function Ur(e){let{aggregation:t,parent:o,collectionContextStore:n,format:r,groupAggregationKey:i,schema:l}=e;const a=(0,s().O7)(),{device:c}=a,{actions:d,initialFocus:u}=function(e,t,o,n,r,i){const{device:l}=t,s=[];let a=0,c=0;const d=Nr(e,t,o,n,r,i);let u=0;return Object.entries(Ir().cY).forEach((i=>{let[p,g]=i;const S=[];for(const t of g)d[t]&&(S.push(d[t]),e.aggregator===t&&(a=u,c=S.length-1));const h=[];if("count_aggregations"===p&&h.push({key:"limitToggleSection",render:e=>(0,m.jsx)(Cr().Z,{...e}),items:[Wr(e,t,o,n,r)]}),h.push({key:"aggregations",render:e=>(0,m.jsx)(Cr().Z,{topBorder:!0,...e}),items:S}),S.length>0){u++;const e=_r().nL[p],t={key:e,render:(t,o)=>(0,m.jsx)(Er().Z,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,m.jsx)(Or().Z,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=l.isMobile?{menuType:fr().o.Modal,title:e,right:(0,m.jsx)(br().DoneMenuText,{}),onClickRight:n.close,...t}:{menuType:fr().o.Popup,width:250,...t},(0,m.jsx)(vr().Z,{...r,children:(0,m.jsx)(xr().ZP,{type:xr().iW.Vertical,initialFocus:c,sections:h,onAccept:(e,t,r)=>{n.close(),o.onAccept&&o.onAccept(e,t,r)}})})}}),action:()=>null};s.push(t)}})),{actions:s,initialFocus:a}}(t,a,n,r,i,l);let p;return p=c.isMobile?{menuType:fr().o.Modal,title:(0,m.jsx)(C()._H,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:(0,m.jsx)(br().DoneMenuText,{}),onClickRight:o.close}:{menuType:fr().o.Popup,width:200},(0,m.jsx)(vr().Z,{...p,children:(0,m.jsx)(xr().ZP,{type:xr().iW.Vertical,initialFocus:u,sections:[{key:"aggregation section",render:e=>(0,m.jsx)(Cr().Z,{...e}),items:d}],onAccept:o.close})})}function $r(e){let{schema:t,collectionContextStore:o,groupFormat:n,aggregation:r,reducer:i}=e;return i?(0,m.jsx)(So().Z,{id:`group_aggregation:${(0,ro().mD)(n)}`,collectionContextStore:o,reducer:i,groupsPointer:[n],render:e=>{const n=e.state;let i,l;if((0,Ir().pK)(r)){const e=t[r.property];!e||"formula"!==e.type&&"number"!==e.type||(i=e.number_format),e&&"date"===e.type&&(l=e.date_format)}return(0,m.jsx)(Fr,{aggregation:r,collectionContextStore:o,children:n?(0,_r().Zy)({numberFormat:i,dateFormat:l,aggregation:r,userTimeZone:(0,mo().r)(),value:n.aggregationResult,numberPrecision:void 0}):"–"})}}):null}function qr(e){let{schema:t,collectionContextStore:o,aggregation:n}=e;const r=(0,C().YB)(),i=_r().VN[(0,Ir().OV)(n)],l=(0,a().VK)((()=>Br(o,n)),[o,n]);if((0,Ir().pK)(n)){const e=t[n.property];if(e){const t=e.name;return(0,m.jsx)(m.Fragment,{children:r.formatMessage(Lr.propertyAggregation,{aggregationType:i,propertyName:t,calculating:l})})}}return(0,m.jsx)(m.Fragment,{children:r.formatMessage(Lr.aggregationType,{aggregationType:i,calculating:l})})}var Yr=()=>o(157593),Qr=()=>o(439320);function Xr(e){const{onMount:t,isInPeekRenderer:o,style:r,paddingTop:i,disabled:d,stickyStyle:u,transitionStickyStyle:p,groupFormat:g,collectionContextStore:S,format:h,groupAggregationKey:f,stickyWrapStyle:y}=e,[v,x]=(0,n.useState)(void 0),b=(0,s().O7)(),C=(0,c().Fg)(),w=(0,ae().Dq)(),k=(0,n.useRef)(null);(0,n.useEffect)((()=>{null==t||t()}),[t]),(0,n.useEffect)((()=>{const e=S.collectionViewBlockStore();e&&x(new(te().G)(b,{table:L().iU,id:e.id}))}),[S,b]);const V=(0,a().VK)((()=>S.groupsStore.getGroupState(g)),[S.groupsStore,g]),j=(0,a().VK)((()=>null==V?void 0:V.toggleStateStore.state),[V]),P=(0,a().Kw)(S.permissionScopesStore),R=(0,a().VK)((()=>!d&&S.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[S,d]),_=(0,a().Kw)(S.isInHomeWidgetStore),M=(0,a().VK)((()=>void 0!==h[f]&&!(null!=w&&w.isPreviewing)),[h,f,w]),B=(0,F().jw)(S,C),K=(0,a().VK)((()=>_?"transparent":(null==B?void 0:B.background)||void 0),[B,_]),O=(0,c().yK)((t=>{const n=o?t.cardContentBackground:t.contentBackground;return{topLevelDiv:{position:"relative",zIndex:at().sL,width:"100%",background:void 0===K?n:K,fontSize:14,overflow:e.stickyLeft?void 0:"auto",...r},stickyWrapStyle:{display:"flex",alignItems:"center",height:e.height??33,paddingTop:i,...e.stickyLeft&&{position:"sticky",left:e.isFullScreen||e.isRootChild?e.paddingLeft:0},...!j&&{marginBottom:e.toggleClosedMarginBottom},...y}}}),[K,o,j,i,e.height,e.isFullScreen,e.isRootChild,e.paddingLeft,e.stickyLeft,e.toggleClosedMarginBottom,r,y]),D=(0,a().VK)((()=>b.WindowSizeStore.state.height),[b.WindowSizeStore]),E=(0,n.useCallback)((()=>{if(!V)return;T().ZH({environment:b});const e=!j;if(ut().uo({environment:b,groupFormat:g,toggleStateStore:V.toggleStateStore,newValue:e,collectionContextStore:S}),!e){const e=k.current,t=null==e?void 0:e.parentElement;t&&l().default.afterNextFlush((()=>{(0,ke().Oc)({environment:b,el:t,windowHeight:D,minEdgeDist:50}),S.renderEmitter.emit()}))}}),[S,b,g,V,j,D]),A=(0,n.useCallback)((()=>(0,m.jsx)(Ro().Z,{isSidebar:!1,open:j??!1,fill:!0,onClick:E,onMouseDown:ye().$0,style:{flexShrink:0}})),[E,j]),H=(0,n.useCallback)((async e=>{const{droppedStores:t,duplicate:o}=e,n=k.current;if(!(n&&n instanceof Element))return;const r=await de().F.formulas.load();I().createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:b,canUndo:!0,perform:e=>ut().by({environment:b,collectionContextStore:S,groupsPointer:[g],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:r})})}),[S,b,g]),Z=(0,n.useMemo)((()=>({...u,paddingLeft:e.paddingLeft})),[u,e.paddingLeft]);return V&&v?(0,m.jsx)(Qr().u,{stickyAttachPoint:_?"no-stick":"ceiling",stickyStyle:Z,transitionStickyStyle:p,nodeRef:k,children:(0,m.jsxs)("div",{style:O.topLevelDiv,ref:k,children:[(0,m.jsx)("div",{style:O.stickyWrapStyle,children:(0,m.jsx)("div",{style:{display:"flex",alignItems:"center",position:e.stickyLeft?"sticky":void 0,left:e.paddingLeft,overflow:"hidden"},children:(0,m.jsxs)(ot().Z,{store:v,canDropOnto:!d&&!j,onSelectableDrop:H,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[g],style:{display:"flex",alignItems:"center",height:"100%",overflow:"hidden"},canSelect:!1,children:[A(),(0,m.jsx)(oi,{collectionGroupHeaderProps:e}),M&&(0,m.jsx)(ei,{disabled:e.disabled,format:e.format,schema:e.schema,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,groupAggregationKey:e.groupAggregationKey}),!d&&P.canConfigureBlock&&(0,m.jsx)(ti,{groupFormat:e.groupFormat,currentGroups:e.currentGroups,format:e.format,schema:e.schema,query:e.query,collectionContextStore:e.collectionContextStore,groupsFormatKey:e.groupsFormatKey,isGroupHoveredStore:e.isGroupHoveredStore}),R&&(0,m.jsx)(ni,{collectionGroupHeaderProps:e,isGroupHoveredStore:e.isGroupHoveredStore})]})})}),e.children]})}):null}const Jr=n.memo(Xr);function ei(e){let{disabled:t,format:o,schema:n,collectionContextStore:r,groupFormat:i,groupAggregationKey:l}=e;const s=(0,a().VK)((()=>r.permissionScopesStore.state.canConfigureBlock),[r]);return(0,m.jsx)(Ar,{groupFormat:i,disabled:t||!s,groupAggregationKey:l,format:o,schema:n,collectionContextStore:r})}function ti(e){let{groupFormat:t,currentGroups:o,format:n,schema:r,query:i,collectionContextStore:l,groupsFormatKey:d,isGroupHoveredStore:u}=e;const p=(0,C().YB)(),g=(0,s().Fy)(),S=(0,a().VK)((()=>l.groupsLimitStore),[l]),h=(0,a().Kw)(u),[f,y]=(0,ur().Z)(),v=(0,c().yK)((()=>({button:{transition:g.isMobile?void 0:"opacity 100ms ease-in-out",opacity:g.isMobile?void 0:h||y?1:0}})),[g.isMobile,y,h]);return(0,m.jsx)(Dr().ZP,{popupType:g.isMobile?Dr().Z4.SlideUp:Dr().Z4.Popup,renderOrigin:e=>(0,m.jsx)(jt().Z,{ariaLabel:p.formatMessage({id:"actionButtonComponent.ariaLabel",defaultMessage:"Show group options"}),ref:f,icon:_n().o,style:v.button,...e}),onClick:ye().Wi,render:e=>(0,m.jsx)(Vr,{parent:e,groupFormat:t,currentGroups:o,format:n,schema:r,query:i,collectionContextStore:l,groupsFormatKey:d,groupsLimitStore:S})})}function oi(e){let{collectionGroupHeaderProps:t}=e;const o=(0,s().O7)(),{groupFormat:n,schema:r,disabled:i,currentGroups:l,groupBy:c,collectionContextStore:d}=t,u=(0,a().Kw)(d.permissionScopesStore);return(0,m.jsx)(Yr().Z,{groupBy:c,groupFormat:n,currentGroups:l,schema:r,disabled:i||!u.canConfigureCollection||u.isSyncedCollection,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:n}=o,r=n.collectionStore();r&&(ut().w$({...e,environment:t,collectionStore:r,...o}),w().wd({environment:t,collectionContextStore:n,action:"rename_group"}))}(e,o,t),style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginLeft:2},collectionContextStore:d})}function ni(e){let{collectionGroupHeaderProps:t,isGroupHoveredStore:o}=e;const n=(0,C().YB)(),r=(0,s().Fy)(),i=(0,s().O7)(),l=(0,a().Kw)(o),[d,u]=(0,ur().Z)(),p=(0,c().yK)((()=>({button:{transition:r.isMobile?void 0:"opacity 100ms ease-in-out",opacity:r.isMobile?void 0:l||u?1:0}})),[r.isMobile,u,l]);return(0,m.jsx)(Tt().Z,{renderTooltip:()=>(0,m.jsx)(C()._H,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:e=>(0,m.jsx)(jt().Z,{ariaLabel:n.formatMessage({id:"collectionGroupHeader.actions.addNewPage.ariaLabel",defaultMessage:"Add new page in group"}),ref:d,icon:lo().R,onClick:()=>function(e,t){const{groupFormat:o,collectionContextStore:n,isFullScreen:r,onGroupHeaderAddItem:i}=t;n.groupsStore.getGroupState(o)&&(0,Ge().ww)(e)&&(n.searchQueryStore.state&&(0,qo().U)({searchQuery:"",collectionContextStore:n,isFullScreen:r}),I().createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:e,canUndo:!0,perform:r=>{const l=ut().IW({environment:e,collectionContextStore:n,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,templateStore:n.defaultPageTemplateStore.state,transaction:r,from:{createBlock:"group_header"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});l&&(i(l.newStore,l.coercionSucceeded,t),Co().W(e,{from:"group_add_item_top",type:"page",new_page_id:l.newStore.id,creating_block_id:l.newStore.id,...(0,ge().Pn)(n)}))}}))}(i,t),style:p.button,...e})})}var ri=()=>o(95804);class ii extends d().default{getInitialState(){return!1}}const li=ii;class si extends d().default{getInitialState(){}}const ai=si;var ci=()=>o(814058);const di=d().default.createClass(!1,{name:"IsGroupHoveredStore"});function ui(e){let{renderGroup:t,groupFormat:o,groupsDisplayState:r,disabled:i,groupsFormatKey:l,groupAggregationKey:c,format:d,schema:u,query:p,collectionContextStore:g,onGroupHeaderAddItem:S,renderHeader:h,getGroupStyle:f,stickyLeft:y,paddingLeft:v,isFullScreen:x,index:b,isRootChild:C,isInPeekRenderer:w,groupBy:k,isLast:V}=e;const j=(0,s().O7)();(0,n.useEffect)((()=>{ut().V$({environment:j,collectionContextStore:g,groupFormat:o})}),[]);const T=(0,a().qz)(void 0,di),[P,I,R,_,M]=(0,a().VK)((()=>{const e=g.groupsStore.getGroupState(o),n=e?e.toggleStateStore:null,s=!!n&&n.state?t(o):null,a={groupFormat:o,currentGroups:r.currentGroups,disabled:i,groupsFormatKey:l,groupAggregationKey:c,format:d,schema:u,query:p,collectionContextStore:g,isFullScreen:x,isInPeekRenderer:w,onGroupHeaderAddItem:S,stickyLeft:y,index:b,paddingLeft:v,isRootChild:C,groupBy:k,isGroupHoveredStore:T},j=h?h(a):(0,m.jsx)(Jr,{...a});return[e,n,f&&n?f({groupFormat:o,index:b,isLast:V,toggleStateStore:n,isFullScreen:x,groupsDisplayState:r}):void 0,s,j]}),[g,o,t,r,i,l,c,d,u,p,x,w,S,y,b,v,C,k,T,h,f,V]),B=(0,n.useCallback)((()=>{T.setState(!0)}),[T]),F=(0,n.useCallback)((()=>{T.setState(!1)}),[T]),K=(0,n.useRef)(null);if(!P||!I)return null;const L=0===b;return(0,m.jsx)("div",{style:{width:"100%",position:"relative",...R},onMouseEnter:B,onMouseLeave:F,ref:K,children:(0,m.jsxs)(ci().Q,{nodeRef:K,isFirst:L,children:[M,_]})})}const pi=n.memo(ui);var mi=()=>o(360240);const gi=n.memo((function(e){const{selectedAggregation:t,parent:o,onChange:r,collectionContextStore:i,schema:l}=e,a=(0,s().O7)(),{isMobile:c}=(0,s().Fy)(),d=c?{menuType:fr().o.Modal,title:(0,m.jsx)(C()._H,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:(0,m.jsx)(br().DoneMenuText,{}),onClickRight:o.close}:{menuType:fr().o.Popup,width:200},{sections:u,initialFocus:p}=(0,n.useMemo)((()=>{const{actions:e,initialFocus:o}=function(e,t,o,n,r){const{device:i}=t,l=[];let s=0,a=0;const c=function(e,t,o,n,r){const i={};for(const s of Ir().o5)i[s]=vi(e.aggregator===s,e.enforceMaxAggregationLimit??!1,s,o,n,t);const l=Object.keys(r).filter((e=>{const t=r[e];return t&&(0,Ir().iV)(t)&&!("rollup"===t.type&&"status"===t.target_property_type)}));if(l.length>0)for(const s of Ir().Sy)"show_unique"!==s&&(i[s]=yi(e,s,l,t,r,o,n));return hi.forEach((l=>{let{supportCheck:s,aggregationTypes:a}=l;const c=Object.keys(r).filter((e=>{const t=r[e];return t&&s(t)}));if(c.length>0)for(const d of a)i[d]=yi(e,d,c,t,r,o,n)})),i}(e,t,o,n,r);let d=0;return Object.entries(Ir().cY).forEach((t=>{let[n,r]=t;const u=[];for(const o of r)c[o]&&(u.push(c[o]),e.aggregator===o&&(s=d,a=u.length-1));const p=[];if("count_aggregations"===n&&p.push({key:"limitToggleSection",render:e=>(0,m.jsx)(Cr().Z,{...e}),items:[fi(e,o)]}),p.push({key:"aggregations",render:e=>(0,m.jsx)(Cr().Z,{topBorder:!0,...e}),items:u}),u.length>0){d++;const e=_r().nL[n],t={key:e,render:(t,o)=>(0,m.jsx)(Er().Z,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,m.jsx)(Or().Z,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=i.isMobile?{menuType:fr().o.Modal,title:e,right:(0,m.jsx)(br().DoneMenuText,{}),onClickRight:n.close,...t}:{menuType:fr().o.Popup,width:250,...t},(0,m.jsx)(vr().Z,{...r,children:(0,m.jsx)(xr().ZP,{type:xr().iW.Vertical,initialFocus:a,sections:p,onAccept:(e,t,r)=>{n.close(),o.onAccept&&o.onAccept(e,t,r)}})})}}),action:()=>null};l.push(t)}})),{actions:l,initialFocus:s}}(t,a,r,i,l);return{sections:[{key:"aggregation section",render:e=>(0,m.jsx)(Cr().Z,{...e}),items:e}],initialFocus:o}}),[i,a,r,l,t]);return(0,m.jsx)(vr().Z,{...d,children:(0,m.jsx)(xr().ZP,{type:xr().iW.Vertical,initialFocus:p,sections:u,onAccept:o.close})})})),Si=n.memo((function(e){const{aggregationType:t,isSelected:o,label:r,innerProps:i}=e,l=_r().Sn[t],s=(0,c().yK)((()=>({container:{width:140,whiteSpace:"normal"},image:{borderRadius:6,width:140,marginTop:4}})),[]),a=(0,n.useCallback)((e=>(0,m.jsx)(Or().Z,{title:r,checkState:o,...(0,Mr().Z)(e,i)})),[o,i,r]),d=(0,n.useCallback)((()=>(0,m.jsxs)("div",{style:s.container,children:[l&&(0,m.jsx)("img",{src:(0,Rr().D)(l),style:s.image}),_r().BG[t]]})),[l,s.container,s.image,t]);return(0,m.jsx)(Tt().Z,{placement:Me().Placement.Right,delayThreshold:0,render:a,renderTooltip:d})}));const hi=[{supportCheck:Ir().O4,aggregationTypes:Ir().k$},{supportCheck:Ir().dN,aggregationTypes:Ir().f8},{supportCheck:Ir().Mv,aggregationTypes:Ir().gC}];function fi(e,t){const o=e.enforceMaxAggregationLimit??!1,n={...e,enforceMaxAggregationLimit:!o};return{key:"aggregationLimitToggle",render:e=>(0,m.jsx)(Kr().Z,{on:o,menuListItemProps:e}),action:()=>{t(n)}}}function yi(e,t,o,n,r,i,l){const{device:s}=n,a=_r().VN[t],c=v().oA(o.map((o=>function(e,t,o,n,r,i,l,s){const a=r[t];if(!a)return;const c=a.name;return{key:`${t}${o}`,render:t=>(0,m.jsx)(Si,{isSelected:e,aggregationType:o,label:c,innerProps:t}),action:()=>{xi({aggregator:o,property:t,enforceMaxAggregationLimit:n},i,l,s)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,e.enforceMaxAggregationLimit??!1,r,i,l,n)))),d=c.findIndex((o=>o.key===`${e.property}${t}`));return{key:`${t}${a}`,render:(e,t)=>(0,m.jsx)(Er().Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,m.jsx)(Or().Z,{...e,ref:t,title:a}),renderExtension:(e,o)=>{let n;return n=s.isMobile?{menuType:fr().o.Modal,title:a,right:(0,m.jsx)(br().DoneMenuText,{}),onClickRight:o.close,...e}:{menuType:fr().o.Popup,width:200,...e},(0,m.jsx)(vr().Z,{...n,children:(0,m.jsx)(xr().ZP,{type:xr().iW.Vertical,initialFocus:d,sections:[{key:"results",render:e=>(0,m.jsx)(Cr().Z,{...e}),items:c}],onAccept:(e,n,r)=>{o.close(),t.onAccept&&t.onAccept(e,n,r)}})})}}),action:()=>null}}function vi(e,t,o,n,r,i){const l=_r().VN[o];return{key:o,render:t=>(0,m.jsx)(Si,{isSelected:e,aggregationType:o,label:l,innerProps:t}),action:()=>{xi({aggregator:o,enforceMaxAggregationLimit:t},n,r,i)}}}function xi(e,t,o,n){o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),t(e),w().wd({environment:n,collectionContextStore:o,action:"board_change_aggregation"})}const bi=n.memo((function(e){const{aggregation:t,schema:o,groupFormat:r,collectionContextStore:i,disabled:l,color:a,onChange:d}=e,{isMobile:u}=(0,s().Fy)(),p=(0,c().yK)((e=>({button:{fontWeight:b().Ue.regular,color:a||e.lightTextColor,paddingTop:4,paddingBottom:4,height:void 0,lineHeight:void 0}})),[a]),g=(0,n.useCallback)((()=>(0,m.jsx)(Ci,{aggregation:t,schema:o,collectionContextStore:i})),[t,i,o]),S=(0,n.useCallback)((e=>(0,m.jsx)(Dr().ZP,{popupType:u?Dr().Z4.SlideUp:Dr().Z4.Popup,renderOrigin:n=>(0,m.jsx)(et().D,{disabled:l,style:p.button,...(0,Mr().Z)(e,n),children:(0,m.jsx)(wi,{schema:o,aggregation:t,collectionContextStore:i,groupFormat:r})}),disabled:l,render:e=>(0,m.jsx)(gi,{parent:e,selectedAggregation:t,onChange:d,collectionContextStore:i,schema:o})})),[t,i,l,r,u,d,o,p.button]);return(0,m.jsx)(Tt().Z,{renderTooltip:g,render:S})}));function Ci(e){let{aggregation:t,schema:o,collectionContextStore:n}=e;const r=(0,a().VK)((()=>!!t&&Br(n,t)),[n,t]);if(t){const e=_r().VN[(0,Ir().OV)(t)];if((0,Ir().pK)(t)){const n=o[t.property];if(n){const t=n.name;return(0,m.jsx)(m.Fragment,{children:ht().Z.formatMessage(Lr.propertyAggregation,{aggregationType:e,propertyName:t,calculating:r})})}}return(0,m.jsx)(m.Fragment,{children:ht().Z.formatMessage(Lr.aggregationType,{aggregationType:e,calculating:r})})}return(0,m.jsx)(C()._H,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}function wi(e){const{schema:t,aggregation:o,collectionContextStore:r,groupFormat:i}=e,l=(0,a().VK)((()=>({type:"aggregation",filter:(0,po().zk)({schema:t,group:i,groupBy:r.getGroupByAndGroupFormats().groupBy,propertyMapping:void 0,timeZone:(0,mo().r)(),experimentService:Le().default}),aggregation:o})),[r,o,t,i]),{numberFormat:s,numberPrecision:c}=(0,n.useMemo)((()=>{if(!(0,Ir().pK)(o))return{};const e=t[o.property];if(e&&("formula"===e.type||"number"===e.type)){const t=e.number_format,n=e.number_precision;return{numberFormat:t,numberPrecision:(0,Ir().nC)(o)?n:void 0}}return{}}),[o,t]),d=(0,n.useMemo)((()=>{if(!(0,Ir().pK)(o))return;const e=t[o.property];return e&&"date"===e.type?e.date_format:void 0}),[o,t]),u=(0,n.useCallback)((e=>{const t=e.state;return(0,m.jsx)(Fr,{aggregation:o,collectionContextStore:r,children:t?(0,_r().Zy)({numberFormat:s,dateFormat:d,aggregation:o,userTimeZone:(0,mo().r)(),value:t.aggregationResult,numberPrecision:c}):"-"})}),[o,r,d,s,c]);return l?(0,m.jsx)(So().Z,{id:`board:${(0,ro().mD)(i)}`,collectionContextStore:r,reducer:l,groupsPointer:[i],render:u}):null}function ki(e){return(0,F().rD)(e.board_cover_size)}const Vi=function(e){const{hoveredGroupStore:t,groupFormat:o,schema:n,format:r,collectionContextStore:i,disabled:l,hidden:d,isPopup:u,isInPeekRenderer:p,query:g,currentGroups:S,isFullScreen:h}=e,f=(0,c().Fg)(),y=(0,s().O7)(),v=(0,C().YB)(),x=(0,ae().Dq)(),b=(0,a().VK)((()=>!!y.device.isMobile||(0,ro().ZH)(t.state,o)),[y,t,o]),w=(0,a().VK)((()=>(0,ho().II)({environment:y,groupFormat:o,schema:n,format:r,theme:f})),[o,n,r,y,f]),k=(0,a().Kw)(i.permissionScopesStore),V=(0,a().VK)((()=>i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[i]),j=(0,a().VK)((()=>(0,F().Il)({collectionContextStore:i,environment:y,intl:v})),[i,y,v]),T=(0,a().VK)((()=>{const e=i.collectionStore();return(!(null==e?void 0:e.inMemoryRecordCache.isTemporaryData)||null==x||!x.isPreviewing)&&(g.aggregations&&g.aggregations.length>0)}),[i,g,x]),P=(0,a().VK)((()=>function(e,t,o,n,r,i){const{device:l}=e,s=ki(o),a=Boolean(o.collection_group_by);return{display:"flex",alignItems:"center",fontSize:14,width:s,paddingLeft:bl,paddingRight:bl,marginRight:2*vl,marginBottom:t?4:0,boxSizing:"content-box",flexShrink:0,...n&&{padding:l.isMobile?"6px 16px":"8px 12px 4px",width:"none",minWidth:s},...i&&!t&&{backgroundColor:i.backgroundColor,...a?{borderRadius:xl}:{borderTopLeftRadius:xl,borderTopRightRadius:xl}}}}(y,d,r,u,0,w)),[y,d,r,u,p,w]);return(0,m.jsxs)("div",{style:P,onMouseMove:()=>function(e,t){e.state!==t&&e.setState(t)}(t,o),children:[(0,m.jsx)(Ti,{boardGroupHeaderProps:e}),T&&(0,m.jsx)(_i,{disabled:l,query:g,schema:n,collectionContextStore:i,groupFormat:o,hidden:d,boardSelectStyle:w}),(0,m.jsx)("div",{style:{flexGrow:1}}),!l&&k.canConfigureBlock&&(0,m.jsx)(Mi,{hidden:d,groupFormat:o,currentGroups:S,format:r,schema:n,query:g,collectionContextStore:i,boardSelectStyle:w,isHovered:b}),V&&(0,m.jsx)(Bi,{format:r,groupFormat:o,collectionContextStore:i,isFullScreen:h,hidden:d,isHovered:b,boardSelectStyle:w}),j&&(0,m.jsx)(Fi,{groupFormat:o,collectionContextStore:i,hidden:d,isHovered:b,boardSelectStyle:w})]})};function ji(e){let{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:s}=e;const a=s.boardColumnsLimitStore;return(0,m.jsx)(Vr,{parent:t,groupFormat:o,currentGroups:n,format:r,query:l,schema:i,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:a})}function Ti(e){let{boardGroupHeaderProps:t}=e;const{groupFormat:o,schema:n,disabled:r,currentGroups:i,format:l,groupBy:c,collectionContextStore:d}=t,u=(0,s().O7)(),p=ki(l),g=(0,a().Kw)(d.permissionScopesStore);return(0,a().VK)((()=>d.groupsStore.getGroupState(o)),[d,o])?(0,m.jsx)(Yr().Z,{groupBy:c,groupFormat:o,currentGroups:i,schema:n,disabled:r||!g.canConfigureBlock,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:n}=o,r=n.collectionStore();r&&(ut().w$({...e,environment:t,groupsFormatKey:"board_columns",collectionStore:r,...o}),w().wd({environment:t,collectionContextStore:n,action:"rename_group"}))}(e,u,t),style:{maxWidth:p-70},collectionContextStore:d}):null}function Pi(e,t,o){return!t&&o?o.textColor:e.lightTextColor}function Ii(e,t){if(!e)return{transition:"opacity 100ms ease-in-out",opacity:t?1:0}}function Ri(e,t,o,n,r,i){const{device:l}=e;if(!(0,Ge().ww)(e))return;const s="collectionTypedView"===n.contextType,a=Boolean(t.collection_group_by);n.searchQueryStore.state&&(0,qo().U)({searchQuery:"",collectionContextStore:n,isFullScreen:r});const c=n.groupsStore.getGroupState(o);if(!c)return;const d=c.resultsStore;I().createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:e,canUndo:!0,perform:t=>{const r=ut().IW({environment:e,collectionContextStore:n,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,templateStore:n.defaultPageTemplateStore.state,transaction:t,from:{createBlock:"board_group_header"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(!r)return;const c=r.coercionSucceeded,u=r.newStore;if(l.isMobile){!function(e,t,o){o?o(e):hn().c4({environment:t,url:e})}((0,Cn().ZP)({store:u,pageVisitSource:Go().tY.Create}),e,i)}else if(c&&!a){const t=u.getBlockTitleStore();T().eP({environment:e,store:u}),P().setSelectionAtEnd({store:t}),(0,$o().v)({store:u})}else Uo().CH({environment:e,store:u,peekMode:(0,F().kr)(n),showMoveTo:s,resultsStore:d,collectionContextStore:n,pageVisitSource:Go().tY.Create});Co().W(e,{from:"board_group_add_item_top",type:"page",new_page_id:u.id,creating_block_id:u.id,...(0,ge().Pn)(n)})}})}function _i(e){let{disabled:t,query:o,schema:n,collectionContextStore:r,groupFormat:i,hidden:l,boardSelectStyle:d}=e;const u=(0,c().Fg)(),p=(0,s().O7)(),g=o.aggregations?o.aggregations[0]:void 0,S=(0,a().Kw)(r.permissionScopesStore);if(!g)return null;const h=Pi(u,l,d);return(0,m.jsx)(bi,{groupFormat:i,disabled:t||!S.canConfigureBlock,aggregation:g,schema:n,collectionContextStore:r,color:h,onChange:e=>function(e,t,o,n){const r=t.collectionViewStore(),i={...o,aggregations:e?[e]:[]};r&&I().createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:n,canUndo:!0,perform:e=>{(0,Sr().i)({collectionViewStore:r,update:{query2:i},transaction:e})}})}(e,r,o,p)})}function Mi(e){let{hidden:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:a,boardSelectStyle:d,isHovered:u}=e;const p=(0,c().Fg)(),g=(0,s().O7)(),{device:S}=g,h=Pi(p,t,d),f=Ii(t,u);return(0,m.jsx)(Dr().ZP,{popupType:S.isMobile?Dr().Z4.SlideUp:Dr().Z4.Popup,renderOrigin:e=>(0,m.jsx)(jt().Z,{icon:_n().o,iconStyle:{fill:h},style:f,...e}),render:e=>(0,m.jsx)(ji,{parent:e,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:a})})}function Bi(e){let{format:t,groupFormat:o,collectionContextStore:r,isFullScreen:i,hidden:l,isHovered:d,boardSelectStyle:u}=e;const p=(0,c().Fg)(),g=(0,s().O7)(),S=(0,C().YB)(),h=(0,n.useContext)(Jn().Z),f=(0,n.useCallback)((()=>Ri(g,t,o,r,i,h)),[g,t,o,r,i,h]),y=(0,a().VK)((()=>{var e;return null===(e=r.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[r]),v=Pi(p,l,u),x=Ii(l,d),b=(0,mi().sN)(y),w=S.formatMessage({defaultMessage:"Create new {newItemName}",id:"database.boardView.actions.addNewItem.tooltip"},{newItemName:b});return(0,m.jsx)(Tt().Z,{renderTooltip:()=>w,render:e=>(0,m.jsx)(jt().Z,{icon:lo().R,onClick:f,style:x,iconStyle:{fill:v},ariaLabel:w,...e})})}function Fi(e){let{groupFormat:t,collectionContextStore:o,hidden:n,isHovered:r,boardSelectStyle:i}=e;const l=(0,c().Fg)(),s=(0,C().YB)(),d=(0,a().VK)((()=>{var e;return null===(e=o.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[o]),u=Pi(l,n,i),p=Ii(n,r),g=(0,mi().sN)(d),S=s.formatMessage({defaultMessage:"Link existing {newItemName}",id:"database.boardView.actions.linkExistingItem.tooltip"},{newItemName:g});return(0,m.jsx)(dn().a,{collectionContextStore:o,groupFormat:t,renderLinkButton:e=>(0,m.jsx)(Tt().Z,{renderTooltip:()=>S,render:t=>(0,m.jsx)(jt().Z,{icon:cn().v,style:p,iconStyle:{fill:u},...t,...e,ariaLabel:S})})})}var Ki=()=>o(374289);const Li=30,Oi=4,Di=10;function Ei(e){const{hiddenGroupsVisibleStore:t}=e,o=(0,a().Kw)(t);return(0,m.jsx)(et().D,{onClick:function(){t.setState(!t.state)},onMouseDown:ye().$0,style:{height:Li,marginBottom:Oi,...e.style},icon:e=>(0,Ki().i)({...e,...o&&{transform:"rotate(180deg)"}}),isLightGray:!0,children:(0,m.jsx)(C()._H,{id:"collectionHiddenGroupsButton.hiddenGroupsButton.text",defaultMessage:"{numberOfHiddenGroups, plural, one {{numberOfHiddenGroups} hidden group} other {{numberOfHiddenGroups} hidden groups}}",values:{numberOfHiddenGroups:e.hiddenGroups.length}})})}function Ai(e){const t=(0,a().VK)((()=>e.columnsDisplayState.visibleGroups.length*(ki(e.format)+2*bl+2*vl)),[e.columnsDisplayState.visibleGroups,e.format]);return(0,m.jsx)("div",{style:{display:"flex",minWidth:t},children:(0,m.jsx)(Ei,{...e})})}const Hi=30,Zi=4,zi=n.memo((function(e){let{type:t,groupsDisplayState:o,groupsLimitStore:n,schema:r,collectionContextStore:i,style:l}=e;const d=(0,s().O7)(),u=(0,c().Fg)(),p=(0,a().Kw)(i.normalizedFormatStore),g=(0,a().VK)((()=>(0,Wo().gf)({collectionContextStore:i,isForColumnGroups:"board"===t})),[i,t]),S=(0,a().VK)((()=>"board"===t?(0,ho().II)({environment:d,groupFormat:void 0,schema:r,format:p,theme:u}):void 0),[d,p,r,u,t]),h="v2"===o.version?void 0:Math.min(ho().kW,o.total-o.hiddenGroups.length-o.visibleGroups.length),f=(0,c().yK)((e=>({hovered:{background:e.whiteButtonBackground},dots:{width:14,fill:e.mediumTextColor,marginLeft:void 0===h?8:4,marginTop:1,..."default"===t?{marginRight:8}:{}},button:{display:"flex",alignItems:"center",fontSize:14,paddingTop:2,paddingBottom:2,paddingRight:8,color:e.mediumTextColor,fontWeight:b().Ue.medium,..."board"===t?{background:null==S?void 0:S.backgroundColor,paddingLeft:8,height:"100%",marginRight:2*vl,borderRadius:xl,width:void 0===h?"fit-content":90,...l}:{paddingLeft:2,borderRadius:4,height:Hi,marginTop:Zi,marginBottom:Zi}}})),[null==S?void 0:S.backgroundColor,h,l,t]);return"default"===t?(0,m.jsxs)(et().D,{onClick:()=>function(e,t,o){o.setState(o.state+ho().kW),t.loadingDetailsStore.setState({type:"load_more_groups"}),w().tf(e)}(d,i,n),onMouseDown:ye().$0,disabled:g,hoveredStyle:g?f.hovered:{},style:{...f.button,...l},children:[(0,_n().o)(f.dots),void 0===h?(0,m.jsx)(C()._H,{id:"database.groups.loadMoreButtonDefault",defaultMessage:"Load more groups"}):(0,m.jsx)(C()._H,{id:"database.groups.loadMoreButtonDefault.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:h}}),g&&(0,m.jsx)("div",{style:{marginTop:1,marginLeft:8},children:(0,m.jsx)(sn().Z,{size:"sm"})})]}):(0,m.jsxs)(et().D,{onClick:()=>function(e,t,o){o.setState(o.state+ho().kW),t.loadingDetailsStore.setState({type:"load_more_columns"}),w().tf(e)}(d,i,n),onMouseDown:ye().$0,disabled:g,hoveredStyle:g?f.hovered:{},style:f.button,children:[(0,m.jsx)("span",{style:{flexGrow:1},children:void 0===h?(0,m.jsx)(C()._H,{id:"database.groups.loadMoreButtonBoard",defaultMessage:"More"}):(0,m.jsx)(C()._H,{id:"database.groups.loadMoreButton.text",defaultMessage:"{loadMoreAmount} more",values:{loadMoreAmount:h}})}),g?(0,m.jsx)("div",{style:{marginLeft:4},children:(0,m.jsx)(sn().Z,{size:"sm"})}):(0,_n().o)(f.dots)]})}),ao().Z);function Wi(e){const{format:t,isFullScreen:o,paddingLeft:n,isRootChild:r}=e,i=(0,s().O7)(),l=(0,a().VK)((()=>(0,Ut().C1)({environment:i,format:t,isFullScreen:o,isRootChild:r})),[i,t,o,r]),c=(0,a().VK)((()=>"collectionTypedView"===e.collectionContextStore.contextType),[e.collectionContextStore]),d=(0,a().VK)((()=>(0,Ut().fj)({environment:i,isRootChild:r,isFullScreen:o,format:t})?Ut().Qw:n),[i,t,o,r,n]);return l||c?null:(0,m.jsx)("div",{style:{width:"100%",height:Bl+Kl+Fl,display:"flex"},children:(0,m.jsx)(Ol,{type:"default",groupBy:e.groupBy,currentGroups:e.currentGroups,schema:e.schema,groupsLimitStore:e.groupsLimitStore,collectionContextStore:e.collectionContextStore,onAccept:e.onAccept,parentStore:e.parentStore,style:{position:"sticky",left:e.isFullScreen?d:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function Gi(e){const{format:t,isFullScreen:o,isRootChild:n,paddingLeft:r,hiddenGroups:i,hiddenGroupsVisibleStore:l,style:c}=e,d=(0,s().O7)(),u=(0,a().VK)((()=>(0,Ut().C1)({environment:d,format:t,isFullScreen:o,isRootChild:n})),[d,t,o,n]),p=(0,a().VK)((()=>(0,Ut().fj)({environment:d,isRootChild:n,isFullScreen:o,format:t})?Ut().Qw:r),[d,t,o,n,r]);return u?null:(0,m.jsx)("div",{style:{width:"100%",height:Li+Oi+Di,display:"flex"},children:(0,m.jsx)(Ei,{hiddenGroupsVisibleStore:l,hiddenGroups:i,style:{position:"sticky",left:o?p:3,width:"max-content",paddingLeft:4,paddingRight:8,...c}})})}function Ni(e){const{format:t,isFullScreen:o,isRootChild:n}=e,r=(0,s().O7)(),i=(0,a().VK)((()=>(0,Ut().C1)({environment:r,format:t,isFullScreen:o,isRootChild:n})),[r,t,o,n]),l=(0,a().VK)((()=>(0,Ut().fj)({environment:r,isRootChild:n,isFullScreen:o,format:t})?Ut().Qw:e.paddingLeft),[r,t,o,n,e.paddingLeft]);return i?null:(0,m.jsx)("div",{style:{width:"100%",height:Hi+2*Zi,display:"flex"},children:(0,m.jsx)(zi,{type:"default",groupsDisplayState:e.groupsDisplayState,groupsLimitStore:e.groupsLimitStore,schema:e.schema,collectionContextStore:e.collectionContextStore,style:{position:"sticky",left:o?l:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}const Ui=(0,p().IU)("collectionGroupAccordion",{svg:(0,m.jsx)("path",{d:"M6.741 0a1 1 0 01.875 1.485l-2.742 4.94a1 1 0 01-1.748 0L.384 1.485A1 1 0 011.26 0h5.48z"}),viewBox:"0 0 8 7"});function $i(e){const{width:t}=e,o=(0,s().O7)(),n=(0,a().VK)((()=>o.WindowSizeStore.state.width<=ml),[o]),r=(0,c().yK)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:t},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${n?"100%":`${t}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,marginLeft:8,borderRadius:12,backgroundColor:e.lightDividerColor}})),[t,n]);return(0,m.jsxs)("div",{style:r.container,children:[(0,m.jsxs)("div",{style:r.groupContainer,children:[(0,m.jsx)("div",{style:r.iconContainer,children:Ui(r.icon)}),(0,m.jsx)(ir().Z,{style:r.groupShimmer})]}),(0,m.jsxs)("div",{style:r.itemsContainer,children:[(0,m.jsx)(lr,{}),(0,m.jsx)(lr,{}),(0,m.jsx)(lr,{})]})]})}function qi(e){const{isFullScreen:t,galleryCoverSize:o}=e,n=t?2:1,r=(0,F().rD)(o),i=v().DZ(n,(e=>(0,m.jsx)($i,{width:r},e)));return(0,m.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:i})}function Yi(){const e=(0,c().yK)((e=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingLeft:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return(0,m.jsxs)("div",{style:e.container,children:[(0,m.jsxs)("div",{style:e.groupContainer,children:[(0,m.jsx)("div",{style:e.iconContainer,children:Ui(e.icon)}),(0,m.jsx)(ir().Z,{style:e.groupShimmer})]}),(0,m.jsxs)("div",{style:e.rowsContainer,children:[(0,m.jsxs)("div",{style:e.rowContainer,children:[(0,m.jsxs)("div",{style:e.firstColumn,children:[(0,m.jsx)(ir().Z,{style:e.circleShimmer}),(0,m.jsx)(ir().Z,{style:e.rowShimmerShort})]}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(ir().Z,{style:e.rowShimmerShort})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(ir().Z,{style:e.rowShimmerShort})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(ir().Z,{style:e.rowShimmerShort})})]}),(0,m.jsxs)("div",{style:e.rowContainer,children:[(0,m.jsxs)("div",{style:e.firstColumn,children:[(0,m.jsx)(ir().Z,{style:e.circleShimmer}),(0,m.jsx)(ir().Z,{style:e.rowShimmerLong})]}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(ir().Z,{style:e.rowShimmer})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(ir().Z,{style:e.rowShimmer})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(ir().Z,{style:e.rowShimmer})})]}),(0,m.jsxs)("div",{style:e.lastRowContainer,children:[(0,m.jsxs)("div",{style:e.firstColumn,children:[(0,m.jsx)(ir().Z,{style:e.circleShimmer}),(0,m.jsx)(ir().Z,{style:e.rowShimmerLong})]}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(ir().Z,{style:e.rowShimmer})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(ir().Z,{style:e.rowShimmer})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(ir().Z,{style:e.rowShimmer})})]})]})]})}function Qi(e){const{isFullScreen:t}=e,o=t?2:1,n=v().DZ(o,(e=>(0,m.jsx)(Yi,{},e)));return(0,m.jsx)("div",{style:{display:"flex",paddingTop:8,paddingLeft:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"},children:n})}function Xi(){const e=(0,c().yK)((e=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,m.jsxs)("div",{style:e.rowsContainer,children:[(0,m.jsx)("div",{style:e.rowContainer,children:(0,m.jsx)(ir().Z,{style:e.rowShimmerShort})}),(0,m.jsx)("div",{style:e.rowContainer,children:(0,m.jsx)(ir().Z,{style:e.rowShimmer})})]})}var Ji=()=>o(717940);function el(){const e=(0,c().yK)((e=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor}})),[]),t=(0,q().DK)(),o=(0,a().VK)((()=>null==t?void 0:t.isInHomeWidgetStore.state),[t]),n=["50%","30%","40%"].map(((e,t)=>(0,m.jsx)(Ji().G,{widthPercentage:e,isInHomeWidget:o},t)));return(0,m.jsxs)("div",{style:e.container,children:[(0,m.jsxs)("div",{style:e.groupContainer,children:[(0,m.jsx)("div",{style:e.iconContainer,children:Ui(e.icon)}),(0,m.jsx)(ir().Z,{style:e.groupShimmer})]}),(0,m.jsx)("div",{style:e.rowsContainer,children:n})]})}function tl(e){const{isFullScreen:t}=e,o=t?2:1,n=v().DZ(o,(e=>(0,m.jsx)(el,{},e)));return(0,m.jsx)("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},children:n})}function ol(e){const{viewType:t,isFullScreen:o,galleryCoverSize:n}=e;if(!(0,qn().Z)(!0,0,100))return null;switch(t){case"table":return(0,m.jsx)(Qi,{isFullScreen:o});case"list":return(0,m.jsx)(tl,{isFullScreen:o});case"gallery":return(0,m.jsx)(qi,{isFullScreen:o,galleryCoverSize:n});case"timeline":return(0,m.jsx)(Xi,{});default:return null}}const nl=new Set(["dropzone","table"]),rl=new Set(["item","table"]),il=n.memo((function(e){const{collectionContextStore:t,timelineProps:r}=e,i=(0,s().O7)(),l=(0,je().E)("collection_group_reducer_visible"),c=(0,a().VK)((()=>{var e;return null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()}),[t]),d=(0,a().Kw)(t.permissionScopesStore),u=(0,a().Kw)(t.normalizedFormatStore),p=null==u?void 0:u.collection_group_by,g=null==u?void 0:u.board_columns_by,S=(0,a().Kw)(t.groupsLimitStore),h=(0,a().Kw)(t.normalizedSchemaStore),f=(0,a().VK)((()=>t.normalizedQueryStore.state??{}),[t.normalizedQueryStore]),y=(0,a().VK)((()=>{if(p&&u&&(null==r||!r.type||!nl.has(null==r?void 0:r.type)))return(0,ho().ej)({groupBy:p,schema:h,format:u,groupsFormatKey:ro().Uh,limit:S})}),[p,u,r,h,S]),v=(0,a().qz)(null==r?void 0:r.reducerResultStore,ai),x=(0,a().Kw)(v),b=(0,a().qz)(null==r?void 0:r.hiddenGroupsVisibleStore,li),C=(0,a().Kw)(b),[w,k]=(0,ri().P)({collectionContextStore:t,groupBy:p,groupsFormatKey:ro().Uh,reducerResult:x,groupsLimit:S}),[V,j]=(0,ri().P)({collectionContextStore:t,groupBy:g,groupsFormatKey:"board_columns",reducerResult:x,groupsLimit:S}),T=n.useCallback((()=>{const e=t.normalizedFormatStore.state;if(""!==t.searchQueryStore.state)return;(0,xo().yU)(t)||ut().$D({environment:i,format:e,groupsFormatKey:ro().Uh,collectionContextStore:t,currentGroups:k.state.currentGroups})}),[t,i,k]),P=(0,pn().v)(T,5e3);n.useEffect((()=>{if(null==r||!r.type||!nl.has(null==r?void 0:r.type))return k.addListener(P),()=>{k.removeListener(P),P.cancel()}}),[k,P,r]);const I=(0,a().VK)((()=>k.state.hiddenGroups.slice(0,ho().ew)),[k]),R=(0,a().VK)((()=>!(null!=r&&r.type&&rl.has(null==r?void 0:r.type))&&(0,Wo().vq)({collectionContextStore:t,displayState:w})),[t,w,r]),_=(0,a().VK)((()=>{const{visibleGroups:e}=w;return 0===e.length&&!t.shouldShowSpinnerStore.state||e.length>0}),[t,w]),M=(0,a().VK)((()=>(0,ho().Df)(w,e.collectionContextStore,!1)),[w,e.collectionContextStore]),B=(0,a().VK)((()=>!e.disabled&&!d.isLocked&&d.canConfigureBlock&&!R&&p&&(0,ro().Wz)(p,d.canConfigureCollection)&&"collectionTypedView"!==t.contextType&&!(0,o(15607).w)(p.property)&&_),[_,t,d.canConfigureBlock,d.canConfigureCollection,d.isLocked,e.disabled,p,R]),F=(0,a().VK)((()=>Le().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]);if(!u)return null;const K=(0,m.jsxs)("div",{style:{position:"relative"},children:[(0,m.jsx)(ll,{groups:w.visibleGroups,groupBy:p,groupsDisplayState:w,format:u,schema:h,query:f,reducerId:e.reducerId,store:e.store,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,timelineProps:r}),R&&(0,m.jsx)(ol,{viewType:c,isFullScreen:e.isFullScreen,galleryCoverSize:u.gallery_cover_size}),M&&(0,m.jsx)(sl,{timelineType:null==r?void 0:r.type,collectionContextStore:e.collectionContextStore,schema:h,format:u,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,groupsDisplayState:w}),I.length>0&&!l&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(cl,{reducerId:e.reducerId,timelineType:null==r?void 0:r.type,format:u,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,columnsDisplayState:V,hiddenGroups:I,hiddenGroupsVisibleStore:b}),C&&(0,m.jsx)(ll,{groups:I,groupBy:p,groupsDisplayState:w,format:u,schema:h,query:f,reducerId:e.reducerId,store:e.store,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,timelineProps:r})]}),B&&(0,m.jsx)(al,{timelineType:null==r?void 0:r.type,store:e.store,collectionContextStore:e.collectionContextStore,schema:h,format:u,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,groupsDisplayState:w,groupBy:p})]});return y?(0,m.jsx)(So().Z,{id:e.reducerId,reducer:y,collectionContextStore:e.collectionContextStore,resultStore:v,render:()=>K,debounceWait:F}):K}),ao().Z);function ll(e){const t=(0,a().VK)((()=>e.collectionContextStore.groupsStore.getGroupState),[e.collectionContextStore.groupsStore]),o=(0,a().Kw)(e.collectionContextStore.isInPeekRendererStore);return(0,m.jsx)(m.Fragment,{children:e.groups.map(((n,r)=>t&&e.groupBy?(0,m.jsx)(pi,{collectionContextStore:e.collectionContextStore,groupsDisplayState:e.groupsDisplayState,groupFormat:n,groupBy:e.groupBy,disabled:e.disabled,groupsFormatKey:ro().Uh,groupAggregationKey:ro().dQ,format:e.format,schema:e.schema,query:e.query,isInPeekRenderer:o,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,getGroupStyle:e.getGroupStyle,index:r,isLast:r===e.groups.length-1},(0,ro().mD)(n)):null))})}function sl(e){return"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,m.jsx)(Ni,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:e.collectionContextStore.groupsLimitStore,groupsDisplayState:e.groupsDisplayState,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft}):(0,m.jsx)("div",{style:{display:"flex"},children:(0,m.jsx)(zi,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:e.collectionContextStore.groupsLimitStore,groupsDisplayState:e.groupsDisplayState,style:e.stickyLeft?{position:"sticky",left:e.paddingLeft}:void 0})})}function al(e){const t=(0,s().O7)(),o=(0,a().VK)((()=>e.collectionContextStore.groupsLimitStore),[e.collectionContextStore]),r=n.useCallback(((e,t,o,n,r)=>{const i=o.collectionStore();i&&ut().tH({update:e,collectionContextStore:o,groupsFormatKey:ro().Uh,collectionStore:i,environment:t,groupBy:n,schema:r})}),[]);return"dropzone"!==e.timelineType&&e.groupBy?"item"===e.timelineType?(0,m.jsx)(Wi,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):(0,m.jsx)(Ol,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,paddingLeft:e.paddingLeft,stickyLeft:!0,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):null}function cl(e){return"board_collection_groups"===e.reducerId?(0,m.jsx)(Ai,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,format:e.format,columnsDisplayState:e.columnsDisplayState}):"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,m.jsx)(Gi,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,style:{marginTop:Di}}):(0,m.jsx)("div",{style:{display:"flex"},children:(0,m.jsx)(Ei,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,style:{marginTop:Di,...e.stickyLeft?{position:"sticky",left:e.paddingLeft}:{}}})})}function dl(e){let{collectionContextStore:t,store:o,format:r,disabled:i,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:d,paddingLeft:u,isRootChild:p,collectionGalleryViewStore:g}=e;const S=(0,c().Fg)(),h=(0,s().O7)(),{isMobile:f}=(0,s().Fy)(),y=(0,n.useCallback)((e=>(0,m.jsx)(pl,{args:e})),[]),v=(0,n.useCallback)((e=>{if(f)No()._c({environment:h,store:e,pageVisitSource:Go().tY.Create});else{const o="collectionTypedView"===t.contextType;Uo().CH({environment:h,store:e,peekMode:F().kr(t),showMoveTo:o,resultsStore:void 0,collectionContextStore:t,pageVisitSource:Go().tY.Create})}}),[t,h,f]),x=(0,n.useCallback)((e=>(0,m.jsx)(cr,{store:o,format:r,disabled:i,collectionContextStore:t,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:d,collectionGalleryViewStore:g,groupFormat:e})),[o,r,i,t,l,a,d,g]),b=(0,n.useCallback)((e=>0===e.index?{}:{borderTop:`1px solid ${S.tableDividerColor}`}),[S]);return(0,m.jsx)(il,{reducerId:"gallery_groups",store:o,collectionContextStore:t,disabled:i,isFullScreen:d,isRootChild:p,paddingLeft:u,stickyLeft:!1,renderHeader:y,onGroupHeaderAddItem:v,renderGroup:x,getGroupStyle:b})}const ul=n.memo(dl);function pl(e){let{args:t}=e;const o=(0,a().Kw)(t.collectionContextStore.isInHomeWidgetStore),{stickyStyle:n}=(0,c().yK)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${e.contentBackground}`}})),[]);return(0,m.jsx)(Jr,{...t,height:o?gt().yZ:48,stickyStyle:n})}const ml=480,gl=40;function Sl(e){const{store:t,format:o,collectionContextStore:r,isFullScreen:i,isPreviewing:l,isRootChild:d,blockPropertyValueOverlayStore:u,disabled:p,schema:g,paddingBottom:S,paddingLeft:h,paddingRight:f,minWidth:y}=e,v=(0,s().O7)(),{isMobile:x}=(0,s().Fy)(),b=(0,n.useRef)(null),C=(0,a().qz)(void 0,Xn);(0,a().Kw)(C);const{coverWidth:w,coverHeight:k}=(0,a().Kw)(C),V=(0,a().VK)((()=>F().az(r,i)),[r,i]),j=(0,a().Kw)(r.isInHomeWidgetStore),T=(0,a().VK)((()=>!!r.viewsModuleContextStore.getViewModuleType()),[r]),P=(0,n.useCallback)((()=>{if(b.current){const e=b.current.getNode();if(e){const t=e.querySelector(`.${me().K4T}`);if(null!==t&&t instanceof HTMLDivElement)return t.offsetWidth}}return F().rD(o.gallery_cover_size)}),[o.gallery_cover_size]),I=(0,n.useCallback)((e=>{C.setState({coverHeight:k,coverWidth:e||P()})}),[C,k,P]),R=(0,n.useCallback)((()=>P()*(9/16)),[P]),_=(0,n.useCallback)((e=>{C.setState({coverWidth:w,coverHeight:e||R()})}),[C,w,R]),M=(0,n.useCallback)((e=>{var t;const o=r.isLoadingStore.state,n=null===(t=r.groupsStore.getGroupState([]))||void 0===t||null===(t=t.reducerResultStore)||void 0===t?void 0:t.state;e<Ke().Z.incrementScrollOffset&&n&&!o&&null!=n&&n.hasMore&&ut().ID({collectionContextStore:r,environment:v,incrementLimitArgs:{isFullScreen:i,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[r,v,i]),B=(0,n.useCallback)((()=>{const e=R(),t=P();k!==e&&_(e),w!==t&&I(t)}),[R,P,k,w,_,I]),K=(0,pn().y)(B,100),L=(0,gn().z)(B,100);(0,n.useEffect)((()=>{I(P()),_()}),[P,_,I,null==o?void 0:o.gallery_cover_size]),(0,n.useEffect)((()=>((0,fe().lj)(window,"resize",L),x&&(0,fe().lj)(window,"orientationchange",K),()=>{(0,fe().ZV)(window,"resize",L),x&&(0,fe().ZV)(window,"orientationchange",K)})),[K,L,x]);const O=(0,c().yK)((()=>({container:{paddingBottom:S,paddingLeft:h,paddingRight:f,minWidth:y}})),[y,S,h,f]),D=o.collection_group_by;return(0,Yn().Z)((e=>(0,m.jsxs)("div",{style:O.container,className:me().sbt,children:[(0,m.jsx)(ot().Z,{store:t,shouldShowHalo:!i&&!j,canSelect:!i&&!T,disablePointerEvents:l,analyticsName:"gallery",...e,ref:b,children:D?(0,m.jsx)(ul,{blockPropertyValueOverlayStore:u,collectionContextStore:r,collectionGalleryViewStore:C,disabled:p,format:o,isFullScreen:i,isRootChild:d,paddingLeft:h,schema:g,store:t}):(0,m.jsx)(cr,{blockPropertyValueOverlayStore:u,collectionContextStore:r,collectionGalleryViewStore:C,disabled:p,format:o,groupFormat:void 0,isFullScreen:i,schema:g,store:t})}),!V&&(0,m.jsx)(zo().Z,{onChange:M})]})))}const hl=n.memo(Sl);function fl(e){const t=e.minHeight||gl,o=(0,c().yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:xl,backgroundColor:e.largeShimmerColor,minHeight:t,width:"100%",marginBottom:4}})),[t]);return(0,m.jsx)(ir().Z,{style:o.card})}function yl(){return(0,qn().Z)(!0,0,100)?(0,m.jsx)(fl,{}):null}const vl=5,xl=10,bl=7,Cl=bl+32;function wl(e,t){return t?0:e?8:12}const kl=function(e){let{groupsPointer:t,schema:o,format:n,collectionContextStore:r,store:i,disabled:l,blockPropertyValueOverlayStore:d,isFullScreen:u,anyGroupHasResults:p,isInPeekRenderer:g,hoveredGroupStore:S}=e;const h=(0,c().Fg)(),f=(0,s().O7)(),y=(0,C().YB)(),{isMobile:x}=(0,s().Fy)(),b=(0,a().VK)((()=>{const e=v().Z$(t);return(0,ho().II)({environment:f,groupFormat:e,schema:o,format:n,theme:h})}),[t,o,n,f,h]),w=(0,a().VK)((()=>{const e=r.groupsStore.getGroupState(t);return Boolean(null==e?void 0:e.reducerResultStore.state)}),[t,r]),k=(0,a().VK)((()=>r.groupsStore.getGroupState(t)),[r,t]),V=(0,a().VK)((()=>(0,F().az)(r,u)),[r,u]),T=(0,a().VK)((()=>null==k?void 0:k.reducerResultStore.state),[k]),P=(0,a().Kw)(r.permissionScopesStore),R=(0,a().Kw)(r.isInHomeWidgetStore),_=(0,a().VK)((()=>!l&&w&&r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!R})),[l,w,r,R]),M=(0,a().VK)((()=>(0,F().VM)({reducerResult:T,collectionContextStore:r,isFullScreen:u})),[T,r,u]),B=(0,a().VK)((()=>(0,Wo().H0)({collectionContextStore:r,groupsPointer:t,hasPartialResults:p})),[r,t,p]),K=(0,a().VK)((()=>p&&r.shouldShowSpinnerStore.state&&"load_general"===r.loadingDetailsStore.state.type),[r,p]),L=(0,a().VK)((()=>(0,F().Il)({collectionContextStore:r,environment:f,intl:y})),[f,r,y]),O=(0,a().VK)((()=>f.device.isMobile||(0,ro().ZH)(S.state,v().Z$(t))),[S,t,f]),D=(0,c().yK)((e=>({loadMoreButton:{borderRadius:xl,fontSize:x?16:14,padding:"5px 4px 5px 11px",height:void 0},loadMoreButtonIcon:{width:x?16:14,height:x?16:14}})),[x]);if(!k)return null;const E=function(e){return e?e.board_cover:void 0}(n),A=!l&&!P.isSyncedCollection,H=Boolean(n.collection_group_by),Z=!p&&H&&B;return(0,m.jsxs)("div",{style:Ml(n,g,w,b),onMouseDown:e=>function(e,t){const{device:o}=t,{target:n}=e;!o.isMobile&&n instanceof HTMLElement&&(0,ye().ZP)({event:e,context:ye().Af.EditorMouseDown,callback:()=>{e.preventDefault(),j().AI({environment:t,target:n,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,f),onClick:Il,className:me().GfL,onMouseMove:()=>function(e,t){const o=v().Z$(e);o&&t.state!==o&&t.setState(o)}(t,S),children:[(0,m.jsx)(Lo,{collectionContextStore:r,groupsPointer:t,format:n,canDrag:A,onSelectableEnter:e=>Rl(e,t,r,u,f),resultProps:{format:n,schema:o,onTextEnter:e=>function(e,t,o,n,r,i){if(!(0,Ge().ww)(i)||!o.collectionStore())return _l(e,o,r,t,i);const l=Pl(t,o);if(!l)return;const s=l.state.findIndex((t=>t===e))+1;I().createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:i,canUndo:!0,perform:e=>{Yo({transaction:e,environment:i,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:s,from:"board_group_enter_add_item",transient:!0})}})}(e,t,r,u,i,f),onShiftEnter:e=>Rl(e,t,r,u,f),coverFormat:E,coverAspectFormat:Vl(n),coverSizeFormat:jl(n),colorStyle:b,onTextEsc:e=>_l(e,r,i,t,f),disabled:l,blockPropertyValueOverlayStore:d,collectionContextStore:r},canDrop:!0,resultComponent:$n,disabled:l,direction:Fo.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:H?bl:3,analyticsName:"board",loadContentCover:E&&"page_content"===E.type}),Z&&(0,m.jsx)(yl,{}),M&&(0,m.jsx)(co().ZP,{groupsPointer:t,store:i,collectionContextStore:r,format:n,isFullScreen:u,incrementLimitsInRelatedGroups:!0,style:D.loadMoreButton,iconStyle:D.loadMoreButtonIcon}),_&&(0,m.jsxs)(m.Fragment,{children:[M&&(0,m.jsx)("div",{style:{width:"100%",borderTop:`1px solid ${h.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,m.jsx)(an,{groupsPointer:t,collectionContextStore:r,isFullScreen:u,color:null==b?void 0:b.textColor,shouldShowSpinner:K})]}),L&&(0,m.jsx)(un,{groupFormat:v().Z$(t),collectionContextStore:r,color:null==b?void 0:b.textColor,isHovered:O}),!V&&(0,m.jsx)(zo().Z,{onChange:e=>function(e,t,o,n,r){const i=t.isLoadingStore.state,l=t.groupsStore.getGroupState(n),s=null==l?void 0:l.reducerResultStore.state;e<Ke().Z.incrementScrollOffset&&!i&&s&&s.hasMore&&(ut().ID({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:o,currentResultCount:s.blockIds.length,groupsPointer:n,incrementLimitsInRelatedGroups:!1}}),t.loadingDetailsStore.setState({type:"load_general"}))}(e,r,u,t,f)})]})};function Vl(e){return e?e.board_cover_aspect:void 0}function jl(e){return e?e.board_cover_size:void 0}function Tl(e){const t=e.board_cover_size;return(0,F().rD)(t)}function Pl(e,t){const o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}function Il(e){(0,ye().ZP)({event:e,context:ye().Af.EditorClick,callback:()=>{}})}function Rl(e,t,o,n,r){const{blocks:i,transaction:l}=e;if(0===i.length)return;const s=i[0];if(!(0,Ge().ww)(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const a=Pl(t,o);if(!a)return;Yo({transaction:l,environment:r,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:a.state.findIndex((e=>e===s))+1,from:"board_group_enter_add_item",transient:!0})}function _l(e,t,o,n,r){const i=t.collectionStore(),l=e.getTitleStore();if(!l)return;if(yt().QaF(l.getValue()))T().Ys({environment:r,store:e});else if(i){const i=Pl(n,t);if(!i)return;const l=i.state.findIndex((t=>t===e))-1,s=t.collectionViewStore(),a=t.collectionViewBlockStore();if(s&&a&&O().sG(r,{...(0,ge().Pn)(t),block_id:o.id}),I().createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:r,canUndo:!0,perform:t=>{ut().Od({store:e,transaction:t})}}),l>=0){const e=i.state[l];T().Ys({environment:r,store:e})}}}function Ml(e,t,o,n){const r=Boolean(e.collection_group_by);return{flex:"none",paddingLeft:bl,paddingRight:bl,paddingBottom:bl,marginRight:2*vl,boxSizing:"content-box",width:Tl(e),height:r?void 0:"max-content",...n&&o&&{backgroundColor:n.backgroundColor,...r?{borderRadius:xl}:{borderBottomLeftRadius:xl,borderBottomRightRadius:xl}}}}const Bl=28,Fl=12,Kl=4,Ll=(0,C().vU)({addGroup:{defaultMessage:"Add a group",id:"database.boardView.addGroupButtonTitle"}}),Ol=n.memo((function(e){let{type:t,style:r,groupBy:i,currentGroups:l,schema:d,groupsLimitStore:u,collectionContextStore:p,parentStore:g,onAccept:S,paddingLeft:h,stickyLeft:f}=e;const y=(0,s().O7)(),v=(0,c().Fg)(),b=(0,C().YB)(),k=(0,a().qz)(void 0,Be().Z),V=d[i.property],j=(0,a().VK)((()=>(0,ho().II)({environment:y,groupFormat:void 0,schema:d,format:p.normalizedFormatStore.state,theme:v})),[p,y,d,v]),T=(0,c().yK)((e=>({plusIcon:{fill:e.mediumTextColor},iconButton:{width:35,background:null==j?void 0:j.backgroundColor,paddingLeft:10,paddingRight:10,paddingTop:bl,paddingBottom:bl,marginRight:vl,borderRadius:xl,height:"100%",...r}})),[j,r]),P=(0,n.useCallback)((e=>{!function(e){let{schema:t,groupBy:o,currentGroups:n,groupsLimitStore:r,collectionContextStore:i,onAccept:l,environment:s,buttonPopupStore:a,update:c}=e;const{newGroupValue:d}=c,u=t[o.property],p=r.state;if(!u||!(0,ro().LG)(u))return;if(w().wd({environment:s,collectionContextStore:i,action:"board_add_group"}),a.reset(),io().cu(u)){if(u.type!==d.type)return;if(void 0===d.value)return;const e=u.options||[],r={id:so().Il(),value:d.value,color:(0,io().TL)(e)},i=[...e,r],s={...u,options:i},a={...t,[o.property]:s},c={property:o.property,value:d,hidden:!1};return void l({newGroups:(0,ho().nr)(n,c,p),newSchema:a})}if("person"===u.type||"relation"===u.type||(0,ro().HB)(u.type)){const e={property:o.property,value:d,hidden:!1};return void l({newGroups:(0,ho().nr)(n,e,p),newPage:c.newPage})}if((0,ro().A1)(u.type)||"status"===u.type||"number"===u.type||"created_by"===u.type||"last_edited_by"===u.type||"formula"===u.type||"checkbox"===u.type||"location"===u.type)return;(0,x().t1)(u.type)}({schema:d,groupBy:i,currentGroups:l,groupsLimitStore:u,collectionContextStore:p,onAccept:S,environment:y,buttonPopupStore:k,update:e})}),[k,p,l,y,i,u,S,d]),I=(0,n.useCallback)((()=>{!function(e){e.reset()}(k)}),[k]),R=(0,n.useCallback)((()=>(0,m.jsx)(o(69222).Q,{groupFormat:void 0,groupBy:i,currentGroups:l,schema:d,onChange:P,onClose:I,parentStore:g})),[l,i,P,I,g,d]);return V&&(0,ro().LG)(V)?(0,m.jsx)(Dr().ZP,{render:R,buttonPopupStore:k,popupType:y.device.isMobile?Dr().Z4.SlideUp:Dr().Z4.Popup,renderOrigin:e=>"board"===t?(0,m.jsx)(jt().Z,{ariaLabel:b.formatMessage(Ll.addGroup),icon:e=>(0,lo().R)({...e,...T.plusIcon}),style:T.iconButton,...e}):(0,m.jsx)(et().D,{isLightGray:!0,icon:lo().R,style:{display:"flex",height:Bl,marginTop:Fl,marginBottom:Kl,width:"max-content",position:f?"sticky":void 0,left:f&&h?h:0,...r},...e,children:b.formatMessage(Ll.addGroup)})}):null}),ao().Z);var Dl=()=>o(119891);const El=n.memo((function(e){let{render:t,collectionContextStore:o,groupsResultStore:n,groupsReducer:r}=e;return r?(0,m.jsx)(So().Z,{id:"board_columns",reducer:r,collectionContextStore:o,resultStore:n,render:t}):(0,m.jsx)(m.Fragment,{children:t()})}));var Al=()=>o(661297);const Hl=16;function Zl(e){const t=(0,c().yK)((()=>({button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[]);return(0,m.jsx)(Vt().Z,{style:t.button,onClick:e.onClick,children:e.children})}const zl=function(e){const{title:t,description:o,icon:n,style:r,buttonText:i,buttonOnClick:l}=e,s=(0,qn().Z)(!0,300,0),a=(0,c().yK)((e=>({wrapper:{minHeight:250,height:1,display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center",padding:Hl,...r},title:{fontSize:17,fontWeight:b().Ue.medium,color:e.lightTextColor,textAlign:"center",marginBottom:-2},description:{margin:"0 auto",fontSize:14,color:e.lightTextColor},button:{marginTop:12,fontSize:14,fontWeight:b().Ue.medium,color:e.regularTextColor}})),[r]);return s?(0,m.jsxs)("div",{style:a.wrapper,children:[n,(0,m.jsx)("div",{style:a.title,children:t}),o?(0,m.jsx)("div",{style:a.description,children:o}):void 0,i?(0,m.jsx)(Al().Z,{onClick:l,style:a.button,children:i}):void 0]}):null},Wl=n.memo((function(e){const{collectionContextStore:t,isFullScreen:o,paddingLeft:r,paddingRight:i,paddingBottom:l}=e,s=(0,a().Kw)(t.permissionScopesStore),c=t.settingsStore,d=(0,n.useCallback)((()=>{k().r$({collectionContextStore:t,collectionSettingsStore:c}),k().H4({collectionSettingsStore:c,item:{type:"properties",timelineViewTab:"table"}})}),[t,c]);return(0,m.jsx)(zl,{title:(0,m.jsx)(C()._H,{defaultMessage:"No group by property",id:"database.boardView.missingSelectPropertyTitle"}),description:s.canConfigureBlock?(0,m.jsx)(C()._H,{defaultMessage:"<opensettingslink>Add a property to group by</opensettingslink> to your database in order to display a Board view.",id:"database.boardView.missingSelectProperty",values:{opensettingslink:e=>(0,m.jsx)(Zl,{onClick:d,children:e})}}):(0,m.jsx)(C()._H,{defaultMessage:"Board views require a property to group by in order to display.",id:"database.boardView.missingSelectPropertyNoPermissions"}),style:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:l}})}));function Gl(e){const{height:t,boardCoverSize:o,showGroupHeader:n,areColumnsColored:r}=e,i=e.numBoardColumns||3,l=function(e){const t=2*bl;return(0,F().rD)(e)+t}(o),s=(0,c().yK)((e=>({container:{display:"flex",alignItems:"flex-start",paddingTop:n?10:0},groupHeader:{backgroundColor:e.largeShimmerColor,height:16,marginBottom:10,borderRadius:12,width:"50%"},group:{marginTop:n?r?20:8:0,marginRight:10,width:"100%",minWidth:l}})),[r,n,l]),a=v().DZ(i,(e=>(0,m.jsxs)("div",{style:s.group,children:[(0,m.jsx)(ir().Z,{style:s.groupHeader}),(0,m.jsx)(fl,{minHeight:t})]},e)));return(0,m.jsx)("div",{style:s.container,children:a})}const Nl=n.memo((function(e){let{format:t,schema:o,collectionContextStore:n,store:r,columnsDisplayStateForCurrentGroups:i}=e;const l=(0,s().O7)(),c=(0,a().VK)((()=>n.contextType),[n]);return t.board_columns_by?"collectionTypedView"===c?null:(0,m.jsx)(Ol,{groupBy:t.board_columns_by,schema:o,currentGroups:i,onAccept:e=>function(e,t,o,n,r){const i=t.collectionStore();if(!i)return;const l=n.board_columns_by;if(!l)return;ut().tH({update:e,collectionContextStore:t,groupsFormatKey:"board_columns",collectionStore:i,schema:o,groupBy:l,environment:r})}(e,n,o,t,l),groupsLimitStore:n.boardColumnsLimitStore,parentStore:r,type:"board",collectionContextStore:n}):null}));var Ul=()=>o(543172),$l=()=>o(612427);function ql(e,t,o){const{visibleGroups:n}=e,r=t.board_columns_by,i=o.permissionScopesStore.state,l=0===n.length&&!o.shouldShowSpinnerStore.state||n.length>0;return i.canConfigureBlock&&r&&(0,ro().Wz)(r,i.canConfigureCollection)&&!i.isSyncedCollection&&l}function Yl(e,t,o){return{marginLeft:e,marginRight:t,float:"left",paddingBottom:o}}function Ql(e){return{display:"flex",position:"relative",flexGrow:1,paddingBottom:e}}function Xl(e){return{marginTop:4,...e.isLast&&{paddingBottom:12}}}function Jl(e,t,o){return{height:"calc(100% + 17px)",...o?{}:{background:e?t.cardContentBackground:t.contentBackground},width:20,marginLeft:-20,marginTop:-17}}const es=n.memo((function(e){const{collectionContextStore:t,columnsDisplayState:o,currentGroups:r,disableBoardColorColumns:i,disabled:l,format:d,headerPlaceholderHeight:u,hiddenGroups:p,hiddenGroupsHeaderRef:g,hoveredGroupStore:S,isFullScreen:h,isInPeekRenderer:f,isRootChild:y,paddingLeft:v,paddingRight:x,query:b,schema:w,store:k,visibleGroups:V}=e,j=(0,s().O7)(),T=(0,c().Fg)(),P=(0,je().E)("collection_group_reducer_visible"),I=(0,n.useRef)(null),R=(0,a().VK)((()=>(0,ho().qW)({device:j.device,isFullScreen:h,isRootChild:y})),[j.device,h,y]),_=function(e,t,o,n){const r=(0,F().jw)(t,e);return(0,a().VK)((()=>{const i=t.isInHomeWidgetStore.state,l=i?"transparent":(null==r?void 0:r.background)||(o?e.cardContentBackground:e.contentBackground),s=wl(n,i);return{position:"absolute",background:l,height:Cl+s,paddingTop:s,zIndex:at().LN,display:"flex",boxShadow:`-3px 0 0 ${l}`,minWidth:"100%"}}),[t,null==r?void 0:r.background,o,e.cardContentBackground,e.contentBackground,n])}(T,t,f,i),M=(0,c().yK)((()=>({stickyHeader:{paddingLeft:v,paddingRight:x},stickyHeaderTransition:{paddingLeft:v}})),[v,x]),B=(0,a().Kw)(t.permissionScopesStore).canConfigureBlock,K=(0,a().Kw)(t.isInHomeWidgetStore),L=(0,n.useCallback)(((e,o)=>(0,m.jsx)(ts,{schema:w,collectionContextStore:t,format:d,query:b,disabled:l,isFullScreen:h,isInPeekRenderer:f,hoveredGroupStore:S,groupFormat:V[o],currentGroups:r})),[t,r,l,d,S,h,f,b,w,V]),O=(0,n.useCallback)((e=>{"v2"!==o.version?ut().Zv({environment:j,collectionContextStore:t,isHidden:!1,groupsFormatKey:"board_columns",groupByKey:"board_columns_by",currentGroups:r,newGroupIds:e}):ut().go({environment:j,collectionContextStore:t,groupByKey:"board_columns_by",groupsFormatKey:"board_columns",newGroupIds:e,currentGroups:void 0})}),[t,o.version,r,j]),D=(0,a().VK)((()=>(0,ho().Df)(o,t,!0)),[t,o]),E=(0,a().VK)((()=>ql(o,d,t)),[t,o,d]);if(0===V.length&&0===p.length)return null;const A=V.map((e=>(0,ro().mD)(e)));return d.board_columns_by?(0,m.jsx)(Qr().u,{stickyAttachPoint:K?"no-stick":"ceiling",absoluteHeight:u,nodeRef:I,stickyStyle:M.stickyHeader,transitionStickyStyle:M.stickyHeaderTransition,children:(0,m.jsxs)("div",{style:_,ref:I,children:[R&&(0,m.jsx)("div",{style:Jl(f,T,K)}),B?(0,m.jsx)(Dl().ZP,{direction:"horizontal",keys:A,renderKey:L,onDrop:O}):A.map(((e,o)=>(0,m.jsx)(ts,{schema:w,collectionContextStore:t,format:d,query:b,disabled:l,isFullScreen:h,isInPeekRenderer:f,hoveredGroupStore:S,groupFormat:V[o],currentGroups:r},(0,ro().mD)(V[o])))),D&&(0,m.jsx)(zi,{groupsDisplayState:o,groupsLimitStore:t.boardColumnsLimitStore,type:"board",schema:w,collectionContextStore:t}),E&&(0,m.jsx)(Nl,{format:d,schema:w,collectionContextStore:t,store:k,columnsDisplayStateForCurrentGroups:r}),p.length>0&&!P&&(0,m.jsx)("div",{style:{position:"relative",width:220,flexShrink:0,display:"flex",alignItems:"center",fontSize:14,color:T.lightTextColor,marginLeft:20},ref:g,children:(0,m.jsx)(C()._H,{defaultMessage:"Hidden groups",id:"collection.boardView.hiddenGroups.label"})})]})}):null})),ts=n.memo((function(e){let{groupFormat:t,currentGroups:o,schema:n,collectionContextStore:r,format:i,query:l,disabled:s,isFullScreen:c,isInPeekRenderer:d,hoveredGroupStore:u}=e;return(0,a().VK)((()=>r.groupsStore.getGroupState([t])),[r,t])&&i.board_columns_by?(0,m.jsx)(Vi,{currentGroups:o,groupFormat:t,query:l,schema:n,format:i,groupBy:i.board_columns_by,collectionContextStore:r,hoveredGroupStore:u,disabled:s,hidden:!1,isPopup:!1,isInPeekRenderer:d,isFullScreen:c}):null}));var os=()=>o(740046),ns=()=>o(838367),rs=()=>o(967092);class is extends d().default{getInitialState(){return{searchQuery:"",limit:is.defaultLimit}}}is.defaultLimit=20,is.loadMoreScrollOffset=200,is.loadMoreIncrement=20;const ls=is,ss={display:"flex",alignItems:"center",justifyContent:"flex-start",height:32,padding:4,borderRadius:6},as=(0,C().vU)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"boardHiddenGroup.searchPlaceholder"}}),cs=n.memo((function(e){const{device:t}=(0,s().O7)(),r=(0,s().O7)(),i=(0,c().Fg)(),{groupBy:l,groupFormat:d,disabled:u,format:p,query:g,schema:S,currentGroups:h,collectionContextStore:f,blockPropertyValueOverlayStore:y,isFullScreen:v,hoveredGroupStore:x,isInPeekRenderer:b}=e,C=(0,a().qz)(void 0,Be().Z),w=(0,a().qz)(void 0,ls),k=n.useRef(null),V=(0,a().VK)((()=>{var e;return null===(e=g.aggregations)||void 0===e?void 0:e[0]}),[g]),j=(0,a().Kw)(f.isInHomeWidgetStore),T=(0,a().VK)((()=>f.collectionViewBlockStore()),[f]),P=(0,n.useMemo)((()=>T?new(te().G)(r,{table:L().iU,id:T.id}):null),[r,T]),R=(0,n.useCallback)((()=>(0,m.jsx)(bs,{groupFormat:d,disabled:u,format:p,collectionContextStore:f,schema:S,blockPropertyValueOverlayStore:y,isFullScreen:v,buttonPopupStore:C})),[y,C,f,u,p,d,v,S]),{searchQuery:_,limit:M}=(0,a().Kw)(w),B=(0,a().VK)((()=>{const e=(0,po().zk)({schema:S,group:d,groupBy:p.board_columns_by,propertyMapping:void 0,timeZone:(0,mo().r)(),experimentService:Le().default});if(!e)return;return{type:"results",filter:e,limit:M,searchQuery:_,loadContentCover:Boolean(p&&p.board_cover&&"page_content"===p.board_cover.type)}}),[d,S,p,_,M]),K=(0,n.useCallback)((e=>function(e,t,o){o.setState({searchQuery:e.target.value,limit:ls.defaultLimit}),hs(t)}(e,r,w)),[r,w]),O=(0,n.useCallback)((()=>function(e,t){t.reset(),hs(e)}(r,w)),[r,w]),D=(0,n.useCallback)((()=>(0,m.jsxs)(n.Fragment,{children:[!t.isMobile&&(0,m.jsx)(Vi,{groupBy:l,currentGroups:h,groupFormat:d,query:g,schema:S,format:p,collectionContextStore:f,disabled:u||Boolean(_),hidden:!0,isPopup:!0,isFullScreen:v,hoveredGroupStore:x,isInPeekRenderer:b},(0,ro().mD)(d)),(0,m.jsx)("div",{style:{margin:t.isMobile?0:"6px 0"},children:(0,m.jsx)(pt().Z,{capture:!0,render:e=>(0,m.jsx)(os().ZP,{value:_,placeholder:ht().Z.formatMessage(as.searchPlaceholder),autoFocus:!t.isMobile,showClearButton:!0,onChange:K,onClearButtonClick:O,...e})})})]})),[f,h,t.isMobile,u,p,l,d,O,K,x,v,b,g,S,_]),E=(0,n.useCallback)((e=>function(e,t,o,n){var r;const i=n.state,l=null===(r=gs(t,o))||void 0===r||null===(r=r.state)||void 0===r?void 0:r.blockIds,s=t.isLoadingStore.state;e<ls.loadMoreScrollOffset&&!s&&l&&i.limit<=l.length&&n.setState({...i,limit:i.limit+ls.loadMoreIncrement})}(e,f,d,w)),[f,d,w]),A=(0,n.useCallback)((e=>(0,m.jsx)("div",{...e,children:(0,_n().o)({width:18,height:18,color:i.lightTextColor})})),[i.lightTextColor]),H=(0,n.useCallback)((e=>(0,m.jsx)(fs,{parent:e,groupFormat:d,currentGroups:h,format:p,schema:S,query:g,collectionContextStore:f})),[d,h,p,S,g,f]),Z=(0,n.useCallback)((e=>{let o,{selectableEvents:n}=e;return o=t.isMobile?{menuType:fr().o.Modal,title:(0,m.jsx)(Yr().Z,{groupBy:l,groupFormat:d,currentGroups:h,schema:S,disabled:!0,isHiddenGroup:!0,collectionContextStore:f}),left:(0,m.jsx)(Dr().ZP,{popupType:rs().kQ.SlideUp,renderOrigin:A,render:H}),right:(0,m.jsx)(br().DoneMenuText,{}),onClickRight:()=>xs(C),header:D()}:{menuType:fr().o.Popup,header:D(),width:(0,F().rD)(ms(p))+20},B?(0,m.jsxs)(vr().Z,{...o,...n,children:[(0,m.jsx)(So().Z,{id:`board_hidden_group:${(0,ro().mD)(d)}`,reducer:B,groupsPointer:[d],collectionContextStore:f,resultStore:gs(f,d),render:R}),(0,m.jsx)(zo().Z,{onChange:E})]}):null}),[t.isMobile,B,d,f,R,E,l,h,S,A,H,D,C,p]),z=(0,n.useCallback)((()=>{if(P)return(0,m.jsx)(o(299519).Z,{store:P,isDefaultContainer:!0,droppable:!0,render:Z})}),[P,Z]),W=(0,n.useCallback)((()=>function(e,t){t.reset(),hs(e)}(r,w)),[r,w]),G=(0,n.useCallback)((async e=>{const{droppedStores:t,duplicate:o}=e,n=k.current;if(!n)return;if(!(n instanceof Element))return;const i=await de().F.formulas.load();I().createAndCommit({userAction:"BoardHiddenGroup.handleDrop",environment:r,canUndo:!0,perform:e=>ut().by({environment:r,collectionContextStore:f,groupsPointer:[d],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:i})})}),[f,d,r]),N=(0,n.useCallback)((e=>(0,m.jsx)(ds,{buttonPopupEvents:e,aggregation:V,schema:S,collectionContextStore:f,query:g,groupFormat:d,groupBy:l,currentGroups:h,isInHomeWidget:j})),[S,f,g,d,l,h,j,V]);return P?(0,m.jsx)("div",{ref:k,children:(0,m.jsx)(ot().Z,{store:P,canDropOnto:!u,onSelectableDrop:G,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,children:(0,m.jsx)(Dr().ZP,{popupType:t.isMobile?rs().kQ.SlideUp:rs().kQ.Popup,renderOrigin:N,render:z,buttonPopupStore:C,onClick:W})})}):null}));function ds(e){let{query:t,aggregation:o,buttonPopupEvents:r,groupFormat:i,groupBy:l,currentGroups:a,schema:d,collectionContextStore:u,isInHomeWidget:p}=e;const g=(0,s().O7)(),S=(0,c().yK)((e=>({button:{...ss,...p?{fontSize:14}:{}}})),[p]),h=(0,n.useCallback)((e=>function(e,t,o,n){const r=t.collectionViewStore(),i=e?[e]:[],l={...o,aggregations:i};r&&I().createAndCommit({userAction:"BoardHiddenGroup.handleBoardAggregationChange",environment:n,canUndo:!0,perform:e=>{(0,Sr().i)({collectionViewStore:r,update:{query2:l},transaction:e})}})}(e,u,t,g)),[u,t,g]);return(0,m.jsxs)(Vt().Z,{style:S.button,...r,children:[(0,m.jsx)(Yr().Z,{groupBy:l,groupFormat:i,currentGroups:a,schema:d,disabled:!0,isHiddenGroup:!0,collectionContextStore:u}),o&&(0,m.jsx)(bi,{groupFormat:i,aggregation:o,schema:d,collectionContextStore:u,disabled:!0,onChange:h})]},(0,ro().mD)(i))}function us(e){return e?e.board_cover:void 0}function ps(e){return e?e.board_cover_aspect:void 0}function ms(e){return e?e.board_cover_size:void 0}function gs(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.reducerResultStore}function Ss(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore}function hs(e){oe().default.state.stores.length>0&&T().ZH({environment:e})}function fs(e){let{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:s}=e;const c=(0,a().VK)((()=>s.collectionStore()),[s]),d=s.boardColumnsLimitStore;return c?(0,m.jsx)(Vr,{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:d}):null}function ys(e,t,o,n,r){const{blocks:i,transaction:l}=e,s=o.groupsStore.getGroupState(t);if(!s)return;const a=s.resultsStore;if(i.length>0&&a.state.length>0){const e=i[0];if(!(0,Ge().ww)(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;Yo({transaction:l,environment:r,collectionContextStore:o,isFullScreen:n,groupsPointer:[t],insertAtIndex:a.state.findIndex((t=>t===e))+1,from:"board_group_enter_add_item",transient:!0})}}function vs(e,t,o,n){const r=t.collectionStore(),i=e.getTitleStore();if(yt().QaF(null==i?void 0:i.getValue()))return void T().Ys({environment:n,store:e});if(!r)return;const l=Ss(t,o);if(!l)return;const s=l.state.findIndex((t=>t===e))-1,a=t.collectionViewStore(),c=t.collectionViewBlockStore();if(a&&c&&O().sG(n,{...(0,ge().Pn)(t),block_id:e.id}),I().createAndCommit({userAction:"BoardHiddenGroup.handleBoardItemTextEsc",environment:n,canUndo:!0,perform:t=>{ut().Od({store:e,transaction:t})}}),s>=0){const e=l.state[s];T().Ys({environment:n,store:e})}}function xs(e){e.setState({open:!1})}function bs(e){let{groupFormat:t,disabled:o,format:r,collectionContextStore:i,schema:l,blockPropertyValueOverlayStore:c,isFullScreen:d,buttonPopupStore:u}=e;const p=(0,s().O7)(),g=(0,n.useCallback)((()=>xs(u)),[u]),S=(0,n.useCallback)((e=>ys(e,t,i,d,p)),[t,i,d,p]),{device:h}=p,f=(0,a().VK)((()=>{var e;return null===(e=gs(i,t))||void 0===e?void 0:e.state}),[i,t]),y=(0,a().VK)((()=>{var e;return null===(e=Ss(i,t))||void 0===e?void 0:e.state}),[i,t]),v=(0,a().VK)((()=>ze().default.isSidePeekOpen()),[]);return f&&y?0===y.length?(0,m.jsx)(Cr().Z,{children:(0,m.jsx)(ns().Z,{title:(0,m.jsx)(C()._H,{defaultMessage:"No results",id:"database.boardView.searchResults.noResults.label"})})}):(0,m.jsx)("div",{style:{padding:h.isMobile?"8px 16px":"6px 14px 8px"},children:(0,m.jsx)(Lo,{collectionContextStore:i,groupsPointer:[t],format:r,canDrag:!o,onSelectableEnter:S,disableRequest:!0,resultProps:{format:r,schema:l,disabled:o,coverFormat:us(r),coverAspectFormat:ps(r),coverSizeFormat:ms(r),colorStyle:void 0,blockPropertyValueOverlayStore:c,onTextEnter:e=>function(e,t,o,n,r){const i=Ss(t,n);if(!i)return;if(!(0,Ge().ww)(r)||!t.collectionStore())return vs(e,t,n,r);const l=i.state.findIndex((t=>t===e))+1;I().createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:r,canUndo:!0,perform:e=>{Yo({transaction:e,environment:r,collectionContextStore:t,isFullScreen:o,groupsPointer:[n],insertAtIndex:l,from:"board_group_enter_add_item",transient:!0})}})}(e,i,d,t,p),onTextEsc:e=>vs(e,i,t,p),onShiftEnter:e=>ys(e,t,i,d,p),collectionContextStore:i},resultComponent:$n,handleOpenPeekPage:v?void 0:g,canDrop:!0,disabled:o,shouldShowHoverMenu:!1,direction:Fo.Vertical,belowDropZoneMargin:2,emptyDroppableSize:4,analyticsName:"board"})}):(0,m.jsx)(Cr().Z,{children:(0,m.jsx)(ns().Z,{title:(0,m.jsx)(sn().Z,{})})})}const Cs=cs,ws=n.memo(n.forwardRef((function(e,t){const{collectionContextStore:o,disabled:r,disableBoardColorColumns:i,hiddenGroups:l,store:c,format:d,query:u,schema:p,isFullScreen:g,isInPeekRenderer:S,blockPropertyValueOverlayStore:h,columnsDisplayStateForCurrentGroups:f,hoveredGroupStore:y}=e,v=(0,s().O7)(),x=(0,s().Fy)(),b=(0,Ve().PE)(c,r),C=(0,a().VK)((()=>b&&!x.isMobile&&!o.permissionScopesStore.state.isLocked&&o.permissionScopesStore.state.canEditContent),[b,o,x]),w=(0,n.useMemo)((()=>l.slice(0,ho().ew)),[l]),k=(0,n.useMemo)((()=>w.map((e=>(0,ro().mD)(e)))),[w]),V=(0,a().Kw)(o.permissionScopesStore),j=(0,n.useCallback)((e=>{if(d.board_columns_by)return(0,m.jsx)(Cs,{query:u,schema:p,format:d,groupFormat:e,groupBy:d.board_columns_by,currentGroups:f,collectionContextStore:o,disabled:r||!b||!V.canEditContent&&"collectionTypedView"!==o.contextType,blockPropertyValueOverlayStore:h,isFullScreen:g,hoveredGroupStore:y,isInPeekRenderer:S},(0,ro().mD)(e))}),[h,b,o,f,r,d,y,g,S,V.canEditContent,u,p]),T=(0,n.useCallback)(((e,t)=>j(w[t])),[w,j]),P=(0,n.useCallback)((e=>ut().Zv({environment:v,collectionContextStore:o,isHidden:!0,groupsFormatKey:"board_columns",groupByKey:"board_columns_by",currentGroups:f,newGroupIds:e})),[o,f,v]),I=(0,a().VK)((()=>function(e,t){const o=e.isInHomeWidgetStore.state;return{width:220,flexShrink:0,marginTop:Cl+wl(t,o),marginLeft:12}}(o,i)),[o,i]);return(0,m.jsx)("div",{style:I,ref:t,children:w.length>0&&(C?(0,m.jsx)(Dl().ZP,{direction:"vertical",keys:k,renderKey:T,onDrop:P}):(0,m.jsx)("div",{children:w.map(j)}))})})));const ks=n.memo((function(e){let{args:t,collectionContextStore:o,isInPeekRenderer:n,format:r,setSubgroupsMounted:i,columnsDisplayStateStore:l}=e;const s=(0,a().Kw)(o.isInHomeWidgetStore),d=(0,a().VK)((()=>function(e,t){return t.state.visibleGroups.length*(ki(e)+2*bl+2*vl)}(r,l)),[r,l]),{stickyStyle:u}=(0,c().yK)((e=>s?{stickyStyle:{}}:{stickyStyle:{background:n?e.cardContentBackground:e.contentBackground,boxShadow:`0 1px 0 ${n?e.cardContentBackground:e.contentBackground}`}}),[s,n]);return(0,m.jsx)(Jr,{...t,height:s?gt().yZ:36,stickyStyle:u,style:{...t.style,minWidth:d},onMount:i})})),Vs=d().default.createClass(void 0,{name:"GroupsReducerResultStore"}),js=d().default.createClass(void 0,{name:"HoveredGroupStore"}),Ts=n.memo((function(e){const{store:t,format:r,schema:i,collectionContextStore:d,isFullScreen:u,isPreviewing:p,paddingLeft:g,paddingRight:S,paddingBottom:h,disabled:f,query:y,blockPropertyValueOverlayStore:x,isInPeekRenderer:b,isRootChild:w}=e,k=(0,s().O7)(),V=(0,c().Fg)(),T=(0,C().YB)(),P=(0,je().E)("collection_group_reducer_visible"),R=(0,n.useRef)(null),_=(0,n.useRef)(null),M=(0,n.useRef)(0),B=(0,n.useRef)(null),K=(0,a().qz)(void 0,Vs),L=(0,a().Kw)(K),O=(0,a().qz)(void 0,js),[D,E]=(0,n.useState)(!1),A=(0,a().SI)((()=>{var e,t;const o=d.collectionViewStore();if(!o)return[void 0,void 0];return[null==o||null===(e=o.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_group_by").getValue(),null==o||null===(t=o.getFormatStore())||void 0===t?void 0:t.getKeyStore("board_columns_by").getValue()]}),[d],{useDeepEqual:!0}),H=(0,a().VK)((()=>{const e=r.board_columns_by;if(e)return(0,ro().Qq)({schema:i,groupBy:e})}),[r.board_columns_by,i],{useDeepEqual:!0}),Z=(0,a().Kw)(d.boardColumnsLimitStore),z=(0,a().VK)((()=>!Boolean((0,ho().II)({environment:k,groupFormat:void 0,schema:i,format:r,theme:V}))),[k,r,i,V]),[W,G]=(0,ri().P)({collectionContextStore:d,groupBy:r.board_columns_by,groupsFormatKey:"board_columns",reducerResult:L,groupsLimit:Z}),N=(0,a().VK)((()=>{const{visibleGroups:e}=W,t=r.collection_group_by,o=d.collectionViewBlockStore(),n=K.state;if(!o||!t)return!1;let l=[];var s;n&&"v2"===n.version?l=n.results.map((e=>({property:t.property,value:e.value}))):l=(0,ho().Cz)({groupBy:t,schema:i,formatGroups:r.collection_groups||[],schemaGroups:H,reducerResults:null==n?void 0:n.results,getRecordModel:o.getRecordModel,relativeVariableResult:d.relativeVariableStore.state,viewAppConfigUri:null===(s=d.collectionViewStore())||void 0===s?void 0:s.getFormat().app_config_uri,allowedCollectionStores:d.collectionStoresStore.state});if(0===l.length){if(void 0!==t)return!1;for(const t of e){const e=d.groupsStore.getGroupState(t);if(null!=e&&e.reducerResultStore.state)return!0}}else for(const r of l)for(const t of e){const e=[r,t],o=d.groupsStore.getGroupState(e);if(null!=o&&o.reducerResultStore.state)return!0}return!1}),[d,W,r,K,i,H]),U=(0,a().VK)((()=>{const e=r.board_columns_by;if(e)return(0,ho().ej)({groupBy:e,schema:i,format:r,groupsFormatKey:"board_columns",limit:d.boardColumnsLimitStore.state})}),[d,r,i]),$=(0,Ve().PE)(t,f),q=(0,a().VK)((()=>{const e=d.permissionScopesStore.state;return $&&("collectionTypedView"===d.contextType||e.canEditContent)}),[$,d]);(0,n.useEffect)((()=>{const e=d.collectionStore();e&&(!r.board_columns_by&&t.isDefined()&&e.isDefined()&&function(e,t,o,n){const r=e.collectionStore(),i=e.permissionScopesStore.state;if(!r||!r.isDefined())return;const l=e.collectionViewStore();l&&i.canConfigureBlock&&I().createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:n,canUndo:!0,perform:s=>{let a,c=F().Se(t);if(!c&&i.canConfigureCollection&&(c=(0,Ul().ZP)(),a={[c]:{name:o.formatMessage({id:"collection.boardView.selectProperty.defaultName",defaultMessage:"Status"}),type:"select",options:[]}}),!c)return;const d=(a||t)[c];d&&(0,ro().LG)(d)&&(Sn().FH({stores:[l],update:{board_columns_by:(0,ro().fw)({property:c,propertySchema:d,isCollectionTypedView:"collectionTypedView"===e.contextType})},transaction:s}),An().sW({store:l,data:{type:"board"},transaction:s}),a&&(0,$l().x)({environment:n,collectionStore:r,update:a,transaction:s}))}})}(d,i,T,k),l().default.afterNextFlush((()=>{if(!_.current||!R.current)return;let e=0;if(R.current){const t=_.current.getBoundingClientRect().left;e=R.current.getBoundingClientRect().left-t+8}const t=e+M.current;M.current=t,_.current.style.left=`${t}px`})))}),[d,k,r.board_columns_by,T,i,t]);const Y=(0,n.useMemo)((()=>v().Ds((()=>function(e,t,o,n){const r=n.state.currentGroups;ut().$D({environment:e,format:t,groupsFormatKey:"board_columns",collectionContextStore:o,currentGroups:r})}(k,r,d,G)),5e3)),[d,G,k,r]);(0,n.useEffect)((()=>(G.addListener(Y),()=>{G.removeListener(Y),Y.cancel()})),[G,Y]),(0,n.useEffect)((()=>{const e=()=>E(!1);return A.addListener(e),()=>A.removeListener(e)}),[A]);const Q=(0,n.useCallback)((()=>O.setState(void 0)),[O]),X=(0,n.useCallback)((e=>{const o=W.visibleGroups;return(0,m.jsx)("div",{style:Dl().l8,children:o.map(((n,l)=>{const s=l===o.length-1,a=e?[e,n]:[n],c=0!==W.hiddenGroups.length;return d.groupsStore.getGroupState(a)?(0,m.jsx)(kl,{store:t,hoveredGroupStore:O,query:y,schema:i,format:r,groupsPointer:a,collectionContextStore:d,isFullScreen:u,isInPeekRenderer:b,disabled:f||!q,isLast:s&&!c,blockPropertyValueOverlayStore:x,anyGroupHasResults:N},(0,ro().KW)(a)):null}))})}),[N,x,q,d,W.hiddenGroups.length,W.visibleGroups,f,r,O,u,b,y,i,t]),J=(0,n.useCallback)((()=>{E(!0)}),[E]),ee=(0,n.useCallback)((e=>(0,m.jsx)(ks,{collectionContextStore:d,isInPeekRenderer:b,format:r,setSubgroupsMounted:J,columnsDisplayStateStore:G,args:e})),[d,G,r,b,J]),te=(0,n.useCallback)((e=>function(e,t,o){const{device:n}=o;if(n.isMobile)No()._c({environment:o,store:e,pageVisitSource:Go().tY.Create});else{const n="collectionTypedView"===t.contextType;Uo().CH({environment:o,store:e,peekMode:F().kr(t),showMoveTo:n,resultsStore:void 0,collectionContextStore:t,pageVisitSource:Go().tY.Create})}}(e,d,k)),[d,k]),oe=N,ne=D,re=(0,a().Kw)(d.shouldShowSpinnerStore)&&!ne&&!oe,ie=(0,a().Kw)(d.isInHomeWidgetStore),le=(0,a().VK)((()=>!!d.viewsModuleContextStore.getViewModuleType()),[d]),{visibleGroups:se,hiddenGroups:ae,currentGroups:ce}=W,de=r.collection_group_by,ue=u?480:ie?220:360,pe=Cl+wl(z,ie),ge=(0,n.useCallback)((()=>(0,Yn().Z)((e=>(0,m.jsx)("div",{style:Yl(g,S,se.length>0?pe:0),className:me().EGJ,...e,ref:B,children:(0,m.jsx)(ci().Q,{nodeRef:B,children:(0,m.jsxs)(ot().Z,{style:Ql(h),store:t,shouldShowHalo:!u&&!ie,canSelect:!u&&!le,disablePointerEvents:p,onMouseDown:e=>function(e,t){const{device:o}=t,{target:n}=e;!o.isMobile&&0===e.button&&n instanceof HTMLElement&&(0,ye().ZP)({event:e,context:ye().Af.EditorMouseDown,callback:()=>{e.preventDefault(),j().AI({environment:t,target:n,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,k),analyticsName:"board",onMouseLeave:Q,children:[(!re||!ie)&&(0,m.jsx)(es,{collectionContextStore:d,columnsDisplayState:W,currentGroups:ce,disableBoardColorColumns:z,disabled:f,format:r,headerPlaceholderHeight:pe,hiddenGroups:ae,hiddenGroupsHeaderRef:_,hoveredGroupStore:O,isFullScreen:u,isInPeekRenderer:b,isRootChild:w,paddingLeft:g,paddingRight:S,query:y,schema:i,store:t,visibleGroups:se}),re&&(0,m.jsx)(Gl,{height:ue,numBoardColumns:se.length,boardCoverSize:r.board_cover_size,areColumnsColored:!z,showGroupHeader:!0}),se.length>0&&(0,m.jsx)("div",{style:{display:"flex",flexDirection:"column",position:"relative",top:pe},children:de?(0,m.jsx)(il,{reducerId:o(56718).M9,store:t,collectionContextStore:d,disabled:f,isFullScreen:u,isRootChild:w,paddingLeft:g,stickyLeft:!k.device.isMobile,renderGroup:X,getGroupStyle:Xl,renderHeader:ee,onGroupHeaderAddItem:te}):X(void 0)}),(0,ho().Df)(W,d,!0)&&(0,m.jsx)("div",{style:{width:90,marginLeft:vl,marginRight:vl,pointerEvents:"none"}}),ql(W,r,d)&&(0,m.jsx)("div",{style:{width:35,marginLeft:vl,marginRight:vl,pointerEvents:"none"}}),ae.length>0&&!P&&(0,m.jsx)(ws,{ref:_,collectionContextStore:d,store:t,disabled:f,hiddenGroups:ae,disableBoardColorColumns:z,format:r,schema:i,query:y,blockPropertyValueOverlayStore:x,isFullScreen:u,isInPeekRenderer:b,columnsDisplayStateForCurrentGroups:W.currentGroups,hoveredGroupStore:O})]})})})))),[x,d,W,ce,z,f,k,r,de,Q,pe,ae,O,u,P,ie,b,p,w,le,te,h,g,S,y,X,ee,i,ue,re,t,se]);return r.board_columns_by?(0,m.jsx)(El,{collectionContextStore:d,groupsResultStore:K,groupsReducer:U,render:ge}):(0,m.jsx)(Wl,{collectionContextStore:d,isFullScreen:u,paddingLeft:g,paddingRight:S,paddingBottom:h})}));o(749411);var Ps=()=>o(70186),Is=()=>o(874459),Rs=()=>o(747589),_s=()=>o(32969),Ms=()=>o(35982),Bs=()=>o(907573),Fs=()=>o(526243),Ks=()=>o(803021);function Ls(e){const{blockPropertyValueOverlayStore:t,calendarBy:r,calendarViewRange:i,canEditCalendar:l,collectionContextStore:s,columnIndex:a,currentlyViewedMonth:d,endOfDay:u,format:p,items:g,query:S,sortedResultsStore:h,schema:f,shouldShowShimmer:y,startOfDay:v}=e,x=(0,Is().Bn)({firstDate:v,secondDate:d}),b=(0,Is().Y3)(v),C=!x&&!b&&"week"!==i,w=(0,c().yK)((e=>({button:{width:"100%",height:44,borderRadius:6},dayNumber:{height:28,color:C?e.lightTextColor:b?e.white:void 0,...b?{width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",background:Qo().ZP.red,marginLeft:"auto",marginRight:"auto"}:{display:"flex",alignItems:"center",justifyContent:"center"}},eventDot:{width:8,height:8,background:e.mediumIconColor,borderRadius:"100%",marginTop:2,marginLeft:"auto",marginRight:"auto"}})),[b,C]),k=(0,n.useMemo)((()=>g.find((e=>(0,Ks().b8)(v,u,e.start,e.end?e.end:void 0)))),[g,v,u]),V=(0,Is().TE)(v),j=(0,n.useCallback)((e=>(0,m.jsxs)(Vt().Z,{style:w.button,...e,children:[(0,m.jsx)("div",{style:w.dayNumber,className:y?`notion-shimmer-calendar-transition notion-shimmer-text animation-delay-${a}`:"notion-shimmer-calendar-transition",children:V}),k&&(0,m.jsx)("div",{style:w.eventDot})]})),[w,y,a,V,k]),T=(0,n.useCallback)((e=>(0,m.jsx)(o(770455).r4,{collectionContextStore:s,initialStartOfDay:v,format:p,schema:f,query:S,calendarBy:r,disabled:!l,onDismiss:e.close,blockPropertyValueOverlayStore:t,resultsStore:h})),[s,v,p,f,S,r,l,t,h]);return(0,m.jsx)(Dr().ZP,{popupType:Dr().Z4.SlideUp,renderOrigin:j,render:T},V.toString())}const Os=(0,n.memo)(Ls);function Ds(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarViewRange:r,canEditCalendar:i,collectionContextStore:l,currentlyViewedMonth:s,format:a,items:d,query:u,sortedResultsStore:p,schema:g,shouldShowShimmer:S,showWeekends:h,startOfWeek:f}=e,y=(0,c().yK)((e=>({container:{display:"flex",boxShadow:`0 -1px 0 ${e.tableDividerColor}`,paddingTop:8,paddingBottom:8,fontSize:14}})),[]),v=h?7:5,x=(0,n.useMemo)((()=>[...Array(v).keys()].map((e=>{const t=(0,Is().Xz)({date:f,daysToAdd:e});return{startOfDay:t,endOfDay:(0,Is().us)(t)}}))),[v,f]);return(0,m.jsx)("div",{style:y.container,children:x.map(((e,n)=>(0,m.jsx)(Os,{blockPropertyValueOverlayStore:t,calendarBy:o,canEditCalendar:i,collectionContextStore:l,columnIndex:n,currentlyViewedMonth:s,endOfDay:e.endOfDay,format:a,items:d,query:u,sortedResultsStore:p,schema:g,shouldShowShimmer:S,startOfDay:e.startOfDay,calendarViewRange:r},e.startOfDay.toString())))},f.toString())}const Es=(0,n.memo)(Ds);var As=()=>o(661727),Hs=()=>o(23151);const Zs=30,zs=(0,C().vU)({addItemLabel:{defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"},linkExistingLabel:{defaultMessage:"Link an existing item",id:"database.calendarView.linkExistingButtonTooltip"},linkExistingCompleteToast:{defaultMessage:"{pageTitle} linked and {numUpdates, plural, one {{numUpdates} property} other {{numUpdates} properties}} updated",id:"database.calendarView.linkExistingToast"}});function Ws(e){const{blockStore:t,calendarStore:r,collectionContextStore:i,columnIndex:l,startOfDay:d,canEditCalendar:u,isInHomeWidget:p,isInPeekRenderer:g,isTypedMsvCollection:S,currentlyViewedMonth:h,calendarBy:f,propertySchema:y,calendarViewRange:v,shouldShowShimmer:x}=e,b=(0,s().O7)(),w=(0,C().YB)(),k=(0,n.useContext)(Jn().Z),{mainEditorCurrentBlockStore:j}=(0,a().Kw)(ft().default),T=(0,a().VK)((()=>i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[i]),{dayStoreMap:P,isDragging:R,hoveredDay:_}=(0,a().VK)((()=>({dayStoreMap:r.state.dayStoreMap,isDragging:r.state.isDragging,hoveredDay:r.state.isDragging?void 0:r.state.hoveredDay})),[r]),{pointer:M,userId:B,inMemoryRecordCache:K}=(0,a().VK)((()=>t),[t]),L=(0,n.useMemo)((()=>{const e=P.get(d);if(e)return e;const t=new(o(128076).G)(b,M,{userId:B,inMemoryRecordCache:K});return P.set(d,t),t}),[P,b,K,M,d,B]),O=(0,Is().Bn)({firstDate:d,secondDate:h}),D=(0,Is().Y3)(d),E=(0,Is().LY)(d),A="date"===y.type,H=!O&&!D&&"week"!==v,Z=!R&&_===d&&(A||D)&&T&&u,z=(0,n.useMemo)((()=>1!==(0,Is().TE)(d)||D?(0,Is().TE)(d):`${new Intl.DateTimeFormat(w.locale,{month:"short",day:"numeric"}).format(new Date(d))} `),[w.locale,D,d]),W=(0,n.useCallback)((e=>{k?k(e):hn().c4({environment:b,url:e})}),[b,k]),G=(0,n.useCallback)((()=>{const{performResult:e}=I().createAndCommit({userAction:"Calendar.createBlockInDay",environment:b,canUndo:!0,perform:e=>{const t=ut().IW({environment:b,collectionContextStore:i,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:e,from:{createBlock:"calendar"},inMemoryRecordCache:b.defaultRecordCache.inMemoryRecordCache});if(!t)return;const o=t.newStore.getAssociatedCollectionStore(),n=(null==o?void 0:o.getMappedProperty(f))??f;Hs().xD({type:"timestamp",environment:b,store:t.newStore,propertyId:n,timestampMs:d,transaction:e});const r=F().mb({environment:b,store:t.newStore,mainEditorCurrentBlockStore:j,collectionContextStore:i,showMoveTo:S})??(0,Cn().ZP)({store:t.newStore,pageVisitSource:Go().tY.Create});return W(r),V().Xd({collectionContextStore:i,resultsStore:void 0}),t.newStore}});return e}),[f,i,b,S,j,W,d]),N=(0,n.useCallback)(((e,t,n)=>{const r=t.getAssociatedCollectionStore(),i=(null==r?void 0:r.getMappedProperty(f))??f;if(Hs().xD({type:"timestamp",environment:b,store:t,propertyId:i,timestampMs:d,transaction:e}),n){var l;const e=Object.keys(n).length+(i in n?0:1),r=(null===(l=t.getModel())||void 0===l?void 0:l.getRenderTitleWithEmojiOrPlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,mo().r)(),intl:w}))||"",s=r.length>53?`${r.slice(0,50)}…`:r;o(102182).d4({item:{label:w.formatMessage(zs.linkExistingCompleteToast,{pageTitle:s,numUpdates:e})},undoFunc:()=>{}})}}),[f,b,d,w]),U=(0,n.useCallback)((e=>{I().createAndCommit({userAction:"Calendar.renderDay",environment:b,canUndo:!0,perform:t=>{const o=i.collectionStore();if(!o&&"collectionTypedView"!==i.contextType)return;const n=Te().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Te().default.DO_NOT_USE_measureAfterNextFlushLegacy(n,{environment:b,getData:()=>ge().yr({collectionContextStore:i,is_native_drop:!1,is_empty:!1})}),Hs().JN({...e,environment:b,startOfDay:d,calendarBy:f,collectionStore:o,collectionContextStore:i,transaction:t})}})}),[f,i,b,d]),$=(0,n.useCallback)((()=>{if(u&&(0,Ge().ww)(b)&&T){const e=G();Co().W(b,{type:"page",from:"calendar_day_double_click",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,ge().Pn)(i)})}}),[u,b,T,G,i]),q=(0,c().yK)((e=>{const t=(()=>{if(E)return p?(0,As().Fq)(e.tableHomeDividerColor,.05):g?e.cardSidebarBackground:e.surface.wash})(),o=H?e.lightTextColor:D?e.white:void 0;return{selectable:{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderRight:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,cursor:"default",background:t},dayNumber:{position:"absolute",fontSize:14,top:4,height:24,lineHeight:"24px",color:o,...D?{right:4,width:24,borderRadius:"100%",textAlign:"center",background:e.calendarTodayBackground}:{right:10,textAlign:"right",transition:"color 100ms ease-out"}}}}),[p,g,D,E,H]);return(0,m.jsxs)(ot().Z,{style:q.selectable,store:L,canDropOnto:u&&A,onSelectableDrop:U,onDoubleClick:$,analyticsName:"calendar_day",shouldShowDropZone:!0,children:[Z&&(0,m.jsx)(Gs,{collectionContextStore:i,createBlockFunc:G,updateBlockDayProperty:N}),(0,m.jsx)("div",{style:q.dayNumber,className:x?`${me().irE} notion-shimmer-text animation-delay-${l} notion-shimmer-calendar-transition`:`${me().irE} notion-shimmer-calendar-transition`,children:z})]},d.toString())}function Gs(e){let{collectionContextStore:t,createBlockFunc:o,updateBlockDayProperty:r}=e;const i=(0,s().O7)(),l=(0,C().YB)(),d=(0,a().VK)((()=>F().Il({collectionContextStore:t,environment:i,intl:l})),[t,i,l]),u=(0,n.useCallback)((()=>{if((0,Ge().ww)(i)){const e=o();Co().W(i,{type:"page",from:"calendar_day_add_button",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,ge().Pn)(t)})}else(0,Ge().eD)(i)}),[i,o,t]),p=(0,c().yK)((e=>({iconToolbar:{position:"absolute",display:"flex",top:6,left:6,padding:2,borderRadius:8,background:e.popoverBackground,boxShadow:e.shadowMD},iconButton:{width:20,height:20}})),[]),g=(0,n.useCallback)(((e,t)=>(0,m.jsx)(jt().Z,{ariaLabel:l.formatMessage(zs.addItemLabel),icon:lo().R,style:p.iconButton,onClick:u,...(0,Mr().Z)(e,{onMouseDown:ye().$0})})),[u,l,p.iconButton]);return(0,m.jsxs)("div",{style:p.iconToolbar,children:[(0,m.jsx)(Tt().Z,{renderTooltip:()=>l.formatMessage(zs.addItemLabel),render:g}),d?(0,m.jsx)(Tt().Z,{renderTooltip:()=>l.formatMessage(zs.linkExistingLabel),render:e=>(0,m.jsx)(dn().a,{collectionContextStore:t,renderLinkButton:t=>(0,m.jsx)(jt().Z,{ariaLabel:l.formatMessage(zs.linkExistingLabel),icon:cn().v,style:p.iconButton,...t,...(0,Mr().Z)(e,{onMouseDown:ye().$0})}),onAddOrLink:r})}):null]})}const Ns=(0,n.memo)(Ws);var Us=()=>o(646574),$s=()=>o(603885),qs=()=>o(790964),Ys=()=>o(384241),Qs=()=>o(412511),Xs=()=>o(670320);const Js=2,ea=3;function ta(e,t){const{store:o,collectionContextStore:r,handleOpenPeekPage:i}=e,l=(0,s().O7)(),c=(0,n.useRef)(null),d=(0,n.useCallback)((()=>{const e=function(e){const{environment:t,store:o,collectionContextStore:n}=e,{mainEditorCurrentBlockStore:r}=ft().default.state;return F().mb({environment:t,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:n,fullyQualified:!1})}({environment:l,store:o,collectionContextStore:r});e&&(i(),hn().c4({environment:l,url:e}))}),[r,l,i,o]),u=(0,n.useMemo)((()=>({store:o,renderedType:"page",getNode:()=>c.current,getBlockStore:()=>o,activate:d})),[d,o]);(0,a().VK)((()=>{r.onItemMount(o)}),[r,o]);const p=(0,m.jsx)("div",{ref:c,children:(0,m.jsx)(na,{...e})});return(0,Ve().ez)(o,t,u,p)}const oa=n.forwardRef(ta);function na(e){const{store:t,row:o,schema:n,format:r,disabled:i,calendarBy:l,showWeekends:c,collectionContextStore:d,includeTime:u,handleOpenPeekPage:p,blockPropertyValueOverlayStore:g,calendarStore:S}=e,h=(0,s().O7)(),{value:f}=(0,ee().XJ)(de().F.formulas),y=n[l],x=(0,a().VK)((()=>!i&&"date"===(null==y?void 0:y.type)&&!d.permissionScopesStore.state.isSyncedCollection),[d.permissionScopesStore,i,null==y?void 0:y.type]),{start:b,end:C,startOfWeek:w,endOfWeek:k,startColumn:V,columnCount:j}=(0,Qs().du)({startUnixTimestampMS:e.start,endUnixTimestampMS:e.end,startOfWeekUnixTimestampMS:e.startOfWeek,endOfWeekUnixTimestampMS:e.endOfWeek}),T=(0,a().VK)((()=>{const e=r.calendar_properties?r.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[],o=e.filter((e=>(0,en().X)({block:t.getModel(),property:e,schema:n,getRecordModel:t.getRecordModel,userId:h.currentUser.id,userTimeZone:(0,mo().r)(),intl:ht().Z.getIntl(),experimentService:Le().default,collectionFeatureGates:(0,tn().W)(),formulasModule:f})));return o.concat(v().e5(e,o))}),[h.currentUser.id,r.calendar_properties,n,t,f]),P=(0,a().VK)((()=>(0,X().ls)({collectionContextStore:d})),[d]);if(!y||!io().Lt(y))return null;const I=T.length+(P?1:0),R=b<w,_=void 0!==C&&C>k;return(0,m.jsxs)(ra,{store:t,row:o,numRows:I,columnCount:j,startIsBeforeStartOfWeek:R,endIsAfterEndOfWeek:_,startColumn:V,disabled:i,isEditableDate:x,calendarBy:l,showWeekends:c,handleOpenPeekPage:p,children:[P&&(0,m.jsx)("span",{style:{paddingRight:4,paddingLeft:8,maxWidth:"100%",overflowX:"hidden",textOverflow:"ellipsis"},children:(0,m.jsx)(vn().O,{blockStore:t,collectionContextStore:d})}),(0,m.jsx)(aa,{store:t,collectionContextStore:d,disabled:i,start:b,startOfWeek:w,end:C,endOfWeek:k,includeTime:u,propertySchema:y}),(0,m.jsx)(da,{store:t,sortedProperties:T,startIsBeforeStartOfWeek:R,disabled:i,blockPropertyValueOverlayStore:g}),x&&(0,m.jsx)(ua,{store:t,start:b,startOfWeek:w,end:C,endOfWeek:k,calendarBy:l,calendarStore:S})]})}function ra(e){const{store:t,children:o,columnCount:r,row:i,numRows:l,startColumn:d,disabled:u,isEditableDate:p,calendarBy:g,showWeekends:S,handleOpenPeekPage:h,startIsBeforeStartOfWeek:f,endIsAfterEndOfWeek:y}=e,v=(0,s().O7)(),x=(0,q().Y$)(),b=(0,a().VK)((()=>F().Ts(t)),[t]),C=sa(l,(0,a().VK)((()=>{var e;return null===(e=x.collectionViewStore())||void 0===e?void 0:e.getFormat()}),[x])),w=Zs+C*i,k=(0,a().qz)(void 0,Xs().Z),V=(0,a().VK)((()=>Oe().Z.state?!0===k.state.dragging:bo().Z.state.hoveredStore===t),[t,k]),j=S?7:5,T=(0,c().yK)((e=>({selectable:{position:"absolute",paddingTop:3,paddingBottom:3,paddingLeft:f?0:6,paddingRight:y?0:6,width:y?`calc(100% / ${j} * ${r} - 1px)`:`calc(100% / ${j} * ${r})`,left:`calc(100% / ${j} * ${d})`,height:C,top:w},haloStyle:{...F().pB(e,b),borderRadius:6,marginTop:2,marginBottom:2,marginLeft:f?0:5,marginRight:y?0:5},linkBoxStyle:{height:"100%",background:e.calendarItemBackground,borderTopLeftRadius:6,borderTopRightRadius:6,borderBottomLeftRadius:6,borderBottomRightRadius:6,boxShadow:e.shadowSM,...y&&{borderTopRightRadius:0,borderBottomRightRadius:0},...f&&{borderTopLeftRadius:0,borderBottomLeftRadius:0}},linkBoxHoveredStyle:{opacity:1,background:e.calendarItemHoveredBackground},linkBoxInnerStyle:{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}})),[r,y,C,j,b,d,f,w]),P=(0,n.useCallback)((e=>{const o=t.getAssociatedCollectionStore();return o?Hs().QG({environment:v,collectionStore:o,collectionContextStore:x,store:t,insertStores:e.insertStores,calendarBy:g,transaction:e.transaction}):[]}),[g,x,v,t]),I=(0,n.useCallback)((e=>{const{transaction:o}=e;t.getAssociatedCollectionStore()&&ut().Od({store:t,transaction:o})}),[t]),[R,_]=(0,a().VK)((()=>{const{mainEditorCurrentBlockStore:e}=ft().default.state,o=F().mb({environment:v,store:t,mainEditorCurrentBlockStore:e,collectionContextStore:x,fullyQualified:!1});return[(0,Cn().ZP)({store:t,fullyQualified:!1,pageVisitSource:Go().tY.LinkInPage}),o]}),[v,x,t]),M=(0,a().Kw)(x.isInHomeWidgetStore);return(0,m.jsx)(ot().Z,{store:t,style:T.selectable,canSelect:!u,shouldShowHalo:!M,shouldForceRenderSelectionHalo:b,haloStyle:T.haloStyle,canTriggerContextMenu:!u,showBlockMenuInput:!0,canDrag:p,onInsertAbove:P,onInsertBelow:P,onRemove:I,canInsertAbove:p,canInsertBelow:p,analyticsName:"calendar",shouldShowDropZone:!0,className:me().K4T,draggableStore:k,children:(0,m.jsx)(bn().Z,{style:T.linkBoxStyle,hoveredStyle:T.linkBoxHoveredStyle,pressedStyle:T.linkBoxHoveredStyle,innerStyle:T.linkBoxInnerStyle,onClick:h,href:R,metaHref:_,hovered:V,children:o})},t.id)}const ia=24,la=36;function sa(e,t){var o;return((null==t?void 0:t.table_wrap)||!0===(null==t||null===(o=t.calendar_properties)||void 0===o||null===(o=o.find((e=>"title"===e.property)))||void 0===o?void 0:o.wrap)?la:ia)+e*$s().ch+2*Js+2*ea}function aa(e){const{store:t,collectionContextStore:o,disabled:i,start:l,startOfWeek:d,end:u,endOfWeek:p,includeTime:g,propertySchema:S}=e,h=(0,s().O7)(),f=l<d,y=u&&u>p,v=(0,a().VK)((()=>(0,X().wI)({collectionContextStore:o,blockStore:t})),[o,t]),x="time_format"in S?S.time_format:Ks().c_,[C,w,k]=(0,a().VK)((()=>[t.getIcon(),t.isEmptyPage(),t.hasError()]),[t]),V=(0,n.useCallback)((e=>{const o=t.getIconStore();o&&I().createAndCommit({userAction:"CalendarItem.handleRecordIconChange",environment:h,canUndo:!0,perform:t=>{An().sO({store:o,value:e,transaction:t})}})}),[h,t]),j=(0,a().VK)((()=>{var e,t,n;const r=null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().calendar_properties;return(null===(t=o.collectionViewStore())||void 0===t?void 0:t.getFormat().table_wrap)||!0===(null==r||null===(n=r.find((e=>"title"===e.property)))||void 0===n?void 0:n.wrap)}),[o]),T=(0,c().yK)((e=>({titleContainer:{paddingLeft:6,paddingRight:6,overflow:"hidden",...f&&{paddingLeft:12},...y&&{paddingRight:11},width:"100%",...j?{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"17px",height:la,paddingTop:2}:{height:ia,whiteSpace:"nowrap"},overflowWrap:"break-word",textOverflow:"ellipsis",fontSize:14,fontWeight:b().Ue.semibold},recordIconStyle:{display:"inline",float:"left",marginRight:3,paddingTop:j?2:4},iconWarningStyle:{display:"inline",float:"left",marginLeft:1,marginRight:5,width:10,height:16,paddingTop:j?2:4,fill:e.accentColors.orange[500]},subitemCountIndicatorContainer:{display:"flex",alignItems:"center",float:"right",paddingTop:j?2:4},timeStyle:{color:e.mediumTextColor,float:"right",fontSize:10,marginLeft:4,height:14,paddingTop:j?2:4},subitemsWrapperStyle:{paddingRight:0,paddingLeft:4}})),[y,f,j]),P=g&&u&&r().Xp.fromDateTimes(d,p).contains(u)&&l.day!==u.day,R=(0,a().VK)((()=>o.shouldShowPageIcon()&&(void 0!==C||!w)&&!k),[o,C,w,k]);return(0,m.jsxs)("div",{style:T.titleContainer,children:[R&&(i?(0,m.jsx)(Hn().Z,{disabled:!0,icon:C,isEmptyPage:w,size:14,style:T.recordIconStyle}):(0,m.jsx)(Hn().Z,{disabled:!1,store:t,bucket:"secure",icon:C,isEmptyPage:w,size:14,style:T.recordIconStyle,onChange:V})),k&&(0,En().t)(T.iconWarningStyle),(0,m.jsx)(ca,{store:t,titlePropertyIsWrapped:j}),v&&(0,m.jsx)("div",{style:T.subitemCountIndicatorContainer,children:(0,m.jsx)(xn().B,{blockStore:t,collectionContextStore:o,wrapperStyle:T.subitemsWrapperStyle})}),g&&r().Xp.fromDateTimes(d,p).contains(l)&&(0,m.jsxs)("div",{style:T.timeStyle,children:[(0,Us().xE)({dateTime:l,humanReadable:!1,timeFormat:x}),P&&(0,m.jsxs)("span",{children:[" → ",(0,Us().xE)({dateTime:u,humanReadable:!1,timeFormat:x})]})]}),(0,m.jsx)(Ys().Z,{store:t,shouldWrap:j})]})}function ca(e){const{store:t,titlePropertyIsWrapped:o}=e,n=(0,c().yK)((e=>({discussionIndicatorStyle:{display:"flex",alignItems:"center",color:e.lightTextColor,fontSize:12,flexShrink:0},discussionIndicatorContainerStyle:{float:"right",marginLeft:4,marginTop:o?-2:1}})),[o]);return(0,m.jsx)(fn().s,{store:t,iconStyle:n.discussionIndicatorStyle,buttonStyle:n.discussionIndicatorContainerStyle,size:12})}function da(e){const{store:t,sortedProperties:o,startIsBeforeStartOfWeek:n,disabled:r,blockPropertyValueOverlayStore:i}=e,l=(0,q().Y$)(),s=(0,a().VK)((()=>l.permissionScopesStore.state.isLocked||!l.permissionScopesStore.state.canEditContent),[l.permissionScopesStore]),[c,d]=(0,a().VK)((()=>[F().Bm({store:t,collectionContextStore:l}),l.collectionViewStore()]),[t,l]);return c?(0,m.jsx)("div",{style:{paddingLeft:6,paddingRight:6,overflow:"hidden",width:"100%",...n&&{paddingLeft:12}},children:o.map((e=>(0,m.jsx)(Ln().m,{store:t,property:e,disabled:r,locked:s,format:wt().C.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:c,collectionViewStore:d},e)))}):null}function ua(e){const{store:t,calendarStore:o,start:r,startOfWeek:i,end:l,endOfWeek:a,calendarBy:d}=e,u=(0,s().O7)(),p=(0,c().yK)((()=>({leftDragHandle:{position:"absolute",top:0,left:-4,height:"100%",width:12,cursor:"col-resize"},rightDragHandle:{position:"absolute",top:0,right:-4,height:"100%",width:12,cursor:"col-resize"}})),[]),g=(0,n.useCallback)((e=>{Hs().td({calendarStore:o,x:e.currentX,y:e.currentY,calendarBy:d})}),[o,d]),S=(0,n.useCallback)((()=>{I().createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:u,canUndo:!0,perform:e=>{Hs().fX({environment:u,transaction:e,calendarStore:o,calendarBy:d})}})}),[d,o,u]),h=(0,n.useCallback)((()=>{Hs().cQ({calendarStore:o})}),[o]),f=r>=i&&(0,m.jsx)(qs().Z,{render:e=>(0,m.jsx)("div",{style:p.leftDragHandle,...e}),onDraggableDragStart:()=>{Hs().f$({calendarStore:o,targetStore:t,direction:Fs().to.Left})},onDraggableDragMove:g,onDraggableDragEnd:S,onDraggableDragCancel:h}),y=(!l||l&&l<a)&&(0,m.jsx)(qs().Z,{render:e=>(0,m.jsx)("div",{style:p.rightDragHandle,...e}),onDraggableDragStart:e=>{Hs().f$({calendarStore:o,targetStore:t,direction:Fs().to.Right})},onDraggableDragMove:g,onDraggableDragEnd:S,onDraggableDragCancel:h});return(0,m.jsxs)(m.Fragment,{children:[f,y]})}function pa(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:r,calendarStore:i,calendarViewRange:l,canEditCalendar:d,collectionContextStore:u,collectionViewStore:p,currentlyViewedMonth:g,endOfWeek:S,format:h,isInHomeWidget:f,isInPeekRenderer:y,isTypedMsvCollection:v,items:x,propertySchema:b,schema:C,shouldShowShimmer:w,showWeekends:k,sortedResultsStore:j,startOfWeek:T}=e,P=(0,s().O7)(),{isDragging:I,targetStore:R,temporaryValue:_}=(0,a().VK)((()=>{const{isDragging:e}=i.state;return{isDragging:e,targetStore:e?i.state.targetStore:void 0,temporaryValue:e?i.state.temporaryValue:void 0}}),[i]),{targetStoreCollectionStoreSchema:M,targetStoreCollectionStoreCalendarBy:B}=(0,a().VK)((()=>{const e=null==R?void 0:R.getAssociatedCollectionStore();return{targetStoreCollectionStoreSchema:null==e?void 0:e.getSchema(),targetStoreCollectionStoreCalendarBy:null==e?void 0:e.getMappedProperty(r)}}),[R,r]),F=(0,n.useCallback)((()=>{Te().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),V().Xd({collectionContextStore:u,resultsStore:j});const e=u.normalizedFormatStore.state.collection_peek_mode,t=e||Vo().Ls.calendar;wo().hy(P,{is_peek:!0,from:"calendar",peek_mode:t})}),[u,P,j]),K=k?7:5,O=(0,n.useMemo)((()=>{const e=[];x.forEach((o=>{const n=te().G.createChildStore(p,{table:L().iU,id:o.id});I&&R===n&&_||e.push((0,m.jsx)(ma,{blockPropertyValueOverlayStore:t,calendarBy:r,calendarStore:i,collectionContextStore:u,endOfWeek:S,format:h,handleOpenPeekPage:F,item:o,schema:C,showWeekends:k,startOfWeek:T,store:n},o.id))}));const o=I&&_&&(0,Is().Y_)(_,(0,mo().r)());if(I&&_&&o&&(0,Ks().b8)(T,S,o.start,o.end)&&R&&null!=R&&R.id){const n=x.find((e=>e.id===R.id));e.push((0,m.jsx)(ma,{blockPropertyValueOverlayStore:t,calendarBy:B??r,calendarStore:i,collectionContextStore:u,endOfWeek:S,format:h,handleOpenPeekPage:F,schema:M??C,showWeekends:k,startOfWeek:T,store:R,item:{id:R.id,start:o.start,end:o.end,row:n?n.row:0,includeTime:"datetime"===_.type||"datetimerange"===_.type}},R.id))}return e}),[t,r,i,u,p,S,h,F,I,x,C,k,T,R,B,M,_]),D=(0,n.useMemo)((()=>Math.max(0,...x.map((e=>e.row)))),[x]),E=(0,a().VK)((()=>(0,X().ls)({collectionContextStore:u})),[u]),A=(0,c().yK)((()=>{const e=(h.calendar_properties?h.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[]).length+(E?1:0),t="week"===l?372:124,o=sa(e,h);return{container:{position:"relative",display:"flex",height:Math.max((D+1)*o+Zs+4,t)}}}),[l,h,D,E]);return(0,m.jsxs)("div",{style:A.container,children:[[...Array(K).keys()].map((e=>{const t=(0,Is().Xz)({date:T,daysToAdd:e});return(0,m.jsx)(Ns,{blockStore:o,calendarStore:i,collectionContextStore:u,columnIndex:e,startOfDay:t,calendarBy:r,currentlyViewedMonth:g,canEditCalendar:d,isInHomeWidget:f,isInPeekRenderer:y,isTypedMsvCollection:v,propertySchema:b,calendarViewRange:l,shouldShowShimmer:w},e)})),O]},T.toString())}function ma(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarStore:n,collectionContextStore:r,endOfWeek:i,format:l,handleOpenPeekPage:s,item:c,schema:d,showWeekends:u,startOfWeek:p,store:g}=e,{canEdit:S,collectionStore:h}=(0,a().VK)((()=>({canEdit:g.canEdit(),collectionStore:g.getAssociatedCollectionStore()})),[g]),{collectionStoreSchema:f,collectionStoreCalendarBy:y}=(0,a().VK)((()=>({collectionStoreSchema:null==h?void 0:h.getSchema(),collectionStoreCalendarBy:null==h?void 0:h.getMappedProperty(o)})),[h,o]);return h?(0,m.jsx)(oa,{collectionContextStore:r,store:g,startOfWeek:p,endOfWeek:i,showWeekends:u,start:c.start,end:c.end,row:c.row,includeTime:c.includeTime,format:l,schema:f??d,calendarBy:y??o,disabled:!S,calendarStore:n,blockPropertyValueOverlayStore:t,handleOpenPeekPage:s},g.id):null}const ga=(0,n.memo)(pa);function Sa(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarStore:n,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:d,isInHomeWidget:u,isInPeekRenderer:p,isTypedMsvCollection:g,query:S,resultStore:h,schema:f,sortedResultsStore:y,weeks:v}=e,{isPhone:x}=(0,s().Fy)(),b=(0,a().VK)((()=>{var e,t;return(void 0===(null===(e=h.getState())||void 0===e?void 0:e.blockIds)||0===(null===(t=h.getState())||void 0===t?void 0:t.blockIds.length))&&(0,Wo().H0)({collectionContextStore:i,groupsPointer:[],hasPartialResults:!1})}),[i,h]),{collectionViewStore:C,calendarViewRange:w,showWeekends:k}=(0,a().VK)((()=>{const e=i.collectionViewStore(),t=null==e?void 0:e.getFormatStore();return{collectionViewStore:e,calendarViewRange:(null==t?void 0:t.getKeyStore("calendar_view_range").getValue())??"month",showWeekends:(null==t?void 0:t.getKeyStore("calendar_show_weekends").getValue())??!0}}),[i]);var V;v&&v.length>0&&(null===(V=i.databaseItemsVisibleTracker)||void 0===V||V.handleItemsRenderStart());const j=(0,c().yK)((e=>({container:x?{}:{boxShadow:`-1px 0 0 ${e.tableDividerColor}`,marginTop:1,overflow:"hidden"}})),[x]),{calendar_by:T}=S;if(!T)return null;const P=f[T];return P&&C?(0,m.jsx)("div",{style:j.container,children:v&&v.map((e=>x?(0,m.jsx)(Es,{blockPropertyValueOverlayStore:t,calendarBy:T,calendarViewRange:w,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:d,items:e.items,query:S,schema:f,shouldShowShimmer:b,showWeekends:k,sortedResultsStore:y,startOfWeek:e.start},e.start):(0,m.jsx)(ga,{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:T,calendarStore:n,calendarViewRange:w,canEditCalendar:r,collectionContextStore:i,collectionViewStore:C,currentlyViewedMonth:l,endOfWeek:e.end,format:d,isInHomeWidget:u,isInPeekRenderer:p,isTypedMsvCollection:g,items:e.items,propertySchema:P,schema:f,shouldShowShimmer:b,showWeekends:k,sortedResultsStore:y,startOfWeek:e.start},e.start)))}):null}const ha=(0,n.memo)(Sa);var fa=()=>o(146947),ya=()=>o(984478),va=()=>o(429600),xa=()=>o(909859),ba=()=>o(61951),Ca=()=>o(880026),wa=()=>o(803728),ka=()=>o(878797),Va=()=>o(138912),ja=()=>o(838266),Ta=()=>o(827510),Pa=()=>o(827539),Ia=()=>o(905263);const Ra=(0,C().vU)({defaultTitle:{id:"openInNotionCalendarOnboardingTooltip.header",defaultMessage:"Get Notion Calendar"},defaultContent:{id:"openInNotionCalendarOnboardingTooltip.content",defaultMessage:"View any Notion database with calendar and timeline views with your Google Calendar events"},connectCalendarTitle:{id:"openInNotionCalendarOnboardingTooltip.connectCalendarTitle",defaultMessage:"Connect Calendar"},successTitle:{id:"openInNotionCalendarOnboardingTooltip.success.header",defaultMessage:"Successfully connected"},successContent:{id:"openInNotionCalendarOnboardingTooltip.success.content",defaultMessage:"You can now view any database with calendar and timeline views in Notion Calendar"}});function _a(e){let{variant:t,origin:o,onCloseClick:n,onConnectCalendarClick:r}=e;const i=(0,c().yK)((e=>({tooltip:{width:233},content:{opacity:1},contentInner:{display:"flex",flexDirection:"column",gap:14},contentMessage:{opacity:.8,color:e.regularInvertedTextColor},footer:{display:"flex",alignItems:"center",gap:12},primaryButton:{display:"flex",alignItems:"center",height:24,padding:"0 12px",marginLeft:"auto",borderRadius:4,background:"#FFF",color:"#1D1B16",fontSize:12,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},primaryButtonHover:{background:"rgba(255,255,255,0.9)"},primaryButtonPressed:{background:"rgba(255,255,255,0.8)"}})),[]);return(0,m.jsx)(Ia().U,{origin:o,placementToOrigin:"bottom",header:(0,m.jsx)(C()._H,{..."success"===t?Ra.successTitle:Ra.defaultTitle}),content:(0,m.jsxs)("div",{style:i.contentInner,children:[(0,m.jsx)("div",{style:i.contentMessage,children:(0,m.jsx)(C()._H,{..."success"===t?Ra.successContent:Ra.defaultContent})}),"default"===t&&(0,m.jsx)("div",{style:i.footer,children:(0,m.jsx)(Vt().Z,{style:i.primaryButton,hoveredStyle:i.primaryButtonHover,pressedStyle:i.primaryButtonPressed,onClick:r,children:(0,m.jsx)(C()._H,{...Ra.connectCalendarTitle})})})]}),contentStyle:i.content,onCloseClick:n,shouldDismissUponOutsideClick:!1,enableMouseCapture:!1,pointerPosition:"33%",style:{...i.tooltip}})}function Ma(e){let{collectionContextStore:t}=e;const o=(0,n.useRef)(null),[r,i]=(0,n.useState)(!1),l=(0,s().O7)(),d=(0,a().VK)((()=>ft().default.state.currentSpaceStore),[]),u=(0,a().VK)((()=>(0,xa().tE)()),[]),p=(0,a().VK)((()=>ka().default.isVisible("open_in_calendar_tooltip")),[]),g=(0,a().VK)((()=>{const e=ja().default.state.open||t.settingsStore.state.open,o=t.isFullScreenStore.state,n=ze().default.state.open;return o&&!e&&!n&&Va().default.state.loaded}),[t]);(0,ba().Z)((()=>{wa().yM(l,"open_in_calendar_tooltip")}),g);const S=(0,n.useCallback)((()=>{const e=t.collectionViewStore(),o=t.collectionStore(),n=null==o?void 0:o.getParentBlockStore();e&&o&&n&&d&&(Ca().QK(l,{is_calendar_connected:u,collection_id:o.id,collection_view_id:e.id,collection_view_block_id:n.id}),Ta().sh({environment:l,collectionViewStore:e,spaceStore:d,from:"openInCalendarButton"}))}),[l,t,d,u]),h=(0,n.useCallback)((()=>{wa().Gi(l,"open_in_calendar_tooltip")}),[l]),f=(0,n.useCallback)((()=>{i(!0),S()}),[S]),y=(0,c().yK)((e=>({button:{marginRight:8,paddingRight:12,fontSize:14,fontWeight:500,height:26},calendarIcon:{marginLeft:4},calendarIconSvg:{fill:e.timelineRed}})),[]);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Al().Z,{ref:o,style:y.button,iconStyle:y.calendarIconSvg,icon:e=>(0,m.jsx)(Pa().Z,{style:{...e,...y.calendarIcon}}),onClick:S,children:(0,m.jsx)(C()._H,{id:"openInNotionCalendarButton.label",defaultMessage:"Open in Calendar"})}),p&&(0,m.jsx)(_a,{variant:r||u?"success":"default",origin:o,onCloseClick:h,onConnectCalendarClick:f})]})}function Ba(e){const t=(0,s().O7)();return(0,a().VK)((()=>(0,xa().ZH)({environment:t,collectionContextType:e.collectionContextStore.contextType,spaceStore:ft().default.state.currentSpaceStore})),[t,e.collectionContextStore])?(0,m.jsx)(Ma,{...e}):null}const Fa=(0,C().vU)({previousMonthButtonAriaLabel:{id:"database.calendarViewHeader.previousMonthButton.ariaLabel",defaultMessage:"Previous Month"},nextMonthButtonAriaLabel:{id:"database.calendarViewHeader.nextMonthButton.ariaLabel",defaultMessage:"Next Month"},todayButtonLabel:{id:"database.calendarViewHeader.todayButton.label",defaultMessage:"Today"}});function Ka(e){const{currentlyViewedMonth:t,calendarViewRange:o,setNewCalendarStart:r,isInHomeWidget:i,dateRangeStart:l,isInPeekRenderer:d,stickyStyle:u,collectionContextStore:p,weeks:g,startOfWeek:S}=e,h=(0,C().YB)(),{isPhone:f,isMobile:y}=(0,s().Fy)(),v=(0,n.useRef)(null),x=(0,c().Fg)(),w=(0,F().jw)(p,x),k=(0,a().VK)((()=>{const e=p.collectionViewStore(),t=null==e?void 0:e.getFormatStore();return(null==t?void 0:t.getKeyStore("calendar_show_weekends").getValue())??!0}),[p]),V=(0,n.useMemo)((()=>{const e=(0,Us().Yx)(t,"month_year_long",fa().locale);if("month"===o)return e;if(!g||void 0===g[0])return"";const n=g[0];if((0,Is().Bn)({firstDate:n.start,secondDate:n.end}))return e;return`${(0,Us().Yx)(n.start,(0,Is().Xh)({firstDate:n.start,secondDate:n.end})?"month_short":"month_year_short",fa().locale)} - ${(0,Us().Yx)(n.end,"month_year_short",fa().locale)}`}),[t,o,g]),j=(0,n.useCallback)((()=>{const e="month"===o?(0,Is().IS)((0,Is().kl)(Date.now()),S):(0,Is().IS)(Date.now(),S);r(e,o)}),[o,r,S]),T=(0,n.useCallback)((e=>{const t=(0,Is().V7)(l,S);if("month"===o){const n="left"===e?-1:1,i=(0,Is().IS)((0,Is().kl)((0,Is()._)({date:t,monthsToAdd:n})),S);r(i,o)}else{const t="left"===e?-7:7,n=(0,Is().IS)((0,Is().Xz)({date:l,daysToAdd:t}),S);r(n,o)}}),[l,S,o,r]),P=(0,c().yK)((e=>{const t=f?e.contentBackground:(null==w?void 0:w.background)||(d?e.cardContentBackground:e.contentBackground);return{container:i?{}:{position:"absolute",left:0,right:0,zIndex:at().VT,background:t},monthSwitcher:{display:"flex",height:42,alignItems:"center",marginBottom:2},monthHeader:{fontWeight:b().Ue.semibold,marginLeft:8,marginRight:8,lineHeight:1,fontSize:f?16:14},spacer:{flexGrow:1},weekdayNamesContainer:{display:"flex",marginTop:f?8:0,boxShadow:`0 1px 0 ${e.tableDividerColor}`},weekdayName:{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,color:e.lightTextColor,height:24}}}),[w,i,d,f]),I=k?(0,Us().kv)(S,fa().locale):(0,Us().vI)(fa().locale);return(0,m.jsx)(Qr().u,{stickyAttachPoint:i?"no-stick":"ceiling",nodeRef:v,stickyStyle:u,transitionStickyStyle:u,absoluteHeight:98,children:(0,m.jsxs)("div",{style:P.container,ref:v,children:[(0,m.jsxs)("div",{style:P.monthSwitcher,children:[(0,m.jsx)("div",{style:P.monthHeader,children:V}),(0,m.jsx)("div",{style:P.spacer}),(0,m.jsx)(Ba,{collectionContextStore:p}),(0,m.jsx)(jt().Z,{ariaLabel:h.formatMessage(Fa.previousMonthButtonAriaLabel),mobileFeedback:y,icon:ya().f,onClick:()=>T("left")}),(0,m.jsx)(et().D,{size:"sm",onClick:j,children:(0,m.jsx)(C()._H,{...Fa.todayButtonLabel})}),(0,m.jsx)(jt().Z,{ariaLabel:h.formatMessage(Fa.nextMonthButtonAriaLabel),mobileFeedback:y,icon:va().o,onClick:()=>T("right")})]}),(0,m.jsx)("div",{style:P.weekdayNamesContainer,className:me().GNl,children:I.map((e=>{let[t,o]=e;return(0,m.jsx)("div",{style:P.weekdayName,children:o},t)}))})]})})}const La=(0,n.memo)(Ka),Oa=n.memo((function(e){const{blockPropertyValueOverlayStore:t,collectionContextStore:r,store:i,format:l,query:u,schema:p,isFullScreen:g,isInPeekRenderer:S,maxHeight:h,minWidth:f,paddingBottom:y,paddingLeft:x,paddingRight:b,isPreviewing:w}=e,k=(0,C().YB)(),V=(0,s().O7)(),{isPhone:P,isMobile:R}=(0,s().Fy)(),_=V.currentUser.id,{value:M}=(0,ee().XJ)(de().F.formulas),B=(0,n.useRef)(null),K=(0,n.useRef)(null),O=(0,o(794623).Z)(K,B),D=(0,a().qz)(void 0,Fs().ZP),E=(0,a().qz)(void 0,d().default),A=(0,Ve().PE)(i,!1),H=(0,a().VK)((()=>Oe().Z.state),[]),Z=(0,a().VK)((()=>pe().AK.state),[]),z=(0,a().VK)((()=>r.collectionViewStore()),[r]),W=(0,a().VK)((()=>r.collectionStore()),[r]),G=null==z?void 0:z.id,N=(0,a().Kw)(r.isLoadingStore),U=(0,a().VK)((()=>"collectionTypedView"===r.contextType),[r]),$=(0,a().Kw)(r.isInHomeWidgetStore),q=(0,a().VK)((()=>!!r.viewsModuleContextStore.getViewModuleType()),[r]),Y=(0,a().Kw)(r.dateRangeStartStore),Q=(0,a().Kw)(r.dateRangeEndStore),X=(0,a().Kw)(r.permissionScopesStore),{calendarStoreState:J,dayStoreMap:oe,startingMonth:ne,hoveredDay:re}=(0,a().VK)((()=>({calendarStoreState:D.state,dayStoreMap:D.state.dayStoreMap,startingMonth:D.state.startingMonth,hoveredDay:D.state.isDragging?void 0:D.state.hoveredDay})),[D]),ie=(0,a().VK)((()=>A&&(X.canEditContent||U)),[A,X.canEditContent,U]),le=(0,a().VK)((()=>{var e;return(null==z||null===(e=z.getFormatStore())||void 0===e?void 0:e.getKeyStore("calendar_view_range").getValue())??"month"}),[z]),se=(0,a().VK)((()=>g&&!R&&"month"===le),[g,R,le]),ae=(0,a().VK)((()=>se||!Y?ne:(0,Is().kl)((0,Is().V7)(Y,Z))),[se,Y,ne,Z]),ce=(0,a().VK)((()=>(0,Bs().Ft)({collectionContextStore:r})),[r],{useDeepEqual:!0}),ue=(0,a().VK)((()=>{if(!z)return[];const e=E.state;if(!e||!e.blockIds)return[];const t=e.blockIds.map((e=>te().G.createChildStore(z,{id:e,table:L().iU})))||[];return(0,Bs().y$)({collectionContextStore:r,results:t,getRecordValue:i.getRecordValue,intl:k,formulasModule:M})}),[z,E,r,i.getRecordValue,k,M],{useDeepEqual:!0}),ge=(0,a().SI)((()=>z&&ue&&(null==ue?void 0:ue.flatMap((e=>e.items.map((e=>te().G.createChildStore(z,{table:L().iU,id:e.id}))))))||[]),[z,ue],{useDeepEqual:!0,debugName:"sortedResultsStore"});(0,a().Kw)(ge);const[Se,he]=(0,n.useState)();(0,n.useEffect)((()=>{var e;null!==(e=B.current)&&void 0!==e&&e.parentElement&&he((0,ke().VW)(B.current.parentElement))}),[]);const ve=(0,n.useCallback)(((e,t)=>{const o=(0,Is().V7)(e,Z);let n;"month"===t?(n=se?(0,Is().V7)((0,Is()._)({date:o,monthsToAdd:1}),Z):(0,Is().V7)((0,Is().RN)(o),Z),Se&&se&&(Se.scrollTop=0)):n=o,(0,Rs().I)({dateRangeStart:e,dateRangeEnd:n,collectionContextStore:r}),D.update((t=>({...t,startingMonth:(0,Is().kl)((0,Is().V7)(e,Z))})))}),[Z,r,D,se,Se]),xe=(0,n.useCallback)((()=>{W&&W.isDefined()&&z&&X.canConfigureBlock&&I().createAndCommit({userAction:"Calendar.updateOrCreateCalendarProperty",environment:V,canUndo:!0,perform:e=>{let t,o=F().PD(p);if(!o&&X.canConfigureCollection){o=(0,Ul().ZP)();t={[o]:{name:k.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}o&&((0,hr().E)({collectionViewStore:z,update:{calendar_by:o},transaction:e}),An().sW({store:z,data:{type:"calendar"},transaction:e}),t&&(0,$l().x)({environment:V,collectionStore:W,update:t,transaction:e}))}})}),[W,z,V,k,X.canConfigureBlock,X.canConfigureCollection,p]),be=(0,n.useCallback)((e=>{if(!z||!G)return;const t=Fs().ZP.getLocalDateRangeStart({collectionViewId:G,currentUserId:_}),o=e.state,n=(0,Is().IS)(t,o),r=(0,Is().IS)(new Date((0,Is().V7)(t,o)).getDate()>7?(0,Is().kl)(t):t,o),i="month"===le?r:n;D.update((e=>({...e,startingMonth:r.valueOf()}))),ve(i,le)}),[z,G,_,le,D,ve]),Ce=(0,n.useCallback)((()=>{if(!K.current||!se)return;const e=v().MR(Array.from(oe.entries()).map((e=>{let[t,o]=e;return{store:o,timestamp:t}})),(e=>{let{timestamp:t}=e;return t})),t=K.current.getBoundingClientRect(),o=e.find((e=>{let{store:o}=e;const n=_s().C.getRectFromStore(o);if(!n)return;const r=(null==Se?void 0:Se.scrollTop)??0,i=n.top<=t.top+r,l=n.bottom>=t.top+r;return i&&l}));if(o){const e=(0,Is().kl)((0,Is().Xz)({date:(0,Is().V7)(o.timestamp,Z),daysToAdd:1}));e!==ne&&D.update((t=>({...t,startingMonth:e})))}}),[D,oe,se,Z,ne,null==Se?void 0:Se.scrollTop]),we=(0,gn().z)(Ce,100),je=(0,n.useCallback)((e=>{if(e<Ke().Z.incrementScrollOffset&&!N&&se){const e=(0,Is().V7)((0,Is()._)({date:Q,monthsToAdd:2}),Z);(0,Rs().I)({dateRangeStart:Y,dateRangeEnd:e,collectionContextStore:r})}}),[r,Q,Y,N,se,Z]),Te=(0,n.useCallback)((e=>{const{target:t}=e;!P&&t instanceof HTMLElement&&(0,ye().ZP)({event:e,context:ye().Af.EditorMouseDown,callback:()=>{e.preventDefault(),j().AI({environment:V,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[i],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})}),[V,P,i]),Pe=(0,n.useCallback)((e=>{if(!H&&(0,Fs().wY)(J)){const t=function(e,t){T().Ch();const{selectableRectMap:n}=o(797522).default.state,r=Array.from(oe.keys()),i=Array.from(oe.values());for(const[o,l]of n.entries())if(l&&Ms().uh(l,e,t)&&i.indexOf(o.props.store)>=0)return r.find((e=>oe.get(e)===o.props.store))}(e.clientX,e.clientY);re!==t&&D.update((e=>({...e,hoveredDay:t})))}}),[D,J,oe,re,H]),Ie=(0,gn().z)(Pe,100);(0,mn().K)((()=>{be(pe().AK),pe().AK.addListener(be)})),(0,Ps().L)((()=>{pe().AK.removeListener(be)})),(0,n.useEffect)((()=>{H&&(0,Fs().wY)(J)&&D.update((e=>({...e,hoveredDay:void 0}))),u.calendar_by||xe()}),[D,J,H,u.calendar_by,xe]),(0,n.useEffect)((()=>{const e=B.current,t=null==e?void 0:e.parentElement,o=Se;return t&&(fe().lj(t,"mousemove",Ie),o&&fe().lj(o,"scroll",we)),()=>{t&&fe().ZV(t,"mousemove",Ie),o&&fe().ZV(o,"scroll",we)}}),[Ie,we,Se]);const Re=(0,c().yK)((()=>({scroller:{height:"calc(100% - 66px)",maxHeight:h?h-(P?74:66):"inherit",paddingBottom:16,maskImage:"none",WebkitMaskImage:"none",...$?{paddingTop:12}:{}},scrollOffset:$?{height:"100%",maxHeight:"inherit"}:{},selectable:{position:"relative",paddingLeft:1,...$&&{height:"100%",maxHeight:"inherit"}},container:{paddingBottom:y,paddingLeft:x,paddingRight:b,minWidth:f,...$&&{height:"100%",maxHeight:"inherit"}},sticky:{paddingLeft:x,paddingRight:b,minWidth:f}})),[$,P,h,f,y,x,b]),_e=(0,n.useCallback)((()=>(0,Yn().Z)((e=>(0,m.jsx)(ci().Q,{nodeRef:K,children:(0,m.jsx)(zo().Z,{onChange:je,style:Re.scrollOffset,children:(0,m.jsx)("div",{ref:O,style:Re.container,className:me().c7X,children:(0,m.jsxs)(ot().Z,{store:i,onMouseDown:Te,style:Re.selectable,shouldShowHalo:!g&&!$,canSelect:!g&&!q,analyticsName:"calendar",disablePointerEvents:w,...e,children:[!w&&(0,m.jsx)(La,{collectionContextStore:r,weeks:ue,startOfWeek:Z,dateRangeStart:Y,currentlyViewedMonth:ae,setNewCalendarStart:ve,calendarViewRange:le,isInHomeWidget:$,isInPeekRenderer:S,stickyStyle:Re.sticky}),$?(0,m.jsx)(Qt,{style:Re.scroller,children:(0,m.jsx)(ha,{blockPropertyValueOverlayStore:t,collectionContextStore:r,blockStore:i,calendarStore:D,resultStore:E,sortedResultsStore:ge,format:l,query:u,schema:p,weeks:ue,isInPeekRenderer:S,currentlyViewedMonth:ae,canEditCalendar:ie,isInHomeWidget:$,isTypedMsvCollection:U})}):(0,m.jsx)(ha,{blockPropertyValueOverlayStore:t,collectionContextStore:r,blockStore:i,calendarStore:D,resultStore:E,sortedResultsStore:ge,format:l,query:u,schema:p,weeks:ue,isInPeekRenderer:S,currentlyViewedMonth:ae,canEditCalendar:ie,isInHomeWidget:$,isTypedMsvCollection:U})]})})})})))),[t,i,D,le,ie,r,ae,Y,l,Te,je,g,$,S,w,q,U,O,u,E,p,ve,ge,Z,Re.container,Re.scrollOffset,Re.scroller,Re.selectable,Re.sticky,ue]),{calendar_by:Me}=u;if(!Me)return(0,m.jsx)(Da,{collectionContextStore:r,isFullScreen:g,paddingBottom:y,paddingLeft:x,paddingRight:b});const Be=p[Me];return Be&&io().Lt(Be)?ce?(0,m.jsx)(So().Z,{id:"calendar_results",resultStore:E,collectionContextStore:r,reducer:ce,render:_e}):null:(0,m.jsx)(Da,{collectionContextStore:r,isFullScreen:g,paddingBottom:y,paddingLeft:x,paddingRight:b})}));function Da(e){const{collectionContextStore:t,isFullScreen:o,paddingBottom:n,paddingLeft:r,paddingRight:i}=e,l=t.settingsStore,s=(0,a().VK)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),d=(0,c().yK)((()=>({container:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:n}})),[o,n,r,i]);return(0,m.jsx)(zl,{style:d.container,title:(0,m.jsx)(C()._H,{defaultMessage:"No date property",id:"database.calendarView.missingDatePropertyTitle"}),description:s?(0,m.jsx)(C()._H,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Calendar view.",id:"database.calendarView.missingDateProperty",values:{opensettingslink:e=>(0,m.jsx)(Zl,{onClick:()=>{k().r$({collectionContextStore:t,collectionSettingsStore:l}),k().H4({collectionSettingsStore:l,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,m.jsx)(C()._H,{defaultMessage:"Calendar views require a date property in order to display.",id:"database.calendarView.missingDatePropertyNoPermissions"})})}var Ea=()=>o(864871),Aa=()=>o(341374),Ha=()=>o(25594);function Za(e){(0,Ea().I)({store:e})}function za(e,t,o,n,r){if("title"===e){ko().xv({environment:r,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();T().eP({environment:r,store:t}),(0,$o().v)({store:t}),P().setSelectionAtEnd({store:e})}else e?(ko().xv({environment:r,blockPropertyValueOverlayStore:o}),ko().bA({environment:r,blockPropertyValueOverlayStore:o,store:t,property:e,format:wt().C.ListView,collectionContextStore:n})):ko().xv({environment:r,blockPropertyValueOverlayStore:o});Za(t)}function Wa(e,t,o){ko().xv({environment:e,blockPropertyValueOverlayStore:t}),T().Ys({environment:e,store:o}),Za(o)}function Ga(e){const{environment:t,newStore:o,previousStore:n}=e;T().eP({environment:t,store:o}),(0,$o().v)({store:o}),Aa().Z.setState({store:o,editMode:"new",previousStore:n})}var Na=()=>o(309797);function Ua(e){const t=(0,s().O7)(),{store:o,collectionContextStore:r,disabled:i,groupsPointer:l,collectionStore:d,subitemPath:u,indentLevel:p,onSubitemCreate:g}=e,S=(0,a().VK)((()=>{var e;return"timeline"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType())}),[r]),h=(0,a().VK)((()=>{var e;return"title"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[r]),f=(0,Na().L2)(o),y=(0,a().VK)((()=>(0,R().lZ)({columnIndex:0,titleColumnIndex:0,indentLevel:p,isSubitemToggleOnTitleColumn:h})),[p,h]),v=(0,c().yK)((t=>({newRowButton:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:y,fontSize:14,lineHeight:b().Nv.UIRegular.desktop,borderBottom:`1px solid ${t.tableDividerColor}`,left:0,right:0,...S&&{borderTop:"none"},...e.styles},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",left:y+8,color:t.lightTextColor},newIcon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor},newText:{color:t.lightTextColor}})),[y,S,e.styles]),x=(0,a().VK)((()=>{const e=r.permissionScopesStore.state,t=d.isSyncedCollection();return!i&&e.canEditContent&&!t}),[r,i,d]),w=(0,n.useCallback)((e=>{I().createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,canUndo:!0,perform:n=>{const i=ut().yk({environment:t,collectionContextStore:r,groupsPointer:l,store:o,before:!1,collectionStore:d,transaction:n,subitemPath:u,subitemInsertDirection:"into",from:"cvb_new_subitem",event:e});i&&g(i)}}),O().JE(t,{...(0,ge().Pn)(r)})}),[r,t,l,d,o,u,g]);return!x||f?null:(0,m.jsx)(Vt().Z,{onClick:w,onMouseDown:ye().$0,style:v.newRowButton,children:(0,m.jsxs)("span",{style:v.newRowContainer,children:[(0,lo().R)(v.newIcon),(0,m.jsx)("span",{style:v.newText,children:(0,m.jsx)(C()._H,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})})]})})}var $a=()=>o(889919);function qa(e){let{property:t,propertyIndex:o,showProperties:r,blockPropertyValueOverlayStore:i,store:l,schema:c,collectionContextStore:d,disabled:u,isEditing:p,mouseIsEntered:g}=e;const S=(0,s().O7)(),h=(0,n.useCallback)((async()=>async function(e,t,o,n,r,i,l){const s=await de().F.formulas.load();za((0,Ha().ck)(e,t,o,n,r,l,s),o,t,i,e)}(S,i,l,c,r,d,p)),[S,i,l,c,r,d,p]),f=(0,n.useCallback)((async()=>async function(e,t,o,n,r,i,l){const s=await de().F.formulas.load();za((0,Ha().Mj)(e,t,o,n,r,l,s),o,t,i,e)}(S,i,l,c,r,d,p)),[S,i,l,c,r,d,p]),y=(0,a().VK)((()=>F().Bm({store:l,collectionContextStore:d})),[l,d]),v=(0,a().VK)((()=>d.collectionViewStore()),[d]),x=(0,a().VK)((()=>{const e=d.isInHomeWidgetStore.state,o=d.isUnlistedViewStore.state&&d.isInlineViewStore.state;return"title"===t&&g&&!e&&!o}),[d,g,t]),b=(0,a().VK)((()=>l.canEdit()),[l]),C=(0,a().VK)((()=>p||d.isInHomeWidgetStore.state),[p,d]),w=(0,a().VK)((()=>d.permissionScopesStore.state.isLocked||!d.permissionScopesStore.state.canEditContent),[d]);return y?(0,m.jsx)(Ln().m,{store:l,property:t,propertyIndex:o,disabled:u||!b,locked:w,format:wt().C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:y,collectionViewStore:v,forceMouseEntered:x,showIfEmpty:C,onBgClick:()=>Wa(S,i,l),onEnter:()=>Wa(S,i,l),onEsc:()=>Wa(S,i,l),onTab:f,onUntab:h,onClick:()=>Za(l)},t):null}function Ya(e){let{collectionContextStore:t,toggleButton:o,subitemPath:n}=e;const r=(0,a().Kw)(t.currentSubitemFormatStoreForUiDisplayStore),i=(null==n?void 0:n.length)??0;if(!r)return null;const l=Math.max((i-1)*X().Hw,0)+X().gY;return o?(0,m.jsxs)("div",{style:{paddingTop:4,display:"flex"},children:[(0,m.jsx)("div",{style:{width:l}}),o]}):(0,m.jsx)("div",{style:{minWidth:l+X().Hw}})}const Qa=n.memo(n.forwardRef((function(e,t){const{store:o,schema:r,blockPropertyValueOverlayStore:i,handleOpenPeekPage:l,collectionContextStore:d,onShiftEnter:u,toggleButton:p,subitemPath:g,showProperties:S,disabled:h}=e,f=(0,s().O7)(),{isMobile:y,isPhone:v}=(0,s().Fy)(),x=(0,n.useRef)(null),b=(0,n.useRef)(null),[w,k]=(0,n.useState)(!1),[V,j]=(0,n.useState)(!1),[T,I]=(0,n.useState)(!1),R=(0,a().qz)(void 0,mt().Z),_=(0,a().VK)((()=>{const e=jo().Z.state;return Boolean(e.isActive&&e.store.id===o.id)}),[o.id]),M=(0,a().VK)((()=>{const e=Aa().Z.state;return e.store&&e.store.id===o.id?e.editMode:void 0}),[o.id]),B=(0,gn().z)((()=>{Oe().Z.state||R.setState({...R.state,mouseEntered:!0})}),100),F=(0,pn().y)((()=>{R.setState({...R.state,mouseEntered:!1})}),100),K=(0,a().VK)((()=>R.state.mouseEntered),[R]),L=(0,gn().z)((()=>{I(!0)}),100),O=(0,gn().z)((()=>{j(!0)}),100),D=(0,a().VK)((()=>oe().default.state.stores.length>0&&oe().default.state.stores[0].id===o.id),[o.id]),E=(0,n.useCallback)((()=>{const e=Ha().gz({environment:f,store:o,collectionContextStore:d});e&&(l(),hn().c4({environment:f,url:e}))}),[f,l,o,d]),A=(0,a().VK)((()=>o.getBlockTitleStore()),[o]),H=(0,a().VK)((()=>Ha().Vf(o)),[o]),Z=(0,a().VK)((()=>Ha().gz({environment:f,store:o,collectionContextStore:d})),[f,o,d]),z=(0,a().VK)((()=>S.map((e=>o.getPropertyValue(e)))),[S,o]),W=(0,n.useCallback)((()=>{!function(e,t){Za(e),t()}(o,l)}),[o,l]),G=(0,n.useCallback)((()=>{b.current&&k(b.current.scrollWidth>b.current.clientWidth)}),[]),N=(0,gn().z)(G,100),U=(0,c().yK)((e=>({container:{display:"flex",position:"relative"},linkBox:{position:"relative",...Ha().iI(_?"multi":"single")},mobileLinkBox:{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:`1px solid ${e.tableDividerColor}`},linkBoxInner:{display:"flex",alignItems:"center",paddingLeft:4,userSelect:_?void 0:"none",WebkitUserSelect:_?void 0:"none"},mobileLinkBoxInner:{paddingLeft:4,paddingRight:4,paddingBottom:4,paddingTop:4},propertiesWithTitleContainer:{display:"flex",alignItems:"center"},propertiesAfterTitleContainer:{display:"flex",alignItems:"center",paddingLeft:y?0:6,paddingBottom:y?0:4},hoveredStyle:{background:_?"transparent":e.buttonHoveredBackground},pressedStyle:{background:_?"transparent":e.buttonPressedBackground},overflowButtonArea:{position:"absolute",right:-28,top:"50%",transform:"translateY(-50%)",width:28,height:"100%",cursor:"pointer"},overflowButton:{position:"absolute",right:0,top:"50%",transform:"translateY(-50%)",display:"flex",width:20,height:20,borderRadius:4,justifyContent:"center",alignItems:"center",isolation:"isolate",zIndex:2,backdropFilter:"blur(8px)",background:e.buttonBackground,transition:"none",paddingLeft:2,paddingRight:0},overflowIcon:{width:12,height:12,fill:e.lightIconColor,marginLeft:-2}})),[_,y]);(0,n.useEffect)((()=>{_&&"new"===M&&P().setSelectionAtEnd({store:A})}),[_,M,A]),(0,n.useEffect)((()=>(window.addEventListener("resize",N),()=>window.removeEventListener("resize",N))),[N]),(0,n.useEffect)((()=>{N()}),[N,z]),(0,Ps().L)((()=>{Aa().Z.reset(),jo().Z.reset()}));const q=(0,n.useMemo)((()=>S.indexOf("title")),[S]),Y=v&&S.length>0,Q=(0,m.jsx)(Ya,{collectionContextStore:d,toggleButton:p,subitemPath:g}),X=(e,t)=>(0,m.jsx)(qa,{blockPropertyValueOverlayStore:i,collectionContextStore:d,disabled:h,isEditing:_,mouseIsEntered:K,property:e,propertyIndex:t,showProperties:S,schema:r,store:o},e);let J;if(Y){const[e,t]=[S.slice(0,q+1),S.slice(q+1)];J=(0,m.jsxs)("div",{style:U.container,dir:"ltr",ref:x,children:[Q,(0,m.jsxs)(bn().Z,{ref:b,href:H,metaHref:Z,external:!1,style:U.mobileLinkBox,innerStyle:U.mobileLinkBoxInner,children:[(0,m.jsx)("div",{style:U.propertiesWithTitleContainer,children:e.map(X)}),t.length>0&&(0,m.jsx)("div",{style:U.propertiesAfterTitleContainer,children:t.map(X)})]})]})}else J=(0,m.jsx)($().Z,{debugName:"CollectionListViewItem",capture:D,onShiftEnter:u,children:(0,m.jsxs)("div",{style:U.container,dir:"ltr",ref:x,onMouseEnter:O,onMouseLeave:()=>j(!1),children:[Q,(0,m.jsx)(bn().Z,{ref:b,href:H,metaHref:Z,altHref:Z,onClick:W,external:!1,style:U.linkBox,innerStyle:U.linkBoxInner,hoveredStyle:U.hoveredStyle,pressedStyle:U.pressedStyle,onMouseEnter:B,onMouseMove:B,onMouseLeave:F,children:S.map(X)}),w&&(0,m.jsx)("div",{style:U.overflowButtonArea,children:(T||V)&&(0,m.jsx)(Tt().Z,{renderTooltip:()=>(0,m.jsx)(C()._H,{defaultMessage:"See all properties",id:"collectionList.overflow.tooltip"}),placement:Me().Placement.Bottom,render:e=>(0,m.jsx)(jt().Z,{icon:$a().k,iconStyle:U.overflowIcon,ariaLabel:"See all properties",style:U.overflowButton,onClick:E,onMouseEnter:L,onMouseLeave:()=>I(!1),...e})})})]})});return(0,Ve().ez)(o,t,(0,n.useMemo)((()=>({renderedType:"page",getBlockStore:()=>o,getNode:()=>x.current,activate:E})),[o,E]),J)})));function Xa(){return{marginTop:1,marginBottom:1}}const Ja=n.memo((function(e){let{groupFormat:t,store:o,format:r,disabled:i,collectionContextStore:l,schema:c,blockPropertyValueOverlayStore:d}=e;const u=(0,s().O7)(),p=(0,n.useMemo)((()=>t?[t]:[]),[t]),g=(0,n.useMemo)((()=>(r.list_properties?r.list_properties:[]).filter((e=>e.visible)).map((e=>{let{property:t}=e;return t}))),[r]),{permissionScopes:S}=(0,a().VK)((()=>({permissionScopes:l.permissionScopesStore.state})),[l]),h=(0,a().VK)((()=>l.groupsStore.getGroupState(p)),[p,l]),f=(0,a().VK)((()=>!i&&o.canEdit()&&S.canEditContent&&!S.isSyncedCollection),[i,o,S]),y=(0,n.useCallback)((()=>{if(!h)return;const e=l.collectionStore();if(!e||!l.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=oe().default.state.stores[0];if(!t)return;const o=l.subitemTreeStore.state,n=(0,vo().DY)(o.children,(e=>e.value.store===t));if(!n)return;const r=n?(0,X().Af)(n.map((e=>e.value.store))):"",i=l.subitemExpandedStore.state.get(r),s=Boolean(null==i?void 0:i.isExpanded);I().createAndCommit({userAction:"CollectionListView.onItemShiftEnter",environment:u,canUndo:!0,perform:o=>{const r=ut().yk({environment:u,collectionContextStore:l,groupsPointer:h.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:n,subitemInsertDirection:s?"into":"below",from:"list_selection_overlay_shift_enter"});r&&Ga({environment:u,newStore:r,previousStore:t})}}),O().sd(u,"list_item_edit_mode_enter",{...(0,ge().Pn)(l),block_id:t.id,from:"shiftEnter",view_type:"list"})}),[l,u,h]),v=(0,n.useCallback)(((e,t)=>{Ga({environment:u,newStore:t,previousStore:e})}),[u]),x=(0,n.useMemo)((()=>({blockPropertyValueOverlayStore:d,collectionContextStore:l,disabled:i,onShiftEnter:y,schema:c,showProperties:g,collectionViewBlockStore:o})),[d,l,i,y,c,g,o]),b=(0,n.useCallback)((e=>{const{store:t,parentStore:o,subitemPath:n,indentLevel:r}=e;if(o)return(0,m.jsx)(Ua,{store:t,collectionStore:o,subitemPath:n,indentLevel:r,collectionContextStore:l,disabled:i,groupsPointer:p,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{(0,$o().v)({store:e,transient:!1}),Aa().Z.setState({store:e,editMode:"new",previousStore:void 0})}})}),[l,i,p]);return h?(0,m.jsx)(Lo,{collectionContextStore:l,groupsPointer:p,format:r,canDrag:f,resultProps:x,canDrop:!0,resultComponent:Qa,disabled:i,shouldShowHoverMenu:!0,direction:Fo.Vertical,analyticsName:"list",getItemSelectableStyle:Xa,emptyDroppableSize:0,onSelectableInsertRow:v,nestedCreateSubitemButton:b}):null}));const ec=n.memo((function(e){const{store:t,format:o,paddingBottom:r,paddingLeft:i,paddingRight:l,isFullScreen:d,isPreviewing:u,isRootChild:p,minWidth:g,disabled:S,collectionContextStore:h}=e,f=(0,s().O7)(),{isMobile:y}=(0,s().Fy)(),v=(0,c().Fg)(),x=(0,a().VK)((()=>F().az(h,d)),[h,d]),b=(0,a().VK)((()=>null==h?void 0:h.isInHomeWidgetStore.state),[h]),C=(0,a().VK)((()=>"collectionSystemView"===(null==h?void 0:h.contextType)),[h]),w=(0,a().VK)((()=>!!h.viewsModuleContextStore.getViewModuleType()),[h]),k=o.collection_group_by,V=(0,n.useCallback)(((e,t,o)=>{if(y)No()._c({environment:f,store:e,pageVisitSource:Go().tY.Create});else if(t)Ga({environment:f,newStore:e,previousStore:void 0});else{const{groupFormat:t}=o,n=t?[t]:[],r=h.groupsStore.getGroupState(n),i="collectionTypedView"===h.contextType;Uo().CH({environment:f,store:e,peekMode:F().kr(h),showMoveTo:i,resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:h,pageVisitSource:Go().tY.Create})}}),[h,f,y]),j=(0,n.useCallback)((e=>0===e.index?{}:{borderTop:`1px solid ${v.tableDividerColor}`}),[v]),T=(0,n.useCallback)((o=>(0,m.jsx)(il,{reducerId:"list_groups",store:t,collectionContextStore:h,disabled:S,isFullScreen:d,isRootChild:p,paddingLeft:i,stickyLeft:!1,renderGroup:t=>(0,m.jsx)(oc,{...e,groupFormat:t}),getGroupStyle:j,renderHeader:e=>(0,m.jsx)(tc,{args:e}),onGroupHeaderAddItem:V})),[h,S,j,V,d,p,i,e,t]),P=(0,n.useCallback)((e=>{const t=h.isLoadingStore.state,o=h.groupsStore.getGroupState([]);if(!o)return;if("collectionSystemView"===h.contextType)return;const n=o.reducerResultStore.state;e<Ke().Z.incrementScrollOffset&&n&&!t&&n.hasMore&&ut().ID({collectionContextStore:h,environment:f,incrementLimitArgs:{isFullScreen:d,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[h,f,d]),I=(0,c().yK)((()=>({container:{paddingBottom:b?0:r,paddingLeft:i,paddingRight:l,minWidth:g},selectable:{display:"flex",flexDirection:"column",paddingTop:k||b||C?void 0:4,paddingBottom:4}})),[r,i,l,g,k,b,C]);return(0,Yn().Z)((o=>(0,m.jsxs)("div",{style:I.container,className:me().nM$,children:[(0,m.jsx)(ot().Z,{store:t,shouldShowHalo:!d&&!b,canSelect:!d&&!w,disablePointerEvents:u,analyticsName:"list",style:I.selectable,...o,children:k?T(k):(0,m.jsx)(oc,{...e,groupFormat:k})}),!x&&(0,m.jsx)(zo().Z,{onChange:P})]})))}));function tc(e){const{args:t}=e,{collectionContextStore:o}=t,n=(0,a().Kw)(o.isInHomeWidgetStore),{stickyStyle:r}=(0,c().yK)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${e.contentBackground}`}})),[]);return(0,m.jsx)(Jr,{...t,height:n?gt().yZ:48,stickyStyle:r})}const oc=n.memo((function(e){const{store:t,format:r,schema:i,disabled:l,groupFormat:d,isFullScreen:u,collectionContextStore:p,blockPropertyValueOverlayStore:g}=e,{isMobile:S}=(0,s().Fy)(),h=void 0!==d,f=(0,n.useMemo)((()=>d?[d]:[]),[d]),y=(0,a().VK)((()=>p.groupsStore.getGroupState(f)),[p,f]),v=(0,a().VK)((()=>null==y?void 0:y.reducerResultStore.state),[y]),x=(0,a().VK)((()=>p.groupsStore.anyGroupHasResults()),[p]),{canEditContent:b,isSyncedCollection:C}=(0,a().VK)((()=>{const e=p.permissionScopesStore.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[p]),w=(0,a().VK)((()=>"collectionTypedView"===p.contextType),[p]),k=(0,a().Kw)(p.isInHomeWidgetStore),V=(0,a().VK)((()=>x&&!l&&t.canEdit()&&(b||w)&&!C),[x,l,t,b,w,C]),j=(0,a().VK)((()=>""!==p.searchQueryStore.state),[p]),T=(0,a().VK)((()=>void 0!==v&&(null==v?void 0:v.blockIds.length)>0),[v]),P=(0,a().VK)((()=>(0,Wo().H0)({collectionContextStore:p,groupsPointer:f,hasPartialResults:T})),[p,f,T]),I=(0,a().VK)((()=>F().VM({collectionContextStore:p,reducerResult:v,isFullScreen:u})),[p,v,u]),R=(0,c().yK)((e=>({container:{paddingBottom:d?k?8:16:void 0},groupLoadMoreButton:{fontSize:16,marginTop:S?4:void 0,paddingLeft:3},groupLoadMoreIcon:{width:16,height:16,marginRight:8},spacer:{width:"100%",borderTop:d||k?void 0:`1px solid ${e.tableDividerColor}`,marginTop:4,marginBottom:4}})),[d,k,S]);return y?(0,m.jsxs)("div",{style:R.container,children:[(0,m.jsx)(Ja,{groupFormat:d,store:t,format:r,disabled:l,collectionContextStore:p,schema:i,blockPropertyValueOverlayStore:g}),P&&(0,m.jsx)(o(23862).h,{isFullScreen:u,hasGroups:h,hasPartialResults:T,hasSearchQuery:j,overrideNumShimmerRows:k&&!T?6:void 0}),V&&(0,m.jsxs)(m.Fragment,{children:[I&&(0,m.jsx)("div",{style:R.spacer}),(0,m.jsx)(nc,{collectionContextStore:p,isFullScreen:u,groupState:y,groupFormat:d})]}),I&&(0,m.jsx)(co().ZP,{groupsPointer:f,store:t,collectionContextStore:p,format:r,isFullScreen:u,incrementLimitsInRelatedGroups:!1,style:R.groupLoadMoreButton,iconStyle:R.groupLoadMoreIcon})]}):null})),nc=n.memo((function(e){const{groupState:t,groupFormat:o,collectionContextStore:r,isFullScreen:i}=e,l=(0,s().O7)(),d=(0,C().YB)(),{isMobile:u}=(0,s().Fy)(),p=(0,a().Kw)(r.isInHomeWidgetStore),g=(0,a().VK)((()=>F().Il({collectionContextStore:r,environment:l,intl:d})),[r,l,d]),S=(0,n.useCallback)((()=>{if(!(0,Ge().ww)(l))return void(0,Ge().eD)(l);const e=r.currentSubitemFormatStoreForUiDisplayStore.state;I().createAndCommit({userAction:"CollectionListView.handleAddItemClick",environment:l,canUndo:!0,perform:o=>{!function(e){var t;const{transaction:o,environment:n,results:r,collectionContextStore:i,isFullScreen:l,groupsPointer:s,insertAtIndex:a,from:c}=e;i.searchQueryStore.state&&(0,qo().U)({searchQuery:"",collectionContextStore:i,isFullScreen:l});const d=null===(t=i.groupsStore.getGroupState(s))||void 0===t?void 0:t.resultsStore;if(!d)return;let u;a>0&&(u=r[a]);const p=ut().IW({environment:n,collectionContextStore:i,groupsPointer:s,insertAtIndex:a,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:o,from:{createBlock:c},inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache});if(!p)return;const m=p.coercionSucceeded,g=p.newStore;n.device.isMobile?No()._c({environment:n,store:g,pageVisitSource:Go().tY.Create}):m?Ga({environment:n,newStore:g,previousStore:u}):Uo().CH({environment:n,store:g,peekMode:(0,F().kr)(i),resultsStore:d,collectionContextStore:i,pageVisitSource:Go().tY.Create}),Co().W(n,{from:c,type:"page",new_page_id:g.id,creating_block_id:g.id,...(0,ge().Pn)(i)})}({transaction:o,environment:l,results:t.resultsStore.state,collectionContextStore:r,isFullScreen:i,groupsPointer:t.groupsPointer,insertAtIndex:t.resultsStore.state.length,from:e?"list_view_add_parent_item_bottom":"list_view_add_item_bottom"})}})}),[l,t,r,i]),h=(0,c().yK)((e=>({button:{display:"flex",alignItems:"center",height:(0,R().rM)({isMobile:u}),borderRadius:6,fontSize:p?14:16,color:e.lightTextColor,paddingLeft:4,paddingRight:12},icon:{width:p?12:16,height:p?12:16,marginLeft:p?10:3,marginRight:p?6:8,fill:e.lightIconColor},buttonContainer:{display:"flex"}})),[p,u]);return g?(0,m.jsxs)("div",{style:h.buttonContainer,children:[(0,m.jsxs)(Vt().Z,{onClick:S,onMouseDown:ye().$0,style:h.button,children:[(0,lo().R)(h.icon),(0,m.jsx)(Jo,{collectionContextStore:r})]}),(0,m.jsx)(dn().a,{collectionContextStore:r,groupFormat:o,renderLinkButton:e=>(0,m.jsxs)(Vt().Z,{style:h.button,...e,children:[(0,cn().v)(h.icon),(0,m.jsx)(C()._H,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})]}):(0,m.jsxs)(Vt().Z,{onClick:S,onMouseDown:ye().$0,style:h.button,children:[(0,lo().R)(h.icon),(0,m.jsx)(Jo,{collectionContextStore:r})]})}));class rc extends d().default{getInitialState(){return{}}getCurrentFormat(e){return this.state.temporaryFormat?this.state.temporaryFormat:e}getCurrentProperties(e,t){return this.getCurrentFormat(t)[e]||[]}}const ic=rc;var lc=()=>o(928459);const sc=n.memo((function(e){let{collectionContextStore:t,tableProperties:o,paddingLeft:r,paddingRight:i,children:l}=e;const c=(0,s().O7)(),{isPhone:d}=(0,s().Fy)(),u=(0,n.useMemo)((()=>o.filter((e=>e.visible))),[o]),p=(0,a().VK)((()=>{var e;const o=null===(e=t.virtualizedModule.getHorizontalScrollerRefStore())||void 0===e||null===(e=e.state)||void 0===e?void 0:e.current;return o?o.getStore().state.elementRef.current:null}),[t]),g=(0,a().VK)((()=>{const e=t.frozoneStore.state.frozenIndex;return void 0===e?0:e+1}),[t]),S=(0,a().VK)((()=>u.map((e=>(0,R().vf)({environment:c,propertyFormat:e})))),[c,u]),h=(0,n.useCallback)((e=>e+g>S.length-1?35:S[e+g]??35),[S,g]),f=(0,uo().MG)({count:u.length,estimateSize:h,scrollMargin:r,getScrollElement:()=>p,getItemKey:e=>u[e].property||e,scrollPaddingStart:r,scrollPaddingEnd:i,overscan:d?2:1,horizontal:!0}),y=f.getVirtualItems(),[v,x]=(0,n.useMemo)((()=>y.length>0?[y[0].start-r,f.getTotalSize()-y[y.length-1].end]:[0,0]),[y,f,r]),b=0===y.length?0:g+y[0].index,C=0===y.length?0:y[y.length-1].index+1,{propertiesInRange:w,propertiesInRangeIndices:k}=(0,n.useMemo)((()=>0===y.length?{propertiesInRange:[],propertiesInRangeIndices:[]}:{propertiesInRange:u.slice(b,C),propertiesInRangeIndices:Array.from({length:C-b},((e,t)=>b+t))}),[y.length,C,b,u]),V=(0,n.useMemo)((()=>({columnVirtualizer:f,propertiesInRange:w,propertiesInRangeIndices:k,beforeWidth:v,afterWidth:x})),[x,v,f,w,k]);return(0,m.jsx)(lc().Q6.Provider,{value:V,children:(0,m.jsx)(lc().aO.Provider,{value:!0,children:l})})}));var ac=()=>o(109477),cc=()=>o(269932),dc=()=>o(339523);const uc={display:"flex",width:32,height:"100%",alignItems:"center",justifyContent:"center"};function pc(e){(0,ye().ZP)({event:e,context:ye().Af.EditorMouseDown,callback:()=>{}})}function mc(e,t){return!e&&t}var gc=()=>o(709917);const Sc=n.memo((function(e){const{disabled:t,property:r,schema:i,collectionContextStore:l,groupFormat:d,propertyFormat:u,isHovered:p,aggregation:g,onChange:S}=e,h=(0,s().O7)(),f=(0,C().YB)(),{isMobile:y}=(0,s().Fy)(),[x,b]=(0,n.useState)(void 0),k=(0,n.useMemo)((()=>Boolean((null==u?void 0:u.width)&&u.width<100)),[u]),V=(0,a().VK)((()=>Br(l,g)),[l,g]),j=(0,a().VK)((()=>{if(!g)return;return{type:"aggregation",filter:d?(0,po().zk)({schema:i,propertyMapping:void 0,groupBy:l.getGroupByAndGroupFormats().groupBy,group:d,timeZone:(0,mo().r)(),experimentService:Le().default}):void 0,aggregation:g}}),[i,d,g,l]),T=(0,n.useCallback)(((e,t)=>{if(e){const o={aggregator:e,property:r,enforceMaxAggregationLimit:t};S(r,o),b(o),w().wd({environment:h,collectionContextStore:l,action:"table_change_aggregation"})}else S(r,void 0),w().wd({environment:h,collectionContextStore:l,action:"table_remove_aggregation"})}),[h,S,r,l]),P=(0,c().yK)((()=>({buttonStyle:{display:"flex",alignItems:"center",justifyContent:"flex-end",width:"100%",height:32,paddingRight:8,overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",WebkitUserSelect:"auto",transition:"background 0.2s ease"}})),[]);(0,n.useEffect)((()=>{x&&!Br(l,x)&&(0,v().Xy)(g,x)&&b(void 0)}),[V,x,l,g]);const I=(0,n.useMemo)((()=>k&&null!=g&&g.aggregator?_r().VN[(0,Ir().OV)(g)]:void 0),[k,g]),R=(0,n.useMemo)((()=>{const e=null==j?void 0:j.aggregation;if(!e)return"";let t=`${e.aggregator}`;return"object"==typeof e.aggregator&&"operator"in e.aggregator&&(t=`${e.aggregator.operator}:${e.aggregator.groupName}`),`table:${(0,ro().mD)(d)}:${r}:${t}`}),[d,r,null==j?void 0:j.aggregation]),_=(0,n.useCallback)((e=>j?(0,m.jsx)(So().Z,{id:R,collectionContextStore:l,reducer:j,groupsPointer:d?[d]:void 0,render:o=>(0,m.jsx)(Tt().Z,{alignment:k?Me().Alignment.Center:Me().Alignment.End,disableTooltip:!V&&!I,renderTooltip:()=>V?f.formatMessage(Lr.aggregationCalculating):I,render:n=>(0,m.jsx)(Vt().Z,{disabled:t,style:P.buttonStyle,...(0,Mr().Z)(n,e),children:(0,m.jsx)(hc,{resultStore:o,aggregation:g,schema:i,property:r,hideLabelText:k})})})}):(0,m.jsx)(Vt().Z,{disabled:t,style:P.buttonStyle,...e,children:(0,m.jsx)(fc,{disabled:t,isHovered:p,hideLabelText:k})})),[j,R,l,d,t,P.buttonStyle,p,k,V,I,f,g,i,r]),M=(0,n.useCallback)((e=>{let{close:t}=e;return(0,m.jsx)(o(103163).Z,{currentAggregation:g,property:r,schema:i,onChange:T,onClose:t,source:"tableAggregation"})}),[T,g,r,i]);return(0,m.jsx)(Dr().ZP,{popupType:y?Dr().Z4.SlideUp:Dr().Z4.Popup,disabled:t,renderOrigin:_,render:M})})),hc=n.memo((function(e){const{aggregation:t,resultStore:r,schema:i,property:l,hideLabelText:d}=e,u=(0,q().Y$)(),{isMobile:p}=(0,s().Fy)(),g=(0,c().yK)((e=>({valueStyle:{display:"flex",alignItems:"center",height:"100%"},aggregationTypeNameStyle:{fontSize:p?12:10,textTransform:"uppercase",letterSpacing:1,color:e.mediumTextColor,marginTop:p?0:2,marginRight:4,userSelect:"none",WebkitUserSelect:"none"}})),[p]),S=(0,a().Kw)(r),h=(0,n.useMemo)((()=>{if(!t)return;let e=_r().v6[(0,Ir().OV)(t)];return(0,Ir().en)(t.aggregator)&&(e=t.aggregator.groupName in gc().ZA?gc().ZA[t.aggregator.groupName]:t.aggregator.groupName),e}),[t]),{numberFormat:f,numberPrecision:y}=(0,a().VK)((()=>{const e=i[l];if(!e)return{};if(e&&("formula"===e.type||"number"===e.type)){const o=e.number_format,n=e.number_precision;return{numberFormat:o,numberPrecision:t?(0,_r().WD)(t.aggregator,n):n}}if("rollup"===e.type&&e.relation_property&&e.target_property&&"number"===e.target_property_type&&void 0!==i[e.relation_property]){var n;const r=i[e.relation_property],l=(0,o(129338).ny)(u,r),s=null==l||null===(n=l.getModel())||void 0===n?void 0:n.getNormalizedSchema(),a=null==s?void 0:s[e.target_property];if("number"===(null==a?void 0:a.type)){const e=a.number_format,o=a.number_precision;return{numberFormat:e,numberPrecision:t?(0,_r().WD)(t.aggregator,o):o}}}return{}}),[i,l,t,u]);if(!h)return null;const v=(0,m.jsx)("span",{style:g.valueStyle,children:t&&(0,m.jsx)(Fr,{aggregation:t,collectionContextStore:u,children:S?(0,_r().Zy)({numberFormat:f,dateFormat:void 0,aggregation:t,userTimeZone:(0,mo().r)(),value:S.aggregationResult,numberPrecision:y}):void 0})},"value");return d?v:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("span",{style:g.aggregationTypeNameStyle,children:h},"type"),v]})})),fc=n.memo((function(e){const{disabled:t,isHovered:n,hideLabelText:r}=e,{isMobile:i}=(0,s().Fy)(),l=(0,c().yK)((e=>({placeholderWrapper:{display:"flex",alignItems:"center"},placeholderText:{color:e.lightTextColor},chevronIcon:{width:10,marginLeft:r?1:4,marginTop:1,fill:e.lightIconColor},summationIcon:{width:12,marginTop:1,fill:e.lightIconColor}})),[r]);return t||!n&&!i?null:(0,m.jsx)(kt().Z,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:l.placeholderWrapper,children:(0,m.jsxs)("div",{style:l.placeholderWrapper,children:[r?(0,m.jsx)("span",{style:l.placeholderText,children:(0,o(2403).D)(l.summationIcon)},"placeholder"):(0,m.jsx)("span",{style:l.placeholderText,children:(0,m.jsx)(C()._H,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})},"placeholder"),(0,Ki().i)(l.chevronIcon)]})})})),yc=n.memo((function(e){let{collectionContextStore:t,disabled:o,groupFormat:r,isFullScreen:i,isInPeekRenderer:l,query:d,schema:u,showPropertyFormats:p,showRightActionsSpacer:g,style:S,paddingLeft:h,paddingRight:f,onMouseEnter:y,onMouseLeave:v,disableSticky:x}=e;const b=(0,s().O7)(),{isPhone:C,isMobile:w}=(0,s().Fy)(),k=(0,c().Fg)(),[V,j]=(0,n.useState)(!1),T=(0,a().VK)((()=>t.frozoneStore.state.frozenIndex),[t.frozoneStore]),{unfrozenIndexAddendum:P,frozenPropertyFormats:I,unfrozenPropertyFormats:_}=(0,a().VK)((()=>{const e=p;let t=[],o=e;const n=(0,F().bW)(T);return void 0!==T&&(t=e.slice(0,n),o=e.slice(n)),{unfrozenIndexAddendum:n,frozenPropertyFormats:t,unfrozenPropertyFormats:o}}),[T,p]),M=(0,a().Kw)(t.isInHomeWidgetStore),B=(0,F().jw)(t,k),K=(0,a().VK)((()=>{const e=M?void 0:(null==B?void 0:B.background)||(l?k.cardContentBackground:k.contentBackground);return{borderTop:`1px solid ${k.tableDividerColor}`,display:"flex",background:e,zIndex:at().RJ,fontSize:14,height:(0,R().rM)({isMobile:w})+(i&&!r?Fe().Z.state:0),minWidth:"100%",clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",left:0,boxSizing:"border-box",...S}}),[i,l,S,k,M,w,r,null==B?void 0:B.background]),L=(0,a().VK)((()=>void 0!==T&&(0,R().oc)({environment:b,collectionContextStore:t,isPhone:C,theme:k})),[T,b,t,C,k]),O=(0,a().VK)((()=>{var e;return((null==d||null===(e=d.aggregations)||void 0===e?void 0:e.length)??0)>0}),[null==d?void 0:d.aggregations]),D=(0,n.useCallback)((()=>{j(!0),null==y||y()}),[j,y]),E=(0,n.useCallback)((()=>{j(!1),null==v||v()}),[j,v]),A=(0,n.useCallback)((e=>{(0,ye().ZP)({event:e,context:ye().Af.EditorMouseDown,callback:()=>{}})}),[]),H=(0,c().yK)((()=>({stickyStyle:{paddingLeft:h,paddingRight:f,fontVariantNumeric:"lining-nums tabular-nums"},container:{display:"flex",paddingRight:!o&&g?32:0},innerContainer:{display:"flex"}})),[o,h,f,g]),Z=(0,n.useCallback)(((e,n)=>(0,m.jsx)(vc,{propertyFormat:e,groupFormat:r,disabled:o,mouseEntered:V,collectionContextStore:t,schema:u,query:d},e.property)),[t,o,r,V,d,u]),z=!M&&(O||i),W=(0,n.useRef)(null),G=(0,m.jsx)(Je().p,{allowSelectionWithin:!1,style:K,onMouseMove:D,onMouseLeave:E,onMouseDown:A,ref:W,children:(0,m.jsx)("div",{style:H.container,children:(0,m.jsxs)("div",{style:H.innerContainer,children:[void 0!==T&&(0,m.jsx)("div",{style:{...L,display:"flex"},children:I.map(Z)}),_.map(((e,t)=>Z(e,t+P)))]})})});return z?(0,m.jsx)(Qr().u,{stickyAttachPoint:x?"no-stick":"floor",stickyStyle:H.stickyStyle,nodeRef:W,children:G}):G})),vc=n.memo((function(e){var t;let{propertyFormat:o,groupFormat:r,disabled:i,mouseEntered:l,collectionContextStore:d,query:u,schema:p}=e;const g=(0,s().O7)(),S=(0,c().yK)((()=>({wrapper:{display:"flex",width:o.width}})),[o.width]),h=(0,n.useCallback)(((e,t)=>{const o=d.collectionViewStore();if(!o)return;let n=u.aggregations?[...u.aggregations]:[];const r=(u.aggregations||[]).findIndex((t=>t.property===e));n=r<0?v().oA([...n,t]):v().oA(n.map(((e,o)=>r===o?t:e)));const i={...u,aggregations:n};!d.isClientModeEnabledStore.state&&t&&d.asyncAggregationStatusStore.setState({calculating:!0,aggregation:t,changingType:!0}),I().createAndCommit({userAction:"TableAggregationRow.handleTableAggregationChange",environment:g,canUndo:!0,perform:e=>{(0,Sr().i)({collectionViewStore:o,update:{query2:i},transaction:e})}})}),[d,u,g]),f=(0,a().VK)((()=>!i&&!!l),[l,i]);return(0,m.jsx)("div",{style:S.wrapper,children:(0,m.jsx)(Sc,{groupFormat:r,propertyFormat:o,disabled:i,isHovered:f,aggregation:null===(t=u.aggregations)||void 0===t?void 0:t.find((e=>e.property===o.property)),property:o.property,collectionContextStore:d,schema:p,onChange:h})})})),xc=n.memo(n.forwardRef((function(e,t){const{collectionContextStore:o,handleAddRowClick:r,numberOfBlankRows:i,isBlockPropertyValueOverlayOpen:l,hideDefaultButtonText:d}=e,{isMobile:u}=(0,s().Fy)(),[p,g]=(0,n.useState)(0),S=(0,a().Kw)(o.isInHomeWidgetStore),h=(0,c().yK)((e=>{const t=S?e.tableHomeDividerColor:e.tableDividerColor,{button:o,buttonInner:n,icon:r}=(0,R().UD)({theme:e,isMobile:u,hideTextWithTransition:d,hideTextWithoutTransition:l});return{button:{...o,transition:"background 0.2s ease",borderBottom:`1px solid ${t}`},buttonInner:n,icon:r}}),[S,u,d,l]);return(0,m.jsxs)("div",{onMouseLeave:()=>g(0),ref:t,children:[(0,m.jsx)(Vt().Z,{className:me().tfM,onClick:r,onMouseDown:ye().$0,style:h.button,onMouseEnter:()=>g(0),children:(0,m.jsxs)("span",{style:{...h.buttonInner,opacity:0!==p||d?0:1},children:[(0,lo().R)(h.icon),(0,m.jsx)(Jo,{collectionContextStore:o})]})},"add-row-button-default"),Array.from({length:i}).map(((e,t)=>{const n=t+1,l=n===i,s=p===n?1:0;return(0,m.jsx)(Vt().Z,{className:me().Gcz,onClick:r,onMouseDown:ye().$0,style:{...h.button,...l&&{borderBottom:"none"}},onMouseEnter:()=>g(n),children:(0,m.jsxs)("span",{style:{...h.buttonInner,opacity:s},children:[(0,lo().R)(h.icon),(0,m.jsx)(Jo,{collectionContextStore:o})]})},n)}))]})})));function bc(e){const{collectionContextStore:t,shouldShowAddRowButton:o,handleAddRowClick:n}=e,{isMobile:r}=(0,s().Fy)(),i=(0,a().VK)((()=>Boolean(t.currentCombinatorFilterStore.state||t.currentPropertyFiltersStore.state.length>0)),[t]),l=(0,a().Kw)(t.isInHomeWidgetStore),d=(0,c().yK)((e=>{const t=l?e.tableHomeDividerColor:e.tableDividerColor,{button:o,buttonInner:n}=(0,R().UD)({theme:e,isMobile:r});return{button:{...o,borderBottom:`1px solid ${t}`},buttonInner:n}}),[l,r]);return(0,m.jsx)(Vt().Z,{className:me().Gcz,onClick:n,onMouseDown:ye().$0,disabled:!o,style:d.button,children:o?(0,m.jsx)("span",{style:d.buttonInner,children:i?(0,m.jsx)(C()._H,{defaultMessage:"No filter results. Click to add a row.",id:"database.tableView.emptyTablePlaceholderWithFilters"}):(0,m.jsx)(C()._H,{defaultMessage:"Empty. Click to add a row.",id:"database.tableView.emptyTablePlaceholder"})}):(0,m.jsx)("span",{style:d.buttonInner,children:i?(0,m.jsx)(C()._H,{defaultMessage:"No filter results.",id:"database.tableView.cannotEdit.emptyTablePlaceholderWithFilters"}):(0,m.jsx)(C()._H,{defaultMessage:"Empty.",id:"database.tableView.cannotEdit.emptyTablePlaceholder"})})})}var Cc=()=>o(673385);const wc=n.memo((function(e){const{collectionContextStore:t}=e,r=(0,s().O7)(),i=(0,c().yK)((e=>({button:{display:"flex",justifyContent:"flex-start",width:32},icon:{width:12,fill:e.mediumIconColor}})),[]),l=(0,n.useCallback)((()=>{t.collectionStore()&&(P().clear({environment:r}),T().ZH({environment:r}),(0,Cc().w)(),w().wd({environment:r,collectionContextStore:t,action:"click_new_property"}),k().wl({collectionSettingsStore:t.settingsStore,item:{type:"propertyType",onAccept:(e,n,i,l)=>{o(853292).PW({environment:r,collectionContextStore:t,propertyType:e,isSuggestedProperty:n,propertyName:i,selectOptions:l,from:"table"})}}}))}),[t,r]);return(0,m.jsx)(Vt().Z,{className:me().V6y,style:i.button,onMouseDown:pc,onClick:l,children:(0,m.jsx)("div",{style:uc,children:(0,lo().R)(i.icon)})})}));function kc(e){let{collectionContextStore:t}=e;const o=(0,s().O7)(),r=(0,c().yK)((e=>({dotsIcon:{width:12,fill:e.mediumIconColor},button:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:32}})),[]),i=(0,n.useCallback)((()=>{k().r$({collectionContextStore:t,collectionSettingsStore:t.settingsStore}),w().wd({environment:o,collectionContextStore:t,action:"click_table_header_dot_menu"}),k().H4({collectionSettingsStore:t.settingsStore,item:{type:"properties",timelineViewTab:"timeline"}})}),[t,o]);return(0,m.jsx)(Vt().Z,{style:r.button,onMouseDown:pc,onClick:i,className:me().V6y,children:(0,m.jsx)("div",{style:uc,children:(0,_n().o)(r.dotsIcon)})})}var Vc=()=>o(644235),jc=()=>o(645805);const Tc=2,Pc=3;function Ic(e){const{isCollectionViewBlockSelected:t,passesFilter:o,isScrolled:r,isCheckbox:i,isShimmerRow:l}=e,s=(0,n.useCallback)((e=>"dark"===e.mode?"transparent":o&&!t?`linear-gradient(to right, ${(0,As().Fq)(Qo().se[e.mode].gray,.15)},${(0,As().Fq)(Qo().se[e.mode].gray,.1)},  transparent)`:`linear-gradient(to right, ${(0,As().Fq)(Qo().se[e.mode].gray,.35)},${(0,As().Fq)(Qo().se[e.mode].gray,.2)},  transparent)`),[o,t]),a=(0,c().yK)((e=>({border:{position:"absolute",right:0,width:Tc,height:l?35:"100%",background:o&&!t||"dark"===e.mode?e.tableDividerColor:e.tableFrozenFilterDividerColor},shadow:{position:"absolute",top:0,right:-Pc,width:Pc,height:l?34:"100%",background:s(e)}})),[l,o,t,s]);return(0,m.jsxs)("div",{style:{display:"flex",flexDirection:"row",height:"100%"},children:[i?null:(0,m.jsx)("div",{style:a.border}),(0,m.jsx)(kt().Z,{visible:!0,animate:{opacity:r?1:0},children:(0,m.jsx)("div",{style:a.shadow})})]})}function Rc(e){const{checkedState:t,onClick:o,checkboxType:r,collectionContextStore:i,isBlockHovered:l,passesFilter:d,disabled:u,frozoneProps:p}=e,g=(0,s().O7)(),S=(0,a().qz)(void 0,mt().Z),h=(0,Vc().hq)(),f=(0,a().VK)((()=>h&&jc().default.state.isOpen&&jc().default.state.isPlusButtonVisible),[h]),y=(0,a().VK)((()=>S.state.mouseEntered),[S]),v=(0,n.useRef)(null);(0,n.useEffect)((()=>{v.current&&(v.current.indeterminate="indeterminate"===t)}),[t]);const x=(0,a().VK)((()=>To().default.state.isDragging),[]),b=(0,n.useCallback)((e=>{u||(o(e),w().Ac({environment:g,collectionContextStore:i,checkbox_type:r}))}),[u,r,i,g,o]),C=(0,a().VK)((()=>f?0:!1===t&&!y||x?l?.6:null!=p&&p.shouldShowStickyMultiSelectColumn?.4:0:1),[t,y,x,l,null==p?void 0:p.shouldShowStickyMultiSelectColumn,f]),k=(0,c().yK)((e=>({multiSelectCheckbox:{background:null!=p&&p.isScrolled?null==p?void 0:p.frozenStyles.background:void 0,borderBottom:e.tableDividerColor,height:"100%"},multiSelectCheckboxInner:{background:null!=p&&p.isCollectionViewBlockSelected?Qo().ZP.blueWithAlpha(.14):void 0,height:"100%"},checkBoxInput:{width:Nt().tA,height:Nt().tA,cursor:u?void 0:"pointer",accentColor:e.fill.uiBlue,position:"relative",right:2}})),[u,null==p?void 0:p.frozenStyles.background,null==p?void 0:p.isCollectionViewBlockSelected,null==p?void 0:p.isScrolled]),V=null!=p&&p.shouldShowStickyMultiSelectColumn?C>0?1:0:C;return(0,m.jsxs)(kt().Z,{animate:{opacity:V},style:k.multiSelectCheckbox,onMouseEnter:()=>S.enter(),onMouseLeave:()=>S.exit(),children:[(0,m.jsx)("div",{style:k.multiSelectCheckboxInner,children:(0,m.jsx)("label",{style:{height:"100%",alignItems:"flex-start",justifyContent:"center",display:"flex",cursor:u?void 0:"pointer",zIndex:1},onClick:ye().Wi,onMouseDown:ye().$0,children:(0,m.jsx)("div",{style:{width:`${Nt().bu}px`,height:`${Nt().bu}px`,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,m.jsx)("input",{type:"checkbox",style:k.checkBoxInput,ref:v,checked:!0===t,onChange:b,disabled:u})})})}),(null==p?void 0:p.shouldFreezeMultiSelectColumn)&&(0,m.jsx)(Ic,{isCollectionViewBlockSelected:null==p?void 0:p.isCollectionViewBlockSelected,passesFilter:d,isCheckbox:!0,isScrolled:!0})]})}function _c(e){const{groupsPointer:t,collectionContextStore:o,hasMoreReducerResults:r,frozoneProps:i}=e,l=(0,s().O7)(),d=(0,n.useCallback)((()=>(0,X().A7)(t[0],o).filter((e=>e.canEdit()))),[o,t]),u=(0,a().VK)((()=>0===d().length),[d]),{checkedState:p,allVisibleItemsChecked:g}=(0,a().VK)((()=>{const e=d(),t=e.length;if(0===t)return{checkedState:!1,allVisibleItemsChecked:!0};const o=oe().default.state.stores.filter((t=>e.includes(t))).length;let n;return n=0!==o&&(o===t&&!r||"indeterminate"),{checkedState:n,allVisibleItemsChecked:o===t}}),[d,r]),S=(0,n.useCallback)((e=>{var t;const n=d(),r=oe().default.state.stores,i=(0,R().vg)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:r;!1===p||"indeterminate"===p&&!g?T().Z5({environment:l,stores:v().G0(i,n)}):(!0===p||"indeterminate"===p&&g)&&T().Z5({environment:l,stores:v().zu(i,...n)}),e.stopPropagation(),e.preventDefault()}),[p,o,l,d,g]),h=(0,a().VK)((()=>(0,F().fk)({environment:l,collectionContextStore:o})),[l,o]),f=(0,c().yK)((()=>({wrapper:{...null==i?void 0:i.frozenStyles,...-1===(null==i?void 0:i.frozenIndex)&&{background:void 0}},checkboxContainer:h?{position:"absolute",left:-Nt().Xx,background:-1===(null==i?void 0:i.frozenIndex)||null==i?void 0:i.frozenStyles.background}:{display:"contents"}})),[null==i?void 0:i.frozenIndex,null==i?void 0:i.frozenStyles,h]);return(0,m.jsx)("div",{style:f.wrapper,children:(0,m.jsx)("div",{style:f.checkboxContainer,children:(0,m.jsx)(Rc,{passesFilter:!0,checkedState:p,onClick:S,checkboxType:"group",collectionContextStore:o,frozoneProps:i?{...i,isCollectionViewBlockSelected:!1}:void 0,disabled:u})})})}var Mc=()=>o(536381),Bc=()=>o(148126),Fc=()=>o(455241),Kc=()=>o(542649);function Lc(e){const{origin:t,propertyType:o}=e,n=(0,s().O7)();return(0,m.jsx)(Ia().U,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return(0,m.jsx)(C()._H,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner"});case"verification":return(0,m.jsx)(C()._H,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification"});case"tags":return(0,m.jsx)(C()._H,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more"});default:(0,x().t1)(o)}}(),content:function(){switch(o){case"owner":return(0,m.jsx)(C()._H,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty",values:{bold:e=>(0,m.jsx)("span",{style:{fontWeight:b().Ue.semibold},children:e})}});case"verification":return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(C()._H,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty"}),(0,m.jsx)(Fc().d,{href:(0,Bc().UY)("guides.wikis"),style:{color:Qo().ZP.uiLightGray}})]});case"tags":return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(C()._H,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty"}),(0,m.jsx)(Fc().d,{href:(0,Bc().UY)("guides.databaseProperties"),style:{color:Qo().ZP.uiLightGray}})]});default:(0,x().t1)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,x().t1)(o)}}(),onCloseClick:()=>{Mc().nX(n)},onPrimaryButtonClick:()=>Mc().Rg(n),onBackButtonClick:()=>Mc().FO(n),enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerLength:Kc().EZ,pointerOffset:Kc().FD,style:{width:Kc().G5}})}var Oc=()=>o(98642),Dc=()=>o(494616);const Ec=new(ee().Ss)("TableHeaderCellMenu",(()=>Promise.all([o.e(62743),o.e(11189),o.e(53329),o.e(72586),o.e(54940),o.e(50471),o.e(2971),o.e(54041)]).then(o.bind(o,490875)))),Ac=(0,ee().kF)(Ec,(e=>e.TableHeaderCellMenu));var Hc=()=>o(269853),Zc=()=>o(475692),zc=()=>o(162109),Wc=()=>o(63562),Gc=()=>o(514),Nc=()=>o(173113),Uc=()=>o(104088);const $c=(0,C().vU)({relation:{defaultMessage:"This relation links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceRelationError.message"},formula:{defaultMessage:"This formula links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceFormulaError.message"},linkedView:{defaultMessage:"This view references content from another workspace. Cross-workspace functionality is limited, so some content may not sync correctly.",id:"collection.tableHeaderCell.crossSpaceLinkedViewError.message"}}),qc=n.memo((function(e){let{type:t}=e;const r=(0,s().O7)(),i=(0,C().YB)(),l=(0,n.useRef)(null),a=(0,c().yK)((e=>({icon:{fill:e.icon.orangePrimary},text:{width:300,color:e.text.secondary,padding:"12px 16px",fontSize:14},footer:{display:"flex",justifyContent:"space-between",borderTop:`1px solid ${e.stroke.secondary}`},button:{width:"auto"},dismissButton:{color:e.text.uiBluePrimary},learnMoreButton:{color:e.text.secondary},learnMoreIcon:{width:14,height:14,marginRight:0}})),[]),d=(0,Bc().UY)("guides.duplicateToSpace"),u=(0,n.useCallback)((()=>(0,m.jsxs)(vr().Z,{menuType:fr().o.Popup,children:[(0,m.jsx)(Cr().Z,{style:a.text,children:i.formatMessage($c[t])}),(0,m.jsx)(xr().ZP,{type:xr().iW.Vertical,initialFocus:void 0,sections:[{key:"footer",items:[{key:"dismiss",action:()=>{var e;null===(e=l.current)||void 0===e||e.setOpen(!1)},render:e=>(0,m.jsx)(Or().Z,{...e,title:(0,m.jsx)(C()._H,{defaultMessage:"Dismiss",id:"collection.tableHeaderCell.crossSpaceRelationError.dismiss"}),buttonStyle:{...a.button,...a.dismissButton}})},{key:"learn-more",action:e=>{var t,o,n;null===(t=(o=e.event).preventDefault)||void 0===t||t.call(o),null===(n=l.current)||void 0===n||n.setOpen(!1),hn().c4({environment:r,url:d,openInNew:"tab"})},render:e=>(0,m.jsx)(Or().Z,{...e,title:(0,m.jsx)(C()._H,{defaultMessage:"Learn more",id:"collection.tableHeaderCell.crossSpaceRelationError.learnMore"}),icon:(0,o(456681).m)(),desktopIconStyle:a.learnMoreIcon,buttonStyle:{...a.button,...a.learnMoreButton},href:d,external:!0})}],render:e=>(0,m.jsx)(Cr().Z,{...e,style:a.footer})}]})]})),[a,i,r,d,t]),p=(0,n.useCallback)((e=>(0,m.jsx)(jt().Z,{icon:En().t,iconStyle:a.icon,ariaLabel:i.formatMessage($c[t]),...e})),[a,i,t]);return(0,m.jsx)(Dr().ZP,{popupType:Uc().k.Popup,render:u,renderOrigin:p,ref:l})})),Yc=n.memo((function(e){const{allowHidingTitle:t,collectionContextStore:r,columnIndex:i,disableCellRightBorder:l,disabled:d,format:u,formatKey:p,isLast:g,paddingTop:S,property:h,renderSpacer:f,schema:y,width:v,collectionViewBlockStore:b}=e,C=(0,n.useRef)(null);(0,Oc().c)(o(804097).Z,(()=>({collectionContextStore:r,property:h,getNode:()=>C.current})),[r,h]);const w=(0,s().O7)(),{isMobile:k}=(0,s().Fy)(),{value:V}=(0,ee().XJ)(de().F.formulas),{value:j}=(0,ee().XJ)(de().F.formulaConstants),{value:I}=(0,ee().XJ)(de().F.formulaPermissions),[R,_]=(0,n.useState)(!1),M=(0,a().Kw)(r.permissionScopesStore),B=(0,a().qz)(void 0,Be().Z),F=(0,a().VK)((()=>o(658096).default.state.publicPageData),[]),{isRightMostFrozenColumn:K,isScrolled:L}=(0,a().VK)((()=>{const{frozenIndex:e,isScrolled:t}=r.frozoneStore.state;return{isRightMostFrozenColumn:e===i,isScrolled:t}}),[r.frozoneStore,i]),O=y[h],D=(0,a().VK)((()=>{var e;if("relation"!==(null==O?void 0:O.type))return!1;const t=null===(e=r.collectionStore())||void 0===e?void 0:e.getSpaceId();return(0,io().Qh)(t,O)}),[r,O]),[{value:E}]=(0,fo().r5)((async()=>{var e;if("formula"!==(null==O?void 0:O.type))return!1;const t=r.collectionStore(),n=null===(e=r.collectionStore())||void 0===e?void 0:e.pointer;if(!(t&&n&&V&&j&&I))return!1;const i=(0,tn().W)(),l=(0,o(520509).yf)({collectionFeatureGates:i,experimentService:Le().default,getRecordModel:t.getRecordModel,loadRecordModel:t.loadRecordModel}),s={type:"block",collection:n},a={kind:j.FormulaContextValueKind.ThisRow,type:s},c={sourceProperty:h,valueTypes:[a],handleDataRequest:l,publicPageDataCollection:{id:null==F?void 0:F.collectionId,schema:null==F?void 0:F.collectionSchema},spaceId:t.getSpaceId(),featureGates:i};return!(await I.hasAccessToProperty({collectionPointer:n,collectionSchema:y,context:c,propertyId:h,hasAccessFn:I.hasSameSpaceAccess}))}),[r,O,h,y,V,j,I,F]),A=(0,je().E)("collections_xws"),H=D&&A,Z=E&&A,z=(0,Nc().a)(O),W=(0,n.useCallback)((()=>{P().clear({environment:w}),T().ZH({environment:w}),(0,Cc().w)()}),[w]),G=(0,n.useCallback)((e=>{k||(e.preventDefault(),(0,ye().ZP)({event:e,context:ye().Af.EditorContextMenu,callback:()=>{W(),B.setState({open:!0})}}))}),[k,W,B]),N=(0,n.useCallback)((e=>{_(e)}),[_]),U=(0,c().yK)((e=>({container:{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:v,borderRight:l?void 0:`1px solid ${e.tableDividerColor}`},button:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:8,paddingRight:8,paddingTop:S},property:{fontSize:14,flex:"1 1 auto"},enabledIcon:{width:20,height:20,marginLeft:4}})),[v,l,S]),$=(0,n.useCallback)((e=>O?(0,m.jsx)(Qc,{propertySchema:O,tooltipEvents:e,propertyId:h,collectionViewBlockStore:b}):null),[O,h,b]),q=(0,n.useCallback)(((e,t)=>{var n;return O?(0,m.jsxs)(Vt().Z,{style:U.button,disabled:d,...(0,Mr().Z)(e,t),children:[f&&f(g),(0,m.jsx)(Pt().ZP,{propertySchema:O,showIcon:!0,badge:(0,m.jsxs)(m.Fragment,{children:["relation"===O.type&&z&&(0,m.jsx)(zc().R,{style:U.enabledIcon}),"button"===O.type&&(0,x().$K)(O.automation_id)&&(0,m.jsx)(ed,{propertyId:h,propertySchema:O,automationId:O.automation_id,collectionViewBlockStore:b}),!(null===(n=O.description)||void 0===n||!n.length)&&!k&&(0,m.jsx)(o(143695).Z,{setIsHovered:N}),(0,m.jsx)(Pt().oV,{propertySchema:O})]}),style:U.property,property:h}),H&&(0,m.jsx)(qc,{type:"relation"}),Z&&(0,m.jsx)(qc,{type:"formula"}),K&&(0,m.jsx)(Ic,{isCollectionViewBlockSelected:!1,passesFilter:!0,isScrolled:Boolean(L)})]}):null}),[O,U.button,U.enabledIcon,U.property,d,f,g,z,h,b,k,N,H,Z,K,L]),Y=(0,n.useCallback)((e=>O?(0,m.jsx)(Tt().Z,{disableTooltip:H||Z,delayThreshold:R?0:500,placement:Me().Placement.Right,renderTooltip:$,render:t=>q(t,e)}):null),[O,H,Z,$,R,q]),Q=(0,n.useCallback)((e=>(0,m.jsx)(Ac,{allowHidingTitle:t,collectionContextStore:r,columnIndex:i,format:u,formatKey:p,parent:e,property:h,schema:y})),[t,r,i,u,p,h,y]);return O?(0,m.jsxs)("div",{ref:C,style:U.container,className:me().VMO,onContextMenu:G,children:[(0,m.jsx)(Wc().BB,{origin:C,store:r}),(0,m.jsx)(Dr().ZP,{popupType:k?rs().kQ.SlideUp:rs().kQ.Popup,disabled:!M.canConfigureBlock,originGap:1,alignmentToOrigin:Dr().vR.Start,buttonPopupStore:B,renderOrigin:Y,render:Q,onClick:W})]}):null}));function Qc(e){const{propertyId:t,propertySchema:o,tooltipEvents:n,collectionViewBlockStore:r}=e,i=(0,c().yK)((e=>({description:{color:e.mediumInvertedTextColor},sharingEnabledTooltip:{marginTop:8,color:e.mediumInvertedTextColor},aiUpdate:{color:e.mediumInvertedTextColor}})),[]),l=(0,a().VK)((()=>(0,io().qQ)(o)&&(0,io().q3)(o)),[o]),s=(0,Nc().a)(o),d=(0,a().VK)((()=>r.getCollectionStore()),[r]);return(0,m.jsxs)("div",{...n,style:Gc().F6,children:[(0,m.jsx)("div",{children:o.name}),void 0!==(null==o?void 0:o.description)&&o.description.length>0?(0,m.jsx)("div",{style:i.description,children:o.description}):null,d&&"relation"===o.type&&s&&(0,m.jsx)(zc().e,{propertySchema:o,collectionStore:d,style:i.sharingEnabledTooltip}),l&&l.auto_update_on_edit&&(0,m.jsx)("div",{style:i.aiUpdate,children:(0,m.jsx)(C()._H,{...Zc().Z.keptUpToDateWithNotionAITooltip})}),"button"===o.type&&(0,x().$K)(o.automation_id)&&(0,m.jsx)(Jc,{propertyId:t,propertySchema:o,automationId:o.automation_id,collectionViewBlockStore:r})]})}function Xc(e){const{automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r,collectionContextStore:i}=e,l=(0,a().VK)((()=>o.getSpaceId()),[o]),s=te().Mz.createChildStore(o,{id:t,table:Dc().cv,spaceId:l});return(0,Hc().l$)({automationStore:s,propertyId:n,propertySchema:r,collectionContextStore:i})}function Jc(e){const{automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r}=e,i=(0,c().yK)((e=>({wrap:{color:e.mediumInvertedTextColor}})),[]);return Xc({automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r,collectionContextStore:(0,q().Y$)()})?(0,m.jsx)("div",{style:i.wrap,children:(0,m.jsx)(C()._H,{...Zc().Z.buttonPropertyErrorTooltip})}):null}function ed(e){const{automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r}=e,i=(0,c().yK)((e=>({icon:{width:14,height:14,marginLeft:5,fill:e.mediumIconColor}})),[]);return Xc({automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r,collectionContextStore:(0,q().Y$)()})?(0,En().t)(i.icon):null}var td=()=>o(834458),od=()=>o(983993);const nd={position:"absolute",right:0,width:0,flexGrow:0,zIndex:1},rd=n.memo((function(e){let{leftFormat:t,height:o,onTemporaryResize:r,onAccept:i,onCancel:l,propertySchema:a,resultStore:c}=e;const d=(0,n.useRef)(void 0),{isPhone:u}=(0,s().Fy)(),[p,g]=(0,n.useState)(!1),[S,h]=(0,n.useState)(!1),f=!u&&(S||p),y=(0,n.useCallback)((e=>{const o=d.current;if(!o||!o.width)return;const n=Math.max(o.width+e.diffX,ad(a,t,o.width,e.optionKey));return{...o,width:n}}),[t,a]),x=(0,n.useCallback)((e=>{e.preventDefault(),d.current=t,h(!0)}),[t]),b=(0,n.useCallback)((e=>{const t=y(e);t&&r(t)}),[y,r]),C=(0,n.useCallback)((e=>{const t=y(e);t&&i(t),h(!1)}),[y,i]),w=(0,n.useCallback)((()=>{l(),d.current=void 0,h(!1)}),[l]),k=(0,n.useCallback)((e=>{const o=c.state?c.state.blockIds:[],n=v().oA(o.map((e=>{const o=od().Z.findBlockPropertyValueByBlockId(e,t.property),n=null==o?void 0:o.getNode();if(n)return function(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const n=getComputedStyle(e);for(let l=0;l<n.length;l++){const e=n[l],o=n.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative");t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const r=t.querySelectorAll("*");for(const l of r)l.style&&(l.style.pointerEvents="none",l.style.width="auto");document.body.appendChild(t);const i=t.getBoundingClientRect();return t.remove(),null!=i&&i.width?Math.ceil(i.width)+1:void 0}(n)})));if(t.width){const e={...t,width:Math.min(800,Math.max(Math.max(...n),ad(a,t,t.width)))};i(e)}}),[t,i,a,c]),V=(0,n.useCallback)((e=>(0,m.jsx)("div",{style:f?dd(o):cd(o),onDoubleClick:k,...e})),[k,o,f]);return(0,m.jsx)("div",{style:nd,onMouseMove:()=>g(!0),onMouseLeave:()=>g(!1),children:(0,m.jsx)(qs().Z,{onDraggableDragStart:x,onDraggableDragMove:b,onDraggableDragEnd:C,onDraggableDragCancel:w,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:V})})}));const id=32,ld=64,sd=100;function ad(e,t,o){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3])return id;const n=function(e,t){var o;if("checkbox"===(null==e?void 0:e.type))return id;if("status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return id;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,td().getFormulaPropertySchemaResultType)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return id;if("auto_increment_id"===(null==e?void 0:e.type))return ld;return sd}(e,t);return o&&o<n?id:n}function cd(e){return{width:5,marginLeft:-3,marginTop:-1,height:e,transition:"background 200ms ease-out",background:Qo().ZP.blueWithAlpha(0),cursor:"col-resize"}}function dd(e){return{...cd(e),background:Qo().ZP.blueWithAlpha(.8)}}const ud=n.memo((function(e){let{store:t,collectionContextStore:r,schema:i,query:l,disabled:d,formatKey:u,disableCellRightBorder:p,renderSpacer:g,allowHidingTitle:S,paddingTop:h,showRightActions:f,showPropertyFormats:y,resultStore:v,format:x,tableStore:b,height:C,groupsPointer:k,property:V,index:j,isLast:T}=e;const P=(0,s().O7)(),{isMobile:_,isPhone:M}=(0,s().Fy)(),B=(0,n.useRef)(null),F=(0,a().VK)((()=>b.getCurrentFormat(x)),[x,b]),K=y[j],{wikiOnboardingPhase:L,showWikiTooltip:O}=(0,a().VK)((()=>{var e,n,l,s;const a=Mc().B1(),c="notion://wiki_collection"===(null===(e=r.collectionStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("app_config_uri").getValue())&&t.isCollectionViewPageWithContent()&&t.id===(null===(n=r.collectionViewBlockStore())||void 0===n?void 0:n.id),d=c&&("notion://wiki/owner_property"===V||V===o(496205).EI.Owner)&&"owner"===a,u=c&&"verification"===(null===(l=i[V])||void 0===l?void 0:l.type)&&"verification"===a,p=c&&"multi_select"===(null===(s=i[V])||void 0===s?void 0:s.type)&&"tags"===a;return{wikiOnboardingPhase:a,showWikiTooltip:!_&&(d||u||p)}}),[r,_,V,i,t]),D=(0,a().VK)((()=>p||T&&!mc(d,f)),[p,d,T,f]),E=(0,a().VK)((()=>(0,R().vf)({environment:P,propertyFormat:K})),[P,K]),A=(0,n.useCallback)((e=>{const t=b.getCurrentFormat(F),o=b.getCurrentProperties(u,t).map((t=>t.property===e.property?e:t)),n={...t,[u]:o};b.setState({...b.state,temporaryFormat:n})}),[b,u,F]),H=(0,n.useCallback)((e=>{const t=r.collectionViewStore();if(!t)return;const o=b.getCurrentFormat(F),n=b.getCurrentProperties(u,F).map((t=>t.property===e.property?e:t)),i={...o,[u]:n};I().createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:P,canUndo:!0,perform:e=>{(0,Sr().i)({collectionViewStore:t,update:{format:i},transaction:e})}}),b.setState({...b.state,temporaryFormat:void 0}),w().wd({environment:P,collectionContextStore:r,action:"table_resize_columns"})}),[r,P,F,u,b]),Z=(0,n.useCallback)((()=>{b.setState({...b.state,temporaryFormat:void 0})}),[b]),z=(0,c().yK)((()=>({container:{display:"flex",position:"relative"}})),[]);return(0,m.jsxs)("div",{style:z.container,ref:O?B:null,children:[O&&(0,m.jsx)(Lc,{origin:B,propertyType:L}),K&&E&&(0,m.jsx)(Yc,{format:F,schema:i,query:l,property:V,width:E,collectionViewBlockStore:t,collectionContextStore:r,disabled:d,formatKey:u,isLast:T,disableCellRightBorder:D,allowHidingTitle:S,renderSpacer:g,paddingTop:h,columnIndex:j,groupsPointer:k}),!d&&!M&&(0,m.jsx)(rd,{leftFormat:K,onTemporaryResize:A,onAccept:H,onCancel:Z,height:C,propertySchema:i[V],resultStore:v})]},V)}));function pd(e,t,o,n,r,i){const l=t.collectionViewStore();if(!l)return;const s={...r.getCurrentFormat(n),[o]:v().MR(r.getCurrentProperties(o,n),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0}))};I().createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:i,canUndo:!0,perform:e=>{(0,Sr().i)({collectionViewStore:l,update:{format:s},transaction:e})}}),w().wd({environment:i,collectionContextStore:t,action:"table_reorder_columns"})}const md=d().default.createClass(void 0,{name:"ReducerResultStore"}),gd=n.memo((function(e){let{store:t,disabled:o,showRightActions:r,disableCellRightBorder:i,disableHorizontalEdgeScroll:l,collectionContextStore:d,frozoneProps:u,height:p,minWidth:g,isInPeekRenderer:S,isInHomeWidget:h,disableTopBorder:f,showHoverActionsStore:y,groupFormat:v,showPropertyFormats:x,format:b,formatKey:C,tableStore:w,resultStore:k,allowHidingTitle:V,renderSpacer:j,paddingTop:T,paddingLeft:P,paddingRight:I,query:R,schema:_,children:M,hasMoreReducerResults:B}=e;const K=(0,s().O7)(),L=(0,c().Fg)(),O=(0,a().VK)((()=>(0,F().fk)({environment:K,collectionContextStore:d})),[d,K]),D=(0,a().qz)(k,md),E=(0,a().VK)((()=>v?[v]:[]),[v],{useDeepEqual:!0}),A=(0,F().jw)(d,L),H=h?"transparent":(null==A?void 0:A.background)||(S?L.cardContentBackground:L.contentBackground),Z=(0,a().VK)((()=>function(e,t,o,n,r,i,l){const s=e.collectionViewStore();if(!s)return{};const a=s.getType(),c=i?n.tableHomeDividerColor:n.tableDividerColor;return{display:"flex",background:r,zIndex:at().bF,height:t,color:n.mediumTextColor,boxShadow:`-3px 0 0 ${r}, inset 0 -1px 0 ${c}${l?"":`, inset 0 1px 0 ${c}`}`,minWidth:o,left:"timeline"===a?void 0:0,right:"timeline"===a?void 0:0,position:"relative",boxSizing:"border-box"}}(d,p,g,L,H,h,f)),[d,H,f,p,h,g,L]),z=(0,a().VK)((()=>mc(o,r)),[o,r]),W=(0,a().VK)((()=>y&&y.state),[y]),G=(0,n.useRef)(null),N=(0,a().VK)((()=>{var e;return null===(e=d.collectionViewStore())||void 0===e?void 0:e.getType()}),[d]),U=(0,c().yK)((e=>({stickyStyle:{paddingLeft:P,paddingRight:I,minWidth:g,background:Z.background,borderRight:"timeline"===N?`1px solid ${e.tableDividerColor}`:void 0,"--timeline-box-shadow":"timeline"===N?"0px":void 0},transitionStickyStyle:"timeline"===N?{borderRight:void 0}:{}})),[P,I,g,Z.background,N]);return(0,m.jsx)(Qr().u,{stickyAttachPoint:h?"no-stick":"ceiling",absoluteHeight:Z.height,nodeRef:G,stickyStyle:U.stickyStyle,transitionStickyStyle:U.transitionStickyStyle,children:(0,m.jsxs)("div",{className:me().kUP,style:Z,dir:"ltr",ref:G,children:[O&&(0,m.jsx)(_c,{groupsPointer:E,collectionContextStore:d,frozoneProps:u,hasMoreReducerResults:!!B}),(0,m.jsx)(Sd,{showRightActions:r,store:t,collectionContextStore:d,schema:_,query:R,disabled:o,formatKey:C,disableCellRightBorder:i,renderSpacer:j,allowHidingTitle:V,paddingTop:T,frozoneProps:u,disableTopBorder:f,backgroundColor:H,disableHorizontalEdgeScroll:l,showPropertyFormats:x,format:b,height:p,tableStore:w,groupsPointer:E,resultStore:D}),(0,m.jsxs)(kt().Z,{visible:z,animate:{opacity:W?1:0},style:{display:"flex"},children:[(0,m.jsx)(wc,{collectionContextStore:d}),(0,m.jsx)(kc,{collectionContextStore:d})]}),M]})})}));function Sd(e){let{disabled:t,collectionContextStore:r,disableCellRightBorder:i,disableHorizontalEdgeScroll:l,disableTopBorder:d,backgroundColor:u,formatKey:p,format:g,schema:S,query:h,tableStore:f,showPropertyFormats:y,allowHidingTitle:v,showRightActions:x,height:b,frozoneProps:C,groupsPointer:w,resultStore:k,paddingTop:V,renderSpacer:j,store:T}=e;const P=(0,s().O7)(),{canConfigureBlock:I,isInHomeWidget:R}=(0,a().VK)((()=>({canConfigureBlock:r.permissionScopesStore.state.canConfigureBlock,isInHomeWidget:r.isInHomeWidgetStore.state})),[r]),_=(0,a().VK)((()=>y.map((e=>e.property))),[y],{useDeepEqual:!0}),M=(0,n.useCallback)(((e,o,n)=>(0,m.jsx)(ud,{collectionContextStore:r,store:T,schema:S,query:h,disabled:t,format:g,formatKey:p,allowHidingTitle:v,showPropertyFormats:y,resultStore:k,showRightActions:x,disableCellRightBorder:i,renderSpacer:j,paddingTop:V,tableStore:f,groupsPointer:w,height:b,property:e,index:o,isLast:n},e)),[v,r,i,t,g,p,w,b,V,h,j,k,S,y,x,T,f]),B=null==C?void 0:C.frozenIndex,K=(0,F().bW)(B),L=null==C?void 0:C.frozenStyles.left,O=(0,c().yK)((e=>{const t=R?e.tableHomeDividerColor:e.tableDividerColor;return{frozenStyle:{display:"flex",...null==C?void 0:C.frozenStyles,left:R?Nt().f_:L??0,boxShadow:`-3px 0 0 ${u}, inset 0 -1px 0 ${t}${d?"":`, inset 0 1px 0 ${t}`}`}}}),[u,d,null==C?void 0:C.frozenStyles,R,L]),D=_.slice(0,K),E=_.slice(K);return t||!I?(0,m.jsxs)("div",{style:Dl().l8,children:[(0,m.jsx)("div",{style:O.frozenStyle,children:D.map(((e,t)=>M(e,t,t===_.length-1)))}),E.map(((e,t)=>M(e,t+K,t===_.length-1)))]}):(0,F().Ql)(B)?(0,m.jsx)(o(164482).Z,{style:{display:"flex"},direction:"horizontal",keys:_,sectionedKeys:{frozen:D,unfrozen:E},sectionStyles:{frozen:O.frozenStyle,unfrozen:{display:"flex"}},renderKey:M,onDrop:e=>pd(e,r,p,g,f,P),disableHorizontalEdgeScroll:l}):(0,m.jsx)(Dl().ZP,{direction:"horizontal",keys:_,renderKey:M,onDrop:e=>pd(e,r,p,g,f,P),disableHorizontalEdgeScroll:l})}function hd(e){const{children:t,isCollectionViewBlockSelected:o,passesFilter:n,shouldFreeze:r}=e,i=(0,c().yK)((()=>({container:{display:"flex",background:o&&n?Qo().ZP.blueWithAlpha(.14):void 0}})),[o,n]);return r?(0,m.jsx)(kt().Z,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:i.container,children:t},"halo"):(0,m.jsx)(m.Fragment,{children:t})}var fd=()=>o(173255),yd=()=>o(965865);function vd(e){let{store:t,collectionContextStore:o,children:n,anyWrapping:r}=e;return(0,je().E)("collections_column_virtualization")&&r?(0,m.jsx)(xd,{store:t,collectionContextStore:o,children:n}):(0,m.jsx)("div",{style:{display:"flex"},children:n})}function xd(e){let{store:t,collectionContextStore:o,children:r}=e;const i=(0,n.useRef)(null),l=o.virtualizedModule.getBlockHeightsCache(),s=(0,n.useCallback)((e=>{l.cacheRowHeight(t.id,e.height)}),[l,t]);(0,yd().c7)(i,s);const d=(0,a().VK)((()=>{var e;return(null===(e=l.getBlockHeightStore(t.id))||void 0===e?void 0:e.state)??void 0}),[l,t]),u=(0,c().yK)((()=>({row:{display:"flex",...d?{height:Math.max(d,$s().nz),overflowY:"clip"}:{}}})),[d]);return(0,m.jsx)("div",{ref:i,style:u.row,children:r})}const bd=n.memo((function(e){const{store:t,passesFilter:o,canEdit:r,frozoneProps:i}=e,l=(0,q().Y$)(),c=(0,s().O7)(),d=(0,a().VK)((()=>oe().default.state.stores.includes(t)),[t]),u=(0,a().VK)((()=>{var e;return jc().default.state.isOpen&&(null===(e=jc().default.state.currentStore)||void 0===e?void 0:e.id)===t.id}),[t]),p=(0,n.useCallback)((e=>{var o;(0,R().vg)({collectionViewBlockId:null===(o=l.collectionViewBlockStore())||void 0===o?void 0:o.id})?T().Z5({environment:c,stores:[t]}):T().Ys({environment:c,store:t,selectMode:T().BK()?T().W7.MULTI_SELECT_FROM_BOUNDARY:T().W7.TOGGLE}),e.stopPropagation()}),[l,c,t]);return(0,m.jsx)(Rc,{checkedState:d,onClick:p,checkboxType:"single_row",collectionContextStore:l,isBlockHovered:u,frozoneProps:i,passesFilter:o,disabled:!r})}));const Cd=function(e){const{toggleButton:t,subitemPath:o,shouldShowMultiSelectCheckbox:n,propertyIndex:r}=e,i=(null==o?void 0:o.length)??0,l=Math.max((i-1)*X().Hw,0)+X().gY;return t?(0,m.jsxs)("div",{style:{paddingTop:4,display:"flex",...0===r&&n?{marginLeft:-8,marginRight:0,gap:4}:{}},children:[(0,m.jsx)("div",{style:{width:l}}),t]}):(0,m.jsx)("div",{style:{minWidth:l+X().Hw,...0===r&&n?{marginLeft:-8,marginRight:4}:{}}})},wd=n.memo((function(e){const{propertyFormat:t,index:r,canEdit:i,isLastColumn:l,isRightMostFrozenColumn:d,store:u,schema:p,disabled:g,disableCellBorderRight:S,disableLastCellBorderRight:h,subitemPath:f,onShiftEnter:y,tableWrap:x,subitemFormat:b,forceMouseEntered:C,shouldCaptureKeyboard:w,isLocked:k,toggleButton:V,onPropertyClick:j,titleColumnIndex:T,isSubitemToggleOnTitleColumn:P,onPropertyTab:I,onPropertyUntab:_,onPropertyEnter:M,onPropertyEsc:B,onPropertyBgClick:F,onPropertyContextMenu:K,collectionViewStore:L,collectionStore:O,blockPropertyValueOverlayStore:D,shouldSetCellHeight:E,onOpenProperty:A,disableHorizontalEdgeScroll:H,handleOpenPeekPage:Z,groupFormat:z,rowIndex:W,isCollectionViewBlockSelected:G,passesFilter:N,isScrolled:U,shouldShowMultiSelectCheckbox:Y,isInHomeWidget:Q,normalizedTableSelection:X}=e,{property:J,wrap:ee}=t,te=(0,s().O7)(),oe=(0,a().VK)((()=>(0,R().vf)({environment:te,propertyFormat:t})),[te,t]),ne=(0,q().Y$)(),re=(null==f?void 0:f.length)??0,ie=b&&(0,R().lO)({columnIndex:r,titleColumnIndex:T,isSubitemToggleOnTitleColumn:P}),le=(0,n.useMemo)((()=>{if(void 0!==oe){if(ie){const e=(0,R().lZ)({columnIndex:r,indentLevel:re,titleColumnIndex:T,isSubitemToggleOnTitleColumn:P});return oe-e}return oe}}),[re,r,P,ie,T,oe]),se=(0,n.useMemo)((()=>ie?(0,m.jsx)(Cd,{subitemFormat:b,toggleButton:V,subitemPath:f,shouldShowMultiSelectCheckbox:Y,propertyIndex:r}):void 0),[ie,b,f,V,Y,r]),ae=(0,n.useCallback)((()=>j(u,J,p)),[j,J,p,u]),ce=g||!i,de=(0,a().VK)((()=>{const e=ne.collectionViewBlockStore();if(!e)return!1;const t=fd().Z.state;if(!t.isActive||!(0,fd().N)(t.selectionKey,{collectionViewBlockStore:e,groupFormat:z})||!X)return!1;const o=X,{start:n,end:i}=o,l=W===n.row||W===i.row||v().Z2(W,n.row,i.row),s=r===n.col||r===i.col||v().Z2(r,n.col,i.col);return l&&s}),[ne,z,r,X,W]),ue=(0,a().VK)((()=>{const e=fd().Z.state,t=ne.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,fd().N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:z})||!X)return!1;const o=X,{start:n}=o;return W===n.row&&r===n.col}),[ne,z,r,X,W]),pe=(0,a().VK)((()=>{const e=ne.frozoneStore.state.frozenIndex;return void 0!==e&&r<=e}),[ne,r]),ge=(0,je().E)("collections_column_virtualization"),Se=(0,o(702466).p)({collectionContextStore:ne,blockId:u.id,property:J,featureEnabled:ge}),he=(0,c().yK)((e=>{const t=Q?e.tableHomeDividerColor:e.tableDividerColor,o=G?e.tableFrozenSelectedDividerColor:t;return{tableCell:{display:"flex",width:oe||void 0,height:Se?void 0:"100%",position:"relative",borderRight:S||d||l&&h?"none":`1px solid ${pe?o:t}`},tableSelectionOverlay:{background:de?Qo().ZP.blueWithAlpha(.07):void 0,borderRadius:ue?3:void 0,boxShadow:ue?e.collectionTableOutlineBlueInputBoxShadow:void 0,position:"absolute",pointerEvents:"none",top:0,height:"100%",zIndex:84,width:"100%",left:0},propertyValueContainer:{display:"flex",overflowX:"clip",height:"100%",width:le||void 0}}}),[Q,G,oe,Se,S,d,l,h,pe,de,ue,le]),fe=(0,m.jsxs)($().Z,{debugName:"TableRow",capture:w,onShiftEnter:y,children:[(0,m.jsx)(Ln().m,{collectionStore:O,store:u,property:J,disabled:ce,locked:k,width:le,format:wt().C.Table,forceMouseEntered:C,tableWrap:Boolean(x||ee),isLast:l,indentLevel:0===r&&f?f.length:void 0,onTab:I,onUntab:_,onEnter:M,onClick:ae,onEsc:B,onBgClick:F,onContextMenu:K,collectionViewStore:L,shouldSetCellHeight:E,onOpenProperty:A,blockPropertyValueOverlayStore:D,disableHorizontalEdgeScroll:H,handleOpenPeekPage:Z,propertyIndex:r,shouldShowMultiSelectCheckbox:Y},J),d&&(0,m.jsx)(Ic,{isCollectionViewBlockSelected:G,passesFilter:N,isScrolled:U})]}),ye=(0,n.useRef)(null);return(0,m.jsxs)("div",{ref:ye,className:me().mWS,"data-row-index":W,"data-col-index":r,style:he.tableCell,children:[se,(0,m.jsx)("div",{style:he.propertyValueContainer,children:fe}),de&&(0,m.jsx)("div",{style:he.tableSelectionOverlay})]})})),kd=n.memo((function(e){const{blockPropertyValueOverlayStore:t,propertyFormats:o,propertyFormatsMap:n,visiblePropertiesLength:r,store:i,tableWrap:l,shouldSetCellHeight:s,indexAddendum:c,frozoneProps:d,normalizedTableSelection:u,canEdit:p,isInHomeWidget:g,...S}=e,h=(0,q().Y$)(),f=(0,a().VK)((()=>h.collectionViewStore()),[h]),y=(0,a().VK)((()=>F().Bm({store:i,collectionContextStore:h})),[i,h]),v=(0,a().VK)((()=>!t.state.isOpen&&oe().default.state.stores.length>0&&oe().default.state.stores[0].id===i.id),[i.id,t]),x=(0,a().Kw)(h.currentSubitemFormatStoreForUiDisplayStore),b=(0,a().VK)((()=>"title"===(null==f?void 0:f.getFormatStore().getKeyStore("table_subitem_toggle_column").getValue())),[f]),C=(0,a().VK)((()=>h.frozoneStore.state.frozenIndex),[h]),w=(0,a().VK)((()=>{if(!p)return;if(g)return;if(h.isInlineViewStore.state&&h.isUnlistedViewStore.state)return;const e=jc().default.state;return Boolean(e.isOpen&&e.currentStore===i)}),[p,h,g,i]),k=r??o.length;return(0,m.jsx)(m.Fragment,{children:o.map(((e,o)=>{const r=(null==n?void 0:n[o])??o+(c??0);return(0,m.jsx)(wd,{index:r,store:i,propertyFormat:e,isLastColumn:r===k-1,isRightMostFrozenColumn:C===r,collectionViewStore:f,collectionStore:y,tableWrap:l,shouldSetCellHeight:s,forceMouseEntered:"title"===e.property?w:void 0,shouldCaptureKeyboard:v,subitemFormat:x,isSubitemToggleOnTitleColumn:b,blockPropertyValueOverlayStore:t,isScrolled:(null==d?void 0:d.isScrolled)??!1,normalizedTableSelection:u,canEdit:p,isInHomeWidget:g,...S},e.property)}))})})),Vd=n.memo((function(e){let{propertyFormats:t,...o}=e;const{propertiesInRange:n,propertiesInRangeIndices:r,beforeWidth:i,afterWidth:l}=(0,lc().MB)();return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{style:{width:`${i}px`}}),(0,m.jsx)(kd,{...o,propertyFormats:n,propertyFormatsMap:r}),(0,m.jsx)("div",{style:{width:`${l}px`}})]})})),jd=n.memo(n.forwardRef((function(e,t){const{disabled:o,store:r,groupFormat:i,collectionContextStore:l,propertyFormats:d,disableTableWrap:u,frozoneProps:p,passesFilter:g,shouldShowMultiSelectCheckbox:S,isLast:h,isInHomeWidget:f,...y}=e,{handleOpenPeekPage:v}=e,x=(0,n.useRef)(null),b=(0,s().O7)(),C=(0,a().VK)((()=>!o&&r.canEdit()),[o,r]),w=(0,a().VK)((()=>(0,X().A7)(i,l)),[i,l]),k=(0,a().VK)((()=>w.findIndex((e=>e===r))),[w,r]),V=(0,a().VK)((()=>{const e=l.collectionViewBlockStore();return!(!e||l.isFullScreenStore.state)&&(0,dc().sY)(e)}),[l]),j=(0,a().VK)((()=>l.isUnlistedViewStore.state&&l.isInlineViewStore.state),[l]),T=(0,a().VK)((()=>{const e=fd().Z.state;if(e.isActive)return(0,R().OG)(e.selection,d.length,w.length)}),[w,d]),P=null==p?void 0:p.frozenIndex,I=void 0!==P,_=(0,a().VK)((()=>{const e=fd().Z.state,t=l.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,fd().N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:i})||!T)return!1;const o=T,{start:n}=o;return void 0!==P&&k===n.row&&n.col<=P}),[i,l,T,P,k]),M=(0,a().VK)((()=>F().bW(P)),[P]),B=(0,n.useMemo)((()=>I?{...null==p?void 0:p.frozenStyles,..._?{zIndex:at().mK}:{zIndex:at().IK},...-1===P?{background:void 0}:{},...f?{left:Nt().f_}:{}}:{}),[I,null==p?void 0:p.frozenStyles,_,P,f]),[K,L]=(0,n.useMemo)((()=>I?[d.slice(0,P+1),d.slice(P+1)]:[[],d]),[P,d,I]),O=(0,a().VK)((()=>{var e;return Boolean(!u&&(null===(e=l.collectionViewStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("table_wrap").getValue()))}),[l,u]),D=(0,a().VK)((()=>{var e;return Boolean("timeline"===(null===(e=l.collectionViewStore())||void 0===e?void 0:e.getType())||!O&&!d.some((e=>e.wrap)))}),[l,d,O]),E=(0,a().VK)((()=>{const e=l.permissionScopesStore.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[l.permissionScopesStore]),A=(0,c().yK)((e=>{const t=f?e.tableHomeDividerColor:e.tableDividerColor;return{tableViewRowStyle:{display:"flex",...h&&f?{}:{borderBottom:`1px solid ${t}`},width:"100%"},checkboxContainer:{position:"absolute",left:-Nt().Xx,...-1!==(null==p?void 0:p.frozenIndex)&&{background:null==p?void 0:p.frozenStyles.background,height:"100%"}}}}),[null==p?void 0:p.frozenIndex,null==p?void 0:p.frozenStyles.background,f,h]),H=(0,a().VK)((()=>{var e;return!f&&"timeline"!==(null===(e=l.collectionViewStore())||void 0===e?void 0:e.getType())}),[l,f]),Z=(0,n.useCallback)((()=>{const{mainEditorCurrentBlockStore:e}=ft().default.state,t=F().mb({environment:b,store:r,mainEditorCurrentBlockStore:e,collectionContextStore:l,fullyQualified:!1,overridePeekMode:j?"center_peek":void 0});t&&(v(),hn().c4({environment:b,url:t}))}),[l,b,v,j,r]),z=(0,je().E)("collections_column_virtualization"),W=(0,lc().vS)(),G=(0,a().VK)((()=>O||d.some((e=>e.wrap))),[d,O]),N=(0,m.jsxs)(n.Fragment,{children:[(0,m.jsx)("div",{className:me().zwY,style:A.tableViewRowStyle,dir:"ltr",ref:x,children:(0,m.jsx)(er().v,{store:r,step:"demo_collection_record",children:(0,m.jsxs)(vd,{collectionContextStore:l,store:r,anyWrapping:G,children:[(0,m.jsx)("div",{style:B,children:(0,m.jsx)(hd,{isCollectionViewBlockSelected:V,passesFilter:Boolean(g),shouldFreeze:-1!==P,children:(0,m.jsxs)(m.Fragment,{children:[S&&(0,m.jsx)(kt().Z,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},config:{timingFunction:"ease-out"},children:(0,m.jsx)("div",{style:A.checkboxContainer,children:(0,m.jsx)(bd,{store:r,passesFilter:Boolean(g),frozoneProps:p,canEdit:C})})}),(0,m.jsx)(kd,{store:r,canEdit:C,propertyFormats:K,visiblePropertiesLength:K.length,shouldSetCellHeight:D,indexAddendum:0,rowIndex:k,disabled:o,groupFormat:i,tableWrap:O,isLocked:E,isCollectionViewBlockSelected:V,passesFilter:Boolean(g),shouldShowMultiSelectCheckbox:S,frozoneProps:p,normalizedTableSelection:T,isInHomeWidget:f,...y})]})})}),z&&W?(0,m.jsx)(Vd,{store:r,canEdit:C,propertyFormats:L,visiblePropertiesLength:L.length,shouldSetCellHeight:D,indexAddendum:M,rowIndex:k,disabled:o,groupFormat:i,tableWrap:O,isLocked:E,isCollectionViewBlockSelected:V,passesFilter:!0,shouldShowMultiSelectCheckbox:S,frozoneProps:p,normalizedTableSelection:T,isInHomeWidget:f,...y}):(0,m.jsx)(kd,{store:r,canEdit:C,propertyFormats:L,visiblePropertiesLength:L.length,shouldSetCellHeight:D,indexAddendum:M,rowIndex:k,disabled:o,groupFormat:i,tableWrap:O,isLocked:E,isCollectionViewBlockSelected:V,passesFilter:!0,shouldShowMultiSelectCheckbox:S,frozoneProps:p,normalizedTableSelection:T,isInHomeWidget:f,...y})]})})}),H?(0,m.jsx)("div",{style:{...A.tableViewRowStyle,display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}}):null]});return(0,Ve().ez)(r,t,(0,n.useMemo)((()=>({renderedType:"table_row",getNode:()=>x.current,getBlockStore:()=>r,activate:Z})),[Z,r]),N)})));var Td=()=>o(435168);const Pd=function(e){const{frozenColumnRepositionStore:t,frozenIndex:o,maxFrozenIndex:r,xForFirstCellInRow:i,showPropertyFormats:l,frozenSectionWidth:d}=e,u=(0,s().O7)(),p=(0,q().DK)(),g=(0,n.useRef)(null),S=(0,n.useRef)(null),[h,f]=n.useState({x:0,y:0,width:0,maxY:0,isEntered:!1,isMouseDown:!1}),[y,x]=n.useState(0),[w,k]=n.useState(0),V=(0,a().VK)((()=>t.state.isRepositioning||h.isMouseDown),[t,h.isMouseDown]),j=(0,a().VK)((()=>t.state.newFrozenIndex),[t]),T=(0,a().VK)((()=>!!p&&(0,F().fk)({environment:u,collectionContextStore:p})),[u,p]),P=(0,a().VK)((()=>null==p?void 0:p.frozoneStore.state.isScrolled),[p]),I=(0,a().VK)((()=>!P&&-1===o&&T?-4:0),[o,P,T]),_=(0,a().VK)((()=>h.isEntered||V),[h.isEntered,V]),M=(0,a().VK)((()=>t.state.newFrozenColumnXPosition),[t]),B=(0,n.useContext)(ce().U),K=null==B?void 0:B.horizontalScroller,L=(0,n.useCallback)((()=>{var e,t,o;if(!K||!g.current)return 0;const n=(null===(e=g.current.getBoundingClientRect())||void 0===e?void 0:e.top)??0,r=null===(t=K.getNode())||void 0===t?void 0:t.getElementsByClassName(me().kUP);return(r&&r.length>0?null===(o=r[0].getBoundingClientRect())||void 0===o?void 0:o.top:0)-n}),[K]),O=(0,n.useCallback)((()=>{var e,t,o,n,r;if(!K||!g.current)return 0;const i=(null===(e=g.current)||void 0===e||null===(e=e.getBoundingClientRect())||void 0===e?void 0:e.bottom)??0,l=null===(t=K.getNode())||void 0===t?void 0:t.getElementsByClassName(me().zwY),s=l&&l.length>0?null===(o=l[l.length-1].getBoundingClientRect())||void 0===o?void 0:o.bottom:0,a=null===(n=K.getNode())||void 0===n?void 0:n.getElementsByClassName(me().Gcz),c=a&&a.length>0?null===(r=a[a.length-1].getBoundingClientRect())||void 0===r?void 0:r.bottom:0;return Math.max(s,c)-i}),[K]),D=(0,a().VK)((()=>{var e;const t=null===(e=g.current)||void 0===e?void 0:e.getBoundingClientRect();return t&&void 0!==d?new DOMRect(t.x+d+h.x+10,t.y+h.y+10,3,3):void 0}),[d,h]),E=(0,a().VK)((()=>{const e=(null==p?void 0:p.frozoneStore.state.scrollerLeftOffset)??0,t=(0,_e().Wk)(u),o=Math.max(t-e,0);return p&&(0,R().iZ)(u,p)?o:0}),[p,u]),A=(0,a().VK)((()=>p&&(0,F().fk)({environment:u,collectionContextStore:p})),[p,u]),H=(0,n.useCallback)((e=>{if(void 0===o||void 0===r||void 0===d||null===g.current||null===S.current)return;const n=g.current.getBoundingClientRect(),s=e.clientX-n.x;if(null==p||p.frozoneStore.setState({...null==p?void 0:p.frozoneStore.state,tryShowHiddenFrozenColumn:s<42}),!_)return;const a=L();x(a);const c=O();k(c);const u=2+d,m=Math.max(s-u,-u),h=e.clientY-n.y-14,y=n.bottom-n.top-14+c,v=V?a:-14,b=Math.max(Math.min(h,y),v);if(f((e=>({...e,x:V?m:0,y:b}))),V){const e=l,n=S.current.getBoundingClientRect();let a=s,c=i,u=-1,p=c,m=Math.abs(c-a);for(let t=0;t<e.length&&!(t>r);t++){const r=e[t];c+=(null==r?void 0:r.width)??0,P&&t===o+1&&(a-=n.x);const i=Math.abs(c-a);i<m&&(m=i,p=c,u=t)}t.setState({...t.state,newFrozenIndex:u,newFrozenColumnXPosition:p-d-1})}}),[o,r,d,null==p?void 0:p.frozoneStore,_,L,O,V,l,i,t,P]);(0,n.useEffect)((()=>{const e=v().P2((e=>{H(e)}),25);return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[H]);const Z=(0,n.useCallback)((e=>{V||(H(e.nativeEvent),f((e=>({...e,isEntered:!0,isMouseDown:!1}))))}),[V,H]),z=(0,n.useCallback)((e=>{V||f((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[V]),W=(0,n.useCallback)((e=>{f((e=>({...e,isMouseDown:!0})))}),[]),G=(0,n.useCallback)((e=>{V&&f((e=>({...e,isEntered:!0})))}),[V]),N=(0,n.useCallback)((e=>{f((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[]),U=(0,n.useCallback)((e=>{V&&f((e=>({...e,x:0,isEntered:!1,isMouseDown:!1})))}),[V]),$=(0,c().yK)((e=>{const t=void 0!==j&&void 0!==o&&j<=o;return{repositionerContainer:{zIndex:at().hc,display:"flex",position:"absolute",width:"100%",height:"100%",cursor:V?"grabbing":"grab",pointerEvents:V?void 0:"none"},repositionerOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)",height:"100%"},repositionerInsideStickyWrapper:{position:"sticky",left:E+(A?Nt().Xx:0),height:"100%"},tooltipContainer:{position:"absolute",left:-1!==d||P?d??0:5,zIndex:at().xP,height:"100%"},tooltipOrigin:{position:"absolute",left:-3,top:0,width:8,pointerEvents:"auto",cursor:V?"grabbing":"grab",height:"100%"},tooltipColumn:{position:"absolute",left:V?h.x-1:-1,top:V?y:0,width:2,height:V?`calc(100% + ${w-y}px`:"100%",background:"dark"===e.mode?e.accentColors.gray[500]:e.accentColors.gray[200]},ghostColumnBase:{position:"absolute",top:V?y:0,width:1,height:V?`calc(100% + ${w-y}px`:"100%",background:e.accentColors.uiBlue[300]},frozenGhostColumn:{left:M,opacity:V&&t?1:0},unfrozenGhostColumn:{left:(d??0)+(M??0),opacity:_&&V&&!t?1:0},tooltipDraggable:{position:"absolute",left:V?h.x-2:-2,top:h.y,width:4,height:28,background:e.accentColors.uiBlue[600],borderRadius:4},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...b().Yu}}}),[j,o,V,E,A,d,P,h.x,h.y,y,w,M,_]);return(0,m.jsx)("div",{className:me().wXs,style:$.repositionerContainer,onMouseEnter:G,onMouseLeave:N,onMouseUp:U,children:(0,m.jsxs)("div",{style:$.repositionerOutsideStickyWrapper,ref:S,children:[(0,m.jsx)("div",{style:$.repositionerInsideStickyWrapper,ref:g,children:(0,m.jsx)(Tt().Z,{renderTooltip:()=>V&&void 0!==j&&j!==o?(0,m.jsx)(C()._H,{id:"tableView.selectionOverlay.repositioner.dynamicTooltip",defaultMessage:"Freeze {numColumns} {numColumns, select, 1 {column} other {columns}}",values:{numColumns:j+1}}):(0,m.jsx)(C()._H,{id:"tableView.selectionOverlay.repositioner.tooltip",defaultMessage:"Drag horizontally to freeze columns"}),delayThreshold:300,forceVisibleState:V||void 0,placement:Me().Placement.Right,originRect:D,render:e=>(0,m.jsxs)(kt().Z,{animate:{translateX:I,opacity:_?1:0},...e,style:$.tooltipContainer,children:[(0,m.jsx)("div",{style:$.tooltipOrigin,onMouseEnter:Z,onMouseLeave:z,onMouseDown:W}),(0,m.jsx)("div",{style:{...$.ghostColumnBase,...$.frozenGhostColumn}}),(0,m.jsx)("div",{style:$.tooltipColumn}),(0,m.jsx)("div",{style:$.tooltipDraggable})]})})}),(0,m.jsx)("div",{style:{...$.ghostColumnBase,...$.unfrozenGhostColumn}})]})})};var Id=()=>o(525038),Rd=()=>o(970105),_d=()=>o(158083),Md=()=>o(475335);let Bd=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e}({});function Fd(e,t){const o=t.permissionScopesStore.state;return!e&&o.canEditContent}function Kd(e,t){let o=e;for(;null!==o;){if(o.classList.contains(t))return o;o=o.parentElement}}function Ld(e,t){return(0,F().fk)({environment:t,collectionContextStore:e})?Nt().Xx:0}function Od(e){let t=e;for(;null!==t&&!t.classList.contains(me().mWS);)t=t.parentElement;if(null===t)return;return{col:parseInt(t.getAttribute("data-col-index")??"0"),row:parseInt(t.getAttribute("data-row-index")??"0")}}function Dd(e,t,o,n){return{col:o.findIndex((e=>e.property===t)),row:n.findIndex((t=>e===t))}}function Ed(e,t){if(!t)return;const o=_s().C.findSelectablesFromStore(e).map((e=>e.getNode())).find((e=>t.contains(e)));return o?o.getBoundingClientRect():void 0}function Ad(e){const t=e.state;return!t.isOpen||0===t.additionalStores.length}function Hd(e,t,o,n,r,i,l){const{selection:s,shouldNormalize:a}=e,c=o.collectionViewBlockStore();if(!c)return;const d=a?(0,R().OG)(s,r.length,i.length):s,u=i[d.start.row];Td().Z5({environment:t,selectionKey:{collectionViewBlockStore:c,groupFormat:n},selection:d,currentRowStore:u}),l.recompute()}function Zd(e,t,o,n,r,i,l,s,a,c,d){if(e.preventDefault(),e.target instanceof Element){if(Kd(e.target,me().wXs))s.setState({isRepositioning:!0,newFrozenIndex:a,newFrozenColumnXPosition:void 0}),function(e,t,o,n,r){var i;if(!t.frozoneStore.state.isScrolled)return;const l=r[0],s=o[0].property,a=od().Z.findBlockPropertyValue(l,s),c=t.frozoneStore.state.scrollerLeftOffset??0,d=(0,_e().Wk)(e),u=Math.max(d-c,0),p=(0,R().iZ)(e,t)?u:0;null==a||null===(i=a.getScrollerContext())||void 0===i||null===(i=i.horizontalScroller)||void 0===i||null===(i=i.getNode())||void 0===i||i.scrollTo({left:n-p})}(t,o,n,r,c),_d().Z.setState({..._d().Z.state,disableHorizontalEdgeScroll:!0,disableVerticalEdgeScroll:!0});else{const t=d;if(t&&Fd(i,o)&&Kd(e.target,me().JR_))return void l.setState({...t})}(0,Cc().w)()}}function zd(e,t,o,n,r,i,l,s){!function(e,t,o){const n=o.state.isRepositioning;if(!n)return;I().createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:e,canUndo:!0,perform:n=>{Td().oz({environment:e,collectionContextStore:t,currentIndex:o.state.newFrozenIndex,transaction:n,entrypoint:"TableSelectionOverlay.FrozenColumnRepositioner"}),o.reset()}})}(e,t,i),function(e,t,o,n,r,i,l){const s=i;if(!s)return;const a=r.state;if(!a)return;const{start:c,end:d}=a;if(c.row!==d.row)return;const{start:u,end:p}=s,[m,g]=[Math.min(u.row,p.row),Math.max(u.row,p.row)],[S,h]=[Math.min(u.col,p.col),Math.max(u.col,p.col)],f=t.slice(S,h+1),y=f.map((e=>{var t;const n=null===(t=o[e.property])||void 0===t?void 0:t.type;return!n||io().Ae.has(n)||"verification"===n?null:{property:e.property,propertyType:n,value:l[u.row].getPropertyValue(e.property)||[]}})).filter((e=>null!==e));if(0===y.length)return;I().createAndCommit({userAction:"TableSelectionOverlay.handleDragAndFill",environment:e,canUndo:!0,perform:e=>{y.forEach((t=>{let{value:o,property:n}=t;$d({transaction:e,value:o,property:n,rows:l.slice(m,g+1)})}))}}),w().qm({environment:e,collectionContextStore:n,property_types:y.map((e=>e.propertyType)),num_rows:g-m,num_cols:y.length}),r.reset()}(e,o,n,t,r,l,s)}function Wd(e,t,o,n,r,i,l,s,a,c,d,u){var p;null===(p=e.preventDefault)||void 0===p||p.call(e),Md().default.setKeyboardMode(!0);const m=l;if(!m)return;const g=n.collectionViewBlockStore();if(!g)return;const S=void 0!==u?u:"shiftKey"in e&&e.shiftKey||!1,h={collectionViewBlockStore:g,groupFormat:r};let f=m;switch(t){case Bd.Left:f=Td().e2({environment:o,selectionKey:h,selection:m,shiftKey:S,columnCount:i.length});break;case Bd.Right:f=Td().FC({environment:o,selectionKey:h,selection:m,shiftKey:S,columnCount:i.length,rowCount:s.length});break;case Bd.Up:f=Td().zJ({environment:o,selectionKey:h,selection:m,shiftKey:S});break;case Bd.Down:f=Td().DI({environment:o,selectionKey:h,selection:m,shiftKey:S,rowCount:s.length})}qd(t,i,f,s,a,c,o,d)}function Gd(e,t,n){const{device:r}=e;if(r.isMobile)return;if(t){const r=n[t.start.row],i=(0,Cn().ZP)({store:r,fullyQualified:!1,pageVisitSource:Go().tY.LinkInPage});o(752127).D({environment:e,url:i})}}function Nd(e,t,o,n,r,i,l,s,a,c,d,u){const p=o.state;if(!p.isOpen)return;const m=Dd(p.store,p.property,n,l),g="tab"===e?{col:Math.min(m.col+1,n.length-1),row:m.row}:{col:Math.max(m.col-1,0),row:m.row};Hd({selection:{start:g,end:g},shouldNormalize:!0},t,r,i,n,l,s),qd("tab"===e?Bd.Right:Bd.Left,n,a,l,c,d,t,u),ko().xv({environment:t,blockPropertyValueOverlayStore:o})}function Ud(e,t,n,r,i,l,s,a,c,d,u){Yd(e,n,r,t,i,l,s,a,c,d,u,(n=>{const{isNewBlock:r,store:i}=n;r&&i.isEmptyTitle()&&i.isEmptyPage()&&I().createAndCommit({userAction:"TableSelectionOverlay.handlePropertyEsc",environment:e,canUndo:!0,perform:n=>{o(663366).y8({environment:e,blocks:[i],transaction:n}),n.postSubmitCallbacks.push((o=>{if(!o){const o=t.collectionStore(),n=t.collectionViewBlockStore();O().dh(e,{analyticsName:"delete",from:"collection_esc_shortcut",block_id:i.id,block_type:"page",collection_id:null==o?void 0:o.id,collection_view_id:null==n?void 0:n.id})}}))}})}))}function $d(e){const{transaction:t,value:o,property:n,rows:r}=e;r.forEach((e=>{Rd().sO({environment:e.environment,store:e.getPropertyStore(n),value:o,transaction:t})}))}function qd(e,t,o,n,r,i,l,s){const a=o;if(!a)return;let c;c=e===Bd.Down?a.start.row>a.end.row?a.start:a.end:e===Bd.Up?a.start.row<a.end.row?a.start:a.end:e===Bd.Right?a.start.col>a.end.row?a.start:a.end:a.start.col<a.end.row?a.start:a.end;const d=n[c.row],u=t[c.col].property,p=od().Z.findBlockPropertyValue(d,u),m=(null==p?void 0:p.getNode())??null;if(m){const e=r??0,t=s||i&&a.start.col<=i&&a.end.col<=i;Wt().bx({element:m,environment:l,vertical:{reveal:"closest",paddingToTopEdge:96,paddingToBottomEdge:48},horizontal:t?void 0:{reveal:"closest",paddingToLeftEdge:e},scrollerContext:null==p?void 0:p.getScrollerContext()})}}function Yd(e,t,o,n,r,i,l,s,a,c,d,u){const{device:p}=e,m=t.state;if(m.isOpen){const{store:g,property:S}=m,h=Dd(g,S,o,i);p.isMobile?(0,Cc().w)():Ad(t)&&Hd({selection:{start:h,end:h},shouldNormalize:!0},e,n,r,o,i,l),qd(Bd.Down,o,s,i,a,c,e,d),ko().xv({environment:e,blockPropertyValueOverlayStore:t}),null==u||u(m)}}class Qd extends d().default{getInitialState(){}}const Xd=Qd;class Jd extends d().default{getInitialState(){return{isRepositioning:!1,newFrozenIndex:void 0,newFrozenColumnXPosition:void 0}}}const eu=Jd,tu=new Set(["rollup","formula","verification"]);function ou(e){var t;const{dragAndFillStore:o,frozenIndex:r,rowsWrapRect:i,schema:l,selection:d,selectionStartRectStore:u,showPropertyFormats:p}=e,g=(0,s().O7)(),S=(0,q().Y$)(),h=(0,a().Kw)(o),f=(0,a().VK)((()=>{const e=(null==h?void 0:h.start)||d.start;return p[e.col]}),[h,d,p]),y=f?null===(t=l[f.property])||void 0===t?void 0:t.type:void 0,v=(0,a().Kw)(u),x=(0,a().VK)((()=>void 0!==r&&d.start.col<=r),[r,d]),w=(0,a().VK)((()=>S.isInHomeWidgetStore.state),[S]),k=(0,a().VK)((()=>(0,F().fk)({environment:g,collectionContextStore:S})),[S,g]),V=(0,c().yK)((e=>{const t=x?at().hc+4:at().IK,o=x?"sticky":void 0;let n=0;w?n=Nt().f_:k&&(n=Nt().Xx);return{dragAndFillContainer:{zIndex:t,display:"flex",position:"relative"},dragAndFillOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)"},dragAndFillInsideStickyWrapper:{position:o,left:n},tooltipContainer:v?{position:"absolute",left:v.left+v.width-6-(k?Nt().Xx:0)}:{},tooltipOrigin:{position:"absolute",left:0,top:v?v.bottom-7:void 0,width:10,height:15,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",left:0,top:v?v.bottom-5:void 0,width:9,height:9,border:`2px solid ${Qo().ZP.blueWithAlpha(.57)}`,transform:h?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:e.contentBackground,borderRadius:"50%",cursor:"ns-resize"},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...b().Yu}}}),[x,w,k,v,h]),j=(0,n.useMemo)((()=>{if(v&&i)return new DOMRect(v.x+i.x+v.width-4,v.y+i.y+v.height-4,7,7)}),[v,i]),T=(0,n.useCallback)((()=>(0,m.jsx)(C()._H,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value"})),[]),P=(0,n.useCallback)((e=>(0,m.jsx)("div",{...e,className:me().JR_,style:V.dragAndFillContainer,children:(0,m.jsx)("div",{style:V.dragAndFillOutsideStickyWrapper,children:(0,m.jsx)("div",{style:V.dragAndFillInsideStickyWrapper,children:(0,m.jsxs)("div",{style:V.tooltipContainer,children:[(0,m.jsx)("div",{style:V.tooltipOrigin}),(0,m.jsx)("div",{style:V.tooltipCircle})]})})})})),[V]);return v?!y||(0,io().ZY)(y)||tu.has(y)?null:(0,m.jsx)(Tt().Z,{renderTooltip:T,delayThreshold:300,forceVisibleState:!!h||void 0,originRect:j,placement:Me().Placement.Right,render:P}):null}const nu=n.memo((function(e){const{groupFormat:t}=e,o=(0,s().O7)(),r=(0,n.useContext)(Jn().Z),i=(0,n.useRef)(null),c=(0,n.useRef)(void 0),d=(0,je().E)("improved_drag_and_fill"),{value:u}=(0,ee().XJ)(Y().p),{value:p}=(0,ee().XJ)(Q().m),{value:g}=(0,ee().XJ)(de().F.formulas),S=(0,a().qz)(void 0,Xd),h=(0,a().qz)(void 0,eu),f=(0,a().SI)((()=>(0,X().A7)(t,e.collectionContextStore)),[t,e.collectionContextStore]),y=(0,a().VK)((()=>(0,F().fk)({environment:o,collectionContextStore:e.collectionContextStore})),[o,e.collectionContextStore]),v=(0,a().VK)((()=>e.collectionContextStore.normalizedSchemaStore.state),[e.collectionContextStore]),x=(0,a().SI)((()=>{const o=e.collectionContextStore.collectionViewBlockStore();if(!o)return;const n=fd().Z.state;if(!n.isActive||!(0,fd().N)(n.selectionKey,{collectionViewBlockStore:o,groupFormat:t}))return;const r=(0,R().OG)(n.selection,e.showPropertyFormats.length,f.state.length);return Td().YY(f.state[r.start.row]),r}),[e.collectionContextStore,e.showPropertyFormats.length,t,f]),b=(0,a().Kw)(x),C=(0,a().VK)((()=>{const e=x.state;return e&&e.start.col===e.end.col&&e.start.row===e.end.row}),[x]),w=(0,a().VK)((()=>{const e=x.state;return e&&e.start.row===e.end.row}),[x]),k=d?w:C,V=(0,a().SI)((()=>{const t=x.state;if(!t)return;if(!i.current)return;const n=t.start,r=e.showPropertyFormats,l=Ed(f.state[n.row],i.current);if(!l)return;const s=i.current.getBoundingClientRect(),a=l.height,c=l.top-s.top-1,d=r[n.col].width||0,u=a+1;let p=Ld(e.collectionContextStore,o);for(let e=0;e<n.col;e++){const t=r[e];t.width&&(p+=t.width)}return new DOMRect(p-1,c,d+1,u)}),[f,o,x,e.collectionContextStore,e.showPropertyFormats]),j=(0,a().SI)((()=>{const t=x.state;if(!t||!w)return;if(!i.current)return;const n=t.end,r=e.showPropertyFormats,l=Ed(f.state[n.row],i.current);if(!l)return;const s=i.current.getBoundingClientRect(),a=l.height,c=l.top-s.top-1,d=r[n.col].width||0,u=a+1;let p=Ld(e.collectionContextStore,o);for(let e=0;e<n.col;e++){const t=r[e];t.width&&(p+=t.width)}return new DOMRect(p-1,c,d+1,u)}),[f,o,w,x,e.collectionContextStore,e.showPropertyFormats]),P=d?j:V,_=(0,a().SI)((()=>e.collectionContextStore.frozoneStore.state.frozenIndex),[e.collectionContextStore]),M=(0,a().VK)((()=>{const t=e.collectionContextStore,o=t.collectionViewStore(),n=t.frozoneStore.state.scrollerWidth;return null==o?void 0:o.getTableMaxFrozenColumnIndex(n,t.normalizedFormatStore.state)}),[e.collectionContextStore]),B=(0,a().SI)((()=>{const t=_.state;if(void 0!==t){let n=Ld(e.collectionContextStore,o);const r=e.showPropertyFormats;for(let e=0;e<=t&&!(e>=r.length);e++){const t=r[e];t.width&&(n+=t.width)}return n-1-(y?Nt().Xx:0)}}),[_,y,e.collectionContextStore,e.showPropertyFormats,o]),K=(0,a().VK)((()=>Ld(e.collectionContextStore,o)-(y?Nt().Xx:0)),[e.collectionContextStore,o,y]),L=(0,a().VK)((()=>{let t=!1;const o=function(e,t){const o=t?[t]:[];return(0,X().A7)(o[0],e)}(e.collectionContextStore,e.groupFormat),n=o.length,r=oe().default.state.stores.filter((e=>o.includes(e))).length;return t=0!==n&&0!==r&&(r===n||"indeterminate"),void 0!==_.state&&!S.state&&!t&&!fd().Z.state.isActive&&void 0===e.tableStore.state.temporaryFormat&&e.collectionContextStore.permissionScopesStore.state.canConfigureBlock}),[S,_,e.collectionContextStore,e.groupFormat,e.tableStore]);(0,n.useEffect)((()=>{i.current&&(c.current=new MutationObserver((()=>{V.recompute()})),c.current.observe(i.current,{attributes:!0,childList:!0,characterData:!0,subtree:!0}));const e=c.current;return()=>{e&&e.disconnect()}}),[V]);const O=(0,n.useCallback)((t=>{Wd(t,Bd.Left,o,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,x.state,f.state,B.state,_.state,e.disableHorizontalEdgeScroll)}),[f,o,_,B,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),D=(0,n.useCallback)((t=>{Wd(t,Bd.Right,o,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,x.state,f.state,B.state,_.state,e.disableHorizontalEdgeScroll)}),[f,o,_,B,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),E=(0,n.useCallback)((t=>{Wd(t,Bd.Up,o,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,x.state,f.state,B.state,_.state,e.disableHorizontalEdgeScroll)}),[f,o,_,B,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),A=(0,n.useCallback)((t=>{Wd(t,Bd.Down,o,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,x.state,f.state,B.state,_.state,e.disableHorizontalEdgeScroll)}),[f,o,_,B,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),H=(0,n.useCallback)((t=>{!function(e,t,o,n,r,i,l,s,a,c){e.preventDefault&&e.preventDefault(),Md().default.setKeyboardMode(!0);const d=s;if(!d)return;const u=a[d.start.row],p=n[d.start.col].property,m=o[p];if(m&&!r)if((0,Vn().AB)(m))ko().bA({environment:t,blockPropertyValueOverlayStore:i,store:u,property:p,format:wt().C.Table,disableHorizontalEdgeScroll:c,collectionContextStore:l}),(0,Cc().w)();else if("checkbox"===m.type){const e=u.getPropertyStore(p),o=lt().Ml(e.getValue()),n=a.slice(d.start.row,d.end.row+1);I().createAndCommit({userAction:"TableSelectionOverlay.handleEnter",environment:t,canUndo:!0,perform:e=>{for(const r of n)Rd().sO({environment:t,store:r.getPropertyStore(p),value:lt()._I(!o),transaction:e})}})}}(t,o,v,e.showPropertyFormats,e.disabled,e.blockPropertyValueOverlayStore,e.collectionContextStore,x.state,f.state,e.disableHorizontalEdgeScroll)}),[f,o,x,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,v]),Z=(0,n.useCallback)((t=>{Wd(t,Bd.Right,o,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,x.state,f.state,B.state,_.state,e.disableHorizontalEdgeScroll,!1)}),[f,o,_,B,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),z=(0,n.useCallback)((t=>{Wd(t,Bd.Left,o,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,x.state,f.state,B.state,_.state,e.disableHorizontalEdgeScroll,!1)}),[f,o,_,B,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),W=(0,n.useCallback)((e=>{!function(e,t,o,n){if(t.device.isMobile)return;e.preventDefault(),Md().default.setKeyboardMode(!0);const r=o;if((0,Cc().w)(),r){const e=(0,R().AV)(r),o=n.slice(e.minRow,e.maxRow+1);T().Z5({environment:t,stores:o})}}(e,o,x.state,f.state)}),[f,o,x]),N=(0,n.useCallback)((()=>{!function(e,t,o,n,r,i){const l=r,s=t.normalizedSchemaStore.state;l&&!o&&I().createAndCommit({userAction:"TableSelectionOverlay.handleDelete",environment:e,canUndo:!0,perform:e=>{Td().NE({selection:l,schema:s,currentPropertyFormats:n,currentRows:i,transaction:e})}})}(o,e.collectionContextStore,e.disabled,e.showPropertyFormats,x.state,f.state)}),[f,o,x,e.collectionContextStore,e.disabled,e.showPropertyFormats]),U=(0,n.useCallback)((t=>{!function(e,t,o,n,r,i,l,s,a){const c=l,d=o.normalizedSchemaStore.state,u=o.collectionViewBlockStore();u&&c&&!n&&I().createAndCommit({userAction:"TableSelectionOverlay.handleCut",environment:t,canUndo:!0,perform:t=>{Td().nA({selectionKey:{collectionViewBlockStore:u,groupFormat:r},schema:d,selection:c,currentPropertyFormats:i,currentRows:s,event:e,transaction:t,formulasModule:a})}})}(t,o,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,x.state,f.state,g)}),[f,o,x,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,g]),q=(0,n.useCallback)((t=>{!function(e,t,o,n,r,i,l){const s=r,a=t.normalizedSchemaStore.state,c=t.collectionViewBlockStore();c&&s&&Td().qn({selectionKey:{collectionViewBlockStore:c,groupFormat:o},schema:a,selection:s,currentPropertyFormats:n,currentRows:i,event:e,formulasModule:l})}(t,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,x.state,f.state,g)}),[f,x,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,g]),J=(0,n.useCallback)((async t=>{const n=await G().F.clipboardActions.load();!function(e,t,o,n,r,i,l,s,a,c,d,u){const p=c,m=o.collectionViewBlockStore();m&&p&&!a&&I().createAndCommit({userAction:"TableSelectionOverlay.handlePaste",environment:t,canUndo:!0,perform:a=>{Td().j0({environment:t,collectionContextStore:o,clipboardActions:u,selectionKey:{collectionViewBlockStore:m,groupFormat:n},selection:p,currentPropertyFormats:i,currentRows:d,event:e,transaction:a,schema:r,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:s})}})}(t,o,e.collectionContextStore,e.groupFormat,v,e.showPropertyFormats,u,p,e.disabled,x.state,f.state,n)}),[f,o,u,x,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,v,p]),te=(0,n.useCallback)((()=>{!function(e,t,o,n,r){const{device:i}=e,l=o;if(i.isMobile||!l)return;const s=n[l.start.row],{mainEditorCurrentBlockStore:a}=ft().default.state,c=(0,F().mb)({environment:e,store:s,mainEditorCurrentBlockStore:a,collectionContextStore:t,fullyQualified:!1});c&&(r?r(c):hn().c4({environment:e,url:c}))}(o,e.collectionContextStore,x.state,f.state,r)}),[f,o,x,r,e.collectionContextStore]),ne=(0,n.useCallback)((()=>{!function(e,t,o,n,r,i,s,a,c,d,u){const{device:p}=e;if(p.isMobile)return;const m=i;if(!m)return;if(!(0,Ge().ww)(e))return;if(!t.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const g=s[m.start.row],S=t.subitemTreeStore.state,h=(0,vo().DY)(S.children,(e=>e.value.store===g)),f="table_selection_overlay_shift_enter";if(h){const i=h?(0,X().Af)(h.map((e=>e.value.store))):"",c=t.subitemExpandedStore.state.get(i),d=Boolean(null==c?void 0:c.isExpanded),u=[...h].splice(0,h.length-1),p=u?(0,X().Af)(u.map((e=>e.value.store))):"",S=t.subitemExpandedStore.state.get(p),y=Boolean(null==S?void 0:S.isExpanded);if(d||y)I().createAndCommit({userAction:"TableSelectionOverlay.handleNestedItemShiftEnter",environment:e,canUndo:!0,perform:r=>{const i=t.collectionStore();if(!i)return;const l=ut().yk({environment:e,collectionContextStore:t,groupsPointer:o?[o]:[],store:g,before:!1,collectionStore:i,transaction:r,subitemPath:h,subitemInsertDirection:y&&!d?"below":"into",from:f});if(l&&n){const o=()=>{ko().bA({isNewBlock:!0,environment:e,blockPropertyValueOverlayStore:n,store:l,property:"title",format:wt().C.Table,collectionContextStore:t})};t.registerCallbackForItemMounted(l,o)}}});else{const n={col:m.end.col,row:t.currentViewHasSort()?s.length:m.end.row+1};I().createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:e,canUndo:!0,perform:r=>{const i=ut().IW({environment:e,collectionContextStore:t,groupsPointer:o?[o]:[],insertAtIndex:n.row,shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:r,from:{createBlock:f},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(i&&!i.coercionSucceeded){const n=o?[o]:[],r=t.groupsStore.getGroupState(n);Uo().CH({environment:e,store:i.newStore,peekMode:(0,F().kr)(t),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t,pageVisitSource:Go().tY.Create})}}}),l().default.afterNextFlush((()=>{Hd({selection:{start:n,end:n},shouldNormalize:!1},e,t,o,r,s,a)}))}}else{const n={col:m.end.col,row:t.currentViewHasSort()?s.length:m.end.row+1};I().createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:e,canUndo:!0,perform:r=>{const i=ut().IW({environment:e,collectionContextStore:t,groupsPointer:o?[o]:[],insertAtIndex:n.row,shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:r,from:{createBlock:f},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(i&&!i.coercionSucceeded){const n=o?[o]:[],r=t.groupsStore.getGroupState(n);Uo().CH({environment:e,store:i.newStore,peekMode:(0,F().kr)(t),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t,pageVisitSource:Go().tY.Create})}}}),l().default.afterNextFlush((()=>{Hd({selection:{start:n,end:n},shouldNormalize:!1},e,t,o,r,s,a)}))}qd(Bd.Down,r,i,s,c,d,e,u),ko().xv({environment:e,blockPropertyValueOverlayStore:n})}(o,e.collectionContextStore,e.groupFormat,e.blockPropertyValueOverlayStore,e.showPropertyFormats,x.state,f.state,V,B.state,_.state,e.disableHorizontalEdgeScroll)}),[f,o,_,B,x,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,V]),re=(0,n.useCallback)((()=>{Gd(o,x.state,f.state)}),[f,o,x]),ie=(0,n.useCallback)((t=>{!function(e,t,o,n,r,i){const{device:l}=t;if(l.isMobile)return;const s=r;if(!s||s.start.col!==s.end.col||o)return;if(!(0,Ge().ww)(t))return;const{start:a,end:c}=s,[d,u]=[Math.min(a.row,c.row),Math.max(a.row,c.row)],p=n[a.col],{property:m}=p,g=i[a.row].getPropertyValue(m)||[];e.preventDefault(),I().createAndCommit({userAction:"TableSelectionOverlay.handleDuplicate",environment:t,canUndo:!0,perform:e=>{$d({transaction:e,value:g,property:m,rows:i.slice(d,u+1)})}})}(t,o,e.disabled,e.showPropertyFormats,x.state,f.state)}),[f,o,x,e.disabled,e.showPropertyFormats]),le=(0,n.useCallback)((t=>{!function(e,t,o,n,r,i,l,s,a,c){if(!e.key||e.metaKey||e.ctrlKey)return;e.preventDefault(),Md().default.setKeyboardMode(!0);const d=s;if(!d)return;const u=a[d.start.row],p=n[d.start.col].property,m=o[p];m&&!r&&io().ub.includes(m.type)&&e.key&&1===e.key.length&&(ko().bA({environment:t,blockPropertyValueOverlayStore:i,store:u,property:p,format:wt().C.Table,disableHorizontalEdgeScroll:c,insertChar:e.key,collectionContextStore:l}),(0,Cc().w)())}(t,o,v,e.showPropertyFormats,e.disabled,e.blockPropertyValueOverlayStore,e.collectionContextStore,x.state,f.state,e.disableHorizontalEdgeScroll)}),[f,o,x,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,v]),se=(0,n.useCallback)((e=>{!function(e,t,o,n){e.preventDefault&&e.preventDefault(),Md().default.setKeyboardMode(!0);const r=o;if((0,Cc().w)(),r){const e=(0,R().AV)(r),o=n.slice(e.minRow,e.maxRow+1);if(0===o.length)return;T().Z5({environment:t,stores:o});const i=_s().C.getRectFromStore(o[0]);Id().bA({environment:t,blocks:o,originRect:i,moveToContext:"action_menu"})}}(e,o,x.state,f.state)}),[f,o,x]),ae=(0,n.useCallback)((t=>{Zd(t,o,e.collectionContextStore,e.showPropertyFormats,e.paddingLeft,e.disabled,S,h,_.state,f.state,x.state)}),[f,S,o,h,_,x,e]),ce=(0,n.useCallback)((t=>{!function(e,t,o,n,r,i,l,s,a,c){if(!(e.target instanceof Element))return;if(l.state.isRepositioning);else if((0,xe().X9)()){const l=Od(e.target);if(!l)return;const d=i.state,u=(null==d?void 0:d.start)??(null==s?void 0:s.start)??l;if(!u)return;Hd({selection:{start:u,end:l},shouldNormalize:!0},t,o,n,r,a,c)}}(t,o,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,S,h,x.state,f.state,V)}),[f,S,o,h,x,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,V]),ue=(0,n.useCallback)((()=>{zd(o,e.collectionContextStore,e.showPropertyFormats,v,S,h,x.state,f.state)}),[f,S,o,h,x,e.collectionContextStore,e.showPropertyFormats,v]),pe=(0,n.useCallback)((()=>{!function(e,t){e.reset(),t.reset(),(0,Cc().w)()}(S,h)}),[S,h]);return(0,m.jsx)($().Z,{debugName:"TableSelectionOverlay",capture:void 0!==b,onLeft:O,onRight:D,onUp:E,onDown:A,onEnter:H,onTab:Z,onUntab:z,onEsc:W,onDelete:N,onBackspace:N,onCut:U,onCopy:q,onPaste:J,onCommandEnter:te,onShiftEnter:ne,onCommandShiftEnter:re,onDuplicate:ie,onKeypress:le,onMoveTo:se,children:(0,m.jsx)(qs().Z,{disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,onDraggableDragStart:ae,onDraggableDragMove:ce,onDraggableDragEnd:ue,onDraggableDragCancel:pe,render:t=>{var o;return(0,m.jsxs)("div",{ref:i,style:{position:"relative",minWidth:e.minWidth,isolation:"auto"},...t,children:[Fd(Boolean(e.disableHorizontalEdgeScroll),e.collectionContextStore)&&b&&(k||S.state)?(0,m.jsx)(ou,{dragAndFillStore:S,frozenIndex:_.state,rowsWrapRect:null===(o=i.current)||void 0===o?void 0:o.getBoundingClientRect(),schema:v,selection:b,selectionStartRectStore:P,showPropertyFormats:e.showPropertyFormats}):null,L&&(0,m.jsx)(Pd,{frozenColumnRepositionStore:h,xForFirstCellInRow:K,maxFrozenIndex:M,showPropertyFormats:e.showPropertyFormats,frozenIndex:_.state,frozenSectionWidth:B.state}),(0,m.jsx)(ru,{...e,allRowsStore:f,selectionStartRectStore:V,normalizedTableSelectionStore:x,frozenSectionWidthStore:B,frozenIndexStore:_})]})}})})}),ao().Z),ru=n.memo((function(e){const t=(0,s().O7)(),o=(0,n.useMemo)((()=>({onPropertyTab:()=>{Nd("tab",t,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state)},onPropertyUntab:()=>{Nd("untab",t,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state)},onPropertyEnter:()=>{!function(e,t,o,n,r,i,s,a,c,d,u){const p=t.state;if(!p.isOpen)return;const{store:m,property:g}=p;if(e.device.isMobile){const t=n.normalizedSchemaStore.state[g],o=ne().default.state;return void("text"===(null==t?void 0:t.type)&&"editing"===o.mode&&I().createAndCommit({userAction:"TableSelectionOverlay.mobileEnter",environment:e,canUndo:!0,perform:t=>{Rd().hJ({environment:e,editorMode:"default",multiSelection:o.multiSelection,string:"\n",disableMentions:!0,disableEmojiCommands:!0,disableSlashCommands:!0,transaction:t})}}))}const S=Dd(m,g,o,i),h={col:S.col,row:S.row+1};l().default.afterNextFlush((()=>{Ad(t)&&Hd({selection:{start:h,end:h},shouldNormalize:!0},e,n,r,o,i,s)})),qd(Bd.Down,o,a,i,c,d,e,u),ko().xv({environment:e,blockPropertyValueOverlayStore:t})}(t,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state)},onPropertyClick:(o,n,r)=>{!function(e,t,o,n,r,i,l,s,a){var c;const{device:d}=n;if("checkbox"!==(null===(c=o[t])||void 0===c?void 0:c.type)||d.isMobile)(0,Cc().w)();else{const o=Dd(e,t,r,s);Hd({selection:{start:o,end:o},shouldNormalize:!0},n,i,l,r,s,a)}}(o,n,r,t,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore)},onPropertyEsc:()=>{Ud(t,e.collectionContextStore,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state,e.disableHorizontalEdgeScroll)},onPropertyBgClick:()=>{!function(e,t,o,n,r,i,l,s,a,c,d){Yd(e,t,o,n,r,i,l,s,a,c,d)}(t,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state,e.disableHorizontalEdgeScroll)},onPropertyContextMenu:o=>{!function(e,t,o,n,r){if(e.preventDefault(),!(e.target instanceof Element))return;const i=r,l=Od(e.target);let s=!1;if(i&&l){const r=Math.min(i.start.row,i.end.row),a=Math.max(i.start.row,i.end.row);if(l.row>=r&&l.row<=a){const i=n.slice(r,a+1);i.length>0&&(T().Z5({environment:t,stores:i}),T().Ys({environment:t,store:i[0]}),Mn().Qn({environment:t,stores:oe().default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:"block_in_collection",showInput:!0,analyticsFrom:"content_block_menu",optionalAnalyticsProperties:{collectionContextStore:o}}),s=!0)}}if(!s&&l){const r=n[l.row];r&&(T().Ys({environment:t,store:r}),Mn().Qn({environment:t,stores:oe().default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:"block_in_collection",showInput:!0,analyticsFrom:"content_block_menu",optionalAnalyticsProperties:{collectionContextStore:o}}))}}(o,t,e.collectionContextStore,e.allRowsStore.state,e.normalizedTableSelectionStore.state)},onOpenProperty:o=>{!function(e,t,o,n,r){const i=t.state;if(i.isOpen){const{store:l}=i;ko().bA({environment:r,blockPropertyValueOverlayStore:t,store:l,property:e,format:wt().C.Table,disableHorizontalEdgeScroll:o,collectionContextStore:n})}}(o,e.blockPropertyValueOverlayStore,Boolean(e.disableHorizontalEdgeScroll),e.collectionContextStore,t)},onSelectableEnter:o=>{!function(e,t,o,n,r,i,l){const s=e.blocks.map((e=>i.indexOf(e))),a=v().VV(s)||0,c=v().Fp(s)||0;a>=0&&c>=0&&Hd({selection:{start:{col:0,row:a},end:{col:0,row:c}},shouldNormalize:!0},t,o,n,r,i,l)}(o,t,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,e.allRowsStore.state,e.selectionStartRectStore)}})),[t,e.allRowsStore,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.frozenIndexStore,e.frozenSectionWidthStore,e.groupFormat,e.normalizedTableSelectionStore,e.selectionStartRectStore,e.showPropertyFormats]);return(0,m.jsx)(m.Fragment,{children:e.render(o)})}),ao().Z);function iu(e){const{isFullScreen:t,hasGroups:o,propertyWidths:n,hasPartialResults:r,hasSearchQuery:i,frozoneProps:l}=e,d=(0,s().O7)(),u=(0,c().Fg)(),p=(0,s().Fy)().isPhone,g=(0,q().DK)(),S=(0,qn().Z)(!0,0,100),h=(0,a().VK)((()=>Boolean(null==g?void 0:g.normalizedFormatStore.state.hide_table_vertical_lines)),[g]),f=l.isScrolled,y=l.frozenIndex,v=void 0!==y,x=(0,a().VK)((()=>{if(!g)return!1;const e=g.collectionViewBlockStore();return!!e&&(0,dc().sY)(e)}),[g]),b=(0,a().VK)((()=>g?(0,R().oc)({environment:d,collectionContextStore:g,isPhone:p,theme:u}):{}),[g,d,p,u]),C=(0,a().VK)((()=>Boolean(null==g?void 0:g.isInHomeWidgetStore.state)),[null==g?void 0:g.isInHomeWidgetStore]),w=(0,c().yK)((e=>{let t="0x 16px";return v?t=void 0:C&&(t=0),{container:{display:"flex",flexDirection:"row",alignItems:"flex-start"},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},frozenColumnsContainer:{display:"flex",flexDirection:"row",...b,...-1===y?{background:void 0}:{}},multiselectCheckbox:{display:"flex",flexDirection:"row",pointerEvents:"none",cursor:"pointer",...b},rowContainer:{display:"flex",alignItems:"flex-start",padding:t,borderBottom:`1px solid ${e.tableDividerColor}`,width:"100%"},rowShimmer:{height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor,marginLeft:v?0:8},column:{display:"flex",height:32,padding:"0px 8px",alignItems:"center",borderRight:h?void 0:`1px solid ${e.tableDividerColor}`}}}),[v,C,b,y,h]);if(!S||!g)return null;const k=n.map(((e,t)=>(0,m.jsx)("div",{style:{...w.column,width:e},children:(0,m.jsx)(ir().Z,{style:{...w.rowShimmer,width:.6*(e-16)}})},t)));let V=null,j=[];if(v&&void 0!==y){const e=k.slice(0,y+1);V=(0,m.jsxs)("div",{style:w.frozenColumnsContainer,children:[(0,m.jsx)(hd,{isCollectionViewBlockSelected:x,passesFilter:!0,shouldFreeze:-1!==y,children:e}),e.length>0?(0,m.jsx)(Ic,{isCollectionViewBlockSelected:x,passesFilter:!0,isShimmerRow:!0,isScrolled:f}):null]}),j=k.slice(y+1,k.length)}else j=k;let T=1;o||r||i||(T=t?10:3);const P=[...Array(T)].map(((e,t)=>(0,m.jsxs)("div",{style:w.rowContainer,children:[V,j]},t)));return(0,m.jsx)("div",{style:w.container,children:(0,m.jsx)("div",{style:w.rowsContainer,children:P})})}const lu=n.memo((function(e){const{groupFormat:t,store:r,format:i,schema:l,query:d,collectionContextStore:u,showHoverActionsStore:p,isFullScreen:g,isInPeekRenderer:S,disabled:h,blockPropertyValueOverlayStore:f,minWidth:y,paddingBottom:v,paddingLeft:x,paddingRight:b,tableStore:w}=e,k=(0,s().O7)(),V=(0,C().YB)(),j=(0,c().Fg)(),T=(0,s().Fy)(),P=(0,n.useContext)(Jn().Z),_=(0,a().VK)((()=>{const e=t?[t]:[];return u.groupsStore.getGroupState(e)}),[t,u]),M=(0,a().VK)((()=>{const e=(0,R().ZH)(i,w).filter((e=>e.visible));return T.isMobile?e.slice(0,20):e}),[T.isMobile,i,w],{useDeepEqual:!0}),B=(0,a().VK)((()=>null==_?void 0:_.reducerResultStore.state),[_]),K=(0,a().VK)((()=>void 0!==B),[B]),L=(0,a().Kw)(u.permissionScopesStore),D=(0,Ve().PE)(e.store,e.disabled),E=(0,a().VK)((()=>!!D&&(!L.isSyncedCollection&&L.canEditContent)),[D,L]),A=(0,a().VK)((()=>"collectionTypedView"===u.contextType),[u]),H=(0,a().Kw)(u.isInHomeWidgetStore),Z=(0,a().Kw)(u.isUnlistedViewStore),z=(0,a().VK)((()=>F().Il({collectionContextStore:u,environment:k,intl:V})),[u,k,V]),W=(0,a().VK)((()=>Boolean(!H&&K&&(E||A)&&u.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))),[E,u,K,A,H]),G=(0,ae().Dq)(),N=(0,a().VK)((()=>!(Z||null!=G&&G.hideTableAggregationRow)),[Z,G]),U=(0,a().VK)((()=>M.reduce(((e,t)=>e+(t.width||0)),0)+(L.canEditContent?32:0)),[M,L]),$=(0,a().VK)((()=>M.map((e=>e.width||ac().Nx))),[M]),q=(0,a().VK)((()=>M.findIndex((e=>"title"===e.property))),[M]),Y=(0,a().VK)((()=>{const e=t?[t]:[],o=(0,X().A7)(e[0],u);return oe().default.state.stores.filter((e=>o.includes(e))).length>0}),[t,u]),Q=(0,a().VK)((()=>{const{device:e}=k,{isScrolled:t,frozenIndex:o,tryShowHiddenFrozenColumn:n}=u.frozoneStore.state;if(void 0===o)return{isScrolled:!1,frozenIndex:void 0,frozenStyles:{},shouldFreezeMultiSelectColumn:!1,shouldShowStickyMultiSelectColumn:!1,isCollectionViewBlockSelected:!1};const r={...(0,R().oc)({environment:k,collectionContextStore:u,isPhone:e.isPhone,theme:j}),display:"flex",...t&&-1===o&&{height:"calc(100% - 1px)",borderBottom:`1px solid ${j.tableDividerColor}`}},i=Boolean(t&&-1===o),l=Boolean(i&&(n||Y)),s=u.collectionViewBlockStore(),a=!!s&&(0,dc().sY)(s);return{isScrolled:Boolean(t),frozenIndex:o,frozenStyles:r,shouldFreezeMultiSelectColumn:i,shouldShowStickyMultiSelectColumn:l,isCollectionViewBlockSelected:a}}),[Y,u,k,j],{useDeepEqual:!0}),J=(0,a().VK)((()=>F().VM({collectionContextStore:u,reducerResult:B,isFullScreen:g})),[u,g,B]),ee=(0,n.useMemo)((()=>t?[t]:[]),[t]),te=(0,n.useMemo)((()=>void 0!==B&&B.blockIds.length>0),[B]),ne=(0,a().VK)((()=>""!==u.searchQueryStore.state),[u]),re=(0,a().VK)((()=>(0,Wo().H0)({collectionContextStore:u,groupsPointer:ee,hasPartialResults:te})),[u,ee,te]),ie=(null==B?void 0:B.blockIds.length)||0,le=K&&!re&&0===ie,se=Boolean(t),ce=(0,a().VK)((()=>{const e=Boolean(u.currentCombinatorFilterStore.state||u.currentPropertyFiltersStore.state.length>0);return K&&!re&&!(g&&ie>0)&&ie<2&&W&&!e&&!se&&"on"===Le().default.getEligibleGroup({experimentId:"packaging_db_empty_states"})}),[K,re,g,ie,W,u,se]),de=(0,a().VK)((()=>u.viewIsFlushToTopbar()),[u]),ue=(0,a().VK)((()=>Boolean(u.normalizedFormatStore.state.hide_table_vertical_lines)),[u]),Se=(0,a().VK)((()=>{const e=u.collectionViewStore();return E&&T.isMobile&&!(null!=e&&e.isSyncedCollection())}),[E,u,T.isMobile]),he=(0,a().VK)((()=>(0,Wo().$t)({collectionContextStore:u,groupsPointer:ee})),[u,ee]),fe=(0,a().VK)((()=>(0,R().zp)(i,w)),[i,w]),ve=(0,a().VK)((()=>(0,pe().qG)(r.id)),[r]),xe=(0,a().Kw)(u.defaultPageTemplateStore),[be,Ce]=n.useState(!1),we=(0,n.useCallback)((()=>{if(!_)return;const e=u.collectionStore();if(!e||!u.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=oe().default.state.stores[0];if(!t)return;const o=u.subitemTreeStore.state,n=(0,vo().DY)(o.children,(e=>e.value.store===t));if(!n)return;const r=n?(0,X().Af)(n.map((e=>e.value.store))):"",i=u.subitemExpandedStore.state.get(r);Boolean(null==i?void 0:i.isExpanded)&&I().createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:k,canUndo:!0,perform:o=>{const r=ut().yk({environment:k,collectionContextStore:u,groupsPointer:_.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:n,subitemInsertDirection:"into",from:"table_group_results_shift_enter"});if(r&&f){const e=()=>{ko().bA({isNewBlock:!0,environment:k,blockPropertyValueOverlayStore:f,store:r,property:"title",format:wt().C.Table,collectionContextStore:u})};u.registerCallbackForItemMounted(r,e)}}})}),[f,u,k,_]),ke=(0,n.useCallback)((e=>{const n=new(o(188517).sA)(k,"handleAddRowClick"),r=t?[t]:[],i=u.groupsStore.getGroupState(r);if(!(0,Ge().ww)(k)||!i)return n.fail("invalid_state"),void(0,Ge().eD)(k);u.searchQueryStore.state&&(0,qo().U)({searchQuery:"",collectionContextStore:u,isFullScreen:g}),I().createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:k,canUndo:!0,perform:e=>{const o=ut().IW({environment:k,collectionContextStore:u,groupsPointer:t?[t]:[],shouldCoerce:!0,templateStore:xe,transaction:e,from:{createBlock:"table_group_results"},tracker:n,inMemoryRecordCache:k.defaultRecordCache.inMemoryRecordCache});if(!o)return;const l=o.newStore;if(T.isMobile){const e=(0,Cn().ZP)({store:l,fullyQualified:!1,pageVisitSource:Go().tY.Create});P?P(e):hn().c4({environment:k,url:e})}else{if(o.coercionSucceeded){const t=()=>{ko().bA({isNewBlock:!0,environment:k,blockPropertyValueOverlayStore:f,store:l,property:"title",format:wt().C.Table,collectionContextStore:u})};u.registerCallbackForItemMounted(l,t),e.postSubmitCallbacks.push((async e=>{if(!e)return u.virtualizedModule.waitToScrollToBlock(r,l)}))}else Uo().CH({environment:k,store:l,peekMode:F().kr(u),resultsStore:i.resultsStore,collectionContextStore:u,pageVisitSource:Go().tY.Create});const t=u.currentSubitemFormatStoreForCollectionStore.state;Co().W(k,{from:t?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",new_page_id:l.id,creating_block_id:l.id,...(0,ge().Pn)(u)})}}})}),[f,u,T.isMobile,k,t,g,P,xe]),je=(0,n.useCallback)((e=>{const o=u.groupsStore.getGroupState(t);if(!o)return;const n=o.reducerResultStore.state;(0,ye().Wi)(e),n&&ut().ID({collectionContextStore:u,environment:k,incrementLimitArgs:{isFullScreen:g,currentResultCount:n.blockIds.length,groupsPointer:o.groupsPointer,incrementLimitsInRelatedGroups:!1}}),O().uD(k)}),[u,k,t,g]),Te=(0,F().jw)(u,j),Pe=(0,a().VK)((()=>{var e,t;const o=null===(e=u.collectionStore())||void 0===e?void 0:e.id;return(f.state.isOpen&&(null===(t=f.state.collectionContextStore)||void 0===t||null===(t=t.collectionStore())||void 0===t?void 0:t.id))===o}),[f,u]),Ie=(0,c().yK)((e=>{const{button:t,buttonInner:o,icon:n}=(0,R().UD)({theme:e,isMobile:T.isMobile,hideTextWithTransition:ce&&be,hideTextWithoutTransition:ce&&Pe});return{iconStyle:n,viewAllButton:{borderTop:`1px solid ${e.tableDividerColor}`,paddingTop:6,paddingBottom:6},loadMoreButton:{...t,borderBottom:`1px solid ${e.tableDividerColor}`,whiteSpace:"break-spaces"},loadMoreButtonHovered:{...he?{background:e.whiteButtonBackground}:{}},loadMoreButtonInner:o,text:{color:e.lightTextColor,flexGrow:1},addRowButton:{...t,background:(null==Te?void 0:Te.background)||(S?e.cardContentBackground:e.contentBackground)},addRowButtonInner:o,linkExistingButton:{marginLeft:12,paddingLeft:6,paddingRight:6,borderRadius:6},linkExistingButtonInner:{display:"flex",alignItems:"center",fontSize:14,height:26},linkExistingIcon:{width:14,height:14,marginLeft:1,marginRight:5,fill:e.lightIconColor},aggregationRow:{...(!K||H)&&{opacity:0,pointerEvents:"none",left:0,right:0}}}}),[T.isMobile,he,Te,S,K,H,Pe,ce,be]),Re=(0,a().VK)((()=>u.isUnlistedViewStore.state&&u.isInlineViewStore.state),[u]),_e=(0,n.useCallback)((e=>(0,m.jsx)(su,{args:e,store:r,collectionContextStore:u,collectionViewFormat:fe,blockPropertyValueOverlayStore:f,groupFormat:t,propertyFormats:M,schema:l,canDrag:Se,disabled:h,titleColumnIndex:q,onShiftEnter:we,frozoneProps:Q,isInHomeWidget:H,isFullScreen:g})),[r,u,fe,f,t,M,l,Se,h,q,we,Q,H,g]);return _?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(gd,{store:r,format:fe,groupFormat:t,schema:l,query:d,collectionContextStore:u,isInPeekRenderer:S,minWidth:y,paddingBottom:v,paddingLeft:x,paddingRight:b,blockPropertyValueOverlayStore:f,resultStore:_.reducerResultStore,showPropertyFormats:M,showRightActions:L.canConfigureCollection&&L.canConfigureBlock&&!Re&&!ve,showHoverActionsStore:p,allowHidingTitle:!1,tableStore:w,formatKey:"table_properties",disabled:h||!L.canConfigureBlock,disableTopBorder:!de||se,disableCellRightBorder:!de||se||ue,height:Nt().aF,frozoneProps:Q,isInHomeWidget:H,hasMoreReducerResults:!(null==B||!B.hasMore)}),(0,m.jsx)(nu,{store:r,collectionContextStore:u,minWidth:y,blockPropertyValueOverlayStore:f,showPropertyFormats:M,disabled:!E,groupFormat:t,tableStore:w,paddingLeft:x,render:_e}),re&&(0,m.jsx)(iu,{isFullScreen:g,hasGroups:void 0!==t,propertyWidths:$,hasPartialResults:te,hasSearchQuery:ne,frozoneProps:Q}),le&&!ce&&(0,m.jsx)(bc,{collectionContextStore:u,shouldShowAddRowButton:W,handleAddRowClick:ke}),ce&&(0,m.jsx)(xc,{collectionContextStore:u,handleAddRowClick:ke,numberOfBlankRows:2-ie,hideDefaultButtonText:be,isBlockPropertyValueOverlayOpen:Pe}),(0,m.jsx)("div",{style:{width:U}}),J&&(H?(0,m.jsx)(co().ZP,{groupsPointer:ee,store:r,collectionContextStore:u,format:i,isFullScreen:g,incrementLimitsInRelatedGroups:!1,style:Ie.viewAllButton}):(0,m.jsx)(Vt().Z,{onMouseDown:ye().$0,onClick:je,disabled:he,hoveredStyle:Ie.loadMoreButtonHovered,style:Ie.loadMoreButton,children:(0,m.jsxs)("span",{style:Ie.loadMoreButtonInner,children:[(0,yo().M)(Ie.iconStyle),(0,m.jsx)("div",{style:Ie.text,children:(0,m.jsx)(C()._H,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),he?(0,m.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,m.jsx)(sn().Z,{size:"sm"})}):E&&(0,m.jsx)(cc().Z,{collectionContextStore:u,format:i})]})})),W&&!ce&&(0,m.jsx)(Vt().Z,{onClick:ke,onMouseDown:ye().$0,style:Ie.addRowButton,className:me().tfM,children:(0,m.jsxs)("span",{style:Ie.addRowButtonInner,children:[(0,lo().R)(Ie.iconStyle),(0,m.jsx)(Jo,{collectionContextStore:u}),z&&(0,m.jsx)(dn().a,{collectionContextStore:u,groupFormat:t,renderLinkButton:e=>(0,m.jsx)(Vt().Z,{style:Ie.linkExistingButton,...e,children:(0,m.jsxs)("span",{style:Ie.linkExistingButtonInner,children:[(0,cn().v)(Ie.linkExistingIcon),(0,m.jsx)(C()._H,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})})]})}),N&&(0,m.jsx)(yc,{groupFormat:t,disabled:h||!L.canConfigureBlock,schema:l,query:d,collectionContextStore:u,isInPeekRenderer:S,isFullScreen:g,showPropertyFormats:M,showRightActionsSpacer:L.canConfigureCollection,style:Ie.aggregationRow,paddingLeft:x,paddingRight:b,onMouseEnter:()=>Ce(!0),onMouseLeave:()=>Ce(!1)})]}):null})),su=n.memo((function(e){const t=(0,s().O7)(),{args:o,store:r,collectionContextStore:i,collectionViewFormat:l,blockPropertyValueOverlayStore:d,groupFormat:u,propertyFormats:p,schema:g,canDrag:S,disabled:h,titleColumnIndex:f,onShiftEnter:y,frozoneProps:v,isInHomeWidget:x,isFullScreen:b}=e,C=(0,n.useMemo)((()=>u?[u]:[]),[u]),w=(0,a().VK)((()=>Boolean(i.normalizedFormatStore.state.hide_table_vertical_lines)),[i.normalizedFormatStore]),k=(0,a().VK)((()=>F().fk({environment:t,collectionContextStore:i})),[i,t]),V=(0,a().VK)((()=>r.isNonEditableState()),[r]),j=(0,c().yK)((e=>({itemSelectableHalo:{borderRadius:3,zIndex:at().iO},itemSelectableStyle:{display:"flex",height:"calc(100% + 2px)"}})),[]),T=(0,n.useCallback)((()=>j.itemSelectableStyle),[j]),P=(0,n.useCallback)((e=>{const{store:o,parentStore:n,subitemPath:r,indentLevel:l}=e;if(n)return(0,m.jsx)(Ua,{store:o,collectionStore:n,subitemPath:r,indentLevel:l,collectionContextStore:i,disabled:h,groupsPointer:C,onSubitemCreate:e=>{if(d){const o=()=>{ko().bA({isNewBlock:!0,environment:t,blockPropertyValueOverlayStore:d,store:e,property:"title",format:wt().C.Table,collectionContextStore:i})};i.registerCallbackForItemMounted(e,o)}}})}),[d,i,h,t,C]),I=(0,n.useMemo)((()=>({schema:g,collectionContextStore:i,propertyFormats:p,onPropertyTab:o.onPropertyTab,onPropertyUntab:o.onPropertyUntab,onPropertyEnter:o.onPropertyEnter,onPropertyClick:o.onPropertyClick,onPropertyEsc:o.onPropertyEsc,onPropertyBgClick:o.onPropertyBgClick,onPropertyContextMenu:o.onPropertyContextMenu,onOpenProperty:o.onOpenProperty,disabled:h,blockPropertyValueOverlayStore:d,disableCellBorderRight:w,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:V,disableTableWrap:!1,onShiftEnter:y,titleColumnIndex:f,groupFormat:u,frozoneProps:v,shouldShowMultiSelectCheckbox:k,isInHomeWidget:x})),[o.onOpenProperty,o.onPropertyBgClick,o.onPropertyClick,o.onPropertyContextMenu,o.onPropertyEnter,o.onPropertyEsc,o.onPropertyTab,o.onPropertyUntab,d,i,h,w,y,p,g,f,u,v,k,V,x]);return(0,m.jsx)(Lo,{collectionContextStore:i,groupsPointer:C,format:l,canDrag:S,resultProps:I,canDrop:!0,resultComponent:jd,disabled:h,direction:Fo.Vertical,getItemSelectableStyle:T,itemSelectableHaloStyle:j.itemSelectableHalo,shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:o.onSelectableEnter,blockPropertyValueOverlayStore:d,titleColumnIndex:f,nestedCreateSubitemButton:P,virtualizeResults:0===C.length&&b})}),ao().Z),au=n.memo((function(e){const{store:t,paddingBottom:o,paddingLeft:r,paddingRight:i,collectionContextStore:l,format:d,schema:u,disabled:p,isFullScreen:g,isRootChild:S,isInPeekRenderer:h,isPreviewing:f,query:y,showHoverActionsStore:v,blockPropertyValueOverlayStore:x,minWidth:b,placementStore:C}=e,w=(0,s().O7)(),k=(0,a().qz)(void 0,ic),V=(0,n.useRef)(null),j=(0,je().E)("collections_column_virtualization"),T=d.collection_group_by,P=g&&!T,I=(0,a().VK)((()=>(0,R().ZH)(d,k)),[d,k]),_=(0,a().VK)((()=>(0,F().az)(l,g)),[l,g]),M=(0,a().VK)((()=>l.isInHomeWidgetStore.state),[l.isInHomeWidgetStore]),B=(0,a().VK)((()=>!!l.viewsModuleContextStore.getViewModuleType()),[l]),K=(0,a().VK)((()=>{const e=l.settingsStore.state.open,t="sidebar"===C.state;return e&&t}),[l.settingsStore,C]),L=n.useCallback((e=>{const t=l.isLoadingStore.state,o=l.groupsStore.getGroupState([]),n=null==o?void 0:o.reducerResultStore.state;e<Ke().Z.incrementScrollOffset&&n&&!t&&n.hasMore&&(l.infiniteScrollLongTaskObserver.observe(),ut().ID({collectionContextStore:l,environment:w,incrementLimitArgs:{isFullScreen:g,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}}))}),[l,w,g]),O=(0,c().yK)((()=>({selectable:{position:"relative",marginRight:K?Gt().P4:void 0},container:{position:"relative",float:"left",minWidth:"100%",WebkitUserSelect:"none",fontVariantNumeric:"lining-nums tabular-nums",paddingBottom:o,paddingLeft:r,paddingRight:i}})),[o,r,i,K]);return(0,Yn().Z)((e=>{const n=(0,m.jsx)(ot().Z,{store:t,shouldShowHalo:!g&&!M,canSelect:!g&&!B,disablePointerEvents:f,analyticsName:"table",style:O.selectable,...e,children:T?(0,m.jsx)(cu,{collectionContextStore:l,store:t,format:d,schema:u,query:y,isFullScreen:g,isRootChild:S,isInPeekRenderer:h,paddingLeft:r,paddingBottom:o,paddingRight:i,minWidth:b,tableStore:k,showHoverActionsStore:v,blockPropertyValueOverlayStore:x,disabled:p}):(0,m.jsx)(uu,{collectionContextStore:l,store:t,format:d,schema:u,query:y,isFullScreen:g,isInPeekRenderer:h,paddingLeft:r,paddingRight:i,paddingBottom:o,minWidth:b,tableStore:k,showHoverActionsStore:v,blockPropertyValueOverlayStore:x,disabled:p,groupFormat:void 0})});return(0,m.jsxs)("div",{className:me()._so,style:O.container,ref:V,children:[T?j?(0,m.jsx)(sc,{collectionContextStore:l,tableProperties:I,paddingLeft:r,paddingRight:i,children:n}):n:(0,m.jsx)(ci().Q,{nodeRef:V,children:j?(0,m.jsx)(sc,{collectionContextStore:l,tableProperties:I,paddingLeft:r,paddingRight:i,children:n}):n}),!_&&!P&&(0,m.jsx)(zo().Z,{onChange:e=>L(e)})]})}))})),cu=n.memo((function(e){let{collectionContextStore:t,store:o,format:r,schema:i,query:l,disabled:a,isFullScreen:d,paddingLeft:u,paddingRight:p,isRootChild:g,isInPeekRenderer:S,showHoverActionsStore:h,blockPropertyValueOverlayStore:f,minWidth:y,paddingBottom:v,tableStore:x}=e;const b=(0,s().O7)(),C=(0,c().yK)((e=>({groupDivider:{borderTop:`1px solid ${e.tableDividerColor}`}})),[]),w=(0,n.useCallback)(((e,t)=>t.isInHomeWidgetStore.state?{}:0!==e.index||t.viewIsFlushToTopbar()?e.index>0&&t.shouldShowSpinnerStore.state?{}:C.groupDivider:{}),[C.groupDivider]),k=(0,n.useCallback)(((e,o)=>{if(b.device.isMobile)No()._c({environment:b,store:e,pageVisitSource:Go().tY.Create});else{const{groupFormat:n}=o,r=n?[n]:[],i=t.groupsStore.getGroupState(r),l="collectionTypedView"===t.contextType;Uo().CH({environment:b,store:e,peekMode:(0,F().kr)(t),showMoveTo:l,resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:Go().tY.Create})}}),[t,b]);return(0,m.jsx)(il,{reducerId:"table_groups",store:o,collectionContextStore:t,disabled:a,isFullScreen:d,isRootChild:g,paddingLeft:u,stickyLeft:!0,renderGroup:e=>(0,m.jsx)(uu,{store:o,format:r,schema:i,query:l,collectionContextStore:t,showHoverActionsStore:h,isFullScreen:d,isInPeekRenderer:S,disabled:a,blockPropertyValueOverlayStore:f,minWidth:y,paddingBottom:v,paddingLeft:u,paddingRight:p,tableStore:x,groupFormat:e}),getGroupStyle:e=>w(e,t),renderHeader:e=>(0,m.jsx)(du,{args:e,isInPeekRenderer:S}),onGroupHeaderAddItem:(e,t,o)=>{k(e,o)}})})),du=n.memo((function(e){let{args:t,isInPeekRenderer:o}=e;const{collectionContextStore:n}=t,r=(0,a().Kw)(n.isInHomeWidgetStore),i=(0,c().yK)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${o?e.cardContentBackground:e.contentBackground}`}})),[o]);return(0,m.jsx)(Jr,{...t,height:r?gt().yZ:Nt().dv,paddingTop:8,toggleClosedMarginBottom:8,stickyStyle:i.stickyStyle})})),uu=n.memo((function(e){let{groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,showHoverActionsStore:s,isFullScreen:c,isInPeekRenderer:d,disabled:u,blockPropertyValueOverlayStore:p,minWidth:g,paddingBottom:S,paddingLeft:h,paddingRight:f,tableStore:y}=e;const v=(0,a().qz)(y,ic);return(0,a().VK)((()=>l.groupsStore.getGroupState(t?[t]:[])),[l,t])?(0,m.jsx)(lu,{tableStore:v,groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,showHoverActionsStore:s,isFullScreen:c,isInPeekRenderer:d,disabled:u,blockPropertyValueOverlayStore:p,minWidth:g,paddingBottom:S,paddingLeft:h,paddingRight:f}):null}));var pu=()=>o(493843),mu=()=>o(645843);class gu extends d().default{constructor(){super("groupsReducerResultStore")}getInitialState(){}}class Su extends d().default{constructor(){super("hiddenGroupsVisibleStore")}getInitialState(){return!1}}class hu extends d().default{getInitialState(){return new Set}}class fu extends(()=>o(442))().Z{constructor(){super(...arguments),this.itemsRefStore=new hu}findCollectionTimelineViewItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}register(e){const t=super.register(e);return this.itemsRefStore.state.has(e)||this.itemsRefStore.setState(new Set(this.itemsRefStore.state).add(e)),t}unregister(e){if(super.unregister(e),this.itemsRefStore.state.has(e)){const t=new Set(this.itemsRefStore.state);t.delete(e),this.itemsRefStore.setState(t)}}getItemsRefStore(){return this.itemsRefStore}}const yu=new fu;(0,o(947115).exposeDebugValue)("GlobalCollectionTimelineViewItemRegistry",yu);var vu=()=>o(992231),xu=()=>o(80122),bu=()=>o(473604);const Cu=15,wu=33,ku=12,Vu={position:"absolute",left:0,top:0,zIndex:at().Gt,width:"100%",height:"100%",pointerEvents:"none"};function ju(e){const{startItemPosition:t,value:o}=e;return t&&o?(o&&t&&o.left<=t.left&&(o.right<t.left?o.left=o.right:(o.left=t.left+ku,o.top=o.top-Cu)),o):o}function Tu(e){const{startItem:t,endItem:o,endRelationPointer:r,timelineState:i,disabled:d,isFullScreen:u,isRootChild:p,relationType:g,isUserDrawnTemp:S,isNewSubitemPlaceholder:h,renderEmitter:f}=e,y=(0,q().Y$)(),v=(0,s().O7)(),x=(0,vu().k)(),[b,C]=(0,n.useState)(!1),w=(0,c().Fg)(),[k,V]=(0,n.useState)(null),[j,T]=(0,n.useState)(null),P=(0,n.useCallback)((e=>{V(e.state)}),[]),I=(0,n.useCallback)((e=>{T(e.state)}),[]),R=(0,n.useCallback)((()=>{l().default.afterNextFlush((()=>{x()}))}),[x]);(0,n.useEffect)((()=>(V(t.stores.nodeStore.state),T(o?o.stores.nodeStore.state:null),t.stores.nodeStore.addListener(P),null==o||o.stores.nodeStore.addListener(I),null==f||f.addListener(R),y.filtersBarOpenStore.addListener(R),()=>{t.stores.nodeStore.removeListener(P),null==o||o.stores.nodeStore.removeListener(I),null==f||f.removeListener(R),y.filtersBarOpenStore.removeListener(R)})),[t,o,f,P,I,R,y.filtersBarOpenStore]);const _=(0,a().VK)((()=>To().default.state.isDragging&&To().default.state.draggedStores.includes(t.props.store)),[t]),M=(0,a().VK)((()=>o&&To().default.state.isDragging&&To().default.state.draggedStores.includes(o.props.store)),[o]),B=(0,a().VK)((()=>{const e=To().default.state;return e.isDragging?e.currentY-e.startY:0}),[]),F=k&&k.getBoundingClientRect().y+(_?B:0),K=(0,a().VK)((()=>{const e=t.itemPositionStore.state;return F&&e?{left:e.left,right:"subitem"===g?e.left+ku:e.right,top:"subitem"===g?F+Cu:F}:void 0}),[g,t.itemPositionStore,F]),L=j&&j.getBoundingClientRect().y+(M?B:0),O=(0,a().VK)((()=>{const e=L&&null!=o&&o.itemPositionStore.state?{...o.itemPositionStore.state,top:L}:void 0;return"subitem"===g?ju({startItemPosition:t.itemPositionStore.state,value:e}):e}),[o,L,g,t.itemPositionStore]),D=(0,a().Kw)(t.dateValueStore),E=(0,a().VK)((()=>null==o?void 0:o.dateValueStore.state),[o]),A=(0,a().VK)((()=>void 0!==i.dragState.state),[i]),H=(0,a().VK)((()=>void 0!==i.drawState.state),[i]),Z=(0,a().Kw)(i.hoveredItem),z=b&&!A&&!H,W=(0,n.useCallback)((()=>{r&&!d&&pu().IL({dependency:{store:t.props.store,relationPointer:r},collectionContextStore:y,environment:v,timelineState:i,isFullScreen:u,isRootChild:p})}),[t,d,r,y,v,i,u,p]),G=(0,n.useCallback)((()=>{C(!0)}),[C]),N=(0,n.useCallback)((()=>{C(!1)}),[C]),U=(0,n.useCallback)((e=>{if(O)return(0,m.jsx)(Pu,{topOffset:e,endPosition:O,handleCloseButtonClick:W})}),[O,W]),$=(0,a().Kw)(y.permissionScopesStore),Y=Z===t.props.store,Q=o&&Z===o.props.store,X=Y||Q||z||"subitem"===g?1:.7;let J;const ee=(0,a().VK)((()=>t.props.store.canEdit()),[t.props.store]),te=(0,a().VK)((()=>"subitem"!==g&&(ee&&("collectionTypedView"===y.contextType||$.canEditContent))),[g,ee,y,$.canEditContent]);"subitem"===g?J=w.collectionUnsetDependencyArrow:D&&E&&(J=D<=E?w.collectionValidDependencyArrow:w.collectionInvalidDependencyArrow);const oe=(0,c().yK)((()=>({svgStyle:{zIndex:"dependency"===g&&(z||Q)?at().Gt:at().wx}})),[g,z,Q]);return K?S?(0,m.jsx)(Iu,{startPosition:K,timelineState:i}):h?(0,m.jsx)(Ru,{startPosition:K,timelineState:i}):t!==o&&O?(0,m.jsx)(_u,{startPosition:K,endPosition:O,strokeOpacity:X,strokeColorOverride:J,svgStyle:oe.svgStyle,cornerRadiusOverride:"subitem"===g?8:void 0,relationType:g,handleMouseMove:G,handleMouseLeave:N,renderChildren:te&&z?U:void 0}):null:null}function Pu(e){const{topOffset:t,endPosition:o,handleCloseButtonClick:n}=e,r=(0,c().yK)((e=>({icon:{background:e.white,borderRadius:5,fill:e.accentColors.red[500],height:14,width:14}})),[]);return(0,m.jsx)(m.Fragment,{children:(0,m.jsx)("foreignObject",{width:16,height:16,x:o.left-16,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:n,children:(0,xu().X)(r.icon)})})}function Iu(e){const{startPosition:t,timelineState:o}=e,n=(0,a().VK)((()=>{const e=o.drawState.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;return{left:t.right+e.xOffsetPx+18,top:t.top+e.yOffsetPx}}),[t,o.drawState]);return n?(0,m.jsx)(_u,{startPosition:t,endPosition:n,strokeOpacity:1,relationType:"dependency"}):null}function Ru(e){var t;const{startPosition:o,timelineState:n}=e,r=(0,c().Fg)(),i=(0,a().Kw)(n.dateRangePlaceholder),l=(0,a().VK)((()=>null!=i&&i.active?i.date:void 0),[i]),s=null!=i&&i.active?null===(t=i.newTimelineItemProps)||void 0===t?void 0:t.subitemPath:void 0,d=s?s[s.length-1].children.length:0,u=o.top+d*wu+Cu+5,p=(0,a().VK)((()=>{const e=(0,Ut().HZ)({timelineState:n,dateValue:l,placeholderDate:l,subitemPlaceholderDate:void 0}),t=u&&e?{...e,top:u}:void 0;return ju({startItemPosition:o,value:t})}),[l,u,o,n]);return p?(0,m.jsx)(_u,{startPosition:o,endPosition:p,strokeOpacity:1,strokeColorOverride:r.collectionUnsetDependencyArrow,relationType:"subitem"}):null}function _u(e){const{startPosition:t,endPosition:o,strokeColorOverride:r,cornerRadiusOverride:i,strokeOpacity:l,relationType:s,svgStyle:d,handleMouseMove:u,handleMouseLeave:p}=e,g=(0,q().Y$)(),S=(0,c().Fg)(),[h,f]=(0,n.useState)(0),y=t.right,v=t.top+Cu-h,x=o.left-3,b=o.top+Cu-h,C=(0,a().VK)((()=>{if(r)return r;return(0,Ut().H5)(g)&&t.right&&o.left?t.right<o.left?S.collectionValidDependencyArrow:S.collectionInvalidDependencyArrow:S.collectionUnsetDependencyArrow}),[g,o.left,t.right,r,S]);return(0,m.jsx)("svg",{style:{...Vu,...d},ref:e=>{e&&f(e.getBoundingClientRect().top)},children:(0,m.jsx)(bu().Z,{startPoint:{x:y,y:v},endPoint:{x,y:b},style:{stroke:C,strokeWidth:Ut().lf,strokeOpacity:l},useRightAngles:"subitem"===s,showArrowHead:"dependency"===s&&!e.renderChildren,cornerRadiusOverride:i,handleMouseMove:u,handleMouseLeave:p,children:e.renderChildren&&e.renderChildren(h)})})}function Mu(e){const{timelineState:t,disabled:o,isReady:r,isFullScreen:i,isRootChild:l,renderEmitter:s}=e,c=(0,q().Y$)(),d=(0,n.useCallback)((()=>{t.drawState.setState(void 0)}),[t.drawState]),u=(0,a().VK)((()=>c.collectionViewBlockStore()),[c]),p=(0,a().VK)((()=>c.settingsStore.state.open),[c]);if((0,n.useEffect)((()=>{var e;!p&&null!==(e=t.drawState.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&d()}),[p,t.drawState,d]),!r||!u)return null;const g=yu.findCollectionTimelineViewItems(u);return(0,m.jsx)(m.Fragment,{children:g.map((e=>{const{store:r,groupFormat:a}=e.props,c=null==a?void 0:a.value,d=c?(0,ro().Hd)(c):"noGroup";return(0,m.jsxs)(n.Fragment,{children:[(0,m.jsx)(Bu,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:s,relationType:"dependency"},`${r.id}-${d}-${r.key}-dependency`),(0,m.jsx)(Bu,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:s,relationType:"subitem"},`${r.id}-${d}-${r.key}-subitem`)]},`${r.id}-${d}-${r.key}`)}))})}function Bu(e){const{startItem:t,timelineState:o,disabled:r,isFullScreen:i,isRootChild:l,relationType:s,renderEmitter:c}=e,{store:d,schema:u}=t.props,p=(0,q().Y$)(),g=(0,a().VK)((()=>"dependency"===s?o.drawState.state:void 0),[o.drawState,s]),S=(0,a().VK)((()=>(null==g?void 0:g.startStore)===d),[d,g]),h=(0,a().VK)((()=>S&&!(null!=g&&g.tryToCompleteDrawnArrow)),[g,S]),f=(0,a().VK)((()=>"dependency"===s?S&&g?g.temporaryDependencyRelationPointers:(0,Ut().YE)(p,d,u):"subitem"===s?(0,Ut().ph)(p,d,u):[]),[s,S,g,p,d,u]),y=(0,a().VK)((()=>p.collectionViewBlockStore()),[p]),v=(0,a().VK)((()=>{var e;const n=o.dateRangePlaceholder.state;if("subitem"!==s||null==n||!n.active||!n.newTimelineItemProps)return;const r=n.newTimelineItemProps.subitemPath;return(r?null===(e=r[r.length-1])||void 0===e?void 0:e.value.store:void 0)===t.props.store?n:void 0}),[s,t.props.store,o.dateRangePlaceholder]),x=(0,a().VK)((()=>[...yu.getItemsRefStore().state]),[]);return y?(0,m.jsxs)(m.Fragment,{children:[f.map((e=>{if(d.id===e.id)return null;const a=x.filter((t=>t.props.store.id===e.id));return(0,m.jsx)(n.Fragment,{children:a.map((n=>{const a=n.props.store,d=n.props.groupFormat;return(0,m.jsx)(Tu,{startItem:t,endItem:n,endRelationPointer:e,timelineState:o,disabled:r,isFullScreen:i,isRootChild:l,renderEmitter:c,relationType:s},`${a.id}-${null==d?void 0:d.value.value}-${a.key}`)}))},e.id)})),"dependency"===s&&h&&(0,m.jsx)(Tu,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"dependency"}),"subitem"===s&&v&&(0,m.jsx)(Tu,{isNewSubitemPlaceholder:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"subitem"})]}):null}const Fu=function(e){let{zoomLevel:t,onChange:o}=e;const n=(0,c().Fg)(),r=(0,s().O7)(),{device:i}=r;return(0,m.jsx)(Dr().ZP,{popupType:i.isMobile?rs().kQ.SlideUp:rs().kQ.Popup,renderOrigin:e=>(0,m.jsxs)(et().D,{size:"sm",isGray:!0,...e,children:[(0,m.jsx)(Ku,{zoomLevel:t}),(0,Ki().i)({width:10,marginLeft:4,fill:n.mediumIconColor})]}),originGap:8,render:e=>(0,m.jsx)(Lu,{parent:e,zoomLevel:t,onChange:o})})};function Ku(e){let{zoomLevel:t}=e;return"hours"===t?(0,m.jsx)(C()._H,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours"}):"day"===t?(0,m.jsx)(C()._H,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day"}):"week"===t?(0,m.jsx)(C()._H,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week"}):"bi_week"===t?(0,m.jsx)(C()._H,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week"}):"month"===t?(0,m.jsx)(C()._H,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month"}):"quarter"===t?(0,m.jsx)(C()._H,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter"}):"year"===t?(0,m.jsx)(C()._H,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year"}):void(0,x().t1)(t)}function Lu(e){let{parent:t,zoomLevel:o,onChange:n}=e;const r=(0,s().O7)(),{device:i}=r,l=[{key:"calendar by section",render:e=>(0,m.jsx)(Cr().Z,{...e}),items:ac().H.map((e=>({key:e,render:t=>(0,m.jsx)(Or().Z,{...t,title:(0,m.jsx)(Ku,{zoomLevel:e})}),action:()=>{n(e),t.close()}})))}];return(0,m.jsx)(tt().Z,{capture:!0,allowEsc:!0,render:e=>{let n;return n=i.isMobile?{menuType:fr().o.Modal,title:(0,m.jsx)(C()._H,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:(0,m.jsx)(br().DoneMenuText,{}),onClickRight:t.close,...e}:{menuType:fr().o.Popup,width:180,...e},(0,m.jsx)(vr().Z,{...n,children:(0,m.jsx)(xr().ZP,{type:xr().iW.Vertical,sections:l,initialFocus:ac().H.indexOf(o)})})}})}const Ou=6,Du=Ut().Zn+Ut().xd;function Eu(e){let{timelineState:t,scrollerLeftOffset:i,paddingLeft:l,showTable:d,isFullScreen:u,isRootChild:p,isReady:g,collectionContextStore:S,isInPeekRenderer:h,format:f,paddingRight:y}=e;const v=(0,c().Fg)(),x=(0,s().O7)(),w=(0,a().VK)((()=>{const e=t.zoomLevel.state,{primaryDisplayUnit:o,secondaryDisplayUnit:n}=Ut().BJ[e],s=t.scrollLeft.state,{startTimestamp:a}=t.currentRange.state;if(void 0!==s){const t=a+(0,Ut().x2)(e,s+i+(!d&&u?l:0));return(0,Ut().DS)(r().ou.fromMillis(t),o).startOf(n).valueOf()}}),[t,i,l,d,u]),k=(0,s().Fy)(),V=(0,a().Kw)(t.zoomLevel),j=(0,a().VK)((()=>t.outerSizeObserver.rect.state.width),[t]),{secondaryDisplayUnit:T}=Ut().BJ[V],P=(0,a().VK)((()=>(0,Ut().d$)({environment:x,isFullScreen:u,isRootChild:p})),[x,u,p]),R=(0,a().Kw)(S.permissionScopesStore),_=!d&&P&&R.canConfigureBlock,M=(0,F().jw)(S,v),B=(null==M?void 0:M.background)||(h?v.cardContentBackground:v.contentBackground),K=h?v.cardContentBackgroundTransparent:v.contentBackgroundTransparent,L=(0,c().yK)((()=>({secondaryDisplayUnit:{position:"absolute",top:1,left:"calc(-1 * var(--sticky-horizontal-offset, 0px))",paddingLeft:u&&!d?i+l:i,display:"flex",alignItems:"center",height:Du,paddingTop:Ou+(k.isMobile?2:0),background:B,fontSize:14,fontWeight:b().Ue.medium},outerContainer:{position:"sticky",left:0,width:j,zIndex:at().Qm,height:0},controlBarRight:{position:"absolute",top:1,right:"var(--sticky-horizontal-offset, 0px)",paddingRight:y,display:"flex",alignItems:"center",height:Du,paddingTop:Ou+1,background:B},hideTableIcon:{paddingLeft:4,paddingRight:4,marginLeft:2,marginRight:4,marginTop:k.isIOS?0:1,height:22,fill:v.lightIconColor}})),[B,k.isIOS,k.isMobile,u,j,l,y,i,d,v.lightIconColor]),O=(0,n.useRef)(null);return(0,m.jsx)(Qr().u,{stickyAttachPoint:"ceiling",nodeRef:O,noPlaceholder:!0,children:(0,m.jsxs)("div",{style:L.outerContainer,ref:O,children:[w&&(0,m.jsxs)("div",{style:L.secondaryDisplayUnit,children:[_&&(0,m.jsx)(Tt().Z,{render:e=>(0,m.jsx)(et().D,{size:"sm",onClick:()=>function(e,t,o,n,r,i){const l=n.collectionViewStore();if(!l)return;I().createAndCommit({userAction:"CollectionTimelineViewControlBar.handleShowTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,Ut().YP)(t,!0);Sn().FH({stores:[l],update:o,transaction:e})}}),(0,mu().CB)(e,{...(0,mu().Ii)({environment:e,collectionContextStore:n,timelineState:o,isFullScreen:r,isRootChild:i}),show:!0})}(x,f,t,S,u,p),style:L.hideTableIcon,...e,children:(0,o(119239).t)({width:14})}),renderTooltip:()=>(0,m.jsx)(C()._H,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}),(0,m.jsx)("span",{style:{paddingLeft:_||k.isPhone?0:u||d?16:2},children:(0,Ut().qG)(w,T)}),!g&&!d&&(0,m.jsx)(Hu,{}),(0,m.jsx)("div",{style:{width:30,marginRight:-30,height:"100%",backgroundImage:`linear-gradient(to right, ${B} 20%, ${K} 100%)`}})]}),(0,m.jsxs)("div",{style:L.controlBarRight,children:[(0,m.jsx)("div",{style:{width:30,marginLeft:-30,height:"100%",backgroundImage:`linear-gradient(to left, ${B} 20%, ${K} 100%)`}}),(0,m.jsx)(Ba,{collectionContextStore:S}),(0,m.jsx)(Fu,{zoomLevel:V,onChange:e=>function(e,t,o,n,r,i){pu().Nf({timelineState:o,environment:t,zoomLevel:e,centerTimestamp:(0,Ut().al)(o)}),(0,mu().zI)(t,(0,mu().Ii)({environment:t,collectionContextStore:n,timelineState:o,isFullScreen:r,isRootChild:i}))}(e,x,t,S,u,p)}),(0,m.jsx)(et().D,{size:"sm",isGray:!0,onClick:()=>function(e,t,o,n,r,i,l){const s=t.zoomLevel.state,a=t.outerSizeObserver.rect.state.width,c=(0,Ut().xI)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(a-c)/2,u=(0,Ut().al)(t),p=u-(0,Ut().x2)(s,d);pu().Nf({timelineState:t,environment:e,zoomLevel:s,centerTimestamp:p}),(0,mu().Al)(e,{...(0,mu().Ii)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"left"})}(x,t,l,f,u,p,S),style:{marginLeft:4,paddingLeft:4,paddingRight:4},children:(0,ya().f)({width:12,fill:v.mediumIconColor})}),(0,m.jsx)(et().D,{size:"sm",onClick:()=>function(e,t,o,n,r,i,l){const s=t.zoomLevel.state,a=(0,Ut().bK)({timestamp:Date.now(),environment:e,timelineState:t,paddingLeft:o,format:n});pu().Nf({timelineState:t,environment:e,zoomLevel:s,centerTimestamp:a}),(0,mu().H6)(e,{...(0,mu().Ii)({environment:e,collectionContextStore:r,timelineState:t,isFullScreen:i,isRootChild:l})})}(x,t,l,f,S,u,p),children:(0,m.jsx)(C()._H,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today"})}),(0,m.jsx)(et().D,{size:"sm",isGray:!0,onClick:()=>function(e,t,o,n,r,i,l){const s=t.zoomLevel.state,a=t.outerSizeObserver.rect.state.width,c=(0,Ut().xI)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(a-c)/2,u=(0,Ut().al)(t),p=u+(0,Ut().x2)(s,d);pu().Nf({timelineState:t,environment:e,zoomLevel:s,centerTimestamp:p}),(0,mu().Al)(e,{...(0,mu().Ii)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"right"})}(x,t,l,f,u,p,S),style:{paddingLeft:4,paddingRight:4},children:(0,va().o)({width:12,fill:v.mediumIconColor})})]})]})})}const Au=n.memo(Eu);function Hu(){return(0,qn().Z)(!0,400,0)?(0,m.jsx)(sn().Z,{style:{marginLeft:8,marginTop:1}}):null}var Zu=()=>o(435308),zu=()=>o(578292);function Wu(e){const{shouldShowShimmer:t,children:o}=e,n=(0,qn().Z)(t,0,100)?"notion-shimmer-timeline-transition notion-shimmer-timeline":"notion-shimmer-timeline-transition";return(0,m.jsx)("div",{className:n,style:{height:"100%"},children:o})}const Gu=4,Nu=22,Uu=110,$u=7,qu=22,Yu=12,Qu=4,Xu=32;function Ju(e){var t;const{collectionContextStore:o,isInPeekRenderer:i,timelineState:l,query:d,schema:u}=e,p=(0,c().Fg)(),g=(0,s().Fy)(),S=(0,C().YB)(),{value:h}=(0,ee().XJ)(de().F.formulas),f=(0,vu().k)(),y=(0,n.useCallback)((()=>{0===(new Date).getSeconds()&&f()}),[f]);(0,n.useEffect)((()=>{const e=setInterval(y,1e3);return()=>clearInterval(e)}),[y]);const{primaryDisplayUnit:x,activeRangeType:b}=(0,a().VK)((()=>{const e=l.zoomLevel.state;return Ut().BJ[e]}),[l]),w=(0,Ut().ST)(x),k=r().ou.now(),V=w?k.startOf("minute"):k.startOf("day"),j=k.startOf("minute"),T=(0,a().VK)((()=>!o.groupsStore.anyGroupHasNonEmptyResults()&&(0,Wo().H0)({collectionContextStore:o,groupsPointer:[],hasPartialResults:!1})),[o]),P=null===(t=(0,F().jw)(o,p))||void 0===t?void 0:t.background,I=(0,a().VK)((()=>o.viewIsFlushToTopbar()),[o]),R=(0,c().yK)((e=>({wrapper:{position:"absolute",left:0,top:0,width:"100%",background:P||(i?e.cardContentBackground:e.contentBackground),boxSizing:"border-box",boxShadow:I?`inset 0 var(--timeline-box-shadow, 1px) 0 0 ${e.tableDividerColor}`:void 0},controlBar:{height:Du,position:"relative",overflow:"hidden"},primaryTimeBar:{height:Xu,boxShadow:`inset 0 -1px 0 0 ${e.tableDividerColor}`,boxSizing:"border-box",position:"relative",overflow:"hidden"},stickyStyle:{outline:void 0,"--timeline-box-shadow":"0px"},transitionStickyStyle:{display:"none"}})),[P,i,I]),_=new(Zu().default)((()=>{const e=o.collectionStore();if(!e)return;const t=l.dragState.state,n=l.zoomLevel.state,r=l.hoveredItem.state,i=l.dateRangePlaceholder.state,{activeRangeType:s}=Ut().BJ[n];if(!s)return;let a;if(t)a=t.temporaryValues.map((e=>(0,Ut().XO)(e,"day")));else if(i.active)a=[(0,Ut().XO)(i.date,"day")];else{const{stores:t}=oe().default.state,n=t.filter((t=>t.getAssociatedCollectionId()===e.id)),i=v().jj(v().oA([...n,r]));a=v().oA(i.map((e=>{const t=(0,Ut().bk)({store:e,query:d,schema:u,userId:o.getCurrentUserId(),intl:S,formulasModule:h});if(t)return(0,Ut().XO)(t,"day")})))}const c=v().F(a,(e=>{let{start:t}=e;return t.valueOf()})),p=v().UT(a,(e=>{let{end:t}=e;return t.valueOf()}));return c&&p?{start:c.start.valueOf(),end:p.end.valueOf()}:void 0}),{debugName:"activeRangeStore"}),M=(0,n.useRef)(null);return(0,m.jsx)(Qr().u,{stickyAttachPoint:"ceiling",nodeRef:M,stickyStyle:R.stickyStyle,transitionStickyStyle:R.transitionStickyStyle,noPlaceholder:!0,children:(0,m.jsxs)("div",{style:R.wrapper,ref:M,children:[(0,m.jsx)("div",{style:R.controlBar,children:!g.isPhone&&(0,m.jsx)(dp,{timelineState:l})}),(0,m.jsxs)("div",{style:R.primaryTimeBar,children:[(0,m.jsx)(Wu,{shouldShowShimmer:T,children:(0,m.jsx)(cp,{timelineState:l,nowTimeStartOfPrimaryDisplayUnit:V})}),"highlight_days"===b&&(0,m.jsx)(pp,{timelineState:l,activeRangeStore:_}),(0,m.jsx)(up,{timelineState:l,time:V}),"display_range"===b&&(0,m.jsx)(pp,{timelineState:l,activeRangeStore:_})]}),(0,m.jsx)(ip,{timelineState:l,time:j})]})})}function ep(e,t,o){const n=o.zoomLevel.state,{startTimestamp:r}=o.currentRange.state,{primaryDisplayUnit:i,primaryDisplayUnitAlignment:l}=Ut().BJ[n],s=(0,Ut().DS)(e,i),a=(0,Ut().Ip)(e,i),c=(0,Ut().e$)(n,s.valueOf()-r),d=(0,Ut().e$)(n,e.valueOf()-r),u=(0,Ut().e$)(n,a.valueOf()-r)-c,p=t?Qu:0;return{left:("range_start"===l?d-u/2:d)-p,width:u+2*p}}function tp(e,t,o,n,r){const i=e.setLocale(fa().locale),l=(0,Ut().xJ)(),s=n?r.regularTextColor:r.lightTextColor,a=n?r.regularTextColor:r.mediumTextColor,c=n?r.mediumTextColor:r.lightTextColor,d=i.toFormat("t").startsWith(i.toFormat("a"));if("fifteen_minutes"===o){if(l)return(0,m.jsx)("span",{style:{color:s},children:i.toFormat("H:mm")});{const e=(0,m.jsx)("span",{style:{color:a,paddingRight:d?void 0:3},children:i.toFormat("h:mm")}),t=(0,m.jsx)("span",{style:{color:c,paddingRight:d?3:void 0},children:i.toFormat("a")});return d?(0,m.jsxs)(m.Fragment,{children:[t,e]}):(0,m.jsxs)(m.Fragment,{children:[e,t]})}}if("hour"===o){if(l)return(0,m.jsx)("span",{style:{color:s},children:i.toFormat("H:mm")});{const e=(0,m.jsx)("span",{style:{color:a,paddingRight:d?void 0:3},children:i.toFormat("h")}),t=(0,m.jsx)("span",{style:{color:c,paddingRight:d?3:void 0},children:i.toFormat("a")});return d?(0,m.jsxs)(m.Fragment,{children:[t,e]}):(0,m.jsxs)(m.Fragment,{children:[e,t]})}}if("day"===o||"week"===o)return"week"===t||"bi_week"===t?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("span",{style:{color:c,paddingRight:3},children:i.toFormat("ccccc")}),(0,m.jsx)("span",{style:{color:a,padding:"2px 7px"},children:i.toFormat("d")})]}):(0,m.jsx)("span",{style:{color:s},children:i.toFormat("d")});(0,x().t1)(o)}function op(e){return{color:e.regularTextColor,fontSize:Yu}}function np(e){return{background:e.timelineRed,width:qu,height:qu,borderRadius:qu/2,position:"absolute",left:`calc(50% - ${qu/2}px)`,top:`calc(50% - ${qu/2}px)`}}function rp(e){let{time:t,accent:o,timelineState:n}=e;const r=(0,c().Fg)(),i=(0,a().Kw)(n.zoomLevel),{primaryDisplayUnit:l}=Ut().BJ[i],{left:s,width:d}=(0,a().VK)((()=>ep(t,!1,n)),[t,n]);return(0,m.jsx)("div",{style:{position:"absolute",top:0,left:s,width:d,height:Xu-4,display:"flex",alignItems:"start",lineHeight:Xu-4+"px"},children:(0,m.jsx)("div",{style:{fontSize:Yu,margin:"0 auto"},children:tp(t,i,l,o,r)})})}function ip(e){let{time:t,timelineState:o}=e;const n=(0,c().Fg)(),r=(0,a().Kw)(o.zoomLevel),{startTimestamp:i}=(0,a().Kw)(o.currentRange),l=Math.floor((0,Ut().e$)(r,t.valueOf()-i));return(0,m.jsx)("div",{style:{position:"absolute",left:l-$u/2+.5,top:Math.floor(Xu+Du-$u/2+.5),width:$u,height:$u,background:n.timelineRed,borderRadius:"100%"}})}function lp(e){let{time:t,timelineState:o,intl:n}=e;const r=(0,c().Fg)(),i=(0,s().O7)(),l=(0,a().Kw)(o.zoomLevel),{startTimestamp:d}=(0,a().Kw)(o.currentRange),{secondaryDisplayUnit:u}=Ut().BJ[l],p=(0,Ut().e$)(l,t.valueOf()-d);return(0,m.jsx)("div",{style:{position:"absolute",top:0,left:p,height:Xu,color:r.regularTextColor,fontSize:14,fontWeight:b().Ue.medium,verticalAlign:"middle",paddingTop:Ou+(i.device.isMobile?2:0),display:"flex",alignItems:"center"},children:(0,Ut().EW)((0,zu().E2)(n),t.valueOf(),u)},p)}function sp(e){let{start:t,end:o,rangeWidth:n}=e;const r=(0,c().Fg)();return t&&o?n>=Uu?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{style:op(r),children:(0,Us().Yx)(t.valueOf(),"month_day",fa().locale)}),(0,m.jsx)("div",{style:{flexGrow:1}}),(0,m.jsx)("div",{style:op(r),children:(0,Us().Yx)(o.valueOf(),"month_day",fa().locale)})]}):(0,m.jsxs)("div",{style:op(r),children:[(0,Us().Yx)(t.valueOf(),"month_day",fa().locale)," – ",t.month===o.month?(0,Us().Yx)(o.valueOf(),"day",fa().locale):(0,Us().Yx)(o.valueOf(),"month_day",fa().locale)]}):(0,m.jsx)("div",{style:op(r),children:(0,Us().Yx)(t.valueOf(),"month_day",fa().locale)})}function ap(e,t,o,n){const r=e.setLocale(fa().locale),i=(0,Ut().ST)(o),l=(0,Ut().xJ)();return i?l?(0,m.jsx)("span",{style:{color:n.timelineRed},children:r.toFormat("H:mm")}):(0,m.jsx)("span",{style:{color:n.timelineRed,paddingRight:3},children:r.toFormat("t")}):"week"===t||"bi_week"===t?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("span",{style:{color:n.lightTextColor,paddingRight:3},children:r.toFormat("ccccc")}),(0,m.jsxs)("div",{style:{position:"relative"},children:[(0,m.jsx)("div",{style:np(n)}),(0,m.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})]}):(0,m.jsxs)("div",{style:{position:"relative"},children:[(0,m.jsx)("div",{style:np(n)}),(0,m.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})}function cp(e){let{nowTimeStartOfPrimaryDisplayUnit:t,timelineState:o}=e;const n=(0,a().Kw)(o.zoomLevel),{startTimestamp:i,endTimestamp:l}=(0,a().Kw)(o.currentRange),s=Ut().BJ[n],{primaryDisplayUnit:c,hidePrimaryIndicatorIntersectionOffset:d}=s,u=d||0,p=(0,a().VK)((()=>ep(t,!1,o)),[t,o]),g=p.left+u,S=p.left+p.width-u,h=[];let f=(0,Ut().DS)(r().ou.fromMillis(i),c);const y=(0,a().VK)((()=>ep(f,!1,o)),[f,o]);for(;f.valueOf()<l;){const e=y.left+u,t=y.left+y.width-u;void 0!==d&&(g>=e&&g<=t||S>=e&&S<=t)||h.push((0,m.jsx)(rp,{timelineState:o,time:f,accent:!1},f.valueOf()));const n=(0,Ut().Ip)(f,c);f=n}return(0,m.jsx)(m.Fragment,{children:h})}function dp(e){let{timelineState:t}=e;const o=(0,C().YB)(),n=(0,a().Kw)(t.zoomLevel),{startTimestamp:i,endTimestamp:l}=(0,a().Kw)(t.currentRange),s=Ut().BJ[n],{primaryDisplayUnit:c,secondaryDisplayUnit:d}=s,u=[];let p=(0,Ut().DS)(r().ou.fromMillis(i),d);for(;p.valueOf()<l;){u.push((0,m.jsx)(lp,{timelineState:t,intl:o,time:p},p.valueOf()));const e=(0,Ut().Ip)(p,d);p=(0,Ut().xP)(e,c)}return(0,m.jsx)(m.Fragment,{children:u})}function up(e){let{time:t,timelineState:o}=e;const n=(0,c().Fg)(),r=(0,a().Kw)(o.zoomLevel),{primaryDisplayUnit:i}=Ut().BJ[r],{left:l,width:s}=(0,a().VK)((()=>ep(t,!0,o)),[t,o]);return(0,m.jsx)("div",{style:{position:"absolute",top:0,left:l,width:s,height:Xu-4,display:"flex",alignItems:"center",fontWeight:500},children:(0,m.jsx)("div",{style:{fontSize:Yu,margin:"0 auto",display:"flex"},children:ap(t,r,i,n)})},l)}function pp(e){let{timelineState:t,activeRangeStore:o}=e;const n=(0,c().Fg)(),i=(0,a().Kw)(t.zoomLevel),{startTimestamp:l,endTimestamp:s}=(0,a().Kw)(t.currentRange),d=Ut().BJ[i],{activeRangeType:u}=d,p=(0,a().Kw)(o);if(p){const e=(0,Ut().DS)(r().ou.fromMillis(p.start),"day"),o=(0,Ut().e$)(i,e.valueOf()-l);if("highlight_days"===u){const a=[];let c=r().ou.fromMillis(Math.max(e.valueOf(),(0,Ut().DS)(r().ou.fromMillis(l),"day").valueOf()));for(;c.valueOf()<p.end&&c.valueOf()<s;){a.push(c);c=(0,Ut().Ip)(c,"day")}const d=(0,Ut().e$)(i,c.valueOf()-l)-o+2*Gu,u=a.map(((e,o)=>(0,m.jsx)(rp,{timelineState:t,time:e,accent:0===o||o===a.length-1},`${e.toString()}-${o}`)));return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{style:{position:"absolute",top:0,left:o-Gu,width:d,marginTop:(Xu-Nu)/2-2,height:Nu,background:n.timelineDarkerBackground,borderRadius:Nu/2}}),u]})}{const t=(0,Ut().DS)(r().ou.fromMillis(p.end),"day"),s=(0,Ut().cK)(r().ou.fromMillis(p.end),"day"),a=(0,Ut().e$)(i,t.valueOf()-l)-o+2*Gu;return(0,m.jsx)("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:0,left:o-Gu,minWidth:a,marginTop:(Xu-Nu)/2-2,height:Nu,background:n.timelineDarkerBackground,borderRadius:Nu/2,paddingLeft:6,paddingRight:6},children:(0,m.jsx)(sp,{start:e,end:e.valueOf()!==s.valueOf()?s:void 0,rangeWidth:a})})}}return null}function mp(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:n}=e;const r=(0,a().VK)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),i=t.settingsStore;return(0,m.jsx)(zl,{title:(0,m.jsx)(C()._H,{defaultMessage:"No date property",id:"database.timelineView.missingDatePropertyTitle"}),description:r?(0,m.jsx)(C()._H,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Timeline view.",id:"database.timelineView.missingDateProperty",values:{opensettingslink:e=>(0,m.jsx)(Zl,{onClick:()=>{k().r$({collectionContextStore:t,collectionSettingsStore:i}),k().H4({collectionSettingsStore:i,item:{type:"properties",timelineViewTab:"timeline"}})},children:e})}}):(0,m.jsx)(C()._H,{defaultMessage:"Timeline views require a date property in order to display.",id:"database.timelineView.missingDatePropertyNoPermissions"}),style:{paddingBottom:o?void 0:n}})}function gp(e){let{timelineState:t}=e;const o=(0,vu().k)(),r=(0,n.useCallback)((()=>{0===(new Date).getSeconds()&&o()}),[o]);(0,n.useEffect)((()=>{const e=setInterval(r,1e3);return()=>clearInterval(e)}),[r]);const i=(0,a().Kw)(t.zoomLevel),{startTimestamp:l,endTimestamp:s}=(0,a().Kw)(t.currentRange);return(0,m.jsxs)("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"},children:[(0,m.jsx)(vp,{zoomLevel:i,startTimestamp:l,endTimestamp:s}),(0,m.jsx)(xp,{zoomLevel:i,startTimestamp:l,endTimestamp:s}),(0,m.jsx)(yp,{zoomLevel:i,startTimestamp:l})]})}const Sp=n.memo(gp,ao().Z),hp=n.memo((function(e){let{start:t,zoomLevel:o,startTimestamp:n}=e;const r=(0,c().yK)((e=>{const r=t.plus({day:2}).startOf("day"),i=(0,Ut().e$)(o,t.valueOf()-n);return{weekendIndicator:{position:"absolute",left:i,width:(0,Ut().e$)(o,r.valueOf()-n)-i,height:"100%",background:e.timelineDarkerBackground}}}),[t,n,o]);return(0,m.jsx)("div",{style:r.weekendIndicator},t.valueOf())}),ao().Z),fp=n.memo((function(e){let{time:t,zoomLevel:o,startTimestamp:n}=e;const r=(0,c().yK)((e=>({verticalDivider:{position:"absolute",left:(0,Ut().e$)(o,t-n),height:"100%",borderRight:`1px solid ${e.regularDividerColor}`}})),[n,t,o]);return(0,m.jsx)("div",{style:r.verticalDivider},t)}),ao().Z),yp=n.memo((function(e){let{zoomLevel:t,startTimestamp:o}=e;const n=(0,c().yK)((e=>{const n=r().ou.now().startOf("minute");return{nowVerticalDivider:{position:"absolute",left:Math.floor((0,Ut().e$)(t,n.valueOf()-o)),height:"100%",borderRight:`1px solid ${e.timelineRed}`}}}),[o,t]);return(0,m.jsx)("div",{style:n.nowVerticalDivider})}),ao().Z),vp=n.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:n}=e;const{showWeekendIndicators:i}=Ut().BJ[t];if(!i)return null;let l=(0,Ut().DS)(r().ou.fromMillis(o),"day");const s=[];for(;l.valueOf()<n;)6===l.weekday&&s.push((0,m.jsx)(hp,{start:l,zoomLevel:t,startTimestamp:o},l.valueOf())),l=(0,Ut().Ip)(l,"day");return(0,m.jsx)(m.Fragment,{children:s})}),ao().Z),xp=n.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:n}=e;const{verticalDividerUnit:i}=Ut().BJ[t];if(!i)return null;const l=[];let s=(0,Ut().DS)(r().ou.fromMillis(o),i);for(;s.valueOf()<n;)l.push((0,m.jsx)(fp,{time:s.valueOf(),zoomLevel:t,startTimestamp:o},s.valueOf())),s=(0,Ut().Ip)(s,i);return(0,m.jsx)(m.Fragment,{children:l})}),ao().Z);var bp=()=>o(760536);function Cp(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:s,canEditCollectionTimeline:a}=e;return(0,n.useCallback)((e=>{const{groupFormat:n,groupsDisplayState:c}=e,d=i.collection_group_by,u=t.groupsStore.getGroupState(n),p=Boolean(n&&!(null!=u&&u.toggleStateStore.state)),{currentGroups:m,visibleGroups:g,hiddenGroups:S}=c,h=function(e,t,o,n){if(!e)return!0;const r=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<r){const t=n.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.state}return!1}))}(n,p,m,t),f=null==u?void 0:u.reducerResultStore.state,y=F().VM({collectionContextStore:t,reducerResult:f,isFullScreen:o}),v=n===S[S.length-1],x=n===g[g.length-1],b=(0,ho().Df)(c,t,!1),C=l.state?v:x,w=t.permissionScopesStore.state,k=C&&!r&&w.canConfigureBlock&&d&&(0,ro().Wz)(d,w.canConfigureCollection),V=f&&0===f.blockIds.length;return{groupHeader:Boolean(n&&(!s||!h)),tableHeaderRow:Boolean(s&&!p&&!h),tableAggregationRow:Boolean(s&&!p),addItemRow:Boolean(a&&!p),hiddenGroupsButton:Boolean(x&&S.length>0),groupsLoadMoreButton:Boolean(x&&b),loadMoreButton:Boolean(!p&&y),tableEmptyRow:Boolean(s&&!p&&V),extraGroupMarginBottom:Boolean(s&&p),addGroupButton:Boolean(k)}}),[a,t,r,i.collection_group_by,l,o,s])}const wp=function(e){let{store:t,collectionContextStore:o,groupFormat:n}=e;const r=(0,s().O7)(),i=(0,a().VK)((()=>kp(t)),[t]),{value:l}=(0,ee().XJ)(de().F.formulas);return(0,m.jsx)(ot().Z,{store:t,style:{width:"100%",height:bp().Z+1},canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:i?Vp(i,r,t,o,n):void 0,onInsertAbove:i?jp(i,r,t,o,n):void 0,onSelectableDrop:e=>function(e,t,o,n,r,i){const{droppedDirection:l,droppedStores:s,duplicate:a}=e,c=kp(o);if(!c)return;const d=n.subitemTreeStore.state,u=(0,vo().DY)(d.children,(e=>e.value.store===o)),p=Te().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Te().default.DO_NOT_USE_measureAfterNextFlushLegacy(p,{environment:t,getData:()=>ge().yr({collectionContextStore:n,is_native_drop:!1,is_empty:!1})});const m="collectionTypedView"===n.contextType;I().createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleDrop",environment:t,canUndo:!0,perform:e=>{ut().by({environment:t,collectionStore:m?void 0:c,targetStore:o,droppedDirection:l,collectionContextStore:n,groupsPointer:r?[r]:[],droppedStores:s,duplicate:a,transaction:e,subitemPath:u,collapsedGroup:!1,formulasModule:i})}})}(e,r,t,o,n,l),onNativeDrop:e=>function(e,t,o,n,r,i){const{files:l,droppedDirection:s}=e,a=kp(r);if(!a)return;const c=o.collectionViewBlockStore(),d=Te().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Te().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:t,getData:()=>ge().yr({collectionContextStore:o,is_native_drop:!0,is_empty:!1})}),c&&I().createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleNativeDrop",environment:t,canUndo:!0,perform:e=>{ut().tQ({environment:t,collectionStore:a,targetStore:c,droppedDirection:s,collectionContextStore:o,groupsPointer:n?[n]:[],files:l,transaction:e,formulasModule:i})}})}(e,r,o,n,t,l),onRemove:e=>function(e,t){const{transaction:o}=e,n=kp(t);if(!n)return;ut().Od({store:t,transaction:o})}(e,t),analyticsName:"timeline"},t.id)};function kp(e){return e.getAssociatedCollectionStore()}function Vp(e,t,o,n,r){return i=>{const{insertStores:l,transaction:s}=i,a="collectionTypedView"===n.contextType;return ut().$T({environment:t,collectionStore:a?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!1,transaction:s})}}function jp(e,t,o,n,r){return i=>{const{insertStores:l,transaction:s}=i,a="collectionTypedView"===n.contextType;return ut().$T({environment:t,collectionStore:a?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!0,transaction:s})}}function Tp(e){let{store:t,groupFormat:o,collectionContextStore:r,canEdit:i,disabled:l,format:c}=e;const d=(0,s().O7)(),{value:u}=(0,ee().XJ)(de().F.formulas),[p]=(0,n.useState)((()=>new(te().G)(d,t.pointer))),g=(0,a().VK)((()=>r.groupsStore.getGroupState(o)),[r,o]),S=(0,a().Kw)(r.permissionScopesStore),h=(0,a().VK)((()=>r.collectionViewStore()),[r]),f=(0,a().VK)((()=>i&&S.canEditContent&&!S.isSyncedCollection&&d.device.isMobile&&!(null!=h&&h.isSyncedCollection())),[i,h,d,S]),y=(0,n.useMemo)((()=>{if(p)return(0,m.jsx)(ot().Z,{store:p,shouldShowDropZone:i,canDropBelow:i,canNativeDropBelow:i,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:e=>function(e,t,o,n,r){const{droppedDirection:i,droppedStores:l,duplicate:s}=e,a=o.collectionStore();if(!a)return;const c=o.groupsStore.getGroupState(t);if(!c)return;const d=o.collectionViewBlockStore(),u=Te().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Te().default.DO_NOT_USE_measureAfterNextFlushLegacy(u,{environment:n,getData:()=>ge().yr({collectionContextStore:o,is_native_drop:!1,is_empty:!0})}),d&&I().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:n,canUndo:!0,perform:e=>{ut().by({environment:n,collectionStore:a,targetStore:d,droppedDirection:i,collectionContextStore:o,groupsPointer:c.groupsPointer,droppedStores:l,duplicate:s,transaction:e,collapsedGroup:!1,formulasModule:r})}})}(e,o,r,d,u),onNativeDrop:e=>function(e,t,o,n,r){const{files:i,droppedDirection:l}=e,s=t.collectionStore();if(!s)return;const a=t.collectionViewBlockStore(),c=Te().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Te().default.DO_NOT_USE_measureAfterNextFlushLegacy(c,{environment:n,getData:()=>ge().yr({collectionContextStore:t,is_native_drop:!0,is_empty:!0})}),a&&I().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:n,canUndo:!0,perform:e=>{ut().tQ({environment:n,collectionStore:s,targetStore:a,droppedDirection:l,collectionContextStore:t,groupsPointer:o?[o]:[],files:i,transaction:e,formulasModule:r})}})}(e,r,o,d,u),analyticsName:"timeline",style:{width:"100%"}})}),[i,r,d,o,p,u]);return g?(0,m.jsxs)(m.Fragment,{children:[y,(0,m.jsx)(Lo,{collectionContextStore:r,groupsPointer:g.groupsPointer,format:c,canDrag:f,disableRequest:!0,resultProps:{groupFormat:o,collectionContextStore:r,isLast:!1,handleOpenPeekPage:v().ZT},canDrop:!0,resultComponent:wp,disabled:l,direction:Fo.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:Ip})]}):null}const Pp=n.memo(Tp,ao().Z);function Ip(e){return(0,m.jsx)("div",{style:{width:"100%",height:bp().Z+1}})}const Rp=n.memo((function(e){let{store:t,collectionContextStore:o,disabled:r,isFullScreen:i,isRootChild:l,paddingLeft:a,onGroupHeaderAddItem:c,format:d,groupsReducerResultStore:u,hiddenGroupsVisibleStore:p,canEditCollectionTimeline:g,showTable:S}=e;const h=(0,n.useMemo)((()=>({type:"dropzone",reducerResultStore:u,hiddenGroupsVisibleStore:p})),[u,p]),f=(0,n.useCallback)((()=>null),[]),y=function(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:c}=e;const d=(0,s().Fy)(),u=Cp({collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:c});return(0,n.useCallback)((e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=u(e),o=(0,R().rM)({isMobile:d.isMobile})-1;let n=0,r=0;return t.groupHeader&&(n+=Ut().Zn+Ut().xd-1),t.tableHeaderRow&&(n+=Ut().pe),t.tableEmptyRow&&(n+=o),t.addItemRow&&(r+=bp().Z),t.loadMoreButton&&(r+=co().J),t.tableAggregationRow&&(r+=o-1),t.addItemRow||(r-=1),t.hiddenGroupsButton&&(r+=Li+Oi+Di),t.groupsLoadMoreButton&&(r+=Hi+2*Zi),t.addGroupButton&&(r+=Bl+Kl+Fl),{paddingTop:n,paddingBottom:r}}),[d,u])}({collectionContextStore:o,isFullScreen:i,disabled:r,format:d,hiddenGroupsVisibleStore:p,showTable:S,canEditCollectionTimeline:g}),v=(0,n.useCallback)((e=>(0,m.jsx)(Pp,{store:t,groupFormat:e,collectionContextStore:o,canEdit:g,format:d,disabled:r&&g})),[o,t,d,r,g]);return d.collection_group_by?(0,m.jsx)(il,{reducerId:"timeline_groups",store:t,collectionContextStore:o,disabled:r,isFullScreen:i,isRootChild:l,paddingLeft:a,stickyLeft:!1,renderGroup:v,getGroupStyle:y,renderHeader:f,onGroupHeaderAddItem:c,timelineProps:h}):(0,m.jsx)("div",{style:y(void 0),children:v(void 0)})}));function _p(e){let{timelineState:t,...o}=e;const{collectionContextStore:n,isFullScreen:r,paddingLeft:i,isInPeekRenderer:l}=o,s=(0,a().Kw)(n.isInHomeWidgetStore),d=(0,a().VK)((()=>t.outerSizeObserver.rect.state.width),[t]),u=(0,c().yK)((e=>({outerDiv:{position:"sticky",left:0,width:d,height:Ut().Zn,zIndex:at().sL},headerStyle:{width:"100%",height:"100%",paddingLeft:r?i:32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},stickyStyle:{...s?{}:{background:e.contentBackground,boxShadow:`0 -1px 0 ${e.tableDividerColor}`}}})),[r,s,d,i]);return(0,m.jsx)("div",{style:u.outerDiv,children:(0,m.jsx)(Jr,{...o,style:u.headerStyle,stickyStyle:u.stickyStyle,preventToggleBackground:l})})}const Mp=new(ee().Ss)("TimelineItemDateRange",(async()=>await o.e(67197).then(o.bind(o,41384)))),Bp=(0,ee().kF)(Mp,(e=>e.TimelineItemDateRange));var Fp=function(e){return e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined",e}(Fp||{});function Kp(e){let{store:t,type:r,timelineState:i,scrollerLeftOffset:l,paddingLeft:d,format:u,itemPositionStore:p,dateValueStore:g,isDraggingViaTimelineItemStore:S,collectionContextStore:h,isFullScreen:f,isInPeekRenderer:y,isRootChild:v}=e;const x=(0,s().O7)(),b=(0,n.useRef)(Fp.NotDefined),C=(0,n.useRef)(null),w=(0,n.useRef)(null),[k,V]=(0,n.useState)(!1),j="left"===r?o(227758).Y:o(702436).n,P=(0,a().Kw)(i.outerSizeObserver.rect),I=(0,a().SI)((()=>{const e=p.state;if(e){const{left:t,right:o}=e;if(S.state)return Fp.Hidden;const n=i.scrollLeft.state;if(void 0!==n){if("left"===r){const e=n+l;if(e-o>0)return Fp.VisibleOutOfItem;if(e-t>0)return Fp.VisibleInItem}else{const e=n+P.width;if(t-e>0)return Fp.VisibleOutOfItem;if(o-e>0)return Fp.VisibleInItem}return Fp.Hidden}}return Fp.NotDefined}),[S,p,P,l,i,r]),R=(0,c().yK)((e=>({arrow:{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:k?e.regularIconColor:e.mediumIconColor,borderRadius:4,border:`1px solid ${e.contentBackground}`,..."left"===r&&{marginLeft:8,marginRight:4},..."right"===r&&{marginRight:8,marginLeft:4}},icon:{height:6,fill:y?e.cardContentBackground:e.contentBackground},wrap:{position:"sticky",left:"left"===r?l:P.width-220,width:220,height:Nt().aF-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===r?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis"}})),[k,y,P,l,r]);(0,n.useLayoutEffect)((()=>{_()}),[]),(0,n.useEffect)((()=>(I.addListener(_),()=>{I.removeListener(_)})),[]),(0,n.useEffect)((()=>{I.enqueueRecompute()}));const _=(0,n.useCallback)((()=>{const e=C.current,t=w.current;if(e&&t){const o=I.state,n=o===Fp.VisibleInItem||o===Fp.VisibleOutOfItem;e.style.opacity=""+(n?1:0),e.style.transform=`scale(${n?1:.3})`,t.style.pointerEvents=o===Fp.VisibleOutOfItem?"":"none";b.current!==Fp.NotDefined&&o!==Fp.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),b.current=o}}),[I]),M=(0,n.useCallback)((()=>{const e=g.state,o=i.zoomLevel.state,{snapUnit:n}=Ut().BJ[o],l=(0,Ut().x2)(o,200);if(e)if("left"===r){const{start:t}=(0,Ut().XO)(e,n),r=(0,Ut().GK)({timestamp:t.valueOf(),environment:x,timelineState:i,paddingLeft:d,format:u})-l;pu().Nf({timelineState:i,environment:x,zoomLevel:o,centerTimestamp:r})}else{const{end:t}=(0,Ut().XO)(e,n),r=(0,Ut().PF)({timestamp:t.valueOf(),timelineState:i})+l;pu().Nf({timelineState:i,environment:x,zoomLevel:o,centerTimestamp:r})}V(!1),T().Ys({environment:x,store:t}),(0,mu().gw)(x,{...(0,mu().Ii)({environment:x,collectionContextStore:h,timelineState:i,isFullScreen:f,isRootChild:v}),type:r})}),[h,g,x,u,f,v,d,t,i,r]),B=(0,n.useCallback)((()=>{x.device.isPhone||Oe().Z.state||V(!0)}),[x]),F=(0,n.useCallback)((()=>{x.device.isPhone||V(!1)}),[x]);return(0,m.jsxs)("div",{style:R.wrap,onMouseOver:B,onMouseOut:F,onMouseDown:ye().$0,onClick:M,ref:w,children:[(0,m.jsx)("div",{style:R.arrow,ref:C,children:j(R.icon)}),k&&(0,m.jsx)(Op,{dateValueStore:g,timelineState:i,isInPeekRenderer:y})]})}const Lp=n.memo(Kp,ao().Z);function Op(e){let{dateValueStore:t,timelineState:o,isInPeekRenderer:n}=e;const r=(0,c().yK)((e=>({dateRange:{fontSize:12,paddingLeft:4,paddingRight:4,borderRadius:4,background:n?e.peekTimelineBackground:e.timelineBackground,pointerEvents:"none"}})),[n]),i=(0,a().Kw)(t),l=(0,a().Kw)(o.zoomLevel);return i?(0,m.jsx)("span",{style:r.dateRange,children:(0,Ut()._Q)(i,l)}):null}class Dp extends d().default{getInitialState(){return null}}function Ep(e){let{store:t,timelineState:o,scrollerLeftOffset:i,paddingLeft:l,format:d,query:u,schema:p,blockPropertyValueOverlayStore:g,disabled:S,showProperties:h,collectionContextStore:f,isFullScreen:y,isRootChild:v,toggleButton:x,groupFormat:b,subitemPath:C,isInPeekRenderer:w,handleOpenPeekPage:k}=e;const V=(0,s().O7)(),{value:T}=(0,ee().XJ)(de().F.formulas),P=(0,n.useRef)(null),[R]=(0,n.useState)((()=>t.clone())),_=(0,n.useRef)(null),M=(0,a().VK)((()=>{const e=o.dateRangePlaceholder.state;if(e.active&&e.store===t&&!e.newTimelineItemProps&&(0,ro().ZH)(e.groupFormat,b))return e.date}),[b,t,o]),B=(0,a().SI)((()=>{const e=o.dragState.state;if(M)return M;if(e){const o=e.stores.indexOf(t);if(o>=0)return e.temporaryValues[o]}return Ap(t,u,p,V,T)}),[V,M,u,p,t,o,T],{useDeepEqual:!0}),K=(0,a().Kw)(B),L=(0,a().VK)((()=>{const e=(0,vo().ub)(C);if(!e||Boolean(K))return;const t=e.value.store,o=yu.findCollectionTimelineViewItems(t);if(o.length>0){return o[0].dateValueStore.state}}),[K,C]),O=(0,a().SI)((()=>(0,Ut().HZ)({timelineState:o,dateValue:K,placeholderDate:M,subitemPlaceholderDate:L})),[K,M,L,o]),D=(0,a().qz)(void 0,Dp);(0,Oc().c)(yu,(()=>({getNode:()=>P.current,props:{store:t,groupFormat:b,schema:p},stores:{nodeStore:D},dateValueStore:B,itemPositionStore:O})),[t,P,B,b,p,O,D]);const E=(0,a().Kw)(O),A=(0,a().VK)((()=>{var e;return null===(e=f.groupsStore.getGroupState(b))||void 0===e?void 0:e.reducerResultStore}),[b,f]),H=(0,ae().Dq)(),Z=Boolean(E&&!E.isPlaceholder&&!(null!=H&&H.isPreviewing)),z=(0,a().SI)((()=>{const e=o.dragState.state,n=To().default.state;return Boolean(e&&e.stores.includes(t)&&n.isDragging&&n.draggedStores.includes(t))}),[t,o]);(0,a().Kw)(z);const W=(0,a().VK)((()=>t.getAssociatedCollectionStore()),[t]),G=(0,n.useCallback)((e=>{const n=o.dateRangePlaceholder.state,r=f.groupsStore.getGroupState(b);if(r)if(n.active){const{date:e}=n;I().createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:V,canUndo:!0,perform:o=>{pu().oP({environment:V,store:t,query:u,schema:p,date:e,transaction:o})}}),o.dateRangePlaceholder.setState({active:!1})}else{const{horizontalScroller:n}=o,i=o.scrollLeft.state,l=O.state,s=_.current;if(!n||void 0===i||!l||!s)return;const a=n.getBoundingClientRect(),c=i+(e.clientX-a.left),d=_.current;if(!d)return;const u=d.lastElementChild;if(!u)return;const p=i+(u.getBoundingClientRect().right-a.left);c>l.right&&c<=p&&(0,ye().ZP)({event:e,context:ye().Af.EditorClick,callback:()=>{(0,xe().X9)()||Uo().CH({environment:V,store:t,openInNew:fe().DJ(e),peekMode:(0,F().kr)(f),resultsStore:r.resultsStore,collectionContextStore:f,pageVisitSource:Go().tY.PeekOpen})}})}}),[f,V,b,O,u,p,t,o]),N=(0,n.useCallback)((()=>{o.dateRangePlaceholder.setState({active:!1})}),[o]),U=(0,n.useCallback)((e=>{const{target:t}=e;!V.device.isMobile&&t instanceof HTMLElement&&(0,ye().ZP)({event:e,context:ye().Af.EditorMouseDown,callback:()=>{e.preventDefault(),j().AI({environment:V,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}),[V]),$=(0,n.useCallback)((e=>{const n=o.dragState.state,i=o.drawState.state,{horizontalScroller:l}=o,s=o.scrollLeft.state,a=o.zoomLevel.state,c=o.currentRange.state,{snapUnit:d,getDateRangePlaceholderDuration:m}=Ut().BJ[a];if(!i&&Oe().Z.state||n||Ap(t,u,p,V,T)||!l||void 0===s||S)return;const g=l.getBoundingClientRect(),h=s+(e.clientX-g.left),f=(0,Ut().x2)(a,h),y=r().ou.fromMillis(c.startTimestamp+f),v=(0,Ut().DS)(y,d),x=(0,Ut().DS)(m(y),d),C=(0,Is().hT)(v.valueOf(),(0,mo().r)()),w=(0,Ut().AZ)({startValue:C,snapUnit:d,desiredStart:v,desiredEnd:x});o.dateRangePlaceholder.setState({active:!0,store:t,parentStore:W,groupFormat:b,date:w,newTimelineItemProps:void 0,existingTimelineItemProps:{query:u,schema:p}})}),[V,o,t,b,S,u,p,W,T]),q=(0,n.useCallback)((e=>{D.setState(e)}),[D]),Y=(0,c().yK)((()=>({scrollArrows:{display:"flex",height:0,position:"relative",zIndex:at().fQ},dateRange:{display:"flex",height:bp().Z+1,width:"100%",cursor:"default",isolation:"auto"}})),[]);if(!A)return null;const Q=Boolean(E);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{ref:P,style:Y.scrollArrows,children:[Z&&(0,m.jsx)(Lp,{store:t,type:"left",timelineState:o,scrollerLeftOffset:i,itemPositionStore:O,dateValueStore:B,paddingLeft:l,format:d,isDraggingViaTimelineItemStore:z,collectionContextStore:f,isFullScreen:y,isInPeekRenderer:w,isRootChild:v}),Z&&(0,m.jsx)(Lp,{store:t,type:"right",timelineState:o,scrollerLeftOffset:i,itemPositionStore:O,dateValueStore:B,paddingLeft:l,format:d,isDraggingViaTimelineItemStore:z,collectionContextStore:f,isInPeekRenderer:w,isFullScreen:y,isRootChild:v})]}),(0,m.jsx)("div",{style:Y.dateRange,onMouseDown:U,onMouseMove:$,onMouseLeave:N,onClick:G,className:me().o4s,ref:q,children:Q&&(0,m.jsx)(Bp,{store:t,parentStore:W,toggleButton:x,clonedStore:R,itemPositionStore:O,dateValueStore:B,query:u,schema:p,timelineState:o,blockPropertyValueOverlayStore:g,disabled:S,showProperties:h,scrollerLeftOffset:i,isDraggingViaTimelineItemStore:z,collectionContextStore:f,isFullScreen:y,isInPeekRenderer:w,isRootChild:v,intl:ht().Z.getIntl(),propertiesWrapElementRef:_,resultStore:A,handleOpenPeekPage:k})})]})}function Ap(e,t,o,n,r){return(0,Ut().bk)({store:e,query:t,schema:o,userId:n.currentUser.id,intl:ht().Z.getIntl(),formulasModule:r})}function Hp(e){const{store:t,parentStore:o,timelineState:i,scrollerLeftOffset:l,query:d,schema:u,blockPropertyValueOverlayStore:p,disabled:g,showProperties:S,collectionContextStore:h,isFullScreen:f,isRootChild:y,toggleButton:v,groupFormat:x,canEditTimelineItems:b,subitemPath:C,paddingLeft:w,showTable:k}=e,V=(0,s().O7)(),[T,P]=(0,n.useState)(),_=(0,c().yK)((()=>({container:{display:"flex",height:(0,R().rM)({isMobile:V.device.isMobile})+1,width:"100%",cursor:"default",isolation:"auto"}})),[V.device]);(0,n.useEffect)((()=>{P(null==t?void 0:t.clone())}),[t]);const M=(0,a().VK)((()=>{var e;return null===(e=h.groupsStore.getGroupState(x))||void 0===e?void 0:e.reducerResultStore}),[h.groupsStore,x]),B=(0,a().VK)((()=>{const e=i.dateRangePlaceholder.state;if(e.active&&e.store===t&&e.newTimelineItemProps&&e.parentStore===o&&(0,ro().ZH)(e.groupFormat,x))return e.date}),[x,o,t,i.dateRangePlaceholder]),F=(0,a().VK)((()=>B),[B],{useDeepEqual:!0}),K=(0,a().VK)((()=>(0,Ut().HZ)({timelineState:i,dateValue:F,placeholderDate:B,subitemPlaceholderDate:void 0})),[F,B,i]),L=(0,a().VK)((()=>Boolean(K)),[K]),O=(0,a().VK)((()=>!h.isInHomeWidgetStore.state&&!t&&!L&&h.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[h,L,t]),D=(0,a().VK)((()=>h.isInPeekRendererStore.state),[h.isInPeekRendererStore]),E=(0,n.useMemo)((()=>new(Zu().default)((()=>K),{debugName:"itemPositionStore"})),[K]),A=(0,n.useMemo)((()=>new(Zu().default)((()=>F),{debugName:"dateValueStore"})),[F]),H=(0,n.useMemo)((()=>new(Zu().default)((()=>!1),{debugName:"isDraggingViaTimelineItemStore"})),[]);return M?(0,m.jsxs)("div",{style:_.container,onMouseDown:e=>function(e,t){const{target:o}=e;if(t.device.isMobile||!(o instanceof HTMLElement))return;(0,ye().ZP)({event:e,context:ye().Af.EditorMouseDown,callback:()=>{e.preventDefault(),j().AI({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,V),onMouseMove:e=>function(e,t,o,n,i,l,s,a,c,d,u,p){var m;const g=t.drawState.state,S=t.dragState.state,{horizontalScroller:h}=t,f=t.scrollLeft.state,y=t.zoomLevel.state,v=t.currentRange.state,{snapUnit:x,getDateRangePlaceholderDuration:b}=Ut().BJ[y];if(!g&&Oe().Z.state||S||!h||void 0===f||i)return;const C=null===(m=d.groupsStore.getGroupState(n))||void 0===m?void 0:m.resultsStore;if(!C)return;const w=h.getBoundingClientRect(),k=f+(e.clientX-w.left),V=(0,Ut().x2)(y,k),j=r().ou.fromMillis(v.startTimestamp+V),T=(0,Ut().DS)(j,x),P=(0,Ut().DS)(b(j),x),I=(0,Is().hT)(T.valueOf(),(0,mo().r)()),R=(0,Ut().AZ)({startValue:I,snapUnit:x,desiredStart:T,desiredEnd:P});t.dateRangePlaceholder.setState({active:!0,store:o,parentStore:u,groupFormat:n,date:R,newTimelineItemProps:{query:l,schema:s,resultsStore:C,isFullScreen:a,canEditTimelineItems:c,subitemPath:p},existingTimelineItemProps:void 0})}(e,i,t,x,g,d,u,f,b,h,o,C),onMouseLeave:()=>function(e){e.dateRangePlaceholder.setState({active:!1})}(i),onClick:e=>function(e,t,o,n,r,i,l,s,a,c,d,u){const p=r.dateRangePlaceholder.state;if(p.active){const{date:e}=p,m=u?u.length>0?"timeline_add_subitem_bottom":"timeline_add_parent_item_bottom":"timeline_add_item_bottom";if(!(0,Ge().ww)(t))return void(0,Ge().eD)(t);I().createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:t,canUndo:!0,perform:r=>{const p=pu().mg({environment:t,transaction:r,date:e,store:c,parentStore:d,query:o,schema:n,isFullScreen:i,groupFormat:l,canEditTimelineItems:s,collectionContextStore:a,subitemPath:u,from:m});Co().W(t,{from:m,type:"page",new_page_id:null==p?void 0:p.id,creating_block_id:null==p?void 0:p.id,...(0,ge().Pn)(a)})}}),r.dateRangePlaceholder.setState({active:!1})}}(0,V,d,u,i,f,x,b,h,t,o,C),className:me().o4s,children:[L&&(0,m.jsx)(Bp,{store:o?void 0:t,parentStore:o,toggleButton:v,clonedStore:T,itemPositionStore:E,dateValueStore:A,query:d,schema:u,timelineState:i,blockPropertyValueOverlayStore:p,disabled:g,showProperties:S,scrollerLeftOffset:l,isDraggingViaTimelineItemStore:H,collectionContextStore:h,isFullScreen:f,isInPeekRenderer:D,isRootChild:y,intl:ht().Z.getIntl(),resultStore:M,handleOpenPeekPage:zp}),O&&(0,m.jsx)(Up,{parentStore:o,collectionContextStore:h,paddingLeft:w,isFullScreen:f,showTable:k})]}):null}const Zp=n.memo(Hp);function zp(){}function Wp(e){let{isMobile:t}=e;return{display:"flex",alignItems:"center",paddingBottom:2,fontSize:14,height:(0,R().rM)({isMobile:t}),lineHeight:b().Nv.UIRegular.desktop}}function Gp(e,t,o){return{position:"sticky",left:t&&!o?e+8:8,display:"flex",alignItems:"center"}}function Np(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.mediumIconColor}}function Up(e){let{parentStore:t,collectionContextStore:o,paddingLeft:n,isFullScreen:r,showTable:i}=e;const l=(0,c().Fg)(),{isMobile:d}=(0,s().Fy)(),u=(0,a().Kw)(o.currentSubitemFormatStoreForUiDisplayStore),p=(0,a().VK)((()=>{var e;return u&&t?null===(e=t.getSchema()[u.property])||void 0===e?void 0:e.name:""}),[u,t]);return(0,m.jsx)("div",{style:Gp(n,r,i),children:(0,m.jsxs)("div",{style:Wp({isMobile:d}),children:[(0,lo().R)(Np(l)),(0,m.jsx)("span",{style:{color:l.mediumTextColor},children:t&&p?(0,m.jsx)(C()._H,{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",values:{propertyName:p}}):(0,m.jsx)(C()._H,{defaultMessage:"New",id:"database.timelineView.item.addRowButton"})})]})})}function $p(e){const{store:t,parentStore:o,subitemPath:n,timelineState:r,disabled:i,query:l,format:s,schema:c,collectionContextStore:d,blockPropertyValueOverlayStore:u,isFullScreen:p,isRootChild:g,groupFormat:S,paddingLeft:h,showTimelineProperties:f,scrollerLeftOffset:y,showTable:v,canEditTimelineItems:x,isInPeekRenderer:b,isReady:C,canEdit:w}=e,k=(0,a().VK)((()=>d.groupsStore.getGroupState(S)),[d,S]),V=(0,a().Kw)(d.permissionScopesStore),j=(0,a().VK)((()=>"collectionTypedView"===d.contextType),[d]);return(0,a().Kw)(d.isInHomeWidgetStore)||!k||!C||!w&&!j||V.isSyncedCollection?null:(0,m.jsx)(Zp,{store:t,disabled:i||!V.canEditContent&&!j,timelineState:r,schema:c,query:l,format:s,scrollerLeftOffset:y,paddingLeft:h,showProperties:f,blockPropertyValueOverlayStore:u,collectionContextStore:d,isFullScreen:p,showTable:v,isRootChild:g,groupFormat:S,canEditTimelineItems:x,isInPeekRenderer:b,parentStore:o,subitemPath:n})}const qp=function(e){const{collectionContextStore:t,schema:o,groupFormat:n,query:r,showTable:i,store:l,format:c,isFullScreen:d,paddingLeft:u,isInPeekRenderer:p,timelineState:g,blockPropertyValueOverlayStore:S,isRootChild:h,isReady:f,canEdit:y,disabled:x,scrollerLeftOffset:b}=e,C=(0,s().O7)(),w=(0,a().VK)((()=>{if(!r.timeline_by)return null;const e=t.groupsStore.getGroupState(n);if(!e)return null;const l=e.currentLimit.state,s=v().oA([n&&(0,po().Ko)({schema:o,propertyMapping:void 0,groupBy:t.getGroupByAndGroupFormats().groupBy,group:n,timeZone:(0,mo().r)(),experimentService:Le().default}),!i&&{property:r.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:s.length>0?{operator:"and",filters:s}:void 0,limit:l}}),[t,o,n,r,i]),k=(0,a().VK)((()=>t.groupsStore.getGroupState(n)),[t,n]),V=n?[n]:[],j=(0,a().VK)((()=>null==k?void 0:k.reducerResultStore.state),[null==k?void 0:k.reducerResultStore]),T=(0,a().VK)((()=>F().VM({collectionContextStore:t,reducerResult:j,isFullScreen:d})),[t,j,d]),P=(0,a().VK)((()=>F().D2({query:r,schema:o})),[r,o]),I=(0,a().VK)((()=>(c.timeline_properties||[]).filter((e=>{let{visible:t}=e;return t})).map((e=>{let{property:t}=e;return t}))),[c]);return k?(0,m.jsxs)(m.Fragment,{children:[w&&(0,m.jsx)(So().Z,{id:V.length>0?`results:${(0,ro().KW)(V)}`:"timeline_results",reducer:w,groupsPointer:V,collectionContextStore:t,resultStore:k.reducerResultStore}),(0,m.jsx)(Qp,{groupFormat:n,format:c,collectionContextStore:t,store:l,schema:o,query:r,isInPeekRenderer:p,timelineState:g,blockPropertyValueOverlayStore:S,showTimelineProperties:I,paddingLeft:u,isFullScreen:d,isRootChild:h,isReady:f,canEdit:y,canEditTimelineItems:P,disabled:x,showTable:i,scrollerLeftOffset:b}),T&&(0,m.jsx)("div",{style:{width:"100%"},children:i?(0,m.jsx)("div",{style:{height:co().J}}):(0,m.jsx)(co().ZP,{style:{position:"sticky",left:d?u:3,width:"max-content",height:co().J},groupsPointer:V,store:l,collectionContextStore:t,format:c,isFullScreen:d,incrementLimitsInRelatedGroups:!1})}),(0,m.jsx)($p,{...e,store:void 0,indentLevel:0,handleOpenPeekPage:()=>Yp(t,n,C),canEditTimelineItems:P,showTimelineProperties:I})]}):null};function Yp(e,t,o){const n=e.groupsStore.getGroupState(t);if(!n)return;Te().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag");const r=e.collectionViewStore();V().Xd({collectionContextStore:e,resultsStore:n.resultsStore});const i=null==r?void 0:r.getFormat().collection_peek_mode,l=i||Vo().Ls.timeline;wo().hy(o,{is_peek:!0,from:"timeline",peek_mode:l})}function Qp(e){const t=(0,s().O7)(),{groupFormat:o,format:n,collectionContextStore:r,disabled:i,query:l,schema:c,blockPropertyValueOverlayStore:d,isFullScreen:u,isRootChild:p,showTable:g,canEditTimelineItems:S,scrollerLeftOffset:h,timelineState:f,paddingLeft:y,showTimelineProperties:v,isInPeekRenderer:x}=e,b=(0,a().VK)((()=>{const e=r.permissionScopesStore.state;return{disabled:i||!("collectionTypedView"===r.contextType||e.canEditContent),timelineState:f,schema:c,query:l,format:n,scrollerLeftOffset:h,paddingLeft:y,showProperties:v,blockPropertyValueOverlayStore:d,collectionContextStore:r,isFullScreen:u,showTable:g,isRootChild:p,groupFormat:o,canEditTimelineItems:S,isInPeekRenderer:x,handleOpenPeekPage:()=>Yp(r,o,t),isLast:!1}}),[r,o,n,t,i,l,c,d,u,p,g,S,h,f,y,v,x]),C=(0,a().VK)((()=>r.groupsStore.getGroupState(o)),[r,o]);return C?(0,m.jsx)(Lo,{disableSelectable:!0,collectionContextStore:r,groupsPointer:C.groupsPointer,format:n,canDrag:!1,disableRequest:!0,resultProps:b,canDrop:!1,resultComponent:Ep,disabled:!0,direction:Fo.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:o=>function(e,t,o){return(0,m.jsx)($p,{...o,store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:()=>Yp(o.collectionContextStore,o.groupFormat,t),canEditTimelineItems:o.canEditTimelineItems,showTimelineProperties:o.showTimelineProperties})}(o,t,e)}):null}const Xp=n.memo((function(e){let{store:t,collectionContextStore:o,timelineState:r,disabled:i,isFullScreen:l,isInPeekRenderer:d,paddingLeft:u,isRootChild:p,format:g,schema:S,query:h,showTable:f,groupsReducerResultStore:y,hiddenGroupsVisibleStore:v,canEditCollectionTimeline:x,isReady:b,blockPropertyValueOverlayStore:C,tableStore:w,scrollerLeftOffset:k,onGroupHeaderAddItem:V}=e;const j=(0,n.useMemo)((()=>({type:"item",reducerResultStore:y,hiddenGroupsVisibleStore:v})),[y,v]),T=(0,n.useCallback)((e=>{if(!f)return(0,m.jsx)(_p,{timelineState:r,...e})}),[f,r]),P=(0,a().VK)((()=>(0,R().zp)(g,w)),[g,w]),I=(0,n.useCallback)((e=>(0,m.jsx)(qp,{store:t,groupFormat:e,schema:S,query:h,isInPeekRenderer:d,timelineState:r,collectionContextStore:o,blockPropertyValueOverlayStore:C,paddingLeft:u,format:P,isFullScreen:l,isRootChild:p,isReady:b,canEdit:x,disabled:i,showTable:f,scrollerLeftOffset:k})),[C,x,o,P,i,l,d,b,p,u,h,S,k,f,t,r]),_=function(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:d}=e;const u=(0,s().Fy)(),p=(0,c().Fg)(),m=Cp({collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:d});return(0,n.useCallback)((e=>{const t=m(e),o=(0,R().rM)({isMobile:u.isMobile});let n=0,r=0;return t.groupHeader&&a&&(n+=Ut().Zn+Ut().xd),t.tableHeaderRow&&(n+=Ut().pe-1),t.tableAggregationRow&&(r+=o),t.addItemRow||(r+=1),t.tableEmptyRow&&(r+=o),t.hiddenGroupsButton&&a&&(r+=Li+Oi+Di),t.groupsLoadMoreButton&&a&&(r+=Hi+2*Zi),t.addGroupButton&&a&&(r+=Bl+Kl+Fl),{paddingTop:n,paddingBottom:r,minHeight:Ut().Zn,boxShadow:e.index>0&&(!a||t.tableHeaderRow)?`inset 0 -1px 0 ${p.tableDividerColor}`:void 0}}),[u,m,a,p])}({collectionContextStore:o,isFullScreen:l,disabled:i,format:g,hiddenGroupsVisibleStore:v,showTable:f,canEditCollectionTimeline:x});return g.collection_group_by?(0,m.jsx)(Qr().F,{children:(0,m.jsx)(il,{reducerId:"timeline_groups",store:t,collectionContextStore:o,disabled:i,isFullScreen:l,isRootChild:p,paddingLeft:u,stickyLeft:!1,renderGroup:I,getGroupStyle:_,renderHeader:T,onGroupHeaderAddItem:V,timelineProps:j})}):I()}));const Jp=function(e){let{isGrouped:t,format:n,collectionContextStore:r,isFullScreen:i,isRootChild:l,timelineState:a}=e;const d=(0,c().Fg)(),u=(0,s().O7)(),{device:p}=u;return(0,m.jsx)(Tt().Z,{render:e=>(0,m.jsx)(et().D,{size:"sm",onClick:()=>function(e,t,o,n,r,i){const l=o.collectionViewStore();if(!l)return;I().createAndCommit({userAction:"CollectionTimelineViewHideTableButton.handleHideTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,Ut().YP)(t,!1);Sn().FH({stores:[l],update:o,transaction:e})}}),(0,mu().CB)(e,{...(0,mu().Ii)({environment:e,collectionContextStore:o,timelineState:i,isFullScreen:n,isRootChild:r}),show:!1})}(u,n,r,i,l,a),style:{position:"absolute",top:t?p.isIOS?3:4:p.isIOS?7:8,right:t?6:8,zIndex:at().MC,fill:d.lightIconColor},...e,children:(0,o(263555).D)({width:14})}),renderTooltip:()=>(0,m.jsx)(C()._H,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})};function em(){const e=(0,c().yK)((e=>({rowContainer:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0",borderBottom:`1px solid ${e.regularDividerColor}`},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,m.jsx)("div",{style:e.rowContainer,children:(0,m.jsx)(ir().Z,{style:e.rowShimmer})})}const tm=function(e){let{showTablePropertyFormatsStore:t,groupFormat:o,isFullScreen:r,collectionContextStore:i,blockPropertyValueOverlayStore:l,isReady:s,store:c,disabled:d,format:u,schema:p,isInPeekRenderer:g,query:S,showHoverActionsStore:h,paddingBottom:f,tableStore:y,timelineState:v,isRootChild:x,canEdit:b,paddingLeft:C,paddingRight:w}=e;const k=(0,a().VK)((()=>t.state.findIndex((e=>"title"===e.property))),[t]),V=(0,n.useMemo)((()=>o?[o]:[]),[o]),j=(0,a().VK)((()=>i.groupsStore.getGroupState(V)),[i,V]),T=(0,a().VK)((()=>null==j?void 0:j.reducerResultStore.state),[j]),P=(0,a().VK)((()=>(0,F().VM)({collectionContextStore:i,reducerResult:T,isFullScreen:r})),[i,T,r]),I=(0,a().Kw)(i.shouldShowSpinnerStore),R=(0,a().Kw)(i.permissionScopesStore),_=(0,a().Kw)(t),M=(0,a().Kw)(i.isInHomeWidgetStore),B=(0,a().VK)((()=>function(e,t,o){const n=e.permissionScopesStore.state,r="collectionTypedView"===e.contextType;return Boolean(!e.isInHomeWidgetStore.state&&t&&(o||r)&&!n.isSyncedCollection)}(i,s,b)),[i,s,b]);if(!j)return null;const K=s&&0===(null==T?void 0:T.blockIds.length)&&!I;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(rm,{store:c,format:u,schema:p,query:S,collectionContextStore:i,disabled:d,paddingBottom:f,isInPeekRenderer:g,blockPropertyValueOverlayStore:l,tableStore:y,showTablePropertyFormats:_,timelineState:v,isFullScreen:r,isRootChild:x,groupFormat:o,isInHomeWidget:M,paddingLeft:C,paddingRight:w}),K&&(0,m.jsx)(am,{collectionContextStore:i,isFullScreen:r,groupFormat:o,blockPropertyValueOverlayStore:l,canEdit:b}),(0,m.jsx)(mm,{store:c,schema:p,query:S,collectionContextStore:i,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:t,canEdit:b,format:u,tableStore:y,paddingLeft:C,disabled:d,groupFormat:o,titleColumnIndex:k,groupsPointer:V}),I&&(0,m.jsx)(em,{}),P&&(0,m.jsx)(dm,{collectionContextStore:i,format:u,canEdit:b,groupFormat:o,isFullScreen:r,groupsPointer:V}),B&&(0,m.jsx)(cm,{collectionContextStore:i,isFullScreen:r,groupFormat:o,blockPropertyValueOverlayStore:l,isInPeekRenderer:g}),(0,m.jsx)(yc,{groupFormat:o,style:nm(s,o,r,C),disabled:d||!R.canConfigureBlock,schema:p,query:S,collectionContextStore:i,isInPeekRenderer:g,isFullScreen:r,showPropertyFormats:_,showRightActionsSpacer:!1,paddingLeft:C,paddingRight:w,disableSticky:!0})]})};function om(){}function nm(e,t,o,n){return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",left:n},...o&&!t&&{left:n}}}function rm(e){let{groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,disabled:s,paddingBottom:c,isInPeekRenderer:d,blockPropertyValueOverlayStore:u,tableStore:p,showTablePropertyFormats:g,timelineState:S,isFullScreen:h,isRootChild:f,isInHomeWidget:y,paddingLeft:v,paddingRight:x}=e;const b=(0,a().VK)((()=>l.groupsStore.getGroupState(t)),[l,t]),C=(0,a().Kw)(l.permissionScopesStore),w=(0,a().VK)((()=>l.viewIsFlushToTopbar()),[l]);if(!b)return null;const k=Boolean(t);return(0,m.jsx)(gd,{store:o,format:n,schema:r,query:i,collectionContextStore:l,isInPeekRenderer:d,minWidth:void 0,paddingBottom:c,blockPropertyValueOverlayStore:u,showPropertyFormats:g,showRightActions:!1,allowHidingTitle:!0,tableStore:p,formatKey:"timeline_table_properties",disabled:s||!C.canConfigureBlock,disableHorizontalEdgeScroll:!0,height:(0,Ut().vX)(k),paddingTop:k?0:Ut().Ne-Ut().pe,disableTopBorder:!w||k,disableCellRightBorder:!0,groupFormat:t,isInHomeWidget:y,hasMoreReducerResults:!1,paddingLeft:v,paddingRight:x,children:!k&&C.canConfigureBlock&&(0,m.jsx)(Jp,{isGrouped:!1,format:n,collectionContextStore:l,timelineState:S,isFullScreen:h,isRootChild:f})})}function im(e,t,o){return{display:"flex",alignItems:"center",height:(0,R().rM)({isMobile:o}),width:"100%",paddingLeft:8,fontSize:14,lineHeight:b().Nv.UIRegular.desktop,background:e?t.cardContentBackground:t.contentBackground}}function lm(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor}}function sm(e,t,o,n,r,i){const{device:l}=e,s=n?[n]:[],a=t.groupsStore.getGroupState(s);if(!(0,Ge().ww)(e)||!a)return;t.searchQueryStore.state&&(0,qo().U)({searchQuery:"",collectionContextStore:t,isFullScreen:o});const c=t.currentSubitemFormatStoreForCollectionStore.state;I().createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:e,canUndo:!0,perform:o=>{const s=ut().IW({environment:e,collectionContextStore:t,groupsPointer:n?[n]:[],shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:o,from:{createBlock:"timeline_table_group_results"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(s){if(l.isMobile){!function(e,t,o){o?o(e):hn().c4({environment:t,url:e})}((0,Cn().ZP)({store:s.newStore,fullyQualified:!1,pageVisitSource:Go().tY.Create}),e,i)}else if(s.coercionSucceeded){const o=()=>{ko().bA({environment:e,blockPropertyValueOverlayStore:r,store:s.newStore,property:"title",format:wt().C.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(s.newStore,o)}else{const o=n?[n]:[],r=t.groupsStore.getGroupState(o);Uo().CH({environment:e,store:s.newStore,peekMode:(0,F().kr)(t),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t,pageVisitSource:Go().tY.Create})}Co().W(e,{from:c?"timeline_add_parent_item_bottom":"timeline_add_item_bottom",type:"page",new_page_id:s.newStore.id,creating_block_id:s.newStore.id,...(0,ge().Pn)(t)})}}})}function am(e){let{collectionContextStore:t,isFullScreen:o,groupFormat:r,blockPropertyValueOverlayStore:i,canEdit:l}=e;const a=(0,c().Fg)(),d=(0,s().O7)(),u=(0,n.useContext)(Jn().Z),p=(0,n.useCallback)((()=>sm(d,t,o,r,i,u)),[d,t,o,r,i,u]);return(0,m.jsx)(Vt().Z,{onClick:p,onMouseDown:ye().$0,disabled:!l,style:{display:"flex",alignItems:"center",height:(0,R().rM)({isMobile:d.device.isMobile}),width:"100%",paddingLeft:8,fontSize:14,lineHeight:b().Nv.UIRegular.desktop,background:a.contentBackground,left:0,right:0,borderBottom:`1px solid ${a.tableDividerColor}`},children:l?(0,m.jsx)("span",{style:{color:a.lightTextColor},children:(0,m.jsx)(C()._H,{defaultMessage:"Empty. Click to add a row.",id:"database.timelineView.emptyTablePlaceholder"})}):(0,m.jsx)("span",{style:{color:a.lightTextColor},children:(0,m.jsx)(C()._H,{defaultMessage:"Empty.",id:"database.timelineView.cannotEdit.emptyTablePlaceholder"})})})}function cm(e){let{collectionContextStore:t,isFullScreen:o,groupFormat:r,blockPropertyValueOverlayStore:i,isInPeekRenderer:l}=e;const a=(0,c().Fg)(),d=(0,s().O7)(),u=(0,n.useContext)(Jn().Z),p=(0,n.useCallback)((()=>sm(d,t,o,r,i,u)),[d,t,o,r,i,u]);return(0,m.jsxs)(Vt().Z,{onClick:p,style:im(l,a,d.device.isMobile),className:me().tfM,onMouseDown:ye().$0,children:[(0,lo().R)(lm(a)),(0,m.jsx)("span",{style:{color:a.lightTextColor},children:(0,m.jsx)(C()._H,{defaultMessage:"New",id:"database.timelineView.addRowButton"})})]})}function dm(e){let{groupsPointer:t,collectionContextStore:o,format:n,canEdit:r,groupFormat:i,isFullScreen:l}=e;const d=(0,c().Fg)(),u=(0,s().O7)(),p=(0,a().VK)((()=>o.groupsStore.getGroupState(t)),[o,t]),g=(0,a().VK)((()=>(0,Wo().$t)({collectionContextStore:o,groupsPointer:t})),[o,t]);return p?(0,m.jsxs)(Vt().Z,{onMouseDown:ye().$0,onClick:e=>function(e,t,o,n,r){const i=t.groupsStore.getGroupState(o);if(!i)return;const l=i.reducerResultStore.state;(0,ye().Wi)(e),T().ZH({environment:r}),l&&ut().ID({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:n,currentResultCount:l.blockIds.length,groupsPointer:i.groupsPointer,incrementLimitsInRelatedGroups:!1}}),O().uD(r)}(e,o,i,l,u),disabled:g,hoveredStyle:g?{background:d.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:co().J,width:"100%",paddingLeft:8,paddingBottom:2,fontSize:14,lineHeight:b().Nv.UIRegular.desktop,boxShadow:`0 -1px 0 ${d.tableDividerColor}`,borderBottom:`1px solid ${d.tableDividerColor}`,whiteSpace:"break-spaces"},children:[(0,yo().M)(lm(d)),(0,m.jsx)("span",{style:{color:d.lightTextColor,flexGrow:1},children:(0,m.jsx)(C()._H,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),g?(0,m.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,m.jsx)(sn().Z,{size:"sm"})}):r&&(0,m.jsx)(cc().Z,{collectionContextStore:o,format:n})]}):null}function um(e){const t=(0,s().O7)(),{isMobile:o}=(0,s().Fy)(),{store:n,parentStore:r,subitemPath:i,indentLevel:l,groupsPointer:a,collectionContextStore:c,disabled:d,blockPropertyValueOverlayStore:u}=e;return r?(0,m.jsx)(Ua,{store:n,collectionStore:r,subitemPath:i,indentLevel:l,collectionContextStore:c,disabled:d,groupsPointer:a,onSubitemCreate:e=>function(e,t,o,n){if(o){const r=()=>{ko().bA({isNewBlock:!0,environment:n,blockPropertyValueOverlayStore:o,store:e,property:"title",format:wt().C.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(e,r)}}(e,c,u,t),styles:{height:(0,R().rM)({isMobile:o})+1}}):null}function pm(e){let{args:t,schema:o,disabled:n,collectionContextStore:r,blockPropertyValueOverlayStore:i,showTablePropertyFormatsStore:l,canEdit:d,format:u,groupFormat:p,titleColumnIndex:g}=e;(0,c().Fg)();const S=(0,s().Fy)(),h=(0,a().VK)((()=>r.collectionViewStore()),[r]),{groupsPointer:f}=t,y=(0,a().VK)((()=>r.groupsStore.getGroupState(f)),[r,f]),v=(0,a().Kw)(l),x=(0,a().VK)((()=>!d&&S.isMobile&&!(null!=h&&h.isSyncedCollection())),[d,S,h]),b=(0,a().Kw)(r.isInHomeWidgetStore);if(!h||!y)return null;return(0,m.jsx)(Lo,{collectionContextStore:r,groupsPointer:f,disableRequest:!0,format:u,canDrag:x,resultProps:{schema:o,collectionContextStore:r,propertyFormats:v,onPropertyTab:t.onPropertyTab,onPropertyUntab:t.onPropertyUntab,onPropertyEnter:t.onPropertyEnter,onPropertyClick:t.onPropertyClick,onPropertyEsc:t.onPropertyEsc,onPropertyBgClick:t.onPropertyBgClick,onPropertyContextMenu:t.onPropertyContextMenu,onOpenProperty:t.onOpenProperty,disabled:n,blockPropertyValueOverlayStore:i,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableTableWrap:!0,disableCellBorderRight:!1,disableLastCellBorderRight:!0,onShiftEnter:om,titleColumnIndex:g,groupFormat:p,shouldShowMultiSelectCheckbox:!1,isInHomeWidget:b},resultComponent:jd,canDrop:!1,disabled:n,direction:Fo.Vertical,getItemSelectableStyle:()=>({display:"flex",width:"fit-content",height:33}),shouldShowHoverMenu:!0,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:t.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:i,titleColumnIndex:g,nestedCreateSubitemButton:e=>{let{store:t,parentStore:o,subitemPath:l,indentLevel:s}=e;return(0,m.jsx)(um,{collectionContextStore:r,disabled:n,blockPropertyValueOverlayStore:i,store:t,parentStore:o,subitemPath:l,indentLevel:s,groupsPointer:f})}})}function mm(e){let{groupFormat:t,groupsPointer:o,store:r,schema:i,query:l,collectionContextStore:s,blockPropertyValueOverlayStore:c,showTablePropertyFormatsStore:d,canEdit:u,format:p,tableStore:g,paddingLeft:S,disabled:h,titleColumnIndex:f}=e;const y=(0,a().VK)((()=>s.collectionViewStore()),[s]),v=(0,a().VK)((()=>s.groupsStore.getGroupState(t)),[s,t]),x=(0,a().Kw)(d),b=(0,n.useCallback)((e=>(0,m.jsx)(pm,{schema:i,disabled:h,collectionContextStore:s,blockPropertyValueOverlayStore:c,showTablePropertyFormatsStore:d,canEdit:u,format:p,groupFormat:t,titleColumnIndex:f,args:{...e,groupsPointer:o}})),[i,h,s,c,d,u,p,t,f,o]);return y&&v?(0,m.jsx)(nu,{store:r,collectionContextStore:s,minWidth:void 0,blockPropertyValueOverlayStore:c,showPropertyFormats:x,disabled:!u,disableHorizontalEdgeScroll:!0,groupFormat:t,render:b,tableStore:g,paddingLeft:S}):null}const gm=n.memo((function(e){let{store:t,tableStore:r,collectionContextStore:i,timelineState:l,format:s,schema:d,query:u,isFullScreen:p,groupBy:g,paddingLeft:S,paddingRight:h,paddingBottom:f,scrollerLeftOffset:y,isInPeekRenderer:v,isInHomeWidget:x,computedOuterHeight:b,showHoverActionsStore:C,blockPropertyValueOverlayStore:w,isRootChild:k,isReady:V,disabled:j,canEditCollectionTimeline:T,viewIsFlushToTopbar:P,groupsReducerResultStore:I,hiddenGroupsVisibleStore:_,onGroupHeaderAddItem:M}=e;const B=n.useRef(null),F=(0,a().SI)((()=>{const e=(0,R().zp)(s,r);return(e&&e.timeline_table_properties?e.timeline_table_properties:[]).filter((e=>e.visible))}),[s,r],{useDeepEqual:!0});(0,a().Kw)(F);const K=(0,a().VK)((()=>F.state.reduce(((e,t)=>e+(t.width||0)),0)),[F]),L=(0,c().yK)((e=>({selectable:{whiteSpace:"nowrap",...x?{}:{background:v?e.cardContentBackground:e.contentBackground},paddingLeft:S,boxSizing:"border-box",borderRight:`1px solid ${e.tableDividerColor}`,boxShadow:e.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:K+S,height:x?"100%":b},tableGroupHeaderSticky:{borderRight:`1px solid ${e.tableDividerColor}`,"--timeline-box-shadow":"0px"},tableGroupHeaderTransition:{borderRight:void 0},tableGroupHeader:{boxShadow:`inset 0 var(--timeline-box-shadow, 1px) 0 ${e.tableDividerColor}`}})),[K,S,x,v,b]),O=(0,a().VK)((()=>(0,R().zp)(s,r)),[s,r]),D=(0,n.useCallback)((e=>(0,m.jsx)(tm,{store:t,groupFormat:e,schema:d,query:u,isInPeekRenderer:v,timelineState:l,collectionContextStore:i,blockPropertyValueOverlayStore:w,showTablePropertyFormatsStore:F,showHoverActionsStore:C,tableStore:r,paddingLeft:S,paddingRight:h,paddingBottom:f,format:O,isFullScreen:p,isRootChild:k,isReady:V,canEdit:T,disabled:j&&T})),[w,T,i,j,O,p,v,V,k,f,S,h,u,d,C,F,t,r,l]),E=(0,n.useCallback)((e=>{const t=i.permissionScopesStore.state;return(0,m.jsx)(Jr,{...e,height:Ut().Zn,paddingTop:Ut().xd,stickyStyle:L.tableGroupHeaderSticky,transitionStickyStyle:L.tableGroupHeaderTransition,style:0!==e.index||P?L.tableGroupHeader:{},stickyWrapStyle:{marginBottom:Ut().xd},children:0===e.index&&t.canConfigureBlock&&(0,m.jsx)(Jp,{isGrouped:!0,format:s,collectionContextStore:i,timelineState:l,isFullScreen:p,isRootChild:k})})}),[i,s,p,k,L.tableGroupHeader,L.tableGroupHeaderSticky,L.tableGroupHeaderTransition,l,P]),A=(0,n.useCallback)((()=>({})),[]),H=(0,n.useCallback)((()=>(0,m.jsx)(il,{reducerId:"timeline_groups",store:t,collectionContextStore:i,disabled:j,isFullScreen:p,isRootChild:k,paddingLeft:S,stickyLeft:!1,renderGroup:D,getGroupStyle:A,renderHeader:E,onGroupHeaderAddItem:M,timelineProps:{type:"table",reducerResultStore:I,hiddenGroupsVisibleStore:_}})),[i,j,A,I,_,p,k,M,S,E,D,t]);return(0,m.jsx)("div",{style:{position:"sticky",left:0,height:0,width:K,zIndex:at().eU},children:(0,m.jsx)(ot().Z,{style:L.selectable,store:t,shouldShowHalo:!1,canSelect:!p,analyticsName:"timeline",children:(0,m.jsx)(o(854021).i,{name:"timeline-side-table",stickyHorizontally:!0,horizontalWidthLimiter:y,children:g?H():(0,m.jsx)(ci().Q,{nodeRef:B,children:(0,m.jsx)("div",{ref:B,children:D(void 0)})})})})})})),Sm=gm,hm=n.memo(n.forwardRef((function(e,t){let{store:r,collectionContextStore:i,query:l,schema:d,format:u,paddingLeft:p,paddingRight:g,isFullScreen:S,isPreviewing:h,isRootChild:f,disabled:y,isInPeekRenderer:v,paddingBottom:x,showHoverActionsStore:b,blockPropertyValueOverlayStore:w}=e;const k=function(e){let{isFullScreen:t,isRootChild:o}=e;const[r]=(0,n.useState)((()=>(0,Ut().Gz)({isFullScreen:t,isRootChild:o})));return r}({isFullScreen:S,isRootChild:f}),V=(0,s().O7)(),j=(0,s().Fy)();(0,mn().K)((()=>{const e=i.collectionViewStore();e&&pu().j2({timelineState:k,environment:V,collectionViewStore:e,collectionContextStore:i}),(0,mu().iR)(V,(0,mu().Ii)({environment:V,collectionContextStore:i,timelineState:k,isFullScreen:S,isRootChild:f}))})),function(e){let{collectionContextStore:t,query:o,schema:r,environment:i}=e;(0,n.useEffect)((()=>{const e=t.collectionStore();if(e&&!o.timeline_by&&e.isDefined()){const e=t.permissionScopesStore.state,o=t.collectionStore();if(!o||!o.isDefined())return;const n=t.collectionViewStore();if(!n||!e.canConfigureBlock)return;const l=(0,C().vU)({date:{id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}});I().createAndCommit({userAction:"CollectionTimelineView.updateOrCreateTimelineProperty",environment:i,canUndo:!0,perform:t=>{let s,a=F().HI(r);if(!a&&e.canConfigureCollection){a=(0,Ul().ZP)();s={[a]:{name:ht().Z.formatMessage(l.date),type:"date"}}}a&&((0,hr().E)({collectionViewStore:n,update:{timeline_by:a},transaction:t}),An().sW({store:n,data:{type:"timeline"},transaction:t}),s&&(0,$l().x)({environment:i,collectionStore:o,update:s,transaction:t}))}})}}),[o,t,r,i])}({collectionContextStore:i,query:l,schema:d,environment:V}),function(e){(0,n.useEffect)((()=>{const t=()=>{Oe().Z.state&&e.hoveredItem.setState(void 0)};return Oe().Z.addListener(t),()=>{Oe().Z.removeListener(t)}}),[e])}(k),function(e){let{environment:t,collectionContextStore:o,timelineState:r,isFullScreen:i,isRootChild:l}=e;(0,n.useEffect)((()=>{const e=r.drawState.state;if(null!=e&&e.tryToCompleteDrawnArrow){(0,Ut().H5)(o)&&I().createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:t,canUndo:!0,perform:e=>{pu().$o({timelineState:r,environment:t,transaction:e,collectionContextStore:o,isFullScreen:i,isRootChild:l})}})}}))}({environment:V,collectionContextStore:i,timelineState:k,isFullScreen:S,isRootChild:f}),(0,Ps().L)((()=>{k.destroyed=!0,k.outerSizeObserver.destroy(),k.timelineSizeObserver.destroy(),k.horizontalScroller&&(k.horizontalScroller.scrollLeft=0,(0,fe().ZV)(k.horizontalScroller,"scroll",B))}));const T=(0,a().qz)(void 0,ic),P=(0,a().qz)(void 0,Su),R=(0,a().qz)(void 0,gu),_=(0,n.useCallback)((()=>{const{horizontalScroller:e,outerSizeObserver:t}=k;if(!e)return;const o=k.zoomLevel.state,{startTimestamp:n,endTimestamp:r}=k.currentRange.state,i=e.scrollLeft,l=t.rect.state.width,s=(0,Ut().e$)(o,r-n),a=(0,Ut().al)(k);if(i<Ut().lx){const e=-(0,Ut().x2)(o,Ut().Ge);k.currentRange.setState({startTimestamp:n+e,endTimestamp:r+e}),pu().Nf({timelineState:k,environment:V,zoomLevel:o,centerTimestamp:a})}else if(i+l>s-Ut().lx){const e=(0,Ut().x2)(o,Ut().Ge);k.currentRange.setState({startTimestamp:n+e,endTimestamp:r+e}),pu().Nf({timelineState:k,environment:V,zoomLevel:o,centerTimestamp:a})}}),[k,V]),M=(0,pn().v)(_,200),B=(0,n.useCallback)((()=>{const{horizontalScroller:e,savePreference:t}=k;if(!e)return;const o=e.scrollLeft,n=k.scrollLeft.state;V.device.isIOS&&void 0!==n&&0===o&&n>Ut().lx?e.scrollLeft=n:(t&&t(),k.scrollLeft.setState(o),(0,Ut().rr)(V)?M():_())}),[k,V,M,_]),K=(0,n.useCallback)((()=>{const{startTimestamp:e,endTimestamp:t}=k.currentRange.state;pu().KA({timelineState:k,centerTimestamp:(e+t)/2})}),[k]),L=(0,n.useRef)(null),O=(0,n.useCallback)((e=>{if(e){L.current=e;const{outerSizeObserver:t}=k;t.observe(e);const o=(0,ke().xH)(e);o&&(k.horizontalScroller=o,(0,fe().lj)(o,"scroll",B),K())}}),[B,K,k]),D=(0,a().VK)((()=>i.viewIsFlushToTopbar()),[i]),E=(0,n.useRef)(null),A=(0,a().VK)((()=>{const e=k.zoomLevel.state,{startTimestamp:t,endTimestamp:o}=k.currentRange.state;return(0,Ut().e$)(e,o-t)}),[k]),H=(0,a().VK)((()=>!h&&(0,Ut().fj)({environment:V,isRootChild:f,isFullScreen:S,format:u})?Ut().Qw:p),[h,f,S,u,p,V]),Z=(0,a().VK)((()=>(0,Ut().xI)({environment:V,paddingLeft:H,format:u,isFullScreen:S,isRootChild:f})),[V,u,S,f,H]);(0,Oc().c)(o(984933).Z,(()=>({getNode:()=>E.current,customizeEdgeScrollRect(e){const t=Z;return Ms().iL.from({top:e.top,height:e.height,left:e.left+t,width:e.width-t})}})),[Z]),(0,n.useImperativeHandle)(t,(()=>({addBlockToView(e){let{store:t,transaction:o}=e;const n=t.getAssociatedCollectionStore()??i.collectionStore();if(n)return pu().Fv({environment:V,store:t,timelineState:k,query:l,collectionStore:n,collectionContextStore:i,groupFormat:void 0,transaction:o})}})));const z=(0,a().VK)((()=>(0,Ut().C1)({environment:V,format:u,isFullScreen:S,isRootChild:f})),[V,u,S,f]),W=(0,a().VK)((()=>i.groupsStore.anyGroupHasResults()),[i]),G=(0,a().Kw)(i.isInHomeWidgetStore),N=(0,a().VK)((()=>!!i.viewsModuleContextStore.getViewModuleType()),[i]),U=(0,a().VK)((()=>F().az(i,S)),[i,S]),$=(0,a().VK)((()=>{const{timelineSizeObserver:e}=k;return(e.rect.state.height||120)+x+(S?0:72)+(!S&&z?28:0)+(S&&j.isMobile?72:0)}),[k,x,S,z,j.isMobile]),q=function(e,t){const o=(0,Ve().PE)(e,!1);return(0,a().VK)((()=>{const e=t.permissionScopesStore.state;return o&&e.canEditContent&&!e.isSyncedCollection}),[o,t])}(r,i),Y=(0,n.useCallback)((e=>{if(e){const{timelineSizeObserver:t}=k;t.observe(e)}}),[k]),Q=(0,n.useCallback)(((e,t,o)=>{if(V.device.isMobile)No()._c({environment:V,store:e,pageVisitSource:Go().tY.Create});else{const{groupFormat:t}=o,n=t?[t]:[],r=i.groupsStore.getGroupState(n),l="collectionTypedView"===i.contextType;Uo().CH({environment:V,store:e,peekMode:F().kr(i),showMoveTo:l,resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:i,pageVisitSource:Go().tY.Create})}}),[V,i]),X=(0,n.useCallback)((e=>{const t=i.isLoadingStore.state,o=i.groupsStore.getGroupState([]);if(!o)return;const n=o.reducerResultStore.state;e<Ke().Z.incrementScrollOffset&&n&&!t&&n.hasMore&&ut().ID({collectionContextStore:i,environment:V,incrementLimitArgs:{isFullScreen:S,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[i,V,S]),J=(0,c().yK)((e=>({container:{position:"relative",float:"left",minWidth:"100%",width:A,...G?{}:{background:v?e.peekTimelineBackground:e.timelineBackground},...!S&&!z&&!G&&{borderBottom:`1px solid ${e.tableDividerColor}`},...(!W||G)&&{minHeight:150},...S&&{paddingBottom:x},height:G?"100%":$}})),[$,S,G,v,W,x,A,z]),{timeline_by:ee}=l;if(!ee)return(0,m.jsx)(mp,{collectionContextStore:i,isFullScreen:S,paddingBottom:x});const te=d[ee];return te&&io().Lt(te)?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{ref:O}),!D&&!h&&(0,m.jsx)("div",{style:{height:4}}),(0,Yn().Z)((e=>(0,m.jsx)(ci().Q,{nodeRef:E,width:A,clipLeftExtra:Z||(S?0:H),children:(0,m.jsx)("div",{style:J.container,className:me().kDE,ref:E,...e,children:(0,m.jsxs)(ot().Z,{store:r,analyticsName:"timeline",shouldShowHalo:!S&&!G,canSelect:!S&&!N,disablePointerEvents:h,style:G?{height:"100%"}:{},children:[(0,m.jsx)(Sp,{timelineState:k}),(0,m.jsxs)("div",{style:{position:"absolute",width:"100%",zIndex:0,top:Ut().Ne},ref:Y,children:[(0,m.jsx)(Xp,{store:r,schema:d,query:l,showTable:z,collectionContextStore:i,timelineState:k,disabled:y,isFullScreen:S,isRootChild:f,isInPeekRenderer:v,paddingLeft:H,groupsReducerResultStore:R,hiddenGroupsVisibleStore:P,format:u,canEditCollectionTimeline:q,isReady:W,blockPropertyValueOverlayStore:w,tableStore:T,scrollerLeftOffset:Z,onGroupHeaderAddItem:Q}),(0,m.jsx)(Mu,{timelineState:k,disabled:y,isReady:W,renderEmitter:i.renderEmitter,isFullScreen:S,isRootChild:f})]}),(0,m.jsx)(Ju,{isInPeekRenderer:v,timelineState:k,query:l,schema:d,scrollerLeftOffset:Z,collectionContextStore:i,showTable:z}),!h&&(0,m.jsx)(Au,{timelineState:k,isInPeekRenderer:v,paddingLeft:H,paddingRight:!S&&f?8:g,format:u,scrollerLeftOffset:Z,isFullScreen:S,isRootChild:f,showTable:z,collectionContextStore:i,isReady:W}),z&&(0,m.jsx)(Sm,{store:r,collectionContextStore:i,groupBy:u.collection_group_by,paddingLeft:H,disabled:y,isFullScreen:S,isRootChild:f,format:u,schema:d,query:l,tableStore:T,scrollerLeftOffset:Z,isInPeekRenderer:v,paddingRight:g,paddingBottom:x,isInHomeWidget:G,computedOuterHeight:$,timelineState:k,showHoverActionsStore:b,blockPropertyValueOverlayStore:w,viewIsFlushToTopbar:D,isReady:W,canEditCollectionTimeline:q,groupsReducerResultStore:R,hiddenGroupsVisibleStore:P,onGroupHeaderAddItem:Q}),(0,m.jsx)("div",{style:{paddingTop:Ut().Ne,pointerEvents:"none"},children:(0,m.jsx)(Rp,{store:r,collectionContextStore:i,disabled:y,isFullScreen:S,paddingLeft:H,isRootChild:f,format:u,groupsReducerResultStore:R,hiddenGroupsVisibleStore:P,canEditCollectionTimeline:q,onGroupHeaderAddItem:Q,showTable:z})}),!U&&(0,m.jsx)(zo().Z,{onChange:X})]})})})))]}):(0,m.jsx)(mp,{collectionContextStore:i,isFullScreen:S,paddingBottom:x})}))),fm=hm;const ym=new(ee().Ss)("CollectionChartView",(async()=>await Promise.all([o.e(94556),o.e(78701),o.e(38804),o.e(27856),o.e(62789),o.e(71641),o.e(38632),o.e(48005),o.e(79308)]).then(o.bind(o,180772)))),vm=(0,ee().kF)(ym,(e=>e.CollectionChartView)),xm=new(ee().Ss)("CollectionFormEditorView",(async()=>await Promise.all([o.e(37358),o.e(7312),o.e(11189),o.e(53329),o.e(72586),o.e(50471),o.e(2971),o.e(52065),o.e(47559),o.e(8564),o.e(15746)]).then(o.bind(o,738385)))),bm=(0,ee().kF)(xm,(e=>e.CollectionFormEditorView));var Cm=()=>o(763266);const wm={CollectionMapView:new(ee().Ss)("CollectionMapView",(async()=>await Promise.all([o.e(29335),o.e(21668)]).then(o.bind(o,66036))))},km=(0,ee().kF)(wm.CollectionMapView,(e=>e.CollectionMapView));var Vm=()=>o(209980);const jm=new(ee().Ss)("CollectionTasksEmptyStateModal",(async()=>await Promise.all([o.e(62743),o.e(27039),o.e(36751)]).then(o.bind(o,727039)))),Tm=(0,ee().kF)(jm,(e=>e.CollectionTasksEmptyStateModal));var Pm=()=>o(384334),Im=()=>o(452404),Rm=()=>o(209264),_m=()=>o(396439);const Mm=32,Bm="noWritableDbs";function Fm(e){const{collectionContextStore:t,onAddTaskClick:o,from:r}=e,i=(0,s().O7)(),l=(0,n.useRef)(null),d=(0,a().Kw)(t.isInHomeWidgetStore),u=(0,a().VK)((()=>t.collectionStoresStore.state.length>0),[t.collectionStoresStore]),p=(0,a().VK)((()=>{const e=t.collectionStoresStore.state;return Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())))}),[t.collectionStoresStore]),g=(0,a().VK)((()=>(0,F().PI)(t)),[t]),S=(0,a().VK)((()=>!t.isFullScreenStore.state),[t]),h=(0,n.useCallback)((e=>{var t;const n=null===(t=l.current)||void 0===t?void 0:t.getBoundingClientRect();n&&Id().Pz({environment:i,originRect:n,moveToContext:"aggregated_type",overrideDatabaseType:"notion://tasks_collection",onAccept:()=>{o(e)}})}),[i,o]),f=(0,c().yK)((e=>({container:{width:"100%",height:S?"calc(100% - 4px)":void 0,paddingTop:S?32:120,paddingBottom:32,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",fontSize:14,color:e.lightTextColor},desktopInner:{width:800,minWidth:800,padding:Mm},icon:(0,Re().jO)(e)})),[S]),y=(0,n.useMemo)((()=>u?(0,m.jsx)(Tt().Z,{disableTooltip:p,placement:Me().Placement.Bottom,renderTooltip:()=>(0,m.jsx)(C()._H,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"tasksEmptyState.addTask.tooltip.noWritableDbs",values:{br:(0,m.jsx)("br",{})}}),render:e=>(0,m.jsx)(Rm().D,{...e,isBlue:!0,ref:l,disabled:!p,disabledFeedback:!p,onClick:e=>{(0,Pm().Aq)({environment:i,from:r}),h(e)},icon:e=>(0,lo().R)(e),children:g})}):(0,m.jsx)(Rm().D,{isBlue:!0,onClick:()=>{(0,Pm().Aq)({environment:i,from:r}),Im().Z.setState(!0)},children:(0,m.jsx)(C()._H,{defaultMessage:"Don't see your tasks?",id:"tasksEmptyState.noDatabases.title"})})),[u,p,g,i,r,h]);return d&&!u?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Tm,{from:r}),(0,m.jsx)(Pe().Qi,{feature:"tasks",onSetup:()=>{(0,Pm().Aq)({environment:i,from:r}),Im().Z.setState(!0)}})]}):(0,m.jsxs)("div",{style:f.container,children:[(0,m.jsx)(Tm,{from:r}),(0,Vm().K)(f.icon),(0,m.jsx)(_m().Z,{size:16}),p?(0,m.jsx)(C()._H,{defaultMessage:"No matching tasks.",id:"tasksEmptyState.noMatchingTasks.title"}):(0,m.jsx)(C()._H,{defaultMessage:"See all tasks assigned to you here.",id:"tasksEmptyState.noTasks.title"}),(0,m.jsx)(_m().Z,{size:16}),y]})}var Km=()=>o(441530);const Lm=new(ee().Ss)("views-main-builder-modules",(()=>Promise.all([o.e(37358),o.e(7312),o.e(11189),o.e(53329),o.e(72586),o.e(50471),o.e(2971),o.e(52065),o.e(47559),o.e(8564),o.e(54308)]).then(o.bind(o,343642)))),Om=(0,ee().kF)(Lm,(e=>e.ViewsMainBuilderModules));var Dm=()=>o(639708),Em=()=>o(311562),Am=()=>o(865449),Hm=()=>o(494630);const Zm=n.memo((function(e){const{modules:t,store:n,collectionStore:r,context:i,disabled:l,templatePickerMenuListStore:c,pageLayoutRef:d,collectionContextStore:u}=e,p=(0,s().O7)(),g=(0,a().VK)((()=>r.getSchema()),[r]),S=(0,a().VK)((()=>(0,o(138196).Z)({environment:p,store:n,pageViewBlockStore:void 0})),[p,n]),h=(0,m.jsx)(m.Fragment,{children:t.map((e=>(0,m.jsx)(zm,{module:e,store:n,context:i,disabled:l,collectionSchema:g,collectionStore:r,modules:t,templatePickerMenuListStore:c,pageLayoutRef:d,pageDiscussionsRenderState:S},e.id)))});return u?(0,m.jsx)(q().L1,{value:u,children:h}):h}));function zm(e){let{module:t,store:r,context:i,disabled:l,collectionSchema:c,collectionStore:d,modules:u,templatePickerMenuListStore:p,pageLayoutRef:g,pageDiscussionsRenderState:S}=e;const h=(0,s().O7)(),f=(0,Hm().du)({layoutModule:t,area:"views_main_tab_modules",collectionSchema:c,collectionStore:d,pageMainModules:u,showDetailsPanelToggleButtonBelowTitle:!1}),y=(0,Hm().wV)({layoutModule:t,area:"views_main_tab_modules",collectionSchema:c,collectionStore:d,showDetailsPanelToggleButtonBelowTitle:!1,modules:u}),v=(0,a().VK)((()=>!(0,o(551242).D)({environment:h,layoutArea:"views_main_tab_modules",moduleType:t.type,pageViewBlockContext:i})),[h,t.type,i]);return(0,o(582025).B)(t,"views_main_tab_modules")?(0,Dm().f)(t)?(0,m.jsx)(o(965631)._,{context:i,disabled:l,propertyId:t.propertyId,store:r,pageModule:t,wrapper:y,stackPropertyLabelAndValue:v},`${t.id}-${r.id}`):(0,Dm().z1)(t)?(0,m.jsx)(n.Fragment,{children:(0,m.jsx)(o(179289).V,{context:i,disabled:l,store:r,wrapper:y,layoutModule:t,customization:{neverShowPropertiesElsewhereInLayout:!0,stackPropertyLabelAndValue:v,disableContainerPadding:!0,disableLastRowBottomPadding:v},showDefaultTitle:!0})},`${t.id}-${r.id}`):"editor"===t.type?(0,m.jsx)(Am().H,{context:i,disabled:l,handlePlaceholderWrapClick:e=>Km().og(e,r,h),pageBlockStore:r,pathToBlockId:t.pathToBlockId,templatePickerMenuListStore:p,pageViewBlockAccessor:()=>(null==g?void 0:g.current)??null,editorWrapper:i===Em().S.DraftPostInInlineComposer?void 0:y}):"relationsGroup"===t.type?(0,m.jsx)(o(305128).T,{pageStore:r,wrapper:y,disabled:l,context:i,showDefaultTitle:f}):"deleted_property"===t.type?null:"discussions"===t.type?(0,m.jsx)(o(293936).s,{store:r,wrapper:y,showDefaultTitle:f,discussionLocation:"page_discussion",pageDiscussionsRenderState:S}):void(0,x().t1)(t):null}var Wm=()=>o(857719);const Gm=n.memo((function(e){const{store:t,canEdit:r,templatePickerMenuListStore:i,collectionStore:l,collectionViewStore:c,isFullScreen:d}=e,u=(0,s().O7)(),p=(0,n.useRef)(null),g=(0,a().VK)((()=>t.isNonEditableState()),[t]),S=(0,$t().w)(),h=(0,q().Y$)(),f=(0,o(896641).S)({pageStore:t,collectionStore:l,pageViewBlockStore:void 0}),{layoutTabModules:y,viewsMainTabId:v}=(0,a().VK)((()=>{const e=null==f?void 0:f.views_main_tab_modules;if(!e)return{layoutTabModules:void 0,viewsMainTabId:void 0};const t=null==c?void 0:c.getFormat().page_layout_pointer;if(!t)return{layoutTabModules:void 0,viewsMainTabId:void 0};return{layoutTabModules:e[t.views_main_tab_id],viewsMainTabId:t.views_main_tab_id}}),[c,f]),x=(0,Na().n1)(),b=(0,a().VK)((()=>(0,Ce().wq)(t)?Em().S.PeekView:h.isFullScreenStore.state?Em().S.CollectionPageViewFullScreen:Em().S.CollectionPageView),[h,t]),C=(0,Ve().Pl)(t),w=(0,a().VK)((()=>{const e=o(472753).R.findBlockFromStore(t);if(e)return"collectionContextStore"in e?e.collectionContextStore:void 0}),[t]),k=(0,a().VK)((()=>(0,o(701474).uE)(C,t,b,u)),[C,t,b,u]),V=!r||g||S,j=S&&v?(0,m.jsx)("div",{style:{paddingTop:24,paddingLeft:4,paddingRight:4},children:(0,m.jsx)(Om,{viewsMainTabId:v,pageLayoutType:k})}):y&&l?(0,m.jsx)(Wm().Xg,{ref:p,type:k,style:{justifyContent:"center",paddingTop:24,paddingBottom:d?x:void 0},children:(0,m.jsx)(Zm,{context:b,modules:y,store:t,disabled:V,collectionStore:l,templatePickerMenuListStore:i,pageLayoutRef:p,collectionContextStore:w})}):(0,m.jsx)(Wm().Xg,{ref:p,type:k,style:{justifyContent:"center",paddingTop:24,paddingBottom:d?x:void 0},children:(0,m.jsx)(Am().H,{context:b,disabled:V,handlePlaceholderWrapClick:e=>Km().og(e,t,u),pageBlockStore:t,templatePickerMenuListStore:i,pageViewBlockAccessor:()=>p.current})});return!S||j||v?j:(0,m.jsx)("div",{inert:"true",style:{userSelect:"none"},children:j})}));var Nm=()=>o(963310);function Um(e){let{store:t,collectionStore:r,collectionViewStore:i,isDisabled:l,isFullScreen:d,isInPeekRenderer:u,isPreviewing:p,isRootChild:g,paddingLeft:S,paddingRight:h,paddingBottom:f,headerSizeObserver:y,viewType:v,timelineViewRef:x,showHoverActionsStore:b,handleAddItemClick:C,isPlaceholderExternalCollection:w,isEmptyMyTasks:k,isInFrameWhenSidePeekOpen:V,query:j,schema:T,format:P,isCustomDbEmptyState:I,maxHeight:R,placementStore:_,templatePickerMenuListStore:M}=e;const B=(0,q().Y$)(),[F,K,L]=(0,a().VK)((()=>[Boolean(B.hasSingleCollection()),"collectionSystemView"===B.contextType,B.isInHomeWidgetStore.state]),[B]),O=!(0,Ve().PE)(t,K||l);(0,n.useEffect)((()=>{"rendered"!==ft().default.state.renderPhase&&ft().default.setState({...ft().default.state,renderPhase:"rendered"})}),[]);const D=function(e){let{isFullScreen:t,viewType:o,isInFrameWhenSidePeekOpen:n,isInHomeWidget:r,isInPeekRenderer:i,isPreviewing:l,isRootChild:c,store:d}=e;const u=(0,s().O7)();return(0,a().VK)((()=>{const{device:e}=u,s=e.isPhone,a=("gallery"===o||("calendar"===o||"list"===o)&&t)&&n,p=(0,_e().ll)(u,i),m=ze().default.state;return r||l?void 0:t||c?s?`calc(100% - ${2*(0,pe().ui)(u)}px - ${p}px)`:i?`calc(100% - ${2*ze().PeekModePadding.horizontal[m.mode]}px - ${p}px)`:n?(0,_e().$3)(u)+(a?(0,_e().vJ)(u):0):t?`calc(100% - ${2*(0,pe().CP)(u)}px - ${p}px)`:(0,be().mO)(d,void 0,u)?`calc(100% - ${2*(0,pe().ui)(u)}px - ${p}px)`:be().zL-2*(0,pe().ui)(u)-p:`calc(100% - ${p}px)`}),[u,o,t,n,i,r,l,c,d])}({isFullScreen:d,viewType:v,isInFrameWhenSidePeekOpen:V,isInHomeWidget:L,isInPeekRenderer:u,isPreviewing:p,isRootChild:g,store:t}),E=u?o(27475).Z:o(121700).Z,[A,H,Z]=(0,a().VK)((()=>[null==r?void 0:r.isReady(),null==r?void 0:r.isDefined(),null==r?void 0:r.canRead()]),[r]),z=(0,c().yK)((e=>({container:{display:"flex",alignItems:"flex-start",paddingLeft:S,paddingRight:h,paddingTop:8},shimmer:{backgroundColor:e.largeShimmerColor,height:48,marginBottom:10,width:"100%"}})),[S,h]);if(F){if(!r)return(0,m.jsx)(Qm,{viewType:v,isFullScreen:d,paddingLeft:S,paddingRight:h,paddingBottom:f});if(!A)return(0,m.jsx)("div",{style:z.container,children:(0,m.jsx)(ir().Z,{emphasized:!1,style:z.shimmer})});if(!H)return Z?(0,m.jsx)(Qm,{viewType:v,isFullScreen:d,paddingLeft:S,paddingRight:h,paddingBottom:f}):(0,m.jsx)(Nm().S2,{collectionStore:r,paddingLeft:S,paddingRight:h,isFullScreen:d})}return w?(0,m.jsx)(Xm,{isFullScreen:d,paddingLeft:S,paddingRight:h,paddingBottom:f}):k&&"calendar"!==v?(0,m.jsx)(Fm,{collectionContextStore:B,onAddTaskClick:C,from:L?"home_tile_tasks":"home_tasks"}):I?(0,m.jsx)(Pe().sg,{collectionContextStore:B,onAddItemClick:C,from:L?"home_tile_custom_db":"home_custom_db"}):"table"===v?(0,m.jsx)(au,{schema:T,format:P,query:j,store:t,collectionContextStore:B,showHoverActionsStore:b,isFullScreen:d,isInPeekRenderer:u,isPreviewing:p,paddingLeft:S,paddingRight:h,minWidth:D,paddingBottom:f,disabled:O,blockPropertyValueOverlayStore:E,isRootChild:g,placementStore:_},i.id):"board"===v?(0,m.jsx)(Ts,{schema:T,format:P,query:j,store:t,collectionContextStore:B,isFullScreen:d,isInPeekRenderer:u,isPreviewing:p,paddingLeft:S,paddingRight:h,paddingBottom:f,disabled:O,blockPropertyValueOverlayStore:E,isRootChild:g},i.id):"page"===v?(0,m.jsx)($m,{store:t,collectionViewStore:i,disabled:O,templatePickerMenuListStore:M,isFullScreen:d}):"calendar"===v?(0,m.jsx)(Oa,{schema:T,format:P,query:j,store:t,collectionContextStore:B,isFullScreen:d,isInPeekRenderer:u,isPreviewing:p,paddingLeft:S,paddingRight:h,maxHeight:R,minWidth:D,paddingBottom:f,disabled:O,blockPropertyValueOverlayStore:E,isRootChild:g},i.id):"list"===v?(0,m.jsx)(ec,{schema:T,format:P,query:j,store:t,collectionContextStore:B,isFullScreen:d,isInPeekRenderer:u,isPreviewing:p,paddingLeft:S,paddingRight:V&&!L?24:h,minWidth:D,paddingBottom:f,disabled:O,blockPropertyValueOverlayStore:E,isRootChild:g},i.id):"gallery"===v?(0,m.jsx)(hl,{schema:T,format:P,query:j,store:t,collectionContextStore:B,isFullScreen:d,isInPeekRenderer:u,isPreviewing:p,paddingLeft:S,paddingRight:h,minWidth:D,paddingBottom:f,disabled:O,blockPropertyValueOverlayStore:E,isRootChild:g},i.id):"timeline"===v?(0,m.jsx)(fm,{schema:T,format:P,query:j,store:t,collectionContextStore:B,isFullScreen:d,isRootChild:g,isInPeekRenderer:u,isPreviewing:p,minWidth:D,paddingBottom:f,disabled:O,blockPropertyValueOverlayStore:E,showHoverActionsStore:b,ref:x,paddingLeft:S,paddingRight:h},i.id):"form_editor"===v?(0,m.jsx)(qm,{collectionViewStore:i,collectionContextStore:B,headerSizeObserver:y,paddingLeft:S,paddingRight:h},i.id):"chart"===v?(0,m.jsx)(Ym,{collectionViewStore:i,isPreviewing:p,paddingLeft:S,paddingRight:h,headerSizeObserver:y,collectionContextStore:B}):"feed"===v?(0,m.jsx)(o(366402).Z,{collectionViewStore:i,collectionContextStore:B,paddingLeft:S,paddingRight:h}):"map"===v?(0,m.jsx)(km,{collectionContextStore:B,paddingLeft:S,paddingRight:h,query:j}):"chat"===v?(0,m.jsx)(Ne().tC,{collectionViewStore:i,collectionContextStore:B,paddingLeft:S,paddingRight:h}):null}function $m(e){let{store:t,collectionViewStore:o,disabled:n,templatePickerMenuListStore:r,isFullScreen:i}=e;const l=(0,q().Y$)(),s=(0,a().VK)((()=>{let e,n=o.getFormat().page_pointer;const r=l.viewsModuleContextStore;if(!n&&"viewsMain"===(null==r?void 0:r.getViewModuleType())){const t=r.currentPageStore();t&&(n=t.pointer,e=t)}if(n)return e??=t.id===n.id?t:te().G.createChildStore(t,{table:n.table,id:n.id,spaceId:n.spaceId}),e.isPageBlock()||e.isCollectionView()?e:void 0}),[l.viewsModuleContextStore,o,t]),{collectionStore:c}=(0,a().VK)((()=>({collectionStore:l.collectionStore()})),[l]);return s?(0,m.jsx)(Gm,{canEdit:!n,disabled:n,store:s,collectionViewStore:o,templatePickerMenuListStore:r,collectionStore:c,isFullScreen:i}):null}function qm(e){let{collectionViewStore:t,collectionContextStore:o,headerSizeObserver:n,paddingLeft:r,paddingRight:i}=e;const l=(0,s().Fy)(),d=(0,c().yK)((e=>({disabledBuilderWrapper:{minHeight:void 0,height:void 0,marginTop:120-Hl,marginBottom:120-Hl,padding:0,paddingLeft:r,paddingRight:i},disabledBuilderTitle:{fontSize:14,fontWeight:b().Ue.regular},disabledBuilderIcon:{fill:e.lightIconColor,height:72,margin:"0 auto"}})),[r,i]),u=(0,a().VK)((()=>n.rect.state.width),[n]);return l.isMobile?(0,m.jsx)(zl,{style:d.disabledBuilderWrapper,title:(0,m.jsx)("span",{style:d.disabledBuilderTitle,children:(0,m.jsx)(C()._H,{id:"formsInner.disabledBuilder.title",defaultMessage:"Forms can only be edited on desktop"})}),icon:no(d.disabledBuilderIcon)}):(0,m.jsx)(bm,{collectionContextStore:o,headingWidth:u,paddingLeft:r,paddingRight:i},t.id)}function Ym(e){let{collectionViewStore:t,isPreviewing:o,paddingLeft:n,paddingRight:r,headerSizeObserver:i,collectionContextStore:l}=e;const s=(0,a().VK)((()=>i.rect.state.width),[i]);return(0,m.jsx)(vm,{collectionContextStore:l,isPreviewing:o,headingWidth:s,paddingLeft:n,paddingRight:r},t.id)}function Qm(e){let{viewType:t,isFullScreen:o,paddingLeft:r,paddingRight:i,paddingBottom:l}=e;const d=(0,s().O7)(),u=(0,q().Y$)(),p=(0,a().Kw)(u.permissionScopesStore),g=(0,c().Fg)(),S=(0,n.useMemo)((()=>({style:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:l},icon:oo({height:48,fill:g.lightIconColor,margin:"0 auto"})})),[o,l,r,i,g.lightIconColor]),h=(0,n.useCallback)((()=>{!function(e,t){const o=e.settingsStore;k().r$({collectionContextStore:e,collectionSettingsStore:o}),k().wl({collectionSettingsStore:o,item:{type:"linkToDatabase",existingCollectionStore:void 0}}),w().wd({environment:t,collectionContextStore:e,action:"click_select_data_source"})}(u,d)}),[u,d]);return p.canConfigureBlock?(0,m.jsx)(zl,{title:t?(0,m.jsx)(C()._H,{defaultMessage:"New {viewType}",id:"database.viewSettings.createView.newViewType",values:{viewType:gt().Bh[t].toLocaleLowerCase()}}):(0,m.jsx)(C()._H,{defaultMessage:"New view",id:"database.viewSettings.createView.newView"}),buttonText:(0,m.jsx)(C()._H,{defaultMessage:"Link a database",id:"collectionViewBlock.linkDatabase"}),buttonOnClick:h,...S}):(0,m.jsx)(zl,{title:(0,m.jsx)(C()._H,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"}),description:(0,m.jsx)(C()._H,{defaultMessage:"This block is not connected to any data source.",id:"collectionViewBlock.noSourcePlaceholder.description"}),...S})}function Xm(e){let{isFullScreen:t,paddingLeft:o,paddingRight:n,paddingBottom:r}=e;const i=(0,c().Fg)(),l=(0,q().Y$)(),[d,u,p]=(0,a().VK)((()=>[l.permissionScopesStore.state,l.settingsStore,l.collectionStore()]),[l]),g=(0,a().VK)((()=>u.state.open),[u]),S=(0,a().VK)((()=>{if(p)return p.getIcon()}),[p]),{isMobileBrowser:h}=(0,s().Fy)(),f=(0,a().VK)((()=>{if(p)return p.getFormat().integration_id}),[p]),y=(0,a().VK)((()=>{if(!p)return!1;const e=p.getFormat().integration_id,t=Va().default.integrations.state.find((t=>t.id===e));return!(!e||!t)&&(0,Cm().NP)(e).length>0}),[p]),v=(0,a().VK)((()=>Va().default.integrations.state.find((e=>e.id===f))),[f]);if(!v)return null;const x=!(h&&!y);return(0,m.jsx)("div",{style:{paddingLeft:o,paddingRight:n,paddingTop:8,paddingBottom:t?void 0:r,height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,m.jsxs)("div",{style:{paddingRight:g?Gt().P4:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,m.jsx)(Hn().Z,{icon:S,size:48,disabled:!0,isEmptyPage:!1}),(0,m.jsx)("div",{style:{fontSize:17,fontWeight:b().Ue.medium,color:i.lightTextColor,textAlign:"center",marginBottom:-2},children:(0,m.jsx)(C()._H,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",values:{integrationName:v.name}})}),d.canConfigureBlock&&(0,m.jsx)("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:i.lightTextColor},children:x&&(0,m.jsx)(C()._H,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",values:{integrationName:v.name,button:e=>(0,m.jsx)(Vt().Z,{style:{display:"inline",padding:"1px 2px",borderRadius:4,textDecoration:"underline"},onClick:()=>{k().NG({collectionSettingsStore:u})},children:e})}})})]})})}const Jm=n.memo(Um);var eg=()=>o(259314),tg=()=>o(239730),og=()=>o(138555),ng=()=>o(986286);function rg(e){const{origin:t}=e,o=(0,s().O7)();return(0,m.jsx)(Ia().U,{origin:t,placementToOrigin:"bottom",header:(0,m.jsx)(C()._H,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!"}),content:(0,m.jsx)(C()._H,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content"}),onCloseClick:()=>{Mc().Rg(o)},enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:Kc().EZ,pointerOffset:Kc().rK,style:{width:Kc().G5}})}function ig(e){const{origin:t}=e,o=(0,s().O7)();return(0,m.jsx)(Ia().U,{origin:t,placementToOrigin:"right",header:(0,m.jsx)(C()._H,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views"}),content:(0,m.jsx)(C()._H,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",values:{bold:e=>(0,m.jsx)("span",{style:{fontWeight:b().Ue.semibold},children:e})}}),onCloseClick:()=>{Mc().Rg(o)},pointerPosition:"50%",pointerLength:Kc().EZ,pointerOffset:Kc().FD,enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,style:{width:Kc().G5}})}let lg;class sg{constructor(e){this.style=void 0,this.lastResult=void 0,this.style=e.style}measure(e){var t;if(e===(null===(t=this.lastResult)||void 0===t?void 0:t.text))return this.lastResult.rect;lg||(lg=document.createElement("div"),lg.style.position="absolute",lg.style.left="0",lg.style.top="0",lg.style.pointerEvents="none",lg.style.opacity="0",document.body.appendChild(lg)),v().M6(this.style,((e,t)=>{lg&&(lg.style[t]=e)})),lg.textContent=e;const o=lg.getBoundingClientRect();return this.lastResult={text:e,rect:o},o}}const ag={ConfigureViewsMainModuleAddNewViewButtonWrapper:new(ee().Ss)("ConfigureViewsMainModuleAddNewViewButtonWrapper",(async()=>await Promise.all([o.e(62743),o.e(90698),o.e(94556),o.e(78701),o.e(38804),o.e(11189),o.e(53329),o.e(72586),o.e(46616),o.e(54940),o.e(20224),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(7678),o.e(5006),o.e(69437),o.e(75066),o.e(18162),o.e(91752),o.e(80730),o.e(62084),o.e(71641),o.e(10553),o.e(20683),o.e(27039),o.e(52065),o.e(38632),o.e(73230),o.e(25911),o.e(76540),o.e(51140)]).then(o.bind(o,895513))))},cg=(0,ee().kF)(ag.ConfigureViewsMainModuleAddNewViewButtonWrapper,(e=>e.ConfigureViewsMainModuleAddNewViewButtonWrapper));var dg=()=>o(965800),ug=()=>o(282662);function pg(e){const{collectionViewBlockStore:t,newViewIds:o,transaction:n}=e,r=t.getCollectionViewStores(),{beforeOps:i}=(0,dg().q)(r.map((e=>e.id)).slice(0,o.length),o);v().Ed(i,((e,r)=>{const i=te().Xr.createChildStore(t,{table:y().np,id:r,spaceId:t.getSpaceId()});if(e)ug().Vt({parentStore:t.getCollectionViewsStore(),insertStore:i,beforeStore:te().Xr.createChildStore(t,{table:y().np,id:e,spaceId:t.getSpaceId()}),transaction:n});else{const e=v().Z$(o.filter((e=>e!==r)));ug().BE({parentStore:t.getCollectionViewsStore(),insertStore:i,afterStore:e?te().Xr.createChildStore(t,{table:y().np,id:e,spaceId:t.getSpaceId()}):void 0,transaction:n})}}))}var mg=()=>o(716025),gg=()=>o(292612),Sg=()=>o(427886),hg=()=>o(437187),fg=()=>o(641702),yg=()=>o(900596),vg=()=>o(843403),xg=()=>o(44037),bg=()=>o(682547),Cg=()=>o(967925),wg=()=>o(237874),kg=()=>o(199264),Vg=()=>o(456524),jg=()=>o(110232),Tg=()=>o(142730),Pg=()=>o(378773),Ig=()=>o(94130),Rg=()=>o(583632);const _g={svgIcon:{width:24,height:16},svgIconPadded:{width:24,height:24}};function Mg(e){let{collectionViewStore:t,collectionContextStore:o,onClose:r}=e;const i=(0,s().O7)(),l=(0,s().Fy)(),c=(0,C().YB)(),d=(0,a().VK)((()=>function(e){var t;let{collectionViewStore:o,collectionContextStore:n,onClose:r,environment:i,intl:l,styles:s}=e;const a=n.permissionScopesStore.state,c=n.collectionViewStore(),d=n.collectionViewBlockStore();if(!c||!d)return[];const u=(0,Ie().Kj)(d.id),p=(0,pe().qG)(d.id),g=c.id===o.id,S=o.getAppConfigUri(),h=!S||(0,jg().R8)(S),f=n.collectionStore(),y=Boolean((null==f||null===(t=f.getParentBlockStore())||void 0===t?void 0:t.id)===d.id),v=void 0!==f||"page"===o.getType(),x=y&&n.isFullScreenStore.state,b=o.getType(),V=n.viewsModuleContextStore,j=void 0!==V.state,T=a.canConfigureBlock&&v&&!j,P=!p&&"form_editor"!==b&&"page"!==b&&v&&a.canConfigureBlock,R=d.getCollectionViewIds().length>1,_=n.isEditableHomeCollectionStore.state,M=!p&&(R||_)&&"page"!==b&&a.canConfigureBlock,B=f&&!x&&!j,F=!j&&v,K=V.currentPageStore(),L=null==K?void 0:K.getAssociatedCollectionStore(),O=K&&!V.isInLayoutBuilder()&&(0,Pg().N)({environment:i,blockStore:K,from:"viewsModule"}),D=n.isFullScreenStore.state,E=!u&&a.canConfigureBlock&&(!y||!D)&&!("page"===b&&void 0===o.getFormat().page_pointer),A=[];A.push([]),O&&K&&L&&A[0].push({key:"configure_layout",render:e=>(0,m.jsx)(Or().Z,{...e,title:(0,m.jsx)(C()._H,{defaultMessage:"Customize layout",id:"pageProperties.editProperty.customizeLayout.label"}),icon:(0,Cg().J)(s.svgIcon)}),action:()=>{L&&K&&(0,Tg().IR)({environment:i,blockStore:K,collectionStore:L,from:"collection_view_action_menu",initialSelectedModuleType:"viewsMain"})}});if(T){if(A[0].push({key:"rename",render:e=>(0,m.jsx)(Tt().Z,{placement:Me().Placement.Left,disableTooltip:h,render:t=>(0,m.jsx)(Or().Z,{...e,disabled:!h,disabledFeedback:!0,title:(0,m.jsx)(C()._H,{defaultMessage:"Rename",id:"database.viewSettings.viewActionMenu.rename"}),icon:(0,Vg().H)(s.svgIcon),...t}),renderTooltip:()=>(0,m.jsx)(C()._H,{id:"database.viewSettings.viewActionMenu.cannotRename",defaultMessage:"This view can’t be renamed."})}),action:()=>{w().wd({environment:i,collectionContextStore:n,action:"view_action_menu_rename"}),null==r||r(!0),g||(0,Sg().f)({environment:i,collectionContextStore:n,collectionViewId:o.id,isFullScreen:D,isRootChild:n.isRootChildStore.state,isInPeekRenderer:n.isInPeekRendererStore.state}),k().r$({collectionContextStore:n,collectionSettingsStore:n.settingsStore,selectViewNameInitial:!0})}}),"page"===b)return A;A[0].push({key:"edit",render:e=>(0,m.jsx)(Or().Z,{...e,title:(0,m.jsx)(C()._H,{defaultMessage:"Edit view",id:"database.viewSettings.viewActionMenu.editView"}),icon:(0,kg().W)(s.svgIcon)}),action:()=>{w().wd({environment:i,collectionContextStore:n,action:"view_action_menu_edit"}),null==r||r(!0),g||(0,Sg().f)({environment:i,collectionContextStore:n,collectionViewId:o.id,isFullScreen:n.isFullScreenStore.state,isRootChild:n.isRootChildStore.state,isInPeekRenderer:n.isInPeekRendererStore.state}),k().r$({collectionContextStore:n,collectionSettingsStore:n.settingsStore})}})}A.push([]),F&&A[1].push({key:"copyLink",render:e=>(0,m.jsx)(Or().Z,{...e,title:(0,m.jsx)(C()._H,{defaultMessage:"Copy link to view",id:"database.viewSettings.viewActionMenu.copyLink"}),icon:(0,wg().N)(s.svgIcon)}),action:async()=>{w().wd({environment:i,collectionContextStore:n,action:"view_action_menu_copy_link"}),await k().Ol({environment:i,collectionContextStore:n,collectionViewStore:o}),null==r||r(!1)}});B&&A[1].push({key:"openSourceDb",render:e=>(0,m.jsx)(Tt().Z,{placement:Me().Placement.Right,render:t=>(0,m.jsx)(Or().Z,{title:y?(0,m.jsx)(C()._H,{defaultMessage:"Open as full page",id:"database.viewSettings.viewActionMenu.openAsFullPage"}):(0,m.jsx)(C()._H,{defaultMessage:"Open source database",id:"database.viewSettings.viewActionMenu.openSourceDb"}),icon:(0,vg().J)(s.svgIcon),...(0,Mr().Z)(e,t)}),renderTooltip:()=>(0,m.jsx)(Bg,{collectionStore:f})}),action:e=>{(0,Ig().m)({environment:i,collectionContextStore:n,event:e.event})}});if(E){const e=n.normalizedFormatStore.state.hide_linked_collection_name;A[1].push({key:"showDatabaseTitle",render:t=>(0,m.jsx)(Or().Z,{...t,title:e?(0,m.jsx)(C()._H,{defaultMessage:"Show database title",id:"database.viewSettings.viewActionMenu.showDatabaseTitle"}):(0,m.jsx)(C()._H,{defaultMessage:"Hide database title",id:"database.viewSettings.viewActionMenu.hideDatabaseTitle"}),icon:(0,bg().N)(s.svgIconPadded)}),action:()=>{const t=!e;w().wd({environment:i,collectionContextStore:n,action:t?"click_source_hide_title":"click_source_show_title"}),I().createAndCommit({userAction:"CollectionViewActionMenu.getMenuSections",environment:i,canUndo:!0,perform:e=>{Sn().FH({stores:[o],update:{hide_linked_collection_name:t},transaction:e})}}),null==r||r(!1)}})}A.push([]),P&&A[2].push({key:"duplicate",render:e=>(0,m.jsx)(Or().Z,{...e,title:(0,m.jsx)(C()._H,{defaultMessage:"Duplicate",id:"database.viewSettings.viewActionMenu.duplicate"}),icon:(0,xg().a)(s.svgIcon)}),action:()=>{w().wd({environment:i,collectionContextStore:n,action:"view_action_menu_duplicate"}),k().zt({environment:i,collectionContextStore:n,collectionViewStore:o,collectionSettingsStore:n.settingsStore,intl:l,from:"view_action_menu_duplicate"}),null==r||r(!0)}});M&&A[2].push({key:"delete",render:e=>(0,m.jsx)(Or().Z,{...e,title:(0,m.jsx)(C()._H,{defaultMessage:"Delete",id:"database.viewSettings.viewActionMenu.delete"}),icon:(0,st().y)(s.svgIcon),isRedOnHover:!0}),action:async()=>{w().wd({environment:i,collectionContextStore:n,action:"view_action_menu_delete"});const e="form_editor"===(null==o?void 0:o.getType())?o.getFormBlockStore():void 0;await k().TT({environment:i,collectionContextStore:n,collectionViewStore:o,collectionSettingsStore:n.settingsStore,additionalBlocksToDelete:e?[e]:void 0,from:"view_action_menu"})&&(null==r||r(!1))}});return A}({collectionViewStore:t,collectionContextStore:o,onClose:r,environment:i,intl:c,styles:_g})),[o,t,i,c,r]),u=d.flatMap((e=>e)).length>0;return{renderMenu:(0,n.useCallback)((()=>{if(!u)return null;const e=l.isMobile?{menuType:fr().o.Modal,title:(0,m.jsx)(C()._H,{defaultMessage:"View options",id:"database.viewSettings.viewActionMenu.title"})}:{menuType:fr().o.Popup,width:220};return(0,m.jsx)(vr().Z,{...e,children:(0,m.jsx)(xr().ZP,{type:xr().iW.Vertical,initialFocus:void 0,sections:v().oA(d.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,m.jsx)(Cr().Z,{...e,topBorder:0!==t}),items:e}})))})})}),[u,l.isMobile,d]),hasMenuItems:u}}function Bg(e){const{collectionStore:t}=e,o=(0,C().YB)(),n=(0,a().VK)((()=>{var e;const n=t.getNameStore();return(0,fg().Xh)(n.getValue(),n)||(null===(e=t.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({intl:o}))||o.formatMessage(Rg().i.titlePlaceholder)}),[t,o]);return(0,m.jsx)(C()._H,{id:"database.viewSettings.viewActionMenu.openDbTooltip",defaultMessage:"Opens “{dbName}”",values:{dbName:n}})}function Fg(e){const{collectionContextStore:t,collectionViewStore:o,menuListItemProps:r,onClose:i}=e,{device:l}=(0,s().O7)(),d=(0,c().yK)((e=>({tooltipMessage:{color:e.mediumInvertedTextColor}})),[]),u=(0,C().YB)(),p=(0,a().qz)(void 0,Be().Z),[g,S,h,f,y,v]=(0,a().VK)((()=>[o.getName(),o.getType(),o.getFormat().collection_view_icon,o.getFormat().description,o.getCollectionStore(),t.permissionScopesStore.state.canConfigureBlock]),[o,t]),x=(0,a().VK)((()=>null!=y&&y.isDefined()?(0,fg().Xh)(y.getName(),y)||y.getModel().getEmptyTitlePlaceholder({intl:u}):(0,hg().Q2)(u)),[y,u]),b=(0,n.useCallback)((e=>{p.setState({open:!1}),e&&i()}),[p,i]),{renderMenu:w}=Mg({collectionViewStore:o,collectionContextStore:t,onClose:b});return void 0===S?null:(0,m.jsx)(Tt().Z,{renderTooltip:e=>(0,m.jsxs)("div",{...e,style:Gc().F6,children:[(0,m.jsx)("div",{children:(0,F().Cc)({collectionViewName:g,collectionViewType:S})}),void 0!==y&&(0,m.jsx)("div",{style:d.tooltipMessage,children:f||(0,m.jsx)(C()._H,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} Form {Form} Chart {Chart view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:gt().Bh[S],collection:x}})})]}),placement:Me().Placement.Left,render:e=>(0,m.jsx)(Or().Z,{title:(0,m.jsx)(yg().Z,{collectionViewType:S,collectionViewName:g}),icon:(0,m.jsx)(mg().F,{color:"regular",viewIcon:h,viewType:S}),showDragHandle:!l.isMobile&&v,right:v?(0,m.jsx)(Dr().ZP,{popupType:l.isMobile?Dr().Z4.BottomSheet:Dr().Z4.Popup,renderOrigin:e=>(0,m.jsx)(jt().Z,{icon:_n().o,ariaLabel:u.formatMessage({id:"collectionViewSelectItem.viewSettings.ariaLabel",defaultMessage:"Database view settings"}),...e}),render:w,buttonPopupStore:p}):null,rightStyle:{marginRight:8},...(0,Mr().Z)(e,r)})})}function Kg(e){const{collectionContextStore:t,onAddViewClick:r,onClose:i,onViewClick:l}=e,c=(0,C().YB)(),d=(0,s().Fy)(),[u,p]=n.useState(0),[g,S]=n.useState(""),h=(0,a().qz)(void 0,o(692304).Z),f=(0,a().VK)((()=>{var e;return!(d.isMobile||null!==(e=t.collectionViewBlockStore())&&void 0!==e&&e.isCollectionViewPageWithContent())}),[t,d.isMobile]),y=(0,a().VK)((()=>{var e;return((null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]).filter((e=>(0,F().D)(e,g)))}),[t,g]),v=(0,a().VK)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),x=(0,a().VK)((()=>(0,F().kn)(t,d)),[t,d]),b=n.useCallback((e=>{S(e.target.value),h.setState({...h.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[h]);n.useEffect((()=>{var e,o;const n=null===(e=t.collectionViewStore())||void 0===e?void 0:e.id,r=((null===(o=t.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())||[]).findIndex((e=>e.id===n));r>=0&&p(r)}),[t]);const w=!d.isMobile&&v;return(0,m.jsx)(tt().Z,{capture:!0,allowEsc:!0,render:e=>{let n;return n=d.isPhone?{menuType:fr().o.Modal,title:(0,m.jsx)(Og,{collectionContextStore:t}),right:(0,m.jsx)(br().DoneMenuText,{}),onClickRight:i}:{menuType:fr().o.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh"},(0,m.jsxs)(vr().Z,{...n,...e,header:f?(0,m.jsx)(os().ZP,{value:g,focus:!0,style:{marginTop:8,marginBottom:4},textWrapperStyle:{marginLeft:8,marginRight:8},onChange:b,placeholder:c.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})}):null,footer:w&&(0,m.jsxs)(Cr().Z,{topBorder:!0,children:[(0,m.jsx)(Hg,{collectionContextStore:t,onClose:i,onAddViewClick:r}),x?null:(0,m.jsx)(o(5317).Z,{collectionContextStore:t,onClose:i,focused:!1,isCompact:!0})]}),children:[(0,m.jsx)(Dg,{collectionContextStore:t,filteredViewStores:y,isDraggable:w&&""===g,menuListStore:h,initialMenuListFocus:u,onClose:i,onViewClick:l}),g&&0===y.length&&(0,m.jsx)(o(178498).Z,{caption:(0,m.jsx)(C()._H,{defaultMessage:"No results",id:"database.collectionViewSelect.noResultsTitle"})}),d.isMobile?(0,m.jsx)(Hg,{collectionContextStore:t,onClose:i,onAddViewClick:r}):null]})}})}const Lg=n.memo(Kg);function Og(e){let{collectionContextStore:t}=e;const o=(0,a().VK)((()=>{var e;return(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]}),[t]);return(0,m.jsx)(C()._H,{defaultMessage:"{numberOfViews, plural, one {{numberOfViews} view} other {{numberOfViews} views}}",id:"database.mobileSelectViewMenu.title",values:{numberOfViews:o.length}})}function Dg(e){const{collectionContextStore:t,onViewClick:o,onClose:r}=e,i=(0,s().O7)(),l=n.useCallback(((e,n)=>{const l=t.collectionViewStore(),s=fe().DJ(e);l&&o({currentCollectionViewStore:l,newCollectionViewStore:n,openInNew:s});const a=t.isFullScreenStore.state,c=t.isRootChildStore.state,d=t.isInPeekRendererStore.state;(0,Sg().f)({environment:i,collectionContextStore:t,collectionViewId:n.id,openInNew:s,isFullScreen:a,isRootChild:c,isInPeekRenderer:d}),w().wd({environment:i,collectionContextStore:t,action:"click_view_in_dropdown",new_view_type:n.getType(),new_view_id:n.id}),s||r()}),[t,i,o,r]);if(0===e.filteredViewStores.length)return null;const a={key:"views",render:t=>(0,m.jsx)(Eg,{menuListSectionProps:t,collectionContextStore:e.collectionContextStore,filteredViewStores:e.filteredViewStores,isDraggable:e.isDraggable,menuListStore:e.menuListStore}),items:e.filteredViewStores.map((t=>({key:t.id,render:o=>(0,m.jsx)(Ag,{collectionContextStore:e.collectionContextStore,onClose:e.onClose,collectionViewStore:t,props:o}),action:e=>{let{event:o}=e;l(o,t)}})))};return(0,m.jsx)(xr().ZP,{type:xr().iW.Vertical,initialFocus:e.initialMenuListFocus,sections:[a],store:e.menuListStore})}function Eg(e){const t=(0,s().O7)(),o=(0,a().VK)((()=>e.filteredViewStores.map((e=>e.id))),[e.filteredViewStores]),r=n.useCallback(((o,n)=>{const r=e.collectionContextStore.collectionViewBlockStore();r&&(I().createAndCommit({userAction:"CollectionViewSelect2.handleViewsDrop",environment:t,canUndo:!0,perform:e=>{pg({collectionViewBlockStore:r,newViewIds:o,transaction:e})}}),e.menuListStore.reset())}),[t,e.collectionContextStore,e.menuListStore]);return e.isDraggable?(0,m.jsx)(Cr().Z,{...e.menuListSectionProps,children:(0,m.jsx)(Dl().ZP,{direction:"vertical",keys:o,renderKey:t=>e.menuListSectionProps.children[o.indexOf(t)],onDrop:r})}):(0,m.jsx)(Cr().Z,{...e.menuListSectionProps})}function Ag(e){let{collectionViewStore:t,props:o,collectionContextStore:n,onClose:r}=e;return(0,m.jsx)(Fg,{collectionContextStore:n,collectionViewStore:t,onClose:r,menuListItemProps:o})}function Hg(e){const t=(0,s().O7)(),o=(0,a().VK)((()=>{var t;if(!e.collectionContextStore.permissionScopesStore.state.canConfigureBlock)return!1;return!(0,pe().qG)((null===(t=e.collectionContextStore)||void 0===t||null===(t=t.collectionViewBlockStore())||void 0===t?void 0:t.id)??"")}),[e.collectionContextStore]),n=(0,a().VK)((()=>"viewsMain"===e.collectionContextStore.viewsModuleContextStore.getViewModuleType()),[e.collectionContextStore]);if(!o)return null;const r=(0,m.jsx)(C()._H,{defaultMessage:"New view",id:"database.collectionViewSelect.newViewButtonTitle"});return n?(0,m.jsx)(cg,{renderOrigin:e=>(0,m.jsx)(gg().Z,{onClick:()=>{e.onClick()},title:r,focused:!1}),onClose:e.onClose}):(0,m.jsx)(Dr().ZP,{popupType:t.device.isMobile?rs().kQ.SlideUp:rs().kQ.Popup,alignmentToOrigin:Dr().vR.Center,placementToOrigin:Dr().pO.Right,renderOrigin:e=>(0,m.jsx)(gg().Z,{...e,title:r,focused:!1}),render:t=>(0,m.jsx)(og().vE,{collectionContextStore:e.collectionContextStore,onClose:()=>{e.onClose(),t.close()},showNewViewItems:!1})})}var Zg=()=>o(253335),zg=()=>o(521045),Wg=()=>o(641506);const Gg=n.memo((function(e){var t,r;let{collectionViewStore:i,collectionContextStore:l,hideUnderline:d,onViewClick:u,disabled:p,variant:g="default"}=e;const S=(0,s().O7)(),h=(0,s().Fy)(),f=(0,c().Fg)(),[y,v]=(0,n.useState)(!1),x=(0,o(162178).oR)(),C=(0,ae().Dq)(),[V,j]=(0,a().VK)((()=>{var e;return[l.viewsModuleContextStore.isInLayoutBuilder(),null===(e=l.viewsModuleContextStore.getViewsModule())||void 0===e?void 0:e.id]}),[l.viewsModuleContextStore]),T=(0,n.useCallback)((()=>{v(!1)}),[]),{renderMenu:P,hasMenuItems:I}=Mg({collectionViewStore:i,collectionContextStore:l,onClose:T}),R=(0,n.useCallback)((()=>{!C&&I&&v(!0)}),[C,I]),_=(0,n.useCallback)((e=>{e.preventDefault(),(0,ye().ZP)({event:e,context:ye().Af.EditorContextMenu,callback:R})}),[R]),M=(0,n.useCallback)((e=>{const t=l.collectionViewStore();if(!t)return;const o=l.viewsModuleContextStore.state?void 0:fe().DJ(e);if(u({currentCollectionViewStore:t,newCollectionViewStore:i,openInNew:o}),t.id===i.id?R():function(e,t,o,n){(0,Sg().f)({environment:o,collectionContextStore:t,collectionViewId:e,openInNew:n,isFullScreen:t.isFullScreenStore.state,isRootChild:t.isRootChildStore.state,isInPeekRenderer:t.isInPeekRendererStore.state})}(i.id,l,S,o),V&&x){var n;const e=null===(n=l.viewsModuleContextStore.getViewsModule())||void 0===n?void 0:n.id;e&&(x.setModuleSelection({type:"existing_module",moduleId:e,isDragging:!1}),k().r$({collectionContextStore:l,collectionSettingsStore:l.settingsStore,closeOnEscape:!1}))}w().wd({environment:S,collectionContextStore:l,action:"click_view_tab",new_view_type:i.getType(),new_view_id:i.id})}),[l,u,R,i,V,x,S]),{currentViewStore:B,collectionViewBlockStore:K}=(0,a().VK)((()=>({currentViewStore:l.collectionViewStore(),collectionViewBlockStore:l.collectionViewBlockStore()})),[l]),{isDefinedCollectionViewStore:L,viewIcon:O,viewType:D}=(0,a().VK)((()=>({isDefinedCollectionViewStore:null==i?void 0:i.isDefined(),viewIcon:null==i?void 0:i.getFormat().collection_view_icon,viewType:null==i?void 0:i.getType()})),[i]),E=(null===(t=(0,F().jw)(l,f))||void 0===t?void 0:t.background)??"none",A=(0,n.useRef)(null),H=(0,a().VK)((()=>{var e,t;return!((null==K?void 0:K.getSpaceId())!==(null===(e=ft().default.state.currentSpaceStore)||void 0===e?void 0:e.id))&&i.getFormat().app_config_uri===rt().g3&&"sprint_board"===(null===(t=ft().default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.getFormat().special_page_for_pm_launch)}),[i,K]),Z=(0,a().VK)((()=>{var e;return!0===(null===(e=ft().default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.getFormat().is_asana_imported_project)&&l.isInPeekRendererStore.state}),[l]),z=(0,a().VK)((()=>{var e;const t=null===(e=l.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores();return t&&t.length>1}),[l]),W=(null==B?void 0:B.id)===i.id,G="pills"!==g&&!d&&W&&z,N=W&&V&&"existing_module"===(null==x||null===(r=x.currentModuleSelection)||void 0===r?void 0:r.type)&&x.currentModuleSelection.moduleId===j;return L&&B&&K?(0,m.jsx)(rs().ZP,{popupType:h.isMobile?rs().kQ.BottomSheet:rs().kQ.Popup,alignmentToOrigin:Me().Alignment.Start,open:y,render:P,onDismiss:T,trapFocus:!0,origin:(0,m.jsxs)("div",{className:me().rTm,style:{display:"flex",alignItems:"center",background:V?void 0:E,height:"100%",...G&&{borderBottom:`2px solid ${f.regularTextColor}`,paddingTop:2},..."pills"===g?{marginRight:2}:void 0},onContextMenu:_,children:[H&&(0,m.jsx)(yn().FF,{origin:A}),Z&&(0,m.jsx)(Wc().LS,{origin:A,store:l}),(0,m.jsx)(Ng,{collectionViewStore:i,render:e=>(0,m.jsxs)(et().D,{"aria-selected":W,role:"tab",ref:A,size:"pills"===g?"lg":"md",style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:b().Ue.medium,color:W?f.regularTextColor:f.mediumTextColor,maxWidth:qg,..."pills"===g?{borderRadius:20,padding:"6px 12px"}:{},...V?N?(0,Wg().x6)({width:3,color:f.stroke.uiBluePrimary}):(0,Wg().x6)({width:1.5,color:f.stroke.uiBlueSecondary}):void 0,...V?{marginRight:4,transition:"box-shadow 0.3s"}:void 0},hovered:V?W&&!N:"pills"===g?y||W:y,hoveredStyle:V?{...(0,Wg().x6)({width:3,color:f.stroke.uiBlueSecondary}),background:"none"}:void 0,pressedStyle:V?{...(0,Wg().x6)({width:3,color:f.stroke.uiBluePrimary}),background:"none"}:void 0,onClick:M,disabled:p,...e,children:[(0,m.jsx)(mg().F,{color:W?"regular":"light",viewIcon:O,viewType:D,style:{marginRight:6}}),(0,m.jsx)("span",{style:{...b().Yu,marginTop:1},children:(0,m.jsx)($g,{collectionContextStore:l,collectionViewStore:i})})]},i.id)})]})}):null}));function Ng(e){const t=(0,c().Fg)(),{collectionViewStore:o,render:n}=e,r=(0,q().Y$)(),i=(0,a().VK)((()=>{var e;const t=null===(e=o.getParentBlockStore())||void 0===e?void 0:e.id;return!!t&&((0,pe().qG)(t)&&r.isInHomeWidgetStore.state)}),[r.isInHomeWidgetStore,o]),[l,s]=(0,a().VK)((()=>{const e=o.getName(),t=o.getType(),n=(0,F().Cc)({collectionViewName:e,collectionViewType:t});if(!t)return[n,void 0];const r=o.getFormat().description;if(r)return[n,r];const i=o.getCollectionStore(),l=null==i?void 0:i.getName();if(i&&l){var s,a;if((null==i||null===(s=i.getParentBlockStore())||void 0===s?void 0:s.id)===(null===(a=o.getParentBlockStore())||void 0===a?void 0:a.id))return[n,(0,m.jsx)(C()._H,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} Form {Form} Chart {Chart view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:gt().Bh[t],collection:(0,fg().Xh)(l,i)}},"viewTab.tooltip.2")]}return[n,(0,m.jsx)(C()._H,{id:"collectionTabBar.viewTab.tooltip.default",defaultMessage:"{viewType} view",values:{viewType:gt().Bh[t]}},"viewTab.tooltip.2")]}),[o]);return l?(0,m.jsx)(Tt().Z,{placement:i?Me().Placement.Top:Me().Placement.Bottom,originGap:i?0:void 0,alignment:Me().Alignment.Start,delayThreshold:500,style:i?{marginBottom:-5,marginLeft:8}:{},render:e=>i?(0,m.jsx)("div",{style:{marginLeft:-8},children:n(e)}):n(e),renderTooltip:e=>i?(0,m.jsx)(C()._H,{id:"collectionTabBar.myTasksWidget.tooltip",defaultMessage:"See all your tasks in one place"}):(0,m.jsxs)("div",{...e,style:Gc().F6,children:[l,(0,m.jsx)("div",{style:{color:t.mediumInvertedTextColor},children:s})]})}):null}function Ug(e,t,o){var n;const r=e.collectionStore();if(!r)return t.getName();const i=r.getPropertyMapping(),l=t.getName(),s=null==i?void 0:i[rt().Es.TaskToSprintRelation];if(!o||!s||l!==ht().Z.formatMessage(Zg().sY.tasksCurrentSprintV2ViewName))return t.getName();const a=o[s];if(!a||"relation"!==a.type||!a.collection_pointer)return t.getName();const c=null===(n=(0,zg().As)(e,"current",a.collection_pointer,r))||void 0===n?void 0:n.getBlockTitleStore().getValue();return c?`${ht().Z.formatMessage(Zg().sY.tasksCurrentSprintV2ViewNamePrefix)}: ${c[0]}`:t.getName()}function $g(e){const{collectionViewStore:t,collectionContextStore:o}=e,[n,r]=(0,a().VK)((()=>{const e=o.settingsStore.state;return[e.open,v().Z$(e.stack)]}),[o.settingsStore]),i=(0,a().VK)((()=>o.viewsModuleContextStore.state),[o.viewsModuleContextStore]),l=(0,a().VK)((()=>o.collectionViewStore()),[o]),s=(0,a().VK)((()=>t.getCollectionStore()),[t]),c=(0,a().VK)((()=>{if(t.isDefined()){return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===rt().g3&&null!=s&&s.isDefined()?{name:Ug(o,t,s.getSchema()),type:t.getType()}:{name:t.getName(),type:t.getType()}}}),[t,s,o]),d=n&&r&&("duplicateExistingView"===r.type||"createView"===r.type);return!c||(null==l?void 0:l.id)===t.id&&d&&!i?(0,m.jsx)(C()._H,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):(0,m.jsx)(yg().Z,{collectionViewName:c.name,collectionViewType:c.type})}const qg=220,Yg=n.memo((function(e){const{collectionContextStore:t,showHoverActionsStore:r,isPlaceholderExternalCollection:i,showOnlyCurrentView:l,onViewClick:d,disabled:u,variant:p="default"}=e,g=(0,n.useRef)(new(We().E)({throttleMs:50})),S=(0,n.useRef)(new Map),h=(0,s().O7)(),f=(0,s().MO)(),y=(0,c().Fg)(),v=(0,n.useRef)(null),x=(0,n.useRef)(null),k=(0,a().Kw)(r),V=(0,ae().Dq)(),j=(0,n.useRef)(null),{permissionScopes:T,isFullScreen:P,isInHomeWidget:R,isInCollectionViewPageWithContent:_,isEditingViewsModuleInPageBuilder:M}=(0,a().VK)((()=>{var e;return{permissionScopes:t.permissionScopesStore.state,isFullScreen:t.isFullScreenStore.state,isInHomeWidget:t.isInHomeWidgetStore.state,isInCollectionViewPageWithContent:null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent(),isEditingViewsModuleInPageBuilder:t.viewsModuleContextStore.isInLayoutBuilder()}}),[t]),B=(0,a().VK)((()=>{var e;return l?[]:(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[t,l]),K=(0,a().VK)((()=>Boolean(Ee().ZP.state.showOnboardingTour&&"database-views-and-filters-tooltip"===(0,o(731322).wF)(ft().default.state.currentUserSettingsStore,"jira-sync-onboarding"))),[]);(0,n.useEffect)((()=>{const e=g.current;return()=>{e.destroy()}}),[g]);const L=(0,n.useCallback)((e=>{let t=S.current.get(e.id);t||(t=new sg({style:{fontSize:`${b().JB.UIRegular.desktop}px`,fontWeight:b().Ue.medium}}),S.current.set(e.id,t));const o=(0,F().Cc)({collectionViewName:e.getName(),collectionViewType:e.getType()}),n=t.measure(o);return Math.min(40+n.width,qg)}),[S]),O=(0,a().VK)((()=>function(e,t,o,n){var r;if("collectionSettings"===e.contextType)return!1;if(n||t||o)return!1;if(!e.permissionScopesStore.state.canConfigureBlock)return!1;const i=null===(r=e.collectionViewBlockStore())||void 0===r?void 0:r.id;if(i&&(0,pe().qG)(i))return!1;return!0}(t,i,(null==V?void 0:V.isPreviewing)??!1,l)),[t,i,null==V?void 0:V.isPreviewing,l]),D=(0,a().VK)((()=>{const e=t.collectionViewStore();if(!e)return;if("collectionSettings"===t.contextType)return[];const o=Math.max(100,O?105:0);let n=g.current.rect.state.width-o;const r=[],i=L(e);if(!(i<n))return r;r.push(e),n-=i;for(const t of B){if(t.id===e.id)continue;const o=L(t);if(!(o<n))break;r.push(t),n-=o}const l=r.filter((t=>t.id!==e.id)),s=B.findIndex((t=>t.id===e.id));return l.splice(s,0,e),l}),[t,O,L,B]),E=(0,a().VK)((()=>"collectionSettings"===t.contextType),[t]),A=(0,n.useMemo)((()=>{const e=(null==D?void 0:D.length)||0,t=B.length-e,o=D&&(0===e||1===e&&B.length>1)||f||_||R,n=E?"allTabsVisible":o?"dropdown":t>0?"someTabsNotVisible":"allTabsVisible";return{showMoreViewsButton:"someTabsNotVisible"===n||"dropdown"===n,showAddViewButton:O&&"allTabsVisible"===n,addViewButtonAnimatedIn:P||k||M,viewSelectState:n,moreViewsCount:t}}),[D,B,f,_,R,O,P,k,M,E]),H=(0,n.useCallback)((e=>{e&&g.current.observe(e)}),[g]),Z=(0,n.useMemo)((()=>{if(D&&"dropdown"!==A.viewSelectState)return!T.canConfigureBlock||null!=V&&V.isPreviewing?D.map(((e,o)=>{const r=n.createRef();return 0===o&&K?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{ref:r,style:{boxShadow:tg().v.outlineBlueInputBoxShadow.light,borderRadius:6},children:(0,m.jsx)(Xg,{collectionContextStore:t,onViewClick:d,disabled:u,collectionViewStore:e,showOnlyCurrentView:l,variant:p},e.id)}),(0,m.jsx)(ng().Pe,{origin:r})]}):(0,m.jsx)(Xg,{collectionContextStore:t,onViewClick:d,disabled:u,collectionViewStore:e,showOnlyCurrentView:l,variant:p},e.id)})):(0,m.jsx)(Dl().ZP,{direction:"horizontal",keys:D.map((e=>e.id)),style:{height:"100%"},disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:(e,o)=>{const r=D.find((t=>t.id===e));if(r){const e=n.createRef();return 0===o&&K?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{ref:e,style:{boxShadow:tg().v.outlineBlueInputBoxShadow.light,borderRadius:6},children:(0,m.jsx)(Xg,{collectionContextStore:t,onViewClick:d,disabled:u,collectionViewStore:r,showOnlyCurrentView:l,variant:p},r.id)}),(0,m.jsx)(ng().Pe,{origin:e})]}):(0,m.jsx)(Xg,{collectionContextStore:t,onViewClick:d,disabled:u,collectionViewStore:r,showOnlyCurrentView:l,variant:p})}},onDrop:e=>function(e,t,o){const n=o.collectionViewBlockStore();if(!n)return;I().createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:t,canUndo:!0,perform:t=>{pg({collectionViewBlockStore:n,newViewIds:e,transaction:t})}})}(e,h,t)})}),[D,A.viewSelectState,T.canConfigureBlock,t,d,u,V,l,h,K,p]),z=(0,n.useCallback)((e=>{const{device:o}=h,n=t.collectionViewStore();if(null!=n&&n.isDefined()){if("dropdown"===A.viewSelectState){var r;const i=n.getType(),l=n.getFormat().collection_view_icon,s=u||R,a="page"===n.getType()&&(null===(r=t.collectionStore())||void 0===r?void 0:r.getFormat().app_config_uri)===rt().GZ;return(0,m.jsxs)(m.Fragment,{children:[!o.isMobile&&a&&"home"===Mc().B1()&&(0,m.jsx)(rg,{origin:v}),(0,m.jsx)(Ng,{collectionViewStore:n,render:r=>(0,m.jsxs)(et().D,{ref:v,style:{display:"flex",alignItems:"center",fontSize:s?b().JB.UISmall.desktop:b().JB.UIRegular.desktop,fontWeight:b().Ue.semibold,color:s?y.mediumTextColor:y.regularTextColor,maxWidth:"form_editor"===i&&o.isMobile?120:qg,paddingRight:s?0:void 0,..."pills"===p?{borderRadius:20}:void 0},hovered:"pills"===p||void 0,size:"pills"===p?"lg":"md",disabled:u,...(0,Mr().Z)(e,r),children:[(0,m.jsx)(mg().F,{color:s?"lightGray":"regular",viewType:i,viewIcon:l,style:{marginRight:s?8:6,marginLeft:s?0:5},size:s?14:void 0}),(0,m.jsx)("span",{style:{...b().Yu,marginRight:6,marginTop:1},children:(0,m.jsx)($g,{collectionContextStore:t,collectionViewStore:n})}),!u&&(0,Ki().i)({marginTop:2,width:10,height:10,fill:y.lightIconColor,marginRight:6})]})})]})}return"someTabsNotVisible"===A.viewSelectState?(0,m.jsx)(et().D,{style:{display:"flex",alignItems:"center",fontSize:b().JB.UIRegular.desktop,color:y.mediumTextColor,..."pills"===p?{borderRadius:20}:{}},size:"pills"===p?"lg":"md",...e,children:(0,m.jsx)("span",{style:{marginTop:1},children:(0,m.jsx)(C()._H,{defaultMessage:"{moreViewsCount} more…",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:A.moreViewsCount}})})}):void 0}}),[t,u,h,R,A.moreViewsCount,A.viewSelectState,y,p]),W=(0,n.useCallback)((e=>{var n;const{device:r}=h,i=(null===(n=t.collectionStore())||void 0===n?void 0:n.getFormat().app_config_uri)===rt().GZ;return(0,m.jsxs)(m.Fragment,{children:[!r.isMobile&&"views"===Mc().B1()&&i&&(0,m.jsx)(ig,{origin:x}),(0,m.jsx)("div",{ref:x,children:(0,m.jsx)(Lg,{collectionContextStore:t,onClose:e.close,onViewClick:d,onAddViewClick:e=>function(e,t,n){I().createAndCommit({userAction:e,environment:t,canUndo:!0,perform:e=>{(0,o(697132).M)({environment:t,collectionContextStore:n,newViewType:"table",transaction:e})}}),w().xb({environment:t,collectionContextStore:n,view_type:"table"})}(e,h,t)})})]})}),[t,h,d]),G=(0,n.useCallback)((e=>{(0,ye().ZP)({event:e,context:ye().Af.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]);return(0,m.jsx)(Ue().D1,{collectionContextStore:t,step:"views",containerRef:j,children:(0,m.jsx)("div",{role:"tablist",style:{display:"flex",alignItems:"center",height:"100%",flexGrow:1,overflow:"hidden",...M?{paddingLeft:2}:{}},ref:H,children:(0,m.jsxs)("div",{ref:j,style:{display:"flex",alignItems:"center",flexShrink:1,height:"100%"},children:[Z,A.showMoreViewsButton&&(0,m.jsx)("div",{onMouseDown:G,children:(0,m.jsx)(Dr().ZP,{popupType:f?rs().kQ.SlideUp:rs().kQ.Popup,render:e=>W(e),renderOrigin:z,onClick:()=>function(e,t){w().wd({environment:e,collectionContextStore:t,action:"click_views_dropdown"})}(h,t)})}),(0,m.jsx)(Qg,{renderState:A,collectionContextStore:t,preventRectangularSelection:G,variant:p,theme:y})]})})})}));function Qg(e){let{renderState:t,collectionContextStore:n,preventRectangularSelection:r,variant:i,theme:l}=e;const s=(0,a().VK)((()=>"viewsMain"===n.viewsModuleContextStore.getViewModuleType()),[n]);if(!t.showAddViewButton)return null;let c=null;return c=s?(0,m.jsx)(cg,{renderOrigin:e=>(0,m.jsx)(jt().Z,{ariaLabel:"Add view",className:me().rVO,icon:lo().R,...e,style:{..."pills"===i?{height:32,width:32,borderRadius:"100%"}:void 0,background:"light"===l.mode?l.accentColors.uiBlue[100]:l.accentColors.uiBlue[200]},hoveredStyle:{color:l.accentColors.uiBlue[600],background:"light"===l.mode?l.accentColors.uiBlue[200]:l.accentColors.uiBlue[300]},pressedStyle:{color:l.accentColors.uiBlue[600],background:"light"===l.mode?l.accentColors.uiBlue[300]:l.accentColors.uiBlue[400]},iconStyle:{fill:l.accentColors.uiBlue[600]}})}):(0,m.jsx)(Dr().ZP,{popupType:Dr().Z4.Popup,alignmentToOrigin:o(627990).v2.Center,render:e=>(0,m.jsx)(og().vE,{collectionContextStore:n,onClose:e.close,showNewViewItems:!0}),renderOrigin:e=>(0,m.jsx)(jt().Z,{ariaLabel:"Add view",className:me().rVO,icon:lo().R,...e,style:{..."pills"===i?{height:32,width:32,borderRadius:"100%"}:void 0}})},"suggested-views"),(0,m.jsx)(kt().Z,{visible:t.addViewButtonAnimatedIn,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},onMouseDown:r,children:c})}function Xg(e){let{collectionViewStore:t,collectionContextStore:o,onViewClick:n,disabled:r,showOnlyCurrentView:i,variant:l="default"}=e;return(0,m.jsx)(Gg,{collectionContextStore:o,collectionViewStore:t,onViewClick:n,disabled:r,hideUnderline:i,variant:l},t.id)}var Jg=()=>o(560287),eS=()=>o(511614),tS=()=>o(251932);function oS(e){const{collectionContextStore:t}=e,o=(0,a().VK)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getParentBlockStore();return o&&o.pathIsDead()}),[t]),{parentBlockStore:n,isParentCollectionDead:r}=(0,a().VK)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getParentBlockStore(),n=o&&(null==o?void 0:o.pathIsDead());return{parentBlockStore:o,isParentCollectionDead:n}}),[t]);return n&&(!o&&r)?(0,m.jsx)(nS,{parentBlockStore:n}):null}function nS(e){let{parentBlockStore:t}=e;const o=(0,s().O7)(),{isMobile:r}=(0,s().Fy)(),i=r?tS().Ht:tS().gq,l=(0,c().yK)((e=>({layoutComponent:{color:e.text.secondary,background:e.accentColors.gray[30],padding:"16px 16px 16px 12px",borderRadius:4,fontSize:14},trashIcon:{width:24,height:24,flexShrink:0,marginRight:10,padding:2},viewCollectionButton:{fontWeight:b().Ue.semibold},arrowIcon:{width:16,height:16,flexShrink:0,padding:2,marginLeft:4}})),[]),a=(0,n.useCallback)((()=>{(0,ue().K4)(o,"view_deleted_database_from_deleted_collection_view_banner"),eS().r({environment:o,store:t,pageVisitSource:Go().tY.LinkInPage})}),[o,t]);return(0,m.jsxs)(i,{style:l.layoutComponent,alignItems:"center",justifyContent:r?"":"space-between",children:[(0,m.jsxs)(tS().gq,{alignItems:"center",children:[(0,st().y)(l.trashIcon),(0,m.jsx)(C()._H,{id:"collectionViewBlock.deletedContainerBanner.collectionInTrash",defaultMessage:"The original database has been deleted and cannot be edited"})]}),(0,m.jsxs)(et().D,{style:l.viewCollectionButton,onClick:a,isLightGray:!0,children:[(0,m.jsx)(C()._H,{id:"collectionViewBlock.deletedContainerBanner.collection.viewCollectionButton",defaultMessage:"View database"}),(0,$a().k)(l.arrowIcon)]})]})}const rS=n.memo(oS);var iS=()=>o(650996);const lS=new(ee().Ss)("formEditorActionButtons",(()=>Promise.all([o.e(62743),o.e(52774),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(11189),o.e(53329),o.e(72586),o.e(46616),o.e(54940),o.e(20224),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(4014),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(80730),o.e(83962),o.e(62084),o.e(21862),o.e(41589),o.e(83837),o.e(22122)]).then(o.bind(o,842117)))),sS=(0,ee().iS)(lS,(e=>e.default));var aS=()=>o(867601),cS=()=>o(720029),dS=()=>o(877727),uS=()=>o(115098);function pS(){const e=(0,q().DK)(),t=(0,a().VK)((()=>Boolean(null==e?void 0:e.shouldShowSpinnerStore.state)),[null==e?void 0:e.shouldShowSpinnerStore]);return(0,qn().Z)(t,500,100)?(0,m.jsx)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginRight:4},children:(0,m.jsx)(sn().Z,{style:{width:14,height:14}})}):null}const mS=n.memo(pS);var gS=()=>o(570328),SS=()=>o(291198);const hS=(0,C().vU)({searchLabel:{defaultMessage:"Search",id:"database.searchButton.tooltip"},searchInputPlaceholder:{defaultMessage:"Type to search...",id:"database.searchInputPlaceholder"}}),fS=n.memo((function(e){let{collectionContextStore:t,isFullScreen:o,currentViewType:r,topbarIconButtonStyle:i}=e;const l=(0,s().O7)(),d=(0,a().Kw)(t.searchOpenStore),u=(0,a().VK)((()=>0===t.collectionStoresStore.state.length),[t]),p=(0,a().Kw)(t.searchQueryStore),g=(0,c().yK)((e=>({iconButton:{width:14,height:void 0,fill:e.mediumIconColor},input:{fontSize:14,lineHeight:1,paddingRight:4,color:e.regularTextColor,marginBottom:1},ignoreArea:{display:"flex",alignItems:"center",overflow:"hidden"}})),[]),S=(0,n.useCallback)((()=>{oe().default.reset(),ne().default.reset(),fd().Z.reset()}),[]),h=(0,n.useCallback)((()=>{t.searchQueryStore.setState(""),t.searchOpenStore.setState(!1)}),[t]),f=(0,n.useCallback)((()=>{t.searchQueryStore.state||h()}),[t,h]),y=(0,n.useCallback)((e=>{27===e.keyCode&&h()}),[h]),v=(0,n.useCallback)((()=>{t.searchOpenStore.update((e=>!e)),w().wd({environment:l,collectionContextStore:t,action:"click_topbar_search"})}),[t,l]),x=(0,n.useCallback)((e=>{(0,qo().U)({searchQuery:e.target.value,collectionContextStore:t,isFullScreen:Boolean(o)}),O().ik(l,{view_type:r})}),[t,r,l,o]),b=(0,pn().y)(x,250);return(0,m.jsx)(Tt().Z,{renderTooltip:()=>ht().Z.formatMessage(hS.searchLabel),render:e=>(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(jt().Z,{...e,icon:gS().e,iconStyle:g.iconButton,style:i,disabled:u,onClick:v,ariaLabel:ht().Z.formatMessage(hS.searchLabel)}),(0,m.jsx)(kt().Z,{visible:d,animate:{width:150,opacity:1},initial:{width:0,opacity:0},exit:{width:0,opacity:0},children:(0,m.jsx)(tt().Z,{capture:d,allowEsc:!0,render:e=>(0,m.jsx)("div",{...e,style:g.ignoreArea,children:(0,m.jsx)(SS().Z,{style:g.input,right:(0,m.jsx)(iS().LazyAssistantCollectionSearchInputButton,{collectionContextStore:t}),format:SS().B.Transparent,value:p,onChange:b,placeholder:ht().Z.formatMessage(hS.searchInputPlaceholder),focusInitial:d,showClearButton:!0,onFocus:S,onBlur:f,onCancel:h,onClick:ye().Wi,onClearButtonClick:h,onKeyDown:y})})})})]})})}),ao().Z),yS=fS;const vS={CollectionViewAddItemButtonTooltip:new(ee().Ss)("CollectionViewAddItemButtonTooltip",(async()=>Promise.all([o.e(62743),o.e(52774),o.e(73298)]).then(o.bind(o,253602))))},xS=(0,ee().kF)(vS.CollectionViewAddItemButtonTooltip,(e=>e.CollectionViewAddItemButtonTooltip)),bS=n.memo((function(e){let{store:t,settingsHeaderSizeObserver:r,handleAddItemClick:i,isTooltipVisible:l,collectionModel:d}=e;const u=(0,s().O7)(),{isMobile:p}=(0,s().Fy)(),g=(0,a().VK)((()=>(0,dS().mq)({disableExposureLogging:!0})),[]),S=(0,n.useRef)(null),h=(0,q().Y$)(),f=(0,a().VK)((()=>h.isMultiSourceView),[h]),y=(0,a().VK)((()=>(0,F().PI)(h)),[h]),v=(0,a().qz)(void 0,Be().Z),x=(0,a().VK)((()=>r.rect.state.width<=ph),[r]),b=(0,a().VK)((()=>{if(!h.isMultiSourceView)return;const e=h.collectionStoresStore.state;if(!e)return"loading";if(0===e.length)return"noDbs";const t=Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));return t?void 0:Bm}),[h]),k=!p&&x,V=f,j=(0,c().yK)((e=>({buttonWrapper:{position:"relative",marginLeft:k?4:2},buttonStyle:{fontSize:14,height:28},mainButtonStyle:k?{width:28}:{},iconStyle:k?{width:15,marginRight:0}:{},offlineMessage:{fontSize:14,color:e.mediumTextColor,width:280,padding:8}})),[k]),T=(0,n.useCallback)((()=>{l&&((0,o(110372).bl)(u,{callout_key:"collection_add_item_button_tooltip",dismiss_type:"tooltip_dismiss"}),(0,wa().Gi)(u,"collection_add_item_button_tooltip"))}),[u,l]),P=(0,n.useCallback)((()=>{w().wd({environment:u,collectionContextStore:h,action:"click_topbar_templates_dropdown"}),T()}),[h,u,T]),R=(0,a().VK)((()=>{const e=h.collectionStore();if(!e)return null;if(o(804217).default.state.online){const n=h.permissionScopesStore.state,r=e=>{I().createAndCommit({userAction:"CollectionViewBlock.handleTemplateEmptyPageClick",environment:u,canUndo:!0,perform:e=>{(0,_().N)({transaction:e,store:t,collectionContextStore:h,environment:u,shouldCoerce:!1,from:{createBlock:"cvb_template_empty_page"}})}}),v.reset()},i=e=>{o(295274).S6({environment:u,collectionContextStore:h,collectionViewBlockStore:t,templateStore:e.templateStore,useCrdt:e.useCrdt,isKeyboard:e.isKeyboard,from:{createBlock:"cvb_template",initCollection:"collection_view_block"},shouldCoerce:!0}),v.reset()},l=()=>{v.reset()};return(0,m.jsx)(o(39607).Z,{isOverlay:!0,collectionStore:e,canConfigureCollection:n.canConfigureCollection,onEmptyPageClick:r,onEmptyEnter:r,onTemplateClick:i,onCancelClick:l,locked:t.isNonEditableState()})}return(0,m.jsx)("div",{style:j.offlineMessage,children:(0,m.jsx)(C()._H,{defaultMessage:"Please go online to use a template.",id:"collectionViewBlock.actionBar.offlineTemplatePicker.message"})})}),[h,u,t,j.offlineMessage,v]),M=(0,n.useCallback)((e=>{var t;const o=null===(t=S.current)||void 0===t?void 0:t.getBoundingClientRect();o&&Id().Pz({environment:u,originRect:o,moveToContext:"aggregated_type",overrideDatabaseType:"notion://tasks_collection",onAccept:()=>{i(e)}})}),[u,i]),B=(0,n.useCallback)((e=>(0,m.jsx)(o(542401).Z,{ref:S,title:k?null:y,icon:k?o(490670).f:void 0,color:"blue",onClick:e=>{f?M(e):i(e),T()},mainButtonTooltip:b===Bm?(0,m.jsx)(C()._H,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"collectionViewBlock.addItem.tooltip.noWritableDbs",values:{br:(0,m.jsx)("br",{})}}):k?y:null,onDropdownClick:e.onClick,style:j.buttonStyle,mainButtonStyle:j.mainButtonStyle,iconStyle:j.iconStyle,className:me().sqL,disabled:Boolean(b),disableDropdown:V})),[y,V,T,i,f,b,M,k,j.buttonStyle,j.iconStyle,j.mainButtonStyle]),K=(0,n.useRef)(null),L=(0,n.useCallback)((e=>g?(0,m.jsx)(Ue().D1,{collectionContextStore:h,containerRef:K,step:"new_page",children:B(e)}):l?(0,m.jsx)(xS,{collectionModel:d,onDismiss:T,children:B(e)}):B(e)),[h,d,T,l,B,g]);return(0,m.jsx)(Dr().ZP,{popupType:p?Uc().k.SlideUp:Uc().k.Popup,render:()=>R,originGap:4,onClick:P,renderOrigin:e=>(0,m.jsx)("div",{style:j.buttonWrapper,ref:K,children:L(e)}),buttonPopupStore:v})}));var CS=()=>o(642966),wS=()=>o(887330);function kS(){const e=(0,s().O7)(),t=(0,q().Y$)(),r=(0,a().VK)((()=>t.settingsStore.state.open&&aS().Cf({tab:(0,CS().n)(t.settingsStore)})),[t]),i=(0,a().Kw)(t.isInHomeWidgetStore),l=(0,a().VK)((()=>t.aliveAutomationCountStore.state>0),[t]),d=(0,a().VK)((()=>t.collectionViewBlockStore()),[t]),u=(0,a().VK)((()=>{var e;return null===(e=ft().default.getState().mainEditorCurrentBlockStore)||void 0===e?void 0:e.pathIsDead()}),[]),p=(0,a().VK)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getParentBlockStore();return null==o?void 0:o.pathIsDead()}),[t]),g=(0,a().VK)((()=>null==d?void 0:d.isLocked()),[d]),S=(0,n.useMemo)((()=>(p||u)&&!l),[l,u,p]),h=(0,c().yK)((e=>({buttonStyle:(0,wS().C)({theme:e,isInHomeWidget:i}),iconStyle:{width:void 0,height:14,fill:l?e.icon.uiBluePrimary:e.mediumIconColor}})),[l,i]),f=(0,a().VK)((()=>aS().Li({collectionStore:t.collectionStore()})),[t]),y=(0,n.useCallback)((o=>{(0,ye().ZP)({event:o,context:ye().Af.CollectionAutomationSettingsClick,callback:()=>{const o=t.settingsStore,n=o.state.open,r=(0,CS().n)(o);n&&"automationSettings"===(null==r?void 0:r.type)?k().E3({collectionSettingsStore:o}):l||g||u||p||!f?(k().r$({collectionContextStore:t,collectionSettingsStore:o}),k().wl({collectionSettingsStore:o,item:{source:"collection_thunderbolt_icon",type:"automationSettings"}})):k().Uk({environment:e,collectionSettingsStore:o,collectionContextStore:t})}})}),[e,t,l,g,u,p,f]);return(0,m.jsx)(Tt().Z,{renderTooltip:()=>S?ht().Z.formatMessage(VS.disableAutomationsSettingsButtonTooltip):ht().Z.formatMessage(VS.openAutomationsSettingsButtonTooltip),render:e=>(0,m.jsx)(jt().Z,{ariaLabel:S?ht().Z.formatMessage(VS.disableAutomationsSettingsButtonAriaLabel):ht().Z.formatMessage(VS.openAutomationsSettingsButtonAriaLabel),className:me().RIA,icon:o(29248).K,style:h.buttonStyle,iconStyle:h.iconStyle,hovered:r,onClick:y,disabled:S,...e})})}const VS=(0,C().vU)({openAutomationsSettingsButtonTooltip:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.tooltip"},openAutomationsSettingsButtonAriaLabel:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.ariaLabel"},disableAutomationsSettingsButtonTooltip:{defaultMessage:"Can't add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.tooltip"},disableAutomationsSettingsButtonAriaLabel:{defaultMessage:"Can't add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.ariaLabel"}}),jS=n.memo(kS);var TS=()=>o(151861),PS=()=>o(765458),IS=()=>o(347577);const RS=(0,C().vU)({filterLabel:{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"}});function _S(e){let{createFilterSettingsStore:t}=e;const r=(0,q().Y$)(),i=(0,s().O7)(),{isMobile:l,isPhone:d}=(0,s().Fy)(),u=(0,a().VK)((()=>t.state.open),[t]),p=(0,a().VK)((()=>(0,xo().RL)({collectionContextStore:r,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}).length>0),[r]),g=(0,a().VK)((()=>(0,xo().yU)(r)),[r]),S=ht().Z.formatMessage(RS.filterLabel),h=(0,a().Kw)(r.isInHomeWidgetStore),f=(0,n.useCallback)((()=>{var e;const n=null===(e=r.collectionViewStore())||void 0===e?void 0:e.id,l=r.permissionScopesStore.state,s=r.isUnlistedViewStore.state&&r.isInlineViewStore.state,a=l.canConfigureBlock||s?r.currentCombinatorFilterStore.state:void 0,c=r.currentPropertyFiltersStore.state,u=r.filtersBarOpenStore.state;n&&!d&&((0,o(636785).E)({userId:i.currentUser.id,collectionViewId:n,isOpen:!u}),r.filtersBarOpenStore.setState(u)),h||s?u||c.length>0||a?k().wl({collectionSettingsStore:r.settingsStore,item:{type:"filters"}}):(k().wl({collectionSettingsStore:r.settingsStore,item:{type:"createFilter"}}),TS()._7(r)):u||c.length>0||a?r.filtersBarOpenStore.setState(!u):(k().wl({collectionSettingsStore:t,item:{type:"createFilter"}}),TS()._7(r)),w().wd({environment:i,collectionContextStore:r,action:"click_topbar_filter"})}),[r,t,i,h,d]),y=(0,n.useCallback)((()=>{k().E3({collectionSettingsStore:t})}),[t]),v=(0,c().yK)((e=>({buttonStyle:(0,wS().C)({theme:e,isInHomeWidget:h}),iconStyle:{width:16,height:void 0,fill:p?e.icon.uiBluePrimary:e.mediumIconColor},searchIcon:{width:14,fill:e.mediumIconColor,marginRight:6},tempFilterIndicator:{position:"absolute",top:3,right:2,background:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[300],border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9}})),[h,p]);return(0,m.jsx)(rs().ZP,{popupType:l?Dr().Z4.SlideUp:Dr().Z4.Popup,open:u,origin:(0,m.jsx)(Tt().Z,{renderTooltip:()=>S,render:e=>(0,m.jsxs)("div",{style:{position:"relative"},children:[(0,m.jsx)(jt().Z,{...e,ariaLabel:S,icon:o(185056).Q,iconStyle:v.iconStyle,style:v.buttonStyle,onClick:f}),g&&(0,m.jsx)("div",{style:v.tempFilterIndicator})]})}),onDismiss:y,originGap:4,render:()=>(0,m.jsx)(PS().PJ,{context:IS().HV.TopbarFilterPopup,collectionContextStore:r,collectionSettingsStore:t,hideDesktopHeader:!0})})}const MS=n.memo(_S);const BS=(0,C().vU)({openFullscreenPageButtonTooltip:{id:"database.collectionViewBlock.openFullscreenPageButton.tooltip",defaultMessage:"Open as full page"}});function FS(e){let{store:t,viewType:r}=e;const i=(0,s().O7)(),l=(0,q().Y$)(),d=(0,a().VK)((()=>(0,Cn().ZP)({store:t,fullyQualified:!1,pageVisitSource:Go().tY.Expand,demoSettingsStore:cS().Z})),[t]),u=(0,c().Fg)(),p=(0,a().VK)((()=>{const e=l.isInHomeWidgetStore.state;return(0,wS().C)({theme:u,isInHomeWidget:e})}),[l,u]),g=(0,n.useCallback)((()=>O().Ji(i,{view_type:r})),[i,r]),S=ht().Z.formatMessage(BS.openFullscreenPageButtonTooltip);return(0,m.jsx)(Tt().Z,{renderTooltip:()=>S,render:e=>(0,m.jsx)(jt().Z,{ariaLabel:S,href:d,onClick:g,icon:o(330404).Z,style:p,iconStyle:{width:16},...e})})}const KS=n.memo(FS);var LS=()=>o(552221),OS=()=>o(574089);class DS extends d().default{getInitialState(){return{query:"",limit:20}}}const ES=DS;var AS=()=>o(231219);const HS=(0,C().vU)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"collectionNoDateMenu.searchPlaceholder"}}),ZS=d().default.createClass(void 0,{name:"ResultStore"});function zS(e){let{collectionViewBlockStore:t,collectionViewType:r,property:i,collectionContextStore:l,onClose:c,onAddPage:d}=e;const u=(0,s().O7)(),p=(0,s().Fy)(),g=(0,a().qz)(void 0,ES),S=(0,a().qz)(void 0,ZS),h=(0,a().VK)((()=>g.state.query),[g]),f=(0,a().Kw)(S),y=(0,a().VK)((()=>{const{query:e,limit:t}=g.state;return{type:"results",filter:{operator:"and",filters:[{property:i,filter:{operator:"is_empty"}}]},limit:t,searchQuery:e}}),[i,g]),v=(0,n.useCallback)((e=>{g.setState({query:e.target.value,limit:NS})}),[g]),x=(0,n.useCallback)((e=>{const t=g.state.limit,o=l.isLoadingStore.state;e<GS&&f&&f.hasMore&&!o&&g.setState({...g.state,limit:t+NS})}),[l,f,g]),b=(0,n.useCallback)((()=>{let e;return e="calendar"===r?p.isMobile?(0,m.jsx)(C()._H,{defaultMessage:"Click to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt.basic"}):(0,m.jsx)(C()._H,{defaultMessage:"Click or drag to calendar to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt"}):(0,m.jsx)(C()._H,{defaultMessage:"Click to add to the timeline",id:"collectionNoDateMenu.addResultToTimeline.prompt"}),f?f&&0===f.blockIds.length?(0,m.jsx)(Cr().Z,{title:e,children:(0,m.jsx)(ns().Z,{title:(0,m.jsx)(C()._H,{defaultMessage:"No results",id:"collectionNoDateMenu.noResults.title"})})}):(0,m.jsx)(xr().ZP,{type:xr().iW.Vertical,sections:[{key:"results",render:t=>(0,m.jsx)(Cr().Z,{...t,title:e}),items:qS(f.blockIds,l,t,i,d,u,r)}],initialFocus:h?0:void 0}):(0,m.jsx)(Cr().Z,{children:(0,m.jsx)($S,{})})}),[t,r,f,l,i,d,u,h,p.isMobile]);return(0,m.jsxs)(o(788899).Tp,{title:void 0,onCancel:c,desktopWidth:320,children:[(0,m.jsx)(Cr().Z,{isInput:!0,children:(0,m.jsx)(os().ZP,{placeholder:ht().Z.formatMessage(HS.searchPlaceholder),focus:!p.isMobile||void 0,focusAfterAnimation:!0,value:h,onChange:v})}),(0,m.jsx)(So().Z,{id:"no_date_results",reducer:y,collectionContextStore:l,render:b,resultStore:S}),(0,m.jsx)(zo().Z,{onChange:x})]})}const WS=n.memo(zS,ao().Z),GS=200,NS=20;function US(e){let{props:t,store:o,disabled:r,url:i,collectionViewType:l}=e;const a=(0,s().O7)(),c=(0,s().Fy)(),d=n.useRef(null),u=(0,m.jsx)(AS().Z,{...t,ref:d,store:o,hidePath:!0,disabled:r,right:void 0!==i?(0,m.jsx)(et().D,{size:"sm",href:i,disabled:r,onClick:()=>{O().tM(a)},children:(0,m.jsx)(C()._H,{defaultMessage:"Open",id:"collectionNoDateMenu.view.button.label"})},o.id):void 0,dontShrinkRight:!0});return"calendar"!==l||c.isMobile?u:(0,m.jsx)(ot().Z,{canSelect:!1,canDrag:!r,canEditText:!1,store:o,shouldShowDropZone:!0,getGhostElement:()=>function(e){if(e.current){return[OS().eN(e.current)]}return[]}(d),analyticsName:"calendar_no_date_item",children:u})}function $S(){return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(ir().Z,{style:{display:"flex",height:16,marginTop:4,marginLeft:12,marginRight:12,borderRadius:12,width:"50%"}}),(0,m.jsx)(ir().Z,{style:{display:"flex",height:16,marginTop:6,marginLeft:12,marginRight:12,marginBottom:6,borderRadius:12,width:"75%"}})]})}function qS(e,t,o,n,r,i,l){const s=e.map((e=>te().G.createChildStore(o,{table:L().iU,id:e}))).filter((e=>!(0,LS().G)(e.getPropertyStore(n).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:o}=ft().default.state;if(!o)return;const n=(0,F().mb)({environment:i,store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1});return{key:e.id,render:t=>(0,m.jsx)(US,{props:t,store:e,disabled:!e.canEdit(),url:n,collectionViewType:l}),action:()=>{e.canEdit()&&(r(e),O().ze(i))}}}));return v().oA(s)}function YS(e){let{noDateTotal:t,noDateProperty:o,collectionViewType:r,timelineViewRef:i}=e;const l=(0,s().O7)(),{isMobile:d}=(0,s().Fy)(),u=(0,q().Y$)(),p=(0,a().VK)((()=>u.collectionViewBlockStore()),[u]),g=(0,n.useCallback)((()=>{w().wd({environment:l,collectionContextStore:u,action:"click_topbar_no_date"})}),[u,l]),S=(0,c().yK)((e=>({buttonStyle:(0,wS().L)({theme:e})})),[]),h=(0,n.useCallback)((e=>{const t=e.getAssociatedCollectionStore(),o=null==i?void 0:i.current;if(!t)return;const{performResult:n}=I().createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:l,canUndo:!0,perform:n=>"calendar"===r?(0,Hs().Fv)({environment:l,store:e,collectionStore:t,collectionContextStore:u,startDayOfWeek:pe().AK.state,transaction:n}):o?o.addBlockToView({store:e,transaction:n}):void 0});n&&T().Z5({environment:l,stores:[n]})}),[u,r,l,i]),f=(0,n.useCallback)((e=>p?(0,m.jsx)(WS,{collectionViewBlockStore:p,property:o,onClose:e.close,onAddPage:h,collectionViewType:r,collectionContextStore:u}):null),[u,p,r,o,h]);return(0,m.jsx)(Dr().ZP,{popupType:d?Uc().k.SlideUp:Uc().k.Popup,render:f,onClick:g,renderOrigin:e=>(0,m.jsx)(et().D,{isGray:!0,style:S.buttonStyle,...e,children:(0,m.jsx)(C()._H,{defaultMessage:"No date ({noDateTotal})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{noDateTotal:t>=Ir().GW?Ir().GW-1+"+":t}})})})}const QS=n.memo(YS);const XS=(0,C().vU)({sortLabel:{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"}});function JS(e){let{createSortSettingsStore:t}=e;const r=(0,q().Y$)(),{isMobile:i}=(0,s().Fy)(),l=(0,s().O7)(),d=(0,a().VK)((()=>t.state.open),[t]),u=(0,a().VK)((()=>r.currentSortsStore.state.length>0),[r]),p=(0,a().VK)((()=>(0,xo().Mj)(r)),[r]),g=(0,a().Kw)(r.isInHomeWidgetStore),S=(0,n.useCallback)((()=>{const e=r.permissionScopesStore.state.canConfigureBlock?r.currentCombinatorFilterStore.state:void 0,o=r.currentPropertyFiltersStore.state,n=r.filtersBarOpenStore.state,i=u||n||o.length>0||e;g&&k().wl({collectionSettingsStore:r.settingsStore,item:{type:u?"sort":"createSort"}}),i?g||(r.filtersBarOpenStore.setState(!n),u?k().wl({collectionSettingsStore:r.filterBarSortSettingsStore,item:{type:"sort"}}):k().wl({collectionSettingsStore:t,item:{type:"createSort"}})):g||k().wl({collectionSettingsStore:t,item:{type:"createSort"}}),w().wd({environment:l,collectionContextStore:r,action:"click_topbar_sort"})}),[r,t,l,u,g]),h=(0,n.useCallback)((()=>{k().E3({collectionSettingsStore:t})}),[t]),f=ht().Z.formatMessage(XS.sortLabel),y=(0,c().yK)((e=>({iconStyle:{width:21,height:void 0,fill:u?e.icon.uiBluePrimary:e.mediumIconColor},buttonStyle:(0,wS().C)({theme:e,isInHomeWidget:g}),tempSortIndicator:{position:"absolute",top:3,right:2,background:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[300],border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9}})),[u,g]);return(0,m.jsx)(rs().ZP,{popupType:i?Dr().Z4.SlideUp:Dr().Z4.Popup,open:d,origin:(0,m.jsx)(Tt().Z,{renderTooltip:()=>f,render:e=>(0,m.jsxs)("div",{style:{position:"relative"},children:[(0,m.jsx)(jt().Z,{...e,ariaLabel:f,icon:o(928595).j,iconStyle:y.iconStyle,style:y.buttonStyle,onClick:S}),p&&(0,m.jsx)("div",{style:y.tempSortIndicator})]})}),onDismiss:h,originGap:4,render:()=>(0,m.jsx)(PS().PJ,{context:IS().HV.TopbarSortPopup,collectionContextStore:r,collectionSettingsStore:t,hideDesktopHeader:!0}),trapFocus:!0})}const eh=n.memo(JS);function th(){const e=(0,s().O7)(),t=(0,q().Y$)(),r=(0,a().VK)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id}),[t]),i=(0,c().yK)((e=>({button:{display:"flex",alignItems:"center",fontSize:14,fontWeight:b().Ue.medium,color:e.mediumTextColor},searchIcon:{width:14,fill:e.mediumIconColor,marginRight:6}})),[]),l=(0,n.useCallback)((()=>{o(278275).Kf({environment:e,analyticsFrom:"wiki-home-collection-view"}),r&&o(625820).ZP.updateFilters({ancestors:[r]})}),[e,r]);return r?(0,m.jsxs)(et().D,{style:i.button,onClick:l,children:[(0,gS().e)(i.searchIcon),(0,m.jsx)(C()._H,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search"})]}):null}const oh=n.memo(th);function nh(e){let{showHoverActionsStore:t,isFullScreen:r,store:i,currentViewType:l,collectionContextStore:u,isPlaceholderExternalCollection:p,settingsHeaderSizeObserver:g,createFilterSettingsStore:S,createSortSettingsStore:h,isInHomeWidget:f,handleAddItemClick:y,headerSizeObserver:v,timelineViewRef:x,allowedActions:b}=e;const C=(0,s().O7)(),w=(0,c().Fg)(),{isPhone:k,isMobile:V}=(0,s().Fy)(),j=(0,o(657320).l)(),T=(0,a().VK)((()=>(0,dS().mq)({disableExposureLogging:!0})),[]),P=(0,a().VK)((()=>u.collectionViewStore()),[u]),I=(0,a().VK)((()=>"view"===o(890324).Z.getMode(C,i).permission),[C,i]),R=(0,a().VK)((()=>(void 0!==u.collectionStore()||"collectionTypedView"===u.contextType)&&!p&&g.rect.state.width>=ph),[u,p,g]),_=(0,a().VK)((()=>({blockId:cS().Z.getCurrentStepBlockId(),subStep:cS().Z.getCurrentStepSubStep()??""})),[]),M=(0,a().VK)((()=>{const e=j&&j.publicEditModeStore.state.hasPublicPermission;return!(!cS().Z.isActiveDemo()||!e)&&(!V&&_.blockId===i.id)}),[_.blockId,V,j,i.id]),B=(0,a().VK)((()=>!!M||t.state),[M,t]),F=(0,a().VK)((()=>{const e=v.rect.state;return!V&&e.width>0&&e.width<400}),[V,v.rect]),K=(0,n.useCallback)((e=>{(0,ye().ZP)({event:e,context:ye().Af.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]),L=(0,a().VK)((()=>{const e=null==P?void 0:P.getUnlistedStatus();return!0===(null==e?void 0:e.isUnlisted)&&!0===(null==e?void 0:e.isUnlistedFromSemanticQuery)}),[P]),O=(0,a().VK)((()=>{var e;return Boolean(null===(e=o(109083).Z.state.caches[o(473244).uw])||void 0===e?void 0:e.inMemoryRecordCache)}),[]),D=(0,a().VK)((()=>{if(F||r||k||!i.canEditCollection())return null;const e=g.rect.state.width<=ph;return(0,m.jsx)(o(986520).Z,{store:i,isInlineCollection:!0,hideText:e,buttonStyle:{marginLeft:4}})}),[r,k,g.rect,F,i]),E=(0,a().VK)((()=>{var e,t;if(!b||b.includes("noDate"))return"timeline"===l?null===(e=u.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by:"calendar"===l?null===(t=u.normalizedQueryStore.state)||void 0===t?void 0:t.calendar_by:void 0}),[b,u.normalizedQueryStore,l]),A=(0,a().qz)(void 0,d().default),H=(0,a().VK)((()=>{if(E)return{type:"aggregation",aggregation:{property:E,aggregator:"empty",enforceMaxAggregationLimit:!0}}}),[E]),Z=(0,a().VK)((()=>{if(H){const e=A.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}}),[H,A]),z=(0,a().VK)((()=>{if(!E||!Z||!R||F||"calendar"!==l&&"timeline"!==l)return null;const e=u.permissionScopesStore.state,t=u.collectionStore();return"collectionTypedView"===u.contextType||t&&e.canEditContent?(0,m.jsx)(QS,{noDateTotal:Z,noDateProperty:E,collectionViewType:l,timelineViewRef:x}):null}),[u,l,E,Z,R,F,x]),W=(0,n.useMemo)((()=>!R||"page"===l||"form_editor"===l||b&&!b.includes("filter")?null:M&&"filter"===_.subStep?(0,m.jsx)(uS().u,{subStep:"filter",step:"demo_collection",children:(0,m.jsx)(MS,{createFilterSettingsStore:S})}):(0,m.jsx)(MS,{createFilterSettingsStore:S})),[R,l,b,M,_.subStep,S]),G=(0,a().VK)((()=>{if(!R||"page"===l||"form_editor"===l||b&&!b.includes("sort"))return null;if("chart"===l){var e,t;const o=null===(e=u.collectionViewStore())||void 0===e?void 0:e.getChartConfig();if("placeholder"===(null==o?void 0:o.type)||"results-advanced"!==(null==o||null===(t=o.chartFormat)||void 0===t?void 0:t.mainSort))return null}return M&&"sort"===_.subStep?(0,m.jsx)(uS().u,{subStep:"sort",step:"demo_collection",children:(0,m.jsx)(eh,{createSortSettingsStore:h})}):(0,m.jsx)(eh,{createSortSettingsStore:h})}),[R,l,b,M,h,u,_]),N=(0,a().VK)((()=>!R||"chart"===l||"page"===l||p||!(0,aS().cB)(u)||I||b&&!b.includes("automations")?null:M&&"automations"===_.subStep?(0,m.jsx)(uS().u,{subStep:"automations",step:"demo_collection",children:(0,m.jsx)(jS,{})}):(0,m.jsx)(jS,{})),[u,l,p,R,b,_,M,I]),U=(0,a().VK)((()=>{return!R||"form_editor"===l||"chart"===l||F||b&&!b.includes("search")||p?null:"page"===l?null!==(e=u.collectionViewBlockStore())&&void 0!==e&&e.isCollectionViewPageWithContent()?(0,m.jsx)(oh,{}):null:(0,m.jsx)(yS,{collectionContextStore:u,isFullScreen:Boolean(r),currentViewType:l,topbarIconButtonStyle:(0,wS().C)({theme:w,isInHomeWidget:Boolean(f)})});var e}),[u,l,r,f,p,R,F,w,b]),$=(0,a().VK)((()=>{var e;return!R||b&&!b.includes("ai")||p||null!=u&&null!==(e=u.collectionStore())&&void 0!==e&&e.isSyncedCollection()?null:(0,m.jsx)(iS().LazyAssistantCollectionViewButton,{collectionContextStore:u})}),[u,p,R,b]),q=(0,n.useMemo)((()=>r||I||b&&!b.includes("fullScreen")?null:(0,m.jsx)(KS,{store:i,viewType:l})),[r,i,l,b,I]),Y=(0,a().VK)((()=>I||b&&!b.includes("viewSettings")||p?null:M&&"settings"===_.subStep?(0,m.jsx)(uS().u,{subStep:"settings",step:"demo_collection",children:(0,m.jsx)(Nm().kE,{collectionContextStore:u,style:(0,wS().C)({theme:w,isInHomeWidget:Boolean(f)})})}):(0,m.jsx)("div",{style:{position:"relative"},children:(0,m.jsx)(Nm().kE,{collectionContextStore:u,style:(0,wS().C)({theme:w,isInHomeWidget:Boolean(f)})})})),[u,f,p,w,b,M,_,I]),Q=(0,a().VK)((()=>R&&null!=b&&b.includes("saveOrOpenOverflow")?(0,m.jsx)(Nm().CI,{collectionContextStore:u,shouldHideSaveViewOption:L||O}):null),[R,b,u,L,O]),X=(0,a().VK)((()=>{var e,t;if("page"===l||"form_editor"===l||p||!u.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})||b&&!b.includes("addItem"))return null;const o=ka().default.isVisible("collection_add_item_button_tooltip")&&!(null===(e=u.collectionStore())||void 0===e||!e.getWorkflowTemplateId())&&(null==u?void 0:u.isEmptyStore.state)&&!T;return(0,m.jsx)(bS,{store:i,settingsHeaderSizeObserver:g,handleAddItemClick:y,isTooltipVisible:o,collectionModel:null===(t=u.collectionStore())||void 0===t?void 0:t.getModel()})}),[l,p,u,b,T,i,g,y]),J=(0,n.useMemo)((()=>"form_editor"!==l||b&&!b.includes("formActionButtons")?null:(0,m.jsx)(sS,{showCompactDesktopHeader:F,collectionContextStore:u})),[l,b,F,u]),ee=(0,a().VK)((()=>null!=b&&b.includes("closeCollectionViewInModal")&&u.isUnlistedViewStore.state?(0,m.jsx)(Nm().sr,{}):null),[b,u]),te=(0,a().VK)((()=>{const e=u.collectionViewStore(),t=u.collectionStore();return!(!e||!t)&&t.getSpaceId()!==e.getSpaceId()}),[u]),oe=(0,a().VK)((()=>te&&Le().default.checkGate({gateName:"collections_xws"})),[te]);return k?(0,m.jsxs)(kt().Z,{visible:B,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center"},children:[(0,m.jsx)(mS,{}),q,Y,X,J,Q]}):(0,m.jsxs)(kt().Z,{visible:B,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center",gap:2},onMouseDown:K,children:[(0,m.jsx)(mS,{}),oe&&(0,m.jsx)(qc,{type:"linkedView"}),D,H&&(0,m.jsx)(So().Z,{id:"no_date_count",collectionContextStore:u,reducer:H,resultStore:A}),z,W,G,N,$,U,q,Y,Q,X,J,ee]})}const rh=n.memo(nh);function ih(e){let{currentViewType:t,store:r,isFullScreen:i,hideViewTabBar:l,collectionViewHeaderText:s,headerActionsBehavior:u,allowedActions:p,isInHomeWidget:g,isMyTasksPage:S,isHomeCustomDbPage:h,showHoverActionsStore:y,headerSizeObserver:v,isPlaceholderExternalCollection:x,handleEditorMouseDown:b,handleHeaderMouseMove:C,handleHeaderMouseLeave:w,handleHeaderMount:V,handleSettingsHeaderMount:j,leftRightPaddingStore:T,headerHeightStore:P,canEdit:I,contentSizeObserver:R,settingsHeaderSizeObserver:_,viewSettingsPlacementStore:M,showOnlyCurrentView:B,switchViewMetric:K,handleAddItemClick:L,timelineViewRef:O,createFilterSettingsStore:D,filterBarCreateFilterSettingsStore:E,headerWrapStyle:A,headerRef:H,headerStyleOverrides:Z}=e;const z=(0,q().Y$)(),W=(0,ae().Dq)(),G=(0,a().qz)(void 0,d().default),N=(0,a().VK)((()=>{if(S){return{type:"results",filter:{operator:"and",filters:[]},limit:1}}}),[S]),U=(0,a().qz)(void 0,d().default),$=(0,a().VK)((()=>{if(h)return{type:"results",filter:{operator:"and",filters:[]},limit:1}}),[h]),Y=(0,a().qz)(void 0,Be().Z),Q=(0,a().qz)(void 0,d().default.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"})),X=(0,a().VK)((()=>T.state),[T]),J=(0,c().Fg)(),ee=(0,a().VK)((()=>{var e;const o=T.state,n=z.viewIsFlushToTopbar(),r=("timeline"===t||"table"===t)&&n||g||z.isUnlistedViewStore.state,i={left:null==o?void 0:o.paddingLeft,paddingLeft:g?Re().pW:void 0,width:"100%"};let l;return l=r?{}:null!==(e=z.viewsModuleContextStore)&&void 0!==e&&e.isInLayoutBuilder()?{boxShadow:`0 0.5px 0 ${J.stroke.uiBlueSecondary}`,marginBottom:.5}:{boxShadow:`0 1px 0 ${J.tableDividerColor}`,marginBottom:1},{headerPositioningStyle:i,headerStyle:{display:"flex",alignItems:"center",height:P.state,...l,...i,...Z},selectableStyle:{position:"relative"}}}),[T,z,t,g,P,Z,J.stroke.uiBlueSecondary,J.tableDividerColor]),te=(0,a().VK)((()=>r.isNonEditableState()),[r]),oe=(0,a().VK)((()=>{var e;return"viewsMain"===(null===(e=z.viewsModuleContextStore)||void 0===e?void 0:e.getViewModuleType())}),[z.viewsModuleContextStore]),ne=(0,a().VK)((()=>{var e;return!x&&!(null!=W&&W.hideViewBlockSource)&&z.shouldShowSourceStore.state&&!z.isUnlistedViewStore.state&&(null===(e=z.collectionStore())||void 0===e?void 0:e.canRead())}),[z,W,x]),re=(0,n.useCallback)((e=>{let{currentCollectionViewStore:t,newCollectionViewStore:o,openInNew:n}=e;if(t.id!==o.id&&!n){const e=t.getType(),n=o.getType();if(e&&n){var r;if(K)K.current={from:e,to:n,metric:Te().default.DO_NOT_USE_markLegacy("collections.switch_view_lag"),sizeHintAtStart:null===(r=z.remoteResultStore.state)||void 0===r?void 0:r.sizeHint};"form_editor"===e&&z.isClientModeEnabledStore.setState(!1),"form_editor"===n&&k().E3({collectionSettingsStore:z.settingsStore})}}}),[z.isClientModeEnabledStore,z.remoteResultStore,z.settingsStore,K]),ie=(0,n.useMemo)((()=>"hidden"===u?null:(0,m.jsx)(rh,{showHoverActionsStore:y,isFullScreen:i,store:r,currentViewType:t,collectionContextStore:z,isPlaceholderExternalCollection:x,settingsHeaderSizeObserver:_,createFilterSettingsStore:D,createSortSettingsStore:Q,isInHomeWidget:g,handleAddItemClick:L,headerSizeObserver:v,timelineViewRef:O,allowedActions:p})),[u,y,i,r,t,z,x,_,D,Q,g,L,v,O,p]),le=(0,n.useMemo)((()=>{if(!l)return(0,m.jsx)(Yg,{collectionContextStore:z,showHoverActionsStore:y,isPlaceholderExternalCollection:x,showOnlyCurrentView:B??!1,onViewClick:re,disabled:S,variant:oe?"pills":"default"})}),[l,z,y,x,B,re,S,oe]);return(0,m.jsxs)(Je().p,{allowSelectionWithin:!0,style:A,onMouseDown:b,onMouseMove:C,onMouseLeave:w,ref:(0,f().lq)(V,H),children:[i&&(0,m.jsx)(to,{currentViewType:t,headerSizeObserver:v,contentSizeObserver:R,settingsHeaderSizeObserver:_,headerHeightStore:P,viewSettingsPlacementStore:M,store:r,leftRightPaddingStore:T,isInHomeWidget:g,headerRef:H}),X&&(0,m.jsxs)(ot().Z,{store:r,shouldShowCopyLinkButton:te,analyticsName:(0,F().$l)(t),style:ee.selectableStyle,shouldShowHalo:!(i||g||null!=W&&W.isPreviewing),children:[(0,m.jsxs)("div",{style:ee.headerStyle,ref:j,children:[le,s,ie]}),N&&(0,m.jsx)(So().Z,{id:"tasks_results",collectionContextStore:z,reducer:N,resultStore:G}),$&&(0,m.jsx)(So().Z,{id:"custom_db_results",collectionContextStore:z,reducer:$,resultStore:U})]}),(0,m.jsxs)("div",{style:ee.headerPositioningStyle,dir:"ltr",children:[ne&&(0,m.jsx)(o(894704).Z,{store:r,collectionContextStore:z,isFullScreen:i,showHoverActionsStore:y,canEdit:I}),(0,m.jsx)(rS,{collectionContextStore:z}),(0,m.jsx)(lh,{collectionContextStore:z,showHoverActionsStore:y,filterBarCreateFilterSettingsStore:E,saveControlMoreActionsButtonPopupStore:Y,currentViewType:t,isInHomeWidget:g})]})]})}function lh(e){let{collectionContextStore:t,showHoverActionsStore:o,filterBarCreateFilterSettingsStore:n,saveControlMoreActionsButtonPopupStore:r,currentViewType:i,isInHomeWidget:l}=e;const c=(0,s().O7)(),d=(0,s().MO)(),u=(0,a().VK)((()=>(0,Bc().rs)(c)),[c]),p=(0,a().Kw)(t.filtersBarOpenStore),g=(0,a().Kw)(t.shouldShowSourceStore),S=(0,a().Kw)(t.completeSprintButtonContextStore),h=g?8:12;return"page"===i||"form_editor"===i||"feed"===i&&u||l?null:p?(0,m.jsx)(eg().ZP,{collectionContextStore:t,showHoverActionsStore:o,createFilterSettingsStore:n,saveControlMoreActionsButtonPopupStore:r}):S?(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:d?12:8,paddingTop:h},children:[(0,m.jsx)("div",{style:{flex:1}}),(0,m.jsx)(Jg().Z,{collectionContextStore:t})]}):null}const sh=n.memo(ih);var ah=()=>o(860715);class ch extends d().default{getInitialState(){return{stage:"NOT_TRACKING"}}}function dh(e,t,o,r){const i=(0,s().O7)(),c=(0,a().qz)(void 0,ch),d=(0,n.useRef)(0),u=(0,n.useRef)(t),p=(0,n.useRef)(),m=(0,n.useRef)(void 0),g=(0,n.useRef)(void 0),S=(0,n.useRef)(!0),h=(0,n.useRef)(!1),f=(0,n.useCallback)((()=>{"NOT_TRACKING"===c.state.stage&&(c.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"INITIAL"}),m.current=performance.now())}),[c]),y=(0,n.useCallback)((e=>{"NOT_TRACKING"===c.state.stage&&(c.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"NAVIGATION"}),e&&(p.current=e))}),[c]),v=(0,n.useCallback)((()=>{if(o.current)return;const t=c.state.stage;if("COUNTING_VISIBLE_ITEMS"===t){if(d.current++,1===d.current){const e=performance.now();l().default.afterNextFlush((()=>{"COUNTING_VISIBLE_ITEMS"===c.state.stage&&c.setState({stage:"SHOULD_TRACK",endTime:e,source:c.state.source})}))}}else"NOT_TRACKING"===t&&S.current&&(S.current=!1,Te().default.DO_NOT_USE_measureFromPageOriginLegacy({metricName:"missed_database_items_visible",endTime:performance.now()},{environment:i,data:ge().Pp({environment:i,collectionContextStore:e,visibleItemsCount:1,wasInitialRenderEmpty:h.current,isPrewarmedTab:(0,ve().isPrewarmedTabInitialRender)(i)})}))}),[e,o,i,c]),b=(0,n.useCallback)((()=>{g.current||(g.current=performance.now())}),[]),C=(0,n.useCallback)((t=>{t.state&&"COUNTING_VISIBLE_ITEMS"===c.state.stage&&(h.current=!0,e.isEmptyStore.removeListener(C),v())}),[e.isEmptyStore,v,c]),w=(0,n.useCallback)((t=>{if(!o.current&&"SHOULD_TRACK"===t.state.stage){const o=(0,ve().isPrewarmedTabInitialRender)(i),s=o?De().default.state.prewarmedTabAppStartTimeOverride:void 0,a=ge().Pp({environment:i,collectionContextStore:e,visibleItemsCount:d.current||0,wasInitialRenderEmpty:h.current,isPrewarmedTab:o});if("INITIAL"===t.state.source){var n,l;const c=(0,we().Z)(null===(n=e.collectionViewStore())||void 0===n?void 0:n.id),d=null===(l=i.prefetchCache)||void 0===l?void 0:l.getPrefetchAnalytic(c),p={cvbBlockRenderStart:u.current,cvbBlockRenderMount:m.current,itemsStart:g.current,itemsVisible:t.state.endTime},S=function(e){const{subMetricsTimes:t}=e,{cvbBlockRenderStart:o,cvbBlockRenderMount:n,itemsStart:r,itemsVisible:i}=t,l={"collections.await_page_chunk_end_to_cvb_start":void 0,"collections.cvb_start_to_cvb_mount":void 0,"collections.cvb_mount_to_items_start":void 0,"collections.items_start_to_items_visible":void 0},{await_page_chunk_start_to_await_page_chunk_end:s}=De().default.state.subMetricsStore.state,a=t=>{let{startTime:o,endTime:n}=t;if(e.isPrewarmedTab){if(n<=e.prewarmedTabNavigationStart)return 0;if(o<e.prewarmedTabNavigationStart&&n>e.prewarmedTabNavigationStart)return n-e.prewarmedTabNavigationStart}return n-o};return o&&s&&(l["collections.await_page_chunk_end_to_cvb_start"]=a({startTime:s.endTime,endTime:o}),(0,ah().b)({name:"collections.await_page_chunk_end_to_cvb_start",startTime:s.endTime,endTime:o})),o&&n&&(l["collections.cvb_start_to_cvb_mount"]=a({startTime:o,endTime:n}),(0,ah().b)({name:"collections.cvb_start_to_cvb_mount",startTime:o,endTime:n})),n&&r&&(l["collections.cvb_mount_to_items_start"]=a({startTime:n,endTime:r}),(0,ah().b)({name:"collections.cvb_mount_to_items_start",startTime:n,endTime:r})),r&&i&&(l["collections.items_start_to_items_visible"]=a({startTime:r,endTime:i}),(0,ah().b)({name:"collections.items_start_to_items_visible",startTime:r,endTime:i})),l}(o&&"number"==typeof s?{subMetricsTimes:p,isPrewarmedTab:!0,prewarmedTabNavigationStart:s}:{subMetricsTimes:p,isPrewarmedTab:!1}),h={...a,sub_metrics:S,initial_render_timings:e.timingTracker.getMetrics(p),includes_page_origin_to_app_start:!0};r&&Te().default.measureFromPageOrigin({metricName:"initial_database_items_visible",endTime:t.state.endTime},{environment:i,data:h,shouldSendIfStatsigNotInitialized:!0}),u.current&&(Te().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_to_items_visible",startTime:u.current,endTime:t.state.endTime},{environment:i,data:h,shouldSendIfStatsigNotInitialized:!0}),"hit-match"===(null==d?void 0:d.type)&&void 0!==d.finishedTimeMs&&d.finishedTimeMs>u.current&&Te().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_waiting_for_api",startTime:u.current,endTime:d.finishedTimeMs},{environment:i,data:a}))}else if("NAVIGATION"===t.state.source){if(p.current){const e={...a,wasm_sqlite_initialized:De().default.state.metricDataStore.state.wasm_sqlite_initialized,...He().Z.getDatabaseNavigationMetrics(p.current)};Te().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_items_visible",startTime:p.current,endTime:t.state.endTime},{environment:i,data:e})}u.current&&Te().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_mount_to_items_visible",startTime:u.current,endTime:t.state.endTime},{environment:i,data:a})}else(0,x().P)(t.state.source);t.setState({stage:"COMPLETED"}),d.current=0}}),[e,o,i,r]);return(0,n.useEffect)((()=>(c.addListener(w),()=>{c.removeListener(w)})),[w,c]),(0,n.useEffect)((()=>(e.isEmptyStore.addListener(C),()=>{e.isEmptyStore.removeListener(C)})),[e.isEmptyStore,C]),{handleInitialDatabaseRender:f,handleNavigationDatabaseRender:y,handleItemMount:v,handleItemsRenderStart:b}}function uh(e){const{collectionContextStore:t,collectionViewBlockRenderStartTime:o,didDelayOffscreenRenderRef:n,mountedBeforeInitialPageRender:r}=e,{handleInitialDatabaseRender:i,handleNavigationDatabaseRender:l,handleItemMount:s,handleItemsRenderStart:a}=dh(t,o,n,r);return t.databaseItemsVisibleTracker||(t.databaseItemsVisibleTracker={handleInitialDatabaseRender:i,handleNavigationDatabaseRender:l,handleItemMount:s,handleItemsRenderStart:a}),null}const ph=480,mh=n.memo(n.forwardRef((function(e,t){const{store:p,isFullScreen:g,viewsModuleContext:b,overrideViewType:C,headerActionsBehavior:L="default",overridePaddingLeft:O,overridePaddingRight:D,fullWidth:E,headerText:A,hideViewTabBar:H,headerAllowedActions:Z,maxHeight:z,disabled:W,forceLocalQueryCollection:G,isUnlistedView:N,viewId:U,onMount:$,setCollectionContextStore:Y,showOnlyCurrentView:Q,additionalCollectionViewInnerHorizontalPadding:X,templatePickerMenuListStore:J,mountedBeforeInitialPageRender:oe}=e,ne=(0,c().Fg)(),ie=(0,s().MO)(),le=(0,n.useRef)(null),Ne=(0,s().O7)(),$e=(0,ae().Dq)(),qe=(null==$e?void 0:$e.isPreviewing)??!1,Ye=(0,n.useMemo)((()=>new(Ke().Z)(Ne,$e)),[Ne,$e]),Qe=(0,n.useContext)(ce().U),et=Boolean(g)||qe,{didDelayOffscreenRenderRef:rt}=function(e){let{collectionContextStore:t,isFullScreen:r,rootRef:i}=e;const l=(0,je().E)("collections_delay_render_offscreen"),s=(0,n.useRef)(r),c=(0,n.useRef)(!1),d=(0,a().VK)((()=>o(158429).default.isOpen()),[]);return(0,n.useEffect)((()=>{if(!i.current||!l)return;if(s.current)return;if(d)return s.current=!0,void t.shouldDelayRenderStore.setState(!1);if(!i.current.parentElement)return;const e=new IntersectionObserver((o=>{const n=!o.reduce(((e,t)=>t.time>e.time?t:e),o[0]).isIntersecting;n?c.current=!0:(s.current=!0,e.disconnect()),t.shouldDelayRenderStore.setState(n)}));return e.observe(i.current.parentElement),()=>e.disconnect()}),[t,l,d,i]),{didDelayOffscreenRenderRef:c}}({collectionContextStore:Ye,isFullScreen:g,rootRef:le}),it=(0,a().qz)(void 0,o(619384).Z),lt=(0,n.useMemo)((()=>new(We().E)),[]),st=(0,n.useMemo)((()=>new(We().E)),[]),at=(0,n.useMemo)((()=>new(We().E)),[]),ct=(0,n.useRef)(null),dt=(0,n.useRef)(),ut=(0,n.useRef)(null),[pt]=(0,n.useState)((()=>performance.now())),mt=(0,n.useRef)(new Map),gt=(0,n.useRef)(),St=(0,n.useMemo)((()=>new Xe(Ye,Ne)),[Ye,Ne]),ht=(0,n.useRef)(),ft=(0,n.useRef)(),yt=(0,a().VK)((()=>Ye.collectionStore()),[Ye]),[vt,xt]=(0,n.useState)(!1),[bt,Ct]=(0,n.useState)(!1),[wt,kt]=(0,n.useState)(!1),Vt=(0,a().qz)(void 0,d().default.createClass({open:!1,stack:[]},{name:"createFilterSettingsStore"})),jt=(0,a().qz)(void 0,d().default.createClass({open:!1,stack:[]},{name:"filterBarCreateFilterSettingsStore"})),Tt=(0,a().qz)(void 0,d().default.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"})),Pt=(0,a().qz)(void 0,d().default.createClass(void 0,{name:"viewSettingsPlacementStore"})),It=(0,a().qz)(void 0,Be().Z);(0,o(932200).Y)(Ye);const Rt=(0,n.useCallback)((()=>{var e;return C??(null===(e=Ye.collectionViewStore())||void 0===e?void 0:e.getType())}),[C,Ye]),_t=(0,a().SI)((()=>(0,Ce().wq)(p)),[p]),Mt=(0,a().Kw)(_t),Bt=(0,a().Kw)(Ye.isInHomeWidgetStore),{isViewModule:Ft,isInLayoutBuilder:Kt}=(0,a().VK)((()=>{const e=Ye.viewsModuleContextStore;return{isViewModule:!!e.getViewModuleType(),isInLayoutBuilder:e.isInLayoutBuilder()}}),[Ye]),Lt=(0,a().VK)((()=>(0,F().Ks)(p)),[p]),Ot=(0,a().SI)((()=>{const e=(0,_e().$3)(Ne)-be().zL;if(Lt&&!g&&!(0,be().mO)(p,void 0,Ne)&&e>0&&!Bt)return e/2}),[Ne,Lt,g,p,Bt]),Dt=(0,a().Kw)(Ot),Et=(0,a().VK)((()=>{var e;return(null===(e=ct.current)||void 0===e?void 0:e.getStore().state.elementRef)??{current:null}}),[ct]),At=(0,n.useCallback)((e=>{var t,o;if(Ye.isInHomeWidgetStore.state)return;const n=Ye.normalizedFormatStore.state,r=null===(t=Et.current)||void 0===t?void 0:t.clientWidth;Ye.frozoneStore.setState({isScrolled:!1,scrollerWidth:r,scrollerLeftOffset:(null==ct||null===(o=ct.current)||void 0===o||null===(o=o.getClientRect())||void 0===o?void 0:o.left)??0,scrollerLeftPadding:Ot.state,frozenIndex:null==e?void 0:e.getTableFrozenColumnIndex(r,n),tryShowHiddenFrozenColumn:!1})}),[Ye,Et,Ot]),Ht=(0,a().VK)((()=>p.isRootOrDirectChild()),[p]),Zt=(0,a().VK)((()=>(0,se().fg)(Ne,p)),[Ne,p]),Wt=(0,a().SI)((()=>{const e=Rt(),t=(0,F().Bs)({environment:Ne,store:p,isFullScreen:g,sizeObserver:lt,viewType:e,collectionContextStore:Ye});return t&&void 0!==O&&(t.paddingLeft=O),t&&void 0!==D&&(t.paddingRight=D),t&&Ht&&Zt&&(0,be().mO)(p,void 0,Ne)&&"page"!==e&&(t.paddingRight+=se().QB),t}),[Ne,p,g,lt,Rt,Ye,O,D,Ht,Zt]);(0,a().Kw)(Wt);const Gt=(0,a().VK)((()=>{var e,t;const o=X??0;return{paddingLeft:((null===(e=Wt.state)||void 0===e?void 0:e.paddingLeft)??0)+o,paddingRight:((null===(t=Wt.state)||void 0===t?void 0:t.paddingRight)??0)+o}}),[Wt,X]),Nt=(0,n.useCallback)((e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,o(474788).E)(t)&&kt(!0)}),[kt]),Ut=(0,n.useCallback)((()=>{kt(!1)}),[kt]),$t=(0,n.useCallback)((()=>{Oe().Z.state||xt(!0)}),[xt]),qt=(0,n.useCallback)((()=>{xt(!1)}),[xt]),Yt=(0,n.useCallback)((()=>{var e,t;if(Bt)return;const o=null===(e=ct.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.getBoundingClientRect().width,n=Ye.frozoneStore.state.scrollerWidth,r=null===(t=ct.current)||void 0===t||null===(t=t.getNode())||void 0===t?void 0:t.getBoundingClientRect().left,i=Ye.frozoneStore.state.scrollerLeftOffset;if(o===n&&r===i)return;const l=Ye.collectionViewStore(),s=Ye.normalizedFormatStore.state;Ye.frozoneStore.update((e=>({...e,scrollerWidth:o,scrollerLeftOffset:r,scrollerLeftPadding:Ot.state,frozenIndex:null==l?void 0:l.getTableFrozenColumnIndex(o,s),tryShowHiddenFrozenColumn:!1})))}),[Ye,ct,Ot,Bt]),Qt=(0,n.useCallback)((()=>{var e,t;const o=null===(e=ct.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.scrollLeft,n=null===(t=Wt.state)||void 0===t?void 0:t.paddingLeft;if(void 0===o||void 0===n)return;const r=o>n;r!==Ye.frozoneStore.state.isScrolled&&(Ye.frozoneStore.setState({...Ye.frozoneStore.state,isScrolled:r}),Yt())}),[Ye,Yt,Wt]),Jt=(0,n.useRef)(!1);(0,a().VK)((()=>{var e;const t=Ye.collectionViewStore(),n=Ye.collectionStore(),r=Ne.currentUser.id,i=null==t?void 0:t.id,l=null==n?void 0:n.id,s=p.getCollectionViewStores(),a=s.map((e=>e.id)),c=null!==(e=s[0])&&void 0!==e&&e.isDefined()?s[0]:void 0,d=p.id,u=S().Z.get({userId:r,key:(0,he().oi)(d)});let m;const h=e=>!!N||(!!a.includes(e)||"collectionSettings"===Ye.contextType);if(U&&h(U)?m=U:t&&h(t.id)?m=t.id:u&&h(u)?m=u:c&&h(c.id)&&(m=c.id),m){const e=te().Xr.createChildStore(t??p,{table:y().np,id:m});if(e.isDefined()){m!==u&&S().Z.set({userId:r,key:(0,he().oi)(d),value:m});const t=e.getCollectionStore();e&&(!Jt.current||m!==i||t&&t.id!==l)&&(Jt.current=!0,(0,o(903609).y)({environment:Ne,collectionViewBlockStore:p,collectionViewStore:e,collectionStore:t,collectionContextStore:Ye,isFullScreen:g??!1,isRootChild:p.isRootOrDirectChild(),isInPeekRenderer:Mt,viewsModuleContext:b,forceLocalQueryCollection:Boolean(G)}))}}}),[p,Ye,Ne,g,Mt,b,G,N,U]),(0,a().VK)((()=>{void 0===Ye.frozoneStore.state.frozenIndex&&Ye.collectionViewStore()&&At(Ye.collectionViewStore())}),[Ye,At]);const eo=(0,n.useRef)(!1);(0,n.useEffect)((()=>(eo.current=!0,()=>{eo.current=!1})),[]);const oo=(0,n.useRef)(!0);(0,n.useEffect)((()=>{if(oo.current){const e=Rt();e&&(i().Z.withListenerIgnored((()=>{const t=Ye.collectionStore(),o=Ye.collectionViewStore(),n=null==o?void 0:o.getChartType(),r=null==o?void 0:o.getChartPlaceholderType();(0,ue().K4)(Ne,"database_visit",{collection_id:null==t?void 0:t.id,collection_view_id:null==o?void 0:o.id,collection_view_block_id:p.id,type:e,is_full_screen:g,is_peek:_t.state,peek_mode:ze().default.state.mode,database_visit_id:Ye.visitSessionId,chart_type:"placeholder"===n?r:n,is_chart_placeholder:"placeholder"===n})})),oo.current=!1)}}),[]);const{value:no}=(0,ee().XJ)(de().F.formulas);(0,n.useEffect)((()=>{(0,x().$K)(no)&&Ye.formulasCodeStore.setState(no)}),[no,Ye.formulasCodeStore]),(0,n.useEffect)((()=>{i().Z.withListenerIgnored((()=>{const e=Ye.collectionViewStore();if(e&&"collectionTypedView"===Ye.contextType){const t=Ye.databaseType,o=Rt();t&&o&&(0,ue().lu)(Ne,"type_aggregated_database_visit",`type_aggregated_database_visit-${t}`,60,{collection_view_id:e.id,collection_view_block_id:p.id,type:o,databaseType:t,is_my_tasks:(0,Ie().Ep)("myTasks")===p.id})}}))}),[]),(0,n.useEffect)((()=>{const e=Te().default.DO_NOT_USE_markLegacy("collections.collection_view_block_render");Te().default.DO_NOT_USE_measureAfterNextFlushLegacy(e,{environment:Ne,getData:()=>({...(0,ge().vS)(Ye),is_first_render:oo.current})})})),ft.current&&i().Z.withListenerIgnored((()=>{if(!ft.current)return;const{from:e,to:t,metric:o,sizeHintAtStart:n}=ft.current;Te().default.DO_NOT_USE_measureAfterNextFlushLegacy(o,{environment:Ne,getData:()=>{const o=(0,ge().vS)(Ye),{view_type:r,row_count_category:i,...l}=o;return{from:e,to:t,did_trigger_fetch:Ye.isLoadingStore.state,row_count_category:(0,ge().ZO)(n),...l}}}),ft.current=void 0})),(0,n.useEffect)((()=>{const e=()=>{if(!Ye.isLoadedStore.state||!eo.current||Ye.wasCreatedThisSessionStore.state||Ye.didFireLoadEventsStore.state)return;Ye.didFireLoadEventsStore.setState(!0);const e=Ne.RouterStore.state;let t;"page"===e.route.name&&(t=e.route.mobileData);const n=Ye.isFullScreenStore.state;if(n){var i;const e=null===(i=Ye.collectionViewStore())||void 0===i?void 0:i.getType();if(!De().default.state.initialRenderCompleted&&oe){var l;o(418216).setInitialRenderCompleted(),r().vF.hackyOffsetParsesCorrectly()||(0,ue().K4)(Ne,"luxon_hacky_offset_parses_correctly_false");const i=()=>{var n,r;const i=(0,ge().vS)(Ye),l=Ye.collectionViewStore(),s=null==l?void 0:l.id,a=(0,we().Z)(s),c=Ye.requestBackend;return{...i,is_push:(null===(n=t)||void 0===n?void 0:n.isPush)??!1,collectionViewType:e,initial_route:Ne.RouterStore.state.initialRoute.name,prefetchCache:null===(r=Ne.prefetchCache)||void 0===r||null===(r=r.getPrefetchAnalytic(a))||void 0===r?void 0:r.type,wasm_sqlite_initialized:De().default.state.metricDataStore.state.wasm_sqlite_initialized,is_mobile_background_launch:(0,o(683938).Z)(),collection_request_backend:c,sub_metrics:ve().getSubMetricsAndMetricDataForTracking({isPrewarmedTab:!1}).sub_metrics,includes_page_origin_to_app_start:!0}};Te().default.measureFromPageOriginAfterNextFlush("initial_database_render",{environment:Ne,getData:i,shouldSendIfStatsigNotInitialized:!0});const c=Nm().Xm.CollectionViewBlock.getLoadingMetrics();var s,a;if(null!=c&&c.startedAt)Te().default.DO_NOT_USE_measureLegacy({metricName:"collection_view_block_bundle_load_and_parse",startTime:c.startedAt,endTime:c.resolvedAt},{environment:Ne,data:{did_prefetch:"hit-match"===(null===(s=Ne.prefetchCache)||void 0===s||null===(s=s.getPrefetchAnalytic((0,we().Z)(null===(a=Ye.collectionViewStore())||void 0===a?void 0:a.id)))||void 0===s?void 0:s.type),is_full_screen:n}});null===(l=Ye.databaseItemsVisibleTracker)||void 0===l||l.handleInitialDatabaseRender()}else{var c;const t=He().Z.popTimings(),o=()=>({...(0,ge().vS)(Ye),wasm_sqlite_initialized:De().default.state.metricDataStore.state.wasm_sqlite_initialized,collectionViewType:e,...He().Z.getDatabaseNavigationMetrics(null==t?void 0:t.navigationStart),is_load_cached_page_chunk_v2:Le().default.checkGate({gateName:"load_cached_page_chunk_multi_cell_enabled"})});t&&Te().default.DO_NOT_USE_measureAfterNextFlushLegacy({metricName:"navigation_database_render",startTime:t.navigationStart},{environment:Ne,getData:o}),Ae().Z.state.isMeasuring&&Ae().Z.update((e=>({...e,isMeasuring:!1}))),null===(c=Ye.databaseItemsVisibleTracker)||void 0===c||c.handleNavigationDatabaseRender(null==t?void 0:t.navigationStart)}}else{var d,u;if(oe)null===(d=Ye.databaseItemsVisibleTracker)||void 0===d||d.handleInitialDatabaseRender();else null===(u=Ye.databaseItemsVisibleTracker)||void 0===u||u.handleNavigationDatabaseRender()}};return Ye.isLoadedStore.addListener(e),e(),()=>{Ye.isLoadedStore.removeListener(e)}}),[Ye,Ne,oe]),(0,a().VK)((()=>{for(const t of p.getCollectionViewStores())t.getValue();const e=Ye.collectionStore();if(e){e.getTemplatePageStores().map((e=>e.getValue()))}}),[p,Ye]),(0,n.useEffect)((()=>{const e=()=>!ze().default.isCenterPeekOpen()&&Ze().Z.state.isVisible,t=()=>{e()&&St.maybeProcessQueuedCollectionEmit("page_show")},o=()=>{e()&&St.maybeProcessQueuedCollectionEmit("exit_peek")};return Ze().Z.addListener(t),ze().default.addListener(o),()=>{Ze().Z.removeListener(t),ze().default.removeListener(o)}}),[St]),(0,n.useEffect)((()=>{const e=e=>{o(86609).Wu({environment:Ne,sprintSettingsContext:e.state})};return Ye.sprintSettingsContextStore.addListener(e),()=>{Ye.sprintSettingsContextStore.removeListener(e)}}),[Ye,Ne]),(0,n.useEffect)((()=>{const e=async e=>{if(e.state){const e=Ye.collectionViewBlockStore(),t=Ye.collectionViewStore(),o=Ye.collectionStore();if(!e||!t||!o)return;await(0,M().d)(Ne,Ye,{src:"relative_variables_stale",queuedTimestamp:Date.now()},Boolean(G))}};return Ye.relativeVariablesAreStaleStore.addListener(e),()=>{Ye.relativeVariablesAreStaleStore.removeListener(e)}}),[Ye,Ne,G]);const{contextType:ro,databaseType:io,remoteCollectionIds:lo}=(0,a().VK)((()=>({contextType:Ye.contextType,databaseType:Ye.databaseType,remoteCollectionIds:Ye.remoteCollectionIdsStore.state})),[Ye]);(0,n.useEffect)((()=>{if(gt.current)return;if("collectionTypedView"!==ro||!io)return;const e=new(nt().E)(Ne,(0,h().JY)({spaceId:p.getSpaceId(),databaseType:io}),((e,t)=>{St.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:Sh(p),isCollectionTypeChange:!0})}));e.subscribe(),gt.current=e;const t=gt.current;return()=>{t.unsubscribe()}}),[Ye,Ne,St,p,ro,io]),(0,n.useEffect)((()=>{null==Y||Y(Ye)}),[Y,Ye]),(0,n.useEffect)((()=>{null==$||$(Rt())}),[]),(0,a().VK)((()=>{var e;const t=Ye.frozoneStore.state.scrollerWidth,o=null===(e=Ye.collectionViewStore())||void 0===e?void 0:e.getTableFrozenColumnIndex(t,Ye.normalizedFormatStore.state);void 0===o||Ye.isInHomeWidgetStore.state||Ye.frozoneStore.setState({...Ye.frozoneStore.state,frozenIndex:o})}),[Ye]),(0,n.useEffect)((()=>{const e=e=>{const t=Array.from(mt.current.keys()??[]),o=v().e5(t,e),n=v().e5(e,t);for(const i of o){var r;null===(r=mt.current.get(i))||void 0===r||r.unsubscribe(),mt.current.delete(i)}for(const i of n){const e=new(nt().E)(Ne,(0,h().jY)(i),((e,t)=>{St.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:Sh(p),isCollectionTypeChange:!1})}));e.subscribe(),mt.current.set(i,e)}};if(yt)e([yt.id]);else if("collectionTypedView"===ro){e(lo??[]);const t=t=>{e(t.state)};return Ye.remoteCollectionIdsStore.addListener(t),()=>{Ye.remoteCollectionIdsStore.removeListener(t)}}}),[Ye.remoteCollectionIdsStore,St,yt,ro,Ne,lo,p]),(0,n.useEffect)((()=>{const e=mt.current;return()=>{if(e)for(const t of e.values())t.unsubscribe()}}),[]);const so=(0,n.useMemo)((()=>({onFocus:Nt,onBlur:Ut,onMouseMove:$t,onMouseLeave:qt})),[Nt,Ut,$t,qt]);(0,n.useEffect)((()=>{var e;const t=null===(e=ct.current)||void 0===e?void 0:e.getNode();return t&&(0,fe().lj)(t,"scroll",Qt),()=>{t&&(0,fe().ZV)(t,"scroll",Qt)}}),[Qt]),(0,n.useEffect)((()=>()=>{(0,o(416918).H)({collectionContextStore:Ye})}),[Ye]),(0,n.useEffect)((()=>()=>{lt.destroy(),st.destroy(),at.destroy()}),[lt,st,at]),(0,n.useEffect)((()=>()=>{var e;null==dt||null===(e=dt.current)||void 0===e||e.disconnect()}),[]),(0,o(22648).$W)({collectionContextStore:Ye,isFullScreen:Boolean(g),wasCreatedThisSessionStore:Ye.wasCreatedThisSessionStore,environment:Ne}),(0,n.useEffect)((()=>{var e;const t=null===(e=Ye.collectionStore())||void 0===e?void 0:e.getFormat();if(!t)return;const o=Ye.settingsStore;"Jira"===t.external_collection_type&&t.synced_collection_external_url&&Ee().ZP.state.defaultExternalCollectionSetting&&(k().Qu({collectionSettingsStore:o,source:Ee().ZP.state.defaultExternalCollectionSetting}),Ee().ZP.setState({...Ee().ZP.state,open:!1,defaultExternalCollectionSetting:void 0}))}),[Ye]);const ao=(0,a().SI)((()=>{var e;const t=null==yt?void 0:yt.isSyncedCollection(),o=!0===(null==yt||null===(e=yt.getFormat().sync_state)||void 0===e?void 0:e.syncing),n=Ne.device.isMobile;return Boolean(t&&o&&!n)}),[yt,Ne]);(0,a().Kw)(ao),(0,n.useEffect)((()=>{const e=async t=>{const n=await o(824462).callApi({eventName:"getExternalCollectionSyncState",environment:Ne,data:t});if("success"===n.type&&n.data.result){const o=n.data.result,r=Ye.numberChildrenReceivedStore,i=Ye.numberChildrenUnfurledStore;r.setState(o.numberChildrenReceived),i.setState(o.numberChildrenUnfurled),i.state/r.state<1&&(ht.current=setTimeout((async()=>{await e(t)}),1e4))}},t=async()=>{if(ao){const t=Ye.collectionStore(),o=null==t?void 0:t.getFormat().uri,n=null==t?void 0:t.getFormat().bot_id,r=null==t?void 0:t.id;if(!o||!n||!r)return;await e({uri:o,botId:n,collectionId:r})}};return ao.addListener(t),()=>{ao.removeListener(t),clearTimeout(ht.current)}}),[ao,Ye,Ne]);const co=(0,a().VK)((()=>Ye.collectionViewStore()),[Ye]),uo=(0,a().VK)((()=>{const e=Rt();return g?"timeline"===e?96:180:"timeline"===e||"gallery"===e?0:N?16:Fe().Z.state}),[g,Rt,N]),po=(0,Ve().PE)(p,W),mo=(0,a().VK)((()=>!!yt&&(0,u().OY)(yt.getValue())),[yt]),go=(0,a().VK)((()=>(0,pe().qG)(p.id)),[p]),So=(0,a().VK)((()=>(0,pe().X)(p.id)),[p]),ho=(0,a().VK)((()=>!!go&&Ye.isEmptyStore.state),[go,Ye]),fo=(0,a().VK)((()=>!!So&&Ye.isEmptyStore.state),[So,Ye]),yo=(0,a().VK)((()=>Bt&&go&&0===Ye.collectionStoresStore.state.length&&Ye.isLoadedStore.state),[Bt,go,Ye]),vo=(0,a().VK)((()=>Bt&&So&&0===Ye.collectionStoresStore.state.length&&p.getCollectionViewStores().length<=1),[Bt,So,Ye,p]),xo=(0,je().E)("workflow_container"),bo=(0,a().VK)((()=>xo&&p.isReady()&&0===p.getCollectionViewStores().length&&"collectionSettings"!==Ye.contextType),[xo,p,Ye]),Co=(0,a().SI)((()=>{if(!Ht||!Zt||!(0,be().mO)(p,void 0,Ne)||p.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};return{marginLeft:void 0,marginRight:-(se().QB/2)}}),[Ne,Ht,Zt,p]);(0,a().Kw)(Co);const wo=(0,a().SI)((()=>{var e;if(yo||vo)return 0;const t="viewsMain"===(null===(e=Ye.viewsModuleContextStore)||void 0===e?void 0:e.getViewModuleType());return A||"hidden"!==L||!H?t?Se().iN:N||Ye.isInHomeWidgetStore.state?Se().Ct:Se().LO:0}),[yo,vo,Ye,A,L,H,N]);(0,a().Kw)(wo);const ko=(0,a().SI)((()=>{if(vt||bt||wt||g)return!0;if("always_show"===L)return!0;if(Ne.device.isMobile)return!0;if("form_editor"===Rt())return!0;if(Ye.settingsStore.state.open)return!0;if(Ye.searchOpenStore.state)return!0;if(Tt.state.open)return!0;if(Vt.state.open)return!0;if(jt.state.open)return!0;if(Ye.filterBarSortSettingsStore.state.open)return!0;if(Array.from(Ye.filterBarItemSettingsStoreMap.values()).some((e=>e.state.open)))return!0;return!!It.state.open}),[Ne.device,vt,bt,wt,g,L,Rt,Ye,Tt,Vt,jt,It]);(0,a().Kw)(ko);const Vo=(0,n.useCallback)((e=>{if(!Ye.collectionViewBlockStore()||!(0,Ge().ww)(Ne))return;const t=Ye.isMultiSourceView;I().createAndCommit({userAction:"CollectionViewBlock.handleAddItemClick",environment:Ne,canUndo:!0,perform:e=>{(0,_().N)({store:p,collectionContextStore:Ye,environment:Ne,transaction:e,shouldCoerce:!0,templateStore:Ye.defaultPageTemplateStore.state,showMoveTo:t,peekModeOverride:Bt?"center_peek":void 0,from:{createBlock:"cvb_add_item"}})}}),w().wd({environment:Ne,collectionContextStore:Ye,action:"click_topbar_new_item"})}),[Ye,Ne,p,Bt]),jo=(0,n.useCallback)((e=>{const{device:t}=Ne,{target:o}=e;if(!co||t.isMobile||!(o instanceof HTMLElement))return;const n=Rt();n&&0===e.button&&"form_editor"!==n&&(0,ye().ZP)({event:e,context:ye().Af.EditorMouseDown,callback:()=>{e.preventDefault(),j().AI({environment:Ne,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===n||"table"===n})}})}),[Ne,co,Rt]),To=(0,n.useCallback)(((e,t)=>{(0,ye().ZP)({event:e,context:ye().Af.EditorClick,callback:()=>{if(_t.state||V().E5(Ne),"page"===t&&!(0,xe().X9)()){const{clientX:t,clientY:o,target:n}=e;l().default.afterNextFlush((()=>{I().createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:Ne,canUndo:!0,perform:e=>{P().editNearestBlockOrInsertIfAtBottomOfPage(Ne,{x:t,y:o,target:n instanceof Element?n:void 0},e)}})}))}}})}),[Ne,_t]),Po=(0,n.useMemo)((()=>v().Ds(Yt,100)),[Yt]),Io=(0,n.useCallback)((()=>{Oe().Z.state||Ct(!0)}),[Ct]),Ro=(0,n.useCallback)((()=>{Ct(!1)}),[Ct]),_o=(0,n.useCallback)((e=>{e&&lt.observe(e)}),[lt]),Mo=(0,n.useCallback)((e=>{e&&at.observe(e)}),[at]),Bo=(0,n.useCallback)((e=>{e&&st.observe(e)}),[st]),Fo=(0,n.useCallback)((e=>{var t,o;const n=null==e||null===(t=e.getNode())||void 0===t?void 0:t.classList.contains(me().PBs);ct.current=n?e:(null==Qe?void 0:Qe.horizontalScroller)||null;const r=Ye.collectionViewStore();At(r);const i=null===(o=ct.current)||void 0===o?void 0:o.getNode();"undefined"!=typeof ResizeObserver&&i&&(dt.current=new ResizeObserver(Po),dt.current.observe(i)),ct.current?Ye.virtualizedModule.setHorizontalScrollerRefStore(ct):Ye.virtualizedModule.setHorizontalScrollerRefStore(void 0)}),[Ye,Po,At,Qe]),Ko=(0,a().VK)((()=>{if("form_editor"!==Rt()&&Ye.settingsStore.state.open&&"sidebar"===Pt.state&&!0!==o(589549).j.state.visible)return(0,m.jsx)("div",{style:{...Wt.state,...Co.state,borderTop:`1px solid ${ne.tableDividerColor}`,height:12}})}),[Ye,Co,Wt,ne,Pt,Rt]),Lo=(0,a().VK)((()=>{const e=null==yt?void 0:yt.getValue();return Boolean(e&&(0,u().Ev)(e))}),[yt]),Oo=(0,a().VK)((()=>{var e;if(Rt())return(0,R().H2)({blockStore:p,isFullScreen:Boolean(g),environment:Ne,collectionContextStore:Ye})?0:-((null===(e=Wt.state)||void 0===e?void 0:e.paddingLeft)??0)}),[Rt,p,g,Wt,Ne,Ye]),[Do,Eo,Ao]=(0,a().VK)((()=>[Ye.normalizedSchemaStore.state,Ye.normalizedQueryStore.state,Ye.normalizedFormatStore.state]),[Ye]),Ho=(0,a().VK)((()=>{if("collectionTypedView"===Ye.contextType)return L;if("collectionSystemView"===Ye.contextType){const e=Ye.collectionViewStore(),t=null==e?void 0:e.getCollectionSource();return(0,o(336860).WW)(t)?"default":"hidden"}return!yt||yt&&!1===yt.canRead()||!yt.isDefined()?"hidden":L??"default"}),[Ye,yt,L]),Zo=(0,n.useRef)(null),zo=(0,a().VK)((()=>{var e,t;const o=Lt&&!ze().default.isSidePeekOpeningStore.state&&!N,n=o?g?{paddingLeft:(null==Wt||null===(e=Wt.state)||void 0===e?void 0:e.paddingLeft)??0,paddingRight:16}:{paddingLeft:0,paddingRight:((null==Wt||null===(t=Wt.state)||void 0===t?void 0:t.paddingRight)??0)+16}:null==Wt?void 0:Wt.state,r=(0,_e().$3)(Ne),i=(0,be().mO)(p,void 0,Ne)||g?r:Math.min(be().zL,r);return{headerWrapper:{minHeight:wo.state,paddingLeft:null==n?void 0:n.paddingLeft,paddingRight:null==n?void 0:n.paddingRight,width:E,position:"relative",left:-((null==n?void 0:n.paddingLeft)??0),flexShrink:0,...(et||o)&&{position:"sticky",zIndex:86,left:0,width:Lt&&n&&!et&&!N?i-n.paddingLeft/2:void 0},...p.isNonEditableState()&&{cursor:"default"},...Co.state},content:{flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",position:"relative",...Co.state,...!et&&{...Dt&&{marginLeft:-Dt},maxHeight:z?z-wo.state:"inherit",...Bt&&Ye.isEditableHomeCollectionStore.state?(0,Re().KI)({isPhone:ie,theme:ne}):{},width:E,left:Oo}},contentInner:et?{}:{position:"relative",...Bt?{height:"100%",maxHeight:"inherit"}:{}}}}),[Ye.isEditableHomeCollectionStore,Oo,Ne,E,wo,et,g,Lt,Bt,ie,N,Co,Wt,z,Dt,p,ne]),Wo=(0,a().VK)((()=>{var e;if(bo)return(0,m.jsx)(gh,{store:p});const t=Rt();if(!(co&&Do&&Eo&&Ao&&t))return null;if(Lo)return(0,m.jsx)(q().L1,{value:Ye,children:(0,m.jsx)(Je().p,{allowSelectionWithin:!0,style:zo.headerWrapper,onMouseDown:jo,onMouseMove:Io,onMouseLeave:Ro,onClick:To,ref:(0,f().lq)(_o,le),children:(0,m.jsx)(ot().Z,{store:p,shouldShowHoverMenu:!0,analyticsName:(0,F().$l)(t),shouldShowHalo:!et&&!Bt,canSelect:!et&&!Bt&&!Ft,children:(0,m.jsx)(o(311598).Z,{store:p,style:{width:"auto"},disabled:!1})})})});if(vo)return(0,m.jsx)(q().L1,{value:Ye,children:(0,m.jsx)("div",{ref:le,...so,style:{display:"contents"},children:(0,m.jsxs)("div",{style:(0,Re().KI)({isPhone:ie,theme:ne}),ref:Zo,children:[(0,m.jsx)("div",{style:{position:"relative"},children:(0,m.jsx)(to,{currentViewType:t,headerSizeObserver:lt,contentSizeObserver:at,settingsHeaderSizeObserver:st,headerHeightStore:wo,viewSettingsPlacementStore:Pt,store:p,leftRightPaddingStore:Wt,isInHomeWidget:Bt,placementToOrigin:Me().Placement.Right,alignmentToOrigin:Me().Alignment.Center,headerRef:Zo})}),(0,m.jsx)(Pe().Qi,{feature:"custom_db",onSetup:e=>{k().r$({collectionContextStore:Ye,collectionSettingsStore:Ye.settingsStore,hideSettingsHeader:!0,ref:e,initialStack:[{type:"linkToDatabase",existingCollectionStore:yt}]})}})]})})});const n=(0,m.jsx)(Jm,{store:p,collectionStore:yt,collectionViewStore:co,viewType:t,isDisabled:W,isFullScreen:Boolean(g),isInPeekRenderer:Mt,isPreviewing:qe,isRootChild:Ht,paddingLeft:Gt.paddingLeft,paddingRight:Gt.paddingRight,paddingBottom:uo,headerSizeObserver:lt,timelineViewRef:ut,showHoverActionsStore:ko,handleAddItemClick:Vo,isPlaceholderExternalCollection:mo,isEmptyMyTasks:ho,isInFrameWhenSidePeekOpen:Lt,query:Eo,schema:Do,format:Ao,isCustomDbEmptyState:vo,maxHeight:z,placementStore:Pt,templatePickerMenuListStore:J}),r=yo?n:(0,m.jsx)(Xt,{store:p,paddingLeft:Dt,isFullScreen:Boolean(g),currentViewType:t,isInPeek:Mt,isInHomeWidget:Bt,isUnlistedView:N,viewSettingsPlacementStore:Pt,format:Ao,isMyTasksEmpty:ho,isHomeCustomDbEmpty:fo,isInFrameWhenSidePeekOpen:Lt,handleEditorMouseDown:jo,isRootOrDirectChild:Ht,leftRightPaddingStore:Wt,paddingBottom:uo,handleHorizontalScrollerMount:Fo,handleEditorClick:To,children:n}),i=et?(0,f().lq)(Mo,le):Mo,l="page"!==t||Kt?(0,m.jsx)(Je().p,{ref:i,allowSelectionWithin:!0,style:zo.content,children:(0,m.jsx)("div",{style:zo.contentInner,children:r})}):(0,m.jsx)(o(28832).O,{disabled:!1,displayName:"CollectionViewPageContent",ref:i,style:zo.content,children:(0,m.jsx)("div",{style:zo.contentInner,children:r})});return(0,m.jsx)(q().L1,{value:Ye,children:(0,m.jsx)(o(817870).C,{value:it,children:(0,m.jsxs)("div",{ref:le,...so,style:{display:"contents"},children:[g?void 0:(0,m.jsx)("div",{style:{position:"relative"},children:(0,m.jsx)(to,{currentViewType:t,headerSizeObserver:lt,contentSizeObserver:at,settingsHeaderSizeObserver:st,headerHeightStore:wo,viewSettingsPlacementStore:Pt,store:p,leftRightPaddingStore:Wt,isInHomeWidget:Bt,headerRef:Zo})}),(0,m.jsx)(re,{}),(0,m.jsx)(zt,{isFullScreen:Boolean(g),leftRightPaddingStore:Wt,leftRightMarginStore:Co,overrideViewType:C}),(0,m.jsx)(sh,{currentViewType:t,store:p,headerWrapStyle:zo.headerWrapper,headerActionsBehavior:Ho,allowedActions:Z,hideViewTabBar:H??!1,showHoverActionsStore:ko,headerSizeObserver:lt,isFullScreen:Boolean(g),isInHomeWidget:Bt,isMyTasksPage:go,isHomeCustomDbPage:So,isPlaceholderExternalCollection:mo,collectionViewHeaderText:A,handleEditorMouseDown:jo,handleHeaderMouseMove:Io,handleHeaderMouseLeave:Ro,handleHeaderMount:_o,handleSettingsHeaderMount:Bo,leftRightPaddingStore:Wt,headerHeightStore:wo,canEdit:po,viewSettingsPlacementStore:Pt,contentSizeObserver:at,settingsHeaderSizeObserver:st,handleAddItemClick:Vo,timelineViewRef:ut,filterBarCreateFilterSettingsStore:jt,createFilterSettingsStore:Vt,switchViewMetric:ft,showOnlyCurrentView:Boolean(Q),headerRef:Zo,headerStyleOverrides:{...N&&{paddingLeft:24,paddingRight:24,paddingTop:12}}}),"form_editor"===t?(0,m.jsx)(tt().Z,{capture:!0,allowSearch:!0,allowEsc:!0,allowUndo:!0,allowOpenLinkMenu:!0,allowBackspace:!0,allowMenuList:!0,render:e=>(0,m.jsx)("div",{...e,children:l})}):l,Ko,(0,m.jsx)(Ue().Qm,{collectionContextStore:Ye,paddingLeft:null===(e=Wt.state)||void 0===e?void 0:e.paddingLeft}),(0,m.jsx)(uh,{collectionContextStore:Ye,collectionViewBlockRenderStartTime:pt,didDelayOffscreenRenderRef:rt,mountedBeforeInitialPageRender:oe})]})})})}),[zo,Rt,co,Do,Eo,Ao,Lo,vo,p,yt,W,g,Mt,qe,Ht,Gt.paddingLeft,Gt.paddingRight,uo,lt,ko,Vo,mo,ho,Lt,z,Pt,J,yo,Dt,Bt,N,fo,jo,Wt,Fo,To,Co,et,Mo,wo,Ye,ie,ne,it,so,at,st,C,Ho,Z,H,go,So,A,Io,Ro,_o,Bo,po,jt,Vt,Q,Ko,pt,rt,oe,Ft,Kt,bo]);return(0,Ve().ez)(p,t,(0,a().VK)((()=>({renderedType:"collection_view_page"===p.getType()?"collection_view_page":"collection_view",getBlockStore:()=>p,getNode:()=>le.current,collectionContextStore:Ye,resetLeftScrollAfterFlush:()=>{l().default.afterNextFlush((()=>{var e;const t=null===(e=ct.current)||void 0===e?void 0:e.getNode();if(t){t.scrollLeft=0;const e=(0,ke().xH)(t);e&&(e.scrollLeft=0)}}))},handleCreated:()=>function(e,t){T().ZH({environment:e}),l().default.afterNextFlush((()=>{const n=t.collectionStore(),r=t.collectionViewBlockStore(),i=t.settingsStore;if(!r)return;const l=r.getCollectionViewSourceCollectionStore();if(n&&(0,u().OY)(n.getValue()))k().NG({collectionSettingsStore:i});else if(l){(0,o(384525).W)({environment:e,collectionContextStore:t});const n=t.collectionViewStore();"form_editor"!==(null==n?void 0:n.getType())&&(k().r$({collectionContextStore:t,collectionSettingsStore:i}),k().wl({collectionSettingsStore:i,item:{type:"createViewSource",existingCollectionStore:l,createdCollectionRecordPointerMap:void 0}}),"chart"===(null==n?void 0:n.getType())&&t.isCreatingNewChartCollectionStore.setState(!0))}else if(n){const l=null==t?void 0:t.collectionViewStore();l?(!function(e){const{collectionStore:t,collectionViewStore:o,collectionViewBlockStore:n,collectionContextStore:r,environment:i}=e,l=null==o?void 0:o.id,s=l?(0,B().x)(l):void 0,a=F().gL({collectionStore:t,sourceCollectionViewBlockStore:n,currentCollectionViewBlockStore:n,currentCollectionViewStore:o,constraints:(0,B().x)(o.id)}).find((e=>{var t;return e.id===(null==s||null===(t=s.viewPointer)||void 0===t?void 0:t.id)}));a&&(0,K().V)({viewToDuplicateStore:a,collectionContextStore:r,collectionViewStore:o,environment:i})}({collectionStore:n,collectionViewStore:l,collectionViewBlockStore:r,collectionContextStore:t,environment:e}),k().r$({collectionContextStore:t,collectionSettingsStore:i}),k().wl({collectionSettingsStore:i,item:{type:"duplicateExistingView"}})):(0,o(594134).V)({environment:e,collectionStore:n,collectionContextStore:t,collectionSettingsStore:i})}else{const e=null==t?void 0:t.collectionViewStore();let o;var s;if(e)o=null===(s=(0,B().x)(e.id))||void 0===s?void 0:s.viewSettingsStack;k().r$({collectionContextStore:t,collectionSettingsStore:i,initialStack:o})}}))}(Ne,Ye)})),[p,Ye,Ne]),Wo)})));function gh(e){const{store:t}=e,o=(0,s().O7)(),n=(0,c().Fg)();return(0,m.jsxs)("div",{style:{marginLeft:96,marginRight:96,marginBottom:180,borderTop:`1px solid ${n.accentColors.gray[100]}`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingTop:180},children:[g({width:48,height:48,color:n.accentColors.gray[200]}),(0,m.jsx)(et().D,{style:{marginTop:12,paddingLeft:12,paddingRight:12,paddingTop:8,paddingBottom:8,fontWeight:b().Ue.medium,fontSize:16,lineHeight:1.2,borderRadius:8,border:`1px solid ${n.accentColors.gray[100]}`},size:"lg",onClick:async()=>{(await Ne().bI.workflowActions.load()).openEditor({environment:o,store:t})},children:(0,m.jsx)(C()._H,{id:"CollectionViewBlock.workflowContainerSetup",defaultMessage:"Continue setup"})})]})}function Sh(e){var t;return!Ze().Z.state.isVisible||!(!ze().default.isCenterPeekOpen()||null!==(t=ze().default.peekTargetStore.state)&&void 0!==t&&t.uiContains(e))}const hh=mh;class fh extends n.Component{componentDidCatch(e){throw o(680146).vd("collections"),e}render(){const{collectionViewBlockRef:e,...t}=this.props;return(0,m.jsx)(hh,{...t,ref:e})}}const yh=n.forwardRef(((e,t)=>(0,m.jsx)(fh,{...e,collectionViewBlockRef:t})))},887330:(e,t,o)=>{"use strict";o.d(t,{C:()=>r,L:()=>i});var n=()=>o(707513);function r(e){const{theme:t,isInHomeWidget:o}=e;return{display:"flex",alignItems:"center",fontSize:14,padding:6,...o?{height:24,width:24,color:t.lightTextColor,fill:t.lightIconColor}:{height:28,width:28,color:t.mediumIconColor,fill:t.mediumIconColor},fontWeight:n().Ue.regular,lineHeight:1,borderRadius:6}}function i(e){const{theme:t}=e;return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:t.mediumIconColor,fontWeight:n().Ue.regular,lineHeight:1,borderRadius:4}}},269932:(e,t,o)=>{"use strict";o.d(t,{Z:()=>f});o(667294);var n=()=>o(219727),r=()=>o(109477),i=()=>o(250303),l=()=>o(421654),s=()=>o(269299),a=()=>o(448419),c=()=>o(967092),d=(o(241792),()=>o(788860)),u=()=>o(513670),p=()=>o(352230),m=()=>o(255577),g=o(785893);const S=(0,d().XN)((function(e){const{limit:t}=e;return(0,g.jsx)(d()._H,{defaultMessage:"{limit} pages",values:{limit:t.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})}));const h=(0,d().XN)((function(e){const t=(0,n().O7)(),{device:i}=t,{currentLimit:l,onAccept:s,onClose:a,showTitle:c}=e,h=[{key:0,render:e=>(0,g.jsx)(o(388284).Z,{enableActionSheetTitle:!0,title:c&&(0,g.jsx)(d()._H,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"}),...e}),items:u().oA(r().jk.map(((e,t)=>{const n={key:t,render:t=>(0,g.jsx)(o(827973).Z,{...t,disabled:!1,title:(0,g.jsx)(S,{limit:e}),checkState:u().Xy(l,e)}),action:()=>s(e)};return n})))}];let f;return f=i.isMobile?{menuType:p().o.ActionSheet}:{menuType:p().o.Popup,width:200},(0,g.jsx)(o(198829).Z,{...f,children:(0,g.jsx)(m().ZP,{type:m().iW.Vertical,sections:h,onAccept:a,initialFocus:void 0})})}));const f=function(e){let{format:t,collectionContextStore:r}=e;const i=(0,n().O7)(),{device:l}=i;return(0,g.jsx)(a().ZP,{popupType:l.isMobile?c().kQ.SlideUp:c().kQ.Popup,renderOrigin:e=>(0,g.jsx)(o(1910).Z,{icon:o(641772).o,style:{marginLeft:4,marginRight:4},...e}),alignmentToOrigin:a().vR.End,placementToOrigin:a().pO.Bottom,originGap:8,render:e=>(0,g.jsx)(v,{parent:e,format:t,collectionContextStore:r})})};function y(e){return(0,r().rx)(e.inline_collection_first_load_limit,Boolean(e.collection_group_by))}function v(e){let{parent:t,format:o,collectionContextStore:r}=e;const a=(0,n().O7)();return(0,g.jsx)(h,{currentLimit:y(o),onAccept:e=>function(e,t,o){const n=t.collectionViewStore();if(!n)return;n.getType()&&(s().createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:o,canUndo:!0,perform:t=>{l().FH({stores:[n],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),i().wd({environment:o,collectionContextStore:t,action:"set_first_load_limit"}))}(e,r,a),onClose:t.close,showTitle:!0})}},455241:(e,t,o)=>{"use strict";o.d(t,{d:()=>s});o(667294);var n=()=>o(846550),r=()=>o(456681),i=()=>o(788860),l=o(785893);function s(e){const{href:t,style:o}=e,s=(0,n().yK)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.mediumTextColor}})),[]);return(0,l.jsxs)("a",{href:t,target:"_blank",style:{...s.default,...o},children:[(0,r().m)({width:14,marginRight:4}),(0,l.jsx)(i()._H,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}},717940:(e,t,o)=>{"use strict";o.d(t,{G:()=>l});o(667294);var n=()=>o(846550),r=()=>o(668001),i=o(785893);function l(e){const{widthPercentage:t,isInHomeWidget:o}=e,l=(0,n().yK)((e=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:o?12:16,height:o?12:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:t||"35%",height:10,flexShrink:0,borderRadius:12,marginLeft:2,backgroundColor:e.lightDividerColor},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[t,o]);return(0,i.jsx)("div",{style:l.rowContainer,children:(0,i.jsxs)("div",{style:l.column,children:[(0,i.jsx)(r().Z,{style:l.circleShimmer}),(0,i.jsx)(r().Z,{style:l.rowShimmer})]})})}},986286:(e,t,o)=>{"use strict";o.d(t,{FW:()=>a,Pe:()=>d,Re:()=>u,Rs:()=>p,YW:()=>s,ht:()=>m,lM:()=>c,rM:()=>g,vK:()=>l,yY:()=>S});var n=()=>o(677559);const r={JiraSyncInfoPopup:new(n().Ss)("JiraSyncInfoPopup",(async()=>await Promise.all([o.e(52774),o.e(57023)]).then(o.bind(o,453110)))),ImproveJiraSyncPopup:new(n().Ss)("ImproveJiraSyncPopup",(async()=>await Promise.all([o.e(52774),o.e(81263)]).then(o.bind(o,931329)))),JiraDCAuthModal:new(n().Ss)("JiraDCAuthModal",(async()=>await o.e(40205).then(o.bind(o,253458)))),ExternalImportAndSyncIndicator:new(n().Ss)("ExternalImportAndSyncIndicator",(async()=>await o.e(47433).then(o.bind(o,635604)))),JiraSyncedAllProjectsTooltip:new(n().Ss)("JiraSyncedAllProjectsTooltip",(async()=>await Promise.all([o.e(62743),o.e(75433)]).then(o.bind(o,205959)))),JiraSyncedAllIssuesTooltip:new(n().Ss)("JiraSyncedAllIssuesTooltip",(async()=>await Promise.all([o.e(62743),o.e(75433)]).then(o.bind(o,205959)))),JiraSyncedDatabaseViewsAndFiltersTooltip:new(n().Ss)("JiraSyncedDatabaseViewsAndFiltersTooltip",(async()=>await Promise.all([o.e(62743),o.e(75433)]).then(o.bind(o,205959)))),JiraSyncSourceTooltip:new(n().Ss)("JiraSyncSourceTooltip",(async()=>await Promise.all([o.e(62743),o.e(75433)]).then(o.bind(o,205959)))),JiraSyncedSettingsToSetupProjectsAndIssuesTooltip:new(n().Ss)("JiraSyncedSettingsToSetupProjectsAndIssuesTooltip",(async()=>await Promise.all([o.e(62743),o.e(75433)]).then(o.bind(o,205959))))},i={JiraSyncTeamSpaceModal:new(n().Ss)("JiraSyncTeamSpaceModal",(async()=>Promise.all([o.e(62743),o.e(94568)]).then(o.bind(o,860619))))},l=(0,n().kF)(i.JiraSyncTeamSpaceModal,(e=>e.default)),s=(0,n().kF)(r.JiraSyncedAllProjectsTooltip,(e=>e.JiraSyncedAllProjectsTooltip)),a=(0,n().kF)(r.JiraDCAuthModal,(e=>e.default)),c=(0,n().kF)(r.JiraSyncedAllIssuesTooltip,(e=>e.JiraSyncedAllIssuesTooltip)),d=(0,n().kF)(r.JiraSyncedDatabaseViewsAndFiltersTooltip,(e=>e.JiraSyncedDatabaseViewsAndFiltersTooltip)),u=(0,n().kF)(r.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip,(e=>e.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip)),p=(0,n().kF)(r.JiraSyncSourceTooltip,(e=>e.JiraSyncSourceTooltip)),m=(0,n().kF)(r.JiraSyncInfoPopup,(e=>e.JiraSyncInfoPopup)),g=(0,n().kF)(r.ImproveJiraSyncPopup,(e=>e.ImproveJiraSyncPopup)),S=(0,n().kF)(r.ExternalImportAndSyncIndicator,(e=>e.ExternalImportAndSyncIndicator));(0,o(827282).CZ)("jira",{default:{loader:()=>o.e(7061).then(o.bind(o,207061)),size:20},small:{loader:()=>o.e(7061).then(o.bind(o,207061)),size:16},mini:{loader:()=>o.e(7061).then(o.bind(o,207061)),size:14},large:{loader:()=>o.e(7061).then(o.bind(o,207061)),size:24}})},542649:(e,t,o)=>{"use strict";o.d(t,{EZ:()=>r,FD:()=>i,G5:()=>n,rK:()=>l});const n=220,r=24,i=-7,l=-3},681035:(e,t,o)=>{"use strict";o.d(t,{S:()=>i});var n=()=>o(677559);const r=new(n().Ss)("CollectionItemCover",(async()=>{const{CollectionItemCover:e}=await Promise.all([o.e(62743),o.e(37912)]).then(o.bind(o,682652));return{CollectionItemCover:e}})),i=(0,n().kF)(r,(e=>e.CollectionItemCover))},761936:(e,t,o)=>{"use strict";o.d(t,{L:()=>d});var n=()=>o(642240),r=()=>o(338530);const i={ko:()=>o.e(60692).then(o.bind(o,299435)),es:()=>o.e(20883).then(o.bind(o,960142)),de:()=>o.e(83224).then(o.bind(o,299606)),fr:()=>o.e(85038).then(o.bind(o,604240)),pt:()=>o.e(72138).then(o.bind(o,515748)),zh:()=>o.e(17835).then(o.bind(o,240169)),ja:()=>o.e(96377).then(o.bind(o,770488)),da:()=>o.e(57677).then(o.bind(o,317410)),fi:()=>o.e(66970).then(o.bind(o,266265)),nb:()=>o.e(93031).then(o.bind(o,189761)),nl:()=>o.e(62579).then(o.bind(o,360701)),sv:()=>o.e(60382).then(o.bind(o,575660))};let l=!1,s=!1;async function a(e){for(const[o,r]of Object.entries(e.emojiLocaleKeywords)){var t;n().Q4[o]={...n().Q4[o],keywords:[...r,...(null===(t=n().Q4[o])||void 0===t?void 0:t.keywords)||[]]}}await r().Z.waitUntilLoaded(),r().Z.update((t=>{let{emojiByName:o,...n}=t;return{...n,emojiByName:{...o,...e.emojiByName}}}))}async function c(){if(l)return;const[e]=o(146947).locale.split("-");e in i&&(await a(await i[e]()),l=!0)}const d=(0,o(924665).Z)((async()=>{await async function(){s||(await a(await o.e(83552).then(o.bind(o,716373))),s=!0)}(),await c()}))},110372:(e,t,o)=>{"use strict";o.d(t,{YF:()=>c,bl:()=>a,gF:()=>l,i6:()=>d,lZ:()=>s});var n=()=>o(954949),r=()=>o(594546),i=()=>o(749826);function l(e,t){const o=(0,n().Si)(t.callout_key);o&&(t.placement_key=(0,n().pU)(o)),(0,r().j)({environment:e,event:{eventName:"callout_show",eventProperties:t}}),i().default.logEvent("callout_show",t.callout_key)}function s(e,t){const o=(0,n().Si)(t.callout_key);o&&(t.placement_key=(0,n().pU)(o)),(0,r().j)({environment:e,event:{eventName:"callout_click",eventProperties:t}}),i().default.logEvent("callout_click",t.callout_key)}function a(e,t){const o=(0,n().Si)(t.callout_key);o&&(t.placement_key=(0,n().pU)(o)),(0,r().j)({environment:e,event:{eventName:"callout_dismiss",eventProperties:t}}),i().default.logEvent("callout_dismiss",t.callout_key)}function c(e,t){const{eligible_callouts:o,required_arg_timeout:n,required_args_run_duration:i,eligibility_timeouts:l,blocklist:s}=t;(0,r().j)({environment:e,event:{eventName:"callout_coordinator_resolved",eventProperties:{eligible_callouts:o,required_arg_timeout:n,required_args_run_duration:i,eligibility_timeouts:l,blocklist:s}}})}function d(e,t){(0,r().j)({environment:e,event:{eventName:"callout_feature_interaction",eventProperties:t}})}},827539:(e,t,o)=>{"use strict";o.d(t,{Z:()=>c});var n=o(667294),r=()=>o(846550),i=()=>o(910746),l=()=>o(326966),s=()=>o(677559);const a=new(s().Ss)("notionCalendarIcons",(async()=>o.e(192).then(o.bind(o,912320))));function c(e){const t=(0,s().XJ)(a),o=function(){const[e,t]=(0,n.useState)(new Date),o=(0,n.useRef)();return(0,n.useEffect)((()=>{const n=()=>{const o=new Date;o.getDate()!==e.getDate()&&t(o)},r=new Date,i=new Date(r);i.setHours(r.getHours()+1),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0);const s=i.getTime()-r.getTime(),a=setTimeout((()=>{n(),o.current=window.setInterval(n,l().U6)}),s);return()=>{clearTimeout(a),clearInterval(o.current)}}),[e]),e}(),c=e.dateNumber??o.getDate(),d=(0,r().yK)((t=>({icon:{width:16,height:16,color:t.mediumIconColor,...e.style}})),[e.style]),u=(0,n.useCallback)((e=>{if(e<1||e>31)return(0,i().s)(d.icon);if("resolved"!==t.status)return(0,i().s)(d.icon);const o=`calendarDate${e<10?`0${e}`:`${e}`}Icon`;return(0,t.value[o])(d.icon)}),[d,t]);return u(c)}},585742:(e,t,o)=>{"use strict";o.d(t,{W:()=>r});class n extends(()=>o(442))().Z{}const r=new n},619384:(e,t,o)=>{"use strict";o.d(t,{Z:()=>r});class n extends(()=>o(263184))().default{constructor(){super(...arguments),this.updatePreviewState=e=>{this.update((t=>({...t,previewCanvasState:e(t.previewCanvasState)})))}}getInitialState(){return{chart:void 0,responsiveChartOptions:void 0,previewCanvasState:void 0,exportBackgroundColor:"gradient"}}}const r=n},153694:(e,t,o)=>{"use strict";o.d(t,{D1:()=>i,Qm:()=>l});var n=()=>o(677559);const r={postInstallTourTooltip:new(n().Ss)("workflowTemplateTourTooltip",(()=>o.e(20550).then(o.bind(o,976690)))),onboardingPills:new(n().Ss)("onboardingPills",(()=>o.e(31257).then(o.bind(o,297891))))},i=(0,n().kF)(r.postInstallTourTooltip,(e=>e.WorkflowTemplateTourTooltip)),l=(0,n().kF)(r.onboardingPills,(e=>e.PostInstallPills))},877727:(e,t,o)=>{"use strict";o.d(t,{QZ:()=>l,SV:()=>r,mq:()=>i});var n=()=>o(749826);function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n().default.checkGate({gateName:"workflow_templates_settings_dev",disableExposureLogging:e.disableExposureLogging})&&n().default.checkGate({gateName:"packaging_m3.1",disableExposureLogging:e.disableExposureLogging})}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n().default.checkGate({gateName:"packaging_m3.1",disableExposureLogging:e.disableExposureLogging})}function l(e){return!e.device.isPhone}},999582:(e,t,o)=>{"use strict";o.d(t,{Z:()=>i});class n extends(()=>o(263184))().default{getInitialState(){return{}}}const r=new n;o(947115).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",r);const i=r},29488:(e,t,o)=>{"use strict";function n(e){return`${e.table}:${e.id}`}o.d(t,{O:()=>n})},924665:(e,t,o)=>{"use strict";function n(e){let t,o,n;return async function(){for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return t?(n=i,o||(o=t.then((()=>(o=void 0,t=e(...n),t))),o)):(t=e(...i),t)}}o.d(t,{Z:()=>n})},941310:(e,t,o)=>{"use strict";o.d(t,{X:()=>r});var n=()=>o(532850);function r(e){const{block:t,property:o,schema:r,getRecordModel:i,userId:l,userTimeZone:s,intl:a,experimentService:c,collectionFeatureGates:d,formulasModule:u}=e;if(!t)return!1;if("title"===o)return!1;const p=r[o];return!(!p||"checkbox"!==p.type)||(!(!p||"button"!==p.type)||(!(!p||"status"!==p.type)||!n().wV({property:o,schema:r,block:t,getRecordModel:i,userId:l,userTimeZone:s,intl:a,experimentService:c,collectionFeatureGates:d,formulasModule:u})))}},910746:(e,t,o)=>{"use strict";o.d(t,{s:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("calendarDate31",{viewBox:"0 0 20 20",svg:(0,n.jsxs)("g",{children:[(0,n.jsx)("path",{d:"M7.565 10.164c0-.753-.429-1.246-1.104-1.246-.649 0-.87.467-.87 1.207v.13c-.077.013-.142.026-.22.026-.468 0-.805-.39-.805-1.052 0-1.012.935-1.908 2.713-1.908 1.584 0 2.596.805 2.596 2.116 0 .987-.843 1.636-1.674 1.804 1.558.17 2.207 1.052 2.207 2.13 0 1.843-1.39 2.803-3.531 2.803h-.052c-1.61 0-2.74-.662-2.74-1.687 0-.584.442-1.052 1.104-1.052.052 0 .104.013.156.013.13 1.052.857 1.48 1.584 1.48.7 0 1.194-.428 1.194-1.077v-.026c0-1.013-.87-1.117-2.181-1.246l-.208-1.22c1.22-.144 1.83-.494 1.83-1.195zm4.95 4.66v-6.05c-1.298.286-1.583-.285-1.44-.856.779-.13 2.804-.597 3.57-.818v7.776l1.415.286c0 .506-.299.805-.831.805-.442 0-1.467-.026-1.96-.026-.766 0-2.168.026-2.168.026a.851.851 0 01-.052-.299c0-.246.104-.493.441-.584l1.026-.26z"}),(0,n.jsx)("path",{d:"M16.664 0H3.334A3.333 3.333 0 000 3.334v13.332A3.333 3.333 0 003.334 20h13.332A3.333 3.333 0 0020 16.666V3.334A3.333 3.333 0 0016.666 0h-.002zm-.525 17.932H3.861a1.797 1.797 0 01-1.797-1.797V5.485h15.872v10.652c0 .993-.804 1.797-1.797 1.797v-.002z"})]})})},984478:(e,t,o)=>{"use strict";o.d(t,{f:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("chevronLeft",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M3.61816 8.06445C3.61816 8.29688 3.70703 8.49512 3.8916 8.67285L9.22363 13.8887C9.36719 14.0391 9.55859 14.1143 9.77734 14.1143C10.2217 14.1143 10.5703 13.7725 10.5703 13.3213C10.5703 13.1025 10.4814 12.9043 10.3311 12.7539L5.52539 8.06445L10.3311 3.375C10.4814 3.21777 10.5703 3.01953 10.5703 2.80078C10.5703 2.35645 10.2217 2.01465 9.77734 2.01465C9.55859 2.01465 9.36719 2.08984 9.22363 2.24023L3.8916 7.45605C3.70703 7.63379 3.625 7.83203 3.61816 8.06445Z"})})},730398:(e,t,o)=>{"use strict";o.d(t,{p:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("collectionHide",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M12.617 12.95a.46.46 0 0 0 .662 0 .46.46 0 0 0 0-.663L3.354 2.373a.465.465 0 1 0-.663.656l9.926 9.92ZM8 2.706c-1.02 0-1.945.176-2.807.457l.938.938A6.702 6.702 0 0 1 8 3.832c3.744 0 6.72 3.258 6.72 3.943 0 .463-.949 1.659-2.454 2.602l.867.873c1.84-1.207 2.912-2.783 2.912-3.475 0-1.2-3.24-5.068-8.045-5.068ZM8 12.85a9.022 9.022 0 0 0 2.97-.498l-.93-.932a7.175 7.175 0 0 1-2.04.305c-3.744 0-6.72-3.13-6.72-3.95 0-.392.995-1.664 2.6-2.648l-.884-.885C1.08 5.461-.05 7.072-.05 7.775-.05 8.977 3.26 12.85 8 12.85Zm2.924-3.944c.152-.345.24-.732.24-1.13A3.137 3.137 0 0 0 8 4.622c-.404 0-.785.076-1.137.223l4.06 4.06ZM8 10.934a2.93 2.93 0 0 0 1.266-.287L5.123 6.497a2.909 2.909 0 0 0-.293 1.283A3.172 3.172 0 0 0 8 10.934Z"})})},521573:(e,t,o)=>{"use strict";o.d(t,{g:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("collectionShow",{viewBox:"0 0 30 30",svg:(0,n.jsx)("path",{d:"M15,4 C8.641,4 0,10.469 0,15 C0,19.531 8.641,26 15,26 C21.359,26 30,19.531 30,15 C30,10.469 21.359,4 15,4 Z M15,24 C9.149,24 2,17.975 2,15 C2,12.025 9.149,6 15,6 C20.851,6 28,12.025 28,15 C28,17.975 20.851,24 15,24 Z M15,8 C11.134,8 8,11.134 8,15 C8,18.866 11.134,22 15,22 C18.866,22 22,18.866 22,15 C22,11.134 18.866,8 15,8 Z M15,20 C12.238,20 10,17.761 10,15 C10,12.239 12.238,10 15,10 C17.762,10 20,12.239 20,15 C20,17.761 17.762,20 15,20 Z"})})},967925:(e,t,o)=>{"use strict";o.d(t,{J:()=>r});o(667294);const n={viewBox:"0 0 20 20",svg:(0,o(785893).jsx)("path",{d:"M3.3 4.825c0-.842.683-1.525 1.525-1.525h3.15c.842 0 1.525.683 1.525 1.525v10.35c0 .842-.683 1.525-1.525 1.525h-3.15A1.525 1.525 0 0 1 3.3 15.175zm1.525-.275a.275.275 0 0 0-.275.275v10.35c0 .152.123.275.275.275h3.15a.275.275 0 0 0 .275-.275V4.825a.275.275 0 0 0-.275-.275zm5.675.275v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.842-.683-1.525-1.525-1.525h-3.15c-.842 0-1.525.683-1.525 1.525m1.525-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275v-3.15c0-.152.123-.275.275-.275m0 5.95c-.842 0-1.525.682-1.525 1.525v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.843-.683-1.525-1.525-1.525zm-.275 1.525c0-.152.123-.275.275-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275z"})},r=(0,o(827282).IU)("layout",n)},330404:(e,t,o)=>{"use strict";o.d(t,{Z:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("openAsPageThick",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M2.16895 7.19629C2.59277 7.19629 2.90723 6.88867 2.90723 6.45801V5.96582L2.75684 3.81934L4.35645 5.50098L6.3252 7.4834C6.46875 7.63379 6.65332 7.70215 6.85156 7.70215C7.30957 7.70215 7.6377 7.39453 7.6377 6.93652C7.6377 6.72461 7.55566 6.54004 7.41211 6.39648L5.43652 4.4209L3.74805 2.82129L5.91504 2.96484H6.44141C6.86523 2.96484 7.18652 2.65723 7.18652 2.22656C7.18652 1.7959 6.87207 1.48145 6.44141 1.48145L2.64746 1.48145C1.86816 1.48145 1.41699 1.93262 1.41699 2.71875L1.41699 6.45801C1.41699 6.88184 1.73828 7.19629 2.16895 7.19629ZM9.55176 14.6543H13.3389C14.125 14.6543 14.5762 14.2031 14.5762 13.417V9.67773C14.5762 9.25391 14.2549 8.93945 13.8242 8.93945C13.4004 8.93945 13.0859 9.24707 13.0859 9.67773V10.1699L13.2295 12.3164L11.6299 10.6348L9.66113 8.65234C9.52441 8.50195 9.33984 8.43359 9.1416 8.43359C8.68359 8.43359 8.35547 8.74121 8.35547 9.19922C8.35547 9.41113 8.43066 9.5957 8.57422 9.73926L10.5566 11.7148L12.2383 13.3145L10.0781 13.1709H9.55176C9.12793 13.1709 8.80664 13.4785 8.80664 13.9092C8.80664 14.3398 9.12109 14.6543 9.55176 14.6543Z"})})},199264:(e,t,o)=>{"use strict";o.d(t,{W:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("options",{viewBox:"0 0 17 15",svg:(0,n.jsx)("path",{d:"M11.287 4.484c.844 0 1.57-.53 1.875-1.265h2.57c.391 0 .72-.344.72-.758 0-.414-.329-.75-.72-.75h-2.57A2.023 2.023 0 0 0 11.287.437c-.852 0-1.578.532-1.875 1.274H1.045a.744.744 0 0 0-.742.75.75.75 0 0 0 .742.758h8.367a2.044 2.044 0 0 0 1.875 1.265Zm0-1.062c-.539 0-.96-.43-.96-.961 0-.547.421-.969.96-.969.547 0 .961.422.961.969a.95.95 0 0 1-.96.96ZM1.021 6.586c-.39 0-.718.336-.718.75 0 .406.328.75.718.75h2.657A2.03 2.03 0 0 0 5.56 9.359c.843 0 1.57-.523 1.875-1.273h8.273a.744.744 0 0 0 .742-.75.744.744 0 0 0-.742-.75H7.436A2.032 2.032 0 0 0 5.56 5.32c-.852 0-1.579.524-1.883 1.266H1.02Zm4.54 1.719a.964.964 0 0 1-.97-.97c0-.546.43-.96.97-.96.539 0 .96.414.96.96 0 .54-.421.97-.96.97Zm5.726 5.93c.852 0 1.578-.532 1.875-1.274h2.57c.391 0 .72-.336.72-.75a.734.734 0 0 0-.72-.75h-2.57a2.023 2.023 0 0 0-1.875-1.274c-.844 0-1.578.532-1.875 1.274H1.045a.744.744 0 0 0-.742.75c0 .406.328.75.742.75h8.367a2.023 2.023 0 0 0 1.875 1.273Zm0-1.063c-.539 0-.96-.43-.96-.961 0-.547.421-.961.96-.961a.94.94 0 0 1 .961.96.95.95 0 0 1-.96.962Z"})})},400939:e=>{var t=/[a-zA-Z0-9_\u0392-\u03c9\u00c0-\u00ff\u0600-\u06ff]+|[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af]+/g;e.exports=function(e){var o=e.match(t),n=0;if(!o)return 0;for(var r=0;r<o.length;r++)o[r].charCodeAt(0)>=19968?n+=o[r].length:n+=1;return n}}}]);