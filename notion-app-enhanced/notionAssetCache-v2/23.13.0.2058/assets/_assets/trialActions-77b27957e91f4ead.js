"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[37554],{438665:(e,t,r)=>{r.d(t,{zL:()=>p,lB:()=>f,ZF:()=>d,DV:()=>v,an:()=>m,n9:()=>_,WV:()=>y});var n=()=>r(799891),a=()=>r(741633);const i={plans_page:["lic_25","lic_50","resurrection_offer","ai_fifty_percent_upgrade"],sidebar_upsell:["lic_25","lic_50"]};var o=()=>r(792409),c=()=>r(824462),s=()=>r(308186),l=()=>r(594546),u=()=>r(876822);async function d(e,t){var r;const{spaceId:n,offerCampaign:a}=t;if(!n||!a||null===(r=u().default.state.currentSpaceStore)||void 0===r||!r.canAdmin())return;const i=await c().callApi({eventName:"getCustomerOffer",environment:e,data:{spaceId:n,offerCampaign:a}});return"failed"!==i.type&&"offer"in i.data&&i.data.offer?i.data.offer:void 0}async function p(e){const{environment:t,spaceId:r,offerCampaign:n,entrypoint:a}=e,i=await c().callApi({eventName:"applyCustomerOffer",environment:t,data:{spaceId:r,offerCampaign:n,entrypoint:a??"unknown"}});if("failed"!==i.type)return i;s().x2(i)}async function f(e,t){const r=await c().callApi({eventName:"applyCustomerOffer",environment:e,data:{...t}});if("failed"!==r.type)return r;s().x2(r)}async function m(e){const{environment:t,spaceId:r,offerCampaign:n}=e;return void 0!==await d(t,{spaceId:r,offerCampaign:n})}async function y(e){var t;const{environment:r,hasReceived:i,offerType:s,newPlan:l,coupon:d}=e,p=null===(t=u().default.state.currentSpaceStore)||void 0===t?void 0:t.getSpaceId();if(!p)return;const f=await c().callApi({eventName:"updateCustomerOffer",environment:r,data:{spaceId:p,hasReceived:i,offerType:s,newPlan:l,coupon:d},headers:(0,a().Bb)({cellId:void 0,spaceId:p})});"failed"===f.type&&n().log({level:"error",from:"offerActions",type:"updateLegacyCustomerOfferFailed",error:(0,o().Ui)(f.error)})}async function v(e,t,r){const n=function(e){if(i.hasOwnProperty(e))return i[e]}(r);if(n)for(const a of n){const r=await d(e,{spaceId:t,offerCampaign:a});if((null==r?void 0:r.campaign)===a)return r}}function _(e){let{environment:t,spaceName:r,offerCampaign:n}=e;if(r)switch(n){case"lic_25":case"lic_50":(0,l().lu)(t,"lic_offer_eligible","lic_offer_eligible",3600,{workspace_name:r,lic_25:"lic_25"===n,lic_50:"lic_50"===n});break;case"resurrection_offer":(0,l().lu)(t,"resurrection_offer_eligible","resurrection_offer_eligible",3600,{workspace_name:r});break;default:return}}},334510:(e,t,r)=>{r.r(t),r.d(t,{applyMultiplayerReverseTrialIfEligible:()=>l().jG,applyReversePlusTrial:()=>l().tY,handleTrialUpgradeFromOnboarding:()=>l().TQ,handleTrialUpgradeFromOnboardingImpl:()=>l().M_,isEligibleForBlockLimitTimedTrial:()=>s});var n=()=>r(575861),a=()=>r(629719),i=()=>r(518019),o=()=>r(444297),c=()=>r(438665);async function s(e,t){const r=await i().Z.awaitData(e,{spaceId:null==t?void 0:t.id});if("free"!==(0,a().wO)(null==r?void 0:r.subscription))return!1;const s=null==t?void 0:t.getSetting("reach_block_limit_time");if(!s||(0,n().O5)(s)<3)return!1;if(await(0,o().D)(e))return!1;const l=t.getSpaceId();return!!(await(0,c().an)({environment:e,spaceId:l,offerCampaign:"default"}))}var l=()=>r(125165)},125165:(e,t,r)=>{r.d(t,{M_:()=>k,TQ:()=>U,jG:()=>E,tY:()=>M});r(821057);var n=()=>r(730120),a=(r(667294),()=>r(799891)),i=()=>r(629719),o=()=>r(976102),c=()=>r(681941),s=()=>r(788860),l=()=>r(792409),u=()=>r(342792),d=()=>r(979614),p=()=>r(824462),f=()=>r(308186),m=()=>r(594546),y=()=>r(876822),v=()=>r(518019),_=()=>r(749826),g=()=>r(801072),w=()=>r(444297),b=()=>r(576387),I=()=>r(438665),h=()=>r(254687),C=()=>r(548812),S=()=>r(18281),D=()=>r(419157),N=()=>r(897257),T=()=>r(723721),A=r(785893);async function k(e){var t,r;const{environment:l,stripe:u,elements:p,trialData:m,trialDays:_,sessionId:g,customerName:w,businessName:I}=e;if(!N().subscriptionDataStoreInstance.state)return void a().log({level:"error",from:"trialUpsellActions",type:"StripeError",error:{miscDataString:"Unable to get subscription data."}});if(!p||!u)return void a().log({level:"error",from:"trialUpsellActions",type:"StripeError",error:{miscDataString:"Stripe elements not initialized when user tried to upgrade"}});const{error:C}=await p.submit();if(C)return void d().iL(l,{error:"could not submit form",error_type:"payment_method"});const k=await u.createPaymentMethod({elements:p});if(k.error)return void d().iL(l,{error:k.error.message,error_type:"payment_method"});if(!k.paymentMethod)return void d().iL(l,{error:"could not create token",error_type:"payment_method"});const U={type:"paymentMethodId",value:k.paymentMethod.id},E=y().default.state.currentSpaceStore;if(!E)return;const M=E.id,O=await h().aQ({environment:l,spaceId:M}),P=await v().Z.awaitData(l,{spaceId:M});if(!P)throw new Error("Billing data not loaded");const Z=(0,i().Lg)(P),L=D().Z.state.selectedCurrencyCode??"USD",j=(0,T().Hy)(),V=(0,c().Vj)({prices:O,quantity:1,domainsQuantity:0}),$={product:j,interval:"month",currency:L},x=(0,o().dP)(V,Z,$),B=n().ou.now().plus({days:_});return await async function(e){const{environment:t,spaceStore:r,paymentData:n,desiredState:a,stripe:i,trialData:o,customerName:c,businessName:l,addressZip:u,addressCountry:p,sessionId:m}=e,y=await v().Z.awaitData(t,{spaceId:r.id});try{const e=await b().Mg({environment:t,sessionId:m,spaceStore:r,desiredState:a,paymentData:n,from:"onboarding",trialData:o,billingEmail:(0,S().pu)(y),customerName:c,businessName:l,addressZip:u,addressCountry:p}),d=e.paymentIntentClientSecret,v=e.paymentIntentStatus;if(d&&"requires_action"===v){const{error:e}=await i.handleNextAction({clientSecret:d});e&&(await b().EO({environment:t,spaceStore:r,from:"subscription_upgrade_onboarding_failed_payment"}),f().UW((0,A.jsx)(s()._H,{id:"subscription.upgrade.payment_failed",defaultMessage:"Your payment could not be processed. Please provide an alternate payment method or you will lose access to Notion."})))}return"success"}catch{return void d().Bg(t)}}({environment:l,spaceStore:E,desiredState:{...x,trialEnd:B},paymentData:U,stripe:u,subscriptionTier:(0,T().Hy)(),trialData:m,customerName:w,businessName:I,addressZip:(null===(t=k.paymentMethod.billing_details.address)||void 0===t?void 0:t.postal_code)||"",addressCountry:(null===(r=k.paymentMethod.billing_details.address)||void 0===r?void 0:r.country)||"",sessionId:g})}const U=(0,r(513670).Ds)(k,1e3,{leading:!0,trailing:!1});async function E(e){let{spaceId:t,environment:r}=e;if(await(0,I().an)({environment:r,spaceId:t,offerCampaign:"reverse"})&&(0,C().jK)(r)){await M(t,r,"going_multiplayer")&&await g().Z.resetData(r,{spaceId:t})}}async function M(e,t,r){let n="reverse";try{const a=await(0,w().D)(t),i=Boolean(_().default.checkGate({gateName:"apply_reverse_trial_key"}));a&&(n="reverse_mm_ent");const o=`${e}_timed_trial`,c=i?(0,u().Ul)(o):void 0,s=await p().callApi({eventName:"applyReverseTrial",environment:t,data:{spaceId:e,trialData:{id:n,from:r},idempotencyKey:c}});return"success"===s.type?((0,m().j)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:n,success:"success"===s.data.status}}}),await b().bi(t),"success"===s.data.status):(O(n,t,s.error),!1)}catch(a){return O(n,t,a),!1}}function O(e,t,r){(0,m().j)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:e,success:!1}}}),a().log({level:"error",from:"trialUpsellActions",type:"applyReverseTrialError",error:(0,l().Ui)(r)})}},976102:(e,t,r)=>{r.d(t,{AI:()=>l,Zl:()=>c,_D:()=>o,dK:()=>d,dP:()=>u,pc:()=>p,t4:()=>s});r(821057),r(267602),r(653476),r(470928),r(241792),r(228244);var n=()=>r(326966),a=()=>r(629719),i=()=>r(122792);function o(e,t){return d(e.items,t.items).some((e=>{let[t,r]=e;return function(e,t){if(!e)return!1;if(!t)return!0;const r=a().H6(e),n=a().H6(t);if(!r||!n)return!1;return i().rC[r]>i().rC[n]}(t,r)}))}function c(e,t,r){let{trialEnd:n,items:a}=t;const i=a.map((t=>{const n=t.price.product,a=t.price.unitAmount.currencyCode,i=function(e,t){let{interval:r,product:n,currency:a}=t;const i=e.find((e=>e.product===n&&e.billingInterval===r&&e.unitAmount.currencyValue.currencyCode===a));return f(i,`Unable to find price with interval: ${r}, product: ${n}, currency: ${a}`)}(e,{interval:r,product:n,currency:a});return{...t,price:i}}));return{trialEnd:n,items:i}}function s(e,t){const r=e.items.filter((e=>a().tw(e)!==t));return{...e,items:r}}function l(e,t){const r=e.items.filter((e=>a().tw(e)!==a().tw(t)));return{...e,items:r.concat([t])}}function u(e,t,r){const{product:n,interval:i,currency:o}=r,c=function(e){if("personal_free"===e||"team_free"===e)return"free";return e}(n),s=t.items.filter((e=>a().tw(e)!==a().h_(c))),l=function(e,t){let{interval:r,product:n,currency:a}=t;const i=e.find((e=>e.price.product===n&&e.price.billingInterval===r&&e.price.unitAmount.currencyValue.currencyCode===a));return f(i,`Unable to find price with interval: ${r}, product: ${n}, currency: ${a}`)}(e,{interval:i,product:c,currency:o});return{...t,items:s.concat([l])}}function d(e,t){return(0,n().UV)(e,(e=>a().tw(e)),t,(e=>a().tw(e)))}function p(e){const{prices:t,billingData:r,product:n}=e,i=a().YF(r.subscription),o=a().Lg(r),c=a().Tz(o),s=a().Tz(r.subscription),l=c??s;return t.find((e=>e.product===n&&e.billingInterval===l&&e.unitAmount.currencyValue.currencyCode===i))}function f(e,t){if(null==e)throw new Error(t);return e}}}]);