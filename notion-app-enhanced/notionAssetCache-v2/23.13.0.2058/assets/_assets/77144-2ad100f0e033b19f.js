"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[77144],{84028:(e,t,n)=>{n.d(t,{C:()=>We});n(821057),n(122556),n(582845),n(250570),n(533019),n(721473),n(788208),n(22624),n(267602),n(653476),n(470928),n(241792);var r=n(667294),o=()=>n(219727),i=()=>n(142735),a=()=>n(846550),s=()=>n(801812),l=()=>n(146007),d=()=>n(414294),c=()=>n(728267),u=()=>n(959784),p=()=>n(578220),f=()=>n(396136),g=()=>n(255933),m=()=>n(325490),h=()=>n(955620),w=()=>n(824462),y=()=>n(265640),k=()=>n(827973),x=()=>n(448419),v=()=>n(1910),C=()=>n(312578),b=()=>n(198829),S=()=>n(255577),j=()=>n(388284),I=()=>n(654133),T=()=>n(755589),M=()=>n(508853),P=()=>n(57687),D=()=>n(487270),B=()=>n(352230),A=()=>n(275200),Z=()=>n(466970),K=()=>n(876822),E=()=>n(804217),R=()=>n(826955),F=()=>n(298721),V=()=>n(825886),W=()=>n(961507),L=n(785893);const O=(0,n(827282).IU)("stop",{viewBox:"0 0 20 20",svg:(0,L.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 19 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,L.jsx)("rect",{y:"0.793945",width:"18.8027",height:"18.8027",rx:"9.40137",fill:"#37352F"}),(0,L.jsx)("rect",{x:"5.91028",y:"6.7041",width:"6.98255",height:"6.98255",rx:"0.783447",fill:"white"})]})});var q=()=>n(970105),N=()=>n(269299),U=()=>n(623498),H=()=>n(632775),z=()=>n(12512),_=()=>n(156538);function G(e){const{store:t,onSubmit:n,clientStore:s,threadStore:l}=e,d=(0,o().O7)(),[c,u]=r.useState(!1),p=(0,i().VK)((()=>0===(0,h().VrM)(t.getValue()||[])),[t]),f=(0,i().VK)((()=>s.state.loading||void 0!==(null==l?void 0:l.getCurrentInferenceId())),[s,l]),g=(0,r.useCallback)((()=>{if(!l)return;const{serverCommitResult:e}=N().createAndCommit({userAction:"AIChatTranscript.StopInferenceButton.handleClick",environment:d,canUndo:!0,perform:e=>{(0,F().Q0)({threadStore:l,transaction:e,clientStore:s})}});s.setState({...s.state,stopInferencePromise:e})}),[d,l,s]),m=(0,r.useCallback)((async()=>{const{dictationActions:e}=await H().Xb.load(),n=(0,h().QaF)(t.getValue()||[]);await e.StreamingDictationManager.start({environment:d,onTranscription:e=>{const r=n?`${n}\n${e}`:e;N().createAndCommit({userAction:"AIChatInput.handleDictation",environment:d,canUndo:!0,perform:e=>{q().sO({environment:d,store:t,value:(0,h().TPx)(r),transaction:e})}})}}),u(!0)}),[d,t]),w=(0,r.useCallback)((async()=>{const{dictationActions:e}=await H().Xb.load();await e.StreamingDictationManager.stop(),u(!1)}),[]);(0,r.useEffect)((()=>()=>{w()}),[w]);const y=(0,a().yK)((e=>({stagingAndInputWrap:{overflow:"inherit",flexGrow:1,flexShrink:1},wrap:{display:"flex",alignItems:"center",fontSize:14,flexWrap:"wrap",boxShadow:`0px 0px 0px 0.5px ${e.stroke.primary}, 0px 4px 12px -2px rgba(0, 0, 0, 0.08)`,backgroundColor:"dark"===e.mode?e.accentColors.translucentGray[100]:e.contentBackground,borderRadius:12,overflow:"inherit",position:"relative"},textContainer:{flexGrow:1,padding:"10px 12px 16px 12px",minHeight:void 0,maxHeight:240,overflow:"auto"},placeholder:{opacity:1,cursor:"text"},rightGutter:{display:"flex",alignItems:"center",justifyContent:"center",padding:6,gap:6},sendButtonIcon:{width:28,height:28},microphoneIcon:{width:28},stopIcon:{width:28,height:28}})),[]),k=(0,r.useCallback)((()=>{f||(null==n||n(t.getValue()),requestAnimationFrame((()=>{const e=_().E.findNodeFromStore(t);e&&e.focus()})))}),[n,t,f]);return(0,L.jsx)("div",{style:y.stagingAndInputWrap,tabIndex:0,children:(0,L.jsxs)("div",{style:y.wrap,onClick:e=>{if(e.target===e.currentTarget){const n=_().E.findEditableWithStore(t);n&&n.handleClick(e)}},children:[(0,L.jsx)(U().Z,{style:y.textContainer,placeholder:"Ask AI anything...",disabled:!1,store:t,placeholderStyle:y.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableEnter:!1,onEnter:k,disableMobileActionBar:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestEdit:!0,inPageFind:z().B3.none,usePopupForMentionOnMobile:!0}),(0,L.jsx)("div",{style:{flexGrow:1,flexBasis:"50px"}}),(0,L.jsx)("div",{style:y.rightGutter,children:c?(0,L.jsx)(v().Z,{icon:O,onClick:w,iconStyle:y.stopIcon,ariaLabel:"stop-recording"},"stop-recording"):f?(0,L.jsx)(v().Z,{icon:O,onClick:g,iconStyle:y.stopIcon,ariaLabel:"stop-ai-message"},"stop-inference"):(0,L.jsxs)(L.Fragment,{children:[!c&&(0,L.jsx)(v().Z,{icon:V().q,onClick:m,iconStyle:y.microphoneIcon,ariaLabel:"start-recording"},"start-recording"),(0,L.jsx)(v().Z,{icon:W()._,onClick:k,iconStyle:y.sendButtonIcon,isBlue:!p,disabled:p,ariaLabel:"submit-ai-message"},"send-message")]})})]})})}var $=()=>n(662293),J=(n(670560),()=>n(923301));function Y(e){return`${e.environmentName}-${e.suffix}`}var Q=()=>n(666908),X=()=>n(328714),ee=()=>n(516169),te=()=>n(783190),ne=()=>n(513670),re=()=>n(715139),oe=()=>n(998901),ie=()=>n(832770),ae=()=>n(680442),se=()=>n(542345),le=()=>n(95886),de=()=>n(316855);function ce(e){const{request:t,memory:n,clientStore:i,onChange:s}=e,l=(0,o().O7)(),[d,c]=(0,r.useState)(!1),u=(0,a().yK)((e=>({topbar:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},inputWrap:{flexGrow:1},status:{marginRight:2}})),[]),p=(0,r.useCallback)((e=>{s({...n,feedback:e.target.value})}),[n,s]),f=(0,r.useCallback)((()=>{s(void 0)}),[s]),g=(0,r.useCallback)((async()=>{c(!0),await(0,se().Bi)({environment:l,request:t,memory:n,clientStore:i,onChange:s}),c(!1)}),[l,t,n,i,s]);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{style:u.topbar,children:[(0,L.jsx)(I().Z,{renderTooltip:()=>(0,L.jsx)("div",{style:{width:300,whiteSpace:"normal"},children:"The text you type here is used as feedback to generate an InferenceMemory."}),placement:oe().Placement.Top,render:e=>(0,L.jsx)("div",{...e,style:u.inputWrap,children:(0,L.jsx)(de().Z,{value:n.feedback,placeholder:"Set feedback",onChange:p,textarea:!0,autosize:!0})})}),(0,L.jsx)(y().D,{onClick:g,children:"Run"})]}),(0,L.jsx)(ae().a,{label:"Memory",left:(0,L.jsxs)("div",{style:u.status,children:[" ",d?(0,L.jsx)(C().Z,{}):n.verified?"✅":"❌"]}),children:(0,L.jsx)(ie().c,{language:"json",value:JSON.stringify(n,null,2)})}),(0,L.jsx)(v().Z,{icon:le().y,onClick:f,ariaLabel:"Delete memory"})]})}var ue=()=>n(374289),pe=()=>n(35980),fe=()=>n(740046),ge=()=>n(661297);function me(e){const{scopeKey:t,inference:n,defaultState:r}=e,o=(0,a().yK)((e=>({chevron:{width:10,marginLeft:4,fill:e.lightIconColor},menuContent:{display:"flex",flexDirection:"column",gap:8,padding:8},label:{fontSize:12,color:e.regularTextColor}})),[]);return(0,L.jsx)(x().ZP,{popupType:x().Z4.Popup,placementToOrigin:x().pO.Bottom,alignmentToOrigin:x().vR.Start,renderOrigin:e=>(0,L.jsxs)(y().D,{...e,children:[(0,L.jsx)("div",{children:"Save"}),(0,ue().i)(o.chevron)]}),render:e=>(0,L.jsx)(he,{scopeKey:t,inference:n,buttonPopupParent:e,defaultState:r})})}function he(e){const{scopeKey:t,inference:n,buttonPopupParent:i,defaultState:s}=e,l=(0,o().O7)(),d=(0,a().yK)((e=>({menuContent:{display:"flex",flexDirection:"column",gap:8,padding:8},label:{fontSize:12,color:e.regularTextColor}})),[]),c=(0,r.useMemo)((()=>function(e){const{environment:t,scopeKey:n,defaultState:r}=e,o=ve(n),i=pe().Z.get({userId:t.currentUser.id,key:o});if(!i&&r)return r;return i||{project:void 0,dataset:void 0,tags:[]}}({environment:l,scopeKey:t,defaultState:s})),[l,s,t]),[u,p]=(0,r.useState)(c),f=(0,r.useCallback)((e=>{p(e),function(e){const{environment:t,scopeKey:n,state:r}=e,o=ve(n);pe().Z.set({userId:t.currentUser.id,key:o,value:r})}({environment:l,scopeKey:t,state:e})}),[l,t]),g=(0,r.useCallback)((e=>{f({...u,project:e,dataset:void 0})}),[f,u]),m=(0,r.useCallback)((e=>{f({...u,dataset:e})}),[f,u]),h=(0,r.useCallback)((e=>{f({...u,tags:e})}),[f,u]),w=(0,r.useCallback)((()=>{const{project:e,dataset:t,tags:r}=u;e&&t&&(0,se().$T)({environment:l,inference:{...n,tags:r},project:e.name,dataset:t})}),[l,n,u]);return(0,L.jsx)(b().Z,{menuType:B().o.Popup,...i,children:(0,L.jsxs)("div",{style:d.menuContent,children:[(0,L.jsx)("div",{style:d.label,children:"Project"}),(0,L.jsx)(we,{project:u.project,setProject:g}),u.project&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:d.label,children:"Dataset"}),(0,L.jsx)(ye,{project:u.project.name,dataset:u.dataset,onChange:m})]}),u.project&&u.dataset&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:d.label,children:"Tags"}),(0,L.jsx)(xe,{tags:u.tags,onChange:h}),(0,L.jsx)(ge().Z,{onClick:w,children:"Save"})]})]})})}function we(e){const t=e.project,[n,i]=(0,r.useState)([]),a=(0,o().O7)();return(0,s().r5)((async()=>{const e=await w().callApi({eventName:"getBraintrustProjects",environment:a,data:{}});if("failed"===e.type)throw e.error;i(e.data.projects.map((e=>{let{id:t,name:n}=e;return{id:t,name:n}})))}),[a]),(0,L.jsx)(ke,{items:n.sort(((e,t)=>e.name.localeCompare(t.name))),selectedItem:t,onSelect:e.setProject,renderItem:e=>e.name,isFiltered:(e,t)=>e.name.toLowerCase().includes(t.toLowerCase()),placeholder:"Select project"})}function ye(e){const{project:t,dataset:n,onChange:i}=e,a=(0,o().O7)(),[l,d]=(0,r.useState)([]),c=(0,r.useCallback)((async()=>{if(!t)return;const e=await w().callApi({eventName:"getBraintrustDatasetsForProject",environment:a,data:{project:t}});if("failed"===e.type)throw e.error;const n=e.data.datasets.map((e=>e.name));n.sort(),d(n)}),[a,t]);return(0,s().r5)((async()=>{await c()}),[c]),(0,L.jsx)(ke,{items:l,selectedItem:n,onSelect:i,renderItem:ne().yR,isFiltered:(e,t)=>e.toLowerCase().includes(t.toLowerCase()),placeholder:"Select dataset"})}function ke(e){const{items:t,selectedItem:n,onSelect:o,renderItem:i,placeholder:s,isFiltered:l}=e,d=(0,a().yK)((e=>({chevron:{width:10,marginLeft:4,fill:e.lightIconColor},buttonWrapper:{display:"flex",alignItems:"center"}})),[]),[c,u]=(0,r.useState)(""),p=(0,r.useCallback)((e=>{u(e.target.value)}),[]),f=t.filter((e=>l(e,c)));return(0,L.jsx)(x().ZP,{popupType:x().Z4.Popup,placementToOrigin:x().pO.Bottom,alignmentToOrigin:x().vR.Start,renderOrigin:e=>(0,L.jsx)(y().D,{...e,children:(0,L.jsxs)("div",{style:d.buttonWrapper,children:[n?i(n):s||"",(0,ue().i)(d.chevron)]})}),render:e=>(0,L.jsxs)(b().Z,{menuType:B().o.Popup,children:[(0,L.jsx)(fe().ZP,{value:c,onChange:p,autoFocus:!0}),(0,L.jsx)(S().ZP,{type:S().iW.Vertical,initialFocus:0,sections:[{key:"items",render:e=>(0,L.jsx)(j().Z,{...e}),items:f.map(((t,r)=>({key:r,action:()=>{o(t),e.close()},render:e=>(0,L.jsx)(k().Z,{...e,title:i(t),checkState:t===n})})))}]})]})})}function xe(e){const{tags:t,onChange:n}=e,o=(0,a().yK)((e=>({container:{display:"flex",flexDirection:"column",gap:4},tagsContainer:{display:"flex",flexWrap:"wrap",gap:8}})),[]),i=(0,r.useCallback)((e=>{const r=t.includes(e)?t.filter((t=>t!==e)):[...t,e];n(r)}),[n,t]);return(0,L.jsx)("div",{style:o.container,children:(0,L.jsx)("div",{style:o.tagsContainer,children:J().Bc.map((e=>(0,L.jsxs)(y().D,{onClick:()=>i(e),style:{display:"flex",alignItems:"center",gap:4},children:[(0,L.jsx)(re().Z,{checked:t.includes(e),size:14}),(0,L.jsx)("span",{children:e})]},e)))})})}function ve(e){return`ai-inference-transcript-save-to-dataset-${e}`}function Ce(e){const{clientStore:t,threadStore:n}=e,o=(0,a().yK)((e=>({topBar:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,fontSize:14},configEditorWrap:{display:"flex",flexDirection:"column",gap:8,overflowY:"auto",fontSize:14},inferencesWrap:{display:"flex",flexDirection:"column",gap:8,overflowY:"auto",fontSize:14},tagsRow:{display:"flex",alignItems:"center",gap:8},header:{fontSize:14}})),[]),s=(0,r.useCallback)((()=>{t.setState({...t.state,showDebug:!1})}),[t]),l=(0,i().VK)((()=>t.state.inferences.length),[t]),d=(0,i().VK)((()=>t.state.loading||void 0!==(null==n?void 0:n.getCurrentInferenceId())),[t,n]),c=(0,i().VK)((()=>t.state.inferences),[t]),u=(0,i().VK)((()=>t.state.requestInfo),[t]),p=(0,r.useCallback)((()=>{const{acceptedInferenceKeys:e}=t.state;e.length>0?t.setState({...t.state,acceptedInferenceKeys:[]}):t.setState({...t.state,acceptedInferenceKeys:t.state.inferences.map((e=>e.key))})}),[t]);return(0,L.jsxs)("div",{style:{padding:16,gap:16,display:"flex",flexDirection:"column",rowGap:16},children:[(0,L.jsxs)("div",{style:o.topBar,children:[d&&(0,L.jsx)(C().Z,{}),n&&(0,L.jsx)(Te,{clientStore:t,threadStore:n},n.id),(0,L.jsx)("div",{style:{flexGrow:1}}),(0,L.jsx)(v().Z,{onClick:s,icon:X().U,ariaLabel:"close debug tools"})]}),u&&(0,L.jsx)(be,{requestInfo:u,clientStore:t}),(0,L.jsxs)("div",{style:o.inferencesWrap,children:[c.length>0&&(0,L.jsxs)("div",{style:o.topBar,children:[(0,L.jsx)("div",{style:o.header,children:"Inferences"}),(0,L.jsx)("div",{style:{flexGrow:1}}),l>0&&(0,L.jsx)("div",{children:`${l} inference${1===l?"":"s"}`}),!d&&l>0&&(0,L.jsx)(y().D,{onClick:p,children:"Toggle all"})]}),c.map(((e,n)=>(0,L.jsx)(je,{inference:e,clientStore:t},`${e.key}-${n}`)))]})]})}function be(e){const{requestInfo:t,clientStore:n}=e,o=(0,a().yK)((e=>({wrap:{display:"flex",flexDirection:"column",gap:12,padding:8,border:`1px solid ${e.regularDividerColor}`,borderRadius:4,whiteSpace:"pre-wrap",fontSize:14},header:{display:"flex",gap:8,alignItems:"center"},toggle:{border:"none",padding:0,margin:0},code:{whiteSpace:"pre-wrap",fontFamily:"monospace",background:e.codeBlockBackground,color:e.regularTextColor,padding:8,margin:0,marginBottom:12}})),[]),{request:i,response:s,memory:l}=t,d=i.transcript.find((e=>"config"===e.type)),c=(0,r.useCallback)((()=>{if(!s)throw new Error("Response is required");n.setState({...n.state,requestInfo:{...t,memory:{...J().zF,originalOutput:s}}})}),[n,t,s]),u=(0,r.useCallback)((e=>{n.setState({...n.state,requestInfo:{...t,memory:e}})}),[n,t]),p=(0,r.useMemo)((()=>({id:i.traceId,input:{type:Q().wq,...i},expected:s,metadata:{memories:ne().oA([l])}})),[i,s,l]),f=(0,r.useMemo)((()=>{if(!t.response)return;return{type:"inferenceTranscript",request:t.request,response:t.response}}),[t]);return(0,L.jsxs)("div",{style:o.wrap,children:[(0,L.jsxs)("div",{style:o.header,children:[(0,L.jsx)("span",{style:{flexGrow:1},children:"Request"}),!l&&(0,L.jsx)(y().D,{onClick:c,children:"Add memory"}),p&&(0,L.jsx)(me,{inference:p,scopeKey:`inferenceTranscript-${null==d?void 0:d.value.type}`})]}),(0,L.jsx)(ae().a,{label:"Input",style:o.toggle,children:(0,L.jsx)(ie().c,{language:"json",value:JSON.stringify(t.request,null,2)})}),t.response?(0,L.jsx)(ae().a,{label:"Output",style:o.toggle,children:(0,L.jsx)(ie().c,{value:JSON.stringify(t.response,null,2),language:"json"})}):null,f&&l&&(0,L.jsx)(ce,{request:f,memory:l,onChange:u,clientStore:n})]})}function Se(e){const{inference:t,clientStore:s}=e,l=t.key,d=(0,o().O7)(),c=(0,a().yK)((e=>({wrap:{display:"flex",flexDirection:"column",gap:12,padding:8,border:`1px solid ${e.regularDividerColor}`,borderRadius:4,whiteSpace:"pre-wrap",fontSize:14},header:{display:"flex",gap:8,alignItems:"center"},toggle:{border:"none",padding:0,margin:0},code:{whiteSpace:"pre-wrap",fontFamily:"monospace",background:e.codeBlockBackground,color:e.regularTextColor,padding:8,margin:0,marginBottom:12},lockedIcon:{width:16}})),[]),u=(0,i().VK)((()=>s.state.inferenceKeysToAnnotations[l]),[s,l]),p=(0,r.useCallback)((e=>{const t=e.target.value,n={...s.state.inferenceKeysToAnnotations,[l]:t};s.setState({...s.state,inferenceKeysToAnnotations:n})}),[s,l]),f=(0,i().VK)((()=>{const{acceptedInferenceKeys:e}=s.state;return e.includes(l)}),[s,l]),g=(0,r.useCallback)((e=>{const{acceptedInferenceKeys:t,inferences:n}=s.state,r=e.shiftKey;if(t.includes(l))if(r){const e=n.findIndex((e=>e.key===l)),r=n.slice(0,e+1).map((e=>e.key));s.setState({...s.state,acceptedInferenceKeys:ne().jj(t.filter((e=>!r.includes(e))))})}else s.setState({...s.state,acceptedInferenceKeys:t.filter((e=>e!==l))});else if(r){const e=n.findIndex((e=>e.key===l)),r=n.slice(0,e+1).map((e=>e.key)),o=ne().jj([...t,...r]);s.setState({...s.state,acceptedInferenceKeys:o})}else s.setState({...s.state,acceptedInferenceKeys:ne().jj([...t,l])})}),[s,l]),m=(0,r.useMemo)((()=>{const e=null==t?void 0:t.value.expected;if(!e)return"";if("string"!=typeof e)return JSON.stringify(e,null,2);try{return e.trim().startsWith("{")?JSON.stringify(JSON.parse(e),null,2):e}catch(n){return e}}),[t]),h=(0,i().VK)((()=>s.state.inferenceKeysToMemories[l]),[s,l]),w=(0,r.useMemo)((()=>({type:"inference",inference:t.value})),[t]),k=(0,r.useCallback)((async()=>{await(0,se().SN)({environment:d,clientStore:s,inference:t})}),[s,d,t]),x=(0,r.useCallback)((e=>{s.setState({...s.state,inferenceKeysToMemories:{...s.state.inferenceKeysToMemories,[l]:e}})}),[s,l]),v=(0,r.useCallback)((()=>{if(!t.value.expected)throw new Error("Expected output is required");s.setState({...s.state,inferenceKeysToMemories:{...s.state.inferenceKeysToMemories,[l]:{...J().zF,originalOutput:t.value.expected}}})}),[s,l,t]),C=(0,r.useMemo)((()=>({...t.value,metadata:{...t.value.metadata,memories:ne().oA([h])}})),[t,h]);return t?(0,L.jsxs)("div",{style:c.wrap,children:[(0,L.jsxs)("div",{style:c.header,children:[(0,L.jsx)(I().Z,{renderTooltip:()=>(0,L.jsx)("div",{style:{width:300,whiteSpace:"normal"},children:"Checking this will 'freeze' this inference. When the request is retried, instead of running the inference again, the original output will be used."}),placement:oe().Placement.Top,render:e=>(0,L.jsx)("div",{...e,children:(0,L.jsx)(re().Z,{checked:f,size:14,onClick:g})})}),(0,L.jsx)("span",{style:{flexGrow:1},children:Ie(t.value.input)}),(0,L.jsx)(y().D,{onClick:k,children:"Retry"}),!h&&(0,L.jsx)(y().D,{onClick:v,children:"Add memory"}),(0,L.jsx)(me,{inference:C,scopeKey:`inference-${t.value.input.type}`,defaultState:{project:Q().V8,dataset:t.value.input.type,tags:[]}})]}),(0,L.jsx)(I().Z,{renderTooltip:()=>(0,L.jsx)("div",{style:{width:300,whiteSpace:"normal"},children:"The text you type here is passed as 'context.annotation' when this inference is retried. Typically, this is rendered as a final user step in the prompt used to 'nudge' the model."}),placement:oe().Placement.Right,render:e=>(0,L.jsx)("div",{...e,children:(0,L.jsx)(n(291198).Z,{value:u,placeholder:"Set annotation",onChange:p,textarea:!0,autosize:!0})})}),(0,L.jsx)(ae().a,{label:"Input",style:c.toggle,children:(0,L.jsx)(ie().c,{language:"json",value:JSON.stringify({...t.value.input,examples:void 0},null,2)})}),t.value.expected?(0,L.jsx)(ae().a,{label:"Output",style:c.toggle,children:(0,L.jsx)(ie().c,{value:m,language:"json"})}):null,t.value.metadata?(0,L.jsx)(ae().a,{label:"Metadata",style:c.toggle,children:(0,L.jsx)(ie().c,{value:JSON.stringify(t.value.metadata,null,2),language:"json"})}):null,h&&(0,L.jsx)(ce,{request:w,memory:h,onChange:x,clientStore:s})]}):null}const je=r.memo(Se);function Ie(e){let t=e.type;"fileName"in e&&(t+=` – ${e.fileName}`),"testName"in e&&(t+=` – ${e.testName}`),"functionKey"in e&&(t+=` – ${e.functionKey}`),"key"in e&&(t+=` – ${e.key}`);const n=["retries","validationRetries"];for(const r of n)if(r in e&&e[r].length>0){t+=` (${e[r].filter((e=>"assistant"!==e.type)).length} error steps)`}return t}function Te(e){const{clientStore:t,threadStore:n}=e,l=(0,o().O7)(),d=(0,a().yK)((e=>({button:{fontSize:14}})),[]),c=(0,i().VK)((()=>n.getSpaceId()),[n]),u=(0,i().VK)((()=>{const e=n.getMessageStores().map((e=>{const t=e.getStep();if(t&&"config"===t.type)return t.value.type}));return ne().oA(e)[0]}),[n]),[{value:p},f]=(0,s().r5)((async()=>{if(!c||!u)return;const e=Y({environmentName:"production",suffix:u});return await w().callApi({eventName:"getBraintrustLogsForThread",environment:l,data:{project:e,threadId:n.id,spaceId:c}})}),[l,c,n,u]),g=(0,r.useMemo)((()=>{if(!p||"failed"===p.type)return;const e=p.data.logs,t=[],n=new Map;for(const r of e)if(r.span_id===r.root_span_id)t.push(r);else if(r.root_span_id){const e=n.get(r.root_span_id)||[];e.push(r),n.set(r.root_span_id,e)}for(const r of n.values())r.sort(((e,t)=>{var n,r;return((null===(n=e.metadata)||void 0===n?void 0:n.index)||0)-((null===(r=t.metadata)||void 0===r?void 0:r.index)||0)}));return t.sort(((e,t)=>{const n=new Date(e.created||"");return new Date(t.created||"").getTime()-n.getTime()})),{rootSpans:t,subSpanGroups:n}}),[p]),m=(0,r.useCallback)((e=>{if(!e.span_id)return;const n=null==g?void 0:g.subSpanGroups.get(e.span_id);n&&t.setState({...t.state,requestInfo:{request:e.input,response:e.output,memory:void 0},inferences:n.filter((e=>{var t;return"number"==typeof(null===(t=e.metadata)||void 0===t?void 0:t.index)})).map((e=>{var t;const n=null===(t=e.metadata)||void 0===t?void 0:t.index;if("number"!=typeof n)throw new Error("Index is not a number");return{type:"inference",key:(0,te().o_)(e.input),index:n,value:{id:e.id,input:e.input,expected:e.output,metadata:e.metadata}}}))})}),[t,g]),h=(0,r.useCallback)((()=>{var e;const n=null===(e=t.state.requestInfo)||void 0===e?void 0:e.request.traceId;if(!u||!n)return;const r=Y({environmentName:"production",suffix:u});window.open(`https://www.braintrust.dev/app/Notion/p/${r}/logs?r=${n}`,"_blank")}),[t,u]);return(0,L.jsx)(x().ZP,{popupType:x().Z4.Popup,placementToOrigin:x().pO.Bottom,alignmentToOrigin:x().vR.Start,renderOrigin:e=>(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(y().D,{...e,style:d.button,children:"failed"===(null==p?void 0:p.type)?"Failed to load logs":g?`View logs (${g.rootSpans.length})`:"Loading logs"}),(0,L.jsx)(I().Z,{renderTooltip:()=>(0,L.jsx)("span",{children:"Open in Braintrust"}),render:e=>(0,L.jsx)(v().Z,{...e,icon:ee().S,ariaLabel:"Open in Braintrust",onClick:h})})]}),render:e=>(0,L.jsxs)(b().Z,{menuType:B().o.Popup,children:[(0,L.jsx)(y().D,{onClick:()=>{e.close(),f()},children:"Refresh"}),(0,L.jsx)(S().ZP,{type:S().iW.Vertical,initialFocus:0,sections:[{key:"dates",render:e=>(0,L.jsx)(j().Z,{...e,shouldShowBottomDivider:!0}),items:((null==g?void 0:g.rootSpans)||[]).map((t=>({key:t.id,render:e=>(0,L.jsx)(k().Z,{...e,title:t.created||"No date"}),action:()=>{e.close(),m(t)}})))||[]}]})]})})}var Me=()=>n(114087),Pe=()=>n(594860),De=()=>n(452435),Be=()=>n(707513),Ae=()=>n(741543),Ze=()=>n(642611);function Ke(e){const{module:t,workflowValue:n}=e,r=(0,a().yK)((e=>({container:{display:"flex",gap:4,flexDirection:"column"},title:{color:e.text.tertiary,fontWeight:Be().Ue.medium,fontSize:14}})),[]),{store:o,workflowStore:s}=(0,Ae().dP)(),l=Ze().D[t.type],d=(0,i().VK)((()=>null==s?void 0:s.id),[s]);if(!l)throw new Error(`Module definition not found for module ${t.type}`);if(!d)return null;if(l.ModuleConfiguration){const{ModuleConfiguration:e}=l;return(0,L.jsx)("div",{style:r.container,children:(0,L.jsx)(e,{module:t,store:o,workflowValue:n,workflowId:d})})}return null}var Ee=()=>n(25014),Re=()=>n(10986);function Fe(e){const{clientStore:t,threadStore:n}=e;if(!n)return;const r=(0,Re().JC)({clientStore:t,threadStore:n});if(!r)return;const o=r.value;return{triggers:(o.triggers??[]).filter((e=>!(0,te().cn)(e,o))),modules:(o.modules??[]).filter((e=>"ready"!==Pe().O[e.type].getModuleConfigurationStatus(e)))}}function Ve(e){const{clientStore:t,threadStore:n,isInWorkflowEditor:a}=e,s=(0,i().VK)((()=>{if(!n)return;const e=(0,Re().JC)({clientStore:t,threadStore:n});return null==e?void 0:e.value}),[t,n]),l=(0,i().VK)((()=>Fe({clientStore:t,threadStore:n})),[t,n]),d=(0,i().VK)((()=>null==n?void 0:n.getSpaceId()),[n]),c=(0,o().O7)();(0,De().useInitializationOfExternalStores)({environment:c,spaceId:d});const u=(0,r.useMemo)((()=>{if(!l||!s||!a)return;const{modules:e,triggers:t}=l,n=[];for(const r of e)n.push((0,L.jsx)(Ke,{workflowValue:s,module:r}));for(const r of t)n.push((0,L.jsx)(Ee().bl,{workflowValue:s,trigger:r}));return ne().oA(n)[0]}),[l,s,a]);return(0,L.jsx)("div",{children:u})}function We(e){const{threadStore:t,config:n,showSidebarButton:s,onThreadChange:c,defaultUserMessage:p,clientStore:w,isInWorkflowEditor:y,getAppendStepsOnUserInputSubmit:k,parentBlockStore:x}=e,{isElectronWindows:C}=(0,o().Fy)(),b=(0,o().O7)(),S=(0,Z().E)("workflows_debug_tools"),j=(0,i().VK)((()=>w.state.showDebug),[w]),{store:B,setValue:E}=(0,P().Cl)({initialValue:(0,h().TPx)(p)});(0,r.useEffect)((()=>{n&&w.state.config!==n&&w.setState({...w.state,config:n})}),[w,n]);const R=j,V=(0,r.useRef)(null),[W,O]=(0,r.useState)(!0),[q,N]=(0,r.useState)(!1),[U,H]=(0,r.useState)(!0),z=(0,a().yK)((e=>({pageLayout:{display:"flex",flexDirection:"column",minHeight:"100vh",width:"100%",backgroundColor:e.contentBackground,order:2},header:{flex:"0 0 auto",display:"flex",height:44,alignItems:"center",justifyContent:"space-between",padding:"0 12px",backgroundColor:e.contentBackground,borderBottom:q?`1px solid ${e.stroke.secondary}`:"1px solid transparent",transition:"border-color 150ms ease-out"},columns:{display:"flex",flexDirection:"row",flex:1,minHeight:0,gap:12,...R&&{paddingLeft:16}},chatColumn:{flex:1,display:"flex",flexDirection:"column",minHeight:0},contentWrapper:{flex:1,overflowY:"auto",position:"relative"},contentContainer:{margin:"0 auto",width:"100%",maxWidth:800,padding:"16px 12px 16px",marginLeft:"auto"},inputWrapper:{flex:"0 0 auto",position:"relative",backgroundColor:e.contentBackground,padding:"0 0 12px"},scrollToBottomButton:{position:"absolute",left:"50%",bottom:"100%",transform:"translate(-50%, -8px)",zIndex:2,padding:10,borderRadius:20,backgroundColor:"dark"===e.mode?"#fff":"#000",border:"none",cursor:"pointer",fontWeight:500,boxShadow:"dark"===e.mode?`0px 0px 0px 0.5px ${e.stroke.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.12), 0px 4px 16px -2px rgba(0, 0, 0, 0.6)`:`0px 0px 0px 0.5px ${e.stroke.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.02), 0px 4px 16px -2px rgba(0, 0, 0, 0.1)`,transition:"opacity 150ms ease-out, transform 150ms ease-out",opacity:0,pointerEvents:"none"},scrollToBottomButtonVisible:{opacity:1,transform:"translate(-50%, -16px)",pointerEvents:"auto"},scrollToBottomButtonHidden:{opacity:0,transform:"translate(-50%, -8px)",pointerEvents:"none"},inputContainer:{margin:"0 auto",width:"100%",maxWidth:800,padding:"0 12px",marginLeft:"auto"},gradientMask:{width:"100%",height:y?32:44,pointerEvents:"none",position:"absolute",bottom:"100%",background:`linear-gradient(to bottom, rgba(255, 255, 255, 0), ${e.contentBackground})`},leftActions:{display:"flex",alignItems:"center",gap:8},rightActions:{display:"flex",alignItems:"center",gap:8,marginLeft:"auto"},title:{position:"absolute",left:"50%",transform:"translateX(-50%)",fontSize:16,fontWeight:500,textAlign:"center"},floatingColumn:{zIndex:1,marginTop:4,marginBottom:16,backgroundColor:e.contentBackground,overflow:"auto",boxShadow:"0px 18px 32px 0px rgba(0, 0, 0, 0.04), 0px 0px 0px 1px rgba(0, 0, 0, 0.03)",backdropFilter:"blur(10px)",borderRadius:8,padding:8,display:"flex",flexDirection:"column",gap:8},historyColumn:{width:350},debugColumn:{width:600},iconButton:{width:32,height:32},iconButtonIcon:{width:18,height:18,fill:e.regularIconColor},chevronDownIcon:{width:12,height:12,fill:"dark"===e.mode?"#000":e.white,transform:"translateY(1px)"}})),[R,q,y]),_=(0,r.useCallback)((()=>{const e=V.current;if(!e)return;const t=e.scrollHeight-e.scrollTop-e.clientHeight<50;O(t),!t&&U&&H(!1),t&&!U&&H(!0),N(e.scrollTop>2)}),[U]);(0,r.useEffect)((()=>{const e=V.current;if(!e)return;e.addEventListener("scroll",_);const t=new MutationObserver((()=>{U&&(e.scrollTop=e.scrollHeight),setTimeout(_,100)}));return t.observe(e,{childList:!0,subtree:!0,characterData:!0}),setTimeout(_,100),()=>{e.removeEventListener("scroll",_),t.disconnect()}}),[_,U]),(0,r.useEffect)((()=>{const e=V.current;if(!e)return;const t=setTimeout((()=>{e.scrollTop=e.scrollHeight,H(!0)}),100);return()=>clearTimeout(t)}),[null==t?void 0:t.id]);const J=(0,r.useCallback)((()=>{const e=V.current;e&&A().X5({element:e,environment:b,options:{top:e.scrollHeight,behavior:"smooth"}})}),[b]),Y=(0,i().VK)((()=>{const{currentSpaceStore:e}=K().default.state;if(e)return x?{table:f().iU,id:x.pointer.id,spaceId:e.id}:{table:g().bx,id:e.id,spaceId:e.id}}),[x]),Q=(0,r.useCallback)((e=>{if(!e||0===e.length)return;E(void 0);const{currentSpaceStore:r,currentUserStore:o}=K().default.state;if(!r||!e||!Y)throw new Error("No current space or value");if(!b.currentUser.id)throw new Error("No current user");const i=(null==t?void 0:t.id)??(0,D().TS)({environment:b,table:m().kL,spaceId:r.id}),a=(null==k?void 0:k({currentSteps:(null==t?void 0:t.getTranscript())||[]}))||[];(0,F().cz)({environment:b,clientStore:w,threadStore:t,threadId:i,threadParentPointer:Y,additionalSteps:a,config:n||w.state.config,userStore:o,spaceStore:r,value:e}),null==c||c({id:i})}),[w,b,E,c,n,t,k,Y]),X=(0,r.useCallback)((()=>{w.setState({...w.state,showDebug:!w.state.showDebug})}),[w]),ee=(0,i().VK)((()=>w.state.model),[w]),te=(0,r.useCallback)((e=>{(0,F().po)({clientStore:w}),null==c||c({id:e})}),[c,w]),ne=(0,r.useCallback)((e=>{w.setState({...w.state,model:e})}),[w]),re=(0,i().VK)((()=>function(e){const t=Fe(e);return!!t&&(t.triggers.length>0||t.modules.length>0)}({clientStore:w,threadStore:t})),[w,t]);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{style:z.header,children:[(0,L.jsxs)("div",{style:z.leftActions,children:[s&&(0,L.jsx)(M().o,{}),(0,L.jsx)(Le,{threadStore:t,handleThreadClick:te,threadParentPointer:Y}),C&&(0,L.jsx)(T().m,{})]}),(0,L.jsxs)("div",{style:z.rightActions,children:[S&&(0,L.jsx)(Me().q,{model:ee,setModel:ne,format:"badge"}),S&&(0,L.jsx)(I().Z,{renderTooltip:()=>(0,L.jsx)("span",{children:"Debug"}),render:e=>(0,L.jsx)(v().Z,{...e,icon:l().r,iconStyle:z.iconButtonIcon,style:z.iconButton,ariaLabel:"Debug",onClick:X})}),(0,L.jsx)(I().Z,{renderTooltip:()=>(0,L.jsx)("span",{children:"New chat"}),render:e=>(0,L.jsx)(v().Z,{...e,icon:u().e,iconStyle:z.iconButtonIcon,style:z.iconButton,ariaLabel:"New chat",onClick:()=>te(void 0)})})]})]}),(0,L.jsxs)("div",{style:z.columns,children:[j&&(0,L.jsx)("div",{style:{...z.floatingColumn,...z.debugColumn},children:(0,L.jsx)(Ce,{clientStore:w,threadStore:t})}),(0,L.jsxs)("div",{style:z.chatColumn,children:[(0,L.jsx)("div",{style:z.contentWrapper,ref:V,children:(0,L.jsxs)("div",{style:z.contentContainer,children:[(0,L.jsx)($().X,{clientStore:w,config:n,threadStore:t,isInWorkflowEditor:y}),re&&(0,L.jsx)("div",{children:(0,L.jsx)(Ve,{clientStore:w,config:n,threadStore:t,isInWorkflowEditor:y})})]})}),(0,L.jsxs)("div",{style:z.inputWrapper,children:[(0,L.jsx)("button",{onClick:J,style:{...z.scrollToBottomButton,...!W&&z.scrollToBottomButtonVisible},children:(0,d().E)(z.chevronDownIcon)}),(0,L.jsx)("div",{style:z.gradientMask}),(0,L.jsx)("div",{style:z.inputContainer,children:(0,L.jsx)(G,{store:B,onSubmit:Q,clientStore:w,threadStore:t})})]})]})]})]})}function Le(e){let{threadStore:t,handleThreadClick:n,threadParentPointer:l}=e;const u=(0,o().O7)(),f=(0,i().VK)((()=>{var e;return null==t||null===(e=t.getData())||void 0===e?void 0:e.title}),[t]),g=!!t,h=(0,a().yK)((e=>({title:{color:g?e.text.primary:e.text.secondary,maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},checkIcon:{width:14},chevronDownIcon:{width:10,marginLeft:6,fill:e.mediumIconColor,flexShrink:0},newChatButtonContainer:{padding:8},newChatButton:{width:"100%",textAlign:"center",justifyContent:"center",background:e.assistantTintedActionButtonBackground},loadingStateContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",gap:8,padding:32},clockIcon:{width:24,opacity:.2}})),[g]),[v,I]=(0,r.useState)([]),[{status:T,value:M}]=(0,s().r5)((async()=>{if(!l)return;if(!E().default.state.online)return;const e=await w().callApi({eventName:"getInferenceTranscriptsForUser",environment:u,data:{threadParentPointer:l}});return"failed"!==e.type?(I((t=>{const n=new Set(t.map((e=>e.id)));return[...t,...e.data.transcripts.filter((e=>!n.has(e.id)))]})),e.data.transcripts):void 0}),[l,u]);(0,r.useEffect)((()=>{const{currentSpaceStore:e}=K().default.state;if(!e||!M||0===M.length)return;const t=R().V3.createChildStore(e,{table:m().kL,id:M[0].id,spaceId:e.id});void 0!==t.getCurrentInferenceId()&&n(t.id)}),[M,n]);const P=(0,i().VK)((()=>{if(t)return{id:t.id,title:t.getDataStore().getKeyStore("title").getValue(),created_at:t.getCreatedTime()}}),[t]);(0,r.useEffect)((()=>{P&&I((e=>e.find((e=>e.id===P.id))?e.map((e=>e.id===P.id?P:e)):[P,...e]))}),[P]);const D=(0,r.useCallback)((()=>(0,L.jsx)("div",{style:h.loadingStateContainer,children:(0,L.jsx)(C().Z,{})})),[h.loadingStateContainer]),A=(0,r.useCallback)((()=>(0,L.jsx)("div",{style:h.loadingStateContainer,children:(0,c().a)(h.clockIcon)})),[h.loadingStateContainer,h.clockIcon]),Z=(0,r.useCallback)((e=>"pending"===T?[{key:"loading",render:e=>(0,L.jsx)(j().Z,{...e,title:"Previous chats",shouldShowBottomDivider:!1}),items:[{key:"loading-item",action:()=>{},render:()=>(0,L.jsx)(D,{})}]}]:v&&0!==v.length?[{key:"history",render:e=>(0,L.jsx)(j().Z,{...e,title:"Previous chats"}),items:v.map((r=>({key:r.id,action:()=>{n(r.id),e.close()},render:e=>(0,L.jsx)(k().Z,{...e,title:r.title||"Untitled chat",right:(null==t?void 0:t.id)===r.id?(0,p().Z)(h.checkIcon):void 0})})))}]:[{key:"empty",render:e=>(0,L.jsx)(j().Z,{...e,title:"Previous chats"}),items:[{key:"empty-item",action:()=>{},render:()=>(0,L.jsx)(A,{})}]}]),[T,v,t,D,A,h.checkIcon,n]);return(0,L.jsx)(x().ZP,{popupType:x().Z4.Popup,placementToOrigin:x().pO.Bottom,alignmentToOrigin:x().vR.Start,renderOrigin:e=>(0,L.jsxs)(y().D,{ariaLabel:"history",...e,children:[(0,L.jsx)("span",{style:h.title,children:g?f||"Untitled chat":"New chat"}),(0,L.jsx)(L.Fragment,{children:(0,d().E)(h.chevronDownIcon)})]}),render:e=>(0,L.jsx)(b().Z,{menuType:B().o.Popup,width:300,children:(0,L.jsx)(S().ZP,{type:S().iW.Vertical,initialFocus:0,sections:Z(e)})})})}},114087:(e,t,n)=>{n.d(t,{q:()=>v});n(241792),n(667294);var r=()=>n(219727),o=()=>n(142735),i=()=>n(846550),a=()=>n(578220),s=()=>n(707513),l=()=>n(154186),d=()=>n(265640),c=()=>n(827973),u=()=>n(448419),p=()=>n(198829),f=()=>n(255577),g=()=>n(388284),m=()=>n(654133),h=()=>n(352230),w=()=>n(164079),y=()=>n(998901),k=()=>n(260889),x=n(785893);function v(e){const t=e.model,n=(0,r().O7)(),v=(0,i().yK)((e=>({badge:{fontSize:12,fontWeight:500,padding:"1px 6px",backgroundColor:e.cardHoveredBackground,color:e.lightTextColor,borderRadius:4,...s().Yu},checkIcon:{width:14}})),[]),b=(0,o().VK)((()=>k().x.getData(n,{})||[]),[n]),S=e.model?C[e.model]||e.model:"Default model";return(0,x.jsx)(u().ZP,{popupType:u().Z4.Popup,placementToOrigin:u().pO.Bottom,alignmentToOrigin:u().vR.Start,renderOrigin:t=>(0,x.jsx)(m().Z,{renderTooltip:()=>(0,x.jsx)("div",{children:"Select a model"}),placement:y().Placement.Bottom,alignment:y().Alignment.Center,render:n=>"button"===e.format?(0,x.jsx)(d().D,{...(0,w().Z)(t,n),children:S}):(0,x.jsx)(l().Z,{...(0,w().Z)(t,n),ignoreLocalHoverState:!0,children:(0,x.jsx)("div",{style:v.badge,children:S})})}),render:n=>(0,x.jsx)(p().Z,{menuType:h().o.Popup,children:(0,x.jsx)(f().ZP,{type:f().iW.Vertical,initialFocus:0,sections:[{key:"models",render:e=>(0,x.jsx)(g().Z,{...e,title:"Models",shouldShowBottomDivider:!0}),items:b.map((r=>({key:r,action:()=>{e.setModel(r),n.close()},render:e=>(0,x.jsx)(c().Z,{...e,title:C[r]||r,right:r===t?(0,a().Z)(v.checkIcon):void 0})})))}]})})})}const C={default:"Default model","openai-gpt-4o":"OpenAI GPT-4o","openai-chatgpt-4o-latest":"OpenAI ChatGPT-4o-latest","openai-gpt-4o-mini":"OpenAI GPT-4o-mini","openai-o1":"OpenAI o1","openai-o1-mini":"OpenAI o1-mini","openai-o3-mini":"OpenAI o3-mini","anthropic-haiku":"Anthropic Haiku","anthropic-sonnet":"Anthropic Sonnet","anthropic-opus":"Anthropic Opus","vertex-gemini-1.5-pro":"Vertex Gemini 1.5 Pro","vertex-gemini-1.5-flash":"Vertex Gemini 1.5 Flash","vertex-gemini-2.0-flash":"Vertex Gemini 2.0 Flash","groq-gemma2-9b-it":"Groq Gemma2 9b It","groq-gemma-7b-it":"Groq Gemma 7b It","groq-llama-70b":"Groq Llama 70b","groq-llama-8b":"Groq Llama 8b","groq-mixtral":"Groq Mixtral","fireworks-llama3.1-405b":"Llama 3.1 405b","fireworks-llama3.1-70b":"Llama 3.1 70b","fireworks-llama3.3-70b":"Llama 3.3 70b","fireworks-llama3.3-70b-dedicated":"Llama 3.3 70b Dedicated","fireworks-llama3.1-8b":"Llama 3.1 8b","fireworks-llama3-70b":"Llama 3.70b","fireworks-mixtral-22b":"Mixtral 22b","fireworks-mixtral-7b":"Mixtral 7b","fireworks-ft-router-101":"FT Router 101","fireworks-ft-router-102":"FT Router 102","fireworks-deepseek-v3":"DeepSeek V3","fireworks-deepseek-r1":"DeepSeek R1"}},790819:(e,t,n)=>{n.d(t,{S:()=>l});var r=n(667294),o=()=>n(619857),i=()=>n(707513),a=n(785893);const s={height:"auto",maxWidth:"auto",paddingInline:4},l=(0,r.forwardRef)((function(e,t){const{children:l,disabled:c,hasActionRequired:u,errorIcon:p,icon:f,isCompact:g,isError:m,isSecondary:h,onClick:w,style:y,tooltipMessage:k,dropdownButtonType:x}=e,v=(0,n(219727).O7)(),C="dropdown"===x,b=(0,n(846550).yK)((e=>({button:{...d(e,{isError:m,hasActionRequired:u,isSecondary:h,dropdownButtonType:x}),gap:2,padding:"0 6px",...g?s:void 0,...C&&{alignItems:"center",height:20,paddingBlock:0,marginBlock:0},...y},children:{...i().Yu,lineHeight:"20px",flex:"1 1 auto",display:"grid",gridTemplateColumns:"auto auto",gap:2,...C&&{padding:"0 2px"}},icon:{width:16,height:16,marginRight:2,...m?{fill:e.lightErrorText}:void 0},warningIcon:{color:e.errorText,fill:e.errorText,height:12,flex:"0 0 auto",marginRight:2,width:12},chevronIcon:{fill:e.icon.secondary,flex:"0 0 auto",...g?{height:12,width:12}:{height:14,width:14},...C&&{fill:"unset"}}})),[m,u,h,x,g,C,y]),S=(0,r.useMemo)((()=>f?()=>f(b.icon):void 0),[f,b.icon]),j=(0,r.useCallback)((()=>k??null),[k]),I=(0,r.useCallback)((e=>{n(990966).clear({environment:v}),n(879952).ZH({environment:v}),null==w||w(e),e.stopPropagation()}),[v,w]),T=p||n(521913).t,M=m?()=>T(b.warningIcon):S;return(0,a.jsx)(n(654133).Z,{delayThreshold:0,disableTooltip:!Boolean(k),placement:n(998901).Placement.Bottom,render:e=>"dropdown"===x?(0,a.jsxs)(n(687626).Z,{...e,variant:m?"secondary":"lightGray",disabled:c,disabledFeedback:c,onClick:I,ref:t,style:b.button,children:[M&&M(),(0,a.jsx)("div",{style:b.children,children:l}),g?(0,n(303171).A)(b.chevronIcon):(0,o().Y)(b.chevronIcon)]}):(0,a.jsxs)(n(265640).D,{...e,icon:m?M:S,disabled:c,disabledFeedback:c,onClick:I,ref:t,shouldShrink:!0,style:b.button,isRed:m,children:[(0,a.jsx)("div",{style:b.children,children:l}),(0,o().Y)(b.chevronIcon)]}),renderTooltip:j})}));function d(e,t){const{isError:n,hasActionRequired:r,isSecondary:o,dropdownButtonType:a}=t;return n?{color:e.errorText,..."dropdown"===a&&{boxShadow:"none"}}:r?{fontWeight:i().Ue.regular,color:e.text.secondary}:o?{color:e.text.secondary}:{fontWeight:i().Ue.regular,color:e.text.primary}}},166312:(e,t,n)=>{n.d(t,{De:()=>m,HH:()=>h,WP:()=>f,dF:()=>g,mq:()=>c,wo:()=>u,z$:()=>p});n(670560);var r=()=>n(730120),o=(n(667294),()=>n(157955)),i=()=>n(874459),a=()=>n(788860),s=()=>n(696459),l=()=>n(239482),d=n(785893);const c=[{frequency:"day",interval:1},{frequency:"week",interval:1},{frequency:"month",interval:1},{frequency:"year",interval:1}];function u(e){const t=l().eG(e)??[],n=[];for(const r of t){if(!("block"===r.table&&!0===r.isTemplate()&&r.getFormat().automation_id&&r.id!==e.id))continue;const t=r.getAutomationStore();if(t){if(!t.isReady())return{automationStoresReady:!1};void 0!==t.getRecurrence()&&t.isDefined()&&n.push(t.getModel())}}return{automationStoresReady:!0,...(0,o().templateAncestorsViolateRecurrenceNesting)(n)}}function p(e){switch(e){case"day":return(0,d.jsx)(a()._H,{defaultMessage:"Repeat daily",id:"database.templatePickerItem.recurrenceFrequency.daily"});case"week":return(0,d.jsx)(a()._H,{defaultMessage:"Repeat weekly",id:"database.templatePickerItem.recurrenceFrequency.weekly"});case"month":return(0,d.jsx)(a()._H,{defaultMessage:"Repeat monthly",id:"database.templatePickerItem.recurrenceFrequency.monthly"});case"year":return(0,d.jsx)(a()._H,{defaultMessage:"Repeat yearly",id:"database.templatePickerItem.recurrenceFrequency.yearly"});default:(0,s().t1)(e)}}function f(e,t){const n="week"!==t||void 0!==e.weekdays&&0!==e.weekdays.length?e.weekdays:[(i=e.start_date,(0,s().Yd)(o().RRULE_WEEKDAYS_MAP)[r().ou.fromMillis(i).weekday-1])];var i;return{...e,weekdays:n,frequency:t}}function g(){return{start_date:r().ou.local().plus({days:1}).set({hour:0,minute:0,second:0,millisecond:0}).toMillis(),timezone:(0,i().Sv)(),hour:0,minute:0,frequency:"day",interval:1}}function m(e){const{recurrence:t,intl:n,leadingPhrase:r}=e;return(0,o().rruleFromRecurrence)({..."month"===t.frequency?{...t,monthly_restriction:void 0}:t,weekdays:void 0,hour:0,minute:0,end_condition:void 0}).toText((e=>{switch(e){case"every":if(void 0===r)return"";if("every"===r)return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.every",defaultMessage:"every"});if("repeat every"===r)return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.repeatEvery",defaultMessage:"repeat every"});(0,s().t1)(r);break;case"day":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.day",defaultMessage:"day"});case"days":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.days",defaultMessage:"days"});case"week":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.week",defaultMessage:"week"});case"weeks":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.weeks",defaultMessage:"weeks"});case"month":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.month",defaultMessage:"month"});case"months":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.months",defaultMessage:"months"});case"year":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.year",defaultMessage:"year"});case"years":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.years",defaultMessage:"years"});default:return e.toString()}})).trim()}function h(e){const t=e.getRecurrence();return Boolean(e.isTriggerType("recurrence")&&t&&"disabled_recurrence_ended"===e.getStatus())}},687626:(e,t,n)=>{n.d(t,{Z:()=>u});var r=n(667294),o=()=>n(568017),i=()=>n(696459),a=n(785893);function s(e,t){switch(e){case"primary":return{background:o().ZP.frontBlueButtonBackground,boxShadow:t.buttonBoxShadow,color:"white"};case"secondary":return{background:o().ZP.frontSecondaryButtonBackground,boxShadow:`\n\t\t\t\t\t0 1px 2px rgba(15, 15, 15, 0.1),\n\t\t\t\t\tinset 0 0 0 1px ${o().ZP.redWithAlpha(.3)}`,color:o().ZP.red};case"tertiary":case"aiTertiary":return{background:o().ZP.white,color:o().ZP.frontTextDark,border:"1px solid rgba(15, 15, 15, 0.15)",width:"100%",boxShadow:"0 1px 2px rgba(15, 15, 15, 0.05)"};case"quaternary":return{background:o().ZP.frontQuaternaryButtonBackground,border:`1px solid ${o().ZP.frontQuaternaryButtonBorder}`,boxShadow:"0 1px 2px rgba(15, 15, 15, 0.1)",color:"white"};case"aiPrimary":return{background:"#CA59FF",color:"white"};case"lightGray":return{background:t.tint.regular,color:t.text.secondary};default:(0,i().t1)(e)}}function l(e,t){switch(e){case"primary":return{background:o().ZP.frontBlueButtonHoveredBackground};case"secondary":return{background:o().ZP.frontSecondaryButtonBackgroundHovered};case"tertiary":return{background:"light"===t.mode?t.buttonHoveredBackground:o().ZP.whiteWithAlpha(.8)};case"quaternary":return{background:o().ZP.frontQuaternaryButtonBackgroundHovered};case"aiPrimary":case"aiTertiary":return{background:"#C592DD"};case"lightGray":return{background:t.tint.regular,color:t.text.primary};default:(0,i().t1)(e)}}function d(e,t){switch(e){case"primary":return{background:o().ZP.frontBlueButtonPressedBackground};case"secondary":return{background:t.buttonPressedBackground};case"tertiary":return{background:"light"===t.mode?t.buttonPressedBackground:o().ZP.whiteWithAlpha(.85)};case"quaternary":return{background:o().ZP.frontQuaternaryButtonBackgroundPressed};case"aiPrimary":case"aiTertiary":return{background:"#946EA6"};case"lightGray":return{background:t.state.pressed,color:t.text.primary};default:(0,i().t1)(e)}}function c(e,t){const{id:r,children:o,disabledFeedback:i,isFullWidth:c,isLoading:u,onClick:p,style:f,variant:g,...m}=e,h=(0,n(846550).Fg)(),w={display:"inline-grid",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",height:36,borderRadius:4,fontSize:14,lineHeight:1,paddingLeft:12,paddingRight:12,fontWeight:n(707513).Ue.medium,...u&&{gridTemplateColumns:"1fr auto 1fr"},transition:"background-color color 150ms ease"};return(0,a.jsx)(n(154186).Z,{ref:t,id:r,onClick:p,style:{...w,...s(g,h),...f,...c&&{width:"100%",justifyContent:"center"}},hoveredStyle:l(g,h),pressedStyle:d(g,h),loadingSpinnerStyle:{marginLeft:"auto"},isLoading:u,disabledFeedback:i,...m,children:(0,a.jsx)("div",{style:{display:"flex",alignItems:"center",textAlign:"center",justifyContent:"center"},children:o})})}const u=r.memo(r.forwardRef(c),n(632314).Z)},953349:(e,t,n)=>{n.d(t,{MF:()=>W,N_:()=>E,U7:()=>F,ZP:()=>A,uV:()=>V});n(670560),n(267602),n(653476),n(470928),n(241792),n(228244);var r=n(667294),o=()=>n(219727),i=()=>n(142735),a=()=>n(846550),s=()=>n(714230),l=()=>n(235484),d=()=>n(775404),c=()=>n(286977),u=()=>n(535014),p=()=>n(899548),f=()=>n(121183),g=()=>n(788860),m=()=>n(513670),h=()=>n(855741),w=()=>n(696459),y=()=>n(824462),k=()=>n(388915),x=()=>n(527278),v=()=>n(762300),C=()=>n(729201),b=()=>n(876822),S=()=>n(138912),j=()=>n(385010),I=()=>n(827973),T=()=>n(740046),M=()=>n(312578),P=()=>n(388284),D=n(785893);const B=(0,g().vU)({channelSearchPlaceholder:{id:"notificationRuleSettings.selectChannelView.searchInput.placeholder",defaultMessage:"Search…"}});function A(e){const{currentNotificationChannels:t,onNotificationChannelSelect:n,onClose:a,onNewSlackAccountAdded:d,renderMenu:u,channelFilter:f,workflowExternalAuthenticationPointer:y,isMultiSelectMode:j,shouldHideSlackAccountSection:A}=e,R=(0,o().O7)(),{isMobile:W}=(0,o().Fy)(),L=(0,i().Kw)(S().default.completeSlackAuthentications),O=e.currentExternalAuthentication??m().Ps(L),q=(0,r.useMemo)((()=>y?{type:"workflow",workflowExternalAuthenticationId:y.id}:O?{type:"external",botId:O.id}:void 0),[y,O]);r.useEffect((()=>{const e=y?null==y?void 0:y.spaceId:null==O?void 0:O.space_id;q&&e&&V({environment:R,spaceId:e,externalAuthConfig:q})}),[R,q,O,y]);const N=(null==y?void 0:y.id)??(null==O?void 0:O.id),[U,H]=r.useState(""),{loadedChannelsForAccount:z,isLoading:_}=F(q),G=(0,i().VK)((()=>S().default.integrations.state.find((e=>e.id===l().nO))),[]),$=(0,i().VK)((()=>{var e;return null===(e=b().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),J=r.useCallback((e=>{O?n(e,O.parent_id):y&&n(e,y.id),j||a()}),[n,O,y,a,j]),Y=Z(),Q=r.useCallback((e=>{const{channel:n}=e;return{key:n.id,render:e=>(0,D.jsx)(I().Z,{...e,icon:E({channel:n,styles:Y.icon}),desktopIconStyle:{width:8},title:n.name,right:(null==t?void 0:t.some((e=>e.id===n.id)))&&(0,c().e)(Y.icon)}),action:()=>{J(n)}}}),[J,Y.icon,t]),{publicChannels:X,privateChannels:ee,personalChannels:te}=r.useMemo((()=>function(e,t){const n=[],r=[],o=[];for(const i of e)t&&!t(i)||("public"===i.type?n.push(i):"private"===i.type?r.push(i):"me"===i.type?o.push(i):(0,w().t1)(i.type));return{publicChannels:n,privateChannels:r,personalChannels:o}}(z,f)),[f,z]),ne=r.useCallback((()=>X.map((e=>({menuListItem:Q({channel:e}),channelName:e.name})))),[X,Q]),re=r.useCallback((()=>ee.map((e=>({menuListItem:Q({channel:e}),channelName:e.name})))),[ee,Q]),oe=r.useCallback((()=>te.map((e=>({menuListItem:Q({channel:e}),channelName:e.name})))),[te,Q]),ie=r.useCallback((()=>ne().map((e=>{let{menuListItem:t,channelName:n}=e;if(K({channelName:n,query:U}))return t})).filter(w().$K)),[ne,U]),ae=r.useCallback((()=>re().map((e=>{let{menuListItem:t,channelName:n}=e;if(K({channelName:n,query:U}))return t})).filter(w().$K)),[re,U]),se=r.useCallback((()=>oe().map((e=>{let{menuListItem:t,channelName:n}=e;if(K({channelName:n,query:U}))return t})).filter(w().$K)),[oe,U]),le=r.useCallback((()=>O?(0,v().jg)(O).organizationName:"Workflows organization"),[O]),de=r.useCallback((()=>{if(!N)return[];const e=[],t=ie(),n=ae(),r=se();return r.length>0&&e.push({key:"personal-channels",render:e=>(0,D.jsx)(P().Z,{...e,title:le()}),items:r}),t.length>0&&e.push({key:"public-channels",render:e=>(0,D.jsx)(P().Z,{...e,topBorder:r.length>0,title:0===r.length&&le()}),items:t}),n.length>0&&e.push({key:"private-channels",render:e=>(0,D.jsx)(P().Z,{...e,topBorder:t.length>0,title:0===r.length&&t.length>0&&le()}),items:n}),e}),[N,ie,ae,se,le]),ce=(0,C().Z)(_,500,300);if(!N||!G)return null;const ue=[{key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,D.jsx)("div",{children:(0,D.jsx)(T().ZP,{...e,inputLeft:(0,D.jsx)(T().f_,{icon:p().R}),inputRight:ce&&(0,D.jsx)(M().Z,{style:{marginRight:2}}),showClearButton:!0,placeholder:x().Z.formatMessage(B.channelSearchPlaceholder),focusInitial:!W,value:U,onChange:e=>{H(e.target.value)}})})}],render:e=>(0,D.jsx)(P().Z,{...e})},...de()];return t||A||ue.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!$)return;const e=await k().hM({environment:R,integration:G,spaceId:$,from:"collection_view_settings"});h().x.isFail(e)||d()},render:e=>(0,D.jsx)(I().Z,{...e,icon:(0,D.jsx)("img",{src:s().Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,D.jsx)(g()._H,{id:"notificationRuleSettings.selectChannelView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,D.jsx)(P().Z,{...e,topBorder:!0})}),(0,D.jsx)(D.Fragment,{children:u(ue)})}function Z(){return(0,a().yK)((e=>({icon:{marginLeft:8,width:12,height:12,color:e.lightTextColor},container:{backgroundColor:e.popoverBackground,marginTop:12,marginBottom:6},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:e.regularIconColor}})),[])}function K(e){const{channelName:t,query:n}=e;return 0===n.length||t.toLocaleLowerCase().indexOf(n.trim().toLocaleLowerCase())>=0}function E(e){const{channel:t,styles:n}=e;return"private"===t.type?(0,u().b)(n):"me"===t.type?(0,d().p)(n):(0,f().J)(n)}const R=15e3;function F(e){return(0,i().VK)((()=>{if(!e)return{loadedChannelsForAccount:[],isLoading:!1};const t=j().l.getStateForBot(e);return{loadedChannelsForAccount:Object.values(t.channels),isLoading:t.fetching}}),[e])}async function V(e){const{environment:t,externalAuthConfig:n,spaceId:r}=e,o=j().l.getStateForBot(n);if(o.fetching||Date.now()-o.lastRefreshed<R)return;let i;for(j().l.updateStateForBot(n,{fetching:!0,lastRefreshed:Date.now()});;){const e=await y().callApi({eventName:"getExternalNotificationChannels",environment:t,data:{spaceId:r,cursor:i,...n}});if("success"!==e.type){console.error(e.error);break}{const t={};for(const n of e.data.channels)t[n.id]=n;if(j().l.addChannelsForBot(n,t),i=e.data.cursor,!i)break}await new Promise((e=>setTimeout(e,0)))}j().l.updateStateForBot(n,{fetching:!1})}const W=r.forwardRef(((e,t)=>{const{channel:n,currentNotificationChannels:r,...o}=e,i=Z();return(0,D.jsx)(I().Z,{ref:t,...o,icon:E({channel:n,styles:i.icon}),desktopIconStyle:{width:8},title:n.name,right:(null==r?void 0:r.some((e=>e.id===n.id)))&&(0,c().e)(i.icon)})}));W.displayName="SlackChannelMenuItem"},681035:(e,t,n)=>{n.d(t,{S:()=>i});var r=()=>n(677559);const o=new(r().Ss)("CollectionItemCover",(async()=>{const{CollectionItemCover:e}=await Promise.all([n.e(62743),n.e(37912)]).then(n.bind(n,682652));return{CollectionItemCover:e}})),i=(0,r().kF)(o,(e=>e.CollectionItemCover))},385010:(e,t,n)=>{n.d(t,{l:()=>a,w:()=>o});function r(e){switch(e.type){case"external":return`external-${e.botId}`;case"workflow":return`workflow-${e.workflowExternalAuthenticationId}`;case"universal":return`universal-${e.app}-${e.spaceId}`;default:throw(0,n(696459).t1)(e)}}const o={channels:{},fetching:!1,lastRefreshed:0};class i extends(()=>n(263184))().default{getStateForBot(e){const t=r(e);return this.state[t]??o}updateStateForBot(e,t){this.setState({...this.state,[r(e)]:{...this.getStateForBot(e),...t}})}addChannelsForBot(e,t){const n=this.getStateForBot(e);this.setState({...this.state,[r(e)]:{...n,channels:{...n.channels,...t}}})}}const a=new i;(0,n(947115).exposeDebugValue)("ExternalNotificationChannelsStore",a)},994875:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});class r extends(()=>n(263184))().default{getInitialState(){return{discussionIdToExpansionStartPointMap:{}}}}const o=new r},993662:(e,t,n)=>{n.d(t,{Ds:()=>x,pc:()=>y});var r=n(667294),o=()=>n(219727),i=()=>n(846550),a=()=>n(783190),s=()=>n(788860),l=()=>n(707513),d=()=>n(402269),c=()=>n(507159),u=()=>n(708518),p=()=>n(906651),f=()=>n(251932),g=()=>n(205228),m=()=>n(741543),h=n(785893);const w=(0,s().vU)({titleMessage:{id:"workflows.authDetails.popup.title",defaultMessage:"Authenticate"}});function y(e){const{module:t,workflowPointer:n,spaceId:i}=e,[s,l]=(0,r.useState)(!1),{threadStore:c}=(0,m().dP)(),u=(0,o().O7)(),p=(0,r.useCallback)((e=>{const r=(0,a().S1)({moduleType:t.type,workflowId:n.id,moduleKey:t.key,spaceId:i,moduleSpecific:e,transcriptId:null==c?void 0:c.id},g().default.domainBaseUrl);r&&d().M(u,{width:610,height:700,url:r,titleMessage:w.titleMessage})}),[t,n.id,i,null==c?void 0:c.id,u]);return{handleConnect:(0,r.useCallback)((()=>{var e;e=t.type,void 0!==k[e]?l(!0):p()}),[t.type,p]),authDetailModalArgs:{onDismiss:(0,r.useCallback)((()=>{l(!1)}),[]),isOpen:s,moduleType:t.type,navigateWithModuleSpecificAuth:p,moduleKey:t.key,workflowPointer:n}}}const k={zendesk:{VendorSpecificAuthDetails:function(e){const{navigateWithModuleSpecificAuth:t}=e,[o,a]=(0,r.useState)(""),[d,c]=(0,r.useState)(!1),u=(0,i().yK)((e=>({title:{fontSize:20,margin:"0 50px 32px",textAlign:"center",fontWeight:l().Ue.medium},inputContainer:{display:"flex",flexDirection:"column",paddingLeft:20,paddingRight:20,paddingTop:5,paddingBottom:5},input:{marginLeft:5,marginRight:5,marginBottom:55},row:{justifyContent:"center"}})),[]),g=(0,r.useCallback)((e=>{a(n(955620).vJ3(e.target.value))}),[a]),m=(0,r.useCallback)((()=>{c(!0),t(o)}),[t,o]),w=(0,r.useCallback)((e=>{"Enter"===e.key&&m()}),[m]);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{style:u.title,children:(0,h.jsx)(s()._H,{id:"workflows.authDetails.title",defaultMessage:"Connect to {integrationName}",values:{integrationName:"Zendesk"}})}),(0,h.jsxs)("div",{style:u.inputContainer,children:[(0,h.jsxs)(f().gq,{children:["https://",(0,h.jsx)(n(291198).Z,{style:u.input,value:o,onChange:g,onKeyDown:w}),".zendesk.com"]}),(0,h.jsx)(f().gq,{style:u.row,children:(0,h.jsx)(p().Z,{onClick:m,disabled:!o,isLoading:d,children:d?"Authenticating...":"Authenticate"})})]})]})}},notionmail:{VendorSpecificAuthDetails:function(e){const{onDismiss:t,moduleKey:a,workflowPointer:d}=e,[c,u]=(0,r.useState)(!1),[g,m]=(0,r.useState)(),w=(0,o().O7)(),y=(0,i().yK)((e=>({title:{fontSize:20,margin:"0 50px 32px",textAlign:"center",fontWeight:l().Ue.medium},inputContainer:{display:"flex",flexDirection:"column",paddingLeft:20,paddingRight:20,paddingTop:5,paddingBottom:5},row:{justifyContent:"center"},errorMessage:{color:e.errorText,marginBottom:10}})),[]),k=(0,r.useCallback)((()=>{u(!0),n(824462).callApi({eventName:"connectAiWorkflowToNotionMailAccount",environment:w,data:{moduleKey:a,workflowPointer:d}}).then(t).catch((()=>{m("Error connecting to Notion Mail")}))}),[t,a,d,w]);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{style:y.title,children:(0,h.jsx)(s()._H,{id:"workflows.authDetails.title",defaultMessage:"Connect to {integrationName}",values:{integrationName:"Notion Mail"}})}),(0,h.jsxs)("div",{style:y.inputContainer,children:[g&&(0,h.jsx)("div",{style:y.errorMessage,children:g}),(0,h.jsx)(f().gq,{style:y.row,children:(0,h.jsx)(p().Z,{onClick:k,isLoading:c,children:c?"Connecting...":"Connect"})})]})]})}}};function x(e){const{onDismiss:t,isOpen:n,moduleType:r,moduleKey:o,workflowPointer:a,navigateWithModuleSpecificAuth:s}=e,{VendorSpecificAuthDetails:l}=k[r]??{},d=(0,i().yK)((e=>({container:{padding:16,display:"flex",flexDirection:"column",gap:8,minWidth:460,maxWidth:460,maxHeight:565,position:"relative"},closeButton:{position:"absolute",right:16,top:16}})),[]);return l?(0,h.jsx)(u().Z,{open:n,preventHideChildrenWhileOpening:!0,onDismiss:t,innerStyle:d.container,render:()=>(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(c().Z,{onClose:t,style:d.closeButton}),(0,h.jsx)(l,{navigateWithModuleSpecificAuth:s,onDismiss:t,moduleKey:o,workflowPointer:a})]})}):null}},741543:(e,t,n)=>{n.d(t,{P6:()=>g,dP:()=>p});n(821057);var r=n(667294),o=()=>n(142735),i=()=>n(269299),a=()=>n(814866),s=()=>n(452435),l=()=>n(10986);function d(e){const{threadStore:t,workflowStore:r,clientStore:i}=e;return(0,o().VK)((()=>{if(!t)return;if(i.state.loading)return;const e=(0,l().JC)({clientStore:i,threadStore:t});if(!e)return;if(!r)return{type:"create",unsavedStep:e,threadStore:t};const o=(0,l().xI)(r);return n(513670).Xy(e.value,o)?void 0:{type:"update",unsavedStep:e,threadStore:t,workflowStore:r}}),[i,t,r])}var c=n(785893);const u=(0,r.createContext)(null);function p(){const e=(0,r.useContext)(u);if(!e)throw new Error("useWorkflowEditorContext must be used inside WorkflowEditorContextProvider");return e}function f(e){const{threadId:t,currentThreadIdRef:r}=e;t!==r.current&&n(799891).log({level:"error",from:"WorkflowEditorContext",type:"Thread ID is outdated",data:{}})}u.displayName="WorkflowEditorContext";const g=r.memo((function(e){let{children:t,store:p}=e;const g=(0,n(219727).O7)(),m=(0,n(275582).D)(p),h=n(922065).r,w=(0,a().oD)(),y=null==w?void 0:w.chatThreadId,k=(0,r.useRef)(y);k.current=y;const x=(0,o().VK)((()=>{const{currentSpaceStore:e}=n(876822).default.state;if(e&&y)return n(826955).V3.createChildStore(e,{table:n(325490).kL,id:y,spaceId:e.id})}),[y]),v=d({threadStore:x,workflowStore:m,clientStore:h}),C=!!v,b=(0,r.useCallback)((async e=>{if(e!==y){if(C){const{accept:e}=await n(308186).gt({message:"You have unsaved changes.",description:"Do you want to discard your changes?",acceptLabel:"Discard changes",cancelLabel:"Cancel"});if(!e)return}k.current=e,(0,a().mS)({environment:g,store:p,navigationState:{chatThreadId:e}})}}),[g,C,p,y]),S=(0,r.useCallback)((e=>{b(e.id)}),[b]),j=(0,o().VK)((()=>({type:"workflow",workflowBlockId:p.id})),[p]),I=(0,r.useCallback)((e=>{if(!m)throw new Error("Cannot save trigger without a workflow store");f({threadId:y,currentThreadIdRef:k}),i().createAndCommit({userAction:"WorkflowEditorContext.saveTrigger",environment:g,canUndo:!0,perform:t=>{const n=(0,l().jI)({workflowStore:m,threadStore:x,clientStore:h});if(!n)throw new Error("Cannot save trigger without a workflow");const r=s().saveTrigger({workflow:n,workflowStore:m,trigger:e,transaction:t,environment:g,threadStore:x});S({id:r})}})}),[h,g,S,y,x,m]),T=(0,r.useCallback)((e=>{if(!m)throw new Error("Cannot save trigger without a workflow store");f({threadId:y,currentThreadIdRef:k}),i().createAndCommit({userAction:"WorkflowEditorContext.saveTriggers",environment:g,canUndo:!0,perform:t=>{const n=(0,l().jI)({workflowStore:m,threadStore:x,clientStore:h});if(!n)throw new Error("Cannot save trigger without a workflow");const r=s().saveTriggers({workflow:n,workflowStore:m,triggers:e,transaction:t,environment:g,threadStore:x});S({id:r})}})}),[h,g,S,y,x,m]),M=(0,r.useCallback)((e=>{if(!m)throw new Error("Cannot save module without a workflow store");f({threadId:y,currentThreadIdRef:k}),i().createAndCommit({userAction:"WorkflowEditorContext.saveModule",environment:g,canUndo:!0,perform:t=>{const n=(0,l().jI)({workflowStore:m,threadStore:x,clientStore:h});if(!n)throw new Error("Cannot save module without a workflow");const r=s().saveModule({workflow:n,workflowStore:m,module:e,transaction:t,environment:g,threadStore:x});S({id:r})}})}),[h,g,S,y,x,m]),P=(0,r.useCallback)((e=>{if(!m)throw new Error("Cannot add module without a workflow store");f({threadId:y,currentThreadIdRef:k}),i().createAndCommit({userAction:"WorkflowEditorContext.addModule",environment:g,canUndo:!0,perform:t=>{const n=(0,l().jI)({workflowStore:m,threadStore:x,clientStore:h});if(!n)throw new Error("Cannot add module without a workflow");const r=s().addModule({workflow:n,workflowStore:m,module:e,transaction:t,environment:g,threadStore:x});S({id:r})}})}),[h,g,S,y,x,m]),D=(0,r.useCallback)((e=>{if(!m)throw new Error("Cannot save function without a workflow store");f({threadId:y,currentThreadIdRef:k}),i().createAndCommit({userAction:"WorkflowEditorContext.saveFunction",environment:g,canUndo:!0,perform:t=>{const n=(0,l().jI)({workflowStore:m,threadStore:x,clientStore:h});if(!n)throw new Error("Cannot save function without a workflow");const r=s().saveFunction({workflow:n,workflowStore:m,functionValue:e,transaction:t,environment:g,threadStore:x});S({id:r})}})}),[h,g,S,y,x,m]),B=(0,r.useCallback)((e=>{if(!m)throw new Error("Cannot save test without a workflow store");i().createAndCommit({userAction:"WorkflowEditorContext.saveTest",environment:g,canUndo:!0,perform:t=>{const n=(0,l().jI)({workflowStore:m,threadStore:x,clientStore:h});if(!n)throw new Error("Cannot save test without a workflow");const r=s().saveTest({workflow:n,workflowStore:m,transaction:t,environment:g,threadStore:x,functionKey:e.functionKey,test:e.test});S({id:r})}})}),[h,g,S,x,m]),A=(0,r.useMemo)((()=>({store:p,workflowStore:m,threadStore:x,clientStore:h,saveTrigger:I,saveTriggers:T,saveModule:M,addModule:P,saveFunction:D,saveTest:B,config:j,onThreadChange:S,workflowChanges:v})),[h,j,I,T,M,P,D,B,p,x,m,S,v]);return(0,c.jsx)(u.Provider,{value:A,children:t})}))},642611:(e,t,n)=>{n.d(t,{D:()=>oe});var r=()=>n(788860);const o=(0,r().vU)({chatMessage:{defaultMessage:"When a chat message is received",id:"aiWorkflow.trigger.title.chat.message"},runAgent:{defaultMessage:"Ran an agent in chat",id:"workflow.run.effect.agents.runAgent.description"},createThread:{defaultMessage:"Created a thread in chat",id:"workflow.run.effect.agents.createThread.description"}}),i={triggers:{"agent.message":{icon:n(259364).n,configuration:"minimal",description:o.chatMessage}},effect:{"agents.runAgent":{runDefinitionType:"minimal",description:o.runAgent},"agents.createThread":{runDefinitionType:"minimal",description:o.createThread}}},a=(0,r().vU)({prompt:{defaultMessage:"Generated a response using an AI prompt",id:"workflow.run.effect.ai.prompt.description"},promptJson:{defaultMessage:"Generated a JSON response using an AI prompt",id:"workflow.run.effect.ai.promptJson.description"}}),s={triggers:{},effect:{"ai.prompt":{runDefinitionType:"minimal",description:a.prompt},"ai.promptJson":{runDefinitionType:"minimal",description:a.promptJson}}};n(821057);var l=n(667294),d=()=>n(491772),c=()=>n(741543),u=()=>n(887554),p=n(785893);const f=(0,r().vU)({databasePageCreated:{defaultMessage:"When a page is created in",id:"aiWorkflow.trigger.title.database.page.created"},databasePageUpdated:{defaultMessage:"When a page is updated in",id:"aiWorkflow.trigger.title.database.page.updated"},databasePageDeleted:{defaultMessage:"When a page is deleted in",id:"aiWorkflow.trigger.title.database.page.deleted"},query:{defaultMessage:"Queried a database",id:"workflow.run.effect.databases.query.description"},getPage:{defaultMessage:"Retrieved a page from a database",id:"workflow.run.effect.databases.getPage.description"},createPage:{defaultMessage:"Created a page in a database",id:"workflow.run.effect.databases.createPage.description"},updatePage:{defaultMessage:"Updated a page in a database",id:"workflow.run.effect.databases.updatePage.description"},deletePage:{defaultMessage:"Deleted a page in a database",id:"workflow.run.effect.databases.deletePage.description"},getPageContent:{defaultMessage:"Read the content of a page in a database",id:"workflow.run.effect.databases.getPageContent.description"},setPageContent:{defaultMessage:"Set the content of a page in a database",id:"workflow.run.effect.databases.setPageContent.description"},insertPageContent:{defaultMessage:"Inserted content into a page in a database",id:"workflow.run.effect.databases.insertPageContent.description"},pickPages:{defaultMessage:"Picked pages from a database",id:"workflow.run.effect.databases.pickPages.description"},pickSelectOption:{defaultMessage:"Picked a select option from a database",id:"workflow.run.effect.databases.pickSelectOption.description"},pickMultiSelectOptions:{defaultMessage:"Picked multiple select options from a database",id:"workflow.run.effect.databases.pickMultiSelectOptions.description"}});function g(e){const{trigger:t}=e,{store:n,workflowStore:r}=(0,c().dP)();if(!r)throw new Error("Workflow store is required");return(0,p.jsx)(u().b,{store:n,workflowStore:r,moduleKey:t.moduleKey})}const m={triggers:{"database.page.created":{icon:d().t,configuration:"minimal",description:f.databasePageCreated,ConfigurationComponent:g},"database.page.updated":{icon:d().t,configuration:"minimal",description:f.databasePageUpdated,ConfigurationComponent:g},"database.page.deleted":{icon:d().t,configuration:"minimal",description:f.databasePageDeleted,ConfigurationComponent:g}},effect:{"databases.query":{runDefinitionType:"minimal",description:f.query},"databases.getPage":{runDefinitionType:"minimal",description:f.getPage},"databases.createPage":{runDefinitionType:"minimal",description:f.createPage},"databases.updatePage":{runDefinitionType:"minimal",description:f.updatePage},"databases.deletePage":{runDefinitionType:"minimal",description:f.deletePage},"databases.getPageContent":{runDefinitionType:"minimal",description:f.getPageContent},"databases.setPageContent":{runDefinitionType:"minimal",description:f.setPageContent},"databases.insertPageContent":{runDefinitionType:"minimal",description:f.insertPageContent},"databases.pickPages":{runDefinitionType:"minimal",description:f.pickPages},"databases.pickSelectOption":{runDefinitionType:"minimal",description:f.pickSelectOption},"databases.pickMultiSelectOptions":{runDefinitionType:"minimal",description:f.pickMultiSelectOptions}}};const h=(0,r().vU)({pageDiscussionCommentAdded:{defaultMessage:"When a comment is added to a page in",id:"aiWorkflow.trigger.title.page.discussion.comment.added"},getPageDiscussions:{defaultMessage:"Got the discussions for a page",id:"workflow.run.effect.discussions.getPageDiscussions.description"},addCommentToPage:{defaultMessage:"Added a comment to a page",id:"workflow.run.effect.discussions.addCommentToPage.description"},addCommentToDiscussion:{defaultMessage:"Added a comment to a discussion",id:"workflow.run.effect.discussions.addCommentToDiscussion.description"}});const w={triggers:{"page.discussion.comment.added":{icon:n(550322).P,configuration:"minimal",description:h.pageDiscussionCommentAdded,ConfigurationComponent:function(e){const{trigger:t}=e,{store:n,workflowStore:r}=(0,c().dP)();if(!r)throw new Error("Workflow store is required");if(!t.state)throw new Error("Discussion trigger state is required");return(0,p.jsx)(u().b,{store:n,workflowStore:r,moduleKey:t.state.databaseKey})}}},effect:{"discussions.getPageDiscussions":{runDefinitionType:"minimal",description:h.getPageDiscussions},"discussions.addCommentToPage":{runDefinitionType:"minimal",description:h.addCommentToPage},"discussions.addCommentToDiscussion":{runDefinitionType:"minimal",description:h.addCommentToDiscussion}}},y=(0,r().vU)({getFileName:{defaultMessage:"Retrieved the name of a file",id:"workflow.run.effect.files.getFileName.description"},getFileContent:{defaultMessage:"Retrieved the content of a file",id:"workflow.run.effect.files.getFileContent.description"}}),k={triggers:{},effect:{"files.getFileName":{runDefinitionType:"minimal",description:y.getFileName},"files.getFileContent":{runDefinitionType:"minimal",description:y.getFileContent}}};var x=()=>n(142735),v=()=>n(846550),C=()=>n(993662);function b(e){const{module:t,store:o,workflowId:i}=e,a=(0,x().VK)((()=>o.getSpaceId()),[o]),{handleConnect:s,authDetailModalArgs:l}=(0,C().pc)({module:t,spaceId:a,workflowPointer:{table:n(361929).An,id:i,spaceId:a}}),d=(0,v().yK)((e=>({container:{display:"flex",justifyContent:"center"}})),[]),c=(0,r().YB)();return(0,p.jsxs)("div",{style:d.container,children:[(0,p.jsx)(n(661297).Z,{onClick:s,icon:(0,n(191877).T)(t),children:(0,p.jsx)(r()._H,{id:"module.connect",defaultMessage:"Connect to {moduleName}",values:{moduleName:n(401806)._.getName(t,c)}})}),(0,p.jsx)(C().Ds,{...l})]})}const S=(0,r().vU)({notionMailEmailReceived:{defaultMessage:"When an email is received",id:"aiWorkflow.trigger.title.notionmail.email.received"}}),j={triggers:{"notionmail.email.received":{icon:n(314171).Z,configuration:"minimal",description:S.notionMailEmailReceived}},effect:{},ModuleConfiguration:b};var I=()=>n(157955),T=()=>n(803021),M=()=>n(707513),P=()=>n(790819),D=()=>n(158548),B=()=>n(166312),A=()=>n(676279),Z=()=>n(448419),K=()=>n(529048);function E(e){const{recurrenceTrigger:t}=e,n=(0,r().YB)(),o=(0,x().qz)(void 0,K().Z),i=(0,A().d)(),a=(0,l.useMemo)((()=>({start_date:(0,T().kq)((0,T().tg)(2025,0,0,0,0,0)),...t})),[t]),s=(0,v().yK)((e=>({temporaryReadonly:{display:"flex",alignItems:"center",justifyContent:"center",color:e.lightErrorText,fontSize:M().JB.UISmall.desktop,marginTop:4}})),[]),d=a?(0,B().De)({intl:n,recurrence:(0,I().convertFromUnpersistedRecurrenceConfig)(a)}):(0,p.jsx)(r()._H,{id:"RecurrenceTrigger.frequency",defaultMessage:"frequency"}),c=a;return(0,p.jsx)(Z().ZP,{alignmentToOrigin:Z().vR.End,buttonPopupStore:o,disabled:!1,originGap:0,placementToOrigin:Z().pO.Bottom,popupType:i,renderOrigin:e=>(0,p.jsx)(P().S,{...e,disabled:!1,isError:!1,hasActionRequired:!0,tooltipMessage:void 0,dropdownButtonType:"dropdown",children:d}),render:()=>(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("span",{style:s.temporaryReadonly,children:"Read only - use chat to edit"}),(0,p.jsx)(D().w,{currentValue:c,onChange:()=>{}})]})})}const R=(0,r().vU)({recurrence:{defaultMessage:"Triggers every",id:"aiWorkflow.trigger.title.recurrence"}});const F={triggers:{recurrence:{icon:n(728267).a,configuration:"minimal",description:R.recurrence,ConfigurationComponent:function(e){const{trigger:t}=e,{workflowStore:n}=(0,c().dP)();if(!t.state)throw new Error("Recurrence trigger state is required");if(!n)throw new Error("Workflow store is required");return(0,p.jsx)(E,{workflowStore:n,recurrenceTrigger:t.state})}}},effect:{}},V=(0,r().vU)({answerQuestions:{defaultMessage:"Answered questions using search",id:"workflow.run.effect.search.answerQuestions.description"},search:{defaultMessage:"Searched content",id:"workflow.run.effect.search.search.description"}}),W={triggers:{},effect:{"search.answerQuestions":{runDefinitionType:"minimal",description:V.answerQuestions},"search.search":{runDefinitionType:"minimal",description:V.search}}};var L=()=>n(525372),O=(n(267602),n(916054),n(653476),n(470928),n(241792),n(228244),()=>n(219727)),q=()=>n(824462),N=()=>n(198829),U=()=>n(255577),H=()=>n(953349),z=()=>n(352230),_=()=>n(385010),G=()=>n(10986);function $(e){var t,n;const{workflowStore:o,moduleKey:i,isAllChannels:a,channelIds:s,writeChannelIds:d}=e,c=s&&s.length>0,u=(0,x().qz)(void 0,K().Z),f=(0,l.useCallback)((()=>u.reset()),[u]),g=(0,x().VK)((()=>(0,G().xI)(o)),[o]),m=(0,x().VK)((()=>o.getSpaceId()),[o]),h=(0,x().VK)((()=>o.id),[o]),w=null==g||null===(t=g.modules)||void 0===t?void 0:t.find((e=>e.key===i)),y=null==w||null===(n=w.state)||void 0===n?void 0:n.connectionPointer,k=(0,l.useMemo)((()=>y?{type:"workflow",workflowExternalAuthenticationId:y.id}:void 0),[y]),C=(0,O().O7)(),{loadedChannelsForAccount:b,isLoading:S}=(0,H().U7)(k),j=(0,l.useMemo)((()=>s&&s.length>=0&&s.every((e=>null==b?void 0:b.some((t=>t.id===e))))),[b,s]),I=(0,l.useMemo)((()=>s?s.map((e=>{const t=null==b?void 0:b.find((t=>t.id===e));return{id:e,type:(null==t?void 0:t.type)??"public",name:(null==t?void 0:t.name)??e,isMember:(null==t?void 0:t.isMember)??!1}})):void 0),[s,b]),T=(0,l.useMemo)((()=>null==I?void 0:I.filter((e=>!e.isMember))),[I]),D=(null==y?void 0:y.spaceId)??m;l.useEffect((()=>{k&&D&&(0,H().uV)({environment:C,spaceId:D,externalAuthConfig:k})}),[C,D,k]),l.useEffect((()=>{k&&D&&s&&async function(e){const{environment:t,spaceId:n,externalAuthConfig:r,channelIds:o,workflowId:i,moduleKey:a}=e,s=await q().callApi({eventName:"getViaWorkflowModuleConfigurationUtil",environment:t,data:{workflowId:i,spaceId:n,moduleKey:a,moduleType:"slack",callArguments:{functionName:"getSlackChannelNames",functionArgs:[o]}}});if("success"===s.type){if("getSlackChannelNames"!==s.data.functionName)throw new Error("Invalid function name");_().l.addChannelsForBot(r,s.data.functionReturn)}}({environment:C,spaceId:D,externalAuthConfig:k,channelIds:s,workflowId:h,moduleKey:i})}),[C,D,k,s,h,i]);const B=(0,A().d)(),E=(0,v().yK)((e=>({errorMessage:{fontWeight:M().Ue.bold}})),[]);if(!y)return(0,p.jsx)("div",{style:E.errorMessage,children:(0,p.jsx)(r()._H,{defaultMessage:"Log in with slack first",id:"workflows.targetPicker.slackNotConnected"})});if(a)return(0,p.jsx)("div",{children:(0,p.jsx)(r()._H,{defaultMessage:"Any channel",id:"workflows.targetPicker.anyChannel"})});const R=(0,p.jsx)(Z().ZP,{alignmentToOrigin:Z().vR.End,buttonPopupStore:u,disabled:!1,originGap:0,placementToOrigin:Z().pO.Bottom,popupType:B,renderOrigin:e=>(0,p.jsx)(P().S,{...e,disabled:!1,isError:!1,hasActionRequired:!c,tooltipMessage:void 0,dropdownButtonType:"dropdown",children:j?(0,p.jsx)("span",{style:M().Yu,children:null==I?void 0:I.map((e=>e.name)).join(", ")}):S?(0,p.jsx)(r()._H,{id:"workflows.targetPicker.loading",defaultMessage:"Loading channels"}):(0,p.jsx)(r()._H,{id:"workflows.targetPicker.noTarget",defaultMessage:"Select Slack channels"})}),render:()=>(0,p.jsx)(J,{currentNotificationChannels:I,connectionPointer:y,channelIds:s,writeChannelIds:d,onClose:f})});return j&&T&&T.length>0?(0,p.jsxs)("div",{children:[R,(0,p.jsx)("div",{children:(0,p.jsx)(r()._H,{id:"workflows.targetPicker.channelsBotIsNotAMemberOf",defaultMessage:"Bot must be added to: {channels}",values:{channels:null==T?void 0:T.map((e=>`#${e.name}`)).join(", ")}})})]}):R}function J(e){const{connectionPointer:t,currentNotificationChannels:n,channelIds:o,writeChannelIds:i,onClose:a}=e,s=l.useCallback(((e,t)=>{const n=null==o?void 0:o.includes(e.id);i(n&&o?o.filter((t=>t!==e.id)):[...o??[],e.id])}),[i,o]),d=(0,v().yK)((e=>({header:{display:"flex",alignItems:"center",margin:8,color:e.mediumTextColor,fontWeight:M().Ue.medium,fontSize:M().JB.UISmall.desktop}})),[]);return(0,p.jsx)(H().ZP,{workflowExternalAuthenticationPointer:t,currentNotificationChannels:n,onClose:a,onNotificationChannelSelect:s,onNewSlackAccountAdded:()=>{},isMultiSelectMode:!0,shouldHideSlackAccountSection:!0,renderMenu:e=>(0,p.jsx)(N().Z,{menuType:z().o.Popup,width:266,maxHeight:"50vh",header:(0,p.jsx)("div",{style:d.header,children:(0,p.jsx)(r()._H,{id:"workflows.selectChannelView.title",defaultMessage:"Select Slack channels"})}),children:(0,p.jsx)(U().ZP,{type:U().iW.Vertical,initialFocus:0,sections:e})})})}const Y=(0,r().vU)({slackMessage:{defaultMessage:"New slack message in",id:"aiWorkflow.trigger.title.slack.message"},slackReactionAdded:{defaultMessage:"Slack reaction added in",id:"aiWorkflow.trigger.title.slack.reaction.added"},slackThreadCreated:{defaultMessage:"Slack thread created in",id:"aiWorkflow.trigger.title.slack.thread.created"},slackChannelTranscriptDescription:{defaultMessage:"Pick a slack channel for {triggerName}",id:"aiWorkflow.trigger.title.slack.transcript.channel"},createThreadInChannel:{defaultMessage:"Created a new thread in a Slack channel",id:"workflow.run.effect.slack.createThreadInChannel.description"},replyInThread:{defaultMessage:"Replied to a Slack thread",id:"workflow.run.effect.slack.replyInThread.description"},updateMessage:{defaultMessage:"Updated a Slack message",id:"workflow.run.effect.slack.updateMessage.description"},addReactionToMessage:{defaultMessage:"Added a reaction to a Slack message",id:"workflow.run.effect.slack.addReactionToMessage.description"},removeReactionFromMessage:{defaultMessage:"Removed a reaction from a Slack message",id:"workflow.run.effect.slack.removeReactionFromMessage.description"},getThreadsInChannelSince:{defaultMessage:"Retrieved Slack threads from a channel",id:"workflow.run.effect.slack.getThreadsInChannelSince.description"},queryChannels:{defaultMessage:"Queried Slack channels",id:"workflow.run.effect.slack.queryChannels.description"},getUser:{defaultMessage:"Retrieved a Slack user’s information",id:"workflow.run.effect.slack.getUser.description"},findUserByEmail:{defaultMessage:"Found a Slack user by their email address",id:"workflow.run.effect.slack.findUserByEmail.description"}});function Q(e){const{trigger:t}=e,{state:n}=t,{saveTrigger:r,workflowStore:o}=(0,c().dP)();if(!n)throw new Error("Slack trigger state is required");if(!o)throw new Error("Workflow store is required");return(0,p.jsx)($,{workflowStore:o,isAllChannels:!!n.allChannels,channelIds:n.channelIds,moduleKey:t.moduleKey??("moduleKey"in n?n.moduleKey:void 0),writeChannelIds:e=>{const o={...t,state:{...n,channelIds:e}};r(o)}})}function X(e,t){return e.formatMessage(Y.slackChannelTranscriptDescription,{triggerName:t.name})}const ee={triggers:{"slack.message":{icon:L().P,configuration:"minimal",description:Y.slackMessage,transcriptDescription:X,ConfigurationComponent:Q},"slack.reaction.added":{icon:L().P,configuration:"minimal",description:Y.slackReactionAdded,transcriptDescription:X,ConfigurationComponent:Q},"slack.thread.created":{icon:L().P,configuration:"minimal",description:Y.slackThreadCreated,transcriptDescription:X,ConfigurationComponent:Q}},effect:{"slack.createThreadInChannel":{runDefinitionType:"minimal",description:Y.createThreadInChannel},"slack.replyInThread":{runDefinitionType:"minimal",description:Y.replyInThread},"slack.updateMessage":{runDefinitionType:"minimal",description:Y.updateMessage},"slack.addReactionToMessage":{runDefinitionType:"minimal",description:Y.addReactionToMessage},"slack.removeReactionFromMessage":{runDefinitionType:"minimal",description:Y.removeReactionFromMessage},"slack.getThreadsInChannelSince":{runDefinitionType:"minimal",description:Y.getThreadsInChannelSince},"slack.queryChannels":{runDefinitionType:"minimal",description:Y.queryChannels},"slack.getUser":{runDefinitionType:"minimal",description:Y.getUser},"slack.findUserByEmail":{runDefinitionType:"minimal",description:Y.findUserByEmail}},ModuleConfiguration:b},te=(0,r().vU)({getUser:{defaultMessage:"Retrieved a user’s information",id:"workflow.run.effect.users.getUser.description"},findUserByEmail:{defaultMessage:"Found a user by their email address",id:"workflow.run.effect.users.findUserByEmail.description"}}),ne={triggers:{},effect:{"users.getUser":{runDefinitionType:"minimal",description:te.getUser},"users.findUserByEmail":{runDefinitionType:"minimal",description:te.findUserByEmail}}};const re=(0,r().vU)({zendeskTicket:{defaultMessage:"When a Zendesk ticket is created",id:"aiWorkflow.trigger.title.zendesk.ticket"},getTicket:{defaultMessage:"Retrieved a Zendesk ticket",id:"workflow.run.effect.zendesk.getTicket.description"},getComments:{defaultMessage:"Retrieved comments from a Zendesk ticket",id:"workflow.run.effect.zendesk.getComments.description"},addTicket:{defaultMessage:"Created a new Zendesk ticket",id:"workflow.run.effect.zendesk.addTicket.description"},updateTicket:{defaultMessage:"Updated a Zendesk ticket",id:"workflow.run.effect.zendesk.updateTicket.description"},addComment:{defaultMessage:"Added a comment to a Zendesk ticket",id:"workflow.run.effect.zendesk.addComment.description"}}),oe={agent:i,ai:s,database:m,discussions:w,files:k,notionmail:j,recurrence:F,search:W,slack:ee,users:ne,zendesk:{triggers:{"zendesk.ticket":{icon:n(175771).L,configuration:"minimal",description:re.zendeskTicket}},effect:{"zendesk.getTicket":{runDefinitionType:"minimal",description:re.getTicket},"zendesk.getComments":{runDefinitionType:"minimal",description:re.getComments},"zendesk.addTicket":{runDefinitionType:"minimal",description:re.addTicket},"zendesk.updateTicket":{runDefinitionType:"minimal",description:re.updateTicket},"zendesk.addComment":{runDefinitionType:"minimal",description:re.addComment}},ModuleConfiguration:b}}},25014:(e,t,n)=>{n.d(t,{NO:()=>c,bl:()=>u,fC:()=>d});n(267602),n(470928),n(667294);var r=()=>n(142735),o=()=>n(846550),i=()=>n(788860),a=()=>n(707513),s=()=>n(642611),l=n(785893);function d(e){const{workflowValue:t,trigger:n}=e;return(0,r().VK)((()=>{var e,r;const o=null===(e=t.modules)||void 0===e?void 0:e.find((e=>e.key===n.moduleKey));if(!o||null===(r=n.state)||void 0===r||!r.type)return null;return s().D[o.type].triggers[n.state.type]}),[t,n])}function c(e){const{workflowValue:t,trigger:n}=e,r=(0,o().yK)((e=>({container:{display:"flex",gap:4},title:{fontWeight:500}})),[]),a=d({workflowValue:t,trigger:n});if(!n.state||!a)return null;if("full"===a.configuration){const{FullConfiguration:e}=a;return(0,l.jsx)("div",{style:r.container,children:(0,l.jsx)(e,{trigger:n,isInTranscript:!1})})}const{ConfigurationComponent:s}=a;return(0,l.jsxs)("div",{style:r.container,children:[(0,l.jsx)("div",{style:r.title,children:(0,l.jsx)(i()._H,{...a.description})}),s&&(0,l.jsx)(s,{trigger:n,isInTranscript:!1})]})}function u(e){const{workflowValue:t,trigger:n}=e,r=(0,o().yK)((e=>({container:{display:"flex",gap:4,flexDirection:"column"},title:{color:e.text.tertiary,fontWeight:a().Ue.medium,fontSize:14}})),[]),s=d({workflowValue:t,trigger:n}),c=(0,i().YB)();if(!n.state||!s)return null;if("full"===s.configuration){const{FullConfiguration:e}=s;return(0,l.jsx)("div",{style:r.container,children:(0,l.jsx)(e,{trigger:n,isInTranscript:!0})})}const{ConfigurationComponent:u}=s;return(0,l.jsxs)("div",{style:r.container,children:[(0,l.jsx)("div",{style:r.title,children:s.transcriptDescription?s.transcriptDescription(c,n):(0,l.jsx)(i()._H,{...s.description})}),u&&(0,l.jsx)(u,{trigger:n,isInTranscript:!0})]})}},887554:(e,t,n)=>{n.d(t,{A:()=>f,b:()=>g});n(821057),n(267602),n(470928),n(667294);var r=()=>n(142735),o=()=>n(846550),i=()=>n(506347),a=()=>n(396136),s=()=>n(729775),l=()=>n(384241),d=()=>n(429725),c=()=>n(826955),u=()=>n(10986),p=n(785893);function f(e){var t;const{store:n,module:u,title:f}=e,g=null===(t=u.state)||void 0===t?void 0:t.pointer,m=(0,r().VK)((()=>{if(g)return c().NW.createChildStore(n,g)}),[g,n]),h=(0,r().VK)((()=>{if(!m)return;const e=m.getParentPointer();if(!e||e.table!==a().iU)return;const t=c().G.createChildStore(m,e);return(0,d().ZP)({store:t,fullyQualified:!1,pageVisitSource:i().tY.LinkInPage})}),[m]),w=(0,o().yK)((e=>({container:{padding:"2px",borderRadius:4,margin:"-2px"}})),[]);return m&&h?(0,p.jsx)(s().Z,{href:h,style:w.container,children:f||(0,p.jsx)(l().Z,{store:m})}):null}function g(e){const{store:t,workflowStore:n,moduleKey:o}=e,i=(0,r().VK)((()=>{var e;const t=(0,u().xI)(n);return null==t||null===(e=t.modules)||void 0===e?void 0:e.find((e=>e.key===o))}),[n,o]);if(!i)return null;if("database"!==i.type)throw new Error("Database trigger controls called with non-database module");return(0,p.jsx)(f,{store:t,module:i})}},191877:(e,t,n)=>{n.d(t,{T:()=>f});var r=()=>n(768745),o=()=>n(697945),i=()=>n(466222),a=()=>n(717064),s=()=>n(494782),l=()=>n(29904),d=()=>n(180789),c=()=>n(730388),u=()=>n(525372),p=()=>n(828042);function f(e){return"database"===e.type?i().v:"slack"===e.type?u().P:"search"===e.type?d().v:"users"===e.type?c().f:"agent"===e.type?a().Q:"recurrence"===e.type?l().r:"files"===e.type?s().R:"ai"===e.type?p().t:"discussions"===e.type?r().Y:o().L}},275582:(e,t,n)=>{n.d(t,{D:()=>a});var r=()=>n(142735),o=()=>n(361929),i=()=>n(826955);function a(e){return(0,r().VK)((()=>{var t;if(!e)return;const n=null===(t=e.getFormat())||void 0===t?void 0:t.workflow_id;return n?i().hA.createChildStore(e,{table:o().An,id:n,spaceId:e.getSpaceId()}):void 0}),[e])}},29248:(e,t,n)=>{n.d(t,{K:()=>o});n(667294);var r=n(785893);const o=(0,n(827282).IU)("boltFilled",{svg:(0,r.jsx)("path",{d:"M0 12.117c0 .38.293.664.703.664h5.518l-2.91 7.91c-.381 1.006.664 1.543 1.318.723l8.877-11.094c.166-.205.254-.4.254-.625 0-.371-.293-.664-.703-.664H7.539l2.91-7.91C10.83.115 9.785-.422 9.131.408L.254 11.492c-.166.215-.254.41-.254.625z"}),viewBox:"0 0 14 22"})},146007:(e,t,n)=>{n.d(t,{r:()=>o});n(667294);var r=n(785893);const o=(0,n(827282).IU)("bug",{viewBox:"0 0 64 64",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"m32,8c-5.55,0-9,3.83-9,10h18c0-6.17-3.45-10-9-10Z"}),(0,r.jsx)("path",{d:"m48,36h12v-4h-12v-6.01c2.74-.06,4.78-.94,6.76-2.92l4.24-4.24-2.83-2.83-4.24,4.24c-1.3,1.3-2.41,1.76-4.24,1.76h-13.69v32c6.15,0,10.63-3.12,12.7-8.47l1.54,1.54c1.3,1.3,1.76,2.41,1.76,4.24v2.69h4v-2.69c0-2.9-.88-5.02-2.93-7.07l-3.26-3.26c.12-.95.19-1.94.19-2.98v-2Z"}),(0,r.jsx)("path",{d:"m12.07,20.24l-4.24-4.24-2.83,2.83,4.24,4.24c1.98,1.98,4.02,2.85,6.76,2.92v6.01H4v4h12v2c0,1.04.07,2.03.19,2.98l-3.26,3.26c-2.05,2.05-2.93,4.17-2.93,7.07v2.69h4v-2.69c0-1.83.46-2.95,1.76-4.24l1.54-1.54c2.08,5.35,6.55,8.47,12.7,8.47V22h-13.69c-1.83,0-2.95-.46-4.24-1.76Z"})]})})},550322:(e,t,n)=>{n.d(t,{P:()=>o});n(667294);var r=n(785893);const o=(0,n(827282).IU)("commentAdd",{viewBox:"0 0 16 15",svg:(0,r.jsx)("path",{d:"M4.73926 14.6865C4.46582 14.6865 4.25163 14.5977 4.09668 14.4199C3.94629 14.2422 3.87109 14.0007 3.87109 13.6953V12.0137H3.50195C2.84115 12.0137 2.27376 11.8861 1.7998 11.6309C1.3304 11.3757 0.968099 11.0111 0.712891 10.5371C0.46224 10.0586 0.336914 9.47982 0.336914 8.80078V3.49609C0.336914 2.81706 0.46224 2.24056 0.712891 1.7666C0.963542 1.28809 1.32585 0.921224 1.7998 0.666016C2.27832 0.410807 2.86165 0.283203 3.5498 0.283203H12.4434C13.127 0.283203 13.708 0.410807 14.1865 0.666016C14.665 0.921224 15.0296 1.28809 15.2803 1.7666C15.5309 2.24056 15.6562 2.81706 15.6562 3.49609V8.80078C15.6562 9.47982 15.5309 10.0586 15.2803 10.5371C15.0296 11.0111 14.665 11.3757 14.1865 11.6309C13.708 11.8861 13.127 12.0137 12.4434 12.0137H8.21875L5.88086 14.085C5.64844 14.29 5.44792 14.4404 5.2793 14.5361C5.11068 14.6364 4.93066 14.6865 4.73926 14.6865ZM5.07422 13.1758L7.24121 11.0293C7.38704 10.8835 7.52148 10.7878 7.64453 10.7422C7.77214 10.6921 7.94076 10.667 8.15039 10.667H12.4023C13.0495 10.667 13.528 10.5075 13.8379 10.1885C14.1523 9.86491 14.3096 9.38639 14.3096 8.75293V3.53711C14.3096 2.9082 14.1523 2.43424 13.8379 2.11523C13.528 1.79167 13.0495 1.62988 12.4023 1.62988H3.58398C2.94141 1.62988 2.46289 1.79167 2.14844 2.11523C1.83854 2.43424 1.68359 2.9082 1.68359 3.53711V8.75293C1.68359 9.38639 1.83854 9.86491 2.14844 10.1885C2.46289 10.5075 2.94141 10.667 3.58398 10.667H4.52051C4.71191 10.667 4.85091 10.7103 4.9375 10.7969C5.02865 10.8789 5.07422 11.0225 5.07422 11.2275V13.1758ZM4.8418 6.14844C4.8418 5.95703 4.90104 5.80208 5.01953 5.68359C5.13802 5.56055 5.29525 5.49902 5.49121 5.49902H7.36426V3.62598C7.36426 3.43913 7.4235 3.28646 7.54199 3.16797C7.66048 3.04492 7.81087 2.9834 7.99316 2.9834C8.18457 2.9834 8.33952 3.04264 8.45801 3.16113C8.58105 3.27962 8.64258 3.43457 8.64258 3.62598V5.49902H10.5156C10.707 5.49902 10.862 5.56055 10.9805 5.68359C11.099 5.80208 11.1582 5.95703 11.1582 6.14844C11.1582 6.33073 11.099 6.48112 10.9805 6.59961C10.862 6.7181 10.707 6.77734 10.5156 6.77734H8.64258V8.65723C8.64258 8.84408 8.58105 8.99902 8.45801 9.12207C8.33952 9.24056 8.18457 9.2998 7.99316 9.2998C7.81087 9.2998 7.66048 9.24056 7.54199 9.12207C7.4235 8.99902 7.36426 8.84408 7.36426 8.65723V6.77734H5.49121C5.2998 6.77734 5.14258 6.7181 5.01953 6.59961C4.90104 6.48112 4.8418 6.33073 4.8418 6.14844Z"})})},768745:(e,t,n)=>{n.d(t,{Y:()=>o});n(667294);var r=n(785893);const o=(0,n(827282).IU)("commentReply",{viewBox:"0 0 12 12",svg:(0,r.jsx)("path",{d:"M11.2324 7.2832C11.2324 4.95117 9.66211 3.33984 7.00195 3.33984H3.32227L1.96875 3.4043L2.99414 2.53711L4.48242 1.08398C4.59961 0.972656 4.67578 0.826172 4.67578 0.632812C4.67578 0.263672 4.41797 0 4.03711 0C3.87305 0 3.69141 0.0761719 3.5625 0.199219L0.205078 3.50977C0.0703125 3.63867 0 3.81445 0 3.99609C0 4.17188 0.0703125 4.34766 0.205078 4.47656L3.5625 7.78711C3.69141 7.91016 3.87305 7.98633 4.03711 7.98633C4.41797 7.98633 4.67578 7.72266 4.67578 7.35352C4.67578 7.16016 4.59961 7.01953 4.48242 6.90234L2.99414 5.44922L1.96875 4.58789L3.32227 4.64648H7.03125C8.90625 4.64648 9.94336 5.71289 9.94336 7.23633C9.94336 8.75977 8.90625 9.87305 7.03125 9.87305H5.66016C5.27344 9.87305 4.99805 10.166 4.99805 10.5234C4.99805 10.8809 5.27344 11.1738 5.66602 11.1738H7.07812C9.69141 11.1738 11.2324 9.63281 11.2324 7.2832Z"})})},466222:(e,t,n)=>{n.d(t,{v:()=>o});n(667294);var r=n(785893);const o=(0,n(827282).IU)("databaseOutline",{viewBox:"0 0 16 16",svg:(0,r.jsx)("path",{d:"M7.98145 15.3584C4.38574 15.3584 2 13.9775 2 12.0088V3.78516C2 1.9873 4.39258 0.763672 7.98145 0.763672C11.5771 0.763672 13.9697 1.9873 13.9697 3.78516V12.0088C13.9697 13.9775 11.584 15.3584 7.98145 15.3584ZM7.98145 5.58301C10.7773 5.58301 12.6709 4.83105 12.6709 3.78516C12.6709 2.69141 10.7842 1.91895 7.98145 1.91895C5.18555 1.91895 3.29883 2.69141 3.29883 3.78516C3.29883 4.83105 5.19238 5.58301 7.98145 5.58301ZM7.98145 6.80664C5.97852 6.80664 4.35156 6.42383 3.29883 5.77441V8.69336C4.42676 9.37695 6.19043 9.81445 7.98145 9.81445C9.7793 9.81445 11.543 9.37695 12.6709 8.69336V5.77441C11.6182 6.42383 9.99121 6.80664 7.98145 6.80664ZM7.98145 11.0449C6.23828 11.0449 4.5293 10.6621 3.29883 10.0332V12.0088C3.29883 13.2051 5.11035 14.1348 7.98145 14.1348C10.8594 14.1348 12.6709 13.2051 12.6709 12.0088V10.0332C11.4404 10.6621 9.73145 11.0449 7.98145 11.0449Z"})})},94250:(e,t,n)=>{n.d(t,{c:()=>o});n(667294);var r=n(785893);const o=(0,n(827282).IU)("eye",{viewBox:"0 0 32 32",svg:(0,r.jsx)("path",{d:"M16.006 25.812c8.863 0 14.994-7.17 14.994-9.406C31 14.16 24.858 7 16.006 7 7.252 7 1 14.16 1 16.406c0 2.236 6.252 9.406 15.006 9.406zm0-3.242a6.194 6.194 0 01-6.197-6.164c-.012-3.452 2.744-6.164 6.197-6.164 3.419 0 6.185 2.711 6.185 6.164 0 3.364-2.766 6.164-6.185 6.164zm0-3.94c1.228 0 2.246-1.007 2.246-2.224 0-1.228-1.018-2.235-2.246-2.235-1.24 0-2.258 1.007-2.258 2.235 0 1.217 1.018 2.224 2.258 2.224z"})})}}]);