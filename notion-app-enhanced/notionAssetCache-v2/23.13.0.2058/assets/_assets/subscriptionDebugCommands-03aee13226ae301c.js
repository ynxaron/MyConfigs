"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[95126],{106374:(e,t,n)=>{n.r(t),n.d(t,{SubscriptionDebugCommands:()=>I});n(821057),n(122556),n(582845),n(250570),n(533019),n(721473),n(788208),n(22624),n(267602),n(653476),n(470928),n(241792);var o=()=>n(100056),r=()=>n(219727),i=()=>n(142735),s=()=>n(947115),a=()=>n(629719),c=()=>n(513670),d=()=>n(696459),u=()=>n(824462),l=()=>n(332542),p=()=>n(636340),m=()=>n(269299),g=()=>n(348141),S=()=>n(254940),b=()=>n(356140),f=()=>n(876822),v=()=>n(538992),h=()=>n(489294),_=()=>n(663773),k=()=>n(18281),A=()=>n(661769),C=()=>n(30795),U=()=>n(404791),D=()=>n(897257);function I(){const e=(0,r().O7)(),t=(0,b().W)(),n=(0,i().Kw)(D().subscriptionDataStoreInstance),o=(0,C().V)(n),c=(0,_().Cv)({spaceId:t}),l=(0,A().h1)(),I=(0,i().VK)((()=>f().default.state.currentSpaceStore),[]);return(0,s().exposeDebugValue)("subscriptions",{updateSubscription:async function(){var t,n,o;let{billingInterval:r="month",products:i=["plus"]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!I||!c)return;const s=new Set(i),u=new Set(null!==(t=c.subscription)&&void 0!==t&&t.items.length?null===(n=c.subscription)||void 0===n?void 0:n.items.map((e=>e.price.product)):["free"]);if(i.find((e=>"free"===e)))return(0,h().cancelSubscription)({environment:e,from:"subscription_debug_commands",spaceStore:I,cancelImmediately:!0});const p=(0,a().Tz)(c.subscription),m="admin"===c.type?(0,a().Tz)(null===(o=c.subscription)||void 0===o?void 0:o.pending):void 0,g=s.difference(u).size>0;if(!(r!==(m??p))&&!g)return;const S=i.map((e=>{const t=l.find((t=>t.product===e&&t.billingInterval===r));if(!(0,d().Rw)(t))return{quantity:1,price:t}})).filter(d().lm);return S.length?(0,h().updateSubscription)({environment:e,from:"subscription_debug_commands",spaceStore:I,paymentData:{type:"paymentMethodId",value:"pm_card_visa"},desiredState:{trialEnd:void 0,items:S}}):void 0},getAiUsage:()=>{const e=U().Z.state;if(!e)throw Error("AI usage store not found");return{spaceUsage:e.spaceUsage,spaceUsageLimit:e.spaceLimit,userUsage:e.userUsage,userUsageLimit:e.userLimit}},getBlockUsage:()=>{const n=D().subscriptionDataStoreInstance.state;if(!n||!t)throw Error("Subscription data store not found");return{blockLimitCount:(0,k().Lz)(e,t,n,o)}},resetDeleteBlocksModal:()=>{const t=f().default.state.currentSpaceViewStore;t&&m().createAndCommit({userAction:"DeleteBlocksModal.showDeleteBlocksModal",environment:e,canUndo:!0,perform:e=>{m().applyOperation({store:t,operation:{pointer:t.pointer,path:["settings"],command:"update",args:{...t.getSettings(),seen_delete_blocks_modal:!1}},transaction:e})}})},resetStudentAiPopup:()=>{const t=f().default.state.currentUserSettingsStore;m().createAndCommit({userAction:"dismissedStudentAiPopup.reset",environment:e,canUndo:!0,perform:e=>{g().d2({transaction:e,userSettingsStore:t,data:{dismissed_student_ai_popup:!1}})}})},resetReverseTrialSidebarAlert:()=>{const t=f().default.state.currentUserSettingsStore;m().createAndCommit({userAction:"ReverseTrialSidebarAlert.resetDismissal",environment:e,canUndo:!0,perform:e=>{g().d2({transaction:e,userSettingsStore:t,data:{reverse_trial_sidebar_alert_dismissed_at:void 0}})}})},sendMemberRequestForAddOn:()=>{const t=f().default.state.currentSpaceStore;t&&v().jw({environment:e,spaceStore:t,from:"ai_qna_limit_in_app"})},recordAIUsage:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const n=f().default.state.currentSpaceStore;n&&(await u().callApi({eventName:"recordAIUsage",environment:e,data:{spaceId:n.id,usage:t}}),await(0,S().maybeUpdateAiEligibility)(e,n.id,!0))},recordBlockUsage:e=>{D().subscriptionDataStoreInstance.update((t=>t&&"blockUsage"in t?{...t,blockUsage:e}:t))},resetReachBlockLimitTime:()=>{const t=f().default.state.currentSpaceStore;t&&m().createAndCommit({userAction:"SubscriptionDebugCommands.resetReachBlockLimitTime",environment:e,canUndo:!0,perform:e=>{p().sW({store:t,data:{settings:{...t.getSettings(),reach_block_limit_time:void 0}},transaction:e})}})}}),null}function y(e,t,o,r){m().createAndCommit({userAction:"SubscriptionDebugCommands.addBlocksToPage",environment:o,canUndo:!0,perform:i=>{c().DZ(e,(()=>{const e=p().j4({environment:o,type:"text",inMemoryRecordCache:t.inMemoryRecordCache,transaction:i,properties:{title:[[r||"money team is the best team"]]}});l().jG({parentStore:t.getContentStore(),childStore:n(826955).G.createChildStore(t.getContentStore(),e.pointer),transaction:i})}))}})}function w(e,t,n){const o=t.getContentStores().slice(-e);m().createAndCommit({userAction:"SubscriptionDebugCommands.removeBlocksFromPage",environment:n,canUndo:!0,perform:e=>{for(const n of o)l().hr({parentStore:t.getContentStore(),childStore:n,transaction:e})}})}(0,o().exposeDebugEnvironmentValue)("getStripeLinks",(e=>function(){var t,o;let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const i=null===(t=f().default.state.currentSpaceStore)||void 0===t?void 0:t.id;if(!i)return"No space id found";const s=n(518019).Z.getData(e,{spaceId:i});if(!s)return"No billing data found";const a=r?"https://dashboard.stripe.com/test":"https://dashboard.stripe.com";return{customer:s.externalId?`${a}/customers/${s.externalId}`:"No customer id found",subscription:null!==(o=s.subscription)&&void 0!==o&&o.externalId?`${a}/subscriptions/${s.subscription.externalId}`:"No subscription id found"}})),(0,o().exposeDebugEnvironmentValue)("addBlocksToPage",(e=>(t,n)=>{const o=f().default.state.currentSpaceStore,r=f().default.state.mainEditorCurrentBlockStore;o&&r&&(t<100?y(t,r,e,n):c().DZ(t/100,(()=>{y(100,r,e,n)})))})),(0,o().exposeDebugEnvironmentValue)("removeBlocksFromPage",(e=>t=>{const n=f().default.state.currentSpaceStore,o=f().default.state.mainEditorCurrentBlockStore;n&&o&&(t<100?w(t,o,e):c().DZ(t/100,(()=>{w(100,o,e)})))}))}}]);