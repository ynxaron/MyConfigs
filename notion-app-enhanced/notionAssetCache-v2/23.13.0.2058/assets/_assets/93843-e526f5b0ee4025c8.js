"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[93843],{493843:(e,t,o)=>{o.d(t,{$o:()=>H,Fv:()=>O,IL:()=>$,J4:()=>X,KA:()=>B,Nf:()=>q,_p:()=>J,cQ:()=>Q,f$:()=>U,fX:()=>Y,j2:()=>A,k2:()=>Z,mg:()=>N,mz:()=>M,oP:()=>E,tF:()=>G,td:()=>K,x:()=>W});o(670560),o(267602),o(470928),o(30005),o(241792),o(228244);var r=()=>o(730120),n=()=>o(492788),i=()=>o(506347),a=()=>o(926724),s=()=>o(331540),l=()=>o(874459),c=()=>o(998411),m=()=>o(35980),d=()=>o(513670),u=()=>o(696459),p=()=>o(250303),S=()=>o(384667),f=()=>o(366257),v=()=>o(139224),y=()=>o(421654),_=()=>o(636340),g=()=>o(531515),h=()=>o(47443),b=()=>o(794586),C=()=>o(879952),w=()=>o(970105),P=()=>o(990966),x=()=>o(269299),T=()=>o(715146),R=()=>o(887430),I=()=>o(861026),k=()=>o(804217),F=()=>o(826955),L=()=>o(965903),V=()=>o(807230),z=()=>o(701182),D=()=>o(645843);function A(e){const{collectionViewStore:t,collectionContextStore:o,timelineState:r,environment:n}=e,i=n.currentUser.id,a=(0,z().B8)(t.id),s=(0,z().pQ)(t,n),l=o.permissionScopesStore.state,c=d().Ds((()=>{if(r.destroyed)return;const e={zoomLevel:r.zoomLevel.state,centerTimestamp:(0,z().al)(r)};m().Z.set({userId:i,key:a,value:e})}),1e3),u=d().Ds((()=>{if(r.destroyed||!k().default.state.online||!n.currentUser.isLoggedIn()||!l.canConfigureBlock)return;const e={zoomLevel:r.zoomLevel.state,centerTimestamp:(0,z().al)(r)},o=t.getFormat().timeline_preference;d().Xy(o,e)||x().createAndCommit({userAction:"collectionTimelineViewActions.setRemotePreference",environment:n,canUndo:!0,perform:o=>{y().FH({stores:[t],update:{timeline_preference:e},transaction:o})}})}),5e3);r.savePreference=()=>{c(),u()},q({timelineState:r,environment:n,...s})}function q(e){const{timelineState:t,zoomLevel:o,centerTimestamp:r,environment:i}=e,{savePreference:a}=t,s=i.WindowSizeStore.state.width+2*z().Ge,l=(0,z().x2)(o,s),c=r-l/2,m=r+l/2;t.zoomLevel.setState(o),t.currentRange.setState({startTimestamp:c,endTimestamp:m}),n().default.afterNextFlush((()=>{B({timelineState:t,centerTimestamp:r}),a&&a()}))}function B(e){const{timelineState:t,centerTimestamp:o}=e,{horizontalScroller:r,outerSizeObserver:n}=t;if(!r)return;const i=t.zoomLevel.state,{startTimestamp:a,endTimestamp:s}=t.currentRange.state,l=n.rect.state.width;if(l===(0,z().e$)(i,s-a))return;const c=(0,z().e$)(i,o-a)-l/2;r.scrollLeft=c,t.scrollLeft.setState(c)}function E(e){const{environment:t,store:o,query:r,date:n,schema:i,transaction:a}=e,{timeline_by:s}=r;if(!s)return;const l=o.getAssociatedCollectionStore(),c=(null==l?void 0:l.getMappedProperty(s))??s,m=r.timeline_by_end?(null==l?void 0:l.getMappedProperty(r.timeline_by_end))??r.timeline_by_end:void 0,d=(0,z().TW)({store:o,dateValue:n,query:r,schema:(null==l?void 0:l.getSchema())??i}),u=o.getPropertyValue(c),p=m?o.getPropertyValue(m):void 0;return _().sW({store:o.getPropertiesStore(),data:d,transaction:a}),f().H({environment:t,store:o,dateProperty:{id:c,newValue:(null==d?void 0:d[c])??[],oldValue:u},otherDateProperty:m?{id:m,newValue:(null==d?void 0:d[m])??[],oldValue:p}:void 0}),o}function O(e){var t;const{environment:o,timelineState:n,collectionStore:i,collectionContextStore:a,store:s,query:m,groupFormat:d,transaction:u}=e,p=n.zoomLevel.state,f=(0,z().al)(n),{snapUnit:v,getDateRangePlaceholderDuration:y}=z().BJ[p],{timeline_by:_}=m;if(!_)return;const g=null===(t=a.groupsStore.getGroupState(d))||void 0===t?void 0:t.resultsStore.state;if(!g)return;const h=r().ou.fromMillis(f),b=(0,z().DS)(h,v),C=(0,z().DS)(y(h),v),w=(0,z().AZ)({startValue:(0,l().Lg)((0,c().r)()),snapUnit:v,desiredStart:b,desiredEnd:C});return E({environment:o,store:s,query:m,schema:i.getSchema(),date:w,transaction:u}),S().$T({environment:o,collectionStore:i,before:!0,store:g[0],insertStores:[s],collectionContextStore:a,groupsPointer:d?[d]:[],transaction:u}),s}function U(e){const{type:t,timelineState:o,store:r,startX:n,query:i,schema:a,intl:s,environment:l}=e,{horizontalScroller:c}=o,{startTimestamp:m}=o.currentRange.state;if(!c)return;C().Ys({environment:l,store:r});const u=c.scrollLeft,{stores:p}=L().default.state,S=d().oA(p.map((e=>{const t=(0,z().bk)({store:e,query:i,schema:a,userId:l.currentUser.id,intl:s,formulasModule:void 0});if(t)return{startValue:t,store:e}})));o.dragState.setState({type:t,startStore:r,stores:S.map((e=>{let{store:t}=e;return t})),startValues:S.map((e=>{let{startValue:t}=e;return t})),temporaryValues:S.map((e=>{let{startValue:t}=e;return t})),startX:n,startStartTimestamp:m,startScrollLeft:u})}function X(e){const{timelineState:t,store:o,startX:r,startY:n,schema:i,collectionContextStore:a,verticalScroller:s}=e,{horizontalScroller:l}=t,{startTimestamp:c}=t.currentRange.state;if(!l||!s)return;const m=l.scrollLeft,d=s.scrollTop,u=(0,z().YE)(a,o,i);t.drawState.setState({startStore:o,startDependencyRelationPointers:u,temporaryDependencyRelationPointers:[...u],startX:r,startY:n,startScrollLeft:m,startScrollTop:d,startStartTimestamp:c,xOffsetPx:0,yOffsetPx:0,tryToCompleteDrawnArrow:!1})}function K(e){const{timelineState:t,currentX:o}=e,{horizontalScroller:r}=t,n=t.zoomLevel.state,i=t.dragState.state,{startTimestamp:a}=t.currentRange.state;if(!i||!r)return;const{type:s,startStartTimestamp:c,startValues:m,startScrollLeft:p,startX:S,startStore:f,stores:v}=i,y=z().BJ[n],{snapUnit:_}=y,g=r.scrollLeft-p+(o-S)+(0,z().e$)(n,a-c),h=(0,z().x2)(n,g),b=m[v.indexOf(f)];let C;if(s===z().px.LeftResizer){const{start:e}=(0,z().XO)(b,_),t=e.plus(h);C=m.map((e=>{const o=(0,z().AZ)({startValue:e,snapUnit:_,desiredStart:t});return(0,l().gW)(o)}))}else if(s===z().px.RightResizer){const{end:e}=(0,z().XO)(b,_),t=e.plus(h);C=m.map((e=>{const o=(0,z().AZ)({startValue:e,snapUnit:_,desiredEnd:t});return(0,l().Qq)(o)}))}else s===z().px.ItemDrag?C=m.map((e=>{const{start:t,end:o}=(0,z().XO)(e,_),r=t.plus(h),n=r.plus(o.valueOf()-t.valueOf());return(0,z().AZ)({startValue:e,snapUnit:_,desiredStart:r,desiredEnd:n})})):(0,u().t1)(s);d().Xy(i.temporaryValues,C)||t.dragState.setState({...i,temporaryValues:C})}function M(e){const{timelineState:t,currentX:o,currentY:r,verticalScroller:n}=e,i=t.drawState.state,a=t.zoomLevel.state,{startTimestamp:s}=t.currentRange.state,{horizontalScroller:l}=t;if(!i||!l||!n)return;const{startDependencyRelationPointers:c,startStore:m,startX:u,startY:p,startScrollLeft:S,startScrollTop:f,startStartTimestamp:v}=i,y=l.scrollLeft,_=n.scrollTop,g=y-S+(o-u)+(0,z().e$)(a,s-v),h=_-f+(r-p),b=t.hoveredItem.state;if(b&&b!==m&&!c.some((e=>e.id===b.id))){const e=[...c,{table:"block",id:b.id,spaceId:b.getSpaceId()}];d().Xy(i.temporaryDependencyRelationPointers,e)||t.drawState.setState({...i,temporaryDependencyRelationPointers:e,xOffsetPx:void 0,yOffsetPx:void 0})}else t.drawState.setState({...i,temporaryDependencyRelationPointers:[...c],xOffsetPx:g,yOffsetPx:h})}function Y(e){const{environment:t,collectionContextStore:o,timelineState:r,query:n,schema:i,transaction:a}=e,s=r.dragState.state,{timeline_by:l}=n;if(!s||!l)return;const{temporaryValues:c,stores:m}=s;c.forEach(((e,r)=>{const s=m[r];E({environment:t,store:s,query:n,schema:i,transaction:a,date:e}),p().rv({environment:t,collectionContextStore:o,block_id:s.id,property:l,property_type:"date",from:"timeline"})})),r.dragState.setState(void 0)}function H(e){var t;const{timelineState:o,environment:r,transaction:n,collectionContextStore:i,isFullScreen:a,isRootChild:s}=e,l=o.drawState.state,c=o.dateRangePlaceholder.state;if(!l)return;const{startStore:m,startDependencyRelationPointers:d,temporaryDependencyRelationPointers:u}=l;if(!m)return void o.drawState.setState(void 0);let S;if(c.active){const{date:e,store:t,parentStore:a,groupFormat:s,newTimelineItemProps:l,existingTimelineItemProps:d}=c;if(t&&d){const{query:o,schema:i}=d;E({environment:r,store:t,query:o,schema:i,date:e,transaction:n}),S={table:"block",id:t.id,spaceId:m.getSpaceId()}}else if(l){const{query:o,schema:c,isFullScreen:d,canEditTimelineItems:u,subitemPath:p}=l,f=N({environment:r,date:e,store:t,parentStore:a,query:o,schema:c,isFullScreen:d,groupFormat:s,canEditTimelineItems:u,collectionContextStore:i,subitemPath:p,transaction:n,from:"timeline_complete_draw"});f&&(S={table:"block",id:f.id,spaceId:m.getSpaceId()})}o.dateRangePlaceholder.setState({active:!1})}else S=u.find((e=>!d.includes(e)));const f=(0,z()._e)(i);if(f){const{property:e}=f;S&&(g().hE({environment:r,propertyWithInverse:f,sourceStore:m,destStore:F().G.createChildStore(m,S),position:{type:"after"},transaction:n}),p().rv({environment:r,collectionContextStore:i,block_id:m.id,property:e,property_type:"relation",from:"timeline",isFromBulkActionsToolbar:!1,isUnthrottled:!0})),o.drawState.setState(void 0)}else v().wl({item:{type:"dependencies",from:"view_options"},collectionSettingsStore:i.settingsStore}),o.drawState.setState({...l,tryToCompleteDrawnArrow:!0});const y=null===(t=S)||void 0===t?void 0:t.id;y&&(0,D().LE)(r,{...(0,I().Pn)(i),...(0,D().Ii)({environment:r,collectionContextStore:i,timelineState:o,isFullScreen:a,isRootChild:s}),dependenciesPropertyID:null==f?void 0:f.property,blockedByStoreID:m.id,blockingStoreID:y})}function Q(e){const{timelineState:t,environment:o}=e;t.dragState.state&&(t.dragState.setState(void 0),C().ZH({environment:o}))}function W(e){const{timelineState:t,environment:o}=e;t.drawState.state&&(t.drawState.setState(void 0),C().ZH({environment:o}))}function Z(e){const{stores:t,collectionViewStore:o,schema:r,transaction:n}=e,i=o.getType(),a=o.getQuery(r),s=[];a&&("calendar"===i?a.calendar_by&&s.push(a.calendar_by):"timeline"===i&&(a.timeline_by&&s.push(a.timeline_by),a.timeline_by_end&&s.push(a.timeline_by_end)));for(const l of t)for(const e of s)w().sO({environment:l.environment,store:l.getPropertyStore(e),value:void 0,transaction:n})}function $(e){const{dependency:t,collectionContextStore:o,environment:r,timelineState:n,isFullScreen:i,isRootChild:a}=e,s=(0,z()._e)(o),l=o.collectionStore();if(!s||!l)return;const{property:c}=s,{store:m,relationPointer:d}=t,u=m.getSchema()[c];u&&"relation"===u.type&&(x().createAndCommit({userAction:"CollectionTimelineDependenciesOverlay.handleRemoveRelation",environment:r,canUndo:!0,perform:e=>{g().Bl({environment:r,propertyWithInverse:s,sourceStore:m,destStore:F().G.createChildStore(m,d),transaction:e}),p().rv({environment:r,block_id:d.id,property:c,property_type:u.type,from:"timeline",collectionContextStore:o,isFromBulkActionsToolbar:!1,isUnthrottled:!0})}}),(0,D().lf)(r,{...(0,I().Pn)(o),...(0,D().Ii)({environment:r,collectionContextStore:o,timelineState:n,isFullScreen:i,isRootChild:a}),dependenciesPropertyID:c,blockedByStoreID:m.id,blockingStoreID:d.id}))}function G(e){const{collectionViewStore:t,newProperty:o,transaction:r}=e;y().FH({stores:[t],update:{timeline_arrows_by:{property:o}},transaction:r})}function J(e){var t;const{collectionContextStore:o,relationPropertyId:r,transaction:n}=e,i=o.collectionStore();if(!i)return;const l=r?i.getSchema()[r]:void 0,c="relation"===(null==l?void 0:l.type)&&l.property&&"relation"===(null===(t=i.getSchema()[l.property])||void 0===t?void 0:t.type)?l.property:void 0;y().FH({stores:[i],update:{collection_default_arrows_by:r,...i.getFormat().app_config_uri===s().iS?{app_uri_map:{...i.getFormat().app_uri_map?i.getFormat().app_uri_map:{},[a().Es.BlockingRelation]:r,[a().Es.BlockedRelation]:c}}:{}},transaction:n})}function N(e){const{environment:t,transaction:o,date:r,parentStore:n,query:a,schema:s,isFullScreen:l,groupFormat:c,canEditTimelineItems:m,collectionContextStore:d,from:u}=e;if(!(0,V().ww)(t))return;const p=c?[c]:[],f=d.groupsStore.getGroupState(p);if(!f)return;if(n)return function(e){const{environment:t,transaction:o,date:r,store:n,parentStore:a,query:s,schema:l,groupFormat:c,canEditTimelineItems:m,collectionContextStore:d,subitemPath:u}=e;if(!n||!a)return;const p=c?[c]:[],f=S().yk({environment:t,collectionContextStore:d,groupsPointer:p,store:n,before:!1,collectionStore:a,transaction:o,subitemPath:u,subitemInsertDirection:"into"});if(f){if(E({environment:t,store:f,query:s,schema:l,date:r,transaction:o}),t.device.isMobile)h()._c({environment:t,store:f,pageVisitSource:i().tY.Create});else if(f&&m){const e=f.getBlockTitleStore();P().setSelectionAtStart({store:e})}return f}}(e);d.searchQueryStore.state&&(0,T().U)({searchQuery:"",collectionContextStore:d,isFullScreen:l});const v=S().IW({environment:t,collectionContextStore:d,groupsPointer:p,shouldCoerce:!0,templateStore:d.defaultPageTemplateStore.state,transaction:o,from:{createBlock:u},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache});if(!v)return;const y=v.coercionSucceeded,_=v.newStore;if(E({environment:t,store:_,query:a,schema:s,date:r,transaction:o}),t.device.isMobile)h()._c({environment:t,store:_,pageVisitSource:i().tY.Create});else if(y&&m){const e=_.getBlockTitleStore();P().setSelectionAtEnd({store:e})}else b().CH({environment:t,store:_,peekMode:(0,R().kr)(d),resultsStore:null==f?void 0:f.resultsStore,collectionContextStore:d,pageVisitSource:i().tY.Create});return _}},645843:(e,t,o)=>{o.d(t,{Al:()=>l,CB:()=>c,H6:()=>s,Ii:()=>S,LE:()=>u,gw:()=>m,iR:()=>i,lf:()=>p,ne:()=>d,zI:()=>a});o(267602),o(653476);var r=()=>o(594546),n=()=>o(701182);function i(e,t){r().lu(e,"timeline_view","timeline_view",5,t)}function a(e,t){r().K4(e,"timeline_zoom_level_update",t)}function s(e,t){r().K4(e,"timeline_today_click",t)}function l(e,t){r().K4(e,"timeline_shift_time_click",t)}function c(e,t){r().K4(e,"timeline_toggle_table_click",t)}function m(e,t){r().K4(e,"timeline_item_scroll_arrow_click",t)}function d(e,t){r().K4(e,"timeline_item_resize",t)}function u(e,t){r().K4(e,"timeline_dependency_arrow_add",t)}function p(e,t){r().K4(e,"timeline_dependency_arrow_delete",t)}function S(e){const{environment:t,collectionContextStore:o,timelineState:r,isFullScreen:i,isRootChild:a}=e,s=r.zoomLevel.state,l=o.normalizedFormatStore.state,c=(0,n().C1)({environment:t,format:l,isFullScreen:i,isRootChild:a}),m=c&&l.timeline_table_properties?l.timeline_table_properties.length:0,d=l.timeline_properties||[],u=d.filter((e=>"title"!==e.property));return{zoom_level:s,show_table:c,show_table_properties_count:m,show_timeline_title:d.length!==u.length,show_timeline_properties_count:u.length}}},715146:(e,t,o)=>{function r(e){const{searchQuery:t,collectionContextStore:o}=e;o.collectionViewStore()&&(o.searchQueryStore.setState(t||""),o.groupsStore.resetAllLimits())}o.d(t,{U:()=>r})}}]);