"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[31655,39447],{832024:(e,t,o)=>{o.d(t,{AK:()=>m,Mc:()=>r,OS:()=>u,Td:()=>h,Uu:()=>l,XC:()=>s,ZK:()=>v,e8:()=>p,gV:()=>d,hc:()=>y,n0:()=>f,u0:()=>g,xi:()=>c});var n=()=>o(594546),i=()=>o(572623),a=()=>o(697623);function r(e){n().K4(e,"add_slack_integration")}function l(e){n().K4(e,"remove_slack_integration")}function s(e,t){n().K4(e,"slack_notification_create",t)}function c(e,t){n().K4(e,"slack_notification_delete",t)}function u(e,t){n().K4(e,"slack_notification_update",t)}function d(e,t){const o=a().zt(),r=i().JF();n().K4(e,"slack_imports_invite_render_button",{subscription_tier:o,domain_type:r,origin:t.origin,invite_flow_id:t.invite_flow_id})}function p(e,t){const o=a().zt(),r=i().JF();n().K4(e,"slack_imports_invite_render_invite_popup",{subscription_tier:o,domain_type:r,origin:t.origin,invite_flow_id:t.invite_flow_id})}function m(e,t){const o=a().zt(),r=i().JF();n().K4(e,"slack_imports_invite_click_invite_button",{subscription_tier:o,domain_type:r,invited_user_count:t.invited_user_count,origin:t.origin,invite_token_query:t.inviteTokenQuery,invite_targets:t.inviteTargets,invite_flow_id:t.invite_flow_id})}function g(e,t){const o=a().zt(),r=i().JF();n().K4(e,"slack_imports_invite_completed",{subscription_tier:o,domain_type:r,invited_user_count:t.invited_user_count,is_success:t.is_success,origin:t.origin,invite_flow_id:t.invite_flow_id,error:t.error,invite_stage:t.invite_stage})}function h(e,t){const o=a().zt(),r=i().JF();n().K4(e,"slack_imports_invite_dismiss_popup",{subscription_tier:o,domain_type:r,origin:t.origin,invite_flow_id:t.invite_flow_id})}function y(e,t){const o=a().zt(),r=i().JF();n().K4(e,"slack_imports_invite_click_select_all",{subscription_tier:o,domain_type:r,origin:t.origin,invite_flow_id:t.invite_flow_id,invited_user_count:t.invited_user_count,is_unselect:t.is_unselect,invite_token_query:t.invite_token_query})}function f(e,t){const o=a().zt(),r=i().JF();n().K4(e,"slack_imports_invite_start_slack_integration",{subscription_tier:o,domain_type:r,origin:t.origin,invite_flow_id:t.invite_flow_id,from:t.from})}function v(e,t){const o=a().zt(),r=i().JF();n().K4(e,"slack_imports_invite_complete_slack_integration",{subscription_tier:o,domain_type:r,origin:t.origin,invite_flow_id:t.invite_flow_id,from:t.from,is_success:t.is_success})}},96724:(e,t,o)=>{o.d(t,{tA:()=>C});o(821057),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(653476);var n=()=>o(892981),i=()=>o(998411),a=()=>o(827370),r=()=>o(396136),l=()=>o(855741),s=()=>o(696459),c=()=>o(141735),u=()=>o(718959),d=()=>o(615676),p=()=>o(527278),m=()=>o(749826),g=()=>o(527135),h=()=>o(826955),y=()=>o(824462);const f=1e3;class v extends Error{constructor(e,t){super(t),this.type=e}}class x extends v{constructor(){super("query_collection_limit_outside_range",`Query collection limit must be between 0 andÂ ${f}`)}}class b extends v{constructor(e){super("query_collection_failed",`Query collection failed: ${e.reason}`),this.data=e}}class S extends v{constructor(){super("query_collection_too_many_items","Query collection updating too many items")}}async function C(e,t){const{source:o,parentRecordStore:v,collectionPointer:C,filter:k,sort:M,limit:j}=t,T=j??f;if(T<0||T>f)return{error:new x};const w=h().NW.createChildStore(v,C);await w.load();const A=w.getModel();if(!A)return{error:new b({reason:"no collection value"})};const I=w.getParentBlockStore();if(!I)return{error:new b({reason:"no collection parent"})};await I.load();const _=I.getCollectionViewStores()[0],P=_.getSpaceId();if(!_||!P)return{error:new b({reason:"no first collection view"})};const V="results",B={[V]:{type:"results",limit:T}},R=Object.keys(t.aggregations??{});for(const n of R){var F;if(n===V)return{error:new b({reason:`${V} is a reserved reducer keyword.`})};const e=null===(F=t.aggregations)||void 0===F?void 0:F[n];if(!e)return{error:new b({reason:`no aggregation provided for ${n}.`})};e&&(B[n]={type:"aggregation",aggregation:e})}const K=w.getSchema(),Z={filter:k&&n().Ih(k,K),sort:M&&n().zh(M,K),userId:e.currentUser.id,userTimeZone:(0,i().r)(),searchQuery:void 0,reducers:B},E=await y().callApi({eventName:"queryCollection",environment:e,data:{source:{type:"collection",id:C.id,spaceId:C.spaceId},collectionView:{id:_.id,spaceId:P},loader:Z},tracking:{src:o}});if("failed"===E.type)return{error:new b({reason:"server query failed",cause:E.error})};const H=E.data.result.reducerResults[V];if(!H||"results"!==H.type)return{error:new b({reason:"unexpected server result"})};if(H.blockIds.length===f&&H.hasMore)return{error:new S};const{groupsReducerIds:D,reducerIdsWithNoGroupDependencies:L}=n().x3(Z.reducers,Z.reducerDependencies),O=m().default.getConfigKey("collection_request_settings","clientFormulaTimeoutMs"),N=Date.now(),W=await c().F.formulas.load(),U={pageSort:[],schema:K,loader:Z,userId:e.currentUser.id,userStartOfWeek:u().AK.state,currentTime:N,getRecordModel:v.getRecordModel,intl:p().Z.getIntl(),isSorted:!1,visibleProperties:void 0,relativeVariableResult:null==E?void 0:E.data.relativeVariableResult,currentPageInRelatedCollection:void 0,isSprintPlanningView:!1,collectionSourceType:"collection",groupsReducerIds:D,reducerIdsWithNoGroupDependencies:L,formulaTimeoutMs:O,resultCache:new Map,regExpCache:new Map,experimentService:m().default,collectionFeatureGates:(0,d().W)(),formulasModule:W},G=n().fk(U);for(const i of H.blockIds){var z;const e=h().G.createChildStore(v,{table:r().iU,id:i}),t=null===(z=e.getAssociatedCollectionStore())||void 0===z?void 0:z.pointer;if(!(t&&a().dr.isEqualIdTable(t,w.pointer)))continue;const o=v.getRecordModel(e);o&&n().BW(o,A,U,G)}const $=g().Z.getEditedBlocksForCollection(A.id),Y=new Set(H.blockIds);for(const i of $){if(Y.has(i))continue;const e=v.getRecordModel({table:r().iU,id:i});e&&n().BW(e,A,U,G)}const{result:q}=n().kk(U,G),J=n().aW({result:q}),X={};for(const i of R){var Q;const e=n().Oi({expectedAggregator:null===(Q=t.aggregations)||void 0===Q||null===(Q=Q[i])||void 0===Q?void 0:Q.aggregator,aggregationReducerResult:E.data.result.reducerResults[i]});if(l().x.isFail(e)){const t="no aggregation provided"===e.error?`no aggregation provided for ${i}`:"unexpected response returned for aggregation"===e.error?`unexpected response returned for aggregation ${i}`:(0,s().t1)(e.error);return{error:new b({reason:t})}}X[i]=e.value}return{value:{blockIds:J,...X}}}},36763:(e,t,o)=>{o.d(t,{O:()=>m});o(667294);var n=()=>o(219727),i=()=>o(142735),a=()=>o(961507),r=()=>o(788860),l=()=>o(1910),s=()=>o(64260),c=()=>o(654133),u=()=>o(998901),d=()=>o(644329),p=o(785893);function m(e){const{onSubmit:t,canSend:o}=e,m=(0,d().bJ)(),g=(0,n().O7)(),h=(0,i().VK)((()=>g.device.isPhone),[g]);return(0,p.jsx)(c().Z,{renderTooltip:()=>(0,p.jsxs)("div",{children:[(0,p.jsx)(r()._H,{defaultMessage:"Send to AI",id:"completions.CompletionMenuActionBar.sendTooltip"}),(0,p.jsx)(s().Z,{style:m.keyboardShortcutInverted,name:"enter"})]}),placement:u().Placement.Bottom,render:e=>(0,p.jsx)(l().Z,{icon:a()._,onClick:t,isPurple:o,disabled:!o,iconStyle:{height:h?24:20,width:h?24:20},ariaLabel:"Send to AI",style:{pointerEvents:"auto",height:h?24:20,width:h?24:20},...e})})}},41109:(e,t,o)=>{o.d(t,{n:()=>l});o(667294);var n=()=>o(828042),i=()=>o(73898),a=o(785893);const r=16/(0,i().O)("small");function l(e){const{variant:t}=e,o=function(e){return(0,i().O)(e)*r}(t);return(0,a.jsx)(a.Fragment,{children:(0,n().t)({width:o,pointerEvents:"none"})})}},785673:(e,t,o)=>{o.d(t,{sW:()=>f,h9:()=>v,fy:()=>g,D_:()=>x,Oc:()=>h});var n=o(667294),i=()=>o(142735),a=()=>o(846550),r=()=>o(828042),l=()=>o(524434),s=()=>o(41109),c=()=>o(576917),u=()=>o(993491);const d=o.p+"c9223887dcb57b7d.gif",p=o.p+"7e9cbd56b1eca7b9.gif";var m=o(785893);function g(e){const{variant:t,style:o,forceSparkles:n}=e,a=(0,i().Kw)(l().r4);let r;return r=!n&&a?(0,m.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,m.jsx)(c().P,{variant:t,shadowVariant:"light"})}):(0,m.jsx)(s().n,{variant:n?"small":t}),(0,m.jsx)("div",{style:o,children:r})}function h(e){const{variant:t}=e,o=(0,i().Kw)(l().r4),n=(0,a().yK)((()=>({sparklesWrapper:{borderRadius:"100%",border:"2px solid RGB(182,208,240)",marginRight:8,marginLeft:8,padding:4},badge:{position:"absolute",left:"27px",top:"-5px"},faceWrapper:{marginRight:8}})),[]);return o?(0,m.jsx)("div",{style:n.faceWrapper,children:(0,m.jsx)(y,{variant:t})}):(0,m.jsxs)("div",{style:n.sparklesWrapper,children:[(0,m.jsx)(s().n,{variant:t}),(0,m.jsx)("div",{style:n.badge,children:(0,m.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"11",viewBox:"0 0 10 11",fill:"none",children:(0,m.jsx)("circle",{cx:"5",cy:"5.5",r:"4",fill:"#2383E2",stroke:"white",strokeWidth:"2"})})})]})}function y(e){const{variant:t}=e,o="dark"===(0,a().Fg)().mode,[i,r]=(0,n.useState)(!0);(0,n.useEffect)((()=>{setTimeout((()=>{r(!1)}),6e3)}),[]);const l=(0,n.useMemo)((()=>{if(i)return o?d:p}),[o,i]);return(0,m.jsx)("div",{style:{marginLeft:8},children:(0,m.jsx)(c().P,{variant:t,shadowVariant:"light",wrapWithPadding:!0,imgSource:l})})}function f(){const e=(0,i().Kw)(l().r4),t=(0,a().yK)((e=>({faceImgStyles:{width:20,height:20,background:e.assistantCornerButtonBackground,borderRadius:"50%",border:`1px solid ${e.tableDividerColor}`},sparklesIconStyle:{width:16,height:16,fill:e.icon.secondary}})),[]);return e?(0,m.jsx)("img",{style:t.faceImgStyles,src:u(),role:"presentation",alt:"Notion AI Face"}):(0,r().t)(t.sparklesIconStyle)}function v(){const e=(0,i().Kw)(l().r4),t=(0,a().yK)((e=>({faceImgStyles:{width:20,height:20,background:e.assistantCornerButtonBackground,borderRadius:"50%",border:`1px solid ${e.tableDividerColor}`},sparklesIconStyle:{width:16,height:16,fill:e.icon.secondary}})),[]);return e?(0,m.jsx)("img",{style:t.faceImgStyles,src:u(),role:"presentation",alt:"Notion AI Face"}):(0,r().t)(t.sparklesIconStyle)}function x(){const e=(0,i().Kw)(l().r4),t=(0,a().yK)((e=>({faceImgStyles:{width:20,height:20,background:e.assistantCornerButtonBackground,borderRadius:"50%",border:`1px solid ${e.tableDividerColor}`,marginLeft:-2,marginRight:2},sparklesIconStyle:{width:16,height:16,marginRight:2},sparklesIconWrapper:{borderRadius:4,display:"flex",alignItems:"center",justifyContent:"center"}})),[]);return e?(0,m.jsx)("img",{style:t.faceImgStyles,src:u(),role:"presentation",alt:"Notion AI Face"}):(0,m.jsx)("div",{style:t.sparklesIconWrapper,children:(0,r().t)(t.sparklesIconStyle)})}},49396:(e,t,o)=>{o.r(t),o.d(t,{addAutomationAction:()=>D,clearInvalidVariables:()=>G,createAutomation:()=>H,deleteAutomation:()=>X,disableAutomation:()=>J,duplicateAutomation:()=>O,duplicateAutomationAction:()=>N,enableAutomation:()=>q,insertEmptyTextInDuplicateBlockAction:()=>Y,messages:()=>E,removeAutomationAction:()=>U,reorderAutomationActions:()=>W,restartAutomation:()=>L});o(821057),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(653476),o(470928),o(30005),o(241792);var n=o.n(o(369282)),i=()=>o(730120),a=()=>o(492788),r=()=>o(912203),l=()=>o(271896),s=()=>o(764052),c=()=>o(157955),u=()=>o(559102),d=()=>o(92960),p=()=>o(481529),m=()=>o(827370),g=()=>o(494616),h=()=>o(922713),y=()=>o(81954),f=()=>o(955620),v=()=>o(513670),x=()=>o(543172),b=()=>o(855741),S=()=>o(696459),C=()=>o(832024),k=()=>o(282662),M=()=>o(332542),j=()=>o(636340),T=()=>o(990966),w=()=>o(269299),A=()=>o(205228),I=()=>o(872308),_=()=>o(594546),P=()=>o(615676),V=()=>o(487270),B=()=>o(32969),R=()=>o(637118),F=()=>o(309841),K=()=>o(658517),Z=()=>o(807629);const E=(0,o(788860).vU)({genericErrorMessage:{id:"automations.buttonTrigger.genericErrorMessage",defaultMessage:"Button failed to execute"},open:{defaultMessage:"Open",id:"automations.buttonTrigger.open"},undo:{defaultMessage:"Undo",id:"automations.buttonTrigger.undo"},defaultConfirmationWorkflowText:{defaultMessage:"Are you sure you want to continue?",id:"automations.buttonTrigger.defaultConfirmationWorkflowText"},defaultContinueWorkflowMessage:{defaultMessage:"Continue",id:"automations.buttonTrigger.defaultContinueWorkflowMessage"},defaultStopWorkflowMessage:{defaultMessage:"Cancel",id:"automations.buttonTrigger.defaultStopWorkflowMessage"},errorQueryCollectionTooManyPages:{defaultMessage:"Button impacts too many pages",id:"automations.buttonTrigger.errorQueryCollectionTooManyPages"},errorRecordInTrash:{id:"automations.buttonTrigger.errorRecordInTrash",defaultMessage:"Button is editing a page in trash"}});function H(e){const{actionIds:t,automationId:o,automationName:i,environment:a,inMemoryRecordCache:r,parentPointer:l,transaction:s,trigger:c}=e,u=o??(0,V().TS)({environment:a,table:g().cv,spaceId:l.spaceId}),d=j().ae({environment:a,inMemoryRecordCache:r??a.defaultRecordCache.inMemoryRecordCache,table:g().cv,transaction:s,value:{action_ids:t,alive:!0,id:u,parent_id:l.id,parent_table:l.table,properties:{name:i},space_id:l.spaceId,status:"active",trigger:c}});return n()(d.isTriggerType(c.type),"Trigger type mismatch"),d}function D(e){const{actionId:t,environment:o,intl:i,automationStore:r,actionType:s,transaction:c,insertionPoint:u,config:d,createDuplicateBlocksContainer:p=!0,builderType:y="sidebar"}=e,v=r.getSpaceId();if(!v)return;let b;if("duplicate_blocks"===s&&p){b=j().j4({environment:o,inMemoryRecordCache:r.inMemoryRecordCache,transaction:c,type:"text"});const e=Y({environment:o,contentStore:b.getContentStore(),transaction:c});a().default.afterNextFlush((()=>{const t=B().C.find((t=>m().dr.isEqual(t.props.store.pointer,e.pointer)));t&&T().setSelectionAtStart({store:t.props.store.getBlockTitleStore()})}))}const C=d??function(e){const{actionType:t,automationStore:o,intl:n}=e;if("modal_confirmation"===t)return{continue_button:{text:n.formatMessage(E.defaultContinueWorkflowMessage)},cancel_button:{text:n.formatMessage(E.defaultStopWorkflowMessage)},text:{type:"simple",value:(0,f().TPx)(n.formatMessage(E.defaultConfirmationWorkflowText))}};if("define_variables"===t){const e=(0,x().ZP)();return{values:{[e]:{name:(0,K().h)(o.getActionStores(),n.formatMessage(h().eC)),value:{type:"simple",value:[[""]]}}},variableIds:[e]}}}({actionType:s,automationStore:r,intl:i})??{},M=j().ae({environment:o,inMemoryRecordCache:r.inMemoryRecordCache,table:h().Xj,transaction:c,value:{id:t,type:s,parent_id:r.id,parent_table:g().cv,alive:!0,space_id:v,config:C,blocks:b?[b.id]:[]}});return b&&k().R3({transaction:c,parentStore:M.getKeyStore("blocks"),appendStore:b}),!u||"afterActionId"in u?k().R3({transaction:c,parentStore:r.getActionIdsStore(),appendStore:M,after:null==u?void 0:u.afterActionId}):"beforeActionId"in u?k().Ce({transaction:c,parentStore:r.getActionIdsStore(),prependStore:M,before:u.beforeActionId}):(0,S().t1)(u),z({transaction:c,automationStore:r}),(0,F().GV)(((e,t,n)=>{const i=(0,_().mc)(o),a=(0,F().TI)({automationActionStore:M,formulaAnalyticsModule:t,formulasModule:e,simpleFormulasModule:n});(0,S().$K)(a)&&(0,l().A2)(i,{automation_action:a,automation_action_id:M.id,automation_id:M.getParentId(),builder_type:y}),M.isDefined()&&(0,l().eI)(i,{automation_action_id:M.id,automation_action_type:M.getType(),automation_id:r.id,builder_type:y})})),n()(M.isType(s),"Action type mismatch"),M}function L(e){var t,o;const{automationStore:n,transaction:a}=e,r=n.getRecurrence();if(!r)return;const l=i().ou.now().plus({day:1}).startOf("day"),s={...r,start_date:l.toMillis(),end_condition:"date"===(null===(t=r.end_condition)||void 0===t?void 0:t.type)?{type:"date",end_at:(0,c().getNewEndTimestamp)(l,r.start_date,null===(o=r.end_condition)||void 0===o?void 0:o.end_at).toMillis()}:r.end_condition};j().sW({store:n,transaction:a,data:{status:"active"}}),j().sW({store:n.getKeyStore("trigger"),transaction:a,data:{recurrence:(0,c().convertFromUnpersistedRecurrenceConfig)(s)}})}function O(e){const{actorPointer:t,environment:o,includeParenting:n,sourceAutomationStore:i,targetAutomationId:a,transaction:r}=e,l=i.getParentStore();if(!l||!l.isReady())throw new Error("Automation parent store not ready");const s=i.getValue(),c=i.getSpaceId();if(!(0,S().$K)(s)||!(0,S().$K)(c))throw new Error("Undefined automation value or space id");const d={},p={...(0,v().Xh)(s),id:a??(0,V().TS)({environment:o,table:g().cv,spaceId:(0,y().J)(c)})};d[i.id]=p.id,(0,S().$K)(p.action_ids)&&(0,S().Of)(p.action_ids)&&p.action_ids.forEach((e=>d[e]=(0,V().TS)({environment:o,table:h().Xj,spaceId:(0,y().J)(c)})));const m=e=>{let{requested:t}=e;const o=d[t.id];return(0,S().$K)(o)?{...t,id:o}:t};(0,u().J_)({actor:t,duplicateRecord:p,options:{},mapper:m,originalRecord:s});const f=j().ae({environment:o,inMemoryRecordCache:i.inMemoryRecordCache,table:g().cv,transaction:r,value:p});n&&M().jG({childStore:f,parentStore:l,transaction:r});const x=i.getActionStores(),b=Promise.all(x.map((e=>{const t=d[e.id],{automationActionStore:n,onComplete:i}=N({environment:o,includeParenting:!1,mapper:m,sourceActionStore:e,targetAutomationActionId:t,transaction:r});return M().jG({childStore:n,parentStore:f,transaction:r}),i}))),C=b.then((e=>e.flat()));return{automationStore:f,onComplete:C}}function N(e){const{environment:t,includeParenting:o,insertionPoint:n,mapper:i,sourceActionStore:a,targetAutomationActionId:r,transaction:s}=e,c=a.getParentStore();if(!c||!c.isReady())throw new Error("Automation store is not ready");const d=a.getValue(),p=a.getSpaceId();if(!(0,S().$K)(d)||!(0,S().$K)(p))throw new Error("Undefined action value or space id");const m={...(0,v().Xh)(d),id:r??(0,V().TS)({environment:t,table:h().Xj,spaceId:(0,y().J)(p)})},g=t.currentUser.id,f=a.inMemoryRecordCache.makeGetRecordRoleFn(g);(0,u().XJ)({duplicateRecord:m,getRecordRole:f,originalRecord:d,mapper:e=>(null==i?void 0:i(e))??e.requested,options:{},originOptions:{baseUrl:A().default.domainBaseUrl,publicDomainName:A().default.publicDomainName},duplicateBlocks:!1});const x=j().ae({environment:t,inMemoryRecordCache:a.inMemoryRecordCache,table:h().Xj,transaction:s,value:m});o&&(!n||"afterActionId"in n?M().jG({after:null==n?void 0:n.afterActionId,childStore:x,parentStore:c,transaction:s}):"beforeActionId"in n?M().SH({before:null==n?void 0:n.beforeActionId,childStore:x,parentStore:c,transaction:s}):(0,S().t1)(n),z({transaction:s,automationStore:c}));const b=Promise.all(a.getBlockStores().map((e=>{const[o,n]=I().duplicateBlock({addCopyName:!1,baseUrl:A().default.domainBaseUrl,deepCopyTransclusionContainers:!1,environment:t,preferDuplicateLocation:"local",publicDomainName:A().default.publicDomainName,resolveTemplateVariables:!1,stores:[e],targetSpaceId:(0,y().J)(e.pointer.spaceId),transaction:s}),i=o[0];return M().jG({childStore:i,parentStore:x,transaction:s}),n}))),C=x.getModel();return(0,S().$K)(C)&&(0,F().GV)(((e,o,n)=>{const i=(0,_().mc)(t),a=(0,F().TI)({automationActionStore:x,formulaAnalyticsModule:o,formulasModule:e,simpleFormulasModule:n});(0,S().$K)(a)&&(0,l().A2)(i,{automation_action:a,automation_action_id:C.id,automation_id:C.parent_id,from:"duplicate"}),(0,l().eI)(i,{automation_action_id:C.id,automation_action_type:C.type,automation_id:c.id,from:"duplicate"})})),{automationActionStore:x,onComplete:b}}function W(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:a,intl:r,newActionIds:l,transaction:s,from:c,movedActionId:u}=e;j().sW({store:o,transaction:s,data:{action_ids:l}}),z({automationStore:o,transaction:s});$({automationStore:o,transaction:s,typecheckResult:(0,Z().k)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:a,intl:r})}),(0,_().j)({environment:t,event:{eventName:"automation_action_move",eventProperties:{automation_id:o.id,automation_action_id:u,from:c}}})}function U(e){const{actionStore:t,automationStore:o,automationTypecheckModule:n,contextType:i,environment:a,formulasModule:r,intl:s,transaction:c}=e,u=(0,Z().k)({environment:a,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:r,intl:s});!function(e){const{automationActionStore:t,automationStore:o,environment:n,transaction:i,hasError:a=!1}=e;let r=t.getParentStore();if((0,S().$K)(o)){const e=t.getParentPointer();if(!(0,S().$K)(e))throw new Error("Automation action does not have a parent pointer");if(!m().dr.isEqual(e,o.pointer))throw new Error(`Automation action parent pointer does not match argument: ${m().dr.toKey(e)}, ${m().dr.toKey(o.pointer)}`);r=o}else if(!(0,S().$K)(r))throw new Error("Automation store is undefined");M().hr({childStore:t,parentStore:r,transaction:i});const s=t.getModel();(0,S().$K)(s)&&(0,F().GV)(((e,o,i)=>{const c=(0,_().mc)(n),u=(0,F().TI)({automationActionStore:t,formulaAnalyticsModule:o,formulasModule:e,simpleFormulasModule:i});(0,S().$K)(u)&&(0,l().OK)(c,{automation_action:u,automation_action_id:s.id,automation_id:s.parent_id,has_error:a}),(0,l().co)(c,{automation_action_id:s.id,automation_action_type:s.type,automation_id:r.id,has_error:a})}))}({automationActionStore:t,environment:a,transaction:c,hasError:(b().x.isSuccess(u)&&u.value.actionValidationFailures[t.id]||[]).length>0}),$({automationStore:o,transaction:c,typecheckResult:u})}function G(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:a,intl:r,transaction:l}=e;$({automationStore:o,transaction:l,typecheckResult:(0,Z().k)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:a,intl:r})})}function z(e){const{automationStore:t,transaction:o}=e;t.getSpaceId()&&t.getActionStores().forEach(((e,t)=>{var n;if(!e.isDefined())return;const i=e.getModel();i.isType("open_page")&&"url"===(null===(n=i.getConfig())||void 0===n||null===(n=n.target)||void 0===n?void 0:n.type)&&!(0,r().GQ)(t)&&j().sW({store:e.getConfigStore(),transaction:o,data:{target:null}})}))}function $(e){const{automationStore:t,transaction:o,typecheckResult:n}=e,i=t.getSpaceId(),a=t.getModel();if(i&&a&&!b().x.isFail(n))for(const r of a.getActionIds()){const e=t.getRecordStore(t,{table:h().Xj,id:r,spaceId:i});if(!e.isDefined())continue;const a=e.getModel(),l=new Set(n.value.actionInputValueTypes[r].map((e=>{if(e.kind===d().FormulaContextValueKind.Binding||e.kind===d().FormulaContextValueKind.ContextValue)return e.id;e.kind!==d().FormulaContextValueKind.ThisRow&&(0,S().t1)(e)})).filter(S().$K)),{value:c}=(0,s().e)({automationActionModel:a,baseUrl:A().default.domainBaseUrl,preventClearingConfig:!0,publicDomainName:A().default.publicDomainName,sourceSpaceId:i,visitors:{visitCollectionProperty:void 0,visitCollectionPropertyPointer:void 0,visitFormulaContextValue:e=>l.has(e)?{type:"keep"}:{type:"replace",value:void 0},visitFormulaPageProperty:void 0,visitRecordPointer:void 0}}),u=p().op.update({pointer:e.pointer,path:["config"],args:c.getConfig()??{}});w().applyOperation({store:e,operation:u,transaction:o})}}function Y(e){const{environment:t,contentStore:o,transaction:n}=e,i=j().j4({environment:t,type:"text",inMemoryRecordCache:o.inMemoryRecordCache,transaction:n,spaceId:o.pointer.spaceId});return k().R3({parentStore:o,appendStore:i,transaction:n}).childStore}function q(e){const{automationStore:t,environment:o,transaction:n}=e;j().sW({store:t,data:{status:"active"},transaction:n});const i=t.getModel();(0,S().$K)(i)&&(0,F().GV)(((e,n,a)=>{const r=(0,R().Ep)(t);let s=[];r&&b().x.isSuccess(r)&&(s=r.value.valueTypes);const c=(0,_().mc)(o),u=(0,l().TY)({automationModel:i,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:s,getRecordModel:t.getRecordModel,featureGates:(0,P().W)(),simpleFormulasModule:a});(0,l().Rt)(c,u)}))}function J(e){const{automationStore:t,environment:o,status:n,transaction:i}=e,a=n??"disabled";j().sW({store:t,data:{status:a},transaction:i}),t.isTriggerType("recurrence")&&j().sW({store:t,data:{run_at:void 0},transaction:i});const r=t.getModel();(0,S().$K)(r)&&(0,F().GV)(((e,n,i)=>{const a=(0,R().Ep)(t);let s=[];a&&b().x.isSuccess(a)&&(s=a.value.valueTypes);const c=(0,_().mc)(o),u=(0,l().TY)({automationModel:r,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:s,getRecordModel:t.getRecordModel,featureGates:(0,P().W)(),simpleFormulasModule:i});(0,l().ai)(c,u)}))}function X(e){const{automationStore:t,environment:o,transaction:n}=e;j().sW({store:t,data:{alive:!1},transaction:n});const i=t.getModel();(0,S().$K)(i)&&(0,F().GV)(((e,n,a)=>{const r=(0,R().Ep)(t);let s=[];r&&b().x.isSuccess(r)&&(s=r.value.valueTypes);const c=(0,_().mc)(o),u=(0,l().TY)({automationModel:i,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:s,getRecordModel:t.getRecordModel,featureGates:(0,P().W)(),simpleFormulasModule:a});(0,l().uO)(c,u),i.isNotificationType()&&C().xi(o,{type:"granular",source:"collection_view_settings",collection_id:i.parent_id})}))}},658328:(e,t,o)=>{o.r(t),o.d(t,{AutomationWorkflowEditor:()=>Xi,AutomationWorkflowEditorActionSection:()=>Gi,ButtonBlockUrlPreviewPopup:()=>sa,PlacedButtonBlockEditor:()=>ea,automationActions:()=>i(),automationErrorHelpers:()=>ae(),automationExecutionActions:()=>n});var n={};o.r(n),o.d(n,{executeClientAutomation:()=>ie});var i=()=>o(49396),a=(o(670560),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(916054),o(653476),o(241792),()=>o(440692)),r=()=>o(513670),l=()=>o(855741),s=()=>o(696459),c=()=>o(360517),u=()=>o(870691),d=()=>o(227666);const p=(0,c().Fd)((async function(e){const{context:t,executeAutomationActionFn:o}=e,{actionModels:n,automationModel:i,contextType:a,runtimeStats:p}=t;let g=t.values;const h=performance.now();let y,f={value:{success:!0}};if("button_block"===a||"button_property"===a){if(!i.isButtonType())return{error:new(c()._z)({message:`Automation trigger (${i.getTriggerType()}) does not match context type (${a}).`})};const e=i.getTrigger();y=(0,d().o)(i.getTriggerType()).execute(t,e)}else if("event"===a){if(!i.isEventType()&&!i.isNotificationType())return{error:new(c()._z)({message:`Automation trigger (${i.getTriggerType()}) does not match context type (${a}).`})};const e=i.getTrigger();y=(0,d().o)(i.getTriggerType()).execute(t,e)}else if("recurrence"===a){if(!i.isRecurrenceType())return{error:new(c()._z)({message:`Automation trigger (${i.getTriggerType()}) does not match context type (${a}).`})};const e=i.getTrigger();y=(0,d().o)(i.getTriggerType()).execute(t,e)}else(0,s().t1)(t);if(l().x.isFail(y))return y;g=g.concat((0,r().d9)(y.value.values));const v=o??m;for(const r of n){var x;const e=await v({action:r,values:g,executionContext:t}),o=null==p||null===(x=p.actionStats)||void 0===x||null===(x=x[r.id])||void 0===x?void 0:x.executionDurationMs;if((0,s().$K)(o)&&o>7e3&&t.executeEffectMap.logMessage({from:"executeAutomation",level:"warning",type:"longRunningAutomationAction",data:{durationMs:o,automationId:i.id,actionId:r.id,actionType:r.getType()}}),l().x.isFail(e)){f=e;break}if(g=g.concat(e.value.values),e.value.stopExecution)break}const b=await t.executeEffectMap.updateLastRunTimesForObservability({automationModel:t.automationModel,executeResult:f});l().x.isFail(b)&&(f=b);const S=Math.trunc(performance.now()-h);p&&(p.executionStartTime=h,p.executionDurationMs=S,p.executionSuccess=l().x.isSuccess(f),u().Fv.aggregate(p));return f}),(e=>e.context.automationModel.id));async function m(e){const{action:t,values:o,executionContext:n}=e,i=(0,a().getActionRegistryItem)(t.getType());return i.requiresPriorTransactionsCommitted&&await n.executeEffectMap.waitForTransactionsCommitted(),await i.execute({...n,values:o},t)}var g=()=>o(92960),h=()=>o(955620),y=()=>o(473304);var f=()=>o(520509),v=()=>o(799891),x=()=>o(998411),b=()=>o(422894),S=()=>o(989478),C=()=>o(342792),k=()=>o(207874),M=()=>o(102182),j=()=>o(205228),T=()=>o(718048),w=()=>o(141735),A=()=>o(594546),I=()=>o(615676),_=()=>o(527278),P=()=>o(749826),V=()=>o(697623),B=()=>o(620218);const R={...u().Fv,logNotionPerformance(e){const{automationStats:t,environment:o}=e;if((0,u().uz)(t)){var n;const e={metricName:"automation.client.execution_duration_ms",startTime:t.executionStartTime,endTime:t.executionStartTime+t.executionDurationMs};B().default.DO_NOT_USE_measureLegacy(e,{environment:o,data:{success:t.executionSuccess,has_formulas:((null===(n=t.formulaStats)||void 0===n?void 0:n.totalFormulas)??0)>0}})}for(const a of Object.values(t.actionStats))if((0,u().Ov)(a)){var i;const e={metricName:"automation.client.action_execution_duration_ms",startTime:a.executionStartTime,endTime:a.executionStartTime+a.executionDurationMs};B().default.DO_NOT_USE_measureLegacy(e,{data:{automation_action_type:a.actionType,success:a.executionSuccess,has_formulas:((null===(i=a.formulaStats)||void 0===i?void 0:i.totalFormulas)??0)>0},environment:o})}}};var F=()=>o(926724),K=()=>o(788860);const Z=(0,K().vU)({genericSuccessMessage:{id:"automations.buttonTrigger.genericSuccessMessage",defaultMessage:"Button automation ran successfully"},createdBlocks:{defaultMessage:"Created {numBlocksDuplicated, plural, one {1 block} other {{numBlocksDuplicated} blocks}} on page",id:"automations.buttonTrigger.createdBlocks"},createdSprintsUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.createdSprints"},updatedSprintsUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.updatedSprints"},createdSprintsLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.createdSprintsLowercase"},updatedSprintsLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.updatedSprintsLowercase"},createdTasksUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.createdTasks"},updatedTasksUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.updatedTasks"},createdTasksLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.createdTasksLowercase"},updatedTasksLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.updatedTasksLowercase"},createdProjectsUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.createdProjects"},updatedProjectsUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.updatedProjects"},createdProjectsLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.createdProjectsLowercase"},updatedProjectsLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.updatedProjectsLowercase"},createdPagesUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.createdPages"},updatedPagesUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.updatedPages"},createdPagesLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.createdPagesLowercase"},updatedPagesLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.updatedPagesLowercase"}}),E=["sprint","task","project","page"],H={[F().wW]:"project",[F().Ym]:"task",[F().zU]:"page",[F().Fi]:"page",[F().p$]:"sprint",[F().GZ]:"page",[F().nG]:"page",[F().Be]:"page",[F().u2]:"page"};function D(e){const{typedAutomationExecutionSummary:t,numBlocksDuplicated:o,intl:n}=e,i=function(e){const{typedAutomationExecutionSummary:t,intl:o}=e,n=[];for(const a of E){const e=t[a];if(e){const{numPagesCreated:t,numPagesEdited:o}=e;t>0&&n.push({pageType:a,modificationType:"created",numPagesModified:t}),o>0&&n.push({pageType:a,modificationType:"updated",numPagesModified:o})}}const i=n.slice(0,L).map(((e,t)=>{let{pageType:n,modificationType:i,numPagesModified:a}=e;const r=O[n][i],l=0===t?r.start:r.append;return o.formatMessage(l,{numPagesModified:a})}));if(i.length>0)return o.formatList(i,{type:"conjunction",style:"long"})}({typedAutomationExecutionSummary:t,intl:n});return i||(o>0?n.formatMessage(Z.createdBlocks,{numBlocksDuplicated:o}):n.formatMessage(Z.genericSuccessMessage))}const L=3;const O={sprint:{created:{start:Z.createdSprintsUppercase,append:Z.createdSprintsLowercase},updated:{start:Z.updatedSprintsUppercase,append:Z.updatedSprintsLowercase}},task:{created:{start:Z.createdTasksUppercase,append:Z.createdTasksLowercase},updated:{start:Z.updatedTasksUppercase,append:Z.updatedTasksLowercase}},project:{created:{start:Z.createdProjectsUppercase,append:Z.createdProjectsLowercase},updated:{start:Z.updatedProjectsUppercase,append:Z.updatedProjectsLowercase}},page:{created:{start:Z.createdPagesUppercase,append:Z.createdPagesLowercase},updated:{start:Z.updatedPagesUppercase,append:Z.updatedPagesLowercase}}};var N=()=>o(396136),W=()=>o(826955);o(492176),o(7961);var U=()=>o(492788),G=()=>o(506347),z=()=>o(481529),$=()=>o(839002),Y=()=>o(824462),q=()=>o(636340),J=()=>o(497065),X=()=>o(879952),Q=()=>o(269299),ee=()=>o(429725),te=()=>o(876822),oe=()=>o(407121);class ne{constructor(e){this.environment=void 0,this.clientContext=void 0,this.automationModel=void 0,this.numBlocksDuplicated=0,this.transactionServerCommitResults=[],this.saveTransactionInfos=[],this.undoCheckpointName=void 0,this.waitForTransactionsCommitted=async()=>{await Promise.all(this.transactionServerCommitResults),this.transactionServerCommitResults=[]},this.getCollectionSchema=async e=>{const t=await this.clientContext.parentRecordStore.loadRecordModel(e.pointer);return t?{value:{collectionSchema:t.getNormalizedSchema()}}:{error:new(c().Do)({actionId:e.actionId,pointer:e.pointer})}},this.logMessage=e=>{v().log(e)},this.queryCollection=async e=>{const t=await o(96724).tA(this.environment,{source:"automation",parentRecordStore:this.clientContext.parentRecordStore,collectionPointer:e.collection,filter:e.filter,sort:e.sort,limit:e.limit});return l().x.isFail(t)?{error:new(c().Pn)({actionId:e.actionId,type:t.error.type,message:t.error.message,cause:t.error})}:{value:{blockIds:t.value.blockIds}}},this.saveTransaction=e=>{const{info:t,operations:n}=e,i=[];if(this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.saveTransaction",environment:this.environment,perform:e=>{for(const t of n)if((0,o(386616).Qf)(t)){const o=W().G.createChildStore(this.clientContext.parentRecordStore,t.pointer);Q().applyCrdtTextOperation({store:o,operation:t,invertedOperation:void 0,transaction:e})}else if((0,z().V_)(t)||(0,z().SH)(t)){const o=(0,W().Kv)(this.clientContext.parentRecordStore,t.pointer);Q().applyOperation({store:o,operation:t,transaction:e})}else(0,s().t1)(t);i.push(e.id)}}),this.saveTransactionInfos.push(t),"create_page"===t.type)o(54512).W(this.environment,{type:"page",automation_id:this.automationModel.id,from:"button_automation",new_page_id:t.pageId,creating_block_id:t.pageId});else if("update_pages"===t.type){const{editedProperties:e,pageIds:n}=t;for(const t of n)for(const{id:n,type:i}of e)o(491927).rv(this.environment,{block_id:t,property:n,property_type:i,from:"button_automation",automation_id:this.automationModel.id},!1)}else"publish_site"===t.type||(0,s().t1)(t);return Promise.resolve({value:{stats:{totalOperations:n.length,transactionIds:i}}})},this.navigateToPage=e=>{const t=te().default.state.mainEditorCurrentBlockStore;if(!t)return;const n=W().G.createChildStore(t,e.page),i="full_page"===e.openIn?(0,ee().ZP)({store:n,fullyQualified:!1,pageVisitSource:G().tY.ButtonAutomation}):(0,ee().ZP)({store:t,peekViewBlockId:n.id,peekMode:(0,o(482162).getUrlParamFromPeekMode)(e.openIn),fullyQualified:!1,pageVisitSource:G().tY.ButtonAutomation});J().c4({environment:this.environment,url:i})},this.openUrl=e=>{J().c4({environment:this.environment,url:e.url,openInNew:"tab"})},this.sendSlackNotification=async e=>{const{action:t}=e;return(0,A().j)({environment:this.environment,event:{eventName:"button_automation_slack_action",eventProperties:{type:this.clientContext.type}}}),this.executeServerSideEffect({effect:"send_slack_notification",actionPointer:t.pointer,contextType:this.clientContext.type})},this.duplicateBlockChildren=async e=>{if("button_block"!==this.clientContext.type)return{error:new(c().iR)({contextType:this.clientContext.type})};const t=this.clientContext.blockStore,n=t.getRecordStoreUIParent();if(!n)return{value:{}};const i={};let a,r=t;if("before"===e.insertionPoint)a=!0;else if("after"===e.insertionPoint)a=!1;else if("topOfPage"===e.insertionPoint){let e;if(a=!0,this.clientContext.pageStore?e=this.clientContext.pageStore:n&&n.isTable(N().iU)&&n.getAncestorRecordStoreAtRootPath()&&(e=n.getAncestorRecordStoreAtRootPath()),!e)return{error:new(c().fH)("invalid_record","Missing page store in client context for top of page insertion")};r=e.getContentStores().at(0)||t}else if("bottomOfPage"===e.insertionPoint){let e;if(a=!1,this.clientContext.pageStore?e=this.clientContext.pageStore:n&&n.isTable(N().iU)&&n.getAncestorRecordStoreAtRootPath()&&(e=n.getAncestorRecordStoreAtRootPath()),!e)return{error:new(c().fH)("invalid_record","Missing page store in client context for bottom of page insertion")};r=e.getContentStores().at(-1)||t}else(0,s().t1)(e.insertionPoint);const l=W().G.createChildStore(n,e.blockPointer);await l.load();const u=l.getContentStores();a||u.reverse();const d=o(32969).C.findSelectableFromStore(r),p=[],m=this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.duplicateBlockChildren",environment:this.environment,perform:e=>{const t=u.map((t=>{const[n,i]=o(872308).duplicateBlock({environment:this.environment,stores:[t],transaction:e,addCopyName:!1,deepCopyTransclusionContainers:!1,resolveTemplateVariables:!0,targetSpaceId:(0,o(81954).J)(t.pointer.spaceId),baseUrl:j().default.domainBaseUrl,publicDomainName:j().default.publicDomainName,preferDuplicateLocation:"local",analyticsFrom:"button_automation"}),r=n[0];return d&&(a?d.props.onInsertAbove&&p.push(d.props.onInsertAbove({insertStores:[r],transaction:e})[0]):d.props.onInsertBelow&&p.push(d.props.onInsertBelow({insertStores:[r],transaction:e})[0])),{copy:r,onComplete:i}}));return R.aggregateActionStats(i,{transactionIds:[e.id]}),t}}).performResult;return a||p.reverse(),X().Z5({environment:this.environment,stores:p}),await $().qd(m,10,(e=>e.onComplete)),U().default.afterNextFlush((()=>{for(const e of p){if(o(576828).dM({environment:this.environment,isAtStartOfLine:!1,store:e}))break}})),this.numBlocksDuplicated+=p.length,R.aggregateActionStats(i,{blocksCreated:this.getNumBlocksDuplicated()}),{value:{stats:i}}},this.displayModal=async e=>{oe().Z.setState({open:!0,format:e.format,recordStore:this.clientContext.parentRecordStore}),await oe().Z.waitUntil((()=>!oe().Z.state.open));const t=oe().Z.state;let o;return t.open||(o=t.result),o=o??"continue",{value:{result:o}}},this.initializeTemplateInDatabase=async e=>{const t=this.clientContext.parentRecordStore,n={},i=W().G.createChildStore(t,{table:N().iU,id:e.templateId});await i.load();const a=W().NW.createChildStore(t,e.collection),r=(0,o(487270).TS)({environment:this.environment,table:N().iU,spaceId:a.pointer.spaceId}),{performResult:l}=this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.initializeTemplateInDatabase",environment:this.environment,perform:l=>{const s=q().j4({environment:this.environment,transaction:l,inMemoryRecordCache:t.inMemoryRecordCache,type:o(156642).Ti.page,id:r});return o(332542).zw({parentStore:a,childStore:s,transaction:l}),o(295274).ob({environment:this.environment,store:s,transaction:l,templateStore:i,title:"template",isCreateIn:!1,isKeyboard:!1,from:"automation_actions"}),o(576808).b({environment:this.environment,store:s,properties:e.propertyUpdates,transaction:l}),R.aggregateActionStats(n,{transactionIds:[l.id]}),s}});return this.saveTransactionInfos.push({type:"create_page",pageId:r,collection:e.collection}),await l.load(),l.isDefined()?{value:{pageId:r,pageModel:l.getModel(),stats:n}}:{error:new(c().Do)({actionId:e.actionId,pointer:l.pointer})}},this.sendInAppNotification=async e=>{const{actionPointer:t,targets:o,message:n,pagePointer:i}=e;return this.executeServerSideEffect({effect:"send_in_app_notification",actionPointer:t,contextType:this.clientContext.type,args:{targets:o,message:n,pagePointer:i}})},this.sendGmailNotification=async e=>{var t;const{action:o,to:n,cc:i,bcc:a,replyTo:r,fromName:l,subject:s,body:c}=e,u="button_block"===this.clientContext.type||"button_property"===this.clientContext.type?null===(t=this.clientContext.pageStore)||void 0===t?void 0:t.pointer:void 0;return this.executeServerSideEffect({effect:"send_gmail_notification",actionPointer:o.pointer,contextType:this.clientContext.type,args:{bcc:a,body:c,cc:i,fromName:l,pagePointer:u,replyTo:r,subject:s,to:n}})},this.updateLastRunTimesForObservability=async e=>{const{automationModel:t,executeResult:o}=e,n=this.clientContext.parentRecordStore,i=W().Mz.createChildStore(n,t.pointer);return this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.updateLastRunTimesForObservability",environment:this.environment,skipUpdatingEditedMetadata:!0,perform:e=>{const t=Date.now();q().sW({data:{last_executed_time:t},store:i,transaction:e}),l().x.isFail(o)&&q().sW({data:{last_failed_time:t},store:i,transaction:e})}}),Promise.resolve({value:void 0})},this.sendHttpRequest=async e=>{const{action:t,pagePointer:o,eventId:n}=e;return this.executeServerSideEffect({effect:"send_http_request",actionPointer:t.pointer,contextType:this.clientContext.type,args:{pagePointer:o,eventId:n}})},this.executeServerSideEffect=async e=>{const t=await Y().callApi({eventName:"executeAutomationActionEffect",environment:this.environment,headers:{},data:e});return"failed"===t.type?{error:new(c().Nz)({actionId:e.actionPointer.id,message:"Failure in execution of the executeAutomationActionEffect endpoint",cause:t.error})}:t.data},this.environment=e.environment,this.clientContext=e.clientContext,this.automationModel=e.automationModel,this.undoCheckpointName=`execute-client-automation-${o(956057).Il()}`}getNumBlocksDuplicated(){return this.numBlocksDuplicated}createAndCommitForEffect(e){const t=Q().createAndCommit({...e,undoCheckpoint:this.undoCheckpointName,canUndo:!0});return this.transactionServerCommitResults.push(t.serverCommitResult),t}}async function ie(e){var t,o;const{clientContext:n,environment:r,onUndo:c}=e,u=await w().F.formulas.load(),d=await w().F.simpleFormulas.load();await n.automationStore.load();const m=n.automationStore.getModel();if(!m||!m.isButtonType()&&!m.isRecurrenceType())return;const j=m.spaceId,B=n.automationStore.getActionStores().map((e=>e.getModel())).filter(s().$K),F=m.getTriggerType(),K="button_block"===n.type?n.blockStore.id:"button_property"===n.type?null===(t=n.pageStore)||void 0===t?void 0:t.id:"recurrence"===n.type?void 0:(0,s().t1)(n),Z=(0,V().zt)();(0,A().j)({environment:r,event:{eventName:"automation_triggered",eventProperties:{actions:B.map((e=>e.getType())),automation_id:m.id,block_id:K,context_type:n.type,space_id:j,subscription_tier:Z,trigger:F}}});const E=new ne({automationModel:m,clientContext:n,environment:r}),L=(0,f().yf)({collectionFeatureGates:(0,I().W)(),experimentService:P().default,getRecordModel:n.parentRecordStore.getRecordModel,loadRecordModel:n.parentRecordStore.loadRecordModel}),O=P().default.getConfigKey("automation_settings","client_formula_timeout_ms"),U=r.currentUser.id?{id:r.currentUser.id,table:S().KJ}:void 0,G="recurrence"!==n.type?null===(o=n.pageStore)||void 0===o?void 0:o.getModel():void 0,z=[];if("recurrence"===n.type&&"completeSprint"===n.recurrence.type){const{values:e}=function(e){const{nextSprintDateRange:t,completeSprintActionType:o}=e;return{values:[{kind:g().FormulaContextValueKind.ContextValue,id:y().Pv,value:{type:"date",value:t}},{kind:g().FormulaContextValueKind.ContextValue,id:y().JL,value:{type:"text",value:(0,h().TPx)(o)}}]}}({completeSprintActionType:n.recurrence.completeSprintActionType,nextSprintDateRange:n.recurrence.nextSprintDateRange});z.push(...e)}const $=R.create(m.pointer,"client"),Y={author:U,automationModel:m,actionModels:B,contextType:n.type,formulaVariableResolution:{executingUserPointer:U,executingUserTimeZone:(0,x().r)(),thisPageBlockModel:G},values:z,executeEffectMap:E,executeContextualFormula:async(e,t)=>{if(!t)return{value:{type:"undefined"}};const o=Date.now()+O;return await u.executeFormulaAsync(t,{...e,depth:0,throwOnDownstreamParseFailures:!0,handleDataRequest:L,intl:n.intl,resultCache:new Map,regExpCache:new Map,userTimeZone:(0,x().r)(),visitedProperties:new Set,formulaTimeoutTimestampMs:o,experimentService:P().default,spaceId:j})},formulasModule:u,handleDataRequest:L,loadRecordModel:n.parentRecordStore.loadRecordModel,makeGetRecordModelFn:async e=>Promise.resolve(n.parentRecordStore.getRecordModel),userTimeZone:(0,x().r)(),intl:n.intl,depth:0,throwOnDownstreamParseFailures:!0,visitedProperties:new Set,resultCache:new Map,regExpCache:new Map,eventTracker:(0,A().mc)(r),runtimeRecordPointerSet:new(b().X),runtimeStats:$,spaceIdCreator:await r.idCreator.getSpaceIdCreator(j),simpleFormulasModule:d,useCrdtDefault:(0,T().WA)(n.automationStore.getSpaceStore()),experimentService:P().default,collectionFeatureGates:(0,I().W)(),spaceId:j,eventId:(0,C().ZP)()},q=await p({context:Y});R.logNotionPerformance({automationStats:$,environment:r});const J={automationContextType:n.type,automationId:m.id,automationRuntime:$,spaceId:j,userId:null==U?void 0:U.id};if(l().x.isFail(q)){const{error:e}=q;0,v().log({actor:U,data:J,error:e,from:"automationActions",level:"error",type:"AutomationExecutionError"}),(0,A().j)({environment:r,event:{eventName:"automation_execution_fail",eventProperties:{automation_id:m.id,block_id:K,context_type:n.type,error_type:e.type,execution_duration_ms:$.executionDurationMs,subscription_tier:Z,trigger:F}}});const t=function(e){if("query_collection_too_many_items"===e.type)return i().messages.errorQueryCollectionTooManyPages;if("record_pointer_in_trash"===e.type)return i().messages.errorRecordInTrash;return i().messages.genericErrorMessage}(e),o=_().Z.formatMessage(t);M().oV({label:o})}else(0,A().j)({environment:r,event:{eventName:"automation_execution_success",eventProperties:{automation_id:m.id,block_id:K,context_type:n.type,execution_duration_ms:$.executionDurationMs,subscription_tier:Z,trigger:F}}}),v().log({actor:U,data:J,from:"automationActions",level:"info",type:"AutomationExecutionSuccess"}),function(e){return!e.every((e=>!(0,a().getActionRegistryItem)(e.type).hasSideEffects))}(B)&&await async function(e){const{actionModels:t,environment:o,saveTransactionInfos:n,clientContext:i,undoCheckpointName:r,numBlocksDuplicated:l,onUndo:c}=e,u=function(e){const{saveTransactionInfos:t,parentRecordStore:o}=e,n={},i=new Set;for(const u of t)if("create_page"===u.type){var a,r;if(i.has(u.pageId))continue;const e=W().NW.createChildStore(o,u.collection).getDatabaseType(),t=(e&&H[e])??"page",l=(null===(a=n[t])||void 0===a?void 0:a.numPagesEdited)??0,s=(null===(r=n[t])||void 0===r?void 0:r.numPagesCreated)??0;n[t]={numPagesCreated:s+1,numPagesEdited:l},i.add(u.pageId)}else if("update_pages"===u.type){var l,c;const e=W().NW.createChildStore(o,u.collection).getDatabaseType(),t=(e&&H[e])??"page",i=(null===(l=n[t])||void 0===l?void 0:l.numPagesEdited)??0,a=(null===(c=n[t])||void 0===c?void 0:c.numPagesCreated)??0;n[t]={numPagesCreated:a,numPagesEdited:i+u.pageIds.length}}else"publish_site"===u.type?n.page={numPagesCreated:0,numPagesEdited:1}:(0,s().t1)(u);return n}({saveTransactionInfos:n,parentRecordStore:i.parentRecordStore}),d=D({typedAutomationExecutionSummary:u,numBlocksDuplicated:l,intl:i.intl}),p=await async function(e){const{saveTransactionInfos:t,clientContext:o}=e;let n;for(const r of t.slice().reverse()){if("create_page"===r.type){var i;n=W().G.createChildStore(o.parentRecordStore,{table:N().iU,id:r.pageId,spaceId:null===(i=r.collection)||void 0===i?void 0:i.spaceId});break}if("update_pages"===r.type){if(1===r.pageIds.length){var a;n=W().G.createChildStore(o.parentRecordStore,{table:N().iU,id:r.pageIds[0],spaceId:null===(a=r.collection)||void 0===a?void 0:a.spaceId})}else{const e=W().NW.createChildStore(o.parentRecordStore,r.collection);await e.load();const t=e.getParentBlockStore();if(!t)continue;n=t}break}if("publish_site"===r.type)break;(0,s().t1)(r)}return n}({saveTransactionInfos:n,clientContext:i}),m=function(e){let t;for(const o of e){const e=(0,a().getActionRegistryItem)(o.type);if(!1===e.invertible)return!1;!0===e.invertible&&(t=!0)}return t}(t),g=!0===m&&k().hv(r)?()=>{k().qB({environment:o,namedRevisionId:r}),M().rN(),c&&c(r)}:void 0;M().d8({blockToOpenStore:p,item:{label:d},performUndo:g})}({actionModels:B,clientContext:n,environment:r,numBlocksDuplicated:E.getNumBlocksDuplicated(),onUndo:c,saveTransactionInfos:E.saveTransactionInfos,undoCheckpointName:E.undoCheckpointName})}var ae=()=>o(960597),re=o(667294),le=()=>o(219727),se=()=>o(142735),ce=()=>o(846550),ue=()=>o(707513),de=()=>o(990966),pe=()=>o(58836),me=()=>o(291198),ge=()=>o(967092),he=()=>o(906651),ye=()=>o(842574),fe=()=>o(949842),ve=()=>o(407544),xe=()=>o(520849),be=()=>o(965014),Se=()=>o(637118),Ce=()=>o(486896),ke=()=>o(200027),Me=()=>o(492135),je=()=>o(676279),Te=()=>o(269853),we=()=>o(359620),Ae=()=>o(545444),Ie=()=>o(969269),_e=()=>o(762478),Pe=()=>o(1910),Ve=()=>o(943620),Be=()=>o(654133),Re=()=>o(150569),Fe=()=>o(164079),Ke=o(785893);const Ze=(0,K().vU)({icon:{defaultMessage:"Icon",id:"buttonBlock.button.iconHeading"},addIconButtonAriaLabel:{defaultMessage:"Add icon",id:"buttonBlock.button.addIconButtonAriaLabel"}});function Ee(e){const{disabled:t,currentIcon:o,handleIconChange:n,store:i}=e,a=(0,le().O7)(),r=(0,K().YB)(),l=(0,re.useCallback)((e=>{_e().$(a,{originRect:e.currentTarget.getBoundingClientRect(),originGap:4,popupWidth:Re().FZ,popupHeight:Re().kX,isSmallWidth:!1,title:r.formatMessage(Ze.icon),currentTab:"icon",tabs:[{type:"icon",onChange:e=>{n(e),_e().Z()}},{type:"emoji",onChange:(e,t)=>{n(e),_e().Z()}}],onDelete:o?()=>{n(void 0),_e().Z()}:void 0})}),[a,n,r,o]),s=(0,ce().yK)((e=>({iconButton:{background:"transparent",boxShadow:e.shadowXS,width:28,height:28},icon:{width:16,height:16}})),[]),c=e=>(0,Ke.jsx)(Pe().Z,{ariaLabel:r.formatMessage(Ze.addIconButtonAriaLabel),style:s.iconButton,iconStyle:s.icon,hasBackground:!0,disabled:t,showShadow:!0,icon:e=>o?(0,Ke.jsx)(Ve().Z,{disabled:!0,isEmptyPage:!1,size:24,icon:{icon:o,pointer:i.pointer},style:e}):(0,Ie().o)(e),...(0,Fe().Z)(e??{},{onClick:l})});return o?c():(0,Ke.jsx)(Be().Z,{renderTooltip:()=>(0,Ke.jsx)(K()._H,{defaultMessage:"Add an icon",id:"buttonBlock.button.addIcon"}),delayThreshold:300,render:c})}var He=()=>o(206352),De=()=>o(687982),Le=()=>o(127519),Oe=()=>o(195245);function Ne(e){const{value:t,onChange:o,wrapStyle:n,onBlur:i,...a}=e,[r,l]=(0,re.useState)(!1),s=(0,le().O7)(),c=(0,De().Z)(!0),u=(0,re.useCallback)((()=>{l(!1),null==i||i()}),[i]),d=(0,re.useCallback)((e=>o(e.currentTarget.value)),[o]),p=(0,re.useCallback)((()=>{"empty"!==Le().default.state.mode&&X().ZH({environment:s,preventDismissMobileKeyboard:!0}),l(!0)}),[s]);return(0,Ke.jsx)(He().Z,{debugName:"AutomationPlainTextInput",capture:r,children:(0,Ke.jsx)("div",{...c,style:n,children:(0,Ke.jsx)(me().Z,{...a,onBlur:u,onChange:d,onFocus:p,value:t})})})}function We(e){const{onChange:t,store:o,...n}=e,{maybePersistedTransactionActions:i}=(0,Oe().i)(),a=(0,se().VK)((()=>o.getValue()??""),[o]),r=(0,re.useCallback)((e=>{i.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:t=>{q().sO({store:o,transaction:t,value:e})}}),null==t||t(e)}),[i,t,o]);return(0,Ke.jsx)(Ne,{value:a,onChange:r,...n})}var Ue=()=>o(87781),Ge=()=>o(51590),ze=()=>o(842631),$e=()=>o(285755),Ye=()=>o(827973),qe=()=>o(448419),Je=()=>o(119891),Xe=()=>o(677559),Qe=()=>o(529048),et=()=>o(280977),tt=()=>o(210968),ot=()=>o(590259),nt=()=>o(360240),it=()=>o(466970),at=()=>o(309841);function rt(e){return!e.pathIsDead()&&e.isDefined()}function lt(e){if(!(0,s().$K)(e))return[];return e.getTemplatePageStores().filter((e=>rt(e)))}var st=()=>o(430311),ct=()=>o(752348),ut=()=>o(38883),dt=()=>o(384241),pt=()=>o(772265),mt=()=>o(903098),gt=()=>o(790819),ht=()=>o(311419);function yt(e){const{actionStore:t,currentValue:o,onChange:n,disabled:i,errorMessage:a,errorIcon:r,skipVariables:l}=e,c=(0,le().O7)(),{typecheckResult:u}=(0,Se().DZ)(),d=(0,it().E)("automation_updated_error_states"),p=(0,se().qz)(void 0,Qe().Z),m=t.id,g=(0,mt().z)({actionId:m}),h=(0,se().VK)((()=>o&&"collection"===o.type?W().NW.createChildStore(t,o.collection):void 0),[o,t]),y=(0,se().VK)((()=>{if(m&&u&&o&&"variable"===o.type)return(0,ct().getContextValueForActionById)(u,m,o.id)}),[o,u,m]),f=(0,re.useCallback)((e=>{"collection"!==e.type&&"variable"!==e.type||(n(e),p.reset(),(0,at().GV)(((o,n,i)=>{const a=(0,at().TI)({automationActionStore:t,formulaAnalyticsModule:n,formulasModule:o,simpleFormulasModule:i});(0,s().$K)(a)&&(0,A().j)({environment:c,event:{eventName:"automation_target_pick",eventProperties:{automation_action:a,automation_id:t.getParentId(),target_type:e.type}}})})))}),[n,p,t,c]),v=(0,re.useCallback)((()=>p.reset()),[p]),x=(0,je().d)(),b=Boolean(h||y);return(0,Ke.jsx)(qe().ZP,{buttonPopupStore:p,popupType:x,alignmentToOrigin:qe().vR.Center,placementToOrigin:qe().pO.Bottom,originGap:0,disabled:i,renderOrigin:e=>(0,Ke.jsx)(gt().S,{...e,disabled:i,isCompact:!0,isError:Boolean(a),hasActionRequired:!b,tooltipMessage:!d&&a,errorIcon:r,dropdownButtonType:"dropdown",children:h?(0,Ke.jsx)(dt().Z,{store:h}):y?(0,Ke.jsx)(pt().F,{format:ut().lo.Medium,isSingle:!0,value:y,style:{background:"transparent",color:"unset",margin:"-1.5px 0",padding:0}}):(0,Ke.jsx)(K()._H,{id:"automations.databasePicker.buttonPlaceholder",defaultMessage:"Select database"})}),render:e=>(0,Ke.jsx)(ht().L,{formulaTypecheckContextValues:g,onChange:f,onClose:v,parentRecordStore:t,selectedTarget:o,skipPages:!0,skipVariables:l})})}var ft=()=>o(953744),vt=()=>o(198829),xt=()=>o(255577),bt=()=>o(388284),St=()=>o(918745);function Ct(e){const{collectionStore:t,currentTemplateId:o,onChange:n,disabled:i,errorMessage:a}=e,r=(0,le().O7)(),{device:l}=r,s=(0,it().E)("automation_updated_error_states"),c=(0,se().VK)((()=>{if(!t)return;if(o){const e=W().G.createChildStore(t,{id:o,spaceId:t.getSpaceId(),table:N().iU});if(!e.pathIsDead())return e}const e=t.getDefaultTemplatePageStore();return e&&!e.pathIsDead()?e:void 0}),[t,o]),u=(0,je().d)(),d=(0,se().VK)((()=>lt(t)),[t]),p=Boolean(o);return(0,Ke.jsx)(qe().ZP,{popupType:u,alignmentToOrigin:qe().vR.Center,placementToOrigin:qe().pO.Bottom,originGap:0,disabled:i,renderOrigin:e=>(0,Ke.jsx)(gt().S,{...e,disabled:i,isCompact:!0,isError:Boolean(a),style:{minWidth:50},tooltipMessage:!s&&a,dropdownButtonType:"dropdown",children:c&&(p||rt(c))?(0,Ke.jsx)(dt().Z,{store:c}):(0,Ke.jsx)(K()._H,{id:"automations.templatePicker.buttonPlaceholder",defaultMessage:"Empty"})}),render:e=>{const o=(0,St().U)({device:l,width:280});return(0,Ke.jsx)(vt().Z,{...o,children:t&&(0,Ke.jsx)(kt,{collectionStore:t,templatePageStores:d,parent:e,onChange:n})})}})}function kt(e){const{collectionStore:t,templatePageStores:o,parent:n,onChange:i}=e,a=(0,le().O7)(),{device:l}=a,s=(0,se().VK)((()=>t.getDefaultTemplatePageStore()),[t]),c=o.map((e=>{const o={key:e.id,render:o=>(0,re.createElement)(ft().Z,{...o,key:e.id,isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:e,isMobile:l.isMobile,locked:!0,isDefault:s===e,onCancelClick:r().ZT,draggable:!1}),action:t=>{i(e.id),n.close()}};return o})),u={key:"empty",render:e=>(0,re.createElement)(ft().Z,{...e,key:"empty",isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:void 0,isMobile:l.isMobile,locked:!0,onCancelClick:r().ZT,draggable:!1}),action:e=>{i(void 0),n.close()}};return(0,Ke.jsx)(xt().ZP,{type:xt().iW.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,Ke.jsx)(bt().Z,{...e,title:(0,Ke.jsx)(K()._H,{id:"automations.templatePicker.menuHeader",defaultMessage:"Select template"})}),items:r().oA([...c,s?void 0:u])}]})}var Mt=()=>o(896441);function jt(e){const{actionStore:t,disabled:o,errorMessage:n,onChange:i,value:a,errorIcon:r}=e,l=(0,it().E)("automation_updated_error_states"),s=(0,se().VK)((()=>{let e;if("collection"===(null==a?void 0:a.type)){const o=t.getRecordModel(a.collection);e=null==o?void 0:o.getDatabaseType()}return(0,nt().sN)(e)}),[t,a]);return(0,Ke.jsx)(K()._H,{defaultMessage:"Add {itemType} to{collectionPicker}",id:"automations.CreatePageActionV2.header.title",values:{collectionPicker:(0,Ke.jsx)(yt,{actionStore:t,currentValue:a,disabled:o,errorMessage:n,errorIcon:l?r:void 0,onChange:i,skipVariables:!0}),itemType:s}})}function Tt(e){const{collectionStore:t,disabled:o,errorMessage:n,onChange:i,value:a}=e;return(0,Ke.jsx)(K()._H,{defaultMessage:"as{collectionTemplatePicker}",id:"automations.CreatePageActionV2.header.template",values:{collectionTemplatePicker:(0,Ke.jsx)(Ct,{collectionStore:t,currentTemplateId:a,disabled:o,errorMessage:n,onChange:i})}})}var wt=()=>o(212493),At=()=>o(922713),It=()=>o(543172),_t=()=>o(658517);function Pt(e,t){const o=e.getConfigStore().getKeyStore("values"),n=o.getValue(),i=null==n?void 0:n[t];return(0,s().$K)(i)?{valueConfig:i,valueStore:o}:{valueConfig:void 0,valueStore:void 0}}var Vt=()=>o(265640);function Bt(e){const{disabled:t,onClick:o}=e,n=(0,ce().yK)((e=>({button:{color:e.text.secondary},children:{...ue().Yu,flex:"1 1 auto"}})),[]);return(0,Ke.jsx)(Vt().D,{disabled:t,disabledFeedback:t,onClick:o,shouldShrink:!0,style:n.button,children:(0,Ke.jsx)("div",{style:n.children,children:(0,Ke.jsx)(K()._H,{defaultMessage:"Define another variableâ¦",id:"automations.DefineVariablesAction.addVariableButton.label"})})})}var Rt=()=>o(907874),Ft=()=>o(585270),Kt=()=>o(214206),Zt=()=>o(985571),Et=()=>o(411766),Ht=()=>o(619857),Dt=()=>o(998901),Lt=()=>o(732811),Ot=()=>o(834458),Nt=()=>o(193962),Wt=()=>o(44037),Ut=()=>o(519454),Gt=()=>o(95886),zt=()=>o(2403),$t=()=>o(178498),Yt=()=>o(740046),qt=()=>o(521913);function Jt(){const e=(0,ce().yK)((e=>({warningIcon:{fill:e.icon.uiRedPrimary,height:14,width:15}})),[]);return(0,qt().t)(e.warningIcon)}function Xt(){}function Qt(e){const{analyzedFormulaOutput:t,onClearClick:o,onDeleteClick:n,onDuplicateClick:i,onEditFormulaClick:a,onEditTextClick:r,onVariableNameChange:l,onVariableNameSubmit:c,variableName:u}=e,{parseErrors:d,type:p,typeErrors:m}=t??{},g=(0,K().YB)(),h=(0,re.useMemo)((()=>(0,Et().M)(g,d??[],m??[])),[g,d,m]),y=(0,s().$K)(h),f=(0,it().E)("automation_updated_error_states"),v=(0,St().F)({width:265}),x=(0,ce().yK)((e=>({duplicateIcon:{height:17,width:17},formulaErrorCaptionMenuItem:{marginBlockStart:0,paddingBlockStart:0,paddingInline:4},formulaIcon:{height:17,width:17},formulaReturnTypeDesktopIcon:{marginBlockStart:4,marginInlineStart:12},formulaReturnTypeCaptionMenuItem:{marginBlock:0,paddingInline:4},formulaErrorCaption:{...f&&y&&{color:e.text.uiRedPrimary}},nameInputMenuItem:{marginBlock:6},simpleFormulaIcon:{height:17,width:17},trashIcon:{height:17,width:17}})),[f,y]),b=(0,re.useMemo)((()=>p?(0,Ot().getHumanReadableType)(p):Nt().l7.unknown),[p]),S=(0,le().O7)();(0,Lt().K)((()=>{de().clear({environment:S})}));const C=[];if((0,s().$K)(u)){const e=(0,s().$K)(l);C.push({items:[{action:()=>null,key:"variable-name-input-item",render:t=>(0,Ke.jsx)(Yt().ZP,{...t,disabled:!e,focus:!0,onChange:l??Xt,onSubmit:c,placeholder:g.formatMessage(At().eC),style:x.nameInputMenuItem,value:u})}],key:"variable-name-input-section",render:e=>(0,Ke.jsx)(bt().Z,{...e,enableActionSheetTitle:!0})})}if((0,s().$K)(r)||(0,s().$K)(a)||(0,s().$K)(i)){const e=[];(0,s().$K)(r)&&e.push({action:r,key:"variable-name-manage-edit-text",render:e=>(0,Ke.jsx)(Ye().Z,{...e,icon:(0,Ut().R)(x.simpleFormulaIcon),title:(0,Ke.jsx)(K()._H,{defaultMessage:"Edit as text",id:"EditVariableMenu.editSimpleFormulaButtonMenuItem.label"})})}),(0,s().$K)(a)&&e.push({action:a,key:"variable-name-manage-edit-formula",render:e=>(0,Ke.jsx)(Ye().Z,{...e,icon:(0,zt().D)(x.formulaIcon),title:(0,Ke.jsx)(K()._H,{defaultMessage:"Edit as formula",id:"EditVariableMenu.editFormulaButtonMenuItem.label"})})}),(0,s().$K)(i)&&e.push({action:i,key:"variable-name-manage-duplicate",render:e=>(0,Ke.jsx)(Ye().Z,{...e,icon:(0,Wt().a)(x.duplicateIcon),title:(0,Ke.jsx)(K()._H,{defaultMessage:"Duplicate",id:"EditVariableMenu.duplicateFormulaButtonMenuItem.label"})})});const t=C.length>0;C.push({items:e,key:"variable-name-manage-actions",render:e=>(0,Ke.jsx)(bt().Z,{...e,enableActionSheetTitle:!0,topBorder:t})})}if((0,s().$K)(n)||(0,s().$K)(o)){const e=[];(0,s().$K)(n)&&e.push({action:n,key:"variable-name-destructive-delete",render:e=>(0,Ke.jsx)(Ye().Z,{...e,icon:(0,Gt().y)(x.trashIcon),title:(0,Ke.jsx)(K()._H,{defaultMessage:"Delete",id:"EditVariableMenu.deleteFormulaButtonMenuItem.label"})})}),(0,s().$K)(o)&&e.push({action:o,key:"variable-name-destructive-clear",render:e=>(0,Ke.jsx)(Ye().Z,{...e,icon:(0,Gt().y)(x.trashIcon),title:(0,Ke.jsx)(K()._H,{defaultMessage:"Clear variable",id:"EditVariableMenu.clearFormulaButtonMenuItem.label"})})});const t=C.length>0;C.push({items:e,key:"variable-name-destructive-actions",render:e=>(0,Ke.jsx)(bt().Z,{...e,enableActionSheetTitle:!0,topBorder:t})})}const k=C.length>0,M=[{action:()=>{},key:"variable-name-typecheck-return-type",render:e=>(0,Ke.jsx)($t().Z,{...e,caption:(0,Ke.jsx)("span",{style:x.formulaErrorCaption,children:(0,Ke.jsx)(K()._H,{defaultMessage:"Type: {formulaType}",id:"EditVariableMenu.formulaReturnType.label",values:{formulaType:(0,Ke.jsx)(K()._H,{...b})}})}),desktopIconStyle:x.formulaReturnTypeDesktopIcon,dontShrinkIcon:!0,icon:y?(0,Ke.jsx)(Jt,{}):null,shouldWrapCaption:!0,style:x.formulaReturnTypeCaptionMenuItem})}];return y&&M.push({action:()=>{},key:"variable-name-typecheck-error",render:e=>(0,Ke.jsx)($t().Z,{...e,caption:(0,Ke.jsx)(K()._H,{...h}),shouldWrapCaption:!0,style:x.formulaErrorCaptionMenuItem})}),C.push({items:M,key:"variable-name-typecheck",render:e=>(0,Ke.jsx)(bt().Z,{...e,enableActionSheetTitle:!0,topBorder:k})}),0===C.length?null:(0,Ke.jsx)(vt().Z,{...v,children:(0,Ke.jsx)(xt().ZP,{initialFocus:0,sections:C,type:xt().iW.Vertical})})}var eo=()=>o(177634);const to={type:"unknown"};function oo(e){const{type:t}=e,o=(0,ce().yK)((e=>({icon:{fill:e.icon.secondary,width:16,height:16}})),[]);return(0,eo().RX)(t??to)(o.icon)}function no(e){const{analyzedFormulaOutput:t,buttonPopupStore:o,children:n,disabled:i,errorMessage:a,onClearClick:r,onDeleteClick:l,onDuplicateClick:s,onEditFormulaClick:c,onEditTextClick:u,onVariableNameChange:d,variableName:p}=e,{parseErrors:m,typeErrors:g}=t,h=Boolean(a),y=Boolean(m&&m.length>0),f=Boolean(g&&g.length>0),v=h||y||f,x=(0,it().E)("automation_updated_error_states"),b=(0,ce().yK)((e=>({button:{color:e.text.secondary,padding:"0 6px",gap:2},chevronIcon:{fill:e.icon.secondary,flex:"0 0 auto",height:14,width:14},children:{...ue().Yu,color:v?e.errorText:e.text.secondary,flex:"1 1 auto",...v&&x&&{fontWeight:ue().Ue.medium}},iconWrap:{marginInlineEnd:2}})),[x,v]),S=(0,je().d)(),C=(0,se().qz)(o,Qe().Z),k=(0,re.useCallback)((()=>a??null),[a]),M=(0,re.useCallback)((()=>{C.reset()}),[C]);return(0,Ke.jsx)(qe().ZP,{alignmentToOrigin:qe().vR.Start,buttonPopupStore:C,disabled:i,originGap:0,placementToOrigin:qe().pO.Bottom,popupType:S,renderOrigin:e=>(0,Ke.jsx)(Be().Z,{delayThreshold:0,disableTooltip:!h,placement:Dt().Placement.Bottom,render:o=>(0,Ke.jsxs)(Vt().D,{...e,...o,disabled:i,disabledFeedback:i,shouldShrink:!0,style:b.button,children:[(0,Ke.jsx)("div",{style:b.iconWrap,children:v?(0,Ke.jsx)(Jt,{}):(0,Ke.jsx)(oo,{type:t.type})}),(0,Ke.jsx)("div",{style:b.children,children:n}),(0,Ht().Y)(b.chevronIcon)]}),renderTooltip:k}),render:e=>(0,Ke.jsx)(Qt,{analyzedFormulaOutput:t,onClearClick:r,onDeleteClick:l,onDuplicateClick:s,onEditFormulaClick:c,onEditTextClick:u,onVariableNameChange:d,onVariableNameSubmit:M,variableName:p})})}function io(e){var t,o;const{actionStore:n,variableId:a}=e,r=(0,le().O7)(),{automationStore:l,contextType:c}=(0,Se().YC)(),{disabled:u,maybePersistedTransactionActions:d,suppressActionErrors:p}=(0,Oe().i)(),m=(0,K().YB)(),{value:g}=(0,Xe().XJ)(w().F.formulas),{value:h}=(0,Xe().XJ)($e().Sm.automationTypecheck),y=(0,se().qz)(void 0,Qe().Z),f=re.useRef(null),v=(0,se().qz)(void 0,Qe().Z),x=(0,se().VK)((()=>l.getActionStores()),[l]),[b,S]=(0,se().VK)((()=>[n.id,n.getSpaceId()]),[n]),C=(0,mt().z)({actionId:b}),{onTextStoreSelect:k,onTextStoreUnselect:M}=(0,Zt().w)(n),j=(0,se().VK)((()=>n.getConfig()),[n]),T=(0,se().VK)((()=>{var e;return null==j||null===(e=j.values)||void 0===e?void 0:e[a]}),[j,a]),A="formula"===(null==T||null===(t=T.value)||void 0===t?void 0:t.type),_=(0,se().VK)((()=>{if(g&&S)return(0,Rt().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:g.createFormulaDataRequestSyncHandler(n.getRecordModel),spaceId:S,valueTypes:C.slice(0),featureGates:(0,I().W)()},value:null==T?void 0:T.value})}),[S,n.getRecordModel,C,g,null==T?void 0:T.value]),P=(0,re.useMemo)((()=>!p.includes(n.id)),[p,n]),{errorMessage:V}=(0,ae().useErrorComponentForAction)({actionId:n.id,errorKey:a,shouldShow:P}),B=(0,re.useCallback)((e=>{const t=e.target.value;d.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,transaction:o,variableId:n,variableName:i}=e,{valueConfig:a,valueStore:r}=Pt(t,n);(0,s().$K)(a)&&(0,s().$K)(r)&&q().sW({data:{[n]:{...a,name:i}},store:r,transaction:o})}({automationActionStore:n,transaction:e,variableId:a,variableName:t})},userAction:"DefineVariablesAction.editVariableName"}),(0,at().yE)(r,{automationStore:l,automationActionStore:n})}),[n,l,r,d,a]),R=(0,re.useCallback)((()=>{d.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,automationActionStores:o,transaction:n,variableId:i}=e,{valueConfig:a,valueStore:r}=Pt(t,i);if(!(0,s().$K)(a)||!(0,s().$K)(r))return;const l=(0,It().ZP)(),c=(0,_t().h)(o,a.name);q().sW({data:{[l]:{...a,name:c}},store:r,transaction:n}),Q().applyOperation({operation:{args:{id:l},command:"listAfter",path:["config","variableIds"],pointer:t.pointer},store:t,transaction:n})}({automationActionStore:n,automationActionStores:x,transaction:e,variableId:a})},userAction:"DefineVariables.duplicateVariable"}),y.reset(),(0,at().yE)(r,{automationStore:l,automationActionStore:n})}),[n,x,l,y,r,d,a]),F=(0,re.useCallback)((e=>{g&&h&&(d.createAndCommit({perform:t=>{!function(e){const{automationActionStore:t,transaction:o,variableId:n,variableValue:i}=e,{valueConfig:a,valueStore:r}=Pt(t,n);(0,s().$K)(a)&&(0,s().$K)(r)&&q().sW({data:{[n]:{...a,value:i}},store:r,transaction:o})}({automationActionStore:n,transaction:t,variableValue:e,variableId:a}),(0,i().clearInvalidVariables)({environment:r,automationStore:l,automationTypecheckModule:h,contextType:c,formulasModule:g,intl:m,transaction:t})},userAction:"DefineVariables.editVariableValue"}),(0,at().yE)(r,{automationStore:l,automationActionStore:n}))}),[n,l,h,c,r,g,m,d,a]),Z=(0,re.useMemo)((()=>{if(null==j||!j.variableIds||1===j.variableIds.length)return function(){y.setState({open:!1}),F({type:"simple",value:void 0})}}),[null==j?void 0:j.variableIds,y,F]),E=(0,re.useMemo)((()=>{if(!(0,s().$K)(Z))return function(){d.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,transaction:o,variableId:n}=e,{valueStore:i}=Pt(t,n);(0,s().$K)(i)&&(q().sW({data:{[n]:null},store:i,transaction:o}),Q().applyOperation({operation:{args:{id:n},command:"listRemove",path:["config","variableIds"],pointer:t.pointer},store:t,transaction:o}))}({automationActionStore:n,transaction:e,variableId:a})},userAction:"DefineVariables.deleteVariable"}),y.reset(),(0,at().yE)(r,{automationStore:l,automationActionStore:n})}}),[n,l,y,r,d,Z,a]),H=(0,re.useCallback)((async()=>{var e,t;if(A){if(!(await(0,Kt().bs)()))return}null===(e=f.current)||void 0===e||e.focus(),y.setState({open:!1}),F({type:"simple",value:null==T||null===(t=T.value)||void 0===t?void 0:t.value})}),[y,A,F,null==T||null===(o=T.value)||void 0===o?void 0:o.value]),D=(0,re.useCallback)((()=>{var e;null===(e=f.current)||void 0===e||e.blur(),y.setState({open:!1}),v.setState({open:!0})}),[y,v]),L=(0,ce().yK)((()=>({textInput:{width:"100%"}})),[]),O=(0,re.useCallback)((()=>{de().clear({environment:r})}),[r]);if(!S||!T||!_)return null;const N=T.name||m.formatMessage(At().eC),{parseErrors:W=[],typeErrors:U=[]}=_,G=W.length>0||U.length>0;return(0,Ke.jsxs)(wt().jX,{direction:"column",gap:7,children:[(0,Ke.jsx)(wt().jX,{direction:"row",width:"hug",children:(0,Ke.jsx)(no,{analyzedFormulaOutput:_,buttonPopupStore:y,errorMessage:V,onClearClick:Z,onDeleteClick:E,onDuplicateClick:R,onEditFormulaClick:D,onEditTextClick:H,onVariableNameChange:B,variableName:T.name,children:(0,Ke.jsx)("span",{style:ue().Yu,children:N})})}),(0,Ke.jsx)(Ft().w,{disabled:u,formulaInputButtonPopupStore:v,formulaTypecheckContextValues:C,onChange:F,onTextStoreSelect:k,onTextStoreUnselect:M,onTextEsc:O,parentRecordStore:n,ref:f,spaceId:S,style:L.textInput,value:T.value,shouldShowErrorStyles:G}),(0,Ke.jsx)(Et().g,{analyzedFormulaOutput:_})]},a)}o(470928);var ao=()=>o(827282),ro=()=>o(28832),lo=()=>o(98275),so=()=>o(307369),co=()=>o(247724);const uo=(0,K().vU)({aboveMenuItemLabel:{id:"automations.DuplicateBlocksAction.aboveButtonLabel",defaultMessage:"Above button"},aboveTitle:{id:"automations.DuplicateBlocksAction.aboveTitle",defaultMessage:"above button"},belowMenuItemLabel:{id:"automations.DuplicateBlocksAction.belowButtonLabel",defaultMessage:"Below button"},belowTitle:{id:"automations.DuplicateBlocksAction.belowTitle",defaultMessage:"below button"},title:{defaultMessage:"Insert blocks {insertionPicker}",id:"automations.DuplicateBlocksAction.title"},topOfPageMenuItemLabel:{id:"automations.DuplicateBlocksAction.topOfPageButtonLabel",defaultMessage:"At top of page"},topOfPageTitle:{id:"automations.DuplicateBlocksAction.topOfPageTitle",defaultMessage:"at top of page"},bottomOfPageMenuItemLabel:{id:"automations.DuplicateBlocksAction.bottomOfPageButtonLabel",defaultMessage:"At bottom of page"},bottomOfPageTitle:{id:"automations.DuplicateBlocksAction.bottomOfPageTitle",defaultMessage:"at bottom of page"}}),po={before:{icon:(0,o(949549).M)({width:ao().ZG.default}),key:"before",menuItemLabel:uo.aboveMenuItemLabel,title:uo.aboveTitle},after:{icon:(0,o(910446).s)({width:ao().ZG.default}),key:"after",menuItemLabel:uo.belowMenuItemLabel,title:uo.belowTitle},topOfPage:{icon:(0,o(32618).D)({width:ao().ZG.default}),key:"topOfPage",menuItemLabel:uo.topOfPageMenuItemLabel,title:uo.topOfPageTitle},bottomOfPage:{icon:(0,o(934590).s)({width:ao().ZG.default}),key:"bottomOfPage",menuItemLabel:uo.bottomOfPageMenuItemLabel,title:uo.bottomOfPageTitle}},mo=po.after;function go(e){const{currentOption:t,disabled:o,onChange:n}=e,i=(0,K().YB)(),a=(0,je().d)(),r=(0,se().qz)(void 0,Qe().Z),l=(0,re.useCallback)((e=>{n&&t.key!==e&&n(e),r.setState({open:!1})}),[r,t,n]);return(0,Ke.jsx)(qe().ZP,{alignmentToOrigin:qe().vR.Center,buttonPopupStore:r,disabled:o,originGap:0,placementToOrigin:qe().pO.Bottom,popupType:a,render:()=>(0,Ke.jsx)(ho,{currentOption:t,onChange:l}),renderOrigin:e=>(0,Ke.jsx)(gt().S,{...e,disabled:o,isCompact:!0,dropdownButtonType:"dropdown",children:i.formatMessage(t.title)})})}function ho(e){const{currentOption:t,onChange:o}=e,n=(0,K().YB)(),i=(0,St().F)({maxWidth:360}),a=Object.values(po).map((e=>({key:e.key,render:o=>(0,Ke.jsx)(Ye().Z,{...o,checkState:t.key===e.key,icon:e.icon,title:n.formatMessage(e.menuItemLabel)}),action:()=>o(e.key)})));return(0,Ke.jsx)(vt().Z,{...i,children:(0,Ke.jsx)(xt().ZP,{initialFocus:0,sections:[{key:0,render:e=>(0,Ke.jsx)(bt().Z,{enableActionSheetTitle:!0,...e}),items:a}],type:xt().iW.Vertical})})}function yo(e){const{actionStore:t,disabled:o,contentParentPointer:n,buttonPlacement:a}=e,r=(0,le().O7)(),l=(0,ce().yK)((e=>({listWrap:{background:e.contentBackground,borderRadius:5,boxShadow:e.inputBoxShadow,fontSize:14,minHeight:64,paddingBlock:3,paddingInline:10,cursor:"text",..."dark"===e.mode?{backgroundColor:e.inputBackground}:{}},emptyPlaceholder:{caretColor:e.mediumTextColor,color:e.lightTextColor,fontSize:14,padding:"5px 0",display:"inline-block"}})),[]),s=(0,se().VK)((()=>W().G.createChildStore(t,n)),[t,n]),c=(0,se().VK)((()=>s.getContentStore()),[s]),u=(0,re.useCallback)((()=>{(c.getValue()??[]).length>0||Q().createAndCommit({userAction:"DuplicateBlocksAction.handleListClick",environment:r,canUndo:!0,perform:e=>{const t=i().insertEmptyTextInDuplicateBlockAction({environment:r,contentStore:c,transaction:e});X().eP({environment:r,store:t}),de().setSelectionAtStart({store:t.getBlockTitleStore()})}})}),[r,c]);if(!c)return null;const d="inline"===(null==a?void 0:a.type);return(0,Ke.jsx)(so().Z,{store:s,analyticsName:"duplicate_blocks_action",isListContainer:!0,children:(0,Ke.jsx)(pe().p,{allowSelectionWithin:!0,children:(0,Ke.jsx)("div",{style:l.listWrap,onClick:u,className:co().Wh_,children:(0,Ke.jsx)(ro().O,{displayName:"DuplicateBlocksActionContent",disabled:o,children:(0,Ke.jsx)(lo().Z,{disabled:o,store:c,emptyPlaceholder:(0,Ke.jsx)("div",{style:l.emptyPlaceholder,children:d?(0,Ke.jsx)(K()._H,{id:"automations.DuplicateBlocksAction.emptyPlaceholder",defaultMessage:"Click to edit or drop blocks hereâ¦"}):(0,Ke.jsx)(K()._H,{id:"automations.DuplicateBlocksAction.emptyCannotDropPlaceholder",defaultMessage:"Click to edit blocks hereâ¦"})}),disableCommentMenu:!0,disableHoverMenu:!1,disableDrag:!1})})})})})}var fo=()=>o(329866),vo=()=>o(494616),xo=()=>o(661641);function bo(e){const{analyzedFormulaOutput:t,labelMessageDescriptor:o,isOptional:n,errorMessageDescriptor:i}=e,a=(0,K().YB)(),r=(0,it().E)("automation_updated_error_states"),l=(0,se().VK)((()=>(0,Et().M)(a,null==t?void 0:t.parseErrors,null==t?void 0:t.typeErrors)),[t,a]),{isMobile:s}=(0,le().Fy)(),c=(0,ce().yK)((e=>({inputLabel:{display:"flex",alignItems:"center",color:e.text.secondary,fontSize:s?ue().JB.UIRegular.mobile:ue().JB.UIRegular.desktop,lineHeight:s?ue().Nv.UIRegular.mobile:ue().Nv.UIRegular.desktop,fontWeight:ue().Ue.regular},messageInput:{width:"100%"},warningIcon:{color:e.errorText,fill:e.errorText,height:12,flex:"0 0 auto",width:12,display:"flex",marginRight:4},inputLabelInner:{flex:"1 1 auto",...r&&(i||l)&&{color:e.text.uiRedPrimary,fontWeight:ue().Ue.medium}},warningError:{color:e.text.uiRedPrimary}})),[i,l,r,s]);return(0,Ke.jsxs)(wt().jX,{direction:"column",gap:6,children:[(0,Ke.jsxs)("label",{style:c.inputLabel,children:[l&&(0,qt().t)(c.warningIcon),(0,Ke.jsxs)("div",{style:c.inputLabelInner,children:[(0,Ke.jsx)(K()._H,{...o}),n&&(0,Ke.jsx)(So,{})]})]}),(0,Ke.jsxs)(wt().jX,{direction:"column",gap:6,children:[(0,Ke.jsx)(Ft().w,{...e,style:c.messageInput,shouldShowErrorStyles:!!l||e.shouldShowErrorStyles}),l&&(0,Ke.jsx)(Et().g,{analyzedFormulaOutput:t}),!l&&i&&r&&(0,Ke.jsx)(xo().q,{colorName:"secondary",styleName:"UISmall-12px/Regular",style:c.warningError,children:(0,Ke.jsx)(K()._H,{...i})})]})]})}function So(){const e=(0,ce().yK)((e=>({optionalLabel:{color:e.text.tertiary,marginLeft:4}})),[]);return(0,Ke.jsx)("span",{style:e.optionalLabel,children:(0,Ke.jsx)(K()._H,{defaultMessage:"{openParenthesis}Optional{closeParenthesis}",id:"automations.SimpleFormulaTextInputWithError.optionalLabel",values:{openParenthesis:"(",closeParenthesis:")"}})})}const Co=(0,K().vU)({confirmationMessageLabel:{defaultMessage:"Confirmation message",id:"automations.BaseModalAction.confirmationMessageLabel"},continueButtonTextLabel:{defaultMessage:"Continue button text",id:"automations.BaseModalAction.continueButtonTextLabel"},cancelButtonTextLabel:{defaultMessage:"Cancel button text",id:"automations.BaseModalAction.cancelButtonTextLabel"}});var ko=()=>o(912203),Mo=()=>o(137727);function jo(e){const{actionStore:t,disabled:o,errorMessage:n,includeThisPage:i,onChange:a,target:r,urlBehavior:l}=e,c=(0,le().O7)(),{typecheckResult:u}=(0,Se().DZ)(),d=(0,se().qz)(void 0,Qe().Z),[p,m]=(0,se().VK)((()=>[t.id,t.getSpaceId()]),[t]),g=(0,mt().z)({actionId:p}),h=(0,se().VK)((()=>{if(r)if("variable"===r.type){if(!u)return;const e=(0,ct().getContextValueForActionById)(u,p,r.id);if(e)return{type:"variable",contextValue:e}}else{if("page"===r.type||"url"===r.type)return r;(0,s().t1)(r)}}),[r,u,p]),y=(0,je().d)(),f=(0,re.useCallback)((e=>{"page"!==e.type&&"variable"!==e.type&&"url"!==e.type||(a(e),d.reset(),(0,at().GV)(((o,n,i)=>{const a=(0,at().TI)({automationActionStore:t,formulaAnalyticsModule:n,formulasModule:o,simpleFormulasModule:i});(0,s().$K)(a)&&(0,A().j)({environment:c,event:{eventName:"automation_target_pick",eventProperties:{automation_action:a,automation_id:t.getParentId(),target_type:e.type}}})})))}),[a,d,t,c]),v=(0,re.useCallback)((()=>d.reset()),[d]);let x;return h?"page"===h.type?x=(0,Ke.jsx)(dt().Z,{store:W().G.createChildStore(t,h.page),style:{paddingBlock:1}}):"variable"===h.type?x=(0,Ke.jsx)(pt().F,{value:h.contextValue,format:ut().lo.Medium,isSingle:!0,style:{background:"transparent",color:"unset",margin:"-1.5px 0",padding:0}}):"url"===h.type?x=(0,Ke.jsx)("div",{children:h.url}):(0,s().t1)(h):x="allow"===l?(0,Ke.jsx)(K()._H,{id:"automations.AutomationPagePicker.pagesDropdown.labelWithUrl",defaultMessage:"Select page, form, or URL"}):(0,Ke.jsx)(K()._H,{id:"automations.AutomationPagePicker.pagesDropdown.label",defaultMessage:"Select page"}),(0,Ke.jsx)(qe().ZP,{buttonPopupStore:d,popupType:y,alignmentToOrigin:qe().vR.Center,placementToOrigin:qe().pO.Bottom,originGap:0,disabled:o,renderOrigin:e=>(0,Ke.jsx)(gt().S,{...e,disabled:o,isCompact:!0,isError:Boolean(n),hasActionRequired:!Boolean(r),tooltipMessage:n,dropdownButtonType:"dropdown",children:x}),render:e=>(0,Ke.jsx)(ht().L,{formulaTypecheckContextValues:g,includeThisPage:i,onChange:f,onClose:v,parentRecordStore:t,selectedTarget:r,skipCollections:!0,spaceId:m,urlBehavior:l})})}function To(e){const{actionStore:t,disabled:o,errorMessage:n,onChange:i,value:a,urlBehavior:r}=e,l=(0,ce().yK)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]);return(0,Ke.jsxs)("div",{style:l.title,children:[(0,Ke.jsx)(K()._H,{defaultMessage:"<span>Open </span>{pagePicker}",id:"automations.OpenPageAction.action.title",values:{pagePicker:(0,Ke.jsx)("div",{style:l.picker,children:(0,Ke.jsx)(jo,{urlBehavior:r,actionStore:t,disabled:o,errorMessage:n,onChange:i,target:a})}),span:e=>(0,Ke.jsx)("span",{style:l.span,children:e})}}),"Â "]})}function wo(e){const{actionStore:t,disabled:o,onChange:n}=e,i=(0,ce().yK)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]),a=(0,se().VK)((()=>t.getOpenPageIn()),[t]);return(0,Ke.jsx)("div",{style:i.title,children:(0,Ke.jsx)(K()._H,{defaultMessage:"<span>in </span>{peekModePicker}",id:"automations.OpenPageAction.peekMode.title",values:{peekModePicker:(0,Ke.jsx)("div",{style:i.picker,children:(0,Ke.jsx)(Ao,{disabled:o,onChange:n,value:a})}),span:e=>(0,Ke.jsx)("span",{style:i.span,children:e})}})})}function Ao(e){const{disabled:t,onChange:o,value:n}=e,i=(0,ce().Fg)(),a=(0,se().qz)(void 0,Qe().Z),r=(0,se().VK)((()=>(0,Mo().v)({currentViewType:void 0,theme:i}).find((e=>e.key===n))),[n,i]),l=(0,re.useCallback)((()=>a.reset()),[a]),s=(0,re.useCallback)((e=>{e!==(null==r?void 0:r.key)&&o(e),l()}),[l,null==r?void 0:r.key,o]),c=(0,je().d)();return r?(0,Ke.jsx)(qe().ZP,{alignmentToOrigin:qe().vR.Center,buttonPopupStore:a,disabled:t,originGap:0,placementToOrigin:qe().pO.Bottom,popupType:c,renderOrigin:e=>(0,Ke.jsx)(gt().S,{...e,disabled:t,isCompact:!0,dropdownButtonType:"dropdown",children:r.title}),render:e=>(0,Ke.jsx)(Io,{onChange:s,value:n})}):null}function Io(e){const{onChange:t,value:o}=e,n=(0,ce().Fg)(),i=(0,ce().yK)((()=>({menuItem:{paddingBlock:8}})),[]),a=(0,St().F)({maxWidth:360,width:280}),r=(0,se().VK)((()=>(0,Mo().v)({currentViewType:void 0,theme:n}).map(((e,n)=>({action:()=>t(e.key),key:n,render:t=>(0,Ke.jsx)(Ye().Z,{...t,body:e.body,caption:e.caption,checkState:o===e.key,disabled:!1,icon:e.icon,style:i.menuItem,title:e.title})})))),[t,i.menuItem,n,o]),l=[{key:0,render:e=>(0,Ke.jsx)(bt().Z,{enableActionSheetTitle:!0,...e}),items:r}];return(0,Ke.jsx)(vt().Z,{...a,children:(0,Ke.jsx)(xt().ZP,{initialFocus:0,sections:l,type:xt().iW.Vertical})})}var _o=()=>o(429600),Po=()=>o(838003),Vo=()=>o(471645),Bo=()=>o(667637),Ro=()=>o(67961),Fo=()=>o(352230),Ko=()=>o(594539),Zo=()=>o(492077),Eo=()=>o(128119);function Ho(e){const{actionStore:t,disabled:o,errorMessage:n,onTargetChange:i,value:a}=e;return(0,Ke.jsx)(K()._H,{defaultMessage:"Publish{pagePicker}",id:"automations.PublishSiteAction.header.title",values:{pagePicker:(0,Ke.jsx)(jo,{actionStore:t,disabled:o,errorMessage:n,includeThisPage:!0,onChange:i,target:a})}})}function Do(){const e=(0,le().Fy)(),t=(0,ce().yK)((e=>({outerContainer:{paddingTop:15,display:"flex",flexDirection:"column",gap:6},siteSettingsContainer:{borderRadius:10,border:`1px solid ${e.regularDividerColor}`,padding:2},sectionMenuItem:{padding:"6px 2px"},button:{marginLeft:0,marginRight:0,width:"100%",paddingTop:2,paddingBottom:2,background:"transparent"},itemInnerContainer:{marginLeft:0,paddingLeft:8,minWidth:"auto",background:"transparent"}})),[]),o={type:"public_permission",role:"reader",expiration_timestamp:void 0},n=[{key:"linkExpiration",render:e=>(0,Ke.jsx)(Ko().Z,{...e,disabled:!1,permissionItem:o,onChange:e=>{},hideIcon:!0}),action:()=>{}},{key:"enableQna",render:o=>(0,Ke.jsx)(Bo().Z,{...o,isMobile:e.isMobile,buttonStyle:t.button,textWrapperStyle:t.itemInnerContainer,title:(0,Ke.jsx)(K()._H,{defaultMessage:"Enable QnA",id:"automations.PublishSiteAction.action.siteSettingsEnableQna.title"}),on:!0,onClick:()=>{}}),action:()=>{}},{key:"enableSeo",render:o=>(0,Ke.jsx)(Bo().Z,{...o,isMobile:e.isMobile,buttonStyle:t.button,textWrapperStyle:t.itemInnerContainer,title:(0,Ke.jsx)(K()._H,{defaultMessage:"Search engine indexing",id:"automations.PublishSiteAction.action.siteSettingsEnableSEO.title"}),on:!1,onClick:()=>{}}),action:()=>{}}],i=(0,r().oA)([{key:0,render:e=>(0,Ke.jsx)(bt().Z,{style:t.sectionMenuItem,...e}),items:n}]);return(0,Ke.jsxs)("div",{style:t.outerContainer,children:[(0,Ke.jsx)("label",{children:(0,Ke.jsx)(K()._H,{defaultMessage:"Settings",id:"automations.PublishSiteAction.action.siteSettingsTitle"})}),(0,Ke.jsx)(xt().ZP,{type:xt().iW.Vertical,sections:i,initialFocus:void 0,resetFocusOnMouseOut:!0,style:t.siteSettingsContainer})]})}function Lo(){const e=(0,ce().yK)((e=>({outerContainer:{paddingTop:15,display:"flex",flexDirection:"column",gap:6},siteSettingsContainer:{borderRadius:10,border:`1px solid ${e.regularDividerColor}`,padding:2},sectionMenuItem:{padding:"6px 2px"},button:{marginLeft:0,marginRight:0,width:"100%",paddingTop:2,paddingBottom:2,background:"transparent"},itemInnerContainer:{marginLeft:0,paddingLeft:8,minWidth:"auto",background:"transparent"}})),[]),t=[{key:"theme",render:t=>(0,Ke.jsx)(Oo,{...t,style:e.sectionMenuItem}),action:()=>{}},{key:"header",render:t=>(0,Ke.jsx)(Uo,{...t,style:e.sectionMenuItem}),action:()=>{}},{key:"googleAnalytics",render:t=>(0,Ke.jsx)(zo,{...t,style:e.sectionMenuItem}),action:()=>{}}],o=(0,r().oA)([{key:0,render:t=>(0,Ke.jsx)(bt().Z,{style:e.sectionMenuItem,...t}),items:t}]);return(0,Ke.jsxs)("div",{style:e.outerContainer,children:[(0,Ke.jsx)("label",{children:(0,Ke.jsx)(K()._H,{defaultMessage:"Site customization",id:"automations.PublishSiteAction.action.siteCustomizationTitle"})}),(0,Ke.jsx)(xt().ZP,{type:xt().iW.Vertical,sections:o,initialFocus:void 0,resetFocusOnMouseOut:!0,style:e.siteSettingsContainer})]})}const Oo=re.forwardRef(((e,t)=>{const o=(0,le().Fy)(),n=(0,ce().yK)((e=>({chevronIcon:{height:12,width:12,fill:e.icon.tertiary,transform:"rotate(90deg)"}})),[]),i=(0,re.useCallback)((e=>{}),[]),a="system";return(0,Ke.jsx)(Po().Z,{...e,popupType:o.isMobile?qe().Z4.SlideUp:qe().Z4.Popup,renderOrigin:t=>(0,Ke.jsx)(Zo().C,{...(0,Fe().Z)(e,t),title:(0,Ke.jsx)(K()._H,{defaultMessage:"Theme",id:"automations.PublishSiteAction.action.siteCustomization.themeTitle"}),right:(0,Ke.jsxs)(Ke.Fragment,{children:[(0,Ke.jsx)(No,{value:a}),(0,_o().o)(n.chevronIcon)]})}),alignmentToOrigin:Eo().lU.End,placementToOrigin:Eo().Iw.Bottom,render:e=>(0,Ke.jsx)(Wo,{value:a,onChange:i,onClose:()=>{e.close()}})})}));function No(e){const{value:t}=e,o=(0,ce().yK)((e=>({container:{color:e.text.secondary}})),[]);return t?"system"===t?(0,Ke.jsx)(Ro().Z,{style:o.container,children:(0,Ke.jsx)(K()._H,{defaultMessage:"System",id:"automations.PublishSiteAction.action.siteCustomization.themeOptions.system"})}):"light"===t?(0,Ke.jsx)(Ro().Z,{style:o.container,children:(0,Ke.jsx)(K()._H,{defaultMessage:"Light",id:"automations.PublishSiteAction.action.siteCustomization.themeOptions.light"})}):"dark"===t?(0,Ke.jsx)(Ro().Z,{style:o.container,children:(0,Ke.jsx)(K()._H,{defaultMessage:"Dark",id:"automations.PublishSiteAction.action.siteCustomization.themeOptions.dark"})}):void(0,s().t1)(t):null}function Wo(e){const{value:t,onChange:o,onClose:n}=e,i=(0,le().Fy)(),a=(0,re.useCallback)((e=>{void 0!==e&&e!==t&&o(e),n()}),[t,o,n]),r=["system","light","dark"].map((e=>({key:e,render:t=>(0,Ke.jsx)(Ye().Z,{...t,title:(0,Ke.jsx)(No,{value:e})}),action:()=>{a(e)}}))),l=[{key:0,render:e=>(0,Ke.jsx)(bt().Z,{...e}),items:r}];return(0,Ke.jsx)(vt().Z,{menuType:i.isMobile?Fo().o.ActionSheet:Fo().o.Popup,width:240,children:(0,Ke.jsx)(xt().ZP,{type:xt().iW.Vertical,initialFocus:r.findIndex((e=>e.key===t)),sections:l})})}Oo.displayName="ThemeCustomizationItem";const Uo=re.forwardRef(((e,t)=>{const o=(0,le().Fy)(),n=(0,ce().yK)((e=>({chevronIcon:{height:12,width:12,fill:e.icon.tertiary,transform:"rotate(90deg)"}})),[]),i=(0,re.useCallback)((e=>{}),[]),a={};return(0,Ke.jsx)(Po().Z,{...e,popupType:o.isMobile?qe().Z4.SlideUp:qe().Z4.Popup,renderOrigin:t=>(0,Ke.jsx)(Zo().C,{...(0,Fe().Z)(e,t),title:(0,Ke.jsx)(K()._H,{defaultMessage:"Header",id:"automations.PublishSiteAction.action.siteCustomization.headerTitle"}),right:(0,Ke.jsxs)(Ke.Fragment,{children:[(0,Ke.jsx)(K()._H,{defaultMessage:"Default",id:"automations.PublishSiteAction.action.siteCustomization.headerDefaultValue"}),(0,_o().o)(n.chevronIcon)]})}),alignmentToOrigin:Eo().lU.End,placementToOrigin:Eo().Iw.Bottom,render:e=>(0,Ke.jsx)(Go,{value:a,onChange:i,onClose:()=>{e.close()}})})}));function Go(e){const{value:t}=e,o=(0,le().Fy)(),n=[{key:"breadcrumbs",render:e=>(0,Ke.jsx)(Zo().C,{...e,title:(0,Ke.jsx)(K()._H,{defaultMessage:"Breadcrumbs",id:"automations.PublishSiteAction.action.siteCustomization.headerOptionBreadcrumb"}),right:(0,Ke.jsx)(Vo().Z,{...e,on:!(null!=t&&t.hideBreadcrumbs)})}),action:()=>{}},{key:"search",render:e=>(0,Ke.jsx)(Zo().C,{...e,title:(0,Ke.jsx)(K()._H,{defaultMessage:"Search",id:"automations.PublishSiteAction.action.siteCustomization.headerOptionSearch"}),right:(0,Ke.jsx)(Vo().Z,{...e,on:!(null!=t&&t.hideSearch)})}),action:()=>{}},{key:"watermark",render:e=>(0,Ke.jsx)(Zo().C,{...e,disabled:!0,title:(0,Ke.jsx)(K()._H,{defaultMessage:"Watermark",id:"automations.PublishSiteAction.action.siteCustomization.headerOptionWatermark"}),right:(0,Ke.jsx)(Vo().Z,{...e,disabled:!0,on:!(null!=t&&t.hideWatermark)})}),action:()=>{}}],i=[{key:0,render:e=>(0,Ke.jsx)(bt().Z,{...e}),items:n}];return(0,Ke.jsx)(vt().Z,{menuType:o.isMobile?Fo().o.ActionSheet:Fo().o.Popup,width:240,children:(0,Ke.jsx)(xt().ZP,{type:xt().iW.Vertical,initialFocus:n.findIndex((e=>e.key===t)),sections:i})})}Uo.displayName="HeaderCustomizationItem";const zo=re.forwardRef(((e,t)=>{const o=(0,re.useRef)(null);return(0,Ke.jsx)(Zo().C,{...e,title:(0,Ke.jsx)(K()._H,{defaultMessage:"Google Analytics",id:"automations.PublishSiteAction.action.siteCustomization.googleAnalyticsTitle"}),right:(0,Ke.jsx)($o,{ref:o,value:undefined}),onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.focus()}})}));zo.displayName="GoogleAnalyticsCustomizationSetting";const $o=re.forwardRef(((e,t)=>{const{value:o}=e,[n,i]=(0,re.useState)(!1),a=!1,r=(0,ce().yK)((e=>({inputContainer:{background:e.surface.page,borderRadius:4,boxShadow:n?"0px 0px 0px 1px #2383E2 inset, 0px 0px 0px 2px rgba(35, 131, 226, 0.35)":`${e.regularDividerColor} 0px 0px 0px 1px inset`,height:28,padding:8,fontWeight:ue().Ue.regular,fontSize:14,lineHeight:1.3,color:e.text.secondary},input:{marginLeft:-6,paddingLeft:0,color:e.text.primary},wrapper:{paddingTop:4,paddingBottom:4}})),[a,n]);return(0,Ke.jsx)("div",{style:r.wrapper,children:(0,Ke.jsx)(me().Z,{ref:t,type:"text",style:r.inputContainer,inputStyle:r.input,value:o,onChange:e=>{},format:me().B.Transparent,onFocus:()=>i(!0),onBlur:()=>i(!1),left:"G-",disabled:a})})}));$o.displayName="GoogleAnalyticsInput";o(749411);var Yo=()=>o(309968),qo=()=>o(235484),Jo=()=>o(535014),Xo=()=>o(154186),Qo=()=>o(71194),en=()=>o(138912),tn=()=>o(339352);o(30005);function on(e){const t=(0,le().O7)();(0,se().VK)((()=>{(0,h().lcG)(e).forEach((e=>{new(W().U6)(t,{table:S().KJ,id:e},{userId:e}).isDefined()}))}),[t,e])}var nn=()=>o(3425),an=()=>o(400836),rn=()=>o(209956),ln=(o(731107),()=>o(226413)),sn=()=>o(446866),cn=()=>o(619186),un=()=>o(801812),dn=()=>o(80122),pn=()=>o(981583),mn=()=>o(815325),gn=()=>o(122671),hn=()=>o(828946),yn=()=>o(98228),fn=()=>o(692304),vn=()=>o(96735),xn=()=>o(874101),bn=()=>o(440424),Sn=()=>o(793041);function Cn(e){let{handleRemoveToken:t,token:o,format:n,style:i,addQuotes:a,renderAvatar:r,isDisabled:l}=e;const s=(0,ce().Fg)();if(!(0,sn().oH)(o))return null;const c=a?`â${o}â`:o;return(0,Ke.jsx)(Sn().ZP,{title:c,format:n??ut().lo.Small,renderAvatar:r||(e=>(0,bn().a)({width:e,height:e,padding:2,marginRight:6})),showRemoveButton:Boolean(t)&&!l,onClickRemove:e=>{null==e||e.stopPropagation(),t&&t(o)},style:{background:s.accentColors.gray[75],...i},shouldShrink:!0,isSingle:!1})}var kn=()=>o(887766);const Mn=["gmail.com","yahoo.com","outlook.com"],jn=["com","net","org"];var Tn=()=>o(838367),wn=()=>o(470386),An=()=>o(497459),In=()=>o(122890),_n=()=>o(534801),Pn=()=>o(879931);function Vn(e){let{email:t,disabled:o,menuArgs:n}=e;const i=(0,Pn().L)();return(0,Ke.jsx)(Ye().Z,{...n,title:(0,Ke.jsx)(Cn,{token:t,format:ut().lo.Inline,addQuotes:!0,style:{background:void 0,padding:void 0}}),disabled:o,style:o?i.disabledMenuItem:void 0,isTokenTitle:!0})}function Bn(e){let{token:t,disabled:o,menuArgs:n,type:i}=e;const a=(0,Pn().L)(),r=(0,ce().Fg)();return(0,Ke.jsx)(Ye().Z,{...n,title:(0,Ke.jsx)(kn().Z,{token:t,type:i,format:ut().lo.Inline,style:{color:r.darkTextColor,background:void 0,padding:void 0}}),disabled:o,style:{...o?a.disabledMenuItem:void 0},isTokenTitle:!0})}var Rn=()=>o(816512),Fn=()=>o(864832);function Kn(e){let{annotation:t,disabled:o,getRecordModel:n,menuArgs:i}=e;const a=(0,Pn().L)(),r=(0,se().VK)((()=>{if((0,Rt().isAnnotationSimpleValueToken)(t)&&(0,h().IWo)(t)){const e=(0,h().zEN)(t);return e?(0,Rn().Hl)({pointer:{table:S().KJ,id:e},getRecordModel:n,getRecordValue:void 0}):void 0}}),[t,n]);return null!=r&&r.asActor&&r.table===S().KJ?(0,Ke.jsx)(Ye().Z,{...i,title:(0,Ke.jsx)(Zn,{actor:r}),disabled:o,style:o?a.disabledMenuItem:void 0,isTokenTitle:!0}):null}function Zn(e){let{actor:t}=e;const o=(0,ce().yK)((e=>({root:{margin:"4px 0"},actor:{margin:"0 10px 0 0"},email:{color:e.actionMenuButtonTextColor,margin:"0 0 0 26px"}})),[]),n=(0,se().VK)((()=>t.getName()),[t]),i=(0,se().VK)((()=>t.getEmail()),[t]);return(0,Ke.jsxs)("div",{style:o.root,children:[(0,Ke.jsx)(Fn().ZP,{actor:t,format:ut().lo.Medium,shouldShrink:!0,isSingle:!1,style:o.actor},t.id),n&&(0,Ke.jsx)(Sn().ZP,{title:i,format:ut().lo.ExtraSmall,isSingle:!1,style:o.email})]})}function En(e){const{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:n,formulaValueContext:i,getRecordModel:a,isDisabled:l,limit:s,menuProps:c,onChange:u,onClose:d,onFormulaButtonClick:p,showFormulaValueItems:m=!1,value:y,pageProperties:f,parentRecordStore:v,showInputErrorStyles:x}=e,b=(0,le().Fy)(),S=(0,ce().Fg)(),{errorMessage:C,isLoading:k,menuListStore:M,noResultsMessage:j,searchInput:T,userItems:w,valueItems:A,pagePropertyItems:I,emailItems:_}=function(e){var t,o,n;const{action:i,formulaTypecheckContextValues:a,formulaValueContext:l,isDisabled:s=!1,limit:c,onChange:u,onClose:d,onFormulaButtonClick:p,unlimitedCurrentSimpleFormulaValueTokens:m,value:y,pageProperties:f,parentRecordStore:v,showInputErrorStyles:x}=e,b=(0,le().O7)(),S=(0,K().YB)(),{collectionStore:C,property:k}="collection"===l.type?l:{collectionStore:void 0,property:void 0},M=v.getRecordModel,j=(0,Kt().Mv)(l),T=j(m,"first"),w=a.filter((e=>(0,eo().uy)(e.type,{type:"person"}))),A=(0,ce().yK)((e=>({personToken:{background:e.accentColors.gray[75],borderRadius:"6px"},formulaValueToken:{background:e.buttonBackground},searchInput:{maxHeight:6*parseInt(gn().go,10),width:"100%",margin:0,minHeight:32,background:e.accentColors.gray[30],...x&&{border:`1px solid ${e.text.uiRedPrimary}`,boxShadow:"none"}},clearButton:{height:20},clearButtonIcon:{height:15,width:15,fill:e.lightIconColor},actionButtonGroup:{alignSelf:"end",cursor:"unset",justifyContent:"end"}})),[x]),[I,_]=(0,re.useState)(""),P=(0,re.useRef)(null),V=(0,re.useRef)(""),B=(0,se().qz)(void 0,fn().Z),R=(0,se().VK)((()=>(null==C?void 0:C.getSchema())??{}),[C]),F=(0,se().VK)((()=>{if(R&&k){const e=R[k];if(e&&(0,ln().en)(e))return 1===e.limit}return!1}),[R,k]),[Z]=(0,un().r5)((async()=>{const e=I?(0,cn().ZP)(I,w,(e=>e.kind===g().FormulaContextValueKind.ContextValue?e.name:"")):w,t=I?(0,cn().ZP)(I,f,(e=>(0,h().pxR)(e).name??"")):f,o=await hn().x.searchActions.load(),n=await o.searchVisibleSpaceUsers({environment:b,query:I,membersOnly:!1}),i=(0,Rt().fromSimpleFormulaArrayValue)(null==y?void 0:y.value).reduce(((e,t)=>(t&&(0,Rt().isAnnotationSimpleValueToken)(t)&&(0,h().IWo)(t)&&e.push(t[1]),e)),[]);let a=0,r=n[a];const l=[];for(;r&&l.length<20;)i.includes(r.id)||l.push(r.id),a+=1,r=n[a];return{valueResults:e,userResults:l,pagePropertyResults:t}}),[b,I,w,null==y?void 0:y.value,f],{debounce:yn().vp}),E=(0,re.useCallback)((()=>{var e;_(""),null===(e=P.current)||void 0===e||e.focus(),B.setState({...B.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[B]),H=(0,re.useCallback)(((e,t)=>{u(e||y,t||i)}),[i,u,y]),D=(0,re.useCallback)((e=>{const t=j(e,"last");H({type:"simple",value:(0,Rt().toSimpleFormulaArrayValue)(t)}),E()}),[j,H,E]),L=(0,re.useCallback)((()=>{D(T.slice(0,T.length-1))}),[T,D]),O=(0,re.useCallback)((e=>{null==D||D((0,Rt().simpleFormulaValueWithoutToken)(T,e))}),[T,D]),N=Boolean(c&&T.length>=c),W=r().oA(T.map(((e,t)=>{if("boolean"==typeof e)return null;if("string"==typeof e)return(0,Ke.jsx)(Cn,{handleRemoveToken:O,token:e,isDisabled:s,renderAvatar:t=>(0,pn().Z)({avatar:{email:e},style:{marginRight:4}}),style:A.personToken},t);if((0,h().IWo)(e))return(0,Ke.jsx)(vn().Z,{handleRemoveToken:O,token:e,isDisabled:s,style:A.personToken,preventOnClickPropagation:!0},t);if((0,h().wjk)(e))return(0,Ke.jsx)(xn().Z,{formulaTypecheckContextValues:a,handleRemoveToken:O,isDisabled:s,style:A.formulaValueToken,token:e,preventOnClickPropagation:!0},t);if((0,h().Lyt)(e)){var o;const n=(0,h().pxR)(e);return(0,Ke.jsx)(kn().Z,{type:null===(o=R[n.property])||void 0===o?void 0:o.type,isDisabled:s,handleRemoveToken:O,token:e},t)}return null}))),G=new Set(r().oA(T.map((e=>(0,Rt().isAnnotationSimpleValueToken)(e)&&(0,h().wjk)(e)&&(0,h().vmO)(e).id)))),z=new Set(r().oA(T.map((e=>(0,Rt().isAnnotationSimpleValueToken)(e)&&(0,h().IWo)(e)&&(0,h().zEN)(e))))),$=r().oA(((null===(t=Z.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>{const t=e.kind===g().FormulaContextValueKind.ContextValue&&e.id||"";if(!t||!G.has(t))return{action:"append",currentSimpleFormulaValueTokens:T,isDisabled:s||N,id:t,getRecordModel:M,setCurrentTokens:D,value:e}}))),Y=r().oA(((null===(o=Z.value)||void 0===o?void 0:o.userResults)||[]).map((e=>{const t=z.has(e);if(t)return;const o=(0,h().tEo)(e);return{action:()=>{t?O(o):D([...T,o]),F&&U().default.afterNextFlush((()=>{d()}))},annotation:o,getRecordModel:M,id:e,isDisabled:s||N,userId:e,isSelected:t}}))),q=new Set(T.filter((e=>(0,Rt().isAnnotationSimpleValueToken)(e)&&(0,h().Lyt)(e))).map((e=>(0,h().pxR)(e).property))),J=r().oA(null===(n=Z.value)||void 0===n?void 0:n.pagePropertyResults.map((e=>{var t;const o=(0,h().pxR)(e);if(!q.has(o.property))return{id:o.property,type:null===(t=R[o.property])||void 0===t?void 0:t.type,isDisabled:s||N,action:()=>{D([...T,e])},propertyAnnotation:e}}))),X=(0,re.useCallback)((e=>{(0,sn().oH)(e)&&D([...T,e])}),[T,D]),Q=(0,re.useCallback)((()=>{X(V.current)}),[X]);(0,re.useEffect)((()=>{V.current=I}),[I]),(0,re.useEffect)((()=>{const e=P.current;return e&&e.addEventListener("blur",Q),()=>{e&&e.removeEventListener("blur",Q)}}),[Q]);const ee=(0,sn().oH)(I)?[I]:[];if(0===ee.length){const[e,t]=I.split("@");if(t){const[o,n]=t.split(".");(!n||n.length<=1)&&ee.push(...jn.map((t=>`${e}@${o}.${t}`)).filter(sn().oH))}else ee.push(...Mn.map((t=>`${e}@${t}`)).filter(sn().oH))}const te=ee.map((e=>({action:()=>X(e),isDisabled:s||N,email:e}))),oe=[...$,...Y,...J,...te],ne=(0,it().E)("gmail_action_formula_recipients");return{errorMessage:Z.error&&S.formatMessage(mn().s.somethingWentWrong),header:S.formatMessage(mn().s.genericMenuHeader),isLoading:!Z.value&&!Z.error,menuListStore:B,noResultsMessage:0===oe.length&&Z.value&&S.formatMessage(mn().s.noResults),searchInput:e=>(0,Ke.jsx)(gn().ZP,{ref:P,style:A.searchInput,right:(0,Ke.jsxs)(wt().jX,{direction:"row",style:A.actionButtonGroup,children:[ne&&p&&(0,Ke.jsx)(an().p,{disabled:s,onClick:e=>{e.stopPropagation(),p(e)},value:y}),(0,Ke.jsx)(Pe().Z,{ariaLabel:"Clear",disabled:s,disabledFeedback:s,onClick:e=>{e.stopPropagation(),D([])},style:A.clearButton,icon:dn().X,iconStyle:A.clearButtonIcon})]}),disabled:s||N,format:gn().UR.FilterValue,onChange:e=>_(e.target.value),onRemoveLastToken:L,placeholder:"",onClick:e,tokens:W,value:I}),userItems:Y,valueItems:$,pagePropertyItems:J,emailItems:te}}({action:t,formulaTypecheckContextValues:n,formulaValueContext:i,isDisabled:l,limit:s,onChange:u,onClose:d,onFormulaButtonClick:p,unlimitedCurrentSimpleFormulaValueTokens:o,value:y,pageProperties:f,parentRecordStore:v,showInputErrorStyles:x})||{},P=(0,re.useMemo)((()=>A&&m?A.map((e=>{const{annotation:t,itemAction:o}=(0,_n().A)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:o=>(0,Ke.jsx)(In().Z,{annotation:t,disabled:e.isDisabled,formulaTypecheckContextValues:n,menuArgs:o,style:{background:void 0,color:S.darkTextColor,padding:void 0},parentRecordStore:v}),action:o}})):[]),[A,m,n,S,v]),V=(0,re.useMemo)((()=>w?w.map((e=>({key:e.userId,render:t=>(0,Ke.jsx)(Kn,{annotation:e.annotation,disabled:e.isDisabled,menuArgs:t,getRecordModel:a||e.getRecordModel}),action:e.action}))):[]),[a,w]),B=[...P,...(0,re.useMemo)((()=>I?I.map((e=>({key:e.id,render:t=>(0,Ke.jsx)(Bn,{disabled:e.isDisabled,menuArgs:t,type:e.type,token:e.propertyAnnotation}),action:e.action}))):[]),[I])],R=[];B.length>0&&R.push({key:"properties",render:e=>(0,Ke.jsx)(bt().Z,{...e,title:"Property",topBorder:!1}),items:B}),V.length>0&&R.push({key:"users",render:e=>(0,Ke.jsx)(bt().Z,{...e,title:"Person",topBorder:B.length>0}),items:V});const F=(0,re.useMemo)((()=>_?_.map((e=>({key:e.email,action:e.action,render:t=>(0,Ke.jsx)(Vn,{email:e.email,disabled:e.isDisabled,menuArgs:t})}))):[]),[_]);let Z;F.length>0&&R.push({key:"emails",render:e=>(0,Ke.jsx)(bt().Z,{...e,title:"Email",topBorder:B.length>0||V.length>0}),items:F}),Z=b.isMobile?{menuType:Fo().o.Modal,right:(0,Ke.jsx)(wn().DoneMenuText,{}),minWidth:"100%"}:{menuType:Fo().o.Popup,maxHeight:"50vh",minWidth:"100%",disableHeaderBorder:!0};const E={width:"260px"},H=(0,Ke.jsxs)(Ke.Fragment,{children:[C&&(0,Ke.jsx)(bt().Z,{style:E,children:(0,Ke.jsx)(Tn().Z,{title:C})}),j&&(0,Ke.jsx)(bt().Z,{style:E,children:(0,Ke.jsx)(Tn().Z,{title:j})}),k&&(0,Ke.jsx)(bt().Z,{style:E,children:(0,Ke.jsx)(An().Z,{})}),R.length>0&&(0,Ke.jsx)(xt().ZP,{type:xt().iW.Vertical,initialFocus:0,sections:R,store:M,style:E})]});return{searchInput:T,innerComponents:H,emailRecipientsMenu:(0,Ke.jsx)(vt().Z,{...Z,...c,children:H})}}function Hn(e){const{currentValue:t,onChange:o,parentRecordStore:n,spaceId:i,formulaTypecheckContextValues:a,disabled:r}=e;return"formula"===(null==t?void 0:t.type)?(0,Ke.jsx)(On,{parentRecordStore:n,spaceId:i,value:t,formulaTypecheckContextValues:a,isDisabled:r,onChange:o}):(0,Ke.jsx)(Dn,{...e})}function Dn(e){const{currentValue:t,collectionStore:o,onChange:n,formulaTypecheckContextValues:i,limit:a,pageProperties:r,disabled:l,parentRecordStore:c,errorMessage:u}=e,d=o?{type:"collection",collectionStore:o,property:"person"}:{type:"empty"},p={menuType:Fo().o.Popup},m=(0,se().VK)((()=>(0,Rt().fromSimpleFormulaArrayValue)(null==t?void 0:t.value)),[t]),{searchInput:g,emailRecipientsMenu:h}=En({currentSimpleFormulaValueTokens:m,formulaTypecheckContextValues:i,formulaValueContext:d,limit:a,menuProps:p,onChange:n,onClose:window.parent.close,onFormulaButtonClick:e=>{e.stopPropagation(),n({type:"formula",value:null==t?void 0:t.value})},showFormulaValueItems:!0,showGenericHeader:!0,value:t,pageProperties:r,isDisabled:l,parentRecordStore:c,showInputErrorStyles:(0,s().$K)(u)});return(0,Ke.jsx)(qe().ZP,{renderOrigin:e=>{let{onClick:t}=e;return null==g?void 0:g(t)},popupType:qe().Z4.Popup,render:()=>h})}const Ln=[{type:"person"},{type:"text"},{type:"array",of:{type:"person"}},{type:"array",of:{type:"text"}}];function On(e){const{formulaTypecheckContextValues:t,parentRecordStore:o,spaceId:n,value:i,onChange:a,isDisabled:r}=e,l=(0,ce().yK)((e=>({containerWrap:{width:"100%"},formulaText:{whiteSpace:"pre-wrap",cursor:"pointer"},scroller:{flexGrow:1,width:"100%"},textWrap:{cursor:"text",display:"flex",flexWrap:"wrap",justifyContent:"end",width:"100%"},wrap:{background:e.inputBackground,boxShadow:e.inputBoxShadow,boxSizing:"border-box",cursor:"text",padding:"4px 8px"},actionButtonGroup:{alignSelf:"end",cursor:"unset",justifyContent:"end"}})),[]),s=async e=>{e.stopPropagation();await(0,Kt().bs)()&&(null==a||a({type:"simple",value:null==i?void 0:i.value}))},c=(0,se().qz)(void 0,Qe().Z),u=(0,re.useCallback)((()=>c.setState({open:!1})),[c]);return(0,Ke.jsx)(qe().ZP,{buttonPopupStore:c,renderOrigin:e=>(0,Ke.jsx)("div",{...e,style:l.containerWrap,children:(0,Ke.jsx)(wt().jX,{align:"center",className:co().Wh_,direction:"column",gap:4,style:l.wrap,children:(0,Ke.jsxs)("div",{style:l.textWrap,children:[(0,Ke.jsx)(ye().T,{style:l.scroller,type:xe().Z.Y,children:(0,Ke.jsx)("div",{style:l.formulaText,children:(0,Ke.jsx)(nn().I,{formulaTypecheckContextValues:t,parentRecordStore:o,spaceId:n,value:i})})}),(0,Ke.jsx)("div",{children:(0,Ke.jsx)(wt().jX,{direction:"row",gap:2,style:l.actionButtonGroup,children:(0,Ke.jsx)(an().p,{disabled:r,onClick:s,value:i})})})]})})}),popupType:qe().Z4.Popup,render:()=>(0,Ke.jsx)(rn().Z,{allowedReturnTypes:Ln,disabled:r,formulaTypecheckContextValues:t??[],onChange:a,onClose:u,parentRecordStore:o,value:i,spaceId:n})})}var Nn=()=>o(714230),Wn=()=>o(242550),Un=()=>o(605305),Gn=()=>o(388915),zn=()=>o(423402),$n=()=>o(18748),Yn=()=>o(286338);const qn=(0,K().vU)({gmailAccountMenuPickerHeader:{defaultMessage:"Select Account",id:"automations.gmailAccountPicker.menuHeader"},gmailAccountMenuPickerHeaderInvalidAccount:{defaultMessage:"Invalid Account",id:"automations.gmailAccountPicker.menuHeaderInvalidAccount"},gmailAccountMenuPickerHeaderInvalidAccountTooltip:{defaultMessage:"Connect a valid account or delete this step",id:"automations.gmailAccountPicker.menuHeaderInvalidAccountTooltip"},addGmailAccountLabel:{id:"automations.gmailAccountPicker.setupAnotherGmailAccount.label",defaultMessage:"Add Gmail Account"},manageAccountInfoCaption:{id:"automations.gmailAccountPicker.manageAccountInfo.caption",defaultMessage:"Manage connected accounts in the âMy Connectionsâ tab of Settings"},connectGmailAccountMobileLabel:{id:"automations.gmailAccountPicker.connectGmailAccountMobile.label",defaultMessage:"Connect Gmail Account"},connectGmailAccountMobileCaption:{id:"automations.gmailAccountPicker.connectGmailAccountMobile.caption",defaultMessage:"Open desktop or web app to connect"},connectGmailAccountLabel:{id:"automations.gmailAccountPicker.connectGmailAccount.label",defaultMessage:"Connect Gmail Account"},connectGmailAccountCaption:{id:"automations.gmailAccountPicker.connectGmailAccount.caption",defaultMessage:"Allow Notion to send email on your behalf"}});function Jn(e){const{currentGmailAuthentication:t,gmailAuthentications:o,disabled:n,errorMessage:i,onAccountChange:a}=e,r=(0,le().O7)(),l=(0,le().Fy)(),s=(0,se().VK)((()=>{var e;return null===(e=te().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),c="collection_view_settings",u=(0,se().VK)((()=>en().default.integrations.state.find((e=>e.id===qo().aG))),[]),d=Boolean(i),p=(0,se().qz)(void 0,Qe().Z),m=(0,re.useCallback)((e=>{a(e),(0,A().j)({environment:r,event:{eventName:"gmail_action_account_click",eventProperties:{}}}),p.reset()}),[a,p,r]),g=(0,je().d)(),h=(0,St().F)(),y=(0,ce().yK)((e=>({infoItem:{color:e.text.secondary,cursor:"default"},connectAccount:{paddingRight:"32px"},externalLinkIcon:{color:e.icon.tertiary,width:18,height:"auto"},plusMediumIcon:{width:16,height:"auto",marginRight:8,marginLeft:1},manageAccountCaption:{color:e.text.tertiary},errorText:{color:e.errorText}})),[]);if(!u)return null;const f=[{items:o.map(((e,o)=>({action:()=>null,key:e.id,render:()=>{const o=(null==t?void 0:t.id)===e.id;return(0,Ke.jsx)(Ye().Z,{focused:(null==t?void 0:t.id)===e.id,onClick:async()=>{if(s)if(o&&d){const e=await Xn(r,u,s,c);if("success"!==e.status)return void p.reset();m(e.externalAuthentication.id)}else m(e.id)},title:e.account_name,left:(0,Ke.jsx)(pn().Z,{avatar:{email:e.account_name},style:{marginRight:8}}),right:d?(0,qt().t)({width:12,height:"auto",marginLeft:12}):(0,Wn().A)({width:18,height:"auto",marginLeft:12}),rightStyle:{visibility:o?"visible":"hidden"},style:{...o&&d&&y.errorText},bodyStyle:{minWidth:"280px"}},e.id)}}))),key:"gmailAccounts",render:e=>(0,Ke.jsx)(bt().Z,{topBorder:!0,...e,enableActionSheetTitle:!0})}];f.push({key:"add-another-gmail-account-section",items:[{key:"add-another-gmail-account-item",action:async()=>{if(!s)return;const e=await Xn(r,u,s,c);"success"===e.status&&(a(e.externalAuthentication.id),p.reset())},render:e=>(0,Ke.jsx)(Ye().Z,{...e,left:(0,ze().A)(y.plusMediumIcon),right:(0,Un().K)(y.externalLinkIcon),title:(0,Ke.jsx)(K()._H,{...qn.addGmailAccountLabel}),bodyStyle:{marginLeft:1}})}],render:e=>(0,Ke.jsx)(bt().Z,{...e,topBorder:!0})}),f.push({key:"manage-account-info-section",items:[{key:"manage-account-info-item",action:()=>null,render:e=>(0,Ke.jsx)(Ye().Z,{...e,style:y.infoItem,focused:!1,caption:(0,Ke.jsx)($n().W0,{caption:(0,Ke.jsx)(K()._H,{...qn.manageAccountInfoCaption}),shouldWrapCaption:!0,captionStyle:y.manageAccountCaption})})}],render:e=>(0,Ke.jsx)(bt().Z,{...e,topBorder:!0})});const v={key:"connect-gmail-account-mobile-item",action:()=>null,render:e=>(0,Ke.jsx)(Ye().Z,{...e,icon:(0,Ke.jsx)("img",{src:Nn().Z.images.externalIntegrations.gmailIconPng,style:{width:18,height:"auto"}}),focused:!1,disabled:!0,buttonStyle:y.connectAccount,title:(0,Ke.jsx)(K()._H,{...qn.connectGmailAccountMobileLabel}),caption:(0,Ke.jsx)($n().W0,{caption:(0,Ke.jsx)(K()._H,{...qn.connectGmailAccountMobileCaption}),shouldWrapCaption:!0})})},x={key:"connect-gmail-account-item",action:async()=>{if(p.reset(),!s)return;const e=await Xn(r,u,s,c);"success"===e.status&&a(e.externalAuthentication.id)},render:e=>(0,Ke.jsx)(Ye().Z,{...e,icon:(0,Ke.jsx)("img",{src:Nn().Z.images.externalIntegrations.gmailIconPng,style:{width:18,height:"auto"}}),focused:!1,buttonStyle:y.connectAccount,title:(0,Ke.jsx)(K()._H,{...qn.connectGmailAccountLabel}),caption:(0,Ke.jsx)($n().W0,{caption:(0,Ke.jsx)(K()._H,{...qn.connectGmailAccountCaption}),shouldWrapCaption:!0})})},b=[{key:"connectGmailAccount",items:[l.isMobile?v:x],render:e=>(0,Ke.jsx)(bt().Z,{topBorder:!0,...e,enableActionSheetTitle:!0})}];return(0,Ke.jsx)(qe().ZP,{buttonPopupStore:p,popupType:g,alignmentToOrigin:qe().vR.End,placementToOrigin:qe().pO.Bottom,originGap:0,disabled:n,renderOrigin:e=>(0,Ke.jsx)(gt().S,{...e,disabled:n,isCompact:!0,isError:d,hasActionRequired:!Boolean(t),dropdownButtonType:"dropdown",children:t?(0,Ke.jsx)(Be().Z,{renderTooltip:()=>i,disableTooltip:!d,render:e=>(0,Ke.jsx)("span",{...e,children:null==t?void 0:t.account_name})}):(0,Ke.jsx)(Be().Z,{renderTooltip:()=>(0,Ke.jsx)(K()._H,{...qn.gmailAccountMenuPickerHeaderInvalidAccountTooltip}),disableTooltip:!d,render:e=>(0,Ke.jsx)("span",{...e,children:(0,Ke.jsx)(K()._H,{...d?qn.gmailAccountMenuPickerHeaderInvalidAccount:qn.gmailAccountMenuPickerHeader})})})}),render:e=>(0,Ke.jsx)(vt().Z,{...h,children:(0,Ke.jsx)(xt().ZP,{type:xt().iW.Vertical,sections:0===o.length?b:f,initialFocus:0})})})}async function Xn(e,t,o,n){const i=await Gn().hM({environment:e,integration:t,spaceId:o,from:n,preventRedirectToLastVisitedPage:(0,Yn().Xj)()});return l().x.isFail(i)?{status:"failure"}:i.value.externalAuthentication?{externalAuthentication:i.value.externalAuthentication,status:"success"}:(await zn().pJ({environment:e}),{status:"re-auth"})}const Qn=(0,K().vU)({toLabel:{defaultMessage:"To",id:"automations.SendGmailNotificationAction.toLabel"},ccLabel:{defaultMessage:"CC",id:"automations.SendGmailNotificationAction.ccLabel"},bccLabel:{defaultMessage:"BCC",id:"automations.SendGmailNotificationAction.bccLabel"},replyToLabel:{defaultMessage:"Send replies to",id:"automations.SendGmailNotificationAction.replyToLabel"},fromNameLabel:{defaultMessage:"Send with display name",id:"automations.SendGmailNotificationAction.fromNameLabel"},subjectLabel:{defaultMessage:"Subject",id:"automations.SendGmailNotificationAction.subjectLabel"},bodyLabel:{defaultMessage:"Message",id:"automations.SendGmailNotificationAction.bodyLabel"},gmailAccountPickerHidden:{defaultMessage:"Hidden",id:"automations.SendGmailNotificationAction.gmailAccountPickerHidden"}}),ei=["subject","body","fromName"],ti={cc:!1,bcc:!1,replyTo:!1,displayName:!1},oi={displayName:!1,replyTo:!1},ni={cc:Qn.ccLabel.defaultMessage,bcc:Qn.bccLabel.defaultMessage,replyTo:Qn.replyToLabel.defaultMessage,displayName:Qn.fromNameLabel.defaultMessage};function ii(e){var t,o,n,i,l,c,u,d,p,m,y,f,v,x,b;const{actionStore:C,currentGmailAuthentication:k,gmailAuthentications:M}=e,{automationStore:j,contextType:T}=(0,Se().YC)(),{disabled:A,maybePersistedTransactionActions:_,suppressActionErrors:P}=(0,Oe().i)(),V=(0,tn().w)(j,T),B=(0,se().VK)((()=>Boolean(A)),[A]),R=(0,a().getActionRegistryItem)("send_gmail_notification"),F=(0,se().VK)((()=>C.getSpaceId()),[C]),Z=(0,se().VK)((()=>{var e,t,o,n;return{to:null==C||null===(e=C.getConfig())||void 0===e?void 0:e.to,cc:null==C||null===(t=C.getConfig())||void 0===t?void 0:t.cc,bcc:null==C||null===(o=C.getConfig())||void 0===o?void 0:o.bcc,reply_to:null==C||null===(n=C.getConfig())||void 0===n?void 0:n.reply_to}}),[C]),[E,H]=(0,re.useState)(ti),[D,L]=(0,re.useState)(oi),O=(0,le().O7)();on(Object.values(Z).flatMap((e=>{var t;return(null==e||null===(t=e.value)||void 0===t?void 0:t.value)||[]})));const{actionId:N,currentFromName:U,currentSubject:G,currentBody:z,externalBotId:$}=(0,se().VK)((()=>{var e,t,o;return{currentFromName:null===(e=C.getConfig())||void 0===e?void 0:e.from_name,currentSubject:null===(t=C.getConfig())||void 0===t?void 0:t.email_subject,currentBody:null===(o=C.getConfig())||void 0===o?void 0:o.email_body,actionId:C.id,externalBotId:C.getConfigStore().getKeyStore("external_bot_id").getValue()}}),[C]);(0,Lt().K)((()=>{H((e=>{var t,o,n;return{...e,cc:Boolean(null==Z||null===(t=Z.cc)||void 0===t||null===(t=t.value)||void 0===t?void 0:t.value),bcc:Boolean(null==Z||null===(o=Z.bcc)||void 0===o||null===(o=o.value)||void 0===o?void 0:o.value),replyTo:Boolean(null==Z||null===(n=Z.reply_to)||void 0===n||null===(n=n.value)||void 0===n?void 0:n.value),displayName:Boolean(null==U?void 0:U.value)}}))}));const Y=(0,mt().z)({actionId:N}),{value:J}=(0,Xe().XJ)(w().F.formulas),X=function(e,t){return(0,se().VK)((()=>t&&e?r().oA(Object.entries(e.getSchema()).map((e=>{let[t,o]=e;const n=new Set(["person","email"]),i=null==o?void 0:o.type;if(!i)return;return n.has(i)||"rollup"===i&&o.target_property_type&&n.has(o.target_property_type)?(0,h().kbv)({contextValueId:(0,Yo().Vl)(),name:o.name,property:t,valueSnapshot:"current"}):void 0}))):[]),[e,t])}(V,(0,re.useMemo)((()=>{if(J)return Y.filter((e=>(null==e?void 0:e.kind)===g().FormulaContextValueKind.ContextValue)).find((e=>(null==e?void 0:e.id)===(0,Yo().Vl)()))}),[Y,J])),Q=(0,se().qz)(void 0,Qe().Z),ee=(0,re.useCallback)((()=>Q.reset()),[Q]),te=(0,re.useMemo)((()=>(0,Ke.jsx)(st().e,{actionStore:C,closeMenu:ee})),[C,ee]),oe=(0,re.useMemo)((()=>!P.includes(C.id)),[P,C]),ne=function(e){const{actionId:t,shouldShowError:o}=e,n={};return n.external_bot_id=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"external_bot_id"}),n.to=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"to"}),n.cc=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"cc"}),n.bcc=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"bcc"}),n.reply_to=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"reply_to"}),n.email_body=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"email_body"}),n.email_subject=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"email_subject"}),n}({actionId:C.id,shouldShowError:oe}),ie=(0,ae().useRequiresSubscriptionUpgradeError)({actionId:C.id,shouldShow:oe}),pe=Boolean(ie),me=(0,it().E)("automation_updated_error_states"),ge=(0,re.useMemo)((()=>{if(me)return Object.values(ne).filter((e=>(0,s().$K)(e.errorMessage)))[0]}),[ne,me]),he=(0,re.useCallback)((e=>{const t=en().default.externalAuthentications.state.find((t=>t.integration_id===qo().aG&&t.id===e)),o=$!==(null==t?void 0:t.id);t&&o&&_.createAndCommit({perform:e=>{q().sW({data:{external_bot_id:t.id},store:C.getConfigStore(),transaction:e})},userAction:"SendGmailNotificationAction.setExternalBotId"})}),[C,$,_]);(0,se().VK)((()=>{$||1===M.length&&he(M[0].id)}),[M,he,$]);const ye=(0,re.useCallback)((e=>t=>{if(!t)return;if("formula"===t.type)return void _.createAndCommit({perform:o=>{q().sW({data:{[e]:{type:"formula",value:t}},store:C.getConfigStore(),transaction:o})},userAction:"SendGmailNotificationAction.setRecipient.formula"});const o=(0,h().lzi)(t.value).filter((e=>{const t=(0,h().lcG)([e]);if(0===t.length)return!0;return!new(W().U6)(O,{table:S().KJ,id:t[0]},{userId:t[0]}).getIsDeleted()}));_.createAndCommit({perform:t=>{q().sW({data:{[e]:{type:"formula",value:{type:"simple",value:o}}},store:C.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setRecipient.simple"}),(0,at().yE)(O,{automationStore:j,automationActionStore:C})}),[C,_,O,j]),fe=(0,re.useCallback)((e=>{_.createAndCommit({perform:t=>{q().sW({data:{from_name:e},store:C.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setFromName"}),(0,at().yE)(O,{automationStore:j,automationActionStore:C})}),[C,_,O,j]),ve=(0,re.useCallback)((e=>{_.createAndCommit({perform:t=>{q().sW({data:{email_subject:e},store:C.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setSubject"}),(0,at().yE)(O,{automationStore:j,automationActionStore:C})}),[C,_,O,j]),xe=(0,re.useCallback)((e=>{_.createAndCommit({perform:t=>{q().sW({data:{email_body:e},store:C.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setBody"}),(0,at().yE)(O,{automationStore:j,automationActionStore:C})}),[C,_,O,j]),{onTextStoreSelect:be,onTextStoreUnselect:Ce}=(0,Zt().w)(C),ke=(0,se().VK)((()=>{if(!J||!F)return{};const{createFormulaDataRequestSyncHandler:e}=J,t={subject:G,body:z,fromName:U};return Object.fromEntries(ei.map((o=>{const n=t[o];return n?[o,(0,Rt().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:e(C.getRecordModel),spaceId:F,valueTypes:Y.slice(0),featureGates:(0,I().W)()},value:n})]:[o,""]})))}),[C.getRecordModel,G,z,U,Y,J,F]),Me=(0,re.useCallback)(((e,t)=>{e.stopPropagation(),e.preventDefault(),H((e=>({...e,[t]:!0}))),"displayName"===t&&L((e=>({...e,displayName:!1})))}),[]),je=(0,re.useCallback)((e=>{L((t=>({...t,[e]:!t[e]})))}),[]),Te=(0,re.useCallback)((e=>{var t,o,n;return!("displayName"!==e||null==U||!U.value)||(!("cc"!==e||null==Z||null===(t=Z.cc)||void 0===t||null===(t=t.value)||void 0===t||!t.value)||(!("bcc"!==e||null==Z||null===(o=Z.bcc)||void 0===o||null===(o=o.value)||void 0===o||!o.value)||!("replyTo"!==e||null==Z||null===(n=Z.reply_to)||void 0===n||null===(n=n.value)||void 0===n||!n.value)))}),[U,Z]),we=(0,re.useCallback)((async(e,t)=>{e.stopPropagation(),e.preventDefault();if(Te(t)){if(!(await(0,Qo().n8)({fieldName:`"${ni[t]}"`})))return}"displayName"===t&&fe(void 0),"cc"!==t&&"bcc"!==t||ye(t)({type:"simple",value:void 0}),"replyTo"===t&&ye("reply_to")({type:"simple",value:void 0}),H((e=>({...e,[t]:!1})))}),[fe,Te,ye]),Ae=(0,re.useCallback)((()=>{de().clear({environment:O})}),[O]),{isMobile:Ie}=(0,le().Fy)(),_e=(0,ce().yK)((e=>{var t;const o={color:e.text.secondary,fontSize:Ie?ue().JB.UIRegular.mobile:ue().JB.UIRegular.desktop,lineHeight:Ie?ue().Nv.UIRegular.mobile:ue().Nv.UIRegular.desktop,fontWeight:ue().Ue.regular};return{inputLabel:{...o},toInputLabel:{...o,...me&&(0,s().$K)(null===(t=ne.to)||void 0===t?void 0:t.errorMessage)&&{color:e.text.uiRedPrimary,fontWeight:ue().Ue.medium}},toErrorLabel:{color:e.text.uiRedPrimary},toggleableInputLabel:{...o,cursor:"pointer",padding:2,transform:"translateX(-2px)",display:"flex",width:"fit-content"},toggleableInputLabelHovered:{...o,cursor:"pointer",backgroundColor:e.buttonHoveredBackground,transform:"translateX(-2px)",display:"flex",width:"fit-content",borderRadius:"4px",padding:2},messageInput:{width:"100%"},replyToInputContainer:{display:"flex",justifyContent:"space-between"},replyToInputField:{width:"100%",fontSize:Ie?ue().JB.UIRegular.mobile:ue().JB.UIRegular.desktop},ccBccToggle:{padding:"6px 12px",color:e.lightTextColor,borderRadius:"6px",marginLeft:8,alignSelf:"flex-start"},container:{overflow:"visible"},toggleFieldGridContainer:{display:"grid",gridTemplateRows:"auto auto",gridTemplateColumns:"1fr auto",alignItems:"center",columnGap:8,rowGap:6},toggleFieldGridLabel:{gridRow:"1",gridColumn:"1"},toggleFieldGridInput:{gridRow:"2",gridColumn:"1"},toggleFieldGridTrashIconButton:{gridRow:"2",gridColumn:"2",alignSelf:"flex-start",height:32,width:32},toggleFieldTrashIconButtonForTextInput:{gridRow:"1",gridColumn:"2",alignSelf:"flex-start",marginTop:26,height:32,width:32},trashIcon:{width:16,height:16}}}),[ne,me,Ie]);function Ve(e,t){return e||t?!e&&t?_e.toggleableInputLabelHovered:_e.inputLabel:_e.toggleableInputLabel}if(!F)return null;const Be={collectionStore:V,limit:li,disabled:B,formulaTypecheckContextValues:Y,spaceId:F,pageProperties:X};return(0,Ke.jsxs)(Mt().Ao,{actionMenu:te,buttonPopupStore:Q,disabled:B,actionId:C.id,canCollapse:!pe,hideDragHandle:pe,children:[(0,Ke.jsx)(Mt().vu,{actionId:C.id,actionRegistryItem:R,disabled:B,errorMessage:ie||(null==ge?void 0:ge.errorMessage),styles:{headerWrap:{paddingRight:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,Ke.jsx)(ai,{currentGmailAuthentication:k,gmailAuthentications:M,disabled:B,isError:pe,onGmailAccountChange:he,accountPickerErrorMessage:null===(t=ne.external_bot_id)||void 0===t?void 0:t.errorMessage})}),k&&(0,Ke.jsx)(Mt().R7,{children:(0,Ke.jsxs)(wt().jX,{direction:"column",gap:16,children:[(0,Ke.jsxs)(wt().jX,{direction:"column",gap:6,children:[(0,Ke.jsx)("label",{style:_e.toInputLabel,children:(0,Ke.jsx)(K()._H,{...Qn.toLabel})}),(0,Ke.jsxs)("div",{className:"to-input-and-ccBcc-container",style:_e.replyToInputContainer,children:[(0,Ke.jsx)(ri,{...Be,recipients:null==Z||null===(o=Z.to)||void 0===o?void 0:o.value,onChange:ye("to"),errorMessage:null===(n=ne.to)||void 0===n?void 0:n.errorMessage,style:_e.replyToInputField}),(!E.cc||!E.bcc)&&(0,Ke.jsx)(Xo().Z,{onClick:e=>{E.cc||Me(e,"cc"),E.bcc||Me(e,"bcc")},style:_e.ccBccToggle,children:E.cc||E.bcc?(0,Ke.jsx)(K()._H,{id:"automations.SendGmailNotificationAction.ccOrBccToggleLabel",defaultMessage:"{showCCLabel, select, true {CC} other {BCC}}",values:{showCCLabel:!E.cc&&E.bcc}}):(0,Ke.jsx)(K()._H,{id:"automations.SendGmailNotificationAction.ccAndBccToggleLabel",defaultMessage:"CC/BCC"})})]}),me&&(0,s().$K)(null===(i=ne.to)||void 0===i?void 0:i.errorMessage)&&(0,Ke.jsx)(xo().q,{colorName:"secondary",styleName:"UISmall-12px/Regular",style:_e.toErrorLabel,children:(0,Ke.jsx)(K()._H,{...null===(l=ne.to)||void 0===l?void 0:l.errorMessageDescriptor})})]}),E.cc&&(0,Ke.jsx)(wt().jX,{direction:"column",gap:16,children:(0,Ke.jsxs)("div",{style:_e.toggleFieldGridContainer,children:[(0,Ke.jsxs)("label",{style:_e.inputLabel,children:[(0,Ke.jsx)(K()._H,{...Qn.ccLabel}),(0,Ke.jsx)(So,{})]}),(0,Ke.jsx)(ri,{...Be,recipients:null==Z||null===(c=Z.cc)||void 0===c?void 0:c.value,onChange:ye("cc"),errorMessage:null===(u=ne.cc)||void 0===u?void 0:u.errorMessage,style:_e.toggleFieldGridInput}),(0,Ke.jsx)(Pe().Z,{icon:Gt().y,ariaLabel:"Remove Field",onClick:e=>we(e,"cc"),style:_e.toggleFieldGridTrashIconButton,iconStyle:_e.trashIcon})]})}),E.bcc&&(0,Ke.jsx)(wt().jX,{direction:"column",gap:16,children:(0,Ke.jsxs)("div",{style:_e.toggleFieldGridContainer,children:[(0,Ke.jsxs)("label",{style:{..._e.inputLabel},children:[(0,Ke.jsx)(K()._H,{...Qn.bccLabel}),(0,Ke.jsx)(So,{})]}),(0,Ke.jsx)(ri,{...Be,recipients:null==Z||null===(d=Z.bcc)||void 0===d?void 0:d.value,onChange:ye("bcc"),errorMessage:null===(p=ne.bcc)||void 0===p?void 0:p.errorMessage,style:_e.toggleFieldGridInput}),(0,Ke.jsx)(Pe().Z,{icon:Gt().y,ariaLabel:"Remove Field",onClick:e=>we(e,"bcc"),style:_e.toggleFieldGridTrashIconButton,iconStyle:_e.trashIcon})]})}),(0,Ke.jsx)(bo,{disabled:B,disableMobileActionBar:!1,disableNewLines:!0,disableStyleAnnotations:!0,disableTemplateVariableMentions:!1,formulaTypecheckContextValues:Y,onChange:ve,onTextStoreSelect:be,onTextStoreUnselect:Ce,onTextEsc:Ae,parentRecordStore:C,spaceId:F,style:_e.messageInput,value:G,analyzedFormulaOutput:ke.subject,labelMessageDescriptor:Qn.subjectLabel,errorMessageDescriptor:null===(m=ne.email_subject)||void 0===m?void 0:m.errorMessageDescriptor,shouldShowErrorStyles:me&&(0,s().$K)(null===(y=ne.email_subject)||void 0===y?void 0:y.errorMessage)}),(0,Ke.jsx)(bo,{disabled:B,disableMobileActionBar:!1,disableTemplateVariableMentions:!1,formulaTypecheckContextValues:Y,onChange:xe,onTextStoreSelect:be,onTextStoreUnselect:Ce,onTextEsc:Ae,parentRecordStore:C,rows:4,spaceId:F,style:_e.messageInput,value:z,analyzedFormulaOutput:ke.body,labelMessageDescriptor:Qn.bodyLabel,errorMessageDescriptor:null===(f=ne.email_body)||void 0===f?void 0:f.errorMessageDescriptor,shouldShowErrorStyles:me&&(0,s().$K)(null===(v=ne.email_body)||void 0===v?void 0:v.errorMessage)}),!E.displayName&&(0,Ke.jsx)("label",{children:(0,Ke.jsxs)("span",{onClick:e=>Me(e,"displayName"),onMouseEnter:()=>je("displayName"),onMouseLeave:()=>je("displayName"),style:Ve(E.displayName,D.displayName),children:[(0,Ke.jsx)(K()._H,{...Qn.fromNameLabel}),"..."]})}),E.displayName&&(0,Ke.jsxs)("div",{style:{..._e.toggleFieldGridContainer,rowGap:0},children:[(0,Ke.jsx)("div",{style:_e.toggleFieldGridLabel,children:(0,Ke.jsx)(bo,{disabled:B,disableMobileActionBar:!1,disableTemplateVariableMentions:!1,formulaTypecheckContextValues:Y,disableNewLines:!0,disableStyleAnnotations:!0,onChange:fe,onTextStoreSelect:be,onTextStoreUnselect:Ce,onTextEsc:Ae,parentRecordStore:C,rows:1,spaceId:F,value:U,analyzedFormulaOutput:ke.fromName,labelMessageDescriptor:Qn.fromNameLabel,isOptional:!0})}),(0,Ke.jsx)(Pe().Z,{icon:Gt().y,ariaLabel:"Remove Field",onClick:e=>we(e,"displayName"),style:_e.toggleFieldTrashIconButtonForTextInput,iconStyle:_e.trashIcon})]}),(0,Ke.jsxs)("div",{style:_e.toggleFieldGridContainer,children:[(0,Ke.jsx)("label",{style:_e.toggleFieldGridLabel,children:(0,Ke.jsxs)("span",{onClick:e=>Me(e,"replyTo"),onMouseEnter:()=>je("replyTo"),onMouseLeave:()=>je("replyTo"),style:Ve(E.replyTo,D.replyTo),children:[(0,Ke.jsx)(K()._H,{...Qn.replyToLabel}),!E.replyTo&&"...",E.replyTo&&(0,Ke.jsx)(So,{})]})}),E.replyTo&&(0,Ke.jsxs)(Ke.Fragment,{children:[(0,Ke.jsx)(ri,{...Be,recipients:null==Z||null===(x=Z.reply_to)||void 0===x?void 0:x.value,onChange:ye("reply_to"),errorMessage:null===(b=ne.reply_to)||void 0===b?void 0:b.errorMessage,limit:1,style:_e.toggleFieldGridInput}),(0,Ke.jsx)(Pe().Z,{icon:Gt().y,ariaLabel:"Remove Field",onClick:e=>we(e,"replyTo"),style:_e.toggleFieldGridTrashIconButton,iconStyle:_e.trashIcon})]})]})]})})]})}function ai(e){const{currentGmailAuthentication:t,gmailAuthentications:o,disabled:n,isError:i,onGmailAccountChange:a,accountPickerErrorMessage:r}=e,l=(0,ce().yK)((()=>({b:{fontWeight:ue().Ue.medium},picker:{display:"inline-flex",minWidth:50,marginLeft:4},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,flexWrap:"wrap",gap:6}})),[]),s=function(){const{isMobile:e}=(0,le().Fy)(),t=e?ue().JB.UISmall.mobile:ue().JB.UISmall.desktop;return(0,ce().yK)((()=>({container:{alignItems:"baseline",display:"inline-flex",gap:2,minWidth:50,width:"100%"},lockIcon:{alignSelf:"center",height:"auto",width:t}})),[t])}();return i?(0,Ke.jsx)("div",{style:l.title,children:(0,Ke.jsx)(K()._H,{defaultMessage:"Send mail",id:"automations.SendGmailNotificationAction.header.titleError"})}):(0,Ke.jsx)("div",{style:l.title,children:(0,Ke.jsx)(K()._H,{defaultMessage:"Send mail from{gmailAccountPicker}",id:"automations.SendGmailNotificationAction.header.title",values:{gmailAccountPicker:n?(0,Ke.jsxs)("div",{style:s.container,children:[(0,Jo().b)(s.lockIcon),(0,Ke.jsx)("span",{style:ue().Yu,children:(0,Ke.jsx)(K()._H,{...Qn.gmailAccountPickerHidden})})]}):(0,Ke.jsx)(Jn,{currentGmailAuthentication:t,gmailAuthentications:o,disabled:n,onAccountChange:a,errorMessage:r})}})})}function ri(e){const{recipients:t,style:o,collectionStore:n,...i}=e,{automationStore:a}=(0,Se().YC)();return(0,Ke.jsx)("div",{style:o,children:(0,Ke.jsx)(Hn,{currentValue:t,collectionStore:n,parentRecordStore:a,...i})})}const li=20;var si=()=>o(307473);const ci=(0,K().vU)({defaultMenuHeader:{defaultMessage:"Select people",id:"automationPersonPicker.defaultMenuHeaderMessage"},personValuePickerPlaceholder:{defaultMessage:"Select up to {maxSelected} people...",id:"automations.personPicker.buttonPlaceholder"}});function ui(e){const{currentValue:t,collectionStore:o,disabled:n,onChange:i,formulaTypecheckContextValues:a,menuHeader:r,limit:l,errorMessage:s,parentRecordStore:c,spaceId:u,style:d}=e,p={type:"person_array"},m=(0,K().YB)(),g=o?{type:"collection",collectionStore:o,property:"person"}:{type:"empty"},h={menuType:Fo().o.Popup,header:(0,Ke.jsx)(bt().Z,{style:{paddingBottom:0},title:r?m.formatMessage(r):m.formatMessage(ci.defaultMenuHeader)})};return(0,Ke.jsx)(si().e,{allowedReturnTypes:ko().Y_.person,formulaTypecheckContextValues:a,disabled:n,simpleFormulaContext:g,onChange:i,type:p,value:t,menuProps:h,placeholder:l?m.formatMessage(ci.personValuePickerPlaceholder,{maxSelected:l}):void 0,limit:l,errorMessage:s,parentRecordStore:c,spaceId:u,style:d})}var di=()=>o(61313);const pi=(0,K().vU)({property:{id:"automationAction.sendInAppNotification.targetType.property",defaultMessage:"Person property"},formula:{id:"automationAction.sendInAppNotification.targetType.formula",defaultMessage:"Specific people"},default:{id:"automations.targetPicker.targetTypePlaceholder",defaultMessage:"Select recipients"}});function mi(e){const{disabled:t,errorMessage:o,selectedTargetType:n,onSelectedTargetTypeChange:i}=e,a=(0,se().qz)(void 0,Qe().Z),r=(0,je().d)(),l=(0,it().E)("automation_updated_error_states"),s=(0,re.useCallback)((e=>{e!==n&&(i(e),a.reset())}),[i,a,n]);return(0,Ke.jsx)(qe().ZP,{buttonPopupStore:a,popupType:r,alignmentToOrigin:qe().vR.End,placementToOrigin:qe().pO.Bottom,originGap:0,disabled:t,renderOrigin:e=>(0,Ke.jsx)(gt().S,{...e,disabled:t,isCompact:!0,isError:Boolean(o),hasActionRequired:!Boolean(n),tooltipMessage:!l&&o,dropdownButtonType:"dropdown",children:n?(0,Ke.jsx)(K()._H,{...pi[n]}):(0,Ke.jsx)(K()._H,{...pi.default})}),render:e=>(0,Ke.jsx)(gi,{handleChange:s,selectedTargetType:n})})}function gi(e){const{handleChange:t}=e,o=(0,St().F)(),n=[(0,re.useMemo)((()=>({action:()=>null,key:"selectUsers",render:e=>(0,Ke.jsx)(Ye().Z,{...e,onClick:()=>t("formula"),title:(0,Ke.jsx)(K()._H,{...pi.formula})})})),[t]),(0,re.useMemo)((()=>({action:()=>null,key:"selectPersonProperty",render:e=>(0,Ke.jsx)(Ye().Z,{...e,onClick:()=>t("property"),title:(0,Ke.jsx)(K()._H,{...pi.property})})})),[t])].filter(s().$K);if(0===n.length)return null;const i={items:n,key:"targetType",render:e=>(0,Ke.jsx)(bt().Z,{topBorder:!0,...e,enableActionSheetTitle:!0})};return(0,Ke.jsx)(vt().Z,{...o,children:(0,Ke.jsx)(xt().ZP,{type:xt().iW.Vertical,sections:[i],initialFocus:0})})}const hi=(0,K().vU)({notificationMessageLabel:{defaultMessage:"Message",id:"automations.BaseModalAction.notificationMessageLabel"},personPropertyTargetTypeLabel:{defaultMessage:"Property",id:"automations.SendInAppNotificationAction.personPropertyTargetTypeLabel"},usersTargetTypeLabel:{defaultMessage:"People",id:"automations.SendInAppNotificationAction.usersTargetTypeLabel"},propertyPickerPlaceholder:{defaultMessage:"Select a property",id:"automations.SendInAppNotificationAction.propertyPickerPlaceholder"},personValuePickerMenuHeader:{defaultMessage:"Send notification to",id:"automations.personPicker.menuHeader"}});function yi(e){const{noCollection:t,targetsErrorMessage:o,selectedTargetType:n,disabled:i,onTargetTypeChange:a}=e;return t?(0,Ke.jsx)(K()._H,{defaultMessage:"Send notification to specific people",id:"automations.SendInAppNotificationAction.header.titleButtonBlock",values:{placeholder:"specific people"}}):(0,Ke.jsx)(K()._H,{defaultMessage:"Send notification to{targetTypePicker}",id:"automations.SendInAppNotificationAction.header.title",values:{targetTypePicker:(0,Ke.jsx)(mi,{onSelectedTargetTypeChange:a,disabled:i,errorMessage:o,selectedTargetType:n})}})}function fi(e){const{isError:t,isMobile:o,selectedTargetType:n}=e,i=(0,ce().yK)((e=>({inputLabel:{color:t?e.text.uiRedPrimary:e.text.secondary,fontSize:o?ue().JB.UIRegular.mobile:ue().JB.UIRegular.desktop,lineHeight:o?ue().Nv.UIRegular.mobile:ue().Nv.UIRegular.desktop,fontWeight:ue().Ue.regular}})),[t,o]),a=(0,se().VK)((()=>{switch(n){case"property":return hi.personPropertyTargetTypeLabel;case"formula":return hi.usersTargetTypeLabel;default:(0,s().t1)(n)}}),[n]);return(0,Ke.jsx)("label",{style:i.inputLabel,children:(0,Ke.jsx)(K()._H,{...a})})}const vi=20;function xi(e){const{collectionStore:t,currentProperties:o,currentTargetValue:n,disabled:i,errorMessage:a,formulaTypecheckContextValues:r,onTargetValueChange:l,parentRecordStore:c,spaceId:u}=e,d=n.type;switch(d){case"formula":return(0,Ke.jsx)(ui,{collectionStore:t,currentValue:n.value,disabled:Boolean(i),onChange:e=>l({type:"formula",value:e}),parentRecordStore:c,formulaTypecheckContextValues:r,menuHeader:hi.personValuePickerMenuHeader,limit:vi,errorMessage:a,spaceId:u,style:{width:"100%"}});case"property":return t?(0,Ke.jsx)(di().X,{availablePropertyIds:o,currentValue:n.propertyId,collectionStore:t,onChange:e=>l({type:"property",propertyId:e}),disabled:Boolean(i),alreadyHaveProperties:Boolean(n.propertyId),placeholderMessage:hi.propertyPickerPlaceholder,errorMessage:a}):null;default:(0,s().t1)(d)}}function bi(e,t){if("formula"===t.type||!(0,s().$K)(t.value))return{type:"simple",value:void 0};const o=t.value.filter((t=>{if(!(0,h().km_)(t))return!1;const o=(0,h().hDy)(t),n=(0,h().hH9)(o);if(n){const t=(0,h().zEN)(n);return!new(W().U6)(e,{id:t,table:S().KJ},{userId:t}).getIsDeleted()}return(0,h().sP4)(o)}));return{type:"simple",value:(0,Rt().toSimpleFormulaArrayValue)((0,Rt().filterTextValueToSimpleFormulaValueTokens)(o))}}o(228244);var Si=()=>o(869963),Ci=()=>o(251932),ki=()=>o(747381);const Mi=(0,K().vU)({addCustomHeader:{defaultMessage:"Add custom header",id:"automations.BaseModalAction.addCustomHeader"},customHeaderKeyLabel:{defaultMessage:"Key",id:"automations.BaseModalAction.customHeaderKeyLabel"},customHeaderValueLabel:{defaultMessage:"Value",id:"automations.BaseModalAction.customHeaderValueLabel"},removeCustomHeaderAriaLabel:{defaultMessage:"Remove custom header",id:"automations.BaseModalAction.removeCustomHeaderAriaLabel"}});function ji(e){const{actionStore:t}=e,o=(0,K().YB)(),n=Li(),{suppressActionErrors:i}=(0,Oe().i)(),{typecheckResult:a}=(0,Se().YC)(),[r,s]=(0,re.useState)(new Set),[c,u]=(0,re.useState)((()=>new(ki().Z))),d=(0,se().VK)((()=>{if(!l().x.isSuccess(a))return new(ki().Z);const e=i.includes(t.id),o=a.value.actionValidationFailures[t.id]||[],n=new(ki().Z);return o.forEach((t=>{if("empty_custom_header_field"===t.type){const[o,i,a]=t.key;n.set({id:i,field:a},!e&&!r.has(i)||(c.get({id:i,field:a})||!1))}})),n}),[a,i,t.id,c,r]),{maybePersistedTransactionActions:p}=(0,Oe().i)(),m=(0,ce().yK)((()=>({customHeadersContainer:{display:"flex",flexDirection:"column",gap:12,marginTop:12},customHeaderInputsContainer:{display:"grid",gridTemplateRows:"auto auto",gridTemplateColumns:"1fr 1fr auto",alignItems:"center",columnGap:8,rowGap:4},customHeaderKeyLabel:{...n.inputLabel,gridRow:1,gridColumn:1},customHeaderValueLabel:{...n.inputLabel,gridRow:1,gridColumn:2},customHeaderKeyInput:{...n.input,gridRow:2,gridColumn:1},customHeaderValueInput:{...n.input,gridRow:2,gridColumn:2},customHeaderRemoveButton:{gridRow:2,gridColumn:3,width:32,height:32},customHeaderRemoveButtonIcon:{width:18,height:18},addCustomHeaderButton:{marginLeft:-8,marginTop:8}})),[n]),g=(0,se().VK)((()=>t.getConfigStore().getKeyStore("customHeaders")),[t]),h=(0,se().VK)((()=>(g.getValue()||[]).map((e=>({...e,id:e.id||(0,It().ZP)()})))),[g]),y=(0,re.useCallback)(((e,t)=>()=>{const o=new(ki().Z)({from:c.entries()});o.set({id:e,field:t},!0),u(o)}),[c]),f=(0,re.useCallback)(((e,t)=>o=>{const n=(g.getValue()||[]).map((n=>n.id===e?{...n,[t]:o}:n));p.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:e=>{q().sO({store:g,transaction:e,value:n})}})}),[g,p]),v=(0,re.useCallback)((()=>{p.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:e=>{const t={id:(0,It().ZP)(),key:"",value:""};q().sO({store:g,transaction:e,value:[...h,t]}),s((e=>{const o=new Set(e);return o.add(t.id),o}))}})}),[h,g,p]),x=(0,re.useCallback)((e=>()=>{const t=h.filter((t=>t.id!==e));p.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:e=>{q().sO({store:g,transaction:e,value:t})}})}),[h,g,p]),b=h.length>0&&(0,Ke.jsx)("div",{style:m.customHeadersContainer,children:h.map((e=>(0,Ke.jsxs)("div",{style:m.customHeaderInputsContainer,children:[(0,Ke.jsx)("label",{style:m.customHeaderKeyLabel,children:(0,Ke.jsx)(K()._H,{...Mi.customHeaderKeyLabel})}),(0,Ke.jsx)("label",{style:m.customHeaderValueLabel,children:(0,Ke.jsx)(K()._H,{...Mi.customHeaderValueLabel})}),(0,Ke.jsx)("div",{}),(0,Ke.jsx)(Ne,{style:m.customHeaderKeyInput,value:e.key,onChange:f(e.id,"key"),errorOutline:d.get({id:e.id,field:"key"}),onBlur:y(e.id,"key"),autoFocus:!e.key,maxlength:Si().aB}),(0,Ke.jsx)(Ne,{style:m.customHeaderValueInput,value:e.value,onChange:f(e.id,"value"),errorOutline:d.get({id:e.id,field:"value"}),onBlur:y(e.id,"value"),maxlength:Si().aB}),(0,Ke.jsx)(Pe().Z,{icon:Gt().y,ariaLabel:o.formatMessage(Mi.removeCustomHeaderAriaLabel),style:m.customHeaderRemoveButton,iconStyle:m.customHeaderRemoveButtonIcon,onClick:x(e.id)})]},e.id)))});return(0,Ke.jsxs)(Ke.Fragment,{children:[b,h.length<Si().Qb&&(0,Ke.jsx)(Ci().gq,{children:(0,Ke.jsx)(Vt().D,{isGray:!0,onClick:v,style:m.addCustomHeaderButton,children:(0,Ke.jsx)(K()._H,{...Mi.addCustomHeader})})})]})}var Ti=()=>o(456681),wi=()=>o(407391),Ai=()=>o(108714),Ii=()=>o(148126);function _i(e){const t=(0,le().O7)(),o=(0,K().YB)();return(0,Ke.jsx)(Be().Z,{renderTooltip:()=>(0,Ke.jsx)(K()._H,{defaultMessage:"Learn more",id:"webhookAction.helpButton.tooltip"}),render:e=>(0,Ke.jsx)(Ai().Z,{...e,href:(0,Ii().UY)("guides.webhookAction"),onClick:()=>wi().Fs(t,{from:"webhookAction"}),external:!0,children:(0,Ke.jsx)(Pe().Z,{...e,ariaLabel:o.formatMessage({id:"webhookAction.helpButton.ariaLabel",defaultMessage:"Learn about webhook actions"}),icon:Ti().m})})})}_i.displayName="SendWebhookActionHelpLink";var Pi=()=>o(532850),Vi=()=>o(766933);const Bi=new Set(["title","text","relation","checkbox","number","person","file","url","email","phone_number","created_time","created_by","last_edited_time","last_edited_by","last_visited_time","formula","rollup","select","multi_select","date","status","auto_increment_id","location","verification","geo_point"]);const Ri=(0,K().vU)({selectAllPropertiesDescription:{defaultMessage:"New properties will not be included automatically",id:"automations.BaseModalAction.selectAllPropertiesDescription"},selectAllProperties:{defaultMessage:"Select all existing properties",id:"automations.BaseModalAction.selectAllProperties"},propertyPickerLabel:{defaultMessage:"Content",id:"automations.BaseModalAction.propertyPickerLabel"},propertyDisabledMissingPermissionTooltip:{defaultMessage:"This property references a database you don't have access to",id:"automations.SendWebhookActionPropertyPicker.propertyDisabledMissingPermissionTooltip"},propertyDisabledUnsupportedTypeTooltip:{defaultMessage:"This property type is not supported",id:"automations.SendWebhookActionPropertyPicker.propertyDisabledUnsupportedTypeTooltip"}});function Fi(){return(0,ce().yK)((e=>({buttonMenuItemContent:{height:34},buttonMenuItem:{borderRadius:4}})),[])}function Ki(e){let{collectionStore:t,value:o,onChange:n}=e;const i=Fi(),a=Li(),l=(0,se().VK)((()=>t.getSchema()),[t]),s=(0,re.useMemo)((()=>new Set("some"===o.type?o.some||[]:Object.keys(l))),[l,o]),c=function(e){const{value:t}=(0,Xe().XJ)(w().F.formulas),{value:o}=(0,Xe().XJ)(w().F.formulaPermissions),n=(0,it().E)("collections_xws"),i=(0,se().VK)((()=>{if(!t)return;const o=(0,I().W)();return{allowedReturnTypes:[{type:"unknown"}],handleDataRequest:(0,f().yf)({collectionFeatureGates:o,experimentService:P().default,getRecordModel:e.getRecordModel,loadRecordModel:e.loadRecordModel}),restrictUnaccessibleProperties:n?"cross_space_and_read_permissions":"read_permissions_only",spaceId:e.getSpaceId(),valueTypes:[],featureGates:o}}),[t,e,n]),[a]=(0,un().r5)((async()=>{if(!t||!i||!o)return;const n=e.getSchema(),a=Object.keys(n),r=await(0,$().qd)(a,3,(async t=>{const a=(0,Pi().Qm)({schema:n,property:t});if(a)return Bi.has(a.type)?await o.hasAccessToProperty({collectionPointer:e.pointer,collectionSchema:n,context:i,propertyId:t,hasAccessFn:o.hasAccessDefaultFn})?void 0:"missing_permission":"unsupported_property_type"})),l=new Map;return r.forEach(((e,t)=>{l.set(a[t],e)})),l.size>0?l:void 0}),[e,i,t,o]);return a}(t),u=(0,re.useMemo)((()=>c.value||new Map),[c]),d=(0,re.useMemo)((()=>new Set(Array.from(u.entries()).filter((e=>{let[t,o]=e;return void 0===o})).map((e=>{let[t]=e;return t})))),[u]),p=(0,re.useMemo)((()=>"some"===o.type&&function(e,t){if(e.size!==t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0}(s,d)),[o.type,s,d]),m=(0,re.useRef)(null),g=(0,re.useCallback)((e=>{s.has(e)?s.delete(e):s.add(e),n({type:"some",some:Array.from(s)})}),[s,n]),h=(0,ce().yK)((e=>({sectionMenuItem:{padding:"6px 2px"},propertyPickerContainer:{display:"flex",flexDirection:"column",gap:12,border:`1px solid ${e.regularDividerColor}`,borderRadius:10,maxHeight:212,overflowY:"auto",marginBottom:2},selectAllPropertiesButton:{height:34},selectAllPropertiesButtonTitle:{display:"flex",alignItems:"center",gap:6,marginLeft:9},selectAllPropertiesCheckboxContainer:{height:13},selectAllPropertiesCheckbox:{cursor:"pointer"}})),[]),y=(0,re.useCallback)((()=>{n(p?{type:"some",some:[]}:{type:"some",some:Array.from(d.values())})}),[p,n,d]);(0,re.useEffect)((()=>{m.current&&(m.current.indeterminate=s.size>0&&!p)}),[p,s,o.type]);const v=Object.keys(l),x=(0,re.useMemo)((()=>v.sort(((e,t)=>{const o=(0,Pi().Qm)({schema:l,property:e}),n=(0,Pi().Qm)({schema:l,property:t});if("title"===(null==o?void 0:o.type))return-1;if("title"===(null==n?void 0:n.type))return 1;const i=(null==o?void 0:o.name)||"",a=(null==n?void 0:n.name)||"";return i.localeCompare(a)}))),[v,l]);if(!u)return null;const b=(0,r().oA)(x.map((e=>{const t=(0,Pi().Qm)({schema:l,property:e});if(!t)return null;return{key:e,render:o=>(0,Ke.jsx)(Zi,{...o,propertySchema:t,selected:s.has(e),noAccessReason:u.get(e),buttonStyle:i.buttonMenuItem,style:i.buttonMenuItemContent}),action:()=>{g(e)}}}))),S=(0,r().oA)([{key:0,render:e=>(0,Ke.jsx)(bt().Z,{...e,style:h.sectionMenuItem}),items:[{key:0,render:e=>(0,Ke.jsx)(Ye().Z,{...e,style:i.buttonMenuItemContent,buttonStyle:i.buttonMenuItem,title:(0,Ke.jsxs)("div",{style:h.selectAllPropertiesButtonTitle,children:[(0,Ke.jsx)(K()._H,{...Ri.selectAllProperties}),(0,Ke.jsx)(Ei,{})]}),leftStyle:h.selectAllPropertiesCheckboxContainer,left:(0,Ke.jsx)("input",{type:"checkbox",readOnly:!0,checked:p,ref:m,style:h.selectAllPropertiesCheckbox})}),action:y}]},{key:1,render:e=>(0,Ke.jsx)(bt().Z,{topBorder:!0,style:h.sectionMenuItem,...e}),items:b}]);return(0,Ke.jsxs)(Ke.Fragment,{children:[(0,Ke.jsx)("label",{style:a.inputLabel,children:(0,Ke.jsx)(K()._H,{...Ri.propertyPickerLabel})}),(0,Ke.jsx)("div",{style:h.propertyPickerContainer,children:(0,Ke.jsx)(xt().ZP,{type:xt().iW.Vertical,sections:S,initialFocus:void 0,resetFocusOnMouseOut:!0})})]})}function Zi(e){const{propertySchema:t,noAccessReason:o}=e,n=(0,ce().Fg)(),i=(0,le().O7)(),{name:a,type:r,icon:l}=t,s=Fi(),c=(0,ce().yK)((e=>({buttonMenuItemTitle:{color:o?e.lightTextColor:e.regularTextColor},propertyIcon:{fill:o?e.lightIconColor:e.regularIconColor,marginLeft:6,marginRight:2},checkBoxInput:{cursor:o?void 0:"pointer"}})),[o]),u=(0,Ke.jsx)(Ye().Z,{title:a,disabled:Boolean(o),style:s.buttonMenuItemContent,titleStyle:c.buttonMenuItemTitle,icon:(0,Ke.jsx)(Vi().ZP,{icon:l,type:r,size:i.device.isMobile?18:16,theme:n,style:c.propertyIcon}),left:(0,Ke.jsx)(Ci().gq,{alignItems:"center",children:(0,Ke.jsx)("input",{type:"checkbox",readOnly:!0,checked:e.selected,disabled:Boolean(o),style:c.checkBoxInput})}),...e});return o?(0,Ke.jsx)(Hi,{noAccessReason:o,children:u}):u}function Ei(){const e=(0,ce().yK)((e=>({helpIcon:{width:14,height:14,fill:e.icon.secondary}})),[]),t=(0,se().VK)((()=>(0,Ti().m)(e.helpIcon)),[e.helpIcon]);return(0,Ke.jsx)(Be().Z,{renderTooltip:()=>(0,Ke.jsx)(K()._H,{...Ri.selectAllPropertiesDescription}),render:e=>(0,Ke.jsx)("div",{...e,children:t}),placement:Dt().Placement.Top})}function Hi(e){const{children:t,noAccessReason:o}=e;return(0,Ke.jsx)(Be().Z,{renderTooltip:()=>"missing_permission"===o?(0,Ke.jsx)(K()._H,{...Ri.propertyDisabledMissingPermissionTooltip}):"unsupported_property_type"===o?(0,Ke.jsx)(K()._H,{...Ri.propertyDisabledUnsupportedTypeTooltip}):void(0,s().t1)(o),originGap:0,render:e=>(0,Ke.jsx)("div",{...e,children:t}),placement:Dt().Placement.Left})}const Di=(0,K().vU)({urlInputLabel:{defaultMessage:"URL",id:"automations.BaseModalAction.urlInputLabel"}});function Li(){const{isMobile:e}=(0,le().Fy)();return(0,ce().yK)((t=>({inputLabel:{color:t.mediumTextColor,fontSize:e?ue().JB.UIRegular.mobile:ue().JB.UIRegular.desktop},input:{backgroundColor:t.contentBackground,paddingTop:6,paddingBottom:6},helpText:{color:t.mediumTextColor,fontSize:e?ue().JB.UISmall.mobile:ue().JB.UISmall.desktop}})),[e])}const Oi={create_page:function(e){const{actionStore:t}=e,n=(0,le().O7)(),{automationStore:i}=(0,Se().YC)(),{disabled:r,maybePersistedTransactionActions:l,suppressActionErrors:c}=(0,Oe().i)(),u=(0,a().getActionRegistryItem)("create_page"),[d,p]=(0,se().VK)((()=>{const e=t.getConfig();return[null==e?void 0:e.properties,null==e?void 0:e.values]}),[t]),[m,g]=(0,se().VK)((()=>{const e=t.getCollectionStore();return null!=e&&e.isDefined()?[e,{collection:e.getSpaceShardedPointer(),type:"collection"}]:[void 0,void 0]}),[t]),h=(0,se().VK)((()=>lt(m).length>0),[m]),y=(0,se().VK)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.template_page_id}),[t]),f=(0,re.useMemo)((()=>({values:p??{},properties:d??[]})),[p,d]),v=(0,se().qz)(void 0,Qe().Z),x=(0,re.useCallback)((()=>v.reset()),[v]),b=(0,re.useMemo)((()=>(0,Ke.jsx)(st().e,{actionStore:t,closeMenu:x})),[t,x]),S=(0,se().VK)((()=>(0,s().$K)(t.getConfigStore().getKeyStore("collection").getValue())),[t]),C=(0,re.useCallback)((e=>{"collection"===e.type&&(l.createAndCommit({perform:o=>{q().sW({data:{collection:e.collection,properties:["title"],template_page_id:null,values:null},store:t.getConfigStore(),transaction:o})},userAction:"CreatePageAction.setCollection"}),(0,at().yE)(n,{automationStore:i,automationActionStore:t}))}),[l,n,i,t]),k=(0,re.useCallback)((e=>{const{properties:o,values:a}=f;let r=!1;if(e&&o&&1===o.length&&o.includes("title")){var s;const e=null==a?void 0:a.title;e&&null!==(s=e.value)&&void 0!==s&&s.value||(r=!0)}l.createAndCommit({perform:o=>{q().sW({store:t.getConfigStore(),data:{template_page_id:e??null,...r&&{properties:[]}},transaction:o})},userAction:"CreatePageAction.onTemplateChange"}),(0,at().yE)(n,{automationStore:i,automationActionStore:t})}),[f,l,n,i,t]),M=(0,re.useMemo)((()=>!c.includes(t.id)),[c,t]),{errorMessage:j,errorIcon:T}=(0,ae().useErrorComponentForAction)({actionId:t.id,errorKeys:["collection","config",t.id],shouldShow:M}),{errorMessage:w}=(0,ae().useErrorComponentForAction)({actionId:t.id,errorKey:"template",shouldShow:M}),A=Boolean(r),I=(0,it().E)("automation_updated_error_states");return(0,Ke.jsxs)(Mt().Ao,{actionId:t.id,actionMenu:b,buttonPopupStore:v,canCollapse:S,disabled:A,children:[(0,Ke.jsxs)(Mt().vu,{actionId:t.id,actionRegistryItem:u,disabled:A,errorMessage:I?j||w:void 0,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:[(0,Ke.jsx)(jt,{actionStore:t,disabled:A,errorMessage:j,errorIcon:T,onChange:C,value:g}),(0,s().$K)(m)&&h&&(0,Ke.jsx)(Tt,{collectionStore:m,disabled:A,errorMessage:w,onChange:k,value:y})]}),m&&(0,Ke.jsx)(Mt().R7,{disabled:A,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,Ke.jsx)(o(883293).QF,{actionStore:t,collectionStore:m,disabled:A,showSetPropertyActions:!1})})]})},update_pages:o(502550).B,query_collection:function(){return null},open_page:function(e){const{actionStore:t}=e,{disabled:o,maybePersistedTransactionActions:n,suppressActionErrors:i}=(0,Oe().i)(),r=(0,se().qz)(void 0,Qe().Z),l=(0,a().getActionRegistryItem)("open_page"),s=(0,se().VK)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.target}),[t]),{contextType:c}=(0,Se().YC)(),u=(0,se().VK)((()=>{if(!(0,ko().fo)(c))return;const e=t.getIndex();return(0,ko().GQ)(e)?"allow":"disallow_with_message"}),[t,c]),d=(0,se().VK)((()=>s&&"url"!==s.type),[s]),p=(0,re.useMemo)((()=>({headerWrap:{paddingInlineEnd:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}})),[]),m=(0,re.useCallback)((e=>{n.createAndCommit({perform:o=>{q().sW({store:t.getConfigStore(),data:{target:e},transaction:o})},userAction:"OpenPageAction.setTarget"})}),[n,t]),g=(0,re.useCallback)((e=>{n.createAndCommit({perform:o=>{q().sW({store:t.getConfigStore(),data:{open_in:e},transaction:o})},userAction:"OpenPageAction.setPeekMode"})}),[n,t]),h=(0,re.useCallback)((()=>r.reset()),[r]),y=(0,re.useMemo)((()=>!i.includes(t.id)),[i,t]),{errorMessage:f}=(0,ae().useErrorComponentForAction)({actionId:t.id,shouldShow:y}),v=(0,re.useMemo)((()=>(0,Ke.jsx)(st().e,{actionStore:t,closeMenu:h})),[t,h]),x=Boolean(o);return(0,Ke.jsx)(Mt().Ao,{actionMenu:v,buttonPopupStore:r,actionId:t.id,canCollapse:!1,children:(0,Ke.jsxs)(Mt().vu,{actionId:t.id,actionRegistryItem:l,disabled:x,styles:p,children:[(0,Ke.jsx)(To,{actionStore:t,disabled:x,errorMessage:f,onChange:m,value:s,urlBehavior:u}),d?(0,Ke.jsx)(wo,{actionStore:t,disabled:x,onChange:g}):null]})})},duplicate_blocks:function(e){const{actionStore:t}=e,{disabled:o,editorPlacement:n}=(0,Oe().i)(),i=(0,le().O7)(),l=(0,ce().yK)((()=>({title:{display:"inline-flex",flexWrap:"wrap",gap:6,whiteSpace:"pre-wrap"}})),[]),s=(0,se().VK)((()=>(0,r().Ps)(t.getBlockPointers())),[t],{useDeepEqual:!0}),c=(0,se().VK)((()=>function(e){const t=Object.values(po).find((t=>t.key===e));return t??mo}(t.getInsertionPoint())),[t]),u=(0,re.useCallback)((e=>function(e,t,o){Q().createAndCommit({userAction:"DuplicateBlocksAction.setInsertionPoint",environment:e,canUndo:!0,perform:e=>{q().sW({store:t.getConfigStore(),data:{insertion_point:o},transaction:e})}})}(i,t,e)),[t,i]),d=(0,se().qz)(void 0,Qe().Z),p=(0,re.useCallback)((()=>d.reset()),[d]),m=(0,re.useMemo)((()=>(0,Ke.jsx)(st().e,{actionStore:t,closeMenu:p})),[t,p]),g=(0,a().getActionRegistryItem)("duplicate_blocks"),h=Boolean(o);return(0,Ke.jsxs)(Mt().Ao,{actionMenu:m,buttonPopupStore:d,disabled:h,actionId:t.id,canCollapse:!0,children:[(0,Ke.jsx)(Mt().vu,{actionId:t.id,actionRegistryItem:g,disabled:h,children:(0,Ke.jsx)("div",{style:l.title,children:(0,Ke.jsx)(K()._H,{...uo.title,values:{insertionPicker:(0,Ke.jsx)(go,{currentOption:c,disabled:h,onChange:u})}})})}),(0,Ke.jsx)(Mt().R7,{disabled:h,children:s?(0,Ke.jsx)(yo,{actionStore:t,buttonPlacement:n,contentParentPointer:s,disabled:h}):null})]})},modal_confirmation:function(e){const{actionStore:t}=e,o=(0,le().O7)(),{isMobile:n}=(0,le().Fy)(),{automationStore:i}=(0,Se().YC)(),r=(0,K().YB)(),{disabled:l,maybePersistedTransactionActions:s}=(0,Oe().i)(),c=Boolean(l),u=(0,a().getActionRegistryItem)("modal_confirmation"),[d,p]=(0,se().VK)((()=>[t.id,t.getSpaceId()]),[t]),m=(0,mt().z)({actionId:d}),g=(0,ce().yK)((e=>({wrap:{display:"flex",flexDirection:"column",gap:10},input:{backgroundColor:e.contentBackground,paddingTop:6,paddingBottom:6},inputLabel:{color:e.lightTextColor,fontSize:n?14:12,lineHeight:1.3,fontWeight:ue().Ue.medium,display:"flex",alignItems:"center"}})),[n]),h=(0,se().qz)(void 0,Qe().Z),y=(0,re.useCallback)((()=>h.reset()),[h]),f=(0,re.useMemo)((()=>(0,Ke.jsx)(st().e,{actionStore:t,closeMenu:y})),[t,y]),v=(0,se().VK)((()=>t.getConfigStore().getKeyStore("text")),[t]),x=(0,se().VK)((()=>v.getValue()),[v]),b=(0,se().VK)((()=>{if(p)return(0,Rt().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:(0,fo().createFormulaDataRequestSyncHandler)(t.getRecordModel),spaceId:p,valueTypes:m.slice(0),featureGates:(0,I().W)()},value:x})}),[p,t.getRecordModel,m,x]),S=(0,se().VK)((()=>t.getConfigStore().getKeyStore("continue_button").getKeyStore("text")),[t]),C=(0,se().VK)((()=>t.getConfigStore().getKeyStore("cancel_button").getKeyStore("text")),[t]),k=(0,re.useCallback)((e=>{s.createAndCommit({userAction:"BaseModalAction.handleTextChange",perform:t=>{q().sO({store:v,value:e,transaction:t})}}),(0,at().yE)(o,{automationStore:i,automationActionStore:t})}),[t,i,o,s,v]),M=(0,re.useCallback)((()=>{(0,at().yE)(o,{automationStore:i,automationActionStore:t})}),[t,i,o]),{onTextStoreSelect:j,onTextStoreUnselect:T}=(0,Zt().w)(t);return p&&b?(0,Ke.jsxs)(Mt().Ao,{actionMenu:f,buttonPopupStore:h,disabled:c,actionId:t.id,canCollapse:!0,children:[(0,Ke.jsx)(Mt().vu,{actionId:t.id,actionRegistryItem:u,disabled:c,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:(0,Ke.jsx)(K()._H,{...u.display.name})}),(0,Ke.jsx)(Mt().R7,{disabled:c,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,Ke.jsxs)(wt().jX,{direction:"column",gap:16,children:[(0,Ke.jsx)(bo,{disabled:c,disableMobileActionBar:!0,formulaTypecheckContextValues:m,onChange:k,onTextStoreSelect:j,onTextStoreUnselect:T,parentRecordStore:t,placeholder:r.formatMessage(Co.confirmationMessageLabel),rows:4,spaceId:p,value:x,analyzedFormulaOutput:b,labelMessageDescriptor:Co.confirmationMessageLabel}),(0,Ke.jsxs)(wt().jX,{direction:"column",gap:6,children:[(0,Ke.jsx)("label",{style:g.inputLabel,children:(0,Ke.jsx)(K()._H,{...Co.continueButtonTextLabel})}),(0,Ke.jsx)(We,{disabled:c,maxlength:vo().OO,onChange:M,style:g.input,store:S})]}),(0,Ke.jsxs)(wt().jX,{direction:"column",gap:6,children:[(0,Ke.jsx)("label",{style:g.inputLabel,children:(0,Ke.jsx)(K()._H,{...Co.cancelButtonTextLabel})}),(0,Ke.jsx)(We,{disabled:c,maxlength:vo().OO,onChange:M,style:g.input,store:C})]})]})})]}):null},slack_notification:o(592479).eQ,send_in_app_notification:function(e){var t;const{actionStore:o}=e,{isMobile:n}=(0,le().Fy)(),{automationStore:i,contextType:r}=(0,Se().YC)(),{disabled:l,maybePersistedTransactionActions:c,suppressActionErrors:u}=(0,Oe().i)(),d=(0,tn().w)(i,r),p=!(0,s().$K)(d),m=Boolean(l),g=(0,a().getActionRegistryItem)("send_in_app_notification"),h=(0,se().VK)((()=>o.getSpaceId()),[o]),y=(0,se().VK)((()=>null==d?void 0:d.getSpaceShardedPointer()),[d]),f=(0,se().VK)((()=>{if(!d)return[];return(0,ko().NO)({collectionFormat:d.getFormat(),collectionSchema:d.getSchema(),spaceId:d.getSpaceId(),restrictCrossSpace:P().default.checkGate({gateName:"collections_xws"})})}),[d]),v=(0,se().VK)((()=>{var e;return null==o||null===(e=o.getConfig())||void 0===e?void 0:e.target}),[o]),x=(0,mt().z)({actionId:o.id}),b=(0,le().O7)();on("formula"===(null==v?void 0:v.type)?null==v||null===(t=v.value)||void 0===t?void 0:t.value:void 0);const S=(0,se().VK)((()=>{var e;return null===(e=o.getConfig())||void 0===e?void 0:e.notification_message}),[o]),C=(0,se().VK)((()=>{if(h)return(0,Rt().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:(0,fo().createFormulaDataRequestSyncHandler)(o.getRecordModel),spaceId:h,valueTypes:x.slice(0),featureGates:(0,I().W)()},value:S})}),[o.getRecordModel,S,x,h]),k=(0,se().qz)(void 0,Qe().Z),M=(0,re.useCallback)((()=>k.reset()),[k]),j=(0,re.useMemo)((()=>(0,Ke.jsx)(st().e,{actionStore:o,closeMenu:M})),[o,M]),T=(0,re.useMemo)((()=>!u.includes(o.id)),[u,o]),w=(0,it().E)("automation_updated_error_states"),{errorMessages:A,errorMessageDescriptors:_}=function(e){const{actionId:t,shouldShowError:o}=e,n={},i={};n.target=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"target"}).errorMessage;const a=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"notification_message"});return n.notification_message=a.errorMessage,i.notification_message=a.errorMessageDescriptor,n.collectionPointer=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"collectionPointer"}).errorMessage,n.propertyId=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"propertyId"}).errorMessage,n.formulaValue=(0,ae().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"formulaValue"}).errorMessage,{errorMessages:n,errorMessageDescriptors:i}}({actionId:o.id,shouldShowError:T}),V=(0,se().VK)((()=>(0,s().$K)(o.getConfigStore().getKeyStore("target").getValue())),[o]),B=(0,re.useCallback)((e=>{c.createAndCommit({perform:t=>{q().sW({data:{target:{type:e}},store:o.getConfigStore(),transaction:t})},userAction:"SendInAppNotificationAction.setTargetType"})}),[o,c]);(0,re.useEffect)((()=>{!v&&p&&B("formula")}),[v,p,B]);const R=(0,re.useCallback)((e=>{const t=e.value;if(!t)return;let n;"formula"===t.type?n={type:"formula",value:t}:"simple"===t.type?n={type:"formula",value:bi(b,t)}:(0,s().t1)(t.type),c.createAndCommit({perform:e=>{q().sW({data:{target:{type:"formula",value:n.value}},store:o.getConfigStore(),transaction:e})},userAction:"SendInAppNotificationAction.setTarget"}),(0,at().yE)(b,{automationStore:i,automationActionStore:o})}),[i,o,b,c]),F=(0,re.useCallback)((e=>{c.createAndCommit({perform:t=>{q().sW({data:{target:{...e,collectionPointer:y}},store:o.getConfigStore(),transaction:t})},userAction:"SendInAppNotificationAction.setTarget"}),(0,at().yE)(b,{automationStore:i,automationActionStore:o})}),[o,i,y,b,c]),K=(0,re.useCallback)((e=>{switch(e.type){case"formula":return R(e);case"property":return F(e);default:(0,s().t1)(e)}}),[R,F]),Z=(0,re.useCallback)((e=>{c.createAndCommit({perform:t=>{q().sW({data:{notification_message:e},store:o.getConfigStore(),transaction:t})},userAction:"SendInAppNotificationAction.setNotificationMessage"}),(0,at().yE)(b,{automationStore:i,automationActionStore:o})}),[o,i,b,c]),{onTextStoreSelect:E,onTextStoreUnselect:H}=(0,Zt().w)(o),D=(0,re.useCallback)((()=>{de().clear({environment:b})}),[b]);return h&&C?(0,Ke.jsxs)(Mt().Ao,{actionMenu:j,buttonPopupStore:k,disabled:m,actionId:o.id,canCollapse:V,children:[(0,Ke.jsx)(Mt().vu,{actionId:o.id,actionRegistryItem:g,disabled:l,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,Ke.jsx)(yi,{noCollection:p,targetsErrorMessage:A.target,selectedTargetType:null==v?void 0:v.type,onTargetTypeChange:B,disabled:Boolean(l)})}),v&&(0,Ke.jsx)(Mt().R7,{children:(0,Ke.jsxs)(wt().jX,{direction:"column",gap:16,children:[(0,Ke.jsxs)(wt().jX,{direction:"column",gap:6,children:[(0,Ke.jsx)(fi,{isMobile:n,selectedTargetType:v.type,isError:w&&Boolean("property"===v.type?A.propertyId:A.formulaValue)}),(0,Ke.jsx)("div",{children:(0,Ke.jsx)(xi,{collectionStore:d,disabled:Boolean(l),formulaTypecheckContextValues:x,currentTargetValue:v,currentProperties:f,onTargetValueChange:K,errorMessage:"property"===v.type?A.propertyId:A.formulaValue,parentRecordStore:o,spaceId:h})})]}),(0,Ke.jsx)(bo,{analyzedFormulaOutput:C,labelMessageDescriptor:hi.notificationMessageLabel,disabled:m,disableMobileActionBar:!0,disableTemplateVariableMentions:!0,errorMessageDescriptor:_.notification_message,formulaTypecheckContextValues:x,onChange:Z,onTextStoreSelect:E,onTextStoreUnselect:H,onTextEsc:D,parentRecordStore:o,rows:3,spaceId:h,value:S})]})})]}):null},send_gmail_notification:function(e){const{actionStore:t}=e,o=function(e){return(0,se().VK)((()=>{const t=e.getConfigStore().getKeyStore("external_bot_id").getValue();if(!t)return;return en().default.externalAuthentications.state.find((e=>e.integration_id===qo().aG&&t===e.id))}),[e])}(t),n=(0,se().VK)((()=>en().default.externalAuthentications.state.filter((e=>e.integration_id===qo().aG))),[]);return(0,Ke.jsx)(ii,{actionStore:t,gmailAuthentications:n,currentGmailAuthentication:o,allGmailAuthentications:n})},define_variables:function(e){const{actionStore:t}=e,o=(0,le().O7)(),n=(0,K().YB)(),{automationStore:i}=(0,Se().YC)(),{disabled:r,maybePersistedTransactionActions:l}=(0,Oe().i)(),s=Boolean(r),c=(0,a().getActionRegistryItem)("define_variables"),u=(0,se().VK)((()=>i.getActionStores()),[i]),d=(0,se().VK)((()=>{const e=t.getConfigStore().getValue();return{values:(null==e?void 0:e.values)??{},variableIds:(null==e?void 0:e.variableIds)??[]}}),[t]),p=(0,se().qz)(void 0,Qe().Z),m=(0,re.useCallback)((()=>p.reset()),[p]),g=(0,re.useMemo)((()=>(0,Ke.jsx)(st().e,{actionStore:t,closeMenu:m})),[t,m]),h=(0,re.useCallback)((()=>{l.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,automationActionStores:o,intl:n,transaction:i}=e,a=(0,It().ZP)(),r={name:(0,_t().h)(o,n.formatMessage(At().eC)),value:{type:"simple",value:[[""]]}};q().sW({data:{[a]:r},store:t.getConfigStore().getKeyStore("values"),transaction:i}),Q().applyOperation({operation:{args:{id:a},command:"listAfter",path:["config","variableIds"],pointer:t.pointer},store:t,transaction:i})}({automationActionStore:t,automationActionStores:u,intl:n,transaction:e})},userAction:"DefineVariablesAction.addVariable"}),(0,at().yE)(o,{automationStore:i,automationActionStore:t})}),[t,u,i,o,n,l]),y=(0,ce().yK)((()=>({headerWrap:{paddingRight:32},titleWrap:{whiteSpace:"pre-wrap"},footer:{display:"flex",overflow:"hidden"}})),[]);return(0,Ke.jsxs)(Mt().Ao,{actionMenu:g,buttonPopupStore:p,disabled:s,actionId:t.id,canCollapse:!0,children:[(0,Ke.jsx)(Mt().vu,{actionId:t.id,actionRegistryItem:c,disabled:s,styles:{headerWrap:y.headerWrap,titleWrap:y.titleWrap},children:(0,Ke.jsx)(K()._H,{...c.display.name})}),(0,Ke.jsx)(Mt().R7,{disabled:s,children:(0,Ke.jsxs)(wt().jX,{direction:"column",gap:16,children:[d.variableIds.length>0&&(0,Ke.jsx)(wt().jX,{direction:"column",gap:14,children:d.variableIds.map((e=>d.values[e]?(0,Ke.jsx)(io,{actionStore:t,variableId:e},e):null))}),(0,Ke.jsx)("footer",{style:y.footer,children:(0,Ke.jsx)(Bt,{disabled:s,onClick:h})})]})})]})},http_request:function(e){const{actionStore:t}=e,{disabled:n,maybePersistedTransactionActions:i,suppressActionErrors:r}=(0,Oe().i)(),{automationStore:s,contextType:c,typecheckResult:u}=(0,Se().YC)(),d=(0,tn().w)(s,c),p=Boolean(n),m=(0,a().getActionRegistryItem)("http_request"),g=Li(),h=(0,se().qz)(void 0,Qe().Z),y=(0,re.useCallback)((()=>h.reset()),[h]),f=(0,re.useMemo)((()=>(0,Ke.jsx)(st().e,{actionStore:t,closeMenu:y})),[t,y]),v=(0,se().VK)((()=>t.getConfigStore().getKeyStore("url")),[t]),x=(0,se().VK)((()=>t.getConfigStore().getKeyStore("selectedProperties")),[t]),b=(0,se().VK)((()=>x.getValue()||{type:"some",some:[]}),[x]),S=(0,re.useCallback)((e=>{i.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:t=>{q().sO({store:x,transaction:t,value:e})}})}),[x,i]),C=(0,ce().yK)((e=>({divider:{marginBottom:8,marginTop:8},dividerColor:{color:e.stroke.secondary},errorMessage:{color:e.text.redTertiary}})),[]),[k,M]=(0,re.useState)(!1),j=(0,re.useMemo)((()=>!r.includes(t.id)||k),[r,t.id,k]),T=(0,se().VK)((()=>{if(!l().x.isSuccess(u)||!j)return!1;return(u.value.actionValidationFailures[t.id]||[]).some((e=>"invalid_url"===e.type))}),[u,t,j]),w=(0,ae().useRequiresSubscriptionUpgradeError)({actionId:t.id,shouldShow:j}),A=Boolean(w),I=(0,re.useCallback)((()=>{M(!0)}),[]);return(0,Ke.jsxs)(Mt().Ao,{actionMenu:f,buttonPopupStore:h,disabled:p,actionId:t.id,canCollapse:!A,hideDragHandle:A,children:[(0,Ke.jsx)(Mt().vu,{actionId:t.id,actionRegistryItem:m,disabled:p,errorMessage:w,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:(0,Ke.jsx)(K()._H,{...m.display.name})}),(0,Ke.jsxs)(Mt().R7,{disabled:p,styles:{bodyWrap:{display:"grid",gap:4,gridTemplateColumns:"1fr",minWidth:0}},children:[(0,Ke.jsx)("label",{style:g.inputLabel,children:(0,Ke.jsxs)(Ci().gq,{alignItems:"center",gap:4,children:[(0,Ke.jsx)(K()._H,{...Di.urlInputLabel}),(0,Ke.jsx)(_i,{})]})}),(0,Ke.jsx)(We,{disabled:p,style:g.input,store:v,errorOutline:T,onBlur:I,maxlength:Si().Y6}),T&&(0,Ke.jsx)("div",{style:C.errorMessage,children:(0,Ke.jsx)(K()._H,{id:"SendWebhookAction.invalidUrl",defaultMessage:"Invalid URL"})}),(0,Ke.jsx)(ji,{actionStore:t}),d&&(0,Ke.jsxs)(Ke.Fragment,{children:[(0,Ke.jsx)(o(666414).Z,{size:1,style:C.divider,dividerColor:C.dividerColor.color}),(0,Ke.jsx)(Ki,{collectionStore:d,value:b,onChange:S})]})]})]})},publish_site:function(e){const{actionStore:t}=e,{disabled:o,maybePersistedTransactionActions:n,suppressActionErrors:i}=(0,Oe().i)(),r=(0,se().VK)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.target}),[t]),l=Boolean(o),s=(0,a().getActionRegistryItem)("publish_site"),c=(0,se().qz)(void 0,Qe().Z),u=(0,re.useCallback)((e=>{"url"!==e.type&&n.createAndCommit({perform:o=>{q().sW({store:t.getConfigStore(),data:{target:e},transaction:o})},userAction:"PublishSiteAction.setTarget"})}),[n,t]),d=(0,re.useCallback)((()=>c.reset()),[c]),p=(0,re.useMemo)((()=>!i.includes(t.id)),[i,t]),{errorMessage:m}=(0,ae().useErrorComponentForAction)({actionId:t.id,shouldShow:p}),g=(0,re.useMemo)((()=>(0,Ke.jsx)(st().e,{actionStore:t,closeMenu:d})),[t,d]);return(0,Ke.jsxs)(Mt().Ao,{actionMenu:g,buttonPopupStore:c,disabled:l,actionId:t.id,canCollapse:!0,children:[(0,Ke.jsx)(Mt().vu,{actionId:t.id,actionRegistryItem:s,disabled:l,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,Ke.jsx)(Ho,{actionStore:t,disabled:l,errorMessage:m,onTargetChange:u,value:r})}),(0,Ke.jsxs)(Mt().R7,{disabled:l,styles:{sectionBodyWrap:{display:"grid",gap:4,gridTemplateColumns:"1fr",minWidth:0}},children:[(0,Ke.jsx)(Do,{}),(0,Ke.jsx)(Lo,{})]})]})}};var Ni=()=>o(703760);function Wi(e){const{children:t}=e,{isMobile:o}=(0,le().Fy)(),n=(0,ce().yK)((e=>({wrap:{color:e.lightTextColor,fontSize:o?14:12,lineHeight:1.3,fontWeight:ue().Ue.medium}})),[o]);return(0,Ke.jsx)("div",{style:n.wrap,children:t})}const Ui=(0,K().vU)({newActionLabel:{defaultMessage:"New action",id:"AutomationActionSelectButton.actionSection.newAction"},addActionLabel:{defaultMessage:"Add action",id:"AutomationActionSelectButton.actionSection.addAction"},addActionAriaLabel:{id:"collectionSettings.editAutomationView.addAction.iconButton",defaultMessage:"Add action"},builderModalActionTitle:{defaultMessage:"Do",id:"builderModal.editAutomationView.actionSection.title"}});function Gi(e){let{isEditable:t}=e;const{automationStore:o}=(0,Se().YC)(),{disabled:n}=(0,Oe().i)(),i=(0,tt().p)(),{contextType:a}=(0,Se().YC)(),r="button_block"===a||"button_property"===a,l=(0,se().VK)((()=>o.getActionStores().map((e=>e.isDefined()&&e.hasConcern("display")?e:null)).filter(s().K0)),[o]),c=l.length>0,u=(0,ce().yK)((e=>({section:{display:"flex",flexDirection:"column",gap:4,width:"100%",...r&&{marginTop:20}},header:{alignItems:"center",display:"flex",flexDirection:"row",height:24},headerAdd:{marginLeft:"auto",flexGrow:0,flexShrink:0},list:{display:"flex",flexDirection:"column"}})),[r]),d=!n&&t&&i.length>0;return(0,Ke.jsxs)("section",{style:u.section,children:[(0,Ke.jsx)("header",{style:u.header,children:(0,Ke.jsx)(Wi,{children:(0,Ke.jsx)(K()._H,{...Ui.builderModalActionTitle})})}),(0,Ke.jsxs)("div",{style:u.list,children:[t?(0,Ke.jsx)($i,{actionStores:l}):(0,Ke.jsx)(zi,{actionStores:l}),d&&(0,Ke.jsx)("footer",{children:(0,Ke.jsx)(Ji,{disabled:n,hasAnyActions:c,variant:"button"})})]})]})}function zi(e){let{actionStores:t}=e;const o=(0,Ge().RD)();return(0,Ke.jsx)("div",{style:o.wrap,children:(0,Ke.jsx)("div",{style:o.list,children:t.map((e=>(0,Ke.jsx)("div",{className:Ge().dN,children:(0,Ke.jsx)(Yi,{actionStore:e})},e.id)))})})}function $i(e){let{actionStores:t}=e;const o=(0,le().O7)(),{automationStore:n,contextType:a}=(0,Se().YC)(),{disabled:r,onActionDragStart:l,onActionDragEnd:c,maybePersistedTransactionActions:u}=(0,Oe().i)(),d=(0,K().YB)(),{value:p}=(0,Xe().XJ)(w().F.formulas),{value:m}=(0,Xe().XJ)($e().Sm.automationTypecheck),g=(0,se().VK)((()=>{const e=n.getActionStores();return new Map(e.map((e=>{if(e.isDefined()&&e.hasConcern("display"))return[e.id,e]})).filter(s().$K))}),[n]),h=(0,re.useMemo)((()=>Array.from(g.keys())),[g]),y=(0,se().qz)(void 0,et().Z),f=(0,re.useCallback)((e=>{const t=e.state;if(t.willDrag){const e=g.get(t.draggingKey);(0,s().$K)(e)&&(0,s().$K)(l)&&l(e)}else t.willDrag||t.isDragging||null==c||c()}),[g,c,l]);(0,re.useEffect)((()=>(y.addListener(f),()=>y.removeListener(f))),[g,y,f]);const v=(0,re.useCallback)(((e,t)=>{p&&m&&u.createAndCommit({userAction:"AutomationButtonAction.moveAction",perform:r=>{i().reorderAutomationActions({environment:o,automationStore:n,automationTypecheckModule:m,contextType:a,formulasModule:p,intl:d,newActionIds:e,transaction:r,from:"drag_and_drop",movedActionId:t.key})}})}),[n,a,m,p,d,u,o]),x=(0,re.useMemo)((()=>!r&&t.length>1),[r,t]),b=(0,re.useCallback)(((e,t)=>{const o=g.get(e);return(0,s().$K)(o)?(0,Ke.jsx)(Yi,{actionStore:o},o.id):null}),[g]);return t.length>0?(0,Ke.jsx)(qi,{draggableListStore:y,hasDragging:x,keys:h,onDrop:v,renderKey:b}):null}function Yi(e){const{actionStore:t}=e,o=(0,se().VK)((()=>t.getType()),[t]);if(!o)return null;const n=Oi[o];return(0,Ke.jsx)(n,{actionStore:t})}function qi(e){const{draggableListStore:t,hasDragging:o,keys:n,onDrop:i,renderKey:a}=e,{isMobile:r}=(0,le().Fy)(),l=(0,Ge().RD)();return(0,Ke.jsx)("div",{style:l.wrap,children:(0,Ke.jsx)(Je().ZP,{childClassName:Ge().dN,direction:"vertical",disabled:!o||r,keys:n,onDrop:i,renderKey:a,store:t,style:l.list})})}function Ji(e){const{disabled:t,hasAnyActions:o,variant:n}=e,{isMobile:i}=(0,le().Fy)(),a=(0,je().d)(),r=(0,K().YB)(),l=(0,re.useMemo)((()=>({availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"})),[]),s=(0,se().qz)(void 0,Qe().Z),c=(0,re.useCallback)((()=>s.reset()),[s]),u=(0,ce().yK)((e=>({buttonWrap:{boxShadow:"initial",background:"transparent"},button:{color:e.mediumTextColor,fill:e.mediumIconColor,margin:0,width:"100%"},buttonIcon:{height:i?18:16,width:24}})),[i]),d=Boolean(t);return(0,Ke.jsx)(qe().ZP,{alignmentToOrigin:qe().vR.Start,buttonPopupStore:s,disabled:d,placementToOrigin:qe().pO.Bottom,popupType:a,render:()=>(0,Ke.jsx)(ot().Z,{initialState:l,onClose:c}),renderOrigin:e=>"icon"===n?(0,Ke.jsx)(Pe().Z,{...e,ariaLabel:r.formatMessage(Ui.addActionAriaLabel),disabled:d,disabledFeedback:d,icon:ze().A}):"button"===n?(0,Ke.jsx)(Ni().D,{...e,ariaLabel:r.formatMessage(Ui.addActionAriaLabel),disabled:d,icon:(0,ze().A)({height:16,width:16}),title:(0,Ke.jsx)(K()._H,{...o?Ui.addActionLabel:Ui.newActionLabel})}):(0,Ke.jsx)(Ye().Z,{...e,buttonStyle:u.button,disabled:d,disabledFeedback:d,focused:!1,icon:(0,ze().A)(u.buttonIcon),style:u.buttonWrap,title:o?(0,Ke.jsx)(K()._H,{id:"automations.addActionButton.nonEmpty.label",defaultMessage:"Add another step"}):(0,Ke.jsx)(K()._H,{id:"automations.addActionButton.empty.label",defaultMessage:"Add a step"})})})}function Xi(e){const{areActionsEditable:t,areTriggersEditable:o,footer:n}=e,{isMobile:i}=(0,le().Fy)(),a=(0,ce().yK)((e=>({verticalRule:{background:e.stroke.primary,borderRadius:2,height:56,marginBottom:5,marginLeft:0,marginTop:16,width:2},container:{alignItems:"center",display:"flex",flexDirection:"column",justifyContent:"center",padding:i?"0 16px":void 0}})),[i]);return(0,Ke.jsxs)("div",{style:a.container,children:[(0,Ke.jsx)(Ge().nT,{isEditable:o}),(0,Ke.jsx)("div",{style:a.verticalRule}),(0,Ke.jsx)(Gi,{isEditable:t}),n]})}const Qi=(0,K().vU)({editButtonAriaLabel:{defaultMessage:"Edit button",id:"buttonBlock.button.editButtonAriaLabel"},buttonPlaceholder:{defaultMessage:"New button",id:"buttonBlock.button.placeholder"},buttonInsufficientPermissions:{defaultMessage:"You donât have permission to run this button",id:"buttonBlock.button.insufficientPermissions"},clickToEdit:{defaultMessage:"Click to edit button",id:"buttonBlock.button.clickToEdit"},done:{defaultMessage:"Done",id:"buttonBlock.button.done"},noEditError:{defaultMessage:"You don't have full access to edit this button",id:"buttonBlock.button.noEditError"}});function ea(e){var t,o,n;const{buttonBlockStore:i}=e,a=(0,se().VK)((()=>i.state.editing?i.state:void 0),[i]),r=(0,ce().yK)((e=>{var t;return{popup:{width:400},editor:{background:e.contentBackground,..."inline"===(null==a||null===(t=a.placement)||void 0===t?void 0:t.type)?{marginTop:6,borderRadius:6,border:`1px solid ${e.regularDividerColor}`,maxWidth:600}:{}}}}),[null==a||null===(t=a.placement)||void 0===t?void 0:t.type]),l=(0,je().d)({tabletBehavior:"slideUp"});return a&&a.placement?"popup"===(null===(o=a.placement)||void 0===o?void 0:o.type)?(0,Ke.jsx)(ge().ZP,{open:!0,popupType:l,render:()=>(0,Ke.jsx)(ta,{...e,style:r.editor}),originRect:a.placement.originRect,style:r.popup,originGap:4,onDismiss:()=>{i.stopEditing()}}):"inline"===(null===(n=a.placement)||void 0===n?void 0:n.type)?(0,Ke.jsx)(ta,{...e,style:r.editor}):void(0,s().t1)(a.placement):null}function ta(e){const{disabled:t,store:o,buttonBlockStore:n}=e,i=(0,le().O7)(),[a,r]=(0,ve().e)(),l=(0,ce().yK)((e=>({scroller:{maxHeight:"75vh"},factoryButtonDeprecationBanner:{margin:"12px 12px 6px 12px"},container:{fontFamily:ue().Gl.sans},footerButton:{height:32,width:"100%"},upgradeMessageWrap:{margin:8},footerButtonWrap:{width:"100%",display:"flex",flexDirection:"column",paddingTop:24}})),[]),s=(0,se().VK)((()=>o.getAutomationStore()),[o]),c=(0,se().VK)((()=>null==s?void 0:s.getSpaceId()),[s]),{maybePersistedAutomationStore:u,maybePersistedTransactionActions:d}=(0,we().$)({automationId:null==s?void 0:s.id,spaceId:c,defaultValue:void 0,persist:!0}),p=(0,Te().Rg)({store:o,automationStore:u}),m=(0,se().VK)((()=>{var e;return o.canEdit()&&"sufficient"===(null==p||null===(e=p.state)||void 0===e?void 0:e.editPermissionStatus)}),[o,p]),g=(0,se().VK)((()=>n.state.editing?n.state.placement:void 0),[n]),h=(0,re.useCallback)((e=>{(0,fe().ZP)({event:e,context:fe().Af.EditorClick,callback:()=>{de().clear({environment:i}),X().ZH({environment:i})}})}),[i]),y=(0,re.useCallback)((()=>{n.stopEditing(),(0,A().j)({environment:i,event:{eventName:"click_configure_button_done",eventProperties:{block_id:o.id,automation_id:null==u?void 0:u.id}}}),P().default.logEvent("click_configure_button_done")}),[n,i,o,u]),f=(0,se().VK)((()=>n.state.suppressErrorsForActionIds),[n]),v=(0,re.useCallback)((e=>n.suppressErrorsForAction(e.id)),[n]),x=(0,re.useCallback)((()=>{be().y(i,{from:"button_block_automation_header_message",upsell:{type:"product",product:"plus",limit:{type:"none"}}})}),[i]),b=(0,Me().a)(),S=t||!m,C=(0,se().VK)((()=>{var e;return!(null==p||null===(e=p.state)||void 0===e||!e.typecheckResult)&&(0,ke().A)({environment:i,typecheckResult:p.state.typecheckResult,automationStore:u})}),[p,i,u]);return u?(0,Ke.jsx)("div",{ref:a,style:{...l.container,...e.style},onClick:h,children:(0,Ke.jsx)(Se().Jj,{automationStore:u,contextType:"button_block",children:(0,Ke.jsxs)(Ce().$,{value:{disabled:S,editorPlacement:g,editorWidth:r,maybePersistedTransactionActions:d,onActionAdded:v,suppressActionErrors:f,hideDragHandle:C,...b},defaultCollapseActions:C,children:[(0,Ke.jsx)(oa,{blockStore:o,disabled:S}),(0,Ke.jsxs)(ye().T,{style:l.scroller,type:xe().Z.Y,children:[C&&(0,Ke.jsx)("div",{style:l.upgradeMessageWrap,children:(0,Ke.jsx)(Ue().c,{onUpsellClick:x})}),!m&&(0,Ke.jsx)("div",{style:l.upgradeMessageWrap,children:(0,Ke.jsx)(Ae().k,{children:(0,Ke.jsx)(K()._H,{...Qi.noEditError})})}),(0,Ke.jsx)("section",{style:{paddingBlock:8,paddingInline:8},children:(0,Ke.jsx)(Xi,{areActionsEditable:!C,areTriggersEditable:!1,footer:(0,Ke.jsx)("div",{style:l.footerButtonWrap,children:(0,Ke.jsx)(he().Z,{onClick:y,style:l.footerButton,children:(0,Ke.jsx)(K()._H,{...Qi.done})})})})})]})]})})}):null}function oa(e){const{blockStore:t,disabled:o}=e,{automationStore:n}=(0,Se().YC)(),i=(0,le().O7)(),a=(0,ce().yK)((e=>({wrap:{display:"flex",flexDirection:"column",padding:12,gap:6},inputs:{display:"flex",alignItems:"center",gap:6,borderBottom:`1px solid ${e.stroke.secondary}`,paddingBottom:12},nameInputWrap:{flexGrow:"1"},nameInput:{background:"transparent",boxShadow:"none",padding:4}})),[]),r=(0,se().VK)((()=>n.getNameStore()),[n]),l=(0,se().VK)((()=>n.getIconStore()),[n]),s=(0,se().VK)((()=>(null==r?void 0:r.getValue())??""),[r]),c=(0,se().VK)((()=>null==l?void 0:l.getValue()),[l]),u=(0,re.useCallback)(((e,t)=>{Q().createAndCommit({userAction:"ButtonBlock.updateProperty",environment:i,canUndo:!0,perform:o=>{q().sW({store:n.getPropertiesStore(),transaction:o,data:{[e]:t??null}})}})}),[n,i]),d=(0,re.useCallback)((e=>u("icon",e)),[u]),p=(0,re.useCallback)((e=>u("name",e)),[u]);return(0,Ke.jsx)(pe().p,{allowSelectionWithin:!0,style:a.wrap,children:(0,Ke.jsxs)("div",{style:a.inputs,children:[(0,Ke.jsx)(Ee,{disabled:o,currentIcon:c,handleIconChange:d,store:t}),(0,Ke.jsx)(Ne,{onChange:p,value:s,disabled:o,placeholder:_().Z.formatMessage(Qi.buttonPlaceholder),wrapStyle:a.nameInputWrap,style:a.nameInput,format:me().B.ExtraLarge,autoFocus:!s})]})})}var na=()=>o(565630),ia=()=>o(250625),aa=(o(821057),()=>o(34683)),ra=()=>o(863406);function la(e){var t;const{url:o,parentStore:n,onMouseEnter:i,onMouseLeave:a}=e,r=(0,le().O7)(),[l]=(0,un().r5)((async()=>{var e,t;const n=await Y().callApi({eventName:"getDataForLinkMention",environment:r,data:{url:o,spaceId:(null===(e=te().default.state.currentSpaceStore)||void 0===e?void 0:e.id)??(null===(t=te().default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.getSpaceId()),source:"button_hover"}});if("success"===n.type){if("error"in n.data)throw new Error(`Error in iframely response: ${n.data.status} ${n.data.error}`);return n.data}throw n.error}),[r,o]);let s;return s=null!==(t=l.value)&&void 0!==t&&t.iframe?(0,Ke.jsx)(aa().g,{hoverData:l.value,iframe_url:l.value.iframe,height:l.value.height,padding:l.value.padding,padding_top:l.value.padding_top,store:n,href:o,showEditButton:!1}):(0,Ke.jsx)(ra().Y,{hoverData:l.value,href:o,showEditButton:!1,store:n,loading:"pending"===l.status}),(0,Ke.jsx)("div",{onMouseEnter:i,onMouseLeave:a,children:s})}function sa(e){const{renderOrigin:t}=e;return(0,le().Fy)().isMobile?(0,Ke.jsx)(Ke.Fragment,{children:t()}):(0,Ke.jsx)(ca,{...e})}function ca(e){const{renderOrigin:t,urlToPreview:o,parentStore:n}=e,[i,a]=(0,re.useState)(!1),l=(0,re.useMemo)((()=>({onMouseEnter:()=>{a(!0)},onMouseLeave:()=>{a(!1)}})),[]),s=function(e){const{targetHovered:t}=e,[o,n]=(0,re.useState)(!1),i=(0,na().Kt)(t,400,Object.is),[a,l]=(0,re.useState)(!1),s=a||!o&&i,c=(0,re.useCallback)((()=>l(s)),[s]),u=(0,re.useCallback)((()=>{l(!1)}),[]),d=(0,re.useCallback)((()=>{u(),n(!0)}),[u]);return(0,re.useEffect)((()=>{n(!1)}),[i]),(0,re.useEffect)((()=>{const e=r().P2((()=>{d()}),200,{leading:!0});return ia().lj(window,"scroll",e,!0),()=>ia().ZV(window,"scroll",e,!0)}),[d]),{state:s,pinPopup:c,unpinPopup:u}}({targetHovered:i});return(0,Ke.jsx)(ge().ZP,{disableMouseCapture:!0,preventCaptureEsc:!0,preventScaleTransition:!0,originGap:6,preventOpacityTransition:!0,open:s.state,popupType:ge().kQ.Popup,alignmentToOrigin:Dt().Alignment.Start,placementToOrigin:Dt().Placement.Bottom,render:()=>(0,Ke.jsx)(la,{url:o,parentStore:n,onMouseEnter:s.pinPopup,onMouseLeave:s.unpinPopup}),origin:t(l)})}},883293:(e,t,o)=>{o.d(t,{QF:()=>O});o(267602),o(653476),o(241792);var n=o(667294),i=()=>o(219727),a=()=>o(142735),r=()=>o(846550),l=()=>o(912203),s=()=>o(21463),c=()=>o(473304),u=()=>o(329866),d=()=>o(907874),p=()=>o(752778),m=()=>o(788860),g=()=>o(513670),h=()=>o(696459),y=()=>o(636340),f=()=>o(990966),v=()=>o(212493),x=()=>o(827973),b=()=>o(448419),S=()=>o(291198),C=()=>o(198829),k=()=>o(255577),M=()=>o(388284),j=()=>o(585270),T=()=>o(307473),w=()=>o(615676),A=()=>o(749826),I=()=>o(637118),_=()=>o(960597),P=()=>o(309841),V=()=>o(195245),B=()=>o(985571),R=()=>o(903098),F=()=>o(918745),K=()=>o(676279),Z=()=>o(790819),E=()=>o(61313),H=()=>o(411766),D=o(785893);const L=(0,m().vU)({replaceActionLabel:{id:"automations.AutomationActionSetPropertiesSection.replaceAction.label",defaultMessage:"Replace with"},appendActionLabel:{id:"automations.AutomationActionSetPropertiesSection.appendAction.label",defaultMessage:"Add"},removeActionLabel:{id:"automations.AutomationActionSetPropertiesSection.removeAction.label",defaultMessage:"Remove"},toggleActionLabel:{id:"automations.AutomationActionSetPropertiesSection.toggleAction.label",defaultMessage:"Toggle"},titlePlaceholder:{id:"automations.AutomationActionSetPropertiesSection.titlePlaceholder",defaultMessage:"Untitled"},automationActionPropertyDeleted:{id:"automations.AutomationActionSetPropertiesSection.automationActionPropertyDeleted",defaultMessage:"This property was deleted"},automationActionPropertyUnsupported:{id:"automations.AutomationActionSetPropertiesSection.automationActionPropertyUnsupported",defaultMessage:"This property is unsupported"}});function O(e){const{actionStore:t,collectionStore:o,disabled:r,showSetPropertyActions:l}=e,s=(0,i().O7)(),{automationStore:c}=(0,I().YC)(),{maybePersistedTransactionActions:u}=(0,V().i)(),d=(0,a().VK)((()=>{var e;return(null===(e=t.getConfig())||void 0===e?void 0:e.values)??{}}),[t]),p=(0,a().VK)((()=>{var e;return(null===(e=t.getConfig())||void 0===e?void 0:e.properties)??[]}),[t]),m=(0,n.useCallback)((e=>{const o=p.concat([e]),n={...d,[e]:void 0};u.createAndCommit({userAction:"AutomationActionSetPropertiesSection.propertiesChange",perform:e=>{N({configStore:t.getConfigStore(),properties:o,transaction:e,values:n})}}),(0,P().yE)(s,{automationActionStore:t,automationStore:c})}),[p,d,u,s,c,t]),g=(0,n.useCallback)(((e,o)=>{const n=p.indexOf(e);if(-1===n)return;const i=p.slice(0);i[n]=o;const a={...d,[o]:void 0};u.createAndCommit({userAction:"AutomationActionSetPropertiesSection.setProperties",perform:e=>{N({configStore:t.getConfigStore(),properties:i,transaction:e,values:a})}}),(0,P().yE)(s,{automationActionStore:t,automationStore:c})}),[p,d,u,s,c,t]),h=(0,n.useCallback)((e=>{const o=p.filter((t=>t!==e)),n={...d,[e]:void 0};u.createAndCommit({userAction:"AutomationActionSetPropertiesSection.removeProperty",perform:e=>{N({configStore:t.getConfigStore(),properties:o,transaction:e,values:n})}}),(0,P().yE)(s,{automationActionStore:t,automationStore:c})}),[p,d,u,s,c,t]),y=(0,n.useCallback)(((e,o)=>{const n={...d,[e]:o};u.createAndCommit({userAction:"AutomationActionSetPropertiesSection.handleValueChange",perform:e=>{N({configStore:t.getConfigStore(),properties:p,transaction:e,values:n})}}),(0,P().yE)(s,{automationActionStore:t,automationStore:c})}),[d,u,s,t,c,p]);return(0,D.jsx)(W,{actionStore:t,collectionStore:o,disabled:r,onPropertyAdd:m,onPropertyChange:g,onPropertyRemove:h,onPropertyValueChange:y,showSetPropertyActions:l})}function N(e){const{configStore:t,properties:o,transaction:n,values:i}=e;y().sW({store:t,data:{properties:o,values:i},transaction:n})}function W(e){const{actionStore:t,collectionStore:o,onPropertyAdd:n,onPropertyChange:i,onPropertyRemove:s,onPropertyValueChange:c,disabled:u,showSetPropertyActions:d}=e,p=(0,r().yK)((e=>({addPropertyValuePlaceholder:{color:e.mediumTextColor,flexGrow:1,textAlign:"right"},addPropertyRow:{display:"flex",alignItems:"center"}})),[]),m=(0,a().VK)((()=>t.getConfigStore().getKeyStore("properties").getValue()??[]),[t]),g=(0,a().VK)((()=>(0,l().cO)({collectionFormat:o.getFormat(),collectionSchema:o.getSchema(),filter:e=>{let[t]=e;return!m.includes(t)},spaceId:o.getSpaceId(),restrictCrossSpace:A().default.checkGate({gateName:"collections_xws"})})),[o,m]),h=0===g.length;return(0,D.jsxs)(D.Fragment,{children:[m.length>0&&(0,D.jsx)(U,{actionStore:t,availablePropertyIds:g,collectionStore:o,disabled:u,onPropertyChange:i,onPropertyRemove:s,onPropertyValueChange:c,showSetPropertyActions:d}),!u&&!h&&(0,D.jsx)("div",{style:p.addPropertyRow,children:(0,D.jsx)(E().X,{availablePropertyIds:g,currentValue:void 0,collectionStore:o,onChange:n,disabled:u,alreadyHaveProperties:m.length>0})})]})}function U(e){const{actionStore:t,availablePropertyIds:o,collectionStore:n,onPropertyChange:l,onPropertyRemove:s,onPropertyValueChange:c,showSetPropertyActions:u,disabled:d}=e,{isMobile:p}=(0,i().Fy)(),m=p,g=(0,r().yK)((()=>({wrap:{alignItems:"start",columnGap:4,display:"grid",gridTemplateColumns:m?"100%":"160px 1fr",minWidth:0,rowGap:m?4:8},propertyValue:{...m?{fontSize:14,marginBlockEnd:16}:{}},lastPropertyValue:{...m?{fontSize:14,marginBlockEnd:0}:{}}})),[m]),[h,y]=(0,a().VK)((()=>{const e=t.getConfig();return[(null==e?void 0:e.properties)??[],(null==e?void 0:e.values)??{}]}),[t]);return(0,D.jsx)("div",{style:g.wrap,children:h.map(((e,i)=>{const a=i===h.length-1;return(0,D.jsx)(G,{actionStore:t,availablePropertyIds:o,collectionStore:n,disabled:d,onPropertyChange:l,onPropertyRemove:s,onPropertyValueChange:c,property:e,showSetPropertyActions:u,value:y[e],valueStyle:a?g.lastPropertyValue:g.propertyValue},e)}))})}function G(e){const{actionStore:t,availablePropertyIds:o,collectionStore:i,disabled:g,onPropertyChange:h,onPropertyRemove:y,onPropertyValueChange:f,property:x,showSetPropertyActions:b,value:C,valueStyle:k}=e,M={type:"collection",collectionStore:i,property:x},j=(0,m().YB)(),T=(0,r().yK)((e=>({propertyName:{display:"flex"},propertyValue:{display:"flex",gap:4,minWidth:50,...k},propertyValueInput:{minWidth:50}})),[k]),A=(0,n.useMemo)((()=>{if("title"===x)return j.formatMessage(L.titlePlaceholder)}),[j,x]),P=(0,a().VK)((()=>i.getSchema()[x]||i.getDeletedSchema()[x]),[i,x]),B=(0,a().VK)((()=>Boolean(!i.getSchema()[x])),[i,x]),F=(0,a().VK)((()=>{if(P)return(0,d().setPropertyValueToSimpleFormulaReturnType)({table:p().vF,id:i.id,spaceId:i.getSpaceId()},x,P)}),[i,P,x]),K=(0,n.useMemo)((()=>{if(P&&(0,l().SF)(P))return P.type}),[P]),Z=(0,n.useMemo)((()=>P&&!(0,l().SF)(P)),[P]),O=null==C?void 0:C.value,N=(0,a().VK)((()=>(0,c().o9)(C)),[C]),{automationStore:W}=(0,I().YC)(),U=(0,a().VK)((()=>W.getSpaceId()),[W]),G=(0,R().z)({actionId:t.id}),$=(0,a().VK)((()=>{if(K&&U)return(0,d().analyzeSimpleFormulaOrFormulaSync)({context:{allowedReturnTypes:l().Y_[K],handleDataRequest:(0,u().createFormulaDataRequestSyncHandler)(t.getRecordModel),spaceId:U,valueTypes:G.slice(0),featureGates:(0,w().W)()},value:null==C?void 0:C.value})}),[t.getRecordModel,G,U,K,null==C?void 0:C.value]),{suppressActionErrors:Y}=(0,V().i)(),J=(0,n.useMemo)((()=>!Y.includes(t.id)),[Y,t]),{errorMessage:X}=(0,_().useErrorComponentForAction)({actionId:t.id,errorKey:x,shouldShow:J}),Q=(0,n.useCallback)((e=>{h(x,e)}),[h,x]),ee=(0,n.useCallback)((()=>y(x)),[y,x]),te=(0,n.useCallback)((e=>{f(x,e)}),[f,x]),oe=(0,n.useCallback)((e=>{te({action:e,value:O})}),[O,te]),ne=(0,n.useCallback)((e=>{te({action:N,value:e})}),[N,te]);if(!U)return null;const ie=function(e){if("email"===e||"phone_number"===e||"url"===e)return{disableEmojiCommands:!0,disableFormattingAndMentions:!0};return{}}(K);let ae;return B?ae=(0,D.jsx)(m()._H,{...L.automationActionPropertyDeleted}):Z?ae=(0,D.jsx)(m()._H,{...L.automationActionPropertyUnsupported}):X&&(ae=X),(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{style:T.propertyName,children:(0,D.jsx)(E().X,{availablePropertyIds:o,currentValue:x,collectionStore:i,onChange:Q,disabled:g,onRemove:ee,errorMessage:ae})}),(0,D.jsxs)("div",{style:T.propertyValue,children:[!B&&b&&P&&s().Y[P.type]&&(0,D.jsx)(z,{disabled:g,onChange:oe,value:N}),B?(0,D.jsx)(S().Z,{disabled:!0,placeholder:j.formatMessage(L.automationActionPropertyDeleted)}):Z?(0,D.jsx)(S().Z,{disabled:!0,placeholder:j.formatMessage(L.automationActionPropertyUnsupported)}):K&&F?(0,D.jsxs)(v().jX,{direction:"column",gap:7,style:T.propertyValueInput,children:[(0,D.jsx)(q,{...ie,analyzedFormulaOutput:$,automationActionStore:t,disabled:g,disableMobileActionBar:!0,disableTemplateVariableMentions:!0,simpleFormulaContext:M,formulaTypecheckContextValues:G,onChange:ne,parentRecordStore:t,placeholder:A,propertyType:K,spaceId:U,type:F,value:null==C?void 0:C.value}),$&&(0,D.jsx)(H().g,{analyzedFormulaOutput:$})]}):null]})]})}function z(e){const{disabled:t,onChange:o,value:n}=e,i=(0,r().yK)((e=>({button:{boxShadow:e.inputBoxShadow,minWidth:120}})),[]),a=(0,K().d)();return(0,D.jsx)(b().ZP,{popupType:a,alignmentToOrigin:b().vR.End,placementToOrigin:b().pO.Bottom,originGap:0,disabled:t,renderOrigin:e=>(0,D.jsx)(Z().S,{...e,disabled:t,style:i.button,dropdownButtonType:"button",children:(0,D.jsx)(Y,{action:n})}),render:e=>(0,D.jsx)($,{onChange:o,parent:e,value:n})})}function $(e){const{value:t,onChange:o,parent:n}=e,i=(0,F().F)({width:250}),a=g().oA(c().E2.map(((e,i)=>({key:i,render:o=>(0,D.jsx)(x().Z,{...o,disabled:!1,title:(0,D.jsx)(Y,{action:e}),checkState:t===e}),action:()=>{e!==t&&o(e),n.close()}}))));return(0,D.jsx)(C().Z,{...i,children:(0,D.jsx)(k().ZP,{type:k().iW.Vertical,sections:[{key:0,render:e=>(0,D.jsx)(M().Z,{enableActionSheetTitle:!0,...e}),items:a}],initialFocus:0})})}function Y(e){const{action:t}=e;return"replace"===t?(0,D.jsx)(m()._H,{...L.replaceActionLabel}):"append"===t?(0,D.jsx)(m()._H,{...L.appendActionLabel}):"remove"===t?(0,D.jsx)(m()._H,{...L.removeActionLabel}):"toggle"===t?(0,D.jsx)(m()._H,{...L.toggleActionLabel}):void(0,h().t1)(t)}function q(e){const{analyzedFormulaOutput:t={},automationActionStore:o,disabled:a,disableEmojiCommands:s,disableFormattingAndMentions:c,disableMobileActionBar:u,disableTemplateVariableMentions:d,formulaTypecheckContextValues:p,onChange:m,parentRecordStore:g,placeholder:h,propertyType:y,simpleFormulaContext:v,spaceId:x,type:b,value:S}=e,{parseErrors:C=[],typeErrors:k=[]}=t,M=C.length>0||k.length>0,{onTextStoreSelect:w,onTextStoreUnselect:A}=(0,B().w)(o),I=(0,r().yK)((e=>({input:{width:"100%"}})),[]),_=(0,i().O7)(),P=(0,n.useCallback)((()=>{f().clear({environment:_})}),[_]);return"text"===b.type?(0,D.jsx)(j().w,{allowedReturnTypes:l().Y_[y],disabled:a,disableEmojiCommands:s,disableMobileActionBar:u,disableTemplateVariableMentions:d,formulaTypecheckContextValues:p,onChange:m,onTextStoreSelect:w,onTextStoreUnselect:A,onTextEsc:P,parentRecordStore:g,spaceId:x,placeholder:h,style:I.input,shouldShowErrorStyles:M,value:S}):"number"===b.type?(0,D.jsx)(j().w,{allowedReturnTypes:l().Y_[y],disabled:a,disableEmojiCommands:!0,disableInsertedDeletedAnnotations:!0,disableMentions:!0,disableMobileActionBar:!0,disableStyleAnnotations:!0,formulaTypecheckContextValues:p,onChange:m,onTextStoreSelect:w,onTextStoreUnselect:A,onTextEsc:P,parentRecordStore:g,spaceId:x,style:I.input,shouldShowErrorStyles:M,value:S}):(0,D.jsx)(T().e,{allowedReturnTypes:l().Y_[y],disabled:a,disableEmojiCommands:s,disableFormattingAndMentions:c,disableMobileActionBar:u,disableTemplateVariableMentions:d,formulaTypecheckContextValues:p,onChange:m,parentRecordStore:g,placeholder:h,simpleFormulaContext:v,spaceId:x,type:b,value:S})}},545444:(e,t,o)=>{o.d(t,{k:()=>l});o(667294);var n=()=>o(219727),i=()=>o(846550),a=()=>o(667067),r=o(785893);function l(e){const{children:t,icon:o}=e,l=function(){const{isMobile:e}=(0,n().Fy)();return(0,i().yK)((t=>({iconWrap:{flexGrow:0,flexShrink:0},messageWrap:{flexGrow:1},lockedIcon:{fill:t.icon.secondary,height:"100%",width:"100%"},lockedIconWrap:{background:t.fill.lightGraySecondary,borderRadius:4,height:20,padding:2,width:20},paragraph:{color:t.text.secondary,fontSize:e?14:12,margin:0},wrap:{alignItems:"center",display:"flex",flexDirection:"row",marginBottom:6,gap:10},wrapWrap:{padding:e?"0 12px 12px":"0 0 6px 0"}})),[e])}();return(0,r.jsx)("div",{style:l.wrapWrap,children:(0,r.jsxs)("div",{style:l.wrap,children:[(0,r.jsx)("div",{style:l.iconWrap,children:(0,r.jsx)("div",{style:l.lockedIconWrap,children:o||(0,a().Q)(l.lockedIcon)})}),(0,r.jsx)("div",{style:l.messageWrap,children:(0,r.jsx)("p",{style:l.paragraph,children:t})})]})})}},790819:(e,t,o)=>{o.d(t,{S:()=>s});var n=o(667294),i=()=>o(619857),a=()=>o(707513),r=o(785893);const l={height:"auto",maxWidth:"auto",paddingInline:4},s=(0,n.forwardRef)((function(e,t){const{children:s,disabled:u,hasActionRequired:d,errorIcon:p,icon:m,isCompact:g,isError:h,isSecondary:y,onClick:f,style:v,tooltipMessage:x,dropdownButtonType:b}=e,S=(0,o(219727).O7)(),C="dropdown"===b,k=(0,o(846550).yK)((e=>({button:{...c(e,{isError:h,hasActionRequired:d,isSecondary:y,dropdownButtonType:b}),gap:2,padding:"0 6px",...g?l:void 0,...C&&{alignItems:"center",height:20,paddingBlock:0,marginBlock:0},...v},children:{...a().Yu,lineHeight:"20px",flex:"1 1 auto",display:"grid",gridTemplateColumns:"auto auto",gap:2,...C&&{padding:"0 2px"}},icon:{width:16,height:16,marginRight:2,...h?{fill:e.lightErrorText}:void 0},warningIcon:{color:e.errorText,fill:e.errorText,height:12,flex:"0 0 auto",marginRight:2,width:12},chevronIcon:{fill:e.icon.secondary,flex:"0 0 auto",...g?{height:12,width:12}:{height:14,width:14},...C&&{fill:"unset"}}})),[h,d,y,b,g,C,v]),M=(0,n.useMemo)((()=>m?()=>m(k.icon):void 0),[m,k.icon]),j=(0,n.useCallback)((()=>x??null),[x]),T=(0,n.useCallback)((e=>{o(990966).clear({environment:S}),o(879952).ZH({environment:S}),null==f||f(e),e.stopPropagation()}),[S,f]),w=p||o(521913).t,A=h?()=>w(k.warningIcon):M;return(0,r.jsx)(o(654133).Z,{delayThreshold:0,disableTooltip:!Boolean(x),placement:o(998901).Placement.Bottom,render:e=>"dropdown"===b?(0,r.jsxs)(o(687626).Z,{...e,variant:h?"secondary":"lightGray",disabled:u,disabledFeedback:u,onClick:T,ref:t,style:k.button,children:[A&&A(),(0,r.jsx)("div",{style:k.children,children:s}),g?(0,o(303171).A)(k.chevronIcon):(0,i().Y)(k.chevronIcon)]}):(0,r.jsxs)(o(265640).D,{...e,icon:h?A:M,disabled:u,disabledFeedback:u,onClick:T,ref:t,shouldShrink:!0,style:k.button,isRed:h,children:[(0,r.jsx)("div",{style:k.children,children:s}),(0,i().Y)(k.chevronIcon)]}),renderTooltip:j})}));function c(e,t){const{isError:o,hasActionRequired:n,isSecondary:i,dropdownButtonType:r}=t;return o?{color:e.errorText,..."dropdown"===r&&{boxShadow:"none"}}:n?{fontWeight:a().Ue.regular,color:e.text.secondary}:i?{color:e.text.secondary}:{fontWeight:a().Ue.regular,color:e.text.primary}}},61313:(e,t,o)=>{o.d(t,{X:()=>f});var n=o(667294),i=()=>o(219727),a=()=>o(142735),r=()=>o(846550),l=()=>o(766933),s=()=>o(788860),c=()=>o(707513),u=()=>o(949719),d=()=>o(448419),p=()=>o(198829),m=()=>o(918745),g=()=>o(676279),h=()=>o(790819),y=o(785893);function f(e){const{alreadyHaveProperties:t,availablePropertyIds:o,collectionStore:f,currentValue:v,disabled:x,onChange:b,onRemove:S,placeholderMessage:C,errorMessage:k,hideErrorMessageTooltip:M}=e,j=(0,i().O7)(),T=(0,r().Fg)(),{device:w}=j,A=(0,a().VK)((()=>f.getSchema()??{}),[f]),I=(0,a().VK)((()=>f.getFormat()??{}),[f]),_=(0,a().VK)((()=>v?f.getSchema()[v]:void 0),[v,f]),P=(0,a().VK)((()=>v?f.getDeletedSchema()[v]:void 0),[v,f]),V=(0,r().yK)((e=>{const t={fill:e.lightTextColor,height:"auto",marginRight:4,width:16};return{propertyIcon:t,deletedPropertyIcon:{...t,fill:e.text.uiRedPrimary},propertyTitle:{fontWeight:c().Ue.regular,...c().Yu},deletedPropertyTitle:{color:e.text.uiRedPrimary,fontWeight:c().Ue.regular,...c().Yu}}}),[]),B=(0,n.useCallback)((()=>o),[o]),R=(0,g().d)(),F=(0,a().VK)((()=>_?function(e){return(0,y.jsx)(l().ZP,{icon:void 0,size:16,style:{...e,...V.propertyIcon},theme:T,type:_.type})}:P?function(e){return(0,y.jsx)(l().ZP,{icon:void 0,type:P.type,size:16,theme:T,style:{...e,...V.deletedPropertyIcon}})}:void 0),[P,_,V.deletedPropertyIcon,V.propertyIcon,T]),K=Boolean(k),Z=!Boolean(_)&&!Boolean(t),E=!Boolean(t);return(0,y.jsx)(d().ZP,{popupType:R,alignmentToOrigin:d().vR.Center,placementToOrigin:d().pO.Bottom,originGap:0,disabled:x,renderOrigin:e=>(0,y.jsx)(h().S,{...e,disabled:x,icon:F,isError:K,hasActionRequired:Z,isSecondary:E,tooltipMessage:!M&&k,dropdownButtonType:"button",children:_?(0,y.jsx)("div",{style:V.propertyTitle,children:_.name}):P?(0,y.jsx)("div",{style:V.deletedPropertyTitle,children:P.name}):C?(0,y.jsx)(s()._H,{...C}):t?(0,y.jsx)(s()._H,{id:"automations.propertyPicker.buttonPlaceholderAlreadyHaveProperties",defaultMessage:"Edit property"}):(0,y.jsx)(s()._H,{id:"automations.propertyPicker.buttonPlaceholder",defaultMessage:"Edit a property"})}),render:e=>{const t=(0,m().U)({device:w,width:280,paddingTop:4});return(0,y.jsx)(p().Z,{...t,children:(0,y.jsx)(u().Z,{schema:A,format:I,showRemoveOption:Boolean(S),currentProperty:v,getProperties:B,onAccept:t=>{t&&t!==v?b(t):void 0===t&&(null==S||S(v)),e.close()}})})}})}},87781:(e,t,o)=>{o.d(t,{c:()=>d});o(667294);var n=()=>o(846550),i=()=>o(788860),a=()=>o(707513),r=()=>o(212493),l=()=>o(265640),s=()=>o(637118),c=o(785893);const u=(0,i().vU)({automationRequiresSubscription:{defaultMessage:"To edit or run this automation, upgrade your plan.",id:"AutomationHeaderView.automationRequiresSubscription"},automationRequiresSubscriptionButton:{defaultMessage:"To edit or run this automation, upgrade your plan or remove any connected action steps.",id:"AutomationHeaderView.automationRequiresSubscriptionButton"},automationRequiresSubscriptionTitle:{defaultMessage:"Upgrade to use connected actions",id:"AutomationHeaderView.automationRequiresSubscriptionTitle"},automationRequiresSubscriptionUpgradeButton:{defaultMessage:"Upgrade",id:"AutomationHeaderView.automationRequiresSubscriptionUpgradeButton"}});function d(e){const{onUpsellClick:t}=e,{contextType:o}=(0,s().YC)(),d="button_block"===o||"button_property"===o,p=d?u.automationRequiresSubscriptionButton:u.automationRequiresSubscription,m=(0,n().yK)((e=>({wrap:{fontSize:14,background:e.surface.wash,border:`1px solid ${e.surface.wash}`,borderRadius:6,padding:12,marginBottom:12},button:{fontWeight:a().Ue.medium,borderRadius:6,border:`1px solid ${e.stroke.primary}`,alignSelf:"flex-start"},title:{color:e.text.primary,fontWeight:a().Ue.medium,margin:0},text:{color:e.text.secondary,margin:0}})),[]);return(0,c.jsxs)(r().jX,{direction:"column",gap:4,style:m.wrap,children:[d&&(0,c.jsx)("p",{style:m.title,children:(0,c.jsx)(i()._H,{...u.automationRequiresSubscriptionTitle})}),(0,c.jsx)("p",{style:m.text,children:(0,c.jsx)(i()._H,{...p})}),(0,c.jsx)(l().D,{onClick:t,style:m.button,children:(0,c.jsx)(i()._H,{...u.automationRequiresSubscriptionUpgradeButton})})]})}},411766:(e,t,o)=>{o.d(t,{M:()=>d,g:()=>u});o(492176),o(7961);var n=o(667294),i=()=>o(756191),a=()=>o(788860),r=()=>o(696459),l=()=>o(661641),s=()=>o(466970),c=o(785893);function u(e){const{analyzedFormulaOutput:t}=e,{parseErrors:o,typeErrors:i}=t,u=(0,a().YB)(),p=(0,s().E)("automation_updated_error_states"),m=(0,n.useMemo)((()=>d(u,o??[],i??[])),[u,o,i]);return(0,r().$K)(m)?(0,c.jsx)(l().q,{colorName:p?"uiRedPrimary":"secondary",styleName:"UISmall-12px/Regular",children:(0,c.jsx)(a()._H,{...m})}):null}function d(e,t,o){const n=null==t?void 0:t.at(0);if((0,r().$K)(n))return(0,i().sG)(n);const a=null==o?void 0:o.at(0);return(0,r().$K)(a)?(0,i().ic)(e,a):void 0}},430311:(e,t,o)=>{o.d(t,{e:()=>E});o(267602),o(653476),o(228244);var n=o(667294),i=()=>o(219727),a=()=>o(142735),r=()=>o(846550),l=()=>o(79685),s=()=>o(702041),c=()=>o(910446),u=()=>o(949549),d=()=>o(200962),p=()=>o(827282),m=o(785893);const g={viewBox:"0 0 20 20",svg:(0,m.jsx)("path",{d:"m13.987 5.682-.684.684-1.288-1.288.692-.691a.91.91 0 0 1 1.28 0c.35.35.35.93 0 1.28zm-9.433 9.433 7.914-7.914-1.289-1.289-7.92 7.908c-.122.122-.214.29-.274.457l-.336 1.082c-.06.229.153.442.366.366l1.082-.335q.252-.07.457-.275m12.446.76H5.61l1.25-1.25H17a.625.625 0 0 1 0 1.25"})},h=(0,p().IU)("pencilLine",g),y={viewBox:"0 0 20 20",svg:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("path",{d:"M9.978 7.154c-.804 0-1.333.456-1.438.874a.625.625 0 0 1-1.213-.303c.28-1.121 1.44-1.82 2.65-1.82 1.365 0 2.714.905 2.714 2.298 0 .812-.49 1.477-1.13 1.872l-.755.516a.84.84 0 0 0-.381.677.625.625 0 1 1-1.25 0c0-.688.36-1.318.921-1.706l.003-.002.784-.535.014-.008c.374-.228.544-.537.544-.814 0-.459-.517-1.049-1.463-1.049m.662 6.336a.8.8 0 1 1-1.6 0 .8.8 0 0 1 1.6 0"}),(0,m.jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 1 0 0 12.75 6.375 6.375 0 0 0 0-12.75"})]})},f=(0,p().IU)("questionMarkCircle",y);var v=()=>o(434383),x=()=>o(788860),b=()=>o(696459),S=()=>o(285755),C=()=>o(827973),k=()=>o(108714),M=()=>o(292518),j=()=>o(198829),T=()=>o(255577),w=()=>o(388284),A=()=>o(141735),I=()=>o(677559),_=()=>o(49396),P=()=>o(637118),V=()=>o(195245),B=()=>o(918745),R=()=>o(210968),F=()=>o(502550),K=()=>o(590259);const Z=(0,x().vU)({learnAboutVariablesMenuItemLabel:{defaultMessage:"Learn about variables",id:"automations.actionContextMenu.learnAboutVariablesMenuItemLabel"},learnAboutWebhooksMenuItemLabel:{defaultMessage:"Learn about webhooks",id:"automations.actionContextMenu.learnAboutWebhooksMenuItemLabel"},addStepAboveMenuItemLabel:{defaultMessage:"Add action above",id:"automations.actionContextMenu.addStepAboveMenuItemLabel"},addStepBelowMenuItemLabel:{defaultMessage:"Add action below",id:"automations.actionContextMenu.addStepBelowMenuItemLabel"},deleteMenuItemLabel:{defaultMessage:"Delete",id:"automations.actionContextMenu.deleteMenuItemLabel"},duplicateMenuItemLabel:{defaultMessage:"Duplicate",id:"automations.actionContextMenu.duplicateMenuItemLabel"},duplicatingMenuItemLabel:{defaultMessage:"Duplicatingâ¦",id:"automations.actionContextMenu.duplicatingMenuItemLabel"},editMenuItemLabel:{defaultMessage:"Edit",id:"automations.actionContextMenu.editMenuItemLabel"},moveDownMenuItemLabel:{defaultMessage:"Move down",id:"automations.actionContextMenu.moveDownMenuItemLabel"},moveUpMenuItemLabel:{defaultMessage:"Move up",id:"automations.actionContextMenu.moveUpMenuItemLabel"}});function E(e){const{actionStore:t,closeMenu:o}=e,{maybePersistedTransactionActions:r}=(0,V().i)(),{automationStore:l,contextType:s}=(0,P().YC)(),c=(0,x().YB)(),u=(0,i().O7)(),{value:d}=(0,I().XJ)(A().F.formulas),{value:p}=(0,I().XJ)(S().Sm.automationTypecheck),[g,h]=(0,n.useState)(),y=(0,a().VK)((()=>l.getActionIds()),[l]),f=(0,a().VK)((()=>y.indexOf(t.id)),[t.id,y]),v=(0,a().VK)((()=>(0,F().r)(s,t)),[t,s]),b=(0,a().VK)((()=>{if(!v||!t.isType("update_pages"))return;const e=t.getConfigStore().getKeyStore("properties").getValue();return null==e?void 0:e[0]}),[t,v]),C=0===f,k=f===y.length-1,M=(0,n.useCallback)((()=>{h(void 0),null==o||o()}),[o]),j=(0,R().p)(),T=(0,a().VK)((()=>j.some((e=>e.type===t.getType()))),[t,j]),w=(0,n.useMemo)((()=>{if(l&&T)return async()=>{const e=r.createAndCommit({perform:e=>_().duplicateAutomationAction({sourceActionStore:t,environment:u,includeParenting:!0,insertionPoint:{afterActionId:t.id},transaction:e}),userAction:"ActionContextMenu.duplicateAction"});await e.performResult.onComplete,M()}}),[t,l,u,M,r,T]),B=(0,n.useCallback)((()=>{if(d&&p)return r.createAndCommit({perform:e=>{_().removeAutomationAction({actionStore:t,automationStore:l,automationTypecheckModule:p,contextType:s,environment:u,formulasModule:d,intl:c,transaction:e})},userAction:"ActionContextMenu.removeAction"}),M(),Promise.resolve()}),[t,l,p,s,u,d,M,c,r]),E=(0,n.useMemo)((()=>{if(!C&&d&&p)return()=>{r.createAndCommit({perform:e=>{const o=L(y,f-1,f);_().reorderAutomationActions({environment:u,automationStore:l,automationTypecheckModule:p,contextType:s,formulasModule:d,intl:c,newActionIds:o,transaction:e,from:"action_menu",movedActionId:t.id})},userAction:"ActionContextMenu.moveAction"}),M()}}),[C,r,M,y,d,f,l,s,c,u,t,p]),D=(0,n.useMemo)((()=>{if(!k&&d&&p)return()=>{r.createAndCommit({perform:e=>{const o=L(y,f+1,f);_().reorderAutomationActions({environment:u,automationStore:l,automationTypecheckModule:p,contextType:s,formulasModule:d,intl:c,newActionIds:o,transaction:e,from:"action_menu",movedActionId:t.id})},userAction:"ActionContextMenu.moveAction"}),M()}}),[k,r,M,y,f,l,s,c,d,u,t,p]),O=(0,n.useMemo)((()=>{if(v&&b)return function(){h({initialState:{actionId:t.id,propertyId:b,type:"eventActionProperty"},insertionPoint:void 0})}}),[t.id,v,b]),N=(0,n.useMemo)((()=>{if(0!==j.length)return()=>{h({initialState:{availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"},insertionPoint:{beforeActionId:t.id}})}}),[j.length,t.id]),W=(0,n.useMemo)((()=>{if(0!==j.length)return()=>{h({initialState:{availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"},insertionPoint:{afterActionId:t.id}})}}),[j.length,t.id]),U=(0,a().VK)((()=>"define_variables"===t.getType()?{link:"https://www.notion.so/help/database-automations#database-automation-actions",label:Z.learnAboutVariablesMenuItemLabel}:"http_request"===t.getType()?{link:"https://www.notion.so/help/webhook-actions",label:Z.learnAboutWebhooksMenuItemLabel}:void 0),[t]);return(0,m.jsxs)(m.Fragment,{children:[!g&&(0,m.jsx)(H,{onAddStepAbove:N,onAddStepBelow:W,onDelete:B,onDuplicate:w,onEdit:O,onMoveDown:D,onMoveUp:E,learnAbout:U}),g&&(0,m.jsx)(K().Z,{initialState:g.initialState,insertionPoint:g.insertionPoint,onClose:M})]})}function H(e){const{onAddStepAbove:t,onAddStepBelow:o,onDelete:i,onDuplicate:a,onEdit:g,onMoveDown:y,onMoveUp:S,learnAbout:C}=e,M=(0,B().F)();let A=!1;const I=function(e){const{hasSeparator:t,onEdit:o}=e,i=(0,n.useMemo)((()=>{if(o)return{action:o,key:"edit",render:e=>(0,m.jsx)(D,{...e,icon:h({width:p().ZG.default}),children:(0,m.jsx)(x()._H,{...Z.editMenuItemLabel})})}}),[o]),a=[i].filter(b().$K);if(0===a.length)return;return{items:a,key:"editActions",render:e=>(0,m.jsx)(w().Z,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:A,onEdit:g});A||=Boolean(I);const _=function(e){const{hasSeparator:t,onMoveDown:o,onMoveUp:i}=e,a=(0,n.useMemo)((()=>{if(i)return{action:i,key:"moveUp",render:e=>(0,m.jsx)(D,{...e,icon:(0,s().R)({width:p().ZG.default}),children:(0,m.jsx)(x()._H,{...Z.moveUpMenuItemLabel})})}}),[i]),r=(0,n.useMemo)((()=>{if(o)return{action:o,key:"moveDown",render:e=>(0,m.jsx)(D,{...e,icon:(0,l().j)({width:p().ZG.default}),children:(0,m.jsx)(x()._H,{...Z.moveDownMenuItemLabel})})}}),[o]),c=[a,r].filter(b().$K);if(0===c.length)return;return{items:c,key:"moveSteps",render:e=>(0,m.jsx)(w().Z,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:A,onMoveDown:y,onMoveUp:S});A||=Boolean(_);const P=function(e){const{hasSeparator:t,onAddStepAbove:o,onAddStepBelow:i}=e,a=(0,n.useMemo)((()=>{if(o)return{action:o,key:"addStepAbove",render:e=>(0,m.jsx)(D,{...e,icon:(0,u().M)({width:p().ZG.default}),children:(0,m.jsx)(x()._H,{...Z.addStepAboveMenuItemLabel})})}}),[o]),r=(0,n.useMemo)((()=>{if(i)return{action:i,key:"addStepBelow",render:e=>(0,m.jsx)(D,{...e,icon:(0,c().s)({width:p().ZG.default}),children:(0,m.jsx)(x()._H,{...Z.addStepBelowMenuItemLabel})})}}),[i]),l=[a,r].filter(b().$K);if(0===l.length)return;return{items:l,key:"addSteps",render:e=>(0,m.jsx)(w().Z,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:A,onAddStepAbove:t,onAddStepBelow:o});A||=Boolean(P);const V=function(e){const{hasSeparator:t,onDuplicate:o,onDelete:i}=e,[a,r]=(0,n.useState)(!1),l=(0,n.useMemo)((()=>{if(o)return{action:async()=>{r(!0);try{await o()}finally{r(!1)}},key:"duplicate",render:e=>(0,m.jsx)(D,{...e,icon:(0,d().a)({width:p().ZG.default}),isLoading:a,children:a?(0,m.jsx)(x()._H,{...Z.duplicatingMenuItemLabel}):(0,m.jsx)(x()._H,{...Z.duplicateMenuItemLabel})})}}),[a,o]),s=(0,n.useMemo)((()=>{if(i)return{action:i,key:"delete",render:e=>(0,m.jsx)(D,{...e,icon:(0,v().y)({width:p().ZG.default}),isRedOnHover:!0,children:(0,m.jsx)(x()._H,{...Z.deleteMenuItemLabel})})}}),[i]),c=[l,s].filter(b().$K);if(0===c.length)return;return{items:c,key:"otherActions",render:e=>(0,m.jsx)(w().Z,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:A,onDuplicate:a,onDelete:i});A||=Boolean(V);const R=function(e){const{hasSeparator:t,learnAbout:o}=e,n=(0,r().yK)((e=>({icon:{height:16,width:16,fill:e.mediumTextColor},textWrapper:{color:e.mediumTextColor}})),[]);if(!o)return;return{items:[{action:()=>{},key:"learnAbout",render:e=>(0,m.jsx)(D,{...e,icon:f(n.icon),textWrapperStyle:n.textWrapper,children:(0,m.jsx)(k().Z,{href:o.link,external:!0,children:(0,m.jsx)(x()._H,{...o.label})})})}],key:"learnSteps",render:e=>(0,m.jsx)(w().Z,{topBorder:t,...e})}}({hasSeparator:A,learnAbout:C});return A||=Boolean(R),(0,m.jsx)(j().Z,{...M,children:(0,m.jsx)(T().ZP,{type:T().iW.Vertical,sections:[I,_,P,V,R].filter(b().$K),initialFocus:0})})}function D(e){const{children:t,icon:o,isLoading:n,...i}=e,a=n?(0,m.jsx)(M().Z,{}):o;return(0,m.jsx)(C().Z,{...i,disabled:n,disabledFeedback:n,icon:a,title:t})}function L(e,t,o){if(t<0||t>=e.length||o<0||o>=e.length)return e;const n=[...e];return n[t]=e[o],n[o]=e[t],n}},590259:(e,t,o)=>{o.d(t,{z:()=>Ge,Z:()=>ze});var n=o(667294),i=()=>o(142735),a=()=>o(696459),r=()=>o(414108),l=(o(670560),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(653476),o(241792),o(731107),o.n(o(443261))),s=()=>o(219727),c=()=>o(846550),u=()=>o(271896),d=()=>o(779247),p=()=>o(429600),m=()=>o(922713),g=()=>o(259408),h=()=>o(788860),y=()=>o(513670),f=()=>o(285755),v=()=>o(827973),x=()=>o(198829),b=()=>o(255577),S=()=>o(603692),C=()=>o(989377),k=()=>o(388284),M=()=>o(654133),j=()=>o(594546),T=()=>o(487270),w=()=>o(527278),A=()=>o(677559);function I(){const e=(0,s().O7)();return(0,n.useMemo)((()=>(0,j().mc)(e)),[e])}var _=()=>o(356140),P=()=>o(998901),V=()=>o(876822),B=()=>o(965014),R=()=>o(815277),F=()=>o(49396),K=()=>o(637118),Z=()=>o(339352),E=()=>o(195245),H=()=>o(918745),D=()=>o(210968),L=(o(749411),()=>o(912203)),O=()=>o(740046),N=()=>o(561933),W=()=>o(749826),U=o(785893);function G(){return(0,c().yK)((e=>({chevronIcon:{marginInlineStart:6,width:12,height:"auto"}})),[])}function z(e){const{automationStore:t,collectionStore:o,searchInput:n}=e,i=new Set(t.getActionStores().flatMap((e=>e.isType("update_pages")?e.getConfigStore().getKeyStore("properties").getValue()??[]:[]))),r=o.getFormat(),s=o.getSchema(),c=(0,L().cO)({collectionFormat:r,collectionSchema:s,filter:e=>{let[t]=e;return!i.has(t)},spaceId:o.getSpaceId(),restrictCrossSpace:W().default.checkGate({gateName:"collections_xws"})}),u=new Map,d=c.map((e=>{const t=s[e];if(t){const o=`${t.name} ${N().SO[t.type]}`;return u.set(e,o),o}})).filter(a().$K),p=new Set(l().filter(n,d).map((e=>{let{original:t}=e;return t})));return c.filter((e=>{const t=u.get(e);return t&&p.has(t)}))}function $(e){const{onChange:t,value:o,placeholder:n}=e;return{items:[{action:()=>{},key:"search-input",render:e=>(0,U.jsx)(Y,{...e,onChange:t,value:o,placeholder:n})}],key:"search",render:e=>(0,U.jsx)(k().Z,{...e})}}const Y=(0,n.forwardRef)((function(e,t){const{onChange:o,value:n,placeholder:i,...a}=e,r=(0,h().YB)(),l=(0,c().yK)((()=>({input:{margin:0,padding:0}})),[]),{isMobile:u}=(0,s().Fy)();return(0,U.jsx)(O().ZP,{...a,focus:!u,inputOuterStyle:{margin:0},onChange:o,placeholder:r.formatMessage(i),ref:t,style:l.input,value:n})}));var q=()=>o(40696);const J=(0,h().vU)({searchInputPlaceholder:{id:"UpdateThisPagePropertiesActionMenu.searchInputPlaceholder ",defaultMessage:"Search for a propertyâ¦"},editProperty:{id:"automationEventActionMenu.pagePropertiesEditedSection.title",defaultMessage:"Edit property"},backButtonAriaLabel:{id:"UpdateThisPagePropertiesActionMenu.backButtonAriaLabel",defaultMessage:"Back to previous step"}});function X(e){const{automationActionMenuStore:t,onClose:o}=e,{automationStore:a,contextType:r}=(0,K().YC)(),l=(0,Z().w)(a,r),[s,c]=(0,n.useState)(""),u=(0,i().VK)((()=>l&&a?z({automationStore:a,collectionStore:l,searchInput:s}):[]),[a,l,s]),d=(0,i().VK)((()=>null==l?void 0:l.getSchema()),[l]),p=(0,n.useMemo)((()=>{const e=[];e.push($({onChange:e=>c(e.target.value),value:s,placeholder:J.searchInputPlaceholder}));const o=d&&Q({automationActionMenuStore:t,propertyIds:u,normalizedBlockSchema:d,includeTitle:!1});return o&&e.push(o),e}),[t,u,d,s]),m=(0,q().F)({automationTriggerActionMenuStore:t,customMenuProps:{leftOuterStyle:{flexGrow:0},rightOuterStyle:{flexGrow:0},titleOuterStyle:{minWidth:0}},onClose:o,title:(0,U.jsx)("div",{style:{display:"inline-flex",minWidth:0,whiteSpace:"pre"},children:(0,U.jsx)(h()._H,{...J.editProperty})})});return(0,U.jsx)(x().Z,{...m,children:(0,U.jsx)(b().ZP,{initialFocus:0,sections:p,type:b().iW.Vertical})})}function Q(e){const{automationActionMenuStore:t,hasTopBorder:o,normalizedBlockSchema:n,propertyIds:i,includeTitle:r}=e,l=i.map((e=>{const o=n[e];if(o)return function(e){const{automationActionMenuStore:t,propertyId:o,propertySchema:n}=e;return{action:()=>{t.pushSettingsItem({actionId:void 0,propertyId:o,type:"eventActionProperty"})},key:`update_this_page_property_${o}_action`,render:e=>(0,U.jsx)(ee,{...e,propertySchema:n})}}({automationActionMenuStore:t,propertyId:e,propertySchema:o})})).filter(a().$K);if(0!==l.length)return{key:"automation_update_this_page_section",items:l,render:e=>(0,U.jsx)(k().Z,{...e,title:r?(0,U.jsx)(h()._H,{...J.editProperty}):void 0,topBorder:o})}}const ee=(0,n.forwardRef)((function(e,t){const{propertySchema:o,...n}=e,i=G();return(0,U.jsx)(v().Z,{...n,icon:(0,U.jsx)(te,{propertySchema:o}),ref:t,right:(0,p().o)(i.chevronIcon),title:o.name})}));function te(e){const{propertySchema:t}=e,n=(0,c().Fg)(),i=(0,c().yK)((e=>({icon:{fill:e.icon.secondary,width:12},iconWrap:{alignItems:"center",borderRadius:4,display:"flex",height:20,justifyContent:"center",width:20}})),[]);return(0,U.jsx)("div",{style:i.iconWrap,children:(0,U.jsx)(o(766933).ZP,{icon:t.icon,size:16,style:i.icon,theme:n,type:t.type})})}const oe=(0,h().vU)({searchInputPlaceholder:{id:"automationEventActionMenu.searchInputPlaceholder.label",defaultMessage:"Search actionsâ¦"},updateThisPagePropertiesMenuItemCaption:{defaultMessage:"Edit propertyâ¦",id:"automationEventActionMenu.updateThisPagePropertiesMenuItem.caption"},upgrade:{defaultMessage:"Upgrade to Plus",id:"automationEventActionMenu.upsellFeatures.title"},disabledActionTooltipHeader:{defaultMessage:"Disabled in your workspace",id:"automationEventActionMenu.disabledActionTooltipHeader"},disabledActionTooltipBody:{defaultMessage:"Contact a workspace admin to modify this setting.",id:"automationEventActionMenu.disabledActionTooltipBody"}}),ne=["automation_actions","update_this_page_actions"],ie=["update_this_page_actions","automation_actions"];function ae(e){const{automationActionMenuStore:t,hasSearch:o,hasUpdateThisPagePropertyActions:r,onClose:p}=e,{isMobile:C}=(0,s().Fy)(),M=(0,s().O7)(),P=(0,h().YB)(),L=I(),{value:O}=(0,A().XJ)(f().Sm.automationActionRegistry),{automationStore:N,contextType:W}=(0,K().YC)(),{maybePersistedTransactionActions:G,onActionAdded:Y}=(0,E().i)(),q=(0,Z().w)(N,W),J=(0,D().p)(),X="event"===W,ee=(0,n.useMemo)((()=>X?ie:ne),[X]),te=(0,i().VK)((()=>t.getInsertionPoint()),[t]),[ae,le]=n.useState(""),se=(0,i().VK)((()=>o?function(e){const{automationActionRegistryModule:t,availableActions:o,searchInput:n}=e;if(!t||0===o.length)return[];const i=new Map,a=o.map((e=>{const t=w().Z.formatMessage(e.display.name);return i.set(e.type,t),t})),r=new Set(l().filter(n,a).map((e=>{let{original:t}=e;return t})));return o.filter((e=>{const t=i.get(e.type);return t&&r.has(t)}))}({automationActionRegistryModule:O,availableActions:J,searchInput:ae}):J),[J,o,ae,O]),ce=(0,i().VK)((()=>N.getActionStores().map((e=>e.getType())).filter(a().$K)),[N]),ue=(0,n.useCallback)((e=>{if(!N)return;const t=N.getSpaceId(),{performResult:o}=G.createAndCommit({userAction:"AutomationActionList.addAction",perform:o=>F().addAutomationAction({actionId:(0,T().TS)({environment:M,table:m().Xj,spaceId:t}),actionType:e,automationStore:N,environment:M,insertionPoint:te,intl:P,transaction:o,builderType:"modal"})});o&&((0,u().eI)(L,{automation_id:N.id,automation_action_id:o.id,automation_action_type:e,builder_type:"modal"}),null==Y||Y(o)),p()}),[N,G,p,M,te,P,L,Y]),pe=(0,i().VK)((()=>r&&q&&N?z({automationStore:N,collectionStore:q,searchInput:ae}):[]),[N,q,r,ae]),me=(0,i().VK)((()=>Boolean(r&&q&&N&&z({automationStore:N,collectionStore:q,searchInput:""}).length>0)),[N,q,r]),ge=(0,i().VK)((()=>null==q?void 0:q.getSchema()),[q]),he=(0,_().W)(),ye=(0,i().VK)((()=>{var e;return null===(e=V().default.state.currentUserStore)||void 0===e?void 0:e.getModel()}),[]),fe=(0,R().oo)({name:"premium_automations",spaceId:he,userId:null==ye?void 0:ye.id}),ve=function(e){let{onClose:t,upsell:o}=e;const i=(0,s().O7)();return(0,n.useCallback)((()=>{t(),o&&B().y(i,{from:"database_automation_modal_action_item",upsell:o})}),[i,t,o])}({onClose:p,upsell:null==fe?void 0:fe.upsell}),xe=(0,g()._e)(fe),be=(0,c().yK)((e=>({unavailableHeader:{display:"inline-flex",minWidth:0,whiteSpace:"pre",cursor:"pointer",color:e.text.secondary},unavailableLinkIcon:{fill:e.icon.secondary}})),[]),Se=(0,i().VK)((()=>{const e=[],n="button_block"===W||"button_property"===W,i=!n&&!xe,r=n&&!xe;o&&!i&&e.push($({onChange:e=>le(e.target.value),value:ae,placeholder:oe.searchInputPlaceholder}));const l=ee.reduce(((e,o)=>{if("automation_actions"===o)if(i||r){const[o,n]=y().uK(se,(e=>i?"slack_notification"===e.type:r?"send_gmail_notification"!==e.type&&"http_request"!==e.type:void 0)),l=re({key:"automation_actions_available_section",actionRegistryItems:o,hasTopBorder:e.length>0,onMenuItemClick:ue,automationActionMenuStore:t,shouldShowUpdateThisPageProperties:"button_property"===W}),s=re({key:"automation_actions_unavailable_section",actionRegistryItems:n,hasTopBorder:(0,a().$K)(l),hideChevron:!0,onMenuItemClick:ve,onClick:ve,automationActionMenuStore:t,shouldShowUpdateThisPageProperties:"event"===W,title:(0,U.jsxs)("div",{style:be.unavailableHeader,onClick:ve,children:[(0,U.jsx)(h()._H,{...oe.upgrade}),(0,U.jsx)(S().y,{iconGroup:d().T,variantName:"small",style:be.unavailableLinkIcon})]})});l&&e.push(l),s&&e.push(s)}else{const o=re({actionRegistryItems:se,hasTopBorder:e.length>0,onMenuItemClick:ue,automationActionMenuStore:t,shouldShowUpdateThisPageProperties:me&&"button_block"!==W&&(!ae||de(ae))});o&&e.push(o)}else if("update_this_page_actions"===o){const o=ge&&(xe||!X)&&ae.length>0&&Q({automationActionMenuStore:t,hasTopBorder:e.length>0,normalizedBlockSchema:ge,propertyIds:pe,includeTitle:!0});o&&e.push(o)}else(0,a().t1)(o);return e}),[]);return 0===l.length?e.push({key:"no_results_section",items:[{key:"no_results_item",action:()=>{},render:e=>(0,U.jsx)(v().Z,{...e,disabled:!0,disabledFeedback:!0,title:(0,U.jsx)(h()._H,{defaultMessage:"No results",id:"automations.automationEventActionMenu.noResultsItem"})})}],render:e=>(0,U.jsx)(k().Z,{...e})}):e.push(...l),e}),[t,xe,pe,se,ge,W,o,me,X,ue,ve,ae,ee,be.unavailableHeader,be.unavailableLinkIcon]);(0,n.useEffect)((()=>{(0,j().j)({environment:M,event:{eventName:"automation_action_menu_opened",eventProperties:{automation_id:N.id,automation_context_type:W,existing_action_types:ce,available_action_types:J.map((e=>e.type))}}})}),[J,W,ce,N,M]);let Ce=(0,H().F)({paddingBottom:6,paddingTop:6,width:266});return C||(Ce={...Ce,maxHeight:"50vh"}),(0,U.jsx)(x().Z,{...Ce,children:(0,U.jsx)(b().ZP,{initialFocus:0,sections:Se,type:b().iW.Vertical})})}function re(e){const{actionRegistryItems:t,hasTopBorder:o,onMenuItemClick:n,onClick:i,automationActionMenuStore:r,shouldShowUpdateThisPageProperties:l,key:s,title:c,hideChevron:u}=e,d=y().oA([l?ce({hideChevron:u,onClick:()=>{(0,a().$K)(i)?i():r.pushSettingsItem({type:"updateThisPageProperties"})}}):void 0,...t.map((e=>function(e){const{actionRegistryItem:t,onClick:o}=e;return{action:()=>o(t.type),key:`${t.type}_action`,render:e=>(0,U.jsx)(le,{...e,actionRegistryItem:t})}}({actionRegistryItem:e,onClick:n})))]);if(0!==d.length)return{key:s||"automation_actions_section",items:d,render:e=>(0,U.jsx)(k().Z,{...e,topBorder:o,title:c})}}const le=(0,n.forwardRef)((function(e,t){const{actionRegistryItem:r,...l}=e,s=r.display,{automationStore:u,contextType:d}=(0,K().YC)(),p=(0,i().VK)((()=>(0,o(985575).uV)(u,d)),[u,d]),m=(0,_().W)(),g=(0,i().VK)((()=>{var e;return null===(e=V().default.state.currentUserStore)||void 0===e?void 0:e.getModel()}),[]),y=(0,R().VX)({name:"premium_automations",spaceId:m,userId:null==g?void 0:g.id}),f=(0,n.useMemo)((()=>{if(y)return!1;return"button_block"===d||"button_property"===d?"send_gmail_notification"===r.type||"http_request"===r.type:"slack_notification"!==r.type}),[r.type,d,y]),x=(0,i().VK)((()=>!!((0,a().$K)(r)&&(0,a().$K)(p)&&(0,a().$K)(r.isDisabledForContext))&&r.isDisabledForContext(p)),[r,p]),b=(0,c().yK)((e=>({row:{display:"grid",gridTemplateColumns:"auto auto auto",justifyContent:"flex-start",...(f||x)&&{color:e.text.tertiary,cursor:"default"}},badge:{...(f||x)&&{color:e.text.tertiary,backgroundColor:e.accentColors.translucentGray[75]}},tooltipHeader:{width:200},tooltipBody:{color:e.text.secondary}})),[x,f]),S=(0,n.useMemo)((()=>{switch(r.type){case"send_gmail_notification":return(0,U.jsx)(o(663631).Z,{style:b.badge});case"http_request":return(0,U.jsx)(C().i,{newBadgeKey:"http_request_automation_action",didUserEngage:!1,style:b.badge});case"define_variables":return(0,U.jsx)(C().i,{newBadgeKey:"define_variables_automation_action",didUserEngage:!1,style:b.badge});default:return}}),[r.type,b.badge]);return s?(0,U.jsx)(M().Z,{textWrap:!0,placement:P().Placement.Right,alignment:P().Alignment.End,disableTooltip:!x,renderTooltip:()=>(0,U.jsxs)("div",{style:b.tooltipHeader,children:[(0,U.jsx)("div",{children:(0,U.jsx)(h()._H,{...oe.disabledActionTooltipHeader})}),(0,U.jsx)("div",{style:b.tooltipBody,children:(0,U.jsx)(h()._H,{...oe.disabledActionTooltipBody})})]}),render:e=>(0,U.jsx)(v().Z,{...l,...e,disabled:x,icon:(0,U.jsx)(se,{type:"actionRegistry",actionRegistryItem:r,disabled:x||f}),ref:t,right:S,title:(0,U.jsx)(h()._H,{...s.name}),style:b.row})}):null}));function se(e){const t="actionRegistry"===e.type&&"send_gmail_notification"===e.actionRegistryItem.type,o=(0,c().yK)((o=>({icon:{fill:e.disabled?o.text.tertiary:o.icon.secondary,height:"auto",width:16,opacity:t&&e.disabled?.4:1},iconWrap:{alignItems:"center",borderRadius:4,display:"flex",height:20,justifyContent:"center",width:20}})),[t,e.disabled]);return(0,U.jsx)("div",{style:o.iconWrap,children:"actionRegistry"===e.type?e.actionRegistryItem.display.icon(o.icon):"icon"===e.type?e.icon(o.icon):(0,a().t1)(e)})}function ce(e){const{onClick:t,hideChevron:o}=e;return{action:()=>t(),key:"update_this_page_properties",render:e=>(0,U.jsx)(ue,{...e,hideChevron:o})}}const ue=(0,n.forwardRef)((function(e,t){const{hideChevron:n}=e,a=G(),{contextType:r}=(0,K().YC)(),l=(0,_().W)(),s=(0,i().VK)((()=>{var e;return null===(e=V().default.state.currentUserStore)||void 0===e?void 0:e.getModel()}),[]),u=(0,R().VX)({name:"premium_automations",spaceId:l,userId:null==s?void 0:s.id}),d=(0,c().yK)((e=>({row:{...!u&&"event"===r&&{color:e.text.tertiary}}})),[r,u]);return(0,U.jsx)(v().Z,{...e,icon:(0,U.jsx)(se,{type:"icon",icon:o(12663).N}),ref:t,right:!n&&(0,p().o)(a.chevronIcon),title:(0,U.jsx)(h()._H,{...oe.updateThisPagePropertiesMenuItemCaption}),style:d.row})}));function de(e){const t=w().Z.formatMessage(oe.updateThisPagePropertiesMenuItemCaption);return l().test(e,t)}o(470928);var pe=()=>o(473304),me=()=>o(309968),ge=()=>o(721927),he=()=>o(226413),ye=()=>o(907874),fe=()=>o(955620),ve=()=>o(707513),xe=()=>o(636340),be=()=>o(98235),Se=()=>o(903098);const Ce=(0,h().vU)({menuHeaderTitle:{defaultMessage:"Set {propertyName} to",id:"automations.eventActionProperty.menuHeaderTitle"},menuHeaderEditTitle:{defaultMessage:"Edit {propertyName}",id:"automations.eventActionProperty.menuHeaderEditTitle"}});function ke(e){var t;const{actionId:o,automationActionMenuStore:r,onClose:l,propertyId:c}=e,{automationStore:d,contextType:p}=(0,K().YC)(),g=(0,Z().w)(d,p),{maybePersistedTransactionActions:y,onActionAdded:f}=(0,E().i)(),v=(0,h().YB)(),x=(0,s().O7)(),b=I(),S=(0,i().VK)((()=>r.getInsertionPoint()),[r]),C=(0,n.useMemo)((()=>g?{collectionStore:g,property:c,type:"collection"}:void 0),[g,c]),k=(0,i().VK)((()=>d.getSpaceId()),[d]),j=o??(0,T().TS)({environment:x,table:m().Xj,spaceId:k}),w=(0,i().VK)((()=>{const e=((null==d?void 0:d.getActionStores())??[]).find((e=>e.id===j));if(e&&e.isType("update_pages"))return e}),[d,j]),A=(0,i().VK)((()=>null==g?void 0:g.getSchema()[c]),[g,c]),_=(0,n.useMemo)((()=>{if(A&&(0,L().SF)(A))return L().Y_[A.type]}),[A]),V=(0,n.useMemo)((()=>!!A&&("multi_select"===A.type||(0,he().en)(A)&&1!==A.limit)),[A]),B=Boolean(A&&"button"!==A.type&&"rollup"!==A.type&&"formula"!==A.type&&"text"===(0,ge().vc)(A.type)),R=Boolean(A&&"button"!==A.type&&"rollup"!==A.type&&"formula"!==A.type&&"number"===(0,ge().vc)(A.type)),H=Boolean(A&&"date"===A.type),D=Boolean(A&&"status"===A.type),O=(0,i().VK)((()=>{if(g&&A)return(0,ye().setPropertyValueToSimpleFormulaReturnType)(g.getSpaceShardedPointer(),c,A)}),[g,A,c]),N=(0,i().VK)((()=>{if(w)return w.getConfigStore().getKeyStore("values").getKeyStore(c).getValue()}),[w,c]),[W,G]=(0,n.useState)(N),z=(0,n.useRef)({action:(null==N?void 0:N.action)||pe().z8,value:null==N?void 0:N.value}),$=(0,n.useMemo)((()=>{var e;return(0,ye().fromSimpleFormulaArrayValue)(null==W||null===(e=W.value)||void 0===e?void 0:e.value)}),[null==W||null===(t=W.value)||void 0===t?void 0:t.value]),Y=(0,Se().z)({actionId:null==w?void 0:w.id}),J=(0,n.useCallback)((e=>{let{action:t,value:o}=e;if(!d)return;const{performResult:n}=y.createAndCommit({perform:e=>{if(!w)return F().addAutomationAction({actionId:j,actionType:"update_pages",automationStore:d,config:{properties:[c],target:{id:(0,me().Vl)(),type:"variable"},values:{[c]:{action:t,value:o}}},environment:x,intl:v,insertionPoint:S,transaction:e,builderType:"modal"});xe().sW({data:{[c]:{action:t,value:o}},store:w.getConfigStore().getKeyStore("values"),transaction:e})},userAction:"UpdateThisPagePropertyActionMenu.saveChanges"});n&&((0,u().eI)(b,{automation_id:d.id,automation_action_id:n.id,automation_action_type:"update_pages"}),null==f||f(n))}),[w,d,x,b,j,S,v,y,f,c]),X=(0,n.useCallback)((()=>{J(z.current),l()}),[J,l]),Q=(0,n.useCallback)(((e,t)=>{const o=t||pe().z8,n=z.current.value;z.current={value:e,action:o};if("formula"===(null==e?void 0:e.type))return void G({action:o,value:e});if("formula"===(null==n?void 0:n.type))G({action:o,value:e});else if(B||R||V||(0,a().$K)(t))G({action:o,value:e});else if(H){const t=(0,ye().fromSimpleFormulaArrayValue)(null==e?void 0:e.value)[0];if((0,a().$K)(t)&&(0,ye().isAnnotationSimpleValueToken)(t)&&(0,fe().fpG)(t))return void G({action:o,value:e});X()}}),[H,B,R,V,X]),ee="person"===(null==A?void 0:A.type)||"relation"===(null==A?void 0:A.type)||"multi_select"===(null==A?void 0:A.type),te=ee?Ce.menuHeaderEditTitle:Ce.menuHeaderTitle,oe=(0,q().F)({automationTriggerActionMenuStore:r,customMenuProps:{leftOuterStyle:{flexGrow:0},rightOuterStyle:{flexGrow:0},titleOuterStyle:{minWidth:0}},onClose:X,onDone:V||B||R||ee?X:void 0,title:(0,U.jsx)("div",{style:{display:"inline-flex",minWidth:0,whiteSpace:"pre"},children:v.formatMessage(te,{propertyName:(0,U.jsx)(M().Z,{placement:P().Placement.Bottom,render:e=>(0,U.jsx)("div",{...e,style:{...ve().Yu},children:(null==A?void 0:A.name)??""}),renderTooltip:()=>(null==A?void 0:A.name)??""})})})});return A&&O&&C?(0,U.jsx)(be().a,{allowedFormulaReturnTypes:_,formulaValueContext:C,currentSimpleFormulaValueTokens:$,formulaTypecheckContextValues:Y,menuProps:oe,onChange:Q,onClose:X,parentRecordStore:d,showClearButton:!D,type:O,value:null==W?void 0:W.value,action:(0,pe().o9)(W),showReplaceAddRemoveToggle:ee}):null}var Me=()=>o(714230),je=()=>o(235484),Te=()=>o(525807),we=()=>o(855741),Ae=()=>o(388915),Ie=()=>o(265640),_e=()=>o(906651),Pe=()=>o(762300),Ve=()=>o(138912),Be=()=>o(826955);function Re(e){const{type:t,automationActionMenuStore:o,onClose:n}=e,a=He(),r=(0,i().VK)((()=>{var e;return null===(e=V().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),l=(0,i().VK)((()=>V().default.state.currentUserStore),[]),s="connectToSlackReconnect"===t?e.externalBotId:void 0,c=(0,i().VK)((()=>{if(void 0!==s&&l)return(0,Be().Kv)(l,{table:Te().PJ,id:s,spaceId:r}).getValue()}),[s,l,r]);let u,d=Ee({viewType:"connectToSlackDefault"});if("connectToSlackReconnect"===t){if(!c)return null;const{accountName:e,organizationName:t}=(0,Pe().jg)(c);u=(0,Pe().jc)(c),d=Ee({viewType:"connectToSlackReconnect",accountName:e,organizationName:t})}return(0,U.jsx)(q().Z,{type:"custom",automationTriggerActionMenuStore:o,onClose:n,children:(0,U.jsx)(k().Z,{children:(0,U.jsxs)("div",{style:a.container,children:[(0,U.jsx)(Ke,{}),(0,U.jsxs)("div",{style:a.connectToSlackBody,children:[(0,U.jsx)("div",{style:a.connectToSlackTitleText,children:Ze(t)}),(0,U.jsx)("div",{style:a.connectToSlackDescriptionText,children:d})]}),(0,U.jsx)(Fe,{...e,slackWorkspaceId:u})]})})})}function Fe(e){const{automationActionMenuStore:t,slackWorkspaceId:o}=e,n=(0,s().O7)(),r=He(),l=(0,i().VK)((()=>{var e;return null===(e=V().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),c=(0,i().VK)((()=>Ve().default.integrations.state.find((e=>e.id===je().nO))),[]);return c&&l?(0,U.jsxs)("div",{style:r.buttonGroup,children:[(0,U.jsx)(_e().Z,{style:r.connectToSlackButton,isLarge:!0,onClick:async()=>{const i=await Ae().hM({environment:n,integration:c,spaceId:l,from:"collection_view_settings",options:{slackWorkspaceId:o}});we().x.isFail(i)?t.replaceSettingsItem({actionStore:e.actionStore,type:"selectWorkspace"}):"connectToSlackReconnect"===e.type||("connectToSlackDefault"===e.type?i.value.externalAuthentication?t.replaceSettingsItem({type:"selectChannelNew",currentExternalAuthentication:i.value.externalAuthentication,actionStore:e.actionStore}):t.replaceSettingsItem({actionStore:e.actionStore,type:"selectWorkspace"}):(0,a().t1)(e))},children:(0,U.jsx)(h()._H,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.connectButton.label",defaultMessage:"Connect"})}),(0,U.jsx)(Ie().D,{style:r.cancelButton,size:"lg",onClick:()=>{t.popSettingsItem()},children:(0,U.jsx)(h()._H,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.cancelButton.label",defaultMessage:"Cancel"})})]}):null}function Ke(){const e=He();return(0,U.jsx)("div",{children:(0,U.jsx)("img",{src:Me().Z.images.externalIntegrations.slackIconPng,style:e.slackIcon})})}function Ze(e){return"connectToSlackDefault"===e?(0,U.jsx)(h()._H,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.title",defaultMessage:"Connect to Slack"}):"connectToSlackReconnect"===e?(0,U.jsx)(h()._H,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.reconnect.title",defaultMessage:"Reconnect to Slack"}):void(0,a().t1)(e)}function Ee(e){const{viewType:t}=e;return"connectToSlackDefault"===t?(0,U.jsx)(h()._H,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.description",defaultMessage:"Get notified in channels, see rich previews, and more."}):"connectToSlackReconnect"===t?(0,U.jsx)(h()._H,{id:"AutomationSlackConnectToSlackView.reconnect.description",defaultMessage:'Reconnect your Slack account ({accountName}) on {hasOrganizationName, select, true {"{organizationName}"} other {your Slack workspace}} to resume your notifications.',values:{accountName:e.accountName,hasOrganizationName:(0,a().$K)(e.organizationName),organizationName:e.organizationName}}):void(0,a().t1)(t)}function He(){return(0,c().yK)((e=>({container:{display:"flex",flexDirection:"column",margin:"10px 15px",justifyContent:"center",textAlign:"center"},connectToSlackBody:{margin:"0px 25px"},connectToSlackTitleText:{marginBottom:2,fontWeight:ve().Ue.semibold},connectToSlackDescriptionText:{fontSize:13,color:e.mediumTextColor},slackIcon:{width:23,height:"auto"},buttonGroup:{margin:"10px 10px 0px 10px"},connectToSlackButton:{width:"100%"},cancelButton:{color:e.mediumTextColor,width:"100%",justifyContent:"center",fontWeight:ve().Ue.medium,fontSize:13,marginTop:8}})),[])}var De=()=>o(953349);function Le(e){const{actionStore:t,automationActionMenuStore:o,onClose:i}=e,{maybePersistedTransactionActions:r}=(0,E().i)(),l=n.useCallback(((e,o)=>{t&&r.createAndCommit({perform:n=>{xe().sW({data:{config:{external_bot_id:o,target:{id:e.id,name:"",type:e.type}}},store:t,transaction:n})},userAction:"SlackSelectChannelMenu.handleChannelSelect"}),i()}),[t,r,i]),s=(0,n.useCallback)((()=>{const e=o.getState().stack;e.length<2||("selectWorkspace"===e[e.length-2].type?o.popSettingsItem():o.replaceSettingsItem({actionStore:t,type:"selectWorkspace"}))}),[t,o]),c="selectChannelNew"===e.type?void 0:"selectChannelUpdate"===e.type?e.currentNotificationChannel:(0,a().t1)(e),u=(0,n.useMemo)((()=>c?[c]:void 0),[c]);return(0,U.jsx)(De().ZP,{currentExternalAuthentication:e.currentExternalAuthentication,currentNotificationChannels:u,onClose:i,onNotificationChannelSelect:l,onNewSlackAccountAdded:s,renderMenu:e=>(0,U.jsx)(q().Z,{type:"default",automationTriggerActionMenuStore:o,headerTitle:(0,U.jsx)(h()._H,{id:"notificationRuleSettings.selectChannelView.title",defaultMessage:"Select Slack channel"}),sections:e,onClose:i})})}var Oe=()=>o(899548);const Ne=(0,h().vU)({workspaceSearchPlaceholder:{id:"notificationRuleSettings.selectWorkspaceView.searchInput.placeholder",defaultMessage:"Searchâ¦"}});function We(e){const{onWorkspaceSelect:t,renderMenu:o,workspaceFilter:a,onNewSlackAccountAdded:r}=e,l=(0,s().O7)(),{isMobile:u}=(0,s().Fy)(),d=(0,i().VK)((()=>{var e;return null===(e=V().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),m=(0,i().VK)((()=>(0,Pe().P9)(Ve().default.completeSlackAuthentications.state,a)),[a]),g=(0,i().VK)((()=>Ve().default.integrations.state.find((e=>e.id===je().nO))),[]),[y,f]=n.useState(""),x=(0,c().yK)((e=>({chevronRight:{width:12,height:"auto",color:e.lightIconColor}})),[]);if(!g)return null;const b=Object.entries((0,Pe().YJ)(m,y)).map(((e,o)=>{let[n,i]=e;return{key:n,items:i.map((e=>{let{workspaceName:o,externalAuthentication:n}=e;return{key:n.id,action:()=>{t(n)},render:e=>(0,U.jsx)(v().Z,{...e,title:o??(0,U.jsx)(h()._H,{id:"notificationRuleSettings.selectWorkspace.untitledWorkspace",defaultMessage:"Slack workspace"}),right:(0,p().o)(x.chevronRight)})}})),render:e=>(0,U.jsx)(k().Z,{...e,title:n,topBorder:0!==o})}}));return b.unshift({key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,U.jsx)("div",{children:(0,U.jsx)(O().ZP,{...e,inputLeft:(0,U.jsx)(O().f_,{icon:Oe().R}),showClearButton:!0,placeholder:w().Z.formatMessage(Ne.workspaceSearchPlaceholder),focus:!u||void 0,value:y,onChange:e=>{f(e.target.value)}})})}],render:e=>(0,U.jsx)(k().Z,{...e})}),b.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!d)return;const e=await Ae().hM({environment:l,integration:g,spaceId:d,from:"collection_view_settings"});we().x.isFail(e)||e.value.externalAuthentication&&(t(e.value.externalAuthentication),null==r||r())},render:e=>(0,U.jsx)(v().Z,{...e,icon:(0,U.jsx)("img",{src:Me().Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,U.jsx)(h()._H,{id:"notificationRuleSettings.selectWorkspaceView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,U.jsx)(k().Z,{...e,topBorder:!0})}),(0,U.jsx)(U.Fragment,{children:o(b)})}function Ue(e){const{automationActionMenuStore:t,onClose:o}=e,i=n.useCallback((o=>{t.pushSettingsItem({actionStore:e.actionStore,type:"selectChannelNew",currentExternalAuthentication:o})}),[t,e.actionStore]);return(0,U.jsx)(We,{onWorkspaceSelect:i,renderMenu:e=>(0,U.jsx)(q().Z,{type:"default",automationTriggerActionMenuStore:t,headerTitle:(0,U.jsx)(h()._H,{id:"notificationRuleSettings.selectSlackWorkspace.title",defaultMessage:"Select Slack workspace"}),sections:e,onClose:o})})}const Ge=(0,n.createContext)({menuStore:void 0});function ze(e){const{initialState:t,insertionPoint:o,onClose:l}=e,s=(0,i().VK)((()=>{const e=new(r().H0);return e.setState({insertionPoint:o,stack:[t]}),e}),[t,o]),c=(0,i().VK)((()=>s.getCurrentTab()),[s]),u=(0,n.useCallback)((()=>null==l?void 0:l()),[l]);if(!c)return null;let d;if("connectToSlackDefault"===c.type)d=(0,U.jsx)(Re,{actionStore:c.actionStore,automationActionMenuStore:s,onClose:u,type:"connectToSlackDefault"});else if("connectToSlackReconnect"===c.type)d=(0,U.jsx)(Re,{actionStore:c.actionStore,automationActionMenuStore:s,externalBotId:c.externalBotId,notificationActionConfigStore:c.notificationActionConfigStore,onClose:u,type:"connectToSlackReconnect"});else if("selectWorkspace"===c.type)d=(0,U.jsx)(Ge.Provider,{value:{menuStore:s},children:(0,U.jsx)(Ue,{actionStore:c.actionStore,automationActionMenuStore:s,onClose:u})});else if("selectChannelNew"===c.type)d=(0,U.jsx)(Le,{actionStore:c.actionStore,automationActionMenuStore:s,currentExternalAuthentication:c.currentExternalAuthentication,onClose:u,type:"selectChannelNew"});else if("selectChannelUpdate"===c.type)d=(0,U.jsx)(Le,{actionStore:c.actionStore,automationActionMenuStore:s,currentExternalAuthentication:c.currentExternalAuthentication,currentNotificationChannel:c.currentNotificationChannel,onClose:u,type:"selectChannelUpdate"});else if("eventActions"===c.type)d=(0,U.jsx)(ae,{automationActionMenuStore:s,hasUpdateThisPagePropertyActions:c.hasUpdateThisPagePropertyActions,hasSearch:c.hasSearch,onClose:u});else if("eventActionProperty"===c.type){const{propertyId:e,actionId:t}=c;d=(0,U.jsx)(ke,{actionId:t,automationActionMenuStore:s,onClose:u,propertyId:e})}else"updateThisPageProperties"===c.type?d=(0,U.jsx)(X,{automationActionMenuStore:s,onClose:u}):(0,a().t1)(c);return(0,U.jsx)(Ge.Provider,{value:{menuStore:s},children:d})}Ge.displayName="AutomationActionMenuContext"},592479:(e,t,o)=>{o.d(t,{eQ:()=>I,pZ:()=>V});o(267602),o(470928);var n=o(667294),i=()=>o(219727),a=()=>o(142735),r=()=>o(846550),l=()=>o(440692),s=()=>o(535014),c=()=>o(788860),u=()=>o(513670),d=()=>o(696459),p=()=>o(707513),m=()=>o(448419),g=()=>o(953349),h=()=>o(718959),y=()=>o(122479),f=()=>o(529048),v=()=>o(138912),x=()=>o(385010),b=()=>o(637118),S=()=>o(960597),C=()=>o(195245),k=()=>o(676279),M=()=>o(430311),j=()=>o(590259),T=()=>o(790819),w=()=>o(896441),A=o(785893);function I(e){const{actionStore:t}=e,{automationStore:o}=(0,b().YC)(),{disabled:i,suppressActionErrors:r}=(0,C().i)(),s=(0,l().getActionRegistryItem)("slack_notification"),u=Boolean(i),d=H(o)?(0,A.jsx)(S().TooltipWithSubtitle,{content:(0,A.jsx)(c()._H,{...S().automationErrorMessages.slackNotificationAuthenticationError})}):null,p=(0,a().qz)(void 0,f().Z),m=(0,n.useCallback)((()=>p.reset()),[p]),g=(0,n.useMemo)((()=>(0,A.jsx)(M().e,{actionStore:t,closeMenu:m})),[t,m]),h=(0,n.useMemo)((()=>!r.includes(t.id)),[r,t]),{errorMessage:y}=(0,S().useErrorComponentForAction)({actionId:t.id,errorKey:"external_bot_id",shouldShow:h}),{errorMessage:v}=(0,S().useErrorComponentForAction)({actionId:t.id,errorKey:"target",shouldShow:h});return(0,A.jsx)(w().Ao,{actionMenu:g,buttonPopupStore:p,disabled:u,actionId:t.id,canCollapse:!1,children:(0,A.jsx)(w().vu,{actionId:t.id,actionRegistryItem:s,disabled:u,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,A.jsx)(_,{actionStore:t,automationStore:o,disabled:u,errorMessage:d??y??v})})})}function _(e){const{actionStore:t,automationStore:o,disabled:n,errorMessage:i}=e;return(0,A.jsx)(c()._H,{defaultMessage:"Notify{slackTargetPicker}",id:"automations.slackNotificationAction.action.title",values:{slackTargetPicker:(0,A.jsx)(P,{actionStore:t,automationStore:o,disabled:n,errorMessage:i})}})}function P(e){const{actionStore:t,automationStore:o,disabled:i,errorMessage:r}=e,l=(0,a().VK)((()=>{const e=t.getConfigStore(),o=e.getKeyStore("external_bot_id").getValue();if((0,u().xb)(o))return!1;const n=e.getKeyStore("target").getValue();return!(0,u().xb)(null==n?void 0:n.id)}),[t]),s=(0,a().qz)(void 0,f().Z),p=(0,n.useCallback)((()=>s.reset()),[s]),g=function(e){const{actionStore:t,automationStore:o}=e,[n,i]=(0,a().VK)((()=>{const e=t.getConfigStore();return[e.getKeyStore("target").getValue(),e.getKeyStore("external_bot_id").getValue()]}),[t]),r=H(o),l=E(t),s=(0,a().VK)((()=>v().default.completeSlackAuthentications.state.length??0),[]);if((0,d().$K)(n)&&(0,d().$K)(i))return r?{actionStore:t,externalBotId:i,notificationActionConfigStore:t,type:"connectToSlackReconnect"}:(0,d().$K)(l)?{actionStore:t,currentExternalAuthentication:l,currentNotificationChannel:n,type:"selectChannelUpdate"}:{actionStore:t,type:"connectToSlackDefault"};return 0===s?{actionStore:t,type:"connectToSlackDefault"}:s>1?{actionStore:t,type:"selectWorkspace"}:{actionStore:t,type:"selectChannelNew"}}({actionStore:t,automationStore:o}),h=(0,k().d)();return(0,A.jsx)(m().ZP,{alignmentToOrigin:m().vR.End,buttonPopupStore:s,disabled:i,originGap:0,placementToOrigin:m().pO.Bottom,popupType:h,renderOrigin:e=>(0,A.jsx)(T().S,{...e,disabled:i,isCompact:!0,isError:Boolean(r),hasActionRequired:!l,dropdownButtonType:"dropdown",children:l?(0,A.jsx)(V,{actionStore:t}):(0,A.jsx)(c()._H,{id:"slackNotificationAction.targetPicker.noTarget",defaultMessage:"Select Slack channel"})}),render:()=>(0,A.jsx)(j().Z,{initialState:g,onClose:p})})}function V(e){const{actionStore:t}=e,o=(0,i().O7)(),r=(0,a().VK)((()=>{const e=(0,h().RM)();return!(0,d().$K)(e)||Boolean((0,y().eV)(o,e))}),[o]),l=function(e){const t=(0,i().O7)(),o=(0,a().VK)((()=>{var t;return null===(t=e.getConfig())||void 0===t||null===(t=t.target)||void 0===t?void 0:t.id}),[e]),r=E(e);return n.useEffect((()=>{r&&(0,g().uV)({environment:t,spaceId:r.space_id,externalAuthConfig:{type:"external",botId:r.id}})}),[t,r]),(0,a().VK)((()=>{if(r&&o){const e=x().l.getStateForBot({type:"external",botId:r.id}).channels[o];if(e)return e}}),[o,r])}(t);return E(t)?r||!(0,d().$K)(l)?(0,A.jsx)(K,{}):"me"===l.type?(0,A.jsx)(F,{channelName:l.name}):"private"===l.type?(0,A.jsx)(R,{channelName:l.name}):"public"===l.type?(0,A.jsx)(B,{channelName:l.name}):void(0,d().t1)(l.type):(0,A.jsx)(Z,{})}function B(e){return(0,A.jsx)("span",{style:p().Yu,children:`#${e.channelName}`})}function R(e){const{channelName:t}=e,o=D();return(0,A.jsxs)("div",{style:o.container,children:[(0,s().b)(o.lockIcon),(0,A.jsx)("span",{style:p().Yu,children:t})]})}function F(e){const{channelName:t}=e;return(0,A.jsx)("span",{style:p().Yu,children:`@${t}`})}function K(){const e=D();return(0,A.jsxs)("div",{style:e.container,children:[(0,s().b)(e.lockIcon),(0,A.jsx)("span",{style:p().Yu,children:(0,A.jsx)(c()._H,{defaultMessage:"Hidden channel",id:"slackNotificationAction.slackTargetChannel.hiddenName"})})]})}function Z(){const e=D();return(0,A.jsx)("div",{style:e.container,children:(0,A.jsx)("span",{style:p().Yu,children:(0,A.jsx)(c()._H,{defaultMessage:"Invalid channel",id:"slackNotificationAction.slackTargetChannel.invalidChannel"})})})}function E(e){return(0,a().VK)((()=>{const t=e.getConfigStore().getKeyStore("external_bot_id").getValue();if(t)return v().default.completeSlackAuthentications.state.find((e=>t===e.id))}),[e])}function H(e){return(0,a().VK)((()=>"disabled_auth"===e.getStatus()),[e])}function D(){const{isMobile:e}=(0,i().Fy)(),t=e?p().JB.UISmall.mobile:p().JB.UISmall.desktop;return(0,r().yK)((()=>({container:{alignItems:"baseline",display:"inline-flex",gap:2,minWidth:50,width:"100%"},lockIcon:{alignSelf:"center",height:"auto",width:t}})),[t])}},502550:(e,t,o)=>{o.d(t,{B:()=>Me,r:()=>je});var n=o(667294),i=()=>o(142735),a=()=>o(177634),r=()=>o(637118),l=(o(821057),o(267602),o(653476),()=>o(219727)),s=()=>o(846550),c=()=>o(440692),u=()=>o(752348),d=()=>o(455947),p=()=>o(892981),m=()=>o(38883),g=()=>o(788860),h=()=>o(696459),y=()=>o(707513),f=()=>o(636340),v=()=>o(269299),x=()=>o(360240),b=()=>o(448419),S=()=>o(384241),C=()=>o(772265),k=()=>o(594546),M=()=>o(867601),j=()=>o(466970),T=()=>o(529048),w=()=>o(826955),A=()=>o(960597),I=()=>o(309841),_=()=>o(195245),P=()=>o(903098),V=()=>o(676279),B=()=>o(430311),R=()=>o(883293),F=()=>o(790819),K=()=>o(311419),Z=()=>o(896441),E=()=>o(446955),H=()=>o(347558),D=()=>o(384547),L=()=>o(198829),O=()=>o(388284),N=()=>o(125659),W=()=>o(918745),U=o(785893);function G(e){const{filter:t,onChange:o,onClose:a,collectionStore:r}=e,l=(0,N().DK)(),s=(0,i().VK)((()=>r.getSchema()),[r]),c=(0,W().F)({minWidth:300,tabletBehavior:"actionSheet"}),u=(0,n.useCallback)(((e,t)=>o(t)),[o]),p=(0,n.useCallback)((()=>{o(void 0),a()}),[o,a]);return(0,U.jsxs)(L().Z,{...c,children:[(0,U.jsx)(D().D,{children:(0,U.jsx)(H().Pq,{collectionViewId:"Automation.FilterMenu",collectionContextStore:l,collectionViewType:"table",combinatorFilter:t||d().hh,index:0,level:0,onChange:u,parentStore:r,schema:s})}),(0,U.jsx)(O().Z,{topBorder:!0,children:(0,U.jsx)(E().Z,{title:(0,U.jsx)(g()._H,{defaultMessage:"Delete filter",id:"automations.AutomationCombinatorFilterPopup.deleteFilter.label"}),onClick:p})})]})}const z=(0,g().vU)({multipleTargetsFilter:{defaultMessage:"<span>Edit </span>{filterPicker}",id:"automations.UpdatePagesAction.multipleTargetsFilter"},multipleTargetsPicker:{defaultMessage:"<span>in </span>{targetPicker}",id:"automations.UpdatePagesAction.multipleTargetsPicker"},singleTarget:{defaultMessage:"<span>Edit </span>{targetPicker}",id:"automations.UpdatePagesAction.singleTarget"}});function $(e){const{actionStore:t}=e,o=(0,l().O7)(),{automationStore:a,typecheckResult:s}=(0,r().YC)(),{disabled:d,suppressActionErrors:m}=(0,_().i)(),y=(0,j().E)("automation_updated_error_states"),x=(0,i().VK)((()=>t.getTargetStore()),[t]),b=(0,i().VK)((()=>Q(t,(0,u().getAllContextValues)(s))),[t,s]),S=(0,i().VK)((()=>{var e;const o=t.getCollectionTargetStore(),n=null==o||null===(e=o.getKeyStore("filter"))||void 0===e?void 0:e.getValue();if(n)return(0,p().Ih)(n,(null==b?void 0:b.getSchema())||{})}),[t,b]),C=(0,i().VK)((()=>{const e=t.getVariableTargetStore();if(e)return e.getValue();const o=t.getCollectionTargetStore();if(o){const e=o.getKeyStore("collection").getValue();if(e)return{collection:e,type:"collection"}}}),[t]),k=(0,i().VK)((()=>{if(!C||"variable"!==C.type)return!1;const e=(0,u().getContextValueForActionById)(s,t.id,C.id),o=null==e?void 0:e.type;return!!o&&("block"===o.type||"array"===o.type&&"block"===o.of.type)}),[t.id,C,s]),w=(0,i().qz)(void 0,T().Z),P=(0,n.useCallback)((()=>w.reset()),[w]),V=(0,n.useMemo)((()=>(0,U.jsx)(B().e,{actionStore:t,closeMenu:P})),[t,P]),F=(0,n.useMemo)((()=>!m.includes(t.id)),[m,t]),K=(0,i().VK)((()=>{if(b&&y)return F&&!(0,M().JO)({actionStore:t,collectionStore:b,typecheckResult:s})?(0,U.jsx)(g()._H,{...A().automationErrorMessages.actionIncompleteErrorMessage}):void 0}),[t,b,y,F,s]),{errorMessage:E,errorIcon:H}=(0,A().useErrorComponentForAction)({actionId:t.id,shouldShow:F,errorKeys:["target","collection","block"]}),{errorMessage:D,errorIcon:L}=(0,A().useErrorComponentForAction)({actionId:t.id,errorKey:"filter",shouldShow:F}),O=(0,i().VK)((()=>(0,h().$K)(t.getConfigStore().getKeyStore("target").getValue())),[t]),N=(0,n.useCallback)((e=>{v().createAndCommit({userAction:"UpdatePagesAction.filterChange",environment:o,canUndo:!0,perform:t=>{f().sW({data:{filter:e},store:x,transaction:t})}}),(0,I().yE)(o,{automationStore:a,automationActionStore:t})}),[t,a,o,x]),W=(0,n.useCallback)((e=>{let n;if("collection"===e.type)n="UpdatePageAction.updateCollection";else if("variable"===e.type)n="UpdatePageAction.updateVariable";else{if("page"===e.type||"property"===e.type||"formula"===e.type||"url"===e.type)throw new Error("Not implemented yet.");(0,h().t1)(e)}v().createAndCommit({userAction:n,environment:o,canUndo:!0,perform:o=>{f().sW({data:{properties:null,target:e,values:null},store:t.getConfigStore(),transaction:o})}}),(0,I().yE)(o,{automationStore:a,automationActionStore:t})}),[o,a,t]),G=Boolean(d),z=(0,c().getActionRegistryItem)("update_pages");return(0,U.jsxs)(Z().Ao,{actionMenu:V,buttonPopupStore:w,disabled:G,actionId:t.id,canCollapse:O,children:[(0,U.jsx)(Z().vu,{actionId:t.id,actionRegistryItem:z,disabled:G,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"grid",gridTemplateColumns:"auto 1fr"}},errorMessage:y?E||D||K:void 0,children:k||!b?(0,U.jsx)(Y,{actionStore:t,disabled:G,errorMessage:E,errorIcon:H,onTargetChange:W,value:C}):(0,U.jsx)(q,{actionStore:t,collectionStore:b,disabled:G,errorMessage:E,errorIcon:H,filterErrorIcon:L,filterErrorMessage:D,filter:S,onFilterChange:N,onTargetChange:W,value:C})}),b&&(0,U.jsx)(Z().R7,{disabled:G,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,U.jsx)(R().QF,{actionStore:t,collectionStore:b,disabled:G,showSetPropertyActions:!0})})]})}function Y(e){const{actionStore:t,disabled:o,errorMessage:n,onTargetChange:i,value:a,errorIcon:r}=e,l=(0,j().E)("automation_updated_error_states"),c=(0,s().yK)((()=>({b:{fontWeight:y().Ue.medium},picker:{display:"inline-flex",minWidth:50},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]);return(0,U.jsx)("div",{style:c.title,children:(0,U.jsx)(g()._H,{...z.singleTarget,values:{b:e=>(0,U.jsx)("b",{style:c.b,children:e}),targetPicker:(0,U.jsx)(X,{actionStore:t,disabled:o,errorMessage:n,errorIcon:l?r:void 0,onChange:i,value:a}),span:e=>(0,U.jsx)("span",{style:c.span,children:e})}})})}function q(e){const{actionStore:t,collectionStore:o,disabled:n,errorMessage:i,errorIcon:a,filterErrorMessage:r,filterErrorIcon:l,filter:c,onFilterChange:u,onTargetChange:d,value:p}=e,m=(0,s().yK)((()=>({b:{fontWeight:y().Ue.medium},picker:{display:"inline-flex",minWidth:50},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]);return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)("div",{style:m.title,children:[(0,U.jsx)(g()._H,{...z.multipleTargetsFilter,values:{filterPicker:(0,U.jsx)(J,{collectionStore:o,disabled:n,errorMessage:r,errorIcon:l,filter:c,onChange:u}),span:e=>(0,U.jsx)("span",{style:m.span,children:e})}}),"Â "]}),(0,U.jsx)("div",{style:m.title,children:(0,U.jsx)(g()._H,{...z.multipleTargetsPicker,values:{targetPicker:(0,U.jsx)(X,{actionStore:t,disabled:n,errorMessage:i,errorIcon:a,onChange:d,value:p}),span:e=>(0,U.jsx)("span",{style:m.span,children:e})}})})]})}function J(e){var t;const{collectionStore:o,disabled:a,errorMessage:r,filter:l,onChange:s,errorIcon:c}=e,u=(0,i().qz)(void 0,T().Z),p=(0,V().d)({tabletBehavior:"slideUp"}),m=(0,n.useCallback)((()=>u.reset()),[u]),h=(0,i().VK)((()=>{const e=o.getModel(),t=null==e?void 0:e.getDatabaseType();return(0,x().Q_)(t)}),[o]),y=(null==l||null===(t=l.filters)||void 0===t?void 0:t.length)||0;return(0,U.jsx)(b().ZP,{alignmentToOrigin:b().vR.Center,disabled:a,originGap:0,placementToOrigin:b().pO.Bottom,popupType:p,renderOrigin:e=>(0,U.jsx)(F().S,{...e,disabled:a,isCompact:!0,errorIcon:c,onClick:t=>{e.onClick(t),0===y&&s(d().TI)},dropdownButtonType:"dropdown",isError:Boolean(r),tooltipMessage:r,children:y>0?(0,U.jsx)(g()._H,{defaultMessage:"{itemType} that match {ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",id:"automations.UpdatePagesAction.FilterPicker.withRules",values:{itemType:h,ruleCount:y}}):(0,U.jsx)(g()._H,{defaultMessage:"all {itemType}",id:"automations.UpdatePagesAction.FilterPicker.noRules",values:{itemType:h}})}),render:()=>(0,U.jsx)(G,{collectionStore:o,disabled:a,filter:l,onChange:s,onClose:m})})}function X(e){const{actionStore:t,disabled:o,errorMessage:a,onChange:s,value:c,errorIcon:d}=e,p=(0,l().O7)(),{automationStore:y,typecheckResult:f}=(0,r().YC)(),v=(0,P().z)({actionId:t.id}),x=(0,i().VK)((()=>{if("collection"===(null==c?void 0:c.type))return w().NW.createChildStore(t,c.collection)}),[t,c]),M=(0,i().VK)((()=>{if(f&&c&&"variable"===c.type)return(0,u().getContextValueForActionById)(f,t.id,c.id)}),[f,c,t.id]),A=(0,i().qz)(void 0,T().Z),_=(0,V().d)(),B=(0,n.useCallback)((()=>A.reset()),[A]),R=(0,n.useCallback)((e=>{s(e),B(),(0,I().GV)(((o,n,i)=>{const a=(0,I().TI)({automationActionStore:t,formulasModule:o,formulaAnalyticsModule:n,simpleFormulasModule:i});(0,h().$K)(a)&&(0,k().j)({environment:p,event:{eventName:"automation_target_pick",eventProperties:{automation_action:a,automation_id:t.getParentId(),target_type:e.type}}})}))}),[s,B,t,p]),Z=(0,j().E)("automation_updated_error_states");return(0,U.jsx)(b().ZP,{buttonPopupStore:A,popupType:_,alignmentToOrigin:b().vR.Center,placementToOrigin:b().pO.Bottom,originGap:0,disabled:o,renderOrigin:e=>(0,U.jsx)(F().S,{...e,disabled:o,isCompact:!0,isError:Boolean(a),tooltipMessage:!Z&&a,errorIcon:d,hasActionRequired:!Boolean(c||M),dropdownButtonType:"dropdown",children:(0,h().$K)(x)?(0,U.jsx)(S().Z,{store:x,style:{paddingBlock:1}}):M?(0,U.jsx)(C().F,{format:m().lo.Medium,isSingle:!0,value:M,style:{background:"transparent",color:"unset",margin:"-1.5px 0",padding:0}}):(0,U.jsx)(g()._H,{id:"automations.UpdatePagesAction.pagesDropdown.label",defaultMessage:"Select database"})}),render:e=>(0,U.jsx)(K().L,{formulaTypecheckContextValues:v,onChange:R,onClose:B,parentRecordStore:y,selectedTarget:c,skipPages:!0})})}function Q(e,t){const o=e.getTargetStore().getValue();if(o){if("collection"===o.type)return w().NW.createChildStore(e,o.collection);if("variable"===o.type){if(!t)return;const n=(0,a().vx)(t,o.id);if(n)return(0,M().wB)(n,e)}else{if("page"===o.type)return;(0,h().t1)(o)}}}var ee=()=>o(912203),te=()=>o(473304),oe=()=>o(226413),ne=()=>o(590259),ie=()=>o(374784),ae=()=>o(49952),re=()=>o(152557);function le(e){const{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:i,propertySchema:a}=e,r=(0,s().yK)((e=>({icon:{fill:e.text.uiRedPrimary},propertyType:{color:e.accentColors.red[700]}})),[]),l=function(e){const{propertySchema:t,styles:o}=e,n=t.name;return(0,U.jsx)(g()._H,{defaultMessage:"{propertyName} is a cross-workspace relation",id:"updateThisPageCrossSpaceRelationAction.crossSpaceRelation.title",values:{propertyName:(0,U.jsx)("span",{style:o.propertyType,children:n})}})}({propertySchema:a,styles:r}),c=function(e){const{propertySchema:t}=e,o=t.name;return(0,U.jsx)(g()._H,{defaultMessage:"{propertyName} is a cross-workspace relation. Cross-workspace features are restricted in automations and will not work.",id:"updateThisPageCrossSpaceRelationAction.crossSpaceRelation.text",values:{propertyName:o}})}({propertySchema:a});return(0,U.jsx)(re().gq,{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:i,propertyType:a.type,styles:r,tooltip:c,children:l})}function se(e){const{actionId:t,renderOrigin:o}=e,a=(0,V().d)(),r=(0,i().qz)(void 0,T().Z),l=(0,n.useCallback)((()=>r.reset()),[r]);return(0,U.jsx)(b().ZP,{buttonPopupStore:r,popupType:a,render:()=>(0,U.jsx)(ae().qO,{actionId:t,closeMenu:l}),renderOrigin:o})}var ce=()=>o(839886),ue=()=>o(957250),de=()=>o(859127),pe=(o(241792),()=>o(923398)),me=()=>o(116291),ge=()=>o(239869);function he(e){const{action:t,actionMenu:o,buttonPopupStore:i,disabled:a,onClick:l,propertySchema:s,value:c}=e,{automationStore:d,typecheckResult:p}=(0,r().YC)(),m=(0,n.useMemo)((()=>(0,u().getAllContextValues)(p)),[p]),{title:g,tooltipTitle:h,styles:y}=(0,me().TY)({getRecordModel:d.getRecordModel,contextValues:m,messageType:"action",operator:t,propertySchema:s,value:c}),f=(0,n.useCallback)((e=>(0,U.jsx)(Z().YG,{...e,actionMenu:o,buttonPopupStore:i,disabled:a,icon:pe().O,onClick:l,children:(0,U.jsx)("div",{style:y.content,children:g})})),[o,i,a,l,y.content,g]);return(0,U.jsx)(ge().y,{renderOrigin:f,title:h})}var ye=()=>o(545914),fe=()=>o(317632);function ve(e){const{action:t,actionMenu:o,automationActionStore:i,buttonPopupStore:a,collectionStore:r,disabled:l,onClick:s,propertySchema:c,value:u}=e,d=(0,P().z)({actionId:i.id}),{tooltipTitle:p,title:m}=(0,fe().lr)({automationContextValues:d,collectionStore:r,messageType:"action",operator:t,propertySchema:c,value:u}),g=(0,n.useCallback)((e=>(0,U.jsx)(Z().YG,{...e,actionMenu:o,buttonPopupStore:a,disabled:l,icon:ye().v,onClick:s,children:m})),[o,a,l,s,m]);return(0,U.jsx)(ge().y,{renderOrigin:g,title:p})}var xe=()=>o(282895),be=()=>o(395137),Se=()=>o(96754);function Ce(e){var t;const{actionStore:o}=e,{disabled:a}=(0,_().i)(),[r,l]=(0,i().VK)((()=>[o.id,o.getConfig()]),[o]),s=(0,P().z)({actionId:r}),c=(0,i().VK)((()=>Q(o,s)),[o,s]),u=(0,i().VK)((()=>null==c?void 0:c.getSchema()),[c]),d=(0,i().VK)((()=>null==c?void 0:c.getDeletedSchema()),[c]),p=(0,i().qz)(void 0,T().Z),m=(0,n.useCallback)((()=>p.reset()),[p]),g=(0,n.useMemo)((()=>(0,U.jsx)(B().e,{actionStore:o,closeMenu:m})),[o,m]),h=(0,j().E)("collections_xws"),y=((null==l?void 0:l.properties)??[])[0],f=null==u?void 0:u[y],v=null==d?void 0:d[y],x=null==l||null===(t=l.values)||void 0===t?void 0:t[y],b=Boolean(a),S={automationActionStore:o,actionMenu:g,buttonPopupStore:p,disabled:b,value:null==x?void 0:x.value};return!f&&v?(0,U.jsx)(ue().RN,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(ue().rV,{...e,...S,propertySchema:v})}):f||v?f&&c?(0,ee().SF)(f)?"person"===f.type?(0,U.jsx)(ke,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(he,{...e,...S,propertySchema:f,action:(0,te().o9)(x)})}):"status"===f.type?(0,U.jsx)(ke,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(be().yr,{...e,...S,propertySchema:f})}):"select"===f.type?(0,U.jsx)(ke,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(xe().D9,{...e,...S,propertySchema:f})}):"multi_select"===f.type?(0,U.jsx)(ke,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(de().m,{...e,...S,propertySchema:f,action:(0,te().o9)(x)})}):"date"===f.type?(0,U.jsx)(ke,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(ce().e,{...e,...S,propertySchema:f,valueContext:{collectionStore:c,property:y,type:"collection"}})}):"relation"===f.type&&h&&(0,oe().Qh)(c.pointer.spaceId,f)?(0,U.jsx)(se,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(le,{...e,...S,propertySchema:f})}):"relation"===f.type?(0,U.jsx)(ke,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(ve,{...e,...S,collectionStore:c,propertySchema:f,action:(0,te().o9)(x)})}):"checkbox"===f.type?(0,U.jsx)(ke,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(ie().Q2,{...e,...S,propertySchema:f})}):"title"===f.type?(0,U.jsx)(ke,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(Se().QQ,{...e,...S,propertySchema:f})}):"text"===f.type?(0,U.jsx)(ke,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(Se().Vk,{...e,...S,propertySchema:f})}):"email"===f.type?(0,U.jsx)(ke,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(Se().Kh,{...e,...S,propertySchema:f})}):"url"===f.type?(0,U.jsx)(ke,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(Se().GJ,{...e,...S,propertySchema:f})}):"number"===f.type?(0,U.jsx)(ke,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(Se().go,{...e,...S,propertySchema:f})}):"phone_number"===f.type?(0,U.jsx)(ke,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(Se().gi,{...e,...S,propertySchema:f})}):null:(0,U.jsx)(re().l6,{actionId:o.id,propertyId:y,renderOrigin:e=>(0,U.jsx)(re().OZ,{...e,...S,propertySchema:f})}):null:(0,U.jsx)(ue().RN,{actionId:o.id,renderOrigin:e=>(0,U.jsx)(ue().PO,{...e,...S})})}function ke(e){const{actionId:t,propertyId:o,renderOrigin:a}=e,r=(0,V().d)(),l=(0,i().qz)(void 0,T().Z),s=(0,n.useCallback)((()=>l.reset()),[l]),c=(0,n.useMemo)((()=>({actionId:t,propertyId:o,type:"eventActionProperty"})),[t,o]);return(0,U.jsx)(b().ZP,{buttonPopupStore:l,popupType:r,render:()=>(0,U.jsx)(ne().Z,{initialState:c,onClose:s}),renderOrigin:a})}function Me(e){const{actionStore:t}=e,{contextType:o}=(0,r().DZ)();return(0,i().VK)((()=>je(o,t)),[t,o])?(0,U.jsx)(Ce,{...e}):(0,U.jsx)($,{...e})}function je(e,t){var o;if(!t.isType("update_pages"))return!1;const n=t.getConfig(),i="variable"===(null==n||null===(o=n.target)||void 0===o?void 0:o.type)?(0,a().MY)(n.target.id):void 0;return"event"===e&&i&&"global"===i.source&&"button_page"===i.global}},374784:(e,t,o)=>{o.d(t,{G7:()=>v,Q2:()=>f});var n=o(667294),i=()=>o(846550),a=()=>o(907874),r=()=>o(813180),l=()=>o(702491),s=()=>o(544672),c=()=>o(788860),u=()=>o(707513),d=()=>o(972350),p=()=>o(361726),m=()=>o(239869),g=()=>o(896441),h=()=>o(415764),y=o(785893);function f(e){const{actionMenu:t,buttonPopupStore:o,disabled:f,onClick:x,propertySchema:b,value:S}=e,C=(0,i().yK)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...u().Yu,fontWeight:u().Ue.medium}})),[]),k=function(e){const{propertySchema:t,styles:o,value:n}=e,i=(0,y.jsx)("span",{style:o.propertyName,children:t.name});let s;const u="formula"===(null==n?void 0:n.type);if(u)s=(0,y.jsx)(h().b,{returnType:{type:"checkbox"}});else{const e=(0,a().fromSimpleFormulaArrayValue)(null==n?void 0:n.value)[0],t=!0===e?(0,l().V)({width:12}):(0,r().z)({width:10});s=(0,y.jsx)(d().o,{icon:t,shouldTruncateChildren:!0,children:!0===e?(0,y.jsx)(c()._H,{...p().Bo.actionCheckboxPropertyChecked}):(0,y.jsx)(c()._H,{...p().Bo.actionCheckboxPropertyUnchecked})})}return(0,y.jsx)(c()._H,{...p().hW({propertyName:i,propertyValue:s})})}({propertySchema:b,styles:C,value:S}),M=v({propertySchema:b,value:S}),j=(0,n.useCallback)((e=>(0,y.jsx)(g().YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:f,icon:s().r,onClick:x,children:(0,y.jsx)("div",{style:C.content,children:k})})),[t,o,f,x,C.content,k]);return(0,y.jsx)(m().y,{renderOrigin:j,title:M})}function v(e){const{propertySchema:t,value:o}=e;let n;if("formula"===(null==o?void 0:o.type))n=(0,y.jsx)(h().K,{});else{n=!0===(0,a().fromSimpleFormulaArrayValue)(null==o?void 0:o.value)[0]?(0,y.jsx)(c()._H,{...p().Bo.actionCheckboxPropertyChecked}):(0,y.jsx)(c()._H,{...p().Bo.actionCheckboxPropertyUnchecked})}return(0,y.jsx)(c()._H,{...p().hW({propertyName:t.name,propertyValue:n})})}},839886:(e,t,o)=>{o.d(t,{e:()=>T,k:()=>w});var n=o(667294),i=()=>o(142735),a=()=>o(846550),r=()=>o(38883),l=()=>o(646574),s=()=>o(177634),c=()=>o(907874),u=()=>o(998411),d=()=>o(587080),p=()=>o(955620),m=()=>o(788860),g=()=>o(696459),h=()=>o(707513),y=()=>o(772265),f=()=>o(214206),v=()=>o(78014),x=()=>o(361726),b=()=>o(903098),S=()=>o(239869),C=()=>o(896441),k=()=>o(887766),M=()=>o(415764),j=o(785893);function T(e){const{actionMenu:t,automationActionStore:o,buttonPopupStore:T,disabled:I,onClick:_,propertySchema:P,value:V,valueContext:B}=e,R=(0,m().YB)(),F=(0,a().yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...h().Yu,fontWeight:h().Ue.medium}})),[]),K=(0,b().z)({actionId:o.id}),Z=(0,i().VK)((()=>function(e){const{intl:t,propertySchema:o,styles:n,typecheckContextValues:i,value:a,valueContext:d}=e,b=(0,j.jsx)("span",{style:n.propertyName,children:o.name});if(void 0===(null==a?void 0:a.value))return(0,j.jsx)(m()._H,{...x().Gx({propertyName:b})});let S;const C="formula"===a.type,T=(0,c().fromSimpleFormulaArrayValue)(null==a?void 0:a.value)[0];if(C)S=(0,j.jsx)(M().b,{returnType:{type:"date"}});else if(!(0,g().$K)(T)||"string"==typeof T||"boolean"==typeof T||(0,p().IWo)(T)||(0,p().STW)(T))S=(0,j.jsx)(v().Z,{format:r().lo.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:(0,j.jsx)("span",{style:h().Yu,children:(0,j.jsx)(m()._H,{...x().Bo.unknownValue})})});else if((0,p().wjk)(T)){const e=(0,p().vmO)(T).id,t=(0,s().vx)(i,e);S=t?(0,j.jsx)(y().F,{value:t,format:r().lo.Medium,isSingle:!1,shouldShrink:!0}):(0,j.jsx)(v().Z,{format:r().lo.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:(0,j.jsx)("span",{style:h().Yu,children:(0,j.jsx)(m()._H,{...x().Bo.unknownValue})})})}else if((0,p().fpG)(T)){const e=(0,f()._7)(d),o=(0,p().zyO)(T);S=o?(0,l().OB)({value:o,date_format:e.dateFormat,time_format:e.timeFormat,userTimeZone:(0,u().r)(),allowRelativeDates:!0,intl:t,shortenDateAndRange:!0,displayInUserTimezone:!0,formatValuesFn:e=>{let{endDate:t,endTime:o,startDate:n}=e;return(0,g().$K)(o)?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(A,{value:n})," â ",(0,j.jsx)(A,{value:o})]}):(0,g().$K)(t)?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(A,{value:n})," â ",(0,j.jsx)(A,{value:t})]}):(0,j.jsx)(A,{value:n})}}):null}else{if((0,p().Lyt)(T))return(0,j.jsx)(k().Z,{token:T});(0,g().t1)(T)}return void 0===S?void 0:(0,j.jsx)(m()._H,{...x().zU({propertyName:b,propertyValue:S})})}({intl:R,propertySchema:P,styles:F,typecheckContextValues:K,value:V,valueContext:B})),[R,P,F,K,V,B]),E=(0,i().VK)((()=>w({intl:R,propertySchema:P,typecheckContextValues:K,value:V,valueContext:B})),[R,P,K,V,B]),H=(0,n.useCallback)((e=>(0,j.jsx)(C().YG,{...e,actionMenu:t,buttonPopupStore:T,disabled:I,icon:d().V,onClick:_,children:(0,j.jsx)("div",{style:F.content,children:Z})})),[t,T,I,_,F.content,Z]);return Z&&E?(0,j.jsx)(S().y,{disable:I,renderOrigin:H,title:E}):null}function w(e){const{intl:t,propertySchema:o,typecheckContextValues:n,value:i,valueContext:a}=e,r=o.name;if(void 0===(null==i?void 0:i.value))return(0,j.jsx)(m()._H,{...x().Gx({propertyName:r})});let d;const h="formula"===i.type,y=(0,c().fromSimpleFormulaArrayValue)(i.value)[0];if(h)d=(0,j.jsx)(M().K,{});else if(!(0,g().$K)(y)||"string"==typeof y||"boolean"==typeof y||(0,p().IWo)(y)||(0,p().STW)(y)||(0,p().Lyt)(y))d=(0,j.jsx)(m()._H,{...x().Bo.unknownValue});else if((0,p().wjk)(y)){const e=(0,p().vmO)(y).id,t=(0,s().vx)(n,e);d=t?(0,s().NP)(t):(0,j.jsx)(m()._H,{...x().Bo.unknownValue})}else if((0,p().fpG)(y)){const e=(0,f()._7)(a),o=(0,p().zyO)(y);d=o?(0,l().ZV)({value:o,date_format:e.dateFormat,time_format:e.timeFormat,userTimeZone:(0,u().r)(),allowRelativeDates:!0,intl:t,shortenDateAndRange:!0,displayInUserTimezone:!0}):null}else(0,g().t1)(y);return void 0===d?void 0:(0,j.jsx)(m()._H,{...x().zU({propertyName:r,propertyValue:d})})}function A(e){const{value:t}=e,o=(0,a().yK)((e=>({token:{marginBlockEnd:4},tokenBackgroundColor:{backgroundColor:e.accentColors.gray[75]}})),[]);return(0,j.jsx)(v().Z,{backgroundColor:o.tokenBackgroundColor.backgroundColor,format:r().lo.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,style:o.token,value:t})}},859127:(e,t,o)=>{o.d(t,{H:()=>m,m:()=>g});var n=o(667294),i=()=>o(142735),a=()=>o(846550),r=()=>o(788680),l=()=>o(788860),s=()=>o(707513),c=()=>o(239869),u=()=>o(896441),d=()=>o(282895),p=o(785893);const m=5;function g(e){const{action:t,actionMenu:o,buttonPopupStore:g,disabled:h,limit:y=m,onClick:f,propertySchema:v,value:x}=e,b=(0,l().YB)(),S=(0,a().yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...s().Yu,fontWeight:s().Ue.medium}})),[]),C=(0,i().VK)((()=>(0,d().F0)({intl:b,limit:y,propertySchema:v,styles:S,operator:t,value:x})),[b,y,v,S,t,x]),k=(0,i().VK)((()=>(0,d().I7)({intl:b,limit:y,propertySchema:v,operator:t,value:x})),[t,b,y,v,x]),M=(0,n.useCallback)((e=>(0,p.jsx)(u().YG,{...e,actionMenu:o,buttonPopupStore:g,disabled:h,icon:r().A,onClick:f,children:(0,p.jsx)("div",{style:S.content,children:C})})),[o,g,h,f,S.content,C]);return(0,p.jsx)(c().y,{renderOrigin:M,title:k})}},282895:(e,t,o)=>{o.d(t,{D9:()=>C,F0:()=>M,I7:()=>j});o(267602),o(653476),o(241792);var n=o(667294),i=()=>o(142735),a=()=>o(846550),r=()=>o(907874),l=()=>o(870960),s=()=>o(788860),c=()=>o(513670),u=()=>o(696459),d=()=>o(707513),p=()=>o(603885),m=()=>o(246471),g=()=>o(78014),h=()=>o(682108),y=()=>o(361726),f=()=>o(239869),v=()=>o(896441),x=()=>o(253783),b=()=>o(415764),S=o(785893);function C(e){const{actionMenu:t,buttonPopupStore:o,disabled:r,onClick:c,propertySchema:u,value:p}=e,m=(0,s().YB)(),g=(0,a().yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...d().Yu,fontWeight:d().Ue.medium}})),[]),h=(0,i().VK)((()=>M({intl:m,propertySchema:u,styles:g,value:p})),[m,u,g,p]),y=(0,i().VK)((()=>j({intl:m,propertySchema:u,value:p})),[m,u,p]),x=(0,n.useCallback)((e=>(0,S.jsx)(v().YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:r,icon:l().w,onClick:c,children:(0,S.jsx)("div",{style:g.content,children:h})})),[t,o,r,c,g.content,h]);return(0,S.jsx)(f().y,{renderOrigin:x,title:y})}function k(e,t){if(!e)return[];let o=(0,r().fromSimpleFormulaArrayValue)(e).filter((e=>(0,c().HD)(e)));return"select"===t.type&&(o=o.slice(0,1)),o}function M(e){const{intl:t,limit:o,operator:n,propertySchema:i,styles:a,tokenFormat:r,value:l}=e,c=(0,p().jV)(r),d=(0,S.jsx)("span",{style:a.propertyName,children:i.name});if("formula"===(null==l?void 0:l.type))return(0,S.jsx)(s()._H,{...y().rf({propertyName:d,propertyValue:(0,S.jsx)(b().b,{returnType:{type:"text"}})})});const h=y().oJ({limit:o,propertySchema:i,optionValues:k(null==l?void 0:l.value,i)}).map((e=>"deleted"===e.type?(0,S.jsx)(x().Z,{tokenFormat:c},`missing_option_value_${e.value}`):"option"===e.type?(0,S.jsx)(m().a,{color:e.value.color,format:c,isSingle:!0,showRemoveButton:!1,value:e.value.value},e.value.id):"truncation"===e.type?(0,S.jsx)(g().Z,{format:c,isRound:!0,isSingle:!0,showRemoveButton:!1,value:e.value},"More tokens"):void(0,u().t1)(e)));return"replace"===n||"append"===n||"remove"===n||"toggle"===n?(0,S.jsx)(s()._H,{...y().Lu({...y().DM({elements:h,intl:t}),operator:n,propertyName:d})}):0===h.length?(0,S.jsx)(s()._H,{...y().Gx({propertyName:d})}):(0,S.jsx)(s()._H,{...y().rf({propertyName:d,propertyValue:h[0]})})}function j(e){const{intl:t,limit:o,propertySchema:n,value:i,operator:a}=e,r=n.name;if("formula"===(null==i?void 0:i.type))return(0,S.jsx)(s()._H,{...y().rf({propertyName:r,propertyValue:(0,S.jsx)(b().K,{})})});const l=y().oJ({limit:o,propertySchema:n,optionValues:k(null==i?void 0:i.value,n)}).map((e=>"deleted"===e.type?y().ST(t):"option"===e.type?e.value.value:"truncation"===e.type?e.value:void(0,u().t1)(e)));return"replace"===a||"append"===a||"remove"===a||"toggle"===a?(0,S.jsx)(s()._H,{...y().Lu({propertyName:r,propertyValue:(0,h().H)(t.formatList(l,{style:"long",type:"conjunction"})),operator:a})}):0===l.length?(0,S.jsx)(s()._H,{...y().Gx({propertyName:r})}):(0,S.jsx)(s()._H,{...y().rf({propertyName:r,propertyValue:l[0]})})}},395137:(e,t,o)=>{o.d(t,{LQ:()=>f,yr:()=>y});var n=o(667294),i=()=>o(142735),a=()=>o(846550),r=()=>o(907874),l=()=>o(556392),s=()=>o(788860),c=()=>o(707513),u=()=>o(361726),d=()=>o(239869),p=()=>o(896441),m=()=>o(823718),g=()=>o(415764),h=o(785893);function y(e){const{actionMenu:t,buttonPopupStore:o,disabled:y,onClick:v,propertySchema:x,value:b}=e,S=(0,s().YB)(),C=(0,a().yK)((()=>({content:{alignItems:"baseline"},propertyName:{...c().Yu,fontWeight:c().Ue.medium}})),[]),k=(0,i().VK)((()=>function(e){const{intl:t,propertySchema:o,styles:n,value:i}=e;if(!i)return;const a=(0,h.jsx)("span",{style:n.propertyName,children:o.name});if("formula"===i.type)return(0,h.jsx)(s()._H,{...(0,u().Ig)({propertyName:a,propertyValue:(0,h.jsx)(g().b,{returnType:{type:"text"}})})});const l=(0,r().fromSimpleFormulaArrayValue)(null==i?void 0:i.value)[0];if("string"!=typeof l)return;const c=(0,m().L)({intl:t,groupValues:[],optionValues:[l],propertySchema:o});if(0===c.length)return;return(0,h.jsx)(s()._H,{...(0,u().Ig)({propertyName:a,propertyValue:c})})}({intl:S,propertySchema:x,styles:C,value:b})),[S,x,C,b]),M=(0,i().VK)((()=>f({intl:S,propertySchema:x,value:b})),[S,x,b]),j=(0,n.useCallback)((e=>(0,h.jsx)(p().YG,{...e,actionMenu:t,buttonPopupStore:o,disabled:y,icon:l().T,onClick:v,children:(0,h.jsx)("div",{style:C.content,children:k})})),[t,o,y,v,C.content,k]);return k&&M?(0,h.jsx)(d().y,{renderOrigin:j,title:M}):null}function f(e){const{intl:t,propertySchema:o,value:n}=e;if(!n)return;const i=o.name;if("formula"===n.type)return(0,h.jsx)(s()._H,{...(0,u().Ig)({propertyName:i,propertyValue:(0,h.jsx)(g().K,{})})});const a=(0,r().fromSimpleFormulaArrayValue)(null==n?void 0:n.value)[0];if("string"!=typeof a)return;const l=(0,m().L)({intl:t,isText:!0,groupValues:[],optionValues:[a],propertySchema:o});return 0!==l.length?(0,h.jsx)(s()._H,{...(0,u().Ig)({propertyName:i,propertyValue:l})}):void 0}},96754:(e,t,o)=>{o.d(t,{GJ:()=>_,Kh:()=>I,QQ:()=>w,Vk:()=>A,gi:()=>V,go:()=>P,lG:()=>T});var n=o(667294),i=()=>o(219727),a=()=>o(142735),r=()=>o(846550),l=()=>o(759366),s=()=>o(121183),c=()=>o(984709),u=()=>o(401506),d=()=>o(562027),p=()=>o(454069),m=()=>o(81954),g=()=>o(788860),h=()=>o(707513),y=()=>o(718611),f=()=>o(641702),v=()=>o(637118),x=()=>o(361726),b=()=>o(903098),S=()=>o(239869),C=()=>o(896441),k=()=>o(415764),M=o(785893);function j(e){const{actionMenu:t,automationActionStore:o,buttonPopupStore:l,disabled:s,icon:c,onClick:u,propertySchema:d,value:p}=e,{automationStore:j}=(0,v().YC)(),w=(0,i().O7)(),A=(0,r().Fg)(),I=(0,r().yK)((()=>({propertyName:{...h().Yu,fontWeight:h().Ue.medium,flexShrink:0}})),[]),_=(0,b().z)({actionId:o.id}),P=(0,a().VK)((()=>function(e){const{automationStore:t,environment:o,propertySchema:n,styles:i,theme:a,typecheckContextValues:r,value:l}=e,s=(0,M.jsx)("span",{style:i.propertyName,children:n.name}),c=void 0===(null==l?void 0:l.value);if(c)return(0,M.jsx)(g()._H,{...x().Gx({propertyName:s})});let u;const d="formula"===l.type;if(d)u=(0,M.jsx)(k().b,{returnType:{type:"text"}});else{const e=(0,f().IY)({disabled:!0,disableDateStyleAnnotations:!0,disableHover:!0,disableLinks:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestionAnnotations:!0,emojiType:(0,y().e_)(o),environment:o,formulaValueTypes:r,katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:l.value??[],spaceId:(0,m().J)(t.pointer.spaceId)},theme:a});u=(0,M.jsxs)(M.Fragment,{children:['"',(0,M.jsx)("span",{style:h().Yu,children:e}),'"']})}return(0,M.jsx)(g()._H,{...x().vE({propertyName:s,propertyValue:u})})}({automationStore:j,environment:w,propertySchema:d,styles:I,theme:A,typecheckContextValues:_,value:p})),[j,w,d,I,A,_,p]),V=(0,a().VK)((()=>T({automationStore:j,environment:w,propertySchema:d,theme:A,typecheckContextValues:_,value:p})),[j,w,d,A,_,p]),B=(0,n.useCallback)((e=>(0,M.jsx)(C().YG,{...e,actionMenu:t,buttonPopupStore:l,disabled:s,icon:c,onClick:u,children:P})),[t,l,s,c,u,P]);return P&&V?(0,M.jsx)(S().y,{renderOrigin:B,title:V}):null}function T(e){const{automationStore:t,environment:o,propertySchema:n,theme:i,typecheckContextValues:a,value:r}=e,l=n.name;if(void 0===(null==r?void 0:r.value))return(0,M.jsx)(g()._H,{...x().Gx({propertyName:l})});let s;return s="formula"===r.type?(0,M.jsx)(k().K,{}):(0,f().IY)({disabled:!0,disableDateStyleAnnotations:!0,disableFormulaVariableStyles:!0,disableHover:!0,disableInsertedDeletedAnnotations:!0,disableLinks:!0,disableStyleAnnotations:!0,disableSuggestionAnnotations:!0,emojiType:(0,y().e_)(o),environment:o,formulaValueTypes:a,katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:r.value??[],spaceId:(0,m().J)(t.pointer.spaceId)},theme:i}),(0,M.jsx)(g()._H,{...x().vE({propertyName:l,propertyValue:s})})}function w(e){return(0,M.jsx)(j,{...e,icon:d().c})}function A(e){return(0,M.jsx)(j,{...e,icon:u().p})}function I(e){return(0,M.jsx)(j,{...e,icon:l().n})}function _(e){return(0,M.jsx)(j,{...e,icon:p().O})}function P(e){return(0,M.jsx)(j,{...e,icon:s().J})}function V(e){return(0,M.jsx)(j,{...e,icon:c().u})}},516463:(e,t,o)=>{o.d(t,{Z:()=>a});o(667294);var n=()=>o(312578),i=o(785893);function a(){return(0,i.jsx)("div",{style:{alignItems:"center",display:"flex",justifyContent:"center",minHeight:200,overflow:"hidden"},children:(0,i.jsx)(n().Z,{})})}},233355:(e,t,o)=>{o.r(t),o.d(t,{AutomationBuilderModal:()=>rt,ButtonBuilderModal:()=>vt});o(670560),o(267602),o(653476),o(228244);var n=o(667294),i=()=>o(219727),a=()=>o(142735),r=()=>o(846550),l=()=>o(912203),s=()=>o(731424),c=()=>o(205248),u=()=>o(494616),d=()=>o(492522),p=()=>o(788860),m=()=>o(513670),g=()=>o(855741),h=()=>o(696459),y=()=>o(707513),f=()=>o(139224),v=()=>o(102182),x=()=>o(285755),b=()=>o(205951),S=()=>o(154186),C=()=>o(255577),k=()=>o(661297),M=()=>o(906651),j=()=>o(388284),T=()=>o(71194),w=()=>o(506347),A=()=>o(29248),I=()=>o(95886),_=()=>o(521913),P=()=>o(530980),V=()=>o(728670),B=()=>o(396136),R=()=>o(696056),F=()=>o(752778),K=()=>o(255933),Z=()=>o(511614),E=()=>o(915687),H=()=>o(545444),D=()=>o(87781),L=()=>o(637118),O=()=>o(265640),N=()=>o(765513),W=()=>o(141735),U=()=>o(594546),G=()=>o(985575),z=()=>o(122479),$=()=>o(677559),Y=()=>o(826955),q=()=>o(965014),J=o(785893);const X=(0,p().vU)({automationIncompatibleViewFilterAndOwner:{defaultMessage:"This automation may not work because the view has a non-supported filter",id:"AutomationHeaderView.incompatibleCollectionViewFilter.owner"},automationPublicAccess:{defaultMessage:"This automation is part of a public page",id:"AutomationHeaderView.automationPublicAccess"},automationUpgrade:{defaultMessage:"<anchor-upsell>Upgrade</anchor-upsell> to edit this automation or create your own",id:"AutomationHeaderView.automationUpgrade"},automationEditOnSite:{defaultMessage:"This automation can only be edited on notion.com",id:"AutomationHeaderView.automationEditOnSite"},automationExternalBotNoPermissions:{defaultMessage:"Ask {user} to edit this automation",id:"AutomationHeaderView.automationExternalBotNoPermissions"},automationExternalBotWithPermissions:{defaultMessage:"Ask {user} to edit this automation or <anchor-delete>delete</anchor-delete> it when necessary",id:"AutomationHeaderView.automationExternalBotWithPermissions"},automationMissingPermissionsNoPermissionsForDatabase:{defaultMessage:"You must have full access to target databases in this automation to edit it",id:"AutomationHeaderView.automationMissingPermissionsNoPermissionsForDatabase"},automationGenericFullAccess:{defaultMessage:"You must have full access to this database to edit automations",id:"AutomationHeaderView.automationGenericFullAccess"},automationCollectionInTrashedPage:{defaultMessage:"This database is in the trash and cannot be edited.",id:"AutomationHeaderView.automationCollectionInTrash"},automationCollectionInTrashedPageViewDeletedPageButton:{defaultMessage:"View deleted page",id:"AutomationHeaderView.automationCollectionInTrashedPageViewDeletedPageButton"},automationMissingActionFeature:{defaultMessage:"The {actionName} action is not available in your workspace",id:"AutomationHeaderView.automationMissingActionFeature"},mustBeWorkspaceMember:{defaultMessage:"You must be a workspace member to edit automations",id:"AutomationHeaderView.mustBeWorkspaceMember"}});function Q(e){const{automationPermissionScope:t,collectionStore:o,collectionSettingsStore:r,onDelete:l,referencesIncompatibleCollectionViewFilter:s,requiresSubscriptionUpgrade:c}=e,u=(0,i().O7)(),{automationStore:d,contextType:m}=(0,L().YC)(),g=(0,p().YB)(),{value:y}=(0,$().XJ)(W().F.formulas),{value:f}=(0,$().XJ)(x().Sm.automationActionRegistry),{value:v}=(0,$().XJ)(x().Sm.automationTypecheck),b=(0,a().VK)((()=>Boolean((0,z().eV)(u,d))),[d,u]),S=(0,a().VK)((()=>(0,G().$5)({environment:u,automationStore:d,automationActionRegistryModule:f,automationTypecheckModule:v,contextType:m,formulasModule:y,intl:g})),[u,d,f,v,m,y,g]),C=(0,a().VK)((()=>{const e=(0,V().OJ)({recordPointer:o.pointer,getRecordModel:o.getRecordModel});if(!e||e.table!==B().iU)return;const t=e.pointer;return Y().G.createChildStore(o,t)}),[o]),k=(0,n.useCallback)((()=>{q().y(u,{from:"database_automation_settings_header_message",upsell:{type:"product",product:"plus",limit:{type:"none"}}})}),[u]),M=ne();if(c)return(0,J.jsx)(D().c,{onUpsellClick:k});if(C)return(0,J.jsx)(oe,{icon:(0,J.jsx)("div",{style:M.lockedIconWrap,children:(0,I().y)(M.lockedIcon)}),children:(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{style:M.paragraph,children:(0,J.jsx)(p()._H,{...X.automationCollectionInTrashedPage})}),(0,J.jsx)(O().D,{onClick:()=>{!function(e,t){(function(e){(0,U().K4)(e,"view_deleted_page_from_automation_edit_menu")})(t),Z().r({environment:t,store:e,pageVisitSource:w().tY.LinkInPage})}(C,u),E().x({environment:u,collectionSettingsStore:r})},style:M.restoreButton,isLightGray:!0,children:(0,J.jsx)(p()._H,{...X.automationCollectionInTrashedPageViewDeletedPageButton})})]})});if(b)return(0,J.jsx)(H().k,{children:(0,J.jsx)(p()._H,{...X.automationPublicAccess})});if("insufficient"===S.editPermissionStatus){if("free_workspace"===S.reason)return(0,G().Rr)({contextType:m,environment:u})?(0,J.jsx)(te,{icon:(0,J.jsx)("div",{style:M.boltIconWrap,children:(0,A().K)(M.boltIcon)}),children:(0,J.jsx)("p",{style:M.paragraph,children:(0,J.jsx)(p()._H,{...X.automationUpgrade,values:{"anchor-upsell":e=>(0,J.jsx)(N().Z,{onClick:k,style:M.link,children:e})}})})}):(0,J.jsx)(H().k,{children:(0,J.jsx)(p()._H,{...X.automationEditOnSite})});if("feature_not_enabled"===S.reason)return(0,J.jsx)(H().k,{children:(0,J.jsx)(p()._H,{...X.automationMissingActionFeature,values:{actionName:S.actionName.toLocaleLowerCase()}})});var j,T,P;if("missing_permissions"===S.reason)return(null===(j=S.relatedPointer)||void 0===j?void 0:j.table)===R().cZ?(0,J.jsx)(ee,{botId:S.relatedPointer.id,automationPermissionScope:t,onDelete:l,automationStore:d}):(null===(T=S.relatedPointer)||void 0===T?void 0:T.table)===F().vF&&S.relatedPointer.id!==o.id?(0,J.jsx)(H().k,{children:(0,J.jsx)(p()._H,{...X.automationMissingPermissionsNoPermissionsForDatabase})}):(null===(P=S.relatedPointer)||void 0===P?void 0:P.table)===K().bx?(0,J.jsx)(H().k,{children:(0,J.jsx)(p()._H,{...X.mustBeWorkspaceMember})}):(0,J.jsx)(H().k,{children:(0,J.jsx)(p()._H,{...X.automationGenericFullAccess})});(0,h().t1)(S)}else{if("unknown"===S.editPermissionStatus)return(0,J.jsx)(H().k,{children:(0,J.jsx)(p()._H,{...X.automationGenericFullAccess})});if("sufficient"===S.editPermissionStatus)return s?(0,J.jsx)(H().k,{icon:(0,_().t)(M.warningIcon),children:(0,J.jsx)(p()._H,{...X.automationIncompatibleViewFilterAndOwner})}):null;(0,h().t1)(S)}}function ee(e){const{botId:t,automationPermissionScope:o,onDelete:n,automationStore:i}=e,r=(0,p().YB)(),l=ne(),s=(0,a().VK)((()=>{const e=Y().Qx.createChildStore(i,{id:t,spaceId:i.getSpaceId(),table:R().cZ}).getCreatedByStore();return e?e.getDisplayName(r):r.formatMessage(P().T_T.messages.anonymousPlaceholder)}),[i,t,r]);return(0,J.jsx)(H().k,{children:(0,J.jsx)(p()._H,{..."readonly"===o?X.automationExternalBotNoPermissions:X.automationExternalBotWithPermissions,values:{"anchor-delete":e=>(0,J.jsx)(N().Z,{onClick:n,style:l.link,children:e}),user:s}})})}function te(e){const{children:t,icon:o}=e,n=ne();return(0,J.jsx)("div",{style:n.wrapWrap,children:(0,J.jsxs)("div",{style:n.upsellWrap,children:[o&&(0,J.jsx)("div",{style:n.iconWrap,children:o}),(0,J.jsx)("div",{style:n.messageWrap,children:t})]})})}function oe(e){const{children:t,icon:o}=e,n=ne();return(0,J.jsx)("div",{style:n.wrapWrap,children:(0,J.jsxs)("div",{style:n.trashPageWrap,children:[o&&(0,J.jsx)("div",{style:n.iconWrap,children:o}),(0,J.jsx)("div",{style:n.messageWrap,children:t})]})})}function ne(){const{isMobile:e}=(0,i().Fy)();return(0,r().yK)((t=>({boltIcon:{fill:t.icon.yellowPrimary,height:"100%",width:"100%"},boltIconWrap:{height:20,padding:2,width:20},icon:{},iconWrap:{flexGrow:0,flexShrink:0},lockedIcon:{fill:t.icon.secondary,height:"100%",width:"100%"},lockedIconWrap:{background:t.fill.lightGraySecondary,borderRadius:4,height:20,padding:2,width:20},link:{color:t.text.uiBluePrimary},messageWrap:{flexGrow:1},paragraph:{color:t.text.secondary,fontSize:e?14:12,margin:0},restoreButton:{fontSize:e?14:12,fontWeight:y().Ue.medium,marginLeft:-8},warningIcon:{color:t.accentColors.orange[400],height:"100%",width:"100%"},warningIconWrap:{height:20,padding:2,width:20},wrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:10},wrapWrap:{padding:e?"0 12px 12px":"0 0 6px 0"},upsellWrap:{alignItems:"center",background:t.accentColors.yellow[50],border:`1px solid ${t.accentColors.yellow[100]}`,borderRadius:6,display:"flex",flexDirection:"row",gap:10,padding:8},trashPageWrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:10,background:t.accentColors.gray[30],padding:8,borderRadius:6},personBadgeQuestionMark:{fill:t.mediumIconColor,width:16,height:"auto"},personBadgeQuestionMarkWrap:{height:20,padding:2,width:20}})),[e])}var ie=()=>o(195245),ae=()=>o(471645),re=()=>o(654133),le=()=>o(641506);const se=(0,p().vU)({automationEnabledLabel:{defaultMessage:"Active",id:"collectionSettings.editAutomationView.automationEnabledLabel"},automationEnabledHiddenAriaLabel:{defaultMessage:"Automation is active.",id:"collectionSettings.editAutomationView.automationEnabledHiddenAriaLabel"},automationPausedHiddenAriaLabel:{defaultMessage:"Automation is paused.",id:"collectionSettings.editAutomationView.automationPausedHiddenAriaLabel"},automationDisabledTooltip:{defaultMessage:"Ask {user} to resume this automation.",id:"collectionSettings.editAutomationView.automationDisabledTooltip"},automationErrorsDisabledTooltip:{defaultMessage:"Fix any errors or remove failing steps to enable this automation",id:"collectionSettings.editAutomationView.automationErrorsDisabledTooltip"}});function ce(e){const{automationId:t,automationOwner:o,disabled:a,isAutomationPaused:l,onPause:s,onResume:c}=e,{cantSaveDueToError:u}=(0,ie().i)(),{isMobile:d}=(0,i().Fy)(),m=`toggle-${t}`,g=(0,n.useCallback)((()=>{l?null==c||c():null==s||s()}),[l,c,s]),h=(0,r().yK)((e=>({labelWrap:{color:a?e.text.tertiary:e.text.secondary,flex:"1 1 auto",fontSize:d?y().JB.UIRegular.mobile:y().JB.UIRegular.desktop},sectionWrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:6,marginBlockEnd:0},toggleWrap:{flex:"0 0 auto",paddingBlockStart:d?5:2}})),[a,d]),f=se.automationEnabledLabel,v=l?se.automationPausedHiddenAriaLabel:se.automationEnabledHiddenAriaLabel;return(0,J.jsxs)("section",{style:h.sectionWrap,children:[(0,J.jsx)("div",{style:h.toggleWrap,children:(0,J.jsx)(re().Z,{disableTooltip:!a||!l,renderTooltip:()=>u?(0,J.jsx)(p()._H,{...se.automationErrorsDisabledTooltip}):(0,J.jsx)(p()._H,{...se.automationDisabledTooltip,values:{user:o}}),render:e=>(0,J.jsx)("div",{...e,children:(0,J.jsx)(ae().Z,{disabled:a,inputId:m,on:!l,onClick:g})})})}),(0,J.jsx)("div",{style:h.labelWrap,children:(0,J.jsxs)("label",{htmlFor:m,children:[(0,J.jsx)("span",{"aria-hidden":!0,children:(0,J.jsx)(p()._H,{...f})}),(0,J.jsx)("span",{style:le().jy,children:(0,J.jsx)(p()._H,{...v})})]})})]})}var ue=()=>o(749826);var de=()=>o(565276);function pe(e){const{shouldInvokeHandler:t,isMobile:o,onClick:i}=e;(0,n.useEffect)((()=>{async function e(e){const o=e.target instanceof Element&&((0,de().Yj)(e.target)||(0,de().Br)(e.target));e.eventPhase===Event.CAPTURING_PHASE&&t&&o&&(e.stopPropagation(),e.preventDefault(),await i())}if(!o)return window.addEventListener("click",e,{capture:!0}),()=>{window.removeEventListener("click",e,{capture:!0})}}),[t,o,i])}var me=()=>o(867601),ge=()=>o(712334),he=()=>o(487270),ye=()=>o(466970),fe=()=>o(142109),ve=()=>o(876822),xe=()=>o(642966),be=()=>o(486896),Se=()=>o(200027),Ce=()=>o(166312),ke=()=>o(807629),Me=()=>o(492135);var je=()=>o(359620);function Te(){const{automationStore:e}=(0,ie().P)();return(0,a().VK)((()=>function(e){var t;const o=(null===(t=e.getTrigger())||void 0===t?void 0:t.type)??"event";return"event"===o||"notification_event"===o||"recurrence"!==o&&void(0,h().t1)(o)}(e)),[e])}var we=()=>o(269299),Ae=()=>o(291198),Ie=()=>o(740046);const _e=(0,p().vU)({placeholder:{defaultMessage:"Automation name",id:"AutomationNameInput.placeholder"}});const Pe=(0,n.forwardRef)((function(e,t){const{disabled:l,autoSelectAllOnDesktop:s,placeholder:c,...u}=e,{automationStore:d}=(0,L().YC)(),{maybePersistedTransactionActions:m}=(0,ie().i)(),g=function(e){const{isMobile:t}=(0,i().Fy)(),{disabled:o}=e;return(0,r().yK)((e=>({automationNameInput:{marginBlockEnd:0},automationNameText:{color:o?e.text.tertiary:e.text.primary,marginInlineStart:t?12:0,marginInlineEnd:t?12:18,fontWeight:y().Ue.medium,padding:0},input:{background:"transparent",boxShadow:"unset",fontWeight:y().Ue.medium,padding:0}})),[t,o])}({showDeleteEnableDisableOptions:!1,disabled:l}),{isMobile:h}=(0,i().Fy)(),f=(0,p().YB)(),v=(0,a().VK)((()=>(null==d?void 0:d.getName())??""),[d]),x=(0,n.useRef)(null),b=(0,o(794623).Z)(x,t),S=c||f.formatMessage(_e.placeholder),C=(0,n.useCallback)((e=>{m.createAndCommit({userAction:"Automation.updateName",perform:t=>{we().applyOperation({store:d,operation:{path:["properties"],pointer:d.pointer,command:"update",args:{name:e}},transaction:t})}})}),[d,m]),k=(0,n.useCallback)((e=>{const t=e.currentTarget.value;C(t)}),[C]),M=(0,n.useCallback)((e=>{e.currentTarget.value||C(S)}),[C,S]);return(0,n.useEffect)((()=>{var e;s&&!h&&(null===(e=x.current)||void 0===e||null===(e=e.querySelector("input"))||void 0===e||e.select())}),[s,h]),(0,o(732811).K)((()=>{h&&!v&&C(S)})),(0,J.jsx)(Ie().ZP,{style:g.automationNameInput,...u,value:v??"Loading...",onChange:k,disabled:l,onBlur:M,ref:b,inputOuterStyle:g.input,format:Ae().B.ExtraLarge,textWrapperStyle:g.automationNameText,placeholder:S,inputStyle:{paddingLeft:0,paddingRight:0},autoFocus:!v})}));var Ve=()=>o(294105),Be=()=>o(374289),Re=()=>o(139978),Fe=()=>o(448419),Ke=()=>o(676279),Ze=(o(241792),o(731107),()=>o(455947)),Ee=()=>o(242550),He=()=>o(716025),De=()=>o(900596),Le=()=>o(887430),Oe=()=>o(178498),Ne=()=>o(827973),We=()=>o(198829),Ue=()=>o(470386),Ge=()=>o(943620),ze=()=>o(561933),$e=()=>o(352230),Ye=()=>o(549813),qe=()=>o(998901);const Je=(0,p().vU)({forPagesIn:{id:"collectionSettings.editAutomationView.notifyForOption.title",defaultMessage:"For pages in"}});function Xe(e){const{selectedSourcePointer:t,collectionContextStore:o,onSelect:l,onClose:s}=e,{isMobile:c}=(0,i().Fy)(),u=(0,p().YB)(),d=(0,i().O7)(),[g,y]=n.useState(""),f=(0,a().VK)((()=>o.collectionStore()),[o]),v=(0,a().VK)((()=>o.collectionViewBlockStore()),[o]),x=(0,a().VK)((()=>v&&f?v.getCollectionViewStores().filter((e=>{var t;const o=null===(t=e.getCollectionStore())||void 0===t?void 0:t.pointer;return(null==o?void 0:o.id)===f.id})):[]),[v,f]),b=(0,a().VK)((()=>{if(!f)return[];let e;t&&"collection_view"===t.table&&(e=Y().Xr.createChildStore(f,t));return m().mN([...x,e].filter(h().$K),(e=>{let{id:t}=e;return t})).filter((e=>(0,Le().D)(e,g)))}),[f,x,g,t]),S=(0,a().VK)((()=>{if(f&&(0,ze().r_)({collectionStore:f,environment:d,intl:u,queryForFilter:g}))return function(e){const{collectionStore:t,environment:o,selectedSourcePointer:n,onSelect:i,isMobile:a,intl:r}=e,l=t.getIcon(),s=(0,Ye().vU)({environment:o,intl:r,store:t}),c=n&&"collection"===n.table&&n.id===t.id,u=t.getSpaceShardedPointer(),d={key:t.id,action:()=>{u&&i(u)},render:e=>(0,J.jsx)(Ne().Z,{...e,icon:l&&(0,J.jsx)(Ge().Z,{isEmptyPage:!1,size:a?18:16,disabled:!0,icon:l}),title:s,caption:(0,J.jsx)(p()._H,{id:"AutomationCollectionSelectMenu.collection.caption",defaultMessage:"Entire database",values:{collectionName:s}}),right:c&&(0,Ee().A)({width:16,height:"auto"})})};return{key:"collection",items:[d],render:e=>(0,J.jsx)(j().Z,{...e})}}({collectionStore:f,environment:d,selectedSourcePointer:t,onSelect:l,isMobile:c,intl:u})}),[f,d,u,c,l,g,t]),k=(0,a().VK)((()=>f&&v&&x?function(e){const{blockStore:t,filteredCollectionViewStores:o,collectionStore:n,selectedSourcePointer:i,onSelect:a,intl:r}=e,l=n.getSchema(),s=o.map((e=>{if("form_editor"===e.getType()||"chart"===e.getType())return;const o=e.getSpaceShardedPointer();if(e.isDefined()&&o){const s=i&&"collection_view"===i.table&&i.id===o.id,c=(0,me().rU)({collectionViewStore:e,collectionSchema:l}),u=(0,me().sM)({collectionViewStore:e,collectionSchema:l}),d=(0,h().$K)(c)||(0,h().$K)(u),m=e.getType(),g=e.getFormat().collection_view_icon,y=e.getName(),f=(o,n)=>(0,J.jsx)(Ne().Z,{...o,...n,icon:(0,J.jsx)(He().F,{color:"lightGray",viewType:m,viewIcon:g}),title:(0,J.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4},children:[(0,J.jsx)(De().Z,{collectionViewType:m,collectionViewName:y}),d&&s&&(0,_().t)({width:16,height:"auto"})]}),caption:(0,J.jsx)(Qe,{blockStore:t,collectionViewStore:e,intl:r,collectionSchema:l,referencesIncompatibleProperties:d}),right:s&&(0,Ee().A)({width:16,height:"auto"}),disabled:d,disabledFeedback:d});let v;if(d&&c){var n;const e=null===(n=l[c])||void 0===n?void 0:n.type,t=e?ze().SO[e]:void 0,o=t?(0,J.jsx)(p()._H,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.specific",defaultMessage:"{propertyTypeName} properties are not supported",values:{propertyTypeName:t}}):(0,J.jsx)(p()._H,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.default",defaultMessage:"Some properties are not supported"});v=e=>(0,J.jsx)(re().Z,{placement:qe().Placement.Right,renderTooltip:()=>o,render:t=>f(e,t)})}else if((0,h().$K)(u)){const e=(0,J.jsx)(p()._H,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.crossSpace",defaultMessage:"Cross work-space properties are not supported"});v=t=>(0,J.jsx)(re().Z,{placement:qe().Placement.Right,renderTooltip:()=>e,render:e=>f(t,e)})}else v=f;return{key:e.id,action:()=>{a(o)},render:v}}}));return[...s].filter(h().$K)}({blockStore:v,collectionStore:f,filteredCollectionViewStores:b,selectedSourcePointer:t,onSelect:l,intl:u}):[]),[v,f,x,b,u,l,t]),M=function(e){const{menuListItems:t}=e;if(0===t.length)return;return{key:"collection-views",items:t,render:e=>(0,J.jsx)(j().Z,{...e,topBorder:!0})}}({menuListItems:k}),T={key:"search",items:[{key:"search_item",action:()=>{},render:()=>(0,J.jsx)(Ie().ZP,{value:g,focus:!0,style:I.searchBar,textWrapperStyle:I.searchText,onChange:e=>y(e.target.value),placeholder:u.formatMessage({defaultMessage:"Search views...",id:"collectionViewSelect.viewSearch.placeholder"})})}],render:e=>(0,J.jsx)(j().Z,{...e})};let w;(0,h().$K)(S)||(0,h().$K)(M)||(w={key:"no-results-section",items:[{key:"no-results-item",action:m().ZT,render:()=>(0,J.jsx)(Oe().Z,{caption:(0,J.jsx)(p()._H,{defaultMessage:"No results",id:"collectionViewSelect.noResults.title"})})}],render:e=>(0,J.jsx)(j().Z,{...e,topBorder:!0})});const A=[T,S,M,w].filter(h().$K),I=(0,r().yK)((e=>({searchBar:{marginTop:6},searchText:{marginLeft:8,marginRight:8}})),[]);if(!f)return null;let P;return P=c?{menuType:$e().o.Modal,title:(0,J.jsx)("div",{style:{display:"flex"},children:(0,J.jsx)(p()._H,{...Je.forPagesIn})}),right:(0,J.jsx)(Ue().DoneMenuText,{}),onClickRight:()=>{s()}}:{menuType:$e().o.Popup,width:230,maxHeight:"50vh"},(0,J.jsx)(We().Z,{...P,children:(0,J.jsx)(C().ZP,{type:C().iW.Vertical,sections:A,initialFocus:0,onAccept:()=>{s()}})})}function Qe(e){const{blockStore:t,collectionViewStore:o,intl:n,collectionSchema:r,referencesIncompatibleProperties:l}=e,s=(0,i().O7)(),c=(0,a().VK)((()=>!o.getAlive()),[o]),u=(0,a().VK)((()=>{const e=o.getParentBlockStore();if(e)return t.id!==e.id?(0,Ye().vU)({environment:s,intl:n,store:e}):void 0}),[t.id,o,n,s]),d=(0,a().VK)((()=>{const e=o.getQuery(r);return(0,Ze().OH)({propertyFilters:o.getPropertyFiltersStore().getValue()??[],combinatorFilter:null==e?void 0:e.filter,schema:r}).reduce(((e,t)=>{if((0,Ze().aN)(t))return e+1;return e+(t.filters??[]).length}),0)}),[r,o]);return l?(0,J.jsx)(p()._H,{id:"AutomationCollectionSelectMenu.collectionView.unsupportedView",defaultMessage:"Not supported"}):c?(0,J.jsx)(p()._H,{id:"AutomationCollectionSelectMenu.collectionView.deletedView",defaultMessage:"<emphasis>View not found.</emphasis>",values:{emphasis:e=>(0,J.jsx)("em",{children:e})}}):u?(0,J.jsx)(p()._H,{id:"AutomationCollectionSelectMenu.collectionView.captionDifferentParent",defaultMessage:"<emphasis>View configured in {externalParentBlockName}</emphasis>",values:{emphasis:e=>(0,J.jsx)("em",{children:e}),externalParentBlockName:u}}):0===d?(0,J.jsx)(p()._H,{id:"AutomationCollectionSelectMenu.collectionView.captionWithNoFilters",defaultMessage:"Any page in this view"}):(0,J.jsx)(p()._H,{id:"AutomationCollectionSelectMenu.collectionView.captionWithFilters",defaultMessage:"{ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",values:{ruleCount:d}})}function et(e){const{pointer:t,collectionStore:o,intl:n}=e,l=(0,i().O7)(),s=(0,r().yK)((e=>({warningIcon:{width:16,height:"auto",color:e.accentColors.orange[400]},titleContainer:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4,flex:"1 1 auto",minWidth:0},title:{...y().Yu},errorText:{color:e.errorText,fontWeight:y().Ue.medium}})),[]),c=(0,a().VK)((()=>t?Y().t1.createChildStore(o,t):void 0),[o,t]),u=(0,a().VK)((()=>c?(0,Ye().vU)({environment:l,intl:n,store:c}):(0,J.jsx)("span",{style:s.errorText,children:(0,J.jsx)(p()._H,{id:"AutomationCollectionSelectMenu.source.missing",defaultMessage:"Select database"})})),[l,n,s.errorText,c]),d=(0,a().VK)((()=>{if(!c||c.table===F().vF)return!1;const e=o.getSchema();return(0,h().$K)((0,me().rU)({collectionViewStore:c,collectionSchema:e}))}),[o,c]);return(0,J.jsxs)("div",{style:s.titleContainer,children:[d&&(0,_().t)(s.warningIcon),(0,J.jsx)("span",{style:s.title,children:u})]})}function tt(e){const{collectionContextStore:t,disabled:o}=e,{isMobile:l}=(0,i().Fy)(),s=(0,p().YB)(),c=(0,r().yK)((e=>{const t=o?e.text.tertiary:e.text.secondary,n=l?y().JB.UIRegular.mobile:y().JB.UIRegular.desktop;return{wrap:{alignItems:"center",color:t,cursor:"default",display:"grid",fontSize:n,gridTemplateColumns:"auto auto"},button:{color:t,fontWeight:y().Ue.medium,fontSize:n,width:"100%",height:24,paddingLeft:6,paddingRight:6,marginLeft:1},icon:{width:10,marginLeft:4,fill:t}}}),[l,o]),{automationStore:u}=(0,L().YC)(),{maybePersistedTransactionActions:d}=(0,ie().i)(),m=(0,a().VK)((()=>t.collectionStore()),[t]),g=(0,a().VK)((()=>{const e=null==u?void 0:u.getTrigger();if(e&&("event"===e.type||"notification_event"===e.type)){const t=e.event.source;if(t&&"filter"!==t.type)return t.pointer}}),[u]),h=(0,n.useCallback)((e=>{const t=e.table===F().vF?{pointer:e,type:F().vF}:{pointer:e,type:Re().np};d.createAndCommit({userAction:"Automation.updateSource",perform:e=>{we().applyOperation({store:u,operation:{path:["trigger","event"],pointer:u.pointer,command:"update",args:{source:t}},transaction:e})}})}),[u,d]),f=(0,Ke().d)(),v=m?(0,J.jsx)(et,{pointer:g,collectionStore:m,intl:s}):(0,J.jsx)(n.Fragment,{}),x=(0,J.jsx)(Fe().ZP,{alignmentToOrigin:Fe().vR.Start,placementToOrigin:Fe().pO.Bottom,popupType:f,render:e=>(0,J.jsx)(Xe,{selectedSourcePointer:g,onSelect:h,onClose:()=>{e.close()},collectionContextStore:t}),renderOrigin:e=>(0,J.jsxs)(O().D,{...e,style:c.button,disabled:o,children:[v,(0,Be().i)(c.icon)]})});return(0,J.jsx)("div",{style:c.wrap,children:(0,J.jsx)(p()._H,{id:"automationBuilderModal.SourceInput.appliesTo",defaultMessage:"For all pages in {button}",values:{button:x}})})}function ot(){const e=(0,i().O7)(),t=(0,p().YB)(),{isMobile:o}=(0,i().Fy)(),n=(0,r().yK)((e=>{const t=o?y().JB.UIRegular.mobile:y().JB.UIRegular.desktop;return{wrap:{color:e.text.secondary,fontSize:t},title:{color:e.text.secondary,fontWeight:y().Ue.medium,fontSize:t}}}),[o]),{collectionStore:l}=(0,ie().P)(),s=(0,a().VK)((()=>(0,Ye().vU)({environment:e,intl:t,store:l})),[l,e,t]),c=(0,J.jsx)("span",{style:n.title,children:s});return(0,J.jsx)("div",{style:n.wrap,children:(0,J.jsx)(p()._H,{id:"automationBuilderModal.SourceLabel.appliesTo",defaultMessage:"For {source}",values:{source:c}})})}let nt;(0,o(947115).exposeDebugGetter)("currentAutomation",(()=>nt));const it=(0,p().vU)({deleteButton:{id:"automationBuilderModal.editAutomationView.deleteButton",defaultMessage:"Delete"},createButton:{id:"automationBuilderModal.editAutomationView.createButton.label",defaultMessage:"Create"},saveButton:{id:"automationBuilderModal.editAutomationView.saveButton.label",defaultMessage:"Save"},cancelButton:{id:"automationBuilderModal.editAutomationView.cancelButton.label",defaultMessage:"Cancel"},doneButton:{id:"automationBuilderModal.editAutomationView.doneButton.label",defaultMessage:"Done"},enableButton:{id:"automationBuilderModal.editAutomationView.enableButton.label",defaultMessage:"Enable"},errorsFooterCaption:{id:"automationBuilderModal.editAutomationView.errorCaption",defaultMessage:"Fix errors to enable"}});function at(){}function rt(e){const{collectionSettingsStore:t,collectionContextStore:o,source:w,...A}=e,I=(0,ye().E)("automation_updated_error_states"),[_]=(0,n.useState)((()=>A)),{mode:P}=_,V=(0,p().YB)(),B=(0,i().O7)(),{isMobile:R}=(0,i().Fy)(),{value:F}=(0,$().XJ)(W().F.formulas),{value:K}=(0,$().XJ)(x().Sm.automationTypecheck),[Z,H]=(0,n.useState)([]),D="create"===P,O=(0,fe().$)("BuilderModal",{cacheFallback:B.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),N=(0,a().VK)((()=>ve().default.state.currentUserStore),[]),G=(0,a().VK)((()=>null==N?void 0:N.userId),[N]),z=(0,a().VK)((()=>null==N?void 0:N.getDisplayName(V)),[N,V]),q=(0,a().VK)((()=>o.collectionStore()),[o]),X=(0,a().VK)((()=>null==q?void 0:q.getSpaceId()),[q]),ee=(0,a().VK)((()=>null==q?void 0:q.id),[q]),te=(0,n.useMemo)((()=>"update"===_.mode?_.automationId:(0,he().TS)({environment:B,table:u().cv,spaceId:X})),[_,B,X]),oe=(0,a().Kw)(o.aliveAutomationCountStore),ne=(0,a().VK)((()=>{if(X&&q&&G)return new(Y().Mz)(B,{id:te,table:u().cv,spaceId:X})}),[te,q,G,B,X]);!function(e){(0,n.useEffect)((()=>(nt=e,()=>{nt=void 0})),[e])}(ne);const ie=(0,a().VK)((()=>(0,s().XO)(V,z)),[z,V]),ae=(0,a().VK)((()=>{if(!X||!q||!G)return;const e={id:te,table:u().cv,spaceId:X},t=O.getEntry({pointer:e,userId:G});return t?t.value.value:me().sA({automationId:te,automationName:"",collectionStore:q,userId:G})}),[te,q,G,X,O]),{maybePersistedAutomationStore:re,maybePersistedTransactionActions:le,hasUnpersistedChanges:se}=(0,je().$)({automationId:te,spaceId:X,defaultValue:D?ae:void 0,persist:!1}),ce=(0,a().VK)((()=>{if(re&&(0,ge().Xd)(re))return re}),[re]),de=(0,a().VK)((()=>(null==ce?void 0:ce.getName())??""),[ce]),Ce=(0,a().VK)((()=>((null==ce?void 0:ce.getActionStores())??[]).filter((e=>e.isDefined()))),[ce]),Te=(0,a().VK)((()=>(0,ge().Uk)((null==ce?void 0:ce.getTriggerType())??"event")),[ce]),we=(0,a().VK)((()=>{const e=null==q?void 0:q.getParentBlockStore();return!!e&&e.pathIsDead()}),[q]),Ae=function(e){const{actionStores:t,automationStore:o,collectionStore:n,loadingStatus:i,mode:r}=e;return(0,a().VK)((()=>"create"===r?"edit":"resolved"===i&&o&&t&&n?(0,me().i1)({automationStore:o,actionStores:t,collectionStore:n})?"edit":(0,me().qM)({automationStore:o,collectionStore:n})?"readonly_with_delete":"readonly":"readonly"),[r,i,o,t,n])}({automationStore:ce,actionStores:Ce,collectionStore:q,loadingStatus:"resolved",mode:_.mode}),Ie=("readonly_with_delete"===Ae||"edit"===Ae&&!D)&&!we,_e=(0,a().VK)((()=>!(!ce||!q)&&me().vM({automationStore:ce,collectionStore:q})),[ce,q]),Be=(0,a().VK)((()=>ce&&F&&K?(0,ke().k)({environment:B,automationStore:ce,automationTypecheckModule:K,contextType:Te,formulasModule:F,intl:V}):void 0),[B,ce,Te,F,K,V]),Re=(0,a().VK)((()=>!!(q&&ce&&Be)&&me().qk({automationStore:ce,collectionStore:q,typecheckResult:Be})),[ce,q,Be]),Fe=(0,a().VK)((()=>!!Be&&(0,Se().A)({environment:B,typecheckResult:Be,automationStore:ce})),[ce,B,Be]),Ke=(0,a().VK)((()=>ne&&F&&K?(0,ke().k)({environment:B,automationStore:ne,automationTypecheckModule:K,contextType:Te,formulasModule:F,intl:V}):void 0),[B,ne,Te,F,K,V]),Ze=(0,a().VK)((()=>!!(q&&ne&&Ke)&&me().qk({automationStore:ne,collectionStore:q,typecheckResult:Ke})),[q,ne,Ke]),Ee=(0,a().VK)((()=>{if(!ce)return!0;let e;var t;(ce.isTriggerType("event")||ce.isTriggerType("notification_event"))&&(e=null===(t=ce.getEventConfiguration())||void 0===t?void 0:t.pagePropertiesEdited.type);const o=(0,h().$K)(e)&&"none"!==e,n=ce.getActionStores().length>0;if(!n&&!o)return!1;const i=!(0,l().Of)({automationTrigger:ce.getTrigger(),collectionSchema:null==q?void 0:q.getSchema()});if(o&&i)return!0;if(n&&(0,h().$K)(Be)&&g().x.isSuccess(Be)){if(Object.keys(Be.value.actionValidationFailures).some((e=>!Z.includes(e))))return!0}return!1}),[ce,q,Z,Be]);!function(e){const{automationStore:t,collectionStoreId:o,source:r}=e,l=(0,i().O7)(),[s,c]=(0,n.useState)(!1),u=(0,a().VK)((()=>(null==t?void 0:t.getActionIds().length)??0),[t]),d=(0,a().VK)((()=>{if(!t||!t.isTriggerType("event")&&!t.isTriggerType("notification_event"))return 0;const e=t.getTriggerStore().getKeyStore("event");let o=0;e.getKeyStore("pagesAdded").getValue()&&o++;const n=e.getKeyStore("pagePropertiesEdited").getValue();if("any"===(null==n?void 0:n.type))o++;else if("some"===(null==n?void 0:n.type)){var i;o+=(null===(i=n.some)||void 0===i?void 0:i.length)??0}else if("all"===(null==n?void 0:n.type)){var a;o+=(null===(a=n.all)||void 0===a?void 0:a.length)??0}return o}),[t]);(0,n.useEffect)((()=>{o&&!s&&t&&((0,U().j)({environment:l,event:{eventName:"automation_configure_view",eventProperties:{automation_id:t.id,automation_total_actions:u,automation_total_triggers:d,collection_id:o,source:r}}}),ue().default.logEvent("automation_configure_view","true"),c(!0))}),[l,o,s,u,d,null==t?void 0:t.id,t,r])}({automationStore:ce,collectionStoreId:ee,source:e.source});const He="edit"===Ae&&!we&&!Fe,De=(0,n.useCallback)((()=>{I&&H([])}),[I]),Le=(0,n.useCallback)((()=>{q&&ce&&se&&("create"===P?function(e){const{automationStore:t,collectionSettingsStore:o,collectionStore:n,environment:i,intl:a,from:r}=e;T().aO({automationStore:t,collectionStore:n,environment:i,intl:a,from:r,builderType:"modal"}),v().oV({label:(0,J.jsx)(p()._H,{id:"automations.editAutomationView.createdConfirmation",defaultMessage:"{automationName} created",values:{automationName:t.getName()}})}),E().x({environment:i,collectionSettingsStore:o});const l=(0,xe().n)(o);l&&"automationSettings"!==l.type&&f().H4({collectionSettingsStore:o,item:{type:"automationSettings",source:"first_automation_created"}})}({automationStore:ce,collectionSettingsStore:t,collectionStore:q,environment:B,intl:V,from:_.from}):"update"===P?function(e){const{automationStore:t,collectionSettingsStore:o,collectionStore:n,environment:i,source:a}=e;T().hY({automationStore:t,collectionStore:n,environment:i,builderType:"modal",source:a}),v().oV({label:(0,J.jsx)(p()._H,{id:"automations.editAutomationView.updatedConfirmation",defaultMessage:"{automationName} updated",values:{automationName:t.getName()}})}),E().x({environment:i,collectionSettingsStore:o})}({automationStore:ce,collectionSettingsStore:t,collectionStore:q,environment:B,source:w}):(0,h().t1)(P))}),[ce,t,q,B,se,V,P,_,w]),Oe=(0,n.useCallback)((async()=>{ce&&q&&!D&&await T().SC({intl:V,environment:B,existingAutomationStore:ce,collectionStore:q,onDelete:()=>{var e;E().x({environment:B,collectionSettingsStore:t}),1===oe&&"automationSettings"===(null===(e=(0,xe().n)(t))||void 0===e?void 0:e.type)&&f().wl({collectionSettingsStore:t,item:{type:"main"}})}})}),[oe,ce,t,q,B,V,D]),Ne=(0,n.useCallback)((async()=>{if(se){await T().hL({automationName:de,hasPendingChanges:se})&&E().x({environment:B,collectionSettingsStore:t})}else E().x({environment:B,collectionSettingsStore:t})}),[de,t,B,se]);pe({shouldInvokeHandler:!0,onClick:Ne,isMobile:R});const We=(0,n.useCallback)((e=>{H([e.id])}),[]),Ue=(0,Me().a)(),Ge=function(){const{isMobile:e}=(0,i().Fy)(),t=ut();return(0,r().yK)((o=>({header:{backgroundColor:o.surface.elevated,zIndex:d().R1,width:"100%",...e?{paddingBottom:0,paddingTop:0}:{paddingBottom:8,borderBottom:`1px solid ${o.stroke.secondary}`}},nameInput:{...e&&{paddingTop:8}},buttons:{backgroundColor:o.surface.elevated,display:"flex",flexDirection:"row",paddingBottom:e?16:4,paddingTop:12,justifyContent:"space-between",gap:e?"10px":0,width:"100%",zIndex:d().R1,...e&&{paddingLeft:lt,paddingRight:lt,flexDirection:"column-reverse"}},footerButton:{height:32,width:e?"100%":"auto"},footerErrorCaption:{color:o.text.tertiary,fontSize:y().JB.UISmall.desktop},footerRight:{alignItems:"center",display:"flex",gap:14,justifyContent:"space-between"},automationOptionIconDesktop:{marginInlineStart:12},wrap:{marginTop:e?16:17,marginBottom:e?20:0,paddingBottom:16,width:"100%",flexGrow:1,overflowY:"auto"},closeButtonContainer:{position:"absolute",top:10,right:10,zIndex:d().Ke},closeButton:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:o.tint.regular,width:24,height:24},closeButtonHover:{background:o.buttonPressedBackground},closeButtonIcon:{width:14,fill:o.icon.secondary},...t})),[e,t])}(),ze=[],$e=se&&Re;He&&!R&&ze.push((0,J.jsxs)(j().Z,{style:Ge.buttons,mobileStyle:Ge.buttons,children:[(0,J.jsx)(k().Z,{onClick:Ne,style:Ge.footerButton,children:(0,J.jsx)(p()._H,{...it.cancelButton})}),(0,J.jsxs)("div",{style:Ge.footerRight,children:[I&&!$e&&Ee&&(0,J.jsx)("div",{style:Ge.footerErrorCaption,children:(0,J.jsx)(p()._H,{...it.errorsFooterCaption})}),(0,J.jsx)(M().Z,{onClick:Le,onMouseEnter:De,disabled:!$e,style:Ge.footerButton,children:D?(0,J.jsx)(p()._H,{...I?it.enableButton:it.createButton}):(0,J.jsx)(p()._H,{...I?it.doneButton:it.saveButton})})]})]},"save"));const Ye=(0,a().VK)((()=>q&&ce?(0,J.jsx)(L().gJ,{automationStore:ce,children:(0,J.jsxs)(be().$,{value:{collectionStore:q,disabled:!He,editorPlacement:{type:"inline"},editorWidth:b().P4,maybePersistedTransactionActions:le,onActionAdded:We,suppressActionErrors:Z,hideDragHandle:Fe,cantSaveDueToError:Ee,...Ue},defaultCollapseActions:Fe,children:[!R&&(0,J.jsx)("div",{style:Ge.closeButtonContainer,children:(0,J.jsx)(S().Z,{onClick:Ne,style:Ge.closeButton,hoveredStyle:Ge.closeButtonHover,children:(0,c().D)(Ge.closeButtonIcon)})}),(0,J.jsx)("div",{style:Ge.header,children:(0,J.jsx)(C().ZP,{type:C().iW.Vertical,initialFocus:void 0,sections:[{key:"automation_top_input",items:(0,m().oA)([{key:"automation_name",action:()=>{},render:e=>(0,J.jsx)("div",{...e,style:Ge.nameInput,children:(0,J.jsx)(Pe,{...e,disabled:!He,autoSelectAllOnDesktop:He&&"create"===P,placeholder:ie})})},st({showActiveAutomationToggle:Ie,isPersistedStateComplete:Ze,collectionContextStore:o,canEdit:He,automationStore:ce})]),render:e=>(0,J.jsx)(j().Z,{...e,disableMobilePadding:!0,desktopStyle:{paddingTop:0,paddingBottom:0}})}]})}),(0,J.jsxs)("div",{style:Ge.wrap,children:[(0,J.jsx)(Q,{collectionStore:q,collectionSettingsStore:t,automationPermissionScope:Ae,referencesIncompatibleCollectionViewFilter:_e,requiresSubscriptionUpgrade:Fe,onDelete:Oe}),(0,J.jsx)(x().IQ,{areActionsEditable:He,areTriggersEditable:He})]})]})}):null),[q,ce,He,le,We,Z,Fe,Ue,R,Ge,Ne,Ie,Ze,o,Ee,t,Ae,_e,Oe,P,ie]);return(0,J.jsxs)(Ve().b,{handleOnDismiss:Ne,handleOnSave:Le,canSave:$e,mode:P,children:[Ye,ze]})}const lt=16;function st(e){const{showActiveAutomationToggle:t,isPersistedStateComplete:o,collectionContextStore:n,canEdit:i}=e;return{key:"automation_toggle_and_source",action:at,render:e=>(0,J.jsx)(ct,{menuListItemProps:e,showActiveAutomationToggle:t,isPersistedStateComplete:o,collectionContextStore:n,canEdit:i})}}function ct(e){const{menuListItemProps:t,showActiveAutomationToggle:o,isPersistedStateComplete:l,collectionContextStore:s,canEdit:c}=e,u=(0,p().YB)(),{isMobile:d}=(0,i().Fy)(),m=(0,i().O7)(),g=(0,ye().E)("automation_updated_error_states"),h=ut(),y=(0,r().yK)((e=>({wrap:{display:"flex",...d?{flexDirection:"column",justifyContent:"center",alignItems:"flex-start",paddingInline:12,borderBottom:`1px solid ${e.stroke.primary}`,paddingBlock:12,gap:12}:{gap:8,minHeight:24,alignItems:"center"}},toggle:{display:"flex",alignItems:"center",marginLeft:1},...h})),[d,h]),{automationStore:f}=(0,L().YC)(),v=(0,a().VK)((()=>{var e;return(null==f||null===(e=f.getOwnerStore())||void 0===e?void 0:e.getDisplayName(u))??""}),[u,f]),x="active"===(0,a().VK)((()=>(null==f?void 0:f.getStatus())??"disabled"),[f]),b=Te(),S=(0,n.useCallback)((()=>{f&&T().j3({automationStore:f,environment:m})}),[m,f]),C=(0,n.useCallback)((()=>{f&&T().$K({automationStore:f,environment:m})}),[m,f]),k=(0,a().VK)((()=>!l||(0,Ce().HH)(f)),[f,l]);return(0,J.jsxs)("div",{...t,style:y.wrap,children:[(l||g&&!x)&&o&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)("div",{style:y.toggle,children:(0,J.jsx)(ce,{automationId:f.id,automationOwner:v,isAutomationPaused:!x,onPause:S,onResume:C,disabled:k})}),(0,J.jsx)("div",{style:y.verticalDivider})]}),b?(0,J.jsx)(tt,{disabled:!c,collectionContextStore:s}):(0,J.jsx)(ot,{})]})}function ut(){const{isMobile:e}=(0,i().Fy)();return(0,r().yK)((t=>({verticalDivider:{background:t.stroke.secondary,height:16,width:1,borderRadius:1,display:e?"none":"block"}})),[e])}var dt=()=>o(636340),pt=()=>o(269853),mt=()=>o(882886);const gt=(0,p().vU)({placeholder:{id:"automations.builderModal.buttonBuilderLabelInput.placeholder",defaultMessage:"Enter a name"},loading:{id:"automations.builderModal.buttonBuilderLabelInput.loading",defaultMessage:"Loading..."}}),ht=(0,n.forwardRef)((function(e,t){let{disabled:o,buttonName:a,handleNameChange:l,handleBlur:s,handleSubmit:c,...u}=e;const d=(0,p().YB)(),{isMobile:m}=(0,i().Fy)(),g=(0,r().yK)((e=>({buttonNamePropertyInput:{marginBlockEnd:0,boxShadow:"none"},buttonNameText:{marginInlineStart:m?12:0,marginInlineEnd:m?12:18},inputOuterStyle:{background:"transparent",boxShadow:"unset"}})),[m]),h=(0,n.useCallback)((e=>{l(e)}),[l]),y=(0,n.useCallback)((e=>{s(e.target.value)}),[s]),f=(0,n.useCallback)((()=>{c(a)}),[c,a]);return(0,J.jsx)(Ie().ZP,{style:g.buttonNamePropertyInput,...u,value:a??d.formatMessage(gt.loading),onChange:h,disabled:o,ref:t,inputOuterStyle:g.inputOuterStyle,format:Ae().B.ExtraLarge,textWrapperStyle:g.buttonNameText,placeholder:d.formatMessage(gt.placeholder),onBlur:y,onSubmit:f,autoFocus:!a})}));var yt=()=>o(516463);const ft=(0,p().vU)({saveButton:{defaultMessage:"Save",id:"database.buttonProperty.saveButtonLabel"},noEditError:{defaultMessage:"You don't have full access to edit this button",id:"database.buttonProperty.noEditError"}});function vt(e){const{collectionContextStore:t,propertySchema:o}=e,i=(0,a().VK)((()=>t.collectionStore()),[t]),r=(0,a().VK)((()=>null==i?void 0:i.getSpaceId()),[i]),l=(0,n.useMemo)((()=>{const e=o.automation_id;if(e&&r)return{id:e,spaceId:r,table:u().cv}}),[o.automation_id,r]);return(0,mt().N)(i,l)?(0,J.jsx)(xt,{...e}):(0,J.jsx)(yt().Z,{})}function xt(e){const{collectionContextStore:t,collectionSettingsStore:o,propertyId:l,propertySchema:s}=e,{isMobile:u}=(0,i().Fy)(),m=(0,i().O7)(),[g,h]=(0,n.useState)([]),y=(0,a().VK)((()=>t.collectionStore()),[t]),f=(0,a().VK)((()=>null==y?void 0:y.getSpaceId()),[y]),{maybePersistedAutomationStore:v,maybePersistedTransactionActions:k}=(0,je().$)({automationId:s.automation_id,spaceId:f,defaultValue:void 0,persist:!0}),T=(0,a().VK)((()=>null==v?void 0:v.getTrigger()),[v]),w=(0,pt().C6)({automationStore:v,propertyId:l,propertySchema:s,collectionContextStore:t}),A=(0,a().VK)((()=>{var e;return"sufficient"===(null==w||null===(e=w.state)||void 0===e?void 0:e.editPermissionStatus)}),[w]),I=(0,a().VK)((()=>{var e;return!(null==w||null===(e=w.state)||void 0===e||!e.typecheckResult)&&(0,Se().A)({environment:m,typecheckResult:w.state.typecheckResult,automationStore:v})}),[w,m,v]),_=(0,a().VK)((()=>(null==v?void 0:v.getNameStore().getValue())??s.name),[v,s.name]),P=(0,a().VK)((()=>"collectionTypedView"===t.contextType),[t]),V=(0,n.useCallback)((e=>{if(!v)return;const t=e.currentTarget.value;k.createAndCommit({userAction:"ButtonBuilderModal.setName",perform:e=>{dt().sO({store:v.getNameStore(),transaction:e,value:t})}})}),[v,k]),B=(0,n.useCallback)((e=>{h((t=>[...t,e.id]))}),[]),R=(0,Me().a)(),F=function(){const{isMobile:e}=(0,i().Fy)();return(0,r().yK)((t=>({header:{backgroundColor:"transparent",borderBottom:`1px solid ${t.stroke.secondary}`,paddingBottom:8,paddingTop:jt,position:"absolute",top:0,width:`calc(100% - ${2*Mt}px)`,zIndex:d().R1,...e&&{paddingBottom:0,paddingTop:0,width:"100%"}},buttons:{backgroundColor:"dark"===t.mode?t.accentColors.gray[100]:t.white,display:"flex",gap:4,paddingBlock:`${jt}px ${Mt}px`,position:"absolute",bottom:0,width:`calc(100% - ${2*Mt}px)`,zIndex:d().R1,...e&&{paddingLeft:Mt,paddingRight:Mt,flexDirection:"column-reverse",width:"100%"}},label:{paddingTop:e?"10px":0},closeButtonContainer:{position:"absolute",top:10,right:10,zIndex:d().Ke},closeButton:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:t.buttonHoveredBackground,width:20,height:20,padding:4},closeButtonHover:{background:t.buttonPressedBackground},closeButtonIcon:{width:16,fill:t.mediumTextColor},wrap:{overflowY:"auto",overflowX:"hidden",marginTop:e?Ct:bt,marginBottom:e?kt:St,paddingInline:e?0:2,width:"100%"},desktopButtonLabelNameContainer:{paddingLeft:0,paddingRight:0,color:t.lightTextColor},mobileButtonLabelNameContainer:{paddingTop:jt,paddingBottom:4,paddingLeft:Mt,paddingRight:Mt,color:t.lightTextColor},buttonLabelNameTextWrapperStyle:{marginLeft:e?Mt:0,marginRight:e?Mt:0},footerButton:{height:32,width:"100%"},inputStyle:{background:"transparent"},inputOuterStyle:{background:"transparent"}})),[e])}(),K=(0,n.useCallback)((()=>{E().x({environment:m,collectionSettingsStore:o})}),[m,o]),Z=(0,n.useCallback)((()=>{q().y(m,{from:"button_property_automation_header_message",upsell:{type:"product",product:"plus",limit:{type:"none"}}})}),[m]);pe({shouldInvokeHandler:!0,onClick:K,isMobile:u});const O=(0,n.useCallback)((e=>{v&&k.createAndCommit({userAction:"ButtonBuilderModal.setName",perform:t=>{dt().sO({store:v.getNameStore(),transaction:t,value:e})}})}),[v,k]),N=(0,n.useMemo)((()=>y&&v&&T&&"button"===T.type?(0,J.jsx)(L().Jj,{automationStore:v,contextType:"button_property",children:(0,J.jsxs)(be().$,{value:{collectionStore:y,disabled:!A,editorPlacement:{type:"inline"},editorWidth:b().P4,maybePersistedTransactionActions:k,onActionAdded:B,suppressActionErrors:g,hideDragHandle:I,...R},defaultCollapseActions:I,children:[!u&&(0,J.jsx)("div",{style:F.closeButtonContainer,children:(0,J.jsx)(S().Z,{onClick:K,style:F.closeButton,hoveredStyle:F.closeButtonHover,children:(0,c().D)(F.closeButtonIcon)})}),(0,J.jsx)("div",{style:F.header,children:(0,J.jsx)(C().ZP,{type:C().iW.Vertical,initialFocus:void 0,sections:[{key:"automation_top_input",items:[{key:"automation_name",action:()=>{},render:e=>(0,J.jsx)(ht,{...e,disabled:P,buttonName:_,handleNameChange:V,handleBlur:O,handleSubmit:O})}],render:e=>(0,J.jsx)(j().Z,{...e,disableMobilePadding:!0,shouldShowBottomDivider:!0,desktopStyle:{paddingTop:0}})}]})}),(0,J.jsxs)("div",{style:F.wrap,children:[I&&(0,J.jsx)(D().c,{onUpsellClick:Z}),!A&&(0,J.jsx)(H().k,{children:(0,J.jsx)(p()._H,{...ft.noEditError})}),(0,J.jsx)(x().IQ,{areActionsEditable:!I,areTriggersEditable:!1})]})]})}):null),[v,_,y,P,V,K,O,A,u,k,B,F,g,T,R,I,Z]),W=u?(0,J.jsx)(n.Fragment,{}):(0,J.jsx)(j().Z,{mobileStyle:F.buttons,style:F.buttons,children:(0,J.jsx)(M().Z,{onClick:K,disabled:!A,style:F.footerButton,children:(0,J.jsx)(p()._H,{...ft.saveButton})})});return y&&v&&T&&"button"===T.type?(0,J.jsxs)(Ve().b,{handleOnDismiss:K,canSave:!0,mode:"button_property",handleOnSave:K,children:[N,W]}):null}const bt=60,St=60,Ct=60,kt=60,Mt=16,jt=12},887766:(e,t,o)=>{o.d(t,{Z:()=>d});o(667294);var n=()=>o(846550),i=()=>o(38883),a=()=>o(843403),r=()=>o(759366),l=()=>o(923398),s=()=>o(955620),c=()=>o(793041),u=o(785893);function d(e){let{handleRemoveToken:t,token:o,type:d,format:p,style:m,isDisabled:g}=e;const h=(0,s().pxR)(o).name,y=(0,n().Fg)();if(!h)return null;let f;switch(d){case"person":f=l().O;break;case"email":f=r().n;break;default:f=a().J}return(0,u.jsx)(c().ZP,{title:h,renderAvatar:e=>f({width:e,height:e,padding:2,marginRight:6}),style:{background:y.accentColors.gray[75],padding:"2px 4px",...m},showRemoveButton:Boolean(t)&&!g,onClickRemove:e=>{null==e||e.stopPropagation(),t&&t(o)},format:p??i().lo.Small,shouldShrink:!0,isSingle:!1})}},200027:(e,t,o)=>{o.d(t,{A:()=>r});o(267602),o(228244);var n=()=>o(855741),i=()=>o(696459),a=()=>o(150275);function r(e){const{environment:t,typecheckResult:o,automationStore:r}=e,l=null==r?void 0:r.getTriggerType();if((0,i().$K)(l)){if(!(0,a().n)({triggerType:l,environment:t,automationStore:r}))return!0}return!n().x.isFail(o)&&Object.values(o.value.actionValidationFailures).some((e=>null==e?void 0:e.some((e=>"requires_subscription_upgrade"===e.type))))}},309841:(e,t,o)=>{o.d(t,{GV:()=>p,TI:()=>u,yE:()=>d});o(267602),o(653476),o(241792);var n=()=>o(271896),i=()=>o(855741),a=()=>o(696459),r=()=>o(141735),l=()=>o(594546),s=()=>o(615676),c=()=>o(637118);function u(e){const{automationActionStore:t,automationStore:o,formulaAnalyticsModule:r,formulasModule:l,simpleFormulasModule:u}=e,d=t.getModel(),p=o??t.getParentStore();if(!d||!p)return;const m=p.getActionStores().map((e=>e.getModel())).filter(a().$K),g=(0,c().Ep)(p);let h=[];return g&&i().x.isSuccess(g)&&(h=g.value.valueTypes),(0,n().Bj)({automationActionModel:d,automationActionModels:m,formulaAnalyticsModule:r,formulasModule:l,simpleFormulasModule:u,formulaTypecheckContextValues:h,getRecordModel:t.getRecordModel,featureGates:(0,s().W)()})}function d(e,t){const{automationStore:o,automationActionStore:n}=t;o.isTriggerType("event")||o.isTriggerType("notification_event")||p(((t,i,a)=>{const r=u({automationActionStore:n,automationStore:o,formulaAnalyticsModule:i,formulasModule:t,simpleFormulasModule:a});r&&(0,l().A3)(e,"automation_action_update",n.id,1,{automation_action:r,automation_action_id:n.id,automation_id:o.id})}))}function p(e){return Promise.all([r().F.formulas.load(),r().F.formulaAnalytics.load(),r().F.simpleFormulas.load()]).then((t=>{let[o,n,i]=t;e(o,n,i)})).catch((e=>{console.error("Error sending analytics for automations",e)}))}},658517:(e,t,o)=>{o.d(t,{h:()=>n});o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(731107);function n(e,t){const o=e.reduce(((e,t)=>{if(t.isType("define_variables")){var o;const n=null===(o=t.getModel())||void 0===o?void 0:o.getVariables();if(n)for(const t of Object.values(n))e.add(t.name)}return e}),new Set),n=t.replace(/\s*\d+$/,"");let i=1,a=`${n} ${i}`;for(;o.has(a);)a=`${n} ${i}`,i++;return a}},492135:(e,t,o)=>{o.d(t,{a:()=>i});var n=o(667294);function i(){const[e,t]=(0,n.useState)(void 0),o=(0,n.useCallback)((e=>t(e.id)),[]),i=(0,n.useCallback)((()=>t(void 0)),[]);return(0,n.useMemo)((()=>({currentDraggingActionId:e,onActionDragStart:o,onActionDragEnd:i})),[e,i,o])}},985571:(e,t,o)=>{o.d(t,{w:()=>l});var n=o(667294),i=()=>o(855741),a=()=>o(583352),r=()=>o(637118);function l(e){const t=(0,r().DZ)();return{onTextStoreSelect:(0,n.useMemo)((()=>{if(t.defined&&i().x.isSuccess(t.typecheckResult)){const{automationStore:o,contextType:n,typecheckResult:i}=t;return function(){a().Z.focus({automationStore:o,contextType:n,typecheckResult:i.value,automationActionStore:e})}}}),[e,t]),onTextStoreUnselect:(0,n.useMemo)((()=>{if(t.defined&&i().x.isSuccess(t.typecheckResult)){const{automationStore:o,contextType:n,typecheckResult:i}=t;return function(){a().Z.blur({automationStore:o,contextType:n,typecheckResult:i.value,automationActionStore:e})}}}),[e,t])}}},918745:(e,t,o)=>{o.d(t,{F:()=>l,U:()=>r});var n=()=>o(219727),i=()=>o(142735),a=()=>o(352230);function r(e){return e.device.isPhone||"actionSheet"===e.tabletBehavior&&e.device.isTablet?{menuType:a().o.ActionSheet}:{menuType:a().o.Popup,maxHeight:e.maxHeight,maxWidth:e.maxWidth,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,width:e.width,minWidth:e.minWidth}}function l(e){const t=(0,n().Fy)();return(0,i().VK)((()=>r({device:t,maxHeight:null==e?void 0:e.maxHeight,maxWidth:null==e?void 0:e.maxWidth,paddingTop:null==e?void 0:e.paddingTop,paddingBottom:null==e?void 0:e.paddingBottom,width:null==e?void 0:e.width,minWidth:null==e?void 0:e.minWidth,tabletBehavior:null==e?void 0:e.tabletBehavior})),[t,null==e?void 0:e.maxHeight,null==e?void 0:e.maxWidth,null==e?void 0:e.paddingTop,null==e?void 0:e.paddingBottom,null==e?void 0:e.width,null==e?void 0:e.minWidth,null==e?void 0:e.tabletBehavior])}},676279:(e,t,o)=>{o.d(t,{d:()=>r});var n=()=>o(219727),i=()=>o(142735),a=()=>o(967092);function r(e){const t=(0,n().Fy)();return(0,i().VK)((()=>t.isPhone||"slideUp"===(null==e?void 0:e.tabletBehavior)&&t.isTablet?a().kQ.SlideUp:a().kQ.Popup),[t,null==e?void 0:e.tabletBehavior])}},210968:(e,t,o)=>{o.d(t,{p:()=>c});o(267602),o(653476);var n=()=>o(142735),i=()=>o(440692),a=()=>o(473304),r=()=>o(985575),l=()=>o(749826),s=()=>o(637118);function c(){const{automationStore:e,contextType:t}=(0,s().YC)(),o=(0,n().VK)((()=>(0,r().uV)(e,t)),[e,t]);return(0,n().VK)((()=>{if(!o)return[];const{automation:e,automationActions:t}=o;let n=e.getTriggerType();"notification_event"===n&&(n="event");const r=(0,a().PQ)({isGenericRecurrenceAllowed:l().default.checkGate({gateName:"automation_generalized_recurrence"})})[n],s="default_bound"===r.max?a().xZ:r.max;if(t.length>=s)return[];return function(e){const t=e=>e?1:-1;return e.slice().sort(((e,o)=>t(o.hasSideEffects)-t(e.hasSideEffects)))}((0,i().getActionRegistryItemsWithConcern)("display").filter((e=>e.isAvailableForContext({...o,isSubscribed:!0}))))}),[o])}},576447:(e,t,o)=>{o.d(t,{Z:()=>i});o(667294);var n=o(785893);const i=function(e){const{title:t,href:i,analyticsFrom:a}=e,r=(0,o(219727).O7)();return(0,n.jsx)(o(108714).Z,{href:i,onClick:()=>o(407391).Fs(r,{from:a}),external:!0,children:(0,n.jsx)(o(446955).Z,{icon:o(456681).m,title:t,isGray:!0})})}},205951:(e,t,o)=>{o.d(t,{Lm:()=>k,P4:()=>C,ZP:()=>T});var n=o(667294),i=()=>o(142735),a=()=>o(846550),r=()=>o(647439),l=()=>o(205248),s=()=>o(788860),c=()=>o(707513),u=()=>o(139224),d=()=>o(154186),p=()=>o(1910),m=()=>o(94967),g=()=>o(198829),h=()=>o(347577),y=()=>o(949842),f=()=>o(352230),v=()=>o(565276),x=()=>o(26796),b=o(785893);const S=(0,s().vU)({back:{defaultMessage:"Back",id:"collectionsSettingsMenu.back"}}),C=290,k=400;function M(e){let{children:t,title:o,settingsStackLength:n,handleClose:u,handleBackArrowClick:m,hideDesktopHeader:g,hasBackStack:h}=e;const y=(0,i().VK)((()=>x().Z.state.isOpen),[]),f=(0,s().YB)(),v=(0,a().yK)((e=>({hiddenDesktopHeaderDiv:{height:0},nonHiddenDesktopHeaderDiv:{display:"flex",alignItems:y?"top":"center",padding:y?"0px 14px 6px 14px":"14px 16px 6px 16px",height:y?void 0:42},arrowButton:{marginRight:8,marginLeft:-2,height:22},arrowIcon:{width:16,height:16},title:{flexGrow:1,fontWeight:y?c().Ue.medium:c().Ue.semibold,fontSize:y?16:14,lineHeight:y?"24px":void 0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},closeButton:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:e.buttonHoveredBackground,width:18,height:18,flexShrink:0},closeButtonHover:{background:e.buttonPressedBackground},closeIcon:{width:14,fill:e.mediumTextColor}})),[y]),C=!y;return(0,b.jsxs)(b.Fragment,{children:[g?(0,b.jsx)("div",{style:v.hiddenDesktopHeaderDiv}):(0,b.jsxs)("div",{style:v.nonHiddenDesktopHeaderDiv,children:[(n>1||h)&&(0,b.jsx)(p().Z,{icon:r().W,style:v.arrowButton,iconStyle:v.arrowIcon,onClick:m,ariaLabel:f.formatMessage(S.back)}),(0,b.jsx)("span",{style:v.title,children:o}),C&&(0,b.jsx)(d().Z,{onClick:u,style:v.closeButton,hoveredStyle:v.closeButtonHover,children:(0,l().D)(v.closeIcon)})]}),t]})}function j(e,t){let{children:a,footer:r,header:l,unconstrainedWidth:c,desktopWidth:d,title:k,collectionSettingsStore:j,fullHeight:T,hideDesktopHeader:w,menuScrollerStyle:A,innerContentWrapperStyle:I,disableScroller:_,handleBackArrowClick:P,hasBackStack:V,handleClose:B}=e;const R=(0,s().YB)(),F=(0,o(219727).Fy)(),K=(0,o(125659).DK)(),Z=(0,i().VK)((()=>x().Z.state.isOpen),[]),E=(0,o(830700).o)({collectionContextStore:K}),H=(0,o(409318).L)(),D=E&&!H,{currentTab:L,settingsStackLength:O,hideHeader:N}=(0,i().VK)((()=>{const e=j.state;return{currentTab:(0,o(642966).n)(j),settingsStackLength:e.stack.length,hideHeader:e.hideSettingsHeader}}),[j]),W=(0,n.useCallback)((()=>{var e;P?P():u().z$({collectionSettingsStore:j,keepPreviousRef:"form_editor"===(null==K||null===(e=K.collectionViewStore())||void 0===e?void 0:e.getType())})}),[P,j,K]),U=(0,n.useCallback)((e=>{B?B(e):(0,y().ZP)({event:e,context:y().Af.CollectionSettingsClick,callback:()=>{u().E3({collectionSettingsStore:j})}})}),[B,j]),G=(0,n.useCallback)((e=>{(0,v().jM)(e.target)||(0,v().eO)(e.target)||(0,v().al)(e.target)||x().Z.state.isOpen||U(e)}),[U]),{MenuArrowKeysProvider:z,context:$}=(0,o(288141).ZP)();if(!L)return null;let Y;if(F.isMobile)Y={disableScroller:_,menuType:f().o.Modal,title:k,left:O>1&&(0,b.jsx)(p().Z,{icon:o(891142).S,onClick:W,ariaLabel:R.formatMessage(S.back)}),right:!H&&(0,b.jsx)(o(470386).DoneMenuText,{}),onClickRight:U,scrollerStyle:{...D&&{maxHeight:`calc(${h().DQ} - ${h().BM})`,height:`calc(${h().DQ} - ${h().BM})`},...A},paddingTop:D?"0px":void 0,innerRef:t};else{const e=c||d?void 0:Z?280:C;Y={disableScroller:_,menuType:f().o.Popup,minWidth:Z?280:C,width:d,maxHeight:T?"100%":"80vh",...e&&{maxWidth:e},onClickOutside:G,scrollerStyle:{flexGrow:0,...A},header:!N&&(0,b.jsx)(M,{settingsStackLength:O,handleClose:U,handleBackArrowClick:W,hasBackStack:V,hideDesktopHeader:w,title:k,children:l}),paddingTop:N?6:0,footer:r,innerRef:t}}const q=(0,b.jsxs)(b.Fragment,{children:[F.isMobile&&l,a,F.isMobile&&r]});return T?(0,b.jsx)(z,{value:$,children:(0,b.jsx)(m().Z,{debugName:"CollectionSettingsMenu",capture:!0,onUp:$.onKeyDown,onDown:$.onKeyDown,children:(0,b.jsx)(g().Z,{...Y,children:q})})}):(0,b.jsx)(o(573357).Z,{capture:!0,allowMobileAutoScroll:!0,allowEsc:!0,render:e=>(0,b.jsx)(z,{value:$,children:(0,b.jsx)(m().Z,{debugName:"CollectionSettingsMenu",capture:!0,onUp:$.onKeyDown,onDown:$.onKeyDown,children:(0,b.jsx)(g().Z,{...Y,...e,children:(0,b.jsx)("div",{style:I,children:q})})})})})}const T=(0,n.forwardRef)(j)},508858:(e,t,o)=>{o.d(t,{Z:()=>p});o(267602),o(470928),o(241792);var n=o(667294),i=()=>o(142735),a=()=>o(513670),r=()=>o(448419),l=()=>o(255577),s=()=>o(967092),c=()=>o(388284),u=()=>o(352230),d=o(785893);const p=function(e){let{icon:t,iconStyle:p,title:m,selectedKey:g,onChange:h,onClick:y,popupStyle:f,menuItemOptionsStyle:v,menuStyle:x,disabled:b,collectionContextStore:S,openButtonPopup:C,hideCheck:k,children:M,disableParentClose:j,inputPlaceholder:T,...w}=e;const A=(0,o(219727).Fy)(),I="options"in w?w.options:a().xH(w.sections),_=I.find((e=>a().Xy(e.key,g))),P=(0,i().qz)(void 0,o(529048).Z),V=(0,i().Kw)(P);return(0,n.useEffect)((()=>{S&&C&&(P.setState({...P.state,open:C}),S.settingsStore.setState({...S.settingsStore.state,openButtonPopup:void 0})),_||o(799891).log({level:"error",from:"CollectionSettingsPickListMenuItem",type:"InvalidSelectedItem",error:(0,o(792409).Ui)("Selected key is invalid.")})})),(0,d.jsx)(r().ZP,{popupType:A.isMobile?s().kQ.SlideUp:s().kQ.Popup,alignmentToOrigin:r().vR.End,placementToOrigin:r().pO.Bottom,style:f,originGap:0,buttonPopupStore:P,disabled:b,onClick:y,renderOrigin:e=>(0,d.jsx)(o(446955).Z,{title:m,showChevron:!0,right:(0,d.jsx)("span",{style:o(707513).Yu,children:"input"===(null==_?void 0:_.type)?_.inputValue:null==_?void 0:_.title}),rotateChevron:V.open,disabled:b,icon:t,iconStyle:p,...(0,o(164079).Z)(e,w)}),render:e=>{let t;t=A.isMobile?{menuType:u().o.ActionSheet}:{menuType:u().o.Popup,width:250,...x};const n=(t,n)=>{if(t.hideOption)return null;let i;return i="input"===t.type?{key:n,render:n=>(0,d.jsx)(o(740046).ZP,{...n,style:{width:"100%",paddingTop:4,paddingBottom:4},value:t.inputValue??"",onChange:e=>{var o;null===(o=t.onChange)||void 0===o||o.call(t,e.target.value)},onSubmit:o=>{var n;null===(n=t.onSubmit)||void 0===n||n.call(t,t.key,e,t.inputValue),e.close()},placeholder:T,checkState:!k&&a().Xy(t.key,g)}),action:()=>{}}:{key:n,render:e=>(0,d.jsx)(o(827973).Z,{...e,disabled:!1,title:t.title,icon:t.icon,caption:t.caption,captionStyle:t.captionStyle,inline:t.captionInline,spacerStyle:t.inlineSpacerStyle,body:t.body,style:v,checkState:!k&&a().Xy(t.key,g)}),action:()=>{h(t.key,e),j||e.close()}},i},i="sections"in w?w.sections.map(((e,t)=>({key:t,render:e=>(0,d.jsx)(c().Z,{enableActionSheetTitle:!0,topBorder:t>0,...e}),items:a().oA(e.map(n))}))):[{key:0,render:e=>(0,d.jsx)(c().Z,{enableActionSheetTitle:!0,...e}),items:a().oA(I.map(n))}];return(0,d.jsxs)(o(198829).Z,{...t,children:[(0,d.jsx)(l().ZP,{type:l().iW.Vertical,sections:i,initialFocus:0,resetFocusOnMouseOut:!0}),M||null]})}})}},949719:(e,t,o)=>{o.d(t,{Z:()=>h});o(670560),o(267602),o(653476),o(241792);var n=o.n(o(443261)),i=o(667294),a=()=>o(788860),r=()=>o(513670),l=()=>o(827973),s=()=>o(255577),c=()=>o(388284),u=()=>o(951877),d=()=>o(527278),p=o(785893);const m=(0,a().vU)({inputPlaceholder:{defaultMessage:"Search for a propertyâ¦",id:"database.viewSettings.propertySelect.inputPlaceholder"},none:{defaultMessage:"None",id:"database.viewSettings.propertySelect.noneMessage"},remove:{defaultMessage:"Remove",id:"database.viewSettings.propertySelect.removeMessage"}});function g(e){let{currentProperty:t,showNoneOption:g,showRemoveOption:h,getProperties:y,onAccept:f,inputPlaceholder:v,defaultShowPropertyCount:x,schema:b,format:S,renderProperty:C}=e;const k=(0,o(219727).Fy)(),[M,j]=(0,i.useState)(""),[T,w]=(0,i.useState)(!1),A=(0,o(142735).qz)(void 0,o(692304).Z),I=(0,o(846550).yK)((e=>({icon:{width:16,fill:e.mediumTextColor,marginLeft:4,marginRight:2},menuItem:{color:e.mediumTextColor}})),[]),_=(0,o(305580).i)(S,b,void 0,o(109477).j5.Page).collection_page_properties||[],P=!x||T,V=d().Z.formatMessage(m.none),B=g?{key:"none",render:e=>(0,p.jsx)(l().Z,{...e,checkState:!t,title:V}),action:()=>{f(void 0)}}:void 0,R=h?{key:"remove",render:e=>(0,p.jsx)(l().Z,{...e,icon:(0,o(95886).y)(I.icon),title:d().Z.formatMessage(m.remove)}),action:()=>{f(void 0)}}:void 0,F=y();let K=r().MR(F,(e=>_.findIndex((t=>t.property===e))));if(M){const e=new Map;let t=K.map((t=>{const n=b[t],i=n?`${n.name} ${o(561933).SO[n.type]}`:"";return e.set(t,i),i}));t=n().filter(M,t).map((e=>{let{original:t}=e;return t})),K=K.filter((o=>t.includes(e.get(o)||"")))}else!P&&x&&(K=K.slice(0,x));const Z=r().oA([!M||n().test(M,V)?B:void 0,...K.map((e=>function(e,t,o,n,i){const a=t[e];if(!a)return;const r={key:e,render:t=>{const o=e===n;return i?i(t,e,o,a):(0,p.jsx)(u().N,{...t,propertySchema:a,format:u().L.Name,checkState:o})},action:()=>{o(e)}};return r}(e,b,f,t,C)))]);if(!P&&F.length>K.length&&!M){const e={key:"show_more",render:e=>(0,p.jsx)(l().Z,{...e,icon:(0,o(641772).o)(I.icon),style:I.menuItem,title:(0,p.jsx)(a()._H,{defaultMessage:"{moreCount} more",id:"database.viewSettings.propertySelect.showMoreTitle",values:{moreCount:F.length-K.length}})}),action:()=>{w(!0)}};Z.push(e)}const E=Z.length>0,H=Boolean(M),D=!R||E||H;D&&!E&&Z.push({action:r().ZT,key:"noResults",render:e=>(0,p.jsx)(o(178498).Z,{...e,caption:(0,p.jsx)(a()._H,{defaultMessage:"No results",id:"database.viewSettings.propertySelect.noResultsTitle"})})});const L=[];return D&&L.push({key:"input",comp:(0,p.jsx)(c().Z,{isInput:!0,children:(0,p.jsx)(o(740046).ZP,{focusInitial:!k.isMobile||void 0,focus:!k.isMobile||void 0,value:M,onChange:e=>{j(e.target.value),A.setState({...A.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}}),w(!1)},placeholder:v||d().Z.formatMessage(m.inputPlaceholder)})})}),(Z.length>0||R)&&L.push({key:"properties",comp:(0,p.jsx)(s().ZP,{type:s().iW.Vertical,initialFocus:0,sections:[...Z.length>0?[{key:"results",render:e=>(0,p.jsx)(c().Z,{...e}),items:Z}]:[],...R?[{key:"remove",render:e=>(0,p.jsx)(c().Z,{topBorder:Z.length>0,...e}),items:[R]}]:[]],store:A})}),(0,p.jsx)(p.Fragment,{children:L.map((e=>{let{key:t,comp:o}=e;return(0,p.jsx)(i.Fragment,{children:o},t)}))})}const h=i.memo(g,o(632314).Z)},830700:(e,t,o)=>{o.d(t,{o:()=>a});var n=()=>o(219727),i=()=>o(142735);function a(e){let{collectionContextStore:t}=e;const o=(0,n().O7)(),a=(0,n().MO)(),r=(0,i().VK)((()=>o.WindowSizeStore.isLandscape()),[o.WindowSizeStore]);return(0,i().VK)((()=>"chart"===(null==t?void 0:t.getViewType())&&a&&!r),[t,a,r])}},747589:(e,t,o)=>{function n(e){const{dateRangeStart:t,dateRangeEnd:o,collectionContextStore:n}=e;n.dateRangeStartStore.setState(t),n.dateRangeEndStore.setState(o)}o.d(t,{I:()=>n})},788899:(e,t,o)=>{o.d(t,{Tp:()=>g,cn:()=>u,fg:()=>p,l0:()=>d});o(667294);var n=()=>o(219727),i=()=>o(573357),a=()=>o(198829),r=()=>o(18748),l=()=>o(470386),s=()=>o(352230),c=o(785893);const u=8,d=8,p=32,m={height:p+u-2,paddingTop:u-2};function g(e){let{title:t,helpButton:o,onCancel:r,desktopMinWidth:u,desktopMaxWidth:d,desktopWidth:p,children:m}=e;const{device:g}=(0,n().O7)();return(0,c.jsx)(i().Z,{capture:!0,allowEsc:!0,allowUndo:!0,render:e=>{let n;return n=g.isMobile?{menuType:s().o.Modal,title:t,right:(0,c.jsx)(l().DoneMenuText,{}),onClickRight:r,...e}:{menuType:s().o.Popup,...u&&{minWidth:u},...d&&{maxWidth:d},...p&&{width:p},...e},(0,c.jsx)(a().Z,{...n,header:t&&(0,c.jsx)(h,{title:t,helpButton:o}),children:m})}})}function h(e){let{title:t,helpButton:o}=e;return(0,n().O7)().device.isMobile?null:(0,c.jsx)(r().ZP,{style:m,title:t,right:o})}},900596:(e,t,o)=>{o.d(t,{Z:()=>a});o(667294);var n=()=>o(788860),i=o(785893);const a=function(e){let{collectionViewName:t,collectionViewType:a}=e;return t?(0,i.jsx)(o(827618).Z,{children:t}):"page"===a?(0,i.jsx)(n()._H,{id:"database.collectionView.untitledName.untitled",defaultMessage:"Untitled"}):(0,i.jsx)(n()._H,{...o(887430).b1[a]})}},178498:(e,t,o)=>{o.d(t,{Z:()=>r});var n=o(667294),i=o(785893);function a(e,t){return(0,i.jsx)(o(18748).ZP,{...e,ref:t,style:{background:"none",borderBottom:"none",boxShadow:"",marginTop:2,marginBottom:6,paddingTop:4,paddingBottom:4,minHeight:"none",...e.style}})}const r=(0,n.forwardRef)(a)},687626:(e,t,o)=>{o.d(t,{Z:()=>d});var n=o(667294),i=()=>o(568017),a=()=>o(696459),r=o(785893);function l(e,t){switch(e){case"primary":return{background:i().ZP.frontBlueButtonBackground,boxShadow:t.buttonBoxShadow,color:"white"};case"secondary":return{background:i().ZP.frontSecondaryButtonBackground,boxShadow:`\n\t\t\t\t\t0 1px 2px rgba(15, 15, 15, 0.1),\n\t\t\t\t\tinset 0 0 0 1px ${i().ZP.redWithAlpha(.3)}`,color:i().ZP.red};case"tertiary":case"aiTertiary":return{background:i().ZP.white,color:i().ZP.frontTextDark,border:"1px solid rgba(15, 15, 15, 0.15)",width:"100%",boxShadow:"0 1px 2px rgba(15, 15, 15, 0.05)"};case"quaternary":return{background:i().ZP.frontQuaternaryButtonBackground,border:`1px solid ${i().ZP.frontQuaternaryButtonBorder}`,boxShadow:"0 1px 2px rgba(15, 15, 15, 0.1)",color:"white"};case"aiPrimary":return{background:"#CA59FF",color:"white"};case"lightGray":return{background:t.tint.regular,color:t.text.secondary};default:(0,a().t1)(e)}}function s(e,t){switch(e){case"primary":return{background:i().ZP.frontBlueButtonHoveredBackground};case"secondary":return{background:i().ZP.frontSecondaryButtonBackgroundHovered};case"tertiary":return{background:"light"===t.mode?t.buttonHoveredBackground:i().ZP.whiteWithAlpha(.8)};case"quaternary":return{background:i().ZP.frontQuaternaryButtonBackgroundHovered};case"aiPrimary":case"aiTertiary":return{background:"#C592DD"};case"lightGray":return{background:t.tint.regular,color:t.text.primary};default:(0,a().t1)(e)}}function c(e,t){switch(e){case"primary":return{background:i().ZP.frontBlueButtonPressedBackground};case"secondary":return{background:t.buttonPressedBackground};case"tertiary":return{background:"light"===t.mode?t.buttonPressedBackground:i().ZP.whiteWithAlpha(.85)};case"quaternary":return{background:i().ZP.frontQuaternaryButtonBackgroundPressed};case"aiPrimary":case"aiTertiary":return{background:"#946EA6"};case"lightGray":return{background:t.state.pressed,color:t.text.primary};default:(0,a().t1)(e)}}function u(e,t){const{id:n,children:i,disabledFeedback:a,isFullWidth:u,isLoading:d,onClick:p,style:m,variant:g,...h}=e,y=(0,o(846550).Fg)(),f={display:"inline-grid",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",height:36,borderRadius:4,fontSize:14,lineHeight:1,paddingLeft:12,paddingRight:12,fontWeight:o(707513).Ue.medium,...d&&{gridTemplateColumns:"1fr auto 1fr"},transition:"background-color color 150ms ease"};return(0,r.jsx)(o(154186).Z,{ref:t,id:n,onClick:p,style:{...f,...l(g,y),...m,...u&&{width:"100%",justifyContent:"center"}},hoveredStyle:s(g,y),pressedStyle:c(g,y),loadingSpinnerStyle:{marginLeft:"auto"},isLoading:d,disabledFeedback:a,...h,children:(0,r.jsx)("div",{style:{display:"flex",alignItems:"center",textAlign:"center",justifyContent:"center"},children:i})})}const d=n.memo(n.forwardRef(u),o(632314).Z)},34683:(e,t,o)=>{o.d(t,{g:()=>S});var n=o(667294),i=()=>o(219727),a=()=>o(846550),r=()=>o(641772),l=()=>o(519454),s=()=>o(788860),c=()=>o(568017),u=()=>o(145990),d=()=>o(998901),p=()=>o(35982),m=()=>o(826955),g=()=>o(154186),h=()=>o(448419),y=()=>o(1910),f=()=>o(733518),v=()=>o(54782),x=()=>o(710706),b=o(785893);function S(e){const{height:t,padding:o,padding_top:S,iframe_url:C,hoverData:k,store:M,token:j,href:T,onDismiss:w}=e,A=(0,s().vU)({editLink:{defaultMessage:"Edit link",id:"hoverPreviewOverlay.editLink"}}),I=(0,i().O7)(),_=(0,s().YB)(),P=(0,n.useRef)(null),V=(0,a().yK)((e=>({content:{width:340,height:"100%",aspectRatio:"auto",position:"relative"},container:{width:340,maxHeight:420,flexDirection:"column",alignItems:"flex-start"},buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:4,fill:e.lightIconColor,background:(0,x().M1)(I)}})),[I]),B=M&&M.recordStoreUIParentStore&&M.recordStoreUIParentStore instanceof m().G?M.recordStoreUIParentStore:M instanceof m().G?M:void 0;return(0,b.jsxs)("div",{style:V.container,children:[e.showEditButton&&(0,b.jsx)(y().Z,{onClick:e.handleEditClick,icon:l().R,isDarkIconColor:!0,ariaLabel:_.formatMessage(A.editLink),hasBackground:!0,style:{position:"absolute",top:8,right:8,zIndex:1}}),j&&B&&k&&(0,b.jsx)("div",{style:{position:"absolute",top:8,right:8,zIndex:2},children:(0,b.jsx)(h().ZP,{popupType:h().Z4.Popup,placementToOrigin:d().Placement.Right,alignmentToOrigin:d().Alignment.Start,originGap:4,onClose:()=>{let e=!1;const t=P.current;t&&(e=(0,p().uh)(t.getBoundingClientRect(),u().IL.x,u().IL.y)),e||null==w||w()},renderOrigin:e=>(0,b.jsx)(g().Z,{style:V.buttonStyle,...e,children:(0,r().o)({width:14,fill:c().ZP.white})}),render:e=>(0,b.jsx)(v().Z,{parentBlockStore:B,store:M,token:j,href:T,hoverData:k,onAccept:()=>e.close()})})}),(0,b.jsx)(f().Z,{source:C,style:V.content,preserveScale:!!(t&&t<1||o),background:!1,height:t&&t>0?t:void 0,aspectRatio:o?o/100:.75,paddingTop:S||void 0})]})}},863406:(e,t,o)=>{o.d(t,{Y:()=>_});var n=o(667294),i=()=>o(492788),a=()=>o(219727),r=()=>o(846550),l=()=>o(524052),s=()=>o(641772),c=()=>o(237874),u=()=>o(519454),d=()=>o(788860),p=()=>o(568017),m=()=>o(707513),g=()=>o(959137),h=()=>o(145990),y=()=>o(641506),f=()=>o(998901),v=()=>o(35982),x=()=>o(826955),b=()=>o(154186),S=()=>o(448419),C=()=>o(643051),k=()=>o(1910),M=()=>o(518242),j=()=>o(668001),T=()=>o(251932),w=()=>o(54782),A=()=>o(710706),I=o(785893);function _(e){const t=(0,a().O7)(),{hoverData:o,href:_,handleEditClick:P,showEditButton:V,loading:B,store:R,token:F,onDismiss:K}=e,Z=(0,r().yK)((e=>({newWrapper:{width:280,flexDirection:"column",alignItems:"flex-start"},coverContainer:{width:280,height:120},pageTitle:{display:"inline",fontWeight:m().Ue.semibold,color:e.text.primary,fontSize:13,lineHeight:1.15},highlightedBlockWrapper:{display:"flex",marginBottom:8},contentNew:{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:"12px 16px",gap:12,width:280},titleAndDescription:{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:0,gap:2,width:248},linkTitle:{...(0,y().pd)(2),fontStyle:"normal",fontWeight:m().Ue.semibold,fontSize:14,letterSpacing:-.154,lineHeight:"143%",fontFeatureSettings:"'case' on",textOverflow:"ellipsis",color:e.regularTextColor},newDescription:{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:0,...(0,y().pd)(3),textOverflow:"ellipsis",width:248},newText:{fontSize:12,fontWeight:400,whiteSpace:"normal",wordBreak:"break-word",color:e.regularTextColor},buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:4,fill:e.lightIconColor,background:o?(0,A().M1)(t):"dark"===e.mode?e.accentColors.gray[100]:e.buttonBackground,border:o?void 0:"1px solid var(--Stroke-Deemphasized, rgba(227, 226, 224, 0.50))"},iconBoxImageStyle:{margin:1}})),[t,o]),E=(0,d().YB)(),H=(0,n.useRef)(null),D=(0,d().vU)({copyLink:{defaultMessage:"Copy link",id:"hoverPreviewOverlay.copyLink"},editLink:{defaultMessage:"Edit link",id:"hoverPreviewOverlay.editLink"}}),L=(0,n.useCallback)((async()=>{await i().default.afterNextFlush();const e=await g().F.clipboardActions.load(),o=e.clipboardMessages.copiedLinkToClipboard,n=_;e.copyString({environment:t,stringValue:n,copiedMessage:o})}),[t,_]),O=R&&R.recordStoreUIParentStore&&R.recordStoreUIParentStore instanceof x().G?R.recordStoreUIParentStore:R instanceof x().G?R:void 0,N=(null==o?void 0:o.thumbnail_url)??((null==o?void 0:o.images)&&o.images.length>0&&o.images[0].url);return(0,I.jsxs)(T().Ht,{style:Z.newWrapper,children:[V&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(k().Z,{onClick:L,icon:l().U,isDarkIconColor:!0,ariaLabel:E.formatMessage(D.copyLink),hasBackground:!0,style:{position:"absolute",top:8,right:8}}),(0,I.jsx)(k().Z,{onClick:P,icon:u().R,isDarkIconColor:!0,ariaLabel:E.formatMessage(D.editLink),hasBackground:!0,style:{position:"absolute",top:8,right:35}})]}),F&&O&&!V&&(0,I.jsx)("div",{style:{position:"absolute",top:8,right:8},children:(0,I.jsx)(S().ZP,{popupType:S().Z4.Popup,placementToOrigin:f().Placement.Right,alignmentToOrigin:f().Alignment.Start,originGap:4,onClose:()=>{let e=!1;const t=H.current;t&&(e=(0,v().uh)(t.getBoundingClientRect(),h().IL.x,h().IL.y)),e||null==K||K()},renderOrigin:e=>(0,I.jsx)(b().Z,{style:Z.buttonStyle,...e,children:(0,s().o)({width:14,fill:o?p().ZP.white:p().ZP.uiGray})}),render:e=>(0,I.jsx)(w().Z,{parentBlockStore:O,store:R,token:F,href:_,hoverData:o,onAccept:()=>e.close()})})}),N&&(0,I.jsx)(T().gq,{style:Z.coverContainer,children:(0,I.jsx)(M().ZP,{src:N,style:{width:"100%",height:"100%",left:0,top:"calc(50% - 280px/2)"}})}),(0,I.jsxs)(T().Ht,{style:Z.contentNew,children:[((null==o?void 0:o.title)||(null==o?void 0:o.description))&&(0,I.jsxs)(T().Ht,{style:Z.titleAndDescription,children:[(null==o?void 0:o.title)&&(0,I.jsx)(T().gq,{gap:2,children:(0,I.jsx)("div",{style:Z.linkTitle,children:null==o?void 0:o.title})}),(null==o?void 0:o.description)&&(0,I.jsx)(T().gq,{gap:2,children:(0,I.jsx)("div",{style:Z.newDescription,children:(0,I.jsx)("div",{spellCheck:!1,style:Z.newText,children:(0,I.jsx)("div",{children:null==o?void 0:o.description})})})})]}),B?(0,I.jsx)(j().Z,{style:{width:200,height:16}}):(0,I.jsxs)(T().gq,{alignItems:"left",style:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4,width:205,height:16},children:[null!=o&&o.favicon_url?(0,I.jsx)(C().Z,{type:"image_url",imageURL:null==o?void 0:o.favicon_url,size:16,style:Z.iconBoxImageStyle}):null!=o&&o.icon_url?(0,I.jsx)(C().Z,{type:"image_url",imageURL:null==o?void 0:o.icon_url,size:16,style:Z.iconBoxImageStyle}):(0,I.jsx)(k().Z,{icon:c().N,isDarkIconColor:!0,disabled:!0}),(0,I.jsx)("div",{style:{flexGrow:0,fontWeight:m().Ue.medium,color:"#787774",fontSize:12,...m().Yu},children:(null==o?void 0:o.provider_name)||(null==o?void 0:o.link_provider)||_})]})]})]})}},54782:(e,t,o)=>{o.d(t,{Z:()=>x});o(670560),o(667294);var n=()=>o(219727),i=()=>o(156642),a=()=>o(524052),r=()=>o(781391),l=()=>o(955620),s=()=>o(788860),c=()=>o(551771),u=()=>o(959137),d=()=>o(636340),p=()=>o(269299),m=()=>o(352230),g=()=>o(855238),h=()=>o(198829),y=()=>o(255577),f=()=>o(388284),v=o(785893);function x(e){const{store:t,parentBlockStore:o,onAccept:x,token:b,href:S,hoverData:C}=e,k=(0,n().O7)(),M=[];return M.push({key:0,render:e=>(0,v.jsx)(f().Z,{...e,style:{paddingTop:0,paddingBottom:0}}),items:[{key:"copy link",render:e=>(0,v.jsx)(g().Z,{...e,title:(0,v.jsx)(s()._H,{id:"linkMention.copyLink",defaultMessage:"Copy Link"}),svg:a().U}),action:async()=>{if(!t)return;if(!b)return;const e=await u().F.clipboardActions.load(),o=e.clipboardMessages.copiedLinkToClipboard,n=S;e.copyString({environment:k,stringValue:n,copiedMessage:o})}}]}),M.push({key:1,render:e=>(0,v.jsx)(f().Z,{...e,style:{paddingTop:0,paddingBottom:0}}),items:[{key:"convert to bookmark",render:e=>(0,v.jsx)(g().Z,{...e,title:(0,v.jsx)(s()._H,{id:"linkMention.convertToBookmark",defaultMessage:"Turn into preview"}),svg:r().z}),action:()=>{t&&b&&p().createAndCommit({userAction:"LinkMentionMenu.convertToBookmark",environment:k,canUndo:!0,perform:e=>{if(C){const n=d().j4({environment:k,type:i().Ti.bookmark,inMemoryRecordCache:t.inMemoryRecordCache,properties:{title:C&&C.title?l().TPx(C.title):l().TPx(S),link:l().TPx(S),description:C&&C.description?l().TPx(C.description):void 0},format:{bookmark_cover:C.thumbnail_url,bookmark_icon:C.favicon_url?C.favicon_url:C.icon_url},transaction:e,spaceId:t.pointer.spaceId});c().e1({environment:k,parentBlockStore:o,blockStore:n,token:b,transaction:e})}else{const n=d().j4({environment:k,type:i().Ti.bookmark,inMemoryRecordCache:t.inMemoryRecordCache,properties:{title:l().TPx(S),link:l().TPx(S)},transaction:e,spaceId:t.pointer.spaceId});c().e1({environment:k,parentBlockStore:o,blockStore:n,token:b,transaction:e})}}})}}]}),(0,v.jsx)(h().Z,{menuType:m().o.Popup,children:(0,v.jsx)(y().ZP,{type:y().iW.Vertical,initialFocus:void 0,onAccept:x,sections:M,style:{paddingTop:3,paddingBottom:3}})})}},951877:(e,t,o)=>{o.d(t,{L:()=>c,N:()=>u});o(667294);var n=()=>o(219727),i=()=>o(846550),a=()=>o(766933),r=()=>o(561933),l=()=>o(827973),s=o(785893);let c=function(e){return e[e.Name=0]="Name",e[e.Type=1]="Type",e}({});function u(e){const{propertySchema:t,format:o,locked:u}=e,d=(0,i().Fg)(),p=(0,n().O7)(),{name:m,type:g,icon:h}=t,y=o===c.Name?m:r().SO[g];return(0,s.jsx)(l().Z,{title:y,icon:(0,s.jsx)(a().ZP,{icon:h,type:g,size:p.device.isMobile?18:16,theme:d,style:{fill:d.regularIconColor,marginLeft:6,marginRight:2}}),disabled:u,...e})}},360197:(e,t,o)=>{o.d(t,{Z:()=>g});o(267602),o(653476),o(241792),o(228244);var n=o.n(o(443261)),i=o(667294),a=()=>o(226413),r=()=>o(532850),l=()=>o(788860),s=()=>o(513670),c=()=>o(352230),u=()=>o(255577),d=()=>o(388284),p=()=>o(951877),m=o(785893);const g=function(e){let{selectedProperty:t,onAccept:g,schema:h,onClose:y,allowProperty:f,isRelationProperty:v}=e;const x=(0,o(219727).O7)(),b=(0,l().YB)(),[S,C]=(0,i.useState)("");let k=Object.keys(h);const M=k.some(o(15607).w);k=s().MR(k,(e=>{const t=(0,r().Qm)({schema:h,property:e});return t?t.name:""}));const j=M?a().bf:a().iw;if(k=s().zu(k,j),k.unshift(j),f&&(k=k.filter((e=>{const t=(0,r().Qm)({schema:h,property:e});return t&&f(t)}))),S){let e=k.map((e=>{const t=(0,r().Qm)({schema:h,property:e});return t&&t.name}));e=n().filter(S,e).map((e=>{let{original:t}=e;return t})),k=k.filter((t=>{const o=(0,r().Qm)({schema:h,property:t});return o&&o.name&&e.includes(o.name)}))}const T=S||k.length>o(347577).nt,w=s().oA(k.map((e=>{const o=(0,r().Qm)({schema:h,property:e});if(!o)return null;return{key:e,render:n=>(0,m.jsx)(p().N,{...n,propertySchema:o,format:p().L.Name,checkState:e===t}),action:()=>g(e)}}))),A=[{key:0,render:e=>(0,m.jsx)(d().Z,{...e}),items:w}],{device:I}=x,_=T?(0,m.jsx)(d().Z,{isInput:!0,children:(0,m.jsx)(o(740046).ZP,{focus:!I.isMobile||void 0,focusAfterAnimation:!0,value:S,onChange:e=>C(e.target.value),placeholder:v?b.formatMessage({defaultMessage:"Search for a relation propertyâ¦",id:"propertySelectMenu.searchForProperty.relation.placeholder"}):b.formatMessage({defaultMessage:"Search for a propertyâ¦",id:"propertySelectMenu.searchForProperty.default.placeholder"})})}):null;let P;return P=I.isMobile?{menuType:c().o.Modal,title:v?b.formatMessage({defaultMessage:"Relation property",id:"propertySelectMenu.mobileMenu.relationProperty.header"}):b.formatMessage({defaultMessage:"Property",id:"propertySelectMenu.mobileMenu.property.header"}),right:(0,m.jsx)(o(470386).CancelMenuText,{}),onClickRight:y,header:_}:{menuType:c().o.Popup,width:280,maxHeight:480,header:_},(0,m.jsx)(o(198829).Z,{...P,children:0===w.length?(0,m.jsx)(d().Z,{children:(0,m.jsx)(o(838367).Z,{title:(0,m.jsx)(l()._H,{defaultMessage:"No results",id:"propertySelectMenu.search.noResults.title"})})}):(0,m.jsx)(u().ZP,{type:u().iW.Vertical,sections:A,onAccept:y,initialFocus:S.length>0?0:void 0})})}},697475:(e,t,o)=>{o.d(t,{Z:()=>r});o(667294);var n=()=>o(788860),i=()=>o(951877),a=o(785893);const r=function(e){const t=(0,o(219727).O7)(),{device:r}=t;if(r.isMobile)return e.propertySchema?(0,a.jsx)(i().N,{propertySchema:e.propertySchema,onClick:e.onClick,focused:!1,format:i().L.Name,showExtensionArrow:!e.disabled}):(0,a.jsx)(o(827973).Z,{focused:!1,title:(0,a.jsx)(n()._H,{defaultMessage:"Property",id:"database.mobileFilterAndSortMenu.property.buttonMenuItem.label"})});{const t=e.propertySchema&&(0,a.jsx)(o(899316).ZP,{propertySchema:e.propertySchema,showIcon:!0,style:{lineHeight:1.4}}),i=(0,a.jsx)(n()._H,{defaultMessage:"Property",id:"database.filterAndSortMenu.propertyButton.label"});return(0,a.jsx)(o(960647).Z,{title:t,placeholder:i,onClick:e.onClick,disabled:e.disabled,disableMargins:e.disableMargins,desktopStyle:e.textWrapperStyle})}}},539245:(e,t,o)=>{o.d(t,{Qr:()=>s,ZP:()=>c,pQ:()=>l});o(241792);var n=o(667294),i=()=>o(352230),a=o(785893);function r(e){let{tabs:t,selectedIndex:r,onChange:c,separatorIndexes:u,right:d,style:p,rightStyle:m,tabStyle:g,tabTitleStyle:h,selectedTabTitleStyle:y,tabBorderStyle:f,selectedTabStyle:v,readOnly:x,hideTabBorder:b,idPrefix:S}=e;const C=(0,n.useContext)(i().p),{device:k,WindowSizeStore:M}=(0,o(219727).O7)(),{safePaddingLeft:j,safePaddingRight:T}=(0,o(142735).VK)((()=>({safePaddingLeft:M.getSafePaddingLeftCSS(16),safePaddingRight:M.getSafePaddingRightCSS(16)})),[M]),w=(0,o(846550).yK)((e=>{const t={paddingTop:6,paddingBottom:6,whiteSpace:"nowrap",minWidth:0,flexShrink:0,color:e.mediumTextColor,...g},o=`inset 0 -1px 0 ${e.regularDividerColor}`,n=C.menuType===i().o.Popup,a={fontSize:16,paddingTop:2,paddingLeft:n?16:j,paddingRight:n?16:T,zIndex:2,height:44,background:e.popoverBackground};return{container:{overflowY:"visible",overflowX:"auto",display:"flex",width:"100%",position:"relative",boxShadow:b?void 0:o,...k.isMobile?a:{fontSize:14,paddingLeft:8,paddingRight:8,zIndex:1},...p},separator:{display:"inline-flex",alignItems:"center",margin:"0 4px",paddingBottom:4,whiteSpace:"nowrap",minWidth:0,flexShrink:0,color:e.regularDividerColor},mobile:{},tab:t,selectedTab:{...t,position:"relative",color:e.regularTextColor,...v},border:{borderBottom:`2px solid ${e.regularTextColor}`,position:"absolute",bottom:0,left:8,right:8,...f},rightContainer:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"flex-end",color:e.mediumTextColor,...m}}}),[C.menuType,k.isMobile,m,j,T,v,p,f,g,b]);return(0,a.jsxs)("div",{className:"hide-scrollbar",style:w.container,role:"tablist",children:[t.map(((e,t)=>{const i=t===r;return(0,a.jsxs)(n.Fragment,{children:[(0,a.jsxs)("div",{style:i?w.selectedTab:w.tab,children:[(0,a.jsx)(o(265640).D,{style:{...h,...i?y:{}},onClick:()=>c(t),disabled:x,mobileFeedback:k.isMobile,isLightGray:!Boolean(i),role:"tab","aria-selected":i,id:l(S,t),"aria-controls":s(S,t),children:e}),i&&(0,a.jsx)("div",{style:w.border})]},`tabButton-${t}`),u&&u.includes(t)&&(0,a.jsx)("div",{style:w.separator,className:"notranslate",children:"|"},`${t}-separator`)]},t)})),d&&(0,a.jsx)("div",{style:w.rightContainer,children:d})]})}function l(e,t){if(e)return`${e}-tab-${t}`}function s(e,t){if(e)return`${e}-tabpanel-${t}`}const c=n.memo(r)},307473:(e,t,o)=>{o.d(t,{e:()=>k});o(667294);var n=()=>o(219727),i=()=>o(142735),a=()=>o(846550),r=()=>o(907874),l=()=>o(707513),s=()=>o(790819),c=()=>o(466970),u=()=>o(529048),d=()=>o(448419),p=()=>o(967092),m=()=>o(209956),g=()=>o(98235),h=(o(241792),()=>o(788860)),y=()=>o(696459),f=()=>o(3425),v=()=>o(214206),x=()=>o(815325),b=o(785893);function S(e){const{context:t,currentSimpleFormulaValueTokens:o,disabled:n,formulaTypecheckContextValues:i,parentRecordStore:r,placeholder:l,spaceId:s,type:c,value:u}=e,d=(0,a().yK)((()=>({tokenWrap:{display:"flex",alignItems:"center",flexGrow:1,overflow:"hidden",marginTop:6}})),[]),p=(0,v().Mv)(t);if("formula"===(null==u?void 0:u.type)&&u.value)return(0,b.jsx)(f().I,{formulaTypecheckContextValues:i??[],parentRecordStore:r,spaceId:s,value:u});if("text"===c.type||"number"===c.type)return null;if("date"===c.type||"select"===c.type||"checkbox"===c.type){const e=o[0];return void 0===e?(0,b.jsx)(C,{placeholder:l}):(0,b.jsx)("div",{style:d.tokenWrap,children:(0,b.jsx)(g().K,{token:e,parentRecordStore:r,disabled:n,currentSimpleFormulaValueTokens:o,context:t})})}return"person_array"===c.type||"block_array"===c.type||"select_array"===c.type?0===o.length?(0,b.jsx)(C,{placeholder:l}):(0,b.jsx)("div",{style:d.tokenWrap,children:p(o,"first").map(((e,i)=>(0,b.jsx)(g().K,{token:e,parentRecordStore:r,disabled:n,currentSimpleFormulaValueTokens:o,context:t},i)))}):void(0,y().t1)(c)}function C(e){const{placeholder:t}=e,o=(0,a().yK)((e=>({placeholderText:{color:e.lightTextColor}})),[]);return(0,b.jsx)("div",{style:o.placeholderText,children:t?(0,b.jsx)(h()._H,{defaultMessage:"{placeholder}",values:{placeholder:t},id:"formulas.SimpleFormulaValuePicker.people.customPlaceholder"}):(0,b.jsx)(h()._H,{...x().s.personSelect})})}function k(e){const{allowedReturnTypes:t,disabled:o,disableEmojiCommands:h,disableFormattingAndMentions:y,disableMobileActionBar:f,disableTemplateVariableMentions:v,errorMessage:x,formulaTypecheckContextValues:C,limit:k,menuProps:M,onChange:j,parentRecordStore:T,placeholder:w,showClearButton:A,showInputMenuItem:I,simpleFormulaContext:_,spaceId:P,style:V,type:B,value:R}=e,F=(0,n().Fy)(),K=!R||"simple"===R.type,Z=(0,i().VK)((()=>(0,r().fromSimpleFormulaArrayValue)(null==R?void 0:R.value)),[R]),E=(0,c().E)("collections_xws"),H=(0,a().yK)((e=>({button:{boxShadow:e.inputBoxShadow,flexGrow:1,flexShrink:1,fontSize:"inherit",fontWeight:l().Ue.regular,...V}})),[V]),D=(0,i().qz)(void 0,u().Z),L=E?"cross_space_and_read_permissions":"read_permissions_only";return(0,b.jsx)(d().ZP,{alignmentToOrigin:d().vR.End,buttonPopupStore:D,disabled:o,originGap:0,placementToOrigin:d().pO.Bottom,popupType:F.isMobile?p().kQ.SlideUp:p().kQ.Popup,renderOrigin:e=>(0,b.jsx)(s().S,{...e,disabled:o,hasActionRequired:!Boolean(Z.length>0),isError:Boolean(x),style:H.button,tooltipMessage:x,dropdownButtonType:"button",children:(0,b.jsx)(S,{currentSimpleFormulaValueTokens:Z,context:_,disabled:!0,formulaTypecheckContextValues:C,parentRecordStore:T,placeholder:w,spaceId:P,type:B,value:R})}),render:e=>K?(0,b.jsx)(g().a,{currentSimpleFormulaValueTokens:Z,disableEmojiCommands:h,disableFormattingAndMentions:y,disableMobileActionBar:f,disableTemplateVariableMentions:v,formulaTypecheckContextValues:C,formulaValueContext:_,limit:k,menuProps:M,onChange:j,onClose:e.close,parentRecordStore:T,showClearButton:A,showInputMenuItem:I,type:B,value:R}):(0,b.jsx)(m().Z,{allowedReturnTypes:t,disabled:o,formulaTypecheckContextValues:C,onChange:j,onClose:e.close,parentRecordStore:T,restrictUnaccessibleProperties:L,spaceId:P,value:R})})}},98235:(e,t,o)=>{o.d(t,{a:()=>_e,K:()=>j});o(267602),o(470928);var n=o(667294),i=()=>o(219727),a=()=>o(142735),r=()=>o(226413),l=()=>o(532850),s=()=>o(38883),c=()=>o(177634),u=()=>o(907874),d=()=>o(955620),p=()=>o(855741),m=()=>o(696459),g=()=>o(253783),h=()=>o(887766),y=()=>o(96735),f=()=>o(637118),v=()=>o(715139),x=()=>o(308252),b=()=>o(328094),S=()=>o(246471),C=()=>o(772265),k=()=>o(214206),M=o(785893);function j(e){const{token:t,disabled:o,setCurrentTokens:n,currentSimpleFormulaValueTokens:j,context:T,parentRecordStore:w}=e,A=(0,i().Fy)(),{typecheckResult:I}=(0,f().DZ)(),_=(0,a().VK)((()=>{if("collection"===T.type)return(0,k()._7)(T)}),[T]),P=(0,a().VK)((()=>{if("collection"===T.type)return T.collectionStore.getSchema()[T.property]}),[T]);if("string"==typeof t){if(!P||!(0,r().t)(P))return null;const e=(0,l().i7)((null==P?void 0:P.options)??[],t);if(!e)return(0,M.jsx)(g().Z,{isSingle:!1,showRemoveButton:!o,onClickRemove:()=>{null==n||n((0,u().simpleFormulaValueWithoutToken)(j,t))}},`deleted_option_value_${t}`);const i={value:e.value,color:e.color,isSingle:!1,showRemoveButton:!o,format:A.isMobile?s().lo.Medium:s().lo.Small,onClickRemove:()=>{null==n||n((0,u().simpleFormulaValueWithoutToken)(j,t))}};if((0,r().gB)(P)){var V;const t=null===(V=P.groups)||void 0===V||null===(V=V.find((t=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)})))||void 0===V?void 0:V.color;return(0,M.jsx)(S().F,{...i,groupColor:t})}return(0,M.jsx)(S().a,{...i})}if("boolean"==typeof t)return(0,M.jsx)(v().Z,{checked:t,disabled:!0,size:16,checkSize:12,style:{marginBottom:6}},t.toString());if((0,d().IWo)(t))return(0,M.jsx)(y().Z,{handleRemoveToken:o?void 0:()=>{null==n||n((0,u().simpleFormulaValueWithoutToken)(j,t))},token:t});if((0,d().wjk)(t)){const e=(0,d().vmO)(t).id,i=I&&p().x.isSuccess(I)?(0,c().vx)(I.value.valueTypes,e):void 0;return i?(0,M.jsx)(C().F,{value:i,format:s().lo.Small,isSingle:!1,shouldShrink:!0,showRemoveButton:!o,onClickRemove:()=>{null==n||n((0,u().simpleFormulaValueWithoutToken)(j,t))},style:{margin:"0 6px 6px 0"}}):null}if((0,d().fpG)(t)){const e=j[0],t=e&&(0,u().isAnnotationSimpleValueToken)(e)&&(0,d().fpG)(e)?(0,d().zyO)(e):void 0;return t&&_?(0,M.jsx)(x().Z,{value:t,dateFormat:_.dateFormat,timeFormat:_.timeFormat,style:{marginBottom:6}}):null}if((0,d().STW)(t)){const e=(0,d().TOT)(t);return e?(0,M.jsx)(b().Z,{format:A.isMobile?s().lo.Medium:s().lo.Small,blockId:e,shouldWrap:!1,shouldShrink:!0,isSingle:!1,parentStore:w,showRemoveButton:!o,relationPropertySchema:void 0,onClickRemove:()=>{null==n||n((0,u().simpleFormulaValueWithoutToken)(j,t))}},e):null}if((0,d().Lyt)(t))return(0,M.jsx)(h().Z,{token:t});(0,m().t1)(t)}o(492176),o(7961);var T=()=>o(583352),w=()=>o(590259);function A(){const e=(0,f().DZ)(),{menuStore:t}=(0,n.useContext)(w().z),{automationActionId:o,insertionPoint:i}=(0,a().VK)((()=>{const e=null==t?void 0:t.getCurrentTab();return{automationActionId:"eventActionProperty"===(null==e?void 0:e.type)?e.actionId:void 0,insertionPoint:null==t?void 0:t.getInsertionPoint()}}),[t]),r=(0,a().VK)((()=>{var t;return o?null===(t=e.automationStore)||void 0===t?void 0:t.findActionStoreById(o):function(e,t){if(!e)return;const o=e.getActionIds(),n=e.getActionStores();if(!t)return;if("beforeActionId"in t){const e=o.indexOf(t.beforeActionId)-1;return e<=0?n.at(0):n.at(e)}if("afterActionId"in t){const e=o.indexOf(t.afterActionId);if(-1===e)return;return n.at(e+1)}(0,m().t1)(t)}(e.automationStore,i)}),[o,i,e.automationStore]);(0,n.useEffect)((()=>{if(e.defined&&p().x.isSuccess(e.typecheckResult)){const{automationStore:t,contextType:o,typecheckResult:n}=e;return T().Z.focus({automationStore:t,contextType:o,typecheckResult:n.value,automationActionStore:r}),function(){T().Z.blur({automationStore:t,contextType:o,typecheckResult:n.value,automationActionStore:r})}}}),[r,e])}var I=()=>o(466970),_=()=>o(876822),P=()=>o(209956),V=()=>o(311281),B=()=>o(44317),R=()=>o(749515),F=(o(670560),o(241792),()=>o(846550)),K=()=>o(568017),Z=(o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(653476),o(731107),()=>o(492788)),E=()=>o(92960),H=()=>o(619186),D=()=>o(788860),L=()=>o(513670),O=()=>o(815325),N=()=>o(836),W=()=>o(122671),U=()=>o(692304),G=()=>o(188301);function z(e){let{disabled:t,handleRemoveToken:o,propertySchema:a,token:c}=e;const u=(0,i().Fy)(),d=(0,n.useCallback)((()=>{o&&o(c)}),[o,c]);if("string"!=typeof c||!a||!(0,r().t)(a))return null;const p=(0,l().i7)((null==a?void 0:a.options)??[],c);if(!p)return(0,M.jsx)(g().Z,{isSingle:!1,showRemoveButton:!t,onClickRemove:d},`deleted_option_value_${c}`);if((0,r().gB)(a)){var m;const e=null===(m=a.groups)||void 0===m||null===(m=m.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(p.id)})))||void 0===m?void 0:m.color;return(0,M.jsx)(S().F,{color:p.color,format:u.isMobile?s().lo.Medium:s().lo.Small,groupColor:e,isSingle:!1,onClickRemove:d,showRemoveButton:!t,value:p.value})}return(0,M.jsx)(S().a,{color:p.color,format:u.isMobile?s().lo.Medium:s().lo.Small,isSingle:!1,onClickRemove:d,showRemoveButton:!t,value:p.value})}var $=()=>o(352230),Y=()=>o(198829),q=()=>o(255577),J=()=>o(838367),X=()=>o(470386),Q=()=>o(388284),ee=()=>o(122890),te=()=>o(534801),oe=()=>o(827973);function ne(e){let{checkState:t,checkType:o,menuArgs:n,onCheckboxClick:a,option:r}=e;const l=(0,i().Fy)();return(0,M.jsx)(oe().Z,{...n,..."single"===o?{checkState:t}:{},..."multi"===o?{icon:(0,M.jsx)(v().Z,{checked:t,size:14,onClick:a})}:{},title:(0,M.jsx)(S().a,{value:r.value,color:r.color,showRemoveButton:!1,isSingle:!0,shouldShrink:!0,format:l.isMobile?s().lo.Large:s().lo.Small}),isTokenTitle:!0})}function ie(e){let{checkState:t,checkType:o,menuArgs:n,onCheckboxClick:a,option:r,group:l}=e;const c=(0,i().Fy)();return(0,M.jsx)(oe().Z,{...n,..."single"===o?{checkState:t}:{},..."multi"===o?{icon:(0,M.jsx)(v().Z,{checked:t,size:14,onClick:a})}:{},title:(0,M.jsx)(S().F,{color:r.color,format:c.isMobile?s().lo.Large:s().lo.Small,groupColor:null==l?void 0:l.color,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:r.value},r.value),isTokenTitle:!0})}function ae(e){const{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:l,formulaValueContext:s,isSingle:p,menuProps:g,onChange:h,onClose:y,showClearButton:f=!1,showInputMenuItem:v=!1,showReplaceAddRemoveToggle:x=!1,type:b,value:S,parentRecordStore:C}=e,k=(0,i().Fy)(),j=(0,F().yK)((e=>({headerDiv:{paddingBlockEnd:k.isMobile?0:6,borderBlockEnd:k.isMobile?"none":`1px solid ${K().ZP.dividerColor}`},replaceAddRemoveToggleButton:{marginLeft:"8px",marginRight:"8px",marginTop:"8px"}})),[k.isMobile]),{footer:T,groupedItems:w,menuListStore:A,noResultsMessage:I,replaceAddRemoveToggleButton:_,searchInput:P,selectItems:V,valueItems:B}=function(e){const{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:l,formulaValueContext:s,isSingle:p,onChange:g,onClose:h,showClearButton:y,showReplaceAddRemoveToggle:f,type:v,value:x}=e,[b,S]=(0,n.useState)(""),C=(0,a().qz)(void 0,U().Z),k=(0,i().Fy)(),j=(0,D().YB)(),{collectionStore:T,property:w}=s,A=(0,a().VK)((()=>T.getSchema()[w]),[T,w]),I=A&&(0,r().gB)(A),_=(0,a().VK)((()=>I?A.groups??[]:[]),[I,A]),P=(0,a().VK)((()=>A&&(0,r().t)(A)&&A.options||[]),[A]),V=(0,n.useMemo)((()=>l.filter((e=>(0,c().uy)(e.type,{type:"select",collection:v.collection,property:v.property})))),[l,v.collection,v.property]),B=(0,a().VK)((()=>({valueResults:b?(0,H().ZP)(b,V,(e=>e.kind===E().FormulaContextValueKind.ContextValue?e.name:"")):V,selectResults:b?(0,H().ZP)(b,P,(e=>e.value)):P})),[b,V,P]),R=(0,n.useCallback)((()=>{S(""),C.setState({...C.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[C]),F=(0,n.useCallback)(((e,o)=>{g(e||x,o||t)}),[t,g,x]),K=(0,n.useCallback)((()=>{p&&Z().default.afterNextFlush((()=>{h()}))}),[p,h]),$=(0,n.useCallback)((e=>{F({type:"simple",value:p?(0,u().toSimpleFormulaSingleValue)(e[0]):(0,u().toSimpleFormulaArrayValue)(e)}),K(),R()}),[F,p,K,R]),Y=(0,n.useCallback)((()=>{$(o.slice(0,o.length-1))}),[o,$]),q=(0,n.useCallback)((e=>{$((0,u().simpleFormulaValueWithoutToken)(o,e))}),[o,$]),J=(0,n.useMemo)((()=>L().oA(o.map(((e,t)=>(0,M.jsx)(z,{disabled:!1,handleRemoveToken:q,propertySchema:A,token:e},`select_option_token_${t}`))))),[o,q,A]),X=(0,n.useMemo)((()=>new Set(L().oA(o.map((e=>(0,u().isAnnotationSimpleValueToken)(e)&&(0,d().wjk)(e)&&(0,d().vmO)(e).id))))),[o]),Q=(0,n.useMemo)((()=>L().oA((B.valueResults??[]).map((e=>{const t=e.kind===E().FormulaContextValueKind.ContextValue&&e.id||"";if(!t||!X.has(t))return{action:p?"replace":"append",currentSimpleFormulaValueTokens:o,onCheckboxClick:K,id:t,isStatusProperty:Boolean(I),setCurrentTokens:$,value:e}})))),[X,o,K,p,I,B.valueResults,$]),ee=p?"single":"multi",te=(0,n.useMemo)((()=>L().oA(B.selectResults??[]).reduce(((e,t)=>{const n=Boolean(o.find((e=>"string"==typeof e&&e===t.value)));return e[t.id]={checkState:n,checkType:ee,group:void 0,id:t.id,isStatusProperty:Boolean(I),onCheckboxClick:()=>{$(p?n?[]:[t.value]:n?(0,u().simpleFormulaValueWithoutToken)(o,t.value):[...o,t.value]),p&&Z().default.afterNextFlush((()=>{h()}))},option:t},e}),{})),[ee,o,p,I,h,B.selectResults,$]),oe=(0,n.useMemo)((()=>Object.values(te)),[te]),ne=(0,n.useMemo)((()=>_.map((e=>({items:(e.optionIds??[]).map((e=>te[e])).filter(m().$K),group:e})))),[te,_]),ie=_.length>0&&0===ne.length||0===_.length&&0===oe.length,ae=(0,M.jsx)(W().ZP,{dontShowBorderBottom:k.isAndroid,focus:!k.isMobile||void 0,focusAfterAnimation:!0,format:W().UR.FilterValue,onChange:e=>S(e.target.value),onClearButtonClick:()=>$([]),onRemoveLastToken:Y,placeholder:j.formatMessage(O().s.searchPlaceHolder),showClearButton:y,tokens:J,value:b}),re=(0,M.jsx)(N().Z,{value:x,onChange:F}),le=(0,M.jsx)(G().Z,{action:t,handleOnChange:F});return{footer:re,groupedItems:ne,menuListStore:C,noResultsMessage:ie&&j.formatMessage(O().s.noResults),replaceAddRemoveToggleButton:!!f&&le,searchInput:ae,selectItems:oe,valueItems:Q}}({action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:l,formulaValueContext:s,isSingle:p,onChange:h,onClose:y,showClearButton:f,showReplaceAddRemoveToggle:x,type:b,value:S})||{},R=(0,n.useMemo)((()=>B.map((e=>{const{annotation:t,itemAction:o}=(0,te().A)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:e=>(0,M.jsx)(ee().Z,{annotation:t,disabled:!1,formulaTypecheckContextValues:l,menuArgs:e,parentRecordStore:C}),action:o}}))),[l,B,C]),{groupedMenuItems:oe,selectMenuItems:ae}=(0,n.useMemo)((()=>{let e=[],t=[];return w.length>0?e=w.map((e=>{let{group:t,items:o}=e;return{key:t.name,render:e=>(0,M.jsx)(Q().Z,{...e,title:t.name,topBorder:!0}),items:o.map((e=>({key:e.id,render:t=>(0,M.jsx)(ie,{...t,checkState:e.checkState,checkType:e.checkType,group:e.group,menuArgs:t,onCheckboxClick:e.onCheckboxClick,option:e.option}),action:e.onCheckboxClick})))}})):t=V.map((e=>({key:e.id,render:t=>(0,M.jsx)(ne,{...t,checkState:e.checkState,checkType:e.checkType,menuArgs:t,onCheckboxClick:e.onCheckboxClick,option:e.option}),action:e.onCheckboxClick}))),{groupedMenuItems:e,selectMenuItems:t}}),[w,V]),re=[...R,...ae];let le,se=[];re.length>0&&se.push({key:"options",render:e=>(0,M.jsx)(Q().Z,{...e}),items:re}),oe.length>0&&(se=[...se,...oe]),le=k.isMobile?{menuType:$().o.Modal,right:(0,M.jsx)(X().DoneMenuText,{}),onClickRight:y,footer:T&&(0,M.jsx)(Q().Z,{topBorder:!0,children:T})}:{menuType:$().o.Popup,maxHeight:"50vh",width:260,footer:T&&(0,M.jsx)(Q().Z,{topBorder:!0,children:T}),disableHeaderBorder:!0};const ce=(0,M.jsxs)("div",{style:j.headerDiv,children:[!k.isMobile&&(null==g?void 0:g.header),v&&P]});return(0,M.jsxs)(Y().Z,{...le,header:ce,children:[_&&(0,M.jsx)("div",{style:j.replaceAddRemoveToggleButton,children:_}),I&&(0,M.jsx)(Q().Z,{children:(0,M.jsx)(J().Z,{title:I})}),se.length>0&&(0,M.jsx)(q().ZP,{type:q().iW.Vertical,initialFocus:0,sections:se,store:A})]})}var re=()=>o(303926),le=(o(228244),o(821057),()=>o(816512)),se=()=>o(396136),ce=()=>o(989478),ue=()=>o(998901),de=()=>o(826955),pe=()=>o(231219),me=()=>o(654133),ge=()=>o(864832);const he=(0,D().vU)({maximumPeopleSelectedTooltip:{defaultMessage:"Maximum people selected",id:"valuePickerItem.maximumSelectedReached"}});function ye(e){const{args:t,checkState:o,checkType:n,context:g,disabled:y,onCheckboxClick:x,parentRecordStore:b,token:C}=e,k=(0,i().Fy)(),j=(0,a().VK)((()=>{if((0,u().isAnnotationSimpleValueToken)(C)&&(0,d().IWo)(C)){const e=(0,d().zEN)(C);if(e)return(0,le().Hl)({pointer:{table:ce().KJ,id:e},getRecordValue:b.getRecordModel})}}),[b.getRecordModel,C]),T=(0,a().VK)((()=>g.collectionStore.getSchema()[g.property]),[g]),w=(0,a().VK)((()=>T&&(0,r().t)(T)?T.options??[]:[]),[T]),A=(0,a().VK)((()=>T&&(0,r().gB)(T)?T.groups??[]:[]),[T]),{typecheckResult:I}=(0,f().DZ)(),_=(0,F().yK)((e=>({disabledMenuItem:{cursor:"not-allowed",opacity:.4}})),[]),P=Boolean(T&&(0,r().gB)(T)),V="single"===n?{checkState:o}:"multi"===n?{icon:(0,M.jsx)(v().Z,{style:y?_.disabledMenuItem:void 0,checked:o,size:14,onClick:x,disabled:y})}:{};if("string"==typeof C){if(P){const e=(0,l().i7)(w,C),o=A.find((t=>{var o;return e&&(null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id))}));return e?(0,M.jsx)(oe().Z,{...t,...V,title:(0,M.jsx)(S().F,{format:k.isMobile?s().lo.Large:s().lo.Small,isSingle:!0,value:e.value,color:e.color,groupColor:null==o?void 0:o.color,shouldShrink:!0,showRemoveButton:!1},C),isTokenTitle:!0,disabled:y,style:y?_.disabledMenuItem:void 0,...t}):null}{const e=(0,l().i7)(w,C);return e?(0,M.jsx)(oe().Z,{...t,...V,title:(0,M.jsx)(S().a,{value:e.value,color:e.color,showRemoveButton:!1,isSingle:!0,shouldShrink:!0,format:k.isMobile?s().lo.Large:s().lo.Small}),isTokenTitle:!0,disabled:y,style:y?_.disabledMenuItem:void 0,...t}):null}}if("boolean"==typeof C)return null;if((0,d().IWo)(C))return null!=j&&j.asActor&&j.table===ce().KJ?(0,M.jsx)(oe().Z,{...t,...V,title:y?(0,M.jsx)(me().Z,{renderTooltip:()=>(0,M.jsx)(D()._H,{...he.maximumPeopleSelectedTooltip}),placement:ue().Placement.Right,render:e=>(0,M.jsx)("div",{style:{width:"100%"},...e,children:(0,M.jsx)(ge().vw,{isSingle:!0,shouldShrink:!0,format:k.isMobile?ge().vw.Format.Large:ge().vw.Format.Medium,userValue:j.asActor})})}):(0,M.jsx)(ge().vw,{isSingle:!0,shouldShrink:!0,format:k.isMobile?ge().vw.Format.Large:ge().vw.Format.Medium,userValue:j.asActor}),disabled:y,style:y?_.disabledMenuItem:void 0,isTokenTitle:!0}):null;if((0,d().wjk)(C)){const e=(0,d().vmO)(C).id,n=I&&p().x.isSuccess(I)?(0,c().vx)(I.value.valueTypes,e):void 0;return n?(0,M.jsx)(ee().Z,{checkState:o,contextValue:n,disabled:Boolean(y),menuArgs:t,parentRecordStore:b}):null}if((0,d().fpG)(C))return null;if((0,d().STW)(C)){const e=(0,d().TOT)(C);if(!e)return null;const n=de().G.createChildStore(b,{id:e,table:se().iU});return(0,M.jsx)(pe().Z,{store:n,checkState:o,hidePath:!0,...t})}if((0,d().Lyt)(C))return(0,M.jsx)(h().Z,{token:C});(0,m().t1)(C)}function fe(e){const{currentSimpleFormulaValueTokens:t,value:o,setCurrentTokens:n,action:i,context:a,checkType:r,onCheckboxClick:l,isDisabled:s,parentRecordStore:c}=e;if(o.kind!==E().FormulaContextValueKind.ContextValue)throw new Error("Not implemented yet.");const p=Boolean(t.find((e=>(0,u().isAnnotationSimpleValueToken)(e)&&(0,d().wjk)(e)&&(0,d().vmO)(e).id===o.id))),m=(0,d()._QF)({id:o.id}),g=()=>{n("append"===i?p?(0,u().simpleFormulaValueWithoutToken)(t,m):[...t,m]:[m]),null==l||l()};return{key:o.id,render:e=>(0,M.jsx)(ye,{disabled:s,token:m,args:e,checkState:p,checkType:r,context:a,onCheckboxClick:g,parentRecordStore:c}),action:g}}function ve(e){const{context:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:a,menuProps:r,onChange:l,onClose:s,parentRecordStore:c,value:d}=e,p=(0,D().YB)(),m=(0,i().Fy)(),g=a.filter((e=>"checkbox"===e.type.type)),h=(0,n.useCallback)((e=>{l({type:"simple",value:void 0!==e[0]?(0,u().toSimpleFormulaSingleValue)(e[0]):void 0})}),[l]),y=(0,n.useCallback)((e=>{h(e),s()}),[h,s]),f=L().oA(g.map((e=>fe({currentSimpleFormulaValueTokens:o,value:e,setCurrentTokens:y,action:"replace",context:t,checkType:"single",parentRecordStore:c})))),v=[],x=o.some((e=>!0===e)),b=[...f,...[{key:0,render:e=>(0,M.jsx)(oe().Z,{title:(0,M.jsx)(D()._H,{...O().s.unchecked}),checkState:!x,...e}),action:()=>{y([!1])}},{key:1,render:e=>(0,M.jsx)(oe().Z,{title:(0,M.jsx)(D()._H,{...O().s.checked}),checkState:x,...e}),action:()=>{y([!0])}}]],S=void 0!==(null==r?void 0:r.header)?r.header:(0,M.jsx)(Q().Z,{style:{paddingBottom:0},title:p.formatMessage(O().s.genericMenuHeader)}),C=Boolean(S);v.push({key:"checkbox",render:e=>(0,M.jsx)(Q().Z,{...e,topBorder:C}),items:b});const k=(0,M.jsx)(Q().Z,{topBorder:!0,children:(0,M.jsx)(N().Z,{onChange:l,value:d})});let j;j=m.isMobile?{menuType:$().o.Modal,right:(0,M.jsx)(X().DoneMenuText,{}),onClickRight:s,footer:k}:{menuType:$().o.Popup,maxHeight:"50vh",width:260,disableHeaderBorder:!0,header:S,footer:k};const T={...j,...r,header:m.isMobile?null:S};return(0,M.jsx)(Y().Z,{...T,children:(0,M.jsx)(q().ZP,{type:q().iW.Vertical,initialFocus:0,sections:v})})}var xe=()=>o(587080),be=()=>o(213715),Se=()=>o(803021),Ce=()=>o(891142),ke=()=>o(675393),Me=()=>o(718959),je=()=>o(677559),Te=()=>o(265640),we=()=>o(1910);function Ae(e){const{context:t,currentSimpleFormulaValueTokens:o,disabled:i,onClose:r,setCurrentTokens:l,setInDatePicker:s}=e,c=o[0],p=c&&(0,u().isAnnotationSimpleValueToken)(c)&&d().fpG(c)?d().zyO(c):void 0,m=(0,D().YB)(),g=(0,a().Kw)(Me().AK),h=(0,n.useCallback)((()=>{s(!1)}),[s]),y=(0,n.useCallback)((e=>{e&&(0,Se().U3)(e)?l([d().pZr(e)]):l([])}),[l]),f=(0,F().yK)((e=>({header:{display:"flex",alignItems:"center",fontSize:12,paddingInline:14,color:e.mediumTextColor,marginTop:8,fontWeight:500},iconWrap:{width:18,height:18,marginRight:4},icon:{width:12,height:12},title:{flex:"1 1 auto"}})),[]),v=(0,a().VK)((()=>(0,k()._7)(t)),[t]);return(0,M.jsx)(je().ev,{dependency:ke().Di,children:e=>{let{DatePropertyMenu:t}=e;return(0,M.jsx)(t,{firstDayOfWeek:g,value:p,canConfigureCollection:!1,onChangeValue:y,dateFormat:v.dateFormat,timeFormat:v.timeFormat,onDismiss:r,disabled:i,shouldShowReminder:!1,header:(0,M.jsxs)("div",{style:f.header,children:[(0,M.jsx)(we().Z,{ariaLabel:m.formatMessage(O().s.back),icon:Ce().S,onClick:h,style:f.iconWrap,iconStyle:f.icon}),(0,M.jsx)("span",{style:f.title,children:(0,M.jsx)(D()._H,{...O().s.pickADate})}),(0,M.jsx)(Te().D,{onClick:r,isBlue:!0,children:(0,M.jsx)(X().DoneMenuText,{})})]}),isTemplatePage:!1})}})}function Ie(e){const{context:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:a,menuProps:r,onChange:l,onClose:s,parentRecordStore:c,value:d}=e,p=(0,D().YB)(),m=(0,i().Fy)(),[g,h]=(0,n.useState)(!1),y=a.filter((e=>"date"===e.type.type)),f=(0,n.useCallback)((e=>{l({type:"simple",value:void 0!==e[0]?(0,u().toSimpleFormulaSingleValue)(e[0]):void 0})}),[l]),v=(0,n.useCallback)((e=>{f(e),s()}),[f,s]),x=(0,n.useCallback)((()=>{h(!0)}),[]),b=(0,n.useCallback)((()=>{f([]),s()}),[f,s]);if(g)return(0,M.jsx)(Ae,{context:t,currentSimpleFormulaValueTokens:o,disabled:!1,onClose:s,setCurrentTokens:f,setInDatePicker:h});const S=void 0!==(null==r?void 0:r.header)?r.header:(0,M.jsx)(Q().Z,{style:{paddingBottom:0},title:p.formatMessage(O().s.genericMenuHeader)}),C=L().oA(y.map((e=>fe({currentSimpleFormulaValueTokens:o,value:e,setCurrentTokens:v,parentRecordStore:c,action:"replace",context:t,checkType:"single"})))),k=[];if(C.length>0){const e=Boolean(S);k.push({key:"values",render:t=>(0,M.jsx)(Q().Z,{topBorder:e,...t}),items:C})}const j=(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(Q().Z,{topBorder:!0,children:[(0,M.jsx)(be().Z,{icon:xe().V,title:(0,M.jsx)(D()._H,{...O().s.pickADate}),onClick:x}),(0,M.jsx)(N().Z,{onChange:l,value:d})]}),o.length>0&&(0,M.jsx)(Q().Z,{topBorder:!0,children:(0,M.jsx)(oe().Z,{title:(0,M.jsx)(D()._H,{...O().s.clear}),focused:!1,onClick:b})})]});let T;T=m.isMobile?{menuType:$().o.Modal,right:(0,M.jsx)(X().DoneMenuText,{}),onClickRight:s,footer:j}:{menuType:$().o.Popup,maxHeight:"50vh",width:260,footer:j,disableHeaderBorder:!0};const w={...T,...r,header:m.isMobile?null:S};return(0,M.jsx)(Y().Z,{...w,children:(0,M.jsx)(q().ZP,{type:q().iW.Vertical,initialFocus:0,sections:k})})}function _e(e){const{action:t,allowedFormulaReturnTypes:o,currentSimpleFormulaValueTokens:i,disableEmojiCommands:r,disableFormattingAndMentions:l,disableMobileActionBar:s,disableTemplateVariableMentions:c,formulaTypecheckContextValues:u,formulaValueContext:d,limit:p,menuProps:g,onChange:h,onClose:y,parentRecordStore:f,showClearButton:v,showInputMenuItem:x,showReplaceAddRemoveToggle:b,type:S,value:C}=e;A();const k="formula"===(null==C?void 0:C.type),j=(0,a().VK)((()=>{var e;return null===(e=_().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),T=n.useCallback((()=>{h({type:"simple",value:null==C?void 0:C.value})}),[h,null==C?void 0:C.value]),w=(0,I().E)("collections_xws")?"cross_space_and_read_permissions":"read_permissions_only";return k&&j?(0,M.jsx)(P().Z,{allowedReturnTypes:o,disabled:!1,formulaTypecheckContextValues:u,onBack:T,onChange:h,onClose:y,parentRecordStore:f,restrictUnaccessibleProperties:w,spaceId:j,value:C}):"person_array"===S.type?(0,M.jsx)(Be,{action:t,currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:u,formulaValueContext:d,limit:p,menuProps:g,onChange:h,onClose:y,showClearButton:v??!0,showInputMenuItem:x??!0,showFormulaValueItems:!0,showGenericHeader:!0,showReplaceAddRemoveToggle:b,showPersonCheckbox:b,getRecordModel:f.getRecordModel,value:C,parentRecordStore:f}):"collection"!==d.type?null:"text"===S.type?(0,M.jsx)(Ve,{currentSimpleFormulaValueTokens:i,disableEmojiCommands:r,disableFormattingAndMentions:l,disableMobileActionBar:s,disableTemplateVariableMentions:c,formulaTypecheckContextValues:u,menuProps:g,onChange:h,onClose:y,parentRecordStore:f,showGenericHeader:!0,value:C}):"number"===S.type?(0,M.jsx)(Pe,{currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:u,menuProps:g,onChange:h,onClose:y,showGenericHeader:!0,value:C,parentRecordStore:f}):"checkbox"===S.type?(0,M.jsx)(ve,{context:d,currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:u,menuProps:g,onChange:h,onClose:y,parentRecordStore:f,value:C}):"date"===S.type?(0,M.jsx)(Ie,{context:d,currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:u,menuProps:g,onChange:h,onClose:y,parentRecordStore:f,value:C}):"block_array"===S.type?(0,M.jsx)(Re,{action:t,collection:"block_array"===S.type?S.collection:void 0,currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:u,formulaValueContext:d,menuProps:g,onChange:h,onClose:y,showClearButton:v??!0,showFormulaValueItems:!0,showGenericHeader:!0,showInputMenuItem:x??!0,showReplaceAddRemoveToggle:b,value:C,parentRecordStore:f}):"select"===S.type?(0,M.jsx)(ae,{currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:u,formulaValueContext:d,isSingle:!0,menuProps:g,onChange:h,onClose:y,showClearButton:v??!0,showInputMenuItem:x??!0,type:S,value:C,parentRecordStore:f}):"select_array"===S.type?(0,M.jsx)(ae,{action:t,currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:u,formulaValueContext:d,isSingle:!1,menuProps:g,onChange:h,onClose:y,showClearButton:v??!0,showInputMenuItem:x??!0,showReplaceAddRemoveToggle:b,type:S,value:C,parentRecordStore:f}):void(0,m().t1)(S)}function Pe(e){let{currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,menuProps:n,onChange:i,onClose:a,showGenericHeader:r,value:l,parentRecordStore:s}=e;const{numberMenu:c}=(0,V().Z)({currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,menuProps:n,onChange:i,onClose:a,showGenericHeader:r,value:l,parentRecordStore:s});return c}function Ve(e){let{currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,menuProps:n,onChange:i,onClose:a,parentRecordStore:r,showGenericHeader:l,value:s}=e;const{textMenu:c}=(0,re().Z)({currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,menuProps:n,onChange:i,onClose:a,parentRecordStore:r,showGenericHeader:l,value:s});return c}function Be(e){let{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:n,formulaValueContext:i,limit:a,menuProps:r,onChange:l,onClose:s,showClearButton:c,showInputMenuItem:u,showFormulaValueItems:d,showGenericHeader:p,showReplaceAddRemoveToggle:m,showPersonCheckbox:g,getRecordModel:h,value:y,parentRecordStore:f}=e;const{personArrayMenu:v}=(0,B().Z)({action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:n,formulaValueContext:i,limit:a,menuProps:r,onChange:l,onClose:s,showClearButton:c,showInputMenuItem:u,showFormulaValueItems:d,showGenericHeader:p,showReplaceAddRemoveToggle:m,showPersonCheckbox:g,getRecordModel:h,value:y,parentRecordStore:f});return v}function Re(e){let{action:t,collection:o,currentSimpleFormulaValueTokens:n,formulaTypecheckContextValues:i,formulaValueContext:a,menuProps:r,onChange:l,onClose:s,showClearButton:c,showFormulaValueItems:u,showGenericHeader:d,showInputMenuItem:p,showReplaceAddRemoveToggle:m,value:g,parentRecordStore:h}=e;const{relationMenu:y}=(0,R().Z)({action:t,collection:o,currentSimpleFormulaValueTokens:n,formulaTypecheckContextValues:i,formulaValueContext:a,menuProps:r,onChange:l,onClose:s,showClearButton:c,showFormulaValueItems:u,showGenericHeader:d,showInputMenuItem:p,showReplaceAddRemoveToggle:m,value:g,parentRecordStore:h});return y}},953349:(e,t,o)=>{o.d(t,{MF:()=>H,N_:()=>F,U7:()=>Z,ZP:()=>V,uV:()=>E});o(670560),o(267602),o(653476),o(470928),o(241792),o(228244);var n=o(667294),i=()=>o(219727),a=()=>o(142735),r=()=>o(846550),l=()=>o(714230),s=()=>o(235484),c=()=>o(775404),u=()=>o(286977),d=()=>o(535014),p=()=>o(899548),m=()=>o(121183),g=()=>o(788860),h=()=>o(513670),y=()=>o(855741),f=()=>o(696459),v=()=>o(824462),x=()=>o(388915),b=()=>o(527278),S=()=>o(762300),C=()=>o(729201),k=()=>o(876822),M=()=>o(138912),j=()=>o(385010),T=()=>o(827973),w=()=>o(740046),A=()=>o(312578),I=()=>o(388284),_=o(785893);const P=(0,g().vU)({channelSearchPlaceholder:{id:"notificationRuleSettings.selectChannelView.searchInput.placeholder",defaultMessage:"Searchâ¦"}});function V(e){const{currentNotificationChannels:t,onNotificationChannelSelect:o,onClose:r,onNewSlackAccountAdded:c,renderMenu:d,channelFilter:m,workflowExternalAuthenticationPointer:v,isMultiSelectMode:j,shouldHideSlackAccountSection:V}=e,K=(0,i().O7)(),{isMobile:H}=(0,i().Fy)(),D=(0,a().Kw)(M().default.completeSlackAuthentications),L=e.currentExternalAuthentication??h().Ps(D),O=(0,n.useMemo)((()=>v?{type:"workflow",workflowExternalAuthenticationId:v.id}:L?{type:"external",botId:L.id}:void 0),[v,L]);n.useEffect((()=>{const e=v?null==v?void 0:v.spaceId:null==L?void 0:L.space_id;O&&e&&E({environment:K,spaceId:e,externalAuthConfig:O})}),[K,O,L,v]);const N=(null==v?void 0:v.id)??(null==L?void 0:L.id),[W,U]=n.useState(""),{loadedChannelsForAccount:G,isLoading:z}=Z(O),$=(0,a().VK)((()=>M().default.integrations.state.find((e=>e.id===s().nO))),[]),Y=(0,a().VK)((()=>{var e;return null===(e=k().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),q=n.useCallback((e=>{L?o(e,L.parent_id):v&&o(e,v.id),j||r()}),[o,L,v,r,j]),J=B(),X=n.useCallback((e=>{const{channel:o}=e;return{key:o.id,render:e=>(0,_.jsx)(T().Z,{...e,icon:F({channel:o,styles:J.icon}),desktopIconStyle:{width:8},title:o.name,right:(null==t?void 0:t.some((e=>e.id===o.id)))&&(0,u().e)(J.icon)}),action:()=>{q(o)}}}),[q,J.icon,t]),{publicChannels:Q,privateChannels:ee,personalChannels:te}=n.useMemo((()=>function(e,t){const o=[],n=[],i=[];for(const a of e)t&&!t(a)||("public"===a.type?o.push(a):"private"===a.type?n.push(a):"me"===a.type?i.push(a):(0,f().t1)(a.type));return{publicChannels:o,privateChannels:n,personalChannels:i}}(G,m)),[m,G]),oe=n.useCallback((()=>Q.map((e=>({menuListItem:X({channel:e}),channelName:e.name})))),[Q,X]),ne=n.useCallback((()=>ee.map((e=>({menuListItem:X({channel:e}),channelName:e.name})))),[ee,X]),ie=n.useCallback((()=>te.map((e=>({menuListItem:X({channel:e}),channelName:e.name})))),[te,X]),ae=n.useCallback((()=>oe().map((e=>{let{menuListItem:t,channelName:o}=e;if(R({channelName:o,query:W}))return t})).filter(f().$K)),[oe,W]),re=n.useCallback((()=>ne().map((e=>{let{menuListItem:t,channelName:o}=e;if(R({channelName:o,query:W}))return t})).filter(f().$K)),[ne,W]),le=n.useCallback((()=>ie().map((e=>{let{menuListItem:t,channelName:o}=e;if(R({channelName:o,query:W}))return t})).filter(f().$K)),[ie,W]),se=n.useCallback((()=>L?(0,S().jg)(L).organizationName:"Workflows organization"),[L]),ce=n.useCallback((()=>{if(!N)return[];const e=[],t=ae(),o=re(),n=le();return n.length>0&&e.push({key:"personal-channels",render:e=>(0,_.jsx)(I().Z,{...e,title:se()}),items:n}),t.length>0&&e.push({key:"public-channels",render:e=>(0,_.jsx)(I().Z,{...e,topBorder:n.length>0,title:0===n.length&&se()}),items:t}),o.length>0&&e.push({key:"private-channels",render:e=>(0,_.jsx)(I().Z,{...e,topBorder:t.length>0,title:0===n.length&&t.length>0&&se()}),items:o}),e}),[N,ae,re,le,se]),ue=(0,C().Z)(z,500,300);if(!N||!$)return null;const de=[{key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,_.jsx)("div",{children:(0,_.jsx)(w().ZP,{...e,inputLeft:(0,_.jsx)(w().f_,{icon:p().R}),inputRight:ue&&(0,_.jsx)(A().Z,{style:{marginRight:2}}),showClearButton:!0,placeholder:b().Z.formatMessage(P.channelSearchPlaceholder),focusInitial:!H,value:W,onChange:e=>{U(e.target.value)}})})}],render:e=>(0,_.jsx)(I().Z,{...e})},...ce()];return t||V||de.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!Y)return;const e=await x().hM({environment:K,integration:$,spaceId:Y,from:"collection_view_settings"});y().x.isFail(e)||c()},render:e=>(0,_.jsx)(T().Z,{...e,icon:(0,_.jsx)("img",{src:l().Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,_.jsx)(g()._H,{id:"notificationRuleSettings.selectChannelView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,_.jsx)(I().Z,{...e,topBorder:!0})}),(0,_.jsx)(_.Fragment,{children:d(de)})}function B(){return(0,r().yK)((e=>({icon:{marginLeft:8,width:12,height:12,color:e.lightTextColor},container:{backgroundColor:e.popoverBackground,marginTop:12,marginBottom:6},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:e.regularIconColor}})),[])}function R(e){const{channelName:t,query:o}=e;return 0===o.length||t.toLocaleLowerCase().indexOf(o.trim().toLocaleLowerCase())>=0}function F(e){const{channel:t,styles:o}=e;return"private"===t.type?(0,d().b)(o):"me"===t.type?(0,c().p)(o):(0,m().J)(o)}const K=15e3;function Z(e){return(0,a().VK)((()=>{if(!e)return{loadedChannelsForAccount:[],isLoading:!1};const t=j().l.getStateForBot(e);return{loadedChannelsForAccount:Object.values(t.channels),isLoading:t.fetching}}),[e])}async function E(e){const{environment:t,externalAuthConfig:o,spaceId:n}=e,i=j().l.getStateForBot(o);if(i.fetching||Date.now()-i.lastRefreshed<K)return;let a;for(j().l.updateStateForBot(o,{fetching:!0,lastRefreshed:Date.now()});;){const e=await v().callApi({eventName:"getExternalNotificationChannels",environment:t,data:{spaceId:n,cursor:a,...o}});if("success"!==e.type){console.error(e.error);break}{const t={};for(const o of e.data.channels)t[o.id]=o;if(j().l.addChannelsForBot(o,t),a=e.data.cursor,!a)break}await new Promise((e=>setTimeout(e,0)))}j().l.updateStateForBot(o,{fetching:!1})}const H=n.forwardRef(((e,t)=>{const{channel:o,currentNotificationChannels:n,...i}=e,a=B();return(0,_.jsx)(T().Z,{ref:t,...i,icon:F({channel:o,styles:a.icon}),desktopIconStyle:{width:8},title:o.name,right:(null==n?void 0:n.some((e=>e.id===o.id)))&&(0,u().e)(a.icon)})}));H.displayName="SlackChannelMenuItem"},125659:(e,t,o)=>{o.d(t,{DK:()=>c,L1:()=>l,Y$:()=>s,cu:()=>r});o(821057);var n=o(667294);const i="collectionContextStore",a=(0,o(949744).Q)({displayName:i,legacyContextKey:i,modernContextDefaultValue:void 0}),r=a.context,l=a.Provider;function s(){const e=n.useContext(r);if(void 0===e)throw new Error(`No context provided: ${i}`);return e}function c(){return n.useContext(r)}},488901:(e,t,o)=>{o.r(t),o.d(t,{CollectionSettingsAutomationsView:()=>Ht});o(670560),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(653476),o(470928),o(30005),o(241792),o(228244);var n=o.n(o(443261)),i=o(667294),a=()=>o(219727),r=()=>o(142735),l=()=>o(846550),s=()=>o(816512),c=()=>o(912203),u=()=>o(440692),d=()=>o(473304),p=()=>o(455947),m=()=>o(226413),g=()=>o(532850),h=()=>o(907874),y=()=>o(394480),f=()=>o(29248),v=()=>o(135796),x=()=>o(742922),b=()=>o(941954),S=()=>o(456681),C=()=>o(519454),k=()=>o(159732),M=()=>o(525372),j=()=>o(839678),T=()=>o(711857),w=o(785893);const A=(0,o(827282).IU)("typesLocation",{viewBox:"0 0 25 25",svg:(0,w.jsxs)("g",{children:[(0,w.jsx)("path",{d:"M12.105 24.21C18.7369 24.21 24.2121 18.7273 24.2121 12.105C24.2121 5.47312 18.7273 0 12.0954 0C5.47523 0 0 5.47312 0 12.105C0 18.7273 5.48484 24.21 12.105 24.21ZM12.105 21.8255C6.71085 21.8255 2.39412 17.4991 2.39412 12.105C2.39412 6.71085 6.70124 2.38452 12.0954 2.38452C17.4895 2.38452 21.8276 6.71085 21.8276 12.105C21.8276 17.4991 17.4991 21.8255 12.105 21.8255Z"}),(0,w.jsx)("path",{d:"M6.75703 16.5939C6.75703 17.4355 7.28742 17.9479 8.17266 17.9479H16.0416C16.9247 17.9479 17.4476 17.4355 17.4476 16.5939V12.0109L12.4683 7.82758C12.236 7.63047 11.9686 7.64008 11.7363 7.82758L6.75703 12.0013V16.5939ZM13.6692 16.7148H10.5429V12.9969C10.5429 12.7178 10.7283 12.5366 11.0128 12.5366H13.2014C13.4977 12.5366 13.6692 12.7178 13.6692 12.9969V16.7148ZM4.81055 11.2199C4.81055 11.5316 5.04469 11.8138 5.43211 11.8138C5.62593 11.8138 5.78554 11.7083 5.9271 11.5806L11.8111 6.65687C12.0145 6.47477 12.2093 6.49609 12.4052 6.65687L18.2775 11.5806C18.4383 11.7083 18.5883 11.8138 18.7725 11.8138C19.1194 11.8138 19.3941 11.5818 19.3941 11.2391C19.3941 11.0315 19.3228 10.873 19.1653 10.7336L13.0078 5.5661C12.4605 5.10508 11.7558 5.10508 11.2181 5.5661L5.03929 10.7357C4.89141 10.8751 4.81055 11.0507 4.81055 11.2199ZM15.8079 8.35282L17.4623 9.75391V6.88399C17.4623 6.62618 17.3004 6.44501 17.033 6.44501H16.249C15.9912 6.44501 15.8079 6.62618 15.8079 6.88399V8.35282Z"})]})});var I=()=>o(788680),_=()=>o(556392),P=()=>o(401506),V=()=>o(726457),B=()=>o(827370),R=()=>o(788860),F=()=>o(696459),K=()=>o(707513),Z=()=>o(139224),E=()=>o(102182),H=()=>o(915687),D=()=>o(239869),L=()=>o(637118),O=()=>o(166312),N=()=>o(205951),W=()=>o(740046),U=()=>o(108714),G=()=>o(906651),z=()=>o(388284),$=()=>o(777346),Y=()=>o(654133),q=()=>o(594546),J=()=>o(561933),X=()=>o(867601),Q=()=>o(122479),ee=()=>o(466970),te=()=>o(998901),oe=()=>o(876822),ne=()=>o(749826),ie=()=>o(815277),ae=()=>o(71194),re=()=>o(474788),le=()=>o(260799),se=()=>o(889919),ce=()=>o(190129),ue=()=>o(521913),de=()=>o(523733),pe=()=>o(928374),me=()=>o(641772),ge=()=>o(44037),he=()=>o(76910),ye=()=>o(95886),fe=()=>o(827973),ve=()=>o(448419),xe=()=>o(1910),be=()=>o(198829),Se=()=>o(255577),Ce=()=>o(667637),ke=()=>o(529048),Me=()=>o(918745),je=()=>o(676279);const Te=(0,R().vU)({automationSummaryCardMoreButtonAriaLabel:{defaultMessage:"More",id:"automations.AutomationSummaryCard.MoreActionsButton.ariaLabel"},automationSummaryCardMoreMenuEditTitle:{defaultMessage:"Edit",id:"automations.AutomationSummaryCard.MoreActionsMenu.Edit.title"},automationSummaryCardMoreMenuDuplicateTitle:{defaultMessage:"Duplicate",id:"automations.AutomationSummaryCard.MoreActionsMenu.Duplicate.title"},automationSummaryCardMoreMenuDeleteTitle:{defaultMessage:"Delete",id:"automations.AutomationSummaryCard.MoreActionsMenu.Delete.title"},automationSummaryCardMoreMenuActiveTitle:{defaultMessage:"Active",id:"automations.AutomationSummaryCard.MoreActionsMenu.Active.title"},automationSummaryCardMoreMenuRestartTitle:{defaultMessage:"Restart",id:"automations.AutomationSummaryCard.MoreActionsMenu.Restart.title"}});function we(e){const{focused:t,style:o,onEdit:n,onDelete:a,onDuplicate:s,onDisable:c,onEnable:u,onRestart:d}=e,p=(0,R().YB)(),m=(0,r().qz)(void 0,ke().Z),g=(0,je().d)();(0,i.useEffect)((()=>{t||m.setState({open:!1})}),[t,m]);const h=(0,l().yK)((e=>({iconButton:{border:`1px solid ${e.regularDividerColor}`,height:26,width:26,...o},iconButtonIcon:{width:16}})),[o]);return(0,w.jsx)(ve().ZP,{stopClickPropagation:!0,popupType:g,alignmentToOrigin:ve().vR.Center,placementToOrigin:ve().pO.Bottom,originGap:0,renderOrigin:e=>(0,w.jsx)(xe().Z,{ariaLabel:p.formatMessage(Te.automationSummaryCardMoreButtonAriaLabel),icon:me().o,iconStyle:h.iconButtonIcon,style:h.iconButton,hasBackground:!0,...e}),render:e=>(0,w.jsx)(Ae,{onClose:()=>e.close(),onEdit:n,onDelete:a,onDuplicate:s,onDisable:c,onEnable:u,onRestart:d}),buttonPopupStore:m})}function Ae(e){const{onClose:t,onEdit:o,onDelete:n,onDuplicate:i,onDisable:a,onEnable:r,onRestart:l}=e,s=(0,R().YB)(),c=(0,Me().F)(),u=o?{action:()=>{t(),o()},key:"edit",render:e=>(0,w.jsx)(fe().Z,{...e,icon:(0,C().R)({height:16,width:16}),title:s.formatMessage(Te.automationSummaryCardMoreMenuEditTitle)})}:void 0,d=l?{action:()=>{t(),l()},key:"restart",render:e=>(0,w.jsx)(fe().Z,{...e,icon:(0,he().n)({height:16,width:16}),title:s.formatMessage(Te.automationSummaryCardMoreMenuRestartTitle)})}:void 0,p=i?{action:()=>{t(),i()},key:"duplicate",render:e=>(0,w.jsx)(fe().Z,{...e,icon:(0,ge().a)({height:16,width:16}),title:s.formatMessage(Te.automationSummaryCardMoreMenuDuplicateTitle)})}:void 0,m=r||a?{action:()=>{t(),r?r():a&&a()},key:"active",render:e=>(0,w.jsx)(Ce().Z,{...e,icon:(0,pe().M)({height:16,width:16}),title:s.formatMessage(Te.automationSummaryCardMoreMenuActiveTitle),on:(0,F().$K)(a)})}:void 0,g=n?{action:()=>{t(),n()},key:"delete",render:e=>(0,w.jsx)(fe().Z,{...e,icon:(0,ye().y)({height:16,width:16}),title:s.formatMessage(Te.automationSummaryCardMoreMenuDeleteTitle),isRedOnHover:!0})}:void 0,h=[];return(0,F().$K)(m)&&h.push({items:[m],key:"active-inactive",render:e=>(0,w.jsx)(z().Z,{enableActionSheetTitle:!0,topBorder:!0,...e})}),h.push({items:[d,u,p,g].filter(F().$K),key:"items",render:e=>(0,w.jsx)(z().Z,{enableActionSheetTitle:!0,topBorder:!0,...e})}),(0,w.jsx)(be().Z,{...c,children:(0,w.jsx)(Se().ZP,{type:Se().iW.Vertical,sections:h,initialFocus:0})})}var Ie=()=>o(521632),_e=()=>o(154186),Pe=()=>o(864832),Ve=()=>o(641506);const Be=6;function Re(e){const{actions:t,caption:o,focused:n,status:r,maxIcons:s,onBlur:c,onClick:u,onDelete:d,onDisable:p,onDuplicate:m,onEdit:g,onRestart:h,onEnable:y,onFocus:f,onMouseDown:v,onMouseEnter:x,onMouseLeave:b,title:S,triggers:C}=e,{isMobile:k}=(0,a().Fy)(),M=(0,i.useRef)(null),[j,T]=(0,re().Z)(),[A,I]=(0,le().Z)(),[_,P]=(0,i.useState)(!1),V=k||_||T||I,B=(0,ee().E)("automation_updated_error_states"),Z=(0,l().yK)((e=>({wrap:{background:e.surface.elevated,border:`1px solid ${e.regularDividerColor}`,borderRadius:10,display:"flex",flexDirection:"column",gap:11,paddingTop:16,paddingLeft:16,paddingRight:16,paddingBottom:13,position:"relative"},moreButtonWrap:{display:V?"block":"none",position:"absolute",right:8,top:8},iconList:{display:"flex",flexWrap:"wrap",gap:6,listStyle:"none",margin:"0 30px 0 0",padding:0},body:{display:"flex",flexDirection:"column",gap:k?4:0},titleWrap:{..."success"!==r?{alignItems:"center",display:"inline-flex",gap:4}:(0,Ve().pd)(2),fontSize:k?16:14,fontWeight:K().Ue.medium,lineHeight:"20px"},title:{..."success"!==r?K().Yu:{}},warning:{color:"error"===r?e.errorText:e.accentColors.orange[400],height:"auto",width:k?16:14},caption:{...(0,Ve().pd)(2),color:e.text.secondary,fontSize:k?14:12,fontWeight:K().Ue.regular,lineHeight:"16px",margin:0},invalidBadge:{backgroundColor:e.tint.uiRed,color:e.icon.uiRedPrimary},failingBadge:{backgroundColor:e.accentColors.yellow[50],color:e.accentColors.yellow[400]},pausedBadge:{backgroundColor:e.tint.regular,color:e.text.secondary},badgeContainer:{alignItems:"center",display:"flex",fontSize:10},icon:{width:10,height:10,marginRight:"4px"}})),[r,V,k]),E=(0,i.useCallback)((e=>{P(!0),x&&x(e)}),[x]),H=(0,i.useCallback)((e=>{P(!1),b&&b(e)}),[b]);(0,i.useEffect)((()=>{n&&null!==M.current&&M.current.focus()}),[n]);const D=(0,de().lq)(M,j,A),L=function(e){const{actionIcons:t,maxIcons:o,triggerIcons:n}=e,i=n.length,a=t.length,r=i>0&&a>0,l=Math.max(o,3),s=r?l-1:l;let c=Math.max(Math.floor(s/2),1),u=Math.max(Math.ceil(s/2),1);if(i<c&&a>u){u+=c-i,c=i}else if(a<u&&i>c){c+=u-a,u=a}const d=[];if(i>0)if(i>c)if(1===c)d.push({color:"gray",type:"truncate",value:i});else{const e=i-(c-1);d.push(...n.slice(0,c-1)),d.push({color:"gray",type:"truncate",value:e})}else d.push(...n);r&&d.push({type:"arrow"});if(a>0)if(a>u)if(1===u)d.push({color:"gray",type:"truncate",value:a});else{const e=a-(u-1);d.push(...t.slice(0,u-1)),d.push({color:"gray",type:"truncate",value:e})}else d.push(...t);return d}({actionIcons:t,maxIcons:Le(s),triggerIcons:C}),O=Boolean(d||p||y||m||g||h),N=(0,i.useMemo)((()=>{if(B){if("invalid"===r)return(0,w.jsx)(Ie().Z,{style:Z.invalidBadge,content:(0,w.jsxs)("div",{style:Z.badgeContainer,children:[(0,ue().t)(Z.icon),(0,w.jsx)(R()._H,{defaultMessage:"Invalid",id:"automationSummaryCard.invalidToken"})]})});if("paused"===r)return(0,w.jsx)(Ie().Z,{style:Z.pausedBadge,content:(0,w.jsxs)("div",{style:Z.badgeContainer,children:[(0,ce().l)(Z.icon),(0,w.jsx)(R()._H,{defaultMessage:"Paused",id:"automationSummaryCard.pausedToken"})]})});if("failing"===r)return(0,w.jsx)(Ie().Z,{style:Z.failingBadge,content:(0,w.jsx)("div",{style:Z.badgeContainer,children:(0,w.jsx)(R()._H,{defaultMessage:"Failing",id:"automationSummaryCard.failingToken"})})});if("expired"===r)return(0,w.jsx)(Ie().Z,{style:Z.pausedBadge,content:(0,w.jsx)("div",{style:Z.badgeContainer,children:(0,w.jsx)(R()._H,{defaultMessage:"Completed",id:"automationSummaryCard.completedToken"})})});if("error"===r||"warning"===r||"success"===r)return;(0,F().t1)(r)}return"success"!==r?(0,ue().t)(Z.warning):void 0}),[B,r,Z]);return(0,w.jsxs)(_e().Z,{onBlur:c,onClick:u,onFocus:f,onMouseDown:v,onMouseEnter:E,onMouseLeave:H,ref:D,style:Z.wrap,children:[(0,w.jsxs)("header",{children:[O&&(0,w.jsx)("div",{style:Z.moreButtonWrap,children:(0,w.jsx)(we,{focused:V,onDelete:d,onDisable:p,onEnable:y,onDuplicate:m,onEdit:g,onRestart:h})}),(0,w.jsx)("ul",{"aria-hidden":"true",style:Z.iconList,children:L.map(((e,t)=>(0,w.jsx)("li",{children:(0,w.jsx)(Fe,{icon:e})},t)))})]}),(0,w.jsxs)("div",{style:Z.body,children:[(0,w.jsxs)("div",{style:Z.titleWrap,children:[(0,w.jsx)("span",{style:Z.title,children:S}),N]}),o&&(0,w.jsx)("p",{style:Z.caption,children:o})]})]})}function Fe(e){const{icon:t}=e;return"property"===t.type||"page"===t.type||"misc"===t.type?(0,w.jsx)(Ke,{color:t.color,icon:t.icon}):"person"===t.type?(0,w.jsx)(De,{actor:t.actor}):"app"===t.type?(0,w.jsx)(Ee,{color:"default",icon:t.icon}):"arrow"===t.type?(0,w.jsx)(Ze,{}):"truncate"===t.type?(0,w.jsx)(He,{color:t.color,value:t.value}):void(0,F().t1)(t.type)}function Ke(e){const{color:t,icon:o}=e,n=Oe(t);return(0,w.jsx)("div",{"aria-hidden":"true",style:n.iconWrap,children:o(n.icon)})}function Ze(){const e=Oe("default");return(0,w.jsx)("div",{style:{...e.iconWrap,...e.iconArrowWrap},children:(0,se().k)({...e.icon,...e.iconArrow})})}function Ee(e){const{icon:t}=e,o=Oe("default");return(0,w.jsx)("div",{"aria-hidden":"true",style:o.iconAppWrap,children:t(o.iconApp)})}function He(e){const{color:t,value:o}=e,n=Oe(t);return(0,w.jsxs)("div",{style:{...n.iconWrap,...n.truncateWrap},children:["+",o]})}function De(e){const{actor:t}=e,o=Oe("default");return(0,w.jsx)("div",{"aria-hidden":"true",style:o.iconPersonWrap,children:(0,w.jsx)(Pe().ZP,{actor:t,avatarSize:26,format:Pe().ZP.Format.Inline,isSingle:!1,showRemoveButton:!1,style:{margin:0}})})}function Le(e){return void 0===e||e<0?Be:e}function Oe(e){const t="default"===e?"gray":e;return(0,l().yK)((e=>{const o="light"===e.mode?400:800,n="light"===e.mode?100:400;return{icon:{fill:e.accentColors[t][o],width:16},iconWrap:{background:e.accentColors[t][n],borderRadius:6,padding:6},iconApp:{width:14,height:14},iconAppWrap:{borderRadius:6,borderWidth:1,borderStyle:"solid",borderColor:e.accentColors.gray[n],padding:6},iconPerson:{display:"block",width:"100%"},iconPersonWrap:{alignItems:"center",display:"flex",height:28,justifyContent:"center",width:28},iconArrow:{fill:e.icon.secondary,width:14,height:14},iconArrowWrap:{background:void 0},truncateWrap:{alignItems:"center",background:e.accentColors.gray[n],color:e.accentColors[t][o],display:"inline-flex",fontSize:12,fontWeight:K().Ue.semibold,height:28,justifyContent:"center",padding:3,width:28}}}),[t])}var Ne=()=>o(752348),We=()=>o(38883),Ue=()=>o(446866),Ge=()=>o(989478),ze=()=>o(955620),$e=()=>o(592479),Ye=()=>o(374784),qe=()=>o(839886),Je=()=>o(859127),Xe=()=>o(282895),Qe=()=>o(395137),et=()=>o(96754),tt=()=>o(152557),ot=()=>o(492120),nt=()=>o(882701),it=()=>o(236647),at=()=>o(344470),rt=()=>o(823718),lt=()=>o(361726),st=()=>o(605252),ct=()=>o(903098),ut=()=>o(194930),dt=()=>o(116291),pt=()=>o(317632),mt=()=>o(796675),gt=()=>o(549813),ht=()=>o(826955);const yt=(0,R().vU)({automationSingleTargetDefault:{defaultMessage:"1 person",id:"database.viewSettings.automationTab.automationSingleTargetDefault"},recurrenceAutomationSummary:{defaultMessage:"Every {frequency}, {actions}",id:"automation.summaryCard.recurrenceCaption"}});function ft(e){const{intl:t,triggerConfig:o}=e;if(o){if("event"===o.type||"notification_event"===o.type){const n=function(e){const{hasAutomationUpdatedErrorStatesEnabled:t,collectionStore:o,environment:n,getRecordModel:i,intl:a,schema:r,typecheckResult:l,triggerConfig:s}=e,{event:u}=s,d=o.getSpaceId(),g=[];u.pagesAdded&&g.push(lt().Mz(a));if("none"===u.pagePropertiesEdited.type);else if("any"===u.pagePropertiesEdited.type)g.push(lt().c5(a));else if("some"===u.pagePropertiesEdited.type||"all"===u.pagePropertiesEdited.type){let e=[];"all"===u.pagePropertiesEdited.type?e=u.pagePropertiesEdited.all??[]:"some"===u.pagePropertiesEdited.type&&(e=u.pagePropertiesEdited.some??[]);for(const s of e){const e=r[s.property];if(!e){g.push(lt().nf(a));continue}if(!c().Ym[e.type]){g.push((0,tt().K1)({propertySchema:e,hasAutomationUpdatedErrorStatesEnabled:t}));continue}const{filter:u}=s;if("changes_to_any"===u.operator)g.push(lt().$G(a,{propertyName:e.name}));else if(p().mv(u))g.push(lt().Vf(a,{propertyName:e.name}));else if(c().bD(e))if("status"===e.type){if(!p().r2(u)||!p().vR(u)){g.push((0,st().Tt)(e));continue}const t=p().wB(u),o=(0,rt().L)({intl:a,groupValues:t.map((e=>"is_group"===e.type?e.value:void 0)).filter(F().$K),isText:!0,optionValues:t.map((e=>"is_option"===e.type?e.value:void 0)).filter(F().$K),propertySchema:e,tokenFormat:We().lo.Small}),n=a.formatList(o,{style:"long",type:"disjunction"});g.push(lt().VO(a,{propertyName:e.name,propertyValues:n}))}else if("select"===e.type||"multi_select"===e.type){if(p().mv(u)||!p().dx(u)&&!p().NU(u)||"select"===e.type&&p().NU(u)||"multi_select"===e.type&&p().dx(u)){g.push((0,st().Tt)(e));continue}const t=Array.isArray(u.value)?u.value:[u.value],o=(0,at().zI)({intl:a,isText:!0,optionValues:t.map((e=>e.value)).filter(F().$K),propertySchema:e,tokenFormat:We().lo.Small}),n=a.formatList(o,{style:"long",type:"disjunction"}),i=(0,at().O1)({filter:u,propertySchema:e});if(i){const t=(0,at().JT)(i);g.push(t(a,{propertyName:e.name,propertyValues:n}))}}else if("checkbox"===e.type){if(!p().XA(u)){g.push((0,st().Tt)(e));continue}g.push((0,ot().l4)({filter:u,propertySchema:e,intl:a}))}else if("person"===e.type){if(!p().Gb(u)){g.push((0,st().Tt)(e));continue}g.push((0,dt().Nv)({actorModels:(0,it().S)(u,i),operator:u.operator,propertySchema:e,intl:a}))}else if("number"===e.type){if(!p().h6(u)){g.push((0,st().Tt)(e));continue}g.push((0,ut().MT)({messageType:"trigger",numberValue:u.value.value,operator:u.operator,propertySchema:e,intl:a}))}else if("email"===e.type||"url"===e.type||"text"===e.type||"phone_number"===e.type||"title"===e.type){if(!p().Ly(u)){g.push((0,st().Tt)(e));continue}"string_is"!==u.operator&&"string_is_not"!==u.operator&&"string_contains"!==u.operator&&"string_does_not_contain"!==u.operator&&"string_starts_with"!==u.operator&&"string_ends_with"!==u.operator||g.push((0,mt().Sm)({messageType:"trigger",textValue:u.value.value,operator:u.operator,propertySchema:e,intl:a}))}else if("relation"===e.type){if(!p().e(u)){g.push((0,st().Tt)(e));continue}if(m().Qh(d,e)){g.push((0,nt().Jw)({propertySchema:e}));continue}const t=(0,pt().RX)({collectionStore:o,filter:u}),i=(0,Ne().getAllContextValues)(l),r=(0,pt().vt)({collectionStore:o,filter:u,propertySchema:e});g.push((0,pt().OI)({availableTokens:r,collectionStore:o,environment:n,operator:u.operator,propertySchema:e,intl:a,relationPages:(0,pt().F2)({value:t.value,automationContextValues:i})}))}else(0,F().t1)(e)}}return a.formatList(g,{style:"long",type:"all"===u.pagePropertiesEdited.type?"conjunction":"disjunction"})}({...e,triggerConfig:o}),i=vt(e);return t.formatMessage({defaultMessage:"When {triggers}, {actions}",id:"automation.summaryCard.caption"},{actions:i,triggers:n})}if("recurrence"===o.type){if(!o.recurrence)return;const n=(0,O().De)({intl:t,recurrence:o.recurrence}),i=vt(e);return t.formatMessage(yt.recurrenceAutomationSummary,{frequency:n,actions:i})}"button"!==o.type&&(0,F().t1)(o)}}function vt(e){var t,o;const{actionStores:n,collectionStore:i,environment:a,intl:r,schema:l,typecheckResult:u,hasAutomationUpdatedErrorStatesEnabled:d}=e,p=[];for(const j of n)if(j.isType("slack_notification"))p.push((0,w.jsx)(R()._H,{defaultMessage:"notify {channel}",id:"CollectionSettingsAutomationsView.summaryCard.slackAction",values:{channel:(0,w.jsx)($e().pZ,{actionStore:j})}}));else if(j.isType("update_pages")){const e=j.getConfig(),t=null==e?void 0:e.properties,o=null==e?void 0:e.values,n=null==e?void 0:e.target;if(!t||0===t.length||!n)continue;if("collection"===n.type)if((0,B().qo)(n.collection,i.pointer))p.push((0,w.jsx)(R()._H,{defaultMessage:"edit pages in this collection",id:"automation.summaryCard.updatePages.sameCollection"}));else{const e=ht().NW.createChildStore(i,n.collection),t=(0,gt().vU)({environment:a,intl:r,store:e});p.push((0,w.jsx)(R()._H,{defaultMessage:"edit pages in {collectionTitle}",id:"automation.summaryCard.updatePages.differentCollection",values:{collectionTitle:t}}))}else if("variable"===n.type){const e=t[0],n=l[e],a=null==o?void 0:o[e];if(!n){p.push(lt().aD(r));continue}if(!a)continue;if(c().SF(n))if("person"===n.type)p.push((0,w.jsx)(jt,{collectionStore:i,contextValues:(0,Ne().getAllContextValues)(u),propertyActionValue:a,propertySchema:n}));else if("status"===n.type){const e=(0,w.jsx)(xt,{propertyActionValue:a,propertySchema:n});e&&p.push(e)}else if("select"===n.type||"multi_select"===n.type)p.push((0,w.jsx)(bt,{propertyActionValue:a,propertySchema:n}));else if("checkbox"===n.type)p.push((0,w.jsx)(St,{propertyActionValue:a,propertySchema:n}));else if("relation"===n.type)p.push((0,w.jsx)(Ct,{collectionStore:i,propertyActionValue:a,propertySchema:n}));else if("date"===n.type){const t=(0,w.jsx)(kt,{automationActionId:j.id,collectionStore:i,propertyActionValue:a,propertyId:e,propertySchema:n});t&&p.push(t)}else"number"===n.type||"phone_number"===n.type||"text"===n.type||"title"===n.type||"email"===n.type||"url"===n.type?p.push((0,w.jsx)(Mt,{automationActionId:j.id,propertyActionValue:a,propertySchema:n})):(0,F().t1)(n);else p.push((0,tt().K1)({propertySchema:n,hasAutomationUpdatedErrorStatesEnabled:d}))}}else if(j.isType("create_page")){var m;const e=null===(m=j.getConfig())||void 0===m?void 0:m.collection;if(!e)continue;e.id===i.pointer.id?p.push((0,w.jsx)(R()._H,{defaultMessage:"create a page in this database",id:"automation.summaryCard.createPageThisDatabase"})):p.push((0,w.jsx)(R()._H,{defaultMessage:"create a page in another database",id:"automation.summaryCard.createPageAnotherDatabase"}))}else if(j.isType("define_variables")){var g;p.push((0,w.jsx)(R()._H,{defaultMessage:"define {numVariables} custom {numVariables, plural, one {variable} other {variables}}",values:{numVariables:(null===(g=j.getConfig())||void 0===g||null===(g=g.variableIds)||void 0===g?void 0:g.length)??0},id:"automation.summaryCard.defineVariables"}))}else if(j.isType("send_in_app_notification")){var h;const e=null===(h=j.getConfig())||void 0===h?void 0:h.target;if(!e)continue;const n=e.type;switch(n){case"formula":const a=(0,ze().lcG)(null===(t=e.value)||void 0===t?void 0:t.value),l=(0,ze().oOk)(null===(o=e.value)||void 0===o?void 0:o.value),c=e=>{const t=j.getSpaceId()??"";return{table:Ge().KJ,id:e,spaceId:t}},u=a.map((e=>c(e))),d=u.map((e=>(0,s().Hl)({getRecordModel:i.getRecordModel,pointer:e}))).filter(F().$K).map((e=>(0,s().$4)(r,e)));p.push((0,w.jsx)(R()._H,{defaultMessage:"{numTargets, plural, one {send a notification to {singleTarget}} other {send a notification to {numTargets} people}}",values:{numTargets:u.length+l.length,singleTarget:u.length>0?d[0]:J().SO.created_by},id:"automation.summaryCard.sendNotificationUserTarget"}));break;case"property":if(!e.propertyId)break;let m;const g=i.getSchema()[e.propertyId];m=g?g.name??J().SO[g.type]:lt().Bo.unknownPropertyTitle.defaultMessage,p.push((0,w.jsx)(R()._H,{defaultMessage:"send a notification to {propertyDisplayName}",values:{propertyDisplayName:m},id:"automation.summaryCard.sendNotificationPropertyTarget"}));break;default:(0,F().t1)(n)}}else if(j.isType("send_gmail_notification")){var y,f,v,x;const e=j.getConfig()??{},{to:t,cc:o,bcc:n}=e;if(null==t||null===(y=t.value)||void 0===y||!y.value)continue;if("formula"===(null==t||null===(f=t.value)||void 0===f?void 0:f.type)||"formula"===(null==o||null===(v=o.value)||void 0===v?void 0:v.type)||"formula"===(null==n||null===(x=n.value)||void 0===x?void 0:x.type))p.push((0,w.jsx)(R()._H,{defaultMessage:"send an email to recipients based on a formula",id:"automation.summaryCard.sendGmailNotificationUserFormulaTarget"}));else{var b,S,C,k,M;const e=[...null===(b=t.value)||void 0===b?void 0:b.value,...(null==o||null===(S=o.value)||void 0===S?void 0:S.value)||[],...(null==n||null===(C=n.value)||void 0===C?void 0:C.value)||[]],a=(0,ze().lcG)(e),l=(0,ze().oOk)(null===(k=t.value)||void 0===k?void 0:k.value),c=(0,ze().jyE)(e),u=e=>{const t=j.getSpaceId()??"";return{table:Ge().KJ,id:e,spaceId:t}},d=a.map((e=>(0,s().Hl)({getRecordModel:i.getRecordModel,pointer:u(e)}))).filter(F().$K).map((e=>(0,s().$4)(r,e))),m=(0,Ue().CU)((0,ze().Jcv)(e));d.push(...m);const g=d[0]||(null===(M=c[0])||void 0===M?void 0:M.name)||r.formatMessage(yt.automationSingleTargetDefault);p.push((0,w.jsx)(R()._H,{defaultMessage:"{numTargets, plural, one {send an email to {singleTarget}} other {send an email to {numTargets} people}}",values:{numTargets:new Set(d).size+l.length+c.length,singleTarget:g},id:"automation.summaryCard.sendGmailNotificationUserTarget"}))}}else j.isType("http_request")&&p.push((0,w.jsx)(R()._H,{defaultMessage:"send a webhook",id:"automation.summaryCard.sendWebRequest"}));return r.formatList(p,{style:"long",type:"conjunction"})}function xt(e){const{propertyActionValue:t,propertySchema:o}=e,n=(0,R().YB)(),i=(0,Qe().LQ)({intl:n,propertySchema:o,value:t.value});return i||null}function bt(e){const{propertyActionValue:t,propertySchema:o}=e,n=(0,R().YB)();return(0,r().VK)((()=>(0,Xe().I7)({intl:n,limit:Je().H,propertySchema:o,operator:null==t?void 0:t.action,value:t.value})),[n,null==t?void 0:t.action,t.value,o])}function St(e){const{propertyActionValue:t,propertySchema:o}=e;return(0,Ye().G7)({propertySchema:o,value:t.value})}function Ct(e){const{collectionStore:t,propertyActionValue:o,propertySchema:n}=e,i=(0,R().YB)(),l=(0,a().O7)(),{typecheckResult:s}=(0,L().YC)(),c=o.value,u=(0,Ne().getAllContextValues)(s),d=(0,pt().F2)({automationContextValues:u,limit:n.limit,value:c});return(0,r().VK)((()=>(0,pt().wr)({collectionStore:t,environment:l,intl:i,operator:null==o?void 0:o.action,propertySchema:n,relationPages:d,value:c})),[t,l,i,null==o?void 0:o.action,n,d,c])}function kt(e){const{automationActionId:t,collectionStore:o,propertyActionValue:n,propertyId:a,propertySchema:l}=e,s=(0,R().YB)(),c=n.value,u=(0,ct().z)({actionId:t}),d=(0,i.useMemo)((()=>({type:"collection",collectionStore:o,property:a})),[o,a]),p=(0,r().VK)((()=>(0,qe().k)({intl:s,propertySchema:l,typecheckContextValues:u,value:c,valueContext:d})),[s,l,u,c,d]);return p||null}function Mt(e){const{automationActionId:t,propertyActionValue:o,propertySchema:n}=e,i=(0,a().O7)(),s=(0,l().Fg)(),{automationStore:c}=(0,L().YC)(),u=(0,ct().z)({actionId:t}),d=(0,r().VK)((()=>(0,et().lG)({automationStore:c,environment:i,propertySchema:n,theme:s,typecheckContextValues:u,value:o.value})),[c,i,o.value,n,s,u]);return d||null}function jt(e){const{collectionStore:t,propertyActionValue:o,propertySchema:n,contextValues:i}=e,a=(0,R().YB)(),l=(0,r().VK)((()=>(0,dt().y3)({getRecordModel:t.getRecordModel,contextValues:i,intl:a,operator:o.action,propertySchema:n,value:o.value})),[t.getRecordModel,a,o.action,o.value,n,i]);return l||null}var Tt=()=>o(730120),wt=()=>o(794623),At=()=>o(779247),It=()=>o(269299),_t=()=>o(348141),Pt=()=>o(603692),Vt=()=>o(917949),Bt=()=>o(644248),Rt=()=>o(397079);const Ft=(0,R().vU)({whatsNewTitle:{defaultMessage:"See whatâs new",id:"database.viewSettings.automationTab.automationWhatsNewTitle"},whatsNewUrl:{defaultMessage:"URL to show whatâs new",id:"database.viewSettings.automationTab.automationWhatsNewUrl"},tryRepeatingTriggersTitle:{defaultMessage:"Try repeating triggers",id:"database.viewSettings.automationTab.automationWhatsNew.tryRepeatingTriggersTitle"},tryRepeatingTriggersBody:{defaultMessage:"Automatically create and edit items on a schedule",id:"database.viewSettings.automationTab.automationWhatsNew.tryRepeatingTriggersBody"}}),Kt={try_repeating_triggers:{title:Ft.tryRepeatingTriggersTitle,body:Ft.tryRepeatingTriggersBody,url:"https://www.notion.com/help/database-automations#database-automation-triggers"}};function Zt(e){let{collectionStoreId:t,surface:o,type:n}=e;const[s,c]=(0,i.useState)(!0),[u,d]=(0,Bt().C)(),[p,m]=(0,Rt().V)(),g=(0,wt().Z)(u,p),h=(0,a().O7)(),y=(0,r().VK)((()=>{const{currentUserSettingsStore:e}=oe().default.state;if(!e||!e.isReady())return!1;const t=e.getSettingsStore().getKeyStore(`has_clicked_${n}_prompt`).getValue(),o=e.getSettingsStore().getKeyStore(`has_clicked_close_${n}_prompt`).getValue();if(t||o)return!1;const i=e.getSettingsStore().getKeyStore(`seen_${n}_prompt_at`).getValue();if((0,F().$K)(i)){const e=Tt().ou.fromMillis(i),t=Tt().ou.fromMillis(Tt().ou.now().toMillis()).diff(e,["weeks"]),o=t.toObject().weeks??0;return(0,F().$K)(t.toObject().weeks)&&o<=5}return It().createAndCommit({userAction:"AutomationsView.markPromptFirstSeen",environment:h,canUndo:!0,perform:t=>{_t().d2({userSettingsStore:e,transaction:t,data:{[`seen_${n}_prompt_at`]:Tt().ou.now().toMillis()}})}}),!0}),[h,n]),f=(0,l().yK)((e=>({title:{alignItems:"center",display:"flex",color:e.regularTextColor,lineHeight:"20px",flexDirection:"row",gap:"2px"},container:{background:e.tint.regular,borderRadius:10,cursor:"pointer",display:"block",height:"fit-content",textDecoration:"none",position:"relative"},description:{fontSize:"14px",lineHeight:"20px"},promptContainer:{padding:"9px 12px"},hoverPressedLayer:{backgroundColor:"transparent",borderRadius:10,height:"100%",position:"absolute",width:"100%",...d?{backgroundColor:"light"===e.mode?e.accentColors.translucentGray[50]:e.accentColors.translucentGray[200]}:{},...m?{backgroundColor:e.accentColors.translucentGray[300]}:{}},titleLinkButton:{marginLeft:"2px"},dismissIconStyles:{color:e.icon.secondary,display:d||m?"block":"none"},dismissButtonStyles:{alignItems:"center",borderRadius:4,display:"flex",height:20,justifyContent:"center",marginRight:-10,marginTop:-4,width:20}})),[d,m]),v=(0,i.useCallback)((()=>{if(!t)return;(0,q().j)({environment:h,event:{eventName:"automation_learn_click",eventProperties:{collection_id:t,specific_feature:n,surface:o}}});const{currentUserSettingsStore:e}=oe().default.state;e&&e.isReady()&&It().createAndCommit({userAction:"AutomationsView.markPromptLinkClicked",environment:h,canUndo:!0,perform:t=>{_t().d2({userSettingsStore:e,transaction:t,data:{[`has_clicked_${n}_prompt`]:!0}})}})}),[t,n,o,h]),x=(0,i.useCallback)((e=>{if(e.preventDefault(),e.stopPropagation(),c(!1),!t)return;(0,q().j)({environment:h,event:{eventName:"automation_close_learn_prompt",eventProperties:{collection_id:t,specific_feature:n,surface:o}}});const{currentUserSettingsStore:i}=oe().default.state;i&&i.isReady()&&It().createAndCommit({userAction:"AutomationsView.markPromptDismissed",environment:h,canUndo:!0,perform:e=>{_t().d2({userSettingsStore:i,transaction:e,data:{[`has_clicked_close_${n}_prompt`]:!0}})}})}),[t,h,o,n]);return s&&y?(0,w.jsx)("div",{ref:g,children:(0,w.jsxs)(U().Z,{href:Kt[n].url,external:!0,onClick:v,style:f.container,children:[(m||d)&&(0,w.jsx)("div",{style:f.hoverPressedLayer}),(0,w.jsx)(Vt().N,{title:(0,w.jsxs)("div",{style:f.title,children:[(0,w.jsx)(R()._H,{...Kt[n].title}),(0,w.jsx)(Pt().y,{iconGroup:At().T,variantName:"mini",colorName:"secondary"})]}),description:(0,w.jsx)("span",{style:f.description,children:(0,w.jsx)(R()._H,{...Kt[n].body})}),onDismiss:x,customDismissIconStyles:f.dismissIconStyles,customContainerStyles:f.promptContainer,customDismissButtonStyles:f.dismissButtonStyles})]})}):null}const Et=(0,R().vU)({automationTabTitle:{defaultMessage:"Automations",id:"database.viewSettings.automationTab.title"},automationTabFilterButton:{defaultMessage:"Filter",id:"database.viewSettings.automationTab.filterButton"},automationTabAddFilterButton:{defaultMessage:"Add filter",id:"database.viewSettings.automationTab.addFilterButton"},automationTabFilterMenuSearchInputPlaceholder:{defaultMessage:"Filter byâ¦",id:"database.viewSettings.automationTab.filterMenuSearchInputPlaceholder"},automationTabFilterMenuNoResults:{defaultMessage:"No results",id:"database.viewSettings.automationTab.filterMenuNoResults"},automationNewAutomationTitle:{defaultMessage:"New automation",id:"database.viewSettings.automationTab.newAutomationTitle"},automationLearnAutomationTitle:{defaultMessage:"Learn about automations",id:"database.viewSettings.automationTab.learnAutomationTitle"},automationDisabledCaption:{defaultMessage:"Paused",id:"database.viewSettings.automationTab.disabledCaption"},automationEmptyViewEditorPublic:{defaultMessage:"Automatically edit properties, create pages, send updates, and more",id:"database.viewSettings.automationTab.automationEmptyViewEditorPublic"},automationEmptyViewReadOnly:{defaultMessage:"You're a content viewer. Content viewers cannot create automations.",id:"database.viewSettings.automationTab.automationEmptyViewReadOnly"},automationEmptyViewContentOnly:{defaultMessage:"You're a content editor. Content editors can edit pages, but cannot create automations.",id:"database.viewSettings.automationTab.automationEmptyViewContentOnly"},automationSearchPlaceholder:{defaultMessage:"Search automationsâ¦",id:"database.viewSettings.automationTab.automationSearchPlaceholder"},automationInvalidPausedCaption:{defaultMessage:"Fix any errors or remove failing steps to enable this automation",id:"database.viewSettings.automationTab.automationInvalidPausedCaption"},automationInvalidActiveCaption:{defaultMessage:"Fix any errors or remove failing steps to prevent this automation from pausing on failure",id:"database.viewSettings.automationTab.automationInvalidActiveCaption"},automationRestartSuccessMessage:{defaultMessage:"Restarted automation successfully",id:"automations.buttonTrigger.restartSuccessMessage"}});function Ht(e){const{collectionContextStore:t,collectionSettingsStore:o,fullHeight:s,tabSettings:c}=e,u=(0,a().O7)(),d=(0,R().YB)(),{isMobile:p}=(0,a().Fy)(),[m,g]=(0,i.useState)(""),h=(0,r().VK)((()=>t.collectionStore()),[t]),y=(0,r().VK)((()=>t.collectionViewBlockStore()),[t]),f=(0,r().VK)((()=>h&&h.id),[h]),v=(0,r().VK)((()=>null==h?void 0:h.getSchema()),[h]),x=(0,r().VK)((()=>null==h?void 0:h.getFormat()),[h]),b=(0,r().VK)((()=>function(e){const{collectionStore:t,collectionViewBlockStore:o}=e;if(!t||!o)return[];const n=t.getAutomationStores(),i=[];for(const a of n){const e=a.getModel();null!=e&&e.getAlive()&&(a.isDisplayableInCollectionSettings()&&i.push(a))}return i}({collectionStore:h,collectionViewBlockStore:y})),[h,y]),C=(0,r().VK)((()=>function(e){const{automationStores:t,collectionSchema:o,intl:i}=e,a=new Map,r=[];for(const n of t){var l;if(!n.isDefined())continue;const e=[],t=n.getName();void 0!==t&&e.push(t);const s=null===(l=n.getOwnerStore())||void 0===l?void 0:l.getDisplayName(i);if(void 0!==s&&e.push(s),n.isTriggerType("event")||n.isTriggerType("notification_event")){const t=n.getEventConfiguration(),a=null==t?void 0:t.pagePropertiesEdited;let r;if("some"===(null==a?void 0:a.type)?r=a.some:"all"===(null==a?void 0:a.type)&&(r=a.all),r)for(const n of r){const t=null==o?void 0:o[n.property];t&&e.push(`${t.name} ${J().SO[t.type]}`)}const l=Wt(n.getActionStores(),o,i);e.push(...l)}else if(n.isTriggerType("recurrence")){const t=n.getRecurrence();t&&e.push((0,O().De)({recurrence:t,intl:i,leadingPhrase:"every"}));const a=Wt(n.getActionStores(),o,i);e.push(...a)}const c=e.join(" ");a.set(n.id,c),r.push(c)}return function(e){const o=new Set(n().filter(e,r).map((e=>{let{original:t}=e;return t})));return t.filter((0,F().AO)((e=>{if(!e.isTriggerType("event")&&!e.isTriggerType("notification_event")&&!e.isTriggerType("recurrence"))return{false:e};const t=a.get(e.id);return t&&o.has(t)?{true:e}:{false:e}})))}}({automationStores:b,collectionSchema:v,intl:d})),[b,v,d]),M=(0,r().VK)((()=>C(m)),[C,m]),j=(0,r().VK)((()=>X().Li({collectionStore:h})),[h]),T=(0,i.useCallback)((()=>{Z().Uk({environment:u,collectionSettingsStore:o,collectionContextStore:t})}),[u,o,t]),A=(0,i.useCallback)((e=>g(e.target.value)),[]),I=(0,i.useCallback)((()=>{f&&(0,q().j)({environment:u,event:{eventName:"automation_learn_click",eventProperties:{collection_id:f}}})}),[u,f]);(0,i.useEffect)((()=>{f&&((0,q().j)({environment:u,event:{eventName:"automation_list_view",eventProperties:{source:c.source,collection_id:f}}}),ne().default.logEvent("automation_list_view","true"))}),[u,f,c]);const[_,P]=i.useState(!1),V=(0,r().VK)((()=>function(e){var t;const o=null===(t=oe().default.state.currentUserStore)||void 0===t?void 0:t.pointer,n=[],i=[];for(const a of e){const e=a.getCreatedByPointer();o&&e&&B().dr.isEqual(o,e)?n.push(a):i.push(a)}return n.sort(((e,t)=>t.getLastEditedTime()-e.getLastEditedTime())),i.sort(((e,t)=>t.getLastEditedTime()-e.getLastEditedTime())),{currentUserAutomations:n,otherUserAutomations:i}}(M)),[M]),K=(0,i.useMemo)((()=>{const{currentUserAutomations:e,otherUserAutomations:t}=V;return _?[...e,...t]:e.length>0?e:t}),[V,_]),E=M.length-K.length,H=!_&&E>0,D=K.length>0,Q=!D&&!(""!==m),ae=(0,ee().E)("automation_generalized_recurrence"),{currentSpaceStoreId:re,currentUserStoreId:le}=(0,r().VK)((()=>{var e,t;return{currentSpaceStoreId:null===(e=oe().default.state.currentSpaceStore)||void 0===e?void 0:e.id,currentUserStoreId:null===(t=oe().default.state.currentUserStore)||void 0===t?void 0:t.id}}),[]),se=(0,ie().VX)({name:"premium_automations",spaceId:re,userId:le}),ce=(0,r().VK)((()=>X().Li({collectionStore:h})),[h]),ue=se&&ae&&ce,de=(0,l().yK)((e=>({buttonList:{display:"flex",flexDirection:"column",flexShrink:1,gap:12,overflow:"hidden auto",paddingBlockEnd:p?0:12,paddingBlockStart:p?12:0,paddingInline:12},emptyViewWrap:{paddingBlockEnd:12,paddingInline:12},menuScrollerStyle:{marginBlockStart:p?12:8},wrap:{display:"flex",flexDirection:"column"},showMoreButtonContainer:{marginLeft:12,marginBottom:12,marginRight:"auto"},showMoreButtonContent:{fontSize:12},noResultsTitle:{color:e.text.secondary,fontSize:12,margin:0},createSection:{paddingBlock:20},createButtonWrapper:{paddingInline:12},createButton:{width:"100%",display:"flex",gap:6},headerContainer:{alignItems:"center",display:"flex",gap:4},headerInfoIcon:{fill:e.mediumIconColor,height:14,width:14}})),[p]);return h&&v&&x&&y?(0,w.jsx)(N().ZP,{...e,fullHeight:s,header:!Q&&(0,w.jsx)(z().Z,{children:(0,w.jsx)(W().ZP,{focusInitial:!p,onChange:A,placeholder:d.formatMessage(Et.automationSearchPlaceholder),showClearButton:!0,value:m})}),footer:(0,w.jsx)(z().Z,{style:de.createSection,topBorder:!1,children:j&&(0,w.jsx)("div",{style:de.createButtonWrapper,children:(0,w.jsxs)(G().Z,{style:de.createButton,onClick:T,children:[(0,k().R)({width:14,height:14}),(0,w.jsx)(R()._H,{...Et.automationNewAutomationTitle})]})})}),menuScrollerStyle:de.menuScrollerStyle,title:D||m?(0,w.jsxs)("div",{style:de.headerContainer,children:[(0,w.jsx)(R()._H,{...Et.automationTabTitle}),(0,w.jsx)(Y().Z,{placement:te().Placement.Right,renderTooltip:()=>(0,w.jsx)(R()._H,{...Et.automationLearnAutomationTitle}),render:e=>(0,w.jsx)(U().Z,{...e,href:"https://www.notion.so/help/database-automations",external:!0,onClick:I,children:(0,S().m)(de.headerInfoIcon)})})]}):null,children:(0,w.jsx)("div",{style:de.wrap,children:Q?(0,w.jsxs)("div",{style:de.emptyViewWrap,children:[(0,w.jsx)(Dt,{collectionStore:h}),ue&&(0,w.jsx)(Zt,{surface:"empty_automations_view",type:"try_repeating_triggers",collectionStoreId:f})]}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{style:de.buttonList,children:[ue&&(0,w.jsx)(Zt,{surface:"list_automations_view",type:"try_repeating_triggers",collectionStoreId:f}),K.length>0?K.map(((e,n)=>(0,w.jsx)(L().gJ,{automationStore:e,children:(0,w.jsx)(Ot,{collectionContextStore:t,collectionStore:h,collectionSettingsStore:o,focused:!1,schema:v})},e.id))):(0,w.jsx)("p",{style:de.noResultsTitle,children:(0,w.jsx)(R()._H,{defaultMessage:"No results",id:"collectionSettings.automationsView.noResults"})})]}),H&&(0,w.jsx)($().Z,{style:de.showMoreButtonContainer,onClick:e=>{e.stopPropagation(),P(!0)},children:(0,w.jsx)("div",{style:de.showMoreButtonContent,children:(0,w.jsx)(R()._H,{id:"collectionSettings.automationsView.showMore",defaultMessage:"Show {number} more",values:{number:E}})})})]})})}):null}function Dt(e){const{collectionStore:t}=e,o=(0,a().O7)(),n=(0,l().yK)((e=>({wrap:{alignItems:"center",display:"flex",flexDirection:"column",gap:7.5,justifyContent:"center",minHeight:250,textAlign:"center"},icon:{fill:e.icon.yellowPrimary,height:24,width:24},title:{fontSize:17,fontWeight:K().Ue.medium,margin:0},copy:{color:e.text.secondary,fontSize:14,margin:0,lineHeight:1.5}})),[]),i=(0,r().VK)((()=>t.getRole()),[t]);let s;return s=(0,r().VK)((()=>Boolean((0,Q().eV)(o,t))),[t,o])||!i||"editor"===i?Et.automationEmptyViewEditorPublic:"reader"===i||"comment_only"===i?Et.automationEmptyViewReadOnly:"content_only_editor"===i||"read_and_write"===i?Et.automationEmptyViewContentOnly:Et.automationEmptyViewEditorPublic,(0,w.jsxs)("div",{style:n.wrap,children:[(0,w.jsx)("div",{"aria-hidden":!0,children:(0,f().K)(n.icon)}),(0,w.jsx)("p",{style:n.title,children:(0,w.jsx)(R()._H,{...Et.automationTabTitle})}),(0,w.jsx)("p",{style:n.copy,children:(0,w.jsx)(R()._H,{...s})})]})}const Lt={text:P().p,number:o(121183).J,url:o(454069).O,file:o(208444).Z,date:o(587080).V,person:o(923398).O,email:o(759366).n,phone_number:o(984709).u,checkbox:o(544672).r,select:o(870960).w,multi_select:I().A,status:_().T,relation:o(545914).v,rollup:o(720927).G,formula:o(2403).D,created_time:j().I,created_by:T().H,title:o(562027).c,last_edited_time:j().I,last_edited_by:T().H,last_visited_time:j().I,button:_().T,auto_increment_id:o(221065).A,location:A,verification:o(836083).f,geo_point:A,ai_summary:o(918579).Y,ai_custom_prompt:o(949489).y,ai_extract:I().A,ai_translate:o(825350).Q,ai_keywords:o(25702).F};function Ot(e){const{collectionContextStore:t,collectionStore:o,collectionSettingsStore:n,focused:l,schema:u}=e,d=(0,R().YB)(),f=(0,a().O7)(),{automationStore:S,typecheckResult:j}=(0,L().YC)(),T=(0,r().VK)((()=>X().qk({automationStore:S,collectionStore:o,typecheckResult:j})),[S,o,j]),A=(0,r().VK)((()=>S.getActionStores()),[S]),I=(0,r().VK)((()=>S.getTriggerStore().getValue()),[S]),_=(0,r().VK)((()=>S.getNameWithDefault(d)),[d,S]),V=(0,r().VK)((()=>S.isActive()),[S]),B=(0,r().Kw)(t.aliveAutomationCountStore),K=(0,r().VK)((()=>X().i1({actionStores:A,automationStore:S,collectionStore:o})),[A,S,o]),N=(0,r().VK)((()=>X().qM({automationStore:S,collectionStore:o})),[S,o]),W=(0,i.useCallback)((async()=>{await ae().SC({collectionStore:o,environment:f,existingAutomationStore:S,intl:d,onDelete:()=>{1===B&&Z().wl({collectionSettingsStore:n,item:{type:"main"}})}})}),[d,f,o,n,S,B]),U=(0,i.useCallback)((()=>{ae().j3({automationStore:S,environment:f})}),[f,S]),G=(0,i.useCallback)((()=>{H().b({environment:f,mode:"edit_automation",collectionSettingsStore:n,collectionContextStore:t,automationId:S.id,source:"collection_settings_automation_view"})}),[f,n,t,S]),z=(0,i.useCallback)((()=>{ae().$K({automationStore:S,environment:f})}),[f,S]),$=(0,i.useCallback)((()=>{ae().HF({automationStore:S,collectionStore:o,environment:f})}),[S,o,f]),Y=(0,i.useCallback)((()=>{if(!S.isTriggerType("recurrence"))return;ae().JU({automationStore:S,collectionStore:o,environment:f});const e=d.formatMessage(Et.automationRestartSuccessMessage);E().oV({label:e})}),[S,o,f,d]),q=(0,r().VK)((()=>I?function(e){const{schema:t,triggerConfig:o,collectionStore:n}=e,i=[];if("notification_event"===o.type||"event"===o.type){o.event.pagesAdded&&i.push({color:"blue",icon:k().R,type:"page"});const e=o.event.pagePropertiesEdited;if("any"===e.type)i.push({color:"blue",icon:C().R,type:"misc"});else if("some"===e.type||"all"===e.type){let o=[];"some"===e.type?o=e.some??[]:"all"===e.type&&(o=e.all??[]);for(const e of o){const o=t[e.property],a=e.filter;if(!o)continue;if(!c().Ym[o.type]){i.push({color:"gray",icon:Nt(o.type),type:"property"});continue}const r=m().gB(o),l=m().cu(o),u=m().KR(o),d=m().G$(o),h=(0,g().TN)(o.type),y=m().p_(o);if("changes_to_any"===a.operator)i.push({color:r||l?"gray":"blue",icon:Nt(o.type),type:"property"});else if(r&&!p().mv(a)&&p().r2(a)){const e=p().wB(a);if(e.length>1)i.push({color:"gray",icon:Nt(o.type),type:"property"});else if(1===e.length){const t=e[0];if("is_group"===t.type){const e=(o.groups??[]).find((e=>e.name===t.value));e&&i.push({color:e.color??"gray",icon:Nt(o.type),type:"property"})}else{const e=(o.options??[]).find((e=>e.value===t.value));e&&i.push({color:e.color??"gray",icon:Nt(o.type),type:"property"})}}}else if(l&&(p().dx(a)||p().NU(a))){const e=p().mv(a)?[]:p().dx(a)?p().mg(a):p().qC(a);if(1===e.length){const t=e[0],n=(o.options??[]).find((e=>e.value===t.value));n&&i.push({color:n.color??"gray",icon:Nt(o.type),type:"property"})}else(e.length>1||0===e.length)&&i.push({color:"gray",icon:Nt(o.type),type:"property"})}else if(u&&p().Gb(a)){const e=p().mv(a)?[]:p().R8(a);if(1===e.length){if(!p().mv(a)){const e=p().R8(a)[0];if("exact"===e.type&&e.value){const t=(0,s().Hl)({pointer:e.value,getRecordValue:n.getRecordValue});i.push({actor:t,type:"person"})}}}else(e.length>1||0===e.length)&&i.push({color:"gray",icon:Nt(o.type),type:"property"})}else(d&&p().h6(a)||h&&p().Ly(a)||y&&p().e(a))&&i.push({color:"is_empty"===a.operator?"gray":"blue",icon:Nt(o.type),type:"property"})}}}else"recurrence"===o.type?i.push({color:"blue",icon:v().C,type:"misc"}):"button"===o.type||(0,F().t1)(o);return i}({schema:u,triggerConfig:I,collectionStore:o}):[]),[u,I,o]),J=(0,r().VK)((()=>function(e){const{actionStores:t,collectionStore:o,schema:n}=e,i=[];for(const d of t)if(d.isType("slack_notification"))i.push({icon:M().P,type:"app"});else if(d.isType("update_pages")){const e=d.getConfig(),t=(null==e?void 0:e.properties)??[];if(1===t.length){var a,r;const u=t[0],d=n[u],p=null==e||null===(a=e.values)||void 0===a?void 0:a[u];if(!d||!p)continue;if(!c().SF(d)){i.push({color:"gray",icon:Nt(d.type),type:"property"});continue}const y=(0,h().fromSimpleFormulaArrayValue)(null===(r=p.value)||void 0===r?void 0:r.value);if(m().gB(d)){const e=(d.options||[]).find((e=>e.value===y[0]));e&&i.push({color:e.color??"gray",icon:Nt(d.type),type:"property"})}else if(m().cu(d))if(1===y.length){const e=(d.options||[]).find((e=>e.value===y[0]));e&&i.push({color:e.color??"gray",icon:Nt(d.type),type:"property"})}else y.length>1&&i.push({color:"gray",icon:Nt(d.type),type:"property"});else if(m().KR(d)){var l;const e=(0,g().DW)({textValue:null===(l=p.value)||void 0===l?void 0:l.value,propertySchema:d,blockCreatorPointer:void 0}).map((e=>(0,s().Hl)({pointer:e,getRecordValue:o.getRecordValue})));1===e.length?i.push({actor:e[0],type:"person"}):i.push({color:"gray",icon:Nt(d.type),type:"property"})}else i.push({color:"gray",icon:Nt(d.type),type:"property"})}else t.length>1&&i.push({color:"gray",icon:C().R,type:"misc"})}else if(d.isType("create_page")){var u;(null===(u=d.getConfig())||void 0===u?void 0:u.collection)&&i.push({color:"blue",icon:k().R,type:"page"})}else d.isType("send_in_app_notification")?i.push({color:"blue",icon:y().t,type:"misc"}):d.isType("define_variables")?i.push({color:"gray",icon:P().p,type:"misc"}):d.isType("send_gmail_notification")?i.push({icon:b().w,type:"app"}):d.isType("http_request")&&i.push({color:"gray",icon:e=>(0,x().y)({transform:"scale(1.35)",...e}),type:"misc"});return i}({actionStores:A,collectionStore:o,schema:u})),[u,o,A]),Q=(0,r().VK)((()=>{if(S.isTriggerType("event")||S.isTriggerType("notification_event")){return!S.getTrigger()||X().vM({automationStore:S,collectionStore:o})}return!1}),[S,o]),oe=(0,i.useMemo)((()=>{if(j.error)return!0;const e=j.value.actionValidationFailures;return Object.values(e).flat().length>0}),[j]),ne=(0,ee().E)("automation_updated_error_states"),ie=(0,r().VK)((()=>{var e,t;const o=null===(e=S.getModel())||void 0===e?void 0:e.getLastFailedTime(),n=null===(t=S.getModel())||void 0===t?void 0:t.getLastExecutedTime();if(ne){if(oe||Q||!T)return"invalid";if(o&&n&&o>=n&&!V)return"failing";if(!V)return(0,O().HH)(S)?"expired":"paused"}else{if(oe||Q)return"error";if(!V)return"warning"}return"success"}),[S,ne,oe,Q,T,V]),{caption:re,tooltipCaption:le}=(0,r().VK)((()=>{const e=V||ne?ft({actionStores:A,collectionStore:o,environment:f,getRecordModel:S.getRecordModel,intl:d,schema:u,triggerConfig:I,typecheckResult:j,hasAutomationUpdatedErrorStatesEnabled:ne}):d.formatMessage(Et.automationDisabledCaption);return{caption:e,tooltipCaption:ne&&"invalid"===ie?(0,w.jsx)(R()._H,{...V?Et.automationInvalidActiveCaption:Et.automationInvalidPausedCaption}):e}}),[V,ne,d,A,o,f,S.getRecordModel,u,I,j,ie]),se=(0,i.useCallback)((e=>(0,i.createElement)(Re,{...e,key:S.id,actions:J,caption:re,focused:l,status:ie,onClick:G,onDelete:N?W:void 0,onDisable:V&&N&&T?U:void 0,onRestart:"expired"===ie?Y:void 0,onDuplicate:K?$:void 0,onEdit:K?G:void 0,onEnable:!V&&N&&T?z:void 0,title:_,triggers:q})),[J,S.id,K,N,re,l,ie,V,T,W,U,$,G,z,Y,_,q]);return(0,w.jsx)(D().y,{caption:le,renderOrigin:se,title:_,tooltipAlignment:te().Alignment.Start,tooltipPlacement:te().Placement.Left})}function Nt(e){return(0,F().$K)(e)?Lt[e]??V().S:V().S}function Wt(e,t,o){const n=[];for(const a of e){const e=a.getType();if(e){const t=(0,u().getActionRegistryItem)(e);(0,d().Xp)(t)&&n.push(o.formatMessage(t.display.name))}if(a.isType("create_page")||a.isType("update_pages")){var i;const e=a.getConfig();null==e||null===(i=e.properties)||void 0===i||i.forEach((e=>{const o=null==t?void 0:t[e];o&&n.push(`${o.name} ${J().SO[o.type]}`)}))}}return n}},675393:(e,t,o)=>{o.d(t,{DG:()=>h,Di:()=>i,F7:()=>c,Lq:()=>u,Q3:()=>s,ZH:()=>p,aL:()=>l,aP:()=>f,db:()=>a,gS:()=>S,i4:()=>g,lG:()=>x,mN:()=>b,oC:()=>m,op:()=>y,pn:()=>d,q4:()=>r,w3:()=>v});var n=()=>o(677559);const i=new(n().Ss)("menus",(async()=>{const[{default:e},{TopbarPageAnalyticsOptOutMenu:t},{default:n},{default:i},{default:a},{default:r},{default:l},{default:s},{default:c},{default:u},{default:d},{SidebarTeamModal:p},{SidebarCreateTeamModal:m},{CreateTeamFromPageConfirmModal:g},{CollectionTypedDatabaseMigrationModal:h},{default:y},{default:f},{default:v}]=await Promise.all([Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,55351)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,83340)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,11070)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,487974)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,293660)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,743405)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,995744)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,795879)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,720940)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,277650)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,363806)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,807883)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,216867)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,253032)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,931928)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,176866)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,874226)),Promise.all([o.e(62743),o.e(52774),o.e(44832),o.e(39938),o.e(84885),o.e(90698),o.e(37358),o.e(7312),o.e(5242),o.e(31189),o.e(90424),o.e(69343),o.e(81580),o.e(84325),o.e(2933),o.e(94556),o.e(78701),o.e(38804),o.e(17100),o.e(4387),o.e(11189),o.e(53329),o.e(71896),o.e(72586),o.e(53335),o.e(46616),o.e(54940),o.e(20224),o.e(46546),o.e(98721),o.e(50471),o.e(49498),o.e(2971),o.e(20634),o.e(91253),o.e(63707),o.e(61171),o.e(4014),o.e(63502),o.e(7678),o.e(5006),o.e(20919),o.e(75377),o.e(99590),o.e(52435),o.e(69437),o.e(81063),o.e(75066),o.e(81917),o.e(88128),o.e(97934),o.e(37317),o.e(91e3),o.e(18162),o.e(91752),o.e(78517),o.e(99537),o.e(80730),o.e(11770),o.e(83962),o.e(62084),o.e(79289),o.e(21862),o.e(41589),o.e(71641),o.e(23006),o.e(72646),o.e(10553),o.e(74879),o.e(67601),o.e(37239),o.e(40692),o.e(20683),o.e(22467),o.e(27039),o.e(97083),o.e(52065),o.e(18534),o.e(39179),o.e(77555),o.e(38632),o.e(78856),o.e(19592),o.e(47559),o.e(22371),o.e(73230),o.e(25911),o.e(54843),o.e(76540),o.e(22337),o.e(93536),o.e(53936),o.e(23721),o.e(32175),o.e(66283),o.e(22154),o.e(58586)]).then(o.bind(o,969016))]);return{CustomizePageMenuRenderer:e,TopbarPageAnalyticsOptOutMenu:t,ImportModal:n,ExportModal:i,PageTemplateModal:a,GoogleAuthPromptModal:r,StudentNotEligibleModal:l,CookieModal:s,ForkPagePopup:c,DatePropertyMenu:u,ReportPageModal:d,SidebarCreateTeamModal:m,SidebarTeamModal:p,CreateTeamFromPageConfirmModal:g,CollectionTypedDatabaseMigrationModal:h,OpenInDesktopAppPopup:y,BlockMenu:f,ImportIntoNewPageModal:v}})),a=(0,n().kF)(i,(e=>e.CustomizePageMenuRenderer)),r=(0,n().kF)(i,(e=>e.TopbarPageAnalyticsOptOutMenu)),l=(0,n().kF)(i,(e=>e.PageTemplateModal)),s=(0,n().kF)(i,(e=>e.ImportModal)),c=(0,n().kF)(i,(e=>e.ExportModal)),u=(0,n().kF)(i,(e=>e.ReportPageModal)),d=(0,n().kF)(i,(e=>e.GoogleAuthPromptModal)),p=(0,n().kF)(i,(e=>e.StudentNotEligibleModal)),m=(0,n().kF)(i,(e=>e.CookieModal)),g=(0,n().kF)(i,(e=>e.BlockMenu)),h=(0,n().kF)(i,(e=>e.ForkPagePopup)),y=(0,n().kF)(i,(e=>e.CollectionTypedDatabaseMigrationModal)),f=(0,n().kF)(i,(e=>e.SidebarCreateTeamModal)),v=(0,n().kF)(i,(e=>e.SidebarTeamModal)),x=(0,n().kF)(i,(e=>e.CreateTeamFromPageConfirmModal)),b=(0,n().kF)(i,(e=>e.OpenInDesktopAppPopup)),S=(0,n().kF)(i,(e=>e.ImportIntoNewPageModal))},412511:(e,t,o)=>{o.d(t,{$G:()=>l,AN:()=>c,Xq:()=>d,du:()=>r});o(670560),o(267602),o(916054),o(653476),o(470928);var n=()=>o(730120),i=()=>o(803021),a=()=>o(526243);function r(e){const t=n().ou.fromMillis(e.startUnixTimestampMS),o=e.endUnixTimestampMS?n().ou.fromMillis(e.endUnixTimestampMS):void 0,i=n().ou.fromMillis(e.startOfWeekUnixTimestampMS),a=n().ou.fromMillis(e.endOfWeekUnixTimestampMS),r=t.startOf("day"),l=n().ou.max(i,r),s=Math.ceil(l.diff(i,"days").get("days"));let c=1;if(o){const e=o.endOf("day"),t=n().ou.min(a,e);c=Math.ceil(t.diff(l,"days").get("days"))}return{start:t,end:o,startOfWeek:i,endOfWeek:a,startColumn:s,columnCount:c}}function l(e){const t=(e.attendees||[]).filter((e=>!e.self&&!e.resource));return e.hasParticipants&&t.length>0&&t.every((e=>"declined"===e.responseStatus))}const s={upcomingMinsThreshold:10,startingMinsThreshold:5,startedMinsThreshold:15};function c(e){const t=e.filter((e=>{var t;if(!e.conferencing)return!1;return!function(e){if("declined"===e)return!0;return!1}((null===(t=e.attendees)||void 0===t?void 0:t.find((e=>e.self)))?e.responseStatus??"accepted":"accepted")&&!e.isAllDay}));if(0===t.length)return;const{upcomingMinsThreshold:o,startingMinsThreshold:i,startedMinsThreshold:a}=s,r=[],l=[],c=[],d=[],p=[];for(const s of t){if(s.isAllDay)continue;const e=u(s),t=n().ou.now(),m=e.start.diff(t,"minutes").minutes;m>=0&&m<=o?r.push(s):-m>=i?c.push(s):-m>=a?d.push(s):e.contains(t)?l.push(s):p.push(s)}return[...r,...c,...d,...l,...p][0]}function u(e){const t=n().ou.fromISO(e.start.dateTime,{zone:e.start.timeZone}),o=n().ou.fromISO(e.end.dateTime,{zone:e.end.timeZone});return n().Xp.fromDateTimes(t,o)}function d(e){let{newCalendarStart:t,newCalendarEnd:o,collectionViewId:n,currentUserId:r="0"}=e;(0,i().nQ)(t,o,Date.now())?a().ZP.clearLocalDateRangeStart({collectionViewId:n,currentUserId:r}):a().ZP.setLocalDateRangeStart({collectionViewId:n,currentUserId:r,dateRangeStart:t})}},762300:(e,t,o)=>{o.d(t,{P9:()=>s,YJ:()=>c,jc:()=>l,jg:()=>r});o(670560),o(267602),o(653476);var n=()=>o(235484),i=()=>o(530980),a=()=>o(525807);function r(e){if(e.integration_id!==n().nO)throw"Cannot render account for integration.";const t=/(.+) - (.+)/.exec(e.account_name);if(!t)return{accountName:e.account_name};const[,o,i]=t;return{organizationName:o,accountName:i}}function l(e){return i().kk5.fromValue(a().PJ,e).getSlackWorkspaceId()}function s(e,t){return t?e.filter((e=>{const o=l(e);return!!o&&t(o)})):e}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const o={};for(const n of e){const{accountName:e,organizationName:i}=r(n);u({query:t,accountName:e,organizationName:i})&&(o[e]||(o[e]=[]),o[e].push({externalAuthentication:n,workspaceName:i}))}return o}function u(e){const{accountName:t,organizationName:o,query:n}=e;if(0===n.length)return!0;const i=t.toLocaleLowerCase().indexOf(n.trim().toLocaleLowerCase())>=0,a=!!o&&o.toLocaleLowerCase().indexOf(n.trim().toLocaleLowerCase())>=0;return i||a}},397079:(e,t,o)=>{o.d(t,{V:()=>i});var n=o(667294);function i(){const e=(0,n.useRef)(null),[t,o]=(0,n.useState)(!1),[i,a]=(0,n.useState)(!1),r=(0,n.useCallback)((()=>{const t=e.current;t&&a(t.matches(":active"))}),[]),l=(0,n.useCallback)((t=>{e.current=t,r(),o(!0)}),[r]);return(0,n.useEffect)((()=>{const o=e.current;if(o&&t)return o.addEventListener("mousedown",r),o.addEventListener("mouseup",r),()=>{o.removeEventListener("mousedown",r),o.removeEventListener("mouseup",r)}}),[r,t]),[l,i,e]}},863606:(e,t,o)=>{o.d(t,{W:()=>i});var n=o(667294);function i(e,t,o){const i=(0,n.useRef)(e),a=(0,n.useRef)(null);(0,n.useEffect)((()=>{i.current=e}),[e]),(0,n.useEffect)((()=>{const e=async()=>{a.current&&(clearTimeout(a.current),a.current=null),o&&(await i.current(),a.current=setTimeout(e,t))};return o&&e(),()=>{a.current&&(clearTimeout(a.current),a.current=null)}}),[o,t])}},728243:(e,t,o)=>{o.d(t,{Z:()=>u});o(267602),o(30005);var n=o(667294),i=()=>o(142735),a=()=>o(396035),r=()=>o(217465),l=()=>o(269299),s=()=>o(757590),c=()=>o(876822);function u(e){let{unpersistedInMemoryRecordCache:t}=e;const o=(0,i().VK)((()=>{var e;return null===(e=c().default.state.currentUserStore)||void 0===e?void 0:e.userId}),[]);return{createAndCommit:(0,n.useCallback)((e=>{let{perform:n}=e;const i=new(s().Y)({deadlockTimeoutMs:l().DEADLOCK_WARNING_TIMEOUT_MS}),c=n(i),u=r().RecordMap.create();i.stores.forEach((e=>{const t=e.getRecordModel(e.pointer);t&&u.addModel(t)})),(0,a().FS)({operations:i.operations,recordMap:u,updateOnly:!1});for(const a of u){const{model:e,pointer:n}=a;t.setModelAndRole({pointer:n,userId:o},e,"editor")}return t.emitAll(),{performResult:c,serverCommitResult:Promise.resolve()}}),[t,o])}}},356140:(e,t,o)=>{o.d(t,{W:()=>a});var n=()=>o(142735),i=()=>o(876822);function a(){const{currentSpaceStore:e}=(0,n().VK)((()=>i().default.state),[]);return null==e?void 0:e.id}},492077:(e,t,o)=>{o.d(t,{C:()=>a});var n=o(667294),i=o(785893);const a=n.forwardRef(((e,t)=>{const n=(0,o(846550).yK)((t=>({buttonStyle:{paddingLeft:8,paddingRight:8,paddingTop:2,paddingBottom:2,width:"100%",marginLeft:0,background:"transparent"},menuItemStyle:{gap:6,background:"transparent"},innerContainer:{marginLeft:0,paddingLeft:0,minWidth:"auto",color:e.disabled?t.text.secondary:void 0,background:"transparent"},desktopIconStyle:{margin:0},rightStyle:{display:"flex",alignItems:"center",gap:6,color:t.text.secondary,margin:0,...e.rightStyle}})),[e.disabled,e.rightStyle]);return(0,i.jsx)(o(827973).Z,{role:"button",...e,ref:t,style:n.menuItemStyle,buttonStyle:n.buttonStyle,textWrapperStyle:n.innerContainer,desktopIconStyle:n.desktopIconStyle,rightStyle:n.rightStyle})}));a.displayName="SiteSettingButtonMenuItem"},594539:(e,t,o)=>{o.d(t,{Z:()=>P});o(670560),o(241792);var n=o(667294),i=()=>o(146947),a=()=>o(219727),r=()=>o(142735),l=()=>o(846550),s=()=>o(646574),c=()=>o(933868),u=()=>o(788860),d=()=>o(326966),p=()=>o(827973),m=()=>o(448419),g=()=>o(198829),h=()=>o(255577),y=()=>o(388284),f=()=>o(67961),v=()=>o(296034),x=()=>o(868744),b=()=>o(718959),S=()=>o(352230),C=()=>o(128119),k=()=>o(965014),M=()=>o(188296),j=()=>o(18281),T=o(785893);function w(e,t){const{permissionItem:n,hideIcon:i,onChange:r}=e,s=(0,a().Fy)(),c=(0,l().yK)((e=>({icon:{margin:0,height:16,width:16,fill:e.icon.secondary},chevronIcon:{height:12,width:12,fill:e.icon.tertiary,transform:"rotate(90deg)"}})),[]);return(0,T.jsx)(o(838003).Z,{...e,popupType:s.isMobile?m().Z4.SlideUp:m().Z4.Popup,renderOrigin:a=>(0,T.jsx)(o(492077).C,{...(0,o(164079).Z)(e,a),ref:t,title:(0,T.jsx)(u()._H,{defaultMessage:"Link expiration",id:"publishSiteSettings.linkExpiration.settingTitle"}),icon:!i&&(0,o(874650).r)(c.icon),right:(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(A,{permissionItem:n}),(0,o(429600).o)(c.chevronIcon)]})}),alignmentToOrigin:C().lU.End,placementToOrigin:C().Iw.Bottom,render:e=>(0,T.jsx)(I,{value:n.expiration_timestamp,onChange:r,onClose:()=>{e.close()}})})}function A(e){const{permissionItem:t}=e,o=(0,u().YB)(),n=(0,l().yK)((e=>({container:{color:e.text.secondary}})),[]);if(!t.expiration_timestamp||(0,c().o7)(t))return(0,T.jsx)(f().Z,{style:n.container,children:(0,T.jsx)(u()._H,{defaultMessage:"None",id:"publishSiteSettings.linkExpiration.never"})});const a=s().$b(t.expiration_timestamp,i().locale,o);return(0,T.jsx)(f().Z,{style:n.container,children:a})}function I(e){const{value:t,onChange:o,onClose:s}=e,c=(0,a().O7)(),m=c.device,f=(0,r().VK)((()=>!j().y$()),[]),v=(0,r().VK)((()=>j().M9(c)),[c]),x=(0,n.useCallback)((e=>{void 0!==e&&e<=(new Date).getTime()||(o(e),s())}),[o,s]),b=(0,l().yK)((e=>({disabledContainer:{display:"flex",gap:6},disabledText:{color:e.text.tertiary}})),[]),C=function(){const e=Date.now(),t=e+d().U6,o=e+d().A0,n=e+7*d().A0;return[{key:"none",time:void 0,title:(0,T.jsx)(u()._H,{defaultMessage:"None",id:"publishSiteSettings.linkExpiration.never"})},{key:"hour",time:t,title:(0,T.jsx)(u()._H,{defaultMessage:"In an hour",id:"publishSiteSettings.linkExpiration.oneHour"}),caption:new Intl.DateTimeFormat(i().locale,{hour:"numeric",minute:"numeric"}).format(t)},{key:"day",time:o,title:(0,T.jsx)(u()._H,{defaultMessage:"In a day",id:"publishSiteSettings.linkExpiration.oneDay"}),caption:new Intl.DateTimeFormat(i().locale,{day:"numeric",month:"long",hour:"numeric",minute:"numeric"}).format(o)},{key:"week",time:n,title:(0,T.jsx)(u()._H,{defaultMessage:"In a week",id:"publishSiteSettings.linkExpiration.oneWeek"}),caption:new Intl.DateTimeFormat(i().locale,{day:"numeric",month:"long",hour:"numeric",minute:"numeric"}).format(n)}]}().map((e=>({key:e.key,action:()=>{x(e.time)},render:t=>(0,T.jsx)(p().Z,{...t,title:e.title,titleStyle:f?b.disabledText:{},caption:e.caption,captionStyle:f?b.disabledText:{},disabled:f})}))),w=[{key:"predefined-expiration",render:e=>(0,T.jsx)(y().Z,{...e}),items:C},{key:"custom-expiration",render:e=>(0,T.jsx)(y().Z,{...e,topBorder:!0}),items:[_(x,t,f,b.disabledText)]}];return v&&f&&w.push({key:"upgrade-for-expiration",render:e=>(0,T.jsx)(y().Z,{...e,topBorder:!0}),items:[{key:"upsell",action:()=>{k().y(c,{from:"public_permission_item_expiration",upsell:{type:"product",product:v,limit:{type:"none"}}})},render:e=>(0,T.jsx)(p().Z,{...e,focused:e.focused,title:(0,T.jsxs)("div",{style:b.disabledContainer,children:[(0,T.jsx)(u()._H,{defaultMessage:"Unlock link expiration",id:"publishSiteSettings.linkExpiration.upgrade"}),(0,T.jsx)(M().Z,{subscriptionTier:v,analyticsName:"public_permission_item_expiration"})]})})}]}),(0,T.jsx)(g().Z,{menuType:m.isMobile?S().o.ActionSheet:S().o.Popup,width:240,children:(0,T.jsx)(h().ZP,{type:h().iW.Vertical,initialFocus:void 0,sections:w})})}function _(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return{key:"custom",action:()=>{window.parent.close()},render:(i,a)=>(0,T.jsx)(x().Z,{...i,renderOrigin:e=>(0,T.jsx)(p().Z,{...e,disabled:o,title:(0,T.jsx)(u()._H,{id:"publicPermissionItem.expiration.chooseDate",defaultMessage:"Choose date"}),titleStyle:o?n:{}}),onFocus:a.onFocus,disableDefaultClick:!0,renderExtension:(n,i)=>(0,T.jsx)("div",{style:{padding:"18px 14px 14px"},children:(0,T.jsx)(v().Z,{...n,firstDayOfWeek:b().AK.state,value:t||Date.now(),onChange:t=>{e(t),i.close()},disabledDays:o||{before:new Date}})})})}}const P=n.forwardRef(w)},583352:(e,t,o)=>{o.d(t,{Z:()=>a});var n=()=>o(632314);class i extends(()=>o(263184))().default{getInitialState(){return{automationActionStore:void 0,automationStore:void 0,contextType:void 0,typecheckResult:void 0}}blur(e){void 0!==this.state.automationStore&&(void 0===e||(0,n().Z)(this.state,e))&&this.setState({automationActionStore:void 0,automationStore:void 0,contextType:void 0,typecheckResult:void 0})}focus(e){(0,n().Z)(this.instanceState,e)||this.setState(e)}}const a=new i;(0,o(947115).exposeDebugValue)("AutomationFocusStore",i)},407121:(e,t,o)=>{o.d(t,{Z:()=>a});class n extends(()=>o(263184))().default{getInitialState(){return{open:!1}}}const i=new n;(0,o(947115).exposeDebugValue)("AutomationModalStore",i);const a=i},385010:(e,t,o)=>{o.d(t,{l:()=>r,w:()=>i});function n(e){switch(e.type){case"external":return`external-${e.botId}`;case"workflow":return`workflow-${e.workflowExternalAuthenticationId}`;case"universal":return`universal-${e.app}-${e.spaceId}`;default:throw(0,o(696459).t1)(e)}}const i={channels:{},fetching:!1,lastRefreshed:0};class a extends(()=>o(263184))().default{getStateForBot(e){const t=n(e);return this.state[t]??i}updateStateForBot(e,t){this.setState({...this.state,[n(e)]:{...this.getStateForBot(e),...t}})}addChannelsForBot(e,t){const o=this.getStateForBot(e);this.setState({...this.state,[n(e)]:{...o,channels:{...o.channels,...t}}})}}const r=new a;(0,o(947115).exposeDebugValue)("ExternalNotificationChannelsStore",r)},179378:(e,t,o)=>{o.d(t,{Z:()=>i});class n extends(()=>o(263184))().default{getInitialState(){return{}}}const i=n},719157:(e,t,o)=>{o.d(t,{D:()=>a});var n=()=>o(142735),i=()=>o(749826);function a(e){const{experimentId:t,groups:o,disableExposureLogging:a}=e,r=function(e){const{experimentId:t,disableExposureLogging:o,defaultGroup:a}=e;return(0,n().VK)((()=>i().default.getEligibleGroup({experimentId:t,defaultGroup:a??"control",disableExposureLogging:o})),[t,o,a])}({experimentId:t,disableExposureLogging:a});return o[r]}},385337:(e,t,o)=>{o.d(t,{R:()=>y});o(667294);var n=()=>o(219727),i=()=>o(142735),a=()=>o(846550),r=()=>o(788860),l=()=>o(568017),s=()=>o(696459),c=()=>o(707513),u=()=>o(946563),d=()=>o(654133),p=()=>o(998901),m=()=>o(876822),g=()=>o(965014),h=o(785893);function y(e){let{upsell:t,mobileStyle:o,desktopStyle:y,analyticsName:f,onClick:v,disableTooltip:x}=e;const b=(0,a().Fg)(),S=(0,n().O7)(),{device:C}=S,k=(0,i().VK)((()=>{const{currentSpaceStore:e}=m().default.state;return null==e?void 0:e.canAdmin()}),[]),M=(0,i().VK)((()=>function(e,t){if("product"!==e.type)return{};switch(e.product){case"plus":case"business":case"enterprise":return{color:t.blueColor,background:"light"===t.mode?l().ZP.diffBackground:"rgba(35, 131, 226, 0.2)",fontWeight:c().Ue.medium};default:return{}}}(t,b)),[t,b]);if("product"!==t.type)return null;if(C.isMobileNative)return null;const j=(()=>{switch(t.product){case"personal":return(0,h.jsx)(r()._H,{defaultMessage:"Personal Pro",id:"upgradeButton.personal.text"});case"plus":return(0,h.jsx)(r()._H,{defaultMessage:"Plus â",id:"upgradeButton.plus.textWithArrow"});case"business":return(0,h.jsx)(r()._H,{defaultMessage:"Business â",id:"upgradeButton.business.textWithArrow"});case"enterprise":return(0,h.jsx)(r()._H,{defaultMessage:"Enterprise â",id:"upgradeButton.enterprise.textWithArrow"});case"ai":return(0,h.jsx)(r()._H,{defaultMessage:"AI â",id:"upgradeButton.ai.textWithArrow"});case"sites_custom_hostnames":return(0,h.jsx)(r()._H,{defaultMessage:"Custom Hostnames â",id:"upgradeButton.sites_custom_hostnames.textWithArrow"});default:(0,s().t1)(t.product)}})();return C.isMobile||!k?(0,h.jsx)(u().Z,{mobileStyle:o,children:j}):(0,h.jsx)(d().Z,{delayThreshold:120,disableTooltip:x,placement:p().Placement.Bottom,renderTooltip:()=>(0,h.jsx)("div",{style:{maxWidth:500},children:(0,h.jsx)(r()._H,{defaultMessage:"Upgrade to use this feature.",id:"premiumFeatureUpgradeButton.upgrade.tooltip"})}),originGap:6,render:e=>(0,h.jsx)(u().Z,{desktopStyle:y,innerStyle:M,onClick:e=>function(e,t,o,n,i){g().y(n,{from:t,upsell:o}),i&&i(e)}(e,f,t,S,v),...e,children:j})})}},188296:(e,t,o)=>{o.d(t,{Z:()=>d});o(667294);var n=()=>o(142735),i=()=>o(122792),a=()=>o(788860),r=()=>o(568017),l=()=>o(707513),s=()=>o(946563),c=()=>o(965014),u=o(785893);const d=function(e){let{subscriptionTier:t,mobileStyle:d,desktopStyle:p,analyticsName:m,onClick:g,disableTooltip:h}=e;const y=(0,o(846550).Fg)(),f=(0,o(219727).O7)(),{device:v}=f,x=(0,n().VK)((()=>{const{currentSpaceStore:e}=o(876822).default.state;return null==e?void 0:e.canAdmin()}),[]),b=(0,n().VK)((()=>function(e,t){switch(e){case"plus":case"business":case"enterprise":return{color:t.blueColor,background:"light"===t.mode?r().ZP.diffBackground:"rgba(35, 131, 226, 0.2)",fontWeight:l().Ue.medium};default:return{}}}(t,y)),[t,y]);if(v.isMobileNative)return null;let S;return"personal"===t?S=(0,u.jsx)(a()._H,{defaultMessage:"Personal Pro",id:"upgradeButton.personal.text"}):(0,i().eR)(t)?S=(0,u.jsx)(a()._H,{defaultMessage:"Plus â",id:"upgradeButton.plus.textWithArrow"}):(0,i().NG)(t)?S=(0,u.jsx)(a()._H,{defaultMessage:"Business â",id:"upgradeButton.business.textWithArrow"}):(0,i().wP)(t)?S=(0,u.jsx)(a()._H,{defaultMessage:"Enterprise â",id:"upgradeButton.enterprise.textWithArrow"}):(0,o(696459).t1)(t),v.isMobile||!x?(0,u.jsx)(s().Z,{mobileStyle:d,children:S}):(0,u.jsx)(o(654133).Z,{delayThreshold:120,disableTooltip:h,placement:o(998901).Placement.Bottom,renderTooltip:()=>(0,u.jsx)("div",{style:{maxWidth:500},children:(0,u.jsx)(a()._H,{defaultMessage:"Upgrade to use this feature.",id:"upgradeButton.upgrade.tooltip"})}),originGap:6,render:e=>(0,u.jsx)(s().Z,{desktopStyle:p,innerStyle:b,onClick:e=>function(e,t,o,n,i){c().y(n,{from:t,upsell:{type:"product",product:o,limit:{type:"none"}}}),i&&i(e)}(e,m,t,f,g),...e,children:S})})}},756191:(e,t,o)=>{o.d(t,{FR:()=>g,OY:()=>m,ic:()=>p,sB:()=>d,sG:()=>u,y_:()=>h});o(241792);var n=()=>o(513670),i=()=>o(696459),a=()=>o(834458),r=()=>o(193962),l=()=>o(455222),s=()=>o(177634);function c(e){switch(e){case"checkbox":return"boolean";case"number":return"number";case"text":return"text";case"date":return"date";case"array":return"array";case"block":return"block";case"person":return"person";case"select":return"select";case"function":return"function";case"unknown":return"unknown";case"undefined":return"undefined";default:(0,i().t1)(e)}}function u(e){switch(e.type){case l().$E.InvalidCharacter:return{...r().mr.InvalidCharacter,values:{errorCharacter:e.character}};case l().$E.UnclosedStringLiteral:return r().mr.UnclosedStringLiteral;case l().$E.UnclosedComment:return r().mr.UnclosedComment;case l().$E.TokenExpected:return{...r().mr.TokenExpected,values:{expectedToken:e.token}};case l().$E.StringLiteralContainsToken:return r().mr.StringLiteralContainsToken;case l().$E.ExpressionExpected:return r().mr.ExpressionExpected;case l().$E.PropertyTokenOrFunctionExpected:return r().mr.PropertyTokenOrFunctionExpected;case l().$E.EndOfInputExpected:return r().mr.EndOfInputExpected;case l().$E.UnexpectedError:return r().mr.UnexpectedError;case l().$E.TooDeeplyNested:return r().mr.TooDeeplyNested;default:(0,i().t1)(e)}}function d(e){switch(e.type){case l().h4.FunctionCallArgumentWrongType:case l().h4.FunctionCallUnexpectedArgument:return e.argument;default:return e.node}}function p(e,t){let o;switch(t.type){case l().h4.ThisRowTypeNotFound:o=r().o8.ThisRowTypeNotFound;break;case l().h4.ThisRowNotBlockWithCollection:o=r().o8.ThisRowNotBlockWithCollection;break;case l().h4.MissingPropertyOnThisRow:o={...r().o8.MissingPropertyOnThisRow,values:{propertyName:t.property}};break;case l().h4.MissingContextVariable:{const e=(0,s().Xp)(t.token)?t.token.contextValueId:t.token.valueId;o={...r().o8.MissingContextVariable,values:{valueId:e}}}break;case l().h4.MissingBlock:o={...r().o8.MissingBlock,values:{blockId:t.token.blockId}};break;case l().h4.CallingNotFunction:o={...r().o8.CallingNotFunction,values:{expressionType:c(t.callee.type.type)}};break;case l().h4.FunctionCallTooFewArguments:o={...r().o8.FunctionCallTooFewArguments,values:{minNumParameters:t.minNumParameters,functionName:t.libraryFunction.name,numArguments:t.numArguments}};break;case l().h4.FunctionCallUnexpectedArgument:o={...r().o8.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case l().h4.FunctionCallArgumentWrongType:o={...r().o8.FunctionCallArgumentWrongType,values:{argumentType:c(t.argument.type.type),functionName:t.libraryFunction.name}};break;case l().h4.MemberPropertyMismatchCollection:o={...r().o8.MemberPropertyMismatchCollection,values:{propertyName:t.token.property}};break;case l().h4.MemberPropertyMissing:o={...r().o8.MemberPropertyMissing,values:{propertyName:t.property}};break;case l().h4.MemberPropertyTargetNotBlock:o=r().o8.MemberPropertyTargetNotBlock;break;case l().h4.MemberPropertyTypeInvalid:o={...r().o8.MemberPropertyTypeInvalid,values:{propertyName:t.propertyName,propertyType:t.propertyType}};break;case l().h4.UndefinedIdentifier:o={...r().o8.UndefinedIdentifier,values:{identifier:t.node.text}};break;case l().h4.UnifiedFunctionCannotFindFunction:o={...r().o8.UnifiedFunctionCannotFindFunction,values:{functionName:t.name}};break;case l().h4.UnifiedFunctionNoArguments:o={...r().o8.UnifiedFunctionNoArguments,values:{functionName:t.libraryFunction.name}};break;case l().h4.UnifiedFunctionTargetWrongType:o={...r().o8.UnifiedFunctionTargetWrongType,values:{functionName:t.libraryFunction.name,targetType:c(t.expression.type.type)}};break;case l().h4.CannotRelativelyCompareTypes:o={...r().o8.CannotRelativelyCompareTypes,values:{lhsType:c(t.lhsType.type),rhsType:c(t.rhsType.type)}};break;case l().h4.CannotDoMathOnType:o={...r().o8.CannotDoMathOnType,values:{lhsType:c(t.lhsType.type),rhsType:c(t.rhsType.type)}};break;case l().h4.UnaryMinusOnNonNumber:o={...r().o8.UnaryMinusOnNonNumber,values:{type:c(t.expression.type.type)}};break;case l().h4.IdentifierExpected:o=r().o8.IdentifierExpected;break;case l().h4.FunctionCallExpected:o={...r().o8.FunctionCallExpected,values:{functionName:t.functionName}};break;case l().h4.RenamedIdentifier:o={...r().o8.RenamedIdentifier,values:{identifier:t.identifier,renamedTo:t.renamedTo}};break;case l().h4.RemovedFunction:o={...r().o8.RemovedFunction,values:{functionName:t.functionName,alternative:t.alternative}};break;case l().h4.ContextVariableNotBlockWithCollection:o={...r().o8.ContextVariableNotBlockWithCollection,values:{valueId:t.token.contextValueId}};break;case l().h4.MissingPropertyOnContextVariable:o={...r().o8.MissingPropertyOnContextVariable,values:{propertyName:t.property,valueId:t.token.contextValueId}};break;case l().h4.BlockPropertyTypeInvalid:o={...r().o8.BlockPropertyTypeInvalid,values:{propertyName:t.propertyName}};break;case l().h4.DisallowedReturnType:{const n=t.allowedReturnTypes.map((t=>e.formatMessage((0,a().getHumanReadableType)(t)).toLocaleLowerCase()));o={...r().o8.DisallowedReturnType,values:{allowedReturnType:e.formatList(n,{style:"long",type:"conjunction"}),allowedReturnTypeCount:t.allowedReturnTypes.length,returnType:e.formatMessage((0,a().getHumanReadableType)(t.returnType)).toLocaleLowerCase()}};break}case l().h4.CrossSpacePropertyNotSupported:o={...r().o8.CrossSpacePropertyNotSupported};break;default:(0,i().t1)(t)}return{...o,values:{...o.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}}function m(e,t){let o;switch(t.type){case l().FY.MissingThisRow:o=r().YG.MissingThisRow;break;case l().FY.MissingSchemaPropertyOnThisRow:o={...r().YG.MissingSchemaPropertyOnThisRow,values:{propertyName:t.property}};break;case l().FY.ThisRowBlockPropertyMismatchCollection:o=r().YG.ThisRowBlockPropertyMismatchCollection;break;case l().FY.MissingContextVariable:o={...r().YG.MissingContextVariable,values:{valueId:t.valueId}};break;case l().FY.IdentifierNotFound:o={...r().YG.IdentifierNotFound,values:{identifier:t.node.text}};break;case l().FY.CannotRelativelyCompareTypes:o={...r().YG.CannotRelativelyCompareTypes,values:{lhsType:c(t.lhsType),rhsType:c(t.rhsType)}};break;case l().FY.CannotDoMathOnType:o={...r().YG.CannotDoMathOnType,values:{valueType:c(t.valueType)}};break;case l().FY.CannotCallNonFunction:o={...r().YG.CannotCallNonFunction,values:{calleeType:c(t.calleeType)}};break;case l().FY.UnifiedFunctionPropertyNotFound:o={...r().YG.UnifiedFunctionPropertyNotFound,values:{functionName:t.node.name}};break;case l().FY.LibraryFunctionExecutionError:const n=t.error instanceof l().Mu?t.error:void 0;o=(null==n?void 0:n.info.type)===l().sj.DateInvalidDurationUnit?{...r().z8.DateInvalidDurationUnit,values:{functionName:t.libraryFunction.name,invalidUnit:n.info.invalidUnit}}:(null==n?void 0:n.info.type)===l().sj.CannotUseToNumberOnList?{...r().z8.CannotUseToNumberOnList}:(null==n?void 0:n.info.type)===l().sj.CannotRoundToNonInteger?{...r().z8.CannotRoundToNonInteger,values:{precision:n.info.precision}}:(null==n?void 0:n.info.type)===l().sj.CannotRoundToTooManyDecimalPlaces?{...r().z8.CannotRoundToTooManyDecimalPlaces,values:{precision:n.info.precision}}:{...r().YG.LibraryFunctionExecutionError,values:{functionName:t.libraryFunction.name}};break;case l().FY.FunctionCallTooFewArguments:o={...r().YG.FunctionCallTooFewArguments,values:{functionName:t.libraryFunction.name}};break;case l().FY.FunctionCallUnexpectedArgument:o={...r().YG.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case l().FY.FunctionCallArgumentWrongType:o={...r().YG.FunctionCallArgumentWrongType,values:{functionName:t.libraryFunction.name,argumentType:c(t.argumentType)}};break;case l().FY.AccessingPropertyOnNonBlock:o=r().YG.AccessingPropertyOnNonBlock;break;case l().FY.MissingDataDependencyBlock:o={...r().YG.MissingDataDependencyBlock,values:{blockId:t.blockPointer.id}};break;case l().FY.MissingDataDependencyPerson:o={...r().YG.MissingDataDependencyPerson,values:{personId:t.personPointer.id}};break;case l().FY.MemberPropertyMismatchCollection:o=r().YG.MemberPropertyMismatchCollection;break;case l().FY.MissingPropertyOnSchemaForMemberProperty:o=r().YG.MissingPropertyOnSchemaForMemberProperty;break;case l().FY.UnaryMinusOnNonNumber:o={...r().YG.UnaryMinusOnNonNumber,values:{expressionType:c(t.expressionType)}};break;case l().FY.UnexpectedRecoveryNode:o=r().YG.UnexpectedRecoveryNode;break;case l().FY.UnexpectedError:o=r().YG.UnexpectedError;break;case l().FY.DepthExceeded:o=r().YG.DepthExceeded;break;case l().FY.CycleDetected:o=r().YG.CycleDetected;break;case l().FY.DownstreamParseFailure:o=r().YG.DownstreamParseFailure;break;case l().FY.MaxEvaluationTimeExceeded:o=r().YG.MaxEvaluationTimeExceeded;break;case l().FY.MissingSchemaPropertyOnCollection:o={...r().YG.MissingSchemaPropertyOnCollection,values:{collectionId:t.collectionId,propertyName:t.property}};break;case l().FY.ContextVariableWrongType:o={...r().YG.ContextVariableWrongType,values:{expectedType:t.expectedType,propertyType:t.resultType,valueId:t.valueId}};break;case l().FY.DisallowedValueType:{const n=t.allowedValueTypes.map((t=>e.formatMessage((0,a().getHumanReadableType)(t)).toLocaleLowerCase()));o={...r().o8.DisallowedReturnType,values:{allowedValueType:e.formatList(n,{style:"long",type:"conjunction"}),allowedValueTypeCount:t.allowedValueTypes.length,valueType:e.formatMessage((0,a().getHumanReadableValueType)(t.expressionValue)).toLocaleLowerCase()}};break}default:(0,i().t1)(t)}return(0,s().w7)(t)?{...o,values:{...o.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}:o}function g(e){const t=null==e?void 0:e.values;return[n().CE(e,"values"),t]}function h(e){return e.type===l().FY.DepthExceeded||e.type===l().FY.CycleDetected||e.type===l().FY.MaxEvaluationTimeExceeded||e.type===l().FY.LibraryFunctionExecutionError}},779247:(e,t,o)=>{o.d(t,{T:()=>n});const n=(0,o(827282).CZ)("arrowUpRight",{default:{loader:()=>o.e(60569).then(o.bind(o,960569))},small:{loader:()=>o.e(8130).then(o.bind(o,608130))},mini:{loader:()=>o.e(88672).then(o.bind(o,188672))},large:{loader:()=>o.e(85943).then(o.bind(o,485943))}})},969269:(e,t,o)=>{o.d(t,{o:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("addPage",{viewBox:"0 0 14 14",svg:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 0c3.861 0 7 3.139 7 7s-3.139 7-7 7-7-3.139-7-7 3.139-7 7-7zM3.561 5.295a1.027 1.027 0 1 0 2.054 0 1.027 1.027 0 0 0-2.054 0zm5.557 1.027a1.027 1.027 0 1 1 0-2.054 1.027 1.027 0 0 1 0 2.054zm1.211 2.816a.77.77 0 0 0-.124-1.087.786.786 0 0 0-1.098.107c-.273.407-1.16.958-2.254.958-1.093 0-1.981-.55-2.244-.945a.788.788 0 0 0-1.107-.135.786.786 0 0 0-.126 1.101c.55.734 1.81 1.542 3.477 1.542 1.668 0 2.848-.755 3.476-1.541z"})})},440424:(e,t,o)=>{o.d(t,{a:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("addPerson",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M9.48242 7.91211C10.8076 7.91211 11.8352 6.77783 11.8352 5.35718C11.8352 4.00391 10.7908 2.84717 9.48242 2.84717C8.17407 2.84717 7.12964 4.00952 7.13525 5.36279C7.14087 6.77783 8.16284 7.91211 9.48242 7.91211ZM9.48242 8.87231C8.7356 8.87231 8.04492 8.99585 7.44409 9.22046C8.23022 9.95044 8.72437 10.9836 8.72437 12.1235C8.72437 12.511 8.66821 12.8872 8.55591 13.2466H12.8684C13.969 13.2466 14.3171 12.8479 14.3171 12.2302C14.3171 10.804 12.3967 8.87231 9.48242 8.87231ZM4.74316 15.1895C6.42212 15.1895 7.80347 13.7969 7.80347 12.1235C7.80347 10.4558 6.42212 9.06885 4.74316 9.06885C3.06982 9.06885 1.68286 10.4558 1.68286 12.1235C1.68286 13.7969 3.06982 15.1895 4.74316 15.1895ZM4.74316 14.1675C4.41187 14.1675 4.18726 13.9429 4.18726 13.6172V12.6907H3.27197C2.94629 12.6907 2.72168 12.4661 2.71606 12.1292C2.71045 11.7979 2.93506 11.5732 3.27197 11.5732H4.18726V10.6636C4.18726 10.3379 4.41187 10.1133 4.74316 10.1077C5.08008 10.1021 5.30469 10.3267 5.30469 10.6636V11.5732H6.22559C6.55127 11.5732 6.77588 11.7979 6.77588 12.1292C6.77588 12.4661 6.55127 12.6907 6.22559 12.6907H5.30469V13.6172C5.30469 13.9429 5.08008 14.1675 4.74316 14.1675Z"})})},934590:(e,t,o)=>{o.d(t,{s:()=>i});o(667294);const n={viewBox:"0 0 20 20",svg:(0,o(785893).jsx)("path",{d:"M10 2.4c.345 0 .625.28.625.625v9.966l3.333-3.333a.625.625 0 1 1 .884.884l-4.4 4.4a.625.625 0 0 1-.884 0l-4.4-4.4a.625.625 0 0 1 .884-.884l3.333 3.333V3.025c0-.345.28-.625.625-.625M4.15 16.35a.625.625 0 1 0 0 1.25h11.7a.625.625 0 0 0 0-1.25z"})},i=(0,o(827282).IU)("arrowLineDown",n)},32618:(e,t,o)=>{o.d(t,{D:()=>i});o(667294);const n={viewBox:"0 0 20 20",svg:(0,o(785893).jsx)("path",{d:"M15.85 3.65a.625.625 0 1 0 0-1.25H4.15a.625.625 0 1 0 0 1.25zm-1.008 6.692a.625.625 0 0 1-.884 0l-3.333-3.333v9.966a.625.625 0 1 1-1.25 0V7.009l-3.333 3.333a.625.625 0 1 1-.884-.884l4.4-4.4a.625.625 0 0 1 .884 0l4.4 4.4a.625.625 0 0 1 0 .884"})},i=(0,o(827282).IU)("arrowLineUp",n)},889919:(e,t,o)=>{o.d(t,{k:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("arrowRightSmaller",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M15.383 8.352a.877.877 0 01-.274.64l-5.156 5.14a.864.864 0 01-.617.266.831.831 0 01-.602-.234.795.795 0 01-.234-.586c0-.12.02-.232.063-.336a.912.912 0 01.187-.273l1.75-1.766 2.914-2.656.274.5-2.711.156H1.484c-.26 0-.471-.078-.632-.234a.851.851 0 01-.235-.617c0-.256.078-.461.235-.618a.856.856 0 01.632-.242h9.493l2.71.164-.273.508L10.5 5.5 8.75 3.727a.946.946 0 01-.188-.266.917.917 0 01-.062-.344c0-.234.078-.43.234-.586a.831.831 0 01.602-.234.79.79 0 01.328.07c.104.047.203.117.297.211l5.148 5.133a.877.877 0 01.274.64z"})})},79685:(e,t,o)=>{o.d(t,{j:()=>i});o(667294);const n={viewBox:"0 0 20 20",svg:(0,o(785893).jsx)("path",{d:"M10.625 3a.625.625 0 1 0-1.25 0v12.491l-4.333-4.333a.625.625 0 1 0-.884.884l5.4 5.4a.62.62 0 0 0 .884 0l5.4-5.4a.625.625 0 0 0-.884-.884l-4.333 4.333z"})},i=(0,o(827282).IU)("arrowStraightDown",n)},702041:(e,t,o)=>{o.d(t,{R:()=>i});o(667294);const n={viewBox:"0 0 20 20",svg:(0,o(785893).jsx)("path",{d:"M9.792 2.41a.6.6 0 0 0-.234.148l-5.4 5.4a.625.625 0 1 0 .884.884l4.333-4.333V17a.625.625 0 1 0 1.25 0V4.509l4.333 4.333a.625.625 0 1 0 .884-.884l-5.4-5.4a.62.62 0 0 0-.65-.147"})},i=(0,o(827282).IU)("arrowStraightUp",n)},910446:(e,t,o)=>{o.d(t,{s:()=>i});o(667294);const n={viewBox:"0 0 20 20",svg:(0,o(785893).jsx)("path",{d:"M4.375 4.75a.625.625 0 1 0-1.25 0v5c0 1.174.951 2.125 2.125 2.125h10.491l-3.333 3.333a.625.625 0 0 0 .884.884l4.4-4.4a.625.625 0 0 0 0-.884l-4.4-4.4a.625.625 0 0 0-.884.884l3.333 3.333H5.25a.875.875 0 0 1-.875-.875z"})},i=(0,o(827282).IU)("arrowTurnDownRight",n)},775404:(e,t,o)=>{o.d(t,{p:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("at",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M.911 8.034c0 4.505 3.049 7.24 7.246 7.24 1.135 0 2.215-.158 2.885-.376.472-.15.622-.397.622-.65a.44.44 0 00-.451-.444 1.3 1.3 0 00-.321.048c-.834.205-1.552.341-2.516.341-3.74 0-6.29-2.255-6.29-6.118 0-3.698 2.407-6.275 6.03-6.275 3.206 0 5.886 1.975 5.886 5.523 0 2.072-.697 3.466-1.825 3.466-.752 0-1.176-.437-1.176-1.183V4.972c0-.37-.205-.595-.554-.595-.341 0-.553.226-.553.595v.779h-.062c-.349-.84-1.203-1.374-2.222-1.374-1.77 0-3.014 1.51-3.014 3.678 0 2.187 1.237 3.712 3.042 3.712 1.06 0 1.88-.575 2.276-1.545h.062c.13.963.943 1.551 2.023 1.551 1.907 0 3.09-1.873 3.09-4.498 0-3.971-2.92-6.548-6.96-6.548C3.886.727.912 3.632.912 8.034zm6.911 2.652c-1.223 0-2.003-1.018-2.003-2.638 0-1.593.786-2.611 2.01-2.611 1.258 0 2.05.998 2.05 2.584 0 1.62-.813 2.665-2.057 2.665z"})})},874650:(e,t,o)=>{o.d(t,{r:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("basicClock",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M4.541 7.919a.53.53 0 01-.39-.157.53.53 0 01-.157-.39c0-.155.053-.282.157-.383a.53.53 0 01.39-.157h2.905V2.895c0-.15.053-.278.158-.383a.521.521 0 01.382-.158.53.53 0 01.39.158.521.521 0 01.157.383v4.477a.53.53 0 01-.157.39.53.53 0 01-.39.157H4.541zm3.452 6.207a6.789 6.789 0 01-2.727-.554 7.124 7.124 0 01-2.256-1.524 7.277 7.277 0 01-1.525-2.256 6.788 6.788 0 01-.553-2.728c0-.966.184-1.875.553-2.727A7.241 7.241 0 015.258.557 6.788 6.788 0 017.987.003c.971 0 1.882.184 2.735.554.852.369 1.604.88 2.256 1.53a7.136 7.136 0 011.53 2.25c.37.852.555 1.761.555 2.727 0 .967-.185 1.876-.554 2.728a7.218 7.218 0 01-3.787 3.78 6.789 6.789 0 01-2.728.554zm0-1.395c.789 0 1.525-.145 2.208-.437a5.678 5.678 0 001.805-1.217 5.68 5.68 0 001.217-1.805c.291-.683.437-1.42.437-2.208a5.55 5.55 0 00-.437-2.2 5.66 5.66 0 00-3.029-3.029 5.567 5.567 0 00-2.208-.438c-.784 0-1.52.146-2.208.438A5.6 5.6 0 003.98 3.052a5.715 5.715 0 00-1.21 1.811 5.55 5.55 0 00-.437 2.201c0 .789.146 1.525.438 2.208a5.735 5.735 0 001.21 1.805 5.598 5.598 0 004.013 1.654z"})})},29248:(e,t,o)=>{o.d(t,{K:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("boltFilled",{svg:(0,n.jsx)("path",{d:"M0 12.117c0 .38.293.664.703.664h5.518l-2.91 7.91c-.381 1.006.664 1.543 1.318.723l8.877-11.094c.166-.205.254-.4.254-.625 0-.371-.293-.664-.703-.664H7.539l2.91-7.91C10.83.115 9.785-.422 9.131.408L.254 11.492c-.166.215-.254.41-.254.625z"}),viewBox:"0 0 14 22"})},242550:(e,t,o)=>{o.d(t,{A:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("checkMarkLine",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M6.79297 13.2871C6.48047 13.2871 6.21484 13.1523 5.99609 12.8828L2.96094 9.14453C2.875 9.04297 2.8125 8.94336 2.77344 8.8457C2.73828 8.74805 2.7207 8.64648 2.7207 8.54102C2.7207 8.30664 2.79883 8.11328 2.95508 7.96094C3.11133 7.80859 3.30859 7.73242 3.54688 7.73242C3.81641 7.73242 4.04297 7.84766 4.22656 8.07812L6.76953 11.3008L11.7324 3.4375C11.834 3.28125 11.9395 3.17188 12.0488 3.10938C12.1582 3.04297 12.2949 3.00977 12.459 3.00977C12.6973 3.00977 12.8926 3.08398 13.0449 3.23242C13.1973 3.38086 13.2734 3.57031 13.2734 3.80078C13.2734 3.89453 13.2578 3.98828 13.2266 4.08203C13.1953 4.17578 13.1465 4.27344 13.0801 4.375L7.5957 12.8594C7.4082 13.1445 7.14062 13.2871 6.79297 13.2871Z"})})},619857:(e,t,o)=>{o.d(t,{Y:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("chevronDownThin",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M8 11.4795C7.77214 11.4795 7.56478 11.3883 7.37793 11.2061L2.17578 5.88086C2.09831 5.80794 2.03906 5.72591 1.99805 5.63477C1.96159 5.53906 1.94336 5.43652 1.94336 5.32715C1.94336 5.17676 1.97754 5.04004 2.0459 4.91699C2.11882 4.79395 2.21452 4.69824 2.33301 4.62988C2.4515 4.55697 2.58594 4.52051 2.73633 4.52051C2.95508 4.52051 3.14648 4.60254 3.31055 4.7666L8.33496 9.91406H7.67188L12.6895 4.7666C12.8535 4.60254 13.0449 4.52051 13.2637 4.52051C13.4141 4.52051 13.5485 4.55697 13.667 4.62988C13.7855 4.69824 13.8789 4.79395 13.9473 4.91699C14.0202 5.04004 14.0566 5.17676 14.0566 5.32715C14.0566 5.54134 13.9792 5.72591 13.8242 5.88086L8.62207 11.2061C8.53548 11.2972 8.43978 11.3656 8.33496 11.4111C8.23014 11.4567 8.11849 11.4795 8 11.4795Z"})})},570328:(e,t,o)=>{o.d(t,{e:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("collectionSearch",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M0 6.35938C0 9.86719 2.85156 12.7188 6.35938 12.7188C7.66406 12.7188 8.85938 12.3203 9.85938 11.6406L13.4531 15.2344C13.6719 15.4609 13.9766 15.5625 14.2812 15.5625C14.9453 15.5625 15.4219 15.0625 15.4219 14.4141C15.4219 14.1016 15.3125 13.8125 15.1016 13.5938L11.5312 10.0156C12.2734 8.99219 12.7188 7.72656 12.7188 6.35938C12.7188 2.85156 9.86719 0 6.35938 0C2.85156 0 0 2.85156 0 6.35938ZM1.65625 6.35938C1.65625 3.76562 3.75781 1.65625 6.35938 1.65625C8.95312 1.65625 11.0625 3.76562 11.0625 6.35938C11.0625 8.95312 8.95312 11.0625 6.35938 11.0625C3.75781 11.0625 1.65625 8.95312 1.65625 6.35938Z"})})},605305:(e,t,o)=>{o.d(t,{K:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("externalLink",{viewBox:"0 0 17 16",svg:(0,n.jsx)("path",{d:"M4.94922 13.498C4.31641 13.498 3.83789 13.3359 3.51367 13.0117C3.18945 12.6914 3.02734 12.2188 3.02734 11.5938V4.46289C3.02734 3.83398 3.18945 3.35938 3.51367 3.03906C3.83789 2.71875 4.31641 2.55859 4.94922 2.55859H12.0449C12.6777 2.55859 13.1562 2.71875 13.4805 3.03906C13.8047 3.35938 13.9668 3.83398 13.9668 4.46289V11.5938C13.9668 12.2188 13.8047 12.6914 13.4805 13.0117C13.1562 13.3359 12.6777 13.498 12.0449 13.498H4.94922ZM5.01953 12.3438H11.9746C12.2441 12.3438 12.4512 12.2734 12.5957 12.1328C12.7402 11.9922 12.8125 11.7793 12.8125 11.4941V4.55664C12.8125 4.27539 12.7402 4.06445 12.5957 3.92383C12.4512 3.7832 12.2441 3.71289 11.9746 3.71289H5.01953C4.74609 3.71289 4.53711 3.7832 4.39258 3.92383C4.25195 4.06445 4.18164 4.27539 4.18164 4.55664V11.4941C4.18164 11.7793 4.25195 11.9922 4.39258 12.1328C4.53711 12.2734 4.74609 12.3438 5.01953 12.3438ZM10.334 9.54297C10.1855 9.54297 10.0664 9.49609 9.97656 9.40234C9.89062 9.30859 9.84766 9.17969 9.84766 9.01562V8.08398L9.93555 7.24609L9.15039 8.10156L7.09961 10.1465C6.99023 10.2559 6.85742 10.3105 6.70117 10.3105C6.55273 10.3105 6.42969 10.2637 6.33203 10.1699C6.23828 10.0762 6.19141 9.95117 6.19141 9.79492C6.19141 9.6582 6.24609 9.53516 6.35547 9.42578L8.41211 7.36914L9.2793 6.57227L8.47656 6.66602H7.48633C7.32617 6.66602 7.19727 6.62305 7.09961 6.53711C7.00586 6.45117 6.95898 6.33203 6.95898 6.17969C6.95898 6.03516 7.00586 5.91992 7.09961 5.83398C7.19727 5.74414 7.32422 5.69922 7.48047 5.69922H10.2227C10.4062 5.69922 10.5508 5.74609 10.6562 5.83984C10.7617 5.93359 10.8145 6.08398 10.8145 6.29102V9.00977C10.8145 9.16602 10.7695 9.29492 10.6797 9.39648C10.5938 9.49414 10.4785 9.54297 10.334 9.54297Z"})})},330814:(e,t,o)=>{o.d(t,{z:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("flag",{viewBox:"0 0 13 14",svg:(0,n.jsx)("path",{d:"M0.825195 13.8457C1.16699 13.8457 1.4541 13.5654 1.4541 13.2168V9.47754C1.63867 9.40918 2.21973 9.19727 3.10156 9.19727C5.59668 9.19727 7.25781 10.4414 9.66406 10.4414C10.7168 10.4414 11.1885 10.3115 11.7217 10.0654C12.207 9.84668 12.4941 9.4502 12.4941 8.82129V1.99219C12.4941 1.55469 12.1523 1.27441 11.6943 1.27441C11.3047 1.27441 10.6895 1.54102 9.58887 1.54102C7.20996 1.54102 5.52148 0.296875 3.0332 0.296875C1.99414 0.296875 1.5293 0.419922 0.975586 0.672852C0.49707 0.891602 0.196289 1.24707 0.196289 1.86914V13.2168C0.196289 13.5586 0.483398 13.8457 0.825195 13.8457ZM9.63672 9.16309C7.41504 9.16309 5.71289 7.92578 3.12207 7.92578C2.45215 7.92578 1.84375 8.00098 1.48145 8.14453V2.0332C1.59766 1.83496 2.11035 1.56836 3.05371 1.56836C5.38477 1.56836 7.09375 2.80566 9.56836 2.80566C10.2383 2.80566 10.792 2.73047 11.2158 2.61426V8.69824C11.0996 8.89648 10.5801 9.16309 9.63672 9.16309Z"})})},81979:(e,t,o)=>{o.d(t,{o:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("globe2",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM3.88477 3.76465C4.56836 3.11523 5.39551 2.61621 6.31836 2.34277C5.83301 2.82812 5.42285 3.51172 5.11523 4.3457C4.63672 4.19531 4.22656 3.99707 3.88477 3.76465ZM9.68848 2.34961C10.6045 2.62305 11.4316 3.11523 12.1084 3.76465C11.7734 4.00391 11.3633 4.19531 10.8848 4.35254C10.5771 3.51172 10.167 2.82812 9.68848 2.34961ZM8.47852 2.56836C9.0459 2.8418 9.56543 3.58008 9.93457 4.58496C9.4834 4.66699 8.99805 4.71484 8.47852 4.73535V2.56836ZM6.06543 4.58496C6.44141 3.58008 6.9541 2.8418 7.52148 2.56836V4.73535C7.00195 4.71484 6.5166 4.66699 6.06543 4.58496ZM2.05273 7.58594C2.14844 6.42383 2.58594 5.35059 3.25586 4.46875C3.67285 4.77637 4.21289 5.04297 4.8418 5.24121C4.66406 5.95215 4.54785 6.74512 4.51367 7.58594H2.05273ZM11.4863 7.58594C11.4521 6.74512 11.3359 5.95215 11.1582 5.24121C11.7871 5.04297 12.3271 4.7832 12.7373 4.46875C13.4141 5.35059 13.8516 6.42383 13.9473 7.58594H11.4863ZM5.49121 7.58594C5.52539 6.84082 5.62793 6.12988 5.78516 5.4873C6.33203 5.59668 6.91309 5.66504 7.52148 5.69238V7.58594H5.49121ZM8.47852 7.58594V5.69238C9.08691 5.66504 9.66797 5.59668 10.2148 5.4873C10.3721 6.12988 10.4746 6.84082 10.5088 7.58594H8.47852ZM2.05273 8.54297H4.51367C4.54785 9.39746 4.66406 10.1973 4.8418 10.915C4.21973 11.1133 3.68652 11.373 3.27637 11.6807C2.59277 10.792 2.14844 9.71191 2.05273 8.54297ZM5.49121 8.54297H7.52148V10.4707C6.91992 10.498 6.33203 10.5664 5.79199 10.6689C5.62793 10.0195 5.51855 9.29492 5.49121 8.54297ZM8.47852 10.4707V8.54297H10.5088C10.4814 9.29492 10.3721 10.0195 10.208 10.6689C9.66797 10.5664 9.08691 10.498 8.47852 10.4707ZM11.1582 10.915C11.3428 10.1973 11.4521 9.39746 11.4863 8.54297H13.9473C13.8516 9.71191 13.4072 10.792 12.7236 11.6807C12.3135 11.373 11.7803 11.1133 11.1582 10.915ZM8.47852 11.4277C8.99121 11.4482 9.47656 11.4961 9.9209 11.5781C9.55176 12.5625 9.03906 13.2939 8.47852 13.5605V11.4277ZM6.0791 11.5781C6.52344 11.4961 7.00879 11.4482 7.52148 11.4277V13.5605C6.96094 13.2939 6.44824 12.5625 6.0791 11.5781ZM3.90527 12.3848C4.24023 12.1523 4.65039 11.9609 5.12207 11.8105C5.42969 12.6309 5.83301 13.3008 6.30469 13.7793C5.40234 13.5059 4.58203 13.0205 3.90527 12.3848ZM10.8779 11.8105C11.3496 11.9609 11.7598 12.1523 12.0947 12.3848C11.418 13.0205 10.5977 13.5059 9.69531 13.7793C10.167 13.3008 10.5703 12.6309 10.8779 11.8105Z"})})},891142:(e,t,o)=>{o.d(t,{S:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("historyBack",{viewBox:"0 0 14 14",svg:(0,n.jsx)("polygon",{points:"2.85893 7.74676 8.05608 12.9439 7 14 0.528042 7.52804 0 7 0.528042 6.47196 7 0 8.05608 1.05608 2.85893 6.25324 14 6.25324 14 7.74676"})})},856870:(e,t,o)=>{o.d(t,{O:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("mention",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M0.870117 8.40625C0.870117 4.01758 3.86426 1.09863 8.14355 1.09863C12.2109 1.09863 15.123 3.68945 15.123 7.6543C15.123 10.293 13.9131 12.1318 11.9443 12.1318C10.8506 12.1318 10.0439 11.5645 9.87988 10.6279H9.79785C9.4082 11.5781 8.62207 12.1318 7.57617 12.1318C5.77148 12.1318 4.53418 10.6143 4.53418 8.42676C4.53418 6.2666 5.76465 4.77637 7.52148 4.77637C8.52637 4.77637 9.36035 5.28906 9.70215 6.12305H9.79102V5.4668C9.79102 5.03613 10.0371 4.77637 10.4473 4.77637C10.8574 4.77637 11.0967 5.03613 11.0967 5.4668V9.85547C11.0967 10.5801 11.4932 11.0039 12.1904 11.0039C13.2363 11.0039 13.8926 9.69141 13.8926 7.74316C13.8926 4.26367 11.3223 2.28125 8.12988 2.28125C4.56836 2.28125 2.18262 4.81055 2.18262 8.44727C2.18262 12.2207 4.69141 14.4629 8.42383 14.4629C9.29883 14.4629 9.94141 14.3398 10.6797 14.1689C10.8164 14.1416 10.9326 14.1279 11.0283 14.1279C11.3428 14.1279 11.5547 14.3398 11.5547 14.6338C11.5547 14.9141 11.3975 15.1533 10.9463 15.3037C10.3242 15.5088 9.31934 15.6523 8.19824 15.6523C3.93262 15.6523 0.870117 12.8975 0.870117 8.40625ZM7.84277 10.9014C8.99805 10.9014 9.73633 9.93066 9.73633 8.41309C9.73633 6.92285 9.00488 5.98633 7.84961 5.98633C6.71484 5.98633 5.99707 6.93652 5.99707 8.44043C5.99707 9.95117 6.70801 10.9014 7.84277 10.9014Z"})})},76910:(e,t,o)=>{o.d(t,{n:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("refresh",{viewBox:"0 0 14 15",svg:(0,n.jsx)("path",{d:"m1.382 7.22 1.294-1.782q.156-.215.376-.215c.22 0 .272.071.376.215l1.289 1.787q.195.263.112.483-.078.215-.39.215H3.69a3.7 3.7 0 0 0 .445 1.24q.337.576.844 1.016.508.435 1.153.673.645.245 1.372.245.771 0 1.445-.288a3.8 3.8 0 0 0 1.182-.777q.277-.225.537-.195a.61.61 0 0 1 .552.674q-.015.258-.254.464-.66.639-1.553 1.02a4.8 4.8 0 0 1-1.91.386 5.13 5.13 0 0 1-3.428-1.304 5.4 5.4 0 0 1-1.132-1.42 5 5 0 0 1-.561-1.734h-.718q-.322 0-.4-.215-.074-.22.117-.488Zm2.666-3.745q.66-.64 1.553-1.02a4.75 4.75 0 0 1 1.904-.387q.99 0 1.865.347a5.2 5.2 0 0 1 1.563.962q.694.615 1.132 1.426.44.806.567 1.728h.703q.317 0 .395.22.083.215-.112.483l-1.294 1.783q-.156.214-.376.214-.215 0-.37-.214l-1.295-1.788q-.195-.263-.112-.478.083-.22.395-.22h.757a3.7 3.7 0 0 0-.454-1.24 3.85 3.85 0 0 0-1.987-1.69 3.8 3.8 0 0 0-1.377-.248q-.762 0-1.44.288a3.8 3.8 0 0 0-1.182.776q-.279.225-.537.195a.63.63 0 0 1-.42-.23.6.6 0 0 1-.137-.439q.02-.258.259-.468"})})},229010:(e,t,o)=>{o.d(t,{N:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("repeat",{viewBox:"0 0 16 14",svg:(0,n.jsx)("path",{d:"M1.185 7.317a.689.689 0 00.697-.704v-.601c0-1.19.806-1.942 2.064-1.942H9.23v1.573c0 .328.199.52.527.52a.66.66 0 00.403-.144l2.68-2.236c.253-.212.26-.547 0-.765L10.16.782A.62.62 0 009.757.64c-.328 0-.527.184-.527.52v1.53H4.05C1.875 2.69.48 3.9.48 5.875v.738c0 .397.308.704.705.704zm13.624-.649a.689.689 0 00-.698.704v.608c0 1.19-.806 1.942-2.064 1.942H6.763V8.35c0-.329-.199-.52-.527-.52a.66.66 0 00-.403.144l-2.68 2.242c-.26.212-.26.547 0 .759l2.68 2.242a.66.66 0 00.403.143c.328 0 .527-.191.527-.52v-1.544h5.181c2.174 0 3.569-1.21 3.569-3.179v-.745a.695.695 0 00-.704-.704z"})})},899548:(e,t,o)=>{o.d(t,{R:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("search",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M.281 6.438c0-.875.164-1.696.492-2.461a6.484 6.484 0 011.375-2.032A6.237 6.237 0 016.64.078 6.2 6.2 0 019.11.57c.77.328 1.447.787 2.03 1.375a6.374 6.374 0 011.368 2.032c.333.765.5 1.586.5 2.46 0 .688-.107 1.342-.32 1.961a6.28 6.28 0 01-.868 1.696l3.563 3.578c.11.104.19.226.242.367.057.14.086.29.086.445 0 .22-.05.417-.149.594a1.122 1.122 0 01-1 .57c-.156 0-.307-.028-.453-.086a1.058 1.058 0 01-.382-.25l-3.586-3.585c-.5.333-1.047.596-1.641.789a6.089 6.089 0 01-1.86.28 6.237 6.237 0 01-2.468-.491 6.4 6.4 0 01-2.024-1.367A6.509 6.509 0 01.773 8.913a6.256 6.256 0 01-.492-2.476zm1.664 0c0 .65.12 1.26.36 1.828a4.775 4.775 0 001.015 1.5c.433.427.933.763 1.5 1.007a4.548 4.548 0 001.82.368c.652 0 1.261-.123 1.829-.368a4.747 4.747 0 002.508-2.507 4.567 4.567 0 00.367-1.829c0-.645-.123-1.252-.367-1.82a4.776 4.776 0 00-1.016-1.5A4.578 4.578 0 008.469 2.11a4.567 4.567 0 00-1.828-.367c-.646 0-1.253.123-1.82.367a4.667 4.667 0 00-1.5 1.008c-.433.432-.772.932-1.016 1.5a4.633 4.633 0 00-.36 1.82z"})})},961507:(e,t,o)=>{o.d(t,{_:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("sendArrow",{viewBox:"0 0 20 20",svg:(0,n.jsx)("path",{d:"M9.79883 18.5894C14.6216 18.5894 18.5894 14.6216 18.5894 9.79883C18.5894 4.96777 14.6216 1 9.79053 1C4.95947 1 1 4.96777 1 9.79883C1 14.6216 4.96777 18.5894 9.79883 18.5894ZM9.79883 14.3062C9.20947 14.3062 8.76953 13.9077 8.76953 13.3433V9.69922L8.86914 8.00586L8.25488 8.84424L7.3916 9.81543C7.23389 10.0063 6.98486 10.1143 6.72754 10.1143C6.21289 10.1143 5.84766 9.75732 5.84766 9.25928C5.84766 8.99365 5.92236 8.79443 6.12158 8.58691L8.96045 5.61523C9.19287 5.35791 9.4585 5.2417 9.79883 5.2417C10.1309 5.2417 10.4048 5.36621 10.6372 5.61523L13.4761 8.58691C13.667 8.79443 13.75 8.99365 13.75 9.25928C13.75 9.75732 13.3848 10.1143 12.8618 10.1143C12.6128 10.1143 12.3638 10.0063 12.2061 9.81543L11.3428 8.86914L10.7202 7.99756L10.8281 9.69922V13.3433C10.8281 13.9077 10.3799 14.3062 9.79883 14.3062Z"})})},525372:(e,t,o)=>{o.d(t,{P:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("slackLogo",{viewBox:"0 0 16 16",svg:(0,n.jsxs)("g",{children:[(0,n.jsx)("path",{d:"M1.68078 11.7915C2.60586 11.7915 3.36156 11.0358 3.36156 10.1107V8.42993H1.68078C0.755701 8.42993 0 9.18563 0 10.1107C0 11.0358 0.755701 11.7915 1.68078 11.7915Z",fill:"#E01E5A"}),(0,n.jsx)("path",{d:"M5.88928 8.42993C4.9642 8.42993 4.2085 9.18563 4.2085 10.1107V14.3192C4.2085 15.2443 4.9642 16 5.88928 16C6.81436 16 7.57006 15.2443 7.57006 14.3192V10.1107C7.57006 9.18563 6.81436 8.42993 5.88928 8.42993Z",fill:"#E01E5A"}),(0,n.jsx)("path",{d:"M4.2085 1.68078C4.2085 2.60586 4.9642 3.36156 5.88928 3.36156H7.57006V1.68078C7.57006 0.755701 6.81436 0 5.88928 0C4.9642 0 4.2085 0.755701 4.2085 1.68078Z",fill:"#36C5F0"}),(0,n.jsx)("path",{d:"M7.57003 5.88928C7.57003 4.9642 6.81433 4.2085 5.88925 4.2085H1.68078C0.755701 4.2085 0 4.9642 0 5.88928C0 6.81436 0.755701 7.57006 1.68078 7.57006H5.88925C6.81433 7.57006 7.57003 6.81436 7.57003 5.88928Z",fill:"#36C5F0"}),(0,n.jsx)("path",{d:"M10.1107 7.57003C11.0358 7.57003 11.7915 6.81433 11.7915 5.88925V1.68078C11.7915 0.755701 11.0358 0 10.1107 0C9.18563 0 8.42993 0.755701 8.42993 1.68078V5.88925C8.42993 6.81433 9.18563 7.57003 10.1107 7.57003Z",fill:"#2EB67D"}),(0,n.jsx)("path",{d:"M14.3192 4.2085C13.3941 4.2085 12.6384 4.9642 12.6384 5.88928V7.57006H14.3192C15.2443 7.57006 16 6.81436 16 5.88928C16 4.9642 15.2443 4.2085 14.3192 4.2085Z",fill:"#2EB67D"}),(0,n.jsx)("path",{d:"M8.42993 10.1107C8.42993 11.0358 9.18563 11.7915 10.1107 11.7915H14.3192C15.2443 11.7915 16 11.0358 16 10.1107C16 9.18563 15.2443 8.42993 14.3192 8.42993H10.1107C9.18563 8.42993 8.42993 9.18563 8.42993 10.1107Z",fill:"#ECB22E"}),(0,n.jsx)("path",{d:"M11.7915 14.3192C11.7915 13.3941 11.0358 12.6384 10.1107 12.6384H8.42993V14.3192C8.42993 15.2443 9.18563 16 10.1107 16C11.0358 16 11.7915 15.2443 11.7915 14.3192Z",fill:"#ECB22E"})]})})},856466:(e,t,o)=>{o.d(t,{$X:()=>r,F_:()=>l,iZ:()=>a});o(267602),o(470928);var n=()=>o(926724),i=()=>o(295617);const a={autoCompleteSprints:!1,actionConfig:{complete_sprint_action:"complete_sprint_and_move_incomplete_tasks_to_next_sprint"},recurrenceConfig:{interval:2,weekdays:["MO"]}};function r(e){const{eventTracker:t,properties:o}=e;t.DO_NOT_USE_commonTrackEvent({eventName:"complete_sprint_action",properties:o})}function l(e,t){var o;return null===(o=t.groups)||void 0===o||null===(o=o.find((t=>t.id===n().nl||(null==t?void 0:t.name)===i().RW||(null==t?void 0:t.name)===e.formatMessage(i().ct.statusGroupNameComplete))))||void 0===o?void 0:o.name}},126301:(e,t,o)=>{o.d(t,{DW:()=>l,IX:()=>r,Su:()=>i,rP:()=>a});var n=()=>o(730120);function i(e){if("week"===e.frequency&&e.weekdays&&1===e.weekdays.length)return{weekday:e.weekdays[0],duration:e.interval}}function a(e){const{currentSprintEndDate:t,sprintSchedule:o}=e;return s({startDate:u({dateToAdjust:n().ou.fromISO(t),weekday:o.weekday,wrapForEqualDays:!0}),duration:o.duration})}function r(e){const{userTimeZone:t,sprintSchedule:o}=e;return s({startDate:n().ou.local({zone:t}),duration:o.duration})}function l(e){const{currentSprintStartDate:t,sprintSchedule:o}=e,i=u({dateToAdjust:n().ou.fromISO(t),weekday:o.weekday,wrapForEqualDays:!1}),{end_date:a}=s({startDate:i,duration:o.duration});let r=n().ou.fromISO(a);const l=n().ou.now().startOf("day");for(;r.diff(l,"days").days<0;)r=r.plus({weeks:1});return{type:"daterange",start_date:r.plus({days:1}).minus({weeks:o.duration}).toISODate(),end_date:r.toISODate()}}function s(e){const{startDate:t,duration:o}=e,n=t.plus({weeks:o}).minus({days:1});return{type:"daterange",start_date:t.toISODate(),end_date:n.toISODate()}}const c={SU:0,MO:1,TU:2,WE:3,TH:4,FR:5,SA:6};function u(e){const{dateToAdjust:t,weekday:o,wrapForEqualDays:n}=e,i=d({currentWeekday:t.weekday%7,nextWeekday:c[o],wrapForEqualDays:n});return t.plus({days:i})}function d(e){const{currentWeekday:t,nextWeekday:o,wrapForEqualDays:n}=e,i="number"==typeof t?t:c[t],a="number"==typeof o?o:c[o];if(i===a)return n?7:0;let r=i,l=0;for(;r!==a;)r===c.SA?r=0:r+=1,l+=1;return l}},993491:(e,t,o)=>{e.exports=o.p+"edfba4a6d1ff7acd.png"}}]);