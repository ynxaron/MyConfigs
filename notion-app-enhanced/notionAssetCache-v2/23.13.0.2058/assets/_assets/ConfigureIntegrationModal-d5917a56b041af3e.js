"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[15116],{41640:(e,t,o)=>{o.r(t),o.d(t,{ConfigureIntegrationModal:()=>X});o(821057),o(241792);var n=o(667294),i=()=>o(219727),a=()=>o(142735),r=()=>o(846550),l=()=>o(205248),s=()=>o(85073),d=()=>o(989478),c=()=>o(441764),g=()=>o(921787),u=()=>o(788860),h=()=>o(513670),p=()=>o(855741),f=()=>o(88142),v=()=>o(308186),b=()=>o(102182),m=()=>o(423402),x=()=>o(404811),y=()=>o(527278),k=()=>o(148126),w=()=>o(466970),M=()=>o(998901),j=()=>o(876822),I=()=>o(853946),S=()=>o(749826),C=()=>o(826955),Z=(o(267602),o(653476),()=>o(94250)),U=()=>o(717956),_=()=>o(698005),T=()=>o(159732),H=()=>o(265640),B=()=>o(1910),L=()=>o(291198),V=()=>o(67961),K=()=>o(167830),P=o(785893);const R=(0,u().vU)({remove:{id:"integrations.configureIntegrationModal.webhookHeadersRemove",defaultMessage:"Remove"},toggleSecretVisibility:{id:"integrations.configureIntegrationModal.toggleSecretVisibility",defaultMessage:"Toggle secret visibility"}});function z(e){const{headers:t,onChange:o}=e,i=W(),a=(0,n.useCallback)(((e,n)=>{const i=t.map(((t,o)=>o===n?e:t));o(i)}),[t,o]),r=(0,n.useCallback)((e=>{const n=t.filter(((t,o)=>o!==e));o(n)}),[t,o]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(K().Z,{style:{display:"flex",alignItems:"center",marginTop:24},children:(0,P.jsx)(u()._H,{id:"integrations.configureIntegrationModal.webhookHeadersInput",defaultMessage:"Webhook Headers"})}),(0,P.jsxs)("div",{style:{maxHeight:"30vh",overflow:"auto",width:"100%"},children:[t.length>0&&(0,P.jsxs)("div",{style:i.headerRow,children:[(0,P.jsx)(V().Z,{style:i.columnLabel,isSmall:!0,children:(0,P.jsx)(u()._H,{id:"integrations.configureIntegrationModal.webhookHeadersKey",defaultMessage:"Key"})}),(0,P.jsx)(V().Z,{style:{...i.columnLabel,marginLeft:8,marginRight:32},isSmall:!0,children:(0,P.jsx)(u()._H,{id:"integrations.configureIntegrationModal.webhookHeadersValue",defaultMessage:"Value"})})]}),t.map(((e,t)=>(0,P.jsx)(E,{header:e,onChange:a,onDelete:r,index:t},t)))]}),(0,P.jsx)(H().D,{style:{marginTop:8},isGray:!0,icon:T().R,onClick:()=>{o([...t,{key:"",value:""}])},children:(0,P.jsx)(u()._H,{id:"integrations.configureIntegrationModal.webhookHeadersAdd",defaultMessage:"New"})})]})}function E(e){const{header:t,index:o,onChange:i,onDelete:a}=e,r=W(),[l,s]=n.useState(!1);return(0,P.jsxs)("div",{style:r.headerRow,children:[(0,P.jsx)(L().Z,{value:t.key,onChange:e=>{i({key:e.target.value,value:t.value},o)}}),(0,P.jsx)(L().Z,{style:r.valueColumn,value:t.value,onChange:e=>{i({key:t.key,value:e.target.value},o)},type:l?"text":"password",right:(0,P.jsx)("div",{style:{display:"flex"},children:(0,P.jsx)(B().Z,{icon:l?Z().c:U().B,onClick:()=>s(!l),ariaLabel:y().Z.formatMessage(R.toggleSecretVisibility),isBlue:!0,iconStyle:{height:18,width:18},style:{height:18}})})}),(0,P.jsx)(B().Z,{style:r.removeButton,onClick:()=>{a(o)},icon:_().$,ariaLabel:y().Z.formatMessage(R.remove)})]})}function W(){return(0,r().yK)((e=>({removeButton:{width:28,height:28,marginLeft:4},headerRow:{marginTop:8,display:"flex"},valueColumn:{marginLeft:8},columnLabel:{width:"100%",textAlign:"start"}})),[])}const D=(0,u().vU)({toggleSecretVisibility:{id:"integrations.configureIntegrationShowSecret.toggleSecretVisibility",defaultMessage:"Toggle secret visibility"}});function A(e){const{secret:t,onChange:o,submit:i,placeholder:a}=e,[r,l]=n.useState(!1);return(0,P.jsx)(L().Z,{type:r?"text":"password",value:t,onChange:o,placeholder:a,style:{padding:"4px 8px"},focusInitial:!1,onKeyDown:e=>{"Enter"===e.key&&i()},right:t&&(0,P.jsx)("div",{style:{display:"flex"},children:(0,P.jsx)(B().Z,{icon:r?Z().c:U().B,onClick:()=>{l(!r)},ariaLabel:y().Z.formatMessage(D.toggleSecretVisibility),isBlue:!0,iconStyle:{height:18,width:18},style:{height:18}})})})}var N=()=>o(802076),F=()=>o(432745),O=()=>o(312578),J=()=>o(906651),Y=()=>o(654133),$=()=>o(756745),q=()=>o(840820),G=()=>o(360964);const Q=(0,u().vU)({webhookUrlPlaceholder:{id:"integrations.configureIntegrationModal.webhookUrlInput.placeholder",defaultMessage:"Paste webhook URL"},webhookSecretPlaceholder:{id:"integrations.configureIntegrationModal.webhookSecretInput.placeholder",defaultMessage:"Paste token"},updateButton:{id:"integrations.configureIntegrationModal.submitButton.update",defaultMessage:"Update"},createButton:{id:"integrations.configureIntegrationModal.submitButton.create",defaultMessage:"Connect"},errorOccurred:{id:"integrations.configureIntegrationModal.error.dialog",defaultMessage:"Failed to connect {integration}. Please contact support."},closeModalAriaLabel:{id:"integrations.configureIntegrationModal.closeButtonLabel",defaultMessage:"Close integration configuration modal"}});function X(){const e=(0,i().O7)(),t=(0,r().yK)((e=>({errorText:{color:e.errorText,fontSize:12},input:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:360},helpInfo:{display:"inline-flex",marginLeft:1}})),[]),o=(0,F().useConnectIntegrationModalStyles)(),Z=(0,a().VK)((()=>I().Z.state.open),[]),U=(0,a().VK)((()=>I().Z.state.open?I().Z.state.integrationId:void 0),[]),_=(0,a().VK)((()=>I().Z.state.open?I().Z.state.webhookSubscriptionId:void 0),[]),T=(0,a().VK)((()=>j().default.state.currentSpaceStore),[]),H=U&&T?C().y2.createChildStore(T,{id:U,table:s().K2}):void 0,V=_&&T?C().n4.createChildStore(T,{id:_,table:c().bf,spaceId:T.id}):void 0;(0,n.useEffect)((()=>{const{webhookUrl:e,webhookSecret:t,webhookCustomization:o}={webhookUrl:(null==V?void 0:V.getWebhookUrl())||"",webhookSecret:(null==V?void 0:V.getWebhookSecret())||"",webhookCustomization:(null==V?void 0:V.getWebhookCustomization())||void 0};E(e),D(t);const n=(null==o?void 0:o.headers)||{},i=Object.entries(n).map((e=>{let[t,o]=e;return{key:t,value:o}})).sort(((e,t)=>e.key.localeCompare(t.key)));ee(i)}),[V]);const[R,E]=n.useState(""),[W,D]=n.useState(""),[X,ee]=n.useState([]),[te,oe]=n.useState(!1),[ne,ie]=n.useState(!1),[ae,re]=n.useState(!1),le=(0,a().VK)((()=>{if(H)return H.getModel()}),[H]),se=(0,g().RW)(U),de=h().TS({},g().iV,null==se?void 0:se.customization).headers.hmac,ce=(0,w().E)("allow_customize_integration_headers"),ge=(0,n.useCallback)((e=>{if("internal"===(null==le?void 0:le.type))throw new Error("internal integrations are not supported");e&&(re(!1),v().UW(y().Z.formatMessage(Q.errorOccurred,{integration:null==le?void 0:le.getInfo().developer_name})))}),[le]),ue=(0,n.useCallback)((async()=>{if(!ae){if(!se||!(0,g().M2)({env:"production",integrationConfig:se,webhookUrlToValidate:R,experimentService:S().default,actor:{table:d().KJ,id:e.currentUser.id||""},spaceId:(null==T?void 0:T.id)||""}))return oe(!0),void re(!1);if(oe(!1),de&&!W)return ie(!0),void re(!1);if(re(!0),le){const t=await x().E({environment:e,integration:le,webhookUrl:R,webhookSecret:W,webhookHeaders:X,webhookSubscriptionId:_,onError:ge,onSuccess:()=>b().oV({label:(0,P.jsx)(u()._H,{id:"configureIntegrationModal.snackbar.title",defaultMessage:"Added {integrationName} to your workspace",values:{integrationName:le.name}})})});if(p().x.isFail(t))return void re(!1);await m().pJ({environment:e}),await f().v({environment:e}),fe()}}}),[e,ge,le,ae,W,X,de,_,R,se,T]),he=(0,n.useCallback)((e=>D(e.target.value)),[]),pe=(0,n.useCallback)((e=>{ee(e)}),[]),fe=()=>{I().Z.setState({open:!1}),E(""),D(""),oe(!1),ie(!1),re(!1)};return le&&se&&T&&"internal"!==le.type?(0,P.jsx)(q().Z,{innerStyle:o.modal,isOpen:Z,onDismiss:fe,render:()=>(0,P.jsxs)("div",{style:o.mobileModal,children:[(0,P.jsxs)("div",{style:o.innerModal,children:[(0,P.jsx)(B().Z,{icon:l().D,onClick:fe,style:o.cancelButton,hoveredStyle:o.hovered,ariaLabel:y().Z.formatMessage(Q.closeModalAriaLabel)}),(0,P.jsx)(N().P,{integrationModel:le,integrationConfig:se,spaceStore:T}),(0,P.jsxs)("div",{style:t.input,children:[(0,P.jsxs)(K().Z,{style:{display:"flex",alignItems:"center",marginTop:40},children:[(0,P.jsx)(u()._H,{id:"integrations.configureIntegrationModal.webhookUrlInput",defaultMessage:"Webhook URL"}),(0,P.jsx)(Y().Z,{placement:M().Placement.Bottom,render:e=>(0,P.jsx)(G().Z,{...e,href:(0,k().UY)("guides.publicAPI"),analyticsFrom:"workspace_connections",style:t.helpInfo}),renderTooltip:()=>(0,P.jsx)(u()._H,{id:"integrations.configureIntegrationModal.webhookUrlInput.tooltip",defaultMessage:"Enter the webhook URL provided by {integrationName}",values:{integrationName:(null==le?void 0:le.getInfo().developer_name)??"Unknown"}})})]}),(0,P.jsx)(L().Z,{type:"text",style:{padding:"4px 8px"},value:R,onChange:e=>{E(e.target.value),oe(!1)},placeholder:y().Z.formatMessage(Q.webhookUrlPlaceholder),focusInitial:!0,onKeyDown:async e=>{"Enter"===e.key&&await ue()}}),te?(0,P.jsx)("div",{style:{marginTop:5,...t.errorText},children:(0,P.jsx)(u()._H,{id:"integrations.configureIntegrationModal.invalidUrl",defaultMessage:"Invalid webhook URL"})}):null]}),se.acceptsSecretToken&&(0,P.jsxs)("div",{style:t.input,children:[(0,P.jsxs)(K().Z,{style:{display:"flex",alignItems:"center",marginTop:24},children:[(0,P.jsx)(u()._H,{id:"integrations.configureIntegrationModal.webhookSecretInput",defaultMessage:"Token"}),(0,P.jsx)(Y().Z,{placement:M().Placement.Bottom,render:e=>(0,P.jsx)(G().Z,{...e,href:(0,k().UY)("guides.publicAPI"),analyticsFrom:"workspace_connections",style:t.helpInfo}),renderTooltip:()=>{var e;return(0,P.jsx)(u()._H,{id:"integrations.configureIntegrationModal.webhookTokenInput.tooltip",defaultMessage:"Enter the token provided by {integrationName}",values:{integrationName:(null==le||null===(e=le.getInfo())||void 0===e?void 0:e.developer_name)??"Unknown"}})}})]}),(0,P.jsx)(A,{secret:W,onChange:he,submit:ue,placeholder:y().Z.formatMessage(Q.webhookSecretPlaceholder)}),ne?(0,P.jsx)("div",{style:{marginTop:5,...t.errorText},children:(0,P.jsx)(u()._H,{id:"integrations.configureIntegrationModal.invalidSecret",defaultMessage:"Webhook secret is required."})}):null]}),se.acceptsCustomHeaders&&ce&&(0,P.jsx)("div",{style:t.input,children:(0,P.jsx)(z,{headers:X,onChange:pe})}),(0,P.jsx)(J().Z,{style:o.connect,onClick:ue,disabled:""===R||de&&""===W,children:ae?(0,P.jsx)(O().Z,{}):(0,P.jsx)("span",{children:_?y().Z.formatMessage(Q.updateButton):y().Z.formatMessage(Q.createButton)})})]}),se.website_url&&(0,P.jsx)($().W,{signupUrl:se.signupUrl??se.website_url})]})}):null}},94250:(e,t,o)=>{o.d(t,{c:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("eye",{viewBox:"0 0 32 32",svg:(0,n.jsx)("path",{d:"M16.006 25.812c8.863 0 14.994-7.17 14.994-9.406C31 14.16 24.858 7 16.006 7 7.252 7 1 14.16 1 16.406c0 2.236 6.252 9.406 15.006 9.406zm0-3.242a6.194 6.194 0 01-6.197-6.164c-.012-3.452 2.744-6.164 6.197-6.164 3.419 0 6.185 2.711 6.185 6.164 0 3.364-2.766 6.164-6.185 6.164zm0-3.94c1.228 0 2.246-1.007 2.246-2.224 0-1.228-1.018-2.235-2.246-2.235-1.24 0-2.258 1.007-2.258 2.235 0 1.217 1.018 2.224 2.258 2.224z"})})},698005:(e,t,o)=>{o.d(t,{$:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("minus",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M3.037 8.844h9.92a.705.705 0 00.368-.103.825.825 0 00.28-.28.73.73 0 000-.773.752.752 0 00-.28-.28.705.705 0 00-.369-.102H3.037a.705.705 0 00-.369.102.824.824 0 00-.28.28.73.73 0 000 .772.914.914 0 00.28.281.705.705 0 00.37.103z"})})}}]);