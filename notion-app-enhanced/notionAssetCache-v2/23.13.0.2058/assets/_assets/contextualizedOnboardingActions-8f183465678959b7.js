"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[81780,95366],{789641:(e,n,t)=>{t.r(n),t.d(n,{DO_NOT_USE_setUserPersonaRoleAndUseCases:()=>le,checkAndApplyTrial:()=>de,clearAllOnboardingStates:()=>ce,createOrJoinSpace:()=>ie,createSpaceAndSetSpaceId:()=>te,createSpaceAsOwner:()=>oe,defaultOnboardingComplete:()=>ue,handleExitOnboarding:()=>ge,handleUserCanNotCreateSpace:()=>ve,joinSpaceAsGuestOrMember:()=>ae,joinSpaceAsGuestOrMemberWithPerformanceTracking:()=>re,onOnboardingCompletePublicAccess:()=>pe,redirectAfterContextualizedOnboardingComplete:()=>X,setAndTrackContextualizedOnboardingComplete:()=>ee,setProfileData:()=>ne,setUserAndSpaceSurveyData:()=>se});t(821057),t(267602),t(653476),t(241792),t(667294);var o=()=>t(506347),a=()=>t(799891),r=()=>t(431595),i=()=>t(35980),s=()=>t(362154),l=()=>t(396136),d=()=>t(282017),c=()=>t(788860),u=()=>t(513670),p=()=>t(696459),g=()=>t(636133),v=()=>t(462928),m=()=>t(407391),S=()=>t(824462),f=()=>t(308186),b=()=>t(231077),w=()=>t(13382),_=()=>t(528918),y=()=>t(636340),I=()=>t(47443),T=()=>t(497065),D=()=>t(96271),O=()=>t(224597),A=()=>t(269299),C=()=>t(13750),k=()=>t(348141),x=()=>t(594546),U=()=>t(286338),R=()=>t(527278),h=()=>t(345918),N=()=>t(803728),P=()=>t(341691),j=()=>t(741636),E=()=>t(70662),L=()=>t(686350),V=()=>t(707138),z=()=>t(267344),M=()=>t(620218),W=()=>t(793935),F=()=>t(876822),H=()=>t(826955),J=()=>t(548812),B=()=>t(334510),Z=()=>t(548919),Y=()=>t(723721),q=()=>t(934262),G=()=>t(281236),$=()=>t(829119),K=()=>t(937419),Q=t(785893);async function X(e){await(0,E().navigateWithRedirectData)(e),ee({environment:e.environment,onboardingState:e.onboardingState,userStore:e.onboardingData.userStore,spaceJoinOrCreate:e.spaceJoinOrCreate,permissionLevel:e.permissionLevel})}function ee(e){const{environment:n,onboardingState:t,userStore:o,spaceJoinOrCreate:a,permissionLevel:r}=e;n.device.isElectron&&b().quickSearchRefresh(),A().createAndCommit({userAction:"onboardingStateActions.setAndTrackContextualizedOnboardingComplete",environment:n,canUndo:!0,perform:e=>{j().Ex({userStore:o,transaction:e})}}),v().PL(n,{...(0,$().getContextualizedOnboardingAnalyticsData)({onboardingState:t,environment:n}),initial_workspace_type:a,permission_level:r}),m().wk(n)}async function ne(e,n){const{onboardingData:t,profileName:o,profilePhoto:a,password:r,emailOptIn:i}=n;if(!t)return;const s=t.userStore;(0,x().Zf)(e,{email_optin_product_tips_and_news:i,email_optin_resources_and_events:i,email_optin_notion_for_startups:i}),A().createAndCommit({userAction:"onboardingHelpers.setProfileData",environment:e,canUndo:!0,perform:e=>{const n={...a&&{profile_photo:a}};n.name=o,y().sW({store:s,data:n,transaction:e})}});const l=await P().shouldCreatePassword(e)&&!function(){var e;const{currentUserSettingsStore:n}=F().default.state;return!(!n||!n.isReady()||"email-password"!==(null===(e=n.getSettings())||void 0===e?void 0:e.mobile_ads_signup_variant))}();r&&l&&await S().callApi({eventName:"setPassword",environment:e,data:{newPassword:r,sendEmail:!1}})}async function te(e,n){var t;if(!e.onboardingData)return;const o=L().Pn(e.onboardingData),{spaceStore:a,inviteLinkCode:r,teamStoreId:i}=await oe({onboardingState:e,onboardingData:e.onboardingData,redirectData:o,planType:null===(t=e.planTypeAndSurveyInfo)||void 0===t?void 0:t.planType,environment:n});K().default.setState({...K().default.state,spaceId:a.id,inviteLinkCode:r,inviteLinkUrl:r?(0,h().cJ)(n,a.id,r):void 0,teamStoreId:i})}async function oe(e){var n,t,o,a;const{onboardingState:r,onboardingData:i,redirectData:s,planType:l,environment:d}=e,{currentSpaceStore:c,currentSpaceViewStore:u}=F().default.state;if(c&&u&&c.id===r.spaceId)return{spaceStore:c,spaceViewStore:u,teamStoreId:r.teamStoreId};_().j({message:E().messages.creatingWorkspace});const p=R().Z.getIntl(),g=i.userStore.getFullName(p),v=M().default.DO_NOT_USE_markLegacy("onboarding.create_space"),m=r.spaceName||L().eW(g||"",p),{spaceViewStore:S,spaceStore:f,inviteLinkCode:b,redirectData:w,teamStoreId:y}=await E().createSpaceWithTemplates({environment:d,isNewUserOnboarding:!!r.isFirstTimeOnboarding,onboardingData:i,userPersona:(null===(n=r.planTypeAndSurveyInfo)||void 0===n||null===(n=n.surveyResponses)||void 0===n?void 0:n.userPersona)||"unfilled",redirectData:s,spaceName:m,spaceIcon:r.spaceIcon||null,planSelection:l,isPrivate:"team"!==l,useCases:(null===(t=r.planTypeAndSurveyInfo)||void 0===t||null===(t=t.surveyResponses)||void 0===t?void 0:t.useCases)||[],categories:(null===(o=r.planTypeAndSurveyInfo)||void 0===o||null===(o=o.surveyResponses)||void 0===o?void 0:o.categories)||[],hasTrialId:!1,selectedWorkflowTemplates:(null==r?void 0:r.selectedWorkflowTemplateIds)||[],collaborativeIntent:null===(a=r.planTypeAndSurveyInfo)||void 0===a?void 0:a.collaborativeIntent});return M().default.DO_NOT_USE_measureLegacy(v,{environment:d,data:{flow:r.flowName,onboarding_complete_data:{stage:(0,$().getStageName)({flowName:r.flowName,stageIndex:r.currentStageIndex,environment:d}),redirect_data:s,is_new_user:!0,permission_level:"member",plan:l}}}),_().x(),{spaceViewStore:S,spaceStore:f,inviteLinkCode:b,newRedirectData:w,teamStoreId:y}}async function ae(e){const{onboardingData:n,redirectData:t,currentUserRootStore:o,currentUserSettingsStore:a,environment:r}=e;if("guest_redirect"===t.type){const{spaceViewStore:e}=await O().j({environment:r,spaceId:t.spaceId,userRootStore:o,analyticsFrom:"onboarding",userSettingsStore:a,navigate:!1,redirectPageId:t.pageId,isOnboarding:!0});return{spaceViewStore:e}}{const{spaceViewStore:e}=await E().joinTeamSpaceWithTemplates({environment:r,onboardingData:n,redirectData:t,spaceId:K().default.state.spaceId,isNewUserOnboarding:!!K().default.state.isFirstTimeOnboarding});return{spaceViewStore:e}}}async function re(e){const{onboardingState:n,onboardingData:t,redirectData:o,currentUserRootStore:a,currentUserSettingsStore:r,environment:i}=e;_().j({message:E().messages.joiningWorkspace});const s=M().default.DO_NOT_USE_markLegacy("onboarding.join_space"),{spaceViewStore:l}=await ae({onboardingData:t,redirectData:o,currentUserRootStore:a,currentUserSettingsStore:r,environment:i});return M().default.DO_NOT_USE_measureLegacy(s,{environment:i,data:{flow:n.flowName,onboarding_complete_data:{stage:(0,$().getStageName)({flowName:n.flowName,stageIndex:n.currentStageIndex,environment:i}),redirect_data:o,is_new_user:!0,permission_level:L().xk(o)}}}),_().x(),{spaceViewStore:l}}async function ie(e){const{spaceJoinOrCreate:n,onboardingState:t,onboardingData:o,currentUserRootStore:a,currentUserSettingsStore:r,planType:i,environment:s}=e,l=L().Pn(o);if("create"===n){const{spaceStore:e,spaceViewStore:n,newRedirectData:a,teamStoreId:r}=await oe({onboardingState:t,onboardingData:o,redirectData:l,planType:i,environment:s});return{spaceStore:e,spaceViewStore:n,newRedirectData:a,teamStoreId:r}}if("join"===n){const{spaceViewStore:e}=await re({onboardingState:t,onboardingData:o,redirectData:l,currentUserRootStore:a,currentUserSettingsStore:r,environment:s});return{spaceViewStore:e}}(0,p().t1)(n)}function se(e){var n,t,o;const{environment:a,onboardingState:r,planType:i,spaceStore:s,spaceViewStore:l}=e,d=null===(n=r.planTypeAndSurveyInfo)||void 0===n?void 0:n.surveyResponses,c=null!=d&&d.educationRole&&"other"!==(null==d?void 0:d.educationRole)?d.educationRole:void 0;L().At({environment:a,state:{onboardingExperiments:void 0,userPersona:null==d?void 0:d.userPersona,userRole:null==d?void 0:d.userRole,categories:null==d?void 0:d.categories,userEducationRole:c,userEducationLevel:null==d?void 0:d.educationLevel,notionUseFrequency:null==d?void 0:d.notionUseFrequency,companySize:null==d?void 0:d.companySize,useCases:u().jj([...(null==d?void 0:d.useCases)??[],...(null===(t=r.selectedWorkflowTemplateIds)||void 0===t?void 0:t.map((e=>{const n=(0,G().getCollectionTemplateFromId)(e);return null!=n&&n.category?G().useCaseByCollectionTemplateCategory[null==n?void 0:n.category]:void 0})).filter((e=>void 0!==e)))??[]]),planSelection:i,collaborativeIntent:null===(o=r.planTypeAndSurveyInfo)||void 0===o?void 0:o.collaborativeIntent},spaceStore:s,spaceViewStore:l})}function le(e,n){var t,o,a,r;const{onboardingData:i}=n;if(!i)return;const s=null===(t=n.planTypeAndSurveyInfo)||void 0===t||null===(t=t.surveyResponses)||void 0===t?void 0:t.userPersona,l=null===(o=n.planTypeAndSurveyInfo)||void 0===o||null===(o=o.surveyResponses)||void 0===o?void 0:o.userRole,d=null===(a=n.planTypeAndSurveyInfo)||void 0===a||null===(a=a.surveyResponses)||void 0===a?void 0:a.useCases,c=null===(r=n.planTypeAndSurveyInfo)||void 0===r||null===(r=r.surveyResponses)||void 0===r?void 0:r.companySize;A().createAndCommit({userAction:"contextualizedOnboardingStateActions.DO_NOT_USE_setUserPersonaRoleAndUseCases",environment:e,canUndo:!0,perform:e=>{k().d2({userSettingsStore:i.userSettingsStore,data:{persona:s,team_role:l,use_cases:d,company_size:c,persona_version:{version:"V4",timestamp:(new Date).getTime()}},transaction:e})}})}async function de(e,n,t){if((0,Y().pV)()&&e&&n){const o=await E().applyPerfmarkTrial(e.id,n,t);o.enableTrialInfoModal&&(0,Z().D)({openedFrom:"onboarding"}),o.enableTrialIneligibleToast&&z().Z.setState({open:!0,isExistingUser:!1})}else if(e&&n&&"team"===n&&(0,J().TN)(t)){await(0,B().applyReversePlusTrial)(e.id,t,"onboarding")&&(0,N().ES)(t,"onboarding_reverse_trial_sidebar")}}function ce(e){const{currentUserRootStore:n}=F().default.state;n&&(i().Z.set({userId:n.id,key:K().f,value:void 0}),K().default.reset(),V().default.setState({isOnboarding:!1,isLoading:!1,currentUserId:e.currentUser.id}),(0,d().UK)())}async function ue(e,n){var t;const{currentUserRootStore:o,currentUserSettingsStore:a}=F().default.state;if(!o)return;const r=K().default.state;if(!r.onboardingData)throw new Error("onboardingData should not be undefined!");const i=(0,$().getSpaceIntentOverride)(r)??(null===(t=r.planTypeAndSurveyInfo)||void 0===t?void 0:t.planType),{spaceStore:s,spaceViewStore:l,newRedirectData:d,teamStoreId:c}=await ie({spaceJoinOrCreate:n,onboardingState:r,onboardingData:r.onboardingData,currentUserRootStore:o,currentUserSettingsStore:a,planType:i,environment:e}),u=L().Pn(r.onboardingData);_().j({message:E().messages.navigatingToWorkspace}),"create"===n&&(await de(s,i,e),se({environment:e,onboardingState:r,planType:i,spaceStore:s,spaceViewStore:l}),le(e,r)),function(e,n,t,o){var a,r;const i=n.planTypeAndSurveyInfo,s=n.selectedWorkflowTemplateIds,l=!!(null!=i&&null!==(a=i.surveyResponses)&&void 0!==a&&a.useCases&&(null==i||null===(r=i.surveyResponses)||void 0===r||null===(r=r.useCases)||void 0===r?void 0:r.length)>0),d=!!(s&&s.length>0),c=l||d;if("team"===t&&o&&c){"control"!==(0,U().hm)(e)&&q().default.setState({type:"team_workflow_templates",step:"teamspaces",initialTeamStoreId:o})}}(e,r,i,c);const p=d??u;await X({environment:e,onboardingData:r.onboardingData,spaceId:l.getSpaceId(),spaceViewId:l.id,spaceJoinOrCreate:n,redirectData:p,onboardingFlow:r.flowName,onboardingState:r,permissionLevel:L().xk(p)}),_().x()}function pe(e,n,t){if(!e.onboardingData)throw new Error("onboardingData not found!");ee({onboardingState:e,environment:t,userStore:e.onboardingData.userStore,spaceJoinOrCreate:void 0,permissionLevel:"public"}),I()._c({environment:t,store:new(H().G)(t,{table:l().iU,id:n.pageId}),pageVisitSource:o().tY.Onboarding})}async function ge(e,n){if(e.isFirstTimeOnboarding){const{accept:t}=await f().gt({message:(0,Q.jsxs)("div",{style:{display:"block"},children:[(0,Q.jsx)("div",{style:{fontWeight:600},children:(0,Q.jsx)(c()._H,{defaultMessage:"Cancel new account setup?",id:"contextualizedOnboardingActions.closeOnboardingDialog.newUser.title"})}),(0,Q.jsx)("div",{children:(0,Q.jsx)(c()._H,{defaultMessage:"You'll be taken back to the Notion home page.",id:"contextualizedOnboardingActions.closeOnboardingDialog.newUser.subtitle"})})]}),acceptLabel:(0,Q.jsx)(c()._H,{defaultMessage:"Return to home page",id:"contextualizedOnboardingActions.closeOnboardingDialog.newUser.confirmCloseButton.label"}),cancelLabel:(0,Q.jsx)(c()._H,{defaultMessage:"Continue setup",id:"contextualizedOnboardingActions.closeOnboardingDialog.newUser.continueButton.label"})});if(!t)return;v().jw(n,(0,$().getContextualizedOnboardingAnalyticsData)({onboardingState:e,environment:n})),await P().actuallyLogoutAndDeleteMostLocalData({environment:n,logoutOrigin:s().F.ContextualizedOnboardingExit,userId:n.currentUser.id})}else{const{accept:o}=await f().gt({message:(0,Q.jsx)(c()._H,{defaultMessage:"Cancel new workspace setup?",id:"onboardingActions.closeOnboardingDialog.existingUser.title"}),description:(0,Q.jsx)(c()._H,{defaultMessage:"You'll be taken back to your previous workspace.",id:"onboardingActions.closeOnboardingDialog.existingUser.subtitle"}),acceptLabel:(0,Q.jsx)(c()._H,{defaultMessage:"Back to previous workspace",id:"onboardingActions.closeOnboardingDialog.existingUser.confirmCloseButton.label"}),cancelLabel:(0,Q.jsx)(c()._H,{defaultMessage:"Continue setup",id:"onboardingActions.closeOnboardingDialog.existingUser.continueButton.label"})});if(!o)return;v().jw(n,(0,$().getContextualizedOnboardingAnalyticsData)({onboardingState:e,environment:n}));const{mainEditorCurrentBlockStore:r}=F().default.state,i=null==r?void 0:r.getSpaceId(),s=i&&(0,h().w3)(i);if(s){const e=s.getSpaceStore();n.device.isMobileNative&&a().log({level:"info",from:"onboardingActions",type:"SpaceSwitchingDebug",data:{message:"onboardingActions.handleCloseOnboarding set space",spaceId:null==e?void 0:e.id}}),F().default.setState({...F().default.state,currentSpaceStore:e,currentSpaceViewStore:s})}const{url:l,userId:d}=w().Vr(n);let u=n;if(d&&d!==n.currentUser.id&&(u=await C().x({environment:n,newCurrentUserId:d})),l){var t;W().close();const e=()=>{ce(u)};T().c4({environment:u,url:l}),null!==(t=u.mobileNative)&&void 0!==t&&t.supportsNativeHomeOnPhone()?D().navigateToHomeTab(u,e):e()}}}function ve(e,n){var t;g().Yc(e,{can_user_create_space:!1,is_new_user:!0,has_joinable_spaces:!1,onboarding_stage:(0,$().getStageName)({flowName:n.flowName,stageIndex:n.currentStageIndex,environment:e})});const o=null===(t=n.onboardingData)||void 0===t?void 0:t.userStore.getEmail();throw K().default.setState({...n,isInvalidRedirect:!0}),new(r().bp)(o?R().Z.formatMessage(E().messages.errorWorkspaceCreationPreventedWithEmail,{userEmailAddress:o}):R().Z.formatMessage(E().messages.errorWorkspaceCreationPrevented),{newUser:!0})}},829119:(e,n,t)=>{t.r(n),t.d(n,{getContextualizedOnboardingAnalyticsData:()=>u,getOnboardingProgressPercentage:()=>m,getSpaceIntentOverride:()=>v,getStageName:()=>l,getStages:()=>d,isEducationFlowState:()=>c,isPublicAccessPageRedirect:()=>g,shouldRedirectToJoinSpace:()=>p});t(821057);var o=()=>t(9835),a=()=>t(345918),r=()=>t(876822),i=()=>t(723721),s=()=>t(834372);function l(e){const{flowName:n,stageIndex:t,environment:o}=e;return d({flowName:n,environment:o})[t]}function d(e){let{flowName:n,environment:t}=e;const o=t.device.isMobile,a=s().onboardingFlowNameToFlowConfig[n];if(o){if(!a.isEnabledForMobile)throw new Error(`Mobile flow is not enabled for flow name: ${n}`);return a.getMobileStages(t)}if(!a.isEnabledForDesktop)throw new Error(`Desktop flow is not enabled for flow name: ${n}`);return a.getDesktopStages()}function c(e){var n,t;return"education_flow"===e.flowName&&void 0!==(null===(n=e.planTypeAndSurveyInfo)||void 0===n||null===(n=n.surveyResponses)||void 0===n?void 0:n.educationRole)&&void 0!==(null===(t=e.planTypeAndSurveyInfo)||void 0===t||null===(t=t.surveyResponses)||void 0===t?void 0:t.educationLevel)}function u(e){var n,t,o,s,d,c,u;let{onboardingState:p,spaceJoinOrCreate:g,environment:v}=e;const{currentSpaceStore:m}=r().default.state,S=(0,a().kO)(),f=(null===(n=p.planTypeAndSurveyInfo)||void 0===n||null===(n=n.surveyResponses)||void 0===n?void 0:n.userPersona)??S.function,b=(null===(t=p.planTypeAndSurveyInfo)||void 0===t||null===(t=t.surveyResponses)||void 0===t?void 0:t.userRole)??S.role,w=(null===(o=p.planTypeAndSurveyInfo)||void 0===o||null===(o=o.surveyResponses)||void 0===o?void 0:o.companySize)??S.companySize,_=(null===(s=p.planTypeAndSurveyInfo)||void 0===s?void 0:s.planType)??S.intent,y=(null===(d=p.planTypeAndSurveyInfo)||void 0===d||null===(d=d.surveyResponses)||void 0===d?void 0:d.useCases)??S.useCases,I=(null===(c=p.planTypeAndSurveyInfo)||void 0===c||null===(c=c.surveyResponses)||void 0===c?void 0:c.categories)??S.categories,T=(null===(u=p.planTypeAndSurveyInfo)||void 0===u?void 0:u.collaborativeIntent)??S.collaborativeIntent;return{flow_name:p.flowName,flow_id:p.flowId,stage:l({flowName:p.flowName,stageIndex:p.currentStageIndex,environment:v}),initial_workspace_type:g,is_new_onboarding:!!p.isFirstTimeOnboarding,is_create_or_join:!0,stage_number:p.currentStageIndex,num_of_joinable_spaces:p.joinableSpaces.length,historical_stages:p.historicalStages,selectedPresets:void 0,user_persona:f,user_team_role:b,user_use_cases:y,user_categories:I,user_company_size:w,plan_selection:_,collaborative_intent:T,plan_type:null==m?void 0:m.getPlanType(),stage_duration_in_ms:void 0,onboarding_templates:void 0,trial_id:(0,i().kx)(),performance_marketing_term:p.performanceMarketingTerm,is_invalid_redirect:p.isInvalidRedirect,is_dark_mode:"dark"===v.ThemeStore.state.mode,selected_workflow_templates:p.selectedWorkflowTemplateIds}}function p(e){return"guest_redirect"===e.type||"redirect_page"===e.type||"redirect_space"===e.type}function g(e){return"public_access_page_redirect"===e.type}function v(e){if("form_response_onboarding"===e.flowName)return"string"==typeof(n=e.formSpaceIntent)&&o().lx.includes(n)?e.formSpaceIntent:"personal";var n}function m(e,n){const{currentStageIndex:t}=e;return 10+(t+1)/d({flowName:e.flowName,environment:n}).length*80}}}]);