"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[46546],{637118:(e,t,o)=>{o.d(t,{DZ:()=>T,Ep:()=>v,Jj:()=>b,YC:()=>h,gJ:()=>g});o(821057);var n=o(667294),r=()=>o(219727),i=()=>o(142735),l=()=>o(435308),c=()=>o(360517),a=()=>o(788860),p=()=>o(696459),u=()=>o(285755),y=()=>o(141735),s=()=>o(712334),d=()=>o(677559),m=()=>o(807629),f=o(785893);const _=new WeakMap,x=(0,n.createContext)({automationStore:void 0,contextType:void 0,defined:!1,typecheckResult:void 0});x.displayName="AutomationContext";function b(e){const{automationStore:t,children:o,contextType:n}=e,b=(0,r().O7)(),g=(0,a().YB)(),{value:v}=(0,d().XJ)(y().F.formulas),{value:h}=(0,d().XJ)(u().Sm.automationTypecheck),T=(0,i().VK)((()=>{if(!v)return{error:new(c().MO)("Missing formulas dependency")};if(!h)return{error:new(c().MO)("Missing automation dependency")};const e=function(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:r,formulasModule:i,intl:c}=e,a=_.get(o);if(a)return a;{const e=new(l().default)((()=>{const e=o.getTriggerType();let l=r;return(0,p().$K)(e)&&(0,s().j$)(e)&&(l=(0,s().Uk)(e)),(0,m().k)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:l,formulasModule:i,intl:c})}),{debugName:"automationContextTypecheckResultCachedStore"});return _.set(o,e),e}}({environment:b,automationStore:t,automationTypecheckModule:h,contextType:n,formulasModule:v,intl:g});return e.state}),[b,t,h,n,v,g]);return(0,f.jsx)(x.Provider,{value:{automationStore:t,typecheckResult:T,contextType:n,defined:!0},children:o})}function g(e){const{automationStore:t,children:o}=e,n=(0,i().VK)((()=>{var e;return null===(e=t.getTrigger())||void 0===e?void 0:e.type}),[t]);return(0,f.jsx)(b,{automationStore:t,contextType:(0,s().Uk)(n??"event"),children:o})}function v(e){var t;return null===(t=_.get(e))||void 0===t?void 0:t.state}function h(){const e=n.useContext(x);if(!1===e.defined)throw new Error("No automation context found!");return e}function T(){return n.useContext(x)}},712334:(e,t,o)=>{o.d(t,{Uk:()=>l,Xd:()=>i,j$:()=>r});var n=()=>o(696459);const r=(0,n().AO)((e=>"event"===e||"notification_event"===e||"recurrence"===e?{true:e}:{false:e}));function i(e){const t=e.getTrigger();return(0,n().$K)(t)&&r(t.type)}function l(e){return"event"===e||"notification_event"===e?"event":"recurrence"===e?"recurrence":void(0,n().t1)(e)}},912203:(e,t,o)=>{o.d(t,{$M:()=>_,GQ:()=>T,Jy:()=>C,LF:()=>F,NO:()=>d,Of:()=>M,SF:()=>y,TX:()=>h,XO:()=>x,Y_:()=>u,Ym:()=>f,bD:()=>g,cO:()=>s,fo:()=>k,rR:()=>m});o(267602),o(653476),o(228244);var n=()=>o(513670),r=()=>o(696459),i=()=>o(226413),l=()=>o(109477),c=()=>o(455222),a=()=>o(305580);(0,r().AO)((e=>(0,r().$K)(e)&&(0,r().$K)(e.target)&&(0,r().$K)(e.external_bot_id)?{true:{external_bot_id:e.external_bot_id,target:e.target}}:{false:e}));const p={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1},u={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function y(e){return Boolean(p[e.type]&&!(0,i().NK)(e)&&(!(0,i().qQ)(e)||void 0===(0,i().q3)(e)))}function s(e){const{collectionFormat:t,collectionSchema:o,filter:c,sort:p,sourcePropertyIds:u}=e,s=(u??(0,r().Yd)(o)).filter(((t,n,r)=>{const l=o[t];return!(!l||!y(l))&&(("relation"!==l.type||!e.restrictCrossSpace||!(0,i().Qh)(e.spaceId,l))&&(!c||c([t,l],n,o)))}));if(0===s.length)return[];if(!t||!1===p)return s;const d=(0,a().i)(t,o,void 0,l().j5.Page).collection_page_properties||[];return n().MR(s,(e=>d.findIndex((t=>t.property===e))))}function d(e){const{collectionFormat:t,collectionSchema:o,sort:c}=e,p=(0,r().Yd)(o).filter(((e,t,n)=>{const r=o[e];return!(!r||!(0,i().U8)(r))}));if(0===p.length)return[];if(!t||!1===c)return p;const u=(0,a().i)(t,o,void 0,l().j5.Page).collection_page_properties||[];return n().MR(p,(e=>u.findIndex((t=>t.property===e))))}function m(e){return e.type===c().$E.InvalidCharacter?{type:e.type,character:e.character}:e.type===c().$E.TokenExpected?{type:e.type,token:e.token}:e.type===c().FY.MissingSchemaPropertyOnThisRow||e.type===c().FY.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===c().FY.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection}:e.type===c().FY.MissingContextVariable?{type:e.type,valueId:e.valueId}:e.type===c().FY.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments}:e.type===c().FY.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex}:e.type===c().FY.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex}:e.type===c().FY.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer}:e.type===c().FY.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer}:e.type===c().FY.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection}:e.type===c().FY.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===c().FY.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType}:e.type===c().FY.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes}:e.type===c().FY.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name}:{type:e.type}}const f={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,geo_point:!1};function _(e){return Boolean(f[e.type])}function x(e){const{collectionFormat:t,collectionSchema:o,filter:c,sort:p}=e,u=(0,r().Yd)(o).filter(((e,t,n)=>{var r;const l=o[e];return!(!l||!f[l.type])&&((!(0,i().qQ)(l)||null===(r=(0,i().q3)(l))||void 0===r||!r.auto_update_on_edit)&&(!c||c([e,l],t,o)))}));if(0===u.length)return[];if(!t||!1===p)return u;const y=(0,a().i)(t,o,void 0,l().j5.Page).collection_page_properties||[];return n().MR(u,(e=>y.findIndex((t=>t.property===e))))}const b={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function g(e){return b[e.type]}const v={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function h(e){return v[e.type]}function T(e){return 0===e}function k(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function F(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function C(e){const{collectionSchema:t,property:o,type:n}=e,r=null==t?void 0:t[o];return!r||("action"===n?!y(r):!f[r.type])}function M(e){let{automationTrigger:t,collectionSchema:o}=e;if("event"===(null==t?void 0:t.type)||"notification_event"===(null==t?void 0:t.type)){const{pagesAdded:e,pagePropertiesEdited:n,source:i}=t.event;if(void 0===i)return!1;const l="some"===n.type&&n.some,c="all"===n.type&&n.all;if((l||c||[]).some((e=>F({collectionSchema:o,property:e.property})||C({collectionSchema:o,property:e.property,type:"trigger"}))))return!1;const a="some"===n.type&&(!(0,r().$K)(n.some)||0===n.some.length),p="all"===n.type&&(!(0,r().$K)(n.all)||0===n.all.length);if(!e&&("none"===n.type||a||p))return!1}else{if("recurrence"!==(null==t?void 0:t.type))return!1;if(!t.recurrence)return!1}return!0}}}]);