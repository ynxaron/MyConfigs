"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[79308],{180772:(e,t,r)=>{r.r(t),r.d(t,{CollectionChartView:()=>Ee});var o=r(667294),i=()=>r(219727),a=()=>r(142735),n=()=>r(970977),l=()=>r(998411),s=()=>r(186923),u=()=>r(205951),c=()=>r(628370),d=()=>r(55406);var p=()=>r(629352),g=(r(670560),()=>r(790300)),m=()=>r(455947),h=()=>r(576868),v=()=>r(263483);var y=()=>r(347577),f=()=>r(163085),C=()=>r(876822),x=()=>r(307369),S=()=>r(820475),b=()=>r(965105),V=()=>r(120793),w=()=>r(145112),R=()=>r(696459),_=()=>r(662753),M=()=>r(132258),P=()=>r(834458),k=()=>r(608352),T=()=>r(532850),B=()=>r(788860),D=()=>r(691594),L=()=>r(594546),K=()=>r(861026),F=()=>r(846550),A=()=>r(456681),E=()=>r(661727),O=()=>r(998901),z=()=>r(1910),j=()=>r(654133),G=r(785893);function H(e){let{message:t,tooltipMessage:r,tooltipAriaLabel:o}=e;const i=(0,F().yK)((e=>({container:{padding:"8px 4px 8px 14px",borderRadius:20,backgroundColor:"light"===e.mode?(0,E().Fq)(e.accentColors.gray[100],.3):"rgba(255, 255, 255, 0.05)",width:"max-content",margin:"0 auto",marginBottom:20},text:{fontSize:12,textAlign:"center",color:e.mediumTextColor},iconStyle:{width:14,height:14,fill:e.mediumTextColor,position:"absolute",bottom:-2},iconContainer:{position:"relative",height:14,width:30}})),[]);return(0,G.jsx)("div",{style:i.container,children:(0,G.jsxs)("div",{style:i.text,children:[t,(0,G.jsx)(j().Z,{renderTooltip:()=>r,placement:O().Placement.Top,render:e=>(0,G.jsx)(z().Z,{icon:()=>(0,A().m)(i.iconStyle),ariaLabel:o,style:{...i.iconContainer},disableBackground:!0,...e})})]})})}const N=(0,B().vU)({earliestDates:{defaultMessage:"Only showing earliest {limit} {dateGroupByOption}",id:"charts.limitsWarning.earliestDates"},latestDates:{defaultMessage:"Only showing latest {limit} {dateGroupByOption}",id:"charts.limitsWarning.latestDates"},lowestNumbers:{defaultMessage:"Only showing lowest {limit} values",id:"charts.limitsWarning.lowestNumbers"},highestNumbers:{defaultMessage:"Only showing highest {limit} values",id:"charts.limitsWarning.highestNumbers"},genericLimit:{defaultMessage:"Only showing {limit} options in {propertyName}",id:"charts.limitsWarning.genericLimit"}}),$=(0,B().vU)({addFilters:{defaultMessage:"Add filters to reduce the data range.",id:"charts.limitsWarning.tooltip.addFilters"}}),Z=(0,B().vU)({column:{defaultMessage:"Max {limit} bars can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.columnChart"},bar:{defaultMessage:"Max {limit} bars can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.barChart"},line:{defaultMessage:"Max {limit} data points can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.lineChart"},donut:{defaultMessage:"Max {limit} slices can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.donutChart"},subGroups:{defaultMessage:"Max {limit} groups can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.subGroups"}});function q(e,t,r){const o=null==e?void 0:e.type;if((0,k().ib)(t)&&"relative"===t.groupBy)return N.genericLimit;if("ascending"===r.type)switch(o){case"formula":switch((0,P().getFormulaPropertySchemaResultType)(e)){case"date":return N.earliestDates;case"number":return N.lowestNumbers;default:return N.genericLimit}case"date":case"created_time":case"last_edited_time":case"last_visited_time":return N.earliestDates;case"number":return N.lowestNumbers;default:return N.genericLimit}else{if("descending"!==r.type)return N.genericLimit;switch(o){case"formula":switch((0,P().getFormulaPropertySchemaResultType)(e)){case"date":return N.latestDates;case"number":return N.highestNumbers;default:return N.genericLimit}case"date":case"created_time":case"last_edited_time":case"last_visited_time":return N.latestDates;case"number":return N.highestNumbers;default:return N.genericLimit}}}function I(e){let{chartConfig:t,chartLimit:r,collectionContextStore:o}=e;const{limitType:i,limit:n}=r,l=(0,B().YB)(),s=(0,a().Kw)(o.normalizedSchemaStore);if("results"===i&&"results_reducer"===t.dataConfig.type){const e=(0,T().Qm)({schema:s,property:t.dataConfig.nameProperty});return e?(0,G.jsx)(B()._H,{...N.genericLimit,values:{limit:n,propertyName:e.name}}):null}if("groups"===i&&"groups_reducer"===t.dataConfig.type){const e=t.dataConfig.groupBy,r=(0,k().mu)(e),o=(0,T().Qm)({schema:s,property:e.property});if(!o)return null;const i=q(o,e,r);return(0,G.jsx)(B()._H,{...i,values:{limit:n,dateGroupByOption:(0,k().ib)(e)?l.formatMessage(D().HE[e.groupBy]).toLocaleLowerCase():void 0,propertyName:o.name}})}if("subGroups"===i&&"groups_reducer"===t.dataConfig.type&&(0,g().u)(t)&&t.dataConfig.aggregationConfig.stackOptions){const e=t.dataConfig.aggregationConfig.stackOptions.groupBy,r=(0,k().mu)(e),o=(0,T().Qm)({schema:s,property:e.property});if(!o)return null;const i=q(o,e,r);return(0,G.jsx)(B()._H,{...i,values:{limit:n,dateGroupByOption:(0,k().ib)(e)?e.groupBy:void 0,propertyName:o.name}})}return null}function W(e){let{chartConfig:t,chartReducerResults:r,loadingProps:n,collectionContextStore:l}=e;const s=(0,B().YB)(),u=function(e){let{chartConfig:t,chartReducerResults:r,collectionContextStore:n}=e;const l=(0,i().O7)(),s=(0,a().VK)((()=>(0,v().WT)()),[]),u=(0,a().VK)((()=>(0,v().Zl)()),[]),c=(0,a().VK)((()=>(0,v().K9)()),[]),d=(0,a().VK)((()=>(0,K().Pn)(n)),[n]),p=o.useMemo((()=>{let e;return"results_reducer"===t.dataConfig.type&&"results"===(null==r?void 0:r.type)&&r.blockIds.length>=u?e={limitType:"results",limit:u}:"groups_reducer"===t.dataConfig.type&&"groups"===(null==r?void 0:r.type)&&r.results.length>=s?e={limitType:"groups",limit:s}:"groups_reducer"===t.dataConfig.type&&"groups"===(null==r?void 0:r.type)&&r.subGroupResults&&r.subGroupResults.length>=c&&(e={limitType:"subGroups",limit:c}),e}),[t.dataConfig.type,r,s,u,c]);return o.useEffect((()=>{(0,L().j)({environment:l,event:{eventName:"charts_data_length",eventProperties:{chart_group_length:"groups"===(null==r?void 0:r.type)?r.results.length:void 0,chart_results_length:"results"===(null==r?void 0:r.type)?r.blockIds.length:void 0,chart_sub_group_length:"groups"===(null==r?void 0:r.type)&&r.subGroupResults?r.subGroupResults.length:void 0,chart_data_limit:p,...d}}})}),[p,r,d,l]),p}({chartConfig:t,chartReducerResults:r,collectionContextStore:l});if(void 0===u||n.isInitialLoading||n.isThrottledLoading)return null;const{limitType:c,limit:d}=u;return(0,G.jsx)(H,{message:(0,G.jsx)(I,{chartConfig:t,collectionContextStore:l,chartLimit:u}),tooltipMessage:(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{children:(0,G.jsx)(B()._H,{..."subGroups"===c?Z.subGroups:Z[t.type],values:{limit:d}})}),(0,G.jsx)("div",{children:(0,G.jsx)(B()._H,{...$.addFilters})})]}),tooltipAriaLabel:s.formatMessage("subGroups"===c?Z.subGroups:Z[t.type],{limit:d})})}r(267602),r(653476),r(241792),r(228244);var Y=()=>r(332143),Q=()=>r(56718),U=()=>r(506347),X=()=>r(717245),J=()=>r(342792);function ee(e){const{chartConfig:t,dataPoint:r,format:o}=e;if(!t||"placeholder"===t.type||"results_reducer"===t.dataConfig.type||!t.dataConfig.groupBy||!r)return{};const i=t.dataConfig.groupBy.property,a=te({groupByFormat:t.dataConfig.groupBy,dataPoint:r}),n={table_properties:[{property:"title",visible:!0,width:276},{property:i,visible:!0}]};return null!=o&&o.collection_pointer&&(n.collection_pointer=o.collection_pointer),(null!=o&&o.property_filters||a)&&(n.property_filters=[...(null==o?void 0:o.property_filters)??[],...a?[a]:[]]),"groups_reducer"===t.dataConfig.type&&(0,g().u)(t)&&t.dataConfig.aggregationConfig.stackOptions&&(n.collection_group_by=function(e){var t;if(null===(t=e.aggregationConfig)||void 0===t||!t.stackOptions)return;const r=e.aggregationConfig.stackOptions.groupBy;return r.hideEmptyGroups=!0,r}(t.dataConfig)),n}function te(e){const{groupByFormat:t,dataPoint:r}=e;if(r.isUncategorized&&"checkbox"!==t.type)return{filter:{filter:{operator:"is_empty"},property:t.property},id:(0,J().ZP)()};if((0,k().aB)(t))return{filter:{filter:{operator:"string_is",value:{type:"exact",value:r.name}},property:t.property},id:(0,J().ZP)()};if("checkbox"===t.type)return{filter:{filter:{operator:"checkbox_is",value:{type:"exact",value:!Boolean(r.isUncategorized)}},property:t.property},id:(0,J().ZP)()};if("number"===t.type){let e;if(r.numberValue?e=r.numberValue:r.x&&(e=r.x),!e)return;return{filter:{filter:{operator:"number_equals",value:{type:"exact",value:e}},property:t.property},id:(0,J().ZP)()}}if((0,k().TD)(t))return{filter:{filter:{operator:"status_is",value:{type:"group"===t.groupBy?"is_group":"is_option",value:r.name}},property:t.property},id:(0,J().ZP)()};if("select"===t.type)return{filter:{filter:{operator:"enum_is",value:{type:"exact",value:r.name}},property:t.property},id:(0,J().ZP)()};if("multi_select"===t.type)return{filter:{filter:{operator:"enum_contains",value:{type:"exact",value:r.name}},property:t.property},id:(0,J().ZP)()};if((0,k().S1)(t)){const e=r.actorPointer;if(!e)return;return{filter:{filter:{operator:"person_contains",value:{type:"exact",value:e}},property:t.property},id:(0,J().ZP)()}}if((0,k().ib)(t)){if(!r.dateValue)return;switch(r.dateValue.type){case"today":case"yesterday":case"tomorrow":case"last_7_days":case"next_7_days":case"last_30_days":case"next_30_days":return;case"day":return{filter:{filter:{operator:"date_is",value:{type:"exact",value:{type:"date",start_date:r.dateValue.range.start_date}}},property:t.property},id:(0,J().ZP)()};case"week":case"month":case"year":return{filter:{filter:{operator:"date_is_within",value:{type:"exact",value:{type:"daterange",start_date:r.dateValue.range.start_date,end_date:r.dateValue.range.end_date}}},property:t.property},id:(0,J().ZP)()};default:(0,R().t1)(r.dateValue)}}else{if((0,k().zb)(t.type))return r.relationId?{filter:{filter:{operator:"relation_contains",value:{type:"exact",value:r.relationId}},property:t.property},id:(0,J().ZP)()}:r.relativeSprintVariable?{filter:{filter:{operator:"relation_contains",value:{type:"relative",value:{type:"builtin",variable:r.relativeSprintVariable}}},property:t.property},id:(0,J().ZP)()}:void 0;if("formula"===t.type){return te({groupByFormat:{...t.groupBy,property:t.property},dataPoint:r})}if("location"===t.type)return;(0,R().t1)(t.type)}}var re=()=>r(429725),oe=()=>r(949842),ie=()=>r(826955),ae=()=>r(497065);function ne(e){const{chartConfig:t,collectionViewBlockStore:r,format:o,dataPoint:i,clickEvent:a}=e;if(!r)return;(0,oe().ZP)({event:a,context:oe().Af.EditorClick});const n=ee({chartConfig:t,format:o,dataPoint:i}),l={type:"table",parent_id:r.id,parent_table:r.table,alive:!0,space_id:r.getSpaceId(),format:{...n,is_unlisted:!0}};X().M.openAndCreateEphemeralCollectionView({collectionViewValue:l,collectionViewBlockStore:r})}function le(e){var t;const{collectionStore:r,dataPoint:o,clickEvent:i,environment:a}=e;if(null==o||null===(t=o.pagePointer)||void 0===t||!t.id||!r)return;(0,oe().ZP)({event:i,context:oe().Af.EditorClick});const n=ie().G.createChildStore(r,o.pagePointer),l=(0,re().ZP)({store:n,fullyQualified:!1,pageVisitSource:U().tY.Expand,showMoveTo:!1,openInCenterPeek:!0});l&&ae().c4({environment:a,url:l})}var se=()=>r(677559);const ue=new(se().Ss)("CollectionChartView",(async()=>await Promise.all([r.e(94556),r.e(78701),r.e(38804),r.e(27856),r.e(62789),r.e(71641),r.e(38632),r.e(48005),r.e(79308)]).then(r.bind(r,358281)))),ce=(0,se().kF)(ue,(e=>e.AxisChart));var de=()=>r(559729),pe=()=>r(561933),ge=()=>r(615719),me=()=>r(422118),he=(r(731107),()=>r(513670));const ve=(0,B().vU)({noData:{defaultMessage:"No data",id:"database.chart.multipleSeriesTooltip.noData"},empty:{defaultMessage:"Empty",id:"database.chart.tooltip.empty"}});function ye(e,t,r){var i;const n=(0,B().YB)(),l=(0,F().yK)((e=>({defaultContainer:{border:`1px solid ${e.accentColors.gray[100]}`,borderRadius:"8px",backgroundColor:e.cardContentBackground,maxHeight:"375px",maxWidth:"300px",width:"max-content",overflow:"hidden",pointerEvents:"auto",boxShadow:"0px 2px 4px rgb(0, 0, 0, 0.1)"},scrollContainer:{overflow:"auto",padding:"15px 15px 10px 15px",maxHeight:"375px"},containerSingleSeries:{padding:"10px 15px 10px 15px"},header:{fontSize:"12px",paddingBottom:"7px",color:e.regularTextColor,overflowX:"hidden",whiteSpace:"normal",display:"block"},row:{fontSize:"12px",lineHeight:"18px",textAlign:"left",display:"flex",justifyContent:"space-between",gap:"16px"},square:{height:"7px",width:"7px",minWidth:"7px",borderRadius:"1px",borderWidth:"0px",marginRight:"6px",marginTop:"6px",verticalAlign:"top",display:"inline-block"},rowLeft:{display:"inline-block",color:e.chartRowLeftColor,overflowX:"hidden",whiteSpace:"normal"},rowLeftContainer:{display:"inline-flex"},rowRight:{color:e.chartRowRightColor},noData:{color:e.chartRowLeftColor}})),[]),s=(0,o.useMemo)((()=>n.formatMessage(ve.noData)),[n]),u=o.useCallback((e=>Object.keys(e).reduce(((t,r)=>`${t}${(0,he().GL)(r)}:${e[r]};`),"")),[]),{rowStyle:c,squareStyle:d,rowLeftStyles:p,rowLeftContainerStyle:m,rowRightStyles:h,headerStyles:v,outsideContainerStyle:y,scrollContainerStyle:f,containerSingleSeriesStyle:C,noDataStyle:x}=(0,o.useMemo)((()=>({outsideContainerStyle:u(l.defaultContainer),scrollContainerStyle:u(l.scrollContainer),containerSingleSeriesStyle:u({...l.defaultContainer,...l.containerSingleSeries}),rowStyle:u(l.row),rowLeftContainerStyle:u(l.rowLeftContainer),squareStyle:u(l.square),rowLeftStyles:u(l.rowLeft),rowRightStyles:u(l.rowRight),headerStyles:u(l.header),noDataStyle:u(l.noData)})),[l,u]),S=(0,o.useMemo)((()=>({useHTML:!0,shadow:!1,borderWidth:0,backgroundColor:void 0,outside:!1,stickOnContact:!0,hideDelay:100})),[]),b=(0,a().VK)((()=>"donut"===(null==e?void 0:e.type)),[null==e?void 0:e.type]),V=(0,a().VK)((()=>{var t;return("bar"===(null==e?void 0:e.type)||"column"===(null==e?void 0:e.type))&&("groups_reducer"===e.dataConfig.type&&(!!e.dataConfig.aggregationConfig.stackOptions&&"percent"===(null===(t=e.chartFormat)||void 0===t?void 0:t.axisGroupStyle)))}),[e]),w=(0,a().VK)((()=>{var r,o;if("precision_from_number_property"===(null==e||null===(r=e.chartFormat)||void 0===r?void 0:r.numberPrecisionOverride)){const r=null==e?void 0:e.dataConfig;if(!r||"results_reducer"!==r.type)return;const o=(0,T().Qm)({schema:t,property:r.valueProperty});return o?(0,me().NX)(o):void 0}return null==e||null===(o=e.chartFormat)||void 0===o?void 0:o.numberPrecisionOverride}),[null==e||null===(i=e.chartFormat)||void 0===i?void 0:i.numberPrecisionOverride,null==e?void 0:e.dataConfig,t]),R=(0,o.useMemo)((()=>({...S,formatter:function(){const r=this.color??this.series.color,{label:o,value:i}=(0,me().Xn)({chartConfig:e,schema:t,highChartsLabel:this.point.name,highChartsValue:this.point.y,isMultiSeries:!1,intl:n,numberPrecisionOverride:w});let a="";b&&this.point.percentage&&(a=` (${(0,me().T3)(this.point.percentage)}%)`);const l=""===o?n.formatMessage(ve.empty):o;return`\n\t\t\t\t\t<div style="${C}">\n\t\t\t\t\t\t<div style="${c}">\n\t\t\t\t\t\t\t<div style="${m}"> \n\t\t\t\t\t\t\t\t<div style="${d} background-color: ${r};"></div> \n\t\t\t\t\t\t\t\t<div style="${p}">\n\t\t\t\t\t\t\t\t\t${l}\n\t\t\t\t\t\t\t\t</div> \n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style="${h}">\n\t\t\t\t\t\t\t\t${i}${a}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`}})),[S,e,t,n,w,b,C,c,m,d,p,h]),_=(0,o.useMemo)((()=>({...S,shared:!0,formatter:function(){var r;const o=null===(r=this.points)||void 0===r?void 0:r.filter((e=>!(null==e||!e.y)&&0!==e.y));("line"===this.series.type||"area"===this.series.type||"areaspline"===this.series.type)&&(null==o||o.sort(((e,t)=>((null==t?void 0:t.y)??0)-((null==e?void 0:e.y)??0))));let i=this.point.name;if(e&&(0,g().u)(e)&&"groups_reducer"===e.dataConfig.type){const r=e.dataConfig,o=r.groupBy,a=(0,T().Qm)({schema:t,property:r.groupBy.property});a&&(i=(0,me().hZ)({propertySchema:a,groupByFormat:o,aggregation:e.dataConfig.aggregationConfig.aggregation,highChartsLabel:this.point.name,intl:n}))}return o&&0!==o.length?`\n\t\t\t\t<div style="${y}">\n\t\t\t\t<div style="${f}">\n\t\t\t\t\t<div style="${v}">${i}</div>\n\t\t\t\t\t${o.map((r=>{const o=r.color??r.series.color,{label:i,value:a}=(0,me().Xn)({chartConfig:e,schema:t,highChartsLabel:r.series.name,highChartsValue:r.y??void 0,isMultiSeries:!0,intl:n,numberPrecisionOverride:w});let l="";V&&r.percentage&&(l=` (${(0,me().T3)(r.percentage)}%)`);const s=""===i?n.formatMessage(ve.empty):i;return`\n\t\t\t\t\t\t\t<div style="${c}">\n\t\t\t\t\t\t\t\t<div style="${m}">\n\t\t\t\t\t\t\t\t\t<div style="${d} background-color: ${o};"></div> \n\t\t\t\t\t\t\t\t\t\t<div style="${p}">\n\t\t\t\t\t\t\t\t\t\t\t${s}\n\t\t\t\t\t\t\t\t\t\t</div> \n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span style="${h}">\n\t\t\t\t\t\t\t\t\t${a}${l}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`})).join("")}\n\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`:`\n\t\t\t\t\t<div style="${y}">\n\t\t\t\t\t<div style="${f}">\n\t\t\t\t\t\t<div style="${v}">${i}</div>\n\t\t\t\t\t\t<div style="${c} ${x}">\n\t\t\t\t\t\t${s}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t`}})),[S,e,y,f,v,t,n,c,x,s,w,V,m,d,p,h]);return r?1===r.length?R:_:S}const fe=ye;var Ce=()=>r(466970);function xe(e){let{collectionContextStore:t,groupedChartReducerResults:r,groupedDataConfig:n,chartFormat:l,timezone:s,loadingProps:u,axisType:c}=e;const p=(0,i().O7)(),m=(0,B().YB)(),h=(0,F().Fg)(),y=(0,o.useRef)(!0),f=(0,Ce().E)("charts_drilldown"),{chartConfig:C,chartErrorStore:x,collectionViewStore:S,collectionViewBlockStore:b,databaseType:V}=(0,a().VK)((()=>{const e=t.collectionViewStore(),r=null==e?void 0:e.getChartConfig();return{chartConfig:r&&(0,g().u)(r)&&"groups_reducer"===r.dataConfig.type?r:void 0,chartErrorStore:t.chartErrorStore,collectionViewStore:e,collectionViewBlockStore:t.collectionViewBlockStore(),databaseType:t.databaseType}}),[t]),R=(0,a().Kw)(t.normalizedSchemaStore),_=(0,a().Kw)(t.normalizedFormatStore),M=(0,a().VK)((()=>(0,T().Qm)({schema:R,property:n.groupBy.property})),[n.groupBy.property,R]),P=(0,a().VK)((()=>{if(n.aggregationConfig.aggregation.property)return(0,T().Qm)({schema:R,property:n.aggregationConfig.aggregation.property})}),[n.aggregationConfig.aggregation,R]),D=(0,a().VK)((()=>null==l?void 0:l.mainSort),[null==l?void 0:l.mainSort]),L=(0,a().VK)((()=>null==l?void 0:l.axisAvatar),[null==l?void 0:l.axisAvatar]),K=(0,a().VK)((()=>{if("side_by_side"===(null==l?void 0:l.axisGroupStyle))return;if(n.aggregationConfig.stackOptions){if(null!=l&&l.axisGroupStyle)return l.axisGroupStyle;if("line"!==(null==C?void 0:C.type))return w().UJ.normal}}),[null==C?void 0:C.type,null==l?void 0:l.axisGroupStyle,n.aggregationConfig]),A=(0,a().VK)((()=>M?M.name||pe().SO[M.type]:""),[M]),E=(0,a().VK)((()=>{const e=n.aggregationConfig;if((0,Y().HK)(e.aggregation)){return(0,d().Hk)({aggregation:e.aggregation,databaseType:V,intl:m})||""}const t=(0,d().Hk)({aggregation:e.aggregation,databaseType:V,intl:m});return P?`${P.name||pe().SO[P.type]} (${t})`:""}),[n.aggregationConfig,V,m,P]),O=(0,a().VK)((()=>(0,w().vi)(C)),[C]),z=!!C&&(0,ge().bc)(C),j=(null==l?void 0:l.hideLegend)||z,H=(0,a().VK)((()=>{const e=null==l?void 0:l.axisGridLine;return!e||("horizontal"===e||"both"===e)}),[l]),N=(0,a().VK)((()=>{const e=null==l?void 0:l.axisGridLine;return!!e&&("vertical"===e||"both"===e)}),[l]),$=(0,a().VK)((()=>(0,v().WT)()),[]),Z=(0,a().VK)((()=>(0,v().K9)()),[]),q=(0,a().VK)((()=>{if(r&&C)return(0,ge().P3)({groupedChartReducerResults:r,chartConfig:C,sortType:"main"})}),[r,C]),I=(0,a().VK)((()=>{if(!(r&&t&&b&&q))return;const{result:e,xAxisType:o}=function(e){var t;let{collectionContextStore:r,groupedDataConfig:o,groupedChartReducerResults:i,chartFormat:a,timezone:n,theme:l,environment:s,intl:u,getRecordModel:c,renderGroupsFromAggregationArgs:d,groupsLimit:p,subGroupsLimit:g,databaseType:m,schema:h,collectionViewFormat:v}=e;const y=i.aggregationResults;if(!y)return;const f=(0,ge().VB)({groupedDataConfig:o,hideEmptyGroups:Boolean(null==a?void 0:a.axisHideEmptyGroups),mainSort:null==a?void 0:a.mainSort});if("v2"===(null==i?void 0:i.version)){var C;const e=i.results.filter((e=>e.visible)).map((e=>({property:o.groupBy.property,value:e.value}))),t=o.aggregationConfig.stackOptions,a=t?null===(C=i.subGroupResults)||void 0===C?void 0:C.filter((e=>e.visible)).map((e=>({property:t.groupBy.property,value:e.value}))):[];return{result:(0,ge().FZ)({collectionContextStore:r,groupedDataConfig:o,groupResults:e,subGroupResults:a,aggregationResults:y,xAxisType:f,timezone:n,environment:s,intl:u,theme:l,groupTotals:d.groupTotals}),xAxisType:f}}const x=(0,k().Qq)({schema:h,groupBy:o.groupBy});let S=(0,de().Cz)({groupBy:o.groupBy,schema:h,formatGroups:v[k().Uh]||[],schemaGroups:x,reducerResults:i.results,getRecordModel:c,relativeVariableResult:r.relativeVariableStore.state,viewAppConfigUri:m,allowedCollectionStores:r.collectionStoresStore.state,renderGroupsFromAggregationArgs:d});S=S.filter((e=>!(0,k().eF)(e))),S=S.slice(0,p);const b=o.aggregationConfig.stackOptions?(0,k().Qq)({schema:h,groupBy:o.aggregationConfig.stackOptions.groupBy}):void 0,V=i.subGroupResults&&null!==(t=o.aggregationConfig.stackOptions)&&void 0!==t&&t.groupBy?(0,de().Cz)({groupBy:o.aggregationConfig.stackOptions.groupBy,schema:h,formatGroups:v.chart_subgroups||[],schemaGroups:b,reducerResults:i.subGroupResults,getRecordModel:c,relativeVariableResult:r.relativeVariableStore.state,viewAppConfigUri:m,allowedCollectionStores:r.collectionStoresStore.state}).filter((e=>!(0,k().eF)(e))).slice(0,g):void 0,w=(0,ge().FZ)({collectionContextStore:r,groupedDataConfig:o,groupResults:S,subGroupResults:V,aggregationResults:y,xAxisType:f,timezone:n,environment:s,intl:u,theme:l,groupTotals:d.groupTotals});return{result:w,xAxisType:f}}({collectionContextStore:t,groupedDataConfig:n,groupedChartReducerResults:r,chartFormat:l,timezone:s,theme:h,environment:p,intl:m,getRecordModel:b.getRecordModel,renderGroupsFromAggregationArgs:q,groupsLimit:$,subGroupsLimit:Z,databaseType:V,schema:R,collectionViewFormat:_})||{};if(!o)return;var i;y.current&&(null===(i=t.databaseItemsVisibleTracker)||void 0===i||i.handleItemsRenderStart(),y.current=!1);const a=r.results.some((e=>(0,Q().z_)(e)?e.visible:e.total>0));return{seriesData:null==e?void 0:e.seriesData,maxValue:(null==e?void 0:e.maxValue)??0,minValue:(null==e?void 0:e.minValue)??0,xAxisType:o,reverseXAxis:(0,ge().Iq)({xAxisType:o,mainSort:D}),hasData:a}}),[r,$,Z,t,b,n,R,_,V,D,l,s,p,m,h,q],{useDeepEqual:!0}),W=ye(C,R,null==I?void 0:I.seriesData),U=(0,me().V4)(null==S?void 0:S.getRecordModel,m,L===w().lr.avatar_name),X=(0,o.useMemo)((()=>M&&(0,w().Sw)(M)&&(void 0===L||L===w().lr.avatar||L===w().lr.avatar_name)),[L,M]),J=(()=>{if(!M)return;if(X)return U;if((0,w().HQ)(M))return(0,me().py)({propertySchema:M,aggregation:n.aggregationConfig.aggregation,intl:m,numberPrecisionOverride:null==l?void 0:l.numberPrecisionOverride});const e="formula"===n.groupBy.type?n.groupBy.groupBy:n.groupBy;return(0,k().ib)(e)&&(0,w().l2)(M)?(0,me().vY)({groupBy:e.groupBy,dateFormat:M.date_format,intl:m}):void 0})(),ee=(()=>{if(P)return(0,w().HQ)(P)?(0,me().py)({propertySchema:P,aggregation:n.aggregationConfig.aggregation,intl:m,numberPrecisionOverride:null==l?void 0:l.numberPrecisionOverride}):void 0})(),te=(e=>{const t=null===(e=n.aggregationConfig.stackOptions)||void 0===e?void 0:e.groupBy;if(j||!t)return;const r="formula"===t.type?t.groupBy:t,o=t.property,i=(0,T().Qm)({schema:R,property:o});return i&&(0,k().ib)(r)&&(0,w().l2)(i)?e=>(0,me().qQ)({dateString:e,dateFormat:i.date_format,groupBy:r.groupBy,intl:m}):void 0})(),re=(0,o.useCallback)(((e,t)=>{ne({chartConfig:C,collectionViewBlockStore:b,format:_,dataPoint:e,clickEvent:t})}),[C,b,_]),oe=(0,a().VK)((()=>!(!P||!I)&&(0,me().ug)({dataYAxisMax:I.maxValue,dataYAxisMin:I.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,propertySchema:P,aggregation:n.aggregationConfig.aggregation})),[I,null==l?void 0:l.yAxisMax,null==l?void 0:l.yAxisMin,n.aggregationConfig.aggregation,P]),ie=(0,a().Kw)(t.isInPeekRendererStore);o.useEffect((()=>{var e;if(!S)return;const t=null==r?void 0:r.subGroupResults;if(Boolean(C&&(0,g().u)(C)&&"groups_reducer"===C.dataConfig.type&&(null===(e=C.dataConfig.aggregationConfig.stackOptions)||void 0===e?void 0:e.groupBy))&&t){if(1===t.length&&!t[0].value.value){const e=new Map(x.state);return e.set(S.id,"stackBy_property_no_values"),void x.setState(e)}}const o=new Map(x.state);o.delete(S.id),x.setState(o)}),[C,S,null==r?void 0:r.subGroupResults,x]);const ae=(0,o.useCallback)((()=>{t.onItemMount()}),[t]);return(0,G.jsx)(ce,{axisType:c,timezone:s,seriesData:(null==I?void 0:I.seriesData)||[],hasData:Boolean(null==I?void 0:I.hasData),loadingProps:u,xAxisType:null==I?void 0:I.xAxisType,xAxisTitle:A,yAxisTitle:E,axisLabelFormat:null==l?void 0:l.axisLabel,colorTheme:null==l?void 0:l.colorTheme,chartHeight:null==l?void 0:l.height,weightColorValue:null==l?void 0:l.weightColorValue,hideLegend:j,showCaption:null==l?void 0:l.showCaption,caption:null==l?void 0:l.caption,showHorizontalGridLines:H,showVerticalGridLines:N,dataLabelsEnabled:O,columnStacking:K,axisHideEmptyGroups:null==l?void 0:l.axisHideEmptyGroups,tooltipOptions:W,sortReversed:null==I?void 0:I.reverseXAxis,xLabelFormatter:J,disableXAxisAutoRotation:X,yLabelFormatter:ee,dataLabelFormatter:ee,stackLabelFormatter:ee,legendLabelFormatter:te,yAxisAllowDecimals:oe,dataYAxisMax:null==I?void 0:I.maxValue,dataYAxisMin:null==I?void 0:I.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,onLoadEventHandler:ae,isInPeekMode:ie,onSeriesClick:f?re:void 0})}const Se=new(se().Ss)("CollectionChartView",(async()=>await Promise.all([r.e(94556),r.e(78701),r.e(38804),r.e(27856),r.e(62789),r.e(71641),r.e(38632),r.e(48005),r.e(79308)]).then(r.bind(r,209269)))),be=(0,se().kF)(Se,(e=>e.DonutChart));var Ve=()=>r(582900),we=()=>r(707513);function Re(e,t){const r=(0,B().YB)(),o=(0,F().yK)((e=>({name:{maxWidth:"250px",...we().Yu,display:"inline-block",verticalAlign:"middle"},value:{display:"inline-block",verticalAlign:"middle",marginLeft:5}})),[]),i=(0,a().VK)((()=>null==e?void 0:e.chartFormat),[e]);if((null==i?void 0:i.donutDataLabels)!==w().gg.none)return function(){const{label:a,value:n}=(0,me().Xn)({chartConfig:e,schema:t,highChartsLabel:this.point.name,highChartsValue:this.point.y,isMultiSeries:!1,intl:r,numberPrecisionOverride:void 0});let l="";return this.point.percentage&&(l=` (${(0,me().T3)(this.point.percentage)}%)`),(null==i?void 0:i.donutDataLabels)===w().gg.value?`${n}${l}`:(null==i?void 0:i.donutDataLabels)===w().gg.name?Ve().Z.renderToStaticMarkup((0,G.jsx)("div",{style:o.name,children:a})):(null==i?void 0:i.donutDataLabels)===w().gg.name_and_value?Ve().Z.renderToStaticMarkup((0,G.jsxs)("div",{children:[(0,G.jsx)("div",{style:o.name,children:a}),(0,G.jsx)("div",{style:o.value,children:`${n}${l}`})]})):void 0}}var _e=()=>r(996106),Me=()=>r(527278);const Pe=(0,B().vU)({total:{id:"charts.donut.aggregationValue.total",defaultMessage:"Total"},totalPropertyName:{id:"charts.donut.aggregationValue.totalPropertyName",defaultMessage:"Total {propertyName}"},averagePropertyName:{id:"charts.donut.aggregationValue.averagePropertyName",defaultMessage:"Average {propertyName}"},minPropertyName:{id:"charts.donut.aggregationValue.minPropertyName",defaultMessage:"Min {propertyName}"},maxPropertyName:{id:"charts.donut.aggregationValue.maxPropertyName",defaultMessage:"Max {propertyName}"},medianPropertyName:{id:"charts.donut.aggregationValue.medianPropertyName",defaultMessage:"Median {propertyName}"},uniquePropertyName:{id:"charts.donut.aggregationValue.uniquePropertyName",defaultMessage:"Distinct {propertyName}"}});function ke(e,t,r,i){const a=(0,B().YB)();return(0,o.useMemo)((()=>{if(!e||!r)return;const o=e.aggregationResult,n=(0,T().Qm)({schema:i,property:r});if(!o||"number"!==o.type||!n)return;let l;const s=o.value?(0,me().dt)(o.value,2):void 0;if((0,w().HQ)(n)&&"count"!==t&&"unique"!==t){const e=(0,me().ff)(n)??"number";l=(0,_e().uf)(s,e,a,"compact")}else l=(0,_e().uf)(s,"number",a,"compact");let u;const c=n.name;switch(t){case"sum":u=Me().Z.formatMessage(Pe.totalPropertyName,{propertyName:c});break;case"average":u=Me().Z.formatMessage(Pe.averagePropertyName,{propertyName:c});break;case"min":u=Me().Z.formatMessage(Pe.minPropertyName,{propertyName:c});break;case"max":u=Me().Z.formatMessage(Pe.maxPropertyName,{propertyName:c});break;case"median":u=Me().Z.formatMessage(Pe.medianPropertyName,{propertyName:c});break;case"unique":u=Me().Z.formatMessage(Pe.uniquePropertyName,{propertyName:c});break;default:u=Me().Z.formatMessage(Pe.total)}return{title:l,subtitle:u}}),[e,t,a,r,i])}function Te(e){let{collectionContextStore:t,groupedChartReducerResults:r,aggregationChartReducerResults:n,groupedDataConfig:l,chartFormat:s,timezone:u,loadingProps:c}=e;const d=(0,i().O7)(),p=(0,B().YB)(),g=(0,F().Fg)(),m=(0,o.useRef)(!0),h=(0,Ce().E)("charts_drilldown"),{collectionViewBlockStore:y,databaseType:f,schema:C,chartConfig:x}=(0,a().VK)((()=>{var e;const r=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getChartConfig();return{collectionViewBlockStore:t.collectionViewBlockStore(),databaseType:t.databaseType,schema:t.normalizedSchemaStore.state,chartConfig:r&&"donut"===r.type&&"groups_reducer"===r.dataConfig.type?r:void 0}}),[t]),S=(0,a().VK)((()=>(0,k().Qq)({schema:C,groupBy:l.groupBy})),[l,C]),b=(0,a().Kw)(t.normalizedFormatStore),V=(0,a().VK)((()=>(0,v().WT)()),[]),R=(0,a().VK)((()=>{if(r&&x)return(0,ge().P3)({groupedChartReducerResults:r,chartConfig:x,sortType:"main"})}),[r,x]),_=(0,a().VK)((()=>{const e=null==r?void 0:r.aggregationResults;if(!y||!R||!e)return;if("v2"===(null==r?void 0:r.version)){const i=r.results.filter((e=>e.visible)).map((e=>({property:l.groupBy.property,value:e.value}))),a=(0,ge().yd)({collectionContextStore:t,groupedDataConfig:l,groupResults:i,aggregationResults:e,timezone:u,environment:d,intl:p,theme:g,groupTotals:R.groupTotals});var o;if(m.current)null===(o=t.databaseItemsVisibleTracker)||void 0===o||o.handleItemsRenderStart(),m.current=!1;return a}let i=(0,de().Cz)({groupBy:l.groupBy,schema:C,formatGroups:b[k().Uh]||[],schemaGroups:S,reducerResults:r.results,getRecordModel:y.getRecordModel,relativeVariableResult:t.relativeVariableStore.state,viewAppConfigUri:f,allowedCollectionStores:t.collectionStoresStore.state,renderGroupsFromAggregationArgs:R});i=i.filter((e=>!(0,k().eF)(e))),i=i.slice(0,V);const a=(0,ge().yd)({collectionContextStore:t,groupedDataConfig:l,groupResults:i,aggregationResults:e,timezone:u,environment:d,intl:p,theme:g,groupTotals:R.groupTotals});var n;m.current&&(null===(n=t.databaseItemsVisibleTracker)||void 0===n||n.handleItemsRenderStart(),m.current=!1);return a}),[r,l,u,d,p,t,g,y,f,C,S,V,b,R],{useDeepEqual:!0}),M=(0,a().VK)((()=>!(null!=s&&s.donutHideValue)),[null==s?void 0:s.donutHideValue]),P=(0,a().VK)((()=>"count"===l.aggregationConfig.aggregation.aggregator?l.groupBy.property:l.aggregationConfig.aggregation.property),[l]),D=ke(n,l.aggregationConfig.aggregation.aggregator,P,C),L=(0,a().VK)((()=>null==s?void 0:s.valueLabel),[null==s?void 0:s.valueLabel])||(null==D?void 0:D.subtitle),K=fe(x,C,_),A=(()=>{const e="formula"===l.groupBy.type?l.groupBy.groupBy:l.groupBy,t=(0,T().Qm)({schema:C,property:l.groupBy.property});if(t)return(0,k().ib)(e)&&(0,w().l2)(t)?r=>(0,me().qQ)({dateString:r.toString(),dateFormat:t.date_format,groupBy:e.groupBy,intl:p}):void 0})(),E=Re(x,C),O=(0,o.useCallback)(((e,t)=>{ne({chartConfig:x,collectionViewBlockStore:y,format:b,dataPoint:e,clickEvent:t})}),[x,y,b]),z=(0,o.useCallback)((()=>{t.onItemMount()}),[t]),j=(0,a().Kw)(t.isInPeekRendererStore);return(0,G.jsx)(be,{timezone:u,seriesData:_||[],title:M?null==D?void 0:D.title:void 0,subtitle:M?L:void 0,loadingProps:c,colorTheme:null==s?void 0:s.colorTheme,chartHeight:null==s?void 0:s.height,weightColorValue:null==s?void 0:s.weightColorValue,hideLegend:null==s?void 0:s.hideLegend,showCaption:null==s?void 0:s.showCaption,caption:null==s?void 0:s.caption,tooltipOptions:K,legendLabelFormatter:A,onLoadEventHandler:z,dataLabelsFormatter:E,isInPeekMode:j,onSeriesClick:h?O:void 0})}function Be(e){let{collectionContextStore:t,resultsChartReducerResults:r,resultsDataConfig:n,chartFormat:l,timezone:s,loadingProps:u,axisType:c}=e;const d=(0,i().O7)(),p=(0,B().YB)(),m=(0,F().Fg)(),h=(0,Ce().E)("charts_drilldown"),v=(0,o.useRef)(!0),{chartConfig:y,collectionViewBlockStore:f,collectionViewStore:C,collectionStore:x}=(0,a().VK)((()=>{const e=t.collectionViewStore(),r=null==e?void 0:e.getChartConfig();return{chartConfig:r&&(0,g().u)(r)&&"results_reducer"===r.dataConfig.type?r:void 0,collectionViewBlockStore:t.collectionViewBlockStore(),collectionViewStore:e,collectionStore:t.collectionStore()}}),[t]),S=(0,a().Kw)(t.normalizedSchemaStore),b=null==l?void 0:l.mainSort,V=(0,a().VK)((()=>{const e=n.nameProperty,t=S[e];return t?t.name||pe().SO[t.type]:""}),[n.nameProperty,S]),R=(0,a().VK)((()=>{const e=S[n.valueProperty];return e?`${e.name||pe().SO[e.type]}`:""}),[n,S]),_=!!y&&(0,ge().bc)(y),M=(null==l?void 0:l.hideLegend)||_,P=(0,a().VK)((()=>{const e=null==l?void 0:l.axisGridLine;return!e||("horizontal"===e||"both"===e)}),[l]),k=(0,a().VK)((()=>{const e=null==l?void 0:l.axisGridLine;return!!e&&("vertical"===e||"both"===e)}),[l]),D=(0,a().VK)((()=>{if(!n||!t||!f)return;const e="category",o=(0,ge().C6)({collectionContextStore:t,resultsDataConfig:n,resultsChartReducerResults:r,chartType:"axis",xAxisType:e,timezone:s,environment:d,intl:p,theme:m});var i;v.current&&(null===(i=t.databaseItemsVisibleTracker)||void 0===i||i.handleItemsRenderStart(),v.current=!1);const a=r&&r.blockIds.length>0;return{seriesData:null==o?void 0:o.seriesData,maxValue:(null==o?void 0:o.maxValue)??0,minValue:(null==o?void 0:o.minValue)??0,xAxisType:e,reverseXAxis:(0,ge().Iq)({xAxisType:e,mainSort:b}),hasData:a}}),[n,t,f,r,s,d,p,m,b],{useDeepEqual:!0}),L=(0,a().VK)((()=>(0,w().vi)(y)),[y]),K=(0,a().VK)((()=>(0,T().Qm)({schema:S,property:n.nameProperty})),[n.nameProperty,S]),A=(0,a().VK)((()=>(0,T().Qm)({schema:S,property:n.valueProperty})),[n.valueProperty,S]),E=(0,me().Bv)(null==C?void 0:C.getRecordModel,p,s),O=(()=>{if(K)return"title"===K.type?E:void 0})(),z=A?(0,me().py)({propertySchema:A,aggregation:void 0,intl:p,numberPrecisionOverride:null==l?void 0:l.numberPrecisionOverride}):void 0,j=(0,a().VK)((()=>!(!A||!D)&&(0,me().ug)({dataYAxisMax:D.maxValue,dataYAxisMin:D.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,propertySchema:A,aggregation:void 0})),[D,null==l?void 0:l.yAxisMax,null==l?void 0:l.yAxisMin,A]),H=ye(y,S,null==D?void 0:D.seriesData),N=(0,o.useCallback)((()=>{t.onItemMount()}),[t]),$=(0,o.useCallback)(((e,t)=>{le({collectionStore:x,dataPoint:e,environment:d,clickEvent:t})}),[x,d]),Z=(0,a().Kw)(t.isInPeekRendererStore);return(0,G.jsx)(ce,{axisType:c,timezone:s,seriesData:(null==D?void 0:D.seriesData)||[],hasData:Boolean(null==D?void 0:D.hasData),loadingProps:u,xAxisType:null==D?void 0:D.xAxisType,xAxisTitle:V,yAxisTitle:R,axisLabelFormat:null==l?void 0:l.axisLabel,colorTheme:null==l?void 0:l.colorTheme,chartHeight:null==l?void 0:l.height,weightColorValue:null==l?void 0:l.weightColorValue,hideLegend:M,showCaption:null==l?void 0:l.showCaption,caption:null==l?void 0:l.caption,showHorizontalGridLines:P,showVerticalGridLines:k,dataLabelsEnabled:L,columnStacking:void 0,tooltipOptions:H,sortReversed:null==D?void 0:D.reverseXAxis,xLabelFormatter:O,dataLabelFormatter:z,yLabelFormatter:z,yAxisAllowDecimals:j,dataYAxisMax:null==D?void 0:D.maxValue,dataYAxisMin:null==D?void 0:D.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,onLoadEventHandler:N,isInPeekMode:Z,onSeriesClick:h?$:void 0})}function De(e){let{collectionContextStore:t,resultsChartReducerResults:r,aggregationChartReducerResults:n,resultsDataConfig:l,chartFormat:s,timezone:u,loadingProps:c}=e;const d=(0,i().O7)(),p=(0,B().YB)(),g=(0,F().Fg)(),m=(0,o.useRef)(!0),h=(0,Ce().E)("charts_drilldown"),{chartConfig:v,collectionViewBlockStore:y,collectionViewStore:f,collectionStore:C}=(0,a().VK)((()=>{const e=t.collectionViewStore(),r=null==e?void 0:e.getChartConfig();return{chartConfig:r&&"donut"===r.type&&"results_reducer"===r.dataConfig.type?r:void 0,collectionViewBlockStore:t.collectionViewBlockStore(),collectionViewStore:t.collectionViewStore(),collectionStore:t.collectionStore()}}),[t]),x=(0,a().Kw)(t.normalizedSchemaStore),S=(0,a().VK)((()=>{var e;if(!r||!y)return;const o=(0,ge().C6)({collectionContextStore:t,resultsDataConfig:l,resultsChartReducerResults:r,chartType:"donut",xAxisType:void 0,timezone:u,environment:d,intl:p,theme:g});var i;m.current&&(null===(i=t.databaseItemsVisibleTracker)||void 0===i||i.handleItemsRenderStart(),m.current=!1);const a=null==o||null===(e=o.seriesData)||void 0===e?void 0:e[0];return[{...a,data:(null==a?void 0:a.data)||[],type:"pie"}]}),[r,y,t,l,u,d,p,g],{useDeepEqual:!0}),b=(0,a().VK)((()=>{if(l.valueProperty)return l.valueProperty}),[l]),V=(0,a().VK)((()=>!(null!=s&&s.donutHideValue)),[null==s?void 0:s.donutHideValue]),w=ke(n,"sum",b,x),R=fe(v,x,S),_=(0,o.useCallback)((()=>{t.onItemMount()}),[t]),M=(0,me().Bv)(null==f?void 0:f.getRecordModel,p,u),P=(()=>{if("title"===l.nameProperty)return M})(),k=Re(v,x),T=(0,o.useCallback)(((e,t)=>{le({collectionStore:C,dataPoint:e,clickEvent:t,environment:d})}),[C,d]),D=(0,a().Kw)(t.isInPeekRendererStore);return(0,G.jsx)(be,{timezone:u,seriesData:S||[],title:V?null==w?void 0:w.title:void 0,subtitle:V?null==w?void 0:w.subtitle:void 0,loadingProps:c,colorTheme:null==s?void 0:s.colorTheme,chartHeight:null==s?void 0:s.height,weightColorValue:null==s?void 0:s.weightColorValue,hideLegend:null==s?void 0:s.hideLegend,showCaption:null==s?void 0:s.showCaption,caption:null==s?void 0:s.caption,tooltipOptions:R,legendLabelFormatter:P,onLoadEventHandler:_,dataLabelsFormatter:k,isInPeekMode:D,onSeriesClick:h?T:void 0})}var Le=()=>r(729201);function Ke(e){var t;let{collectionContextStore:r,chartConfig:i,timezone:n,reducerRequestType:l,groupedChartReducer:s,aggregationChartReducer:u,resultsChartReducer:c}=e;const{reducer:d,reducerKey:p}=(0,a().VK)((()=>"groups"===l?{reducer:s,reducerKey:V().FW}:"results"===l?{reducer:c,reducerKey:V().OS}:void(0,R().t1)(l)),[s,l,c]),m=(0,a().VK)((()=>(0,M().q)()),[]),h=(0,_().Z)({id:p,reducer:d,collectionContextStore:r,debounceWait:m}),v=(0,a().Kw)(r.isFullScreenStore),y=(0,o.useMemo)((()=>{var e;const t=(null==i||null===(e=i.chartFormat)||void 0===e?void 0:e.height)||w().Dv.medium;return(0,w().Ni)(t)}),[null==i||null===(t=i.chartFormat)||void 0===t?void 0:t.height]),f=(0,a().VK)((()=>{var e;if(void 0!==h)return;const t=r.remoteErrorStore.state;return"msg"!==(null==t?void 0:t.requestSrc)?"RequestTimeoutCancellationError"===(null==t||null===(e=t.errorBody)||void 0===e?void 0:e.name)?"queryCollection_timeout":t?"queryCollection_generic":void 0:void 0}),[r,h]),{loadingProps:C,chartConfigToDisplay:x}=function(e){let{collectionContextStore:t,chartConfig:r,chartReducerResults:i}=e;const n=(0,o.useRef)(void 0),l=(0,o.useRef)(void 0),[s,u]=(0,o.useState)(void 0),c=(0,a().VK)((()=>t.shouldShowSpinnerStore.state),[t],{useDeepEqual:!0}),d=(0,a().VK)((()=>void 0===i||Boolean(t.lastRemoteRequestStore.state&&t.remoteRequestStore.state&&!he().Xy(t.lastRemoteRequestStore.state.source,t.remoteRequestStore.state.source))),[i,t]),p=(0,a().VK)((()=>t.isFullScreenStore.state),[t]);(0,o.useEffect)((()=>{n.current=r,(t.isClientModeEnabledStore.state||t.isViewSpecificClientModeEnabledStore.state)&&u(r)}),[r,t]),(0,o.useEffect)((()=>{c||(l.current=n.current)}),[c]),(0,o.useEffect)((()=>{l.current=n.current,u(n.current)}),[null==r?void 0:r.type]);const{nameProperty:g,valueProperty:m}=(0,a().VK)((()=>"results_reducer"===(null==r?void 0:r.dataConfig.type)?{nameProperty:r.dataConfig.nameProperty,valueProperty:r.dataConfig.valueProperty}:{}),[null==r?void 0:r.dataConfig]);return(0,o.useEffect)((()=>{l.current=n.current,u(n.current)}),[g,m]),(0,o.useEffect)((()=>{u(c?l.current:n.current)}),[c]),{loadingProps:{isInitialLoading:d,isThrottledLoading:(0,Le().Z)(c,200,0),initialLoadingSvg:(0,o.useCallback)((()=>(0,G.jsx)(b().f,{chartType:null==r?void 0:r.type,showCopy:p})),[null==r?void 0:r.type,p])},chartConfigToDisplay:s}}({collectionContextStore:r,chartConfig:i,chartReducerResults:h});if(f)return(0,G.jsx)(S().Z,{chartError:f,collectionSettingsStore:r.settingsStore,chartType:null==i?void 0:i.type});if(x){if(i&&(0,g().u)(i)&&x&&(0,g().u)(x))return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(W,{loadingProps:C,chartConfig:x,chartReducerResults:h,collectionContextStore:r}),(0,G.jsx)(Fe,{collectionContextStore:r,chartConfig:i,chartConfigToDisplay:x,chartReducerResults:h,loadingProps:C,timezone:n,chartHeight:y,isFullScreen:v})]});if("donut"===(null==i?void 0:i.type)&&x&&"donut"===x.type)return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(W,{loadingProps:C,chartConfig:x,chartReducerResults:h,collectionContextStore:r}),(0,G.jsx)(Ae,{collectionContextStore:r,chartConfig:i,chartConfigToDisplay:x,chartReducerResults:h,timezone:n,loadingProps:C,aggregationChartReducer:u,chartHeight:y,isFullScreen:v})]})}return(0,G.jsx)("div",{style:{height:y,width:"100%"},children:(0,G.jsx)(b().f,{chartType:null==i?void 0:i.type,showCopy:v})})}function Fe(e){let{collectionContextStore:t,chartConfig:r,chartConfigToDisplay:o,chartReducerResults:i,timezone:a,loadingProps:n,chartHeight:l,isFullScreen:s}=e;if(r&&(0,g().u)(r)&&o&&(0,g().u)(o)){if("groups_reducer"===o.dataConfig.type&&(void 0===i||"groups"===(null==i?void 0:i.type)))return(0,G.jsx)(xe,{loadingProps:n,timezone:a,groupedDataConfig:o.dataConfig,chartFormat:r.chartFormat,collectionContextStore:t,groupedChartReducerResults:i,axisType:r.type});if("results_reducer"===o.dataConfig.type&&(void 0===i||"results"===(null==i?void 0:i.type)))return(0,G.jsx)(Be,{loadingProps:n,timezone:a,resultsDataConfig:o.dataConfig,chartFormat:r.chartFormat,collectionContextStore:t,resultsChartReducerResults:i,axisType:r.type})}return(0,G.jsx)("div",{style:{height:l,width:"100%"},children:(0,G.jsx)(b().f,{chartType:null==r?void 0:r.type,showCopy:s})})}function Ae(e){let{collectionContextStore:t,chartConfig:r,chartConfigToDisplay:o,chartReducerResults:i,timezone:n,loadingProps:l,aggregationChartReducer:s,chartHeight:u,isFullScreen:c}=e;const d=(0,a().VK)((()=>(0,M().q)()),[]),p=(0,_().Z)({id:V().jW,reducer:s,collectionContextStore:t,debounceWait:d});return"groups_reducer"!==o.dataConfig.type||void 0!==i&&"groups"!==(null==i?void 0:i.type)?"results_reducer"!==o.dataConfig.type||void 0!==i&&"results"!==(null==i?void 0:i.type)?(0,G.jsx)("div",{style:{height:u,width:"100%"},children:(0,G.jsx)(b().f,{chartType:null==r?void 0:r.type,showCopy:c})}):(0,G.jsx)(De,{loadingProps:l,timezone:n,resultsDataConfig:o.dataConfig,chartFormat:r.chartFormat,collectionContextStore:t,resultsChartReducerResults:i,aggregationChartReducerResults:p}):(0,G.jsx)(Te,{loadingProps:l,timezone:n,groupedDataConfig:o.dataConfig,chartFormat:r.chartFormat,collectionContextStore:t,groupedChartReducerResults:i,aggregationChartReducerResults:p})}function Ee(e){const{collectionContextStore:t,isPreviewing:r,paddingLeft:o,paddingRight:V,headingWidth:w=0}=e,R=(0,i().O7)(),_=(0,a().VK)((()=>R.device.isMobile),[R.device]),{collectionViewBlockStore:M,collectionSettingsStore:P,collectionViewStore:k,chartErrorStore:T}=(0,a().VK)((()=>({collectionViewBlockStore:t.collectionViewBlockStore(),collectionSettingsStore:t.settingsStore,collectionViewStore:t.collectionViewStore(),chartErrorStore:t.chartErrorStore})),[t]),B=(0,a().Kw)(t.isFullScreenStore),D=(0,a().Kw)(t.isInHomeWidgetStore),L=(0,a().VK)((()=>!!t.viewsModuleContextStore.getViewModuleType()),[t]),K=(0,a().VK)((()=>M&&f().Z.isBlockInTemplate(M)),[M]),F=(0,a().Kw)(t.normalizedFormatStore),A=(0,a().VK)((()=>F.chart_config),[F]),E=(0,a().VK)((()=>{var e;return(null==k?void 0:k.id)&&(null===(e=t.updateFreeChartsResultStore.state.get(k.id))||void 0===e?void 0:e.isPending)}),[t.updateFreeChartsResultStore,k]),{canViewChart:O,canViewChartError:z}=(0,s().n)({collectionContextStore:t}),j=(0,a().VK)((()=>{const e=(0,n().SO)({chartConfig:A,collectionSchema:t.normalizedSchemaStore.state});if(void 0!==e)return e;const r=k?T.getState().get(k.id):void 0;if(void 0!==r)return r;let o;return K||!z&&O||(o=z??"paywall"),o}),[A,T,t.normalizedSchemaStore,k,O,z,K],{useDeepEqual:!0}),H=(0,a().VK)((()=>"sidebar"===(0,y().F4)(t,_,w)&&P.state.open),[t,P,w,_]),N=(0,a().VK)((()=>{var e;const t=null===(e=C().default.state.currentUserSettingsStore)||void 0===e?void 0:e.getSettings(),r=null==t?void 0:t.time_zone,o=(0,l().r)();return r||o}),[]),$=(0,p().x)({chartConfig:A,chartError:j,collectionContextStore:t}),Z=function(e){let{chartConfig:t,chartError:r,collectionContextStore:o}=e;return(0,a().VK)((()=>{var e,o;if((!r||(0,n().se)(r))&&t&&"placeholder"!==t.type)if("groups_reducer"===(null===(e=t.dataConfig)||void 0===e?void 0:e.type)){const e=(0,d().x7)(t);if(e)return{type:"aggregation",aggregation:e}}else if("results_reducer"===(null===(o=t.dataConfig)||void 0===o?void 0:o.type))return{type:"aggregation",aggregation:{aggregator:"sum",property:t.dataConfig.valueProperty}}}),[t,r],{useDeepEqual:!0})}({chartConfig:A,chartError:j,collectionContextStore:t}),q=function(e){let{chartConfig:t,chartError:r,collectionContextStore:o}=e;const i=(0,a().VK)((()=>{var e;const r=(0,h().RL)({collectionContextStore:o,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}),i=t&&(0,g().u)(t)?null===(e=t.chartFormat)||void 0===e?void 0:e.axisHideEmptyGroups:void 0,a=t&&(0,g().u)(t)&&"results_reducer"===t.dataConfig.type?t.dataConfig.valueProperty:void 0;if(i&&a){const e={property:a,filter:{operator:"is_not_empty"}},t={property:a,filter:{operator:"number_does_not_equal",value:{type:"exact",value:0}}};r.push(e,t)}return(0,m().kk)(r)}),[o,t]),l=(0,a().VK)((()=>(0,v().Zl)()),[]);return(0,a().VK)((()=>{if((!r||(0,n().se)(r))&&t&&"placeholder"!==t.type&&"results_reducer"===t.dataConfig.type)return{type:"results",limit:l,filter:i}}),[r,t,i,l],{useDeepEqual:!0})}({chartConfig:A,chartError:j,collectionContextStore:t}),I=(0,a().VK)((()=>{var e,r;if(A&&"placeholder"!==A.type&&Z)return"groups_reducer"===(null==A||null===(e=A.dataConfig)||void 0===e?void 0:e.type)&&$?{reducerRequestType:"groups",groupedChartReducer:$,aggregationChartReducer:Z,collectionContextStore:t,chartConfig:A,timezone:N}:"results_reducer"===(null==A||null===(r=A.dataConfig)||void 0===r?void 0:r.type)&&q?{reducerRequestType:"results",resultsChartReducer:q,aggregationChartReducer:Z,collectionContextStore:t,chartConfig:A,timezone:N}:void 0}),[A,t,$,Z,q,N]);if(!M)return null;let W;return W=j&&!(0,n().se)(j)?"paywall"!==j||!E&&void 0!==O?(0,G.jsx)(S().Z,{chartError:j,collectionSettingsStore:t.settingsStore,chartType:null==A?void 0:A.type}):(0,G.jsx)(b().f,{chartType:null==A?void 0:A.type,showCopy:B}):A&&"placeholder"!==A.type&&I?(0,G.jsx)(Ke,{...I}):(0,G.jsx)(S().Z,{chartError:A?"data_model_invalid":"chart_config_not_found",collectionSettingsStore:t.settingsStore,chartType:null==A?void 0:A.type}),(0,G.jsx)("div",{style:{paddingLeft:o,paddingRight:V,paddingTop:15},children:(0,G.jsx)(x().Z,{store:M,shouldShowHalo:!B&&!D,canSelect:!B&&!L,disablePointerEvents:r,analyticsName:"chart",children:(0,G.jsx)(c().Z,{animate:{width:H?`calc(100% - ${u().P4}px)`:"100%"},children:W})})})}},209269:(e,t,r)=>{r.r(t),r.d(t,{DonutChart:()=>f});r(670560),r(267602),r(653476);var o=r(667294),i=()=>r(846550),a=()=>r(145112),n=()=>r(582900),l=()=>r(788860),s=()=>r(513670),u=()=>r(696459),c=()=>r(707513),d=()=>r(234150),p=()=>r(265195),g=()=>r(2581),m=()=>r(202638),h=()=>r(812372),v=r(785893);const y=14;function f(e){const t=(0,l().YB)(),r=(0,i().Fg)(),f=e.chartHeight||a().Dv.medium,R=e.seriesData.length>0&&e.seriesData[0].data.length>0,_=o.useMemo((()=>R?e.seriesData:[{name:"No data",data:[]}]),[R,e.seriesData]),M=(0,o.useMemo)((()=>(0,p().zn)(e.colorTheme||"auto",Boolean(e.weightColorValue),r)),[e.colorTheme,e.weightColorValue,r]),P=(0,o.useMemo)((()=>(0,a().Ni)(f)),[f]),k=e.dataLabelsFormatter?.9:1,T=(P-160)*k,B=(0,o.useMemo)((()=>{const o=e.showCaption?(0,g().I)(e.caption):"";return s().TS((0,m().Z)(r),{chart:{type:"pie",height:P,events:{render:function(){const o=this,i=o.container;if(i)if(R){if(e.title){var a;const e=o.title.getBBox();null===(a=o.title)||void 0===a||a.attr({y:y+o.plotTop+(o.plotHeight-e.height)/2})}}else(0,g().E)({intl:t,theme:r,chartType:"donut",container:i,hasData:R,hasBadYAxisRange:!1,isInPeekMode:Boolean(e.isInPeekMode)})},load:e.onLoadEventHandler}},time:{timezone:e.timezone},title:{useHTML:!0,floating:!0,text:void 0},series:_,...M,plotOptions:{pie:{size:T,innerSize:f===a().Dv.small||f===a().Dv.medium?"85%":"90%",showInLegend:!e.hideLegend,color:R?void 0:"transparent",fillColor:R?"transparent":r.tableDividerColor,states:{inactive:{opacity:1}},dataLabels:{enabled:!!e.dataLabelsFormatter,formatter:e.dataLabelsFormatter}},series:{cursor:e.onSeriesClick?"pointer":void 0,point:{events:{click:function(t){if(e.onSeriesClick){const r=(0,d().O)(e.seriesData,this.x);if(!r)return;e.onSeriesClick(r,t)}}}},marker:{enabled:!1},states:{hover:{halo:null}}}},legend:{enabled:!e.hideLegend,labelFormatter:function(){if(e.legendLabelFormatter){const t=this.index,r=_.length>0?_[0].data[t]:void 0;return e.legendLabelFormatter(this.name,r)}return this.name}},caption:{text:o},tooltip:{...e.tooltipOptions},responsive:{rules:C(T,f)}})}),[e,r,P,_,M,T,f,R,t]),D=(0,i().yK)((e=>({titleStyle:{fontWeight:500,color:e.text.primary,textAlign:"center"},subtitleStyle:{color:e.text.secondary,fontWeight:400,lineHeight:"15px",textAlign:"center",...c().Yu}})),[]),L=o.useCallback(((t,r)=>{const o=r||f,i=function(e,t,r){const o=(e||"").split("").filter((e=>","!==e&&"."!==e)),i=5*o.length;if(t&&x(t,r)){const e=t/5-i;return r===a().Dv.small||r===a().Dv.medium?Math.max(e,S):Math.max(e,b)}if(r===a().Dv.extra_large){const e=108-i;return Math.max(e,w)}if(r===a().Dv.large){const e=84-i;return Math.max(e,V)}if(r===a().Dv.medium){const e=72-i;return Math.max(e,b)}{const e=48-i;return Math.max(e,S)}}(e.title,t,o),l=function(e){if(!e||e===a().Dv.small||e===a().Dv.medium)return 12;if(e===a().Dv.large)return 14;if(e===a().Dv.extra_large)return 16;(0,u().t1)(e)}(o),s=function(e,t){if(e&&x(e,t))return.5*e;return t===a().Dv.extra_large?400:t===a().Dv.large?250:t===a().Dv.medium?150:80}(t,o),c=t??200,d=c<50?"":n().Z.renderToStaticMarkup((0,v.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,v.jsx)("div",{style:{...D.titleStyle,fontSize:i,lineHeight:`${i+13}px`,maxWidth:s},children:e.title}),e.subtitle&&c>=200?(0,v.jsx)("div",{style:{...D.subtitleStyle,fontSize:l,lineHeight:`${l+3}px`,maxWidth:s},children:e.subtitle}):null]}));return{title:{useHTML:!0,floating:!0,text:R?d:""}}}),[f,e.title,e.subtitle,D.titleStyle,D.subtitleStyle,R]);return(0,v.jsx)(h().Z,{loadingProps:e.loadingProps,chartOptions:B,containerHeight:P,getResponsiveChartOptions:L})}function C(e,t){const r=[];return t!==a().Dv.extra_large&&t!==a().Dv.large||r.push({condition:{maxWidth:e},chartOptions:{plotOptions:{pie:{size:void 0}}}}),r.push({condition:{maxWidth:(0,a().Q5)(t)},chartOptions:{plotOptions:{pie:{size:"75%"}}}}),r}function x(e,t){return t===a().Dv.extra_large?e-180<(0,a().Q5)(t):t===a().Dv.large?e-100<(0,a().Q5)(t):e<(0,a().Q5)(t)}const S=8,b=12,V=18,w=24},228772:(e,t,r)=>{r.d(t,{r:()=>a});var o=()=>r(142735),i=()=>r(876822);function a(){return(0,o().VK)((()=>i().default.state.currentSpaceStore),[])}}}]);