"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[28682],{166312:(e,t,n)=>{n.d(t,{De:()=>p,HH:()=>_,WP:()=>f,dF:()=>y,mq:()=>u,wo:()=>l,z$:()=>m});n(670560);var r=()=>n(730120),a=(n(667294),()=>n(157955)),o=()=>n(874459),i=()=>n(788860),s=()=>n(696459),d=()=>n(239482),c=n(785893);const u=[{frequency:"day",interval:1},{frequency:"week",interval:1},{frequency:"month",interval:1},{frequency:"year",interval:1}];function l(e){const t=d().eG(e)??[],n=[];for(const r of t){if(!("block"===r.table&&!0===r.isTemplate()&&r.getFormat().automation_id&&r.id!==e.id))continue;const t=r.getAutomationStore();if(t){if(!t.isReady())return{automationStoresReady:!1};void 0!==t.getRecurrence()&&t.isDefined()&&n.push(t.getModel())}}return{automationStoresReady:!0,...(0,a().templateAncestorsViolateRecurrenceNesting)(n)}}function m(e){switch(e){case"day":return(0,c.jsx)(i()._H,{defaultMessage:"Repeat daily",id:"database.templatePickerItem.recurrenceFrequency.daily"});case"week":return(0,c.jsx)(i()._H,{defaultMessage:"Repeat weekly",id:"database.templatePickerItem.recurrenceFrequency.weekly"});case"month":return(0,c.jsx)(i()._H,{defaultMessage:"Repeat monthly",id:"database.templatePickerItem.recurrenceFrequency.monthly"});case"year":return(0,c.jsx)(i()._H,{defaultMessage:"Repeat yearly",id:"database.templatePickerItem.recurrenceFrequency.yearly"});default:(0,s().t1)(e)}}function f(e,t){const n="week"!==t||void 0!==e.weekdays&&0!==e.weekdays.length?e.weekdays:[(o=e.start_date,(0,s().Yd)(a().RRULE_WEEKDAYS_MAP)[r().ou.fromMillis(o).weekday-1])];var o;return{...e,weekdays:n,frequency:t}}function y(){return{start_date:r().ou.local().plus({days:1}).set({hour:0,minute:0,second:0,millisecond:0}).toMillis(),timezone:(0,o().Sv)(),hour:0,minute:0,frequency:"day",interval:1}}function p(e){const{recurrence:t,intl:n,leadingPhrase:r}=e;return(0,a().rruleFromRecurrence)({..."month"===t.frequency?{...t,monthly_restriction:void 0}:t,weekdays:void 0,hour:0,minute:0,end_condition:void 0}).toText((e=>{switch(e){case"every":if(void 0===r)return"";if("every"===r)return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.every",defaultMessage:"every"});if("repeat every"===r)return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.repeatEvery",defaultMessage:"repeat every"});(0,s().t1)(r);break;case"day":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.day",defaultMessage:"day"});case"days":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.days",defaultMessage:"days"});case"week":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.week",defaultMessage:"week"});case"weeks":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.weeks",defaultMessage:"weeks"});case"month":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.month",defaultMessage:"month"});case"months":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.months",defaultMessage:"months"});case"year":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.year",defaultMessage:"year"});case"years":return n.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.years",defaultMessage:"years"});default:return e.toString()}})).trim()}function _(e){const t=e.getRecurrence();return Boolean(e.isTriggerType("recurrence")&&t&&"disabled_recurrence_ended"===e.getStatus())}},680917:(e,t,n)=>{n.d(t,{q:()=>o,s:()=>a});var r=()=>n(677559);const a=new(r().Ss)("recurrence",(async()=>{const[e,t,{RecurrenceConfigMenu:r}]=await Promise.all([Promise.all([n.e(62743),n.e(71896),n.e(46546),n.e(91253),n.e(58548),n.e(90653)]).then(n.bind(n,857205)),Promise.all([n.e(62743),n.e(71896),n.e(46546),n.e(91253),n.e(58548),n.e(90653)]).then(n.bind(n,157955)),Promise.all([n.e(62743),n.e(71896),n.e(46546),n.e(91253),n.e(58548),n.e(90653)]).then(n.bind(n,788171))]);return{recurrenceActions:e,recurrenceHelpers:t,RecurrenceConfigMenu:r}})),o=(0,r().iS)(a,(e=>e.RecurrenceConfigMenu))},157955:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>D,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>v,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>R,MAX_RECURRENCE_INTERVAL:()=>_,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>M,RRULE_WEEKDAYS_MAP:()=>p,convertFromUnpersistedRecurrenceConfig:()=>N,convertToUnpersistedRecurrenceConfig:()=>I,getFormattedEndCondition:()=>C,getFormattedNextRecurrenceTime:()=>T,getNewEndTimestamp:()=>L,getNextDateUtc:()=>w,getRecurrenceAfter:()=>E,isRunningBetweenMidnightAnd3AM:()=>A,isValidRecurrenceInterval:()=>g,isValidRecurrenceNumberOfRuns:()=>h,rruleFromRecurrence:()=>b,templateAncestorsViolateRecurrenceNesting:()=>k});n(267602),n(653476),n(241792);var r=()=>n(730120);n(670560);function a(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(0===n.length)return e.map((e=>[e]));const o=[];for(const i of e)o.push(...a(n[0],...n.slice(1)).map((e=>[i,...e])));return o}var o=()=>n(696459),i=()=>n(326966),s=()=>n(803021),d=()=>n(646574),c=()=>n(998411),u=()=>n(578292);class l extends(()=>n(484885))().Ci{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var m=()=>n(494616);const f=(0,n(788860).vU)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),y={day:l.DAILY,week:l.WEEKLY,month:l.MONTHLY,year:l.YEARLY},p={MO:l.MO,TU:l.TU,WE:l.WE,TH:l.TH,FR:l.FR,SA:l.SA,SU:l.SU},_=99,M=999;function g(e){return(0,i().hj)(e)&&Number.isInteger(e)&&e>0&&e<=_}function h(e){return(0,i().hj)(e)&&Number.isInteger(e)&&e>0&&e<=M}function b(e){const{start_date:t,frequency:n,interval:r,weekdays:i,timezone:d,hour:c,minute:u}=e,m="week"===n&&i?i.map((e=>p[e])):void 0,f={};return(0,o().$K)(e.end_condition)&&("date"===e.end_condition.type?f.until=(0,s().pd)(e.end_condition.end_at):"number"===e.end_condition.type?f.count=e.end_condition.number_of_occurrences:(0,o().t1)(e.end_condition)),"month"===e.frequency&&(0,o().$K)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?f.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?f.byweekday=a(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return p[t].nth(n)})):(0,o().t1)(e.monthly_restriction)),new l({freq:y[n],dtstart:(0,s().pd)(t),interval:r,byweekday:m,tzid:d,byhour:c??0,byminute:u??0,bysecond:0,...f})}const R=1,v=1;function k(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),r=e.length,a=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,o=r>R,i=n.length>=v;return{violatesConstraint:o||i,templateNestingExceedsMaxDepth:o,ancestorHasDailyTemplate:i,nestedDepthOfAutomationAncestors:r,immediateAncestorRecurrenceType:a}}function E(e){const{recurrence:t,afterDate:n}=e;if((0,m().nA)(t)){const e=(0,s().kq)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=b(t).after((0,s().pd)(n));if(!e)return;return(0,s().YL)(e)}}function A(e){return 0===e.hour||1===e.hour||2===e.hour}function w(e){return b(e).after((0,s().pd)((0,s().Jh)()))||void 0}function T(e){const{recurrence:t,intl:n}=e,a=w(N(t));if(!a)return;const o=A(t),i=r().ou.fromJSDate(a).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().E2)(n)).setZone(t.timezone),s=(0,d().p6)({date:i,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(o)return n.formatMessage(f.dateBetweenMidnightAnd3AM,{date:s});{let e=i.toLocaleString(r().ou.TIME_SIMPLE);return t.timezone!==(0,c().r)()&&(e+=` ${i.toFormat("ZZZZ")}`),n.formatMessage(f.dateAtTime,{date:s,time:e})}}function C(e,t){return(0,o().$K)(e)?"number"===e.type?t.formatMessage(f.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,d().p6)({date:r().ou.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,o().t1)(e):t.formatMessage(f.noEndCondition)}const D=100;function I(e){return{...e,start_date:(0,s().kq)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,s().kq)(e.end_condition.end_at)}:(0,o().t1)(e.end_condition):void 0}}function L(e,t,n){return e.plus(n-t)}function P(e,t){const n=r().ou.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,s().Jh)(n.toJSDate())}}function N(e){return{...e,start_date:(0,s().Jh)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?P(e,e.end_condition):(0,o().t1)(e.end_condition):void 0}}}}]);