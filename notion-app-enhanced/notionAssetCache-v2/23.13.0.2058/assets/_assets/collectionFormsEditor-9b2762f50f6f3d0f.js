"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[57036],{509572:(e,o,t)=>{t.r(o),t.d(o,{FORMS_SHARE_CALLOUT_KEY:()=>Y,changeFormClosedState:()=>de,changeFormSubmissionPermissions:()=>me,createAndFocusCollectionFormEditorView:()=>ne,createCollectionFormEditorView:()=>re,createDummyFormPage:()=>ge,createFormInPrivate:()=>ie,createFormQuestion:()=>se,createFormQuestionAndModuleForNewlyDuplicatedProperty:()=>ce,createFormQuestionAndUpdateOrCreateModule:()=>le,createResponsesCollectionView:()=>ae,handleUpdateFormQuestionName:()=>ee,incrementAndTrackUserFormsCreated:()=>J,maybeAlertAboutUnsupportedPublicQuestions:()=>ye,maybeSyncQuestionNameToPropertyName:()=>oe,remapQuestionToNewProperty:()=>fe,toggleAnonymousFormSubmissionState:()=>ue,toggleNotionBrandingState:()=>pe});t(821057),t(670560),t(267602),t(653476),t(470928),t(30005),t(667294);var n=()=>t(846550),r=()=>t(506347),i=()=>t(156642),a=()=>t(863112),s=()=>t(226413),c=()=>t(532850),l=()=>t(817629),d=()=>t(998411),m=()=>t(127513),u=()=>t(64272),p=()=>t(644602),f=()=>t(667932),g=()=>t(217465),y=()=>t(375255),v=()=>t(396136),S=()=>t(139978),h=()=>t(26645),C=()=>t(483791),I=()=>t(955620),b=()=>t(788860),_=()=>t(342792),w=()=>t(543172),x=()=>t(707513),T=()=>t(984871),A=()=>t(132156),F=()=>t(308186),M=()=>t(421654),Q=()=>t(636340),N=()=>t(47443),P=()=>t(145284),R=()=>t(269299),k=()=>t(348141),B=()=>t(804057),E=()=>t(427886),V=()=>t(594546),L=()=>t(907005),U=()=>t(561933),D=()=>t(487270),j=()=>t(527278),q=()=>t(803728),H=()=>t(99537),Z=()=>t(356117),O=()=>t(876822),W=()=>t(749826),z=()=>t(808282),G=()=>t(807230),X=()=>t(469753),K=t(785893);const $=(0,b().vU)({responsesViewName:{id:"formEditorActions.responsesViewName",defaultMessage:"Responses"},newFormViewName:{id:"formEditorActions.newFormViewName",defaultMessage:"Form builder"},formDatabaseTitle:{id:"newBlock.databaseInline.formDatabaseTitle",defaultMessage:"New form"}}),Y="forms_share_form_tooltip";function J(e,o){const{currentUserSettingsStore:t}=O().default.state;if(!t)return;const n=function(){const{currentUserSettingsStore:e}=O().default.state;if(!e)return;return e.getSettingsStore().getKeyStore("user_forms_created_count").getValue()??0}();void 0!==n&&(k().d2({userSettingsStore:t,transaction:o,data:{user_forms_created_count:n+1}}),function(e,o){(0,V().j)({environment:e,event:{eventName:"form_created",eventProperties:{user_total_form_count:o.userFormsCreatedCount}}})}(e,{userFormsCreatedCount:n+1})),W().default.logEvent("form_created")}function ee(e){var o;const{questionStore:t,newName:n,environment:r,collectionStore:i,collectionSchema:a,collectionContextStore:s}=e,c=null===(o=t.getConfig())||void 0===o?void 0:o.propertyId;if(!c)throw new Error("No property ID found for question");R().createAndCommit({userAction:"formQuestion.changeName",environment:r,canUndo:!0,perform:e=>{var o,r;const l=null===(o=t.getConfig())||void 0===o?void 0:o.name;if(!l)return;const m=(0,y().Xh)({textValue:l,getRecordModel:t.getRecordModel,deterministic:!0,userTimeZone:(0,d().r)(),intl:j().Z.getIntl()})===(null===(r=a[c])||void 0===r?void 0:r.name);R().applyOperation({store:t,operation:{pointer:t.pointer,path:["config","name"],command:"set",args:[[n]]},transaction:e}),t.shouldSyncQuestionNameToPropertyName()&&(m&&!(0,U().Gu)({property:c,collectionContextStore:s,newValue:n})?T().Bv({collectionStore:i,property:c,name:n,transaction:e}):R().applyOperation({store:t,operation:{pointer:t.pointer,path:["config","shouldSyncQuestionNameToPropertyName"],command:"set",args:!1},transaction:e}))}})}function oe(e){var o;const{questionStore:t,environment:n,collectionStore:r,collectionContextStore:i}=e,a=null===(o=t.getConfig())||void 0===o?void 0:o.propertyId;if(!a)throw new Error("No property ID found for question");R().createAndCommit({userAction:"formQuestion.changeName",environment:n,canUndo:!0,perform:e=>{if(!t.shouldSyncQuestionNameToPropertyName())return;const o=t.getNameStore().getValue();if(!o)return;const n=(0,y().Xh)({textValue:o,getRecordModel:t.getRecordModel,deterministic:!0,userTimeZone:(0,d().r)(),intl:j().Z.getIntl()}),s=(0,U().Gu)({property:a,collectionContextStore:i,newValue:n})?(0,l().n)(n):n;T().Bv({collectionStore:r,property:a,name:s,transaction:e})}})}function te(){const e=(0,n().yK)((e=>({container:{display:"flex",flexDirection:"column"},iconGroup:{display:"flex",flexDirection:"row",justifyContent:"center",color:e.icon.secondary,alignItems:"center"},dialogTitle:{fontSize:16,fontWeight:x().Ue.semibold,lineHeight:"22px",marginTop:12,marginBottom:12},dialogDescription:{color:e.text.secondary,fontSize:14,lineHeight:"20px"}})),[]);return(0,K.jsxs)("div",{style:e.container,children:[(0,K.jsxs)("div",{style:e.iconGroup,children:[(0,p().t)({width:24}),(0,m().r)({width:16,marginLeft:16,marginRight:14}),(0,u().E)({width:24})]}),(0,K.jsx)("span",{style:e.dialogTitle,children:(0,K.jsx)(b()._H,{defaultMessage:"Auto-create form questions based on existing properties?",id:"NewFormOnExistingCollectionDialogTitle.message"})}),(0,K.jsx)("span",{style:e.dialogDescription,children:(0,K.jsx)(b()._H,{defaultMessage:"Only supported property types will create new questions.",id:"NewFormOnExistingCollectionDialogTitle.description"})})]})}function ne(e){const{environment:o,collectionContextStore:t,transaction:n}=e,r=t.collectionViewBlockStore(),i=t.collectionStore();if(!r||!i)return;const a=t.normalizedSchemaStore.state,s=re({environment:o,collectionViewBlockStore:r,schema:a,transaction:n,initializeWithAllDefaultQuestions:!1});if(!s)return;(0,E().f)({environment:o,collectionContextStore:t,collectionViewId:s.newViewId,isFullScreen:t.isFullScreenStore.state,isRootChild:t.isRootChildStore.state,isInPeekRenderer:t.isInPeekRendererStore.state});const c=s.layoutStore,l=Object.keys(a).filter((e=>{const o=a[e];return"title"!==e&&o&&(0,X().I0)(o)}));l.length>0&&l.length<=X().h0&&F().vC({showCancel:!1,keepFocus:!1,message:(0,K.jsx)(te,{}),mode:"wide",items:[{label:(0,K.jsx)(b()._H,{defaultMessage:"Create {numQuestions, plural, one {1 question} other {{numQuestions} questions}}",id:"formEditorActions.createQuestions.primaryAction",values:{numQuestions:l.length}}),color:"blue",buttonType:"solid",onAccept(){R().createAndCommit({environment:o,userAction:"formActions.autoCreateFormQuestionsForExistingDatabase",canUndo:!0,perform:e=>{for(const n of l)ce({environment:o,transaction:e,layoutStore:c,collectionStore:i,propertyId:n,position:{type:"area_relative",area:"form_layout_schema",location:"end_moveable"},addLayoutModule:t=>{(0,H().sW)({environment:o,sessionId:(0,_().ZP)(),layoutStore:c,position:t.position??{type:"area_relative",area:"form_layout_schema",location:"end_moveable"},module:t.layoutModule,transaction:e,isPropertyCreation:!1})},collectionContextStore:t,shouldLogEvent:!0,autoCreatedFromExistingDatabase:!0})}})}},{label:(0,K.jsx)(b()._H,{defaultMessage:"Start from scratch",id:"formEditorActions.createQuestions.secondary"}),color:"gray",buttonType:"plain",onAccept(){}}]})}function re(e){const{environment:o,collectionViewBlockStore:t,transaction:n,schema:r,initializeWithAllDefaultQuestions:i}=e;if(!t)return;const c=t.getSpaceId(),{formBlockStore:l,layoutStore:d}=function(e){var o;const{environment:t,spaceId:n,inMemoryRecordCache:r,transaction:i,schema:c,initializeWithAllDefaultQuestions:l}=e,d=Object.keys(c).find((e=>{var o;return"select"===(null===(o=c[e])||void 0===o?void 0:o.type)})),m=Boolean(l&&void 0!==d),u=(0,D().TS)({environment:t,table:v().iU,spaceId:n}),p=(0,D().TS)({environment:t,table:h().L_,spaceId:n}),g=m?(0,D().TS)({environment:t,table:h().L_,spaceId:n}):void 0,y=Q().j4({id:u,environment:t,type:"form",permissions:(0,a().wG)(),inMemoryRecordCache:r,transaction:i}),S=Q().ae({environment:t,table:C().Bh,value:{space_id:n,parent_table:v().iU,parent_id:y.id,modules:(0,f().l2)(p,g)},inMemoryRecordCache:r,transaction:i});var I;M().FH({stores:[y],update:{form_layout_pointer:{id:S.id,spaceId:n,table:C().Bh}},transaction:i}),se({environment:t,questionId:p,spaceId:n,layoutId:S.id,propertyId:s().iw,initialQuestionTitle:(null===(o=c[s().iw])||void 0===o?void 0:o.name)??"",inMemoryRecordCache:r,transaction:i,shouldSyncQuestionNameToPropertyName:!0,shouldLogEvent:!1}),m&&g&&d&&se({environment:t,questionId:g,spaceId:n,layoutId:S.id,propertyId:d,initialQuestionTitle:(null===(I=c[d])||void 0===I?void 0:I.name)??"",inMemoryRecordCache:r,transaction:i,shouldSyncQuestionNameToPropertyName:!0,shouldLogEvent:!1});return{formBlockStore:y,layoutStore:S}}({environment:o,spaceId:c,inMemoryRecordCache:t.inMemoryRecordCache,transaction:n,schema:r,initializeWithAllDefaultQuestions:i}),m=(0,B().W)({environment:o,collectionViewBlockStore:t,collectionView:{type:"form_editor",parent_id:t.id,parent_table:v().iU,alive:!0,space_id:c,name:j().Z.formatMessage($.newFormViewName),format:{form_block_pointer:{id:l.id,spaceId:c,table:v().iU}}},transaction:n});return Q().sW({store:l,data:{parent_id:m.id,parent_table:S().np,alive:!0},transaction:n}),z().Z.setState({openTooltip:m.id}),q().yM(o,Y),J(o,n),{newViewId:m.id,layoutStore:d,formId:l.id}}function ie(e){const{environment:o,navigateToFormBuilder:t}=e,{currentSpaceStore:n,currentSpaceViewStore:i}=O().default.state;if(!n||!i)return;if(!(0,G().ww)(o))return void(0,G().eD)(o);if(!(n&&n.canEdit()&&i))return;const a=n.id,s=o.idCreator.getSpaceIdCreatorSync(a);R().createAndCommit({environment:o,userAction:"formActions.createAndNavigateToFormInPrivate",canUndo:!0,perform:e=>{var c;const{targetBlockStore:l}=A().Z({environment:o,sourceBlockId:"root",targetBlockPointer:(0,D().Ii)({environment:o,table:v().iU,spaceId:a}),sourceBlockSubtree:(0,g().partialRecordMapToRecordMap)(L().Xq({isInline:!0,name:(0,I().TPx)(j().Z.formatMessage($.formDatabaseTitle))})),targetRecordCache:n.inMemoryRecordCache,transaction:e,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!1,spaceIdCreator:s}),d=l.getCollectionStore(),m=null==d||null===(c=d.getModel())||void 0===c?void 0:c.getNormalizedSchema(),u=l;if(!m)throw new Error("Schema not found");re({environment:o,transaction:e,collectionViewBlockStore:u,schema:m,initializeWithAllDefaultQuestions:!0}),ae({environment:o,transaction:e,collectionViewBlockStore:u,schema:m}),P().Hj({environment:o,spaceStore:n,spaceViewStore:i,pageStore:l,isPrivate:!0,transaction:e,location:{type:"prepend"}}),t&&N()._c({environment:o,store:l,pageVisitSource:r().tY.CreateFormDeepLink})}})}function ae(e){const{environment:o,collectionViewBlockStore:t,transaction:n}=e,r=t.getSpaceId(),i=Object.keys(e.schema).find((o=>{var t;return"created_by"===(null===(t=e.schema[o])||void 0===t?void 0:t.type)}));(0,B().W)({environment:o,collectionViewBlockStore:t,collectionView:{type:"table",parent_id:t.id,parent_table:v().iU,alive:!0,name:j().Z.formatMessage($.responsesViewName),space_id:r,format:{table_properties:[{property:"title",visible:!0},...i?[{property:i,visible:!0}]:[]],table_wrap:!0,collection_pointer:t.getCollectionPointer()}},transaction:n})}function se(e){const{environment:o,questionId:t,spaceId:n,layoutId:r,propertyId:i,initialQuestionTitle:a,inMemoryRecordCache:s,transaction:c,shouldSyncQuestionNameToPropertyName:l,collectionContextStore:d,shouldLogEvent:m=!0,autofocusTitle:u,existingFormQuestionConfig:p,autoCreatedFromExistingDatabase:f}=e;Q().ae({environment:o,table:h().L_,value:{id:t,space_id:n,parent_table:C().Bh,parent_id:r,alive:!0,config:{...p,propertyId:i,name:[[a]],shouldSyncQuestionNameToPropertyName:l}},inMemoryRecordCache:s,transaction:c}),m&&(0,V().j)({environment:o,event:{eventName:"add_form_question",eventProperties:{...(0,X().Pz)({collectionContextStore:d,propertyId:i,questionId:t}),auto_created_from_existing_database:Boolean(f)}}}),u&&u.autofocusedQuestionTextStore.autofocusQuestionTitle({questionId:t})}function ce(e){const{environment:o,transaction:t,layoutStore:n,collectionStore:r,propertyId:i,position:a,addLayoutModule:s,collectionContextStore:c,shouldLogEvent:l=!0,autofocusTitle:d,existingFormQuestionConfig:m,autoCreatedFromExistingDatabase:u}=e,p=r.getSchema()[i];if(!p)throw new Error(`No schema found for property ${i}`);const f=m?(0,I().QaF)(null==m?void 0:m.name):p.name,g=n.getSpaceId(),y=(0,D().TS)({environment:o,table:h().L_,spaceId:g});return se({environment:o,questionId:y,spaceId:g,layoutId:n.id,propertyId:i,initialQuestionTitle:f,inMemoryRecordCache:n.inMemoryRecordCache,transaction:t,shouldSyncQuestionNameToPropertyName:!0,shouldLogEvent:l,collectionContextStore:c,autofocusTitle:d,existingFormQuestionConfig:m,autoCreatedFromExistingDatabase:u}),s({layoutModule:{type:"formQuestion",id:(0,w().ZP)(),formQuestionId:y},position:a,transaction:t}),{questionId:y}}function le(e){const{environment:o,transaction:t,layoutStore:n,propertyId:r,initialQuestionTitle:i,moduleId:a,shouldSyncQuestionNameToPropertyName:s,collectionContextStore:c,autofocusTitle:l,area:d,sessionId:m}=e,u=n.getModel();if(!u)throw new Error("Layout model cannot be undefined");const p=n.getSpaceId(),f=(0,D().TS)({environment:o,table:h().L_,spaceId:p});se({environment:o,questionId:f,spaceId:p,layoutId:u.id,propertyId:r,initialQuestionTitle:i,inMemoryRecordCache:n.inMemoryRecordCache,transaction:t,shouldSyncQuestionNameToPropertyName:s,collectionContextStore:c,autofocusTitle:l});const g={type:"formQuestion",id:a??(0,w().ZP)(),formQuestionId:f,..."form_conditional_modules"===d?{parentModuleId:e.parentModuleId,parentConditionalGroupId:e.parentConditionalGroupId}:{}};return a?(0,Z().Uq)({environment:o,transaction:t,layoutStore:n,position:{area:d,moduleId:a},updatedModule:g}):"form_conditional_modules"===d&&(0,H().sW)({environment:o,transaction:t,layoutStore:n,position:{type:"absolute",area:"form_conditional_modules",parentConditionalGroupId:e.parentConditionalGroupId,parentModuleId:e.parentModuleId},module:g,sessionId:m,isPropertyCreation:!1}),{updatedModuleId:g.id}}function de(e){let{environment:o,formBlockStore:t,isClosed:n}=e;t.getIsFormClosed()!==n&&R().createAndCommit({userAction:"formActions.changeFormClosedState",environment:o,canUndo:!0,perform:e=>{M().FH({stores:[t],update:{form_config:{...t.getFormConfig(),is_form_closed:n}},transaction:e})}})}function me(e){let{environment:o,formBlockStore:t,permissions:n}=e;t.getFormSubmissionPermissions()!==n&&R().createAndCommit({userAction:"formActions.changeFormSubmissionPermissions",environment:o,canUndo:!0,perform:e=>{M().FH({stores:[t],update:{form_config:{...t.getFormConfig(),submission_permissions:n}},transaction:e})}})}function ue(e){let{environment:o,formBlockStore:t}=e;const n=t.getIsFormAnonymousSubmissionEnabled();R().createAndCommit({userAction:"formActions.changeAnonymousFormSubmissionState",environment:o,canUndo:!0,perform:e=>{M().FH({stores:[t],update:{form_config:{...t.getFormConfig(),anonymous_submissions:!n}},transaction:e})}})}function pe(e){var o;let{environment:t,formBlockStore:n}=e;const r=n.getSiteStore();if(!r)return;const i=(null===(o=r.getHeader())||void 0===o?void 0:o.hideWatermark)??!1;R().createAndCommit({userAction:"formBlockStore.publicForm.toggleNotionBranding",environment:t,canUndo:!0,perform:e=>{R().applyOperation({store:r,operation:{pointer:r.pointer,path:["header","hideWatermark"],command:"set",args:!i},transaction:e})}})}function fe(e){let{environment:o,newPropertyId:t,formQuestionStore:n}=e;R().createAndCommit({userAction:"formQuestion.remapQuestionToNewProperty",environment:o,canUndo:!0,perform:e=>{R().applyOperation({store:n,operation:{pointer:n.pointer,path:["config","propertyId"],command:"set",args:t},transaction:e})}})}function ge(e){const{environment:o,collectionSchema:t,temporaryRecordCache:n,spaceId:r,collectionId:a,formMode:s}=e,c={};Object.keys(t).forEach((e=>{c[e]=(0,I().TPx)("")}));const{performResult:l}=R().createAndCommit({environment:o,userAction:"formActions.createDummyFormPage",perform:e=>{const t=Q().j4({environment:o,type:i().Ti.page,inMemoryRecordCache:n,transaction:e,spaceId:r,properties:{...c}});return Q().sW({store:t,data:{alive:"viewer"===s,parent_id:a,parent_table:"collection"},transaction:e}),t},canUndo:!1});return l}async function ye(e){const{environment:o,formBlockStore:t,collectionSchema:n,theme:r,onAccept:i}=e;if(!n)return;const a=(0,X().jj)(t),s=(null==a?void 0:a.getFormQuestionsForFormLayout())??[],l=[];if(s.forEach((e=>{const t=e.getPropertyId();if(!t)return;const r=(0,c().Qm)({schema:n,property:t}),i=null==r?void 0:r.type;if(!i)return;(0,X().Hz)({environment:o,propertyType:i,propertySchema:r,isPublicForm:!0})&&l.push(e)})),0===l.length)return void i();const m=l.map(((e,o)=>{const t=(0,y().Xh)({textValue:e.getNameStore().getValue(),getRecordModel:e.getRecordModel,deterministic:!0,userTimeZone:(0,d().r)(),intl:j().Z.getIntl()}),n=o===l.length-1;return(0,K.jsx)("div",{style:{fontSize:14,textAlign:"start",padding:"8px 12px",borderBottom:n?void 0:`1px solid ${r.lightDividerColor}`},children:t},e.id)})),{accept:u}=await F().gt({message:(0,K.jsx)(b()._H,{id:"formEditorActions.maybeAlertAboutUnsupportedPublicQuestions.message",defaultMessage:"These questions are not supported in public forms and will not be shown to respondents:"}),description:(0,K.jsx)("div",{style:{borderRadius:6,border:`1px solid ${r.lightDividerColor}`,width:"calc(100% + 24px)",marginLeft:-12,marginTop:12,maxHeight:210,overflow:"auto"},children:m}),acceptLabel:(0,K.jsx)(b()._H,{id:"formEditorActions.maybeAlertAboutUnsupportedPublicQuestions.acceptLabel",defaultMessage:"Got it"}),acceptColor:"blue",cancelButtonType:"plain",mode:"wide"});u&&i()}},801670:(e,o,t)=>{t.r(o),t.d(o,{formEditorActions:()=>n()});var n=()=>t(509572)},808282:(e,o,t)=>{t.d(o,{Z:()=>r});class n extends(()=>t(263184))().default{getInitialState(){return{openTooltip:void 0}}}const r=new n},127513:(e,o,t)=>{t.d(o,{r:()=>r});t(667294);var n=t(785893);const r=(0,t(827282).IU)("arrowRightRounded",{viewBox:"0 0 16 13",svg:(0,n.jsx)("path",{d:"M15.3828 6.85156C15.3828 7.09635 15.2917 7.3099 15.1094 7.49219L9.95312 12.6328C9.77083 12.8099 9.5651 12.8984 9.33594 12.8984C9.09635 12.8984 8.89583 12.8203 8.73438 12.6641C8.57812 12.5078 8.5 12.3125 8.5 12.0781C8.5 11.9583 8.52083 11.8464 8.5625 11.7422C8.60938 11.638 8.67188 11.5469 8.75 11.4688L10.5 9.70312L13.4141 7.04688L13.6875 7.54688L10.9766 7.70312H1.48438C1.22396 7.70312 1.01302 7.625 0.851562 7.46875C0.695312 7.30729 0.617188 7.10156 0.617188 6.85156C0.617188 6.59635 0.695312 6.39062 0.851562 6.23438C1.01302 6.07292 1.22396 5.99219 1.48438 5.99219H10.9766L13.6875 6.15625L13.4141 6.66406L10.5 4L8.75 2.22656C8.67188 2.14844 8.60938 2.0599 8.5625 1.96094C8.52083 1.85677 8.5 1.74219 8.5 1.61719C8.5 1.38281 8.57812 1.1875 8.73438 1.03125C8.89583 0.875 9.09635 0.796875 9.33594 0.796875C9.45052 0.796875 9.5599 0.820312 9.66406 0.867188C9.76823 0.914062 9.86719 0.984375 9.96094 1.07812L15.1094 6.21094C15.2917 6.39323 15.3828 6.60677 15.3828 6.85156Z"})})}}]);