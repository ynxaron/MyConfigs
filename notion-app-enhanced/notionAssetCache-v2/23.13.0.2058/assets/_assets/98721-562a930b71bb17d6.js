"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[98721],{298721:(e,t,r)=>{r.d(t,{cG:()=>L,fS:()=>H,Wy:()=>Y,po:()=>S,mH:()=>O,nD:()=>j,_O:()=>U,Q0:()=>D,cz:()=>A,bc:()=>E});r(821057),r(492176),r(670560),r(7961),r(267602),r(470928),r(749411),r(241792);var n=()=>r(730120),a=()=>r(704923),o=()=>r(666908),i=()=>r(998411),s=()=>r(741633),u=()=>r(325490),c=()=>r(28070),l=()=>r(989478),p=()=>r(361929),d=()=>r(255393),m=()=>r(955620),y=()=>r(783190),h=()=>r(956898),b=()=>r(513670),g=()=>r(342792);const f=(0,r(830742).LS)("runInferenceTranscriptQueue");var v=()=>r(824462),k=()=>r(959137),x=()=>r(308186),w=()=>r(782646),T=()=>r(636340),_=()=>r(269299),N=()=>r(254940),C=()=>r(487270),I=()=>r(876822),q=()=>r(965014),M=()=>r(404791),K=()=>r(144628);function S(e){const{clientStore:t}=e;t.setState({showHistory:t.state.showHistory,showDebug:t.state.showDebug,config:t.state.config,debugOverrides:t.state.debugOverrides,inferences:[],acceptedInferenceKeys:[],inferenceKeysToAnnotations:{},inferenceKeysToMemories:{},abortController:void 0,model:t.state.model,loading:!1,stopInferencePromise:void 0,temporarySteps:[],tags:[],traceId:void 0,requestInfo:void 0})}function $(e){const{environment:t,spaceStore:r,transcript:n,threadParentPointer:a,threadId:o,transaction:i}=e,s=t.currentUser.id;if(!s)throw new Error("No current user");const c=P({environment:t,threadId:o,spaceStore:r,userId:s,transcript:n,transaction:i});return T().ae({environment:t,table:u().kL,value:{id:o,parent_id:a.id,parent_table:a.table,space_id:a.spaceId,messages:c,created_time:Date.now(),created_by_id:s,created_by_table:l().KJ},transaction:i,inMemoryRecordCache:r.inMemoryRecordCache})}function D(e){var t;const{threadStore:r,transaction:n,clientStore:a}=e;null===(t=a.state.abortController)||void 0===t||t.abort(),T().sW({store:r,data:{current_inference_id:null,current_inference_lease_expiration:null},transaction:n})}function A(e){const{environment:t,value:r,clientStore:a,spaceStore:o,userStore:s,config:u,additionalSteps:c,threadStore:l,threadId:p,threadParentPointer:d}=e,y=t.currentUser.id??(null==s?void 0:s.id);if(!y)throw new Error("No current user");const h=l?l.getTranscript():[],b=h.find((e=>"config"===e.type)),f=h.find((e=>"context"===e.type)),v=(0,m().Aqt)(r),k=[...b?[]:[{id:(0,g().ZP)(),type:"config",value:u}],...f?[]:[{id:(0,g().ZP)(),type:"context",value:{timezone:(0,i().r)(),userName:null==s?void 0:s.getName(),spaceName:o.getName(),currentDatetime:n().ou.now().toISO()}}],...c,...v&&v.length>0?[{id:(0,g().ZP)(),type:"user",value:v,userId:y}]:[]];if(!l)return void j({environment:t,clientStore:a,threadStore:void 0,threadCommitResult:void 0,createThreadArgs:{threadId:p,transcript:k,threadParentPointer:d}});const{serverCommitResult:x}=_().createAndCommit({userAction:"FullPageAI.handleSubmit",environment:t,canUndo:!0,perform:e=>{const r=l.getMessages()??[],n=P({environment:t,threadId:p,spaceStore:o,userId:y,transcript:k,transaction:e});T().sW({store:l,data:{messages:[...r,...n]},transaction:e})}});j({environment:t,clientStore:a,threadStore:l,threadCommitResult:x})}function P(e){const{environment:t,threadId:r,spaceStore:n,userId:a,transcript:o,transaction:i}=e;return o.map((e=>T().ae({environment:t,table:c().xu,value:{id:e.id.toString(),parent_id:r,parent_table:u().kL,space_id:n.id,step:e,created_by_id:a,created_by_table:l().KJ,created_time:Date.now()},transaction:i,inMemoryRecordCache:n.inMemoryRecordCache}).id))}function O(e){const{threadStore:t,stepIndex:r,transaction:n}=e;T().sW({store:t,data:{messages:t.getMessages().slice(0,r+1)},transaction:n})}function E(e){const{threadStore:t,stepIndex:r,transaction:n,newValue:a}=e,o=t.getStepStoreAt(r);o&&T().sW({store:o,data:{value:a},transaction:n})}async function j(e){var t,r;const{clientStore:n,environment:a,threadStore:i,createThreadArgs:p,threadCommitResult:d}=e,{model:m}=n.state,y=(null==i?void 0:i.getTranscript())??(null==p?void 0:p.transcript)??[];if(0===y.length)throw new Error("No transcript");const b=null===(t=I().default.state.currentSpaceStore)||void 0===t?void 0:t.id;if(!b)throw new Error("No space id");const k=(null==i?void 0:i.id)??(null==p?void 0:p.threadId);if(!k)throw new Error("No thread id");const{cachedInferences:N,annotationInferences:C}=(0,K().h)(n),q=new AbortController,M={};for(const s of N){if(!s.value.expected)throw new Error("No expected output for cached inference");if((0,o().sw)(s.value.expected))throw new Error("Merged response not supported");M[s.key]=s.value.expected}const S={};for(const o of C)o.value.input.annotation&&(S[o.key]=o.value.input.annotation);const D=(0,g().ZP)();n.setState({...n.state,loading:!0,inferences:[],temporarySteps:(null==p?void 0:p.transcript)??[],abortController:q,traceId:D}),n.state.stopInferencePromise&&(await n.state.stopInferencePromise,n.setState({...n.state,stopInferencePromise:void 0}));const A=Boolean(null==i||null===(r=i.getData())||void 0===r?void 0:r.title),P=(0,o().Lo)(y),O={traceId:D,spaceId:b,transcript:y,threadId:k,threadParentPointer:null==p?void 0:p.threadParentPointer,createThread:void 0===i,debugOverrides:{...n.state.debugOverrides,cachedInferences:M,annotationInferences:S,model:m,emitInferences:n.state.showDebug},generateTitle:!A};n.state.showDebug&&n.setState({...n.state,requestInfo:{request:O,response:void 0,memory:void 0}});try{P?await async function(e){var t;const{environment:r,abortController:n,request:a,threadCommitResult:o}=e;o&&await o;a.createThread&&a.threadId&&a.threadParentPointer&&await async function(e){const{environment:t,spaceStore:r,transcript:n,threadParentPointer:a,threadId:o}=e,{performResult:i,serverCommitResult:s}=_().createAndCommit({userAction:"inferenceTranscriptActions.createThread",environment:t,canUndo:!0,perform:e=>{$({environment:t,spaceStore:r,transcript:n,threadParentPointer:a,threadId:o,transaction:e})}});return await s,i}({environment:r,threadId:a.threadId,spaceStore:I().default.state.currentSpaceStore,transcript:a.transcript,threadParentPointer:a.threadParentPointer});const i=(0,w().Lj)(r,f,{...a,createThread:!1,transcript:[]});if(null===(t=a.debugOverrides)||void 0===t||!t.emitInferences){const e=await i.next();if(e.value.error)throw e.value.error;return}(async()=>{try{for await(const e of i)if(e.error)throw e.error}catch(e){if(F(n,e))return;throw e}})()}({environment:a,abortController:q,clientStore:n,request:O,threadCommitResult:d}):await async function(e){const{environment:t,abortController:r,clientStore:n,request:a}=e,o=await v().callStreamApi({eventName:"runInferenceTranscript",environment:t,data:a,abortSignal:r.signal,headers:(0,s().Bb)({spaceId:a.spaceId})});if("failed"===o.type)throw o.error;if(h().H1.is(o.data))for await(const i of o.data)R({request:a,clientStore:n,value:i})}({environment:a,abortController:q,clientStore:n,request:O})}catch(E){F(q,E)?function(e){const{environment:t,clientStore:r,threadId:n,spaceId:a}=e,{currentUserStore:o}=I().default.state;if(!o)throw new Error("No current user root store");_().createAndCommit({userAction:"inferenceTranscriptActions.handleAbort",environment:t,canUndo:!0,perform:e=>{for(const i of r.state.temporarySteps)T().ae({environment:t,table:c().xu,value:{id:i.id.toString(),parent_id:n,parent_table:u().kL,space_id:a,step:i,created_by_id:o.id,created_by_table:l().KJ,created_time:Date.now()},transaction:e,inMemoryRecordCache:o.inMemoryRecordCache})}})}({environment:a,clientStore:n,threadId:k,spaceId:b}):x().PV({message:E instanceof Error?E.message:"Unknown error"})}n.setState({...n.state,loading:!1,abortController:void 0})}function F(e,t){return t instanceof Error&&"AbortError"===t.name&&e.signal.aborted}function R(e){const{request:t,clientStore:r,value:n}=e;if("inference"===n.type){const e={type:"inference",key:(0,y().o_)(n.value.input),index:n.index,value:n.value},t=b().MR([...r.state.inferences,e],(e=>e.index));r.setState({...r.state,inferences:t})}else{const{temporarySteps:e}=r.state,a=(0,o().q3)(e,n);if(r.setState({...r.state,temporarySteps:a}),r.state.showDebug){const e={transcript:a};r.setState({...r.state,requestInfo:{request:t,response:e,memory:void 0}})}}}async function U(e){var t;const{environment:r,onResponse:n,data:a,userId:o,tracking:i,abortSignal:u,upsellFrom:c}=e,l=()=>{(0,q().y)(r,{upsell:{type:"product",product:"ai",limit:{type:"none"}},from:c})},p=M().Z.state;if(!1===(null==p?void 0:p.isEligible))return l(),{error:new(d().vU)};const m=await v().callStreamApi({eventName:"runInferenceTranscript",environment:r,data:a,userId:o,tracking:i,abortSignal:u,headers:(0,s().Bb)({spaceId:a.spaceId})});if("success"!==m.type)return x().x2(m),{error:m.error};const y=[];if(h().H1.is(m.data))for await(const s of m.data){if("error"===s.type)return(0,d().lX)(s.errorCode)?(l(),{error:new(d().vU)}):{error:new Error(s.message)};null==n||n(s),y.push(s)}const b=null===(t=I().default.state.currentSpaceStore)||void 0===t?void 0:t.id;return b&&(0,N().maybeUpdateAiEligibility)(r,b),{value:y}}async function L(e){const{environment:t,step:r}=e;let n;if("markdown-chat"===r.type||"fast-researcher-chat"===r.type||"search-chat"===r.type)n=r.value;else{if("workflow-inference"!==r.type)throw new Error("Unsupported step type");n=(0,a().Ms)(r.value).flatMap((e=>"text"===e.type?[e.content]:[])).join("")}const o=await k().F.clipboardActions.load();await o.copyString({environment:t,stringValue:n,copiedMessage:o.clipboardMessages.copiedQnAMessageToClipboard})}function Y(e){const{environment:t,threadStore:r,stepIndex:n,clientStore:a}=e,{serverCommitResult:o}=_().createAndCommit({userAction:"AIChatTranscript.RunFromStepButton.handleClick",environment:t,canUndo:!0,perform:e=>{O({threadStore:r,stepIndex:n,transaction:e})}});j({environment:t,threadStore:r,clientStore:a,threadCommitResult:o})}function H(e){const{transaction:t,threadStore:r,workflowData:n,environment:a,workflowStore:o}=e,{currentSpaceStore:i}=I().default.state;if(!i)throw new Error("No current space");const s=a.currentUser.id;if(!s)throw new Error("No current user");const c=o.getParentId();if(!c)throw new Error("Workflow must be parented to update");const l=((null==r?void 0:r.getTranscript())??[]).find((e=>"config"===e.type)),d={id:(0,g().ZP)(),type:"config",value:{type:"workflow",workflowBlockId:c}},m=[...l?[]:[d],{id:(0,g().ZP)(),type:"workflow",value:n,workflow_block_id:o.getParentId(),traceId:(0,g().ZP)(),tag:"user-edit",saved:!1,completed:!0}],y=(null==r?void 0:r.id)??(0,C().TS)({environment:a,table:u().kL,spaceId:i.id});if(!r)return $({environment:a,threadId:y,spaceStore:i,transcript:m,threadParentPointer:{table:p().An,id:o.id,spaceId:i.id},transaction:t}),y;const h=r.getMessages()??[],b=h.at(-1);if(b){const e=r.getStepStoreById(b),a=null==e?void 0:e.getValue();if(e&&"workflow"===(null==a?void 0:a.type)&&!a.saved)return T().sW({store:e,data:{value:n},transaction:t}),y}const f=P({environment:a,threadId:y,spaceStore:i,userId:s,transcript:m,transaction:t});return T().sW({store:r,data:{messages:[...h,...f]},transaction:t}),y}},666908:(e,t,r)=>{r.d(t,{Lo:()=>u,V8:()=>i,q3:()=>s,sw:()=>l,wq:()=>c});r(93383),r(670560),r(267602),r(653476),r(470928),r(749411),r(228244);var n=()=>r(513670),a=()=>r(696459),o=()=>r(833179);const i={id:"32983546-2835-4c6b-9101-25f10781415c",name:"inference-saved-examples"};function s(e,t){const r={};for(const n of e)"registered-tool-grouping"===n.type&&(r[n.toolCallId]=n);let i=[...e];if("config"===t.type||"user"===t.type||"error"===t.type||"context"===t.type||"workflow-error"===t.type||"title"===t.type||"retry"===t.type||"autocorrect"===t.type||"search-observation"===t.type||"researcher-next-steps"===t.type||"researcher-text-observation"===t.type||"debug-inference"===t.type||"search-queries"===t.type||"search-results"===t.type||"fast-researcher-plan"===t.type||"fast-researcher-search-results"===t.type||"memory-agent"===t.type||"summarize-transcript"===t.type||"summarize-transcript-response"===t.type||"workflow-run-investigation"===t.type||"workflow-runs"===t.type||"researcher-agent-group"===t.type)i.push({...t});else if("workflow-inference"===t.type)i=[...i.filter((e=>e.id!==t.id)),{...t}];else if("workflow-function-call-results"===t.type){const e=i.findLastIndex((e=>e.id===t.id));if(-1!==e&&"workflow-function-call-results"===i[e].type){const r=i[e];i[e]={...r,value:[...r.value,...t.value]}}else i.push({...t})}else if("markdown-chat"===t.type){const e=i.findLastIndex((e=>e.id===t.id));if(-1!==e&&"markdown-chat"===i[e].type){const r=i[e];i[e]={...r,value:`${r.value}${t.value}`}}else i.push({...t})}else if("search-chat"===t.type){const e=i.findLastIndex((e=>e.id===t.id));if(-1!==e&&"search-chat"===i[e].type){const r=i[e];i[e]={...r,value:`${r.value}${t.value}`}}else i.push({...t})}else if("fast-researcher-chat"===t.type){const e=i.findLastIndex((e=>e.id===t.id));if(-1!==e&&"fast-researcher-chat"===i[e].type){const r=i[e];i[e]={...r,value:`${r.value}${t.value}`}}else i.push({...t})}else if("workflow"===t.type){const e=i.filter((e=>"workflow"===e.type));i=[...i.filter((e=>"workflow"!==e.type)),{...t,progressSteps:[...e.flatMap((e=>e.progressSteps||[])),...t.progressSteps||[]]}]}else if("setup"===t.type)i=n().mN([...i,t].reverse(),(e=>e.id)).reverse();else if("researcher-report"===t.type){const e=i.findLastIndex((e=>e.id===t.id));if(-1!==e&&"researcher-report"===i[e].type){const r=i[e];i[e]={...r,value:`${r.value}${t.value}`,citationInfo:(0,o().ZO)(r.citationInfo,t.citationInfo)}}else i.push({...t})}else if("researcher-agent"===t.type){const e=i.findIndex((e=>e.id===t.id));-1!==e&&"researcher-agent"===i[e].type?i[e]={...i[e],value:Object.assign(i[e].value,t.value)}:i.push({...t})}else if("registered-tool-call"===t.type||"registered-tool-output"===t.type||"registered-tool-error"===t.type){let e=r[t.toolCallId];e||(e={id:t.toolCallId,type:"registered-tool-grouping",toolName:t.toolName,toolCallId:t.toolCallId,steps:[]},r[t.toolCallId]=e,i.push(e));const n={...t};e.steps.push(n)}else if("registered-tool-grouping"===t.type)r[t.toolCallId]||(r[t.toolCallId]=t,i.push({...t}));else if("setup-operations"===t.type){const e=i.findLastIndex((e=>e.id===t.id)),r=i[e];(null==r?void 0:r.type)===t.type?i[e]={...r,operations:[...r.operations,...t.operations]}:i.push({...t})}else(0,a().t1)(t);return i}function u(e){const t=e.find((e=>"config"===e.type)),r=e[e.length-1];return"researcher"===(null==t?void 0:t.value.type)&&!0===t.value.runInQueue||!("workflow"!==(null==t?void 0:t.value.type)||"workflow-inference"!==r.type||"workflowAgent9"!==r.inferenceType||!r.updateWorkflow)}const c="inferenceTranscript";function l(e){return"object"==typeof e&&null!==e&&"transcript"in e}},833179:(e,t,r)=>{r.d(t,{dy:()=>p,ZO:()=>c,FR:()=>s,jH:()=>u});r(670560),r(122556),r(582845),r(250570),r(533019),r(721473),r(788208),r(22624),r(267602),r(653476),r(470928),r(241792),r(228244);var n=()=>r(815292),a=()=>r(9369),o=()=>r(413880),i=()=>r(175882);function s(e){let t=1;return e.replace(/\[(.*?)\|(.*?)\]/g,((e,r,n)=>{const a=encodeURIComponent(r),o=encodeURIComponent(n),i=encodeURIComponent("|");return`[**[${t++}]**](#citation:${a}${i}${o})`}))}function u(e){return e.replace(/(\s)?\[\*\*\[\d+\]\*\*\]\(#citation:[^)]+\)/g,"")}function c(e,t){const r={stepCitations:{...e.stepCitations}};for(const[n,a]of Object.entries(t.stepCitations)){if(!r.stepCitations[n]){r.stepCitations[n]={claims:[...a.claims],artifacts:[...a.artifacts]};continue}const e=new Set(r.stepCitations[n].claims.map((e=>e.id)));for(const o of a.claims)e.has(o.id)||r.stepCitations[n].claims.push(o);const t=new Set(r.stepCitations[n].artifacts.map((e=>e.id)));for(const o of a.artifacts)t.has(o.id)||r.stepCitations[n].artifacts.push(o)}return r}const l={"slack-result":"slack","google-drive-result":"google-drive","helpdoc-result":"helpdoc","github-result":"github","webpage-result":"webpage","jira-result":"jira"};function p(e,t){const r=[],s=(0,n().P5)(e.value,!1,{parseNoneClosedTags:!0})[0];if("element"!==s.type)return r;for(const n of s.children){if("element"!==n.type)continue;let e;const s=t.mapCounterToKey((0,o().tI)(n.attributes.id));if("element"!==n.type||"page"!==n.tagName&&"block"!==n.tagName){if("element"===n.type&&("slack-result"===n.tagName||"github-result"===n.tagName||"google-drive-result"===n.tagName||"jira-result"===n.tagName||"webpage"===n.tagName||"helpdoc"===n.tagName)){var u;const t=a().Tc.parseAssistantHref(s.key),r="text"===(null===(u=n.children[0])||void 0===u?void 0:u.type)?n.children[0].value:"",o="slack-result"===n.tagName?n.attributes.channel:n.attributes.title;e={citationType:"universal_search",target:l[n.tagName],href:s.key,title:o,text:r,number:Number(n.attributes.id),...t}}}else{const r=t.mapCounterToKey((0,o().tI)(null==n?void 0:n.attributes.id));e={citationType:"notion",pageId:r.key,blockId:"block"===n.tagName?s.key:r.key,number:Number(n.attributes.id)}}r.push({id:n.attributes.id,artifactType:"text",content:(0,i().KT)(n),citationInfo:e})}return r}},9369:(e,t,r)=>{r.d(t,{LV:()=>y,Tc:()=>h,oU:()=>d});r(821057),r(670560),r(241792),r(398858),r(461318),r(33228);var n=r.n(r(467266)),a=()=>r(513670),o=()=>r(855741),i=()=>r(696459),s=()=>r(916673),u=()=>r(441010),c=()=>r(413880);function l(e){if(!(32===e.length&&/^[a-f0-9]*$/g.test(e)))return;return[e.substring(0,8),e.substring(8,12),e.substring(12,16),e.substring(16,20),e.substring(20,32)].join("-")}const p=/^\d+$/,d=(0,i().AO)((e=>p.test(e)?{true:e}:{false:e}));function m(e){try{const t=new URL(e).searchParams.get("url");if(!t)return;return{url:t}}catch(t){return}}class y extends Error{constructor(e){super(`Tried to use an ID that doesn't exist: ${e}`)}}class h{generateSerializedKey(e){return n()(e)}constructor(e){if(this.counter=0,this.keyToCounterMap=new Map,this.counterToKeyMap=new Map,this.mapCounterToKeyInModeOrThrow=(e,t,r)=>o().x.unwrap(this.mapCounterToKeyInMode(e,t,r)),this.mapCounterToKeyInMode=(e,t,r)=>h.mapCounterToKeyInMode(this,e,t,r),this.utilitiesForTests={removeKey:this.removeKey.bind(this),setCounterValueForKey:this.setCounterValueForKey.bind(this)},e){const t=[];for(const{key:n,counter:a}of e.keyMap)this.keyToCounterMap.set(this.generateSerializedKey(n),a),this.counterToKeyMap.set(a,n),t.push(parseInt(a));const r=a().Fp(t);this.counter="number"==typeof r?r+1:0}}serialize(){return{keyMap:Array.from(this.counterToKeyMap.entries()).map((e=>{let[t,r]=e;return{key:a().Xh(r),counter:t}}))}}inheritFrom(e){for(const[t,r]of e.keyToCounterMap.entries())this.keyToCounterMap.set(t,r);for(const[t,r]of e.counterToKeyMap.entries())this.counterToKeyMap.set(t,r)}mapKeyToCounter(e){const t=this.generateSerializedKey(e);if(!this.keyToCounterMap.has(t)){const r=this.counter.toString();this.keyToCounterMap.set(t,r),this.counterToKeyMap.set(r,e),this.counter++}return this.keyToCounterMap.get(t)}mapNodeKeyToCounter(e){if("block"===e.type){const t={...e},r=this.mapNodeAttributesKeyToCounter(e.attributes);t.attributes=r;const n=e.text.map((e=>this.mapNodeKeyToCounter(e)));t.text=n;const a=e.children.map((e=>{const r=this.mapNodeKeyToCounter(e);return r.parent=t,r}));t.children=a;const o={};for(const[e,u]of Object.entries(t.properties))o[e]=this.mapNodeKeyToCounter(u);t.properties=o;const i={};for(const[e,u]of Object.entries(t.schemas))i[e]=this.mapNodeKeyToCounter(u);t.schemas=i;const s=this.mapKeyToCounter({key:e.schemaId,type:"block"});return t.schemaId=s,t}if("property"===e.type||"schema"===e.type||"inline"===e.type){const t={...e};return t.attributes=this.mapNodeAttributesKeyToCounter(t.attributes),t.children=t.children.map((e=>this.mapNodeKeyToCounter(e))),t}if("instructions"===e.type){const t={...e};return t.children=t.children.map((e=>this.mapNodeKeyToCounter(e))),t}if("text"===e.type)return{...e};if("collection"===e.type){const t={...e,schemaId:this.mapKeyToCounter({type:"block",key:e.schemaId}),attributes:{...e.attributes,id:this.mapKeyToCounter({type:"collection",key:e.attributes.id})}},r=Object.fromEntries(Object.entries(t.properties).map((e=>{let[t,r]=e;return[t,this.mapNodeKeyToCounter(r)]})));t.properties=r;const n=Object.fromEntries(Object.entries(t.schemas).map((e=>{let[t,r]=e;return[t,this.mapNodeKeyToCounter(r)]})));return t.schemas=n,t}if("collectionView"===e.type)return{...e,schemaId:this.mapKeyToCounter({type:"block",key:e.schemaId}),attributes:{...e.attributes,id:this.mapKeyToCounter({type:"collection-view",key:e.attributes.id}),"database-id":this.mapKeyToCounter({type:"collection",key:e.attributes["database-id"]})}};if("slackMessages"===e.type){return{...e,attributes:{...e.attributes,id:this.mapKeyToCounter({type:"universal",key:e.attributes.id})}}}if("attachment"===e.type){return{...e,attributes:{...e.attributes,id:this.mapKeyToCounter({type:"attachment",key:e.attributes.id,attachmentType:e.attributes.attachmentType})}}}throw new Error(`Unknown node type ${e}`)}mapNodeAttributesKeyToCounter(e){if(!e)return e;const t={...e};for(const[n,a]of Object.entries(h.attributesToMap)){if(!a)continue;const e=t[n];if(e)if("href"===n){let a;const o=s().Qc(e),i=s().Nm({str:o.href,allowNoProtocol:!0});i&&(a=(0,r(526839).A5)({url:i,baseUrl:o.protocol?`${o.protocol}//${o.host}`:`https://${o.host??"www.notion.so"}`,publicDomainName:o.host??"www.notion.so"})),t[n]=a?this.mapKeyToCounter({type:"block",key:a}):e}else t[n]="person-id"===n?this.mapKeyToCounter({type:"person",key:e}):"database-id"===n?this.mapKeyToCounter({type:"collection",key:e}):this.mapKeyToCounter({type:"block",key:e})}return t}doesIdMapperContainMappedKey(e){return this.counterToKeyMap.has(e)}doesIdMapperContainKey(e){return this.keyToCounterMap.has(this.generateSerializedKey(e))}getIdForMappedKeyIfExists(e){const t=this.counterToKeyMap.get(e);return null==t?void 0:t.key}mapCounterToKey(e){const t=this.counterToKeyMap.get(e);if(!t)throw new y(e);return t}mapAssistantContextCounterToKey(e){const{"instructions-page-id":t,"current-page-id":r,"current-person-id":n,"current-background-page-id":a,...o}=e;return{...o,...e["instructions-page-id"]?{"instructions-page-id":this.mapCounterToKeyInModeOrThrow(e["instructions-page-id"],"block_counter")}:{},...e["current-page-id"]?{"current-page-id":this.mapCounterToKeyInModeOrThrow(e["current-page-id"],"block_counter")}:{},...e["current-background-page-id"]?{"current-background-page-id":this.mapCounterToKeyInModeOrThrow(e["current-background-page-id"],"block_counter")}:{},...e["current-thread-id"]?{"current-thread-id":this.mapCounterToKeyInModeOrThrow(e["current-thread-id"],"thread_counter")}:{},...e["current-person-id"]?{"current-person-id":this.mapCounterToKeyInModeOrThrow(e["current-person-id"],"person_counter")}:{}}}mapAssistantContextKeyToCounter(e){const{"instructions-page-id":t,"current-page-id":r,"current-person-id":n,"current-background-page-id":a,...o}=e;return{...o,...e["instructions-page-id"]?{"instructions-page-id":this.mapKeyToCounter({type:"block",key:e["instructions-page-id"]})}:{},...e["current-page-id"]?{"current-page-id":this.mapKeyToCounter({type:"block",key:e["current-page-id"]})}:{},...e["current-background-page-id"]?{"current-background-page-id":this.mapKeyToCounter({type:"block",key:e["current-background-page-id"]})}:{},...e["current-thread-id"]?{"current-thread-id":this.mapKeyToCounter({type:"slack-thread",key:e["current-thread-id"]})}:{},...e["current-person-id"]?{"current-person-id":this.mapKeyToCounter({type:"person",key:e["current-person-id"]})}:{}}}mapAssistantSelectionKeyToCounter(e){return"block"===e.type?{type:"block",blockIds:e.blockIds.map((e=>this.mapKeyToCounter({type:"block",key:e})))}:"text"===e.type?{type:"text",start:{...e.start,blockId:this.mapKeyToCounter({type:"block",key:e.start.blockId})},end:{...e.end,blockId:this.mapKeyToCounter({type:"block",key:e.end.blockId})}}:void(0,i().t1)(e)}static mapCounterToKeyInMode(e,t,r,n){if("block_counter"===r||"person_counter"===r||"thread_counter"===r||"collection_counter"===r||"collection_view_counter"===r||"query_database_result_counter"===r||"external_id_counter"===r||"attachment_id_counter"===r){const a=o().x.catchErrors((()=>e.mapCounterToKey(t)));if(o().x.isFail(a))return a;const s=a.value;let c;return"block_counter"===r?c="block":"person_counter"===r?c="person":"thread_counter"===r?c="slack-thread":"collection_counter"===r?c="collection":"collection_view_counter"===r?c="collection-view":"query_database_result_counter"===r?c="query-database-result":"external_id_counter"===r?c="universal":"attachment_id_counter"===r?c="attachment":(0,i().t1)(r),s.type!==c?{error:new(u()._N)({receivedIdType:s.type,expectedIdType:c,tagNameForErrorMessage:n,idValueForErrorMessage:t})}:{value:s.key}}if("href_counter"===r){const r=h.getMappedTypeFromCounterIfExists(t,e);return"query-database-result"===r?{error:new(u()._N)({receivedIdType:r,expectedIdType:"href",tagNameForErrorMessage:n,idValueForErrorMessage:t})}:{value:h.mapHrefCounterToUrl(e,t)}}(0,i().t1)(r)}getTypeKeyFromCounter(e){return h.getMappedTypeFromCounterIfExists(e,this)}static getMappedTypeFromCounterIfExists(e,t){let r;try{r=t.mapCounterToKey(e)}catch(n){if(n instanceof y)return;throw n}return r.type}static blockKeyToHref(e){return`/${e.key.split("/")[0].replaceAll("-","")}`}static blockIdToHref(e){return`/${e.split("/")[0].replaceAll("-","")}`}static parseAssistantHref(e){if(e===h.EMPTY_HREF)return{type:"citation_unsupported"};if(function(e){return e.startsWith("query_database_result_counter://")}(e)){const t=h.databaseQueryHrefToDatabaseQueryResultsId(e);if(t)return{type:"database_query_results",id:t}}else if(function(e){return e.startsWith("slack://")}(e)){const t=function(e){try{const t=new URL(e),r=t.searchParams.get("domain")||void 0,n=t.searchParams.get("base_url")||void 0,a=t.searchParams.get("channel_id"),o=t.searchParams.get("message_id"),i=t.searchParams.get("thread_ts")||void 0;if(!r&&!n||!a||!o)return;return{domain:r,baseUrl:n,channelId:a,messageId:o,threadTs:i}}catch(t){return}}(e);if(t)return{type:"slack",href:(0,c()._B)(e),...t}}else if(function(e){return e.startsWith("google-drive://")}(e)){const t=m(e);if(t)return{type:"google-drive",href:(0,c().JV)(e),...t}}else{if(function(e){return e.startsWith("webpage://")}(e))return{type:"webpage",href:(0,c().Wf)(e),...m(e)};if(function(e){return e.startsWith("helpdoc://")&&!e.includes("%23")}(e)){const t=m(e);if(t)return{type:"helpdoc",href:(0,c().Lv)(e),...t}}else if(function(e){return e.startsWith("helpdoc://")&&e.includes("%23")}(e)){const t=m(e);if(t){const r=(0,c().Lv)(e.split("%23")[0]);return{type:"helpdoc-section",href:(0,c().Yi)(e),parentPageHref:r,...t}}}else if(function(e){return e.startsWith("github://")}(e)){const t=m(e);if(t)return{type:"github",href:(0,c().RI)(e),...t}}else if(function(e){return e.startsWith("jira://")}(e)){const t=m(e);if(t)return{type:"jira",href:(0,c().yV)(e),...t}}else{const t=h.blockHrefToAssistantBlockId(e);if(t)return{type:"block",blockId:t}}}}static databaseQueryHrefToDatabaseQueryResultsId(e){var t;const r=null===(t=e.match(/^query_database_result_counter:\/\/(.+)$/))||void 0===t?void 0:t[1];return r&&l(r)}static blockHrefToAssistantBlockId(e){var t;const r=null===(t=e.match(/\/(.+)/))||void 0===t?void 0:t[1];return r?l(r):void 0}static mapHrefCounterToUrl(e,t){let r;try{r=e.mapCounterToKey(t)}catch(n){if(n instanceof y)return t;throw n}if("block"===r.type)return h.blockKeyToHref(r);if("url"===r.type||"slack-message"===r.type||"slack-thread"===r.type||"webpage"===r.type||"helpdoc"===r.type||"helpdoc-section"===r.type||"google-drive"===r.type||"github"===r.type||"jira"===r.type)return r.key;if("collection"===r.type||"collection-view"===r.type||"person"===r.type)return h.EMPTY_HREF;if("query-database-result"===r.type||"skill"===r.type)throw new Error(`Invalid URL type: ${r.type}`);return"universal"===r.type||"attachment"===r.type?r.key:void(0,i().t1)(r)}removeKey(e){const t=this.generateSerializedKey(e),r=this.keyToCounterMap.get(t);if(r)return this.keyToCounterMap.delete(t),this.counterToKeyMap.delete(r),r}setCounterValueForKey(e,t){const r=this.generateSerializedKey(e);this.keyToCounterMap.set(r,t),this.counterToKeyMap.set(t,e)}}h.attributesToMap={id:!0,"page-id":!0,"database-id":!0,"person-id":!0,"person-name":!1,href:!0,category:!1,option:!1,format:!1,number:!1,date:!1,time:!1,"start-date":!1,"start-time":!1,"end-date":!1,"end-time":!1,"synced-property-name":!1,"synced-block-id":!0,"external-id":!0,index:!1,title:!1,icon_url:!1,description:!1,name:!1,equation:!1},h.EMPTY_HREF="#"},441010:(e,t,r)=>{r.d(t,{B9:()=>p,DY:()=>h,Db:()=>T,Dt:()=>l,EH:()=>q,EO:()=>v,FI:()=>s,Ii:()=>_,JB:()=>S,JZ:()=>i,MX:()=>a,O7:()=>w,OX:()=>f,WH:()=>m,XV:()=>o,_N:()=>y,d4:()=>c,dO:()=>K,eL:()=>u,en:()=>I,fr:()=>b,kj:()=>g,ll:()=>$,lm:()=>M,qf:()=>x,uY:()=>N,uk:()=>k,vQ:()=>d,wh:()=>C});r(821057),r(241792);var n=()=>r(696459);class a extends Error{constructor(e,t,r){super(t),this.type=e,this.cause=r}getMetadata(){}}class o extends a{}class i extends o{constructor(e){let t=1===e.attributeNames.length?`Unexpected attribute for <${e.tagName}> tag: ${e.attributeNames[0]}`:`Unexpected attributes for <${e.tagName}> tag: ${e.attributeNames.join(", ")}`;e.attributeNames.includes("key")&&(t+="\n\nThe key attribute is not needed. You should omit it."),super("unexpected_attributes",t)}}class s extends o{constructor(e){super("missing_attribute",`The <${e.tagName}> tag is missing a ${e.attributeName} attribute. It should be specified as <${e.tagName} ${e.attributeName}="...">`)}}class u extends o{constructor(e){super("bad_attribute",`Attempted to set attribute ${e.attributeName} on a <${e.tagName}> tag to a value that is not allowed: ${e.receivedValue}`)}}class c extends o{constructor(e){const{tagName:t,unexpectedNode:r}=e;let n;n=r?"text"===r.type?`Plain text, whitespace, or newlines are not allowed inside a <${t}> tag. Make sure not to include any extra whitespace or newlines in your XML.`:`A <${r.tagName}> tag is not allowed inside a <${t}> tag`:`Encountered an invalid child inside a <${t}> tag.`,"set-title"===t||"set-property"===t?n+=`\nOnly inline elements and text are allowed inside <${t}>`:"insert-before"===t||"insert-after"===t||"insert-inside"===t||"chat"===t?(n+=`\nOnly block elements are allowed inside <${t}>`,"chat"===t&&(n+="\nWhen using <chat>, remember to wrap text in <text> tags.")):"create"===t&&(n+="\nWhen using <create>, remember to wrap in a <page> tag."),super("disallowed_child",n),this.tagName=void 0,this.unexpectedNode=void 0,this.tagName=t,this.unexpectedNode=r}}class l extends o{constructor(e){const{tagName:t,unexpectedNode:r,conditionName:n,cause:a}=e;super("disallowed_child_in_condition",r?"text"===r.type?`Plain text, whitespace, or newlines are not allowed inside a <${t}> tag with "${n}" condition`:`A <${r.tagName}> tag is not allowed inside a <${t}> tag with "${n}" condition`:`Encountered an invalid child inside a <${t}> tag with "${n}" condition`),this.cause=void 0,this.cause=a}}class p extends o{constructor(e){super("expected_tag_name",`Expected a <${e}> tag`)}}class d extends o{constructor(e){let t;(0,n().$K)(e.unexpectedNode)?"text"===e.unexpectedNode.type?t=`Text is not supported as a child for a ${e.nodeType} node`:"element"===e.unexpectedNode.type?t=`Unsupported ${e.nodeType} tag name: ${e.unexpectedNode.tagName}`:(0,n().t1)(e.unexpectedNode):t=`Unexpected value for a ${e.nodeType} node`,super("unsupported_node",t)}}class m extends o{constructor(e,t){super("unmapped_id",`Expected counter ID for attribute ${e}, instead received ${t}`)}}class y extends o{constructor(e){const{expectedIdType:t,receivedIdType:r,tagNameForErrorMessage:n,idValueForErrorMessage:a}=e;super("unexpected_id_type",n?`Expected ID ${a} in <${n}> to be of type '${t}', instead received ID of type '${r}'`:`Expected ID ${a} to be of type '${t}', instead received ID of type '${r}'`)}}class h extends o{constructor(e){super("out_of_order_node",`Encountered a ${e.foundNodeType} after a ${e.incorrectlyAfterType}. You should ensure that any ${e.foundNodeType}s come before ${e.incorrectlyAfterType}s.`)}}class b extends o{constructor(){super("table_row_property_name","Inside tr, the property-text name attribute must be a string which is an integer counter, starting from 1.")}}class g extends o{constructor(){super("synced_block_invalid_children","Cannot include content when writing a <synced-block-reference> tag")}}class f extends o{constructor(){super("must_provide_id","Block node is missing an id attribute")}}class v extends o{constructor(){super("cannot_provide_id","When creating new blocks, do not provide an id attribute.")}}class k extends o{constructor(){super("must_provide_unknown_block_id","When referencing unknown blocks, you must provide an id.")}}class x extends o{constructor(){super("cannot_append_to_multiple_properties","Cannot append to multiple properties. Use multiple calls to <insert-inside> instead.")}}class w extends o{constructor(){super("cannot_remove_from_multiple_properties","Cannot remove from multiple properties. Use multiple calls to <delete> instead.")}}class T extends o{constructor(){super("move_disallowed","A <move> tag is not allowed in this context")}}class _ extends o{constructor(){super("set_attribute_without_key","<set-attribute> is missing an attribute to set")}}class N extends o{constructor(e){super("invalid_query_condition",`<${e.tagName}> condition operator must be ${e.allowedOperators.map((e=>`"${e}"`)).join(" or ")}, not "${e.inputCondition}"`)}}class C extends o{constructor(e){super("children_required",`<${e.tagName}> must have children`)}}class I extends o{constructor(e){super("only_one_child_allowed",`Only one ${e} element is allowed`)}}class q extends o{constructor(e){super("unknown_api",`Unexpected API: ${e}. Make sure to use only the supported XML APIs, and ensure you are using this API in the right context.`)}}class M extends a{constructor(e,t){super("load_page_as_xml_failed",t),this.pageId=e}getMetadata(){return{pageId:this.pageId}}}class K extends a{constructor(e,t){super("load_database_as_xml_failed",t),this.databaseId=e}getMetadata(){return{databaseId:this.databaseId}}}class S extends a{constructor(){super("illegal_replace_page",'When calling <replace> on a page, you must provide a <page> tag as the single child, like this: <replace start="..." end="..."><page>...</page></replace>.')}}class $ extends a{constructor(){super("out_of_order_replace","When calling <replace>, the start of the range must be AFTER the end of the range.")}}},413880:(e,t,r)=>{r.d(t,{B5:()=>p,CC:()=>k,JV:()=>P,Lv:()=>E,RI:()=>O,S5:()=>K,ST:()=>Y,Se:()=>_,WC:()=>h,Wf:()=>F,X_:()=>H,Yi:()=>j,ZK:()=>m,_B:()=>D,c8:()=>g,dn:()=>u,eT:()=>s,hs:()=>R,mI:()=>L,ou:()=>U,pX:()=>I,sj:()=>M,t:()=>d,tI:()=>S,v:()=>q,x:()=>W,xD:()=>$,yD:()=>c,yV:()=>A,zh:()=>l});r(241792);var n=r.n(r(467266)),a=()=>r(342792),o=()=>r(696459),i=()=>r(956057);(0,o().AO)((e=>"element"===e.type?{true:e}:{false:e}));const s={default:"default",gray:"gray",brown:"brown",orange:"orange",yellow:"yellow",teal:"green",blue:"blue",purple:"purple",pink:"pink",red:"red",default_background:"default-background",gray_background:"gray-background",brown_background:"brown-background",orange_background:"orange-background",yellow_background:"yellow-background",teal_background:"green-background",blue_background:"blue-background",purple_background:"purple-background",pink_background:"pink-background",red_background:"red-background"},u=Object.fromEntries(Object.entries(s).map((e=>{let[t,r]=e;return[r,t]}))),c=Object.values(s),l=["mention-page","mention-database","mention-person","mention-assistant","mention-date","mention-datetime","mention-date-range","mention-datetime-range","mention-link"],p=["b","i","code","s","u","a","h","e",...l],d={b:{attributes:{},inline:p,text:!0,isToken:!1},i:{attributes:{},inline:p,text:!0,isToken:!1},code:{attributes:{},inline:p,text:!0,isToken:!1},s:{attributes:{},inline:p,text:!0,isToken:!1},u:{attributes:{},inline:p,text:!0,isToken:!1},a:{attributes:{href:{required:!0,values:!0,description:"link URL. Do not link to any URLs that are not already in the current context.",mappingMode:"href_counter"},type:{required:!1,values:r(48826).Y,description:"universal source type"},"external-id":{required:!1,values:!0,description:"ID for loadable external resource",mappingMode:"external_id_counter"}},inline:p,text:!0,isToken:!1},h:{attributes:{color:{required:!0,values:c,description:"text color"}},inline:p,text:!0,isToken:!1},e:{attributes:{equation:{required:!0,values:!0,description:"LaTeX equation string"}},inline:[],text:!0,isToken:!0},"mention-page":{attributes:{"page-id":{required:!0,values:!0,description:"ID of page",mappingMode:"block_counter"}},inline:[],text:!0,isToken:!0},"mention-link":{attributes:{href:{required:!0,values:!0,description:"link URL. Do not link to any URLs that are not already in the current context."},title:{required:!1,values:!0,description:"Linked page title"},icon_url:{required:!1,values:!0,description:"Favicon. Do not edit this field."},description:{required:!1,values:!0,description:"Linked page description. Do not edit this field."}},inline:[],text:!0,isToken:!0},"mention-database":{attributes:{"database-id":{required:!0,values:!0,description:"ID of database",mappingMode:"collection_counter"}},inline:[],text:!0,isToken:!0},"mention-person":{attributes:{"person-id":{required:!0,values:!0,description:"ID of person",mappingMode:"person_counter"},"person-name":{required:!1,values:!0,description:"Name of person"}},inline:[],text:!0,isToken:!0},"find-person":{attributes:{name:{required:!0,values:!0,description:"Name of person"}},inline:[],text:!0,isToken:!0},"mention-assistant":{attributes:{},inline:[],text:!0,isToken:!0},"mention-date":{attributes:{date:{required:!0,values:!0,description:"Date in ISO 8601 (YYYY-MM-DD) format"}},inline:[],text:!1,isToken:!1},"mention-datetime":{attributes:{date:{required:!0,values:!0,description:"Date in ISO 8601 (YYYY-MM-DD) format"},time:{required:!0,values:!0,description:"Time in ISO 8601 (HH:MM) format"}},inline:[],text:!1,isToken:!1},"mention-date-range":{attributes:{"start-date":{required:!0,values:!0,description:"Start date in ISO 8601 (YYYY-MM-DD) format"},"end-date":{required:!0,values:!0,description:"End date in ISO 8601 (YYYY-MM-DD) format"}},inline:[],text:!1,isToken:!1},"mention-datetime-range":{attributes:{"start-date":{required:!0,values:!0,description:"Start date in ISO 8601 (YYYY-MM-DD) format"},"end-date":{required:!0,values:!0,description:"End date in ISO 8601 (YYYY-MM-DD) format"},"start-time":{required:!0,values:!0,description:"Start time in ISO 8601 (HH:MM) format"},"end-time":{required:!0,values:!0,description:"End time in ISO 8601 (HH:MM) format"}},inline:[],text:!1,isToken:!1},option:{attributes:{option:{values:!0,description:"Option name",required:!0}},inline:[],text:!1,isToken:!1},"option-category":{attributes:{category:{values:!0,description:"Status category",required:!0}},inline:[],text:!1,isToken:!1},"schema-option":{attributes:{option:{values:!0,description:"Option name",required:!0}},inline:[],text:!1,isToken:!1},"schema-option-category":{attributes:{category:{values:!0,description:"Status category",required:!0}},inline:["schema-option"],text:!1,isToken:!1}},m={"property-title":{text:!0,inline:l,attributes:{}},"property-text":{text:!0,inline:p,attributes:{}},"property-url":{text:!0,inline:[],attributes:{}},"property-email":{text:!0,inline:[],attributes:{}},"property-phone-number":{text:!0,inline:[],attributes:{}},"property-person":{text:!1,inline:["mention-person","find-person"],attributes:{}},"property-date":{text:!1,inline:["mention-date","mention-date-range","mention-datetime","mention-datetime-range"],attributes:{}},"property-created-time":{text:!1,inline:["mention-date","mention-datetime"],attributes:{}},"property-last-edited-time":{text:!1,inline:["mention-date","mention-datetime"],attributes:{}},"property-created-by":{text:!1,inline:["mention-person"],attributes:{}},"property-last-edited-by":{text:!1,inline:["mention-person"],attributes:{}},"property-checkbox":{text:!1,inline:[],attributes:{checked:{values:["true","false"],description:'checked state, either "true" or "false"',required:!0}}},"property-select":{text:!1,inline:["option"],attributes:{}},"property-multi-select":{text:!1,inline:["option"],attributes:{}},"property-relation":{text:!1,inline:["mention-page"],attributes:{"database-id":{values:!0,description:"The database ID the relation points to",required:!1,mappingMode:"collection_counter"}}},"property-status":{text:!1,inline:["option"],attributes:{}},"property-number":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!1}}}},y=(0,o().Yd)(m),h={"schema-property-title":{propertyTagName:"property-title",inline:[],attributes:{}},"schema-property-text":{propertyTagName:"property-text",inline:[],attributes:{}},"schema-property-url":{propertyTagName:"property-url",inline:[],attributes:{}},"schema-property-email":{propertyTagName:"property-email",inline:[],attributes:{}},"schema-property-phone-number":{propertyTagName:"property-phone-number",inline:[],attributes:{}},"schema-property-person":{propertyTagName:"property-person",inline:[],attributes:{limit:{values:["1","Infinity"],description:"The number of options that can be added",required:!0}}},"schema-property-date":{propertyTagName:"property-date",inline:[],attributes:{}},"schema-property-created-time":{propertyTagName:"property-created-time",inline:[],attributes:{}},"schema-property-last-edited-time":{propertyTagName:"property-last-edited-time",inline:[],attributes:{}},"schema-property-created-by":{propertyTagName:"property-created-by",inline:[],attributes:{}},"schema-property-last-edited-by":{propertyTagName:"property-last-edited-by",inline:[],attributes:{}},"schema-property-checkbox":{propertyTagName:"property-checkbox",inline:[],attributes:{}},"schema-property-select":{propertyTagName:"property-select",inline:["schema-option"],attributes:{}},"schema-property-multi-select":{propertyTagName:"property-multi-select",inline:["schema-option"],attributes:{}},"schema-property-relation":{propertyTagName:"property-relation",inline:["mention-page"],attributes:{limit:{values:["1","Infinity"],description:"The number of options that can be added",required:!0},"database-id":{values:!0,description:"The database ID the relation points to",required:!0,mappingMode:"collection_counter"},"synced-property-name":{required:!1,values:!0,description:"The symmetric relation property name in the database this relation points to"}}},"schema-property-status":{propertyTagName:"property-status",inline:["schema-option-category"],attributes:{}},"schema-property-number":{propertyTagName:"property-number",inline:[],attributes:{format:{values:!0,description:"Number format",required:!1}}}},b={is:{text:!1,inline:["mention-date"],attributes:{}},">":{text:!1,inline:["mention-date"],attributes:{}},"<":{text:!1,inline:["mention-date"],attributes:{}},"≥":{text:!1,inline:["mention-date"],attributes:{}},"≤":{text:!1,inline:["mention-date"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},g={"property-title":{is:{text:!0,inline:[],attributes:{}},contains:{text:!0,inline:[],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-text":{is:{text:!0,inline:[],attributes:{}},contains:{text:!0,inline:[],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-url":{is:{text:!0,inline:[],attributes:{}},contains:{text:!0,inline:[],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-email":{is:{text:!0,inline:[],attributes:{}},contains:{text:!0,inline:[],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-phone-number":{is:{text:!0,inline:[],attributes:{}},contains:{text:!0,inline:[],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-person":{contains:{text:!1,inline:["mention-person","find-person"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-date":b,"property-created-time":b,"property-last-edited-time":b,"property-created-by":{contains:{text:!1,inline:["mention-person"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-last-edited-by":{contains:{text:!1,inline:["mention-person"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-checkbox":{is:{text:!1,inline:[],attributes:{checked:{values:["true","false"],description:'checked state, either "true" or "false"',required:!0}}}},"property-select":{is:{text:!1,inline:["option"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-multi-select":{contains:{text:!1,inline:["option"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-relation":{contains:{text:!1,inline:["mention-page"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-status":{is:{text:!1,inline:["option","option-category"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-number":{is:{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!0}}},">":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!0}}},"<":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!0}}},"≥":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!0}}},"≤":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!0}}},"is empty":{text:!1,inline:[],attributes:{}}}},f=["Count all"],v=["Count values","Count unique values","Count empty","Count not empty","Percent empty","Percent not empty","Show unique values"],k={"Count all":"count","Count values":"count_values","Count unique values":"unique","Count empty":"empty","Count not empty":"not_empty","Percent empty":"percent_empty","Percent not empty":"percent_not_empty","Show unique values":"show_unique","Count checked":"checked","Count unchecked":"unchecked","Percent checked":"percent_checked","Percent unchecked":"percent_unchecked","Count per group":"count_per_group","Percent per group":"percent_per_group",Sum:"sum",Average:"average",Median:"median",Min:"min",Max:"max",Range:"range","Earliest date":"earliest_date","Latest date":"latest_date","Date range":"date_range"},x={basic:[...f,...v],date:[...f,...v,"Earliest date","Latest date","Date range"],status:[...f,...v,"Count per group","Percent per group"],number:[...f,...v,"Sum","Average","Median","Min","Max","Range"],checkbox:[...f,"Count checked","Count unchecked","Percent checked","Percent unchecked"]};function w(e){return`the name of the ${e} property being aggregated`}function T(e){return`the method of aggregation for the ${e} property`}const _={"aggregation-property-title":{attributes:{name:{required:!0,values:!0,description:w("title")},aggregation:{values:x.basic,required:!0,description:T("title")}}},"aggregation-property-text":{attributes:{name:{required:!0,values:!0,description:w("text")},aggregation:{values:x.basic,required:!0,description:T("text")}}},"aggregation-property-url":{attributes:{name:{required:!0,values:!0,description:w("url")},aggregation:{values:x.basic,required:!0,description:T("url")}}},"aggregation-property-email":{attributes:{name:{required:!0,values:!0,description:w("email")},aggregation:{values:x.basic,required:!0,description:T("email")}}},"aggregation-property-phone-number":{attributes:{name:{required:!0,values:!0,description:w("phone_number")},aggregation:{values:x.basic,required:!0,description:T("phone_number")}}},"aggregation-property-date":{attributes:{name:{values:!0,required:!0,description:w("date")},aggregation:{values:x.date,required:!0,description:T("date")}}},"aggregation-property-created-time":{attributes:{name:{values:!0,required:!0,description:w("created-time")},aggregation:{values:x.date,required:!0,description:T("created-time")}}},"aggregation-property-last-edited-time":{attributes:{name:{values:!0,required:!0,description:w("last-edited-time")},aggregation:{values:x.date,required:!0,description:T("last-edited-time")}}},"aggregation-property-person":{attributes:{name:{values:!0,required:!0,description:w("person")},aggregation:{values:x.basic,required:!0,description:T("person")}}},"aggregation-property-created-by":{attributes:{name:{values:!0,required:!0,description:w("created-by")},aggregation:{values:x.basic,required:!0,description:T("created-by")}}},"aggregation-property-last-edited-by":{attributes:{name:{values:!0,required:!0,description:w("last-edited-by")},aggregation:{values:x.basic,required:!0,description:T("last-edited-by")}}},"aggregation-property-checkbox":{attributes:{name:{values:!0,required:!0,description:w("checkbox")},aggregation:{values:x.checkbox,required:!0,description:T("checkbox")}}},"aggregation-property-select":{attributes:{name:{values:!0,required:!0,description:w("select")},aggregation:{values:x.basic,required:!0,description:T("select")}}},"aggregation-property-multi-select":{attributes:{name:{values:!0,required:!0,description:w("multi-select")},aggregation:{values:x.basic,required:!0,description:T("multi-select")}}},"aggregation-property-relation":{attributes:{name:{values:!0,required:!0,description:w("relation")},aggregation:{values:x.basic,required:!0,description:T("relation")}}},"aggregation-property-number":{attributes:{name:{values:!0,required:!0,description:w("number")},aggregation:{values:x.number,required:!0,description:T("number")}}},"aggregation-property-status":{attributes:{name:{values:!0,required:!0,description:w("status")},aggregation:{values:x.status,required:!0,description:T("status")},group:{values:!0,required:!0,description:"then name of the status group being aggregated when aggregation is 'Count per group' or 'Percent per group'. For other aggregations, just provide any group name."}}}},N=["hr","h1","h2","h3","database","math-block","code-block","child-page","link-page","child-database","link-database","database-views","text","page","synced-block","synced-block-reference","uli","oli","toggle","quote","callout","todo","columns","table","unknown-block"],C={required:!1,values:c,description:"color for the block"},I={hr:{title:!1,content:[],attributes:{},properties:[],schemas:[]},h1:{title:!0,content:[],attributes:{color:C},properties:[],schemas:[]},h2:{title:!0,content:[],attributes:{color:C},properties:[],schemas:[]},h3:{title:!0,content:[],attributes:{color:C},properties:[],schemas:[]},database:{title:!1,content:[],attributes:{},properties:["property-title"],schemas:y},"math-block":{title:!0,content:[],attributes:{},properties:[],schemas:[]},"code-block":{title:!0,content:[],attributes:{language:{required:!1,values:r(716703).A$,description:"language of code"}},properties:[],schemas:[]},"child-page":{title:!1,content:[],attributes:{"page-id":{required:!0,values:!0,description:"ID of page, to be used in <load>",mappingMode:"block_counter"},"database-id":{required:!1,values:!0,description:"The ID of the database this page is within, if there is one",mappingMode:"collection_counter"},"has-content":{required:!1,values:["true","false"],description:'"true" if the page has content, "false" otherwise'}},properties:y,schemas:[]},"link-page":{title:!1,content:[],attributes:{"page-id":{required:!0,values:!0,description:"ID of page, to be used in <load>",mappingMode:"block_counter"},"database-id":{required:!1,values:!0,description:"The ID of the database this page is within, if there is one",mappingMode:"collection_counter"}},properties:y,schemas:[]},"child-database":{title:!1,content:[],attributes:{"database-id":{required:!0,values:!0,description:"ID of database. Make sure to use the value of this attribute as the id in query-database.",mappingMode:"block_counter"}},properties:["property-title"],schemas:y},"database-views":{title:!1,content:[],attributes:{},properties:["property-title"],schemas:y},"link-database":{title:!1,content:[],attributes:{"database-id":{required:!0,values:!0,description:"ID of database",mappingMode:"collection_counter"}},properties:["property-title"],schemas:y},text:{title:!0,content:N,attributes:{color:C},properties:[],schemas:[]},page:{title:!1,content:N,attributes:{"database-id":{required:!1,values:!0,description:"ID of the database this page belongs to. Use this to look up the schema for the page",mappingMode:"collection_counter"},"page-font":{required:!1,values:["default","serif","mono"],description:"Font used for the page"},"page-width":{required:!1,values:["default","full-width"],description:"Width of the page"},"page-font-size":{required:!1,values:["default","small"],description:"Font size for the page"}},properties:y,schemas:[]},uli:{title:!0,content:N,attributes:{color:C},properties:[],schemas:[]},oli:{title:!0,content:N,attributes:{color:C,index:{required:!1,values:!0,description:"Specify a custom index for the list item"}},properties:[],schemas:[]},toggle:{title:!0,content:N,attributes:{color:C,size:{required:!1,values:["h1","h2","h3"],description:"size of the toggle header, if the toggle is a header"}},properties:[],schemas:[]},quote:{title:!0,content:N,attributes:{color:C},properties:[],schemas:[]},todo:{title:!0,content:N,attributes:{checked:{required:!0,values:["true","false"],description:'checked state, either "true" or "false"'},color:C},properties:[],schemas:[]},callout:{title:!0,content:N,attributes:{color:C},properties:[],schemas:[]},"synced-block":{title:!1,content:N,attributes:{},properties:[],schemas:[]},"synced-block-reference":{title:!1,content:N,attributes:{"synced-block-id":{required:!0,values:!0,description:"The ID of the <synced-block> node that this references",mappingMode:"block_counter"}},properties:[],schemas:[]},columns:{title:!1,content:["column"],attributes:{},properties:[],schemas:[]},column:{title:!1,content:N,attributes:{},properties:[],schemas:[]},table:{title:!1,content:["tr"],attributes:{"header-row":{required:!1,values:["true","false"],description:'whether first <tr> is row header, either "true" or "false"'},"header-column":{required:!1,values:["true","false"],description:'whether first <td> in every <tr> is column header, either "true" or "false"'}},properties:[],schemas:["property-text"]},tr:{title:!1,content:[],attributes:{},properties:["property-text"],schemas:[]},"ai-block":{title:!0,content:N,attributes:{},properties:["property-text"],schemas:[]},transcript:{title:!0,content:N,attributes:{},properties:[],schemas:[]},"unknown-block":{title:!0,content:N,attributes:{type:{required:!1,values:Object.values(r(156642).Ti),description:"the type of the unknown block"}},properties:[],schemas:[]}},q=Object.freeze((0,o().Yd)({text:!0,toggle:!0,quote:!0,callout:!0,uli:!0,oli:!0,todo:!0,h1:!0,h2:!0,h3:!0}));function M(e){return e}function K(e){return e}function S(e){return e}function $(e){return e}function D(e){return e}function A(e){return e}function P(e){return e}function O(e){return e}function E(e){return e}function j(e){return e}function F(e){return e}function R(e){return e}function U(){return i().Il()}function L(e){return(0,a().Ul)(n()(e))}const Y=(0,o().AO)((e=>"collectionView"===e.type?{true:e}:{false:e})),H="search-notion-help",W=(0,o().AO)((e=>"synced-block-reference"===e||"ai-block"===e||"database-views"===e||"transcript"===e?{true:e}:{false:e}))},673571:(e,t,r)=>{function n(e){return"text"===e.type&&!e.value.trim()}r.d(t,{Z:()=>n})},175882:(e,t,r)=>{r.d(t,{He:()=>m,KT:()=>d,dF:()=>i,p1:()=>p,vw:()=>s});r(821057),r(670560),r(267602),r(749411),r(30005),r(241792);var n=()=>r(513670),a=()=>r(696459),o=()=>r(413880);const i="\x3c!--<selection>--\x3e",s="\x3c!--</selection>--\x3e";function u(e){const{node:t,selection:r,path:p,onlyAllowPropertyTypes:d,namespace:m}=e;if(p.includes(t))throw new Error("Circular reference detected!");const y=[...p,t],h=[];if("text"===t.type)for(const n of t.value)h.push(n);else{let e="";e+=`<${t.tagName}`;for(const[r,n]of Object.entries(t.attributes||{}))void 0!==n&&(e+=` ${r}="${n}"`);const p=`</${t.tagName}>`;if("block"===t.type){const o="block"===t.type&&"block"===(null==r?void 0:r.type)&&r.blockIds[0]===t.attributes.id,b="block"===t.type&&"block"===(null==r?void 0:r.type)&&r.blockIds[r.blockIds.length-1]===t.attributes.id,g="block"===t.type&&"text"===(null==r?void 0:r.type)&&(r.start.blockId===t.attributes.id||r.end.blockId===t.attributes.id);o&&h.push(i);if(0===t.text.length&&0===Object.values(t.properties).length&&0===Object.values(t.schemas).length&&0===t.children.length&&!g)h.push(`${e}/>`);else{h.push(`${e}>`);const o=[];if(t.text)for(const e of t.text){const t=u({node:e,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m});for(const e of t)o.push(e)}let b,g;"text"===(null==r?void 0:r.type)&&r.start.blockId===t.attributes.id&&(b=r.start.index),"text"===(null==r?void 0:r.type)&&r.end.blockId===t.attributes.id&&(g=r.end.index);for(let e=0;e<o.length;e++){const t=o[e];let n="";(0,a().$K)(r)&&e===b&&(n+=i),(0,a().$K)(r)&&e===g&&(n+=s),n+=t,h.push(n)}if((0,a().$K)(r)&&b===o.length&&h.push(i),(0,a().$K)(r)&&g===o.length&&h.push(s),"end_to_end"!==m&&"tr"===t.tagName){n().MR(Object.values(t.properties),(e=>Number(e.attributes.name))).forEach(((e,n)=>{const a=t.parent&&"table"===t.parent.tagName?t.parent:void 0,o=a&&a.attributes["header-row"],i=a&&"table"===a.tagName&&a.attributes["header-column"],s=a&&0===a.children.indexOf(t),c=o&&0===n||i&&s?"th":"td";h.push(`<${c}>`),h.push(...e.children.flatMap((e=>u({node:e,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m})))),h.push(`</${c}>`)}))}else{const e=function(e){const{tagName:t,properties:r}=e;if("tr"===t)return r;const n=[];for(const a of r){const e=l(a),r="page"===t;("property-title"===a.tagName||!e||r&&n.length<c)&&n.push(a)}return n}({tagName:t.tagName,properties:Object.values(t.properties)});for(const t of e)d&&!d.includes(t.tagName)||h.push(...u({node:t,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m}))}for(const e of Object.values(t.schemas))h.push(...u({node:e,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m}));if(t.children)for(const e of t.children){const t=u({node:e,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m});for(const e of t)h.push(e)}h.push(p)}(0,a().$K)(r)&&b&&h.push(s)}else if("collection"===t.type){h.push(`${e}>`);for(const e of Object.values(t.properties))d&&!d.includes(e.tagName)||h.push(...u({node:e,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m}));for(const e of Object.values(t.schemas))h.push(...u({node:e,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m}));h.push(p)}else{const n=(0,a().AO)((e=>"collection"===e.type||"collectionView"===e.type?{true:e}:{false:e}));if(n(t)||0===t.children.length)h.push(`${e}/>`);else{const i=[];if(!n(t)&&t.children)for(const e of t.children){const t=u({node:e,selection:r,path:y,onlyAllowPropertyTypes:d,namespace:m});for(const e of t)i.push(e)}if(i.length<=1||(0,a().qg)(o().t,t.tagName)&&o().t[t.tagName].isToken)h.push(`${e}>${i.join("")}${p}`);else for(let t=0;t<i.length;t++){const r=i[t];0===t?h.push(`${e}>${r}`):t===i.length-1?h.push(r+p):h.push(r)}}}}return h}const c=20;function l(e){return"property-checkbox"!==e.tagName&&("property-number"===e.tagName?!e.attributes.number:0===e.children.length)}function p(e){const{node:t,selection:r,onlyAllowPropertyTypes:n,namespace:a}=e;return u({node:t,selection:r,path:[],onlyAllowPropertyTypes:n,namespace:a}).join("")}function d(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o="";if(t){o+="\n";for(let e=0;e<r;e++)o+="\t"}if("text"===e.type)o+=a?n().YU(e.value):e.value;else{o+=`<${e.tagName}`;for(const[t,r]of Object.entries(e.attributes||{}))o+=` ${t}="${r}"`;if(e.children&&e.children.length>0){o+=">";for(const n of e.children)o+=d(n,t,r+1,a);if(t){o+="\n";for(let e=0;e<r;e++)o+="\t"}o+=`</${e.tagName}>`}else o+="/>"}return o}function m(e){return e.map((e=>d(e))).join("")}},815292:(e,t,r)=>{r.d(t,{P5:()=>o});r(241792);var n=()=>r(790698),a=(n(),()=>r(513670));function o(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;return(0,n().parse)(e,r).childNodes.map((e=>i(e,t)))}function i(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.nodeType===n().NodeType.TEXT_NODE?{type:"text",value:t?a().AK(e.textContent):e.textContent}:{type:"element",tagName:e.tagName.toLowerCase(),attributes:e.attributes||{},children:e.childNodes.map((e=>i(e,t)))||[]}}},48826:(e,t,r)=>{r.d(t,{RJ:()=>n,V:()=>o,WM:()=>l,Y:()=>a,aP:()=>i,qC:()=>u,xb:()=>s});r(267602),r(470928);const n=["slack","googleDrive","github","jira","microsoftTeams","microsoftSharepoint"],a=[...n,"web","githubCode"],o="7c57d10c-00cc-48bc-a552-fb3911dd7745",i="1031cb6c-4935-4cc1-9c08-c9a4ecaae323",s="65683ef9-c923-4a14-8c5b-bfcf591cf5a1",u="c1f230b1-6635-4ab0-a3f5-f7eb105a87c3",c=[{regex:/https:\/\/(?<workspace>[\w-]+)\.slack\.com\/archives\/(?<channel>[^\/]+)\/p(?<timestamp>\d+)(\?thread_ts=(?<thread_ts>\d+\.\d+)&cid=(?<cid>[^\/]+))?/,type:"slack"},{regex:/https:\/\/docs\.google\.com\/(?<fileType>document|spreadsheets|presentation)\/d\/(?<fileId>[a-zA-Z0-9_-]+)(?:\/\S*)?/,type:"googleDrive"},{regex:/https:\/\/github\.com\/(?<orgName>[^\/]+)\/(?<repoName>[^\/]+)\/(?:blob|tree|blame)\/(?<branchName>[^\/]+)\/(?<codePath>[^#]+)(#(?<lineNumber>L\d+(?:C\d+)?(?:-L\d+)?))?/,type:"githubCode"},{regex:/https:\/\/github\.com\/(?<orgName>[^\/]+)\/(?<repoName>[^\/]+)\/pull\/(?<prNumber>\d+)(\/(files|commits|checks)?)?/,type:"github"},{regex:/https:\/\/app\.graphite\.dev\/github\/pr\/(?<orgName>[^\/]+)\/(?<repoName>[^\/]+)\/(?<prNumber>\d+)(?:\/\S*)?/,type:"github"},{regex:/https:\/\/(?:[^\.]+)\.sourcegraphcloud\.com\/github\.com\/(?<orgName>[^\/]+)\/(?<repoName>[^\/@]+)(?:@(?<branchName>[a-f0-9]+))?\/-\/blob\/(?<codePath>[^?]+)\?(?<lineNumbers>L\d+|l\d+)?/,type:"githubCode"},{regex:/https:\/\/(?<site>[^/]+\.atlassian\.net).*?(?:browse\/|[?&]selectedIssue=)(?<issueKey>[A-Z0-9]+-\d+).*?/,type:"jira"}];function l(e){const t=c.find((t=>t.regex.test(e)));return(null==t?void 0:t.type)??"web"}},121508:(e,t,r)=>{r.d(t,{I8:()=>d});r(821057),r(670560),r(267602),r(653476);var n=()=>r(855741),a=()=>r(696459),o=()=>r(110958),i=()=>r(441010),s=()=>r(413880),u=()=>r(673571),c=(r(241792),()=>r(963864));const l=o().p.map(c().oT,(e=>({type:"text",value:e.value})));function p(e){const t=(0,a().Xc)(s().t,((t,r)=>function(e,t){const r=s().t[e],{mapCounterToKey:a}=t;return o().p.mapResult((0,c().hc)(e),(t=>{const i=(0,c().jg)({inputAttributes:t.attributes,definitions:r.attributes,tagName:e,mapCounterToKey:a});if(n().x.isFail(i))return i;let s=t.children??[];r.text||(s=s.filter((e=>!(0,u().Z)(e))));const l=(0,o().w6)(o().p.manyTill(d({inlineNodesAllowed:r.inline,textAllowed:r.text,parentTagName:e,mapCounterToKey:a}),o().p.eof()),s);if(n().x.isFail(l))return l;const p=l.value;return{value:{type:"inline",tagName:e,attributes:i.value,children:p}}}))}(r,e)));return t}function d(e){const{inlineNodesAllowed:t,textAllowed:r,parentTagName:n,mapCounterToKey:s}=e,u=[...t],c=[];for(const[o,i]of(0,a().qP)(p({mapCounterToKey:s})))(0,a().DE)(u,o)&&c.push(i);return o().p.choice([...c,...r?[l]:[],o().p.fail((e=>e.length>0?new(i().d4)({tagName:n,unexpectedNode:e[0]}):new Error("No inline or text node")))])}},695093:(e,t,r)=>{r.d(t,{ue:()=>M,q9:()=>K,$u:()=>C,ho:()=>N,br:()=>_,b8:()=>I,zL:()=>S,Fs:()=>w,Zv:()=>T,zp:()=>q,qC:()=>x,pV:()=>O,w6:()=>A,Qm:()=>P,Vl:()=>D,_B:()=>$});r(821057),r(267602),r(749411),r(241792);var n=()=>r(513670),a=()=>r(855741),o=()=>r(110958),i=()=>r(441010),s=()=>r(9369),u=()=>r(413880),c=()=>r(48826),l=()=>r(696459),p=()=>r(121508),d=()=>r(963864);function m(e,t){const r=`filter-${e}`;return o().p.mapResult((0,d().hc)(r),(n=>{var s;if(null===(s=n.attributes)||void 0===s||!s.condition)return{error:new(i().FI)({tagName:r,attributeName:"condition"})};const c=u().c8[e],l=function(e){const{tagName:t,condition:r,allowedOperators:n}=e;if(r.includes("not ")){const e=r.replace("not ","").replace(/\s+/g," ").trim();return n.includes(e)?{value:{not:!0,operator:e}}:{error:new(i().uY)({tagName:t,allowedOperators:n,inputCondition:r})}}return n.includes(r)?{value:{not:!1,operator:r}}:{error:new(i().uY)({tagName:t,allowedOperators:n,inputCondition:r})}}({condition:n.attributes.condition,tagName:r,allowedOperators:Object.keys(c)});if(a().x.isFail(l))return l;const m=c[l.value.operator],y=(0,d().jg)({inputAttributes:n.attributes,definitions:{name:{required:!0,values:!0},condition:{required:!0,values:!0},...m.attributes},tagName:r,mapCounterToKey:t.mapCounterToKey});if(a().x.isFail(y))return y;const{name:h,condition:b,...g}=y.value,f=(0,o().w6)((0,d().Lf)(r,[(0,p().I8)({inlineNodesAllowed:m.inline,textAllowed:m.text,parentTagName:r,mapCounterToKey:t.mapCounterToKey})],{allowUnmatchedText:!0}),n.children??[]);if(a().x.isFail(f))return f.error instanceof i().d4?{error:new(i().Dt)({tagName:f.error.tagName,unexpectedNode:f.error.unexpectedNode,conditionName:n.attributes.condition,cause:f.error})}:f;return{value:{propertyName:y.value.name,propertyTagName:e,children:f.value,attributes:g,operator:l.value.operator,not:l.value.not}}}))}function y(e){return o().p.choice([...(0,l().Yd)(u().c8).map((t=>m(t,e))),o().p.fail((e=>new(i().vQ)({nodeType:"database filter",unexpectedNode:n().Ps(e)})))])}function h(e){return o().p.mapResult((0,d().hc)("filter-group"),(t=>{const r=(0,d().jg)({inputAttributes:t.attributes,definitions:{match:{required:!0,values:["any","all"]}},tagName:"filter-group",mapCounterToKey:e.mapCounterToKey});if(a().x.isFail(r))return r;if(!t.children||0===t.children.length)return{error:new(i().wh)({tagName:"filter-group"})};const n=(0,o().w6)((0,d().Lf)("filter-group",[b(e)],{allowUnmatchedText:!0}),t.children??[]);return a().x.isFail(n)?n:{value:{operator:r.value.match,filters:n.value}}}))}function b(e){return o().p.choice([y(e),h(e)])}const g=o().p.choice([...(0,l().Yd)(u().ZK).map((e=>function(e){const t=`sort-${e}`;return o().p.mapResult((0,d().hc)(t),(e=>{const r=(0,d().xB)(e);if(a().x.isFail(r))return r;const n=(0,d().jg)({inputAttributes:e.attributes,definitions:{name:{required:!0,values:!0},direction:{required:!0,values:["ascending","descending"]}},tagName:t,mapCounterToKey:void 0});return a().x.isFail(n)?n:{value:{propertyName:n.value.name,direction:n.value.direction}}}))}(e))),o().p.fail((e=>new(i().vQ)({nodeType:"database sort",unexpectedNode:n().Ps(e)})))]),f=o().p.map((0,d().MD)({tagName:"limit",attributeDefinitions:{number:{required:!0,values:!0}},mapCounterToKey:void 0}),(e=>{let{attributes:t}=e;return parseInt(t.number)})),v=o().p.map((0,d().MD)({tagName:"search",attributeDefinitions:{question:{required:!0,values:!0},keywords:{required:!0,values:!0},"question-intl":{required:!1,values:!0},channel:{required:!1,values:!0}},mapCounterToKey:void 0}),(e=>{let{attributes:t}=e;return{question:t.question,keywords:t.keywords,questionIntl:t["question-intl"]}}));const k=o().p.choice([...(0,l().Yd)(u().ZK).map((e=>function(e){const t=`aggregation-${e}`,r=u().Se[t];return o().p.mapResult((0,d().hc)(t),(e=>{const n=(0,d().xB)(e);if(a().x.isFail(n))return n;const o=(0,d().jg)({inputAttributes:e.attributes,definitions:r.attributes,tagName:t,mapCounterToKey:void 0});return a().x.isFail(o)?o:{value:{tagName:t,attributes:o.value}}}))}(e))),o().p.fail((e=>new(i().vQ)({nodeType:"database sort",unexpectedNode:n().Ps(e)})))]);function x(e){return o().p.mapResult((0,d().hc)("query-database"),(t=>{const{id:r,...s}=t.attributes,u=r?function(e){const{id:t,mapCounterToKey:r}=e;if(!r)return{value:{key:t,type:"collection"}};const n=a().x.catchErrors((()=>r(t)));if(a().x.isFail(n))return n;return"collection"===n.value.type||"collection-view"===n.value.type?{value:n.value}:{error:new Error(`Expected block or collection ID, got ${n.value.type}`)}}({id:r,mapCounterToKey:e.mapCounterToKey}):void 0;if(u&&a().x.isFail(u))return u;if(!u)return{error:new Error('The <query-database> tag is missing a id attribute. It should be specified as <query-database id="...">')};if(Object.keys(s).length>0)return{error:new Error("<query-database> cannot have any attributes other than 'id'")};const c=(0,o().w6)((0,d().Lf)("query-database",[o().p.map(b(e),(e=>({type:"filter",value:e}))),o().p.map(g,(e=>({type:"sort",value:e}))),o().p.map(v,(e=>({type:"search",value:e}))),o().p.map(k,(e=>({type:"aggregation",value:e}))),o().p.map(f,(e=>({type:"limit",value:e})))],{allowUnmatchedText:!0}),t.children??[]);if(a().x.isFail(c))return c;const l=c.value.flatMap((e=>"filter"===e.type?[e.value]:[])),p=c.value.flatMap((e=>"sort"===e.type?[e.value]:[])),m=c.value.flatMap((e=>"search"===e.type?[e.value]:[])),y=c.value.flatMap((e=>"aggregation"===e.type?[e.value]:[])),h=c.value.flatMap((e=>"limit"===e.type?[e.value]:[]));if(m.length>1)return{error:new(i().en)("<search>")};if(y.length>1)return{error:new(i().en)("aggregation")};return{value:{tagName:"query-database",type:"observation",query:{databaseId:u.value.key,search:n().Ps(m),aggregation:n().Ps(y),filter:{operator:"all",filters:l},sorts:p,limit:n().Ps(h)}}}}))}function w(e){return o().p.map((0,d().MD)({tagName:"load-page",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"block_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-page",attributes:t}}))}function T(e){return o().p.map((0,d().MD)({tagName:"load-slack",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-slack",attributes:t}}))}function _(e){return o().p.map((0,d().MD)({tagName:"load-google-drive",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-google-drive",attributes:t}}))}function N(e){return o().p.map((0,d().MD)({tagName:"load-github",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-github",attributes:t}}))}function C(e){return o().p.map((0,d().MD)({tagName:"load-github-code",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-github-code",attributes:t}}))}function I(e){return o().p.map((0,d().MD)({tagName:"load-jira",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-jira",attributes:t}}))}function q(e){return o().p.map((0,d().MD)({tagName:"load-web-page",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"external_id_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-web-page",attributes:t}}))}function M(e){return o().p.map((0,d().MD)({tagName:"load-attachment",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"attachment_id_counter"},attachmentType:{required:!0,values:["pdf"]}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-attachment",attributes:t}}))}function K(e){return o().p.map((0,d().MD)({tagName:"load-database",attributeDefinitions:{id:{required:!0,values:!0,mappingMode:"collection_counter"}},mapCounterToKey:e.mapCounterToKey}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"load-database",attributes:t}}))}function S(e){return o().p.mapResult((0,d().hc)("load"),(t=>{const r=(0,d().xB)(t);if(a().x.isFail(r))return r;const{id:n,...o}=t.attributes;if(void 0===n)return{error:new Error("<load> must have an 'id' attribute")};if(Object.keys(o).length>0)return{error:new Error("<load> cannot have any attributes other than 'id'")};const{mapCounterToKey:i}=e;if(!i)return{error:new Error("mapCounterToKey is required")};const u=s().Tc.mapCounterToKeyInMode({mapCounterToKey:i},n,"block_counter","load");if(!u.error)return{value:{type:"observation",tagName:"load-page",attributes:{id:u.value}}};const l=s().Tc.mapCounterToKeyInMode({mapCounterToKey:i},n,"collection_counter","load");if(!l.error)return{value:{type:"observation",tagName:"load-database",attributes:{id:l.value}}};const p=s().Tc.mapCounterToKeyInMode({mapCounterToKey:i},n,"external_id_counter","load");if(!p.error){const e=(0,c().WM)(p.value);if("web"===e)return{value:{type:"observation",tagName:"load-web-page",attributes:{id:p.value}}};if("slack"===e)return{value:{type:"observation",tagName:"load-slack",attributes:{id:p.value}}};if("googleDrive"===e)return{value:{type:"observation",tagName:"load-google-drive",attributes:{id:p.value}}};if("github"===e)return{value:{type:"observation",tagName:"load-github",attributes:{id:p.value}}};if("githubCode"===e)return{value:{type:"observation",tagName:"load-github-code",attributes:{id:p.value}}};if("jira"===e)return{value:{type:"observation",tagName:"load-jira",attributes:{id:p.value}}}}return{error:new Error(`<load> with id ${n} could must be either a block or database ID.`)}}))}const $=["notion","slack","google-drive","github","jira"],D=["document","spreadsheets","presentation","message","pull-request","code","issue","task","ticket"],A=o().p.map((0,d().MD)({tagName:"search",attributeDefinitions:{question:{required:!0,values:!0},keywords:{required:!0,values:!0},lookback:{required:!1,values:!0},"question-intl":{required:!1,values:!0},channel:{required:!1,values:!0},source:{required:!1,values:!0},sort:{required:!1,values:["latest"]},database:{required:!1,values:!0},"file-type":{required:!1,values:D},repo:{required:!1,values:!0},[u().X_]:{required:!1,values:["true"]},contributor:{required:!1,values:!0}},mapCounterToKey:void 0}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"search",attributes:t}})),P=o().p.map((0,d().MD)({tagName:"search-people",attributeDefinitions:{search:{required:!0,values:!0}},mapCounterToKey:void 0}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"search-people",attributes:t}})),O=o().p.map((0,d().MD)({tagName:"search-databases",attributeDefinitions:{search:{required:!0,values:!0}},mapCounterToKey:void 0}),(e=>{let{attributes:t}=e;return{type:"observation",tagName:"search-databases",attributes:t}}))},963864:(e,t,r)=>{r.d(t,{Lf:()=>b,MD:()=>f,_e:()=>h,hc:()=>l,jg:()=>y,oT:()=>p,xB:()=>g});r(821057),r(492176),r(670560),r(267602),r(653476),r(470928),r(241792);var n=()=>r(513670),a=()=>r(855741),o=()=>r(696459),i=()=>r(110958),s=()=>r(441010),u=()=>r(9369);const c=i().p.satisfy((0,o().AO)((e=>"element"===e.type?{true:e}:{false:e})));function l(e){return i().p.describe(i().p.filter(c,(t=>t.tagName===e)),(()=>new(s().B9)(e)))}const p=i().p.satisfy((0,o().AO)((e=>"text"===e.type?{true:e}:{false:e}))),d=i().p.satisfy((e=>"text"===e.type&&""===e.value.trim()));function m(e){const{prefixMappingMode:t,baseHref:r}=e;return"query_database_result_counter"===t?`query_database_result_counter:/${u().Tc.blockIdToHref(r)}`:"href_counter"===t?r:void(0,o().t1)(t)}function y(e){const{inputAttributes:t={},definitions:r,tagName:i,validateRequiredAttributes:c=!0,mapCounterToKey:l}=e,p=Object.keys(t),d=Object.keys(r),y=n().e5(p,d);if(y.length>0)return{error:new(s().JZ)({attributeNames:y,tagName:i})};if(c)for(const[n,a]of Object.entries(r))if(a.required&&!p.includes(n))return{error:new(s().FI)({attributeName:n,tagName:i})};const h=n().d9(t);for(const[n,b]of Object.entries(t)){const e=r[n];if((0,o().$K)(e.mappingMode)){if("href_counter"!==e.mappingMode&&!(0,u().oU)(b))return{error:new(s().WH)(n,b)};if((0,o().$K)(l)&&"href_counter"===e.mappingMode){let e;const t=["href_counter","query_database_result_counter"];for(const r of t)if(e=u().Tc.mapCounterToKeyInMode({mapCounterToKey:l},b,r,i),a().x.isSuccess(e)){h[n]=m({prefixMappingMode:r,baseHref:e.value});break}if(a().x.isFail(e))return{error:new(s().XV)("unmapped_id",e.error.message,e.error)}}else if((0,o().$K)(l)){const t=u().Tc.mapCounterToKeyInMode({mapCounterToKey:l},b,e.mappingMode,i);if(a().x.isFail(t))return{error:new(s().XV)("unmapped_id",t.error.message,t.error)};h[n]=t.value}}if(!0!==e.values&&!e.values.includes(b))return{error:new(s().eL)({attributeName:n,receivedValue:b,tagName:i})}}return{value:h}}function h(e,t){if(0===e.length)throw new Error("Must provide at least 1 label and type guard");const r=[...e],n=[[]];for(const o of t){const[t,i]=r[0];if(!i(o)){for(;r.length>0;){r.shift();const e=r[0];if(n.push([]),e&&e[1](o))break}if(0===r.length){var a;const r=null===(a=e.find((e=>{let[,t]=e;return t(o)})))||void 0===a?void 0:a[0];if(!r)throw new Error(`Item did not match any type guards: ${JSON.stringify(o)}`);return{error:{incorrectLabel:r,lastLabel:t}}}}n.at(-1).push(o)}for(;n.length<e.length;)n.push([]);return{value:n}}function b(e,t,r){const{allowUnmatchedText:a=!1}=r??{},o=i().p.manyTill(i().p.choice([...t,...a?[i().p.map(d,(e=>{}))]:[],i().p.fail((t=>new(s().d4)({tagName:e,unexpectedNode:n().Ps(t)})))]),i().p.eof());return i().p.map(o,(e=>n().oA(e)))}function g(e){return e.children&&e.children.length>0?{error:new(s().d4)({tagName:e.tagName,unexpectedNode:e.children[0]})}:{value:void 0}}function f(e){const{tagName:t,attributeDefinitions:r,mapCounterToKey:n}=e;return i().p.mapResult(l(t),(e=>{const o=y({tagName:t,inputAttributes:e.attributes,definitions:r,mapCounterToKey:n});if(a().x.isFail(o))return o;const i=g(e);return a().x.isFail(i)?i:{value:{attributes:o.value}}}))}},110958:(e,t,r)=>{r.d(t,{kU:()=>s,p:()=>c,w6:()=>i});r(821057),r(670560),r(241792);var n=()=>r(513670),a=()=>r(855741);class o extends Error{constructor(e){super(e)}}function i(e,t){const r=Array.isArray(t)?t:[t],[,n]=e(r);return n.status?{value:n.value}:{error:n.error}}function s(e,t){const r=i(e,t);if(a().x.isFail(r))throw r.error;return r.value}const u=Symbol("ManyTillEndSentinel"),c={try:e=>t=>{const[r,n]=e(t);return n.status?[r,n]:[t,n]},any:()=>e=>e.length>0?[e.slice(1),{status:!0,value:e[0]}]:[[],{status:!1,error:new o("Reached end of input")}],eof:e=>t=>0===t.length?[[],{status:!0,value:void 0}]:[t,{status:!1,error:(null==e?void 0:e(t[0]))??new o("Expected end of input")}],map:(e,t)=>r=>{const[n,a]=e(r);return[n,a.status?{status:!0,value:t(a.value)}:a]},mapResult:(e,t)=>r=>{const[n,o]=c.map(e,t)(r);return o.status?a().x.isFail(o.value)?[n,{status:!1,error:o.value.error}]:[n,{status:!0,value:o.value.value}]:[n,o]},andThen:(e,t)=>r=>{const[n,a]=e(r);return a.status?t(a.value)(n):[n,a]},sequence:function(e){return t=>{const r=[];for(const n of e){const[e,a]=n(t);if(!a.status)return[e,a];r.push(a.value),t=e}return[t,{status:!0,value:r}]}},satisfy:function(e){return c.try((t=>{const[r,n]=c.any()(t);return n.status&&!e(n.value)?[r,{status:!1,error:new o("Failed predicate")}]:[r,n]}))},filter:function(e,t){return c.try((r=>{const[n,a]=e(r);return[n,a.status?t(a.value)?a:{status:!1,error:new o("Failed predicate")}:a]}))},literal:e=>c.describe(c.satisfy((t=>n().Xy(t,e))),(()=>new o(`Expected: ${JSON.stringify(e)}.`))),describe:(e,t)=>r=>{const[n,a]=e(r);return[n,a.status?a:{status:!1,error:t()}]},constant:e=>t=>[t,{status:!0,value:e}],choice:e=>0===e.length?c.fail((()=>new o("No parsers to choose from"))):t=>{let r=e[0](t);for(const a of e.slice(1)){const[e,o]=r;if(o.status||!n().Xy(e,t))return r;r=a(t)}return r},fail:e=>t=>[t,{status:!1,error:e(t)}],many:e=>t=>{const r=[];for(;;){const[n,a]=c.try(e)(t);if(!a.status)return[n,{status:!0,value:r}];r.push(a.value),t=n}},manyTill:(e,t)=>r=>{const n=[];for(;;){const[a,o]=c.choice([c.map(t,(()=>u)),c.try(e)])(r);if(!o.status)return[a,o];if(o.value===u)return[a,{status:!0,value:n}];n.push(o.value),r=a}},many1:e=>c.map(c.sequence([e,c.many(e)]),(e=>{let[t,r]=e;return[t,...r]})),sepBy:(e,t)=>c.choice([c.sepBy1(e,t),c.constant([])]),sepBy1:(e,t)=>c.andThen(e,(r=>c.map(c.many(c.map(c.sequence([t,e]),(e=>{let[,t]=e;return t}))),(e=>[r,...e])))),lazy:e=>c.andThen(c.constant(void 0),e),lookAhead:e=>t=>[t,e(t)[1]]}},783190:(e,t,r)=>{r.d(t,{S1:()=>d,cn:()=>b,hi:()=>h,o_:()=>m,qq:()=>y});r(267602),r(653476),r(470928),r(241792),r(398858),r(461318),r(33228);var n=r.n(r(467266)),a=()=>r(369448),o=()=>r(696459),i=()=>r(124199),s=()=>r(5234),u=()=>r(926161),c=()=>r(956057),l=()=>r(594860);const p="/workflows/oauth/connect";function d(e,t){const r=Object.fromEntries(Object.entries(e).filter((e=>{let[t,r]=e;return Boolean(r)})));return`${t}${p}?${new URLSearchParams(r).toString()}`}i().object({required:{moduleType:i().literals(...Object.keys(l().O)),workflowId:i().string(),moduleKey:i().string(),spaceId:i().string()},optional:{transcriptId:i().string(),moduleSpecific:i().string()}});function m(e){const t={...e};delete t.examples,delete t.memories,delete t.annotation,"transcript"in e&&Array.isArray(e.transcript)&&(t.transcript=e.transcript.map((e=>({...e,id:void 0}))));const r=y((0,u().Z)((0,a().U)(t),"ignore-class-instances"));return(0,c().Ul)(r)}function y(e,t){return n()(e,t?{space:"  "}:void 0)}function h(e){return("info"===e.level?"":`${(0,s().Z)(e.level)}: `)+e.messages.map((e=>{switch(e.type){case"msg":return e.data;case"object":return JSON.stringify(e.data);case"undefined":return"undefined";case"error":return`${e.message||"Unknown error"}\n${e.stack||""}`;case"database":return`${e.database_key}`;default:return(0,o().t1)(e)}})).join(" ")}function b(e,t){var r,n;const a=null==t||null===(r=t.modules)||void 0===r?void 0:r.find((t=>t.key===e.moduleKey));if(!a||null===(n=e.state)||void 0===n||!n.type)return!1;const o=l().O[a.type].isTriggerConfigured[e.state.type];return!o||o(e.state)}}}]);