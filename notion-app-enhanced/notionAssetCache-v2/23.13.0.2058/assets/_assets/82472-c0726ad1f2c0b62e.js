"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[82472],{314160:(e,t,n)=>{n.d(t,{Jh:()=>o,Mo:()=>r,O$:()=>d,_F:()=>a,aC:()=>s,mm:()=>l});var i=()=>n(594546);function o(e,t){(0,i().j)({environment:e,event:{eventName:"open_publish_modal",eventProperties:t}})}function a(e,t){(0,i().j)({environment:e,event:{eventName:"change_domain",eventProperties:t}})}function r(e,t){(0,i().j)({environment:e,event:{eventName:"update_seo_settings",eventProperties:t}})}function s(e,t){(0,i().j)({environment:e,event:{eventName:"site_set_link_expiration",eventProperties:t}})}function d(e,t){(0,i().j)({environment:e,event:{eventName:"page_unpublish",eventProperties:t}})}function l(e,t){(0,i().j)({environment:e,event:{eventName:"page_publish",eventProperties:t}})}},998470:(e,t,n)=>{n.d(t,{AB:()=>D,Au:()=>R,C$:()=>q,DR:()=>B,Fo:()=>A,H2:()=>N,Hl:()=>j,KD:()=>z,Q6:()=>C,QP:()=>x,YU:()=>O,Y_:()=>H,c7:()=>W,cy:()=>J,dM:()=>Z,dU:()=>M,f$:()=>E,gx:()=>F,pn:()=>P,t:()=>T,wt:()=>G,xz:()=>V,y_:()=>Q,yr:()=>$});n(821057),n(670560),n(267602),n(653476),n(241792),n(667294);var i=()=>n(396136),o=()=>n(81954),a=()=>n(928833),r=()=>n(899133),s=()=>n(788860),d=()=>n(513670),l=()=>n(342792),c=()=>n(824462),u=()=>n(636340),m=()=>n(752127),p=()=>n(102182),v=()=>n(269299),g=()=>n(205228),S=()=>n(487270),h=()=>n(314169),f=()=>n(663132),I=()=>n(479875),b=()=>n(836756),_=()=>n(759160),U=()=>n(314160),y=()=>n(566245),k=n(785893);function A(e){const{environment:t,store:n,type:i,header:r,domainId:s}=e,d=n.getSiteStore();if(d)return d.id;let l=s;var c;l||(l=null===(c=f().VA(n.getSpaceStore()))||void 0===c?void 0:c.id);const m=(0,S().$x)({environment:t,table:a().Gs,spaceId:(0,o().J)(n.getSpaceId())});v().createAndCommit({userAction:"publishSite.create",environment:t,canUndo:!0,perform:e=>{const o=u().Ue({environment:t,table:m.table,args:{id:m.id,type:i,spaceId:m.spaceId,blockId:n.id,domainId:l,currentUserId:t.currentUser.id,header:r??{}},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:e});return u().sW({store:n.getFormatStore(),data:{site_id:o.id},transaction:e}),o.id}})}function w(e){const{environment:t,siteRootBlockStore:n,domainId:i}=e;let o=n.getSiteStore();if(o||(A({environment:t,type:"site",store:n,domainId:i}),o=n.getSiteStore()),o)return o}function Z(e){const{environment:t,domainId:n,resetWatermark:i}=e,o=w(e);o&&o.isDefined()&&(v().createAndCommit({userAction:"publishSite.updatePublicDomain",environment:t,canUndo:!0,perform:e=>{o.getDomainId()!==n&&v().applyOperation({transaction:e,store:o,operation:o.getModel().ops.updatePublicDomainId({domainId:n,currentUserId:t.currentUser.id})})}}),v().createAndCommit({userAction:"publishSite.resetWatermark",environment:t,canUndo:!0,perform:e=>{if(i){const n=o.getHeader();v().applyOperation({transaction:e,store:o,operation:o.getModel().ops.updateHeader({header:{...n,hideWatermark:!1},currentUserId:t.currentUser.id})})}}}),p().oV({label:(0,k.jsx)(s()._H,{id:"publishSiteSettings.publicDomain.confirmation",defaultMessage:"Successfully updated domain for all pages within this site"})}))}function B(e){const{environment:t,siteRootBlockStore:n,isSearchEngineIndexingEnabled:i}=e,a=w(e);if(!a)return;"form"!==a.getType()&&v().createAndCommit({userAction:"publishSite.updateSeoEnabled",environment:t,canUndo:!0,perform:e=>{a&&a.isDefined()&&i!==a.isSearchEngineIndexingEnabled()&&(v().applyOperation({transaction:e,store:a,operation:a.getModel().ops.updateIsSearchEngineIndexingEnabled({isSearchEngineIndexingEnabled:i,currentUserId:t.currentUser.id})}),i&&e.postSubmitCallbacks.push((async e=>{e||await c().callApi({eventName:"enqueueScanContentTask",environment:t,data:{pagePointer:{id:n.id,table:"block",spaceId:(0,o().J)(n.pointer.spaceId)}}})})))}})}function C(e){const{environment:t,store:n,seoTitle:i,seoDescription:o}=e;v().createAndCommit({userAction:"publishSite.create",environment:t,canUndo:!0,perform:e=>{const a=n.getFormat().seo_title,r=n.getFormat().seo_description;a===i&&r===o||(u().sW({store:n.getFormatStore(),data:{seo_title:i,seo_description:o},transaction:e}),(0,U().Mo)(t,{target_block_id:n.id,new_title:i??null,new_description:o??null}),p().oV({label:(0,k.jsx)(s()._H,{id:"siteSettingsEditor.publishSeoChanges.confirmation",defaultMessage:"Successfully updated the SEO settings"})}))}})}function M(e){_().Z.setState({..._().Z.state,settingOpen:e})}function D(){_().Z.setState({..._().Z.state,settingOpen:"initial"})}function P(e){b().Z.setState({...b().Z.state,siteSettingContentType:e})}function H(e){var t,n,i;const{siteRootBlockStore:o,permissionItem:a,from:r,sudoModeStore:s}=e,d=o.getSiteStore(),l=null==d?void 0:d.getHeader(),c=(null==l||null===(t=l.customItems)||void 0===t?void 0:t.map((e=>e.blockId)))||[];_().Z.setState({settingOpen:"initial",permissionItem:a,from:r,sudoModeStore:s,faviconUrl:(null==d?void 0:d.getFaviconUrl())||null,previewImageUrl:(null==d?void 0:d.getPreviewImageUrl())||null,hideBreadcrumbs:null==l?void 0:l.hideBreadcrumbs,hideSearch:null==l?void 0:l.hideSearch,hideWatermark:null==l?void 0:l.hideWatermark,enableDuplicateAsTemplate:a.allow_duplicate,customHeaderBlockIds:c,googleAnalyticsId:null==d?void 0:d.getGoogleAnalyticsId(),theme:null==d||null===(n=d.getSettings())||void 0===n?void 0:n.theme,enableQna:null==d||null===(i=d.getSettings())||void 0===i?void 0:i.enableQna})}async function O(e){var t;const{environment:n,store:o,siteRootBlockStore:a}=e,r=w({environment:n,siteRootBlockStore:a}),u=null==r?void 0:r.getType();if(!r||"form"===u)return;const m=_().Z.getState();let g=!1;const S={};let I;m.enableQna&&(I=await async function(e){var t,n,i,o;const{environment:a,siteStore:r}=e,s=null===(t=r.getSettings())||void 0===t?void 0:t.siteUserId;if(s)return s;if(!((null===(n=r.getDomainStore())||void 0===n?void 0:n.getDomainName())??(null===(i=f().VA(r.getSpaceStore()))||void 0===i?void 0:i.domain_name)))throw new Error("no domain on site");const d=f().Co({spaceStore:r.getSpaceStore(),domainId:null===(o=r.getDomainStore())||void 0===o?void 0:o.id}).split(":")[0],u=`${(0,l().XR)(r.id)}@${d}`,m=await c().callApi({eventName:"createEmailUser",environment:a,data:{email:u}});if("failed"===m.type)throw new Error("failed to create qna user");return m.data.userId}({environment:n,siteStore:r})),v().createAndCommit({userAction:"publishSite.updateSiteSettingsInEditor",environment:n,canUndo:!0,perform:e=>{if(r&&r.isDefined()){var t,i;(r.getFaviconUrl()||null)!==m.faviconUrl&&(v().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateFaviconUrl({faviconUrl:m.faviconUrl,currentUserId:n.currentUser.id})}),g=!0,S.favicon=m.faviconUrl);(r.getPreviewImageUrl()||null)!==m.previewImageUrl&&(v().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updatePreviewImageUrl({previewImageUrl:m.previewImageUrl,currentUserId:n.currentUser.id})}),g=!0,S.preview_image=m.previewImageUrl);const o=r.getHeader();let a=o;const s=function(e,t){const n=e.map((e=>({type:"block",blockId:e})));if(!t&&0===n.length)return;if(t&&(0,d().Xy)(n,t))return;return n}(m.customHeaderBlockIds,null==o?void 0:o.customItems);s&&(a={...a,customItems:s},S.custom_headers=s.map((e=>e.blockId))),(null==o?void 0:o.hideBreadcrumbs)!==m.hideBreadcrumbs&&(a={...a,hideBreadcrumbs:m.hideBreadcrumbs},S.hide_breadcrumbs=m.hideBreadcrumbs),(null==o?void 0:o.hideSearch)!==m.hideSearch&&(a={...a,hideSearch:m.hideSearch},S.hide_search=m.hideSearch),(null==o?void 0:o.hideWatermark)!==m.hideWatermark&&(a={...a,hideWatermark:m.hideWatermark},S.hide_watermark=m.hideWatermark),a&&o!==a&&(v().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateHeader({header:a,currentUserId:n.currentUser.id})}),g=!0);r.getGoogleAnalyticsId()!==m.googleAnalyticsId&&(v().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateGoogleAnalyticsId({googleAnalyticsId:m.googleAnalyticsId,currentUserId:n.currentUser.id})}),g=!0,S.google_analytics_id=m.googleAnalyticsId);(null===(t=r.getSettings())||void 0===t?void 0:t.theme)!==m.theme&&(v().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateTheme({theme:m.theme,currentUserId:n.currentUser.id})}),g=!0,S.theme=m.theme);(null===(i=r.getSettings())||void 0===i?void 0:i.enableQna)!==m.enableQna&&(m.enableQna?I&&v().applyOperation({transaction:e,store:r,operation:{pointer:r.pointer,command:"update",path:["settings"],args:{enableQna:m.enableQna,siteUserId:I}}}):v().applyOperation({transaction:e,store:r,operation:{pointer:r.pointer,command:"update",path:["settings"],args:{enableQna:m.enableQna}}}),g=!0)}}});if((null===(t=m.permissionItem)||void 0===t?void 0:t.allow_duplicate)!==m.enableDuplicateAsTemplate&&m.permissionItem&&m.from){const e=m.from.table===i().iU?m.from.blockId:m.from.teamId;(0,h().iK)({oldPermissionItem:m.permissionItem,newPermissionItem:{...m.permissionItem,allow_duplicate:m.enableDuplicateAsTemplate},wasInherited:e!==o.id,environment:n,store:o,sudoModeStore:m.sudoModeStore,location:"published_site_settings"}),g=!0,S.enable_duplicate_as_template=m.enableDuplicateAsTemplate}g&&((0,y().u6)(n,{settings_changed:S}),p().oV({label:(0,k.jsx)(s()._H,{id:"siteSettingsEditor.publishChanges.confirmation",defaultMessage:"Changes published"})}))}function x(e){_().Z.setState({..._().Z.state,faviconUrl:e})}function E(e){_().Z.setState({..._().Z.state,previewImageUrl:e})}function T(e){_().Z.setState({..._().Z.state,hideBreadcrumbs:e})}function W(e){_().Z.setState({..._().Z.state,hideSearch:e})}function N(e){_().Z.setState({..._().Z.state,hideWatermark:e})}function Q(e){_().Z.setState({..._().Z.state,enableDuplicateAsTemplate:e})}function j(e){const t=_().Z.state.customHeaderBlockIds.concat([e]);_().Z.setState({..._().Z.state,customHeaderBlockIds:t})}function R(e){const t=_().Z.state.customHeaderBlockIds.filter((t=>t!==e));_().Z.setState({..._().Z.state,customHeaderBlockIds:t})}function F(e){_().Z.setState({..._().Z.state,googleAnalyticsId:e})}function V(e){_().Z.setState({..._().Z.state,theme:e})}async function $(e){const{environment:t,spaceStore:n,query:i,siteRootBlockId:o}=e;if(!n)return;const a=await c().callApi({eventName:"searchPagesInSite",environment:t,data:{query:i,spaceId:n.id,filters:r().u4({isDeletedOnly:!1,navigableBlockContentOnly:!0,excludeTemplates:!0,editedBy:[],ancestors:[o],inTeams:[]}),sort:{field:"relevance"},limit:10}});return"failed"!==a.type?a.data:void 0}async function q(e){const{environment:t,blockStore:n,slug:i}=e,o=await c().callApi({eventName:"updatePublicPageSlug",environment:t,data:{spaceId:n.getSpaceId(),blockId:n.id,slug:i,clientVersion:g().default.version}});if("success"!==o.type)return{error:o};p().oV({label:(0,k.jsx)(s()._H,{id:"customSlugInput.updateSuccess.toast",defaultMessage:"Successfully updated URL for this page"})})}function z(e){_().Z.setState({..._().Z.state,enableQna:e})}function G(e){const{environment:t,store:n,pageVisitSource:i}=e,o=I().$({store:n,pageVisitSource:i});m().D({environment:t,url:o})}function J(e){const{environment:t,siteStore:n,embedSettings:i}=e;v().createAndCommit({userAction:"embedSite.updateEmbedSettings",environment:t,canUndo:!0,perform:e=>{u().sW({store:n.getSettingsStore(),data:{embedSettings:i},transaction:e})}})}},566245:(e,t,n)=>{n.d(t,{Cx:()=>r,g2:()=>o,u6:()=>a});var i=()=>n(594546);function o(e,t){(0,i().j)({environment:e,event:{eventName:"open_customize_site",eventProperties:t}})}function a(e,t){(0,i().j)({environment:e,event:{eventName:"update_site_customization_settings",eventProperties:t}})}function r(e){(0,i().j)({environment:e,event:{eventName:"close_customize_site",eventProperties:{}}})}},759160:(e,t,n)=>{n.d(t,{Z:()=>o});class i extends(()=>n(263184))().default{getInitialState(){return{settingOpen:"initial",permissionItem:void 0,from:void 0,sudoModeStore:void 0,location:"",faviconUrl:null,previewImageUrl:null,hideBreadcrumbs:!1,hideSearch:!1,hideWatermark:!1,enableDuplicateAsTemplate:!1,customHeaderBlockIds:[],googleAnalyticsId:void 0,theme:void 0,enableQna:!1}}}const o=new i},201565:(e,t,n)=>{function i(e){return"none"!==e.role&&Boolean(!e.is_public_share_link||e.is_site)}n.d(t,{L:()=>i})}}]);