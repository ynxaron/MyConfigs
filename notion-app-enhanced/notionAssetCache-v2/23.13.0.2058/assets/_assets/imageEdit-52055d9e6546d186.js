"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[78138],{435656:(e,t,i)=>{i.r(t),i.d(t,{ImageEditModal:()=>se,imageEditActions:()=>n,makeAspectCrop:()=>S});var n={};i.r(n),i.d(n,{MIN_CROP_SIZE:()=>y,cropAndUploadImage:()=>f,uploadCroppedImage:()=>b});i(821057);var o=()=>i(455530),r=()=>i(956057),a=()=>i(955620),s=()=>i(788860),h=()=>i(308186),d=()=>i(421654),c=()=>i(636340),l=()=>i(269299),p=()=>i(109757),g=()=>i(527278),w=()=>i(942226),u=()=>i(84926),m=()=>i(920991),C=()=>i(721118);const x=2e3,y=100,v=(0,s().vU)({cropError:{id:"imageEditActions.cropError.message",defaultMessage:"Failed to crop image."}});async function f(e){const{store:t,environment:i,proxiedOriginalUrl:n}=e;C().Z.setStatusDrawing(t.id);const r=await async function(e){const{store:t,proxiedOriginalUrl:i}=e,n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw Error("drawEditsToCanvas: missing 2d context");const r=C().Z.getMetadataByBlockId(t.id);if(!r)throw Error("attempted to crop without setting ImageEditStore first");const a=await new Promise(((e,t)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>e(n),n.onerror=()=>{t()},n.src=i}));let s=function(e){const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("drawInitialCanvas: missing 2d context");const n=Math.min(x,e.naturalWidth),o=n/e.naturalWidth,r=e.naturalHeight*o;return t.width=n,t.height=r,i.drawImage(e,0,0,n,r),t}(a);const{crop:h,mask:d}=r;s=function(e,t){const i=document.createElement("canvas"),n=i.getContext("2d");if(!n)throw new Error("applyCropToCanvas: missing 2d context");const o=e.width*t.x/100,r=e.height*t.y/100,a=e.width*t.width/100,s=e.height*t.height/100;return i.width=a,i.height=s,n.drawImage(e,-o,-r),i}(s,h),"Circle"===d&&(s=function(e){const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("applyCircleMaskToCanvas: missing 2d context");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.globalCompositeOperation="destination-in",i.fillStyle="#000",i.beginPath(),i.arc(.5*e.width,.5*e.height,.5*e.width,0,2*Math.PI),i.fill(),t}(s));return n.style.width=`${s.width}px`,n.style.height=`${s.height}px`,n.width=s.width,n.height=s.height,o.drawImage(s,0,0,s.width,s.height),n}({store:t,proxiedOriginalUrl:n});C().Z.setStatusUploading(t.id,r.toDataURL());const a=r.width/r.height;let s=u().Z.getWidth((0,w().wq)(t))??o().TT,d=s/a;if(d>o().QA){const e=d/o().QA;s/=e,d/=e}return b({canvas:r,store:t,environment:i,newBlockWidth:s,newBlockHeight:d,onUploadComplete:e=>C().Z.setStatusCompleted(t.id,e),onUploadError:()=>{C().Z.setStatusError(t.id),h().UW(g().Z.formatMessage(v.cropError))}})}async function b(e){const{environment:t,canvas:i,store:n,newBlockWidth:o,newBlockHeight:s}=e,h="image/png",g=await new Promise(((e,t)=>{i.toBlob((i=>{i?e(i):t()}),h,1)})),w=new File([g],`${r().Il()}.png`,{type:h}),u=m().default.getBlockKey(n.id);p().cT({environment:t,file:w,bucket:"secure",record:n.pointer,onStart:e=>{m().default.setKeyState(u,{progressPercent:0,file:w,name:e.name,size:e.size})},onProgress:e=>{const t=m().default.getKeyState(u);t&&m().default.setKeyState(u,{...t,progressPercent:e.progressPercent})},onComplete:i=>{var r;const h=n.getOriginalImageSource(),p=C().Z.getMetadataByBlockId(n.id);if(!p)throw Error("Missing edit metadata on format update!");if(!h)throw Error("Missing original image source on format update!");l().createAndCommit({userAction:"embedBlockActions.uploadEditedImage",environment:t,canUndo:!0,perform:e=>{d().FH({stores:[n],update:{display_source:i,original_source:h,image_edit_metadata:p,block_width:o,block_height:s,block_aspect_ratio:s/o},transaction:e}),c().sW({store:n.getPropertiesStore(),data:{source:a().TPx(i)},transaction:e})}}),m().default.setKeyState(u,void 0),null===(r=e.onUploadComplete)||void 0===r||r.call(e,i)},onError:t=>{var i;m().default.setKeyState(u,void 0),null===(i=e.onUploadError)||void 0===i||i.call(e)}})}var D=i(667294);const k={x:0,y:0,width:0,height:0,unit:"px"},M=(e,t,i)=>Math.min(Math.max(e,t),i),E=(e,t)=>e===t||e.width===t.width&&e.height===t.height&&e.x===t.x&&e.y===t.y&&e.unit===t.unit;function S(e,t,i,n){const o=R(e,i,n);return e.width&&(o.height=o.width/t),e.height&&(o.width=o.height*t),o.y+o.height>n&&(o.height=n-o.y,o.width=o.height*t),o.x+o.width>i&&(o.width=i-o.x,o.height=o.width/t),"%"===e.unit?I(o,i,n):o}function I(e,t,i){return"%"===e.unit?{...k,...e,unit:"%"}:{unit:"%",x:e.x?e.x/t*100:0,y:e.y?e.y/i*100:0,width:e.width?e.width/t*100:0,height:e.height?e.height/i*100:0}}function R(e,t,i){return e.unit?"px"===e.unit?{...k,...e,unit:"px"}:{unit:"px",x:e.x?e.x*t/100:0,y:e.y?e.y*i/100:0,width:e.width?e.width*t/100:0,height:e.height?e.height*i/100:0}:{...k,...e,unit:"px"}}function _(e,t,i,n,o,r=0,a=0,s=n,h=o){const d={...e};let c=Math.min(r,n),l=Math.min(a,o),p=Math.min(s,n),g=Math.min(h,o);t&&(t>1?(c=a?a*t:c,l=c/t,p=s*t):(l=r?r/t:l,c=l*t,g=h/t)),d.y<0&&(d.height=Math.max(d.height+d.y,l),d.y=0),d.x<0&&(d.width=Math.max(d.width+d.x,c),d.x=0);const w=n-(d.x+d.width);w<0&&(d.x=Math.min(d.x,n-c),d.width+=w);const u=o-(d.y+d.height);if(u<0&&(d.y=Math.min(d.y,o-l),d.height+=u),d.width<c&&(("sw"===i||"nw"==i)&&(d.x-=c-d.width),d.width=c),d.height<l&&(("nw"===i||"ne"==i)&&(d.y-=l-d.height),d.height=l),d.width>p&&(("sw"===i||"nw"==i)&&(d.x-=p-d.width),d.width=p),d.height>g&&(("nw"===i||"ne"==i)&&(d.y-=g-d.height),d.height=g),t){const e=d.width/d.height;if(e<t){const e=Math.max(d.width/t,l);("nw"===i||"ne"==i)&&(d.y-=e-d.height),d.height=e}else if(e>t){const e=Math.max(d.height*t,c);("sw"===i||"nw"==i)&&(d.x-=e-d.width),d.width=e}}return d}const j={capture:!0,passive:!1};let Z=0;const H=class e extends D.PureComponent{constructor(){super(...arguments),this.docMoveBound=!1,this.mouseDownOnCrop=!1,this.dragStarted=!1,this.evData={startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0},this.componentRef=(0,D.createRef)(),this.mediaRef=(0,D.createRef)(),this.initChangeCalled=!1,this.instanceId="rc-"+Z++,this.state={cropIsActive:!1,newCropIsBeingDrawn:!1},this.onCropPointerDown=e=>{const{crop:t,disabled:i}=this.props,n=this.getBox();if(!t)return;const o=R(t,n.width,n.height);if(i)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const r=e.target.dataset.ord,a=!!r;let s=e.clientX,h=e.clientY,d=o.x,c=o.y;if(r){const t=e.clientX-n.x,i=e.clientY-n.y;let a=0,l=0;"ne"===r||"e"==r?(a=t-(o.x+o.width),l=i-o.y,d=o.x,c=o.y+o.height):"se"===r||"s"===r?(a=t-(o.x+o.width),l=i-(o.y+o.height),d=o.x,c=o.y):"sw"===r||"w"==r?(a=t-o.x,l=i-(o.y+o.height),d=o.x+o.width,c=o.y):("nw"===r||"n"==r)&&(a=t-o.x,l=i-o.y,d=o.x+o.width,c=o.y+o.height),s=d+n.x+a,h=c+n.y+l}this.evData={startClientX:s,startClientY:h,startCropX:d,startCropY:c,clientX:e.clientX,clientY:e.clientY,isResize:a,ord:r},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})},this.onComponentPointerDown=e=>{const{crop:t,disabled:i,locked:n,keepSelection:o,onChange:r}=this.props,a=this.getBox();if(i||n||o&&t)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const s=e.clientX-a.x,h=e.clientY-a.y,d={unit:"px",x:s,y:h,width:0,height:0};this.evData={startClientX:e.clientX,startClientY:e.clientY,startCropX:s,startCropY:h,clientX:e.clientX,clientY:e.clientY,isResize:!0},this.mouseDownOnCrop=!0,r(R(d,a.width,a.height),I(d,a.width,a.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})},this.onDocPointerMove=e=>{const{crop:t,disabled:i,onChange:n,onDragStart:o}=this.props,r=this.getBox();if(i||!t||!this.mouseDownOnCrop)return;e.cancelable&&e.preventDefault(),this.dragStarted||(this.dragStarted=!0,o&&o(e));const{evData:a}=this;let s;a.clientX=e.clientX,a.clientY=e.clientY,s=a.isResize?this.resizeCrop():this.dragCrop(),E(t,s)||n(R(s,r.width,r.height),I(s,r.width,r.height))},this.onComponentKeyDown=t=>{const{crop:i,disabled:n,onChange:o,onComplete:r}=this.props;if(n)return;const a=t.key;let s=!1;if(!i)return;const h=this.getBox(),d=this.makePixelCrop(h),c=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?e.nudgeStepLarge:t.shiftKey?e.nudgeStepMedium:e.nudgeStep;if("ArrowLeft"===a?(d.x-=c,s=!0):"ArrowRight"===a?(d.x+=c,s=!0):"ArrowUp"===a?(d.y-=c,s=!0):"ArrowDown"===a&&(d.y+=c,s=!0),s){t.cancelable&&t.preventDefault(),d.x=M(d.x,0,h.width-d.width),d.y=M(d.y,0,h.height-d.height);const e=R(d,h.width,h.height),i=I(d,h.width,h.height);o(e,i),r&&r(e,i)}},this.onHandlerKeyDown=(t,i)=>{const{aspect:n=0,crop:o,disabled:r,minWidth:a=0,minHeight:s=0,maxWidth:h,maxHeight:d,onChange:c,onComplete:l}=this.props,p=this.getBox();if(r||!o)return;if("ArrowUp"!==t.key&&"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key)return;t.stopPropagation(),t.preventDefault();const g=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?e.nudgeStepLarge:t.shiftKey?e.nudgeStepMedium:e.nudgeStep,w=function(e,t,i,n){const o={...e};return"ArrowLeft"===t?"nw"===n?(o.x-=i,o.y-=i,o.width+=i,o.height+=i):"w"===n?(o.x-=i,o.width+=i):"sw"===n?(o.x-=i,o.width+=i,o.height+=i):"ne"===n?(o.y+=i,o.width-=i,o.height-=i):"e"===n?o.width-=i:"se"===n&&(o.width-=i,o.height-=i):"ArrowRight"===t&&("nw"===n?(o.x+=i,o.y+=i,o.width-=i,o.height-=i):"w"===n?(o.x+=i,o.width-=i):"sw"===n?(o.x+=i,o.width-=i,o.height-=i):"ne"===n?(o.y-=i,o.width+=i,o.height+=i):"e"===n?o.width+=i:"se"===n&&(o.width+=i,o.height+=i)),"ArrowUp"===t?"nw"===n?(o.x-=i,o.y-=i,o.width+=i,o.height+=i):"n"===n?(o.y-=i,o.height+=i):"ne"===n?(o.y-=i,o.width+=i,o.height+=i):"sw"===n?(o.x+=i,o.width-=i,o.height-=i):"s"===n?o.height-=i:"se"===n&&(o.width-=i,o.height-=i):"ArrowDown"===t&&("nw"===n?(o.x+=i,o.y+=i,o.width-=i,o.height-=i):"n"===n?(o.y+=i,o.height-=i):"ne"===n?(o.y+=i,o.width-=i,o.height-=i):"sw"===n?(o.x-=i,o.width+=i,o.height+=i):"s"===n?o.height+=i:"se"===n&&(o.width+=i,o.height+=i)),o}(R(o,p.width,p.height),t.key,g,i),u=_(w,n,i,p.width,p.height,a,s,h,d);if(!E(o,u)){const e=I(u,p.width,p.height);c(u,e),l&&l(u,e)}},this.onDocPointerDone=e=>{const{crop:t,disabled:i,onComplete:n,onDragEnd:o}=this.props,r=this.getBox();this.unbindDocMove(),!i&&t&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,o&&o(e),n&&n(R(t,r.width,r.height),I(t,r.width,r.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))},this.onDragFocus=()=>{var e;null==(e=this.componentRef.current)||e.scrollTo(0,0)}}get document(){return document}getBox(){const e=this.mediaRef.current;if(!e)return{x:0,y:0,width:0,height:0};const{x:t,y:i,width:n,height:o}=e.getBoundingClientRect();return{x:t,y:i,width:n,height:o}}componentDidUpdate(e){const{crop:t,onComplete:i}=this.props;if(i&&!e.crop&&t){const{width:e,height:n}=this.getBox();e&&n&&i(R(t,e,n),I(t,e,n))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,j),this.document.addEventListener("pointerup",this.onDocPointerDone,j),this.document.addEventListener("pointercancel",this.onDocPointerDone,j),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,j),this.document.removeEventListener("pointerup",this.onDocPointerDone,j),this.document.removeEventListener("pointercancel",this.onDocPointerDone,j),this.docMoveBound=!1)}getCropStyle(){const{crop:e}=this.props;if(e)return{top:`${e.y}${e.unit}`,left:`${e.x}${e.unit}`,width:`${e.width}${e.unit}`,height:`${e.height}${e.unit}`}}dragCrop(){const{evData:e}=this,t=this.getBox(),i=this.makePixelCrop(t),n=e.clientX-e.startClientX,o=e.clientY-e.startClientY;return i.x=M(e.startCropX+n,0,t.width-i.width),i.y=M(e.startCropY+o,0,t.height-i.height),i}getPointRegion(e,t,i,n){const{evData:o}=this,r=o.clientX-e.x,a=o.clientY-e.y;let s,h;return s=n&&t?"nw"===t||"n"===t||"ne"===t:a<o.startCropY,h=i&&t?"nw"===t||"w"===t||"sw"===t:r<o.startCropX,h?s?"nw":"sw":s?"ne":"se"}resolveMinDimensions(e,t,i=0,n=0){const o=Math.min(i,e.width),r=Math.min(n,e.height);return t&&(o||r)?t>1?o?[o,o/t]:[r*t,r]:r?[r*t,r]:[o,o/t]:[o,r]}resizeCrop(){const{evData:t}=this,{aspect:i=0,maxWidth:n,maxHeight:o}=this.props,r=this.getBox(),[a,s]=this.resolveMinDimensions(r,i,this.props.minWidth,this.props.minHeight);let h=this.makePixelCrop(r);const d=this.getPointRegion(r,t.ord,a,s),c=t.ord||d;let l=t.clientX-t.startClientX,p=t.clientY-t.startClientY;(a&&"nw"===c||"w"===c||"sw"===c)&&(l=Math.min(l,-a)),(s&&"nw"===c||"n"===c||"ne"===c)&&(p=Math.min(p,-s));const g={unit:"px",x:0,y:0,width:0,height:0};"ne"===d?(g.x=t.startCropX,g.width=l,i?(g.height=g.width/i,g.y=t.startCropY-g.height):(g.height=Math.abs(p),g.y=t.startCropY-g.height)):"se"===d?(g.x=t.startCropX,g.y=t.startCropY,g.width=l,g.height=i?g.width/i:p):"sw"===d?(g.x=t.startCropX+l,g.y=t.startCropY,g.width=Math.abs(l),g.height=i?g.width/i:p):"nw"===d&&(g.x=t.startCropX+l,g.width=Math.abs(l),i?(g.height=g.width/i,g.y=t.startCropY-g.height):(g.height=Math.abs(p),g.y=t.startCropY+p));const w=_(g,i,d,r.width,r.height,a,s,n,o);return i||e.xyOrds.indexOf(c)>-1?h=w:e.xOrds.indexOf(c)>-1?(h.x=w.x,h.width=w.width):e.yOrds.indexOf(c)>-1&&(h.y=w.y,h.height=w.height),h.x=M(h.x,0,r.width-h.width),h.y=M(h.y,0,r.height-h.height),h}renderCropSelection(){const{ariaLabels:t=e.defaultProps.ariaLabels,disabled:i,locked:n,renderSelectionAddon:o,ruleOfThirds:r,crop:a}=this.props,s=this.getCropStyle();if(a)return D.createElement("div",{style:s,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":t.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!i&&!n&&D.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},D.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),D.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),D.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),D.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),D.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":t.nwDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"nw"),role:"button"}),D.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":t.nDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"n"),role:"button"}),D.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":t.neDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"ne"),role:"button"}),D.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":t.eDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"e"),role:"button"}),D.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":t.seDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"se"),role:"button"}),D.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":t.sDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"s"),role:"button"}),D.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":t.swDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"sw"),role:"button"}),D.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":t.wDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"w"),role:"button"})),o&&D.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:e=>e.stopPropagation()},o(this.state)),r&&D.createElement(D.Fragment,null,D.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),D.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(e){return R({...k,...this.props.crop||{}},e.width,e.height)}render(){const{aspect:e,children:t,circularCrop:i,className:n,crop:o,disabled:r,locked:a,style:s,ruleOfThirds:h}=this.props,{cropIsActive:d,newCropIsBeingDrawn:c}=this.state,l=o?this.renderCropSelection():null,p=((...e)=>e.filter((e=>e&&"string"==typeof e)).join(" "))("ReactCrop",n,d&&"ReactCrop--active",r&&"ReactCrop--disabled",a&&"ReactCrop--locked",c&&"ReactCrop--new-crop",o&&e&&"ReactCrop--fixed-aspect",o&&i&&"ReactCrop--circular-crop",o&&h&&"ReactCrop--rule-of-thirds",!this.dragStarted&&o&&!o.width&&!o.height&&"ReactCrop--invisible-crop",i&&"ReactCrop--no-animate");return D.createElement("div",{ref:this.componentRef,className:p,style:s},D.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},t),o?D.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},D.createElement("defs",null,D.createElement("mask",{id:`hole-${this.instanceId}`},D.createElement("rect",{width:"100%",height:"100%",fill:"white"}),i?D.createElement("ellipse",{cx:`${o.x+o.width/2}${o.unit}`,cy:`${o.y+o.height/2}${o.unit}`,rx:`${o.width/2}${o.unit}`,ry:`${o.height/2}${o.unit}`,fill:"black"}):D.createElement("rect",{x:`${o.x}${o.unit}`,y:`${o.y}${o.unit}`,width:`${o.width}${o.unit}`,height:`${o.height}${o.unit}`,fill:"black"}))),D.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,l)}};H.xOrds=["e","w"],H.yOrds=["n","s"],H.xyOrds=["nw","ne","se","sw"],H.nudgeStep=1,H.nudgeStepMedium=10,H.nudgeStepLarge=100,H.defaultProps={ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}};let B=H;var P=()=>i(219727),K=()=>i(142735),A=()=>i(846550),O=()=>i(492522),L=()=>i(265640),$=()=>i(312578),U=()=>i(708518),Y=()=>i(748621),z=()=>i(906651),X=()=>i(135499),N=()=>i(466970),T=()=>i(235453),V=()=>i(436929),W=()=>i(827973),F=()=>i(448419),q=(i(267602),i(653476),i(241792),()=>i(827282)),G=i(785893);const Q=(0,q().IU)("rectLandscape",{viewBox:"0 0 16 16",svg:(0,G.jsx)("path",{d:"M3.076 2.97h9.842c.629 0 1.105.16 1.43.48.328.321.492.796.492 1.425v6.24c0 .629-.164 1.103-.492 1.424-.325.32-.801.48-1.43.48H3.076c-.633 0-1.111-.16-1.435-.48-.325-.32-.487-.795-.487-1.424v-6.24c0-.63.162-1.104.487-1.424.324-.32.802-.48 1.435-.48zm.07 1.155c-.269 0-.476.07-.62.21-.145.141-.217.354-.217.64v6.046c0 .285.072.498.216.639.145.14.352.21.621.21h9.696c.273 0 .482-.07.627-.21.148-.141.222-.354.222-.639V4.974c0-.285-.074-.498-.222-.639-.145-.14-.354-.21-.627-.21H3.146z"})}),J=(0,q().IU)("rectLandscapeChecked",{viewBox:"0 0 16 16",svg:(0,G.jsx)("path",{fillRule:"evenodd",d:"M12.918 2.97H3.076c-.633 0-1.111.16-1.435.48-.325.321-.487.796-.487 1.425v6.24c0 .629.162 1.103.487 1.424.324.32.802.48 1.435.48h9.842c.629 0 1.105-.16 1.43-.48.328-.32.492-.795.492-1.424v-6.24c0-.63-.164-1.104-.492-1.424-.325-.32-.801-.48-1.43-.48zm-5.967 7.377a.569.569 0 00.454.217c.201 0 .356-.08.463-.237l2.728-4.175a.745.745 0 00.082-.17.516.516 0 00.026-.158.456.456 0 00-.138-.34.478.478 0 00-.348-.135.472.472 0 00-.243.059.593.593 0 00-.188.193L7.394 9.383l-1.22-1.508a.483.483 0 00-.389-.19.482.482 0 00-.351.137.46.46 0 00-.138.343c0 .06.01.119.032.175a.595.595 0 00.111.176l1.512 1.831z",clipRule:"evenodd"})}),ee=(0,q().IU)("rectPortait",{viewBox:"0 0 16 16",svg:(0,G.jsx)("path",{d:"M2.973 12.918v-9.84c0-.63.16-1.106.48-1.43.32-.328.795-.492 1.424-.492h6.24c.63 0 1.104.164 1.424.492.32.324.48.8.48 1.43v9.841c0 .633-.16 1.112-.48 1.436-.32.324-.795.486-1.424.486h-6.24c-.629 0-1.104-.162-1.424-.486-.32-.324-.48-.803-.48-1.435zm1.154-.07c0 .27.07.477.21.621.142.145.354.217.64.217h6.046c.286 0 .498-.072.64-.217.14-.144.21-.351.21-.62V3.152c0-.274-.07-.483-.21-.627-.142-.149-.354-.223-.64-.223H4.977c-.286 0-.498.074-.64.223-.14.144-.21.353-.21.627v9.695z"})}),te=(0,q().IU)("rectPortaitChecked",{viewBox:"0 0 16 16",svg:(0,G.jsx)("path",{fillRule:"evenodd",d:"M2.973 3.072v9.842c0 .632.16 1.11.48 1.435.32.324.795.486 1.424.486h6.24c.63 0 1.104-.162 1.424-.486.32-.324.48-.803.48-1.435V3.072c0-.63-.16-1.106-.48-1.43-.32-.328-.795-.492-1.424-.492h-6.24c-.629 0-1.104.164-1.424.492-.32.324-.48.8-.48 1.43zm3.978 7.273a.568.568 0 00.454.216.526.526 0 00.463-.237l2.728-4.175a.745.745 0 00.082-.17.516.516 0 00.026-.158.456.456 0 00-.138-.34.478.478 0 00-.348-.134.472.472 0 00-.243.058.593.593 0 00-.188.194L7.394 9.38l-1.22-1.509a.483.483 0 00-.389-.19.482.482 0 00-.351.137.46.46 0 00-.138.343c0 .06.01.12.032.176a.595.595 0 00.111.176l1.512 1.83z",clipRule:"evenodd"})});var ie=()=>i(135596),ne=()=>i(1910);function oe(e){const{aspectRatio:t,flipped:i,rowIsSelected:n}=e,o=(0,D.useMemo)((()=>n&&i?te:ee),[i,n]),r=(0,D.useMemo)((()=>n?i?Q:J:Q),[i,n]);return(0,G.jsxs)("div",{style:{transform:"translate(5px, 0px)"},children:[(0,G.jsx)(ne().Z,{icon:o,iconStyle:{width:16,height:16},ariaLabel:`${t} aspect ratio flipped`,onClick:()=>T().Z.setFixedAspectRatio(t,!0)}),(0,G.jsx)(ne().Z,{icon:r,iconStyle:{width:16,height:16},ariaLabel:`${t} aspect ratio`,onClick:()=>T().Z.setFixedAspectRatio(t,!1)})]})}const re=function(e){const t=(0,K().VK)((()=>{if(T().Z.state.open)return T().Z.state.fixedAspectSelection}),[]),i=(0,K().VK)((()=>!!T().Z.state.open&&T().Z.state.aspectSelectionFlipped),[]),n=(0,N().E)("image_cropping_aspect_ratios"),[o,r]=(0,D.useState)();return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(W().Z,{focused:!1,onClick:()=>T().Z.setFixedAspectRatio("1:1",!1),title:"Square",right:"1:1"===t?e.checkIcon:void 0},"1:1 aspect ratio"),n&&Object.keys(ie().V3).filter((e=>"1:1"!==e)).map((n=>{const{width:a,height:s}=ie().V3[n],h=function(e,t,i){return i?`${t}:${e}`:`${e}:${t}`}(a,s,i),d=t===n,c=o===n?(0,G.jsx)(oe,{aspectRatio:n,flipped:i,rowIsSelected:d}):d?e.checkIcon:void 0;return(0,G.jsx)(W().Z,{focused:!1,onMouseEnter:()=>r(n),onMouseLeave:()=>r(void 0),onClick:()=>T().Z.setFixedAspectRatio(n,i),title:h,right:c},h)}))]})};const ae=function(e){const t=(0,K().VK)((()=>{var e;return null===(e=T().Z.getEditMetadata())||void 0===e?void 0:e.mask}),[]),n=(0,K().VK)((()=>T().Z.state.open&&T().Z.state.fixedAspectSelection),[]),o=(0,N().E)("image_cropping_reset"),r="None"===t&&void 0===n,a=(0,A().yK)((e=>({shapeText:{fontSize:13,color:e.icon.secondary,marginRight:5},button:{display:"flex",color:e.icon.secondary},divider:{color:e.stroke.secondary,opacity:.2},filledIcon:{width:20,transform:"translate(2px, 2px)",fill:e.blueButtonBackground},checkIcon:{width:14,height:14,color:e.icon.secondary}})),[]),h=(0,D.useMemo)((()=>r?(0,i(366636).Z)({width:20}):(0,i(811223).h)(a.filledIcon)),[r,a.filledIcon]),d=(0,D.useMemo)((()=>(0,i(235605).k)(a.checkIcon)),[a.checkIcon]);return(0,G.jsx)(F().ZP,{alignmentToOrigin:i(998901).Alignment.Start,renderOrigin:e=>{let{onClick:t}=e;return(0,G.jsxs)(i(209264).D,{onClick:t,style:a.button,children:[o&&(0,G.jsx)("div",{style:a.shapeText,children:(0,G.jsx)(s()._H,{id:"imageEditModal.shape",defaultMessage:"Shape"})}),h,(0,i(374289).i)({width:10,marginLeft:2})]})},popupType:F().Z4.Popup,render:()=>(0,G.jsx)(i(198829).Z,{menuType:i(352230).o.Popup,children:(0,G.jsxs)(i(388284).Z,{children:[(0,G.jsx)(W().Z,{focused:!1,onClick:()=>T().Z.setMask("None"),title:"Freeform",right:r?d:void 0},"free-mask"),(0,G.jsx)("hr",{style:a.divider}),(0,G.jsx)(W().Z,{focused:!1,onClick:()=>T().Z.setMask("Circle"),title:"Circle",right:"Circle"===t?d:void 0},"circle-mask"),(0,G.jsx)(re,{checkIcon:d})]})})})};function se(e){const t=(0,P().O7)(),i=(0,s().vU)({image:{id:"imageEditModal.image.altText",defaultMessage:"Original image to edit"}}),n=(0,K().Kw)(T().Z),o=(0,K().VK)((()=>T().Z.getIsImageLoaded()),[]),r=(0,K().VK)((()=>T().Z.getEditMetadata()),[]),[a,h]=(0,D.useState)(),[d,c]=(0,D.useState)(),l=(0,K().VK)((()=>{if(a)return a.width<300}),[a]),p=(0,D.useRef)(null),w=function(e){const{isImageLoaded:t,outerContainerSize:i,innerContainerSize:n}=e;return(0,A().yK)((e=>({modal:{display:"flex",visibility:t?"visible":"hidden"},modalInnerStyle:{borderRadius:"12px"},cropMask:{color:e.white,opacity:e.cropMaskOpacity},container:{flexDirection:"column",justifyContent:"center",alignItems:"center"},outerImageContainer:{...i,display:"flex",justifyContent:"center",alignItems:"center",transition:"all 0.2s ease-out",position:"relative",overflow:"hidden"},innerImageContainer:{maxWidth:"70vw",maxHeight:"75vh",position:n?"absolute":void 0,...n},cropWindow:{padding:"30px",background:e.surface.wash,overflow:"hidden",display:"flex",justifyContent:"center"},image:{width:"100%",height:"100%",objectFit:"contain"},loadingSpinner:{display:t?"none":"block"},loadingSpinnerOverlay:{zIndex:O().mJ,width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:e.overlaySmokescreen}})),[t,i,n])}({isImageLoaded:o,outerContainerSize:a,innerContainerSize:d});(0,D.useEffect)((()=>{if(document.documentElement.style.setProperty("--crop-mask-color",w.cropMask.color),document.documentElement.style.setProperty("--crop-mask-opacity",w.cropMask.opacity),d){const e=d.width<y||d.height<y;document.documentElement.style.setProperty("--cardinal-handle-visibility",e?"hidden":"visible")}}),[w.cropMask,d]);const u=(0,D.useCallback)((e=>{h(e),c(e)}),[]);(0,D.useLayoutEffect)((()=>{if(o&&!a&&p.current){const e=ce(p.current);u(e)}}),[o,a,u]);const m=(0,D.useCallback)((()=>{if(p.current){const e=ce(p.current);u(e)}}),[u]);(0,D.useEffect)((()=>(window.addEventListener("resize",m),()=>window.removeEventListener("resize",m))),[m]);const x=(0,D.useCallback)((()=>{h(void 0),c(void 0)}),[]);function v(e){var t;T().Z.setIsImageLoaded(e),null===(t=document.querySelector(".ReactCrop__crop-mask"))||void 0===t||t.setAttribute("height","100%")}return(0,D.useEffect)((()=>{n.open||x()}),[x,n.open]),n.open?(0,G.jsxs)("div",{children:[(0,G.jsx)(Y().Z,{open:n.open&&!o,children:(0,G.jsx)("div",{style:w.loadingSpinnerOverlay,children:(0,G.jsx)($().Z,{onDarkBackground:!0,legacySize:32,style:w.loadingSpinner})})}),(0,G.jsx)(U().Z,{style:w.modal,innerStyle:w.modalInnerStyle,open:n.open,onDismiss:de,render:()=>(0,G.jsx)("div",{style:w.container,children:(0,G.jsx)(X().Z,{width:window.innerWidth,url:n.originalSource,render:(e,o)=>(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(he,{hideTitle:l,onSave:()=>{var e;n.open&&(e={editMetadata:r,store:n.blockStore,environment:t},C().Z.setStatusPending(e.store.id,e.editMetadata),(0,V().tc)(e.store,e.environment),T().Z.setSaveButtonLoading(!0),setTimeout((()=>{T().Z.closeModal()}),750))},onClose:()=>{de()}}),(0,G.jsx)("div",{style:w.cropWindow,children:(0,G.jsx)(B,{onChange:(e,t)=>{T().Z.setCrop(t)},crop:r.crop,minHeight:y,minWidth:y,keepSelection:!0,aspect:n.open&&n.cropAspect,circularCrop:"Circle"===(null==r?void 0:r.mask),children:(0,G.jsx)("div",{style:w.outerImageContainer,children:(0,G.jsx)("div",{style:w.innerImageContainer,children:(0,G.jsx)("img",{ref:p,src:o,alt:g().Z.formatMessage(i.image),onLoad:()=>v(p),style:w.image})})})})})]}),isAuthenticated:!0,permissionRecord:n.blockStore.pointer})})})]}):null}function he(e){const{onSave:t,onClose:i,hideTitle:n}=e,o=(0,A().yK)((e=>({toolbar:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%",background:e.modalBackground,borderBottom:`1px solid ${e.stroke.secondary}`,padding:"12px"},buttonGroup:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",gap:"5px"},title:{position:"absolute",marginLeft:"auto",marginRight:"auto",left:0,right:0,textAlign:"center",width:"fit-content",fontWeight:"400"},resetButton:{fontSize:13,color:e.icon.secondary}})),[]),r=(0,K().VK)((()=>T().Z.state.open&&T().Z.state.saveButtonLoading),[]),a=(0,N().E)("image_cropping_reset");return(0,G.jsxs)("div",{style:o.toolbar,children:[(0,G.jsxs)("div",{style:o.buttonGroup,children:[(0,G.jsx)(ae,{}),a&&(0,G.jsx)(L().D,{onClick:()=>T().Z.resetCrop(),isGray:!0,style:o.resetButton,children:(0,G.jsx)(s()._H,{id:"imageEditModal.reset",defaultMessage:"Reset"})})]}),!n&&(0,G.jsx)("div",{style:o.title,children:(0,G.jsx)(s()._H,{id:"imageEditModal.title",defaultMessage:"Crop image"})}),(0,G.jsxs)("div",{style:o.buttonGroup,children:[(0,G.jsx)(L().D,{onClick:i,isGray:!0,children:(0,G.jsx)(s()._H,{id:"imageEditModal.cancelButton.label",defaultMessage:"Cancel"})}),(0,G.jsx)(z().Z,{onClick:t,isLoading:r,children:(0,G.jsx)(s()._H,{id:"imageEditModal.saveButton.label",defaultMessage:"Save"})})]})]})}function de(){T().Z.closeModal()}function ce(e){const t=e.naturalWidth/e.naturalHeight;let i=e.height*t,n=e.height;return i>e.width&&(i=e.width,n=e.width/t),{width:i,height:n}}},366636:(e,t,i)=>{i.d(t,{Z:()=>o});i(667294);var n=i(785893);const o=(0,i(827282).IU)("squareOnCircle",{viewBox:"0 0 20 20",svg:(0,n.jsx)("path",{d:"M2.07031 7.85645C2.07031 7.05436 2.2207 6.30469 2.52148 5.60742C2.82227 4.91016 3.23926 4.2972 3.77246 3.76855C4.30566 3.23991 4.92318 2.8252 5.625 2.52441C6.33138 2.21908 7.08561 2.06641 7.8877 2.06641C8.57585 2.06641 9.22982 2.18034 9.84961 2.4082C10.4694 2.63151 11.0322 2.94596 11.5381 3.35156C12.0439 3.75716 12.4701 4.2334 12.8164 4.78027C13.1673 5.32715 13.4157 5.92188 13.5615 6.56445H12.2354C12.0531 5.94466 11.7477 5.39323 11.3193 4.91016C10.8955 4.42708 10.3874 4.04655 9.79492 3.76855C9.20703 3.49056 8.57129 3.35156 7.8877 3.35156C7.26335 3.35156 6.67546 3.46777 6.12402 3.7002C5.57259 3.93262 5.08952 4.25618 4.6748 4.6709C4.26009 5.08561 3.93424 5.56641 3.69727 6.11328C3.46484 6.6556 3.34863 7.23665 3.34863 7.85645C3.34863 8.58561 3.50814 9.26237 3.82715 9.88672C4.15072 10.5065 4.58822 11.0283 5.13965 11.4521C5.69108 11.8714 6.31771 12.1471 7.01953 12.2793V13.5781C6.31771 13.4779 5.66602 13.2591 5.06445 12.9219C4.46289 12.5846 3.9388 12.1608 3.49219 11.6504C3.04557 11.1354 2.69694 10.5566 2.44629 9.91406C2.19564 9.26693 2.07031 8.58105 2.07031 7.85645ZM8.75586 17.4678C8.01758 17.4678 7.45931 17.2809 7.08105 16.9072C6.7028 16.5335 6.51367 15.9798 6.51367 15.2461V8.27344C6.51367 7.54427 6.7028 6.99284 7.08105 6.61914C7.45931 6.24089 8.01758 6.05176 8.75586 6.05176H15.6807C16.4189 6.05176 16.9772 6.24089 17.3555 6.61914C17.7337 6.99284 17.9229 7.54427 17.9229 8.27344V15.2461C17.9229 15.9798 17.7337 16.5335 17.3555 16.9072C16.9772 17.2809 16.4189 17.4678 15.6807 17.4678H8.75586ZM8.83789 16.1279H15.5986C15.9176 16.1279 16.1615 16.0436 16.3301 15.875C16.4987 15.7064 16.583 15.458 16.583 15.1299V8.39648C16.583 8.0638 16.4987 7.81543 16.3301 7.65137C16.1615 7.48275 15.9176 7.39844 15.5986 7.39844H8.83789C8.52344 7.39844 8.2819 7.48275 8.11328 7.65137C7.94466 7.81543 7.86035 8.0638 7.86035 8.39648V15.1299C7.86035 15.458 7.94466 15.7064 8.11328 15.875C8.2819 16.0436 8.52344 16.1279 8.83789 16.1279Z"})})},811223:(e,t,i)=>{i.d(t,{h:()=>o});i(667294);var n=i(785893);const o=(0,i(827282).IU)("squareOnCircleFilled",{viewBox:"0 0 20 20",svg:(0,n.jsx)("path",{d:"M4.53809 13.4795V6.56836C4.53809 5.83464 4.72721 5.28092 5.10547 4.90723C5.48372 4.53353 6.04427 4.34668 6.78711 4.34668H13.6504C14.3887 4.34668 14.9469 4.53353 15.3252 4.90723C15.7035 5.28092 15.8926 5.83464 15.8926 6.56836V13.4795C15.8926 14.2132 15.7035 14.7669 15.3252 15.1406C14.9469 15.5143 14.3887 15.7012 13.6504 15.7012H6.78711C6.04427 15.7012 5.48372 15.5143 5.10547 15.1406C4.72721 14.7669 4.53809 14.2132 4.53809 13.4795ZM6.78711 3.34863C6.10807 3.34863 5.52474 3.47852 5.03711 3.73828C4.55404 3.99349 4.1849 4.36263 3.92969 4.8457C3.67448 5.32422 3.54688 5.89844 3.54688 6.56836V11.4629C2.85872 11.1621 2.25033 10.7451 1.72168 10.2119C1.19303 9.67871 0.780599 9.06348 0.484375 8.36621C0.188151 7.66439 0.0400391 6.91471 0.0400391 6.11719C0.0400391 5.3151 0.19043 4.56315 0.491211 3.86133C0.791992 3.15951 1.20898 2.54199 1.74219 2.00879C2.27539 1.47559 2.8929 1.05859 3.59473 0.757812C4.30111 0.452474 5.05534 0.299805 5.85742 0.299805C6.59115 0.299805 7.28385 0.429688 7.93555 0.689453C8.58724 0.944661 9.17057 1.30241 9.68555 1.7627C10.2051 2.21842 10.6289 2.74707 10.957 3.34863H6.78711Z"})})}}]);