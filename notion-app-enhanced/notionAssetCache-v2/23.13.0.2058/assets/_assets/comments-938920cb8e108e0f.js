(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[58324,95986,93843,75751],{147249:(e,t,o)=>{"use strict";o.d(t,{K:()=>i,y:()=>s});var n=()=>o(594546);function i(e,t){const{from:o}=t;n().K4(e,"show_tooltip",{from:o,time:Date.now()})}function s(e,t){const{from:o}=t;n().K4(e,"dismiss_tooltip",{from:o,time:Date.now()})}},169793:(e,t,o)=>{"use strict";o.d(t,{ND:()=>D,RD:()=>R,gc:()=>A,gl:()=>T,u7:()=>M});var n=o(667294),i=()=>o(219727),s=()=>o(142735),r=()=>o(156642),a=()=>o(575861),l=()=>o(788860),c=()=>o(696459),d=()=>o(147249),u=()=>o(905263),m=()=>o(982855),p=()=>o(191003),g=()=>o(550054),h=()=>o(803728),f=()=>o(110372),v=()=>o(156538),S=()=>o(876822),x=()=>o(890324),b=()=>o(826955),C=()=>o(127519),y=()=>o(343353),w=()=>o(559155),k=()=>o(656801),j=o(785893);const _=1,I=1,L=(0,l().vU)({spaceForAiHeader:{id:"AiOnboardingTooltips.spaceForAi.header",defaultMessage:"Press ‘space’ for AI"},spaceForAiContent:{id:"AiOnboardingTooltips.spaceForAi.content",defaultMessage:"On a new line or page, press ‘space’ on your keyboard for AI to generate or edit the page. Try it now!"},askAiAnythingHeader:{id:"AiOnboardingTooltips.askAiAnything.header",defaultMessage:"Ask AI anything"},askAiAnythingContent:{id:"AiOnboardingTooltips.askAiAnything.content",defaultMessage:"Just tell AI what to do — the more details, the better. You can also start from an example in the menu."},refineAiResponseHeader:{id:"AiOnboardingTooltips.refineAiResponse.header",defaultMessage:"Tell AI what to do next"},refineAiResponseContent:{id:"AiOnboardingTooltips.refineAiResponse.content",defaultMessage:"How was it? Give AI further instructions to improve what it wrote, or hit ‘Done’ when finished."},showAssistantLocationHeader:{id:"AiOnboardingTooltips.showAssistantLocation.answersToYourQuestionHeader",defaultMessage:"Ask AI when searching"},showAssistantLocationContent:{id:"AiOnboardingTooltips.showAssistantLocation.askQuestionBody",defaultMessage:"AI can find pages and synthesize a quick, concise answer for you. Try it now."},showAssistantOriginElementLocationHeader:{id:"AiOnboardingTooltips.ShowAssistantOriginElementLocationTooltip.header",defaultMessage:"Start by asking a question"},showAssistantOriginElementLocationContent:{id:"AiOnboardingTooltips.ShowAssistantOriginElementLocationTooltip.content",defaultMessage:"Notion AI will find pages and compose a concise answer for you. Try it now."}});function M(){const e=(0,i().O7)(),t=function(){const e=(0,i().O7)(),t=(0,s().VK)((()=>{var e;return null===(e=S().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),o=(0,s().VK)((()=>{const t=S().default.state.mainEditorCurrentBlockStore;return t&&x().Z.getMode(e,t)}),[e]);return(0,s().VK)((()=>{if(e.device.isMobile)return;const{currentUserSettingsStore:n,inAppCalloutStore:i}=S().default.state;if(!i.getCalloutVisibility("ai_onboarding_tooltip").canShow)return;const s=null==n?void 0:n.getSettings();if(!s)return;if((0,c().$K)(s.last_used_ai_writer_at))return;if("tooltip"!==s.ai_assistant_onboarding_phase)return;if((0,w().$_)(e,t)){if(!(0,c().$K)(s.ai_sales_assisted_extra_notification_seen_at)||(0,a().O5)(s.ai_sales_assisted_extra_notification_seen_at)<I)return}else if((0,c().$K)(s.ai_assistant_onboarding_phase_last_set_at)&&(0,a().O5)(s.ai_assistant_onboarding_phase_last_set_at)<_)return;if("space_for_ai"!==(0,k().sy)())return;if(!(0,m().GD)(o))return;const l=C().default.state;if("editing"===l.mode){const e=(0,p().QY)(l.multiSelection);if(e&&(0,g().wd)(e.selection)){const t=e.store,o=v().E.findEditableWithStore(t);if(o){const e="block"===t.pointer.table?b().G.createChildStore(t,t.pointer):void 0,n=e&&e.getType(),i=Boolean(n&&(0,r().hD)(n)),s=t.getValue();if(i&&!s)return o}}}}),[e,o,t])}(),[o,d]=(0,n.useState)(!1),h=(0,n.useCallback)((()=>{d(!0)}),[]),f=!o&&Boolean(t);return(0,n.useEffect)((()=>()=>{f&&(0,k().fz)(e)}),[e,f]),f&&t?(0,j.jsx)(u().U,{origin:()=>t.getNode(),placementToOrigin:"bottom",header:(0,j.jsx)(l()._H,{...L.spaceForAiHeader}),content:(0,j.jsx)(l()._H,{...L.spaceForAiContent}),onCloseClick:h}):null}function R(e){const{originRef:t,openState:o}=e,r=(0,i().O7)(),a=(0,s().VK)((()=>(0,k().sy)()),[]),[c,d]=(0,n.useState)(!1),m=(0,n.useCallback)((()=>{d(!0)}),[]),p="ask_ai_anything"===a&&"initialPrompt"===o.stage&&!c;return(0,n.useEffect)((()=>()=>{!r.device.isMobile&&p&&(0,k().fz)(r)}),[r,p]),r.device.isMobile||!p?null:(0,j.jsx)(u().U,{origin:t,placementToOrigin:"top",header:(0,j.jsx)(l()._H,{...L.askAiAnythingHeader}),content:(0,j.jsx)(l()._H,{...L.askAiAnythingContent}),onCloseClick:m})}function T(e){const{originRef:t,openState:o,isInputEmpty:r}=e,a=(0,i().O7)(),c=(0,s().VK)((()=>(0,k().sy)()),[]),[d,m]=(0,n.useState)(!1),p=(0,n.useCallback)((()=>{m(!0)}),[]),g="refine_ai_response"===c&&"results"===o.stage&&!o.loading&&"cursor"===o.context.type&&r&&!d;return(0,n.useEffect)((()=>()=>{!a.device.isMobile&&g&&(0,k().fz)(a)}),[a,g]),a.device.isMobile?null:(0,j.jsx)(u().U,{origin:g?t:void 0,placementToOrigin:"right",pointerOffset:-4,pointerLength:25,header:(0,j.jsx)(l()._H,{...L.refineAiResponseHeader}),content:(0,j.jsx)(l()._H,{...L.refineAiResponseContent}),onCloseClick:p})}function D(e){const{origin:t}=e,o=(0,i().O7)();(0,n.useEffect)((()=>{d().K(o,{from:"qna_button"}),f().gF(o,{callout_key:"ai_assistant_origin_element_tooltip"})}),[o]);const s=(0,n.useCallback)((()=>{const{currentUserSettingsStore:e}=S().default.state;e&&(d().y(o,{from:"qna_button"}),f().bl(o,{callout_key:"ai_assistant_origin_element_tooltip",dismiss_type:"tooltip_dismiss"}),(0,y().setQnaOnboardingPhase)(o,{phase:"complete",transactionUserAction:"AiQnaIntroModal.debug.clickTooltipComplete",userSettingsStore:e}),h().Gi(o,"ai_assistant_origin_element_tooltip"))}),[o]);return(0,j.jsx)(u().U,{style:{width:250},pointerLength:25,pointerPosition:"94%",origin:t,placementToOrigin:"top",header:(0,j.jsx)(l()._H,{...L.showAssistantOriginElementLocationHeader}),content:(0,j.jsx)(l()._H,{...L.showAssistantOriginElementLocationContent}),onCloseClick:s})}function A(e){const{origin:t}=e,o=(0,i().O7)();(0,n.useEffect)((()=>{d().K(o,{from:"qna_search"})}),[o]);const s=(0,n.useCallback)((()=>{const{currentUserSettingsStore:e}=S().default.state;e&&(d().y(o,{from:"qna_search"}),(0,y().setQnaOnboardingPhase)(o,{phase:"complete",transactionUserAction:"AiQnaIntroModal.debug.clickTooltipComplete",userSettingsStore:e}))}),[o]);return(0,j.jsx)(u().U,{style:{width:250},pointerLength:25,pointerPosition:"5%",origin:t,placementToOrigin:"bottom",header:(0,j.jsx)(l()._H,{...L.showAssistantLocationHeader}),content:(0,j.jsx)(l()._H,{...L.showAssistantLocationContent}),onCloseClick:s})}(0,o(100056).exposeDebugEnvironmentValue)("resetAIOnboarding",(e=>()=>{const{currentUserSettingsStore:t}=S().default.state;t&&o(269299).createAndCommit({userAction:"AiIntroModal.debugging.resetAIOnboarding",environment:e,canUndo:!0,perform:e=>{o(348141).d2({userSettingsStore:t,transaction:e,data:{ai_onboarding_phase:"space_for_ai"}})},userId:t.id})}))},579217:(e,t,o)=>{"use strict";o.d(t,{_:()=>s,s:()=>i});var n=()=>o(677559);const i=(0,n().kF)(new(n().Ss)("UniversalQnaModals",(async()=>await Promise.all([o.e(62743),o.e(37358),o.e(7312),o.e(31189),o.e(69343),o.e(2933),o.e(7678),o.e(20919),o.e(52435),o.e(75066),o.e(37317),o.e(78517),o.e(93843),o.e(58183)]).then(o.bind(o,960872)))),(e=>e.UniversalQnaModals)),s=(0,n().kF)(new(n().Ss)("SlackConnectionOptions",(async()=>await o.e(16982).then(o.bind(o,945272)))),(e=>e.SlackConnectionOptions))},493843:(e,t,o)=>{"use strict";o.d(t,{$o:()=>N,Fv:()=>F,IL:()=>Y,J4:()=>U,KA:()=>Z,Nf:()=>P,_p:()=>G,cQ:()=>W,f$:()=>K,fX:()=>z,j2:()=>E,k2:()=>q,mg:()=>J,mz:()=>O,oP:()=>V,tF:()=>X,td:()=>H,x:()=>$});o(670560),o(267602),o(470928),o(30005),o(241792),o(228244);var n=()=>o(730120),i=()=>o(492788),s=()=>o(506347),r=()=>o(926724),a=()=>o(331540),l=()=>o(874459),c=()=>o(998411),d=()=>o(35980),u=()=>o(513670),m=()=>o(696459),p=()=>o(250303),g=()=>o(384667),h=()=>o(366257),f=()=>o(139224),v=()=>o(421654),S=()=>o(636340),x=()=>o(531515),b=()=>o(47443),C=()=>o(794586),y=()=>o(879952),w=()=>o(970105),k=()=>o(990966),j=()=>o(269299),_=()=>o(715146),I=()=>o(887430),L=()=>o(861026),M=()=>o(804217),R=()=>o(826955),T=()=>o(965903),D=()=>o(807230),A=()=>o(701182),B=()=>o(645843);function E(e){const{collectionViewStore:t,collectionContextStore:o,timelineState:n,environment:i}=e,s=i.currentUser.id,r=(0,A().B8)(t.id),a=(0,A().pQ)(t,i),l=o.permissionScopesStore.state,c=u().Ds((()=>{if(n.destroyed)return;const e={zoomLevel:n.zoomLevel.state,centerTimestamp:(0,A().al)(n)};d().Z.set({userId:s,key:r,value:e})}),1e3),m=u().Ds((()=>{if(n.destroyed||!M().default.state.online||!i.currentUser.isLoggedIn()||!l.canConfigureBlock)return;const e={zoomLevel:n.zoomLevel.state,centerTimestamp:(0,A().al)(n)},o=t.getFormat().timeline_preference;u().Xy(o,e)||j().createAndCommit({userAction:"collectionTimelineViewActions.setRemotePreference",environment:i,canUndo:!0,perform:o=>{v().FH({stores:[t],update:{timeline_preference:e},transaction:o})}})}),5e3);n.savePreference=()=>{c(),m()},P({timelineState:n,environment:i,...a})}function P(e){const{timelineState:t,zoomLevel:o,centerTimestamp:n,environment:s}=e,{savePreference:r}=t,a=s.WindowSizeStore.state.width+2*A().Ge,l=(0,A().x2)(o,a),c=n-l/2,d=n+l/2;t.zoomLevel.setState(o),t.currentRange.setState({startTimestamp:c,endTimestamp:d}),i().default.afterNextFlush((()=>{Z({timelineState:t,centerTimestamp:n}),r&&r()}))}function Z(e){const{timelineState:t,centerTimestamp:o}=e,{horizontalScroller:n,outerSizeObserver:i}=t;if(!n)return;const s=t.zoomLevel.state,{startTimestamp:r,endTimestamp:a}=t.currentRange.state,l=i.rect.state.width;if(l===(0,A().e$)(s,a-r))return;const c=(0,A().e$)(s,o-r)-l/2;n.scrollLeft=c,t.scrollLeft.setState(c)}function V(e){const{environment:t,store:o,query:n,date:i,schema:s,transaction:r}=e,{timeline_by:a}=n;if(!a)return;const l=o.getAssociatedCollectionStore(),c=(null==l?void 0:l.getMappedProperty(a))??a,d=n.timeline_by_end?(null==l?void 0:l.getMappedProperty(n.timeline_by_end))??n.timeline_by_end:void 0,u=(0,A().TW)({store:o,dateValue:i,query:n,schema:(null==l?void 0:l.getSchema())??s}),m=o.getPropertyValue(c),p=d?o.getPropertyValue(d):void 0;return S().sW({store:o.getPropertiesStore(),data:u,transaction:r}),h().H({environment:t,store:o,dateProperty:{id:c,newValue:(null==u?void 0:u[c])??[],oldValue:m},otherDateProperty:d?{id:d,newValue:(null==u?void 0:u[d])??[],oldValue:p}:void 0}),o}function F(e){var t;const{environment:o,timelineState:i,collectionStore:s,collectionContextStore:r,store:a,query:d,groupFormat:u,transaction:m}=e,p=i.zoomLevel.state,h=(0,A().al)(i),{snapUnit:f,getDateRangePlaceholderDuration:v}=A().BJ[p],{timeline_by:S}=d;if(!S)return;const x=null===(t=r.groupsStore.getGroupState(u))||void 0===t?void 0:t.resultsStore.state;if(!x)return;const b=n().ou.fromMillis(h),C=(0,A().DS)(b,f),y=(0,A().DS)(v(b),f),w=(0,A().AZ)({startValue:(0,l().Lg)((0,c().r)()),snapUnit:f,desiredStart:C,desiredEnd:y});return V({environment:o,store:a,query:d,schema:s.getSchema(),date:w,transaction:m}),g().$T({environment:o,collectionStore:s,before:!0,store:x[0],insertStores:[a],collectionContextStore:r,groupsPointer:u?[u]:[],transaction:m}),a}function K(e){const{type:t,timelineState:o,store:n,startX:i,query:s,schema:r,intl:a,environment:l}=e,{horizontalScroller:c}=o,{startTimestamp:d}=o.currentRange.state;if(!c)return;y().Ys({environment:l,store:n});const m=c.scrollLeft,{stores:p}=T().default.state,g=u().oA(p.map((e=>{const t=(0,A().bk)({store:e,query:s,schema:r,userId:l.currentUser.id,intl:a,formulasModule:void 0});if(t)return{startValue:t,store:e}})));o.dragState.setState({type:t,startStore:n,stores:g.map((e=>{let{store:t}=e;return t})),startValues:g.map((e=>{let{startValue:t}=e;return t})),temporaryValues:g.map((e=>{let{startValue:t}=e;return t})),startX:i,startStartTimestamp:d,startScrollLeft:m})}function U(e){const{timelineState:t,store:o,startX:n,startY:i,schema:s,collectionContextStore:r,verticalScroller:a}=e,{horizontalScroller:l}=t,{startTimestamp:c}=t.currentRange.state;if(!l||!a)return;const d=l.scrollLeft,u=a.scrollTop,m=(0,A().YE)(r,o,s);t.drawState.setState({startStore:o,startDependencyRelationPointers:m,temporaryDependencyRelationPointers:[...m],startX:n,startY:i,startScrollLeft:d,startScrollTop:u,startStartTimestamp:c,xOffsetPx:0,yOffsetPx:0,tryToCompleteDrawnArrow:!1})}function H(e){const{timelineState:t,currentX:o}=e,{horizontalScroller:n}=t,i=t.zoomLevel.state,s=t.dragState.state,{startTimestamp:r}=t.currentRange.state;if(!s||!n)return;const{type:a,startStartTimestamp:c,startValues:d,startScrollLeft:p,startX:g,startStore:h,stores:f}=s,v=A().BJ[i],{snapUnit:S}=v,x=n.scrollLeft-p+(o-g)+(0,A().e$)(i,r-c),b=(0,A().x2)(i,x),C=d[f.indexOf(h)];let y;if(a===A().px.LeftResizer){const{start:e}=(0,A().XO)(C,S),t=e.plus(b);y=d.map((e=>{const o=(0,A().AZ)({startValue:e,snapUnit:S,desiredStart:t});return(0,l().gW)(o)}))}else if(a===A().px.RightResizer){const{end:e}=(0,A().XO)(C,S),t=e.plus(b);y=d.map((e=>{const o=(0,A().AZ)({startValue:e,snapUnit:S,desiredEnd:t});return(0,l().Qq)(o)}))}else a===A().px.ItemDrag?y=d.map((e=>{const{start:t,end:o}=(0,A().XO)(e,S),n=t.plus(b),i=n.plus(o.valueOf()-t.valueOf());return(0,A().AZ)({startValue:e,snapUnit:S,desiredStart:n,desiredEnd:i})})):(0,m().t1)(a);u().Xy(s.temporaryValues,y)||t.dragState.setState({...s,temporaryValues:y})}function O(e){const{timelineState:t,currentX:o,currentY:n,verticalScroller:i}=e,s=t.drawState.state,r=t.zoomLevel.state,{startTimestamp:a}=t.currentRange.state,{horizontalScroller:l}=t;if(!s||!l||!i)return;const{startDependencyRelationPointers:c,startStore:d,startX:m,startY:p,startScrollLeft:g,startScrollTop:h,startStartTimestamp:f}=s,v=l.scrollLeft,S=i.scrollTop,x=v-g+(o-m)+(0,A().e$)(r,a-f),b=S-h+(n-p),C=t.hoveredItem.state;if(C&&C!==d&&!c.some((e=>e.id===C.id))){const e=[...c,{table:"block",id:C.id,spaceId:C.getSpaceId()}];u().Xy(s.temporaryDependencyRelationPointers,e)||t.drawState.setState({...s,temporaryDependencyRelationPointers:e,xOffsetPx:void 0,yOffsetPx:void 0})}else t.drawState.setState({...s,temporaryDependencyRelationPointers:[...c],xOffsetPx:x,yOffsetPx:b})}function z(e){const{environment:t,collectionContextStore:o,timelineState:n,query:i,schema:s,transaction:r}=e,a=n.dragState.state,{timeline_by:l}=i;if(!a||!l)return;const{temporaryValues:c,stores:d}=a;c.forEach(((e,n)=>{const a=d[n];V({environment:t,store:a,query:i,schema:s,transaction:r,date:e}),p().rv({environment:t,collectionContextStore:o,block_id:a.id,property:l,property_type:"date",from:"timeline"})})),n.dragState.setState(void 0)}function N(e){var t;const{timelineState:o,environment:n,transaction:i,collectionContextStore:s,isFullScreen:r,isRootChild:a}=e,l=o.drawState.state,c=o.dateRangePlaceholder.state;if(!l)return;const{startStore:d,startDependencyRelationPointers:u,temporaryDependencyRelationPointers:m}=l;if(!d)return void o.drawState.setState(void 0);let g;if(c.active){const{date:e,store:t,parentStore:r,groupFormat:a,newTimelineItemProps:l,existingTimelineItemProps:u}=c;if(t&&u){const{query:o,schema:s}=u;V({environment:n,store:t,query:o,schema:s,date:e,transaction:i}),g={table:"block",id:t.id,spaceId:d.getSpaceId()}}else if(l){const{query:o,schema:c,isFullScreen:u,canEditTimelineItems:m,subitemPath:p}=l,h=J({environment:n,date:e,store:t,parentStore:r,query:o,schema:c,isFullScreen:u,groupFormat:a,canEditTimelineItems:m,collectionContextStore:s,subitemPath:p,transaction:i,from:"timeline_complete_draw"});h&&(g={table:"block",id:h.id,spaceId:d.getSpaceId()})}o.dateRangePlaceholder.setState({active:!1})}else g=m.find((e=>!u.includes(e)));const h=(0,A()._e)(s);if(h){const{property:e}=h;g&&(x().hE({environment:n,propertyWithInverse:h,sourceStore:d,destStore:R().G.createChildStore(d,g),position:{type:"after"},transaction:i}),p().rv({environment:n,collectionContextStore:s,block_id:d.id,property:e,property_type:"relation",from:"timeline",isFromBulkActionsToolbar:!1,isUnthrottled:!0})),o.drawState.setState(void 0)}else f().wl({item:{type:"dependencies",from:"view_options"},collectionSettingsStore:s.settingsStore}),o.drawState.setState({...l,tryToCompleteDrawnArrow:!0});const v=null===(t=g)||void 0===t?void 0:t.id;v&&(0,B().LE)(n,{...(0,L().Pn)(s),...(0,B().Ii)({environment:n,collectionContextStore:s,timelineState:o,isFullScreen:r,isRootChild:a}),dependenciesPropertyID:null==h?void 0:h.property,blockedByStoreID:d.id,blockingStoreID:v})}function W(e){const{timelineState:t,environment:o}=e;t.dragState.state&&(t.dragState.setState(void 0),y().ZH({environment:o}))}function $(e){const{timelineState:t,environment:o}=e;t.drawState.state&&(t.drawState.setState(void 0),y().ZH({environment:o}))}function q(e){const{stores:t,collectionViewStore:o,schema:n,transaction:i}=e,s=o.getType(),r=o.getQuery(n),a=[];r&&("calendar"===s?r.calendar_by&&a.push(r.calendar_by):"timeline"===s&&(r.timeline_by&&a.push(r.timeline_by),r.timeline_by_end&&a.push(r.timeline_by_end)));for(const l of t)for(const e of a)w().sO({environment:l.environment,store:l.getPropertyStore(e),value:void 0,transaction:i})}function Y(e){const{dependency:t,collectionContextStore:o,environment:n,timelineState:i,isFullScreen:s,isRootChild:r}=e,a=(0,A()._e)(o),l=o.collectionStore();if(!a||!l)return;const{property:c}=a,{store:d,relationPointer:u}=t,m=d.getSchema()[c];m&&"relation"===m.type&&(j().createAndCommit({userAction:"CollectionTimelineDependenciesOverlay.handleRemoveRelation",environment:n,canUndo:!0,perform:e=>{x().Bl({environment:n,propertyWithInverse:a,sourceStore:d,destStore:R().G.createChildStore(d,u),transaction:e}),p().rv({environment:n,block_id:u.id,property:c,property_type:m.type,from:"timeline",collectionContextStore:o,isFromBulkActionsToolbar:!1,isUnthrottled:!0})}}),(0,B().lf)(n,{...(0,L().Pn)(o),...(0,B().Ii)({environment:n,collectionContextStore:o,timelineState:i,isFullScreen:s,isRootChild:r}),dependenciesPropertyID:c,blockedByStoreID:d.id,blockingStoreID:u.id}))}function X(e){const{collectionViewStore:t,newProperty:o,transaction:n}=e;v().FH({stores:[t],update:{timeline_arrows_by:{property:o}},transaction:n})}function G(e){var t;const{collectionContextStore:o,relationPropertyId:n,transaction:i}=e,s=o.collectionStore();if(!s)return;const l=n?s.getSchema()[n]:void 0,c="relation"===(null==l?void 0:l.type)&&l.property&&"relation"===(null===(t=s.getSchema()[l.property])||void 0===t?void 0:t.type)?l.property:void 0;v().FH({stores:[s],update:{collection_default_arrows_by:n,...s.getFormat().app_config_uri===a().iS?{app_uri_map:{...s.getFormat().app_uri_map?s.getFormat().app_uri_map:{},[r().Es.BlockingRelation]:n,[r().Es.BlockedRelation]:c}}:{}},transaction:i})}function J(e){const{environment:t,transaction:o,date:n,parentStore:i,query:r,schema:a,isFullScreen:l,groupFormat:c,canEditTimelineItems:d,collectionContextStore:u,from:m}=e;if(!(0,D().ww)(t))return;const p=c?[c]:[],h=u.groupsStore.getGroupState(p);if(!h)return;if(i)return function(e){const{environment:t,transaction:o,date:n,store:i,parentStore:r,query:a,schema:l,groupFormat:c,canEditTimelineItems:d,collectionContextStore:u,subitemPath:m}=e;if(!i||!r)return;const p=c?[c]:[],h=g().yk({environment:t,collectionContextStore:u,groupsPointer:p,store:i,before:!1,collectionStore:r,transaction:o,subitemPath:m,subitemInsertDirection:"into"});if(h){if(V({environment:t,store:h,query:a,schema:l,date:n,transaction:o}),t.device.isMobile)b()._c({environment:t,store:h,pageVisitSource:s().tY.Create});else if(h&&d){const e=h.getBlockTitleStore();k().setSelectionAtStart({store:e})}return h}}(e);u.searchQueryStore.state&&(0,_().U)({searchQuery:"",collectionContextStore:u,isFullScreen:l});const f=g().IW({environment:t,collectionContextStore:u,groupsPointer:p,shouldCoerce:!0,templateStore:u.defaultPageTemplateStore.state,transaction:o,from:{createBlock:m},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache});if(!f)return;const v=f.coercionSucceeded,S=f.newStore;if(V({environment:t,store:S,query:r,schema:a,date:n,transaction:o}),t.device.isMobile)b()._c({environment:t,store:S,pageVisitSource:s().tY.Create});else if(v&&d){const e=S.getBlockTitleStore();k().setSelectionAtEnd({store:e})}else C().CH({environment:t,store:S,peekMode:(0,I().kr)(u),resultsStore:null==h?void 0:h.resultsStore,collectionContextStore:u,pageVisitSource:s().tY.Create});return S}},645843:(e,t,o)=>{"use strict";o.d(t,{Al:()=>l,CB:()=>c,H6:()=>a,Ii:()=>g,LE:()=>m,gw:()=>d,iR:()=>s,lf:()=>p,ne:()=>u,zI:()=>r});o(267602),o(653476);var n=()=>o(594546),i=()=>o(701182);function s(e,t){n().lu(e,"timeline_view","timeline_view",5,t)}function r(e,t){n().K4(e,"timeline_zoom_level_update",t)}function a(e,t){n().K4(e,"timeline_today_click",t)}function l(e,t){n().K4(e,"timeline_shift_time_click",t)}function c(e,t){n().K4(e,"timeline_toggle_table_click",t)}function d(e,t){n().K4(e,"timeline_item_scroll_arrow_click",t)}function u(e,t){n().K4(e,"timeline_item_resize",t)}function m(e,t){n().K4(e,"timeline_dependency_arrow_add",t)}function p(e,t){n().K4(e,"timeline_dependency_arrow_delete",t)}function g(e){const{environment:t,collectionContextStore:o,timelineState:n,isFullScreen:s,isRootChild:r}=e,a=n.zoomLevel.state,l=o.normalizedFormatStore.state,c=(0,i().C1)({environment:t,format:l,isFullScreen:s,isRootChild:r}),d=c&&l.timeline_table_properties?l.timeline_table_properties.length:0,u=l.timeline_properties||[],m=u.filter((e=>"title"!==e.property));return{zoom_level:a,show_table:c,show_table_properties_count:d,show_timeline_title:u.length!==m.length,show_timeline_properties_count:m.length}}},715146:(e,t,o)=>{"use strict";function n(e){const{searchQuery:t,collectionContextStore:o}=e;o.collectionViewStore()&&(o.searchQueryStore.setState(t||""),o.groupsStore.resetAllLimits())}o.d(t,{U:()=>n})},526041:(e,t,o)=>{"use strict";o.r(t),o.d(t,{Comment:()=>ht,CommentFileBlock:()=>Ho().Z,Discussion:()=>qt,DiscussionIndicator:()=>Xt().ZP,DiscussionInput:()=>gt().Z,DiscussionReactionBar:()=>He,MarginCommentsSection:()=>Mo,NewDiscussionMenu:()=>Zo,PropertyDiscussionIndicator:()=>oo,ReactionBar:()=>Oe,ReplyDiscussionMenu:()=>Ko,SuggestionContext:()=>Nt,discussionHelpers:()=>T(),discussionViewActions:()=>n,reactionActions:()=>_e()});var n={};o.r(n),o.d(n,{isCommentUnread:()=>yt});o(267602),o(653476);var i=o(667294),s=()=>o(492788),r=()=>o(219727),a=()=>o(657320),l=()=>o(98642),c=()=>o(142735),d=()=>o(846550),u=()=>o(933868),m=()=>o(955620),p=()=>o(788860),g=()=>o(707513),h=()=>o(799454),f=()=>o(308186),v=()=>o(844085),S=()=>o(990966),x=()=>o(269299),b=()=>o(312578),C=()=>o(765513),y=()=>o(837416),w=()=>o(852465),k=()=>o(874210),j=()=>o(687647),_=()=>o(197666),I=()=>o(826955),L=()=>o(388573),M=()=>o(547592),R=()=>o(444851),T=()=>o(37272);function D(e){return e.isFirstComment&&"comment_unfurl"!==e.discussionLocation&&!e.blockStore.isPost()}var A=()=>o(3391),B=()=>o(8208),E=(o(670560),()=>o(506347)),P=()=>o(156642),Z=()=>o(370668),V=()=>o(205248),F=()=>o(641772),K=()=>o(237874),U=()=>o(519454),H=()=>o(78652),O=()=>o(827282),z=o(785893);const N=(0,O().IU)("reopen",{viewBox:"0 0 14 14",svg:(0,z.jsx)("path",{d:"M1.64844 7.88477C1.64844 10.791 3.98047 13.1289 6.88086 13.1289C9.78125 13.1289 12.1133 10.791 12.1133 7.88477C12.1133 7.53906 11.873 7.29297 11.5273 7.29297C11.1934 7.29297 10.9707 7.53906 10.9707 7.88477C10.9707 10.1582 9.14844 11.9805 6.88086 11.9805C4.61328 11.9805 2.79688 10.1582 2.79688 7.88477C2.79688 5.59961 4.60156 3.78906 6.86328 3.78906C7.25 3.78906 7.60742 3.81836 7.90625 3.88281L6.3125 5.46484C6.20703 5.57617 6.1543 5.69922 6.1543 5.85156C6.1543 6.17383 6.39453 6.41992 6.71094 6.41992C6.875 6.41992 7.00977 6.36719 7.10938 6.26172L9.51758 3.83594C9.64062 3.71289 9.69922 3.57227 9.69922 3.41406C9.69922 3.26172 9.63477 3.10938 9.51758 2.99219L7.10938 0.548828C7.00977 0.4375 6.875 0.378906 6.71094 0.378906C6.39453 0.378906 6.1543 0.636719 6.1543 0.953125C6.1543 1.10547 6.20703 1.24023 6.30664 1.3457L7.72461 2.74609C7.4668 2.69336 7.16797 2.66406 6.86328 2.66406C3.96875 2.66406 1.64844 4.98438 1.64844 7.88477Z"})}),W=(0,O().IU)("resolve",{viewBox:"0 0 16 16",svg:(0,z.jsx)("path",{d:"M6.6123 14.2646C7.07715 14.2646 7.43945 14.0869 7.68555 13.7109L14.0566 3.96973C14.2344 3.69629 14.3096 3.44336 14.3096 3.2041C14.3096 2.56152 13.8311 2.09668 13.1748 2.09668C12.7236 2.09668 12.4434 2.26074 12.1699 2.69141L6.57812 11.5098L3.74121 7.98926C3.48828 7.68848 3.21484 7.55176 2.83203 7.55176C2.16895 7.55176 1.69043 8.02344 1.69043 8.66602C1.69043 8.95312 1.7793 9.20605 2.02539 9.48633L5.55273 13.7588C5.84668 14.1074 6.1748 14.2646 6.6123 14.2646Z"})});var $=()=>o(235605),q=()=>o(95886),Y=()=>o(989478),X=()=>o(513670),G=()=>o(696459),J=()=>o(959137),Q=()=>o(827973),ee=()=>o(448419),te=()=>o(1910),oe=()=>o(198829),ne=()=>o(255577),ie=()=>o(388284),se=()=>o(654133),re=()=>o(508181),ae=()=>o(205228),le=()=>o(247724),ce=()=>o(352230),de=()=>o(239482),ue=()=>o(148126),me=()=>o(466970),pe=()=>o(876822),ge=()=>o(7186),he=()=>o(539410),fe=(o(241792),o(228244),()=>o(659278)),ve=()=>o(568017),Se=()=>o(762478),xe=()=>o(628370),be=()=>o(154186),Ce=()=>o(754668),ye=()=>o(103908),we=()=>o(150569),ke=()=>o(606757),je=()=>o(998901),_e=()=>o(879077),Ie=()=>o(18748),Le=()=>o(539245),Me=()=>o(718611),Re=()=>o(981697),Te=()=>o(472675);function De(e){let{reactionStores:t,initialIndex:o}=e;const[n,s]=i.useState(o),a=(0,p().YB)(),l=(0,r().O7)(),d=(0,c().VK)((()=>(0,Me().e_)(l)),[l]),u=(0,c().VK)((()=>t.map(((e,t)=>{const o=e.getIcon();if(!o)return;const i="raw"!==d||fe().xo.isCustomEmojiString(o);return(0,z.jsx)("span",{style:i&&t!==n?{opacity:.5}:{},children:(0,z.jsx)(Ce().Z,{size:14,char:o})},o)})).filter(G().$K)),[t,n,d]),m=(0,c().VK)((()=>t[n].getActorStores().map((e=>({id:e.id,store:e,name:e.getDisplayName(a)}))).filter(G().$K)),[t,n,a]);return(0,z.jsxs)(oe().Z,{menuType:ce().o.ActionSheet,children:[(0,z.jsx)(Le().ZP,{tabStyle:{flex:1,justifyContent:"center",display:"flex",minWidth:60},tabs:u,selectedIndex:n,onChange:e=>s(e)}),m.map((e=>(0,z.jsx)(Ie().ZP,{title:e.name,dontShrinkIcon:!0,icon:(0,z.jsx)(Te().S,{authorStore:e.store,avatarSize:20,avatarStyle:{width:20,height:20},placeholderStyle:{width:20,height:20}})},e.id)))]})}function Ae(e){const t=(0,r().Fy)(),o=(0,c().VK)((()=>I().bh.getUserVisibleReactions(e.store)),[e.store]),n=(0,i.useRef)(null),s=(0,Re().Z)({onLongPress:()=>{var e;return null===(e=n.current)||void 0===e?void 0:e.setOpen(!0)}});if(!t.isMobile)return(0,z.jsx)(z.Fragment,{children:e.children});const a=o.findIndex((t=>!e.reactionStore||t===e.reactionStore))??0;return(0,z.jsx)(ee().ZP,{ref:n,renderOrigin:()=>(0,z.jsx)("div",{...s,onTouchStart:e=>{e.stopPropagation(),s.onTouchStart()},onTouchMove:e=>{e.stopPropagation(),s.onTouchMove(e)},onTouchEnd:e=>{e.stopPropagation(),s.onTouchEnd()},onTouchCancel:e=>{e.stopPropagation(),s.onTouchCancel()},children:e.children}),popupType:t.isTablet?ee().Z4.Popup:ee().Z4.SlideUp,render:()=>(0,z.jsx)(De,{initialIndex:a,reactionStores:o})},e.store.id)}const Be=(0,p().vU)({addReaction:{defaultMessage:"Add reaction",id:"ReactionBar.newReaction.ariaLabel"},resolveDiscussion:{defaultMessage:"Resolve",id:"ReactionBar.resolveDiscussion.ariaLabel"},emojiPickerTitle:{defaultMessage:"Reaction",id:"ReactionBar.emojiModalMenu.title"}});function Ee(){const{isMobile:e}=(0,r().Fy)();return(0,d().yK)((t=>({reaction:{display:"flex",margin:"1px",padding:"1px 6px 1px 6px",justifyContent:"center",alignItems:"center",gap:"4px",border:`1px solid ${t.regularDividerColor}`,borderRadius:"100px",fontSize:14,fontVariantNumeric:"tabular-nums",background:t.whiteButtonBackground,height:25},count:{color:t.mediumTextColor,fontSize:e?g().JB.UISmall.mobile:g().JB.UISmall.desktop},countReacted:{color:t.blueColor},reacted:{background:ve().ZP.blueWithAlpha(.08),border:`1px solid ${t.filterPillBorder}`,fontWeight:500},reactedHover:{background:ve().ZP.blueWithAlpha(.18)},emojiStyle:{color:"black",display:"flex"},reactionIcon:{width:18,height:18,fill:t.mediumIconColor,marginTop:-.5,marginRight:1},dropShadow:{boxShadow:t.shadowSM}})),[e])}function Pe(e){let{store:t,disabled:o,onClick:n,dropShadow:i}=e;const s=(0,c().VK)((()=>t.getActors()),[t]),a=(0,c().VK)((()=>t.getIcon()),[t]),l=Ee(),{currentUser:d}=(0,r().O7)();if(!s||!a)return null;if(0===s.length)return null;const u=s.some((e=>e.id===d.id)),m={...l.reaction,...u&&l.reacted,...i&&l.dropShadow},p={...l.count,...u&&l.countReacted};return(0,z.jsx)(se().Z,{textWrap:!0,style:{maxWidth:250,width:"max-content"},placement:je().Placement.Bottom,delayThreshold:300,renderTooltip:()=>(0,z.jsx)(Ze,{store:t,icon:a}),render:e=>(0,z.jsxs)(be().Z,{disabled:o,style:m,hoveredStyle:u?l.reactedHover:void 0,onClick:n,...e,children:[(0,z.jsx)("span",{style:l.emojiStyle,children:(0,z.jsx)(Ce().Z,{size:14,char:a})}),(0,z.jsx)("span",{style:p,children:s.length})]})})}function Ze(e){let{store:t,icon:o}=e;const n=(0,p().YB)(),i=(0,c().VK)((()=>t.getActorStores()),[t]),s=(0,c().VK)((()=>i.map((e=>e.getDisplayName(n))).filter(G().$K)),[i,n]),r=fe().xo.isCustomEmojiString(o),a=(0,c().VK)((()=>{if(r){const e=fe().xo.fromCustomEmojiString(o).pointer;return(0,ke().KX)({parentStore:void 0,pointer:e})}}),[o,r]),l=(0,c().VK)((()=>{if(null!=a&&a.isDefined())return null==a?void 0:a.getModel().getRenderTitle()}),[a]);return r?a?(0,z.jsx)(ye().Z,{type:"custom",customEmojiStore:a,text:(0,z.jsx)(Ve,{names:s,emojiNameOrIcon:(0,z.jsx)("span",{className:"notranslate",children:l}),isDeletedCustomEmoji:!1}),deletedText:(0,z.jsx)(Ve,{names:s,emojiNameOrIcon:(0,z.jsx)("span",{className:"notranslate",children:l}),isDeletedCustomEmoji:!0})}):null:(0,z.jsx)(ye().Z,{type:"unicode",emoji:o,text:(0,z.jsx)(Ve,{names:s,emojiNameOrIcon:(0,z.jsx)(Ce().Z,{size:12,char:o}),isDeletedCustomEmoji:!1})})}function Ve(e){let{names:t,emojiNameOrIcon:o,isDeletedCustomEmoji:n}=e;const i=(0,d().yK)((e=>({text:{color:e.mediumInvertedTextColor}})),[]);return t.length>50?(0,z.jsx)(p()._H,{defaultMessage:"{additionalNames, plural, one {{names} and {additionalNames} other <medium>reacted with</medium> {icon}} other {{names} and {additionalNames} others <medium>reacted with</medium> {icon}}} {isDeletedCustomEmoji, select, true {<medium>(deleted)</medium>} other {}}",id:"ReactionBar.hoverTooltip.textAbbreviated",values:{additionalNames:t.length-50,names:t.slice(0,50).join(", "),medium:e=>(0,z.jsx)("span",{style:i.text,children:e}),icon:o,isDeletedCustomEmoji:n}}):(0,z.jsx)(p()._H,{defaultMessage:"{nameOrNames} <medium>reacted with</medium> {icon} {isDeletedCustomEmoji, select, true {<medium>(deleted)</medium>} other {}}",id:"ReactionBar.hoverTooltip.text",values:{numberOfNames:t.length,nameOrNames:t.join(", "),medium:e=>(0,z.jsx)("span",{style:i.text,children:e}),icon:o,isDeletedCustomEmoji:n}})}function Fe(e){const{store:t,discussionLocation:o,onEmojiSelection:n,style:s}=e,a=(0,r().O7)(),l=(0,i.useRef)(null),c=(0,r().Fy)(),u=(0,d().yK)((e=>({container:{padding:2,display:"flex",boxShadow:e.shadowSM,backgroundColor:e.buttonGroupBackground,borderRadius:c.isMobile?3:4,...s},addIcon:{width:21,height:21,fill:e.icon.secondary},iconButton:{height:24,width:24,flex:"0 0 auto"}})),[c.isMobile,s]),m=(0,p().YB)();return(0,z.jsx)("div",{style:u.container,children:(0,z.jsx)(te().Z,{hasBackground:!0,ariaLabel:m.formatMessage(Be.addReaction),showShadow:!1,icon:()=>(0,H().V)(u.addIcon),style:u.iconButton,ref:l,onClick:()=>Ue(a,m,t,null==l?void 0:l.current,o,n)})})}function Ke(e){let{store:t,discussionLocation:o,onEmojiSelection:n}=e;const s=(0,r().O7)(),a=(0,i.useRef)(null),l=Ee(),c=(0,p().YB)();return(0,z.jsx)(be().Z,{style:{...l.reaction,minWidth:"2em"},ref:a,onClick:()=>Ue(s,c,t,null==a?void 0:a.current,o,n),children:(0,H().V)(l.reactionIcon)})}function Ue(e,t,o,n,i,s){if(!(n instanceof Element))return;const r=n.getBoundingClientRect();Se().$(e,{originGap:4,originRect:r,popupWidth:we().FZ,popupHeight:we().kX,isSmallWidth:!1,title:t.formatMessage(Be.emojiPickerTitle),currentTab:"emoji",tabs:[{type:"emoji",title:(0,z.jsx)(p()._H,{defaultMessage:"Emoji",id:"recordIcon.emojiTab.title"}),hideRandomButton:!0,onChange:(t,n)=>{s&&s(),x().createAndCommit({environment:e,userAction:"Comment.toggleReactionFromMenu",canUndo:!0,perform:s=>{_e().toggleReaction({environment:e,transaction:s,store:o,icon:t,discussionLocation:i}),n&&n.keepVisible||Se().Z()}})}}]})}function He(e){const{parentStore:t,discussionLocation:o,onReact:n,focused:s}=e,[a,l]=(0,i.useState)(!1),u=(0,d().yK)((e=>({reactionIcon:{height:21,width:21,fill:e.mediumIconColor},resolveIcon:{height:16,width:16,fill:e.mediumIconColor},container:{gap:"4px",marginTop:"post_discussion"===o?0:12,paddingBottom:"post_discussion"===o?12:0,display:"flex",flexWrap:"wrap",willChange:"transform",transition:"transform 200ms ease",transformOrigin:"center left",transform:s?"scale3d(1.05)":"scale(1)"},reactionItem:{display:"flex",flexDirection:"row"},actionButton:{borderRadius:"50%",marginLeft:2}})),[s,o]),m=e=>{x().createAndCommit({userAction:"Discussion.handleResolve",environment:v,canUndo:!0,perform:e=>{(0,ge().D)({environment:v,discussionStore:t,transaction:e,discussionLocation:o})}}),h().Xv(),null==e||e.stopPropagation()},g=(0,c().VK)((()=>t.canComment()),[t]),f=(0,c().VK)((()=>{var e;return t.canEdit()&&!(null!==(e=t.getParentStore())&&void 0!==e&&e.isPost())}),[t]),v=(0,r().O7)(),S=(0,i.useRef)(null),b=(0,p().YB)(),C=a||e.focused,y=(0,c().VK)((()=>I().bh.getUserVisibleReactions(t)),[t]),w=e=>()=>{e.isDefined()&&(null==n||n(),x().createAndCommit({environment:v,userAction:"Comment.toggleReaction",canUndo:!0,perform:n=>{_e().toggleReaction({environment:v,transaction:n,store:t,icon:e.getIcon(),discussionLocation:o})}}))},k=()=>{Ue(v,b,t,null==S?void 0:S.current,o,n)};return(0,z.jsx)("div",{onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),style:u.container,children:y.map(((o,n)=>(0,z.jsxs)("div",{style:u.reactionItem,children:[(0,z.jsx)(Ae,{reactionStore:o,store:t,children:(0,z.jsx)(Pe,{dropShadow:e.focused&&!e.disableShadow,disabled:!g,store:o,onClick:w(o)})}),n===y.length-1&&(0,z.jsxs)(xe().Z,{animate:{opacity:C?1:0},style:{display:"flex",alignItems:"center",marginLeft:2},children:[g&&(0,z.jsx)(Ae,{store:t,children:(0,z.jsx)(se().Z,{renderTooltip:()=>(0,z.jsx)(p()._H,{...Be.addReaction}),render:e=>(0,z.jsx)(te().Z,{style:u.actionButton,hasBackground:!1,showShadow:!1,ref:S,icon:()=>(0,H().V)(u.reactionIcon),onClick:k,...e,ariaLabel:b.formatMessage(Be.addReaction)})})}),f&&(0,z.jsx)(se().Z,{renderTooltip:()=>(0,z.jsx)(p()._H,{...Be.resolveDiscussion}),render:e=>(0,z.jsx)(te().Z,{style:{borderRadius:"50%",marginLeft:4},hasBackground:!1,showShadow:!1,icon:()=>W(u.resolveIcon),onClick:m,...e,ariaLabel:b.formatMessage(Be.resolveDiscussion)})})]})]},o.id)))})}const Oe=function(e){const{parentStore:t,discussionLocation:n,onReactionToggle:i,newReactionStyle:s}=e,a=(0,c().VK)((()=>t.canComment()),[t]),l=(0,c().VK)((()=>I().bh.getUserVisibleReactions(t)),[t]),d=(0,r().O7)(),u=(0,c().VK)((()=>{if(t.table===o(602299).x_){const e=t.getParentBlockStore();return Boolean(e&&e.pathIsDead())}if(t.table===o(542973).qF){const e=t.getParentStore();return Boolean(e&&e.pathIsDead())}return!1}),[t]),m=a&&!u&&l.length>0,p=a&&!u&&0===l.length;return(0,z.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[l.map((e=>(0,z.jsx)(Ae,{reactionStore:e,store:t,children:(0,z.jsx)(Pe,{disabled:!a||u,store:e,onClick:()=>{if(e.isDefined()){const o=x().createAndCommit({environment:d,userAction:"Comment.toggleReaction",canUndo:!0,perform:o=>_e().toggleReaction({environment:d,transaction:o,store:t,icon:e.getIcon(),discussionLocation:n})});void 0!==o.performResult&&i&&i(o.performResult)}}})},e.id))),m&&(0,z.jsx)(Ae,{store:t,children:(0,z.jsx)(Ke,{store:t,discussionLocation:n,onEmojiSelection:void 0!==i?()=>i("Added"):void 0})}),p&&(0,z.jsx)(Fe,{store:t,discussionLocation:n,onEmojiSelection:void 0!==i?()=>i("Added"):void 0,style:s})]})},ze=(0,p().vU)({addReaction:{id:"comment.actions.addReaction.label",defaultMessage:"Add reaction"},acceptButton:{id:"comment.actions.acceptButton.label",defaultMessage:"Accept"},rejectButton:{id:"comment.actions.rejectButton.label",defaultMessage:"Reject"},moreActions:{id:"comment.actions.moreActions.label",defaultMessage:"More actions"},reopenButton:{id:"comment.actions.reopenButton.label",defaultMessage:"Re-open"},resolveButton:{id:"comment.actions.resolveButton.label",defaultMessage:"Resolve"}});function Ne(e){const{discussionLocation:t,isFirstComment:o,blockStore:n}=e,s=(0,p().YB)(),l=(0,r().O7)(),d=l.device,m=(0,me().E)("mobile_use_bottom_sheet_popup_container"),g=(0,i.useRef)(null),f=(0,a().l)(),v=(0,c().VK)((()=>Boolean(e.discussionStore.getResolved())),[e.discussionStore]),S=(0,c().VK)((()=>e.store.isDefined()),[e.store]),b=(0,c().VK)((()=>{var e;return null===(e=pe().default.state.currentUserStore)||void 0===e?void 0:e.id}),[]),C=(0,c().VK)((()=>{const t=e.store.getCreatedById();return e.store.getCreatedByTable()===Y().KJ&&b===t}),[b,e.store]),y=(0,c().VK)((()=>{var e;const t=null===(e=pe().default.state.currentSpaceStore)||void 0===e?void 0:e.getRole();return t&&u().zz(t)}),[]),w=(0,c().VK)((()=>n.getRole()),[n]),k=(0,c().VK)((()=>{var e;return null==f||null===(e=f.publicEditModeStore.state)||void 0===e?void 0:e.permission}),[null==f?void 0:f.publicEditModeStore]),{isFirstCommentOfSuggestionDiscussion:j,disableAccept:_}=(0,c().VK)((()=>{var t;const o="suggestion"===e.discussionStore.getType()&&e.discussionStore.getCommentPointers()[0].id===e.store.id,i=(null===(t=n.getNavigableBlockStore())||void 0===t?void 0:t.canEdit())??!1;return{isFirstCommentOfSuggestionDiscussion:o,disableAccept:o&&!i}}),[e.discussionStore,n,e.store]),I=(0,c().VK)((()=>n.pathIsDead()),[n]),M=(0,c().VK)((()=>D({isFirstComment:o,discussionLocation:t,blockStore:n})),[o,t,n]),R="comment_only"===w||"comment"===k;if(!S||!b)return null;const T=()=>{x().createAndCommit({userAction:"Comment.handleReopen",environment:l,canUndo:!0,perform:t=>{L().bh({environment:l,commentStore:e.store,discussionStore:e.discussionStore,transaction:t,discussionLocation:e.discussionLocation})}})},A=t=>{x().createAndCommit({userAction:"Comment.handleResolve",environment:l,canUndo:!0,perform:t=>{(0,ge().D)({environment:l,commentStore:e.store,discussionStore:e.discussionStore,transaction:t,discussionLocation:e.discussionLocation})}}),h().Xv(),null==t||t.stopPropagation()},B=()=>{x().createAndCommit({userAction:"Suggestion.handleAccept",environment:l,canUndo:!0,perform:t=>{he().Yo({action:"accept",environment:l,commentStore:e.store,discussionStore:e.discussionStore,transaction:t,discussionLocation:e.discussionLocation,currentPageStore:de().fM(e.discussionStore)})}}),h().Xv()},V=()=>{x().createAndCommit({userAction:"Suggestion.handleReject",environment:l,canUndo:!0,perform:t=>{he().Yo({action:"reject",environment:l,commentStore:e.store,discussionStore:e.discussionStore,transaction:t,discussionLocation:e.discussionLocation,currentPageStore:de().fM(e.discussionStore)})}}),h().Xv()},F=async()=>{var t,o;const n=e.store.getParentStore();if(!n||null==n||!n.isDefined())return null;let i=n.getParentStore();if(null===(t=i)||void 0===t||!t.isDefined())return null;var s;i.getType()===P().Ti.tableRow&&(i=null===(s=i)||void 0===s?void 0:s.getParentBlockStore());if(null===(o=i)||void 0===o||!o.isDefined())return null;const r=i.getModel().getRenderUrl({baseUrl:ae().default.domainBaseUrl,getRecordModel:e.store.getRecordModel,discussionId:n.id,pageVisitSource:E().tY.CopyLink}),a=await J().F.clipboardActions.load();a.copyString({environment:l,stringValue:r,copiedMessage:a.clipboardMessages.copiedLinkToClipboard})};if(!l.currentUser.isLoggedIn())return null;const H=w&&u().rz(w)||I;if(H)return null;const O=M&&!d.isMobile&&!R&&!H,N=[];d.isMobile&&!R&&!H&&e.isFirstComment&&(v?N.push("reopen"):N.push("resolve")),!j&&C&&N.push("edit"),o&&N.push("copyLink"),j||!C&&!y||N.push("delete");const W=N.length>0;return W||O||e.canShowReactions?(0,z.jsx)(ee().ZP,{ref:g,popupType:d.isMobile?m?ee().Z4.BottomSheet:ee().Z4.SlideUp:ee().Z4.Popup,bottomSheetInitialState:"half",buttonPopupStore:e.buttonPopupStore,placementToOrigin:ee().pO.Right,stopClickPropagation:!0,renderOrigin:o=>(0,z.jsx)(qe,{buttonConfig:{resolve:{visible:O&&!j,resolved:v,onResolve:A,onReopen:T},react:{visible:e.canShowReactions,onReact:()=>{var o;Ue(l,s,e.store,(null===(o=g.current)||void 0===o?void 0:o.getAnchor())??null,t,e.handleReaction)}},accept:{visible:j&&!_&&!v,onAccept:B},reject:{visible:j&&!v&&(!R||C),onReject:V},moreActions:{visible:W}},visible:e.visible,buttonPopupEvents:o,discussionLocation:e.discussionLocation,store:e.store}),render:t=>{let o;o=d.isMobile?m?{menuType:ce().o.Modal,title:(0,z.jsx)(p()._H,{id:"comment.mobileCommentMenu.title",defaultMessage:"Comment"})}:{menuType:ce().o.ActionSheet}:{menuType:ce().o.Popup};const n=N.map((t=>"reopen"===t?{key:"reopen",render:e=>(0,z.jsx)(Q().Z,{...e,icon:(0,Z().V)({height:16,width:16}),title:(0,z.jsx)(p()._H,{id:"comment.reopenDiscussion.button",defaultMessage:"Re-open discussion"})}),action:T}:"resolve"===t?{key:"resolve",render:e=>(0,z.jsx)(Q().Z,{...e,icon:(0,$().k)({height:16,width:16}),title:(0,z.jsx)(p()._H,{id:"comment.resolveDiscussion.button",defaultMessage:"Resolve comments"})}),action:()=>A()}:"edit"===t?{key:"edit",render:e=>(0,z.jsx)(Q().Z,{...e,icon:(0,U().R)({height:16,width:16}),title:(0,z.jsx)(p()._H,{id:"comment.editComment.button",defaultMessage:"Edit comment"})}),action:e.handleEditComment}:"delete"===t?{key:"delete",render:e=>(0,z.jsx)(Q().Z,{...e,icon:(0,q().y)({height:16,width:16}),title:(0,z.jsx)(p()._H,{id:"comment.deleteComment.button",defaultMessage:"Delete comment"})}),action:e.handleDeleteComment}:"copyLink"===t?{key:"copyLink",render:e=>(0,z.jsx)(Q().Z,{...e,icon:(0,K().N)({height:16,width:16}),title:(0,z.jsx)(p()._H,{id:"comment.copyLinkToDiscussion.button",defaultMessage:"Copy link to discussion"})}),action:F}:void(0,G().t1)(t)));return(0,z.jsx)("div",{className:le().G6g,children:(0,z.jsxs)(oe().Z,{...o,children:[(0,z.jsx)(ne().ZP,{type:ne().iW.Vertical,initialFocus:void 0,onAccept:t.close,sections:X().oA([n.length&&{key:0,render:e=>(0,z.jsx)(ie().Z,{...e}),items:n}])}),!d.isMobile&&(0,z.jsx)(ie().Z,{topBorder:!0,disableDesktopPadding:!1,children:(0,z.jsx)(re().Z,{title:(0,z.jsx)(p()._H,{defaultMessage:"Learn about comments",id:"comments.learn"}),href:(0,ue().UY)("guides.comments"),analyticsFrom:"comments"})})]})})}}):null}function We(e){return"accept"in e}function $e(e){return"resolve"in e}function qe(e){const{buttonPopupEvents:t,buttonConfig:o}=e,n=(0,r().O7)().device,i=(0,p().YB)(),s=(0,d().yK)((t=>({addIcon:{height:21,width:21,fill:t.mediumIconColor},container:{display:"flex",boxShadow:"0px 2px 12px 0px rgba(29, 27, 22, 0.06)",borderWidth:1,borderStyle:"solid",borderColor:t.stroke.secondary,position:"absolute",flexShrink:0,padding:"2px",backgroundColor:t.buttonGroupBackground,right:0,...n.isMobile?{borderRadius:6,top:-3}:{marginRight:0,marginTop:"updates_sidebar"===e.discussionLocation?6:0,opacity:e.visible?1:0,gap:1,borderRadius:6,transition:"opacity 100ms ease-out",zIndex:1,top:-4}}})),[n.isMobile,e.discussionLocation,e.visible]);return(0,z.jsxs)("div",{style:s.container,children:[We(o)&&o.accept.visible&&(0,z.jsx)(se().Z,{renderTooltip:()=>(0,z.jsx)(p()._H,{...ze.acceptButton}),render:e=>(0,z.jsx)(te().Z,{hasBackground:!1,showShadow:!1,icon:W,onClick:o.accept.onAccept,ariaLabel:i.formatMessage(ze.acceptButton),...e})}),We(o)&&o.reject.visible&&(0,z.jsx)(se().Z,{renderTooltip:()=>(0,z.jsx)(p()._H,{...ze.rejectButton}),render:e=>(0,z.jsx)(te().Z,{hasBackground:!1,showShadow:!1,icon:V().D,onClick:o.reject.onReject,iconStyle:{height:18,width:18},ariaLabel:i.formatMessage(ze.rejectButton),...e})}),o.react.visible&&(0,z.jsx)(se().Z,{renderTooltip:()=>(0,z.jsx)(p()._H,{...ze.addReaction}),render:e=>(0,z.jsx)(te().Z,{ariaLabel:i.formatMessage(ze.addReaction),hasBackground:!1,showShadow:!1,icon:()=>(0,H().V)(s.addIcon),onClick:o.react.onReact,...e})}),$e(o)&&o.resolve.visible&&(0,z.jsx)(se().Z,{renderTooltip:()=>(0,z.jsx)(p()._H,{...o.resolve.resolved?ze.reopenButton:ze.resolveButton}),render:e=>(0,z.jsx)(te().Z,{hasBackground:!1,showShadow:!1,icon:o.resolve.resolved?N:W,onClick:o.resolve.resolved?o.resolve.onReopen:o.resolve.onResolve,...e,ariaLabel:i.formatMessage(o.resolve.resolved?ze.reopenButton:ze.resolveButton)})}),o.moreActions.visible&&(0,z.jsx)(se().Z,{renderTooltip:()=>(0,z.jsx)(p()._H,{...ze.moreActions}),render:e=>(0,z.jsx)(te().Z,{...t,...e,hasBackground:!1,showShadow:!1,icon:F().o,ariaLabel:i.formatMessage(ze.moreActions)})})]})}var Ye=()=>o(544607),Xe=()=>o(710706),Ge=()=>o(920991),Je=()=>o(125519),Qe=()=>o(585);const et=3;function tt(e){let{stores:t,collapsed:o,shouldShowGrayFogInScroller:n,onRemoveBlockFromComment:i}=e;return 0===t.length?null:t.length<=et?(0,z.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,z.jsx)(Je().Z,{store:e,disabled:!1,commentProps:{shouldHideBlockActionMenu:o,onRemoveBlockFromComment:i}},e.id)))}):(0,z.jsx)(Qe().Z,{shouldShowGrayFog:n,children:t.map((e=>(0,z.jsx)(Je().Z,{store:e,disabled:!1,commentProps:{shouldHideBlockActionMenu:o,onRemoveBlockFromComment:i}},e.id)))})}var ot=()=>o(453999);const nt=3,it=4;function st(e){let{stores:t,embedBlockLocation:o,onRemoveContent:n}=e;const i=(0,r().O7)();if(0===t.length)return null;if(t.length<=nt)return(0,z.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,z.jsx)(rt,{store:e,embedBlockLocation:o,onRemoveContent:n,isLarge:!0},e.id)))});if(t.length<=it)return(0,z.jsx)("div",{style:{display:"flex",gap:4},children:t.map((e=>(0,z.jsx)(rt,{store:e,embedBlockLocation:o,onRemoveContent:n,isLarge:!1},e.id)))});const s=t.slice(0,it-1),a=t[it-1],l=t.length-it+1,c=t.slice(it);return(0,z.jsxs)("div",{style:{display:"flex",gap:4},children:[s.map((e=>(0,z.jsx)(rt,{store:e,embedBlockLocation:o,onRemoveContent:n,isLarge:!1},e.id))),(0,z.jsxs)("div",{children:[(0,z.jsx)(be().Z,{style:{position:"absolute",zIndex:1,width:48,height:48,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.4)",borderRadius:8,color:"white",fontWeight:g().Ue.bold},hoveredStyle:{background:"rgba(0, 0, 0, 0.4)"},pressedStyle:{background:"rgba(0, 0, 0, 0.4)"},onClick:()=>{ot().dK({environment:i,blockStore:a})},children:`+${l}`}),(0,z.jsx)(rt,{store:a,embedBlockLocation:o,onRemoveContent:n,isLarge:!1},a.id)]}),(0,z.jsx)("div",{style:{display:"none"},children:c.map((e=>(0,z.jsx)(rt,{store:e,embedBlockLocation:o,onRemoveContent:n,isLarge:!1},e.id)))})]})}function rt(e){let{store:t,isLarge:o,embedBlockLocation:n,onRemoveContent:i}=e;const s=(0,d().yK)((e=>({imageShared:{border:`1px solid ${e.stroke.secondary}`,borderRadius:8,cursor:"zoom-in"}})),[]);return(0,z.jsx)(Xe().ZP,{store:t,blockLocation:n,disabled:!1,disableDrag:!0,disableResizers:!0,preserveScale:!0,inlineContentStyle:{...s.imageShared,...o?at:lt},disableActions:!o,onRemoveBlockFromComment:o?i:void 0},t.id)}const at={objectFit:"contain",width:"auto",height:"auto",maxWidth:240,maxHeight:240,minWidth:48,minHeight:48},lt={width:48,height:48,minWidth:48,minHeight:48};var ct=()=>o(410184);function dt(e){let{store:t}=e;const o=(0,c().VK)((()=>Ge().default.getKeyState(Ge().default.getBlockKey(t.id))),[t.id]),n=(0,p().YB)(),i=(0,d().yK)((e=>({wrapper:{height:48,width:214,display:"flex",alignItems:"center",background:"white",border:`1px solid ${e.regularDividerColor}`,borderRadius:12,padding:"8px 10px 8px 8px",gap:8},icon:{background:e.tint.regular,borderRadius:6,width:32,minWidth:32,height:32,display:"flex",alignItems:"center",justifyContent:"center"},fileDetails:{display:"flex",flexDirection:"column"},fileName:{fontSize:14,fontWeight:g().Ue.medium,lineHeight:"18px",color:e.text.primary,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},fileSizeText:{color:e.text.secondary},progressText:{color:e.text.tertiary},sizeAndProgressContainer:{display:"flex",alignItems:"center",gap:4,fontSize:12,lineHeight:"15px"}})),[]);if(!o)return(0,z.jsxs)("div",{style:i.wrapper,children:[(0,z.jsx)("div",{style:i.icon,children:(0,z.jsx)(b().Z,{})}),(0,z.jsx)("div",{style:i.fileDetails,children:(0,z.jsx)("div",{style:i.fileName,children:n.formatMessage({id:"commentFilePlaceholder.loading",defaultMessage:"Loading..."})})})]});const{name:s,size:r,progressPercent:a}=o;return(0,z.jsxs)("div",{style:i.wrapper,children:[(0,z.jsx)("div",{style:i.icon,children:(0,z.jsx)(b().Z,{})}),(0,z.jsx)("div",{style:{overflow:"hidden"},children:(0,z.jsxs)("div",{style:i.fileDetails,children:[(0,z.jsx)("div",{style:i.fileName,children:s}),(0,z.jsxs)("div",{style:i.sizeAndProgressContainer,children:[(0,z.jsx)("span",{style:i.fileSizeText,children:(0,T().formatFileSize)(r)}),(0,z.jsx)("span",{style:i.progressText,children:"—"}),(0,z.jsx)(b().Z,{}),(0,z.jsx)(ct().Z,{percentage:a,style:i.progressText})]})]})})]})}function ut(e){let{stores:t}=e;return 0===t.length?null:(0,z.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,z.jsx)(dt,{store:e},e.id)))})}function mt(e){const t=e.discussionFormat===T().DiscussionFormat.Sidebar?Ye().vW.SidebarComment:Ye().vW.PageComment,{uploading:o,images:n,embeds:i,files:s}=(0,c().VK)((()=>{const[t,o]=X().uK(e.contentStores,(e=>{const t=Boolean(Ge().default.getKeyState(Ge().default.getBlockKey(e.id))),o=(0,Xe().lI)(e);return t||!o})),[n,i]=X().uK(o,(e=>e.getType()===P().Ti.image)),[s,r]=X().uK(i,(e=>"video"===e.getType()));return{uploading:t,images:n,embeds:s,files:r}}),[e.contentStores]);return 0===o.length&&0===n.length&&0===i.length&&0===s.length?null:(0,z.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4,marginTop:8},children:[(0,z.jsx)(ut,{stores:o}),(0,z.jsx)(st,{stores:n,embedBlockLocation:t,onRemoveContent:e.onRemoveContent}),i.length>0&&(0,z.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:i.map((o=>(0,z.jsx)(Xe().ZP,{store:o,blockLocation:t,disabled:!1,disableDrag:!0,disableResizers:!0,preserveScale:!0,inlineContentStyle:{},onRemoveBlockFromComment:e.onRemoveContent},o.id)))}),(0,z.jsx)(tt,{stores:s,collapsed:e.collapsed,shouldShowGrayFogInScroller:e.discussionHovered&&(e.discussionFormat===T().DiscussionFormat.Margin||e.discussionFormat===T().DiscussionFormat.Sidebar),onRemoveBlockFromComment:e.onRemoveContent})]})}function pt(){const e=(0,d().yK)((e=>({newBarLine:{height:"0px",borderBottom:`1px solid ${e.darkDividerColor}`,width:"100%",marginLeft:0},newBarWrapper:{color:e.mediumTextColor,textTransform:"uppercase",fontSize:10.5,letterSpacing:.5,fontWeight:g().Ue.semibold,display:"flex",alignItems:"center",margin:0,paddingTop:10,paddingBottom:10,paddingLeft:R().yx},newBarText:{padding:"0 10px",whiteSpace:"nowrap"},threadLine:{position:"absolute",backgroundColor:e.stroke.secondary,width:R().Ky,height:"100%",borderRadius:2,left:R().fT,top:-6}})),[]);return(0,z.jsxs)("div",{style:{position:"relative"},children:[(0,z.jsx)("div",{style:e.threadLine}),(0,z.jsxs)("div",{style:e.newBarWrapper,children:[(0,z.jsx)("div",{style:e.newBarLine}),(0,z.jsx)("div",{style:e.newBarText,children:(0,z.jsx)(p()._H,{id:"comment.newIndicator.label",defaultMessage:"New comments"})}),(0,z.jsx)("div",{style:e.newBarLine})]})]})}var gt=()=>o(887328);const ht=function(e){const{store:t,discussionContext:n,discussionLocation:E,shouldShowThreadLine:P,discussionStore:Z,blockStore:V,collapsed:F}=e,K=(0,r().O7)(),[U,H]=(0,i.useState)(!1),[O,N]=(0,i.useState)(!1),[W,$]=(0,i.useState)(!1),[q,Y]=(0,i.useState)(!1),[X,G]=(0,i.useState)("post_discussion"===E&&F),J=(0,c().VK)((()=>e.store.isDefined()?new(A().Z)(K,e.store.getSpaceId()):void 0),[K,e.store]),Q=(0,c().VK)((()=>w().le(e.store).filter((e=>(0,I().Vh)(e,{table:o(396136).iU,id:e.id},"alive").getValue()))),[e.store]),ee=(0,c().VK)((()=>Z.getResolved()),[Z]),te=(0,c().VK)((()=>null==J?void 0:J.state.files),[J]),oe=(0,c().VK)((()=>null==J?void 0:J.state.textStore),[J]),ne=(0,i.useCallback)((e=>{const t=e.target;t instanceof HTMLElement&&(0,o(474788).E)(t)&&N(!0)}),[]),ie=(0,i.useCallback)((()=>{N(!1)}),[]),se=(0,i.useCallback)((()=>{_().Z.state||$(!0)}),[]),re=(0,i.useCallback)((()=>{$(!1)}),[]),ae=(0,a().l)(),le=(0,c().qz)(void 0,o(529048).Z),ce=(0,c().VK)((()=>le.state.open),[le]),de=(0,o(309797).L2)(V),ue=(0,c().VK)((()=>(0,o(338855).cw)(e.store.id)),[e.store.id]),me=(0,c().VK)((()=>{const t=e.discussionStore.getComments();return Boolean(t&&t[0]===e.store.id)}),[e.discussionStore,e.store.id]),pe=(0,c().VK)((()=>{var t;const o=V.getRole(),n=D({isFirstComment:me,discussionLocation:E,blockStore:V}),i=V.pathIsDead(),s=o&&u().rz(o)||i,{device:r}=K,a="comment_only"===o||ae&&"comment"===(null===(t=ae.publicEditModeStore.state)||void 0===t?void 0:t.permission),l=n&&!r.isMobile&&!a&&!s;return W||O||e.hoveringDiscussion&&n||ce||r.isMobile||e.showResolveButtonByDefaultIfPossible&&l}),[V,e.hoveringDiscussion,e.showResolveButtonByDefaultIfPossible,me,E,K,ae,W,O,ce]),ge=(0,i.useContext)(o(939513).U),he=(0,c().VK)((()=>{const e=t.getCreatedByPointer();return e?{createdByPointer:e,lastEditedTime:t.getLastEditedTime(),createdTime:t.getCreatedTime(),text:t.getText(),reactions:I().bh.getUserVisibleReactions(t)}:null}),[t]),fe=(0,c().VK)((()=>he?I().t1.createChildStore(t,he.createdByPointer):null),[he,t]),ve=function(e){const{discussionLocation:t,isCommentCollapsed:o,isDiscussionCollapsed:n,maxLines:i}=e;if("post_discussion"===t)return o?i:void 0;return n?i:void 0}({discussionLocation:E,isCommentCollapsed:X,isDiscussionCollapsed:F,maxLines:e.maxLines}),Se=(0,i.useCallback)((()=>{x().createAndCommit({userAction:"Comment.deleteComment",environment:K,canUndo:!0,perform:t=>{L().YF({environment:K,commentStore:e.store,transaction:t,discussionLocation:E})},skipUpdatingEditedMetadata:!0})}),[K,e.store,E]),xe=(0,i.useCallback)((async()=>{const{accept:e}=await f().gt({message:(0,z.jsx)(p()._H,{defaultMessage:"Would you like to delete this comment?",id:"comment.confirmDialog.deleteComment.prompt"}),acceptLabel:(0,z.jsx)(p()._H,{defaultMessage:"Delete",id:"comment.confirmDialog.deleteComment.deleteButton.label"})});e&&(Se(),h().Xv(),B().Z.state.overlapsExistingDiscussionMenu&&!j().Z.state.open&&B().Z.setState({...B().Z.state,overlapsExistingDiscussionMenu:!1}),M().Cd(K))}),[Se,K]),be=(0,i.useCallback)((async t=>{const o=w().zP(e.store).getValue(),n=w().le(e.store).filter((e=>e.id!==t.id)),i=o&&o.length>0,s=0===n.length;!i&&s?(await xe(),H(!1)):x().createAndCommit({userAction:"Comment.handleRemoveFileFromActions",environment:K,canUndo:!0,perform:o=>{L().Zo({commentStore:e.store,fileBlocks:[t],transaction:o})}})}),[K,xe,e.store]),Ce=(0,i.useCallback)((()=>{Y(!0)}),[]),ye=(0,i.useCallback)((async()=>{if(!J)return;const t=w().zP(e.store).getValue()||[],n=J.state.textStore;x().createAndCommit({userAction:"Comment.handleEditComment",environment:K,canUndo:!0,perform:e=>{o(970105).sO({environment:K,store:n,value:t,transaction:e})}}),H(!0),await s().default.afterNextFlush(),await s().default.afterNextFlush(),S().setSelectionAtEnd({store:n})}),[J,K,e.store]),we=(0,i.useCallback)((async()=>{if(!J)return!1;if(!(0,T().hasCommentChanged)(J,e.store))return H(!1),!0;{const{accept:e}=await f().gt({message:(0,z.jsx)(p()._H,{defaultMessage:"Do you want to discard this edit?",id:"comment.confirmDialog.discardEdit.prompt"}),acceptLabel:(0,z.jsx)(p()._H,{defaultMessage:"Discard",id:"comment.confirmDialog.discardEdit.discardButton.label"})});if(e)return H(!1),!0}return!1}),[J,e.store]),ke=(0,i.useCallback)((async()=>{const t=null==oe?void 0:oe.getValue();t&&t.length>0||te&&te.length>0?x().createAndCommit({userAction:"Comment.handleSubmitEdit",environment:K,canUndo:!0,perform:o=>{L().DF({environment:K,store:e.store,text:t||[],transaction:o,discussionLocation:E,files:te||[],property_id:Z.getPropertyId(),blockStore:V})}}):await xe(),H(!1)}),[oe,te,K,e.store,E,Z,V,xe]),je=(0,i.useCallback)((()=>{"post_discussion"===E&&G(!1)}),[E]),_e=(0,i.useRef)(null),Ie=(0,i.useRef)(null);(0,l().c)(k().Z,(()=>({edit:ye,handleCancelEdit:we,getNode:()=>_e.current,isEditing:()=>U,discussionLocation:E,commentId:e.store.id})),[ye,we,U,E,e.store.id]);const Le=null==he?void 0:he.text,Me=void 0!==Le&&Le.length>0&&m().VrM(Le)>0,Re=Me&&(0,T().isCommentAllEmojis)(Le),Te=function(e){let{discussionLocation:t,isAllEmojis:o}=e;return(0,d().yK)((e=>({container:{flexGrow:"comment_unfurl"===t?1:void 0,paddingTop:"comment_unfurl"===t?R().tD:R().En,paddingRight:"margin_comments"===t?12:16,paddingBottom:R().rb,paddingLeft:R().vi(t)},comment:{position:"relative",fontSize:14},commentElementsBelowUserRow:{paddingLeft:R().yx},discussionInputContainer:{width:"calc(100% + 8px)"},threadLine:{position:"absolute",backgroundColor:e.stroke.secondary,borderRadius:2,width:R().Ky,height:R().bd,left:R().fT,top:R().aH},unfurlMoreWrapper:{color:e.lightTextColor,fontWeight:"comment_unfurl"===t?g().Ue.medium:void 0,display:"block",marginBottom:-1.5,pointerEvents:"auto"},attachIcon:{width:18,height:18,fill:e.mediumIconColor},text:{cursor:"comment_unfurl"!==t?"text":void 0,lineHeight:"20px",paddingTop:4,...o?{fontSize:32,lineHeight:"32px"}:{}},attachmentContainer:{display:"flex",alignItems:"center"},commentAttachment:{}})),[t,o])}({discussionLocation:E,isAllEmojis:Re}),De=(0,i.useMemo)((()=>({type:"comment_match",commentId:e.store.id})),[e.store.id]),Ae="comment_unfurl"!==E,Be=Ae&&he&&he.reactions.length>0;if((0,i.useEffect)((()=>{q&&Ie.current&&Be&&(v().bx({element:Ie.current,environment:K,scrollerContext:ge,vertical:{reveal:"closest"},horizontal:void 0,animate:!0}),Y(!1))}),[K,ge,q,Be]),!J)return null;if(!he||!fe)return null;const Ee=Q.length>0&&(0,z.jsx)("div",{style:Te.commentAttachment,children:(0,z.jsx)(mt,{contentStores:Q,onRemoveContent:be,discussionFormat:(0,T().discussionLocationToDiscussionFormat)(E),collapsed:F,discussionHovered:e.hoveringDiscussion})});return(0,z.jsxs)("div",{ref:_e,onClick:e=>U&&e.stopPropagation(),style:Te.container,children:[e.showNewBar&&(0,z.jsx)(pt,{}),(0,z.jsxs)("div",{style:Te.comment,onFocus:ne,onBlur:ie,onMouseMove:se,onMouseLeave:re,children:[(0,z.jsx)(o(197950).q,{createdTime:he.createdTime,lastEditedTime:he.lastEditedTime,discussionLocation:E,isResolved:ee,isSuggestionComment:e.isSuggestionComment,authorStore:fe}),P&&(0,z.jsx)("div",{style:Te.threadLine}),(0,z.jsxs)("div",{style:Te.commentElementsBelowUserRow,children:[Boolean(n)&&n,U&&(0,z.jsx)("div",{style:{marginTop:4},children:(0,z.jsx)(gt().Z,{containerStyle:Te.discussionInputContainer,showAvatar:!1,parentStore:e.store,blockStore:V,onCancel:we,onSubmit:ke,discussionInputStore:J,isEditingExistingComment:!0,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,commentStore:e.store,discussionFormat:(0,T().discussionLocationToDiscussionFormat)(E),canDrop:!0})}),Me&&!U&&(0,z.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,z.jsx)(y().Z,{onMore:"comment_unfurl"===E?void 0:je,moreElement:(0,z.jsxs)(C().Z,{disableUnderline:!0,style:Te.unfurlMoreWrapper,hoverColor:"blue",children:["…"," ",(0,z.jsx)("span",{children:(0,z.jsx)(p()._H,{id:"comment.truncated.showMoreLabel",defaultMessage:"more"})})]}),maxLines:ve,children:(0,z.jsx)(o(623498).Z,{style:Te.text,store:w().zP(e.store),disabled:!0,disabledMentionTypes:{date:!0},disableEquationInteraction:!0,inPageFind:De})}),de&&ue&&(0,z.jsx)(b().Z,{style:{alignSelf:"flex-end",marginRight:8,marginLeft:8}})]}),U||"comment_unfurl"===E?!Me&&(0,z.jsxs)("div",{style:Te.attachmentContainer,children:[(0,z.jsx)("div",{style:{marginRight:5},children:(0,o(738017).s)(Te.attachIcon)}),(0,z.jsx)(p()._H,{defaultMessage:"{numberOfAttachments, plural, one {{numberOfAttachments} attachment} other {{numberOfAttachments} attachments}}",values:{numberOfAttachments:Q.length},id:"comment.unfurl.attachments.title"})]}):Ee,Be&&(0,z.jsx)("div",{ref:Ie,style:{marginTop:8},children:(0,z.jsx)(Oe,{parentStore:e.store,discussionLocation:E})})]}),"comment_unfurl"!==E&&!U&&!de&&(0,z.jsx)(Ne,{store:e.store,discussionStore:e.discussionStore,blockStore:V,discussionLocation:E,visible:pe,isFirstComment:me,buttonPopupStore:le,canShowReactions:Ae,handleEditComment:ye,handleDeleteComment:xe,handleReaction:Ce})]})]})};o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(470928);var ft=()=>o(580397),vt=()=>o(349220),St=()=>o(191586),xt=()=>o(275200),bt=()=>o(32969),Ct=()=>o(908102);function yt(e){var t;let{discussionStore:o,commentStore:n}=e;if(!n.isDefined())return!1;const i=null===(t=pe().default.state.currentUserStore)||void 0===t?void 0:t.id;const s=Ct().Z.state.lastInteractionTimes[o.id];if(n.getCreatedById()===i)return!1;const r=function(){if(!o.isDefined()||!i)return 0;const{pageVisitStore:e}=pe().default.state,{lastViewTime:t,lastExitTime:n}=e.state;return n||t}();if(void 0===r)return!1;const a=(0,T().getAndSortCommentStoresByTime)(o).filter((e=>e.getCreatedById()===i)).reverse()[0],l=n.getCreatedTime();return!l||!(a&&l<a.getCreatedTime())&&(!(s&&l<s)&&l>r)}var wt=()=>o(72539),kt=()=>o(456681),jt=()=>o(521913),_t=()=>o(108714),It=()=>o(469203);const Lt="https://notion.notion.site/AI-Conflict-Detection-158efdeead058037b57efc2b77ad9c21";function Mt(e){let{origin:t}=e;const n=(0,d().yK)((e=>({learnMoreLink:{color:e.regularInvertedTextColor}})),[]);return(0,z.jsx)(o(125302).r,{origin:t,placementToOrigin:"bottom",tutorialId:"ai-comment-onboarding",tutorialStepId:"ai-comment-onboarding-tooltip",hideActions:!0,hideInsteadOfFlip:!0,header:(0,z.jsx)(p()._H,{id:"AiCommentOnboardingTooltip.header",defaultMessage:"Check for conflicts with Notion AI"}),content:(0,z.jsx)(p()._H,{id:"AiCommentOnboardingTooltip.content",defaultMessage:"Notion AI searches across your workspace and connected apps for conflicting information, using only sources that all members can access. {learnMoreLink}",values:{learnMoreLink:(0,z.jsx)(o(455241).d,{href:Lt,style:n.learnMoreLink})}})})}function Rt(e){const{discussionLocation:t,commentStore:o}=e,n=(0,c().VK)((()=>{if(!o)return!1;const e=o.getCreatedByPointer();return!!e&&e.id===wt().GR.id}),[o]),i=(0,r().Fy)(),s=(0,d().yK)((e=>({container:{display:"flex",flexDirection:"row",gap:6,width:"100%",color:e.lightTextColor,fontSize:i.isMobile?g().JB.UISmall.mobile:g().JB.UISmall.desktop,paddingTop:R().En,paddingLeft:R().vi(t)+R().IX-8},warningIcon:{width:10,height:10,alignSelf:"center",display:"inline-block",verticalAlign:"text-bottom"},helpIcon:{color:e.lightTextColor,flexDirection:"row-reverse",gap:6,width:14,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto"},text:{maxWidth:200}})),[i,t]);return n?(0,z.jsxs)("div",{style:s.container,children:[(0,jt().t)(s.warningIcon),(0,z.jsx)(It().s,{style:s.text,children:(0,z.jsx)(p()._H,{id:"aiCommentHeader.conflictingContent.label",defaultMessage:"Notion AI found potential conflicts"})}),(0,z.jsx)(_t().Z,{href:Lt,external:!0,style:s.helpIcon,children:(0,kt().m)({width:14,marginRight:4})})]}):null}var Tt=()=>o(297490),Dt=()=>o(550888),At=()=>o(190322),Bt=()=>o(474999),Et=()=>o(150376);var Pt=()=>o(527278);const Zt=(0,p().vU)({helpful:{id:"assistant.commentFeedback.helpful",defaultMessage:"Helpful"},notHelpful:{id:"assistant.commentFeedback.notHelpful",defaultMessage:"Not helpful"},feedbackPlaceholder:{id:"assistant.commentFeedback.feedbackPlaceholder",defaultMessage:"How can we improve?"},thankYou:{id:"assistant.commentFeedback.thankYou",defaultMessage:"Thank you for your feedback!"}});function Vt(e){const{blockStore:t}=e,n=t.id,i=function(e){const t=(0,r().O7)(),o=(0,c().VK)((()=>{const o=e.getNavigableBlockStore();if(o)return new(I().dV)(t,{table:Bt().te,id:o.id,spaceId:o.getSpaceId()})}),[t,e]);return(0,c().VK)((()=>{if(!o)return;const t=e.id,n=o.getRelatedContent().find((e=>e.targetId===t));return n?{feedback:Et().Z.state[n.inferenceId],inferenceId:n.inferenceId}:void 0}),[o,e.id])}(t),s=null==i?void 0:i.feedback,a=null==i?void 0:i.inferenceId,l=(0,r().O7)(),u=(0,o(356140).W)(),m=(0,d().yK)((()=>({container:{display:"flex",flexDirection:"column",gap:12,width:"100%"},buttonRow:{display:"flex",flexDirection:"row",gap:8}})),[]);return a?(0,z.jsx)("div",{style:m.container,children:(0,z.jsxs)("div",{style:m.buttonRow,children:[(0,z.jsx)(At().ZP,{title:Pt().Z.formatMessage(Zt.helpful),variant:"tinted",icon:"thumbs_up"===s?o(962310).w:o(94265).P,onClick:()=>{if(!u||!a)return;const e=t.getNavigableBlockStore();e&&(0,Dt().oJ)({environment:l,pageId:e.id,blockId:n,spaceId:u,inferenceId:a,thumbsUpOrDown:"up"})}}),(0,z.jsx)(At().ZP,{title:Pt().Z.formatMessage(Zt.notHelpful),variant:"tinted",icon:"thumbs_down"===s?o(242194).E:o(996927).A,onClick:()=>{if(!u||!a)return;const e=t.getNavigableBlockStore();e&&(0,Dt().oJ)({environment:l,pageId:e.id,blockId:n,spaceId:u,inferenceId:a,thumbsUpOrDown:"down"})}})]})}):null}const Ft={block_menu:"8px 16px 0px",page_discussion:"8px 0px 0px",updates_sidebar:"4px 16px 12px",margin_comments:"8px 12px 6px",comment_unfurl:"0",post_discussion:"0px -16px 0px",updates_menu_mentions_comments:"4px 16px 12px",updates_menu_all_updates:"4px 16px 12px",updates_menu_archive:"4px 16px 12px",reply_menu_mentions_comments:"8px 16px 0px",reply_menu_all_updates:"8px 16px 0px",reply_menu_archive:"8px 16px 0px",reply_menu_updates_sidebar:"8px 16px 0px",ai_reject_all_suggestions:"0"},Kt=i.forwardRef((function(e,t){const n=(0,r().O7)(),{format:s,role:a,showMoreCommentsButton:l,onMoreCommentsClick:m,inputVisible:p,blockStore:g,store:h}=e,f=(0,o(480089).cR)(g),v=a&&u().rz(a)||f,S=n.currentUser.isLoggedIn(),x=(0,i.useRef)(null),b=(0,d().yK)((t=>({container:{position:"relative",padding:0,...s===T().DiscussionFormat.Page?{marginLeft:16,marginRight:16}:{}},discussionInputContainer:{padding:Ft[e.discussionLocation]},aiFeedbackContainer:{display:"flex",flexDirection:"row",gap:8,marginLeft:"page_discussion"===e.discussionLocation?32:24,padding:Ft[e.discussionLocation]}})),[s,e.discussionLocation]),C=(0,c().VK)((()=>{const e=h.getCommentStores()[0];if(!e)return!1;const t=e.getCreatedByPointer();return!!t&&t.id===wt().GR.id}),[h]);return(0,z.jsx)(z.Fragment,{children:S&&!v&&(l||p)&&(0,z.jsxs)("div",{style:b.container,children:[l&&(0,z.jsx)(o(83447).Z,{onClick:m}),p&&(C?(0,z.jsxs)("div",{style:b.aiFeedbackContainer,ref:x,children:[(0,z.jsx)(Vt,{blockStore:g,location:e.discussionLocation}),(0,z.jsx)(Mt,{origin:x})]}):(0,z.jsx)(gt().Z,{autoFocus:!0,showAvatar:!0,containerStyle:b.discussionInputContainer,parentStore:e.store,onCancel:e.onCancel,onSubmit:e.onSubmit,discussionInputStore:e.discussionInputStore,isMobileSlideUpMenu:!1,shouldSaveUnsentComments:!0,onEditPreviousComment:e.onEditPreviousComment,inReplyToDiscussionId:e.store.id,discussionFormat:e.format,showCtaButtons:e.showCtaButtons,ref:t,onFileUploaded:e.onFileUploaded}))]})})}));var Ut=()=>o(777346);function Ht(e){const t=(0,d().yK)((t=>{const o=R().vi(e.discussionLocation)+R().IX;return{newBarLine:{height:"0px",borderBottom:`1px solid ${t.darkDividerColor}`,marginLeft:0,flex:1},moreCommentsWrapper:{color:t.lightTextColor,fontSize:14,flexGrow:1,display:"flex",alignItems:"center",paddingLeft:8},button:{borderRadius:6,fontSize:14,color:t.mediumTextColor,justifyContent:"space-between",padding:"14px 0",margin:`0 0 0 ${o}px`,width:`calc(100% - ${o}px - 16px)`},buttonHovered:{background:t.focusDiscussionInputBackground},threadLine:{position:"absolute",backgroundColor:t.stroke.secondary,width:R().Ky,height:"100%",top:R().En-R()._e,left:R().vi(e.discussionLocation)+R().fT,borderRadius:2}}}),[e.discussionLocation]);return e.count<=0?null:(0,z.jsxs)("div",{style:{position:"relative"},children:[(0,z.jsx)("div",{style:t.threadLine}),(0,z.jsx)(Ut().Z,{style:t.button,onClick:e.onClick,hoveredStyle:t.buttonHovered,children:(0,z.jsx)("div",{className:"discussion-show-all-button",style:t.moreCommentsWrapper,children:(0,z.jsx)(p()._H,{defaultMessage:"Show {moreCommentsNumber, plural, one {{moreCommentsNumber} reply} other {{moreCommentsNumber} replies}}",id:"discussion.showMoreCommentsSidebarButton.label",values:{moreCommentsNumber:e.count}})})},"show")]})}var Ot=()=>o(722917),zt=()=>o(641702);function Nt(e){const{discussionStore:t}=e,o=(0,p().YB)(),n=(0,c().VK)((()=>t.isSuggestionDiscussion()),[t]),i=(0,c().VK)((()=>{const t=e.discussionStore.getContext();return(t?(0,ft().GW)({discussionContextData:t,discussionId:e.discussionStore.id,discussionType:(0,vt().TO)(e.discussionStore.getType()),intl:o}):[])??[]}),[e.discussionStore,o]),s=(0,d().yK)((e=>({container:{marginTop:2},label:{color:e.text.uiBlueSecondary,fontSize:14,lineHeight:"18px"},labelDeleteColor:{color:e.text.tertiary},text:{color:e.text.uiBluePrimary,fontSize:14,lineHeight:1.29},textDeleteColor:{color:e.text.secondary},suggestionContextItem:{display:"block",marginBottom:4,whiteSpace:"pre-wrap",wordBreak:"break-word"},unfurlMoreWrapper:{color:e.lightTextColor,fontWeight:g().Ue.medium,display:"block",marginBottom:-1.5,pointerEvents:"auto"}})),[]),r=(0,Ot().Kc)(o).title;return n&&r&&0!==i.length?(0,z.jsx)("div",{style:s.container,children:(0,z.jsx)(y().Z,{maxLines:e.collapsed?1:void 0,clampOverride:{lineHeight:1.29,fontSize:14},moreElement:(0,z.jsxs)(C().Z,{disableUnderline:!0,style:s.unfurlMoreWrapper,hoverColor:"blue",children:["…"," ",(0,z.jsx)("span",{children:(0,z.jsx)(p()._H,{id:"suggestion.truncated.showMoreLabel",defaultMessage:"more"})})]}),children:i.map(((e,o)=>{let{label:n,value:i,shouldUseDeleteColor:r,removeQuotationMarks:a}=e;return(0,z.jsxs)("div",{style:s.suggestionContextItem,children:[(0,z.jsxs)("span",{style:{...s.label,...r&&s.labelDeleteColor},children:[n,": "]}),(0,z.jsxs)("span",{style:{...s.text,...r&&s.textDeleteColor},children:[a?null:"“",(0,z.jsx)(Wt,{value:i,discussionStore:t}),a?null:"”"]})]},o)}))})}):null}function Wt(e){let{value:t,discussionStore:o}=e;const n=(0,r().O7)(),i=(0,d().Fg)(),s=(0,c().VK)((()=>(0,zt().IY)({environment:n,textValue:{value:t,spaceId:o.pointer.spaceId},parentStore:o,disableHover:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!0,disableSuggestionAnnotations:!0,disabled:!0,theme:i,emojiType:(0,Me().e_)(n),katex:n.KatexStore.getKatex(),formulaValueTypes:[]})),[n,t,o,i]);return(0,z.jsx)("span",{children:s})}function $t(e){const{onDismiss:t}=e,n=(0,i.useRef)(null),a=(0,p().YB)(),u=(0,r().O7)(),g=(0,c().VK)((()=>"suggestion"===e.store.getType()),[e.store]),h=(0,c().VK)((()=>w().D4(e.store)),[e.store]),b=(0,c().VK)((()=>h.filter((e=>e.isDefined())).filter((e=>Boolean(e.getAlive())))),[h]),C="page_discussion"===e.discussionLocation?3:5;(0,i.useEffect)((()=>{b.length===C&&Z(!0)}),[b,C]);const y=(0,i.useRef)(e.discussionInputStore||new(A().Z)(u,e.store.pointer.spaceId)).current,j=(0,c().VK)((()=>(0,T().inputIsEmpty)(y)),[y]),M=(0,c().VK)((()=>(0,St().Wt)(e.blockStore)&&!(0,St().bm)(e.blockStore)),[e.blockStore]),D=(0,c().VK)((()=>e.store.getResolved()),[e.store]),[B,E]=(0,i.useState)(!1),[P,Z]=(0,i.useState)(void 0!==e.collapsed&&!e.collapsed),[V,F]=(0,i.useState)(!0),K=(0,c().qz)(void 0,o(561280).Z),U=(0,c().VK)((()=>K.state.clientRect),[K]),H=e.format===T().DiscussionFormat.Sidebar,O=e.format===T().DiscussionFormat.Margin,N=(0,i.useRef)(null);(0,l().c)(o(244826).Z,(()=>({isSidebarFormat:()=>H,isMarginFormat:()=>O,getStore:()=>e.store,getInputStore:()=>y,getNode:()=>N.current,getMarginDiscussionScrollContainer:()=>n.current})),[H,O,e.store,y]);const W=(0,c().VK)((()=>{if(!H)return;return(0,T().getAndSortCommentStoresByTime)(e.store).find((t=>yt({discussionStore:e.store,commentStore:t})))}),[H,e.store]),$=(0,i.useRef)(W),q=void 0===$.current?W:$.current,Y=(0,i.useCallback)((()=>{var t;if(P||b.length<=C||"block_menu"===e.discussionLocation)return b;if("page_discussion"===e.discussionLocation)return X().pm(b,1);const o=[e.showAllRepliesAfterTimestamp,null===(t=$.current)||void 0===t?void 0:t.getCreatedTime(),null==W?void 0:W.getCreatedTime()].filter(G().$K),n=o.length>0?Math.min(...o):void 0;if(n){const e=b.filter((e=>(e.getCreatedTime()||0)>n)),t=b.filter((e=>(e.getCreatedTime()||0)<=n));return t.length<=5?b:[...X().pm(t,2),...e]}return X().pm(b,2)}),[b,W,C,e.discussionLocation,e.showAllRepliesAfterTimestamp,P]),J=(0,c().VK)((()=>{const t=Y(),o=new Set(t.map((e=>e.id))),n=b.filter((e=>!o.has(e.id)));return{commentStores:b,commentsToShow:t,commentsToCollapse:n,reactionsToShow:I().bh.getUserVisibleReactions(e.store)}}),[b,Y,e.store],{useDeepEqual:!0}),Q=(0,i.useCallback)((()=>{if(!e.store.isDefined())return;const t=e.store.getContext();if(!t)return;const o=(0,ft().Bb)({discussionContextData:t,discussionType:(0,vt().TO)(e.store.getType()),discussionId:e.store.id,intl:a});return m().VP_(o,(t=>!m().xw5(t)||m().h19(t)===e.store.id))}),[e.store,a]),ee=(0,c().VK)((()=>{if(!H)return;return(0,T().getAndSortCommentStoresByTime)(e.store).find((t=>yt({discussionStore:e.store,commentStore:t})))}),[H,e.store]),te=(0,i.useRef)(null),oe=(0,i.useRef)(e.blockStore.clone()).current,ne=(0,d().yK)((t=>({discussionWrapper:{...e.format===T().DiscussionFormat.Page&&{margin:`0px ${R().n4}px 16px`,..."post_discussion"===e.discussionLocation&&{marginLeft:-16,marginBottom:J.reactionsToShow.length>0?0:12}},...e.format===T().DiscussionFormat.Menu&&{padding:"6px 0 12px",marginLeft:-2,boxShadow:e.isFirst?"none":`0 -1px 0 ${t.regularDividerColor}`,marginTop:e.isFirst?0:1},...e.format===T().DiscussionFormat.Margin&&{padding:"4px 0",borderRadius:8}},reactionBarWrapper:{paddingLeft:16,paddingRight:16,..."post_discussion"===e.discussionLocation&&{display:"flex",justifyContent:"space-between"}}})),[J.reactionsToShow.length,e.discussionLocation,e.format,e.isFirst]);(0,i.useEffect)((()=>{u.KatexStore.loadIfNeeded(Q)}),[u.KatexStore,Q]);const ie=(0,i.useCallback)((t=>{const{device:n}=u;if(!n.isMobile)return;if(!e.store.isDefined())return;t.stopPropagation(),t.preventDefault(),o(980316).Z.setState({open:!1});const i=X().oA(bt().C.findSelectablesFromIds([e.store.getParentId()])),s=null==i?void 0:i[0];s&&v().XW({environment:u,handle:s,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})}),[e.store,u]),se=(0,i.useCallback)((e=>{O||(e.stopPropagation(),Z(!0))}),[O]),re=(0,i.useMemo)((()=>{const{commentStores:t,commentsToShow:i,commentsToCollapse:s}=J;if(O){const i=(0,T().lineClampForCommentCount)(t.length);if(!e.collapsed)return(0,z.jsx)(o(842574).T,{style:{display:"flex",flexDirection:"column",maxHeight:500,overflowY:"scroll"},ref:n,type:o(520849).Z.Y,store:K,children:t.map(((o,n)=>{const s=g&&0===n;return(0,z.jsx)(ht,{store:o,discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:B,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:i,shouldShowThreadLine:n!==t.length-1,discussionContext:s?(0,z.jsx)(Nt,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):void 0,isSuggestionComment:s},o.id)}))});const s=t[0]&&(0,z.jsx)(ht,{store:t[0],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:B,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:i,collapsed:e.collapsed,shouldShowThreadLine:1!==t.length,discussionContext:g?(0,z.jsx)(Nt,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):void 0,isSuggestionComment:g},t[0].id),r=t.length>1&&t[t.length-1]&&(0,z.jsx)(ht,{store:t[t.length-1],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:B,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:i,collapsed:e.collapsed,shouldShowThreadLine:!1},t[t.length-1].id),a=t.length-2;return(0,z.jsxs)(z.Fragment,{children:[s,(0,z.jsx)(Ht,{insetButton:!O,count:a,onClick:se,discussionLocation:e.discussionLocation}),r]})}const r=s.length>0,a=i.map(((t,o)=>{const n=g&&0===o,s=n?(0,z.jsx)(Nt,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):0===o&&!r&&(e.format===T().DiscussionFormat.Menu||e.format===T().DiscussionFormat.Sidebar)&&(0,z.jsx)(Tt().Z,{format:e.format,discussionLocation:e.discussionLocation,store:e.store,blockStore:e.blockStore,onClick:ie}),a="post_discussion"===e.discussionLocation?(0,T().lineClampForCommentCount)(i.length):void 0;return(0,z.jsx)(ht,{store:t,discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:B,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,discussionContext:s,isSuggestionComment:n,showNewBar:t.id===(null==q?void 0:q.id)&&0!==o,shouldShowThreadLine:o!==i.length-1,maxLines:a},t.id)})),l=g,c=l?(0,z.jsx)(Nt,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):(e.format===T().DiscussionFormat.Menu||e.format===T().DiscussionFormat.Sidebar)&&(0,z.jsx)(Tt().Z,{format:e.format,discussionLocation:e.discussionLocation,store:e.store,blockStore:e.blockStore,onClick:ie});return(0,z.jsxs)("div",{style:{position:"relative"},children:[H&&ee&&(0,z.jsx)(o(819792).z,{style:Yt}),r&&(0,z.jsx)(ht,{store:t[0],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:B,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,discussionContext:c,shouldShowThreadLine:1!==t.length,isSuggestionComment:l,collapsed:e.collapsed,maxLines:"post_discussion"===e.discussionLocation&&e.collapsed?(0,T().lineClampForCommentCount)(t.length):void 0},t[0].id),(0,z.jsx)(Ht,{insetButton:!O,count:s.length-1,onClick:se,discussionLocation:e.discussionLocation}),a]})}),[null==q?void 0:q.id,J,ie,se,ee,B,O,H,g,e.blockStore,e.collapsed,e.discussionLocation,e.format,e.showResolveButtonByDefaultIfPossible,e.store,K]),ae=(0,c().VK)((()=>e.blockStore.getRole()),[e.blockStore]),[le,ce]=(0,i.useState)(!0);(0,i.useEffect)((()=>{var e;const t=null===(e=n.current)||void 0===e?void 0:e.getNode();if(t){function o(){t&&ce(xt().N0(t))}return t.addEventListener("scroll",o),()=>t.removeEventListener("scroll",o)}}),[n]);const de=V&&!e.collapsed&&O&&U&&!le,ue=(0,i.useCallback)((()=>{const e=bt().C.findSelectableFromStore(oe);e&&v().XW({environment:u,handle:e,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})}),[oe,u]),me=(0,i.useCallback)((()=>{y.reset()}),[y]),pe=(0,i.useCallback)((()=>{const t=u.currentUser.id;if(!t)return;const o=w().D4(e.store).filter((e=>e.getCreatedById()===t)),n=X().Z$(o);if(!n)return;if(g&&1===o.length)return;const i=k().Z.find((t=>t.commentId===n.id&&t.discussionLocation===e.discussionLocation));i&&(S().clear({environment:u}),i.edit())}),[e.discussionLocation,g,e.store,u]),ge=(0,i.useCallback)((async()=>{if((0,T().hasCommentChanged)(y)){const{accept:e}=await f().gt({message:(0,z.jsx)(p()._H,{defaultMessage:"Do you want to discard this reply?",id:"discussion.confirmDialog.discardReply.prompt"}),acceptLabel:(0,z.jsx)(p()._H,{defaultMessage:"Discard",id:"discussion.confirmDialog.discardReplyButton.label"})});e?(me(),t&&t()):(await s().default.afterNextFlush(),S().setSelectionAtEnd({store:y.state.textStore}))}else me(),t&&t()}),[t,y,me]),he=(0,i.useCallback)((()=>{s().default.afterNextFlush((()=>{var e;const t=null===(e=n.current)||void 0===e?void 0:e.getNode();t&&xt().X5({element:t,environment:u,options:{top:t.scrollHeight,behavior:"smooth"}})}))}),[n,u]),fe=X().Ds((()=>{setTimeout((()=>F(!0)),50)}),50),ve=(0,i.useCallback)((async()=>{F(!1);const{device:t}=u;x().createAndCommit({userAction:"Discussion.handleSubmitReply",environment:u,canUndo:!0,perform:t=>{L().Xi({environment:u,discussionStore:e.store,textValue:y.state.textStore.getValue()||[],transaction:t,discussionLocation:e.discussionLocation,files:y.state.files,property_id:e.store.getPropertyId(),blockStore:e.blockStore})}}),me(),S().clear({environment:u}),he(),fe(),t.isMobile||(await s().default.afterNextFlush(),S().setSelectionAtStart({store:y.state.textStore}))}),[y,fe,e.blockStore,e.store,e.discussionLocation,he,u,me]),Se=(0,i.useCallback)((()=>{_().Z.state||E(!0)}),[]),xe=(0,i.useCallback)((()=>{E(!1)}),[]);return 0===J.commentsToShow.length&&J.reactionsToShow.length>0||"post_discussion"===e.discussionLocation&&0===J.commentsToShow.length&&J.reactionsToShow.length>0?(0,z.jsxs)("div",{ref:N,style:{...ne.discussionWrapper,...ne.reactionBarWrapper},onMouseMove:Se,onMouseLeave:xe,children:[(0,z.jsx)(He,{focused:!0,disableShadow:!0,parentStore:e.store,discussionLocation:e.discussionLocation}),"post_discussion"===e.discussionLocation&&(0,z.jsx)(o(259878).W4,{pageVisitStore:e.pageVisitStore,presenceStore:e.presenceStore,rootStore:e.blockStore,maxUsers:5,isShowingInPostFeed:!0})]}):(0,z.jsx)(o(307369).Z,{store:oe,analyticsName:"discussion",canNativeDropOnto:!0,onNativeDrop:async e=>{let{files:t}=e;te.current&&await te.current.uploadFiles(t)},keepTextSelectionOnDrop:!0,shouldShowDropZone:!0,children:(0,z.jsxs)("div",{ref:N,style:ne.discussionWrapper,onMouseMove:Se,onMouseLeave:xe,children:[!e.collapsed&&(0,z.jsx)(Rt,{commentStore:h[0],discussionLocation:e.discussionLocation}),re,D?(0,z.jsx)("div",{style:{height:8}}):(0,z.jsx)(Kt,{ref:te,showMoreCommentsButton:!!de,onMoreCommentsClick:he,inputVisible:!(M||e.collapsed&&j&&"post_discussion"!==e.discussionLocation),store:e.store,blockStore:oe,format:e.format,discussionInputStore:y,discussionLocation:e.discussionLocation,onCancel:ge,onSubmit:ve,onEditPreviousComment:pe,showCtaButtons:!!O||void 0,onFileUploaded:ue,role:ae})]})})}const qt=i.memo($t),Yt={marginRight:4,position:"absolute",right:16,top:14};var Xt=()=>o(527188),Gt=()=>o(251932),Jt=()=>o(589525),Qt=()=>o(954452);const eo=(0,p().vU)({commentsAriaLabel:{defaultMessage:"{count, plural, one {1 comment} other {{count} comments}}",id:"comments.components.discussionindicator.commentAriaLabel"},suggestionsAriaLabel:{defaultMessage:"{count, plural, one {1 suggestion} other {{count} suggestions}}",id:"comments.components.discussionindicator.suggestionAriaLabel"},reactionsAriaLabel:{defaultMessage:"{count, plural, one {1 reaction} other {{count} reactions}}",id:"comments.components.discussionindicator.reactionsAriaLabel"}});function to(e){const t=(0,p().YB)(),{store:n,propertyId:i,style:s}=e,{showIndicator:a,formattedReactionCount:l,onlySuggestions:u,icon:m,showReactionsIcon:h,onlyHasDraftIndicator:f,formattedCommentCount:v,handleClick:S,discussionIsSelected:x,commentsCount:b,shouldShowDraftIndicator:C}=(0,o(678910).Z)({store:n,recursivelyLoadAllDiscussions:!1,onlyCountBlockLevelDiscussions:!1,propertyId:i}),y=(0,d().yK)((e=>({iconButton:{background:x?e.selectLightGray[100]:void 0,gap:2},icon:{width:14,color:e.lightTextColor},commentCount:{marginLeft:2,color:e.lightTextColor,fontWeight:g().Ue.semibold,marginBottom:1},reactIcon:{width:14,height:14,color:e.lightTextColor},commentCaptionStyle:{fontWeight:g().Ue.semibold,...C?{color:e.icon.tertiary}:{color:e.lightTextColor,marginBottom:1}},reactionCaptionStyle:{fontWeight:g().Ue.semibold,color:e.lightTextColor}})),[x,C]),w=(0,r().O7)(),k=(0,c().VK)((()=>(0,Jt().vK)(w)),[w]),j=(0,c().VK)((()=>(0,Qt().fg)(w,n)),[w,n]),{isPropertyInPageDetails:_}=(0,o(70191).d0)({store:n,propertyId:i});return!a||!_&&(k||j)?null:(0,z.jsxs)(Gt().gq,{style:s,children:[(b>0||f)&&(0,z.jsxs)(Gt().gq,{style:{position:"relative"},children:[(0,z.jsx)(te().Z,{ariaLabel:u?t.formatMessage(eo.suggestionsAriaLabel,{count:v}):t.formatMessage(eo.commentsAriaLabel,{count:v}),icon:m,style:y.iconButton,iconStyle:y.icon,onClick:S,caption:v,captionStyle:y.commentCaptionStyle}),C&&(0,z.jsx)(o(211332).Z,{customTop:3,customLeft:16,onlyShowDraftDot:!0})]}),h&&(0,z.jsx)(te().Z,{ariaLabel:t.formatMessage(eo.reactionsAriaLabel,{count:l}),icon:o(85078).a,style:y.iconButton,iconStyle:y.icon,onClick:S,captionStyle:y.reactionCaptionStyle,caption:l})]})}const oo=i.memo(to);var no=()=>o(887430),io=()=>o(942226),so=()=>o(435308),ro=()=>o(463212),ao=()=>o(574767),lo=()=>o(958783),co=(o(749411),()=>o(135796)),uo=()=>o(630078),mo=()=>o(67961),po=()=>o(46335),go=()=>o(176691),ho=()=>o(252100);function fo(e){let{discussionData:{groupedDiscussionsData:t,newDiscussionData:o,id:n},onClick:s}=e;const[a,l]=(0,i.useState)(!1),u=(0,r().O7)(),m=u.currentUser.id,h=(0,i.useCallback)((()=>{l(!0)}),[]),f=(0,i.useCallback)((()=>{l(!1)}),[]),v=o,S=(0,i.useCallback)((async e=>{if(v){const e=pe().default.state.mainEditorCurrentBlockStore;B().Z.setActiveWithSource("margin_comments"),await(0,ho().U)({currentBlockStore:e,discussionInputStore:o.discussionInputStore,environment:u})}else if(t.length>0){const o=t[0].discussionStore;await s(e,o)}}),[v,t,null==o?void 0:o.discussionInputStore,u,s]),{commentStores:x,reactionStores:b}=(0,c().VK)((()=>{if(t){return{commentStores:t.flatMap((e=>(0,w().D4)(e.discussionStore))),reactionStores:t.flatMap((e=>I().bh.getUserVisibleReactions(e.discussionStore)))}}return{commentStores:[],reactionStores:[]}}),[t]),C=(0,c().VK)((()=>{let e;if(v&&(e=o.parentBlockStore),t.length>0&&(e=t[0].parentBlockStore),!e)return;const n=x.map((e=>e.getCreatedById())).filter(G().$K),i=b.map((e=>e.getActorPointers().map((e=>e.id)))).flat().filter(G().$K);return Array.from(new Set([...n,...i,...v&&m?[m]:[]])).map((t=>I().U6.createChildStore(e,{table:Y().KJ,id:t}))).slice(0,5)}),[t,v,x,b,m,null==o?void 0:o.parentBlockStore]),y=(0,c().VK)((()=>{const e=x.map((e=>e.getLastEditedTime())),t=b.map((e=>e.getCreatedTime()));return Math.max(...e,...t)}),[x,b]),k=(0,d().yK)((e=>({discussion:{background:a?e.hoveredMarginDiscussionBackground:e.contentBackground,width:Qt().Z,display:"flex",cursor:"pointer",border:`1px solid ${e.stroke.secondary}`,borderRadius:10,padding:"12px",alignItems:"center",gap:6},userAvatarsContainer:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"row-reverse",marginRight:8},hiddenUsers:{fontSize:14,color:e.mediumTextColor,marginRight:6},lastEditedTime:{margin:"1px 0px 0px 0px",whiteSpace:"normal",display:"flex",justifyContent:"center",alignItems:"center",color:e.text.tertiary,fontSize:12,lineHeight:"15px"},commentAuthorAvatarStyle:{borderRadius:20,position:"relative",userSelect:"none",WebkitUserSelect:"none",width:24,height:24,boxShadow:e.avatarBoxShadow,marginRight:-6},commentAuthorPlaceholderStyle:{width:20,height:20,borderRadius:20,marginRight:-3,position:"relative"},secondaryLabel:{fontSize:g().JB.UISmall.desktop,whiteSpace:"normal",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:"21px",marginLeft:0,marginTop:0,color:e.text.tertiary},expandIcon:{width:g().JB.UISmall.desktop,height:g().JB.UISmall.desktop,fill:e.lightTextColor,marginTop:1},expandDiv:{display:"flex",justifyContent:"center",alignItems:"center",marginLeft:0}})),[a]),j=(0,z.jsx)("div",{style:k.secondaryLabel,children:(0,z.jsx)(p()._H,{defaultMessage:"Draft",id:"marginComments.collapsed.draft.label"})}),_=(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{style:k.expandDiv,children:(0,uo().s)(k.expandIcon)}),v?j:(0,z.jsx)("div",{style:k.secondaryLabel,children:(0,z.jsx)(p()._H,{defaultMessage:"Expand",id:"marginComments.collapsed.expand.label"})})]}),L=v?j:y&&(0,z.jsx)(mo().Z,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:k.lastEditedTime,children:(0,z.jsx)(po().Z,{text:(0,go().IS)(y,{useUltraCompactFormat:!0}),tooltipText:(0,go().uy)(y),icon:co().C})});return(0,z.jsxs)("div",{style:k.discussion,onMouseEnter:h,onMouseLeave:f,onClick:S,className:le().S9A,children:[(0,z.jsx)("div",{style:k.userAvatarsContainer,children:null==C?void 0:C.map((e=>(0,z.jsx)(Te().S,{authorStore:e,avatarSize:24,avatarStyle:k.commentAuthorAvatarStyle,placeholderStyle:k.commentAuthorPlaceholderStyle},e.id)))}),(0,z.jsx)(vo,{reactionCount:b.length,commentCount:x.length+(v?1:0)}),a?_:L]})}function vo(e){const t=(0,d().yK)((e=>({commentCount:{fontSize:14,whiteSpace:"normal",marginLeft:0,color:e.text.primary,fontWeight:g().Ue.medium,lineHeight:"18px"},textPlaceholder:{background:e.lightDividerColor,height:14,width:81,borderRadius:4,marginLeft:4}})),[]);return e.commentCount>0?(0,z.jsx)("div",{style:t.commentCount,children:(0,z.jsx)(p()._H,{defaultMessage:"{numComments, plural, one {{numComments} comment} other {{numComments} comments}}",id:"marginComments.collapsed.numComments.count",values:{numComments:e.commentCount}})}):e.reactionCount>0?(0,z.jsx)("div",{style:t.commentCount,children:(0,z.jsx)(p()._H,{defaultMessage:"{numReactions, plural, one {{numReactions} reaction} other {{numReactions} reactions}}",id:"marginComments.collapsed.numReactions.count",values:{numReactions:e.reactionCount}})}):(0,z.jsx)("div",{style:t.textPlaceholder})}var So=()=>o(177804),xo=()=>o(141735),bo=()=>o(604068);function Co(e){let{discussionData:{parentBlockStore:t,discussionInputStore:o},isVisible:n}=e;const s=(0,i.useRef)(null),a=(0,r().O7)(),l=(0,i.useCallback)((async()=>{const e=await xo().F.formulas.load();bo().Dc({environment:a,allowActionsWhileCommenting:!0,formulasModule:e})}),[a]),u=(0,c().VK)((()=>o.isEmpty()),[o]),m=(0,i.useCallback)((()=>{B().Z.setActiveWithSource("margin_comments")}),[]),p=(0,i.useCallback)((()=>{B().Z.resetActiveSource("margin_comments")}),[]),g=(0,i.useCallback)((()=>{u&&lo().default.reset(),B().Z.resetEditorActiveSources()}),[u]),h=(0,i.useCallback)((()=>{B().Z.setHoverWithSource("margin_comments")}),[]),f=(0,i.useCallback)((()=>{B().Z.resetHoverSource("margin_comments")}),[]),v=(0,i.useMemo)((()=>[`.${le().mJW}`]),[]),S=(0,c().VK)((()=>B().Z.state.isActivelyComposing),[]),x=(0,c().VK)((()=>B().Z.state.isHovered&&!B().Z.state.isActivelyComposing),[]),b=Boolean(S||u);(0,So().O)({active:n&&b,closeHandler:g,ref:s,excludedSelectors:v,ignoreKeydown:!0});const C=(0,d().yK)((e=>({discussion:{borderRadius:10,...S?{boxShadow:e.shadowSM}:{border:`1px solid ${e.lightDividerColor}`},width:Qt().Z,background:e.selectedMarginDiscussionBackground,willChange:"transform",transition:"transform 200ms ease",transform:S?"translateX(-20px)":x?"translateX(-5px)":void 0},discussionInputContainer:{borderRadius:6,padding:"8px 0px 4px 12px",backgroundColor:x?e.hoveredMarginDiscussionBackground:void 0}})),[S,x]);return(0,z.jsx)("div",{style:C.discussion,ref:s,className:le().S9A,onMouseEnter:h,onMouseLeave:f,children:(0,z.jsx)(gt().Z,{parentStore:t,discussionInputStore:o,shouldSaveUnsentComments:!1,isMobileSlideUpMenu:!1,discussionFormat:T().DiscussionFormat.Margin,onSubmit:l,onCancel:g,isNewComment:!0,blockStore:t,canDrop:!0,showAvatar:!1,containerStyle:C.discussionInputContainer,showCtaButtons:!0,onFocus:m,onBlur:p})})}function yo(e){let{discussionData:{discussionStore:t,parentBlockStore:n},timeMounted:s,onClick:a,isVisible:l,isDiscussionSelected:u,isDiscussionHovered:m}=e;const p=(0,i.useRef)(null),g=(0,r().O7)(),[f,v]=(0,i.useState)((()=>new(A().Z)(g,t.pointer.spaceId))),S=(0,me().E)("block_reactions"),x=t.id,b=(0,c().VK)((()=>t.getCommentStores().length>0),[t]),C=(0,c().VK)((()=>t.getReactionStores().length>0),[t]),y=(0,i.useMemo)((()=>[`.${(0,o(26970).dk)({discussionId:x})}`,`.${le().mJW}`,`.${le().S9A}`]),[x]),w=(0,i.useCallback)((async()=>{const e=k().Z.find((e=>e.isEditing()));if(e){if(!(await e.handleCancelEdit()))return}h().LZ()}),[]);(0,So().O)({active:l&&u,closeHandler:w,ref:p,excludedSelectors:y,ignoreKeydown:!0});const j=(0,d().yK)((e=>({discussion:{border:u?void 0:`1px solid ${e.lightDividerColor}`,borderRadius:10,padding:u?"1px":void 0,background:u?e.selectedMarginDiscussionBackground:m?e.hoveredMarginDiscussionBackground:e.contentBackground,boxShadow:u?e.shadowSM:void 0,width:Qt().Z,cursor:u?void 0:"pointer"},wrapper:{willChange:"transform",transition:"transform 200ms ease",transform:u?"translateX(-20px)":m?"translateX(-5px)":void 0}})),[m,u]),_=(0,i.useCallback)((async e=>{var n;u||(o(248825).Uw(g,{discussion_id:t.id,discussion_type:t.getType(),from:"margin_comments",parent_block_id:t.getParentId(),parent_collection_id:null===(n=t.getParentStore())||void 0===n?void 0:n.getParentCollectionIdUpToTwoLevels()}),await a(e,t))}),[a,t,u,g]);return(0,z.jsxs)("div",{className:le().S9A,ref:p,style:j.wrapper,onClick:_,children:[C&&S&&(0,z.jsx)("div",{style:{width:Qt().Z},children:(0,z.jsx)(He,{focused:u,parentStore:t,discussionLocation:"margin_comments"})}),b&&(0,z.jsx)("div",{style:j.discussion,children:(0,z.jsx)(qt,{store:t,blockStore:n,format:T().DiscussionFormat.Margin,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"margin_comments",showAllRepliesAfterTimestamp:s,discussionInputStore:f,collapsed:!u})})]})}const wo=i.memo(yo);function ko(e){const{discussionData:t,isLastItem:o,isDiscussionSelected:n,discussionItemElementMap:s}=e,a=(0,d().yK)((()=>({discussionContainer:{transition:t.hide?void 0:"opacity 200ms ease-in-out",top:t.offsetTop,position:"absolute",paddingBottom:o?Qt().Vs:Qt().wo,zIndex:n?1:void 0,opacity:t.hide?0:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",pointerEvents:"auto"}})),[t.hide,t.offsetTop,n,o]);let l;const u=t.type,m=(0,r().O7)();(0,c().VK)((()=>(0,Qt().az)(m,t.parentBlockStore)),[m,t.parentBlockStore])?"existing"===u?l=(0,z.jsx)(wo,{...e,discussionData:t}):"new"===u?l=(0,z.jsx)(Co,{...e,discussionData:t}):"grouped"===u?l=(0,z.jsx)(fo,{...e,discussionData:t}):(0,G().t1)(u):l=null;const p=(0,i.useCallback)((()=>{ao().Z.setState({source:"margin_comments",discussionIds:[t.id]})}),[t.id]),g=(0,i.useCallback)((()=>{ao().Z.setState({discussionIds:[]})}),[]),h=(0,i.useCallback)((e=>{s.set(t.id,e)}),[t.id,s]);return(0,z.jsx)("div",{style:a.discussionContainer,onMouseEnter:p,onMouseLeave:g,ref:h,children:l})}const jo=i.memo(ko),_o=`.${ro().zd}, .${ro().FB}`;function Io(e){let{pageBlockStore:t,timeMounted:n,isVisible:s,animating:a,pageViewBlockAccessor:l,width:u,context:m}=e;const p=(0,r().O7)(),g=(0,i.useRef)(null),h=(0,i.useRef)(new Map),f=(0,i.useRef)(new Map),v=(0,c().VK)((()=>ao().Z.getFirstSelectedDiscussionId()),[]),S=(0,i.useCallback)((async(e,n)=>{(0,o(154057).X9)()||e.target instanceof Element&&e.target.closest(_o)||await L().Ri({discussionStore:n,currentBlockStore:t,environment:p,analyticsFrom:"margin_comments",currentEl:g.current})}),[t,p]),[x,b]=(0,i.useState)({data:[],hasNewDiscussion:!1,selectedDiscussion:void 0}),[C,y]=(0,i.useState)(!1),{WindowSizeStore:w}=p,k=o(467171).R6(p.device.isElectronMac);(0,i.useEffect)((()=>{if(!s)return;const e=new(so().default)((()=>({selectableRectMap:o(797522).default.state.selectableRectMap,pageContentStores:t.getContentStores(),sidebarIsAnimating:o(590972).default.state.isAnimating,windowHeight:w.state.height})),{debugName:"effectDataStore"}),n=new(so().default)((()=>Qt().EM.state),{debugName:"discussionStoresStore"}),i=new(so().default)((()=>{const e=lo().default.state,t=lo().default.getBlockStore(),n=lo().default.getClosestBlockStore();if(e.open&&e.rect&&"comment"===e.content&&(t||n)&&(!t||o(163085).Z.isBlockInFrame(t)&&!e.property_id))return{recomputeFocus:B().Z.state.isActivelyComposing,blockStore:t??e.blockStore,discussionInputStore:e.discussionInputStore}}),{debugName:"newMarginDiscussionArgsStore"}),r=new(so().default)((()=>{if(!B().Z.state.isActivelyComposing)return j().Z.getFramePageFirstSelectedDiscussionId();j().Z.reset()}),{debugName:"selectedDiscussionIdStore"});let c=!1;const d=(0,X().Ds)((()=>{const{selectableRectMap:o,pageContentStores:s,sidebarIsAnimating:d,windowHeight:u}=e.state,v=n.state,S=i.state,w=r.state;if(a||d)return;const j=l();if(!(j&&g.current&&o&&o.size))return;(0,Qt().H0)({discussionStores:v,pageContentStores:s,marginDiscussionItemRefs:h.current,selectedDiscussionId:w,newMarginDiscussionArgs:S,marginContainerElement:g.current,pageViewBlockElement:j,onComputeComplete:(e,t)=>{c||(f.current=t,C||y(!0),b(e))},computedOnce:C,topbarHeight:k,windowHeight:u,isFullWidth:(0,St().mO)(t,m,p),prevSelectedDiscussionId:x.selectedDiscussion,previousDiscussionElements:f.current})}),5);return e.addListener(d),n.addListener(d),r.addListener(d),i.addListener(d),()=>{c=!0,e.removeListener(d),n.removeListener(d),r.removeListener(d),i.removeListener(d)}}),[s,a,l,C,t,x.selectedDiscussion,w,k,p,m]);const _=(0,d().yK)((()=>({marginCommentsContainer:{display:"flex",flexDirection:"column",paddingTop:8,paddingBottom:8,paddingLeft:Qt().fS,paddingRight:Qt().fS,width:u-2*Qt().fS,flexShrink:0,height:"100%",position:"relative",pointerEvents:"none",zIndex:o(492522).p8}})),[u]);return(0,z.jsx)("div",{style:_.marginCommentsContainer,ref:g,children:x.data.map(((e,t)=>(0,z.jsx)(jo,{discussionData:e,timeMounted:n,onClick:S,isVisible:s,discussionItemElementMap:h.current,isDiscussionSelected:e.selected||"new"===e.type,isDiscussionHovered:e.id===v,isLastItem:t===x.data.length-1},`margin-discussion-${e.id}`)))})}const Lo=i.memo(Io);function Mo(e){let{pageBlockStore:t,isVisible:o,pageViewBlockAccessor:n,context:s,isCollapsedAnchor:a}=e;const[l,u]=(0,i.useState)(!1),m=(0,r().O7)(),p=(0,i.useMemo)((()=>(new Date).getTime()),[]),g=(0,c().VK)((()=>{const e=(0,St().mO)(t,s,m);return a?{paddingLeft:e?96:16,height:0}:e?void 0:{position:"absolute",right:(0,Qt().oS)(m,(0,io().wq)(t),(0,no().Ks)(t))}}),[t,s,m,a]),h=(0,i.useCallback)((()=>{u(!0)}),[]),f=(0,i.useCallback)((()=>{u(!1)}),[]),v=(0,d().yK)((()=>({marginCommentsSection:{display:o||l?"flex":"none",flexShrink:0,pointerEvents:"none",width:o?Qt().QB:0,...g}})),[o,l,g]);return(0,z.jsx)(xe().Z,{animate:{opacity:o?1:0},onAnimationStart:h,onAnimationEnd:f,style:v.marginCommentsSection,children:(0,z.jsx)(Lo,{pageBlockStore:t,timeMounted:p,isVisible:o,animating:l,pageViewBlockAccessor:n,width:Qt().QB,context:s})})}var Ro=()=>o(573357),To=()=>o(967092),Do=()=>o(299519);const Ao=function(e){const{capture:t,children:n}=e,s=(0,i.useRef)(null);return(0,l().c)(o(81821).Z,(()=>({getNode:()=>s.current,isCaptured:()=>t})),[t]),(0,z.jsx)("div",{ref:s,children:i.Children.only(n)})};var Bo=()=>o(10271),Eo=()=>o(104088);function Po(e){let{blockStore:t,discussionInputStore:o,handleDismiss:n}=e;const s=(0,r().O7)(),{device:a,WindowSizeStore:l}=s,u=(0,i.useCallback)((async()=>{const e=await xo().F.formulas.load();bo().Dc({environment:s,allowActionsWhileCommenting:!0,formulasModule:e})}),[s]),m=(0,c().VK)((()=>({paddingLeft:a.isMobileNative?l.getSafePaddingLeftCSS(12):12,paddingRight:a.isMobileNative?l.getSafePaddingRightCSS(8):8})),[l,a.isMobileNative]),p=(0,d().yK)((()=>({inputWrapper:{width:a.isMobileNative?"100%":470,maxWidth:a.isMobileBrowser?"90vw":"100%",paddingTop:9,paddingBottom:a.isAndroid?12:8,paddingLeft:m.paddingLeft,paddingRight:m.paddingRight}})),[a,m]);return(0,Bo().Z)({shouldPreserveTextSelection:!0,shouldPreserveBlockSelection:!0,shouldRestoreSelection:!0}),(0,z.jsx)(Ro().Z,{capture:!0,allowOpenLinkMenu:!0,render:()=>(0,z.jsx)(Do().Z,{store:t,droppable:!0,render:()=>(0,z.jsx)(Ao,{capture:!0,children:(0,z.jsx)("div",{style:p.inputWrapper,children:(0,z.jsx)(gt().Z,{showAvatar:!0,parentStore:t,onCancel:n,onSubmit:u,discussionInputStore:o,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,discussionFormat:T().DiscussionFormat.Page,blockStore:t,canDrop:!0})})})},t.id)})}const Zo=function(){const e=(0,r().O7)(),t=(0,r().MO)(),n=(0,c().VK)((()=>lo().default.state.rect),[]),s=(0,c().VK)((()=>{if(lo().default.state.open&&"comment"===lo().default.state.content){const{discussionInputStore:o}=lo().default.state;if((0,Jt().vK)(e))return null;if(lo().default.updateRect(),B().Z.state.isActivelyComposing){"comments_pane"===B().Z.state.clickEntryPoint&&B().Z.setActiveWithSource("popover_comments");const n=lo().default.getBlockStore();var t;if(n)return{blockStore:n,discussionInputStore:o,canMarginCommentsRender:!(null!==(t=lo().default.state)&&void 0!==t&&t.property_id)&&(0,Qt().az)(e,n)}}}return null}),[e]),a=(0,i.useCallback)((()=>{const t=null==s?void 0:s.discussionInputStore;t&&(0,o(40302).l)({discussionInputStore:t,environment:e})}),[e,s]),l=(0,i.useCallback)((()=>{lo().default.hasContent()?B().Z.resetEditorActiveSources():s&&(0,o(300329).C)(e)}),[e,s]);(0,i.useEffect)((()=>{function t(t){const n=lo().default.state,i=n.open&&"comment"===n.content&&n.discussionInputStore||void 0;i&&((0,o(879920).uK)({discussionInputStore:i,environment:e,discussionHelpers:T()}),t.preventDefault())}return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}}),[e]);const d=(0,c().VK)((()=>o(121700).Z.state.isOpen),[]);return(0,c().VK)((()=>B().Z.state.overlapsExistingDiscussionMenu),[])?null:(0,z.jsx)(To().ZP,{popupType:t?Eo().k.SlideUp:Eo().k.Popup,keepFocus:!0,open:null!==s&&(!s.canMarginCommentsRender||d),originRect:n,placementToOrigin:je().Placement.Bottom,alignmentToOrigin:je().Alignment.Center,originGap:4,onDismiss:l,render:()=>s?(0,z.jsx)(Po,{blockStore:s.blockStore,discussionInputStore:s.discussionInputStore,handleDismiss:l}):null,onAnimationEnd:a})};var Vo=()=>o(832924),Fo=()=>o(882637);const Ko=function(){const e=(0,r().O7)(),{device:t}=e,{open:o,rect:n}=(0,c().VK)((()=>{const{open:e,rect:t}=Fo().default.state;return{open:e,rect:t}}),[]);return(0,z.jsx)(To().ZP,{popupType:t.isMobile?Eo().k.SlideUp:Eo().k.Popup,open:o,originRect:n,placementToOrigin:je().Placement.Bottom,alignmentToOrigin:je().Alignment.Center,originGap:4,onDismiss:()=>M().UZ(e),render:()=>(0,z.jsx)(Uo,{})})};function Uo(){const e=(0,r().O7)(),{device:t}=e,o=(0,c().Kw)(Fo().default),n=(0,c().VK)((()=>Fo().default.state.open?Fo().default.state.discussionInputStore.state.textStore.getValue():null),[]);if((0,i.useEffect)((()=>{var e;const t=null===(e=Vo().default.MenuScroller)||void 0===e?void 0:e.getNode();null==t||t.scrollTo({top:t.scrollHeight})}),[n,o]),o.open){const{discussionStore:n,discussionInputStore:i,blockStore:s,discussionLocation:r}=o;let a;return a=t.isMobile?{menuType:ce().o.Modal,title:(0,z.jsx)(p()._H,{defaultMessage:"Comments",id:"discussion.mobileReplyMenu.title"}),right:(0,z.jsx)(p()._H,{defaultMessage:"Close",id:"discussion.mobileReplyMenu.closeButton.label"}),onClickRight:()=>M().UZ(e),whiteBackground:!0}:{menuType:ce().o.Popup,width:420,minHeight:"100px",maxHeight:"50vh",maxWidth:"100%"},(0,z.jsx)(oe().Z,{className:le().LoZ,...a,children:(0,z.jsx)(Ro().Z,{capture:!0,allowMobileAutoScroll:!0,render:()=>"post_discussion"!==r?(0,z.jsx)(qt,{store:n,discussionInputStore:i,onDismiss:()=>M().UZ(e),format:T().DiscussionFormat.Menu,isFirst:!0,isOnly:!0,discussionLocation:r,showResolveButtonByDefaultIfPossible:!0,blockStore:s,collapsed:!1}):null})})}return null}var Ho=()=>o(552814)},197950:(e,t,o)=>{"use strict";o.d(t,{q:()=>k});o(667294);var n=()=>o(142735),i=()=>o(846550),s=()=>o(135796),r=o(785893);const a=(0,o(827282).IU)("suggestionExtraSmall",{viewBox:"0 0 10 9",svg:(0,r.jsxs)("g",{children:[(0,r.jsx)("path",{d:"M5.175 4.745l-.906.339c-.07.027-.14.012-.205-.045-.064-.057-.08-.127-.048-.212l.342-.899L7.492.798l.814.813-3.131 3.134zm3.4-3.397L7.76.53l.359-.352A.617.617 0 018.48.005a.364.364 0 01.33.105l.14.14c.1.105.145.226.134.365a.596.596 0 01-.168.366l-.341.366z"}),(0,r.jsx)("path",{d:"M4.91 1.962L5.969.906H2.704c-.354 0-.66.072-.92.216-.26.14-.46.341-.601.601-.142.26-.212.566-.212.92v2.754c0 .354.074.66.222.92.148.26.345.461.591.605.249.141.524.212.827.212h.25v.694c0 .214.056.382.167.506a.603.603 0 00.465.184.84.84 0 00.383-.092c.125-.06.27-.16.434-.301l1.138-.991h1.846c.353 0 .66-.07.92-.212.26-.144.46-.345.6-.605a1.89 1.89 0 00.213-.92V2.643c0-.114-.007-.223-.022-.327l-.433.443-.601.602V5.32c0 .253-.064.442-.192.567-.125.126-.314.188-.567.188h-1.85a.757.757 0 00-.307.051.962.962 0 00-.256.192L3.743 7.349v-.926c0-.125-.031-.214-.093-.267a.372.372 0 00-.256-.082h-.608c-.251 0-.44-.062-.568-.188-.125-.125-.188-.314-.188-.567V2.72c0-.253.063-.442.188-.567.128-.128.317-.192.568-.192H4.91z"})]})});var l=()=>o(161002),c=()=>o(788860),d=()=>o(707513),u=()=>o(729775),m=()=>o(946563),p=()=>o(654133),g=()=>o(67961),h=()=>o(46335),f=()=>o(193739),v=()=>o(286338),S=()=>o(176691),x=()=>o(998901),b=()=>o(826955),C=()=>o(383694),y=()=>o(444851),w=()=>o(472675);function k(e){let{lastEditedTime:t,createdTime:o,discussionLocation:s,isResolved:h,isSuggestionComment:S,teamStore:k,authorStore:I}=e;const L=(0,c().YB)(),M=(0,n().VK)((()=>(0,v().y3)()),[]),R=(0,n().VK)((()=>I.getDisplayName(L)),[I,L]),T=(0,n().VK)((()=>null==k?void 0:k.getName()),[k]),D=y().IX,A=function(e){let{discussionLocation:t,avatarSize:o}=e;return(0,i().yK)((e=>({avatar:{marginTop:0,marginRight:2,userSelect:"none"},avatarSuggestionBadgeWrapper:{position:"absolute",right:-2,bottom:-4},avatarSuggestionBadge:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",borderRadius:100,background:"light"===e.mode?"#fff":"#000",width:16,height:16,border:`1px solid ${e.accentColors.uiBlue[200]}`,fill:e.accentColors.uiBlue[600]},avatarSuggestionBadgeBacking:{position:"absolute",width:"100%",height:"100%",borderRadius:100,background:e.accentColors.uiBlue[100]},in:{color:e.text.secondary},timestamp:{flexBasis:"comment_unfurl"!==t?140:void 0,whiteSpace:"normal",flexGrow:"updates_sidebar"===t||"comment_unfurl"===t?void 0:1,display:"inline",color:e.text.tertiary},userRow:{display:"flex",flexDirection:"row",alignItems:"center",userSelect:"none",fontSize:14,gap:6},user:{display:"flex",alignItems:"center",gap:6},placeholder:{height:8,width:81,borderRadius:6,background:e.lightDividerColor},commentAuthorPlaceholder:{marginRight:2,marginTop:"comment_unfurl"===t?14:2,height:o,width:o,borderRadius:20,flexShrink:0},teamIconAndName:{display:"flex",alignItems:"center",gap:5},linkBox:{borderRadius:4,padding:4,marginInline:-4},author:{fontWeight:d().Ue.medium,whiteSpace:"normal",flexShrink:0},teamName:{fontWeight:d().Ue.medium,lineHeight:1.3,borderBottom:`1px solid ${e.darkDividerColor}`}})),[o,t])}({discussionLocation:s,avatarSize:D});if(!o)return null;const B=t&&t>o+5e3;return(0,r.jsxs)("div",{style:A.userRow,children:[(0,r.jsx)(p().Z,{disableTooltip:!M,renderTooltip:()=>I&&I instanceof b().U6?(0,r.jsx)(f().J,{userStore:I}):null,placement:x().Placement.Top,originGap:20,alignment:x().Alignment.Start,render:e=>(0,r.jsxs)("div",{...e,style:A.user,children:[S?(0,r.jsxs)("div",{style:{position:"relative"},children:[(0,r.jsx)(w().S,{authorStore:I,avatarSize:D,avatarStyle:A.avatar,placeholderStyle:A.commentAuthorPlaceholder}),(0,r.jsx)("div",{style:A.avatarSuggestionBadgeWrapper,children:(0,r.jsxs)("div",{style:A.avatarSuggestionBadge,children:[a({height:8.5}),(0,r.jsx)("div",{style:A.avatarSuggestionBadgeBacking})]})})]}):(0,r.jsx)(w().S,{hasTooltip:!M,authorStore:I,avatarSize:D,avatarStyle:A.avatar,placeholderStyle:A.commentAuthorPlaceholder}),(0,r.jsx)("div",{style:A.author,children:R||(0,r.jsx)("span",{style:A.placeholder})})]}),allowHover:!0,closeDelay:800,isLightBackground:!0}),k&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{style:A.in,children:(0,r.jsx)(c()._H,{id:"posts.post.inPreposition",defaultMessage:" in "})}),(0,r.jsx)(u().Z,{style:A.linkBox,href:(0,l().y)({teamId:k.id}),children:(0,r.jsxs)("div",{style:A.teamIconAndName,children:[(0,r.jsx)(C().p,{size:14,store:k,disabled:!1}),(0,r.jsx)("span",{style:A.teamName,children:T})]})})]}),(0,r.jsx)(g().Z,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:A.timestamp,children:B?(0,r.jsx)(_,{createdTime:o,lastEditedTime:t}):(0,r.jsx)(j,{createdTime:o})}),"comment_unfurl"===s&&h&&(0,r.jsx)("div",{style:{display:"inline-flex"},children:(0,r.jsx)(m().Z,{children:(0,r.jsx)(c()._H,{id:"comment.unfurl.resolvedStatus",defaultMessage:"Resolved"})})})]})}function j(e){const{createdTime:t}=e;return(0,r.jsx)(h().Z,{text:(0,S().IS)(t,{useUltraCompactFormat:!0}),tooltipText:(0,S().uy)(t),icon:s().C})}function _(e){const{createdTime:t,lastEditedTime:o}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h().Z,{text:(0,S().IS)(t,{useUltraCompactFormat:!0}),tooltipText:(0,r.jsx)(c()._H,{defaultMessage:"Created {absoluteCreatedTime}",id:"comment.createdAtTime.label",values:{absoluteCreatedTime:(0,S().uy)(t)}}),icon:s().C})," ",(0,r.jsx)(h().Z,{text:(0,r.jsx)(c()._H,{defaultMessage:"(edited)",id:"comment.editedAtIndicator"}),tooltipText:(0,r.jsx)(c()._H,{defaultMessage:"Last edited {absoluteLastEditedTime}",id:"comment.editedAtTime.label",values:{absoluteLastEditedTime:(0,S().uy)(o)}}),icon:s().C})]})}},83447:(e,t,o)=>{"use strict";o.d(t,{Z:()=>l});o(667294);var n=()=>o(846550),i=()=>o(721543),s=()=>o(788860),r=()=>o(654133),a=o(785893);function l(e){const{onClick:t}=e,o=(0,n().yK)((e=>({moreCommentsWrapper:{position:"absolute",display:"flex",justifyContent:"center",alignItems:"flex-start",zIndex:1,left:0,right:0,height:30,background:`linear-gradient(to bottom, ${e.contentBackgroundTransparent} 0px, ${e.selectedMarginDiscussionBackground} 30px`,marginTop:-28},tooltip:{...(0,r().J)(e,!1),cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center",marginTop:-4,borderRadius:6,padding:"4px 10px 4px 8px"}})),[]),l=(0,n().Fg)();return(0,a.jsx)("div",{style:o.moreCommentsWrapper,children:(0,a.jsxs)("div",{style:o.tooltip,onClick:t,children:[(0,a.jsx)("div",{style:{marginRight:5},children:(0,i().K)({fill:l.regularInvertedTextColor,height:12,width:12})}),(0,a.jsx)(s()._H,{defaultMessage:"See more",id:"discussion.moreMessageTooltip"})]})})}},397174:(e,t,o)=>{"use strict";o.d(t,{Z:()=>d});o(267602),o(653476),o(241792),o(258429);var n=o(667294),i=()=>o(846550),s=()=>o(26970),r=()=>o(707513),a=()=>o(384510),l=o(785893);function c(e){const{button:t,isLast:o}=e,a=(0,i().yK)((e=>({button:{display:"flex",alignItems:"center",padding:"4px 6px",fontWeight:r().Ue.medium,borderRight:`1px solid ${e.regularDividerColor}`,color:e.actionMenuButtonTextColor,fill:e.actionMenuButtonTextColor},buttonLast:{borderRight:"none"},buttonHovered:{background:e.whiteButtonHoveredBackground},buttonPressed:{background:e.whiteButtonPressedBackground}})),[]);return n.cloneElement(t,{...(0,s().iv)(t.props.style,a.button,o&&a.buttonLast),hoveredStyle:(0,s().iv)(a.buttonHovered,o&&a.buttonLast).style,pressedStyle:a.buttonPressed})}const d=function(e){let{children:t,isVisible:d,position:u,style:m}=e;const p=(0,o(219727).O7)(),g=(0,i().yK)((e=>({container:{color:e.actionMenuButtonTextColor,fill:e.actionMenuButtonTextColor,fontSize:12,background:e.whiteButtonBackground,boxShadow:e.shadowSM,display:"flex",whiteSpace:"nowrap",borderRadius:a().Z.borderRadius,maxWidth:"calc(100% - 16px)",minHeight:24,overflow:"hidden",pointerEvents:p.device.isMobile?"auto":"none",opacity:p.device.isMobile?1:0,fontFamily:r().F5(o(146947).locale).sans,position:"absolute",right:a().Z.horizontal.small,bottom:a().Z.vertical.small,zIndex:2},containerHover:{pointerEvents:"auto",opacity:1},containerTop:{top:a().Z.vertical.small,bottom:void 0}})),[p]),h=n.Children.toArray(t).filter(o(696459).$K),f=h.length;return(0,l.jsx)(o(628370).Z,{animate:{opacity:d?1:0},...(0,s().iv)(g.container,m,d&&g.containerHover,"top"===u&&g.containerTop),children:h.map(((e,t)=>{const i=t===f-1;if(e&&"object"==typeof e&&"type"in e){if(e.type===o(654133).Z&&n.isValidElement(e))return n.cloneElement(e,{render:(t,o)=>{const n=e.props.render(t,o);return(0,l.jsx)(c,{isLast:i,button:n},e.key)}});if(e.type===o(154186).Z&&n.isValidElement(e))return(0,l.jsx)(c,{isLast:i,button:e},e.key)}}))})}},632599:(e,t,o)=>{"use strict";o.d(t,{Z:()=>l});var n=o(667294),i=()=>o(846550),s=()=>o(729201),r=()=>o(312578),a=o(785893);function l(e){let{loadingMessage:t}=e;const o=(0,i().Fg)(),l=(0,s().Z)(!0,400);return(0,a.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:l&&(0,a.jsxs)(n.Fragment,{children:[(0,a.jsx)(r().Z,{}),t&&(0,a.jsx)("div",{style:{marginLeft:8,color:o.text.secondary},children:t})]})})}},887330:(e,t,o)=>{"use strict";o.d(t,{C:()=>i,L:()=>s});var n=()=>o(707513);function i(e){const{theme:t,isInHomeWidget:o}=e;return{display:"flex",alignItems:"center",fontSize:14,padding:6,...o?{height:24,width:24,color:t.lightTextColor,fill:t.lightIconColor}:{height:28,width:28,color:t.mediumIconColor,fill:t.mediumIconColor},fontWeight:n().Ue.regular,lineHeight:1,borderRadius:6}}function s(e){const{theme:t}=e;return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:t.mediumIconColor,fontWeight:n().Ue.regular,lineHeight:1,borderRadius:4}}},755589:(e,t,o)=>{"use strict";o.d(t,{m:()=>d});o(667294);var n=()=>o(968061),i=()=>o(788860),s=()=>o(231077),r=()=>o(1910),a=()=>o(45909),l=o(785893);const c=(0,i().vU)({menu:{defaultMessage:"Menu",id:"topbar.appMenuButton.title"}});function d(){const e=(0,i().YB)();return(0,l.jsx)(r().Z,{style:{position:"absolute",top:"10px",left:"14px",width:24,height:24,zIndex:1e5,...(0,a().X)({noDrag:!0})},iconStyle:{width:16,height:16},isDarkIconColor:!0,onClick:()=>{s().openAppMenu()},icon:n().h,ariaLabel:e.formatMessage(c.menu)})}},46335:(e,t,o)=>{"use strict";o.d(t,{Z:()=>l});o(667294);var n=()=>o(846550),i=()=>o(707513),s=()=>o(998901),r=()=>o(654133),a=o(785893);function l(e){let{text:t,tooltipText:o,icon:l}=e;const c=(0,n().yK)((e=>({icon:{height:"1em",width:"1em",marginRight:"0.25em",fill:e.mediumIconColor,marginBottom:"0.1em"},tooltip:{background:e.contentBackground,boxShadow:e.shadowSM},container:{display:"flex",alignItems:"center",fontWeight:i().Ue.regular,color:e.mediumTextColor,fontSize:i().JB.UISmall.desktop,textAlign:"center"},text:{display:"inline"}})),[]);return(0,a.jsx)(r().Z,{style:c.tooltip,render:e=>(0,a.jsx)("div",{style:c.text,...e,children:t}),renderTooltip:()=>(0,a.jsxs)("div",{style:c.container,children:[l(c.icon),(0,a.jsx)("div",{children:o})]}),alignment:s().Alignment.Start,placement:s().Placement.Bottom})}},455241:(e,t,o)=>{"use strict";o.d(t,{d:()=>a});o(667294);var n=()=>o(846550),i=()=>o(456681),s=()=>o(788860),r=o(785893);function a(e){const{href:t,style:o}=e,a=(0,n().yK)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.mediumTextColor}})),[]);return(0,r.jsxs)("a",{href:t,target:"_blank",style:{...a.default,...o},children:[(0,i().m)({width:14,marginRight:4}),(0,r.jsx)(s()._H,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}},75751:(e,t,o)=>{"use strict";o.d(t,{Z:()=>S});var n=o(667294),i=()=>o(219727),s=()=>o(142735),r=()=>o(788860),a=()=>o(421654),l=()=>o(839821),c=()=>o(269299),d=()=>o(191586),u=()=>o(685472),m=()=>o(774985),p=()=>o(397174),g=()=>o(628370),h=()=>o(154186),f=()=>o(710706),v=o(785893);const S=function(e){let{store:t,disabled:r,paddingRight:l,paddingLeft:d,height:p,proxyWidth:g}=e;const h=(0,i().O7)(),f=(0,s().qz)(void 0,o(233417).Z),S=(0,s().VK)((()=>r||"suggest"===o(279386).MT.getMode(t)),[r,t]),C=(0,s().VK)((()=>t.getCover()),[t]),y=(0,s().Kw)(m().Z),[w,k]=(0,n.useState)(void 0);if(!C)return null;const j=y.loadingMode!==u().LU&&y.loadingMode!==u().SS;return(0,v.jsx)(o(910293).Z,{mouseStore:f,onFlushTemporaryPosition:e=>function(e,t,o){const{imagePosition:n,reset:i}=e;c().createAndCommit({userAction:"PageCover.handleFlushTemporaryPosition",environment:o,canUndo:!0,perform:e=>{a().Mp({store:t,coverPosition:n,transaction:e}),i()}})}(e,t,h),renderControl:e=>{let{handleRepositionClick:o,handleSavePositionClick:n,handleCancelClick:i,isVisible:s,isRepositioning:r}=e;return(0,v.jsx)(b,{handleRepositionClick:o,handleSavePositionClick:n,handleCancelClick:i,isVisible:s,isRepositioning:r,lastProxiedUrl:w,store:t,disabled:S,paddingRight:l,paddingLeft:d,mouseStore:f})},source:"page",store:t,style:{display:"flex",flexDirection:"column",alignItems:"center",height:p,maxHeight:280,cursor:"default"},render:e=>(0,v.jsxs)(n.Fragment,{children:[(0,v.jsx)(o(135499).Z,{url:C.cover,isAuthenticated:!0,permissionRecord:C.pointer,width:g,onFinishedLoadingProxyUrl:k,render:(t,n)=>{const i={width:"100%",height:p,maxHeight:280,objectFit:"cover",opacity:j?.5:1,objectPosition:`center ${100*(1-(e.imagePosition||0))}%`,borderRadius:0},s={width:"100%",height:p,maxHeight:280};return(0,v.jsx)(o(167499).B,{src:n,placeholderSrc:j?y.dataURL:void 0,placeholderBehavior:j?"force-show-placeholder":"show-placeholder-if-loading-src",containerStyle:s,imageStyle:i,onLoadComplete:x,testId:"pageCover"})}}),j&&(0,v.jsxs)("div",{style:o(518242).IA,children:[(0,v.jsx)(o(312578).Z,{size:"md",style:{marginRight:4}}),(0,v.jsx)("div",{style:{minWidth:30,textAlign:"right"},children:(0,v.jsx)(o(410184).Z,{percentage:y.uploadProgress})})]})]})})};function x(){m().Z.reset()}function b(e){let{isVisible:t,isRepositioning:o,handleCancelClick:a,handleRepositionClick:c,handleSavePositionClick:S,lastProxiedUrl:x,store:b,disabled:C,paddingRight:y,paddingLeft:w,mouseStore:k}=e;const j=(0,i().O7)(),_=(0,r().YB)(),I=(0,n.useCallback)((e=>function(e,t,o,n,i){i.reset();const s=e.target.getBoundingClientRect();l().j({environment:t,intl:o,store:n,rect:s})}(e,j,_,b,k)),[j,_,b,k]),L=(0,s().VK)((()=>m().Z.state.loadingMode),[]),M=(0,s().VK)((()=>function(e){let t;return t=e.isFullWidth()?"100%":d().zL,t}(b)),[b]);if(C||L!==u().LU)return null;const{device:R}=j,{isMobile:T}=R;return(0,v.jsx)(g().Z,{animate:{width:M,opacity:t?1:0},style:{position:"absolute",pointerEvents:t?"auto":"none",maxWidth:"100%",top:48},children:(0,v.jsxs)(p().Z,{isVisible:t,position:"bottom",style:{marginRight:y,marginLeft:w},children:[!o&&(0,v.jsx)(h().Z,{style:{borderRight:T?"none":void 0,...f().ar},onClick:I,children:(0,v.jsx)(r()._H,{defaultMessage:"Change cover",id:"pageCover.changeCover.text"})}),!o&&!T&&(0,v.jsx)(h().Z,{style:{...f().ar,borderRight:"none"},onClick:e=>c(e,x),children:(0,v.jsx)(r()._H,{defaultMessage:"Reposition",id:"pageCover.reposition.text"})}),o&&!T&&(0,v.jsx)(h().Z,{style:f().ar,onClick:S,children:(0,v.jsx)(r()._H,{defaultMessage:"Save position",id:"pageCover.savePosition.text"})}),o&&!T&&(0,v.jsx)(h().Z,{style:{...f().ar,borderRight:"none"},onClick:a,children:(0,v.jsx)(r()._H,{defaultMessage:"Cancel",id:"pageCover.reposition.cancelText"})})]})})}},910293:(e,t,o)=>{"use strict";o.d(t,{Z:()=>f});var n=o(667294),i=()=>o(146947),s=()=>o(219727),r=()=>o(142735),a=()=>o(26970),l=()=>o(788860),c=()=>o(568017),d=()=>o(513670),u=()=>o(707513),m=()=>o(326966),p=()=>o(628370),g=o(785893);const h={isRepositioning:!1};const f=function(e){const t=(0,n.useRef)(null),i=(0,s().O7)(),{isMobile:l}=(0,s().Fy)(),[c,u]=(0,n.useState)(h),p=(0,n.useCallback)((()=>{u(h)}),[]),{renderControl:f,onFlushTemporaryPosition:S,style:x,source:b,store:C}=e,{isRepositioning:y,image:w,startDragRenderedPosition:k,startDragImageScreenHeight:j}=c,_=(0,r().VK)((()=>0===o(965903).default.state.stores.length),[]),[I,L]=(0,n.useState)(!1),M=(0,r().qz)(e.mouseStore,o(233417).Z),R=(0,r().VK)((()=>M.state.mouseEntered),[M]),T=(0,o(846550).yK)((()=>({dragContainer:{width:"100%",cursor:y?"move":"inherit"},container:{position:"relative",width:"100%",zIndex:1}})),[y]),D=(0,r().VK)((()=>function(e,t,o){return(0,d().hj)(o)?o:function(e,t){if("gallery"===e||"board"===e){const e=t.getFormat().card_cover_position;if((0,d().hj)(e))return e}const o=.5;if(t.isCollectionView()){const e=t.getCollectionStore();if(e){const t=e.getFormat().collection_cover_position;return(0,m().z4)(t)?o:t}}const n=t.getFormat(),i=n.page_cover_position;if((0,d().hj)(i))return i;return o}(e,t)}(b,C,c.temporaryPosition)),[c.temporaryPosition,b,C]);(0,n.useEffect)((()=>{const e=e=>{const o=t.current;o&&!o.contains(e.target)&&y&&S({imagePosition:D,reset:()=>{M.reset(),p()}})};return window.addEventListener("mousedown",e),()=>window.removeEventListener("mousedown",e)}),[D,y,M,S,p]),y&&!_&&p();const A=(0,n.useMemo)((()=>(0,d().P2)((e=>{M.setState({...M.state,mouseEntered:!0})}),100)),[M]),B=(0,n.useMemo)((()=>(0,d().Ds)((e=>{M.setState({...M.state,mouseEntered:!1})}),100)),[M]),E=(0,n.useCallback)(((e,t)=>{o(879952).ZH({environment:i});const n=new Image;n.onload=()=>{u((e=>({...e,isRepositioning:!0,image:n})))},t&&(n.src=t)}),[i]),P=(0,n.useCallback)((e=>{S({imagePosition:D,reset:()=>{p()}})}),[D,S,p]),Z=(0,n.useCallback)((e=>{const t=e.target;void 0!==t&&t instanceof HTMLElement&&(0,o(474788).E)(t)&&L(!0)}),[]),V=(0,n.useCallback)((()=>{L(!0)}),[]),F=(0,n.useCallback)((e=>{if(w&&y){const e=t.current;if(e&&e instanceof Element){const t=e.getBoundingClientRect().width/w.width*w.height;u((e=>({...e,startDragImageScreenHeight:t,startDragRenderedPosition:D})))}}}),[w,D,y]),K=(0,n.useCallback)((e=>{if(y){const t=e.diffY/(j||0)+(k||0);u((e=>({...e,temporaryPosition:(0,d().NM)((0,o(120420).Z)(t,0,1),4)})))}}),[y,j,k]),U=(0,n.useCallback)((()=>{u((e=>({...e,startDragImageScreenHeight:void 0,startDragRenderedPosition:void 0})))}),[]),H=(0,r().VK)((()=>f({handleRepositionClick:E,handleSavePositionClick:P,handleCancelClick:p,isVisible:l||R||I||y,isRepositioning:y})),[E,P,I,l,y,R,f,p]);return(0,g.jsxs)("div",{ref:t,onFocus:Z,onBlur:V,onMouseEnter:A,onMouseMove:A,onMouseLeave:B,...(0,a().iv)(T.container,x),children:[(0,g.jsx)(o(790964).Z,{onDraggableDragStart:F,onDraggableDragMove:K,onDraggableDragEnd:U,onDraggableDragCancel:U,disabled:!y,render:t=>(0,g.jsx)("div",{...(0,a().iv)(T.dragContainer),...t,children:e.render({imagePosition:D,isRepositioning:y})})}),(0,g.jsx)(v,{small:e.small,isRepositioning:y}),H]})};function v(e){let{small:t,isRepositioning:o}=e;if(t)return null;const n={background:c().ZP.blackWithAlpha(.4),borderRadius:4,color:c().ZP.white,fontSize:12,fontFamily:u().F5(i().locale).sans,width:180,left:"calc(50% - 90px)",padding:"0.3em 1.5em 0.3em",pointerEvents:"none",position:"absolute",top:"calc(50% - 10px)",textAlign:"center"};return(0,g.jsx)(p().Z,{visible:o,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:n,children:(0,g.jsx)(l()._H,{defaultMessage:"Drag image to reposition",id:"withImageRepositioning.dragImage.text"})})}},681035:(e,t,o)=>{"use strict";o.d(t,{S:()=>s});var n=()=>o(677559);const i=new(n().Ss)("CollectionItemCover",(async()=>{const{CollectionItemCover:e}=await Promise.all([o.e(62743),o.e(37912)]).then(o.bind(o,682652));return{CollectionItemCover:e}})),s=(0,n().kF)(i,(e=>e.CollectionItemCover))},81821:(e,t,o)=>{"use strict";o.d(t,{Z:()=>i});class n extends(()=>o(442))().Z{}const i=new n},761936:(e,t,o)=>{"use strict";o.d(t,{L:()=>d});var n=()=>o(642240),i=()=>o(338530);const s={ko:()=>o.e(60692).then(o.bind(o,299435)),es:()=>o.e(20883).then(o.bind(o,960142)),de:()=>o.e(83224).then(o.bind(o,299606)),fr:()=>o.e(85038).then(o.bind(o,604240)),pt:()=>o.e(72138).then(o.bind(o,515748)),zh:()=>o.e(17835).then(o.bind(o,240169)),ja:()=>o.e(96377).then(o.bind(o,770488)),da:()=>o.e(57677).then(o.bind(o,317410)),fi:()=>o.e(66970).then(o.bind(o,266265)),nb:()=>o.e(93031).then(o.bind(o,189761)),nl:()=>o.e(62579).then(o.bind(o,360701)),sv:()=>o.e(60382).then(o.bind(o,575660))};let r=!1,a=!1;async function l(e){for(const[o,i]of Object.entries(e.emojiLocaleKeywords)){var t;n().Q4[o]={...n().Q4[o],keywords:[...i,...(null===(t=n().Q4[o])||void 0===t?void 0:t.keywords)||[]]}}await i().Z.waitUntilLoaded(),i().Z.update((t=>{let{emojiByName:o,...n}=t;return{...n,emojiByName:{...o,...e.emojiByName}}}))}async function c(){if(r)return;const[e]=o(146947).locale.split("-");e in s&&(await l(await s[e]()),r=!0)}const d=(0,o(924665).Z)((async()=>{await async function(){a||(await l(await o.e(83552).then(o.bind(o,716373))),a=!0)}(),await c()}))},981697:(e,t,o)=>{"use strict";o.d(t,{Z:()=>s});var n=o(667294),i=()=>o(219727);function s(e){const t=(0,i().O7)(),{onLongPress:o,hapticsEnabled:s=!0,timeout:r=300}=e,a=(0,n.useCallback)((()=>{var e,n,i;s&&(null!==(e=t.mobileNative)&&void 0!==e&&e.buzz?t.mobileNative.buzz():null===(n=(i=window.navigator).vibrate)||void 0===n||n.call(i,20));o()}),[t.mobileNative,s,o]),l=(0,n.useRef)(),c=(0,n.useRef)(0),d=(0,n.useRef)(0),u=(0,n.useCallback)((()=>clearTimeout(l.current)),[]);(0,n.useEffect)((()=>u),[u]);return{onTouchStart:(0,n.useCallback)((()=>{clearTimeout(l.current),l.current=setTimeout(a,r)}),[r,a]),onTouchMove:(0,n.useCallback)((e=>{const t=e.touches[0].clientX,o=e.touches[0].clientY;(Math.abs(t-c.current)>50||Math.abs(o-d.current)>50)&&clearTimeout(l.current)}),[]),onTouchEnd:u,onTouchCancel:u}}},110372:(e,t,o)=>{"use strict";o.d(t,{YF:()=>c,bl:()=>l,gF:()=>r,i6:()=>d,lZ:()=>a});var n=()=>o(954949),i=()=>o(594546),s=()=>o(749826);function r(e,t){const o=(0,n().Si)(t.callout_key);o&&(t.placement_key=(0,n().pU)(o)),(0,i().j)({environment:e,event:{eventName:"callout_show",eventProperties:t}}),s().default.logEvent("callout_show",t.callout_key)}function a(e,t){const o=(0,n().Si)(t.callout_key);o&&(t.placement_key=(0,n().pU)(o)),(0,i().j)({environment:e,event:{eventName:"callout_click",eventProperties:t}}),s().default.logEvent("callout_click",t.callout_key)}function l(e,t){const o=(0,n().Si)(t.callout_key);o&&(t.placement_key=(0,n().pU)(o)),(0,i().j)({environment:e,event:{eventName:"callout_dismiss",eventProperties:t}}),s().default.logEvent("callout_dismiss",t.callout_key)}function c(e,t){const{eligible_callouts:o,required_arg_timeout:n,required_args_run_duration:s,eligibility_timeouts:r,blocklist:a}=t;(0,i().j)({environment:e,event:{eventName:"callout_coordinator_resolved",eventProperties:{eligible_callouts:o,required_arg_timeout:n,required_args_run_duration:s,eligibility_timeouts:r,blocklist:a}}})}function d(e,t){(0,i().j)({environment:e,event:{eventName:"callout_feature_interaction",eventProperties:t}})}},355435:(e,t,o)=>{"use strict";o.d(t,{E7:()=>s,Ju:()=>i,cb:()=>a,iv:()=>r,tL:()=>n});const n=32,i=202,s=1e3,r="Want to add a metric? Look for 'src/client/performanceToolbar/config.ts' in notion-next.",a="To disable the toolbar entirely, go to the 'Experiments' panel and look for the 'performance_debugging_toolbar' flag."},420406:(e,t,o)=>{"use strict";o.d(t,{$:()=>n});function n(e,t){t.route.name;return!1}},341643:(e,t,o)=>{"use strict";o.d(t,{DW:()=>S,IG:()=>h,J4:()=>v,hZ:()=>f,q9:()=>g,qq:()=>x,s4:()=>p});var n=o(667294),i=()=>o(219727),s=()=>o(142735),r=()=>o(801812),a=()=>o(677559),l=()=>o(690664),c=()=>o(105649),d=()=>o(291335),u=()=>o(590972),m=()=>o(420406);const p=new(a().Ss)("PerformanceToolbar",(()=>Promise.all([o.e(62743),o.e(5242),o.e(4014),o.e(20919),o.e(93843),o.e(66283),o.e(54194)]).then(o.bind(o,674207)))),g=(0,a().kF)(p,(e=>e.PerformanceToolbar)),h=(0,a().kF)(p,(e=>e.PerformanceToolbarSettings));function f(){const e=(0,i().O7)();return(0,s().VK)((()=>(0,m().$)(e,e.RouterStore.state)),[e])}function v(){const e=(0,i().O7)(),t=b("PerformanceToolbarStore"),o=b("isPerformanceToolbarVisible");return(0,s().VK)((()=>!(!t||!o)&&o(e,e.RouterStore.state,t.state)),[o,e,t])}function S(){const e=b("PerformanceToolbarStore");return(0,s().VK)((()=>!!e&&e.state.isPerformanceToolbarMounted),[e])}function x(){const e=(0,i().O7)(),t=b("createPerformanceToolbarMouseListeners"),o=b("PerformanceToolbarStore"),{sidebarExpanded:r,sidebarWidth:a,secondarySidebarExpanded:m,secondarySidebarWidth:p,updateSidebarExpanded:g,updateSidebarWidth:h}=(0,s().VK)((()=>({sidebarExpanded:d().sidebarExpandedStore.state,sidebarWidth:d().sidebarWidthStore.state,secondarySidebarExpanded:c().default.isOpen(),secondarySidebarWidth:l().default.getWidth(),updateSidebarExpanded:u().default.state.expanded,updateSidebarWidth:u().default.state.width})),[]);return(0,n.useEffect)((()=>{if(o&&t)return t(e,(e=>o.update((t=>({...t,isMouseNearPerformanceToolbar:e})))),r,a,m,p,g,h)}),[t,e,o,r,a,m,p,g,h])}function b(e){const t=f(),[{value:o}]=(0,r().r5)((()=>t?p.load().then((t=>t[e])):Promise.resolve(void 0)),[e,t]);return o}},974442:(e,t,o)=>{"use strict";o.d(t,{Z:()=>n});const n=o(263184).default.createValue({open:!1},{name:"ConfirmOverwriteModalStore"})},994875:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>i});class n extends(()=>o(263184))().default{getInitialState(){return{discussionIdToExpansionStartPointMap:{}}}}const i=new n},877727:(e,t,o)=>{"use strict";o.d(t,{QZ:()=>r,SV:()=>i,mq:()=>s});var n=()=>o(749826);function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n().default.checkGate({gateName:"workflow_templates_settings_dev",disableExposureLogging:e.disableExposureLogging})&&n().default.checkGate({gateName:"packaging_m3.1",disableExposureLogging:e.disableExposureLogging})}function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n().default.checkGate({gateName:"packaging_m3.1",disableExposureLogging:e.disableExposureLogging})}function r(e){return!e.device.isPhone}},999582:(e,t,o)=>{"use strict";o.d(t,{Z:()=>s});class n extends(()=>o(263184))().default{getInitialState(){return{}}}const i=new n;o(947115).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",i);const s=i},280210:(e,t,o)=>{"use strict";o.d(t,{U_:()=>y,f6:()=>k,ii:()=>w});o(821057),o(409045),o(453627),o(994774),o(995194),o(520522),o(200082),o(379976),o(724224),o(761121),o(637133),o(241792);var n=o.n(o(402568)),i=()=>o(513670),s=()=>o(326966),r=()=>o(431595),a=()=>o(24945),l=()=>o(255933);const c={version:8,notion_version:0,variant:2},d={version:8,notion_version:1,variant:2},u=0,m=1,p=6,g=8,h=10,f=Date.UTC(2024,0,1);function v(e,t){if(e)return t[u]=255,t[u+1]=240|15&t[u+1],t;const o=Math.floor(((new Date).getTime()-f)/s().A0);if(o>=4096||o<0)throw new Error("Invalid offsetInDays.");return t[u]=o>>4,t[u+1]=o<<4&240|15&t[u+1],t}function S(e,t){if(e>=2**36||e<0)throw new Error("Invalid spaceShortId.");t[m]=240&t[m]|e/2**32&15;for(let o=0;o<4;o++)t[m+1+o]=e/2**(24-8*o)&255;return t}function x(e,t){const o=e?1:0;return t[p]=c.version<<4&240|c.notion_version<<1&14|1&o,t[g]=c.variant<<6&192|63&t[g],t}function b(e,t){if("block"===e)return t[h]=(0,a().ym)(e)|63&t[h],t;const o=(0,a().ym)(e);return t[h]=o>>8&127,t[h+1]=255&o,t}function C(e,t){const o=(0,a().Nq)(e);return t[h]=127&o|128&t[h],t}function y(e,t,o,n){const i=new Uint8Array(16),s=globalThis.crypto.getRandomValues(i);return o!==l().bx&&v(e,s),S(t,s),x(n,s),b(o,s),I(s)}function w(e,t,o,n){return y(e,t,o,n)}function k(e,t,o){return j(e,t,o)}function j(e,t,o){const s=n()(o),l=i().yo(s,2).map((e=>parseInt(e.join(""),16)));if((0,a().LV)(t)){if(void 0===e)throw new(r().D3)(`Deterministic ID for '${t}' must specify a space short id`)}else if(void 0!==e)throw new(r().D3)(`Deterministic ID for '${t}' should not provide a space short id`);const c=new Uint8Array(l);return e&&S(e,c),C(t,c),function(e){e[p]=240&d.version<<4|14&d.notion_version<<1|1&e[p],e[g]=192&d.variant<<6|63&e[g]}(c),I(c)}const _=new Array(256).fill(0).map(((e,t)=>t.toString(16).padStart(2,"0")));function I(e){let t=0;return _[e[t++]]+_[e[t++]]+_[e[t++]]+_[e[t++]]+"-"+_[e[t++]]+_[e[t++]]+"-"+_[e[t++]]+_[e[t++]]+"-"+_[e[t++]]+_[e[t++]]+"-"+_[e[t++]]+_[e[t++]]+_[e[t++]]+_[e[t++]]+_[e[t++]]+_[e[t++]]}},29488:(e,t,o)=>{"use strict";function n(e){return`${e.table}:${e.id}`}o.d(t,{O:()=>n})},924665:(e,t,o)=>{"use strict";function n(e){let t,o,n;return async function(){for(var i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return t?(n=s,o||(o=t.then((()=>(o=void 0,t=e(...n),t))),o)):(t=e(...s),t)}}o.d(t,{Z:()=>n})},157955:(e,t,o)=>{"use strict";o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>M,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>y,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>C,MAX_RECURRENCE_INTERVAL:()=>f,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>v,RRULE_WEEKDAYS_MAP:()=>h,convertFromUnpersistedRecurrenceConfig:()=>A,convertToUnpersistedRecurrenceConfig:()=>R,getFormattedEndCondition:()=>L,getFormattedNextRecurrenceTime:()=>I,getNewEndTimestamp:()=>T,getNextDateUtc:()=>_,getRecurrenceAfter:()=>k,isRunningBetweenMidnightAnd3AM:()=>j,isValidRecurrenceInterval:()=>S,isValidRecurrenceNumberOfRuns:()=>x,rruleFromRecurrence:()=>b,templateAncestorsViolateRecurrenceNesting:()=>w});o(267602),o(653476),o(241792);var n=()=>o(730120);o(670560);function i(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];if(0===o.length)return e.map((e=>[e]));const s=[];for(const r of e)s.push(...i(o[0],...o.slice(1)).map((e=>[r,...e])));return s}var s=()=>o(696459),r=()=>o(326966),a=()=>o(803021),l=()=>o(646574),c=()=>o(998411),d=()=>o(578292);class u extends(()=>o(484885))().Ci{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var m=()=>o(494616);const p=(0,o(788860).vU)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12–3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),g={day:u.DAILY,week:u.WEEKLY,month:u.MONTHLY,year:u.YEARLY},h={MO:u.MO,TU:u.TU,WE:u.WE,TH:u.TH,FR:u.FR,SA:u.SA,SU:u.SU},f=99,v=999;function S(e){return(0,r().hj)(e)&&Number.isInteger(e)&&e>0&&e<=f}function x(e){return(0,r().hj)(e)&&Number.isInteger(e)&&e>0&&e<=v}function b(e){const{start_date:t,frequency:o,interval:n,weekdays:r,timezone:l,hour:c,minute:d}=e,m="week"===o&&r?r.map((e=>h[e])):void 0,p={};return(0,s().$K)(e.end_condition)&&("date"===e.end_condition.type?p.until=(0,a().pd)(e.end_condition.end_at):"number"===e.end_condition.type?p.count=e.end_condition.number_of_occurrences:(0,s().t1)(e.end_condition)),"month"===e.frequency&&(0,s().$K)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?p.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?p.byweekday=i(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,o]=e;return h[t].nth(o)})):(0,s().t1)(e.monthly_restriction)),new u({freq:g[o],dtstart:(0,a().pd)(t),interval:n,byweekday:m,tzid:l,byhour:c??0,byminute:d??0,bysecond:0,...p})}const C=1,y=1;function w(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const o=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),n=e.length,i=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,s=n>C,r=o.length>=y;return{violatesConstraint:s||r,templateNestingExceedsMaxDepth:s,ancestorHasDailyTemplate:r,nestedDepthOfAutomationAncestors:n,immediateAncestorRecurrenceType:i}}function k(e){const{recurrence:t,afterDate:o}=e;if((0,m().nA)(t)){const e=(0,a().kq)(o);return t.start_date>=e?new Date(t.start_date):void 0}{const e=b(t).after((0,a().pd)(o));if(!e)return;return(0,a().YL)(e)}}function j(e){return 0===e.hour||1===e.hour||2===e.hour}function _(e){return b(e).after((0,a().pd)((0,a().Jh)()))||void 0}function I(e){const{recurrence:t,intl:o}=e,i=_(A(t));if(!i)return;const s=j(t),r=n().ou.fromJSDate(i).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,d().E2)(o)).setZone(t.timezone),a=(0,l().p6)({date:r,dateFormat:"relative",allowRelativeDates:!0,intl:o,shortenDate:!0});if(s)return o.formatMessage(p.dateBetweenMidnightAnd3AM,{date:a});{let e=r.toLocaleString(n().ou.TIME_SIMPLE);return t.timezone!==(0,c().r)()&&(e+=` ${r.toFormat("ZZZZ")}`),o.formatMessage(p.dateAtTime,{date:a,time:e})}}function L(e,t){return(0,s().$K)(e)?"number"===e.type?t.formatMessage(p.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,l().p6)({date:n().ou.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,s().t1)(e):t.formatMessage(p.noEndCondition)}const M=100;function R(e){return{...e,start_date:(0,a().kq)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,a().kq)(e.end_condition.end_at)}:(0,s().t1)(e.end_condition):void 0}}function T(e,t,o){return e.plus(o-t)}function D(e,t){const o=n().ou.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,a().Jh)(o.toJSDate())}}function A(e){return{...e,start_date:(0,a().Jh)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?D(e,e.end_condition):(0,s().t1)(e.end_condition):void 0}}},370668:(e,t,o)=>{"use strict";o.d(t,{V:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("arrowLeft",{viewBox:"0 0 30 30",svg:(0,n.jsx)("polygon",{points:"29 14 4.813 14 13.406 5.406 12 4 1 15 12 26 13.406 24.594 4.813 16 29 16"})})},984478:(e,t,o)=>{"use strict";o.d(t,{f:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("chevronLeft",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M3.61816 8.06445C3.61816 8.29688 3.70703 8.49512 3.8916 8.67285L9.22363 13.8887C9.36719 14.0391 9.55859 14.1143 9.77734 14.1143C10.2217 14.1143 10.5703 13.7725 10.5703 13.3213C10.5703 13.1025 10.4814 12.9043 10.3311 12.7539L5.52539 8.06445L10.3311 3.375C10.4814 3.21777 10.5703 3.01953 10.5703 2.80078C10.5703 2.35645 10.2217 2.01465 9.77734 2.01465C9.55859 2.01465 9.36719 2.08984 9.22363 2.24023L3.8916 7.45605C3.70703 7.63379 3.625 7.83203 3.61816 8.06445Z"})})},165940:(e,t,o)=>{"use strict";o.d(t,{R:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("chevronUpRounded",{viewBox:"0 0 15 9",svg:(0,n.jsx)("path",{d:"M1.258 6.5L7.203.422a.946.946 0 01.719-.32.99.99 0 01.726.32L14.586 6.5a.89.89 0 01.266.648c0 .524-.407.93-.922.93a.921.921 0 01-.672-.281L7.93 2.32 2.586 7.797a.926.926 0 01-.672.281.915.915 0 01-.922-.93c0-.25.094-.476.266-.648z"})})},742922:(e,t,o)=>{"use strict";o.d(t,{y:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("codeFile",{viewBox:"0 0 23 24",svg:(0,n.jsx)("path",{d:"M4.195 11.86c0-.266.078-.488.235-.665.156-.182.38-.3.672-.351.494-.089.849-.271 1.062-.547.214-.281.32-.73.32-1.344V6.961c0-1.115.263-1.938.79-2.469.525-.536 1.333-.804 2.421-.804.203 0 .375.023.516.07.177.057.31.146.398.265a.646.646 0 01.141.422c0 .339-.148.558-.445.657a1.14 1.14 0 01-.157.039l-.171.015c-.625.047-1.066.222-1.32.524-.256.302-.384.8-.384 1.492v2.414c0 .672-.182 1.198-.546 1.578-.36.38-.86.604-1.5.672-.032 0-.047.013-.047.039.005.02.02.034.047.04.64.062 1.14.283 1.5.663.364.38.546.906.546 1.578v2.414c0 .693.128 1.19.383 1.492.255.303.696.48 1.32.532.053 0 .1.002.141.008l.133.03c.333.09.5.308.5.657a.68.68 0 01-.14.43.816.816 0 01-.407.273 1.48 1.48 0 01-.437.063c-1.12 0-1.948-.266-2.485-.797-.531-.526-.797-1.352-.797-2.477V14.79c0-.614-.106-1.062-.32-1.344-.213-.28-.568-.463-1.062-.547-.292-.062-.516-.182-.672-.359-.157-.177-.235-.404-.235-.68zm15.602 0c0 .275-.078.502-.235.68-.156.176-.382.296-.68.358-.5.084-.856.266-1.07.547-.208.282-.312.73-.312 1.344v1.992c0 1.125-.266 1.95-.797 2.477-.531.531-1.36.797-2.484.797-.151 0-.297-.021-.438-.063a.757.757 0 01-.414-.265.715.715 0 01-.133-.438c0-.182.042-.328.125-.437a.674.674 0 01.383-.22l.117-.03c.047-.006.097-.008.149-.008.625-.052 1.065-.23 1.32-.532.255-.302.383-.799.383-1.492v-2.414c0-.672.182-1.208.547-1.61.364-.405.864-.616 1.5-.632.026-.005.039-.018.039-.039 0-.026-.013-.04-.04-.04-.635-.015-1.135-.226-1.5-.632-.364-.406-.546-.945-.546-1.617V7.172c0-.693-.128-1.193-.383-1.5-.255-.307-.695-.48-1.32-.516l-.18-.015a1.233 1.233 0 01-.148-.04c-.297-.109-.446-.328-.446-.656 0-.166.045-.307.133-.422a.777.777 0 01.414-.265c.14-.047.31-.07.508-.07 1.089 0 1.896.268 2.422.804.526.531.789 1.354.789 2.469v1.992c0 .615.107 1.06.32 1.336.214.276.568.461 1.063.555.297.052.523.169.68.351a.967.967 0 01.234.664z"})})},94250:(e,t,o)=>{"use strict";o.d(t,{c:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("eye",{viewBox:"0 0 32 32",svg:(0,n.jsx)("path",{d:"M16.006 25.812c8.863 0 14.994-7.17 14.994-9.406C31 14.16 24.858 7 16.006 7 7.252 7 1 14.16 1 16.406c0 2.236 6.252 9.406 15.006 9.406zm0-3.242a6.194 6.194 0 01-6.197-6.164c-.012-3.452 2.744-6.164 6.197-6.164 3.419 0 6.185 2.711 6.185 6.164 0 3.364-2.766 6.164-6.185 6.164zm0-3.94c1.228 0 2.246-1.007 2.246-2.224 0-1.228-1.018-2.235-2.246-2.235-1.24 0-2.258 1.007-2.258 2.235 0 1.217 1.018 2.224 2.258 2.224z"})})},78652:(e,t,o)=>{"use strict";o.d(t,{V:()=>i});o(667294);var n=o(785893);const i=(0,o(827282).IU)("reactionAdd",{viewBox:"0 0 20 20",svg:(0,n.jsxs)("g",{children:[(0,n.jsx)("path",{d:"M12 14.3516C12 14.1875 12.0573 14.0482 12.1719 13.9336C12.2891 13.8164 12.4297 13.7578 12.5938 13.7578H14.7617V11.5938C14.7617 11.4297 14.819 11.2904 14.9336 11.1758C15.0482 11.0586 15.1875 11 15.3516 11C15.5156 11 15.6549 11.0586 15.7695 11.1758C15.8867 11.2904 15.9453 11.4297 15.9453 11.5938V13.7578H18.1133C18.2747 13.7578 18.4128 13.8164 18.5273 13.9336C18.6445 14.0482 18.7031 14.1875 18.7031 14.3516C18.7031 14.5156 18.6445 14.6562 18.5273 14.7734C18.4128 14.888 18.2747 14.9453 18.1133 14.9453H15.9453V17.1133C15.9453 17.2747 15.8867 17.4128 15.7695 17.5273C15.6549 17.6445 15.5156 17.7031 15.3516 17.7031C15.1875 17.7031 15.0482 17.6445 14.9336 17.5273C14.819 17.4128 14.7617 17.2747 14.7617 17.1133V14.9453H12.5938C12.4297 14.9453 12.2891 14.888 12.1719 14.7734C12.0573 14.6562 12 14.5156 12 14.3516Z"}),(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.0615 17.123C9.09538 17.123 8.1862 16.9385 7.33398 16.5693C6.48177 16.2048 5.72982 15.6966 5.07812 15.0449C4.43099 14.3932 3.92285 13.6413 3.55371 12.7891C3.18457 11.9368 3 11.0277 3 10.0615C3 9.09538 3.18457 8.1862 3.55371 7.33398C3.92285 6.48177 4.43099 5.7321 5.07812 5.08496C5.72982 4.43327 6.47949 3.92285 7.32715 3.55371C8.17936 3.18457 9.08854 3 10.0547 3C11.0254 3 11.9368 3.18457 12.7891 3.55371C13.6413 3.92285 14.3932 4.43327 15.0449 5.08496C15.6966 5.7321 16.207 6.48177 16.5762 7.33398C16.9453 8.1862 17.1299 9.09538 17.1299 10.0615C17.1299 10.6193 17.0684 11.1581 16.9453 11.678V11.5938C16.9453 11.1646 16.7813 10.7706 16.4767 10.4687C16.2657 10.2558 16.0099 10.1116 15.7285 10.0441C15.7263 9.26677 15.5805 8.53887 15.291 7.86035C14.9993 7.1722 14.5938 6.56836 14.0742 6.04883C13.5547 5.5293 12.9508 5.1237 12.2627 4.83203C11.5791 4.54036 10.8431 4.39453 10.0547 4.39453C9.27083 4.39453 8.53483 4.54036 7.84668 4.83203C7.16309 5.1237 6.5638 5.5293 6.04883 6.04883C5.53385 6.56836 5.13053 7.1722 4.83887 7.86035C4.5472 8.54395 4.40137 9.27767 4.40137 10.0615C4.40137 10.8499 4.5472 11.5859 4.83887 12.2695C5.13053 12.9531 5.53385 13.5547 6.04883 14.0742C6.56836 14.5938 7.16992 14.9993 7.85352 15.291C8.54167 15.5827 9.27767 15.7285 10.0615 15.7285C10.5739 15.7285 11.0641 15.6669 11.5321 15.5438C11.8272 15.8056 12.1958 15.9453 12.5938 15.9453H13.7617V16.0641C13.4535 16.2554 13.1293 16.4238 12.7891 16.5693C11.9368 16.9385 11.0277 17.123 10.0615 17.123ZM10.0547 13.4248C9.58073 13.4248 9.16146 13.3405 8.79688 13.1719C8.43685 12.9987 8.15658 12.8005 7.95605 12.5771C7.76009 12.3538 7.66211 12.167 7.66211 12.0166C7.66211 11.9346 7.69401 11.8776 7.75781 11.8457C7.82617 11.8092 7.89909 11.8092 7.97656 11.8457C8.22721 11.9779 8.51204 12.1055 8.83105 12.2285C9.15006 12.3516 9.55794 12.4131 10.0547 12.4131C10.5514 12.4131 10.9593 12.3516 11.2783 12.2285C11.6019 12.1055 11.8867 11.9779 12.1328 11.8457C12.2103 11.8092 12.2832 11.8092 12.3516 11.8457C12.4199 11.8776 12.4541 11.9346 12.4541 12.0166C12.4541 12.167 12.3538 12.3538 12.1533 12.5771C11.9528 12.8005 11.6725 12.9987 11.3125 13.1719C10.9525 13.3405 10.5332 13.4248 10.0547 13.4248ZM8.03809 9.44629C7.82389 9.44629 7.63704 9.3597 7.47754 9.18652C7.32259 9.01335 7.24512 8.79004 7.24512 8.5166C7.24512 8.24772 7.32259 8.02669 7.47754 7.85352C7.63704 7.67578 7.82389 7.58691 8.03809 7.58691C8.25228 7.58691 8.44141 7.67578 8.60547 7.85352C8.76953 8.02669 8.85156 8.24772 8.85156 8.5166C8.85156 8.79004 8.76953 9.01335 8.60547 9.18652C8.44141 9.3597 8.25228 9.44629 8.03809 9.44629ZM12.0713 9.44629C11.8571 9.44629 11.6702 9.3597 11.5107 9.18652C11.3558 9.01335 11.2783 8.79004 11.2783 8.5166C11.2783 8.24772 11.3558 8.02669 11.5107 7.85352C11.6702 7.67578 11.8571 7.58691 12.0713 7.58691C12.2855 7.58691 12.4746 7.67578 12.6387 7.85352C12.8027 8.02669 12.8848 8.24772 12.8848 8.5166C12.8848 8.79004 12.8027 9.01335 12.6387 9.18652C12.4746 9.3597 12.2855 9.44629 12.0713 9.44629Z"})]})})},46581:(e,t,o)=>{"use strict";o.d(t,{U:()=>r});var n=o.n(o(389539)),i=()=>o(280210),s=()=>o(956057);class r{constructor(e){this.environmentName=void 0,this.mainShortId=void 0,this.getSettings=void 0,this.isServerOriginated=void 0,this.mapSpaceIdToShortId=void 0,this.idCreatorLogger=void 0,this.environmentName=e.environmentName,this.mainShortId=o(631871).jF[this.environmentName],this.getSettings=e.getSettings,this.isServerOriginated=e.isServerOriginated,this.mapSpaceIdToShortId=e.mapSpaceIdToShortId,this.idCreatorLogger=e.idCreatorLogger??(()=>{})}idInMain(e){const{enableTestDateOffset:t,enableIdSchema:n}=this.getSettings();return n&&e!==o(363777).uK?(this.idCreatorLogger(void 0,e,t?"id_schema_test":"id_schema"),(0,i().ii)(t,this.mainShortId,e,this.isServerOriginated)):this.legacyId(e,"disabled")}pointerInMain(e){return{table:e,id:this.idInMain(e)}}async idWithSpaceId(e,t){const{enableTestDateOffset:o,enableIdSchema:s}=this.getSettings();if(!s||"space"===t)return this.legacyId(t,"disabled");const r=this.mapSpaceIdToShortId(e),a=n().types.isPromise(r)?await r:r;return a?(this.idCreatorLogger(e,t,o?"id_schema_test":"id_schema"),(0,i().U_)(o,a,t,this.isServerOriginated)):this.legacyId(t,"missing_short_id")}async pointerWithSpaceId(e,t){return{table:t,spaceId:e,id:await this.idWithSpaceId(e,t)}}idWithSpaceShortId(e,t){const{enableTestDateOffset:o,enableIdSchema:n}=this.getSettings();return n&&"space"!==t?(this.idCreatorLogger(void 0,t,o?"id_schema_test":"id_schema"),(0,i().U_)(o,e,t,this.isServerOriginated)):this.legacyId(t,"disabled")}legacyId(e,t){return this.idCreatorLogger(void 0,e,t),s().Il()}async deterministicIdWithSpaceId(e,t,o){const{enableTestDateOffset:r,enableIdSchema:a}=this.getSettings();if(!a)return this.idCreatorLogger(e,t,"disabled"),s().Ul(o);const l=this.mapSpaceIdToShortId(e),c=n().types.isPromise(l)?await l:l;return c?(this.idCreatorLogger(e,t,r?"id_schema_test":"id_schema"),(0,i().f6)(c,t,o)):(this.idCreatorLogger(e,t,"missing_short_id"),s().Ul(o))}deterministicIdWithSpaceShortId(e,t,o){const{enableTestDateOffset:n,enableIdSchema:r}=this.getSettings();return r?(this.idCreatorLogger(void 0,t,n?"id_schema_test":"id_schema"),(0,i().f6)(e,t,o)):(this.idCreatorLogger(void 0,t,"disabled"),s().Ul(o))}async getSpaceIdCreator(e){if(!e)return new a(e,this.idCreatorLogger);const{enableIdSchema:t}=this.getSettings();if(!t)return new a(e,this.idCreatorLogger);const o=this.mapSpaceIdToShortId(e),i=n().types.isPromise(o)?await o:o;return this.getSpaceShortIdCreator(e,i)}getSpaceIdCreatorSync(e){if(!e)return new a(e,this.idCreatorLogger);const{enableIdSchema:t}=this.getSettings();if(!t)return new a(e,this.idCreatorLogger);const o=this.mapSpaceIdToShortId(e),i=n().types.isPromise(o)?void 0:o;return this.getSpaceShortIdCreator(e,i)}getSpaceShortIdCreator(e,t){const{enableIdSchema:o}=this.getSettings();return o&&t?new l(e,this,t):new a(e,this.idCreatorLogger)}async getSpaceIdCreatorFromModel(e){return e.getShortIdStr()?this.getSpaceShortIdCreator(e.id,Number(e.getShortIdStr())):await this.getSpaceIdCreator(e.id)}}class a{constructor(e,t){this.spaceId=void 0,this.idCreatorLogger=void 0,this.spaceId=e,this.idCreatorLogger=t}idInSavedSpace(e){return this.idCreatorLogger(void 0,e,"disabled"),s().Il()}idInMain(e){return this.idCreatorLogger(void 0,e,"disabled"),s().Il()}deterministicIdInSavedSpace(e,t){return this.idCreatorLogger(void 0,e,"disabled"),s().Ul(t)}pointerInMain(e){return{id:this.idInMain(e),table:e}}pointerInSavedSpace(e){return{id:this.idInSavedSpace(e),table:e,spaceId:this.spaceId}}getSpaceId(){return this.spaceId}}class l{constructor(e,t,o){this.spaceId=void 0,this.idCreator=void 0,this.spaceShortId=void 0,this.spaceId=e,this.idCreator=t,this.spaceShortId=o}idInSavedSpace(e){return this.idCreator.idWithSpaceShortId(this.spaceShortId,e)}idInMain(e){return this.idCreator.idInMain(e)}deterministicIdInSavedSpace(e,t){return this.idCreator.deterministicIdWithSpaceShortId(this.spaceShortId,e,t)}pointerInMain(e){return{id:this.idInMain(e),table:e}}pointerInSavedSpace(e){return{id:this.idInSavedSpace(e),table:e,spaceId:this.spaceId}}getSpaceId(){return this.spaceId}}},88829:(e,t,o)=>{"use strict";o.d(t,{Z:()=>n});const n={appCursorListener:{sidebar:1,secondarySidebar:2,editor:3,aiChat:3,marketplace:3,teamHome:3}}},971095:(e,t,o)=>{"use strict";o.d(t,{A:()=>n});const n=(0,o(830742).LS)("importEvernote")},400939:e=>{var t=/[a-zA-Z0-9_\u0392-\u03c9\u00c0-\u00ff\u0600-\u06ff]+|[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af]+/g;e.exports=function(e){var o=e.match(t),n=0;if(!o)return 0;for(var i=0;i<o.length;i++)o[i].charCodeAt(0)>=19968?n+=o[i].length:n+=1;return n}}}]);