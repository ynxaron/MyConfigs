"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[73308],{895330:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ke});var o=n(667294),i=()=>n(492788),s=()=>n(219727),r=()=>n(142735),l=()=>n(526839),a=()=>n(788860),c=()=>n(744091),u=()=>n(33649),d=()=>n(269299),p=()=>n(206352),k=()=>n(94967),f=()=>n(198829),m=()=>n(255577),g=()=>n(470386),v=()=>n(967092),y=()=>n(493954),x=()=>n(352230),h=()=>n(191003),I=()=>n(91502),S=()=>n(81979),T=()=>n(300822),w=()=>n(396136),P=()=>n(955620),M=()=>n(513670),B=()=>n(696459),L=()=>n(916673),b=()=>n(286310),j=()=>n(970105),Z=()=>n(827973),C=()=>n(388284),U=()=>n(205228),_=()=>n(594546),V=()=>n(718959),A=()=>n(624528),F=()=>n(189288),R=()=>n(922784),E=()=>n(740046),O=()=>n(385185);var H=n(785893);function Q(e){const{state:t,focusInitial:n,defaultValue:o,onBlur:i,onKeyDown:r,style:l}=e,c=(0,s().MO)(),u=(0,a().YB)(),d=u.formatMessage({defaultMessage:"Paste link or search pages",id:"selectionLinkButton.search.createNewLinkPlaceholder"}),p=u.formatMessage({defaultMessage:"Edit link or search pages",id:"selectionLinkButton.search.editLinkPlaceholder"}),k=!c||!t.showCreateIn,f=c?void 0:!t.showCreateIn&&t.focusLinkInput,m=(0,y().Z8)(t)?p:d;return k?(0,H.jsx)(E().ZP,{onFocus:y().FV,placeholder:m,value:o||t.url,onChange:K,onBlur:i,onKeyDown:r,focus:f,focusInitial:n,focusAfterAnimation:!0,preventCaptureArrowShortcuts:!0,style:l}):null}function K(e){const t=(0,y().ny)();t&&function(e,t){switch(e.type){case"text":return void O().Z.setState({...e,url:t.target.value,focusLinkInput:!0});case"image":return void F().Z.setState({...e,url:t.target.value,focusLinkInput:!0});default:(0,B().t1)(e)}}(t,e)}function q(e){const{state:t,showPreview:n,store:o}=e,i=(0,s().MO)(),r=(0,y().Fs)(t),l=(0,y().Z8)(t);return n&&o?(0,H.jsx)(R().B,{store:o,onClick:y().FV}):(0,H.jsx)(Q,{state:t,onBlur:y().cX,onKeyDown:N,defaultValue:n?r:void 0,style:l?void 0:{marginTop:6},focusInitial:!l||i&&"text"===t.type&&!t.focusTitleInput})}function N(e){"Escape"===e.key&&(e.stopPropagation(),(0,y().hy)())}function D(e){const{title:t,focus:n,defaultTitle:i}=e,r=(0,s().O7)(),l=(0,s().MO)(),[a,c]=(0,o.useState)(),u=(0,o.useRef)(!1),d=(0,o.useMemo)((()=>({environment:r,defaultTitle:i,setPlaceholder:c,hasTitleChanged:u})),[i,r]);return(0,o.useEffect)((()=>{const e=u.current;return()=>{e&&b().pZ(r)}}),[u,r]),(0,H.jsx)(E().ZP,{focus:n,focusInitial:l,onFocus:Y,onBlur:()=>X(d),onChange:e=>function(e,t){G(e.target.value,t)}(e,d),onKeyDown:e=>function(e,t){"Enter"!==e.key&&"Escape"!==e.key||(e.stopPropagation(),X(t))}(e,d),value:a?"":t,placeholder:a,preventCaptureArrowShortcuts:!0,style:{paddingBottom:8}})}function G(e,t){const n=O().Z.state;if(!n.open)return;const{editingToken:o,savedTextSelectionState:i}=n;if(!o)return;if(!e)return void O().Z.setState({...n,title:""});const{environment:s,setPlaceholder:r,hasTitleChanged:l}=t;d().createAndCommit({userAction:"LinkMenu.updateTitle",environment:s,canUndo:!0,perform:t=>{const a=u().iX({environment:s,title:e,transaction:t,editingToken:o,savedTextSelectionState:i});a&&O().Z.setState({...n,...a,title:e}),r(void 0),l.current=!0}})}function Y(){(0,y().ZG)(!0)}function X(e){!function(e){const t=O().Z.state;if(!t.open)return;const{defaultTitle:n,setPlaceholder:o}=e;t.title||(G(n,e),o(n))}(e),(0,y().ZG)(!1)}var W=()=>n(804217),$=()=>n(826955),J=(n(267602),n(241792),n(228244),()=>n(504008)),z=()=>n(801812),ee=()=>n(231219),te=()=>n(15981),ne=()=>n(828946),oe=()=>n(677559),ie=()=>n(729201);var se=()=>n(95886);function re(e){const{state:t,onUnlink:n}=e,i=(0,o.useMemo)((()=>(0,y().uP)(t)),[t]),c=(0,o.useMemo)((()=>(0,y().dY)(i)),[i]),u=function(e){const{state:t,inputUrl:n,query:i,handleLinkSelection:l}=e,{url:c}=t,u=(0,s().O7)(),d=(0,s().MO)(),p=(0,r().VK)((()=>W().default.state.online),[]),k=!!c,f=(0,o.useMemo)((()=>{let e,o=!1;if(!n&&k)e=(0,H.jsx)(a()._H,{defaultMessage:"Type a complete URL to link",id:"selectionLinkButton.invalidUrl"}),o=!0;else{if(!n)return;if("notion"===n.type&&p)return;"web"===n.type?e=(0,H.jsx)(a()._H,{id:"selectionLinkButton.linkToWebPage",defaultMessage:"Link to web page"}):"notion"===n.type?e=(0,H.jsx)(a()._H,{id:"selectionLinkButton.linkToPage",defaultMessage:"Link to page"}):"other"===n.type?e=(0,H.jsx)(a()._H,{id:"selectionLinkButton.linkToURL",defaultMessage:"Link to URL"}):(0,B().t1)(n.type)}return{key:"link to url",action:()=>l(u,t,i,d),render:t=>(0,H.jsx)(Z().Z,{...t,title:c,caption:e,icon:(0,S().o)({width:16,paddingTop:4}),disabled:o})}}),[t,i,u,d,p,n,l,k,c]);return f}({state:t,inputUrl:c,query:i,handleLinkSelection:le}),d=function(e){const{state:t,inputUrl:n,query:i,additionalItem:c}=e,u="text"===t.type?t.editingToken:t.imageHyperlink,d=(0,y().Z8)(t),p=function(e){const{state:t,inputUrl:n,query:i,handleLinkSelection:c,disableEmptyQueryResults:u}=e,d=(0,s().O7)(),p=(0,s().MO)(),[{online:k}]=(0,r().AF)(W().default),f=(0,o.useMemo)((()=>{var e;const n="text"===t.type?null===(e=(0,h().QY)(t.savedTextSelectionState.multiSelection))||void 0===e?void 0:e.store:t.store;if(n&&n instanceof $().G)return n}),[t]),m=(0,oe().XJ)(ne().x.searchActions),[{value:g,status:v}]=(0,z().r5)((async()=>{if(!k||"resolved"!==m.status)return[];if(!i)return u?[]:te().X4.state.map((e=>e.pageId));const e=m.value;return(await e.searchMentionablePages({nearBlock:f,environment:d,query:i,source:"mention_menu",limit:10})).map((e=>e.id))}),[i,f,d,k,u,m.status,m.value]),y=(0,ie().Z)("resolved"===v,300,300),x=(0,o.useMemo)((()=>{if(n&&"notion"===n.type){const e="page"===n.notionPage.name?n.notionPage.blockId:n.notionPage.peekViewBlockId,t=g?M().zu(g,e):[];return[n,...t]}return g}),[g,n]);return(0,o.useMemo)((()=>{if(!x||0===x.length)return;if(n&&"web"===n.type&&n.url===i)return;const e=J().Z.withListenerIgnored(V().RM);if(!e)return;const o=t.url?5:3,s=(0,H.jsx)(a()._H,{id:"selectionLinkButton.linkToPage.linkToBlock",defaultMessage:"Link to block"}),r=(0,H.jsx)(a()._H,{defaultMessage:"Link to page",id:"selectionLinkButton.linkToPageSection.title"});return{items:(0,M().oA)(x.map(((n,o)=>{const{pageId:i,peekViewBlockId:r,scrollToBlockId:u,discussionId:k,collectionViewId:f}="object"==typeof n?{pageId:"page"===n.notionPage.name?n.notionPage.blockId:n.notionPage.peekViewBlockId,..."page"===n.notionPage.name?{scrollToBlockId:n.notionPage.scrollToBlockId,peekViewBlockId:n.notionPage.peekViewBlockId,discussionId:n.notionPage.discussionId,collectionViewId:n.notionPage.collectionViewId}:{scrollToBlockId:void 0,peekViewBlockId:void 0,discussionId:void 0,collectionViewId:void 0}}:{pageId:n,peekViewBlockId:void 0,scrollToBlockId:void 0,discussionId:void 0,collectionViewId:void 0};if(!i)return;const m=$().G.createChildStore(e,{table:w().iU,id:i});return{key:o,action:()=>{if("object"==typeof n){const e=(0,l().nR)({pageId:i,peekViewBlockId:r,peekMode:n.notionPage.peekMode,discussionId:k,collectionViewId:f,scrollToBlockId:u});c(d,t,e,p,m)}else c(d,t,(0,l().nR)({pageId:i}),p,m)},render:e=>{const t="object"==typeof n&&u;return(0,H.jsx)(ee().Z,{...e,store:m,caption:t?s:void 0,placeholder:y?(0,H.jsx)(a()._H,{id:"selectionLinkButton.linkToPage.unknownBlock",defaultMessage:"Unknown block"}):(0,H.jsx)(a()._H,{id:"selectionLinkButton.linkToPage.loading",defaultMessage:"Loading..."})})}}}))).slice(0,o),title:x.some((e=>Boolean("object"==typeof e&&"page"===e.notionPage.name&&e.notionPage.scrollToBlockId)))?s:r}}),[x,t,d,p,i,n,c,y])}({state:t,inputUrl:n,query:i,handleLinkSelection:le,disableEmptyQueryResults:d}),k=(0,o.useMemo)((()=>{if(p||c){return{key:"results",items:M().oA([...(null==p?void 0:p.items)||[],c]),render:e=>(0,H.jsx)(C().Z,{...e,title:u||i?void 0:(0,H.jsx)(a()._H,{id:"selectionLinkButton.recents.title",defaultMessage:"Recents"})})}}}),[p,c,u,i]);return k}({state:t,inputUrl:c,query:i,additionalItem:u}),p=(0,y().Fs)(t),k=p&&(0,l().A5)({url:p,baseUrl:U().default.domainBaseUrl,publicDomainName:U().default.publicDomainName}),f=(0,r().VK)((()=>{if(!k)return;const e=(0,V().RM)();return e?$().G.createChildStore(e,{table:w().iU,id:k}):void 0}),[k]),m=function(e){const{state:t,url:n,isEmptyResults:i,pageStore:s}=e,r=(0,o.useMemo)((()=>{let e=(0,H.jsx)(a()._H,{defaultMessage:"Page or URL",id:"selectionLinkButton.currentInfo.pageOrUrl"});const o=!t.focusLinkInput&&i;let r;return s?r={key:"link to page",action:()=>{},render:()=>(0,H.jsx)(q,{state:t,showPreview:o,store:s})}:n?r={key:"link to web",action:()=>{},render:()=>(0,H.jsx)(q,{state:t,showPreview:!0})}:(e=void 0,r={key:"create link",action:()=>{},render:()=>(0,H.jsx)(q,{state:t,showPreview:o})}),{key:"page or url",render:t=>(0,H.jsx)(C().Z,{title:e,...t}),items:[r]}}),[t,n,i,s]);return r}({state:t,url:p,isEmptyResults:!Boolean(d),pageStore:f}),g=function(e){const{state:t,url:n,pageStore:i}=e,s=(0,r().VK)((()=>i?P().QaF(i.getTitleValue()):void 0),[i]),l=(0,o.useMemo)((()=>{if("text"!==t.type)return;const{editingToken:e,title:o,focusTitleInput:i}=t;return e?{key:"link title",render:e=>(0,H.jsx)(C().Z,{title:(0,H.jsx)(a()._H,{defaultMessage:"Link title",id:"selectionLinkButton.currentInfo.linkTitle"}),...e}),items:[{key:"update title",action:()=>{},render:()=>(0,H.jsx)(D,{title:o,defaultTitle:s??n,focus:i})}]}:void 0}),[t,n,s]);return l}({state:t,url:p,pageStore:f}),v=function(e){const{state:t,onUnlink:n}=e,i=function(e){const{state:t,onUnlink:n}=e,i=(0,s().O7)();return(0,o.useMemo)((()=>{if((0,y().Z8)(t))return{key:"unlink",action:()=>{n(i);const e=(0,y().Fs)(t);switch(t.type){case"text":b().oS(i,{type:"remove_link",url:e});break;case"image":const n=e?(0,L().gy)(e):void 0;(0,_().j)({environment:i,event:{eventName:"image_hyperlink_action",eventProperties:{action:"remove_link",url_type:null!=n&&n.hostname?"external":"notion"}}});break;default:(0,B().t1)(t)}},render:e=>(0,H.jsx)(Z().Z,{...e,title:(0,H.jsx)(a()._H,{id:"selectionLinkButton.removeLink",defaultMessage:"Remove link"}),icon:(0,se().y)({width:16})})}}),[n,t,i])}({state:t,onUnlink:n}),r=(0,o.useMemo)((()=>{const e=M().oA([i]);if(0!==e.length)return{key:"link actions",render:e=>(0,H.jsx)(C().Z,{topBorder:!0,...e}),items:e}}),[i]);return r}({state:t,onUnlink:n});let x,I;return d?(I=1,x=M().oA([m,d])):(I=void 0,x=M().oA([m,g,v])),{initialFocus:I,sections:x}}function le(e,t,n,o,i){const s=(0,T().D)(n);if(!s)return;const r=(0,y().Fs)(t);if(d().createAndCommit({userAction:"LinkMenu.handleLinkSelection",environment:e,canUndo:!0,perform:n=>{switch(t.type){case"text":const{editingToken:r,savedTextSelectionState:l,title:a}=t;(0,h().iG)(l.multiSelection)&&(i?j().lZ({environment:e,editorMode:"default",store:l.multiSelection.start.store,selection:{startIndex:l.multiSelection.start.index,endIndex:l.multiSelection.end.index},annotation:P().$0A(i.id,i.getSpaceId()),transaction:n,analyticsFrom:"block"}):j().mM({environment:e,store:l.multiSelection.start.store,tokens:[[s,[["a",s]]]],index:l.multiSelection.start.index,transaction:n}));const c=u().gp({environment:e,transaction:n,url:s,title:a,editingToken:r,savedTextSelectionState:l});c?(b().oS(e,{type:"edit_link",url:s}),O().Z.setState({...t,...c,url:"",focusLinkInput:!1,focusTitleInput:Boolean(o)})):(b().oS(e,{type:"create_link",url:s}),O().Z.reset());break;case"image":A().kJ({url:s,transaction:n}),F().Z.reset()}}}),"image"===t.type){var l;const t=null!==(l=(0,L().gy)(s))&&void 0!==l&&l.hostname?"external":"notion";(0,_().j)({environment:e,event:{eventName:"image_hyperlink_action",eventProperties:{action:r?"edit_link":"create_link",url_type:t}}})}}var ae=()=>n(10271),ce=()=>n(123721),ue=()=>n(998901),de=()=>n(104088),pe=()=>n(807230);function ke(){const e=(0,r().VK)((()=>(0,y().ny)()),[]),t=(0,s().Fy)(),n=(0,r().VK)(I().bq,[]),i=(0,r().VK)((()=>!e||function(e){switch(e.type){case"text":return u().Bn();case"image":return!e.open;default:(0,B().t1)(e)}}(e)),[e]);(0,o.useEffect)((()=>{e&&i&&function(e){switch(e){case"text":return void u().F5();case"image":return void A().$s();default:(0,B().t1)(e)}}(e.type)}),[i,e]);const l=function(e){if(e)switch(e.type){case"text":return{onClose:u().F5,onUnlink:u().PP};case"image":return{onClose:A().$s,onUnlink:A().rm};default:(0,B().t1)(e)}}(e);return l&&e?(0,H.jsx)(v().ZP,{popupType:t.isMobile?t.isTablet?de().k.Popup:de().k.SlideUp:de().k.Popup,style:{width:xe(n)},keepFocus:t.isPhone,open:e.open,originRect:e.open?e.selectionRect:void 0,placementToOrigin:ue().Placement.Bottom,alignmentToOrigin:ue().Alignment.Center,originGap:8,disableContentScroll:!0,onDismiss:l.onClose,render:()=>e.open?(0,H.jsx)(fe,{state:e,onClose:l.onClose,onUnlink:l.onUnlink}):void 0,preventBlockRenderQueueOnEnter:!t.isMobile}):null}function fe(e){const{state:t,onClose:n,onUnlink:r}=e,l=(0,s().MO)(),[c,u]=(0,o.useState)(!0);(0,o.useEffect)((()=>u(!1)),[]);const d=(0,o.useRef)(null);(0,o.useEffect)((()=>(d.current=document.createElement("input"),d.current.style.position="fixed",d.current.style.top="-9999px",d.current.style.left="-9999px",document.body.appendChild(d.current),()=>{d.current&&document.body.removeChild(d.current)})),[]);const m=l&&t.focusLinkInput&&("text"!==t.type||!t.focusTitleInput);(0,o.useEffect)((()=>{m&&i().default.afterNextFlush((()=>{d.current&&d.current.focus()}))}),[m]);const h=(0,o.useCallback)((()=>{i().default.afterNextFlush((()=>{d.current&&document.activeElement===d.current&&d.current.blur()}))}),[]);if((0,ae().Z)({shouldPreserveTextSelection:m,shouldPreserveBlockSelection:!0,shouldRestoreSelection:!0,onClearSelection:h}),t.showCreateIn&&!l)return(0,H.jsx)(ge,{state:t});let I;return I=l?{menuType:x().o.Modal,title:(0,H.jsx)(a()._H,{defaultMessage:"Link",id:"selectionLinkButton.mobile.title"}),right:(0,H.jsx)(g().CancelMenuText,{}),onClickRight:n,footer:(0,H.jsx)(v().ZP,{popupType:de().k.SlideUp,open:t.showCreateIn||!1,render:()=>(0,H.jsx)(ge,{state:t})})}:{menuType:x().o.Popup},(0,H.jsxs)(p().Z,{debugName:"LinkMenu",capture:t.open&&(c||t.focusLinkInput||"text"===t.type&&t.focusTitleInput),allowEsc:!0,children:[(0,H.jsx)(f().Z,{...I,children:(0,H.jsx)(me,{state:t,onUnlink:r})}),(0,H.jsx)(k().Z,{debugName:"LinkMenu",capture:!0,onCommandSlash:y().FV})]})}function me(e){const{state:t,onUnlink:n}=e,{initialFocus:o,sections:i}=re({state:t,onUnlink:n});return(0,H.jsx)(m().ZP,{type:m().iW.Vertical,initialFocus:o,sections:i})}function ge(e){var t;const{state:n}=e,i=(0,s().O7)(),a=(0,o.useCallback)((async e=>{var t;if(!(0,pe().ww)(i))return;const o="text"===n.type?null===(t=(0,h().QY)(n.savedTextSelectionState.multiSelection))||void 0===t?void 0:t.store:void 0;if(!o)return;const{performResult:{createInState:s}}=await d().createAndCommitAsync({environment:i,userAction:"LinkMenu.LinkCreateInMenu",waitForServerCommit:!0,perform:async t=>{const s=c().f8({environment:i,transaction:t,titleText:n.url||"",createInValue:e,recordStoreParentStore:o}),[r]=s.createdPages;return r&&"text"===n.type&&(u().gp({environment:i,url:(0,l().nR)({pageId:r.id}),transaction:t,editingToken:n.editingToken,savedTextSelectionState:n.savedTextSelectionState}),O().Z.reset()),await s.moveToStorePromise,{createInState:s}}});await c().c_({analyticsFrom:"link_menu",createInState:s})}),[n,i]),p="text"===n.type?null===(t=(0,h().QY)(n.savedTextSelectionState.multiSelection))||void 0===t?void 0:t.store:void 0,k=p&&"block"===p.table?p.id:void 0,f=(0,r().VK)(I().bq,[]);return(0,H.jsx)(ce().ZP,{targets:[],isAddTo:!0,isCreateIn:!0,onAccept:a,parentBlockId:k,onAutocompleteQueryChange:ve,autocompleteQuery:n.createInQuery||"",desktopWidth:xe(f),onCancel:ye})}function ve(e){const t=O().Z.state;t.open&&O().Z.setState({...t,createInQuery:e})}function ye(){const e=O().Z.state;e.open&&O().Z.setState({...e,showCreateIn:!1,createInQuery:""})}function xe(e){return e?400:330}}}]);