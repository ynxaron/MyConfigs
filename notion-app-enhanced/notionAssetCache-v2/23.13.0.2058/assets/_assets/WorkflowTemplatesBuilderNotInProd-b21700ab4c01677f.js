"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[6532,95986],{344927:(e,t,o)=>{o.d(t,{E:()=>l});var n=()=>o(635596);class l{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=(e,t,o)=>{let n=!0;this.didEmit||(this.didEmit=!0,n=!1),this.lastValue===t?n=!1:this.lastValue=t,n&&this.onEmit(t,o)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=n().ZP.addListener(this.listenerEventKey,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&n().ZP.removeListener(this.listener,this.environment)}}},726707:(e,t,o)=>{o.d(t,{EZ:()=>c,QW:()=>s,Wr:()=>i,Wt:()=>d});o(241792);var n=o(667294),l=()=>o(342792),r=o(785893);const a={marginBottom:4};function i(e){const{label:t,value:o,onChange:n}=e,l=u();return(0,r.jsxs)("div",{style:a,children:[(0,r.jsx)("input",{type:"checkbox",checked:o,id:l,onChange:e=>n(e.target.checked)}),(0,r.jsx)("label",{htmlFor:l,children:t})]})}function s(e){const{label:t,value:o,onChange:n,options:l,optionLabels:i}=e,s=u();return(0,r.jsxs)("div",{style:a,children:[(0,r.jsxs)("label",{htmlFor:s,children:[t,": "]}),(0,r.jsx)("select",{value:o,onChange:e=>n(e.target.value),children:l.map((e=>(0,r.jsx)("option",{value:e,children:i?i[e]:e},e)))})]})}const p="(none)";function c(e){const{label:t,value:o,onChange:n,options:l,optionLabels:a}=e;return(0,r.jsx)(s,{label:t,value:o??p,onChange:e=>n(e===p?void 0:e),options:[p,...l],optionLabels:a?{...a,[p]:"(none)"}:void 0})}function d(e){const{label:t,value:o,onChange:n,placeholder:l,dataList:i,disabled:s}=e,p=u(),c=u();return(0,r.jsxs)("div",{style:a,children:[(0,r.jsxs)("label",{htmlFor:p,children:[t,": "]}),(0,r.jsx)("input",{id:p,list:i?c:void 0,type:"text",value:o,disabled:s,placeholder:l,onChange:e=>{n(e.target.value)}}),i&&(0,r.jsx)("datalist",{id:c,children:i.map(((e,t)=>(0,r.jsx)("option",{value:e},t)))})]})}function u(){const[e]=(0,n.useState)((()=>(0,l().ZP)()));return e}},999582:(e,t,o)=>{o.d(t,{Z:()=>r});class n extends(()=>o(263184))().default{getInitialState(){return{}}}const l=new n;o(947115).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",l);const r=l},729728:(e,t,o)=>{o.r(t),o.d(t,{WorkflowTemplatesBuilderNotInProd:()=>Nt});var n=o(667294),l=()=>o(466970),r=(o(821057),o(241792),o(398858),o(461318),o(33228),()=>o(219727)),a=()=>o(142735),i=()=>o(342792),s=()=>o(877289),p=()=>o(205228),c=()=>o(726707);function d(e,t,o){!function(e,t){const o=(0,n.useRef)(),l=(0,n.useRef)();(0,n.useEffect)((()=>{if(o.current&&l.current!==t)throw new Error(`Assertion failure: "${e}" has changed. Original value was "${l.current}", but it is now "${t}".`);o.current=!0,l.current=t}),[e,t])}("persisted reducer key",e);const l=(0,n.useReducer)(t,void 0,(()=>{try{const t=window.sessionStorage.getItem(e);return t?JSON.parse(t):o}catch(t){return o}})),[r]=l;return(0,n.useEffect)((()=>{try{window.sessionStorage.setItem(e,JSON.stringify(r))}catch(t){}}),[e,r]),l}var u=()=>o(565630),m=()=>o(801812),f=()=>o(183922),h=()=>o(344927),y=(o(670560),()=>o(998411)),g=()=>o(217465),I=()=>o(955620),v=()=>o(824462),b=()=>o(332542),w=()=>o(636340),x=()=>o(970105),T=()=>o(826955),j=()=>o(54193);Error;function C(e){const{environment:t,transaction:o,rows:n,collectionInfo:{collectionId:l,spaceId:r,schema:a}}=e;let i=0,s=0;const p=function(e){const t=new Map;for(const[o,n]of Object.entries(e))n&&t.set(n.name,o);return t}(a),c=new(T().NW)(t,{table:"collection",id:l,spaceId:r});for(const d of n){const{_id:e,...n}=d.value;let l;d.isNewRow?(l=w().j4({environment:t,type:"page",inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:o,spaceId:r}),b().zw({childStore:l,parentStore:c,transaction:o}),i+=1):(l=T().G.createChildStore(c,{table:"block",id:e,spaceId:r}),s+=1);for(const[r,i]of Object.entries(n)){const e=p.get(r);if(!e)throw new Error(`Unable to find property id for "${r}"`);const n=a[e];if(!n)throw new Error(`No property schema found for "${r}"`);const s=k({value:i,schema:n}),c="title"===e?l.getBlockTitleStore():l.getPropertiesStore().getKeyStore(e);x().sO({environment:t,store:c,transaction:o,value:s})}}return{created:i,updated:s}}function k(e){const{value:t}=e;if("string"!=typeof t&&void 0!==t)throw new Error("Only property strings are currently supported.");return(0,I().TPx)(t)}function M(e){throw new Error("usePrototypeCollectionRows should never be used in production")}var O=()=>o(956057),_=()=>o(269299),S=()=>o(487333);function V(e){const{environment:t,templates:o,collectionInfo:n,templateToRowIdMap:l}=e,r=function(e,t){const o=[];for(const n of e){const e=!t.has(n.templateId),l=t.get(n.templateId)??(0,O().Il)();o.push({isNewRow:e,value:{_id:l,Name:n.templateId,JSON:JSON.stringify(n,null,2)}})}return o}(o,l);return _().createAndCommit({userAction:"prototypeBuilderRegistryActions.upsertWorkflowTemplatesToPrototypeBuilderRegistry",environment:t,canUndo:!0,perform:e=>C({environment:t,collectionInfo:n,transaction:e,rows:r})})}function N(e){let{rows:t}=e;const o=function(e){const{collectionInfo:t,errors:o}=e,n=[];for(const r of e.rows)if(r.JSON)try{const e=JSON.parse(r.JSON);n.push({collectionRowId:r._id,template:e})}catch(l){if(!(l instanceof Error))throw l;o.push({id:r._id,error:l})}return{collectionInfo:t,errors:o,templatesWithRowIds:n,templateToRowIdMap:$(n)}}(t);o.errors.length>0&&console.warn("Errors loading prototype workflow template builder registry:",o.errors),S().Z.setState(o)}function $(e){const t=new Map;for(const o of e){const e=o.template.templateId,n=o.collectionRowId;t.has(e)&&console.warn(`Duplicate definition for template id "${e}" found.`,o.template),t.set(e,n)}return t}var F=()=>o(124199);F().object({required:{_id:F().string()},optional:{Name:F().string(),JSON:F().string()}});var B=()=>o(749826);function R(){return(0,a().VK)((()=>E?E.getState():B().default.getConfigKey("workflow_templates_builder_config","prototype_registry_view_url")),[])}const E=void 0;(0,o(947115).exposeDebugValue)("WorkflowTemplatesBuilderLocalRegistryViewUrlStore",E);var W=o(785893);function P(){const e=R();return e?(0,W.jsx)(U,{viewUrl:e}):null}function U(e){const{viewUrl:t}=e,o=M();return(0,n.useEffect)((()=>{o.value&&N({rows:o.value})}),[o]),null}function K(e,t){var o;switch(t.type){case"reset":return D;case"setUrl":return{...D,url:t.url};case"setMultiCollectionPageUrl":return{...D,multiCollectionPageUrl:t.url};case"setCreateCopy":return{...e,createCopy:t.createCopy};case"addNewCompoundTemplate":return{...e,newCompoundTemplates:[...e.newCompoundTemplates??[],{id:(0,i().ZP)(),initialName:t.initialName}]};case"setFeatureOrdering":return{...e,featureOrdering:t.featureOrdering};case"updateBuilderSettings":return{...e,builderSettings:{...e.builderSettings,[t.key]:{...null===(o=e.builderSettings)||void 0===o?void 0:o[t.key],[t.property]:t.value}}}}}const D={url:"",multiCollectionPageUrl:"",createCopy:!1};o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(653476),o(30005);var L=()=>o(353329),A=()=>o(827370),J=()=>o(788860),q=()=>o(696459),Z=()=>o(326966),z=()=>o(709344),Y=()=>o(491585),G=()=>o(281236),Q=()=>o(382474),X=()=>o(342266);var H=()=>o(209737),ee=()=>o(29488),te=()=>o(494616),oe=()=>o(527278);const ne=3;o(916054);var le=()=>o(235484),re=()=>o(396136),ae=()=>o(872308);function ie(e){const{spaceId:t,collectionInfo:o,collectionStore:l,instanceMap:i}=e,s=(0,r().O7)(),p=(0,a().VK)((()=>{if(t&&null!=o&&o.pageTemplateIds&&l)return o.pageTemplateIds.map((e=>T().G.createChildStore(l,{table:re().iU,id:e})))}),[null==o?void 0:o.pageTemplateIds,l,t]),c=(0,a().VK)((()=>!!p&&p.every((e=>se(e)))),[p]),d=(0,a().VK)((()=>{if(!(t&&p&&o&&i&&c))return;return p.map((e=>{const t=ae().loadLocalSubtree(s,{blockId:e.id,inMemoryRecordCache:e.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!0,skipTransclusionContainerChildren:!1,allowCopyExternalObjectInstances:!0,includeLegacyTransclusionBlockValues:!1,excludeCrdtData:!0}),n=(0,I().QaF)(e.getTitleValue());if("error"===t.type)return{type:"error",error:`For page template "${n}", loadLocalSubtree returned "${t.reason}" for ${t.pointer.table} ${t.pointer.id}.`};const{recordMap:l}=t;for(const o of l.getModelsByTable(re().iU))if(o.isExternalObjectInstanceType()){const e=o.getFormat();if(!e.is_placeholder)return{type:"error",error:`For page template "${n}", external object instance ${o.id} is not a placeholder.`};if(!(0,le().BP)({integrationId:e.integration_id}))return{type:"error",error:`For page template "${n}", external object instance ${o.id} is not a Notion-owned integration.`}}for(const{model:o}of t.recordMap)null==o||o.__IM_SORRY__getValue();const r=(0,H().QN)({collectionInfo:o,pageStore:e,recordMap:l,instanceMap:i});return r?{type:"success",blockInfo:r}:{type:"error",error:`For page template "${n}", getBlockInfo returned undefined.`}}))}),[t,p,o,i,c,s]);return(0,n.useMemo)((()=>{if(!d)return{infos:void 0,errors:[]};const e=[],t=[];for(const o of d)"success"===o.type?e.push(o.blockInfo):t.push(o.error);return t.length>0?{infos:void 0,errors:t}:{infos:e,errors:t}}),[d])}function se(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e.isReady())return!1;if(t[e.id])return!0;t[e.id]=!0;const o=[];if(e instanceof T().G){o.push(...e.getContentStores()),o.push(...e.getNonContentChildrenStores()),o.push(...e.getCollectionViewStores());const t=e.getCollectionStore();t&&o.push(t);const n=e.getTransclusionReferenceTargetStore();n&&o.push(n)}else e instanceof T().Xr||e instanceof T().NW||(0,q().t1)(e);return o.every((e=>se(e,!1,t)))}const pe=(0,n.createContext)(null);function ce(){const e=(0,n.useContext)(pe);if(!e)throw new Error("Persisted context not found");return e}function de(e){var t,o,l,i,s;let c,d;const{state:I,dispatch:b,allIcons:w,requireTemplateInstance:x,templateRegistryMap:C,templateProvider:k}=e,M=(0,r().O7)(),O=function(e){const t=(0,j().parseRoute)({url:e,isMobile:!1,baseUrl:p().default.domainBaseUrl,publicDomainName:p().default.publicDomainName,protocol:p().default.protocol,currentUrl:void 0});if("page"===t.name&&t.blockId)return{blockId:t.blockId}}((null==I?void 0:I.url)??""),_=null==O?void 0:O.blockId;O||(c??="Invalid collection URL");const S=(0,a().VK)((()=>_?function(e){const{environment:t,collectionViewBlockId:o}=e,n=new(T().G)(t,{table:"block",id:o});if(!n.isReady())return{type:"loading"};if(!n.getModel())return{type:"error",message:"Inaccessible collection view block"};if(!n.isCollectionView())return{type:"error",message:"Block is not a collection view block/page"};const l=n.getCollectionStore();return null!=l&&l.isReady()?l.getModel()?{type:"success",collectionViewBlockStore:n,collectionStore:l,spaceId:l.getSpaceId()}:{type:"error",message:"Inaccessible collection"}:{type:"loading"}}({collectionViewBlockId:_,environment:M}):{type:"loading"}),[_,M]);let V;switch(S.type){case"error":c??=S.message;break;case"loading":d??="Loading collection";break;case"success":V=S;break;default:(0,q().t1)(S)}const N=null===(t=V)||void 0===t?void 0:t.spaceId,$=null===(o=V)||void 0===o?void 0:o.collectionStore.id,F=null===(l=V)||void 0===l?void 0:l.collectionStore,B=(0,a().VK)((()=>{if(!F)return;const e=(0,Y().loadWorkflowTemplateInstances)(F);return e.isLoading?{status:"pending"}:{status:"resolved",value:{[`collection:${F.id}`]:(0,Q().Wv)(e.instances)}}}),[F]),R=(0,n.useMemo)((()=>{if(null!=B&&B.value)return function(e,t){const o={};for(const n of(0,Z().XP)(e)){const l=e[n];o[n]=(0,Q().ej)(l,t)}return o}(B.value,k)}),[null==B?void 0:B.value,k]),E=null===(i=V)||void 0===i?void 0:i.collectionViewBlockStore;let W=(0,a().VK)((()=>{if(E&&F&&R)return(0,H().SX)({collectionViewBlockStore:E,collectionStore:F,instanceMap:R})}),[F,E,R]);W||(d??="Loading collection dependencies");const P=function(e,t){const o=(0,r().O7)(),l=null==e?void 0:e.id,a=null==e?void 0:e.firstTableViewId,i="collection_group_results",[s,p]=(0,n.useState)(0);(0,n.useEffect)((()=>{if(!l)return;const e=new(h().E)(o,(0,f().jY)(l),(()=>{p((e=>e+1))}));return e.subscribe(),()=>{e.unsubscribe()}}),[l,o]);const c=(0,u().Kt)(s,250,Object.is),[d]=(0,m().r5)((async()=>{if(!a||!l||!t)return;const e=await v().callApi({eventName:"queryCollection",environment:o,data:{collectionView:{spaceId:t,id:a},source:{type:"collection",id:l,spaceId:t},loader:{filter:{operator:"or",filters:void 0},reducers:{[i]:{type:"results",limit:ne}},searchQuery:"",sort:[],userId:o.currentUser.id,userTimeZone:(0,y().r)()}}}),n=[];if("success"===e.type){const t=e.data.result.reducerResults[i];if("results"===t.type){const{blockIds:o}=t,l=g().RecordMapWithRole.create(e.data.recordMap);for(const e of o){const t=l.getModel({table:"block",id:e});t&&n.push({properties:t.getProperties(),icon:t.getFormat().page_icon})}}}return n}),[l,c,o,a,t]);return d.value}(W,N);P||(d??="Loading example rows"),x&&W&&!W.templateId&&(c=`Collection "${W.name}" is not an instance of a workflow template`,W=void 0);const{infos:U,errors:K}=function(e){const{spaceId:t,collectionInfo:o,collectionStore:n,instanceMap:l}=e;return(0,a().VK)((()=>{if(!(t&&o&&n&&l))return{infos:void 0,errors:[]};const e=[];for(const n of o.properties)"button"===n.schema.type&&n.schema.automation_id&&e.push({table:te().cv,id:n.schema.automation_id,spaceId:t});e.push(...o.automationPointers);const r=[],a=[],i=[];for(const s of e){const e=T().Mz.createChildStore(n,s);if(!e||!e.isDefined()){a.push(`Loading automation ${s.id}...`);continue}const i=(0,ee().O)({table:"collection",id:o.id}),p=l[i]??{},c=e.getNameWithDefault(oe().Z.getIntl()),d=e.getModel(),u=[];for(const t of e.getActionStores())t.isDefined()?u.push(t.getModel()):a.push(`Loading action ${t.id}...`);r.push({type:"automation",id:s.id,templateId:(0,H().E6)(p,"automation",e.id),spaceId:t,name:c,referrerName:(0,X()._A)(c),automationModel:d,automationActionModels:u})}return a.length>0||i.length>0?{infos:void 0,errors:i}:{infos:r,errors:i}}),[o,n,l,t])}({spaceId:N,collectionInfo:W,collectionStore:F,instanceMap:R});U||(d??="Loading automations");const{infos:D,errors:z}=ie({spaceId:N,collectionInfo:W,collectionStore:F,instanceMap:R});D||(d??="Loading page templates");const le=(0,n.useMemo)((()=>{var e;const t=null===(e=W)||void 0===e?void 0:e.templateId;if(!t)return;const o=C.get(t);return"collection"===(null==o?void 0:o.type)?o:void 0}),[null===(s=W)||void 0===s?void 0:s.templateId,C]),re=(0,n.useMemo)((()=>{if(!le||!W)return[];return(0,L().Js)(le).map((e=>{const t=C.get(e);if("compound"===(null==t?void 0:t.type))return t})).filter(q().$K)}),[W,le,C]),ae=(0,n.useMemo)((()=>{var e;return[...re.map((e=>({type:"compound",id:e.templateId,name:e.name,templateId:e.templateId}))),...(null===(e=I.newCompoundTemplates)||void 0===e?void 0:e.map((e=>({type:"compound",id:e.id,name:e.initialName,templateId:void 0}))))??[]]}),[re,I.newCompoundTemplates]),{uninstantiatedFeatures:se,instantiatedFeatures:pe}=(0,n.useMemo)((()=>{if(!W||!U||!D)return{instantiatedFeatures:[],uninstantiatedFeatures:[]};const e=[...W.properties,...W.collectionViews,...ae,...D,...U,W.layout].filter(q().$K);if(!le)return{instantiatedFeatures:e,uninstantiatedFeatures:[]};const t=new Set(e.map((e=>e.templateId)).filter(q().$K));return{instantiatedFeatures:e,uninstantiatedFeatures:(0,L().Js)(le).filter((e=>!t.has(e))).map((e=>{const t=C.get(e);if(t)return{type:"uninstantiated_template",id:t.templateId,templateId:t.templateId,name:(0,G().getWorkflowTemplateName)(t)}})).filter(q().$K)}}),[U,W,ae,D,le,C]),ce=(0,n.useMemo)((()=>[...pe,...se]),[pe,se]),de=(0,n.useMemo)((()=>{const e=new Map;return W?([W,...ce].forEach((t=>{t.templateId&&e.set(t.templateId,(0,X().dO)(t))})),e):e}),[ce,W]),ue=(0,n.useMemo)((()=>{const e=new Map;return W&&D?([W,...ce,...D].forEach((t=>{e.set((0,X().dO)(t),t)})),e):e}),[ce,W,D]),me=(0,n.useMemo)((()=>{if(!W)return[];const e=ce.map((e=>(0,X().dO)(e))),t=new Set(e),o=(le?(0,L().Js)(le):[]).map((e=>de.get(e))).filter(q().$K),n=(0,Z().jj)(I.featureOrdering??[]).filter((e=>t.has(e))),l=new Set(n),r=W.tableOrderPropertyIds.map((e=>{const t=(0,X().dO)({type:"property",id:e});if(ue.has(t))return t})).filter(q().$K),a=e=>{for(const t of e)l.has(t)||(n.push(t),l.add(t))};return a(o),a(r),a(e),n}),[ce,W,ue,le,I.featureOrdering,de]),fe=(0,n.useMemo)((()=>null!=E&&E.pointer&&N?{...null==E?void 0:E.pointer,spaceId:N}:void 0),[null==E?void 0:E.pointer,N]);"en-US"!==(0,J().YB)().locale&&(c??="You must be on the English locale to use the builder.");return(0,n.useMemo)((()=>{if(!c&&W&&fe&&F&&U&&D){var e;return{type:"loaded",context:{state:I,dispatch:b,templateRegistryMap:C,templateProvider:k,templateIdToBuilderKeyMap:de,featureInfoMap:ue,collectionInfo:W,sourceCollectionTemplate:le,isOriginalSourceCollectionViewBlock:Boolean(le&&(null===(e=le.builderMetadata)||void 0===e?void 0:e.sourceCollectionViewBlock)&&A().dr.isEqual(le.builderMetadata.sourceCollectionViewBlock,fe)),exampleRows:P,compoundTemplateInfos:ae,collectionStore:F,featureOrdering:me,uninstantiatedFeatures:se,allIcons:w,pageTemplatesInfos:D,pageTemplatesErrors:z,automationInfos:U,automationErrors:K,sourceCollectionViewBlockPointer:fe}}}return null!=I&&I.url?c?{type:"error",message:c,collectionId:$,collectionViewBlockId:_}:{type:"loading",message:d,collectionId:$,collectionViewBlockId:_}:{type:"emptyInput"}}),[W,fe,F,U,D,I,c,d,$,_,b,C,k,de,ue,le,P,ae,me,se,w,z,K])}pe.displayName="BuilderContext";var ue=()=>o(780741);function me(){const e=(0,J().YB)(),t=(0,a().VK)((()=>{var t;const o=(null===(t=S().Z.state)||void 0===t?void 0:t.templatesWithRowIds.map((e=>e.template)))??[],n=(0,ue().i1)(e,{localizeTemplates:!1,includeNextTemplates:!0}),l=new Map;for(const e of n)l.set(e.templateId,e);for(const e of o)l.set(e.templateId,e);return l}),[e]),o=(0,n.useMemo)((()=>new(L().ni)((e=>{const o=t.get(e);if(!o)throw new Error(`Template not found in builder context: "${e}"`);return o}))),[t]);return(0,n.useMemo)((()=>({templateRegistryMap:t,templateProvider:o})),[o,t])}var fe=()=>o(773779),he=()=>o(119891);function ye(e){const{builderContext:t,item:o}=e;if("property"===o.type&&!o.isSupported)return{type:"ignore",reason:"unsupported_property_type"};const n=(0,X().W3)(t,o);if(n.ignore)return{type:"ignore",reason:"ignore_checkbox_is_checked"};if("uninstantiated_template"===o.type)return n.isDeleted?{type:"ignore",reason:"deleted"}:{type:"mapToTemplateId",templateId:o.templateId,includeInCollectionTemplate:!0};const l=n.templateId??"";return l?n.isDeleted?{type:"ignore",reason:"deleted"}:t.state.createCopy&&!n.bypassCreateCopy&&t.templateRegistryMap.has(l)?{type:"invalidCopyName"}:n.shouldMapToTemplate?{type:"mapToTemplateId",templateId:l,includeInCollectionTemplate:n.includeInCollectionTemplate}:{type:"createOrUpdateTemplate",templateId:l,includeInCollectionTemplate:n.includeInCollectionTemplate}:{type:"ignore",reason:"empty_template_id"}}o(470928);var ge=o.n(o(467266)),Ie=()=>o(926931),ve=o.n(o(369282)),be=()=>o(783540),we=()=>o(890085),xe=()=>o(191234);function Te(e){return"select"===e.type||"multi_select"===e.type}function je(e){const{templateId:t,validatorName:o,validatorTestName:n,message:l}=e;return`${[t,o,n].filter(q().$K).join(" -> ")}: ${l}`}class Ce{constructor(e){this.templates=void 0,this.templatesRegistry=new Map,this.validators=[],this.currentTemplateId=void 0,this.currentValidatorName=void 0,this.currentValidatorTestName=void 0,this.errors=[],this.templates=e.templatesToValidate;const t=[...e.templatesToValidate,...e.templatesRegistry??[]];for(const o of t)this.templatesRegistry.has(o.templateId)||this.templatesRegistry.set(o.templateId,o)}getWorkflowTemplateFromId(e){const t=this.templatesRegistry.get(e);return ve().ok(t,`Template "${e}" must exist`),t}ensureTemplateIdType(e,t){if(this.getWorkflowTemplateFromId(e).type!==t)throw new Error(`Template "${e}" is not of type "${t}"`)}logInvalidTemplateIds(e){for(const t of e??[])this.templatesRegistry.has(t)||this.log("error",`Template id "${t}" does not exist`)}captureExceptions(e,t){try{t()}catch(o){if(o instanceof Error)return void this.log(e,o.message);throw o}}test(e,t){this.testWithLevel("error",e,t)}testWarning(e,t){this.testWithLevel("warning",e,t)}testWithLevel(e,t,o){if(!this.currentTemplateId||!this.currentValidatorName)throw new Error("This method should only be run from a validator");this.currentValidatorTestName=t,this.captureExceptions(e,o),this.currentValidatorTestName=void 0}log(e,t){if(!this.currentTemplateId||!this.currentValidatorName)throw new Error("This method should only be run from a validator");this.errors.push({level:e,templateId:this.currentTemplateId,validatorName:this.currentValidatorName,validatorTestName:this.currentValidatorTestName,message:t})}addValidator(e,t){this.validators.push({name:e,validator:t})}run(){for(const e of this.templates){this.currentTemplateId=e.templateId;for(const{name:t,validator:o}of this.validators)this.currentValidatorName=t,this.captureExceptions("error",(()=>o(this,e))),this.currentValidatorName=void 0;this.currentTemplateId=void 0}}}function ke(e){const t=new(be().G)((()=>0));for(const n of e){const e=t.get(n);t.set(n,e+1)}const o=[];for(const[n,l]of t.entries())l>1&&o.push(`${n} (${l})`);if(o.length>0)throw new Error(`Duplicates found: ${o.join(", ")}`)}var Me=()=>o(513670),Oe=()=>o(43093);function _e(e){const{builderContext:t,item:o}=e,n=ye({builderContext:t,item:o});if(!n.templateId)return;const{templateId:l}=n;if(o.templateId===l)return;const r=function(e,t){switch(e.type){case"uninstantiated_template":case"compound":return;case"collection":return{type:"collection",id:e.id};case"collection_view":return{type:"collection_view",id:e.id};case"layout":return{type:"layout",id:e.id,spaceId:e.spaceId};case"property":return{type:"property",id:e.id,collectionId:t.id};case"block":return{type:"block",id:e.id,spaceId:e.spaceId};case"automation":return{type:"automation",id:e.id,spaceId:e.spaceId};default:(0,q().t1)(e)}}(o,t.collectionInfo);if(!r)return;return(0,H().ic)(t.collectionInfo.templateIdToInstancePointersMap,r.type,r.id)?{type:"update",pointer:r,templateId:l}:{type:"create",pointer:r,templateId:l}}var Se=()=>o(764052),Ve=()=>o(177634),Ne=()=>o(752778),$e=()=>o(139978);function Fe(e){let{schema:t,collectionViewType:o,primitiveFormat:n}=e;const l={collection_view_icon:n.collection_view_icon,collection_group_by:n.collection_group_by,collection_groups:Be(n.collection_groups),property_filters:n.property_filters,collection_group_aggregation:n.collection_group_aggregation,hide_linked_collection_name:n.hide_linked_collection_name,collection_peek_mode:n.collection_peek_mode,description:n.description,show_page_icon:n.show_page_icon,collection_view_default_template:n.collection_view_default_template};for(const[a,i]of Object.entries(n))a.startsWith(o)&&(a.endsWith("_properties")&&Array.isArray(i)?l[a]=(r=i,r.filter((e=>!1!==e.visible))).filter((e=>Boolean(t[null==e?void 0:e.property]))):l[a]=i);var r;return l}function Be(e){if(e&&e.length>0)return e}function Re(e){var t;let{collectionViewTemplateValue:o,mapper:n}=e;const l={};var r;"object"==typeof(null===(t=o.format)||void 0===t?void 0:t.collection_view_default_template)&&n.populateDependencyMap((0,X().dO)({type:"block",id:null===(r=o.format)||void 0===r?void 0:r.collection_view_default_template.template_page_id}),l);(0,L().DY)({object:o,callback:e=>{const t=e.property;n.populateDependencyMap((0,X().dO)({type:"property",id:t}),l)}});const{query2:a}=o;if(a)for(const i of L().py){const e=a[i];e&&n.populateDependencyMap((0,X().dO)({type:"property",id:e}),l)}return l}var Ee=()=>o(894759);const We="__self__";function Pe(e){const{collectionInfo:t,compoundTemplateInfos:o,pageTemplatesInfos:n,automationInfos:l}=e,r={templateOutputs:[],instanceActions:[],errors:[],warnings:[],debugMessages:[],counts:{new:0,changed:0,unchanged:0},hasNewOrChangedTemplates:!1,fakeLocalizedTemplates:void 0},a=new Map;for(const[f,h]of e.featureInfoMap.entries()){const t=ye({builderContext:e,item:h});t.templateId&&a.set(f,t.templateId)}let i;for(const f of t.collectionViews)f.isFirstTableView&&(i=f);for(const f of t.properties){const o=ye({builderContext:e,item:f});"createOrUpdateTemplate"===o.type&&Ue({builderContext:e,propertyInfo:f,templateId:o.templateId,collectionInfo:t,builderKeyToTemplateIdMap:a,firstTableViewInfo:i,output:r})}for(const f of t.collectionViews){const t=ye({builderContext:e,item:f});"createOrUpdateTemplate"===t.type&&Ke({builderContext:e,collectionViewInfo:f,templateId:t.templateId,builderKeyToTemplateIdMap:a,output:r})}for(const f of n){const t=ye({builderContext:e,item:f});"createOrUpdateTemplate"===t.type&&Le({builderContext:e,blockInfo:f,builderKeyToTemplateIdMap:a,templateId:t.templateId,output:r})}for(const f of l){const t=ye({builderContext:e,item:f});"createOrUpdateTemplate"===t.type&&De({builderContext:e,automationInfo:f,builderKeyToTemplateIdMap:a,templateId:t.templateId,output:r})}for(const f of o){const t=ye({builderContext:e,item:f});"createOrUpdateTemplate"===t.type&&Ae({builderContext:e,compoundTemplateInfo:f,templateId:t.templateId,output:r})}const s=t.layout;if(s){const t=ye({builderContext:e,item:s});"createOrUpdateTemplate"===t.type&&function(e){const{builderContext:t,layoutInfo:o,templateId:n,output:l,builderKeyToTemplateIdMap:r}=e,a={},i=new qe(n,r,t.featureInfoMap,l),s=(0,Oe().ZW)(o.layout);for(const d of s)i.populateDependencyMap(d,a);const p=(0,X().W3)(t,o),c={templateId:n,type:"layout",name:p.name,value:o.layout,dependencyMap:a};Je(t,l,c,o)}({builderContext:e,layoutInfo:s,templateId:t.templateId,builderKeyToTemplateIdMap:a,output:r})}const p=ye({builderContext:e,item:t});"createOrUpdateTemplate"===p.type&&function(e){const{builderContext:t,collectionInfo:o,builderKeyToTemplateIdMap:n,templateId:l,output:r}=e,a=(0,X().W3)(t,o),i=t.featureOrdering.map((e=>{const o=t.featureInfoMap.get(e);if(!o)return;const n=ye({builderContext:t,item:o});return"ignore"!==n.type&&"invalidCopyName"!==n.type&&n.includeInCollectionTemplate?{item:o,settings:(0,X().W3)(t,o),templateId:n.templateId}:void 0})).filter(q().$K),s=o.format?{collection_default_template:o.format.collection_default_template,item_name_config_v2:o.format.item_name_config_v2}:void 0,p={},c=new qe(l,n,t.featureInfoMap,r);"object"==typeof(null==s?void 0:s.collection_default_template)&&c.populateDependencyMap((0,X().dO)({type:"block",id:s.collection_default_template.template_page_id}),p);for(const u of t.exampleRows??[])for(const e in u.properties)c.populateDependencyMap((0,X().dO)({type:"property",id:e}),p);const d={type:"collection",description:a.description||o.descriptionAsString,category:(0,X().su)(a.category),value:{targetCollection:{name:o.name,icon:o.icon??X().ZM,description:o.description,itemName:{singular:a.singularItemName,plural:a.pluralItemName},format:s},exampleRows:t.exampleRows,templateItems:i.map((e=>({pointer:e.templateId,optionality:e.settings.optionality,isInSettings:!!e.settings.isInSettings||void 0}))),onboarding:{isMinimal:a.hasMinimalOnboarding}},templateId:l,dependencyMap:p,builderMetadata:{env:"production",sourceCollectionViewBlock:t.sourceCollectionViewBlockPointer,sourceFirstTableViewId:o.firstTableViewId}};Je(t,r,d,o)}({builderContext:e,collectionInfo:t,builderKeyToTemplateIdMap:a,templateId:p.templateId,output:r});const c=r.templateOutputs.map((e=>e.template)),d=(0,J().dp)({locale:"fr",defaultLocale:"en-US",messages:{}});try{r.fakeLocalizedTemplates=(0,Ie().Uo)({},d,c,{shouldFakeLocalization:!0,strict:!1})}catch(m){if(!(m instanceof Error))throw m;r.warnings.push(`Some content may need engineering support to be made localizable: ${m.message}`)}const u=function(e){const t=new Ce(e);return t.addValidator("template contains no template instance metadata",((e,t)=>{const o=["workflow_template_instance","compound_workflow_template_instances"],n=JSON.stringify(t);for(const l of o)n.includes(l)&&e.log("warning",`Template JSON contains "${l}"--are we properly removing instance metadata from our primitives?`)})),t.addValidator("dependency map",((e,t)=>{"dependencyMap"in t&&(e.test("contains valid template IDs",(()=>{e.logInvalidTemplateIds(Object.values(t.dependencyMap??{}))})),e.test("is declared on templates with dependencies",(()=>{"collection_view"!==t.type&&"layout"!==t.type||ve().ok(void 0!==t.dependencyMap)})))})),t.addValidator("property template is valid",((e,t)=>{"property"===t.type&&(e.test("relationCollectionTemplateId is only set for relation property template",(()=>{ve().equal(void 0!==t.relatedCollectionTemplateId,"relation"===t.value.type),t.relatedCollectionTemplateId&&e.ensureTemplateIdType(t.relatedCollectionTemplateId,"collection")})),e.test("buttonAutomationId is only set for button property template",(()=>{ve().equal(void 0!==t.buttonAutomationId,"button"===t.value.type),t.buttonAutomationId&&e.ensureTemplateIdType(t.buttonAutomationId,"automation")})),e.test("propertyOptionsType is set correctly",(()=>{ve().equal(void 0!==t.propertyOptionsType,Te(t.value))})))})),t.addValidator("compound template is valid",((e,t)=>{"compound"===t.type&&(e.test("contains valid templates",(()=>{for(const o of t.value.templateItems){const t=e.getWorkflowTemplateFromId(o.pointer);ve().ok((0,L().qu)(t))}})),e.test("contains two or more templates",(()=>{const e=t.value.templateItems.length;ve().ok(e>=2)})),e.test("has notion static icon",(()=>{ve().ok((0,we().V2)(t.icon))})),e.test("has no duplicate template IDs",(()=>{ke(t.value.templateItems.map((e=>e.pointer)))})),e.test("contains all its dependencies",(()=>{for(const o of t.value.templateItems){const n=e.getWorkflowTemplateFromId(o.pointer);if((0,L().qu)(n)){const l=(0,L().EL)({template:n});for(const n of l){if("collection"===e.getWorkflowTemplateFromId(n.templateId).type)continue;const l=t.value.templateItems.find((e=>e.pointer===n.templateId));l||e.log("warning",`Compound template has explicit dependency "${o.pointer}", which depends on "${n.templateId}" (via ${n.debugSource}). However, the latter is not part of the compound template--it should be!`)}}}})))})),t.addValidator("collection template is valid",((e,t)=>{if("collection"!==t.type)return;const o=(0,L().Js)(t),n=o.map((t=>e.getWorkflowTemplateFromId(t)));e.testWarning("has description",(()=>{ve().ok(t.description,"collection template should specify description so it'll look nice in suggestions & during onboarding")})),e.test("has valid templateItems",(()=>{for(const o of t.value.templateItems){const t=e.getWorkflowTemplateFromId(o.pointer);ve().ok(t,`No template found for ID ${o.pointer}`),ve().ok((0,L().Zl)(t),`${o.pointer} is not of FeatureTemplate type`),o.isInSettings&&(ve().ok((0,L().iI)(t),`${o.pointer} is not of FeatureTemplateInSettings type`),ve().ok("compound"!==t.type,"Compound template cannot have isInSettings set to true"))}})),e.test("has no duplicate templates across all available template IDs",(()=>{ke(o)})),e.test("doesn't have two or more relation properties pointing to the same collection preset",(()=>{ke(n.filter(L().yw).map((e=>e.relatedCollectionTemplateId)))})),e.test("has valid category",(()=>{t.category&&ve()(xe().Mz.includes(t.category))})),e.test("has notion static icon",(()=>{ve().ok((0,we().V2)(t.value.targetCollection.icon))}));const l=t.value.templateItems.map((t=>({template:e.getWorkflowTemplateFromId(t.pointer),templateItem:t})));e.test("has at most one title property template, which is required",(()=>{const e=l.filter((e=>"property"===e.template.type&&"title"===e.template.value.type));ve().ok(e.length<=1),1===e.length&&ve().ok("required"===e[0].templateItem.optionality)})),e.test("contains at least 1 collection_view template that is set to either optionalDefaultOn or required",(()=>{if((0,L().Wl)(t.templateId))return;const o=t.value.templateItems.filter((t=>"collection_view"===e.getWorkflowTemplateFromId(t.pointer).type)).filter((e=>"required"===e.optionality||"optionalDefaultOn"===e.optionality));ve().ok(o.length>0)}))})),t.run(),t.errors}({templatesToValidate:r.templateOutputs.map((e=>e.template)),templatesRegistry:Array.from(e.templateRegistryMap.values())});for(const f of u){const e=je(f);"error"===f.level?r.errors.push(e):"warning"===f.level?r.warnings.push(e):(0,q().t1)(f.level)}for(const f of r.templateOutputs){const{templateId:e}=f.template;"unchanged"!==f.type&&ue().lT.has(e)&&r.errors.push(`"${e}" is a built-in system template and can't be changed! Consider changing its template id so a new template is created.`)}return r.instanceActions.push(...function(e){const t=[];for(const o of e.featureInfoMap.values()){const n=_e({builderContext:e,item:o});n&&t.push(n)}return t}(e)),r}function Ue(e){const{builderContext:t,templateId:o,propertyInfo:n,firstTableViewInfo:l,collectionInfo:r,builderKeyToTemplateIdMap:a,output:i}=e,s=(0,X().W3)(t,n);let p=s.relatedCollectionTemplateId;if(p===We){const e=ye({builderContext:t,item:r});if(e.templateId)p=e.templateId;else{const e=`In property "${n.name}", unable to obtain template id for self-relation.`;i.errors.push(e),p=e}}const c=Ee().yc(n.schema);let d;if("button"===c.type){const{automation_id:e}=c;if(e){const o=t.featureInfoMap.get((0,X().dO)({type:"automation",id:e}));if(o){d=ye({builderContext:t,item:o}).templateId,delete c.automation_id}}if(!d){const e=`In property "${n.name}", unable to obtain template id for automation.`;i.errors.push(e),d=e}}const u={templateId:o,type:"property",value:c,relatedCollectionTemplateId:p,buttonAutomationId:d,propertyOptionsType:Te(c)?null==s?void 0:s.propertyOptionsType:void 0,dependencyMap:Ee().Du({propertyTemplateValue:c,mapper:new qe(o,a,t.featureInfoMap,i)})};"relation"!==n.schema.type&&Ee().kh({propertyId:n.id,propertyTemplate:u,firstTableViewInfo:l}),Je(t,i,u,n)}function Ke(e){const{builderContext:t,collectionViewInfo:o,templateId:n,builderKeyToTemplateIdMap:l,output:r}=e;if(!o.viewType)return void r.errors.push(`Collection "${o.name}" has no type.`);const a={type:o.viewType,name:o.name,format:Fe({schema:t.collectionInfo.schema,collectionViewType:o.viewType,primitiveFormat:o.format}),query2:o.query};Je(t,r,{templateId:n,type:"collection_view",value:a,dependencyMap:Re({collectionViewTemplateValue:a,mapper:new qe(n,l,t.featureInfoMap,r)})},o)}function De(e){const{builderContext:t,builderKeyToTemplateIdMap:o,automationInfo:n,templateId:l,output:r}=e,a={},i=new qe(l,o,t.featureInfoMap,r),s=new Set,c=new Map,{automationModel:d,builderKeys:u}=function(e){const t=new Set,{value:o}=(0,Se().R)({automationModel:e,visitors:{visitCollectionProperty:e=>(t.add((0,X().dO)({id:e,type:"property"})),{type:"keep"}),visitRecordPointer:e=>(e.table!==re().iU&&e.table!==Ne().vF&&e.table!==te().cv&&e.table!==$e().np||t.add((0,X().dO)({id:e.id,type:e.table})),{type:"keep"})}});return{automationModel:o,builderKeys:t}}(n.automationModel),m=d.getTrigger();u.forEach((e=>s.add(e)));const f=n.automationActionModels.map(((e,o)=>{const{automationActionModel:n,builderKeys:r}=function(e){const{actionIdToActionPlaceholderIdMap:t,automationActionModel:o,spaceId:n}=e,l=new Set;function r(e){const o=(0,Ve().MY)(e);if("action"===o.source){const e=t.get(o.action_id)??o.action_id;return(0,Ve().Kd)({...o,action_id:e})}if("global"===o.source)return e;(0,q().t1)(o)}const{value:a}=(0,Se().e)({automationActionModel:o,baseUrl:p().default.domainBaseUrl,preventClearingConfig:!0,publicDomainName:p().default.publicDomainName,sourceSpaceId:n,visitors:{visitCollectionProperty:e=>(l.add((0,X().dO)({id:e,type:"property"})),{type:"keep"}),visitCollectionPropertyPointer:e=>(l.add((0,X().dO)({id:e.propertyId,type:"property"})),l.add((0,X().dO)({id:e.id,type:"collection"})),{type:"keep"}),visitFormulaContextValue:e=>({type:"replace",value:r(e)}),visitFormulaPageProperty:e=>{if(l.add((0,X().dO)({id:e.property,type:"property"})),"collection"in e&&e.collection)l.add((0,X().dO)({id:e.collection.id,type:"collection"}));else if("contextValueId"in e&&e.contextValueId){const t=(0,Me().Xh)(e);return t.contextValueId=r(t.contextValueId),{type:"replace",value:t}}return{type:"keep"}},visitRecordPointer:e=>(e.table!==re().iU&&e.table!==Ne().vF&&e.table!==te().cv&&e.table!==$e().np||l.add((0,X().dO)({id:e.id,type:e.table})),{type:"keep"})}});return{automationActionModel:a,builderKeys:l}}({actionIdToActionPlaceholderIdMap:c,automationActionModel:e,spaceId:t.collectionStore.getSpaceId()});r.forEach((e=>s.add(e)));const a=function(e,t){const o=e.getType();return{type:o,config:e.getConfig(),placeholderId:`${t}:${o}`}}(n,`${l}:${o}`);return c.set(n.id,a.placeholderId),a}));for(const p of s)i.populateDependencyMap(p,a);const h={type:"automation",templateId:l,value:{actions:f,name:n.name,trigger:m},dependencyMap:a};return Je(t,r,h,n),h}function Le(e){var t;const{builderContext:o,builderKeyToTemplateIdMap:n,blockInfo:l,templateId:r,output:a}=e,i=(0,X().W3)(o,l),s={};!function(e){const{propertyIds:t,builderKeyToTemplateIdMap:o,output:n,dependencyMap:l}=e;for(const r of t){const e=o.get((0,X().dO)({type:"property",id:r}));e?l[`property:${r}`]=e:n.errors.push(`In template "${e}", unable to find mapping for property "${r}".`)}}({propertyIds:Array.from(l.propertyIds),dependencyMap:s,builderKeyToTemplateIdMap:n,output:a});const p=l.recordMap.toJson();if(!(0,g().isRecordMapJsonV3)(p))return void a.errors.push("recordMap.toJson() is not V3!");const c=null===(t=p.block)||void 0===t?void 0:t[l.id];var d,u;c&&"page"===c.value.type?null!==(d=c.value.format)&&void 0!==d&&d.workflow_template_instance&&(c.value=(0,Me().Xh)(c.value),null===(u=c.value.format)||void 0===u||delete u.workflow_template_instance):a.errors.push(`Page template "${r}" has no root block!`);const m={templateId:r,type:"block",description:i.description,value:{blockPointer:{table:re().iU,id:l.id,spaceId:o.collectionStore.getSpaceId()},recordMap:p},dependencyMap:s};Je(o,a,m,l)}function Ae(e){const{builderContext:t,compoundTemplateInfo:o,output:n,templateId:l}=e,r=(0,X().W3)(t,o);Je(t,n,{type:"compound",templateId:l,name:r.name,icon:r.icon,value:{templateItems:r.templateItems.map(((e,o)=>{if(!e.pointer)return void n.errors.push(`In "${l}", template item at index ${o} is undefined`);const r=t.featureInfoMap.get(e.pointer);if(!r)return void n.errors.push(`In "${l}", unable to resolve pointer "${e.pointer}"`);const a=ye({builderContext:t,item:r});if("createOrUpdateTemplate"===a.type||"mapToTemplateId"===a.type)return{pointer:a.templateId,optionality:e.optionality};n.errors.push(`In "${l}", builder action for "${e.pointer}" is "${a.type}"`)})).filter(q().$K)}},o)}function Je(e,t,o,n){const{templateId:l}=o,r=e.templateRegistryMap.get(l);if(r){const{version:e,copiedFrom:n,...l}=r,a=ge()(l,{space:"  "}),i=ge()(o,{space:"  "});if(a===i)t.counts.unchanged+=1,t.templateOutputs.push({type:"unchanged",template:{...o,version:e,copiedFrom:n}});else{const l=(e??0)+1;t.hasNewOrChangedTemplates=!0,t.counts.changed+=1,t.templateOutputs.push({type:"changed",newVersion:l,template:{...o,version:l,copiedFrom:n},originalTemplate:r,templateJson:i,originalTemplateJson:a})}}else t.hasNewOrChangedTemplates=!0,t.counts.new+=1,t.templateOutputs.push({type:"new",template:{...o,copiedFrom:e.state.createCopy?n.templateId:void 0}})}class qe{constructor(e,t,o,n){this.templateId=e,this.builderKeyToTemplateIdMap=t,this.featureInfoMap=o,this.output=n}map(e){const t=this.builderKeyToTemplateIdMap.get(e);return t||(this.output.errors.push(`In template "${this.templateId}", "${e}" has no template id mapping.`),`ðŸš¨TEMPLATE ID MAPPING NOT FOUND FOR "${e}"ðŸš¨`)}populateDependencyMap(e,t){if(e===X().WK)return void this.output.debugMessages.push(`"${e}" is a special property and will not be mapped to a template id.`);const o=this.featureInfoMap.get(e),n=this.map(e);o?"compound"!==o.type&&"uninstantiated_template"!==o.type?t[`${o.type}:${o.id}`]=n:this.output.errors.push(`"${e}" has invalid feature type: "${o.type}"`):this.output.errors.push(`"${e}" has no feature info`)}}var Ze=()=>o(533808);function ze(e){const{builderOutputWorld:{collectionTemplate:t,templateProvider:o}}=e,l=(0,a().VK)((()=>t?(0,Ze().se)(t,o):[]),[t,o]),r=(0,a().VK)((()=>null==t?void 0:t.value.templateItems.map((e=>(0,Ze().zh)(e.pointer,e.optionality,o)))),[null==t?void 0:t.value.templateItems,o]),i=(0,n.useMemo)((()=>(0,Ze().Uy)({collectionViewTemplates:l,featureTemplateSelections:r??[]})),[l,r]);return r&&0!==r.length?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(s().bU,{children:"Feature selection step preview"}),(0,W.jsx)("p",{children:"(Items with a gray background mean they are selected by default.)"}),(0,W.jsx)("ul",{children:i.map((e=>(0,W.jsx)("li",{style:{display:"inline-block",backgroundColor:e.selected?"lightgray":void 0,padding:4,margin:8},children:(0,G().getWorkflowTemplateName)(e.template)},e.template.templateId)))})]}):null}var Ye=()=>o(799891),Ge=()=>o(102182),Qe=()=>o(688745);function Xe(e){const{transaction:t,collectionStore:o,action:n,logger:l}=e;"create"===n.type||"update"===n.type?(0,Qe().cP)({transaction:t,collectionStore:o,templateId:n.templateId,instance:n.pointer,logger:l}):(0,q().t1)(n)}function He(e){const{builderOutput:t}=e,{collectionStore:o}=ce(),l=(0,r().O7)(),[a,i]=(0,n.useState)(!1),s=(0,n.useCallback)((()=>{const e=S().Z.state;if(!e)return void Ge().oV({label:"Workflow templates are not loaded!"});(0,Ye().log)({level:"info",from:"WorkflowTemplatesBuilder.InstallTemplatesButton",type:"install",data:{miscDataToConvertToString:t}}),i(!0);const{serverCommitResult:n,performResult:{created:r,updated:a}}=V({environment:l,collectionInfo:e.collectionInfo,templateToRowIdMap:e.templateToRowIdMap,templates:t.templateOutputs.filter((e=>"unchanged"!==e.type)).map((e=>e.template))}),{serverCommitResult:s}=function(e){const{environment:t,collectionStore:o,actions:n}=e,l=new(G().WorkflowTemplateLogger);return _().createAndCommit({userAction:"builderInstantiationActions.executeBuilderInstanceActions",environment:t,canUndo:!0,perform(e){for(const t of n)Xe({transaction:e,collectionStore:o,action:t,logger:l})}})}({environment:l,actions:t.instanceActions,collectionStore:o});Promise.all([n,s]).then((()=>{Ge().oV({label:`Created ${r} templates and updated ${a}.`})})).catch((e=>{console.error(e),Ge().oV({label:"Alas, an error occurred. See the console for details."})})).finally((()=>{i(!1)}))}),[l,t,o]),{counts:p}=t;return(0,W.jsxs)("button",{onClick:s,disabled:a,children:["Install templates to prototype registry (",p.new," new,"," ",p.changed," changed)"]})}function et(e){const{object:t}=e;return(0,W.jsx)("pre",{children:JSON.stringify(t,null,2)})}function tt(e){const{errors:t,label:o,type:n}=e;return(0,W.jsx)(ot,{messages:t,label:o,type:n||"error"})}function ot(e){const{messages:t,label:o,type:n}=e;return(0,W.jsxs)("div",{className:n,children:[o,(0,W.jsx)("ul",{children:t.map(((e,t)=>(0,W.jsx)("li",{children:e},t)))})]})}function nt(e){var t;const{label:o,color:n,value:l,onChange:r}=e,{allIcons:a}=ce(),i=(null===(t=(0,we().c)(l))||void 0===t?void 0:t.iconName)??"";return(0,W.jsxs)("div",{style:{display:"flex"},children:[(0,W.jsx)(c().QW,{label:o,value:i,onChange:e=>{r(`/icons/${e}_${n}.svg`)},options:a}),(0,W.jsx)("img",{src:l,style:{width:32,height:32},alt:i})]})}var lt=o.n(o(452027)),rt=()=>o(590058);function at(e){const{oldValue:t,newValue:o}=e,n=new(lt()),l=n.diff_linesToChars_(t,o),r=n.diff_main(l.chars1,l.chars2,!1);return n.diff_charsToLines_(r,l.lineArray),n.diff_cleanupSemantic(r),(0,W.jsx)("pre",{children:r.map(((e,t)=>{let o,[n,l]=e;return n===rt().NL?o="diff-delete":n===rt().D$&&(o="diff-insert"),(0,W.jsx)("span",{className:o,children:l},t)}))})}function it(e){var t;const{item:o,builderOutput:n}=e,l=ce(),{dispatch:r}=l,a=ye({builderContext:l,item:o}),i=(0,X().dO)(o),s=(0,X().W3)(l,o),p="collection"===o.type?o.descriptionAsString:void 0,d=(0,H().vg)(o);return(0,W.jsxs)("div",{children:["collection"!==o.type&&"compound"!==o.type&&"uninstantiated_template"!==o.type&&(0,W.jsx)(c().Wr,{label:"Do not instantiate a template for this primitive",value:s.ignore,onChange:e=>{r({type:"updateBuilderSettings",key:i,property:"ignore",value:e})}}),"uninstantiated_template"!==o.type&&"collection"!==o.type&&(0,W.jsx)(c().Wr,{label:"Map to existing template, do not update it",value:s.shouldMapToTemplate,onChange:e=>{r({type:"updateBuilderSettings",key:i,property:"shouldMapToTemplate",value:e})}}),!s.ignore&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(c().Wt,{label:"Template id",value:s.templateId??"",disabled:"uninstantiated_template"===o.type&&"mapToTemplateId"===a.type,onChange:e=>{r({type:"updateBuilderSettings",key:i,property:"templateId",value:e})}}),(0,W.jsx)(dt,{action:a,builderOutput:n,onUndelete:()=>{r({type:"updateBuilderSettings",key:i,property:"isDeleted",value:!1})}})]}),l.state.createCopy&&(0,W.jsx)(c().Wr,{label:"Bypass create copy (allow reuse of original template)",value:s.bypassCreateCopy,onChange:e=>{r({type:"updateBuilderSettings",key:i,property:"bypassCreateCopy",value:e})}}),"createOrUpdateTemplate"===a.type&&(0,W.jsxs)(W.Fragment,{children:["compound"===o.type||"layout"===o.type?(0,W.jsx)(c().Wt,{label:"Name",value:s.name,onChange:e=>{r({type:"updateBuilderSettings",key:i,property:"name",value:e})}}):void 0,"compound"===o.type&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(nt,{label:"Icon",color:"gray",value:s.icon,onChange:e=>r({type:"updateBuilderSettings",key:i,property:"icon",value:e})}),(0,W.jsxs)("ol",{children:[s.templateItems.map(((e,t)=>(0,W.jsxs)("li",{children:[(0,W.jsx)(st,{templateItem:e,onChange:e=>{var o,n,l;r({type:"updateBuilderSettings",key:i,property:"templateItems",value:(o=s.templateItems,n=e,l=t,o.map(((e,t)=>t===l?n:e)))})}}),(0,W.jsx)("button",{style:{marginBottom:4},onClick:()=>{var e,o;r({type:"updateBuilderSettings",key:i,property:"templateItems",value:(e=s.templateItems,o=t,e.filter(((e,t)=>t!==o)))})},children:"Delete compound template item"})]},t))),(0,W.jsx)("p",{children:(0,W.jsx)("button",{onClick:()=>{r({type:"updateBuilderSettings",key:i,property:"templateItems",value:[...s.templateItems,{pointer:void 0,optionality:"optionalDefaultOn"}]})},children:"Add compound template item"})}),(0,W.jsx)(ut,{templateItems:s.templateItems,onChange:e=>r({type:"updateBuilderSettings",key:i,property:"templateItems",value:e})})]})]}),"property"!==o.type&&"collection_view"!==o.type&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(c().Wt,{label:"Description",value:s.description??"",placeholder:p,onChange:e=>{r({type:"updateBuilderSettings",key:i,property:"description",value:e})}}),p&&s.description&&s.description!==p?(0,W.jsx)("aside",{children:"Leave this blank to fall back to the underlying primitive's description."}):null]}),"property"===o.type&&"relation"===o.schema.type&&(0,W.jsx)(pt,{label:"Related collection",value:s.relatedCollectionTemplateId,onChange:e=>r({type:"updateBuilderSettings",key:i,property:"relatedCollectionTemplateId",value:e})}),"collection"===o.type?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(c().EZ,{label:"Category",value:(0,X().su)(s.category),onChange:e=>{r({type:"updateBuilderSettings",key:i,property:"category",value:(0,X().PB)(e)})},options:xe().Mz}),null!==(t=o.format)&&void 0!==t&&t.item_name_config_v2?(0,W.jsx)("p",{children:"The collection specifies its own item name terminology. Cool, we will reuse that!"}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("p",{children:"The collection does not specify its own item name terminology. You can specify it below, but this is deprecated and support for it will be removed soon."}),(0,W.jsx)(c().Wt,{label:"Singular",value:s.singularItemName,onChange:e=>{r({type:"updateBuilderSettings",key:i,property:"singularItemName",value:e})}}),(0,W.jsx)(c().Wt,{label:"Plural",value:s.pluralItemName,onChange:e=>{r({type:"updateBuilderSettings",key:i,property:"pluralItemName",value:e})}})]}),(0,W.jsx)(c().Wr,{label:"Use minimal onboarding",value:s.hasMinimalOnboarding,onChange:e=>{r({type:"updateBuilderSettings",key:i,property:"hasMinimalOnboarding",value:e})}})]}):(0,W.jsxs)(W.Fragment,{children:["compound"!==o.type&&!d&&(0,W.jsx)(c().Wr,{label:"Include in collection template",value:s.includeInCollectionTemplate,onChange:e=>{r({type:"updateBuilderSettings",key:i,property:"includeInCollectionTemplate",value:e})}}),s.includeInCollectionTemplate&&!d&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(c().QW,{label:"Required",value:s.optionality,onChange:e=>{r({type:"updateBuilderSettings",key:i,property:"optionality",value:e})},options:mt,optionLabels:ft}),"compound"!==o.type&&(0,W.jsx)(c().Wr,{onChange:e=>r({type:"updateBuilderSettings",key:i,property:"isInSettings",value:e}),label:"Is pulled up to top of customize menu",value:s.isInSettings})]})]}),"property"===o.type&&Te(o.schema)&&(0,W.jsx)(c().QW,{label:"Property options type",value:s.propertyOptionsType,onChange:e=>{r({type:"updateBuilderSettings",key:i,property:"propertyOptionsType",value:e})},options:["sample","content"]})]}),("createOrUpdateTemplate"===a.type||"mapToTemplateId"===a.type)&&("compound"===o.type||"uninstantiated_template"===o.type)&&(0,W.jsx)("button",{onClick:()=>r({type:"updateBuilderSettings",key:i,property:"isDeleted",value:!0}),children:"Delete"})]})}function st(e){const{templateItem:t,onChange:o}=e;return(0,W.jsxs)("div",{children:[(0,W.jsx)(ct,{excludeTypes:["collection","compound"],value:t.pointer,onChange:e=>o({...t,pointer:e})}),(0,W.jsx)(c().QW,{label:"Required",value:t.optionality,onChange:e=>o({...t,optionality:e}),options:mt,optionLabels:ft})]})}function pt(e){const{label:t,value:o,onChange:l}=e,r=ce(),{options:a,optionLabels:i}=(0,n.useMemo)((()=>{const e=[We],t={[We]:"(self-relation)"};for(const o of r.templateRegistryMap.values())"collection"===o.type&&(e.push(o.templateId),t[o.templateId]=`${o.value.targetCollection.name} (${o.templateId})`);return{options:e,optionLabels:t}}),[r.templateRegistryMap]);return(0,W.jsx)(c().EZ,{label:t,value:o,onChange:l,options:a,optionLabels:i})}function ct(e){const t=ce(),{value:o,onChange:n,excludeTypes:l}=e,r=new Set(l),a={},i=[];for(const[s,p]of t.featureInfoMap.entries())r.has(p.type)||(i.push(s),a[s]=(0,X().Zt)(t,p));return(0,W.jsx)(c().EZ,{label:"Template",value:o,onChange:n,options:i,optionLabels:a})}function dt(e){const{action:t,builderOutput:o,onUndelete:n}=e;switch(t.type){case"mapToTemplateId":return(0,W.jsxs)("aside",{children:["This will be mapped to the ",(0,W.jsx)("code",{children:t.templateId})," template."]});case"createOrUpdateTemplate":const e=o.templateOutputs.find((e=>e.template.templateId===t.templateId));if(!e)return(0,W.jsx)("aside",{className:"error",children:"An error occurred when generating the new template."});switch(e.type){case"new":return(0,W.jsxs)("details",{children:[(0,W.jsx)("summary",{className:"success",children:"A new template will be created."}),(0,W.jsx)("p",{children:"Here's the new template's JSON:"}),(0,W.jsx)(at,{oldValue:"",newValue:JSON.stringify(e.template,null,2)})]});case"unchanged":return(0,W.jsxs)("details",{className:"superSubtle",children:[(0,W.jsx)("summary",{style:{color:"gray"},children:"This template has not been changed from its value in the registry."}),(0,W.jsx)("p",{children:"Here's the unchanged template's JSON:"}),(0,W.jsx)(et,{object:e.template})]});case"changed":return(0,W.jsxs)("details",{children:[(0,W.jsxs)("summary",{className:"success",children:["The existing template will be updated to version"," ",e.newVersion," (however, instances of the template will not be updated)."]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("p",{children:"The following changes will be made to the template in the registry:"}),(0,W.jsx)(at,{oldValue:e.originalTemplateJson,newValue:e.templateJson})]})]})}(0,q().t1)(e);break;case"ignore":return"deleted"===t.reason?(0,W.jsxs)("aside",{children:["This has been deleted and won't be included in any templates."," ",(0,W.jsx)("button",{onClick:n,children:"Undelete"})]}):(0,W.jsxs)("aside",{children:["This data will be ignored (reason: ",(0,W.jsx)("code",{children:t.reason}),")."]});case"invalidCopyName":return(0,W.jsx)("aside",{className:"error",children:"This id is already taken."})}}function ut(e){const{templateItems:t,onChange:o}=e,n=ce();return t.length<=1?null:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("aside",{children:"Drag-and-drop in the list below to re-order template items."}),(0,W.jsx)(he().ZP,{direction:"vertical",keys:t.map(((e,t)=>t.toString())),renderKey:e=>{const o=t[parseInt(e)].pointer,l=o?(0,X().Zt)(n,o):"(ERROR)";return(0,W.jsx)("div",{className:"draggableItem",children:l})},onDrop:e=>{o(e.map((e=>t[parseInt(e)])))}})]})}const mt=["required","optionalDefaultOn","optionalDefaultOff"],ft={optionalDefaultOn:"Optional (default on)",optionalDefaultOff:"Optional (default off)",required:"Required"};function ht(e){const{builderContextState:t,...o}=e;switch(t.type){case"loaded":return(0,W.jsx)(pe.Provider,{value:t.context,children:(0,W.jsx)(yt,{...o})});case"emptyInput":return null;case"error":return(0,W.jsx)("div",{className:"error",children:t.message});case"loading":return(0,W.jsxs)("p",{children:[(0,W.jsxs)("strong",{children:[t.message||"Loading","â€¦"]}),(0,W.jsx)("br",{}),"collection view block id:"," ",(0,W.jsx)("code",{children:t.collectionViewBlockId||"(unknown)"}),(0,W.jsx)("br",{}),"collection id:"," ",(0,W.jsx)("code",{children:t.collectionId||"(unknown)"})]})}(0,q().t1)(t)}function yt(e){var t;const{isCompact:o}=e,l=ce(),r=(0,a().VK)((()=>Pe(l)),[l]),i=(0,n.useMemo)((()=>l.featureOrdering.filter((e=>{const t=l.featureInfoMap.get(e);if(t){const e=ye({builderContext:l,item:t});return("createOrUpdateTemplate"===e.type||"mapToTemplateId"===e.type)&&e.includeInCollectionTemplate}return!1}))),[l]),p=(0,a().VK)((()=>null!==S().Z.state),[]),c=R(),d=r.warnings.length>0?(0,W.jsx)(tt,{errors:r.warnings,type:"warning",label:"Your templates have the following warnings. While you can save them to the registry, we won't be able to ship them to production until they're fixed:"}):null,u=r.hasNewOrChangedTemplates?(0,W.jsx)(He,{builderOutput:r}):(0,W.jsx)("aside",{children:"The template registry is up to date."}),{properties:m,collectionViews:f,compoundTemplateInfos:h,blockTemplateInfos:y,automationInfos:g,uninstantiatedTemplateInfos:I}=(0,n.useMemo)((()=>{const e=[],t=[],o=[],n=[],r=[],a=[];for(const i of l.featureOrdering){const s=l.featureInfoMap.get(i);if(s)switch(s.type){case"property":e.push(s);break;case"collection_view":t.push(s);break;case"compound":o.push(s);break;case"uninstantiated_template":a.push(s);break;case"collection":case"layout":break;case"block":n.push(s);break;case"automation":r.push(s);break;default:(0,q().t1)(s)}}return{properties:e,collectionViews:t,compoundTemplateInfos:o,blockTemplateInfos:n,automationInfos:r,uninstantiatedTemplateInfos:a}}),[l.featureInfoMap,l.featureOrdering]),v=Boolean(0===r.errors.length&&p&&c);let b=null,w=r.warnings.length;const x=null===(t=l.sourceCollectionTemplate)||void 0===t||null===(t=t.builderMetadata)||void 0===t?void 0:t.sourceCollectionViewBlock;x&&!l.isOriginalSourceCollectionViewBlock&&(b=(0,W.jsxs)("p",{className:"warning",children:["The template you're updating was created based on"," ",(0,W.jsx)("a",{href:(0,fe().ph)(x),children:"this collection"}),", which is different from the one you provided."]}),w+=1);const T=(0,n.useMemo)((()=>function(e,t){const o=e.templateOutputs.map((e=>e.template)),n=o.find((e=>"collection"===e.type));if(!n)return;return{collectionTemplate:n,templateProvider:new(L().ni)((e=>o.find((t=>t.templateId===e))||t.templateProvider.fromId(e)))}}(r,l)),[l,r]),j=(0,W.jsxs)(W.Fragment,{children:[b,(0,W.jsx)(gt,{sourceCollectionViewBlockURL:(0,fe().ph)(l.sourceCollectionViewBlockPointer),collectionInfo:l.collectionInfo,properties:m,collectionViews:f,builderOutput:r}),(0,W.jsx)(wt,{blockTemplateInfos:y,pageTemplatesErrors:l.pageTemplatesErrors,builderOutput:r}),(0,W.jsx)(bt,{automationInfos:g,automationErrors:l.automationErrors,builderOutput:r}),(0,W.jsx)(vt,{compoundTemplateInfos:h,builderOutput:r}),(0,W.jsx)(It,{uninstantiatedFeatures:I,builderOutput:r}),(0,W.jsx)(xt,{featureOrdering:i,onChange:e=>l.dispatch({type:"setFeatureOrdering",featureOrdering:e})}),T&&(0,W.jsx)(ze,{builderOutputWorld:T}),(0,W.jsx)(s().bU,{children:"Output"}),r.errors.length>0&&(0,W.jsx)(tt,{errors:r.errors,label:"You can't save the templates to the registry until the following errors are fixed:"}),r.debugMessages.length>0&&(0,W.jsxs)("details",{className:"subtle",children:[(0,W.jsx)("summary",{children:"Debug log"}),(0,W.jsx)(ot,{messages:r.debugMessages})]}),v&&(0,W.jsxs)(W.Fragment,{children:[d,u]}),(0,W.jsxs)("details",{children:[(0,W.jsx)("summary",{children:"Template definition JSON output"}),(0,W.jsx)(et,{object:r.templateOutputs.map((e=>e.template))})]}),r.fakeLocalizedTemplates&&(0,W.jsxs)("details",{children:[(0,W.jsx)("summary",{children:"Fake-localized template definition JSON output"}),(0,W.jsx)(et,{object:r.fakeLocalizedTemplates})]}),(0,W.jsxs)("details",{children:[(0,W.jsx)("summary",{children:"Template instance actions JSON output"}),(0,W.jsx)(et,{object:r.instanceActions})]})]});if(o){const e=r.errors.length>0?(0,W.jsxs)("span",{className:"error",children:[r.errors.length," errors"]}):null,t=w>0?(0,W.jsxs)("span",{className:"warning",children:[w," warnings"]}):null,o=(0,W.jsxs)("span",{children:[r.counts.new," new, ",r.counts.changed," changed"]});return(0,W.jsxs)("details",{className:"builder-details",children:[(0,W.jsxs)("summary",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,W.jsxs)("div",{style:{flexGrow:1},children:[l.collectionInfo.name," - ",e," ",t," ",o]}),(0,W.jsx)("div",{children:v&&u})]}),j]})}return j}function gt(e){const{sourceCollectionViewBlockURL:t,collectionInfo:o,properties:n,collectionViews:l,builderOutput:r}=e;return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("h2",{children:"Collection"}),(0,W.jsxs)("p",{children:["This is the"," ",(0,W.jsx)("strong",{children:(0,W.jsx)("a",{href:t,target:"_blank",children:o.name})})," ","collection."]}),(0,W.jsx)(Tt,{}),(0,W.jsx)(it,{item:o,builderOutput:r}),(0,W.jsx)("h2",{children:"Properties"}),(0,W.jsx)("ul",{children:n.map((e=>{const{id:t,schema:o}=e;return(0,W.jsxs)("li",{children:[(0,W.jsx)("div",{children:(0,W.jsx)("strong",{children:o.name})}),e.isSupported?(0,W.jsx)(it,{item:e,builderOutput:r}):(0,W.jsxs)("div",{className:"error",children:["Alas, the ",(0,W.jsx)("code",{children:o.type})," property type is not currently supported by the builder."]})]},t)}))}),(0,W.jsx)("h2",{children:"Views"}),(0,W.jsx)("ul",{children:l.map((e=>(0,W.jsxs)("li",{children:[(0,W.jsx)("div",{children:(0,W.jsx)("strong",{children:e.name})}),(0,W.jsx)(it,{item:e,builderOutput:r})]},e.id)))}),o.layout&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("h2",{children:"Layout"}),(0,W.jsx)(it,{item:o.layout,builderOutput:r})]})]})}function It(e){const{uninstantiatedFeatures:t,builderOutput:o}=e;return 0===t.length?null:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("h2",{children:"Uninstantiated templates"}),(0,W.jsx)("ul",{children:t.map((e=>(0,W.jsx)("li",{children:(0,W.jsx)(it,{item:e,builderOutput:o})},e.id)))})]})}function vt(e){const{compoundTemplateInfos:t,builderOutput:o}=e,{dispatch:n}=ce();return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("h2",{children:"Compound templates"}),(0,W.jsx)("ul",{children:t.map((e=>(0,W.jsx)("li",{children:(0,W.jsx)(it,{item:e,builderOutput:o})},e.id)))}),(0,W.jsx)("p",{children:(0,W.jsx)("button",{onClick:()=>{const e=window.prompt("Enter a name for the new compound template (it can be changed later).");e&&n({type:"addNewCompoundTemplate",initialName:e})},children:"Add new compound templateâ€¦"})})]})}function bt(e){const{automationInfos:t,automationErrors:o,builderOutput:n}=e;return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("h2",{children:"Automations"}),o.length>0&&(0,W.jsx)("div",{className:"error",children:(0,W.jsx)("ul",{children:o.map(((e,t)=>(0,W.jsx)("li",{children:e},t)))})}),(0,W.jsx)("ul",{children:t.map((e=>(0,W.jsxs)("li",{children:[(0,W.jsx)("div",{children:(0,W.jsx)("strong",{children:e.name})}),(0,W.jsx)(it,{item:e,builderOutput:n})]},e.id)))})]})}function wt(e){const{blockTemplateInfos:t,pageTemplatesErrors:o,builderOutput:n}=e;return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("h2",{children:"Page Templates"}),o.length>0&&(0,W.jsx)("div",{className:"error",children:(0,W.jsx)("ul",{children:o.map(((e,t)=>(0,W.jsx)("li",{children:e},t)))})}),(0,W.jsx)("ul",{children:t.map((e=>(0,W.jsxs)("li",{children:[(0,W.jsx)("div",{children:(0,W.jsx)("strong",{children:e.name})}),(0,W.jsx)(it,{item:e,builderOutput:n})]},e.id)))})]})}function xt(e){const{featureOrdering:t,onChange:o}=e,n=ce();return t.length<=1?null:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("h2",{children:"Feature ordering"}),(0,W.jsx)("aside",{children:"Drag-and-drop in the list below to re-order the collection features."}),(0,W.jsx)(he().ZP,{direction:"vertical",keys:t,renderKey:e=>{const t=(0,X().Zt)(n,e);return(0,W.jsx)("div",{className:"draggableItem",children:t})},onDrop:o})]})}function Tt(){const{state:e,dispatch:t,collectionInfo:o}=ce(),l=Boolean(o.templateId);return(0,n.useEffect)((()=>{!l&&e.createCopy&&t({type:"setCreateCopy",createCopy:!1})}),[l,t,e.createCopy]),l?(0,W.jsx)("div",{className:"paragraph",children:(0,W.jsx)(c().Wr,{onChange:e=>t({type:"setCreateCopy",createCopy:e}),label:`Create a copy of the source "${o.templateId}" template (instead of updating it)`,value:e.createCopy})}):null}const jt="ðŸ—¾ Local Registry Setup",Ct="setup";W.Fragment;const kt="workflowTemplateBuilderState",Mt=new URLSearchParams(window.location.search.slice(1)),Ot="initialUrl",_t="initialMultiCollectionPageUrl";Mt.get(Ot),Mt.get(_t);function St(){if(!(0,l().E)("workflow_templates_builder"))throw new Error("Assertion failure, builder is not enabled!");const e=Boolean(R()),t=function(){const e=(0,r().O7)(),[t]=(0,m().r5)((async()=>{const t=await(0,z().default)({environment:e,url:"/icons/all",method:"GET",format:"json",mode:"cors"});if("success"===t.type){const e=null==t?void 0:t.data;return Object.keys(e)}}),[e]);return(null==t?void 0:t.value)??[]}(),o=(0,r().O7)(),n=(0,a().Kw)(o.RouterStore).route;let s;if("page"===n.name&&n.blockId&&n.collectionViewId&&e){const e=`${p().default.domainBaseUrl}/${(0,i().cj)(n.blockId)}`;s=(0,W.jsx)("div",{className:"uidoc-workflow-templates-builder-in-app",children:(0,W.jsx)(Vt,{url:e,allIcons:t,hideUntilLoaded:!0,showOnlyIfOriginalSourceCollection:!0},e)})}return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(P,{}),s]})}function Vt(e){const{url:t,allIcons:o,hideUntilLoaded:l,showOnlyIfOriginalSourceCollection:r}=e,a=(0,n.useMemo)((()=>({...D,url:t})),[t]),[i,s]=d(`${kt}_${t}`,K,a),p=de({state:i,dispatch:s,allIcons:o,requireTemplateInstance:!0,...me()});return l&&"loaded"!==p.type||r&&"loaded"===p.type&&!p.context.isOriginalSourceCollectionViewBlock?null:(0,W.jsx)(ht,{builderContextState:p,isCompact:!0})}function Nt(e){return(0,l().E)("workflow_templates_builder")?(0,W.jsx)(St,{}):null}},29488:(e,t,o)=>{function n(e){return`${e.table}:${e.id}`}o.d(t,{O:()=>n})}}]);