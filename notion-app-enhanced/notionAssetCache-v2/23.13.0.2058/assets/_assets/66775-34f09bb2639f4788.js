"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[66775,95986,30795],{636133:(e,t,o)=>{o.d(t,{Ce:()=>i,IC:()=>l,Jv:()=>u,QF:()=>p,Yc:()=>n,az:()=>s,eO:()=>d,s4:()=>c,ti:()=>a});var r=()=>o(594546);function n(e,t){r().K4(e,"workspace_creation_ability",t)}function a(e,t){r().K4(e,"workspace_creation_setting_updated",t)}function i(e,t){r().K4(e,"claimable_spaces_viewed",t)}function s(e,t){r().K4(e,"space_transfer_requested",t)}function c(e,t){r().K4(e,"space_transfer_completed",t)}function d(e,t){r().K4(e,"space_claim_upgrade_requested",t)}function l(e,t){r().K4(e,"space_claim_upgrade_completed",t)}function p(e,t){r().K4(e,"space_claim_deletion_started",t)}function u(e,t){r().K4(e,"space_claim_deletion_canceled",t)}},86609:(e,t,o)=>{o.d(t,{KV:()=>z,Rh:()=>$,U6:()=>K,Wu:()=>te,Xx:()=>J,YD:()=>ee,g9:()=>q,jc:()=>Y,m8:()=>Q,ys:()=>H,zX:()=>X});o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(30005),o(241792),o(228244);var r=()=>o(730120),n=()=>o(506347),a=()=>o(926724),i=()=>o(271896),s=()=>o(226413),c=()=>o(803021),d=()=>o(874459),l=()=>o(956057),p=()=>o(528514),u=()=>o(494616),m=()=>o(922713),g=()=>o(396136),_=()=>o(752778),f=()=>o(255933),S=()=>o(306164),v=()=>o(856466),y=()=>o(126301),b=()=>o(955620),w=()=>o(253335),I=()=>o(110232),k=()=>o(285755),h=()=>o(23151),C=()=>o(757216),D=()=>o(544903),T=()=>o(594546),O=()=>o(487270),E=()=>o(527278),U=()=>o(876822),M=()=>o(826955),A=()=>o(250303),P=()=>o(824462),R=()=>o(984871),V=()=>o(139224),N=()=>o(421654),F=()=>o(636340),L=()=>o(511614),x=()=>o(269299),W=()=>o(663366),j=()=>o(348141);const B="week";function J(e){var t;const{environment:o,transaction:r,tasksBlockStore:n,sprintsBlockStore:a}=e,i=null===(t=a.getFormat())||void 0===t?void 0:t.collection_pointer,s=n.getFormat().collection_pointer;if(!i||!s)return;const c=M().NW.createChildStore(a,i),d=c.getRole()??"none";if(!(0,p().yY)(d,"editor"))return;c.getAutomationStores().some((e=>e.isCompleteSprintAutomation()))||Z({environment:o,transaction:r,sprintCollectionStore:c,taskCollectionStore:M().NW.createChildStore(n,s),sprintSettingsConfig:v().iZ})}function Z(e){const{environment:t,sprintSettingsConfig:o,transaction:r,sprintCollectionStore:n,taskCollectionStore:a}=e,i=n.getSpaceId(),s=(0,O().TS)({environment:t,table:u().cv,spaceId:i}),c=(0,O().TS)({environment:t,table:m().Xj,spaceId:i});F().ae({environment:t,table:u().cv,inMemoryRecordCache:n.inMemoryRecordCache,value:{id:s,parent_id:n.id,parent_table:n.table,alive:!0,space_id:i,status:o.autoCompleteSprints?"active":"disabled",trigger:{id:l().Il(),type:"recurrence",recurrence:re(o)},action_ids:[c]},transaction:r}),N().FH({stores:[n],update:{automation_ids:[...n.getFormat().automation_ids??[],s]},transaction:r}),F().ae({environment:t,table:m().Xj,inMemoryRecordCache:n.inMemoryRecordCache,transaction:r,value:{id:c,parent_id:s,parent_table:u().cv,type:"complete_sprint",alive:!0,space_id:i,config:{sprint_collection:n.getSpaceShardedPointer(),task_collection:a.getSpaceShardedPointer(),complete_sprint_action:o.actionConfig.complete_sprint_action}}})}function z(e){const{environment:t,automationStore:o,transaction:r,newDuration:n,currentSprintBlockStore:a}=e;F().sW({store:o.getTriggerStore().getKeyStore("recurrence"),data:{interval:n},transaction:r}),G({environment:t,transaction:r,automationStore:o,currentSprintBlockStore:a})}function q(e){const{environment:t,automationStore:o,transaction:r,newWeekday:n,currentSprintBlockStore:a}=e;F().sW({store:o.getTriggerStore().getKeyStore("recurrence"),data:{weekdays:[n]},transaction:r}),G({environment:t,transaction:r,automationStore:o,currentSprintBlockStore:a})}function Y(e){const{environment:t,actionStore:o,automationStore:r,transaction:n,newAutocompleteStatus:a,currentSprintBlockStore:s}=e;F().sW({store:r,data:{status:a?"active":"disabled"},transaction:n}),G({environment:t,transaction:n,automationStore:r,currentSprintBlockStore:s});const c=r.getParentPointer();if(!c||c.table!==_().vF)return;const d=(0,T().mc)(t),l={automation_id:r.id,automation_actions:[{automation_action_id:o.id,type:"complete_sprint"}],automation_triggers:[{type:"recurrence"}],collection_id:c.id};a?(0,i().Rt)(d,l):(0,i().ai)(d,l)}function G(e){const{automationStore:t,currentSprintBlockStore:o,transaction:n,environment:i}=e;if(!t.isActive())return;const s=t.getRecurrence();if(!s)return;const d=(0,y().Su)(s);if(!d)return;const l=o.getPropertyValue(a().b0.Dates);if(!l)return;const p=(0,b().nai)(l)[0];if(!p||"daterange"!==p.type)return;const u=p.start_date,{start_date:m,end_date:g}=(0,y().DW)({currentSprintStartDate:u,sprintSchedule:d});F().sW({store:t.getTriggerStore().getKeyStore("recurrence"),data:{start_date:(0,c().Jh)(r().ou.fromISO(m).plus({minutes:1}).toJSDate())},transaction:n}),h().xD({store:o,propertyId:a().b0.Dates,transaction:n,environment:i,type:"dateValue",dateValue:{type:"daterange",start_date:u,end_date:g}})}function K(e){const{transaction:t,newRemainingTasksBehavior:o,actionStore:r}=e;F().sW({store:r.getConfigStore(),data:{complete_sprint_action:o},transaction:t})}async function H(e){var t;const{appTemplatesSetupActions:o,appTemplatesSprintBoardActions:r,appConfigs:i}=await D().vF.load(),{environment:s,collectionContextStore:c,from:d}=e,{currentSpaceViewStore:l}=U().default.state,p=c.collectionStore(),u=null==p?void 0:p.getParentBlockStore(),m=null==u?void 0:u.getParentStore(),_=null==p||null===(t=p.getFormat())||void 0===t?void 0:t.app_config_uri,v=_&&(0,I().YB)(i(),_);if(!p||!u||!m||!l||m.table!==f().bx&&m.table!==g().iU&&m.table!==S().e0||!v)return;const y=u.getFormat().app_id,b=y?await P().callApi({eventName:"getCollectionViewBlocksByAppId",environment:s,data:{spaceId:u.getSpaceId(),appId:y}}):void 0,k="success"===(null==b?void 0:b.type)&&b.data.result.length?b.data.result.map((e=>M().G.createChildStore(m,{table:g().iU,id:e.blockId,spaceId:u.getSpaceId()}))):[u];await oe({environment:s,taskCollectionStore:p,executeFn:()=>{const e=x().createAndCommit({userAction:"sprintSettingsActions.handleTurnOnSprints",environment:s,canUndo:!0,perform:e=>{const t=(0,w().eu)(),n=o.applyTypedFeatures({environment:s,spaceViewStore:l,appParentStore:m,appUri:v.uri,features:[{type:"simple",featureUri:t.uri}],transaction:e,createOrModify:"modify",appCollectionViewBlockStores:k}),i=r.createSprintPage({environment:s,spaceViewStore:l,appParentStore:m,transaction:e,blockStores:n,creationEntryPoint:{type:"sprint_settings"}});if(V().E3({collectionSettingsStore:c.settingsStore}),!i)return;const p=d?{feature:{id:a().Es.TaskToSprintRelation,from:d,type:"notion://projects/tasks_with_sprints_feature"}}:{};return A()._H({environment:s,collectionContextStore:c,from:"view_settings",property:a().Es.TaskToSprintRelation,property_type:"relation",is_suggested_property:!0,...p}),i}});e.serverCommitResult.then((()=>{const t=e.performResult;t&&L().r({environment:s,store:t,pageVisitSource:n().tY.Create})}))}})}async function Q(e){const{environment:t,collectionContextStore:o,sprintSettingsContext:r,sprintBoardViewBlockIds:i}=e,{sprintCollectionStore:s,automationContext:c,currentCollectionViewBlockStore:d,sprintCollectionViewBlockStore:l,taskCollectionStore:p,taskCollectionViewBlockStore:u}=r;if(!s||!l||!c)return;const m=u.getSpaceId(),_=[l,...i.map((e=>new(M().G)(t,{id:e,table:g().iU,spaceId:m})))];d.id===u.id?V().E3({collectionSettingsStore:o.settingsStore}):L().r({environment:t,store:u,pageVisitSource:n().tY.LeaveOrRemove});const{automationActions:f}=await k().Sm.automations.load(),{automationStore:S}=c;await oe({environment:t,taskCollectionStore:p,executeFn:()=>{x().createAndCommit({userAction:"sprintSettingsActions.handleTurnOffSprints",environment:t,canUndo:!0,perform:e=>{!function(e){const{transaction:t,blocksToDelete:o,environment:r,taskCollectionStore:n,sprintCollectionStore:i}=e;F().sW({store:i,transaction:t,data:{alive:!1}}),R().E2({environment:r,collectionStore:n,schema:n.getSchema(),property:a().Es.TaskToSprintRelation,transaction:t,permanentlyDelete:!0}),W().y8({environment:r,blocks:o,transaction:t,permanentlyDelete:!0})}({environment:t,transaction:e,blocksToDelete:_,sprintCollectionStore:s,taskCollectionStore:p}),f.disableAutomation({automationStore:S,environment:t,transaction:e}),f.deleteAutomation({automationStore:S,environment:t,transaction:e})}}),A().y9({environment:t,collectionContextStore:o,property_type:"relation",from:"view_settings",property:a().Es.TaskToSprintRelation})}})}function X(e){const{environment:t,userSettingsStore:o}=e;x().createAndCommit({userAction:"sprintSettingsActions.handleSeenSprintsEngagementBanner",environment:t,canUndo:!0,perform:e=>{j().d2({userSettingsStore:o,data:{seen_sprint_settings_engagement_banner:!0},transaction:e})}})}function $(e){e.settingsStore.setState({open:!0,stack:[{type:"main"},{type:"sprintSettings"}]})}function ee(e){const{environment:t,collectionContextStore:o,currentViewBlockStore:r,taskCollectionViewBlockStore:n}=e,i=o.collectionViewStore();if(!i)return;const s=i.getFormat(),c=i.getRawQuery();x().createAndCommit({userAction:"sprintSettingsActions.handleManageSprintFromThisView",environment:t,canUndo:!0,perform:e=>{if((0,C().i)({collectionViewStore:i,transaction:e,update:{name:E().Z.formatMessage(w().sY.tasksCurrentSprintV2ViewName),query2:{...c,filter:void 0},format:{...s,collection_view_icon:"/icons/playback-play-button_gray.svg",property_filters:w().Jt,app_config_uri:a().g3,hide_linked_collection_name:!0}}}),r.id===n.id){var t;const o=(null===(t=r.getFormat())||void 0===t?void 0:t.app_uri_map)??{},c=s.app_config_uri;c&&delete o[c],N().FH({stores:[n],update:{app_uri_map:{...o,[a().g3]:i.id}},transaction:e})}}})}function te(e){const{environment:t,sprintSettingsContext:o}=e;if(!o)return;const r=o.sprintCollectionStore,n=(null==r?void 0:r.getRole())??"none";r&&(0,p().yY)(n,"editor")&&o.automationContextLoaded&&!o.automationContext&&x().createAndCommit({userAction:"sprintSettingsActions.ensureCompleteSprintAutomation",environment:t,canUndo:!0,perform:e=>{Z({environment:t,transaction:e,sprintCollectionStore:r,taskCollectionStore:o.taskCollectionStore,sprintSettingsConfig:v().iZ})}})}async function oe(e){const{executeFn:t,environment:o,taskCollectionStore:r}=e;await async function(e){var t;const{environment:o,taskCollectionStore:r}=e,n=r.getFormat().app_uri_map,i=a().Es.TaskToSprintRelation,c=r.getSchema(),d=(null==n?void 0:n[i])??i,l=c[d];if(!l||!(0,s().p_)(l))return;const p=null===(t=(0,s().j0)(l))||void 0===t?void 0:t.id;if(!p)return;const u=new Set([d]);Object.entries(c).forEach((e=>{var t;let[o,r]=e;r&&(0,s().p_)(r)&&(null===(t=(0,s().j0)(r))||void 0===t?void 0:t.id)===p&&u.add(o)}));const{serverCommitResult:m}=x().createAndCommit({userAction:"sprintSettingsActions.clearSprintRelationDataFromTaskCollection",environment:o,canUndo:!0,perform:e=>{for(const t of u)R().E2({environment:o,transaction:e,permanentlyDelete:!0,collectionStore:r,schema:c,property:t});null==n||delete n[i],n&&N().FH({stores:[r],transaction:e,update:{app_uri_map:n}})}});await m}({environment:o,taskCollectionStore:r}),t()}function re(e){return{frequency:B,interval:e.recurrenceConfig.interval,weekdays:e.recurrenceConfig.weekdays,start_date:(0,c().Jh)(r().ou.local().set({hour:0,minute:0,second:0,millisecond:0}).toJSDate()),timezone:(0,d().Sv)(),hour:0,minute:0}}},23151:(e,t,o)=>{o.d(t,{Fv:()=>O,JN:()=>k,QG:()=>U,cQ:()=>T,f$:()=>h,fX:()=>D,td:()=>C,xD:()=>E});o(670560),o(267602),o(30005),o(241792);var r=()=>o(730120),n=()=>o(552221),a=()=>o(532850),i=()=>o(803021),s=()=>o(874459),c=()=>o(998411),d=()=>o(752778),l=()=>o(513670),p=()=>o(696459),u=()=>o(250303),m=()=>o(384667),g=()=>o(366257),_=()=>o(332542),f=()=>o(636340),S=()=>o(970105),v=()=>o(887430),y=()=>o(32969),b=()=>o(35982),w=()=>o(826955),I=()=>o(526243);function k(e){const{environment:t,droppedStores:o,duplicate:a,calendarBy:l,transaction:p,collectionContextStore:g}=e,f=r().ou.fromMillis(e.startOfDay);let S=!0;for(const r of o){const t=e.collectionStore?e.collectionStore:(0,v().Bm)({store:r,collectionContextStore:g});if(r.getParentTable()===d().vF||!t){S=!1;break}_().zw({childStore:r,parentStore:t,transaction:p})||(S=!1)}const y=m().Ab({environment:t,droppedStores:o,duplicate:a,transaction:p,collectionStore:e.collectionStore});for(const r of y){const o=e.collectionStore?e.collectionStore:(0,v().Bm)({store:r,collectionContextStore:g});if(!o)continue;const a=o.getMappedProperty(l),d=r.getPropertyStore(a),_=(0,n().G)(d.getValue())||s().Lg((0,c().r)()),y=s().c$(_,(0,c().r)()),b=f.toFormat(s().Iq);let w;if("date"===y.type||"datetime"===y.type)w={...y,start_date:b};else{const e=s().NK(y,(0,c().r)());if(!e.end)return;const t={...y,start_date:b},o=s().NK(t,(0,c().r)()).start.diff(e.start,"days"),r=e.end.plus(o).toFormat(s().Iq);w={...y,start_date:b,end_date:r}}const I=s().c$(w,i().yw(_)||(0,c().r)());m().mp({environment:t,store:r,collectionStore:o,collectionContextStore:g,shouldCoerce:!0,groupsPointer:[],transaction:p,alreadyMovedToCollection:S}),E({environment:t,type:"dateValue",propertyId:a,store:r,transaction:p,dateValue:I}),u().rv({environment:t,collectionContextStore:g,block_id:r.id,property:a,property_type:"date",from:"calendar"})}}function h(e){const{calendarStore:t,direction:o,targetStore:r}=e;t.setState({...t.state,isDragging:!0,targetStore:r,direction:o,temporaryValue:void 0})}function C(e){const{calendarStore:t,x:o,y:a,calendarBy:d}=e,p=t.state;if(p.isDragging){const e=(0,n().G)(p.targetStore.getPropertyStore(d).getValue());if(!e)return;const u=s().c$(e,(0,c().r)()),m=p.temporaryValue||e,g=s().c$(m,(0,c().r)()),_=[];p.dayStoreMap.forEach(((e,t)=>{_.push({store:e,timestamp:t})}));const f=_.find((e=>{let{store:t}=e;const r=y().C.getRectFromStore(t);return Boolean(r&&b().uh(r,o,a))}));let S;if(f){const e=r().ou.fromMillis(f.timestamp),t=e.endOf("day"),o=e.toFormat(s().Iq);if(u){const n=s().NK(u,(0,c().r)());if(p.direction===I().to.Left)if(r().Xp.fromDateTimes(e,t).contains(n.start))S=u;else{let e;e="datetimerange"===u.type||"daterange"===u.type?{...u,start_date:o,end_date:u.end_date}:"datetime"===u.type?{type:"datetimerange",start_date:o,start_time:u.start_time,end_date:u.start_date,end_time:u.start_time,time_zone:u.time_zone,reminder:u.reminder}:{type:"daterange",start_date:o,end_date:u.start_date,reminder:u.reminder};const t=s().NK(e,(0,c().r)());S=!n.end&&t.start>n.start||n.end&&t.start>n.end?g:e}else if(n.end?r().Xp.fromDateTimes(e,t).contains(n.end):r().Xp.fromDateTimes(e,t).contains(n.start))S=u;else{let e;e="date"===u.type?{...u,type:"daterange",end_date:o}:"datetime"===u.type?{...u,type:"datetimerange",end_date:o,end_time:"00:00"}:{...u,end_date:o};const t=s().NK(e,(0,c().r)());S=t.end&&t.end<t.start?g:e}}}if(S&&!l().Xy(g,S)){const e=s().c$(S,i().yw(m)||(0,c().r)());t.setState({...p,temporaryValue:e})}}}function D(e){const{environment:t,calendarStore:o,calendarBy:r,transaction:n}=e,a=o.state;a.isDragging&&a.temporaryValue&&(E({type:"dateValue",environment:t,dateValue:a.temporaryValue,propertyId:r,store:a.targetStore,transaction:n}),o.setState({...o.state,isDragging:!1}))}function T(e){const{calendarStore:t}=e,o=t.state;o.isDragging&&t.setState({...o,isDragging:!1})}function O(e){const{environment:t,store:o,collectionStore:n,collectionContextStore:i,startDayOfWeek:d,transaction:l}=e,p=i.dateRangeStartStore.state,u=(0,c().r)(),g=i.normalizedQueryStore.state;if(!g||!g.calendar_by)return;const _=(null==n?void 0:n.getMappedProperty(g.calendar_by))??g.calendar_by,S=s().gQ(p,d,u),v=S.startOf("month"),y=S.endOf("month"),b=r().ou.now().startOf("day");let w;return w=r().Xp.fromDateTimes(v,y).contains(b)?s().hT(b.valueOf(),u):s().hT(s().em(p,d,u).valueOf(),u),f().sW({store:o.getPropertiesStore(),data:{[_]:a().d7(w)},transaction:l}),m().mp({environment:t,store:o,collectionStore:n,collectionContextStore:i,shouldCoerce:!0,groupsPointer:[],transaction:l}),o}function E(e){const{environment:t,store:o,propertyId:r,transaction:n}=e;let i;"timestamp"===e.type?i=s().hT(e.timestampMs.valueOf(),(0,c().r)()):"dateValue"===e.type?i=e.dateValue:(0,p().t1)(e);const d=o.getPropertyValue(r),l=a().d7(i);f().sW({store:o.getPropertiesStore(),data:{[r]:l},transaction:n}),g().H({environment:t,store:o,dateProperty:{id:r,oldValue:d,newValue:l}})}function U(e){const{environment:t,collectionStore:o,calendarBy:r,store:n,insertStores:a,collectionContextStore:i,transaction:s}=e,c=n.getPropertyStore(r).getValue();for(const d of a)m().mp({environment:t,store:d,collectionStore:o,collectionContextStore:i,shouldCoerce:!0,groupsPointer:[],transaction:s}),S().sO({environment:t,store:d.getPropertyStore(r),value:c,transaction:s});return a.map((e=>w().G.createChildStore(o,e.pointer)))}},70662:(e,t,o)=>{o.r(t),o.d(t,{applyPerfmarkTrial:()=>Oe,completeDesktopOnboardingForTeamPlan:()=>Ee,createSpaceWithTemplates:()=>Ie,getInitialState:()=>se,getRedirectDataUpdate:()=>Ce,getWorkflowTemplateForUseCase:()=>Me,getWorkflowTemplatesForUseCases:()=>Ue,joinTeamSpaceWithTemplates:()=>ke,messages:()=>ie,navigateWithRedirectData:()=>ye,redirectAfterOnboardingComplete:()=>ve,timedTrialUpsellNextState:()=>_e,updateAndGetNextState:()=>ce,updateAndGetPreviousState:()=>de});o(821057),o(267602),o(653476),o(241792);var r=()=>o(506347),n=()=>o(991460),a=()=>o(799891),i=()=>o(431595),s=()=>o(956057),c=()=>o(741633),d=()=>o(217465),l=()=>o(396136),p=()=>o(752778),u=()=>o(255933),m=()=>o(125571),g=()=>o(282017),_=()=>o(245015),f=()=>o(513670),S=()=>o(792409),v=()=>o(696459),y=()=>o(863119),b=()=>o(636133),w=()=>o(462928),I=()=>o(407391),k=()=>o(824462),h=()=>o(917801),C=()=>o(231077),D=()=>o(528918),T=()=>o(919671),O=()=>o(143346),E=()=>o(47443),U=()=>o(497065),M=()=>o(224597),A=()=>o(145284),P=()=>o(269299),R=()=>o(348141),V=()=>o(2971),N=()=>o(887430),F=()=>o(937419),L=()=>o(594546),x=()=>o(718959),W=()=>o(286338),j=()=>o(572623),B=()=>o(527278),J=()=>o(345918),Z=()=>o(803728),z=()=>o(620218),q=()=>o(876822),Y=()=>o(9599),G=()=>o(826955),K=()=>o(576387),H=()=>o(548812),Q=()=>o(334510),X=()=>o(548919),$=()=>o(723721),ee=()=>o(934262),te=()=>o(686350),oe=()=>o(707138),re=()=>o(267344),ne=()=>o(505006),ae=()=>o(741636);const ie=(0,o(788860).vU)({joiningWorkspace:{id:"onboardingStateActions.joiningWorkspace.loadingMessage",defaultMessage:"Joining team…"},creatingWorkspace:{id:"onboardingStateActions.creatingWorkspace.loadingMessage",defaultMessage:"Getting ready…"},creatingWorkflowTemplate:{id:"onboardingStateActions.creatingWorkflowTemplate.loadingMessage",defaultMessage:"Getting ready…"},navigatingToWorkspace:{id:"onboardingStateActions.navigatingToWorkspace.loadingMessage",defaultMessage:"Taking you to your workspace…"},errorNoAction:{id:"onboardingStateActions.errorMessage.noActionToPerform",defaultMessage:"No action to perform for {onboardingRedirectType}"},errorWorkspaceCreationPreventedWithEmail:{id:"onboardingStateActions.errorMessage.domainClaim.workspaceCreationPreventedWithEmail",defaultMessage:"You are signed in to {userEmailAddress} and do not have access to any workspaces. Please reach out to your IT department for access to Notion."},errorWorkspaceCreationPrevented:{id:"onboardingStateActions.errorMessage.domainClaim.workspaceCreationPrevented",defaultMessage:"You do not have access to any workspaces. Please reach out to your IT department for access to Notion."},errorWorkspaceDoesNotExist:{id:"onboardingStateActions.errorMessage.spaceDoesNotExist",defaultMessage:"Workspace does not exist."},errorWorkspaceDidNotLoad:{id:"onboardingStateActions.errorMessage.spaceDidNotLoad",defaultMessage:"Failed to load workspace."}});async function se(e){let{environment:t,startOnboardingArgs:o,onboardingData:r,redirectData:a}=e;const c=t.currentUser.id;if(void 0===c)throw new Error("Environment currentUserId not defined.");const{type:d,redirectUrl:l,disableRedirectUrl:p}=o,u=t.device.isMobile,{currentUserRootStore:m}=q().default.state,g=0===(m&&m.isReady()?f().jj(m.getSpaceViewStores().filter((e=>e.getJoined())).map((e=>e.getSpaceId()))).length:0),_=(0,$().pV)()?"perfmark":void 0,S={onboardingData:r,redirectData:a,isOnboarding:!0,isLoading:!1,flowId:s().Il(),currentUserId:c,isNewUser:g,stageNumber:0,spaceId:void 0,historicalStages:void 0,onboardingExperiments:{},stageStats:{startedTimeStampMs:Date.now()},trialId:_,performanceMarketingTerm:r.performanceMarketingTerm};if("new-user"===d){const e=r.joinableSpaceData.results.length>0;let o;o=u?l&&!p?"mobile_redirect":e?"mobile_joinable_spaces":"mobile_cold_start":l&&!p?"desktop_redirect":e?"desktop_joinable_spaces":"desktop_cold_start";const a={...S,flow:o,stage:"profile",uploadingProfilePhoto:!1,profilePhoto:null,prefilled:!1,passwordErrorData:null,emailOptIn:(0,n().Aw)(r.countryCode).defaultOptIn},i=te().$U({userStore:r.userStore});return i?le({...a,...i},t):a}if("create-or-join"===d){const e=te().ey({onboardingData:r,isNewUserFlow:!1}),o=u?"mobile_join_or_create_space":"desktop_join_or_create_space";if(e.length>0)return{...S,flow:o,stage:"workspace_choose",joinableSpaces:e,prefilled:!1};if(r.canUserCreateSpace)return{...Te(S),...S,flow:o,stage:"workspace_plan_choose",prefilled:!1,spaceJoinOrCreate:"create",useCases:[],collaborativeIntent:void 0};{b().Yc(t,{can_user_create_space:!1,is_new_user:!1,has_joinable_spaces:!1,onboarding_stage:void 0});const e=r.userStore.getEmail();throw oe().default.setState({...S,flow:o,stage:"error"}),new(i().bp)(e?B().Z.formatMessage(ie.errorWorkspaceCreationPreventedWithEmail,{userEmailAddress:e}):B().Z.formatMessage(ie.errorWorkspaceCreationPrevented),{newUser:!1})}}if("mobile-onboarding"===d)return{...S,flow:"mobile_existing_user",stage:"mobile_editor",spaceJoinOrCreate:"join"};v().t1(d)}async function ce(e,t){if(!e.isOnboarding)return{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};const o={...e,stageNumber:e.stageNumber+1};switch(te().Ck(t),o.stage){case"profile":return le(o,t);case"workspace_plan_choose":return ue(o,t);case"workspace_collaborative_intent_choose":return function(e,t){return ue({...e,stage:"workspace_plan_choose"},t,!0)}(o,t);case"workspace_choose":return async function(e,t){const{redirectData:o}=e;if("guest_redirect"===o.type)return De(e,o,"guest",t);if("create"===e.spaceJoinOrCreate)return{...Te(e),planSelection:void 0,...e,stage:"workspace_plan_choose",useCases:[],collaborativeIntent:void 0};{const o=z().default.DO_NOT_USE_markLegacy("onboarding.join_space"),{spaceStore:r,spaceViewStore:n,...a}=await we(e,t);te().At({environment:t,state:{onboardingExperiments:e.onboardingExperiments,userPersona:"userPersona"in e?e.userPersona:void 0,userRole:"userRole"in e?e.userRole:void 0,companySize:void 0,useCases:void 0,planSelection:void 0,categories:void 0,userEducationRole:void 0,userEducationLevel:void 0,notionUseFrequency:void 0,collaborativeIntent:void 0},spaceStore:void 0,spaceViewStore:n});const{spaceId:i,spaceViewId:s,redirectData:c}=a,{flow:d}=e;switch(d){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_redirect":case"desktop_joinable_spaces":return await ve({environment:t,onboardingData:e.onboardingData,spaceId:i,spaceViewId:s,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:c,onboardingFlow:d,onboardingState:e}),z().default.DO_NOT_USE_measureLegacy(o,{environment:t,data:{flow:e.flow,onboarding_complete_data:{stage:e.stage,redirect_data:c,is_new_user:te().rT(e),permission_level:"guest_redirect"===c.type?"guest":"member"}}}),{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};case"mobile_join_or_create_space":{const o={...e,...a};return fe(e.onboardingData,o,t)}case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":{const r={...e,...a};return z().default.DO_NOT_USE_measureLegacy(o,{environment:t,data:{flow:e.flow,onboarding_complete_data:{stage:e.stage,redirect_data:c,is_new_user:te().rT(e),permission_level:"guest_redirect"===c.type?"guest":"member"}}}),Se({onboardingState:r,environment:t,flow:d})}default:return v().t1(d)}}}(o,t);case"persona_survey":return pe(o,t);case"workspace_create":return me(o,t);case"invite":return ge(o,t);case"timed_trial_upsell":return _e(o,t);case"template_optout":return function(e,t){return{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id}}(0,t);case"workspace_setup":return async function(e,t){const{flow:o}=e;switch(o){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_joinable_spaces":case"desktop_redirect":return await ve({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingState:e}),{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};case"mobile_join_or_create_space":return fe(e.onboardingData,e,t);case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":return U().T4(t),Se({onboardingState:e,environment:t,flow:o});default:return v().t1(o)}}(o,t);case"mobile_editor":return function(e){return{...e,stage:"mobile_sidebar"}}(o);case"mobile_sidebar":return function(e,t){if(te().og(t))return{...e,stage:"mobile_app_download"};return{...e,stage:"mobile_desktop"}}(o,t);case"mobile_desktop":return function(e,t){return{...e,stage:"mobile_web_clipper"}}(o);case"mobile_web_clipper":return function(e,t){if("mobile_existing_user"===e.flow)return he(e,t);return fe(e.onboardingData,e,t)}(o,t);case"mobile_app_download":return async function(e,t){if("mobile_existing_user"===e.flow)return he(e,t);return fe(e.onboardingData,e,t)}(o,t);case"error":return function(e){return{isOnboarding:!1,isLoading:!1,currentUserId:e.currentUser.id}}(t);default:v().t1(o)}}function de(e,t){if(!e.isOnboarding)throw new Error("Trying to go back on step which is not onboarding.");const o={...e,stageNumber:e.stageNumber-1};if(!oe().onboardingStagesWithBack.includes(e.stage))throw new Error(`Trying to go back in onboarding on step where back is not supported. Stage: ${e.stage}`);switch(o.stage){case"workspace_plan_choose":return function(e){const t=te().rT(e),o=te().ey({onboardingData:e.onboardingData,isNewUserFlow:t});if(o.length>0)return{...e,joinableSpaces:o,stage:"workspace_choose"};if(t)throw new Error("Trying to go back to profile step from plan choose for new user!");throw new Error("Trying to go back on plan choose step for existing user with no joinable spaces!")}(o);case"workspace_collaborative_intent_choose":return function(e){return{...e,stage:"workspace_plan_choose",collaborativeIntent:void 0}}(o);case"persona_survey":return function(e){return{...e,stage:"workspace_collaborative_intent_choose"}}(o);case"workspace_create":return function(e){const t=te().rT(e);if("school"===e.planSelection||"personal"===e.planSelection)return{...e,skip:!1,prefilled:e.prefilled,previousStage:"workspace_create",userPersona:e.userPersona,spaceName:e.spaceName,stage:"persona_survey"};return t&&"team"===e.planSelection?{...e,prefilled:e.prefilled,previousStage:"workspace_create",skip:!1,userPersona:e.userPersona,spaceName:e.spaceName,stage:"persona_survey"}:{...e,stage:"workspace_collaborative_intent_choose"}}(o);case"timed_trial_upsell":return function(e){const t=te().lr(e.onboardingData);return{...e,flow:e.flow,stage:"invite",isChecked:!0,emails:[],spaceSetupCompleted:!0,joinableUserEmailDomain:t,spaceJoinOrCreate:"create",inviteLinkUrl:e.inviteLinkUrl,shouldTriggerPostInviteAnimations:!1,isBulkInvite:!1,planSelection:e.planSelection,collaborativeIntent:e.collaborativeIntent}}(o);case"mobile_editor":return function(e){const t=te().lr(e.onboardingData);return{...e,flow:e.flow,stage:"invite",isChecked:!0,emails:[],spaceSetupCompleted:!0,joinableUserEmailDomain:t,spaceJoinOrCreate:"create",shouldTriggerPostInviteAnimations:!1,isBulkInvite:!1,teamStoreId:e.teamStoreId,inviteLinkUrl:e.inviteLinkUrl,spaceViewId:e.spaceViewId,planSelection:e.planSelection,collaborativeIntent:e.collaborativeIntent}}(o);case"mobile_sidebar":return function(e){return{...e,stage:"mobile_editor"}}(o);case"mobile_desktop":case"mobile_app_download":return function(e){return{...e,stage:"mobile_sidebar"}}(o);case"mobile_web_clipper":return function(e,t){return{...e,stage:"mobile_desktop"}}(o);case"workspace_choose":case"invite":case"template_optout":case"workspace_setup":case"profile":case"error":return null;default:v().t1(o)}}async function le(e,t){await te()._J(e,t);const{password:o,...n}=e,a=_().Z.get(te().WX),{onboardingData:s,redirectData:c}=n,d=te().ey({onboardingData:s,isNewUserFlow:te().n0(n)});if("guest_redirect"===c.type)return De(n,c,"guest",t);if("redirect_page"===c.type||"redirect_space"===c.type)return De(n,c,"member",t);if("public_access_page_redirect"===c.type)return function(e,t,o){return be({environment:o,permissionLevel:"public",onboardingState:e}),E()._c({environment:o,store:new(G().G)(o,{table:l().iU,id:t.pageId}),pageVisitSource:r().tY.Onboarding}),{isOnboarding:!1,isLoading:!1,currentUserId:o.currentUser.id}}(n,c,t);if(a){const e=await k().callApi({eventName:"getPublicSpaceForInvite",environment:t,data:{type:"invite-link",inviteLinkCode:a}});if("success"===e.type){const{data:o}=e,{result:r}=o;if(r)return De(n,{type:"team_invite_redirect",spaceId:r.id,inviteCode:a},"member",t);throw new Error(B().Z.formatMessage(ie.errorWorkspaceDoesNotExist))}throw new Error(B().Z.formatMessage(ie.errorWorkspaceDidNotLoad))}if(d.length>0)return{...n,joinableSpaces:d,stage:"workspace_choose"};if(s.canUserCreateSpace){if(te().fz({state:n})){return{...n,spaceJoinOrCreate:"create",userPersona:void 0,useCases:[],stage:"workspace_plan_choose",planSelection:void 0,collaborativeIntent:void 0}}return{spaceName:void 0,...n,spaceJoinOrCreate:"create",userPersona:void 0,userRole:void 0,companySize:void 0,useCases:[],categories:[],stage:"persona_survey",skip:!1,previousStage:"profile",planSelection:void 0,collaborativeIntent:void 0}}{b().Yc(t,{can_user_create_space:!1,is_new_user:!0,has_joinable_spaces:!1,onboarding_stage:n.stage});const o=s.userStore.getEmail();throw oe().default.setState({...e,stage:"error"}),new(i().bp)(o?B().Z.formatMessage(ie.errorWorkspaceCreationPreventedWithEmail,{userEmailAddress:o}):B().Z.formatMessage(ie.errorWorkspaceCreationPrevented),{newUser:!0})}}function pe(e,t){!e.skip&&e.isNewUser&&function(e,t){const{onboardingData:o,userPersona:r,userRole:n,useCases:a,companySize:i}=t;P().createAndCommit({userAction:"onboardingStateActions.setUserPersonaRoleAndUseCases",environment:e,canUndo:!0,perform:e=>{R().d2({userSettingsStore:o.userSettingsStore,data:{persona:r,team_role:n,use_cases:a,company_size:i,persona_version:{version:"V4",timestamp:(new Date).getTime()}},transaction:e})}})}(t,e);const{onboardingData:o}=e,r=B().Z.getIntl(),n={spaceIcon:null,uploadingSpaceIcon:!1,...Te(e),...e,spaceJoinOrCreate:"create",userPersona:e.userPersona,stage:"workspace_create"},a=o.userStore.getFullName(r);if("planSelection"in n&&["personal","school"].includes(n.planSelection||"")&&a){const e=o.userStore.getProfilePhoto();return me({...n,userPersona:n.userPersona||"unfilled",spaceName:te().eW(a,r),spaceIcon:e||null},t)}return n}function ue(e,t,o){const r="school"===e.planSelection||"personal"===e.planSelection,n=te().fz({state:e}),a={userRole:void 0,companySize:void 0,spaceName:void 0,categories:[],...e,skip:!1,stage:"persona_survey",previousStage:"workspace_plan_choose"};if(!o)return{...a,collaborativeIntent:void 0,stage:"workspace_collaborative_intent_choose"};if(n||r)return"team"===e.planSelection||r?a:pe({...e,skip:!0,userPersona:void 0,userRole:void 0,companySize:void 0,useCases:[],categories:[],previousStage:"workspace_plan_choose",spaceName:void 0,stage:"persona_survey",collaborativeIntent:void 0},t);{if("team"===e.planSelection)return a;const o={userRole:void 0,companySize:void 0,...e,spaceJoinOrCreate:"create",useCases:[],categories:[],stage:"workspace_create",spaceIcon:null,uploadingSpaceIcon:!1},{onboardingData:r}=e,n=B().Z.getIntl(),i=r.userStore.getFullName(n),s=r.userStore.getProfilePhoto();if("planSelection"in e&&["personal","school"].includes(e.planSelection||"")&&i){return me({...o,userPersona:e.userPersona||"unfilled",spaceName:te().eW(i,n),spaceIcon:s||null,useCases:e.useCases},t)}return o}}async function me(e,t){const{flow:o,spaceJoinOrCreate:r,onboardingData:n}=e,a=z().default.DO_NOT_USE_markLegacy("onboarding.create_space"),{spaceStore:i,spaceViewStore:s,...c}=await we(e,t);if(te().At({environment:t,state:{...e,userEducationRole:void 0,userEducationLevel:void 0,notionUseFrequency:void 0},spaceStore:i,spaceViewStore:s}),"team"===e.planSelection){const o=te().lr(e.onboardingData),{spaceId:r,inviteLinkCode:n}=c;if(z().default.DO_NOT_USE_measureLegacy(a,{environment:t,data:{flow:e.flow,onboarding_complete_data:{stage:e.stage,redirect_data:e.redirectData,is_new_user:te().rT(e),permission_level:"guest_redirect"===e.redirectData.type?"guest":"member",plan:e.planSelection}}}),e.collaborativeIntent&&"multiplayer"!==e.collaborativeIntent){return ge({...e,isChecked:!1,stage:"invite",isBulkInvite:!1,spaceSetupCompleted:!0,shouldTriggerPostInviteAnimations:!1,inviteLinkUrl:void 0,emails:[],spaceViewId:s.id,joinableUserEmailDomain:void 0,teamStoreId:void 0},t)}return{...e,...c,isChecked:!0,spaceId:r,emails:[],joinableUserEmailDomain:o,inviteLinkUrl:n&&(0,J().cJ)(t,r,n),stage:"invite",isBulkInvite:!1,shouldTriggerPostInviteAnimations:!1,spaceSetupCompleted:!0}}switch(o){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_joinable_spaces":case"desktop_redirect":const{spaceId:i,spaceViewId:d,redirectData:l}=c;if(e.collaborativeIntent&&"multiplayer"===e.collaborativeIntent){return{...e,isChecked:!1,stage:"invite",isBulkInvite:!1,spaceSetupCompleted:!0,shouldTriggerPostInviteAnimations:!1,inviteLinkUrl:void 0,emails:[],spaceViewId:s.id,joinableUserEmailDomain:void 0,teamStoreId:void 0}}return D().j({message:ie.navigatingToWorkspace}),await ve({environment:t,onboardingData:n,spaceId:i,spaceViewId:d,spaceJoinOrCreate:r,redirectData:l,onboardingFlow:o,onboardingState:e}),D().x(),z().default.DO_NOT_USE_measureLegacy(a,{environment:t,data:{flow:e.flow,onboarding_complete_data:{stage:e.stage,redirect_data:e.redirectData,is_new_user:te().rT(e),permission_level:"guest_redirect"===e.redirectData.type?"guest":"member",plan:e.planSelection}}}),{...e,spaceId:i,spaceViewId:d,flow:o,stage:"template_optout"};case"mobile_join_or_create_space":return fe(e.onboardingData,{...e,...c},t,a);case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":return Se({onboardingState:{...e,...c},environment:t,flow:o});default:return v().t1(o)}}async function ge(e,t){const o=z().default.DO_NOT_USE_markLegacy("invite_next_state");await te().SN(e,t);const{flow:r,isNewUser:n,trialId:a}=e;switch(r){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_joinable_spaces":if("team"!==e.planSelection)return await ve({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingState:e}),z().default.DO_NOT_USE_measureLegacy(o,{environment:t,data:{numInvitesSent:e.emails.length}}),{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};return n&&"perfmark"===a||(0,H().TN)(t)?(await ve({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingState:e}),z().default.DO_NOT_USE_measureLegacy(o,{environment:t,data:{numInvitesSent:e.emails.length}}),Ee(e,t)):{...e,stage:"timed_trial_upsell"};case"desktop_redirect":return await ve({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingState:e}),z().default.DO_NOT_USE_measureLegacy(o,{environment:t,data:{numInvitesSent:e.emails.length}}),"team"===e.planSelection?Ee(e,t):{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};case"mobile_join_or_create_space":const i=fe(e.onboardingData,e,t);return z().default.DO_NOT_USE_measureLegacy(o,{environment:t,data:{mobileOnboardingState:r}}),i;case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":const s=Se({onboardingState:e,environment:t,flow:r});return z().default.DO_NOT_USE_measureLegacy(o,{environment:t,data:{mobileOnboardingState:r}}),s;default:return v().t1(r)}}async function _e(e,t){return await ve({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingState:e}),Ee(e,t)}async function fe(e,t,o,r){return await ve({environment:o,onboardingData:e,spaceId:t.spaceId,spaceViewId:t.spaceViewId,spaceJoinOrCreate:t.spaceJoinOrCreate,redirectData:t.redirectData,onboardingFlow:t.flow,onboardingState:t}),r&&z().default.DO_NOT_USE_measureLegacy(r,{environment:o,data:{flow:t.flow,onboarding_complete_data:{stage:t.stage,redirect_data:t.redirectData,is_new_user:te().rT(t),permission_level:"guest_redirect"===t.redirectData.type?"guest":"member"}}}),{isOnboarding:!1,isLoading:!1,currentUserId:o.currentUser.id}}function Se(e){const{onboardingState:t,environment:o,flow:r}=e;if("oauth_authorization_redirect"===t.redirectData.type){const{responseType:e,integrationId:r,redirectUri:n,state:a,owner:i,userId:s,spaceId:c}=t.redirectData;T().g({environment:o,responseType:e,integrationId:r,redirectUri:n,state:a,owner:i,userId:s,spaceId:c})}return{...t,flow:r,stage:"mobile_editor"}}async function ve(e){const{environment:t,redirectData:o,spaceViewId:r,spaceId:n,onboardingData:a,spaceJoinOrCreate:i,onboardingFlow:s,onboardingState:c}=e;await ye({environment:t,redirectData:o,spaceViewId:r,spaceId:n,onboardingData:a,spaceJoinOrCreate:i,onboardingFlow:s}),be({environment:t,spaceJoinOrCreate:i,permissionLevel:"member",onboardingState:c})}async function ye(e){const{environment:t,redirectData:o,spaceViewId:n,spaceId:a,onboardingData:i,spaceJoinOrCreate:s,onboardingFlow:u}=e;h().qL({bannerStore:Y().Z,id:"SubscriptionEditingBlocker"}),t.device.isMobile&&P().createAndCommit({userAction:"onboardingStateActions.navigateWithRedirectData",environment:t,canUndo:!0,perform:e=>{ae().Mf({userStore:i.userStore,transaction:e})}});const _=n?G().V9.createChildStore(i.userRootStore,{table:m().zU,id:n}):void 0,f=g().bT();if("fork_page"===o.type&&_)await M().y3({environment:t,spaceViewStore:_,redirectPageId:o.pageId,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:r().tY.Onboarding,navigationType:"joiningOrCreatingSpace"});else if(f&&!i.onboardingCompleted)g().B9(),U().c4({environment:t,url:f,redirect:!0});else if("home"===o.type&&null!=_&&_.isDefined()){const e=await k().callApi({eventName:"getUserHomePages",environment:t,data:{spaceViewId:_.id,spaceId:_.getSpaceId()},headers:(0,c().Bb)({cellId:void 0,recordId:_.id,spaceId:_.getSpaceId()})}),{recordMap:o,homePageId:n}="success"===e.type?{recordMap:d().RecordMapWithRole.create(e.data.recordMap),homePageId:e.data.homePageId}:{recordMap:void 0,homePageId:void 0},a=_.pointer;o&&O().Wl({environment:t,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,pointer:a,model:o.getModel(a),role:o.getRole(a)||"none",updatePaths:[["settings","personal_home"]],debugSource:"onboardingStateActions.navigateWithRedirectData",force:!0}),await M().y3({environment:t,redirectPageId:n,spaceViewStore:_,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:r().tY.Onboarding,navigationType:"joiningOrCreatingSpace"})}else if("redirect_page"===o.type&&o.spaceId===a&&_)await O().bG({environment:t,pointer:{table:l().iU,id:o.pageId},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,userId:t.currentUser.id}),await M().y3({environment:t,spaceViewStore:_,redirectPageId:o.pageId,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:r().tY.Onboarding,navigationType:"joiningOrCreatingSpace"});else if("redirect_space"===o.type&&o.spaceId===a&&_)await M().y3({environment:t,spaceViewStore:_,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:r().tY.Onboarding,navigationType:"joiningOrCreatingSpace"});else if("mobile_native_home"===o.type&&_)await M().y3({environment:t,spaceViewStore:_,redirectPageId:void 0,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:r().tY.Onboarding,navigationType:"joiningOrCreatingSpace"});else if("getting_started_page"!==o.type&&"redirect_space"!==o.type&&"performance_marketing_template"!==o.type||!_)if("oauth_authorization_redirect"===o.type&&"mobile_cold_start"!==u&&"mobile_joinable_spaces"!==u&&"mobile_redirect"!==u){const{responseType:e,integrationId:r,redirectUri:n,state:a,owner:i,userId:s,spaceId:c}=o;T().g({environment:t,responseType:e,integrationId:r,redirectUri:n,state:a,owner:i,userId:s,spaceId:c})}else if(_)await M().y3({environment:t,spaceViewStore:_,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:r().tY.Onboarding,navigationType:"joiningOrCreatingSpace"});else{if(!i.firstSpaceView)throw new Error(B().Z.formatMessage(ie.errorNoAction,{onboardingRedirectType:o.type}));await M().y3({environment:t,spaceViewStore:i.firstSpaceView,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:r().tY.Onboarding,navigationType:"joiningOrCreatingSpace"})}else{let e;if("getting_started_page"===o.type&&o.collectionId){const r=G().NW.createChildStore(_.getSpaceStore(),{table:p().vF,id:o.collectionId});e=(await(0,N()._z)({environment:t,collectionStore:r})).collectionViewBlockStore()}await M().y3({environment:t,spaceViewStore:_,redirectPageId:o.pageId,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:r().tY.Onboarding,navigationType:"joiningOrCreatingSpace",navigateToStore:e})}}function be(e){const{environment:t,onboardingState:o}=e;if(t.device.isElectron&&C().quickSearchRefresh(),!o.isOnboarding)return;const{onboardingData:{userStore:r}}=o;P().createAndCommit({userAction:"onboardingStateActions.setAndTrackOnboardingComplete",environment:t,canUndo:!0,perform:e=>{ae().Ex({userStore:r,transaction:e})}}),w().PL(t,{...te().jn(o),initial_workspace_type:"public"!==e.permissionLevel?e.spaceJoinOrCreate:void 0,permission_level:e.permissionLevel}),I().wk(t)}async function we(e,t){if("join"===e.spaceJoinOrCreate){D().j({message:ie.joiningWorkspace});const o=await ke({environment:t,onboardingData:e.onboardingData,redirectData:e.redirectData,spaceId:e.spaceId||"",isNewUserOnboarding:te().rT(e)});return D().x(),o}{D().j({message:ie.creatingWorkspace});const o=await Ie({environment:t,isNewUserOnboarding:te().rT(e),onboardingData:e.onboardingData,userPersona:e.userPersona,redirectData:e.redirectData,spaceName:e.spaceName,spaceIcon:e.spaceIcon,planSelection:e.planSelection,isPrivate:"team"!==e.planSelection,useCases:e.useCases,categories:e.categories,hasTrialId:Boolean(e.trialId),selectedWorkflowTemplates:[]}),r=e.isNewUser&&"perfmark"===e.trialId;if(!r&&(0,H().TN)(t)&&"team"===e.planSelection){await(0,Q().applyReversePlusTrial)(o.spaceId,t,"onboarding")&&(0,Z().ES)(t,"onboarding_reverse_trial_sidebar")}if(r&&e.planSelection&&te().rT(e)){const r=await Oe(o.spaceId,e.planSelection,t),{enableTrialInfoModal:n,enableTrialIneligibleToast:a}=r;n&&(0,X().D)({openedFrom:"onboarding"}),a&&re().Z.setState({open:!0,isExistingUser:!1})}return D().x(),o}}async function Ie(e){const{environment:t,onboardingData:o,userPersona:r,redirectData:n,spaceName:a,planSelection:i,spaceIcon:s,isPrivate:c,useCases:d,categories:l,isNewUserOnboarding:p,selectedWorkflowTemplates:u,collaborativeIntent:m}=e,g="team"===i?"team":"personal",_=z().default.DO_NOT_USE_markLegacy("create_space_with_templates"),{spaceStore:f,spaceViewStore:S,inviteLinkCode:v,teamStore:y}=await M().wh({environment:t,planType:g,name:a,userRootStore:o.userRootStore,analyticsFrom:"onboarding",icon:s||void 0,userPersona:r,collaborativeIntent:m});let b;oe().default.setState({...oe().default.state,spaceId:f.id}),await K().OR({environment:t,spaceId:f.id,isNewlyCreatedSpace:!0});let I=[],k={};if(te().VW(g)&&!o.performanceMarketingTerm){let e=[],o=[],r=[];"control"!==(0,W().hm)(t)?(r=[...u??[],...Ue(d)],e=d.includes("wikis")?[V().wikiAppTemplateUri]:[]):(e=(0,V().getAppTemplatePresetsForUseCases)(d),o=(0,ne().getPageTemplatesForUseCases)(d,B().Z.getIntl())),k={appTemplates:e,pageTemplates:o,workflowTemplates:r}}else{let e=[];e=o.performanceMarketingTerm?(0,ne().getPerformanceMarketingSearchTermTemplates)(o.performanceMarketingTerm,B().Z.getIntl()):ne().getStarterTemplatesForSpace({environment:t,onboardingPlanType:i,categories:l,intl:B().Z.getIntl()}),e&&(I=e.map((e=>e.rootId))),k={pageTemplates:e}}b=await ne().createTemplatePagesInSpace({environment:t,redirectData:n,spaceViewStore:S,userSettingsStore:o.userSettingsStore,userRootStore:o.userRootStore,isPrivate:c,templatesToCreateInSpace:k,planType:g,spaceJoinOrCreate:"create",teamStore:y,useCases:d,userPersona:r,isNewUserOnboarding:p}),w().vd(t,{plan_selection:i,user_persona:r,initial_workspace_type:"create",space_id:f.id,onboarding_templates:I}),z().default.DO_NOT_USE_measureLegacy(_,{environment:t,data:{}});const h=Ce(n,b,t),C="pageId"in h?h.pageId:void 0;return F().default.setState({...F().default.state,onboardingData:{...o,redirectPageId:C}}),{redirectData:h,spaceId:f.id,spaceViewId:S.id,inviteLinkCode:v,spaceStore:f,spaceViewStore:S,teamStoreId:null==y?void 0:y.id}}async function ke(e){const{environment:t,onboardingData:o,spaceId:r,redirectData:n,isNewUserOnboarding:a}=e,i="team_invite_redirect"===n.type?n.inviteCode:void 0,{spaceViewStore:s}=await M().j({environment:t,spaceId:r,userRootStore:o.userRootStore,analyticsFrom:"onboarding",userSettingsStore:o.userSettingsStore,inviteCode:i,isOnboarding:!0});q().default.state.currentSpaceStore||q().default.setState({...q().default.state,currentSpaceStore:s.getSpaceStore()});const c=ne().getStarterTemplatesForSpace({environment:t,onboardingPlanType:"team",categories:[],isJoiner:!0,intl:B().Z.getIntl()}),d=await ne().createTemplatePagesInSpace({environment:t,redirectData:n,spaceViewStore:s,isPrivate:!0,userSettingsStore:o.userSettingsStore,userRootStore:o.userRootStore,templatesToCreateInSpace:{pageTemplates:c},planType:"team",spaceJoinOrCreate:"join",useCases:[],userPersona:"unfilled",isNewUserOnboarding:a});w().e7(t,{initial_workspace_type:"join",space_id:r,onboarding_templates:null==c?void 0:c.map((e=>e.rootId))});return{redirectData:Ce(n,d,t),spaceId:r,spaceViewId:s.id,inviteLinkCode:void 0,spaceStore:void 0,spaceViewStore:s,teamStoreId:void 0}}async function he(e,t){const o=await async function(e,t){const o="spaceId"in e.redirectData&&e.redirectData.spaceId,{onboardingData:r,redirectData:n}=e;if(o){const a=await ke({environment:t,onboardingData:r,redirectData:n,spaceId:o,isNewUserOnboarding:te().rT(e)});return{...e,...a,spaceId:o}}if("fork_page"===n.type){const o=x().o(r.userRootStore);if(o.length>0){const a=o[0].getSpaceId();if(a){const i=G().H2.createChildStore(r.userRootStore,{table:u().bx,id:a}),s=Ce(n,await A().ux({environment:t,userRootStore:r.userRootStore,isPrivate:!0,forkedPageId:n.pageId,spaceStore:i,spaceViewStore:o[0]}),t);return{...e,redirectData:s,spaceViewId:o[0].id,spaceId:a}}}}return e}(e,t);return fe(e.onboardingData,o,t)}function Ce(e,t,o){if(t){if("redirect_space"===e.type)return{type:e.type,pageId:t.id,spaceId:e.spaceId};if("getting_started_page"===e.type)return te().Ck(o)?{type:"mobile_native_home"}:{type:e.type,pageId:t.id};if("fork_page"===e.type)return{type:e.type,pageId:t.id};if("performance_marketing_template"===e.type)return{type:e.type,pageId:t.id}}return e}async function De(e,t,o,r){const{onboardingData:n}=e,a=z().default.DO_NOT_USE_markLegacy("onboarding.join_space");if("guest"===o){if(be({environment:r,spaceJoinOrCreate:"join",permissionLevel:o,onboardingState:e}),"team_invite_redirect"===t.type)throw new Error("Cannot invite guests to workspace from invite links.");await M().j({environment:r,spaceId:t.spaceId,userRootStore:n.userRootStore,analyticsFrom:"onboarding",userSettingsStore:n.userSettingsStore,navigate:!0,redirectPageId:t.pageId})}else{const o=await ke({environment:r,onboardingData:n,redirectData:t,spaceId:t.spaceId,isNewUserOnboarding:te().rT(e)});await ve({environment:r,onboardingData:n,spaceId:o.spaceId,spaceViewId:o.spaceViewId,spaceJoinOrCreate:"join",redirectData:o.redirectData,onboardingFlow:e.flow,onboardingState:e})}return z().default.DO_NOT_USE_measureLegacy(a,{environment:r,data:{flow:e.flow,onboarding_complete_data:{stage:e.stage,redirect_data:t,is_new_user:te().rT(e),permission_level:o}}}),{isOnboarding:!1,isLoading:!1,currentUserId:r.currentUser.id}}function Te(e){let t;e.onboardingData.isEducationPlanEligible&&(t="student");const{function:o}=(0,J().kO)();return o&&(t=o),{userPersona:t}}async function Oe(e,t,o){let r=!1,n=!1;const i=await k().callApi({eventName:"checkAndApplyPerfmarkTrial",environment:o,data:{spaceId:e}});if("success"===i.type){const e="success"===i.data.status;(0,L().j)({environment:o,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:"perfmark",success:e,planType:t,..."error"===i.data.status&&{reason:i.data.reason}}}}),y().QF(o,{trial_id:"perfmark",success:e,planType:t,domainType:(0,j().JF)()}),"success"===i.data.status?r=!0:n=!0}else(0,L().j)({environment:o,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:"perfmark",success:!1,planType:t,reason:i.error.name}}}),y().QF(o,{trial_id:"perfmark",success:!1,planType:t}),a().log({level:"error",from:"onboardingActions",type:"applyPerfmarkTrialError",error:(0,S().Ui)(i.error)});return(0,$().XG)(),{enableTrialInfoModal:r,enableTrialIneligibleToast:n}}function Ee(e,t,o,r){return"create"===e.spaceJoinOrCreate&&e.isNewUser&&!o&&ee().default.setState({type:"team_creator",step:"welcome",initialTeamStoreId:e.teamStoreId}),"modal"===o&&(0,X().D)({openedFrom:"onboarding"}),"sidebar"===o&&(0,Z().ES)(t,"onboarding_reverse_trial_sidebar"),r&&re().Z.setState({open:!0,isExistingUser:!1}),{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id}}function Ue(e){return e.map((e=>Me(e))).filter((e=>void 0!==e))}function Me(e){switch(e){case"docs":return"docsCollection";case"project":return"projectsCollection";case"notes":return"meetingNotesCollection";case"goals":return"goalsCollection";default:return}}},913011:(e,t,o)=>{o.d(t,{H:()=>p});o(821057);var r=()=>o(792197),n=()=>o(308240),a=()=>o(215134),i=()=>o(6623),s=()=>o(639708),c=()=>o(269299),d=()=>o(655260),l=()=>o(772669);function p(e){let{environment:t,transaction:o,layoutStore:p,position:u,sessionId:m,beforePerformDeleteModule:g}=e;const _=p.getModules();if(!_)throw new Error("[deleteModuleAtPosition] modules by area not found for layout store");const f=(0,a().h7)(_,(e=>e.id===u.moduleId));if(!f)throw new Error("[deleteModuleAtPosition] module to delete not found");const{module:S,position:v}=f;if(!(0,i().Fo)(S))throw new Error("[deleteModuleAtPosition] module to delete is not removeable");var y;(c().createAndCommitOrAppend({environment:t,transaction:o,canUndo:!0,perform(e){!function(e){const{transaction:t,layoutStore:o,moduleLocation:a,moduleToDelete:i,beforePerformDeleteModule:d}=e;d&&d(t);(0,s().Fc)(i)&&(0,l().deleteViewsModuleDependencies)({layoutStore:o,viewsModule:i,transaction:t});if("form_conditional_modules"===a.area){const e=r().CI.removeChildModule({pointer:o.pointer,modulesByArea:o.getModules(),module:i});for(const r of e)c().applyOperation({transaction:t,store:o,operation:r})}else{const e="views_main_tab_modules"===a.area?{area:a.area,viewId:a.viewId}:{area:n().mt[a.area]};c().applyOperation({transaction:t,store:o,operation:r().CI.deleteModuleInArea({...e,pointer:o.pointer,moduleId:i.id})})}}({environment:t,transaction:e,layoutStore:p,moduleLocation:v,moduleToDelete:S,beforePerformDeleteModule:g})},userAction:"pageLayout.deleteActions.deleteModuleAtPosition"}),m)&&d().DZ({environment:t,module:S,sessionId:m,collectionId:null===(y=p.getCollectionModel())||void 0===y?void 0:y.id,layoutId:p.id,context:(0,n().AR)(u.area),area:u.area})}},142730:(e,t,o)=>{o.d(t,{IR:()=>O,L0:()=>U,MF:()=>E,gm:()=>M,iQ:()=>A,m2:()=>C});o(821057),o(492176),o(7961),o(267602),o(653476);var r=()=>o(956057),n=()=>o(530980),a=()=>o(308240),i=()=>o(215134),s=()=>o(667932),c=()=>o(137785),d=()=>o(639708),l=()=>o(483791),p=()=>o(593515),u=()=>o(82937),m=()=>o(497065),g=()=>o(269299),_=()=>o(887430),f=()=>o(487270),S=()=>o(793935),v=()=>o(876822),y=()=>o(482162),b=()=>o(826955),w=()=>o(26796),I=()=>o(913011),k=()=>o(655260),h=()=>o(356117);function C(e){let{environment:t,transaction:o,collectionStore:r,userId:a,modules:i}=e;const c=(0,f().Ii)({environment:t,spaceId:r.getSpaceId(),table:l().Bh}),d=b().t1.createChildStore(r,c),{model:p,operations:[u]}=n().rp4.create({pointer:c,parent:r.pointer,createdByUserId:a,modules:i??(0,s()._P)()});g().applyOperation({transaction:o,store:d,operation:u});const m=n().kj1.setLayout(r.pointer,c);return g().applyOperation({transaction:o,store:r,operation:m}),{model:p,store:d}}function D(e){let t;return e?t=e:y().default.state.open&&y().default.state.targetStore?t=y().default.state.targetStore:v().default.state.mainEditorCurrentBlockStore&&(t=v().default.state.mainEditorCurrentBlockStore),t}function T(e){S().setUpdateExpand({environment:e,isExpanded:!1,from:"keyboard_default",saveDetailsSidebarPreference:!1}),u().xv({environment:e,from:"open_page_layout_editor",preventAnimation:!0})}function O(e){var t,o;let{environment:n,blockStore:a,collectionStore:i,collectionViewStore:s,from:c,initialSelectedModuleType:d}=e;const l=function(e){var t;let o=D(e);if(null!==(t=o)&&void 0!==t&&t.isCollectionView()){const e=(0,_().fm)(o);o=e?e.resultsInViewOrder(1).at(0):void 0}return o}(a),p=window.location.href;T(n);const u=r().Il();w().Z.setState({isOpen:!0,mode:"layout-editor",collectionStore:i,pageStore:l,siteRootBlockStore:void 0,sessionId:u,initialSelectedModuleId:null==l||null===(t=l.getAssociatedCollectionStore())||void 0===t||null===(t=t.getLayoutStore())||void 0===t||null===(t=t.getModel())||void 0===t||null===(t=t.firstRawModuleOfType(d??"titleWithIcon"))||void 0===t?void 0:t.id,urlOnOpen:p}),(0,k().Rt)({environment:n,from:c,context:"layout",sessionId:u,collectionId:null==i?void 0:i.id,existingLayoutId:null==i||null===(o=i.getLayoutStore())||void 0===o?void 0:o.id,collectionViewId:null==s?void 0:s.id})}function E(e){let{environment:t,store:o,siteRootBlockStore:n,from:a}=e;const i=D(o);T(t);const s=r().Il();w().Z.setState({isOpen:!0,mode:"site-settings-editor",collectionStore:void 0,pageStore:i,siteRootBlockStore:n,sessionId:s}),(0,k().Rt)({environment:t,context:"site",from:a,sessionId:s,collectionId:void 0,existingLayoutId:void 0})}function U(e){w().Z.getState().isOpen&&M(e)}function M(e){let{environment:t}=e;const o=w().Z.getState();if(!o.isOpen)throw new Error("Cannot close page layout editor. Page layout editor is not open.");"layout-editor"===o.mode&&o.urlOnOpen&&window.location.href!==o.urlOnOpen&&m().op(t),w().Z.setState({isOpen:!1})}function A(e){var t;let{environment:o,transaction:r,property:n,layoutStore:s}=e;const l=w().Z.getSessionId(),u=null===(t=s.getModel())||void 0===t?void 0:t.getRawModules(),m=s.getCollectionModel();if(!u||!m)return;const g=b().NW.createChildStore(s,m.pointer),_=(0,i()._i)(u,(e=>"titleWithIcon"===e.type));if(_&&(0,d().p9)(_.module)){var f;const{module:e,position:t}=_,i={...e,type:"titleWithIcon",propertyIds:null===(f=e.propertyIds)||void 0===f?void 0:f.filter((e=>e!==n))};(0,h().Uq)({environment:o,sessionId:l,transaction:r,layoutStore:s,position:{area:(0,a().Gc)(t.area),moduleId:e.id},updatedModule:(0,c().V)(i)})}const S=(0,i().MI)(u,(e=>"property"===e.type&&e.propertyId===n));for(const{module:i,position:c}of S){const e=i.id,t=(0,a().Gc)(c.area);(0,I().H)({environment:o,sessionId:l,transaction:r,layoutStore:s,position:{area:t,moduleId:e}})}const v=m.getFormat().collection_page_sections;if(v){const e=v.filter((e=>e.section!==n));p().Do({store:g,pageSectionFormats:e,transaction:r,environment:o})}}},356117:(e,t,o)=>{o.d(t,{Uq:()=>m,Wb:()=>_});o(821057),o(267602),o(470928),o(30005);var r=()=>o(109477),n=()=>o(530980),a=()=>o(308240),i=()=>o(712185),s=()=>o(215134),c=()=>o(667932),d=()=>o(639708),l=()=>o(827370),p=()=>o(421654),u=()=>o(269299);function m(e){let{environment:t,transaction:o,layoutStore:r,position:c,updatedModule:d,sessionId:l}=e;const p=a().mt[c.area],m=r.getRawModules();if("form_conditional_modules"===p){const e=null==m?void 0:m[p];if(!(null==e?void 0:e[c.moduleId]))throw new Error("Unable to find module being updated.");return void u().createAndCommitOrAppend({environment:t,transaction:o,canUndo:!0,perform(e){u().applyOperation({transaction:e,store:r,operation:n().CIp.updateNestedModule(r.pointer,p,(0,i().cm)(d))})},userAction:"BuilderLayoutModules.updateModule"})}if(!m)throw new Error("Unable to find modules");const g=(0,s().mT)(m,(e=>e.id===c.moduleId));if(!g||g.area!==p)throw new Error("Unable to find module being updated.");u().createAndCommitOrAppend({environment:t,transaction:o,canUndo:!0,perform(e){u().applyOperation({transaction:e,store:r,operation:n().CIp.updateModuleInArea({pointer:r.pointer,module:(0,i().cm)(d),..."views_main_tab_modules"===g.area?{area:g.area,viewId:g.viewId}:{area:g.area}})})},userAction:"BuilderLayoutModules.updateModule"})}function g(e){var t,o,r;let{collectionStore:n,layoutStore:a}=e;const i=new Map,s=n.getFormat(),c=[...null===(t=a.getModules())||void 0===t?void 0:t.page_main,...null===(o=a.getModules())||void 0===o?void 0:o.page_details],l=new Map;null===(r=s.property_visibility)||void 0===r||r.forEach((e=>{l.set(e.property,e)})),c.forEach((e=>{if(!(0,d().LP)(e))return(0,d().f)(e)?(i.set(e.propertyId,{property:e.propertyId}),void l.set(e.propertyId,{property:e.propertyId,visibility:"show"})):void 0;e.propertyIds.forEach((e=>{i.set(e,{property:e}),l.set(e,{property:e,visibility:"show"})}))}));const p=n.getNormalizedPropertyGroups();var u;p?p.forEach((e=>{var t;null===(t=e.propertyIds)||void 0===t||t.forEach((e=>{i.has(e)||i.set(e,{property:e})}))})):null===(u=s.collection_page_properties)||void 0===u||u.forEach((e=>{i.has(e.property)||i.set(e.property,e)}));return{propertiesFormat:Array.from(i.values()),propertyVisibility:Array.from(l.values())}}function _(e){let{environment:t,transaction:o,collectionStore:a,layoutStore:i}=e;const{propertiesFormat:s,propertyVisibility:m}=g({collectionStore:a,layoutStore:i});u().createAndCommitOrAppend({environment:t,transaction:o,canUndo:!0,perform(e){const t=i.getBlockChildrenPointers(),o=i.getFormat(),g=i.firstModuleOfType("viewsMain");g&&(0,d().aJ)(g)&&t.find((e=>l().dr.isEqual(e,g.collection_view_block_pointer)))&&u().applyOperation({transaction:e,store:i,operation:n().CIp.removeBlockChild(i.pointer,g.collection_view_block_pointer.id)});const _=null==o?void 0:o.previousViewsMainCollectionViewBlockPointer,f=_&&t.find((e=>l().dr.isEqual(e,_)));f&&u().applyOperation({transaction:e,store:i,operation:n().CIp.removeBlockChild(i.pointer,f.id)}),u().applyOperation({transaction:e,store:i,operation:n().CIp.setModulesByAreas(i.pointer,(0,c()._P)())}),u().applyOperation({transaction:e,store:i,operation:n().CIp.deleteFormat(i.pointer)});const S=a.getFormat(),{page_section_visibility:v}=S;p().FH({stores:[a],update:{property_groups:void 0,collection_page_properties:s,property_visibility:m,...v?{page_section_visibility:r().dN}:void 0},transaction:e})},userAction:"BuilderLayoutModules.resetLayoutToDefault"})}},772669:(e,t,o)=>{o.r(t),o.d(t,{deleteViewsModuleDependencies:()=>i});var r=()=>o(349220),n=()=>o(332542),a=()=>o(826955);function i(e){const{layoutStore:t,viewsModule:o,transaction:i}=e,s=(0,r().TO)(a().G.createChildStore(t,o.collection_view_block_pointer));n().hr({childStore:s,parentStore:t,transaction:i})}},548919:(e,t,o)=>{o.d(t,{D:()=>a,Qk:()=>s,we:()=>i});var r=()=>o(873463),n=()=>o(914575);function a(e){n().Z.setState({open:!0,...e})}function i(){n().Z.setState({open:!1})}function s(e){r().Z.setState({open:!0,...e})}},873463:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o(263184).default.createValue({open:!1},{name:"TrialEndModalStore"})},914575:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o(263184).default.createValue({open:!1},{name:"TrialInfoModalStore"})},877727:(e,t,o)=>{o.d(t,{QZ:()=>i,SV:()=>n,mq:()=>a});var r=()=>o(749826);function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r().default.checkGate({gateName:"workflow_templates_settings_dev",disableExposureLogging:e.disableExposureLogging})&&r().default.checkGate({gateName:"packaging_m3.1",disableExposureLogging:e.disableExposureLogging})}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r().default.checkGate({gateName:"packaging_m3.1",disableExposureLogging:e.disableExposureLogging})}function i(e){return!e.device.isPhone}},999582:(e,t,o)=>{o.d(t,{Z:()=>a});class r extends(()=>o(263184))().default{getInitialState(){return{}}}const n=new r;o(947115).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",n);const a=n},29488:(e,t,o)=>{function r(e){return`${e.table}:${e.id}`}o.d(t,{O:()=>r})},157955:(e,t,o)=>{o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>E,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>I,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>w,MAX_RECURRENCE_INTERVAL:()=>f,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>S,RRULE_WEEKDAYS_MAP:()=>_,convertFromUnpersistedRecurrenceConfig:()=>P,convertToUnpersistedRecurrenceConfig:()=>U,getFormattedEndCondition:()=>O,getFormattedNextRecurrenceTime:()=>T,getNewEndTimestamp:()=>M,getNextDateUtc:()=>D,getRecurrenceAfter:()=>h,isRunningBetweenMidnightAnd3AM:()=>C,isValidRecurrenceInterval:()=>v,isValidRecurrenceNumberOfRuns:()=>y,rruleFromRecurrence:()=>b,templateAncestorsViolateRecurrenceNesting:()=>k});o(267602),o(653476),o(241792);var r=()=>o(730120);o(670560);function n(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),r=1;r<t;r++)o[r-1]=arguments[r];if(0===o.length)return e.map((e=>[e]));const a=[];for(const i of e)a.push(...n(o[0],...o.slice(1)).map((e=>[i,...e])));return a}var a=()=>o(696459),i=()=>o(326966),s=()=>o(803021),c=()=>o(646574),d=()=>o(998411),l=()=>o(578292);class p extends(()=>o(484885))().Ci{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var u=()=>o(494616);const m=(0,o(788860).vU)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12–3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),g={day:p.DAILY,week:p.WEEKLY,month:p.MONTHLY,year:p.YEARLY},_={MO:p.MO,TU:p.TU,WE:p.WE,TH:p.TH,FR:p.FR,SA:p.SA,SU:p.SU},f=99,S=999;function v(e){return(0,i().hj)(e)&&Number.isInteger(e)&&e>0&&e<=f}function y(e){return(0,i().hj)(e)&&Number.isInteger(e)&&e>0&&e<=S}function b(e){const{start_date:t,frequency:o,interval:r,weekdays:i,timezone:c,hour:d,minute:l}=e,u="week"===o&&i?i.map((e=>_[e])):void 0,m={};return(0,a().$K)(e.end_condition)&&("date"===e.end_condition.type?m.until=(0,s().pd)(e.end_condition.end_at):"number"===e.end_condition.type?m.count=e.end_condition.number_of_occurrences:(0,a().t1)(e.end_condition)),"month"===e.frequency&&(0,a().$K)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?m.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?m.byweekday=n(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,o]=e;return _[t].nth(o)})):(0,a().t1)(e.monthly_restriction)),new p({freq:g[o],dtstart:(0,s().pd)(t),interval:r,byweekday:u,tzid:c,byhour:d??0,byminute:l??0,bysecond:0,...m})}const w=1,I=1;function k(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const o=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),r=e.length,n=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,a=r>w,i=o.length>=I;return{violatesConstraint:a||i,templateNestingExceedsMaxDepth:a,ancestorHasDailyTemplate:i,nestedDepthOfAutomationAncestors:r,immediateAncestorRecurrenceType:n}}function h(e){const{recurrence:t,afterDate:o}=e;if((0,u().nA)(t)){const e=(0,s().kq)(o);return t.start_date>=e?new Date(t.start_date):void 0}{const e=b(t).after((0,s().pd)(o));if(!e)return;return(0,s().YL)(e)}}function C(e){return 0===e.hour||1===e.hour||2===e.hour}function D(e){return b(e).after((0,s().pd)((0,s().Jh)()))||void 0}function T(e){const{recurrence:t,intl:o}=e,n=D(P(t));if(!n)return;const a=C(t),i=r().ou.fromJSDate(n).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,l().E2)(o)).setZone(t.timezone),s=(0,c().p6)({date:i,dateFormat:"relative",allowRelativeDates:!0,intl:o,shortenDate:!0});if(a)return o.formatMessage(m.dateBetweenMidnightAnd3AM,{date:s});{let e=i.toLocaleString(r().ou.TIME_SIMPLE);return t.timezone!==(0,d().r)()&&(e+=` ${i.toFormat("ZZZZ")}`),o.formatMessage(m.dateAtTime,{date:s,time:e})}}function O(e,t){return(0,a().$K)(e)?"number"===e.type?t.formatMessage(m.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,c().p6)({date:r().ou.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().t1)(e):t.formatMessage(m.noEndCondition)}const E=100;function U(e){return{...e,start_date:(0,s().kq)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,s().kq)(e.end_condition.end_at)}:(0,a().t1)(e.end_condition):void 0}}function M(e,t,o){return e.plus(o-t)}function A(e,t){const o=r().ou.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,s().Jh)(o.toJSDate())}}function P(e){return{...e,start_date:(0,s().Jh)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?A(e,e.end_condition):(0,a().t1)(e.end_condition):void 0}}},519454:(e,t,o)=>{o.d(t,{R:()=>n});o(667294);var r=o(785893);const n=(0,o(827282).IU)("pencil",{viewBox:"0 0 16 16",svg:(0,r.jsx)("path",{d:"M3.926 13.307H14.11c.183 0 .34-.066.472-.199a.644.644 0 00.198-.471.652.652 0 00-.198-.479.644.644 0 00-.472-.198H5.272l-1.346 1.347zm-.704-.636l7.683-7.684-1.312-1.319-7.69 7.684-.67 1.606c-.037.1-.017.191.06.273.083.082.174.105.274.069l1.655-.63zm8.34-8.326l.738-.732c.182-.187.278-.376.287-.567.009-.192-.068-.374-.232-.547l-.267-.267c-.169-.168-.351-.246-.547-.232-.196.014-.385.11-.567.287l-.739.732 1.327 1.326z"})})},667932:(e,t,o)=>{o.d(t,{KD:()=>c,_I:()=>d,_P:()=>p,l2:()=>u,x9:()=>l});o(267602),o(653476),o(241792);var r=()=>o(543172),n=()=>o(210349),a=()=>o(639708),i=()=>o(712185);const s={page_main:[{id:"cover",type:"cover"},{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyIds:[]},{id:"properties",type:"properties"},{id:"discussions",type:"discussions"},{id:"editor",type:"editor"}],page_details:[],form_layout_schema:[]},c={page_main:[{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyIds:[]},{id:"editor",type:"editor"}],page_details:[],form_layout_schema:[]},d={page_main:[{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyIds:[]},{id:"editor",type:"editor"},{id:"discussions",type:"discussions"}],page_details:[],form_layout_schema:[]};function l(e){return(0,i().Dl)({modulesByArea:s,collectionSchema:null==e?void 0:e.collectionSchema,collectionFormat:null==e?void 0:e.collectionFormat})}function p(){return{page_layout_schema:(0,i().L0)(s.page_main).map((e=>{if(!(0,a().zP)(e))return(0,n().T)(e)?{...e,id:(0,r().ZP)()}:e})).filter((e=>void 0!==e)),page_info_layout_schema:(0,i().L0)(s.page_details).map((e=>{if(!(0,a().zP)(e))return(0,n().T)(e)?{...e,id:(0,r().ZP)()}:e})).filter((e=>void 0!==e)),form_layout_schema:void 0}}function u(e,t){const o=void 0===t?[{id:(0,r().ZP)(),type:"formQuestion",formQuestionId:e}]:[{id:(0,r().ZP)(),type:"formQuestion",formQuestionId:e},{id:(0,r().ZP)(),type:"formQuestion",formQuestionId:t}];return{page_layout_schema:void 0,page_info_layout_schema:void 0,form_layout_schema:[{id:(0,r().ZP)(),type:"cover"},{id:(0,r().ZP)(),type:"formTitle"},...o,{id:(0,r().ZP)(),type:"formSubmit"}]}}},210349:(e,t,o)=>{o.d(t,{T:()=>i,s:()=>a});const r={normalizedTitleWithIcon:!0,properties:!0,property_number:!0,property_title:!0,property_person:!0,property_file:!0,property_text:!0,property_checkbox:!0,property_url:!0,property_email:!0,property_phone_number:!0,property_created_by:!0,property_last_edited_by:!0,property_button:!0,property_select:!0,property_multi_select:!0,property_status:!0,property_date:!0,property_created_time:!0,property_last_edited_time:!0,property_last_visited_time:!0,property_relation:!0,property_rollup:!0,property_formula:!0,property_auto_increment_id:!0,property_location:!0,property_verification:!0,property_geo_point:!0,views:!0,viewsMain:!0,relationsGroup:!0,formQuestion:!0,placeholder:!0,deleted_property:!1,cover:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,editor:!1,transcript:!1,formTitle:!1,formSubmit:!1},n={properties:!0,property:!0,relationsGroup:!0,formQuestion:!0,placeholder:!0,titleWithIcon:!0,cover:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,editor:!1,transcript:!1,formTitle:!1,formSubmit:!1,views:!0,viewsMain:!0,collectionView:!0,collectionViewV2:!0};function a(e,t){return r[e.type]}function i(e){return n[e.type]}},6623:(e,t,o)=>{o.d(t,{Fo:()=>a,m7:()=>i});const r={property_number:!0,property_title:!0,property_person:!0,property_file:!0,property_text:!0,property_checkbox:!0,property_url:!0,property_email:!0,property_phone_number:!0,property_created_by:!0,property_last_edited_by:!0,property_button:!0,property_select:!0,property_multi_select:!0,property_status:!0,property_date:!0,property_created_time:!0,property_last_edited_time:!0,property_last_visited_time:!0,property_relation:!0,property_rollup:!0,property_formula:!0,property_auto_increment_id:!0,property_location:!0,property_verification:!0,property_geo_point:!0,deleted_property:!1,relationsGroup:!0,formSubmit:!0,formQuestion:!0,formTitle:!0,placeholder:!0,transcript:!0,cover:!1,normalizedTitleWithIcon:!1,properties:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,editor:!1,views:!0,viewsMain:!1},n={property_number:!0,property_title:!0,property_person:!0,property_file:!0,property_text:!0,property_checkbox:!0,property_url:!0,property_email:!0,property_phone_number:!0,property_created_by:!0,property_last_edited_by:!0,property_button:!0,property_select:!0,property_multi_select:!0,property_status:!0,property_date:!0,property_created_time:!0,property_last_edited_time:!0,property_last_visited_time:!0,property_relation:!0,property_rollup:!0,property_formula:!0,property_auto_increment_id:!0,property_location:!0,property_verification:!0,property_geo_point:!0,deleted_property:!1,formSubmit:!1,formQuestion:!1,formTitle:!1,placeholder:!1,transcript:!1,cover:!1,normalizedTitleWithIcon:!1,properties:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,relationsGroup:!0,editor:!1,views:!1,viewsMain:!1};function a(e){return r[e.type]}function i(e){return n[e.type]}},856466:(e,t,o)=>{o.d(t,{$X:()=>i,F_:()=>s,iZ:()=>a});o(267602),o(470928);var r=()=>o(926724),n=()=>o(295617);const a={autoCompleteSprints:!1,actionConfig:{complete_sprint_action:"complete_sprint_and_move_incomplete_tasks_to_next_sprint"},recurrenceConfig:{interval:2,weekdays:["MO"]}};function i(e){const{eventTracker:t,properties:o}=e;t.DO_NOT_USE_commonTrackEvent({eventName:"complete_sprint_action",properties:o})}function s(e,t){var o;return null===(o=t.groups)||void 0===o||null===(o=o.find((t=>t.id===r().nl||(null==t?void 0:t.name)===n().RW||(null==t?void 0:t.name)===e.formatMessage(n().ct.statusGroupNameComplete))))||void 0===o?void 0:o.name}},126301:(e,t,o)=>{o.d(t,{DW:()=>s,IX:()=>i,Su:()=>n,rP:()=>a});var r=()=>o(730120);function n(e){if("week"===e.frequency&&e.weekdays&&1===e.weekdays.length)return{weekday:e.weekdays[0],duration:e.interval}}function a(e){const{currentSprintEndDate:t,sprintSchedule:o}=e;return c({startDate:l({dateToAdjust:r().ou.fromISO(t),weekday:o.weekday,wrapForEqualDays:!0}),duration:o.duration})}function i(e){const{userTimeZone:t,sprintSchedule:o}=e;return c({startDate:r().ou.local({zone:t}),duration:o.duration})}function s(e){const{currentSprintStartDate:t,sprintSchedule:o}=e,n=l({dateToAdjust:r().ou.fromISO(t),weekday:o.weekday,wrapForEqualDays:!1}),{end_date:a}=c({startDate:n,duration:o.duration});let i=r().ou.fromISO(a);const s=r().ou.now().startOf("day");for(;i.diff(s,"days").days<0;)i=i.plus({weeks:1});return{type:"daterange",start_date:i.plus({days:1}).minus({weeks:o.duration}).toISODate(),end_date:i.toISODate()}}function c(e){const{startDate:t,duration:o}=e,r=t.plus({weeks:o}).minus({days:1});return{type:"daterange",start_date:t.toISODate(),end_date:r.toISODate()}}const d={SU:0,MO:1,TU:2,WE:3,TH:4,FR:5,SA:6};function l(e){const{dateToAdjust:t,weekday:o,wrapForEqualDays:r}=e,n=p({currentWeekday:t.weekday%7,nextWeekday:d[o],wrapForEqualDays:r});return t.plus({days:n})}function p(e){const{currentWeekday:t,nextWeekday:o,wrapForEqualDays:r}=e,n="number"==typeof t?t:d[t],a="number"==typeof o?o:d[o];if(n===a)return r?7:0;let i=n,s=0;for(;i!==a;)i===d.SA?i=0:i+=1,s+=1;return s}}}]);