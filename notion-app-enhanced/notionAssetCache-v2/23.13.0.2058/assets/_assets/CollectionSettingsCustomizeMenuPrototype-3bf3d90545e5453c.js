"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[70586],{65503:(e,t,n)=>{n.r(t),n.d(t,{CollectionSettingsCustomizeMenuPrototype:()=>W});n(267602),n(653476);var o=n(667294),i=()=>n(219727),l=()=>n(142735),s=()=>n(846550),r=()=>n(353329),a=()=>n(146007),c=()=>n(205951),u=()=>n(446955),d=()=>n(466970),p=(n(821057),n(670560),n(470928),n(241792),()=>n(788860)),m=()=>n(696459),g=()=>n(255577),f=()=>n(388284);const h=(0,o.createContext)(void 0);function v(){const e=(0,o.useContext)(h);if(!e)throw new Error("useWorkflowTemplatesCustomizeContext must be used within a WorkflowTemplatesCustomizeContextProvider");return e}h.displayName="WorkflowTemplatesCustomizeContext";var y=()=>n(282224),S=()=>n(822909),x=()=>n(535645),T=()=>n(299728),w=()=>n(139224),C=()=>n(821159),k=()=>n(281236),F=()=>n(382474),b=()=>n(741119),j=n(785893);const I=["linked_collection","collection_view","property"],M={property:{getTitleFn:e=>e.formatMessage({id:"workflowFeatureGroupMenuItem.propertiesTitle",defaultMessage:"Properties"}),icon:n(150345).O,getCaptionFn:function(e){const t=e.getSchema();return _({collectionStore:e,featureType:"property",primitiveIds:Object.keys(t),getPrimitiveName:e=>{var n;return null===(n=t[e])||void 0===n?void 0:n.name}})},navigateFn:function(e){w().H4({collectionSettingsStore:e,item:{type:"properties",timelineViewTab:"timeline"}})},shouldRenderFn:()=>!0},collection_view:{getTitleFn:e=>e.formatMessage({id:"workflowFeatureGroupMenuItem.viewsTitle",defaultMessage:"Views"}),icon:n(708972).h,getCaptionFn:function(e){var t;const n=(null===(t=e.getParentBlockStore())||void 0===t?void 0:t.getCollectionViewStores())??[];return _({collectionStore:e,featureType:"collection_view",primitiveIds:n.map((e=>e.id)),getPrimitiveName:e=>{var t;return null===(t=n.find((t=>t.id===e)))||void 0===t?void 0:t.getName()}})},navigateFn:function(e){w().H4({collectionSettingsStore:e,item:{type:"views"}})},shouldRenderFn:()=>!0},linked_collection:{getTitleFn:e=>e.formatMessage({id:"workflowFeatureGroupMenuItem.linkedCollectionsTitle",defaultMessage:"Linked to"}),icon:n(545914).v,getCaptionFn:function(e){const t=O(e).map((e=>e.name));return(0,k().getWorkflowTemplateItemsCaption)(t)},navigateFn:function(e){w().H4({collectionSettingsStore:e,item:{type:"linked_collections"}})},shouldRenderFn:function(e){return O(e).length>0}}};function P(e){let{buttonMenuItemProps:t,featureGroupType:n}=e;const o=(0,p().YB)(),i=(0,s().yK)((()=>({iconContainer:{height:28,width:28,display:"flex",alignItems:"center",justifyContent:"center"},icon:{width:18,height:18}})),[]),{collectionStore:r,collectionSettingsStore:a}=(0,S().M)(),{getTitleFn:c,icon:u,getCaptionFn:d,navigateFn:m}=M[n],g=c(o),f=(0,l().VK)((()=>d(r)),[r,d]);return(0,j.jsx)(C().Y,{buttonMenuItemProps:t,title:g,caption:f,icon:(0,j.jsx)("div",{style:i.iconContainer,children:u(i.icon)}),right:(0,j.jsx)(b().K,{}),onClick:()=>m(a)})}function _(e){let{collectionStore:t,featureType:n,primitiveIds:o,getPrimitiveName:i}=e;if(0===o.length)return;const l=(0,F().cj)(t,n).map((e=>e.id)),s=[...o].sort(((e,t)=>l.indexOf(t)-l.indexOf(e))).map((e=>i(e))).filter(p().lm).filter((e=>e.length>0));return 0!==s.length?(0,k().getWorkflowTemplateItemsCaption)(s):void 0}function O(e){const t=e.getSchema();return Object.values(t).filter(p().lm).filter((e=>"relation"===e.type))}function U(){const{suggestedTemplates:e,legacyUnpackagedFeatureTemplates:t}=v(),n=function(){const e=function(){const{collectionTemplate:e,instantiatedTemplates:t}=v(),n=(null==e?void 0:e.value.templateItems.filter((e=>!0===e.isInSettings)).map((e=>e.pointer)))??[],o=[];for(const i of n){const e=t.find((e=>e.templateId===i));if(e){if(!(0,r().iI)(e))throw new Error("Template in settings must be feature templates");o.push(e)}}return o}(),{collectionStore:t,collectionContextStore:n}=(0,S().M)(),o=(0,i().O7)(),s=(0,l().VK)((()=>e.map((e=>(0,x().N)({template:e,isInSuggestedSection:!1,collectionContextStore:n,environment:o})))),[n,o,e]),{legacyUnpackagedFeatureTemplates:a}=v(),c=a.filter((e=>e.isInstalled)).map((e=>(0,T().z)({legacyUnpackagedFeatureTemplate:e,collectionContextStore:n}))),u=(0,l().VK)((()=>I.filter((e=>function(e){let{collectionStore:t,featureGroupType:n}=e;return M[n].shouldRenderFn(t)}({collectionStore:t,featureGroupType:e}))).map((e=>({key:e,action:()=>{},render:t=>(0,j.jsx)(P,{buttonMenuItemProps:t,featureGroupType:e})})))),[t]);return{key:"general",render:e=>(0,j.jsx)(f().Z,{...e,title:"General"}),items:[...s,...c,...u]}}(),o=(0,p().YB)(),{device:{isMobile:s}}=(0,i().O7)(),a=[...n.items.length>0?[n]:[],(0,y().n)({title:o.formatMessage({id:"workflowCustomizeList.suggestedSectionTitle",defaultMessage:"Suggested"}),templates:s?e.filter((e=>!("property"===e.type&&"relation"===e.value.type))):e,legacyUnpackagedFeatureTemplates:t.filter((e=>!e.isInstalled)),isSuggestedSection:!0})].filter(m().lm);return(0,j.jsx)(g().ZP,{disableInitialScroll:!0,type:g().iW.Vertical,initialFocus:void 0,resetFocusOnMouseOut:!0,sections:a})}var z=()=>n(810374),Z=()=>n(582835);function K(e){const t=[],n=Boolean((0,Z().wf)(e));t.push({type:"subitems",isInstalled:n});const o=Boolean((0,z().Xy)({feature:"timeline_arrows_by",collectionContextStore:e}));return t.push({type:"dependencies",isInstalled:o}),t}var V=()=>n(520186),N=()=>n(226413),G=()=>n(308186),H=()=>n(269299),B=()=>n(205228);var Y=()=>n(367404),R=()=>n(200528);function W(e){let{collectionTemplate:t}=e;const n=(0,i().O7)(),{collectionStore:o,collectionSettingsStore:p,collectionContextStore:m}=(0,S().M)(),g=(0,R().UL)(m),f=(0,d().E)("workflow_templates_builder"),{instantiatedTemplates:v,suggestedTemplates:y,legacyUnpackagedFeatureTemplates:x}=(0,l().VK)((()=>({instantiatedTemplates:(0,F().Bs)(n,o).filter(r().Zl),suggestedTemplates:(0,V().r)(n,o),legacyUnpackagedFeatureTemplates:K(m)})),[n,o,m]),T=(0,s().yK)((()=>({header:{display:"flex",alignItems:"center"},title:{overflow:"hidden",textOverflow:"ellipsis"},searchInput:{padding:4}})),[]);return t?(0,j.jsx)(c().ZP,{collectionSettingsStore:p,title:(0,j.jsx)("div",{style:T.header,children:(0,j.jsx)("div",{style:T.title,children:`Customize ${g}`})}),children:(0,j.jsxs)(h.Provider,{value:{collectionTemplate:t,instantiatedTemplates:v,suggestedTemplates:y,legacyUnpackagedFeatureTemplates:x},children:[(0,j.jsx)(U,{}),(0,j.jsx)(Y().xR,{collectionContextStore:m,collectionSettingsStore:p,children:f&&(0,j.jsx)(u().Z,{icon:a().r,onClick:()=>{!function(e){const{environment:t,collectionContextStore:n}=e,{env:o}=B().default;if("production"===o)return;const i=e=>{G().K(e,o)},l=n.collectionStore();if(!l)return void i("No collection store!");const s=l.getModel();if(!s)return void i("No collection model!");const r=[];H().createAndCommit({environment:t,userAction:"collectionFixingActions.fixCollection",canUndo:!0,perform(e){const t=s.getSchema()[N().iw];t&&"title"===t.type||(r.push("missing/malformed title property"),H().applyOperation({store:l,operation:{pointer:l.pointer,path:["schema",N().iw],command:"set",args:{type:"title",name:"Name"}},transaction:e}))}}),0===r.length?i("The database seems fine."):i(`Applied the following fixes: ${r.join(", ")}`)}({environment:n,collectionContextStore:m})},title:"Fix database (Dev)"})})]})}):null}},299728:(e,t,n)=>{n.d(t,{z:()=>g});n(667294);var o=()=>n(846550),i=()=>n(714230),l=()=>n(445520),s=()=>n(788860),r=()=>n(696459),a=()=>n(139224),c=()=>n(821159),u=()=>n(66417),d=()=>n(741119),p=()=>n(563452),m=n(785893);function g(e){let{legacyUnpackagedFeatureTemplate:t,collectionContextStore:n}=e;return{key:t.type,action:()=>{const e=n.settingsStore;switch(t.type){case"subitems":a().H4({collectionSettingsStore:e,item:{type:"subitemV2",from:"customize_menu"}});break;case"dependencies":a().H4({collectionSettingsStore:e,item:{type:"dependencies",from:"customize_menu"}});break;default:(0,r().t1)(t.type)}},render:e=>(0,m.jsx)(h,{legacyFeature:t,buttonMenuItemProps:e})}}function f(e,t,n){const o=t=>{const n={items:"items"};return{title:(0,m.jsx)(s()._H,{...(0,u().Gt)({feature:t,databaseType:void 0}),values:n}),caption:e.formatMessage((0,u().qi)({feature:t,databaseType:void 0}),n)}},a=t.accentColors.brown,c=e=>(0,m.jsx)("div",{style:{height:28,width:28,borderRadius:4,display:"flex",alignItems:"center",justifyContent:"center",background:n.isInstalled?void 0:a[30]},children:(0,m.jsx)(l().Z,{icon:e,theme:t,size:16,style:{fill:n.isInstalled?t.regularIconColor:a[400]}})});switch(n.type){case"subitems":return{...o("subitem"),icon:c(i().Z.images.appPackages.featureSubtasksSvg)};case"dependencies":return{...o("timeline_arrows_by"),icon:c(i().Z.images.appPackages.featureDependenciesSvg)};default:(0,r().t1)(n.type)}}function h(e){const{legacyFeature:t,buttonMenuItemProps:n}=e,i=(0,s().YB)(),l=(0,o().Fg)();return(0,m.jsx)(c().Y,{buttonMenuItemProps:n,...f(i,l,t),right:t.isInstalled?(0,m.jsx)(d().K,{}):(0,m.jsx)(p().a,{isAdded:!1})})}},282224:(e,t,n)=>{n.d(t,{n:()=>h});n(241792);var o=n(667294),i=()=>n(219727),l=()=>n(142735),s=()=>n(846550),r=()=>n(641772),a=()=>n(788860),c=()=>n(821159),u=()=>n(388284),d=()=>n(125659),p=()=>n(535645),m=()=>n(299728),g=n(785893);const f=3;function h(e){let{title:t,templates:n,legacyUnpackagedFeatureTemplates:h,isSuggestedSection:v,additionalItems:y=[]}=e;const S=(0,s().yK)((e=>({title:{color:e.mediumTextColor},iconContainer:{height:28,width:28,display:"flex",alignItems:"center",justifyContent:"center"},icon:{width:18,height:18,fill:e.mediumTextColor}})),[]),x=(0,d().Y$)(),T=(0,i().O7)(),[w,C]=(0,o.useState)(!1),k=[...(0,l().VK)((()=>n.map((e=>(0,p().N)({template:e,isInSuggestedSection:v,collectionContextStore:x,environment:T})))),[x,T,v,n]),...h.map((e=>(0,m().z)({legacyUnpackagedFeatureTemplate:e,collectionContextStore:x}))),...y];if(0===k.length)return;const F={key:`${t}-toggle-truncation`,action:()=>{C(!w)},render:e=>(0,g.jsx)(c().Y,{buttonMenuItemProps:e,title:(0,g.jsx)("div",{style:S.title,children:w?(0,g.jsx)(a()._H,{id:"useFeatureTemplatesSection.showLess",defaultMessage:"Show less"}):(0,g.jsx)(a()._H,{id:"useFeatureTemplatesSection.showMore",defaultMessage:"More"})}),icon:(0,g.jsx)("div",{style:S.iconContainer,children:(0,r().o)(S.icon)})})},b=w?k:k.slice(0,f);return{key:t,render:e=>(0,g.jsx)(u().Z,{...e,title:t}),items:[...b,...k.length>f?[F]:[]]}}},146007:(e,t,n)=>{n.d(t,{r:()=>i});n(667294);var o=n(785893);const i=(0,n(827282).IU)("bug",{viewBox:"0 0 64 64",svg:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("path",{d:"m32,8c-5.55,0-9,3.83-9,10h18c0-6.17-3.45-10-9-10Z"}),(0,o.jsx)("path",{d:"m48,36h12v-4h-12v-6.01c2.74-.06,4.78-.94,6.76-2.92l4.24-4.24-2.83-2.83-4.24,4.24c-1.3,1.3-2.41,1.76-4.24,1.76h-13.69v32c6.15,0,10.63-3.12,12.7-8.47l1.54,1.54c1.3,1.3,1.76,2.41,1.76,4.24v2.69h4v-2.69c0-2.9-.88-5.02-2.93-7.07l-3.26-3.26c.12-.95.19-1.94.19-2.98v-2Z"}),(0,o.jsx)("path",{d:"m12.07,20.24l-4.24-4.24-2.83,2.83,4.24,4.24c1.98,1.98,4.02,2.85,6.76,2.92v6.01H4v4h12v2c0,1.04.07,2.03.19,2.98l-3.26,3.26c-2.05,2.05-2.93,4.17-2.93,7.07v2.69h4v-2.69c0-1.83.46-2.95,1.76-4.24l1.54-1.54c2.08,5.35,6.55,8.47,12.7,8.47V22h-13.69c-1.83,0-2.95-.46-4.24-1.76Z"})]})})}}]);