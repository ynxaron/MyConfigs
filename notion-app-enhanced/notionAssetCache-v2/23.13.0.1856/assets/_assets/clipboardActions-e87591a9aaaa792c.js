"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[81480,39447,14705],{950874:(e,t,o)=>{o.r(t),o.d(t,{clipboardMessages:()=>xt,copy:()=>io,copyDirectLinkToContent:()=>Lo,copyFormattedLinkToBlock:()=>Bo,copyHtml:()=>Eo,copyLinkToBlock:()=>Po,copyLinksToBlocks:()=>Uo,copyString:()=>Vo,copyWithToast:()=>No,createSelectedMultiColumnBlockSubtree:()=>Jt,cutWithMaybeConfirmation:()=>no,getFormulaEditorInformation:()=>To,getInlineTextValueFromClipboardData:()=>Go,getInlineTitleValueFromClipboardTextHtml:()=>fo,getNotionSelectionClipboardData:()=>Qt,htmlToMultiTextSelectionClipboardData:()=>mo,insertOrTransformToCodeBlock:()=>Fo,markdownToBlocks:()=>_o,multiTextSelectionToMarkdown:()=>Wo,paste:()=>wo,pasteFilesForBlocks:()=>ro,pasteMarkdown:()=>uo,serializeMultiTextSelectionToClipboardData:()=>Xt,serializePagePropertiesAsText:()=>Kt,triggerBrowserCopy:()=>Oo});var n={};o.r(n),o.d(n,{clipboardMessages:()=>xt,copy:()=>io,copyDirectLinkToContent:()=>Lo,copyFormattedLinkToBlock:()=>Bo,copyHtml:()=>Eo,copyLinkToBlock:()=>Po,copyLinksToBlocks:()=>Uo,copyString:()=>Vo,copyWithToast:()=>No,createSelectedMultiColumnBlockSubtree:()=>Jt,cutWithMaybeConfirmation:()=>no,getFormulaEditorInformation:()=>To,getInlineTextValueFromClipboardData:()=>Go,getInlineTitleValueFromClipboardTextHtml:()=>fo,getNotionSelectionClipboardData:()=>Qt,htmlToMultiTextSelectionClipboardData:()=>mo,insertOrTransformToCodeBlock:()=>Fo,markdownToBlocks:()=>_o,multiTextSelectionToMarkdown:()=>Wo,paste:()=>wo,pasteFilesForBlocks:()=>ro,pasteMarkdown:()=>uo,serializeMultiTextSelectionToClipboardData:()=>Xt,serializePagePropertiesAsText:()=>Kt,triggerBrowserCopy:()=>Oo});o(670560),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(916054),o(653476),o(749411),o(30005),o(241792),o(731107),o(228244);var i=o.n(o(827856)),r=()=>o(66077),a=()=>o(492788),s=()=>o(816512),l=()=>o(506347),c=()=>o(156642),d=()=>o(226413),u=()=>o(135857),p=()=>o(455530),m=()=>o(659278),f=()=>o(922785),g=()=>o(374847),b=()=>o(569427),k=()=>o(225339),v=()=>o(22183),y=()=>o(177634),h=()=>o(799891),S=()=>o(942275),T=()=>o(998411),M=()=>o(459422),C=()=>o(956057),I=()=>o(526839),x=()=>o(321160),w=()=>o(225771),F=()=>o(665553),D=()=>o(530980),R=()=>o(481529),P=()=>o(396035),B=()=>o(981850),U=()=>o(217465),L=()=>o(827370),E=()=>o(375255),V=()=>o(572680),A=()=>o(396136),O=()=>o(752778),N=()=>o(602299),W=()=>o(81954),_=()=>o(245015),G=()=>o(955620),Y=()=>o(386616),Z=()=>o(572948),j=()=>o(727207),$=()=>o(426546),Q=()=>o(96642),H=()=>o(788860),z=()=>o(568017),J=()=>o(513670),K=()=>o(342792),q=()=>o(543172),X=()=>o(696459),ee=()=>o(916673),te=()=>o(406799),oe=()=>o(523709),ne=()=>o(324877),ie=()=>o(932753),re=()=>o(539410),ae=()=>o(205228),se=()=>o(718048),le=()=>o(872308),ce=()=>o(630903),de=()=>o(338530),ue=()=>o(718959),pe=()=>o(921995),me=()=>o(615676),fe=()=>o(845111),ge=()=>o(429725),be=()=>o(487270),ke=()=>o(123927),ve=()=>o(527278),ye=()=>o(191003),he=()=>o(271308),Se=()=>o(852465),Te=()=>o(339523),Me=()=>o(924390),Ce=()=>o(505462),Ie=()=>o(550054),xe=()=>o(10208),we=()=>o(472753),Fe=()=>o(156538),De=()=>o(156958),Re=()=>o(881688),Pe=()=>o(663132),Be=()=>o(495439),Ue=()=>o(876822),Le=()=>o(516623),Ee=()=>o(804217),Ve=()=>o(279386),Ae=()=>o(749826),Oe=()=>o(138912),Ne=()=>o(475335),We=()=>o(826955),_e=()=>o(965903),Ge=()=>o(127519),Ye=()=>o(807230),Ze=()=>o(491927),je=()=>o(54512),$e=()=>o(286310),Qe=()=>o(332079),He=(o(821057),o(470928),()=>o(843200)),ze=()=>o(163836),Je=()=>o(349220),Ke=()=>o(332542),qe=()=>o(643937),Xe=()=>o(239482),et=()=>o(321930),tt=()=>o(32969),ot=()=>o(893379),nt=()=>o(970105),it=()=>o(990966);function rt(e){var t;const{environment:o,clipboardData:n,transaction:i,allowPasteIntoHeaderWithoutChildren:r,selectAll:s,preventLegacyTransclusions:l}=e;if(Ge().default.isEditingComment()||(0,Ie().qK)())return!1;if(function(e,t){return e.blockSelection.blocks.some((e=>{var o;if(!e.blockSubtree)return!0;const n=null===(o=e.blockSubtree.getModel({id:e.blockId,table:A().iU}))||void 0===o?void 0:o.spaceId;return!!(n&&t&&te().uq({sourceSpaceId:n,targetSpaceId:t,sourceBlockSubtree:e.blockSubtree}))||void 0}))}(n,null===(t=Ue().default.state.currentSpaceStore)||void 0===t?void 0:t.id))return!1;const d=Ge().default.state;if("editing"!==d.mode)return!1;const u=d.multiSelection.start.store;if(!u.isTable(A().iU))return!1;const p=(0,Te().sQ)(u);if(!p)return!1;if(u!==p.getBlockTitleStore())return!1;const m=p.getType(),f=p.getFormat();if(!m)return!1;if(!((0,c().Um)(m,f)||r&&(0,c().zp)(m)))return!1;if(r&&(0,c().zp)(m)){const e=n.blockSelection.blocks[0],t=null==e?void 0:e.blockId,o=null==e?void 0:e.blockSubtree,i=t&&o?o.getModel({id:t,table:"block"}):void 0;if(Boolean(null==i?void 0:i.getContentLength()))return!1}const g=(0,et().dq)({includeNonSelectableListContainer:!0});if(!g)return!1;const b=(0,et().v5)(p,[g]);if(!b)return!1;let k=0;for(let a=b.length-1;a>=0;a--){const e=b[a].value.store,t=tt().C.findSelectableFromStore(e),o=e.getModel();if(null!=o&&o.isType(c().$t)||t&&!t.props.canSelect){k=a;break}}const v=b.slice(k);if(0===v.length)return!1;const y=v[0].value.store,h=y.pointer.spaceId,S=y.isInsideTemplate()||y.isInsideFactoryOrDuplicateBlocksAction();i.logDebugMessage("pasteMultiTextSelection: pasting",v,{spaceId:h,pastingIntoTemplate:S,insertionPathRootStore:y});const T=n.blockSelection.blocks.map((e=>{var t;let{blockId:n,blockSubtree:r}=e;if(!r)throw new Error("Missing data for local duplicate block during paste");const a=(null===(t=r.getModel({table:A().iU,id:n}))||void 0===t?void 0:t.getType())===c().Ti.factory,s=!(S||a),d=We().G.createChildStore(y,{table:A().iU,id:n}),u=le().localDuplicate({environment:o,sourceBlockId:n,targetBlockPointer:(0,be().Ii)({environment:o,table:A().iU,spaceId:h}),sourceBlockSubtree:r,targetInMemoryRecordCache:y.inMemoryRecordCache,addCopyName:(0,Me().Z)(d),deepCopyTransclusionContainers:!1,resolveTemplateVariables:s,transaction:i,preventLegacyTransclusions:l}),m=u.targetBlockStore.getType();return m&&je().W(o,{from:"paste",type:m,new_page_id:"page"===m?u.targetBlockStore.id:void 0,creating_block_id:u.targetBlockStore.id,parent_collection_id:p.getParentCollectionIdUpToTwoLevels()}),u})),M=n.multiTextSelection.start.pointerPath,C=n.multiTextSelection.end.pointerPath,I=[],x=[],w=Math.max(M.length,C.length),F=(v[v.length-w]||v[0]).value.store,D=(0,$().MW)({node:n.tree,recordStoreParent:F},(e=>{let{node:t,recordStoreParent:o}=e;const n=((e,t)=>{let o;for(const{originalToDuplicate:n}of T)if(o=n.get(t),o)break;if(o)return We().G.createChildStore(e,o)})(o,t.value),i=I.length<M.length?M[I.length]:void 0,r=x.length<C.length?C[x.length]:void 0;let a=!1;if((null==i?void 0:i.id)===t.value.id&&(a=!0,I.push(n)),(null==r?void 0:r.id)===t.value.id&&(a=!0,x.push(n)),!a)return{value:{store:n}};const s=(null==n?void 0:n.getContentStore())||y;return{value:{store:n},children:t.children.map((e=>({node:e,recordStoreParent:s})))}}));if(I.length!==M.length||0===I.length)throw new Error(`Failed to hydrate start path during paste (found ${I.length} of ${M.length})`);if(x.length!==C.length||0===x.length)throw new Error(`Failed to hydrate end path during paste (found ${x.length} of ${C.length})`);const R=I[I.length-1],P=x[x.length-1];if(!R||!P)throw new Error(`Failed to hydrate position during paste (${R?"":"missing start"} ${P?"":"missing end"})`);const B=(0,$().DY)([D],(e=>e.value.store===R)),U=(0,$().DY)([D],(e=>e.value.store===P)),L=B&&U&&ze().T.fromNearestCommonAncestor(B,U);if(!L)throw new Error(`Failed to build range for paths: ${B?"":"missing start"} ${U?"":"missing end"}`);nt().pz({environment:o,multiSelection:d.multiSelection,transaction:i});const E=Ge().default.state,V="editing"===E.mode?E.multiSelection:d.multiSelection;if((0,Se().Nm)(p)&&0===n.multiTextSelection.start.textIndex){const e=R.getType();e&&(0,c().Zu)(e)&&ce().transformBlocks({environment:o,blocks:[p],blockType:e,transaction:i})}let O;return y.useCrdt()?(st({transaction:i,clipboardData:n,startBlockStore:p,duplicateStartStore:R,range:L,insertionPath:v,duplicates:T,insertionPathRootStore:y}),O=at({environment:o,transaction:i,clipboardData:n,insertionPoint:V,textSelectionState:d,duplicateEndStore:P,pastingIntoTemplate:S}).newSelectionIndex):(O=at({environment:o,transaction:i,clipboardData:n,insertionPoint:V,textSelectionState:d,duplicateEndStore:P,pastingIntoTemplate:S}).newSelectionIndex,st({transaction:i,clipboardData:n,startBlockStore:p,duplicateStartStore:R,range:L,insertionPath:v,duplicates:T,insertionPathRootStore:y})),a().default.afterNextFlush((()=>{const e=(0,et().kC)({rootStore:y,root:g,target:L.end}),t=e&&(0,Te().mh)(e[e.length-1]);if(!t)return;const o={start:{index:s?V.start.index:O,store:s?V.start.store:t},end:{index:O,store:t}};it().setMultiSelection({multiSelection:o})})),!0}function at(e){const{insertionPoint:t,duplicateEndStore:o,pastingIntoTemplate:n,environment:i,transaction:r,clipboardData:a}=e;let s=0;const l=t.end.store,c=t.end.index,d=(0,Te().mh)(o);if(d){s=G().eeV(d.getValue()).length;const e=(0,Je().TO)((0,Te().sQ)(l)),t=(0,Je().TO)((0,Te().sQ)(d));se().Ls({store:l,blockStore:e})&&se().Ls({store:d,blockStore:t})?(qe().Wc({sourceBlockStore:e,targetBlockStore:t,splitAtGraphemeIndex:c,transaction:r,moveIntoNewBlock:!1}),r.logDebugMessage("(CRDT) pasted suffix into end",d)):(nt().gc({environment:i,sourceStore:l,sourceIndex:c,targetStore:d,targetIndex:s,transaction:r}),r.logDebugMessage("pasted suffix into end",d))}else nt().pe({environment:i,transaction:r,store:l,selection:{startIndex:c,endIndex:1/0}}),r.logDebugMessage("no end title store to paste text into");let u=G().V3g(a.multiTextSelection.start.copiedText,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:!0});return n||(u=(0,j().KV)(u,{currentUserId:i.currentUser.id,currentTimeZone:(0,T().r)()})),nt().mM({environment:i,index:t.start.index,store:t.start.store,tokens:u,transaction:r}),{newSelectionIndex:s}}function st(e){const{transaction:t,clipboardData:o,startBlockStore:n,duplicateStartStore:i,insertionPath:r,insertionPathRootStore:a,duplicates:s,range:l}=e,c=Ae().default.checkGate({gateName:"prefer_high_level_operations"});for(const p of l.iterateInsertionAt(r))(0,et().D_)({transaction:t,treeOperation:p,deleteFrom:"tree-parent",preferHighLevelOperations:c}),He().f.applyMutable(p);if(o.blockSelection.wasContiguousSelection&&o.blockSelection.blocks.length>0&&!n.hasContent())for(const p of i.getContentStores())Ke().jG({parentStore:n.getContentStore(),childStore:p,transaction:t});const d=new Set;for(const{originalToDuplicate:p}of s){const e=p.getByTable(A().iU);for(const{value:o}of e){var u;if(!o||d.has(o.id))continue;d.add(o.id);const e=We().G.createChildStore(i,o),n=(0,Xe().eG)(e),r="transclusion_reference"===a.getType()?null===(u=a.getTransclusionReferenceTargetStore())||void 0===u?void 0:u.id:a.id;n.find((e=>e.id===r))||(t.logDebugMessage("disposing of unwanted duplicated block",e,e.id===i.id),ot().YM({childStore:e,parentStore:a,alive:!1,transaction:t}))}}}var lt=()=>o(33150),ct=()=>o(308186),dt=()=>o(231077),ut=()=>o(544607),pt=()=>o(295703),mt=()=>o(905),ft=()=>o(282662),gt=()=>o(636340),bt=()=>o(453999),kt=()=>o(879952),vt=()=>o(102182),yt=()=>o(435168),ht=()=>o(15672),St=()=>o(269299),Tt=()=>o(423402);const Mt=!1;function Ct(){if(Mt){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];console.log("clipboardActions:",...t)}}const It=(0,H().vU)({offlineError:{id:"clipboardActions.offlineError.message",defaultMessage:"Please go online to copy this block."},untitled:{defaultMessage:"Untitled",id:"clipboardActions.untitledMessage"}}),xt=(0,H().vU)({copiedQnAMessageToClipboard:{id:"action.copiedQnAMessageToClipboard",defaultMessage:"Copied response to clipboard"},copiedHumanMessageToClipboard:{id:"action.copiedHumanMessageToClipboard",defaultMessage:"Copied your message to clipboard"},copiedLinkToClipboard:{id:"action.copiedLinkToClipboard.snackBarMessage",defaultMessage:"Copied link to clipboard"},copiedPageLinkToClipboard:{id:"action.copiedPageLinkToClipboard.snackBarMessage",defaultMessage:"Copied page link to clipboard"},copiedFormLinkToClipboard:{id:"action.copiedFormLinkToClipboard.snackBarMessage",defaultMessage:"Copied form link to clipboard"},copiedTeamHomeLinkToClipboard:{id:"action.copiedTeamHomeLinkToClipboard.snackBarMessage",defaultMessage:"Copied page link to clipboard"},copiedBlockLinkToClipboard:{id:"action.copiedBlockLinkToClipboard.snackBarMessage",defaultMessage:"Copied block link to clipboard"},copiedLinksToClipboard:{id:"action.copiedLinksToClipboard.snackBarMessage",defaultMessage:"Copied links to clipboard"},copiedPropertyToClipboard:{id:"action.copiedPropertyToClipboard.snackBarMessage",defaultMessage:"Copied property to clipboard"},copiedCodeToClipboard:{id:"action.copiedCodeToClipboard.snackBarMessage",defaultMessage:"Copied code to clipboard"},copiedTokenToClipboard:{id:"action.copiedTokenToClipboard.snackBarMessage",defaultMessage:"Copied token to clipboard"},copiedToClipboard:{id:"action.copiedToClipboard.snackBarMessage",defaultMessage:"Copied to clipboard"},copiedApiObjectToClipboard:{id:"action.copiedApiObjectToClipboard.snackBarMessage",defaultMessage:"Copied API object to clipboard"},copiedImageToClipboard:{id:"action.copiedImageToClipboard.snackBarMessage",defaultMessage:"Copied image to clipboard"},copyImageError:{id:"action.copyImageError.snackBarMessage",defaultMessage:"Failed to copy image to clipboard"},copiedPageToClipboard:{id:"action.copiedPageToClipboard.snackBarMessage",defaultMessage:"Copied page to clipboard"}}),wt={...o(748456).Y,dockerfile:"Docker",javascriptreact:"JavaScript",jsonc:"JSON","objective-c":"Objective-C",proto:"Protobuf",shellscript:"Shell",typescriptreact:"TypeScript",vb:"Visual Basic"},Ft="text/_notion-blocks-v3-production",Dt="text/_notion-text-production",Rt="text/_notion-multi-text-production",Pt="text/_notion-page-source-production",Bt="vscode-editor-data",Ut=[Ft,Dt,Rt,Pt],Lt=new Set(Ut);const Et={fromJson:e=>e,toJson:e=>e},Vt=Et,At=Et,Ot=Et,Nt={fromJson(e){const t=(0,$().MW)(e.tree,(e=>e)),o=Wt.fromJson(e.blockSelection);return{...e,tree:t,blockSelection:o}},toJson(e){const t=Wt.toJson(e.blockSelection);return{...e,blockSelection:t}}},Wt={fromJson:e=>({...e,blocks:e.blocks.map((e=>({...e,blockSubtree:e.blockSubtree?U().RecordMap.create(e.blockSubtree):void 0})))}),toJson:e=>({...e,blocks:e.blocks.map((e=>({...e,blockSubtree:e.blockSubtree?e.blockSubtree.toJson():void 0})))})},_t="VirtualClipboard:production";let Gt;function Yt(e){return e.isAndroid}function Zt(e,t){if(!Yt(t))return e;const o=(0,pe().nZ)(e.getData("text/html"));if(o){Gt||(Gt=_().Z.get(_t));const t=Gt;if(o===(null==t?void 0:t.id)){const o=e.types.concat(Object.keys(t.mimeTypes));return{getData(o){const n=e.getData(o);return!n&&function(e){return Lt.has(e)}(o)?t.mimeTypes[o]||"":n},types:[...new Set(o)].filter((o=>{const n=t.mimeTypes[o];return""!==e.getData(o)||n&&""!==n})),items:e.items}}}return e}function jt(e,t,o,n){if(!e.clipboardData)return;const i=o.toJson(n),r=JSON.stringify(i);e.clipboardData.setData(t,r)}function $t(e,t,o){try{const n=e.getData(t),i=JSON.parse(n);return o.fromJson(i)}catch(n){return}}function Qt(e){const{clipboardData:t}=e,{text:o,html:n,isFromMicrosoftOffice:i,isHtmlTable:r}=function(e){const{clipboardData:t,tinyMceMicrosoftWordPasteFilter:o}=e,n=t.getData("text/uri-list"),i=t.getData("text/plain").replace(xo,"\n")||n,r=t.getData("text/html"),a=yo(r),{isHtmlTable:s,htmlContainsRichFormatting:l}=function(e){var t;const o=document.createElement("div");o.innerHTML=ho(e);const n=Boolean("table"===(null===(t=o.firstElementChild)||void 0===t?void 0:t.nodeName.toLowerCase()));return{htmlContainsRichFormatting:M().RE({node:o,window,emojiData:de().Z.state}),isHtmlTable:n}}({html:r,tinyMceMicrosoftWordPasteFilter:o});if(!l&&!function(e,t){return Io.test(e)&&Io.test(t)}(r,i))return{text:i,isFromMicrosoftOffice:a,isHtmlTable:s};return{text:i,html:r,isFromMicrosoftOffice:a,isHtmlTable:s}}(e);return{text:o,html:n,multiTextSelectionData:$t(t,Rt,Nt),textSelectionData:$t(t,Dt,Vt),blockSelectionData:$t(t,Ft,Wt),isFromMicrosoftOffice:i,isHtmlTable:r}}function Ht(e){const{blocks:t,action:o,environment:n}=e;if(0===t.length)return{action:o,blocks:[],wasContiguousSelection:!1};const i=t[0],r=i.inMemoryRecordCache,a=J().jj(J().oA(t.map((e=>e.id)))),s=i.getParentBlockStore(),l=s?s.getRenderableContentIds():[],c=l.indexOf(i.id),d=Boolean(s&&t.every(((e,t)=>l.indexOf(e.id)===c+t)));if(r.isTemplatePreview){return{blocks:a.map((e=>({blockId:e,blockSubtree:le().loadLocalSubtree(n,{blockId:e,inMemoryRecordCache:r,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,ke().hC)()}).recordMap}))),action:o,wasContiguousSelection:d}}if(r.snapshotData){Ze().P_(n,r.snapshotData);return{blocks:a.map((e=>({blockId:e,blockSubtree:le().loadLocalSubtree(n,{blockId:e,inMemoryRecordCache:r,allowCopyCollections:!0,requireFullSubtree:!0,skipNavigableChildren:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,ke().hC)()}).recordMap}))),action:o,wasContiguousSelection:d,wasSelectionFromSnapshot:!0}}{const e=(0,pe().IU)(t),i=e&&Jt({environment:n,inMemoryRecordCache:r,multiColumnPasteInfo:e});if(e&&i){let t=!1;const s=[];for(const o of a)e.blockIds.has(o)?t||(s.push({blockId:e.columnListId,blockSubtree:i}),t=!0):s.push({blockId:o,blockSubtree:le().loadLocalSubtree(n,{blockId:o,inMemoryRecordCache:r,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,ke().hC)()}).recordMap});return{blocks:s,action:o,wasContiguousSelection:d}}return{blocks:a.map((e=>({blockId:e,blockSubtree:le().loadLocalSubtree(n,{blockId:e,inMemoryRecordCache:r,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,ke().hC)()}).recordMap}))),action:o,wasContiguousSelection:d}}}function zt(e){const{markdown:t,markdownOptions:o,markdownLinkifyIt:n}=e;if(n)return F().c8({...n,markdown:t,plugin:null==o?void 0:o.plugin})}function Jt(e){var t;const{environment:o,multiColumnPasteInfo:n,inMemoryRecordCache:i}=e,{columnListId:r,columnIds:a,spaceId:s}=n,l=U().RecordMap.create(),c=null===(t=i.getEntry({pointer:{table:A().iU,id:r,spaceId:s},userId:o.currentUser.id}))||void 0===t?void 0:t.value.value;if("column_list"!==(null==c?void 0:c.type))return;const d={...c,content:(c.content||[]).filter((e=>a.has(e)))};l.setValue({table:A().iU,id:r,spaceId:s},d);for(const m of a){var u;const e=null===(u=i.getEntry({pointer:{table:A().iU,id:m,spaceId:s},userId:o.currentUser.id}))||void 0===u?void 0:u.value.value;if("column"!==(null==e?void 0:e.type))return;const t={...e,content:(e.content||[]).filter((e=>n.blockIds.has(e)))};l.setValue({table:A().iU,id:m,spaceId:s},t)}const p=[l];for(const m of n.blockIds){const e=le().loadLocalSubtree(o,{blockId:m,inMemoryRecordCache:i,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,ke().hC)()}).recordMap;if(!e)return;p.push(e)}return U().RecordMap.merge(p)}function Kt(e){const{rootBlock:t,getRecordValue:o}=e,n=o(t);if(!n)return;const i=(0,S().ky)({block:n,getRecordValue:o});if(!i)return;const r=(0,pe().ax)({rootBlock:t,getRecordValue:o,formulasModule:v()}),a=(0,d().oC)(i),s=Object.keys(a),l=J().MR(s,(e=>{const t=a[e];return t&&t.name||""}));let c="";for(const d of l){const e=a[d];if(e&&"title"!==d){const t=(0,g().Wy)({property:d,schema:a,block:n,exportArgs:r,renderers:f().O});t&&(c+=`${e.name}: ${t}\n`)}}return c||void 0}function qt(e){const{treePath:t,textPosition:o,endpoint:n}=e,{store:i,index:r}=o,a=t.map((e=>e.value.store.pointer)),s=se().FX(o.store)?["properties","title"]:o.store.path,l=G().xrQ(i.getValue(),r,r);return{copiedText:"end"===n?l.tokensBeforeRange:l.tokensAfterRange,textIndex:r,attributePath:s,pointerPath:a}}function Xt(e){var t;const{multiSelection:o,action:n,environment:i}=e;(0,ye().qS)(o)&&console.warn("Warning, serializeMultiTextSelectionToClipboardData() was called with a single-store text selection! This function should only be  called with a multi-selection that spans multiple blocks.");const r=null===(t=(0,he().tp)({filterCommonAncestors:!0,multiSelection:o,focus:void 0}))||void 0===t?void 0:t.stores;if(!r)return;const a=o.start.store.inMemoryRecordCache,s=Ht({action:n,blocks:r,environment:i});if(0===s.blocks.length)return;const l=(0,he().Nj)({multiSelection:o,includeNonSelectable:!1});if(!l)return;const{treeRange:c}=l,d=[],u=new Map,p=(e,t)=>{t.forEach((e=>p(e,[])));const o=u.get(e),n=o&&o.length>t.length?o:t;u.set(e,n)},m=Ae().default.checkGate({gateName:"prefer_high_level_operations"});for(const{start:y,end:h}of c.iterateAnalogousNodes()){if(y){const e=y.childrenBeforeRange.slice(-1).concat(y.childrenInsideRange);p(y.parent,e)}if(h)if(p(h.parent,h.childrenInsideRange),m)for(const e of h.childrenAfterRange)d.push({command:"removeChild",path:["content"],pointer:h.parent.value.store.pointer,args:{id:e.value.store.id}});else d.push(R().op.set({pointer:h.parent.value.store.pointer,path:["content"],args:h.childrenInsideRange.map((e=>e.value.store.id))}))}const f=qt({textPosition:o.start,endpoint:"start",treePath:c.startPath}),g=qt({textPosition:o.end,endpoint:"end",treePath:c.endPath});d.push(...(0,pe().FQ)(f),...(0,pe().FQ)(g));for(const y of[null===(b=s.blocks[0])||void 0===b?void 0:b.blockSubtree,null===(k=s.blocks[s.blocks.length-1])||void 0===k?void 0:k.blockSubtree]){var b,k;y&&((0,P().FS)({recordMap:y,operations:d,updateOnly:!0}),m&&eo(i,a,y))}const v=(0,$().MW)(c.commonAncestor,(e=>{const t=u.get(e);if(t)return{value:e.value.store.pointer,children:t}}));if(v)return{blockSelection:s,tree:v,multiTextSelection:{start:f,end:g},action:n};Ct("unexpected: trimming tree produced undefined")}function eo(e,t,o){const n=[];for(const{model:i}of o)if(i instanceof D().yJh&&!i.alive){n.push(i.pointer);const o=le().loadLocalSubtree(e,{blockId:i.pointer.id,inMemoryRecordCache:t,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,ke().hC)()}).recordMap;if(o)for(const{pointer:e}of o)n.push(e)}for(const i of n)o.delete(i)}function to(e){const{environment:t,event:o}=e,n=C().Il();!function(e){const{environment:t,event:o,markdownLinkifyIt:n}=e;if(!o.clipboardData)return;const i=_e().default.state.stores,r=Ge().default.isEditingComment(),a=Be().default.state.open,s=Re().UQ(),l="empty"!==Ge().default.state.mode&&Ge().default.state.multiSelection,d=t.currentUser.id,u="copy"===o.type?"copy":"cut",p=ue().RM();p&&(0,L().$O)(p.pointer,A().iU)&&jt(o,Pt,At,p.pointer);const m=l&&(0,ye().QY)(l);if(m&&m.selection.startIndex!==m.selection.endIndex){const e=ve().Z.getIntl(),{store:n,selection:i}=m,r=n.inMemoryRecordCache,a=n.getValue();if(Ct("copy: copying single-store text selection"),o.preventDefault(),a&&!To()){const e=n.table===A().iU?(0,Te().sQ)(n):void 0,t=e&&J().Xy(n.path,e.getBlockTitleStore().path)?e.getType():void 0,r=t&&(0,c().Zu)(t)?t:void 0,s=a.filter((e=>!G().eIM(e)));jt(o,Dt,Vt,{blockType:r,editing:s,selection:i,action:u})}const s=G().KU1(a,i.startIndex,i.endIndex),l=D().omK.fromGetRecordValueFn(r.makeGetRecordValueFn(d)),p=r.makeGetRecordRoleFn(d),f=(0,E().Xh)({intl:e,textValue:s,getRecordModel:l,userTimeZone:(0,T().r)(),externalIntegrations:Oe().default.integrations.state});o.clipboardData.setData("text/plain",(0,pe().ZI)(t.device.isWindows,f));const g=Z().hW({textValue:s&&{value:s,spaceId:(0,W().J)(n.pointer.spaceId)},getRecordModel:l,getRecordRole:p,userTimeZone:(0,T().r)(),isAndroid:!1,isSafariOrIOS:!1,isWindows:!1,disableLinks:!1,disabled:!0,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,baseUrl:ae().default.domainBaseUrl,publicDomainName:ae().default.publicDomainName,showEmojiInline:!0,emojiType:"raw",theme:(0,z().Vx)(),intl:e,katex:void 0,isClient:void 0,currentUserId:void 0,getPublicBaseUrlForPage:ge().Lr,externalIntegrations:Oe().default.integrations.state,formulaValueTypes:[],emojiData:de().Z.state,isMobileNative:!1});return void o.clipboardData.setData("text/html",(0,pe().ZI)(t.device.isWindows,g))}if(l&&!(0,ye().iG)(l)&&!r&&l.start.store.table===A().iU&&l.end.store.table===A().iU){const e=Xt({environment:t,multiSelection:l,action:u});if(e){Ct("copy: copying multi-text selection"),o.preventDefault(),jt(o,Rt,Nt,e);const i=l.start.store.inMemoryRecordCache,r=l.start.store.getRecordStoreUIRoot().getValue();if(!r)return;const{markdown:a,html:s}=(0,pe().Ef)({clipboardData:e,rootBlock:{id:r.id,table:A().iU,spaceId:r.space_id},isWindows:t.device.isWindows,fallbackGetRecordValue:i.makeGetRecordValueFn(d),markdownLinkifyIt:n,markdownSerializationOptions:{transformBlockMapping:{image:Ae().default.checkGate({gateName:"docs_clipboard_imagedata"})?oo:void 0}},formulasModule:v()});return a&&o.clipboardData.setData("text/plain",a),void(s&&o.clipboardData.setData("text/html",s))}}if(l&&!(0,ye().iG)(l)&&!r&&l.start.store.table===N().x_&&l.end.store.table===N().x_){Ct("copy: copying comment multi-text selection"),o.preventDefault();const e=(0,he().L5)(l),n=ve().Z.getIntl(),i=e.map((e=>{let{store:o,selection:i}=e;if(i.startIndex===i.endIndex)return;const r=o.inMemoryRecordCache,a=D().omK.fromGetRecordValueFn(r.makeGetRecordValueFn(d)),s=r.makeGetRecordRoleFn(d),l=G().KU1(o.getValue(),i.startIndex,i.endIndex);return{plainText:(0,E().Xh)({intl:n,textValue:l,getRecordModel:a,userTimeZone:(0,T().r)(),externalIntegrations:Oe().default.integrations.state}),htmlContent:Z().hW({textValue:l&&{value:l,spaceId:(0,W().J)(o.pointer.spaceId)},getRecordModel:a,getRecordRole:s,userTimeZone:(0,T().r)(),isAndroid:!1,isSafariOrIOS:!1,isWindows:!1,disableLinks:!1,disabled:!0,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,baseUrl:ae().default.domainBaseUrl,publicDomainName:ae().default.publicDomainName,showEmojiInline:!0,emojiType:"raw",theme:(0,z().Vx)(),intl:n,katex:void 0,isClient:void 0,currentUserId:void 0,getPublicBaseUrlForPage:Pe().aR(t),externalIntegrations:Oe().default.integrations.state,formulaValueTypes:[],emojiData:de().Z.state,isMobileNative:!1}),textValue:l}})).filter(X().$K),r=i.map((e=>e.plainText)).join("\n\n"),a=`<div>${i.map((e=>e.htmlContent)).join("</div><div>")}</div>`;return o.clipboardData.setData("text/plain",(0,pe().ZI)(t.device.isWindows,r)),void o.clipboardData.setData("text/html",(0,pe().ZI)(t.device.isWindows,a))}if(i.length>0&&!r&&!s&&!a){Ct("copy: copying block selection"),o.preventDefault();const e=i[0],r=e.inMemoryRecordCache,a=Ht({blocks:i,environment:t,action:u});if(jt(o,Ft,Wt,a),!e.isDefined())return;const s=J().oA(i.map((e=>e.computeWithRecordValues((t=>{let{getRecordValueAndSubscribe:o}=t;return o(e)}))))),l=r.makeGetRecordValueFn(d),{markdown:c,html:p}=(0,pe().X4)({rootBlock:{id:e.id,table:A().iU,spaceId:e.getSpaceId()},blockValues:s,getRecordValue:l,isWindows:t.device.isWindows,markdownLinkifyIt:n,formulasModule:v()});return c&&o.clipboardData.setData("text/plain",c),void(p&&o.clipboardData.setData("text/html",p))}Ct("copy: doing nothing")}(e),(0,pe().Li)(o,n),function(e){let{event:t,device:o,customEventId:n}=e;if(!t.clipboardData||!Yt(o))return;const i={};for(const s of Ut)i[s]=t.clipboardData.getData(s);const r=t.clipboardData.getData("text/html");t.clipboardData.setData("text/html",`${r}${(0,pe().Gp)(n)}`),Gt={id:n,mimeTypes:i};try{_().Z.set(_t,Gt)}catch(a){h().log({level:"error",from:"clipboardActions",type:"setVirtualClipboardData",error:{message:"Unable to persistently store virtual clipboard data."}})}}({event:o,device:t.device,customEventId:n})}function oo(e){const{block:t,exportArgs:o}=e,{getExportedRenderAsset:n}=o,{source:i}=D().kk5.fromBlock(t).getProperties(),r=G().QaF(i),a=function(e){if(!e.file_ids)return;const t=we().R.findBlockFromId(e.id);if(!t)return;const o=t.getNode();if(!(o instanceof Element))return;const n=o.querySelector("img");if(!n)return;const i=document.createElement("canvas");i.width=n.width,i.height=n.height;const r=i.getContext("2d");if(!r)return;return r.drawImage(n,0,0,n.width,n.height),i.toDataURL()}(t)??n({fromBlockId:o.blockId,toFileURI:r}),s=F().cG(e)||F().WB({block:t,exportArgs:o})||a;return{text:(0,p().SR)({url:r})?`![${s}](${a})`:`[${s}](${a})`,breakLines:!0,children:F().AS(e)}}async function no(e){const{event:t,environment:o,markdownLinkifyIt:n}=e;it().syncTextSelection();const i=_e().default.state.stores,r=Ge().default.isEditingComment(),a=ue().JE(),s="editing"===Ge().default.state.mode&&Ge().default.state.multiSelection,{phase:l}=_e().default.state;if(io({environment:o,event:t,disableSyncTextSelection:!0,markdownLinkifyIt:n}),s&&!(0,ye().iG)(s)){const e=s.start.store.getAncestorBlockStoreAtRootPath(),t=e?Ve().MT.getMode(e):"default";St().createAndCommit({userAction:"clipboardActions.cutWithMaybeConfirmation",environment:o,canUndo:!0,perform:n=>{if("suggest"===t){const t=re().oG(o,n,e);re().Sz({environment:o,multiSelection:s,transaction:n,discussionStore:t})}else nt().pz({environment:o,multiSelection:s,transaction:n})}})}else(l===_e().SelectionPhase.Selected||s)&&i.length>0&&!r&&!a&&await bt().Qw({environment:o,blocks:i,shouldCheckSuggestEdit:!0});Ne().default.setKeyboardMode(!0)}function io(e){const{environment:t,event:o,disableSyncTextSelection:n,markdownLinkifyIt:i}=e;n||it().syncTextSelection(),to({environment:t,event:o,markdownLinkifyIt:i}),Ne().default.setKeyboardMode(!0)}function ro(e){var t;const{environment:o,files:n,transaction:i,insertBelowBlockStore:r}=e,a=_e().default.getCurrentRecordCache(),s=ue().qQ(o);if(!a)return;const l=_e().default.state.stores,c=ut().z({environment:o,files:n,inMemoryRecordCache:a,transaction:i,pageWidth:s,spaceId:0!==l.length?l[0].pointer.spaceId:null===(t=ue().RM())||void 0===t?void 0:t.pointer.spaceId});c.forEach((e=>{const t=e.getType();t&&je().W(o,{from:"paste",type:t,creating_block_id:e.id})})),lo({environment:o,blocks:c,transaction:i,replaceEmptyTextBlock:!0,insertBelowBlockStore:r})}function ao(e){const{environment:t,store:o,tokens:n,index:i,transaction:r,multiTextSelection:s,disableEmbedMenu:l,selectAll:c}=e,d=(0,ye().QY)(s),u=d?{value:d.store.getValue()}:void 0,p=o.getAncestorBlockStoreAtRootPath(),f=p?Ve().MT.getMode(p):"default";let g=n;(Ge().default.isEditingComment()||Ge().default.isEditingCaption())&&(g=function(e){const{environment:t,tokens:o}=e,n=so(o);if(n&&n.url===n.text){const e=(0,V().parseRoute)({url:n.url,baseUrl:ae().default.domainBaseUrl,publicDomainName:ae().default.publicDomainName,isMobile:t.device.isMobile,protocol:ae().default.protocol,currentUrl:window.location.href});if("page"===e.name&&e.blockId){const t=G().$0A(e.scrollToBlockId??e.blockId,void 0);return[G().YCD(t),G().V3y(" ")]}}return o}({environment:t,tokens:n})),nt().mM({environment:t,store:o,tokens:g,index:i,transaction:r,selectAll:c,editorMode:f});const b=so(g);!l&&u&&b&&"suggest"!==f&&function(e){const{environment:t,hyperlink:o,oldTextValue:n}=e,i="editing"===Ge().default.state.mode&&(0,ye().QY)(Ge().default.state.multiSelection),r=_e().default.state;if(i&&r.stores.length>0){const e=i.store.getValue(),r=G().QaF(e),s=m().p4(r.substring(0,r.indexOf(o.text))).length,l=s+m().p4(o.text).length;if(i.store.isTable(A().iU)||i.store.isTable(N().x_)){if(Tt().KT({environment:t,blockStore:_e().default.state.stores[0],textStore:i.store,textValueBeforePaste:n,url:o.url,urlSelection:{startIndex:s,endIndex:l}}))return;if(mt().QZ({environment:t,textStore:i.store,blockStore:_e().default.state.stores[0],oldTextValue:n,url:o.url,urlSelection:{startIndex:s,endIndex:l}}))return}a().default.afterNextFlush((()=>{const e=o.url;pt().KT({environment:t,textStore:i.store,oldTextValue:n,url:e,urlSelection:{startIndex:s,endIndex:l}})}))}}({environment:t,hyperlink:b,oldTextValue:u.value,transaction:r})}function so(e){if(1!==e.length)return;const t=e[0];if(!G().AJd(t))return;const[o,n]=t;if(1!==n.length)return;const i=n[0];if(!G().j0F(i))return;return{text:o,url:G().zW$(i)}}function lo(e){const{environment:t,blocks:o,transaction:n,replaceEmptyTextBlock:i,insertBelowBlockStore:r}=e,a=_e().default.state.stores;if(1===a.length){const e=a[0];if(e.getType()&&e.isType(c().hY)&&function(e){if("editing"!==Ge().default.state.mode||!Ge().default.state.multiSelection)return!1;const t=(0,ye().QY)(Ge().default.state.multiSelection);if(!t)return!1;return t.store===e.getTitleStore()}(e)){const i=e.getContentStore(),r=J().d9(o).reverse().map((e=>ft().Ce({parentStore:i,prependStore:e,transaction:n}).childStore));return kt().Z5({environment:t,stores:r}),r}}return bt().BM({environment:t,blocksToInsert:o,target:r?[r]:a,transaction:n,replaceEmptyTextBlock:i})}function co(e,t,o,n){const i=(0,ue().RM)();if(!i)return;const r=_e().default.state.stores,s=0!==r.length?r[0].pointer.spaceId:i.pointer.spaceId,l="suggest"===Ve().MT.getMode(i,!0);let d=function(e,t){if("cut"!==t.action||!Ae().default.checkGate({gateName:"convert_cut_paste_to_move"}))return;const o="suggest"===Ve().MT.getMode(e,!0),n=[];for(const i of t.blocks){const t=We().G.createChildStore(e,{table:A().iU,id:i.blockId});if(!t.isReady())return;const r=t.getModel();if(!r)return;if(r.getSpaceId()!==e.getSpaceId())return;if(!1!==r.alive)return;o&&!c().ZM[r.getType()]||n.push(t)}return n}(i,t);if(!d){const o=JSON.stringify(t).length>xe()._V;d=t.blocks.reduce(((r,a)=>{var d,u,p,m,f;let{blockId:g,blockSubtree:b}=a;const k=We().G.createChildStore(i,{table:A().iU,id:g});let v;if(k.isDefined())v=k.getModel();else{const e=null==b?void 0:b.getValue({table:A().iU,id:g});v=e&&D().kk5.fromBlock(e)}if(l&&v&&!c().ZM[v.getType()])return r;if(null!==(d=v)&&void 0!==d&&d.isCollectionView()&&(null===(u=v)||void 0===u||!u.getCollectionPointer())&&(null===(p=v)||void 0===p?void 0:p.getSpaceId())!==s&&Ae().default.checkGate({gateName:"collections_xws"})){const t=gt().j4({environment:e,type:c().Ti.text,inMemoryRecordCache:k.inMemoryRecordCache,transaction:n,spaceId:s});return nt().mM({environment:e,store:t.getBlockTitleStore(),tokens:[G().YCD(G().$0A(g,v.getSpaceId()))],index:0,transaction:n}),r.push(t),r}const y=!(i.isInsideTemplate()||Mo()||i.isInsideFactoryOrDuplicateBlocksAction()||null!==(m=v)&&void 0!==m&&m.isTemplateVariableContainerBlock()),S=b&&s&&(null===(f=v)||void 0===f?void 0:f.getSpaceId())&&te().uq({sourceSpaceId:v.getSpaceId(),targetSpaceId:s,sourceBlockSubtree:b});if(b&&!o&&!S){const o=le().localDuplicate({environment:e,sourceBlockId:g,targetBlockPointer:(0,be().Ii)({environment:e,table:A().iU,spaceId:s}),sourceBlockSubtree:b,targetInMemoryRecordCache:k.inMemoryRecordCache,addCopyName:(0,Me().Z)(k),deepCopyTransclusionContainers:!1,shallowCopyNavigableBlock:!!t.wasSelectionFromSnapshot&&Ae().default.checkGate({gateName:"duplicate_snapshot_navigable_blocks_by_reference"}),resolveTemplateVariables:y,transaction:n,preventLegacyTransclusions:(0,ke().hC)()}).targetBlockStore,i=o.getType();return i&&je().W(e,{from:"paste",type:i,new_page_id:"page"===i?o.id:void 0,creating_block_id:o.id,parent_collection_id:k.getParentCollectionIdUpToTwoLevels()}),r.push(o),r}if(t.wasSelectionFromSnapshot)return h().log({level:"warning",from:"clipboardActions",type:"pasteBlockSelection",data:{message:"Unable to locally duplicate pasted block selection from snapshot",miscDataToConvertToString:{blockId:g,blockType:k.getType(),blockSelectionTooBig:o,missingBlockSubtree:!b}}}),r;Ee().default.state.online||ct().UW(ve().Z.formatMessage(It.offlineError));const[T,M]=le().serverDuplicate({environment:e,sourceBlocks:[{id:g,spaceId:(0,W().J)(void 0)}],targetInMemoryRecordCache:k.inMemoryRecordCache,addCopyName:(0,Me().Z)(k),transaction:n,deepCopyTransclusionContainers:!1,resolveTemplateVariables:y,targetSpaceId:(0,W().J)(s),convertExternalObjectInstancesToPlaceholders:!1,userActionSuffix:b&&o?" (forceServerSideCopy)":void 0}),C=T[0],I=C.getType();return M.then((o=>{if("error"===o.status){const n=o.error;te().nr(n)?t.blocks.length>1?te().qR(e,{product:n.clientData.metadata.product}):te().y1({product:n.clientData.metadata.product}):ct().UW(o.errorMessage)}else I&&je().W(e,{from:"paste",type:I,new_page_id:"page"===I?C.id:void 0,creating_block_id:C.id,parent_collection_id:k.getParentCollectionIdUpToTwoLevels()})})),r.push(C),r}),[])}if(l){const t=re().oG(e,n,d[0]),o=[];d.forEach((e=>{const i={type:"insert",id:C().Il(),discussionId:t.id};re().n1(n,e,i),o.push(e.id)})),n.preEnqueueActions.push((()=>{re().vh({environment:e,transaction:n,discussionStore:t,addModifiedBlockIdsAfter:o})})),ht().uj({environment:e,blocks:d,annotation:[G().GKr.SuggestionInsertText,t.id],transaction:n})}lo({environment:e,blocks:d,transaction:n,replaceEmptyTextBlock:!0});const u=_e().default.state.stores,p=u.length>0?u:[i],m=t.blocks.map((e=>{const t=p.length>0?p[0]:function(e){return e.isCollectionView()?e.getCollectionStore()||e:e.getContentStore()}(i);return We().G.createChildStore(t,{table:A().iU,id:e.blockId})}));a().default.afterNextFlush((async()=>{await Promise.all(p.map((e=>e.waitUntil((()=>{const t=e.getType();return Boolean(t&&t!==c().Ti.copyIndicator)}))))),await Promise.all(m.map((e=>e.load()))),o&&Qe().RH({environment:e,blocks:p,pageSource:o,copiedStores:m,action:t.action,wasContiguousSelection:t.wasContiguousSelection,rootStore:i})&&Qe().kE({environment:e,copiedStores:m,blocks:p,pageSource:o})}))}function uo(e){const{environment:t,disableEmbedMenu:o,transaction:n,overwrite:i,selectAll:r,markdownOptions:a,markdownLinkifyIt:s,text:l,tinyMceMicrosoftWordPasteFilter:c}=e,d=l.includes("\n"),u=Ge().default.state,p=So(u);d&&"inline"!==p||"editing"!==u.mode?i?(n.logDebugMessage("paste: pasting as markdown overwrite"),function(e){const{environment:t,text:o,transaction:n,selectAll:i,markdownOptions:r,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:s}=e,l=zt({markdown:o,markdownOptions:r,markdownLinkifyIt:a});if(!l)return;let c=mo({environment:t,html:l,wrapInEmptyBlocks:!1,tinyMceMicrosoftWordPasteFilter:s});c||(c=mo({environment:t,html:l,wrapInEmptyBlocks:!0,tinyMceMicrosoftWordPasteFilter:s}));if(!c)return;rt({environment:t,clipboardData:c,transaction:n,allowPasteIntoHeaderWithoutChildren:!0,selectAll:i,preventLegacyTransclusions:(0,ke().hC)()})}({environment:t,text:l,transaction:n,selectAll:r,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:c})):l&&(n.logDebugMessage("paste: pasting as markdown append"),function(e){const{environment:t,text:o,transaction:n,markdownOptions:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}=e,s=zt({markdown:o,markdownOptions:i,markdownLinkifyIt:r});if(s)bo({environment:t,html:s,transaction:n,tinyMceMicrosoftWordPasteFilter:a})}({environment:t,text:l,transaction:n,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:c})):(n.logDebugMessage("paste: pasting as inline markdown"),function(e){const{environment:t,text:o,disableEmbedMenu:n,transaction:i,selectAll:r,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l}=e,c="editing"===Ge().default.state.mode&&Ge().default.state.multiSelection;if(c){const e=(0,ye().QY)(c);if(e&&function(e){const t=Ge().default.state;return"editing"===t.mode&&!(0,ye().iG)(t.multiSelection)&&(0,ye().qS)(t.multiSelection)&&w().B(e,"url")}(o))Co({environment:t,text:o,transaction:i,editingSelection:e,selectAll:r});else if((0,Ie().Ld)("c")){const e=(0,Te().sQ)(c.start.store);nt().hJ({environment:t,editorMode:e?Ve().MT.getMode(e):"default",multiSelection:c,string:o,disableMentions:!0,disableEmojiCommands:!0,disableSlashCommands:!0,transaction:i,selectAll:r})}else{const e=s&&F().lM({...s,markdown:o,plugin:null==a?void 0:a.plugin});if(!e)return;go({environment:t,html:e,transaction:i,stripText:!1,stripSurroundingWhitespace:!1,disableEmbedMenu:n,selectAll:r,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l})}}}({environment:t,text:l,disableEmbedMenu:o,transaction:n,selectAll:r,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:c}))}function po(e,t){const o=e.getValue({table:A().iU,id:t});if(!o)return;const n={table:A().iU,id:t,spaceId:o.space_id},i=(o.content??[]).map((t=>po(e,t))).filter(X().$K);return new($().mp)(n,i)}function mo(e){var t,o,n,i;const a=ue().RM(),{html:s,wrapInEmptyBlocks:l,tinyMceMicrosoftWordPasteFilter:c,environment:d}=e,u=vo({environment:d,html:s,tinyMceMicrosoftWordPasteFilter:c,useCrdt:!1});if(!u)return;const{currentUserStore:p}=Ue().default.state;if(!p)return;let{allOperations:m,rootContentIds:f}=u;if(l){const e=ko(d),t=ko(d);if(!e||!t)return;m=[e.operation,...m,t.operation],f=[e.id,...f,t.id]}const g=U().RecordMap.create();(0,P().FS)({recordMap:g,operations:m,updateOnly:!1});const b=[],k=function(e){const{name:t,userId:o,recordMap:n}=e,i=U().RecordMapWithRole.create();for(const{pointer:r,model:a}of n)i.setModelAndRole(r,a,"reader");return new(r().Z)({name:t,data:new(Q().o)({[o]:i})})}({name:"htmlToMultiTextSelectionClipboardData",userId:p.id,recordMap:g});for(const r of f){const e=le().loadLocalSubtree(d,{blockId:r,inMemoryRecordCache:k,allowCopyCollections:!0,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,ke().hC)()}).recordMap;b.push({blockId:r,blockSubtree:e})}const v=new($().mp)({...(0,be().Ii)({environment:d,table:A().iU,spaceId:null==a?void 0:a.pointer.spaceId})},f.map((e=>po(g,e))).filter(X().$K));if(0===v.children.length)return;const y=v.children[0],h=null===(t=(0,$().DY)([v],(e=>e===y)))||void 0===t?void 0:t.map((e=>e.value)),S=null===(o=g.getValue(y.value))||void 0===o||null===(o=o.properties)||void 0===o?void 0:o.title,T=(0,$().CY)(v),M=null===(n=(0,$().DY)([v],(e=>e===T)))||void 0===n?void 0:n.map((e=>e.value)),C=null===(i=g.getValue(T.value))||void 0===i||null===(i=i.properties)||void 0===i?void 0:i.title,I=C?G().QaF(C).length:0;return S&&h&&C&&M?{blockSelection:{blocks:b,wasContiguousSelection:!0,action:"copy"},tree:v,multiTextSelection:{start:{textIndex:0,copiedText:S,attributePath:["properties","title"],pointerPath:h},end:{textIndex:I,copiedText:C,attributePath:["properties","title"],pointerPath:M}},action:"copy"}:void 0}function fo(e){const{text:t,html:o,stripText:n,stripSurroundingWhitespace:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}=e,s=o||(t?zt({markdown:t,markdownLinkifyIt:r}):void 0);if(!s)return;const l=document.createElement("div");return l.innerHTML=ho({html:s,tinyMceMicrosoftWordPasteFilter:a}),M().xR({node:l,window,stripText:n,stripSurroundingWhitespace:i,emojiData:de().Z.state})}function go(e){const{environment:t,html:o,transaction:n,stripText:i,stripSurroundingWhitespace:r,disableEmbedMenu:a,selectAll:s,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:c}=e,d="editing"===Ge().default.state.mode&&Ge().default.state.multiSelection;if(d){const e=fo({html:o,stripText:i,stripSurroundingWhitespace:r,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:c});if(!e)return;const u=(0,Te().sQ)(d.start.store),p=1===e.length;if(p){if(p&&(!e[0][1]||0===e[0][1].length)){n.logDebugMessage("pasteInlineHtml: insertString");const o=e[0][0];return void nt().hJ({environment:t,editorMode:u?Ve().MT.getMode(u):"default",multiSelection:d,string:o,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:n,selectAll:s})}const o=(0,ye().QY)(d);if(o&&!(0,ye().iG)(d)){const[,i]=e[0],r=i&&G().rlz(i);if(r){n.logDebugMessage("pasteInlineHtml: pasteLinkOverText");return void Co({environment:t,text:G().zW$(r),transaction:n,editingSelection:o,selectAll:s})}}}n.logDebugMessage("pasteInlineHtml: delete selection and insert"),nt().pz({environment:t,multiSelection:d,transaction:n}),ao({environment:t,store:d.start.store,tokens:e,index:d.start.index,transaction:n,disableEmbedMenu:a,multiTextSelection:d,selectAll:s})}}function bo(e){const{environment:t,html:o,transaction:n,tinyMceMicrosoftWordPasteFilter:i}=e,r=ue().RM();if(!r)return;const s=vo({environment:t,html:o,tinyMceMicrosoftWordPasteFilter:i,useCrdt:r.useCrdt()});if(!s)return;const{allOperations:l,rootContentIds:d}=s;for(const a of l)if((0,Y().Qf)(a)){const e=We().G.createChildStore(r,a.pointer);St().applyCrdtTextOperation({store:e,operation:a,invertedOperation:void 0,transaction:n})}else if((0,R().V_)(a)){const e=(0,We().Kv)(r,a.pointer);St().applyOperation({store:e,operation:a,transaction:n})}else(0,X().t1)(a);const u=d.map((e=>We().G.createChildStore(r,{table:A().iU,id:e})));u.forEach((e=>{const o=e.getType();o&&je().W(t,{from:"paste",type:o,creating_block_id:e.id,parent_collection_id:e.getParentCollectionIdUpToTwoLevels()})}));const p=lo({environment:t,blocks:u,transaction:n,replaceEmptyTextBlock:!0}).slice().reverse();return a().default.afterNextFlush((()=>{const e=p.map((e=>{if(e.getType()!==c().Ti.text)return;const o=so(e.getTitleValue());if(!o)return;const n=(0,V().parseRoute)({url:o.url,baseUrl:ae().default.domainBaseUrl,publicDomainName:ae().default.publicDomainName,isMobile:t.device.isMobile,protocol:ae().default.protocol,currentUrl:window.location.href});return"page"===n.name?n:void 0})).filter(X().$K);Qe()._x({environment:t,rootStore:r,blocks:p,copiedLinks:e})||Qe().QS({environment:t,blocks:p})})),u}function ko(e){const{currentUserStore:t}=Ue().default.state,o=ue().RM();if(!t||!o)return;const n=t.id;if(!n)return;const i=o.id,r=o.pointer.spaceId,a=(0,be().TS)({environment:e,table:A().iU,spaceId:r});return{operation:{pointer:{table:"block",id:a,spaceId:r},command:"set",path:[],args:{id:a,version:1,type:"text",properties:{title:[[""]]},parent_id:i,parent_table:"block",space_id:r,created_by_table:"notion_user",created_by_id:n,created_time:Date.now(),last_edited_by_table:"notion_user",last_edited_by_id:n,last_edited_time:Date.now(),alive:!0}},id:a}}function vo(e){const{environment:t,useCrdt:o,...n}=e,i=document.createElement("div");i.innerHTML=ho(n);const{currentUserStore:r}=Ue().default.state,a=ue().RM();if(!r||!a)return;const l=r.getValue();if(!l)return;const c=a.getSpaceId(),d=(0,be().l5)({environment:t,spaceId:c}),u=t.idCreator.getSpaceShortIdCreator(c,d);return M().$O({actor:(0,s().dp)(l),parent:{id:a.id,table:A().iU,spaceId:c},rootNode:i,deps:{importFileMap:{},window,intl:ve().Z.getIntl(),randomID:K().ZP,spaceIdCreator:u,randomShortID:q().ZP,isPhoneNumber:B().x,emojiData:de().Z.state},options:{useCrdt:o,ignoreBlockCount:!1}})}function yo(e){return/schemas-microsoft-com:office/.test(e)||/xmlns:m="http:\/\/schemas.microsoft.com\/office\/2004\/12\/omml"/.test(e)}function ho(e){const{html:t,tinyMceMicrosoftWordPasteFilter:o}=e;return i().sanitize(o&&yo(t)?o(t):t)}function So(e){const t="editing"===e.mode&&e.multiSelection;if(!t)return;const o=Fe().E.findEditableWithStore(t.start.store),n=null==o?void 0:o.props;return n&&!n.disabled?n.pasteBehavior:void 0}function To(){var e;if("editing"!==Ge().default.state.mode)return;const t=Ge().default.state.multiSelection.start,o=t.store.path;if("formula"!==o[o.length-1])return;const n=t.store.getRecordStoreAtRootPath();if((null==n?void 0:n.table)!==A().iU)return;const i=null==n||null===(e=n.getPropertiesStore())||void 0===e||null===(e=e.getValue())||void 0===e||null===(e=e.collection_id)||void 0===e||null===(e=e[0])||void 0===e?void 0:e[0];if(!i)return;const r={table:O().vF,id:i,spaceId:n.getSpaceId()},a=n.getRecordModel(r);return a?{parentCollection:a,start:t,getRecordModel:n.getRecordModel}:void 0}function Mo(){const e=_e().default.state.stores;if("editing"!==Ge().default.state.mode)return e.length>0&&e[0].isInsideFactoryOrDuplicateBlocksAction();if(0===e.length)return!1;const{multiSelection:t}=Ge().default.state,o=t.start.store;if(!o.isTable(A().iU))return!1;const n=fe().W(o);return Boolean(n)}function Co(e){const{text:t,transaction:o,environment:n,editingSelection:i,selectAll:r}=e,a=(0,V().parseRoute)({url:t,baseUrl:ae().default.domainBaseUrl,publicDomainName:ae().default.publicDomainName,isMobile:n.device.isMobile,protocol:ae().default.protocol,currentUrl:window.location.href}),s="page"===a.name&&a.blockId?(0,I().nR)({pageId:a.blockId,peekViewBlockId:a.peekViewBlockId,peekMode:a.peekMode,discussionId:a.discussionId,scrollToBlockId:a.scrollToBlockId,collectionViewId:a.collectionViewId}):t,l=nt().ao({environment:n,store:i.store,selection:i.selection,transaction:o});nt().ST({environment:n,store:i.store,selection:l,annotationKey:"a",transaction:o,updateSelection:!1}),ht().WO({environment:n,store:i.store,selection:l,annotation:["a",s],transaction:o}),it().setSelection({store:i.store,selection:{startIndex:r?l.startIndex:l.endIndex,endIndex:l.endIndex}})}const Io=/\<\!-- wp:/;const xo=/\u2028/g;function wo(e){var t;let{environment:o,event:i,disableEmbedMenu:r,transaction:a,onPasteFiles:s,formulasModule:l,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u}=e;const p=Ae().default.checkGate({gateName:"allow_cut_copy_comment"});if(i.preventDefault(),it().syncTextSelection(),!i.clipboardData)return;const f=Zt(i.clipboardData,o.device),g=Array.from(Array((null===(t=f.items)||void 0===t?void 0:t.length)??0).keys()).flatMap((e=>{var t;const o=f.items[e];if("file"!==o.kind)return[];const n=null===(t=o.getAsFile())||void 0===t||null===(t=t.name.match(/\.[^.]+$/))||void 0===t?void 0:t[0];return n?[n]:[]}));Ze().VJ(o,{source:"editor",types:f.types||[],fileExtensions:g,htmlContent:f.getData("text/html")});const{text:b,html:k,multiTextSelectionData:v,textSelectionData:h,blockSelectionData:S,isFromMicrosoftOffice:M,isHtmlTable:C}=Qt({clipboardData:f,tinyMceMicrosoftWordPasteFilter:u}),I=$t(f,Pt,At),x=function(e){return e.clipboardData?e.clipboardData.items?J().oA(Array.from(e.clipboardData.items).map((e=>{const t=e.getAsFile();if(t&&t.size>0)return new File([t],t.name??ve().Z.formatMessage(It.untitled),{type:e.type})}))):m().p4(e.clipboardData.files):[]}(i),w=So(Ge().default.state),F=(null==S?void 0:S.action)||(null==v?void 0:v.action)||(null==h?void 0:h.action);a.annotateWithUserAction("cut"===F?"paste.from_cut":pe().xF);const D=b.includes("\n"),R="body"===(0,Ie().qK)()&&!h;if((x.length>0||S||D&&!R)&&!(0,Ye().ww)(o))return;const P=function(e){const t=$t(e,Bt,Ot),o=null==t?void 0:t.mode;if(!o)return;return wt[o]||"Plain Text"}(f),B=D&&P&&"inline"!==w&&!(0,Ie().qK)()?Fo({codeLanguage:P,environment:o,transaction:a}):void 0;$e().bO(o,{pastedText:b,source:"editor_paste"});const U=Re().UQ(),L=Re().mv(),E=i.clipboardData.getData(ne().mH),V=To();if(x.length>0&&!M&&!C)a.logDebugMessage("paste: file/image detected -> onPasteFiles"),s({environment:o,files:x,transaction:a});else if(R)a.logDebugMessage("paste: editing code block contents with no Notion text selection -> pasteRawText"),Do(o,b,a);else if(B)a.logDebugMessage("paste: pasting code in existing empty text block with no selection or new code block after selection  -> pasteRawText"),Do(o,b,a);else if(V){a.logDebugMessage("paste: formulaInformation detected, attempting to paste as formula");const{parentCollection:e,start:t}=V,n=[[b]],i=e;if(!i||!l)return void Do(o,b,a);const r=Ge().default.state;"multiSelection"in r&&nt().pz({environment:o,multiSelection:r.multiSelection,transaction:a});const s=(0,y().UQ)({formulasModule:l,getRecordModel:V.getRecordModel,sourceCollection:i,textValue:n,featureGates:(0,me().W)()});nt().mM({environment:o,tokens:s,store:t.store,index:t.index,transaction:a})}else if("plaintext"===w)a.logDebugMessage("paste: plaintext paste behavior detected, pasting as inline html"),go({environment:o,html:b,transaction:a,stripText:!0,stripSurroundingWhitespace:!0,disableEmbedMenu:r,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u});else if(v){a.logDebugMessage("paste: multiTextSelectionData detected, attempting to paste as textselection");const e=function(e){const{environment:t,transaction:o,multiTextSelectionData:n,disableEmbedMenu:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}=e,s=e.pasteBehavior||"inline",l=e.html||zt({markdown:e.text,markdownLinkifyIt:r});if("editing"===Ge().default.state.mode)switch(s){case"inline":return!!l&&(go({environment:t,html:l,transaction:o,stripText:!1,stripSurroundingWhitespace:!0,disableEmbedMenu:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}),!0);case"block":return rt({environment:t,clipboardData:n,transaction:o,preventLegacyTransclusions:(0,ke().hC)()});default:(0,X().t1)(s)}}({multiTextSelectionData:v,environment:o,html:k,text:b,transaction:a,disableEmbedMenu:r,pasteBehavior:w,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u});e||(a.logDebugMessage("paste: could not paste as textSelection -> paste as blockSelection"),co(o,v.blockSelection,I,a))}else if(h&&h.editing){a.logDebugMessage("paste: textSelectionData detected, pasting text selection");const e=(0,oe().dI)(),t=(null==I?void 0:I.id)!==(null==e?void 0:e.id);!function(e){const{environment:t,textSelectionData:o,transaction:n,disableEmbedMenu:i,removeDiscussions:r}=e,a=_e().default.getCurrentRecordCache(),{editing:s,selection:l}=o;let{tokensInsideRange:d}=G().xrQ(s,l.startIndex,l.endIndex);d=G().V3g(d,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:r??!0});const u=(0,ue().RM)();if(u&&!(u.isInsideTemplate()||Mo()||u.isInsideFactoryOrDuplicateBlocksAction())&&(d=(0,j().KV)(d,{currentUserId:t.currentUser.id,currentTimeZone:(0,T().r)()})),"body"===(0,Ie().qK)()){const e=G().vNd(d);e&&(d=e)}const p="editing"===Ge().default.state.mode&&Ge().default.state.multiSelection;if(p){if(!(0,ye().iG)(p)){const t=(0,ye().QY)(p);if(t){const n=G().KU1(o.editing,o.selection.startIndex,o.selection.endIndex);if(1===n.length){const[o,i]=n[0],r=i&&G().rlz(i);if(r){const n=G().zW$(r);if([o,`http://${o}`,`https://${o}`].includes(n))return void Co({environment:e.environment,text:n,transaction:e.transaction,editingSelection:t})}}}}const r=(0,Te().sQ)(p.start.store),a=r?Ve().MT.getMode(r):"default";if("suggest"===a){const e=re().oG(t,n,p);re().Sz({environment:t,multiSelection:p,transaction:n,discussionStore:e}),d=G().WO0({textValue:d,selection:{startIndex:0,endIndex:1/0},annotation:[G().GKr.SuggestionInsertText,e.id]})}else"default"===a&&nt().pz({environment:t,multiSelection:p,transaction:n});const s=Ge().default.state;if("editing"===s.mode){const e=s.multiSelection;if(o.blockType&&0===l.startIndex){const i=(0,Te().sQ)(e.start.store);i&&"page"!==o.blockType&&(0,Se().Nm)(i)&&ce().transformBlocks({environment:t,blocks:[i],blockType:o.blockType,transaction:n})}ao({environment:t,store:e.end.store,tokens:d,index:e.end.index,transaction:n,disableEmbedMenu:"suggest"===a||i,multiTextSelection:p})}}else if(a){var m;const e=_e().default.state.stores,o=gt().j4({environment:t,type:c().Ti.text,inMemoryRecordCache:a,transaction:n,spaceId:0!==e.length?e[e.length-1].pointer.spaceId:null===(m=ue().RM())||void 0===m?void 0:m.pointer.spaceId}),i=o.getTitleStore();i&&nt().mM({environment:t,store:i,tokens:d,index:0,transaction:n}),lo({environment:t,blocks:[o],transaction:n,replaceEmptyTextBlock:!1}),je().W(t,{from:"paste",type:c().Ti.text,creating_block_id:o.id,parent_collection_id:o.getParentCollectionIdUpToTwoLevels()})}}({environment:o,textSelectionData:h,transaction:a,disableEmbedMenu:r,removeDiscussions:!p||("copy"===F||t)})}else if(S&&S.blocks.length>0&&"inline"!==w)a.logDebugMessage("paste: blockSelectionData detected, pasting block selection"),co(o,S,I,a);else if(U&&L&&E){const{simpleTableStore:e}=U.getProps(),{selection:t}=L,r=Re().h4(e);t&&r&&yt().j0({clipboardActions:n,environment:o,simpleTableStore:e,selection:t,currentRows:e.getContentStores(),columnOrder:r,event:i,transaction:a,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u})}else if(k)if(U&&L){const{simpleTableStore:e}=U.getProps(),{selection:t}=L,r=Re().h4(e);t&&r&&(a.logDebugMessage("paste: pasting selection into simple table"),yt().j0({clipboardActions:n,environment:o,simpleTableStore:e,selection:t,currentRows:e.getContentStores(),columnOrder:r,event:i,transaction:a,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u}))}else(D||C)&&"inline"!==w?(a.logDebugMessage("paste: pasting as html"),bo({environment:o,html:k,transaction:a,tinyMceMicrosoftWordPasteFilter:u})):(a.logDebugMessage("paste: pasting as inline html"),go({environment:o,html:k,transaction:a,stripText:!1,stripSurroundingWhitespace:!1,disableEmbedMenu:r,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u}));else a.logDebugMessage("paste: pasting as markdown"),uo({environment:o,text:b,disableEmbedMenu:r,transaction:a,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u});Ne().default.setKeyboardMode(!0)}function Fo(e){const{codeLanguage:t,environment:o,transaction:n}=e,i=Ge().default.state,r="editing"===i.mode&&i.multiSelection,a=_e().default.state.stores;if(!r&&0===a.length)return;let s,l,d;if(r?(s=r.start.store,l=r.end.store,d=(0,Te().sQ)(l)):(s=a[0],l=a[a.length-1],d=l),!d)return;let u=d;if((0,Se().Nm)(d))!function(e){const{blockStore:t,environment:o,transaction:n,codeLanguage:i}=e;ce().transformBlocks({environment:o,blocks:[t],blockType:"code",transaction:n}),lt().E5({blocks:[t],language:i,transaction:n})}({blockStore:d,environment:o,transaction:n,codeLanguage:t});else{const e=(0,Te().sQ)(d);if(!e)return;const t=s.inMemoryRecordCache;if(!t)return;u=gt().j4({environment:o,type:c().Ti.code,inMemoryRecordCache:t,transaction:n,spaceId:e.pointer.spaceId}),ft().BE({parentStore:e.getContentStore(),afterStore:l,insertStore:u,transaction:n})}Ce().clear(o);const p=(0,Te().mh)(u);return p&&it().setSelectionAtStart({store:p}),u}function Do(e,t,o){const n="editing"===Ge().default.state.mode&&Ge().default.state.multiSelection;if(n){const i=(0,Te().sQ)(n.start.store);nt().hJ({environment:e,editorMode:i?Ve().MT.getMode(i):"default",multiSelection:n,string:t,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:o})}}function Ro(e){const t=e.getNavigableBlockStore();if(t)return(0,ge().Hu)({store:t,scrollToBlockId:t.id===e.id?void 0:e.id,fullyQualified:!0,pageVisitSource:l().tY.CopyLink,embedded:!1})}function Po(e){const{environment:t,blocks:o}=e,n=o[0];ie().wG(),De().MO();const i=Ro(n);if(i){Vo({environment:t,stringValue:i,copiedMessage:n.isPageBlock()||n.isFormBlock()?xt.copiedLinkToClipboard:xt.copiedBlockLinkToClipboard})}}function Bo(e){const{environment:t,blocks:o}=e,n=o[0];ie().wG(),De().MO();const i=Ro(n),r=function(e,t){var o;const n=Ro(t);if(!n)return;const i=e.currentUser.id,r=(0,g().Ho)({blockId:t.id,intl:ve().Z.getIntl(),getRecordValue:t.inMemoryRecordCache.makeGetRecordValueFn(i),userTimeZone:(0,T().r)()}),a=null===(o=t.getBlockIconStore())||void 0===o?void 0:o.getValue(),s=[(0,x().Z)(a)?a:void 0,r].filter(X().$K).join(" ");return s?`<a href="${n}"><span>${s}</span></a>`:n}(t,n);if(i&&r){Eo({environment:t,stringValue:i,htmlValue:r,copiedMessage:n.isPageBlock()?xt.copiedPageLinkToClipboard:n.isFormBlock()?xt.copiedFormLinkToClipboard:xt.copiedBlockLinkToClipboard})}}function Uo(e){const{environment:t,blocks:o}=e;if(o.length<2)return Po(e);ie().wG(),De().MO();const n=o.map(Ro).filter(X().$K);if(n.some(Boolean)){const e=n.length>1?xt.copiedLinksToClipboard:xt.copiedLinkToClipboard;Vo({environment:t,stringValue:n.join("\n\n"),copiedMessage:e})}}function Lo(e){const{environment:t,blocks:o}=e,n=o[0];if(!n.isDefined())return;const i=n.getModel(),r=n.getProperties(),a=n.getFormat();let s;if(n.isType(c().Ti.bookmark))s=null==r?void 0:r.link,s=G().QaF(s);else if(i.isType(c().Ok))s=null==r?void 0:r.source,s=G().QaF(s);else if(n.isType(c().Ti.file))s=null==r?void 0:r.source,s=G().QaF(s);else if(n.isType(c().Ti.externalObjectInstance)||n.isType(c().Ti.externalObjectInstancePage))s=(null==a?void 0:a.original_url)||(null==a?void 0:a.uri);else if(n.isType(c().Ti.collectionView)){var l;const e=null===(l=n.getCollectionStore())||void 0===l?void 0:l.getValue();var d;if(e&&(0,b().Gq)(e))s=null===(d=e.format)||void 0===d?void 0:d.original_url}else{if(!n.isType(c().Ti.alias))return;s=null==a?void 0:a.comment_alias_url}if(!s)return;if(k().iS(s))return void h().log({level:"error",from:"clipboardActions",type:"copyDirectLinkToContent",error:{message:"Attempted to copy a direct signed url for S3-housed content."}});if(s=ee().yn(s),!s)return;ie().wG(),De().MO();Vo({environment:t,stringValue:s,copiedMessage:xt.copiedLinkToClipboard})}function Eo(e){return Ao(e)}function Vo(e){return Ao(e)}async function Ao(e){const{environment:t,htmlValue:o,stringValue:n,copiedMessage:i,showCopyModal:r}=e;function a(){kt().ZH({environment:t}),Le().default.setState({...Le().default.state,active:!0,stringValue:n})}if(r)a();else try{var s;if(t.device.isElectron&&null!==(s=dt().electronApi)&&void 0!==s&&s.clipboard){const e={text:n};o&&(e.html=o),await dt().electronApi.clipboard.write(e)}else if("undefined"==typeof ClipboardItem)await navigator.clipboard.writeText(n);else{const e={"text/plain":new Blob([n],{type:"text/plain"})};o&&(e["text/html"]=new Blob([o],{type:"text/html"}));const t=new ClipboardItem(e);await navigator.clipboard.write([t])}i&&vt().oV({label:ve().Z.formatMessage(i)})}catch{a()}}function Oo(){document.queryCommandSupported("copy")&&document.execCommand("copy")}async function No(e,t){let o;o="string"==typeof t?t:JSON.stringify(t),o&&await Vo({environment:e,stringValue:o,copiedMessage:xt.copiedToClipboard})}function Wo(e){const{environment:t,textSelection:o,markdownSerializationOptions:n,markdownLinkifyIt:i}=e,r=(0,ye().QY)(o);if(r&&r.selection.startIndex!==r.selection.endIndex)return function(e){const{environment:t,singleStoreTextSelection:o,markdownSerializationOptions:n}=e,{store:i,selection:r}=o,a=t.currentUser.id,s=i.inMemoryRecordCache,c=ve().Z.getIntl(),d=i.getValue(),p=G().KU1(d,r.startIndex,r.endIndex),m=i.getRecordStoreUIRoot().getValue();if(!m)return;const f={id:m.id,table:A().iU,spaceId:m.space_id},g=s.makeGetRecordValueFn(a);return F().CK({textValue:p,exportArgs:{root:f,navigableBlockId:f.id,renderParentBlockId:void 0,blockId:f.id,userTimeZone:(0,T().r)(),intl:c,getRecordValue:g,numberedListCache:{},bulletedListCache:{},getRecordsWithParent:()=>[],getExportedPathToFile:e=>{let{toFileURI:t}=e;return t},getExportedRenderAsset:e=>{let{toFileURI:t}=e;return t},getExportedPathToPage:e=>{let{toPageId:t}=e;return(0,u().Z)({pageId:t,pageValue:g({table:A().iU,id:t}),baseUrl:ae().default.domainBaseUrl,pageVisitSource:l().tY.Export})},baseUrl:ae().default.domainBaseUrl,publicDomainName:ae().default.publicDomainName,transformAnnotation:null==n?void 0:n.transformAnnotation,transformBlockMapping:null==n?void 0:n.transformBlockMapping,resultCache:new Map,regExpCache:new Map,experimentService:Ae().default,collectionFeatureGates:(0,me().W)(),formulasModule:v()}})}({environment:t,singleStoreTextSelection:r,markdownSerializationOptions:n});const a=Xt({environment:t,multiSelection:o,action:"copy"});if(!a)return;const s=o.start.store.inMemoryRecordCache,c=o.start.store.getRecordStoreUIRoot().getValue();if(!c)return;const d=t.currentUser.id,{markdown:p}=(0,pe().Ef)({clipboardData:a,rootBlock:{id:c.id,table:A().iU,spaceId:c.space_id},isWindows:t.device.isWindows,fallbackGetRecordValue:s.makeGetRecordValueFn(d),markdownSerializationOptions:n,markdownLinkifyIt:i,formulasModule:v()});return p}function _o(e){const{environment:t,inMemoryRecordCache:o,text:n,transaction:i,markdownOptions:r,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:l}=e,c=zt({markdown:n,markdownOptions:r,markdownLinkifyIt:a});if(!c)return;const d=document.createElement("div");d.innerHTML=ho({html:c,tinyMceMicrosoftWordPasteFilter:l});const{currentUserStore:u,currentSpaceStore:p}=Ue().default.state;if(!u||!p)return;const m=u.getValue();if(!m)return;const f=(ue().RM()??p).id,g=p.id,b=(0,be().l5)({environment:t,spaceId:g}),k=t.idCreator.getSpaceShortIdCreator(g,b),{allOperations:v,rootContentIds:y}=M().$O({actor:(0,s().dp)(m),parent:{id:f,table:A().iU,spaceId:p.id},rootNode:d,deps:{importFileMap:{},window,intl:ve().Z.getIntl(),randomID:K().ZP,spaceIdCreator:k,randomShortID:q().ZP,isPhoneNumber:B().x,emojiData:de().Z.state},options:{useCrdt:(0,se().WA)(p),ignoreBlockCount:!1}});for(const s of v)if((0,Y().Qf)(s)){const e=new(We().G)(t,s.pointer,{inMemoryRecordCache:o,userId:m.id});St().applyCrdtTextOperation({store:e,operation:s,invertedOperation:void 0,transaction:i})}else if((0,R().V_)(s)){const e=new(We().ST)({environment:t,pointer:s.pointer,recordStoreOptions:{inMemoryRecordCache:o,userId:m.id}});St().applyOperation({store:e,operation:s,transaction:i})}else(0,X().t1)(s);return y.map((e=>new(We().G)(t,{table:A().iU,id:e},{inMemoryRecordCache:o})))}function Go(e){const{event:t,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:n}=e;if(!t.clipboardData)return;const{text:i,html:r,multiTextSelectionData:a,textSelectionData:s,blockSelectionData:l}=Qt({clipboardData:t.clipboardData,tinyMceMicrosoftWordPasteFilter:n});if(a)return fo({text:i,html:r,stripText:!1,stripSurroundingWhitespace:!0,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:n});if(s){const{editing:e,selection:t}=s;return G().V3g(G().xrQ(e,t.startIndex,t.endIndex).tokensInsideRange,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:!0})}return r||i?function(e){const{text:t,html:o,blockSelectionData:n,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:r}=e,a=t.includes("\n");return a||n&&n.blocks.length>0?G().TPx(t):fo({text:t,html:o,stripText:!1,stripSurroundingWhitespace:!0,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:r})}({text:i,html:r,blockSelectionData:l,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:n}):void 0}},905:(e,t,o)=>{o.d(t,{QZ:()=>B,az:()=>L,pg:()=>U});var n=()=>o(66077),i=()=>o(435308),r=()=>o(156642),a=()=>o(530980),s=()=>o(572680),l=()=>o(396136),c=()=>o(542973),d=()=>o(81954),u=()=>o(955620),p=()=>o(696459),m=()=>o(636340),f=()=>o(879952),g=()=>o(990966),b=()=>o(205228),k=()=>o(223321),v=()=>o(852465),y=()=>o(505462),h=()=>o(639832),S=()=>o(490091),T=()=>o(656769),M=()=>o(788206),C=()=>o(543842),I=()=>o(826955),x=()=>o(439373),w=()=>o(351972),F=()=>o(282662),D=()=>o(143346),R=()=>o(970105),P=()=>o(269299);function B(e){const{environment:t,textStore:o,blockStore:r,url:a,oldTextValue:u,urlSelection:p}=e;if(h().Z.state.open||k().Z.state.open||C().Z.state.open||T().Z.state.open)return!1;const m=y().get();if(!m)return!1;const f=y().getRect(m);if(!f)return!1;const g=(0,s().parseRoute)({url:a,baseUrl:b().default.domainBaseUrl,publicDomainName:b().default.publicDomainName,isMobile:t.device.isMobile,protocol:b().default.protocol,currentUrl:window.location.href});if("page"===g.name&&!!g.discussionId&&g.discussionId){const e=g.discussionId,s=g.blockId;if(!s)return!1;const m=r.getParentBlockStore();if(!m)return!1;const b=(0,I().Kv)(m,{table:l().iU,id:s,spaceId:(0,d().J)(m.pointer.spaceId)}),k=(0,I().Kv)(b,{table:c().qF,id:e,spaceId:(0,d().J)(r.pointer.spaceId)});if("none"===k.getRole())return!1;const y=new(i().default)((()=>v().D4(k)[0]),{debugName:"firstCommentStore"}),h=new(n().Z)({name:"internalUnfurlingMenuActions.activate",isTemporaryData:!0});t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(h);const T=r.clone(h),C=o.clone(h),x=m.clone(h);return M().Z.setState({args:{commentStore:y},stores:{blockStore:r,textStore:o,parentStore:m},temporaryStores:{blockStore:T,textStore:C,parentStore:x},temporaryRecordCache:h,focusedIndex:S().Z.Preview,selectionRect:f,oldTextValue:u,open:!0,url:a,urlSelection:p}),w().el(t,{url:a}),!0}return!1}function U(e){const{actionType:t,environment:o,commentStore:n,useTempStores:i}=e,r=M().Z.state;if(!r.open)return;const{oldTextValue:s}=r,l=i?r.temporaryStores:r.stores,{textStore:c,blockStore:m,parentStore:b}=l,k=o.currentUser.id;if(k){if(i){r.temporaryRecordCache.clearCache();for(const e in r.temporaryStores){const t=r.temporaryStores[e],n={userId:k,pointer:t.pointer},i=o.defaultRecordCache.inMemoryRecordCache.getRecord(n);i?D().Wl({environment:o,inMemoryRecordCache:r.temporaryRecordCache,pointer:t.pointer,model:a().kk5.fromValue(t.pointer.table,i.value),role:i.role,updatePaths:[[]],userId:k,force:!0,debugSource:"setUnfurlType"}):D().uo({environment:o,inMemoryRecordCache:r.temporaryRecordCache,persistedRecordCache:void 0,pointer:t.pointer,userId:k})}}else o.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(r.temporaryRecordCache);switch(t){case S().Z.Link:f().eP({environment:o,store:r.stores.blockStore}),g().setSelection({store:r.stores.textStore,selection:{startIndex:r.urlSelection.endIndex,endIndex:r.urlSelection.endIndex}}),M().Z.setState({...r,focusedIndex:S().Z.Link});break;case S().Z.Mention:if(!n)return;const e=(0,d().J)(c.pointer.spaceId);if(!e)return;const i=n.id;P().createAndCommit({environment:o,userAction:"internalUnfurlingMenuActions.mention",canUndo:!0,perform:t=>{R().sO({environment:o,store:c,value:s,transaction:t}),R().lZ({environment:o,editorMode:"default",store:c,selection:{startIndex:r.urlSelection.startIndex,endIndex:r.urlSelection.startIndex},annotation:u().mfJ(i,e),transaction:t,analyticsFrom:"block"})}}),M().Z.setState({...r,focusedIndex:S().Z.Mention});break;case S().Z.Preview:if(!n)return;P().createAndCommit({environment:o,userAction:"internalUnfurlingMenuActions.preview",canUndo:!0,perform:e=>{R().sO({environment:o,store:c,value:s,transaction:e});const t=v().GP(n);if(!t)return;if(!v().HK(t)||!b||!t.getParentId())return;const i=x().k({environment:o,parentBlockStore:b,targetStore:n,transaction:e});if(F().BE({parentStore:b.getContentStore(),insertStore:i,afterStore:m,transaction:e}),0===u().QaF(r.oldTextValue).trim().length){const t=I().G.createChildStore(b.getContentStore(),r.stores.blockStore.pointer);F().Od({parentStore:b.getContentStore(),childToRemoveStore:t,transaction:e})}}}),M().Z.setState({...r,focusedIndex:S().Z.Preview});break;default:throw(0,p().t1)(t)}i||M().Z.setState({open:!1})}}function L(e){var t,o;const{blockStore:n,transaction:i}=e,a=n.getType(),s=n.getFormat(),l=n.getSpaceId();if(!n.isDefined()||a!==r().Ti.alias||null==s||null===(t=s.alias_pointer)||void 0===t||!t.id)return;const c=[u().YCD(u().mfJ(null==s||null===(o=s.alias_pointer)||void 0===o?void 0:o.id,l))];m().sW({store:n,data:{type:r().Ti.text},transaction:i}),m().sW({store:n.getFormatStore(),data:{alias_pointer:null},transaction:i}),R().sO({environment:n.environment,store:n.getBlockTitleStore(),value:c,transaction:i})}},630903:(e,t,o)=>{o.r(t),o.d(t,{maybeTurnCollectionViewIntoCollectionViewPage:()=>M,transformBlocks:()=>T,transformIntoColumnList:()=>C});o(241792);var n=()=>o(492788),i=()=>o(156642),r=()=>o(396136),a=()=>o(513670),s=()=>o(282662),l=()=>o(332542),c=()=>o(771678),d=()=>o(636340),u=()=>o(453999),p=()=>o(879952),m=()=>o(990966),f=()=>o(269299),g=()=>o(28063),b=()=>o(540413),k=()=>o(487270),v=()=>o(852465),y=()=>o(749826),h=()=>o(826955),S=()=>o(262453);function T(e){const{environment:t,blocks:o,blockType:S,transaction:T}=e;if(S!==i().Ti.transclusionContainer)if(S===i().Ti.callout&&y().default.checkGate({gateName:"create_v2_callouts"}))!function(e){const{environment:t,blocks:o,transaction:n}=e,a=o[0];if(!a)return;const s=a.getRecordStoreUIParent();if(!s||!(0,v().dz)(s))return;const u=s.getRecordStoreUIParent();if(!(u&&u instanceof h().G))return;const f=(0,k().TS)({environment:t,table:r().iU,spaceId:u.getSpaceId()}),g=d().j4({environment:t,id:f,type:i().Ti.callout,inMemoryRecordCache:s.inMemoryRecordCache,transaction:n,spaceId:u.getSpaceId(),format:{callout_version:2}});l().jG({parentStore:s,childStore:g,after:a.id,transaction:n});I({newParentStore:g.getContentStore(),blocks:o,transaction:n}),c().WO({store:g,transaction:n}),m().clear({environment:t}),p().ZH({environment:t}),p().Z5({environment:t,stores:[g]})}({environment:t,blocks:o,transaction:T});else if(S!==i().Ti.columnList)if(S!==i().Ti.slide)if((0,i().sX)(S)){const e=parseInt(S.replace("column","").replace("block","")),i=a().oA(a().DZ(e-1,(()=>b().insertTextBelow({environment:t,blocks:o,transaction:T})))),r=[...o,...i],s=C({environment:t,blocks:r,transaction:T});n().default.afterNextFlush((()=>{m().setSelectionAtStart({store:s[0].getBlockTitleStore()})}))}else for(const i of o)if(i.isCalloutV2()){const e=i.getParentBlockStore();if(e){const r=i.getContentStores();f().applyOperation({store:e,operation:{pointer:e.pointer,path:["content"],command:"insertChildrenAfter",args:{ids:r.map((e=>e.id)),after:i.id}},transaction:T}),l().hr({parentStore:e.getContentStore(),childStore:i,transaction:T});for(const e of r)g().vs({environment:t,block:e,blockType:S,transaction:T,isMultiBlockTransformation:o.length>1});n().default.afterNextFlush((()=>{u().DQ(t,r.map((e=>e.id)))}))}}else g().vs({environment:t,block:i,blockType:S,transaction:T,isMultiBlockTransformation:o.length>1});else!function(e){const{environment:t,blocks:o,transaction:n}=e,a=o[0];if(!a)return;const s=a.getRecordStoreUIParent();if(!s||!(0,v().dz)(s))return;const c=s.getRecordStoreUIParent();if(!(c&&c instanceof h().G))return;const u=(0,k().TS)({environment:t,table:r().iU,spaceId:c.getSpaceId()}),f=d().j4({environment:t,id:u,type:i().Ti.slide,inMemoryRecordCache:s.inMemoryRecordCache,transaction:n,spaceId:c.getSpaceId()});l().jG({parentStore:s,childStore:f,after:a.id,transaction:n});I({newParentStore:f.getContentStore(),blocks:o,transaction:n}),m().clear({environment:t}),p().ZH({environment:t}),p().Z5({environment:t,stores:[f]})}({environment:t,blocks:o,transaction:T});else C({environment:t,blocks:o,transaction:T});else!function(e){const{environment:t,blocks:o,transaction:n}=e,a=o[0];if(!a)return;const l=a.getRecordStoreUIParent();if(!l||!(0,v().dz)(l))return;const c=l.getRecordStoreUIParent();if(!c||!(0,v().OY)(c))return;if(!c.isDefined())return;const u=(0,k().TS)({environment:t,table:r().iU,spaceId:c.getSpaceId()}),f=d().j4({environment:t,id:u,type:i().Ti.transclusionContainer,inMemoryRecordCache:l.inMemoryRecordCache,transaction:n,spaceId:c.getSpaceId()});s().BE({parentStore:l,insertStore:f,afterStore:a,transaction:n});I({newParentStore:f.getContentStore(),blocks:o,transaction:n}),m().clear({environment:t}),p().ZH({environment:t}),p().Z5({environment:t,stores:[f]})}({environment:t,blocks:o,transaction:T})}function M(e){let{environment:t,blocks:o,transaction:n}=e;(function(e){return 1===e.length&&"collection_view"===e[0].getType()})(o)&&T({environment:t,blocks:o,blockType:"collection_view_page",transaction:n})}function C(e){const{environment:t,blocks:o,transaction:n}=e,a=o[0];if(!a)return[];const l=a.recordStoreUIParentStore;if(null==l||!l.valueIs(S().i))return[];const c=(0,k().TS)({environment:t,table:r().iU,spaceId:a.getSpaceId()}),u=d().j4({environment:t,id:c,type:i().Ti.columnList,inMemoryRecordCache:a.inMemoryRecordCache,transaction:n,spaceId:a.getSpaceId()}),{childStore:p}=s().Vt({parentStore:l,insertStore:u,beforeStore:a,transaction:n});return o.map((e=>{const o=(0,k().TS)({environment:t,table:r().iU,spaceId:a.getSpaceId()}),c=d().j4({environment:t,id:o,type:i().Ti.column,inMemoryRecordCache:a.inMemoryRecordCache,transaction:n,spaceId:a.getSpaceId()}),{childStore:u}=s().Od({parentStore:l,childToRemoveStore:e,transaction:n}),{childStore:m}=s().BE({parentStore:p.getContentStore(),insertStore:c,transaction:n}),{childStore:f}=s().BE({parentStore:m.getContentStore(),insertStore:u,transaction:n});return f}))}function I(e){const{newParentStore:t,blocks:o,transaction:n}=e;for(const i of o){const e=i.getRecordStoreUIParent();null!=e&&e.valueIs(S().i)&&(s().Od({parentStore:e,childToRemoveStore:i,transaction:n}),s().R3({parentStore:t,appendStore:i,transaction:n}))}}},490091:(e,t,o)=>{o.d(t,{Z:()=>i});var n=function(e){return e[e.Preview=0]="Preview",e[e.Mention=1]="Mention",e[e.Link=2]="Link",e}(n||{});const i=n},516623:(e,t,o)=>{o.d(t,{default:()=>i});class n extends(()=>o(263184))().default{getInitialState(){return{active:!1,stringValue:""}}}const i=new n},910595:(e,t,o)=>{o.d(t,{V:()=>r});var n=()=>o(226413),i=()=>o(114079);function r(e){let{intl:t,propertySchema:o,value:r}=e,a=i().dk;return o&&(0,n().G$)(o)&&(a=o.number_format??i().dk),i().uf(r,a,t)}},756191:(e,t,o)=>{o.d(t,{FR:()=>f,OY:()=>m,ic:()=>p,sB:()=>u,sG:()=>d,y_:()=>g});o(241792);var n=()=>o(513670),i=()=>o(696459),r=()=>o(834458),a=()=>o(193962),s=()=>o(455222),l=()=>o(177634);function c(e){switch(e){case"checkbox":return"boolean";case"number":return"number";case"text":return"text";case"date":return"date";case"array":return"array";case"block":return"block";case"person":return"person";case"select":return"select";case"function":return"function";case"unknown":return"unknown";case"undefined":return"undefined";default:(0,i().t1)(e)}}function d(e){switch(e.type){case s().$E.InvalidCharacter:return{...a().mr.InvalidCharacter,values:{errorCharacter:e.character}};case s().$E.UnclosedStringLiteral:return a().mr.UnclosedStringLiteral;case s().$E.UnclosedComment:return a().mr.UnclosedComment;case s().$E.TokenExpected:return{...a().mr.TokenExpected,values:{expectedToken:e.token}};case s().$E.StringLiteralContainsToken:return a().mr.StringLiteralContainsToken;case s().$E.ExpressionExpected:return a().mr.ExpressionExpected;case s().$E.PropertyTokenOrFunctionExpected:return a().mr.PropertyTokenOrFunctionExpected;case s().$E.EndOfInputExpected:return a().mr.EndOfInputExpected;case s().$E.UnexpectedError:return a().mr.UnexpectedError;case s().$E.TooDeeplyNested:return a().mr.TooDeeplyNested;default:(0,i().t1)(e)}}function u(e){switch(e.type){case s().h4.FunctionCallArgumentWrongType:case s().h4.FunctionCallUnexpectedArgument:return e.argument;default:return e.node}}function p(e,t){let o;switch(t.type){case s().h4.ThisRowTypeNotFound:o=a().o8.ThisRowTypeNotFound;break;case s().h4.ThisRowNotBlockWithCollection:o=a().o8.ThisRowNotBlockWithCollection;break;case s().h4.MissingPropertyOnThisRow:o={...a().o8.MissingPropertyOnThisRow,values:{propertyName:t.property}};break;case s().h4.MissingContextVariable:{const e=(0,l().Xp)(t.token)?t.token.contextValueId:t.token.valueId;o={...a().o8.MissingContextVariable,values:{valueId:e}}}break;case s().h4.MissingBlock:o={...a().o8.MissingBlock,values:{blockId:t.token.blockId}};break;case s().h4.CallingNotFunction:o={...a().o8.CallingNotFunction,values:{expressionType:c(t.callee.type.type)}};break;case s().h4.FunctionCallTooFewArguments:o={...a().o8.FunctionCallTooFewArguments,values:{minNumParameters:t.minNumParameters,functionName:t.libraryFunction.name,numArguments:t.numArguments}};break;case s().h4.FunctionCallUnexpectedArgument:o={...a().o8.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case s().h4.FunctionCallArgumentWrongType:o={...a().o8.FunctionCallArgumentWrongType,values:{argumentType:c(t.argument.type.type),functionName:t.libraryFunction.name}};break;case s().h4.MemberPropertyMismatchCollection:o={...a().o8.MemberPropertyMismatchCollection,values:{propertyName:t.token.property}};break;case s().h4.MemberPropertyMissing:o={...a().o8.MemberPropertyMissing,values:{propertyName:t.property}};break;case s().h4.MemberPropertyTargetNotBlock:o=a().o8.MemberPropertyTargetNotBlock;break;case s().h4.MemberPropertyTypeInvalid:o={...a().o8.MemberPropertyTypeInvalid,values:{propertyName:t.propertyName,propertyType:t.propertyType}};break;case s().h4.UndefinedIdentifier:o={...a().o8.UndefinedIdentifier,values:{identifier:t.node.text}};break;case s().h4.UnifiedFunctionCannotFindFunction:o={...a().o8.UnifiedFunctionCannotFindFunction,values:{functionName:t.name}};break;case s().h4.UnifiedFunctionNoArguments:o={...a().o8.UnifiedFunctionNoArguments,values:{functionName:t.libraryFunction.name}};break;case s().h4.UnifiedFunctionTargetWrongType:o={...a().o8.UnifiedFunctionTargetWrongType,values:{functionName:t.libraryFunction.name,targetType:c(t.expression.type.type)}};break;case s().h4.CannotRelativelyCompareTypes:o={...a().o8.CannotRelativelyCompareTypes,values:{lhsType:c(t.lhsType.type),rhsType:c(t.rhsType.type)}};break;case s().h4.CannotDoMathOnType:o={...a().o8.CannotDoMathOnType,values:{lhsType:c(t.lhsType.type),rhsType:c(t.rhsType.type)}};break;case s().h4.UnaryMinusOnNonNumber:o={...a().o8.UnaryMinusOnNonNumber,values:{type:c(t.expression.type.type)}};break;case s().h4.IdentifierExpected:o=a().o8.IdentifierExpected;break;case s().h4.FunctionCallExpected:o={...a().o8.FunctionCallExpected,values:{functionName:t.functionName}};break;case s().h4.RenamedIdentifier:o={...a().o8.RenamedIdentifier,values:{identifier:t.identifier,renamedTo:t.renamedTo}};break;case s().h4.RemovedFunction:o={...a().o8.RemovedFunction,values:{functionName:t.functionName,alternative:t.alternative}};break;case s().h4.ContextVariableNotBlockWithCollection:o={...a().o8.ContextVariableNotBlockWithCollection,values:{valueId:t.token.contextValueId}};break;case s().h4.MissingPropertyOnContextVariable:o={...a().o8.MissingPropertyOnContextVariable,values:{propertyName:t.property,valueId:t.token.contextValueId}};break;case s().h4.BlockPropertyTypeInvalid:o={...a().o8.BlockPropertyTypeInvalid,values:{propertyName:t.propertyName}};break;case s().h4.DisallowedReturnType:{const n=t.allowedReturnTypes.map((t=>e.formatMessage((0,r().getHumanReadableType)(t)).toLocaleLowerCase()));o={...a().o8.DisallowedReturnType,values:{allowedReturnType:e.formatList(n,{style:"long",type:"conjunction"}),allowedReturnTypeCount:t.allowedReturnTypes.length,returnType:e.formatMessage((0,r().getHumanReadableType)(t.returnType)).toLocaleLowerCase()}};break}case s().h4.CrossSpacePropertyNotSupported:o={...a().o8.CrossSpacePropertyNotSupported};break;default:(0,i().t1)(t)}return{...o,values:{...o.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}}function m(e,t){let o;switch(t.type){case s().FY.MissingThisRow:o=a().YG.MissingThisRow;break;case s().FY.MissingSchemaPropertyOnThisRow:o={...a().YG.MissingSchemaPropertyOnThisRow,values:{propertyName:t.property}};break;case s().FY.ThisRowBlockPropertyMismatchCollection:o=a().YG.ThisRowBlockPropertyMismatchCollection;break;case s().FY.MissingContextVariable:o={...a().YG.MissingContextVariable,values:{valueId:t.valueId}};break;case s().FY.IdentifierNotFound:o={...a().YG.IdentifierNotFound,values:{identifier:t.node.text}};break;case s().FY.CannotRelativelyCompareTypes:o={...a().YG.CannotRelativelyCompareTypes,values:{lhsType:c(t.lhsType),rhsType:c(t.rhsType)}};break;case s().FY.CannotDoMathOnType:o={...a().YG.CannotDoMathOnType,values:{valueType:c(t.valueType)}};break;case s().FY.CannotCallNonFunction:o={...a().YG.CannotCallNonFunction,values:{calleeType:c(t.calleeType)}};break;case s().FY.UnifiedFunctionPropertyNotFound:o={...a().YG.UnifiedFunctionPropertyNotFound,values:{functionName:t.node.name}};break;case s().FY.LibraryFunctionExecutionError:const n=t.error instanceof s().Mu?t.error:void 0;o=(null==n?void 0:n.info.type)===s().sj.DateInvalidDurationUnit?{...a().z8.DateInvalidDurationUnit,values:{functionName:t.libraryFunction.name,invalidUnit:n.info.invalidUnit}}:(null==n?void 0:n.info.type)===s().sj.CannotUseToNumberOnList?{...a().z8.CannotUseToNumberOnList}:(null==n?void 0:n.info.type)===s().sj.CannotRoundToNonInteger?{...a().z8.CannotRoundToNonInteger,values:{precision:n.info.precision}}:(null==n?void 0:n.info.type)===s().sj.CannotRoundToTooManyDecimalPlaces?{...a().z8.CannotRoundToTooManyDecimalPlaces,values:{precision:n.info.precision}}:{...a().YG.LibraryFunctionExecutionError,values:{functionName:t.libraryFunction.name}};break;case s().FY.FunctionCallTooFewArguments:o={...a().YG.FunctionCallTooFewArguments,values:{functionName:t.libraryFunction.name}};break;case s().FY.FunctionCallUnexpectedArgument:o={...a().YG.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case s().FY.FunctionCallArgumentWrongType:o={...a().YG.FunctionCallArgumentWrongType,values:{functionName:t.libraryFunction.name,argumentType:c(t.argumentType)}};break;case s().FY.AccessingPropertyOnNonBlock:o=a().YG.AccessingPropertyOnNonBlock;break;case s().FY.MissingDataDependencyBlock:o={...a().YG.MissingDataDependencyBlock,values:{blockId:t.blockPointer.id}};break;case s().FY.MissingDataDependencyPerson:o={...a().YG.MissingDataDependencyPerson,values:{personId:t.personPointer.id}};break;case s().FY.MemberPropertyMismatchCollection:o=a().YG.MemberPropertyMismatchCollection;break;case s().FY.MissingPropertyOnSchemaForMemberProperty:o=a().YG.MissingPropertyOnSchemaForMemberProperty;break;case s().FY.UnaryMinusOnNonNumber:o={...a().YG.UnaryMinusOnNonNumber,values:{expressionType:c(t.expressionType)}};break;case s().FY.UnexpectedRecoveryNode:o=a().YG.UnexpectedRecoveryNode;break;case s().FY.UnexpectedError:o=a().YG.UnexpectedError;break;case s().FY.DepthExceeded:o=a().YG.DepthExceeded;break;case s().FY.CycleDetected:o=a().YG.CycleDetected;break;case s().FY.DownstreamParseFailure:o=a().YG.DownstreamParseFailure;break;case s().FY.MaxEvaluationTimeExceeded:o=a().YG.MaxEvaluationTimeExceeded;break;case s().FY.MissingSchemaPropertyOnCollection:o={...a().YG.MissingSchemaPropertyOnCollection,values:{collectionId:t.collectionId,propertyName:t.property}};break;case s().FY.ContextVariableWrongType:o={...a().YG.ContextVariableWrongType,values:{expectedType:t.expectedType,propertyType:t.resultType,valueId:t.valueId}};break;case s().FY.DisallowedValueType:{const n=t.allowedValueTypes.map((t=>e.formatMessage((0,r().getHumanReadableType)(t)).toLocaleLowerCase()));o={...a().o8.DisallowedReturnType,values:{allowedValueType:e.formatList(n,{style:"long",type:"conjunction"}),allowedValueTypeCount:t.allowedValueTypes.length,valueType:e.formatMessage((0,r().getHumanReadableValueType)(t.expressionValue)).toLocaleLowerCase()}};break}default:(0,i().t1)(t)}return(0,l().w7)(t)?{...o,values:{...o.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}:o}function f(e){const t=null==e?void 0:e.values;return[n().CE(e,"values"),t]}function g(e){return e.type===s().FY.DepthExceeded||e.type===s().FY.CycleDetected||e.type===s().FY.MaxEvaluationTimeExceeded||e.type===s().FY.LibraryFunctionExecutionError}},981850:(e,t,o)=>{function n(e){return/^(\+\d{1,2}[\s.-])?\(?\d{3}\)?[\s.-]\d{3}[\s.-]\d{4}$/.test(e)}function i(e){return/^[0-9 .()\-\+]{7,}$/.test(e)}o.d(t,{E:()=>i,x:()=>n})}}]);