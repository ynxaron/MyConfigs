"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[8564],{274707:(e,o,t)=>{t.d(o,{Z4:()=>d,yP:()=>i});var a=()=>t(677559);const n={TopbarLayoutInfoButtonEducationTooltip:new(a().Ss)("TopbarLayoutInfoButtonEducationTooltip",(()=>Promise.all([t.e(62743),t.e(36815)]).then(t.bind(t,811418)))),BuilderAddModuleButtonEducationTooltip:new(a().Ss)("BuilderAddModuleButtonEducationTooltip",(()=>t.e(41103).then(t.bind(t,737690))))},i=(0,a().kF)(n.TopbarLayoutInfoButtonEducationTooltip,(e=>e.default),{renderLoading:(e,o)=>o.children}),d=(0,a().kF)(n.BuilderAddModuleButtonEducationTooltip,(e=>e.default))},8564:(e,o,t)=>{t.d(o,{v:()=>q});t(821057),t(241792);var a=t(667294),n=()=>t(219727),i=()=>t(142735),d=()=>t(846550),r=()=>t(66006),l=()=>t(766537),s=()=>t(628370),u=()=>t(119891),g=()=>t(796408),m=()=>t(275200),c=()=>t(280977),p=()=>t(99537),y=()=>t(294630),v=()=>t(602801),b=()=>t(896641),M=(t(492176),t(7961),t(267602),t(653476),()=>t(210349)),h=()=>t(788860),f=()=>t(1910),_=()=>t(654133),w=()=>t(247724),T=()=>t(466970),A=()=>t(135515),x=()=>t(75433),I=()=>t(998901),B=()=>t(243144),S=()=>t(274860),L=()=>t(162178),C=t(785893);const P=(0,h().vU)({formLayoutAddModule:{id:"addModuleHoverMenu.formLayout.add",defaultMessage:"Add question"},pageLayoutAddModule:{id:"addModuleHoverMenu.pageLayout.add",defaultMessage:"Add"}}),D=32;function k(e){if("views_main_tab_modules"===e.area)throw new Error("[ViewsMain Not Implemented] AddModuleHoverMenu not implemented for views_main_tab_modules");const o=(0,h().YB)(),{layoutStore:t,addModuleHoverMenuStore:a,currentModuleSelection:n}=(0,L().J9)(),r=(0,i().VK)((()=>{if(a.state.isOpen)return a.state.moduleId}),[a]),l=(0,i().VK)((()=>{if(!r)return;const e=x().Z.findModuleContainer({layoutStore:t,moduleId:r});return e?e.getNode():void 0}),[r,t]),u=(0,i().VK)((()=>{if(!n||"new_module"===n.type)return!1;const e=t.getModuleById(n.moduleId);return"placeholder"===(null==e?void 0:e.type)}),[n,t]),g=(0,T().E)("layout_view_module"),m=(0,T().E)("layout_view_module_next"),c=(0,i().VK)((()=>{var o;if("views_main_tab_modules"===e.area)throw new Error("[ViewsMain Not Implemented] AddModuleHoverMenu not implemented for views_main_tab_modules");if("form_conditional_modules"===e.area)return!1;const n=t.getModules()[e.area].filter((e=>(0,M().s)(e,{isLayoutViewModuleEnabled:g,isLayoutViewModuleNextEnabled:m}))),i=0===n.length||(null===(o=n.at(-1))||void 0===o?void 0:o.id)===r;return a.state.isOpen&&!u&&!i}),[a,r,u,g,m,t,e.area]),p=(0,S().G)({area:e.area,afterModuleId:r}),y=(0,B().F)(),v=(0,d().yK)((e=>({bigRoundButton:{...y.button,width:D,height:D,borderTopLeftRadius:"100%",borderTopRightRadius:"100%",borderBottomLeftRadius:"100%",transform:"rotate(-45deg)"},bigRoundButtonHovered:{...y.buttonHovered},bigRoundButtonPressed:{...y.buttonPressed}})),[y]),b="form"===(0,i().VK)((()=>{var e;return null===(e=t.getModel())||void 0===e?void 0:e.getLayoutType()}),[t])?o.formatMessage(P.formLayoutAddModule):o.formatMessage(P.pageLayoutAddModule),k=l?l.offsetLeft-40:void 0,j=l?l.offsetTop+l.offsetHeight-4:void 0;return(0,C.jsx)(s().Z,{visible:c,animate:{opacity:1,scale:1,transformOrigin:"center right"},initial:{opacity:0,scale:.3,transformOrigin:"center right"},exit:{opacity:0,scale:.3,transformOrigin:"center right"},style:{position:"absolute",left:k,top:j},children:(0,C.jsx)(_().Z,{placement:I().Placement.Left,renderTooltip:()=>b,render:e=>(0,C.jsx)(f().Z,{...e,style:v.bigRoundButton,hoveredStyle:v.bigRoundButtonHovered,className:w().AWi,pressedStyle:v.bigRoundButtonPressed,onClick:p,icon:A().A,iconStyle:{width:16,height:16,transform:"rotate(45deg)"},isBlue:!0,ariaLabel:b})})})}var j=()=>t(251932),R=()=>t(42392),V=()=>t(857719);const E=(0,h().vU)({addPageModule:{id:"pageLayout.builder.addModuleToPage.button.ariaLabel",defaultMessage:"Add page module"},addQuestionModuleTooltip:{id:"pageLayout.builder.addModuleToPage.button.addQuestionModuleTooltip",defaultMessage:"Add question"},addModuleToPanelButton:{id:"pageLayout.builder.addModuleToPanel.button.label",defaultMessage:"Add to panel"}}),O=a.forwardRef((function(e,o){const{area:a}=e,{layoutStore:n}=(0,L().J9)(),r=(0,i().VK)((()=>n.getLayoutType()),[n]),l=(0,h().YB)(),s=(0,B().F)(),u=(0,d().yK)((e=>({bigRoundButton:{...s.button,width:32,height:32,borderRadius:"100%"},bigRoundButtonHovered:{...s.buttonHovered},bigRoundButtonPressed:{...s.buttonPressed},emptyModuleAreaAddButton:{cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center",padding:"8px 16px 8px 12px",fontSize:14,lineHeight:"20px",fontWeight:500,background:"light"===e.mode?e.accentColors.uiBlue[100]:e.accentColors.uiBlue[200],color:e.accentColors.uiBlue[600],borderRadius:28,transition:"background 0.2s"},emptyModuleAreaAddButtonHover:{...s.buttonHovered},emptyModuleAreaAddButtonPressed:{...s.buttonPressed}})),[s]),g=(0,S().G)("views_main_tab_modules"===a?{area:a,viewsMainTabId:e.viewsMainTabId}:{area:a});if("form_conditional_modules"===a)throw new Error("[Forms Conditional Logic Not Implemented] AddPageLayoutModuleButton not implemented for form_conditional_modules yet.");const m=(0,i().VK)((()=>{var o;const t=n.getModules();return("views_main_tab_modules"===a?(null===(o=t[a])||void 0===o?void 0:o[e.viewsMainTabId])||[]:t[a]).length>0}),[n,a,e.viewsMainTabId]);return"page_details"!==a||m?(0,C.jsx)(_().Z,{renderTooltip:()=>l.formatMessage(E.addQuestionModuleTooltip),disableTooltip:"form"!==r,placement:I().Placement.Bottom,render:e=>(0,C.jsx)(f().Z,{style:u.bigRoundButton,hoveredStyle:u.bigRoundButtonHovered,pressedStyle:u.bigRoundButtonPressed,onClick:g,icon:A().A,iconStyle:{width:16,height:16},isBlue:!0,className:w().AWi,ariaLabel:l.formatMessage(E.addPageModule),ref:o,...e})}):(0,C.jsxs)(t(745740).Z,{style:u.emptyModuleAreaAddButton,onClick:g,hoveredStyle:u.emptyModuleAreaAddButtonHover,pressedStyle:u.emptyModuleAreaAddButtonPressed,ref:o,children:[(0,t(419273).f)({width:12,marginRight:4}),(0,C.jsx)(h()._H,{...E.addModuleToPanelButton})]})})),K=a.memo((function(e){var o;const{shouldShowTooltip:n}=(0,t(946650).w)(),{area:d}=e,r=n&&"page_main"===d,l=n&&"form_layout_schema"!==d,s=a.useRef(null),{currentModuleSelection:u,layoutStore:g,setModuleSelection:m,isPropertyTypeSearchInputDirtyStore:c}=(0,L().J9)(),p=(0,i().VK)((()=>"existing_module"===(null==u?void 0:u.type)?g.getModuleById(u.moduleId):void 0),[u,g]),y=(0,i().VK)((()=>{var o;if("form_conditional_modules"===d)throw new Error("[Forms Conditional Logic Not Implemented] AddPageLayoutModuleButton not implemented for form_conditional_modules yet.");const t=g.getModules();return("views_main_tab_modules"===d?(null===(o=t[d])||void 0===o?void 0:o[e.viewsMainTabId])||[]:t[d]).length>0}),[g,d,e.viewsMainTabId]),[v,b]=a.useState(!1),M=a.useCallback((()=>{c.state||m(void 0)}),[c,m]);return"new_module"===(null==u?void 0:u.type)&&u.area===e.area?(0,C.jsx)(t(94967).Z,{onUndo:M,capture:!0,priority:1,debugName:"AddPageLayoutModuleButton",children:(0,C.jsx)(F,{})}):"placeholder"===(null==p?void 0:p.type)?null:r||l?(0,C.jsxs)(j().gq,{justifyContent:"center",style:null===(h=e.styles)||void 0===h?void 0:h.buttonContainer,className:V().Vc,children:[(0,C.jsx)(R().p,{shape:"page_main"===e.area?"circle":"pill",size:"page_main"===e.area||y?32:34,onDependencyLoaded:()=>b(!0),children:(0,C.jsx)(O,{isEducationCalloutVisible:r,...e,ref:s})}),r&&v&&(0,C.jsx)(t(274707).Z4,{buttonRef:s})]}):(0,C.jsx)(j().gq,{justifyContent:"center",style:null===(o=e.styles)||void 0===o?void 0:o.buttonContainer,className:V().Vc,children:(0,C.jsx)(O,{isEducationCalloutVisible:!1,ref:s,...e})});var h}));function F(){const e=(0,d().yK)((e=>({ghostPageModuleContainer:{paddingBottom:12},ghostPageModule:{width:"100%",height:160,background:e.accentColors.uiBlue[75],borderRadius:12,boxShadow:`0px 0px 0px 0px ${e.stroke.uiBlueSecondary}, inset 0px 0px 0px 1px ${e.stroke.uiBlueSecondary}`}})),[]);return(0,C.jsx)("div",{style:e.ghostPageModuleContainer,className:V().Vc,children:(0,C.jsx)(R().p,{shape:"square",borderRadius:e.ghostPageModule.borderRadius,width:e.ghostPageModule.width,height:e.ghostPageModule.height,children:(0,C.jsx)("div",{style:e.ghostPageModule})})})}var H=()=>t(513670);const N=12;function Z(){const{addModuleHoverMenuStore:e}=(0,L().J9)(),o=(0,v().j)(),t=(0,a.useCallback)((t=>{const a=x().Z.getMembersByDOMOrder({filter:e=>"cover"!==e.moduleType&&"form_conditional_modules"!==e.area});let n=null;for(const e of a){const a=e.getNode();if(!a)continue;const i=a.getBoundingClientRect();if(t.clientX>i.right||t.clientX<i.left&&i.left-t.clientX>300)continue;if(t.clientY<=i.bottom&&i.bottom-t.clientY<N||t.clientY>i.bottom&&t.clientY-i.bottom<N+o){n=e;break}}if(n)e.setState({isOpen:!0,moduleId:n.moduleId,menuIsOpen:!1});else{const o=e.getState();o.isOpen&&!o.menuIsOpen&&e.setState({isOpen:!1})}}),[e,o]),n=H().P2(t,30);return(0,a.useEffect)((()=>(window.addEventListener("mousemove",n),()=>{window.removeEventListener("mousemove",n)})),[n]),null}var Y=()=>t(761651);function q(e){const{area:o}=e;if("form_conditional_modules"===o)throw new Error("[Forms Conditional Logic] Can't render builder layout modules for nested form_conditional_modules directly.");const t=(0,n().O7)(),{sessionId:M,layoutStore:h,currentModuleSelection:f,setModuleSelection:_,canEditLayout:w,layoutBuilderModuleSelectionStore:T}=(0,L().J9)(),A=(0,a.useRef)(null),x=(0,b().L)({layoutStore:h,pageStoreId:void 0}),I=(0,i().VK)((()=>h.isTabbedPageLayout()),[h]),B=(0,v().j)(),{nonMoveableHeaderModules:S,moveableModules:P,nonMoveableFooterModules:D}=(0,i().VK)((()=>{var t;const a="views_main_tab_modules"===o?(null===(t=x[o])||void 0===t?void 0:t[null==e?void 0:e.viewsMainTabId])||[]:x[o];return(0,l().Lk)(o,a)}),[o,x,null==e?void 0:e.viewsMainTabId]),j=(0,i().VK)((()=>{const e=T.state;if(null!=e&&e.isDragging){const t=e.draggingModuleInitialArea,a=e.draggingModuleFinalArea;return{isDraggingIntoThisArea:t.area!==o&&a.area===o,isDraggingFromThisAreaToOtherArea:t.area===o&&a.area!==o,isDraggingAnyModuleList:!0,dragArea:a}}return{isDraggingIntoThisArea:!1,isDraggingFromThisAreaToOtherArea:!1,isDraggingAnyModuleList:!1,dragArea:void 0}}),[o,T]),R=P.map((e=>"form_layout_schema"===o?{key:e.id,draggable:"placeholder"!==e.type}:{key:e.id,draggable:!0})),E=(0,a.useMemo)((()=>new(c().Z)),[]),O=(0,i().VK)((()=>E.state.isDragging),[E]),F=(0,i().VK)((()=>{var e;return null===(e=h.getModel())||void 0===e?void 0:e.getLayoutType()}),[h]);(0,a.useEffect)((()=>{A.current&&j.isDraggingIntoThisArea&&(0,m().n5)({element:A.current,additionalPadding:{top:200,bottom:200}})}),[j.isDraggingIntoThisArea]);const H=(0,a.useCallback)((t=>{const a="views_main_tab_modules"===o?{area:"views_main_tab_modules",viewsMainTabId:e.viewsMainTabId}:{area:o};_({type:"existing_module",moduleId:t,isDragging:!0,draggingModuleInitialArea:a,draggingModuleFinalArea:a})}),[o,e.viewsMainTabId,_]),N=(0,a.useCallback)((e=>{e&&_({type:"existing_module",moduleId:e,isDragging:!1})}),[_]),q=(0,a.useCallback)((()=>{const e=T.state,o=h.getLayoutType();o&&(0,r().K)(o)?_(void 0):null!=e&&e.isDragging&&T.setState({...e,isDragging:!1,draggingModuleInitialArea:void 0,draggingModuleFinalArea:void 0})}),[T,_,h]),J=(0,a.useCallback)((e=>{const a=T.state,n=null!=a&&a.isDragging?a.draggingModuleFinalArea:void 0;"form_conditional_modules"!==(null==n?void 0:n.area)&&(null!=e&&e.key&&n&&n.area!==o&&((0,p().ST)({environment:t,position:{type:"area_relative",location:"end_moveable",..."views_main_tab_modules"===n.area?{area:n.area,viewId:n.viewsMainTabId}:{area:n.area}},moduleId:e.key,layoutStore:h,sessionId:M}),(0,y().O)({moduleId:e.key,layoutStore:h})),q())}),[T,o,q,t,h,M]),z=(0,a.useCallback)((a=>{let{key:n,endPosition:i,startPosition:d}=a;if(j.isDraggingFromThisAreaToOtherArea)return;const r=S.length,l="views_main_tab_modules"===o?{area:"views_main_tab_modules",viewId:e.viewsMainTabId}:{area:o};(0,p().ST)({environment:t,layoutStore:h,position:{type:"absolute",index:r+i,...l},moduleId:n,sessionId:M}),(0,y().O)({moduleId:n,layoutStore:h})}),[j.isDraggingFromThisAreaToOtherArea,S.length,o,e.viewsMainTabId,t,h,M]),Q=(0,d().yK)((e=>({draggableList:{display:"flex",flexDirection:"column",gap:B,marginBottom:B},addButtonContainer:{paddingTop:"page_in_collection"===F?8:0,marginBottom:"form"===F?0:12,width:"100%"},dropzoneHalo:{background:g().e2,height:g().D0,marginTop:-g().D0},hiddenModuleStyle:{display:"none"}})),[B,F]),U=(0,a.useCallback)((e=>{const t="existing_module"===(null==f?void 0:f.type)&&f.moduleId===e,a=t&&O;return(0,C.jsx)(Y().x,{active:t,pageModuleId:e,isDragging:a,area:o,style:a&&j.isDraggingFromThisAreaToOtherArea?Q.hiddenModuleStyle:void 0},e)}),[j.isDraggingFromThisAreaToOtherArea,f,O,Q.hiddenModuleStyle,o]),W=(0,a.useMemo)((()=>S.length?S.map((e=>U(e.id))):null),[S,U]),X=(0,a.useMemo)((()=>D.length?D.map((e=>U(e.id))):null),[D,U]),G=(0,a.useMemo)((()=>({enter:{opacity:0},animate:{opacity:1},exit:{opacity:0}})),[]),$=(0,a.useMemo)((()=>({buttonContainer:Q.addButtonContainer})),[Q.addButtonContainer]);if(!h)return null;let ee;return ee=!!w&&(!I||("views_main_tab_modules"===o||"page_details"===o)),(0,C.jsxs)(C.Fragment,{children:[W,!!R.length&&(0,C.jsx)(u().ZP,{forceDragKeyIndex:j.isDraggingFromThisAreaToOtherArea?R.length-1:void 0,className:V().Vc,store:E,keys:R,direction:"vertical",onDraggingKeyChanged:H,onDrop:(e,o)=>{z(o)},onDragCancel:q,onDragEnd:J,onClick:N,style:Q.draggableList,renderKey:U,disabled:!w,...I?{}:{hoverCursorStyleOverride:j.isDraggingAnyModuleList?"grabbing":void 0}}),(0,C.jsx)(s().Z,{visible:j.isDraggingIntoThisArea,initial:G.enter,animate:G.animate,exit:G.exit,skip:!j.isDraggingAnyModuleList,className:"layout-content",ref:A,style:Q.dropzoneHalo}),ee&&(0,C.jsx)(K,{...e,styles:$}),"form"===F&&w&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Z,{}),(0,C.jsx)(k,{area:o})]}),X]})}}}]);