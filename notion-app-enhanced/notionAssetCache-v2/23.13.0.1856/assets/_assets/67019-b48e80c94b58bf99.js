"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[67019],{922065:(e,t,n)=>{n.d(t,{r:()=>r});class o extends(()=>n(263184))().default{getInitialState(){return{showHistory:!1,showDebug:!1,previewingStepId:void 0,config:n(923301).t8[0],acceptedInferenceKeys:[],inferenceKeysToAnnotations:{},inferenceKeysToMemories:{},tags:[],abortController:void 0,loading:!1,stopInferencePromise:void 0,temporarySteps:[],inferences:[],allFeaturesEnabled:!1,model:void 0,traceId:void 0}}}const r=new o},352701:(e,t,n)=>{n.d(t,{n:()=>p});n(670560),n(267602),n(470928);var o=()=>n(459264),r=()=>n(926724),a=()=>n(714230),i=()=>n(235484),s=()=>n(253335),c=()=>n(749826),d=()=>n(138912),l=()=>n(338855);const u=[i().U9,i().f3,i().mQ,i().Dv,i().Nw,i().nO];function p(e,t){if(!e)return[];const n=c().default.checkGate({gateName:"cron_connected_relation"}),p=c().default.checkGate({gateName:"connected_relation"}),f=c().default.checkGate({gateName:"slack_connected_relation"}),w=c().default.checkGate({gateName:"salesforce_connected_relation_database_actions_enabled"}),y=e.getDatabaseType()===r().Ym,m=d().default.state;if(!m.loaded)return[];const g=m.integrations,h={};if(!y){const e=g.find((e=>e.id===i().U9)),t=(0,s().GT)();var v;if(e)h[t.name]={name:t.name,pattern:o().x,integration:e,tooltipImage:{img:a().Z.images.tooltips.properties.githubSyncPullStatusPng,scale:.5},description:t.description,canOnlyAdminAuth:{disabledPropertyTooltipMessage:null===(v=t.canOnlyAdminAuth)||void 0===v?void 0:v.disabledPropertyTooltipMessage}}}const S=[];if(t&&(S.push(i().f3,i().mQ,i().Nw),f&&S.push(i().nO)),n&&S.push(i().Dv),S.forEach((e=>{const t=g.find((t=>t.id===e));if(null!=t&&t.info.original_url_patterns)for(const o of t.info.original_url_patterns){var n;null!==(n=o.additional_types)&&void 0!==n&&n.connectedRelation&&(h[o.name]||(h[o.name]={name:(0,l().ni)({pattern:o,integration:t}),pattern:o,integration:t}))}})),!p)return Object.values(h);for(const o of g)if(o.info.original_url_patterns&&t&&![...u,i().Ff].includes(o.id))for(const e of o.info.original_url_patterns){var b;null!==(b=e.additional_types)&&void 0!==b&&b.connectedRelation&&(h[e.name]||(o.id===i().aW&&w?h[o.name]={name:o.name,pattern:e,integration:o}:h[e.name]={name:(0,l().ni)({pattern:e,integration:o}),pattern:e,integration:o}))}return Object.values(h)}},814866:(e,t,n)=>{n.d(t,{$v:()=>v,Hi:()=>m,Xe:()=>k,Y$:()=>K,dY:()=>_,oD:()=>g,r3:()=>b});var o=n(667294),r=()=>n(219727),a=()=>n(142735),i=()=>n(506347),s=()=>n(342792),c=()=>n(696459),d=()=>n(957042),l=()=>n(497065),u=()=>n(887430),p=()=>n(429725),f=()=>n(876822);const w=n(124199).literals("view","instructions","runs","chat","module","view_settings","database","trigger","function","test","debug","runtime_actor");function y(e){const{RouterStore:t}=e;if("page"!==t.state.route.name)return;const{workflowViewType:n,workflowViewKey:o}=t.state.route;return function(e){const t=(0,d().OD)(w,e.workflowViewType);if(t)switch(t){case"view":return e.workflowViewKey?{view:{type:"settings"},settingsPane:{type:"instructions"},view:{type:"view",key:e.workflowViewKey}}:{view:{type:"settings"},settingsPane:{type:"instructions"}};case"instructions":case"debug":case"runtime_actor":return{view:{type:"settings"},settingsPane:{type:t}};case"module":case"view_settings":case"trigger":case"function":case"database":if(!e.workflowViewKey)return{view:{type:"settings"},settingsPane:{type:"instructions"}};const n=(0,s().xP)(e.workflowViewKey);return n?{view:{type:"settings"},settingsPane:{type:"database",collectionId:n}}:{view:{type:"settings"},settingsPane:{type:"instructions"}};case"runs":return{view:{type:"settings"},settingsPane:{type:"runs",runId:(0,s().xP)(e.workflowViewKey)}};case"chat":return{view:{type:"settings"},settingsPane:{type:"chat",transcriptId:e.workflowViewKey}};case"test":if(!e.workflowViewKey)return{view:{type:"settings"},settingsPane:{type:"instructions"}};const[o,r]=e.workflowViewKey.split(",");return o&&r?{view:{type:"settings"},settingsPane:{type:"test",name:r,functionKey:o}}:{view:{type:"settings"},settingsPane:{type:"instructions"}};default:(0,c().t1)(t)}}({workflowViewType:n,workflowViewKey:o})}function m(e){return void 0!==y(e)}function g(e){const t=(0,r().O7)();return(0,a().VK)((()=>y(t)??e),[t,e])}function h(e){const t=e.view.type;switch(t){case"settings":return function(e){const t=e.type;switch(t){case"instructions":case"debug":case"runtime_actor":return{workflowViewType:t};case"runs":return{workflowViewType:t,workflowViewKey:e.runId};case"chat":return{workflowViewType:t,workflowViewKey:e.transcriptId};case"test":return{workflowViewType:t,workflowViewKey:`${e.functionKey},${e.name}`};case"database":return{workflowViewType:t,workflowViewKey:e.collectionId};case"module":case"view_settings":case"trigger":case"function":return{workflowViewType:t,workflowViewKey:e.key};default:(0,c().t1)(t)}}(e.settingsPane);case"view":return{workflowViewType:t,workflowViewKey:e.view.key};default:(0,c().t1)(t)}}function v(e){const{store:t,environment:n,navigationPane:o}=e,{workflowViewType:r,workflowViewKey:a}=h(o),s=(0,p().Hu)({store:t,pageVisitSource:i().tY.Workflows,workflowViewType:r,workflowViewKey:a});l().c4({environment:n,url:s})}function S(e){const t=(0,r().O7)();return(0,o.useCallback)((n=>{v({store:e,environment:t,navigationPane:n})}),[t,e])}function b(e){const{store:t,environment:n}=e,o=(0,p().Hu)({store:t,pageVisitSource:i().tY.Workflows});l().c4({environment:n,url:o})}function k(e){const t=S(e);return(0,o.useCallback)((e=>{t({view:{type:"settings"},settingsPane:e})}),[t])}function _(e){const t=S(e);return(0,o.useCallback)((e=>{t({view:{type:"settings"},settingsPane:{type:"instructions"},view:e})}),[t])}function K(){return(0,a().VK)((()=>{const e=f().default.state.mainEditorCurrentBlockStore;if(e)if(e.isCollectionView()){if(e.getCollectionStore())return(0,u().fm)(e)}else{const t=e.getAssociatedCollectionStore();if(t&&!t.isPageTreeCollection())return(0,u().fm)(e)}}),[])}},187435:(e,t,n)=>{n.d(t,{Ao:()=>K,FN:()=>x,P4:()=>b,TR:()=>k,pX:()=>E,tO:()=>_,v8:()=>M});n(821057),n(670560),n(267602),n(653476),n(470928),n(241792);var o=()=>n(530980),r=()=>n(396136),a=()=>n(752778),i=()=>n(139978),s=()=>n(955620),c=()=>n(335696),d=()=>n(513670),l=()=>n(342792),u=()=>n(543172),p=()=>n(696459),f=()=>n(450048),w=()=>n(282662),y=()=>n(332542),m=()=>n(636340),g=()=>n(276124),h=()=>n(352701),v=()=>n(826955),S=()=>n(286427);function b(e){const{environment:t,store:n,workflowStore:o,transaction:d}=e,{inMemoryRecordCache:p}=o,f=o.getSpaceId();if(!f)throw new Error("Space ID not found");const w=(0,S().x)(o),h=(w.modules||[]).filter((e=>"database"===e.type));if(0===h.length)throw new Error("No database modules found");const b={},k=[];for(const r of h){const{key:e,state:t}=r;if(!t||!t.schema)throw new Error("Database state not found");if(t.pointer&&t.propertyKeyToIdMap)b[e]={collectionPointer:t.pointer,propertyKeyToIdMap:t.propertyKeyToIdMap};else{const n={table:a().vF,id:(0,l().ZP)(),spaceId:f};b[e]={collectionPointer:n,propertyKeyToIdMap:{}};for(const[o,r]of Object.entries(t.schema))b[e].propertyKeyToIdMap[o]="title"===r.type?"title":(0,u().ZP)();k.push(r)}}for(const l of k){const{key:e,name:u,state:S}=l;if(!S)throw new Error("Database state not found");const{collectionPointer:k,propertyKeyToIdMap:_}=b[e];if(!S||!S.schema)throw new Error("Database state not found");const K=I({schema:S.schema,environment:t,transaction:d,collectionPointer:k}),M=v().NW.createChildStore(n,k),{schema:E,deletedSchema:T}=(0,c().yr)({databaseKey:e,databaseKeyMap:b,workflowSchema:S.schema,notionSchema:M.getSchema(),connectedRelationCollections:K,databaseModules:h});if(n.isCollectionView())m().ae({environment:t,table:a().vF,value:{id:k.id,schema:E,deleted_schema:T,name:(0,s().TPx)(u),parent_table:r().iU,parent_id:n.id,space_id:f,alive:!0},transaction:d,inMemoryRecordCache:p}),(0,g().z)({collectionViewBlockStore:n,collectionPointer:k,transaction:d});else{const e=m().j4({environment:t,type:"collection_view_page",inMemoryRecordCache:p,transaction:d});m().sW({store:e,data:{parent_id:n.id,parent_table:r().iU,space_id:f,alive:!0},transaction:d}),y().jG({parentStore:n,childStore:e,transaction:d}),m().ae({environment:t,table:a().vF,value:{id:k.id,schema:E,deleted_schema:T,name:(0,s().TPx)(u),parent_table:r().iU,parent_id:e.id,space_id:f,alive:!0},transaction:d,inMemoryRecordCache:p}),(0,g().z)({collectionViewBlockStore:e,collectionPointer:k,transaction:d});const o=m().ae({environment:t,table:i().np,value:{type:"table",format:{collection_pointer:k},parent_table:r().iU,parent_id:e.id,space_id:f,alive:!0},transaction:d,inMemoryRecordCache:p});m().sW({store:e,data:{view_ids:[o.id]},transaction:d})}const x=(w.modules||[]).findIndex((t=>t.key===e));if(-1===x)throw new Error("Module not found");m().sW({store:o.getDataStore().getKeyStore("modules").getKeyStore(x).getKeyStore("state"),data:{pointer:k,propertyKeyToIdMap:_},transaction:d})}}function k(e){const{workflowStore:t,pointer:n,transaction:o}=e,r=(0,S().x)(t),a=(r.modules||[]).filter((e=>"database"===e.type)),i=K({collectionStore:v().NW.createChildStore(t,n),databaseModules:a,accessScope:"write"}),s=[...r.modules||[],i];m().sO({store:t.getDataStore().getKeyStore("modules"),value:s,transaction:o});const c=t.getParentStore();null!=c&&c.isCollectionView()&&(0,g().z)({collectionViewBlockStore:c,collectionPointer:n,transaction:o})}function _(e){const{workflowStore:t,transaction:n}=e,o=(0,S().x)(t),r=(o.modules||[]).filter((e=>"database"===e.type)),a=r.map((e=>{var n;if(null===(n=e.state)||void 0===n||!n.pointer)throw new Error("Database module pointer not found");return function(e){var t;const{dataBaseModule:n,workflowStore:o,databaseModules:r}=e;if(null===(t=n.state)||void 0===t||!t.pointer)throw new Error("Database pointer not found, must create and connect database before pulling from it");const a=v().NW.createChildStore(o,n.state.pointer);if(!n.state)throw new Error("Database state not found");const{schema:i,propertyKeyToIdMap:s}=(0,c().dw)({databaseKey:n.key,schema:a.getSchema(),databaseModules:r});return n.state.schema=i,n.state.propertyKeyToIdMap=s,n}({dataBaseModule:e,workflowStore:t,databaseModules:r})})),i=d().MR([...(o.modules||[]).filter((e=>"database"!==e.type)),...a],(e=>e.key));m().sO({store:t.getDataStore().getKeyStore("modules"),value:i,transaction:n})}function K(e){const{collectionStore:t,databaseModules:n,collectionViewId:o,accessScope:r}=e,a=(0,s().QaF)(t.getName())||"",i=(0,c().Gw)(a),d={type:"database",key:i,name:a,state:{schema:{},propertyKeyToIdMap:{},pointer:t.getSpaceShardedPointer(),collectionViewId:o,accessScope:r}},{schema:l,propertyKeyToIdMap:u}=(0,c().dw)({databaseKey:i,schema:t.getSchema(),databaseModules:[...n,d]}),p=d.state;if(!p)throw new Error("Database state not found");return p.schema=l,p.propertyKeyToIdMap=u,d}function M(e){const t={};for(const n of e){const{key:e,state:o}=n;if(!o||!o.schema||!o.pointer)throw new Error("Database state not found");const r=o.propertyKeyToIdMap||{},a={};t[e]={collectionPointer:o.pointer,propertyKeyToIdMap:a};for(const[t,n]of Object.entries(o.schema))a[t]="title"===n.type?"title":r[t]||(0,u().ZP)()}return t}function E(e){const{workflowStore:t,transaction:n,environment:o}=e;if(!t.getSpaceId())throw new Error("Space ID not found");const r=(0,S().x)(t),a=(r.modules||[]).filter((e=>"database"===e.type));if(0===a.length)throw new Error("No database modules found");const i=M(a);for(const s of a){const{key:e,state:l}=s;if(!l)throw new Error("Database state not found");const{collectionPointer:u,propertyKeyToIdMap:p}=i[e];if(!l||!l.schema)throw new Error("Database state not found");const f=v().NW.createChildStore(t,u),w=T({databaseKey:e,databaseKeyMap:i,schema:l.schema,environment:o,transaction:n,collectionStore:f}),{schema:y,deletedSchema:g}=(0,c().yr)({databaseKey:e,databaseKeyMap:i,workflowSchema:l.schema,notionSchema:f.getSchema(),connectedRelationCollections:w,databaseModules:a});d().Xy(y,f.getSchema())||m().sW({store:f,data:{schema:y,deleted_schema:{...f.getDeletedSchema(),...g}},transaction:n});const h=(r.modules||[]).findIndex((t=>t.key===e));if(-1===h)throw new Error("Module not found");m().sW({store:t.getDataStore().getKeyStore("modules").getKeyStore(h).getKeyStore("state"),data:{pointer:u,propertyKeyToIdMap:p},transaction:n})}}function T(e){const{schema:t,environment:n,transaction:o,collectionStore:r,databaseKey:a,databaseKeyMap:i}=e,s=(0,c().c1)({notionSchema:r.getSchema(),databaseKey:a,databaseKeyMap:i});return I({schema:t,environment:n,transaction:o,collectionPointer:r.pointer,existingConnectedRelations:s})}function I(e){const{schema:t,environment:n,transaction:r,collectionPointer:a,existingConnectedRelations:i}=e,s=i||{},d=(0,c().rl)(t);if(0===Object.entries(d).length)return s;const l=(0,h().n)({getDatabaseType:()=>{}},!0);for(const[c,w]of Object.entries(d))if(!s[c])switch(w){case"slack.message":{const e=l.find((e=>"slack_message"===e.pattern.name));if(!e)throw new Error("Slack message relation not found");const t=o().kk5.fromIntegration(e.integration),i=f().cf({environment:n,pattern:e.pattern,integration:t,parentCollectionStore:{pointer:a,id:a.id},transaction:r});s[c]={collectionPointer:i.pointer,property:(0,u().ZP)(),externalRelationType:"slack.message"};break}default:(0,p().t1)(w)}return s}function x(e){const{environment:t,store:n,workflowStore:o,transaction:a}=e,{inMemoryRecordCache:s}=o,c=(0,S().x)(o).views||[],d=o.getSpaceId();if(!d)throw new Error("Space ID not found");for(let l=0;l<c.length;l++){const e=c[l];if(e.pointer)continue;const u=m().ae({environment:t,table:i().np,value:{type:e.type,parent_table:r().iU,parent_id:n.id,space_id:d,alive:!0,name:e.name},transaction:a,inMemoryRecordCache:s});w().R3({parentStore:n.getCollectionViewsStore(),appendStore:u,transaction:a}),m().sW({store:o.getDataStore().getKeyStore("views").getKeyStore(l),data:{pointer:{id:u.id,table:i().np,spaceId:d}},transaction:a})}}},452435:(e,t,n)=>{n.d(t,{DE:()=>P,Ek:()=>F,Kj:()=>C,P$:()=>I,R$:()=>N,TY:()=>E,U0:()=>U,Ux:()=>j,VP:()=>V,_s:()=>A,b$:()=>W,bM:()=>$,fz:()=>O,gM:()=>D,mJ:()=>R,tF:()=>x});n(821057),n(267602),n(653476),n(241792),n(228244);var o=()=>n(506347),r=()=>n(933868),a=()=>n(836273),i=()=>n(396136),s=()=>n(325490),c=()=>n(28070),d=()=>n(361929),l=()=>n(955620),u=()=>n(342792),p=()=>n(421654),f=()=>n(784234),w=()=>n(636340),y=()=>n(47443),m=()=>n(497065),g=()=>n(145284),h=()=>n(298721),v=()=>n(922065),S=()=>n(487270),b=()=>n(876822),k=()=>n(826955),_=()=>n(286427),K=()=>n(814866),M=()=>n(187435);function E(e){const{environment:t,store:n}=e;y()._c({environment:t,store:n,pageVisitSource:o().tY.Workflows})}function T(e,t){const n=((0,_().x)(e).modules||[]).findIndex((e=>e.key===t));if(-1===n)throw new Error(`Module ${t} not found`);return n}function I(e){const{workflowStore:t,moduleKey:n,transaction:o}=e,r=t.getDataStore().getKeyStore("modules").getKeyStore(T(t,n));w().sW({store:r,data:{state:{}},transaction:o})}function x(e){const{workflowStore:t,moduleKey:n,state:o,transaction:r}=e,a=t.getDataStore().getKeyStore("modules").getKeyStore(T(t,n)).getKeyStore("state");w().sW({store:a,data:o,transaction:r})}function R(e){const{workflowStore:t,module:n,transaction:o}=e,r=((0,_().x)(t).modules||[]).findIndex((e=>e.key===n.key));if(-1===r)throw new Error(`Module ${n.key} not found`);const a=t.getDataStore().getKeyStore("modules").getKeyStore(r);w().sO({store:a,value:n,transaction:o})}function P(e){const{workflowStore:t,trigger:n,transaction:o}=e,r=((0,_().x)(t).triggers||[]).findIndex((e=>e.key===n.key));if(-1===r)throw new Error(`Trigger ${n.key} not found`);const a=t.getDataStore().getKeyStore("triggers").getKeyStore(r);w().sO({store:a,value:n,transaction:o})}function C(e){const{workflowStore:t,functionValue:n,transaction:o}=e,r=((0,_().x)(t).functions||[]).findIndex((e=>e.key===n.key));if(-1===r)throw new Error(`Function ${n.key} not found`);const a=t.getDataStore().getKeyStore("functions").getKeyStore(r);w().sO({store:a,value:n,transaction:o})}function D(e){var t;const{workflowStore:n,functionKey:o,test:r,transaction:a}=e,i=(0,_().x)(n),s=(i.functions||[]).findIndex((e=>e.key===o));if(-1===s)throw new Error(`Function ${o} not found`);const c=((null===(t=(i.functions||[])[s])||void 0===t?void 0:t.tests)||[]).findIndex((e=>e.description.name===r.description.name));if(-1===c)throw new Error(`Test ${r.description.name} not found in function`);const d=n.getDataStore().getKeyStore("functions").getKeyStore(s).getKeyStore("tests").getKeyStore(c);w().sO({store:d,value:r,transaction:a})}function V(e){const{workflowStore:t,module:n,transaction:o}=e,r=((0,_().x)(t).modules||[]).findIndex((e=>e.key===n.key));if(-1===r)throw new Error(`Module ${n.key} not found`);const a=t.getDataStore().getKeyStore("modules").getKeyStore(r).getKeyStore("state");w().sW({store:a,data:{pointer:null},transaction:o})}function A(e){const{workflowStore:t,workflow:n,transaction:o}=e;w().sW({store:t.getDataStore(),data:{enabled:!n.enabled},transaction:o})}function N(e){const{workflowStore:t,module:n,transaction:o}=e,r=((0,_().x)(t).modules||[]).filter((e=>e.key!==n.key));w().sO({store:t.getDataStore().getKeyStore("modules"),value:r,transaction:o})}function j(e){const{environment:t,workflow:n,transaction:o,step:r,threadStore:a,workflowBlockId:s}=e,{currentSpaceStore:l,currentSpaceViewStore:u}=b().default.state;if(!l||!u)throw new Error("No current space");const f=k().fI.createChildStore(a,{table:c().xu,id:r.id,spaceId:l.id});if(!f)throw new Error("Thread message store not found");let y;s?y=k().G.createChildStore(l,{table:i().iU,id:s,spaceId:l.id}):(y=w().j4({environment:t,type:"workflow",transaction:o,inMemoryRecordCache:l.inMemoryRecordCache}),g().Hj({environment:t,spaceStore:l,spaceViewStore:u,pageStore:y,isPrivate:!0,location:{type:"append"},transaction:o}));const m=w().ae({environment:t,table:d().An,value:{data:n,parent_table:i().iU,parent_id:y.id,space_id:l.id},inMemoryRecordCache:l.inMemoryRecordCache,transaction:o});p().FH({stores:[y],update:{workflow_id:m.id},transaction:o}),w().sW({store:f.getStepStore(),data:{workflow_block_id:y.id},transaction:o}),w().sW({store:a,data:{parent_table:d().An,parent_id:m.id,space_id:l.id},transaction:o}),q({environment:t,store:y,workflowStore:m,workflow:n,transaction:o})}function U(e){const{environment:t,workflowStore:n,transaction:o,workflow:r}=e;w().sO({store:n.getDataStore(),value:r,transaction:o});const a=n.getParentStore();if(!a)throw new Error("Workflow parent store not found");q({environment:t,store:a,workflowStore:n,workflow:r,transaction:o})}function O(e){const{collectionPointers:t}=e,{currentSpaceStore:n,currentSpaceViewStore:o}=b().default.state;if(!n||!o)throw new Error("No current space");return{modules:t.map((e=>{const t=k().NW.createChildStore(n,e);return(0,M().Ao)({collectionStore:t,databaseModules:[],accessScope:"write"})})),enabled:!0}}function q(e){var t,n;const{environment:o,store:r,workflowStore:a,workflow:i,transaction:s}=e;(null==i||null===(t=i.modules)||void 0===t?void 0:t.some((e=>{var t;return"database"===e.type&&!(null!==(t=e.state)&&void 0!==t&&t.pointer)})))&&(0,M().P4)({environment:o,store:r,workflowStore:a,transaction:s});(null==i||null===(n=i.views)||void 0===n?void 0:n.some((e=>!e.pointer)))&&(0,M().FN)({environment:o,store:r,workflowStore:a,transaction:s})}function W(e){const{runtimeActorStore:t,missingRoles:n,transaction:o,environment:a}=e,s=n.getPointersByTable(i().iU);for(const i of s){const e=k().G.createChildStore(t,i),s=n.getRole(i);if(!s)continue;let c;(0,r().J5)(s)?c={read_content:!0,insert_content:!0,update_content:!0,read_comment:!0,insert_comment:!0}:(0,r().YX)(s)&&(c={read_content:!0,read_comment:!0});const d={type:"bot_permission",bot_id:t.id,parent_id:t.getParentId(),parent_table:t.getParentTable(),role:c??"none"};f().l3({environment:a,store:e,permissionItems:[d],transaction:o})}}function F(e){const{environment:t,workflowStore:n,store:o,inputValue:r,additionalSteps:i=[]}=e,{currentSpaceStore:c}=b().default.state;if(!c)return;const d=(0,S().TS)({environment:t,table:s().kL,spaceId:c.id});(0,h().cz)({environment:t,clientStore:v().r,threadStore:void 0,threadId:d,additionalSteps:[{id:(0,u().c9)(),type:"workflow",value:(0,_().x)(n),workflow_block_id:o.id},...i],config:{type:"workflow",workflowBlockId:o.id},workflowStore:n,userStore:void 0,spaceStore:c,value:(0,l().TPx)(r)}),m().c4({environment:t,url:`${a().VP.aiInferenceTranscript}?t=${(0,u().cj)(d)}`})}function $(e){let{environment:t,collectionContextStore:n}=e;const o=n.collectionViewBlockStore();if(!o)throw new Error("Collection view store not found");(0,K().$v)({store:o,environment:t,navigationPane:{view:{type:"view",key:"workflow"},settingsPane:{type:"instructions"}}})}},286427:(e,t,n)=>{n.d(t,{x:()=>s});var o=()=>n(124199);const r={enabled:!0},a=o().object({required:{value:o().string(),description:o().string()},optional:{},exact:!0}),i=o().union([o().object({required:{type:o().literal("title"),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("content"),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("text"),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("url"),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("email"),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("phone_number"),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("file"),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("number"),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("date"),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("select"),options:o().array(a),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("multi_select"),options:o().array(a),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("status"),groups:o().object({required:{to_do:o().array(a),in_progress:o().array(a),complete:o().array(a)},optional:{},exact:!0}),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("person"),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("relation"),databaseKey:o().string(),description:o().string()},optional:{propertyKey:o().string()}}),o().object({required:{type:o().literal("external_relation"),object:o().literals("slack.message"),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("checkbox"),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("created_time"),description:o().string()},optional:{},exact:!0}),o().object({required:{type:o().literal("last_edited_time"),description:o().string()},optional:{},exact:!0})]);o().record(o().string(),i);function s(e){var t;return(null===(t=e.getModel())||void 0===t?void 0:t.getData())||r}},923301:(e,t,n)=>{n.d(t,{Bc:()=>r,t8:()=>o});const o=[{type:"markdown-chat"},{type:"search"},{type:"workflow"},{type:"setup-generator"},{type:"template-fill"},{type:"researcher",autoExecutePlan:!0,disablePlanRevision:!1,ignoreFindings:!1,ignoreUnverifiedClaims:!1,filterToSpaceSharedResults:!1,fastMode:!1,evaluateAsync:!0,runInQueue:!1},{type:"fast-researcher"},{type:"tool-markdown-chat"}],r=["Eval","Prompt"]},157955:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>x,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>k,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>b,MAX_RECURRENCE_INTERVAL:()=>m,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>g,RRULE_WEEKDAYS_MAP:()=>y,convertFromUnpersistedRecurrenceConfig:()=>C,convertToUnpersistedRecurrenceConfig:()=>R,getFormattedEndCondition:()=>I,getFormattedNextRecurrenceTime:()=>T,getNextDateUtc:()=>E,getRecurrenceAfter:()=>K,isRunningBetweenMidnightAnd3AM:()=>M,isValidRecurrenceInterval:()=>h,isValidRecurrenceNumberOfRuns:()=>v,rruleFromRecurrence:()=>S,templateAncestorsViolateRecurrenceNesting:()=>_});n(267602),n(653476),n(241792);var o=()=>n(730120);n(670560);function r(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(0===n.length)return e.map((e=>[e]));const a=[];for(const i of e)a.push(...r(n[0],...n.slice(1)).map((e=>[i,...e])));return a}var a=()=>n(696459),i=()=>n(326966),s=()=>n(803021),c=()=>n(646574),d=()=>n(998411),l=()=>n(578292);class u extends(()=>n(484885))().Ci{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var p=()=>n(494616);const f=(0,n(788860).vU)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),w={day:u.DAILY,week:u.WEEKLY,month:u.MONTHLY,year:u.YEARLY},y={MO:u.MO,TU:u.TU,WE:u.WE,TH:u.TH,FR:u.FR,SA:u.SA,SU:u.SU},m=99,g=999;function h(e){return(0,i().hj)(e)&&Number.isInteger(e)&&e>0&&e<=m}function v(e){return(0,i().hj)(e)&&Number.isInteger(e)&&e>0&&e<=g}function S(e){const{start_date:t,frequency:n,interval:o,weekdays:i,timezone:c,hour:d,minute:l}=e,p="week"===n&&i?i.map((e=>y[e])):void 0,f={};return(0,a().$K)(e.end_condition)&&("date"===e.end_condition.type?f.until=(0,s().pd)(e.end_condition.end_at):"number"===e.end_condition.type?f.count=e.end_condition.number_of_occurrences:(0,a().t1)(e.end_condition)),"month"===e.frequency&&(0,a().$K)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?f.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?f.byweekday=r(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return y[t].nth(n)})):(0,a().t1)(e.monthly_restriction)),new u({freq:w[n],dtstart:(0,s().pd)(t),interval:o,byweekday:p,tzid:c,byhour:d??0,byminute:l??0,bysecond:0,...f})}const b=1,k=1;function _(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),o=e.length,r=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,a=o>b,i=n.length>=k;return{violatesConstraint:a||i,templateNestingExceedsMaxDepth:a,ancestorHasDailyTemplate:i,nestedDepthOfAutomationAncestors:o,immediateAncestorRecurrenceType:r}}function K(e){const{recurrence:t,afterDate:n}=e;if((0,p().nA)(t)){const e=(0,s().kq)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=S(t).after((0,s().pd)(n));if(!e)return;return(0,s().YL)(e)}}function M(e){return 0===e.hour||1===e.hour||2===e.hour}function E(e){return S(e).after((0,s().pd)((0,s().Jh)()))||void 0}function T(e){const{recurrence:t,intl:n}=e,r=E(C(t));if(!r)return;const a=M(t),i=o().ou.fromJSDate(r).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,l().E2)(n)).setZone(t.timezone),s=(0,c().p6)({date:i,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(a)return n.formatMessage(f.dateBetweenMidnightAnd3AM,{date:s});{let e=i.toLocaleString(o().ou.TIME_SIMPLE);return t.timezone!==(0,d().r)()&&(e+=` ${i.toFormat("ZZZZ")}`),n.formatMessage(f.dateAtTime,{date:s,time:e})}}function I(e,t){return(0,a().$K)(e)?"number"===e.type?t.formatMessage(f.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,c().p6)({date:o().ou.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().t1)(e):t.formatMessage(f.noEndCondition)}const x=100;function R(e){return{...e,start_date:(0,s().kq)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,s().kq)(e.end_condition.end_at)}:(0,a().t1)(e.end_condition):void 0}}function P(e,t){const n=o().ou.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,s().Jh)(n.toJSDate())}}function C(e){return{...e,start_date:(0,s().Jh)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?P(e,e.end_condition):(0,a().t1)(e.end_condition):void 0}}}}]);