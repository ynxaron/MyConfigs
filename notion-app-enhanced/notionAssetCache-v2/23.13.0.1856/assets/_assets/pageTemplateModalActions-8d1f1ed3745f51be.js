"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[46616],{241516:(e,t,a)=>{a.r(t),a.d(t,{accept:()=>B,close:()=>N,createTemplateInstance:()=>z,loadAndDuplicatePageTemplate:()=>x,openWithItem:()=>U,previewItem:()=>D,setTemplateVisited:()=>V});a(821057);var o=()=>a(506347),n=()=>a(799891),i=()=>a(35980),r=()=>a(217465),l=()=>a(396136),c=()=>a(151097),s=()=>a(855741),d=()=>a(824462),p=()=>a(47443),m=()=>a(872308),u=()=>a(234049),v=()=>a(594546),g=()=>a(527278),_=()=>a(239482),f=()=>a(482962),S=()=>a(793935),b=()=>a(876822),I=()=>a(749826),y=()=>a(253225),T=()=>a(21688),C=()=>a(826955),w=()=>a(8101),h=()=>a(291338),k=()=>a(636340),M=()=>a(143346),P=()=>a(879952),A=()=>a(145284),R=()=>a(269299),E=()=>a(663366);const Z="LastViewedTemplateId",L=(0,a(788860).vU)({clientCopyError:{defaultMessage:"Client copy could not be created.",id:"spaceActions.createGettingStartedPage.copyNotCreated.error"}});function U(e){const{environment:t,item:a,createNewPage:o,isPrivate:n,disablePointerEvents:r,isCheckout:l=!1}=e;P().ZH({environment:t}),T().Z.setState({open:!0,item:a,createNewPage:o,isPrivate:n,isLoading:!1,disablePointerEvents:r,isCheckout:l}),i().Z.set({userId:t.currentUser.id,key:Z,value:a.rootId}),w().jW(t,{template_id:(0,f().gA)(a),from:o?"sidebar":"newPage"})}function D(e){let{templateItem:t,currentUserId:a}=e;const o=T().Z.state.item;T().Z.setState({...T().Z.state,item:t}),o!==t&&i().Z.set({userId:a,key:Z,value:t.rootId})}function N(e){T().Z.setState({item:T().Z.state.item,open:!1}),P().ZH({environment:e})}async function B(e){const{acceptFrom:t,item:a,environment:n,spaceStore:i,initializeStore:r,...l}=e;T().Z.state.open&&T().Z.setState({...T().Z.state,isLoading:!0}),I().default.checkGate({gateName:"mobile_keep_template_gallery_open"})&&y().Z.state.open&&y().Z.setState({open:!1});const c=r?{...{...l,item:a,environment:n,spaceStore:i},initializeStore:r,type:"inExistingStore",useMinimalTemplates:!1}:{...{...l,item:a,environment:n,spaceStore:i},type:"inSpace",useMinimalTemplates:!1,isOnboarding:!1};let s=!1;const d=Date.now();let m;try{var u;m=await z(c),s=!0;const e=null===(u=b().default.state.mainEditorCurrentBlockStore)||void 0===u?void 0:u.id;!m||e&&e===m.id||p()._c({environment:n,store:m,pageVisitSource:o().tY.Create,showMoveTo:!0}),N(n),n.device.isMobile&&(S().close(),y().Z.setState({open:!1}))}finally{var v;const o=Date.now()-d,r=e.initializeStore?_().VP(e.initializeStore):void 0,l=e.initializeStore?!r:e.isPrivate;w().en(n,{destination:l?"private":"team",template_block_id:a.rootId,template_duplication_duration_ms:o,team_id:null==r?void 0:r.id,created_page_id:null===(v=m)||void 0===v?void 0:v.id}),w().Xy(n,{from:"mobileApp",success:s,context:t,template_block_id:a.rootId,target_space_id:i.id,template_duplication_duration_ms:o,public_template_name:a.name,template_id:a.id})}}async function x(e){const{environment:t,initializeStore:a,item:o,isPrivate:n,useMinimalTemplates:i,spaceStore:l,spaceViewStore:c}=e,s=i?o.rootId:o.previewRootId,p=await d().callApi({eventName:"loadBlockSubtree",environment:t,data:{block:{id:s,spaceId:o.spaceId},shallow:!1}});let u;"success"===p.type&&(u=r().RecordMapWithRole.create(p.data.subtreeRecordMap));const _="pageTemplateModalActions.loadAndDuplicatePageTemplate",{performResult:f}=R().createAndCommit({userAction:_,environment:t,canUndo:!0,perform:e=>{const o=a||A().KE({environment:t,spaceStore:l,spaceViewStore:c,isPrivate:n,loading:!0,transaction:e});M().fL({environment:t,inMemoryRecordCache:o.inMemoryRecordCache,recordMap:u,debugSource:_});const i=m().loadLocalSubtree(t,{blockId:s,inMemoryRecordCache:o.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!1,allowCopyExternalObjectInstances:!0}).recordMap;if(!i)throw new Error(g().Z.getIntl().formatMessage(L.clientCopyError));return m().localDuplicate({environment:t,sourceBlockId:s,targetBlockPointer:o.pointer,sourceBlockSubtree:i,targetInMemoryRecordCache:o.inMemoryRecordCache,transaction:e,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!0}),o}}),S=f.getCollectionPointer();return(0,v().j)({environment:t,event:{eventName:"create_app_templates",eventProperties:{target_page_ids:[f.id],template_label:o.name,collection_ids:S?[S.id]:[]}}}),f}async function z(e){var t;const{environment:a,item:o,useRecordCache:i,useMinimalTemplates:r,spaceStore:d,isOnboarding:p,from:m,type:v,initializeStore:g,teamStore:_,onSuccess:f,onError:S}=e,b=i&&!r?o.previewRootId:o.rootId,y={id:b,table:l().iU,spaceId:o.spaceId},T=p?"onboarding":null!==(t=o.marketplaceTemplateMetadata)&&void 0!==t&&t.isMobileMarketplaceTemplate?"mobile_app":"homepage_team"===m?"team_home":void 0,w=await(0,u().LL)(a,b),k=T?{context:"",source:T,isListedTemplate:!!w}:void 0;let M=!1,P=d;const A=new(C().G)(a,{table:l().iU,id:y.id,spaceId:y.spaceId});if("inExistingStore"===v&&g){if(P=g,g.isEmptyPage()){const e=g.getParentStore();e&&e.canEdit()&&("block"===e.table||"space"===e.table||"team"===e.table)&&(M=!0,P=e)}}else"inTeam"===v&&_&&(P=_);k||n().log({level:"warning",from:"pageTemplateModalActions.createTemplateInstance",type:"templateInstallationMetadataNotSet",data:{miscDataToConvertToString:{template_id:o.id,template_block_id:o.rootId,target_space_id:d.id,public_template_name:o.name,isOnboarding:p,from:m,type:v}}});const Z=I().default.checkGate({gateName:"enable_local_duplication_for_non_marketplace_templates"}),L=await h().fD({environment:a,store:A,newParentStore:P,addCopyName:!1,duplicateOnlyCollectionSchema:!1,unlockPage:!0,templateInstallationMetadata:k,shouldAttemptServerBackedLocalDuplication:!(0,c().sB)(null==k?void 0:k.source)&&Z});if(L){if(s().x.isSuccess(L)&&L.value.length>0){const e=L.value[0];if(M&&g){const t=g;try{await t.waitUntil((()=>t.isDefined()));const{serverCommitResult:o}=R().createAndCommit({userAction:"pageTemplateModalActions.initializePageTemplateInPlace",environment:a,canUndo:!0,perform:e=>{E().y8({environment:a,blocks:[t],transaction:e,permanentlyDelete:!0})}});return await o,e}catch(U){n().log({level:"error",from:"pageTemplateModalActions.initializePageTemplateInPlace",type:"transactionError",data:{miscDataToConvertToString:{error:U}}})}}return null==f||f(e),e}return null==S||S(),void n().log({level:"error",from:"pageTemplateModalActions.initializePageTemplate",type:"duplicateTemplateError",data:{miscDataToConvertToString:{error:L.error,template_id:o.id,template_block_id:o.rootId,target_space_id:d.id,public_template_name:o.name}}})}}function V(e){const{item:t,transaction:a,spaceViewStore:o}=e;if(o){const e=o.getVisitedTemplateIds();if(e.indexOf(t.rootId)<0){const n=e.concat([t.rootId]);k().sW({store:o,data:{visited_templates:n},transaction:a})}}}},482962:(e,t,a)=>{a.d(t,{EE:()=>v,PL:()=>p,TI:()=>g,W4:()=>m,gA:()=>u});a(267602),a(653476);var o=()=>a(146947),n=()=>a(836273),i=()=>a(696459),r=()=>a(916673),l=()=>a(2971),c=()=>a(205228),s=()=>a(153831),d=()=>a(826955);async function p(e,t){const a=await s().h.load();return e.filter((e=>{const o=e.getCopiedFromPointer();return Boolean(o&&a.isTemplate(o)&&Boolean(t&&t(o.id)))}))}function m(e){const t=window.location.href;return r().SK(t,{tg:e.templateGalleryItem})}function u(e){let t,a;return e instanceof d().j$?(t=e.getAppTemplateURI(),a=e.getBlockId()):"type"in e?"preset"===e.type?(t=e.uri,a=void 0):"pageTemplate"===e.type?(t=void 0,a=e.template.rootId):(0,i().t1)(e):(t=void 0,a=e.rootId),t&&l().presetUriToHumanReadableName[t]?l().presetUriToHumanReadableName[t]:a}function v(e){const t=o().locale&&"en-us"!==o().locale.toLocaleLowerCase()?`/${o().locale.toLowerCase()}`:"",a=void 0!==e?`${t}${n()._j.templates}/${encodeURIComponent(e)}`:`${t}${n()._j.templates}`;return`${c().default.domainBaseUrl}${a}`}function g(e){if(!e)return"";try{const a=JSON.parse(e);if("text"===a.content[0].content[0].nodeType){var t;return(null==a||null===(t=a.content)||void 0===t||null===(t=t[0])||void 0===t||null===(t=t.content)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.value)||""}}catch(a){return""}}}}]);