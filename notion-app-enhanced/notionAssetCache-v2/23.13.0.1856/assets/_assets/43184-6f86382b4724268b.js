"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[43184],{673893:(e,t,a)=>{a.d(t,{EQ:()=>l,PT:()=>d});a(821057);var n=a(667294),o=()=>a(846550),r=()=>a(985551),i=a(785893);const s=(0,n.createContext)({screenWidthType:"desktop",isMobileWidth:!1,isLowResolutionTabletWidth:!1,isDesktopWidth:!1,isTabletWidth:!1});function l(){const e=(0,n.useContext)(s);if(!e)throw new Error("ScreenWidthContext not found. Please make sure this is used within a ScreenWidthContext.Provider.");return e}function d(e){const{children:t,mobileUpperBound:a=550,lowResolutionTabletUpperBound:l=720,tabletUpperBound:d=1024,throttle:c=0}=e,u=(0,n.useRef)(null),p=(0,o().yK)((()=>({sizeObserverContainer:{width:"100%",height:0,position:"absolute"}})),[]),[m,y]=(0,n.useState)("desktop"),g=(0,n.useCallback)((e=>{e.state.width<=a?y("mobile"):e.state.width>a&&e.state.width<=l?y("lowResolutionTablet"):e.state.width>l&&e.state.width<=d?y("tablet"):y("desktop")}),[a,l,d]);(0,r().I)(u,g,c);const f="mobile"===m,h="desktop"===m,x="tablet"===m,v="lowResolutionTablet"===m,b=n.useMemo((()=>({screenWidthType:m,isMobileWidth:f,isLowResolutionTabletWidth:v,isDesktopWidth:h,isTabletWidth:x})),[m,f,v,h,x]);return(0,i.jsxs)(s.Provider,{value:b,children:[(0,i.jsx)("div",{ref:u,style:p.sizeObserverContainer}),t]})}s.displayName="ScreenWidthContext"},985551:(e,t,a)=>{a.d(t,{I:()=>r});a(821057);var n=a(667294),o=()=>a(200936);function r(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,n.useEffect)((()=>{const n=new(o().E)({throttleMs:a});if(!e.current)throw new Error("ref.current is null");return n.observe(e.current),n.rect.addListener(t),()=>{n.destroy()}}),[t])}},120508:(e,t,a)=>{a.d(t,{$g:()=>b,JC:()=>k,LN:()=>y,Tz:()=>x,X4:()=>g,bF:()=>h,nb:()=>m,p7:()=>f,xu:()=>v});a(398858),a(461318),a(33228);var n=()=>a(799891),o=()=>a(824462),r=()=>a(308186),i=()=>a(497065),s=()=>a(594546),l=()=>a(443269),d=()=>a(527278),c=()=>a(749826),u=()=>a(177116),p=()=>a(518172);function m(e){p().Z.setState({...p().Z.state,isModalOpen:!1,marketplaceListingId:void 0,from:void 0});const t=new URL(window.location.href);t.searchParams.delete("checkout"),t.searchParams.delete("coupon"),t.searchParams.delete("from"),i().c4({environment:e,url:t.toString()})}function y(e){const t=new URL(window.location.href);t.searchParams.append("checkout","true"),i().c4({environment:e,url:t.toString()})}async function g(e){const{environment:t,listingId:a,spaceId:n,intl:i}=e,s=await o().callApi({eventName:"initiateProductPurchase",environment:t,data:{productId:a,listingId:a,spaceId:n}});if("success"===s.type)return s.data;m(t),r().UW((0,l().wf)(i,s))}async function f(e){const{coupon:t,productListingId:a,environment:n}=e,r=d().Z.getIntl();try{u().Z.setState({...u().Z.state,invalidCouponReason:""});const e=await o().callApi({eventName:"calculatePriceWithMarketplaceCoupon",environment:n,data:{productListingId:a,couponCode:t}});if("success"===e.type)return{discount:e.data.discount,discountedPrice:e.data.discountedPrice};{const t=(0,l().wf)(r,e);u().Z.setState({...u().Z.state,invalidCouponReason:t})}}catch(i){u().Z.setState({...u().Z.state,invalidCouponReason:r.formatMessage({id:"inApp.marketplace.checkout.coupon.invalid",defaultMessage:"Something went wrong, please try again."})})}}async function h(e){const{address:t,acquisitionId:a,elements:n,environment:r}=e,i=u().Z.state.discountedPrice,s=u().Z.state.coupon;let l=0,d=0;u().Z.setState({...u().Z.state,isTaxValid:!1,isCalculatingTax:!0});const c=await o().callApi({eventName:"calculateMarketplaceTax",environment:r,data:{address:t,acquisitionId:a,couponCode:s}});if("success"===c.type&&c.data.valid){l=c.data.taxAmount,d=c.data.taxAmountWithCoupon??0;0!==(void 0!==i?c.data.totalAmountWithCoupon:c.data.totalAmount)&&n.update({amount:void 0!==i?c.data.totalAmountWithCoupon:c.data.totalAmount}),u().Z.setState({...u().Z.state,address:t,taxAmount:l,taxAmountWithDiscount:d,isTaxValid:!0,isCalculatingTax:!1})}}function x(e){const{environment:t,emailRequirement:a}=e,n=p().Z.state;if(n.creatorId&&n.customerId&&n.marketplaceListingId&&n.templateId){const e={creator_id:n.creatorId,template_id:n.templateId,listing_id:n.marketplaceListingId,customer_id:n.customerId,email_requirement:a};(0,s().j)({environment:t,event:{eventName:"marketplace_checkout_open",eventProperties:e}}),c().default.logEvent("marketplace_checkout_open",1,e)}}function v(e){const{environment:t,coupon:a}=e,n=p().Z.state;if(n.creatorId&&n.customerId&&n.marketplaceListingId&&n.templateId){const e={creator_id:n.creatorId,template_id:n.templateId,listing_id:n.marketplaceListingId,customer_id:n.customerId,coupon:a};(0,s().j)({environment:t,event:{eventName:"marketplace_coupon_apply",eventProperties:e}}),c().default.logEvent("marketplace_coupon_apply",1,e)}}function b(e){const{environment:t,emailRequirement:a}=e,o=p().Z.state,r=u().Z.state;if(o.creatorId&&o.customerId&&o.marketplaceListingId&&o.templateId&&r.paymentType){const e={creator_id:o.creatorId,template_id:o.templateId,listing_id:o.marketplaceListingId,customer_id:o.customerId,payment_method:r.paymentType,email_requirement:a};(0,s().j)({environment:t,event:{eventName:"marketplace_payment_initiated",eventProperties:e}}),c().default.logEvent("marketplace_payment_initiated",1,e),n().log({level:"info",from:"marketplaceCheckoutActions",type:"marketplacePaymentInitiated",data:{miscDataToConvertToString:{...e}}})}}function k(e){const{environment:t,success:a,emailRequirement:o,transactionValue:r,error:i}=e,l=p().Z.state,d=u().Z.state;if(l.creatorId&&l.customerId&&l.marketplaceListingId&&l.templateId&&d.paymentType){const e={creator_id:l.creatorId,template_id:l.templateId,listing_id:l.marketplaceListingId,customer_id:l.customerId,payment_method:d.paymentType,email_requirement:o,transaction_value:r,success:a};(0,s().j)({environment:t,event:{eventName:"marketplace_payment_completed",eventProperties:e}}),c().default.logEvent("marketplace_payment_completed",1,e)}a?n().log({level:"info",from:"marketplaceCheckoutActions",type:"marketplacePaymentCompletedSuccess",data:{miscDataToConvertToString:{creator_id:l.creatorId,template_id:l.templateId,listing_id:l.marketplaceListingId,customer_id:l.customerId,payment_method:d.paymentType,email_requirement:o,success:a}}}):n().log({level:"error",from:"marketplaceCheckoutActions",type:"marketplacePaymentCompletedFailure",data:{miscDataToConvertToString:{error:i,creator_id:l.creatorId,template_id:l.templateId,listing_id:l.marketplaceListingId,customer_id:l.customerId,payment_method:d.paymentType,email_requirement:o,success:a}}})}},943184:(e,t,a)=>{a.d(t,{n:()=>ve});var n=()=>a(629756),o=a(667294),r=()=>a(219727),i=()=>a(142735),s=()=>a(846550),l=()=>a(801812),d=()=>a(788860),c=()=>a(342792),u=()=>a(661641),p=()=>a(673893),m=()=>a(876822),y=()=>a(120508),g=()=>a(356140),f=()=>a(518172),h=()=>a(875120),x=()=>a(799891),v=()=>a(848297),b=()=>a(578292),k=()=>a(396136),C=()=>a(145543),I=()=>a(513670),S=()=>a(824462),w=()=>a(308186),T=()=>a(443269),A=()=>a(749826),P=()=>a(21688),_=()=>a(826955),M=()=>a(38812),j=()=>a(791642),Z=()=>a(602422),L=()=>a(177116),E=()=>a(851898),N=(a(241792),()=>a(629013)),D=()=>a(374327),B=()=>a(291198),R=a(785893);const q="marketplace-checkout-email";function V(){const e=(0,s().yK)((e=>({inputLabel:{position:"absolute",marginTop:"7px",marginLeft:"9px"},inputStyle:{paddingTop:"17px",cursor:"not-allowed",color:e.text.tertiary}})),[]),t=(0,i().VK)((()=>{var e;return(null===(e=m().default.state.currentUserStore)||void 0===e?void 0:e.getEmail())||""}),[]);return(0,R.jsxs)("div",{children:[(0,R.jsx)(u().q,{as:"label",id:q,styleName:"Micro-10px/Semibold",style:e.inputLabel,children:(0,R.jsx)(d()._H,{id:"inApp.marketplace.checkout.email",defaultMessage:"Email"})}),(0,R.jsx)(B().Z,{disabled:!0,value:t,inputStyle:e.inputStyle,"aria-labelledby":q})]})}const W=(0,d().vU)({paymentDetails:{id:"inApp.marketplace.checkout.payment.secondaryText",defaultMessage:"Payment details"},billedTo:{id:"inApp.marketplace.checkout.payment.billedTo",defaultMessage:"Billed to"}});function K(e){const{onAddressChange:t,contacts:a,setIsPaymentElementComplete:o,isPaying:i}=e,l=function(){const e=(0,r().Fy)().isMobile;return(0,s().yK)((()=>({formContainer:{minWidth:e?"100%":390,display:"flex",flexDirection:"column",gap:24},filler:{width:"100%",display:"flex",flexDirection:"column",gap:8},isolation:{isolation:"auto"},addressContainer:{zIndex:1}})),[e])}(),c=(0,n().useStripe)(),p=(0,n().useElements)(),m=(0,d().YB)(),y={mode:"billing",contacts:a.length>0?a.map((e=>({name:e.name,address:e.address}))):void 0},g=(0,N().y)(t,1e3),f={business:{name:"Notion Labs, Inc"},readOnly:i};return(0,R.jsxs)("div",{style:l.formContainer,children:[(0,R.jsxs)("div",{style:{...l.filler,...l.isolation},children:[(0,R.jsx)(u().q,{styleName:"Caption-12px/Semibold",colorName:"secondary",children:m.formatMessage(W.billedTo)}),(0,R.jsx)("div",{style:l.addressContainer,children:(0,R.jsx)(n().AddressElement,{options:y,onChange:g})}),(0,R.jsx)(V,{})]}),(0,R.jsxs)("div",{style:l.filler,children:[(0,R.jsx)(u().q,{styleName:"Caption-12px/Semibold",colorName:"secondary",children:m.formatMessage(W.paymentDetails)}),(0,R.jsx)(n().PaymentElement,{options:f,onChange:e=>{c&&p&&(e.value.type&&(0,D().nr)(e.value.type)&&L().Z.setState({...L().Z.state,paymentType:e.value.type}),e.complete&&o(!0))}})]})]})}var U=()=>a(518242),H=()=>a(981583);function F(e){const{productInformation:t}=e,{name:a,imageSource:n,mobileImageSource:o,creatorIconImage:i,creatorName:l}=t,d=(0,r().Fy)().isMobile,c=function(){const e=(0,r().Fy)(),t=e.isMobile;return(0,s().yK)((e=>({container:{display:"flex",gap:20,alignItems:"center",justifyContent:"space-between",padding:t?"16px 16px 0px 16px":"16px",borderRadius:6,border:`1px solid ${e.stroke.primary}`,maxHeight:t?"120px":"initial",overflow:t?"hidden":"initial"},mobileProductImage:{width:"87px",minHeight:"100px",height:"auto",border:t?"none":`1px solid ${e.stroke.primary}`,boxShadow:t?"rgba(0, 0, 0, 0.02) -10px 12px 32px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px":"unset",borderRadius:6},productImageContainer:{alignSelf:t?"start":"initial"},productImage:{width:118,height:74,borderRadius:6,border:`1px solid ${e.stroke.primary}`},productNameAndCreator:{display:"flex",flexDirection:"column",gap:10,paddingBottom:t?16:0},productCreator:{display:"flex",alignItems:"center",gap:6},productName:{display:"flex",flexWrap:"wrap",maxWidth:181}})),[t])}();return(0,R.jsxs)("div",{style:c.container,children:[(0,R.jsxs)("div",{style:c.productNameAndCreator,children:[(0,R.jsx)(u().q,{styleName:"UIHeader-17px/Semibold",colorName:"primary",customStyles:c.productName,children:a}),(0,R.jsxs)("div",{style:c.productCreator,children:[(0,R.jsx)(H().Z,{size:20,avatar:{name:l,avatarUrl:i}}),(0,R.jsx)(u().q,{styleName:"UISmall-12px/Medium",colorName:"secondary",children:l})]})]}),(0,R.jsx)("div",{style:c.productImageContainer,children:(0,R.jsx)(U().ZP,{src:d?o:n,alt:a,style:d?c.mobileProductImage:c.productImage})})]})}var z=()=>a(793331),O=()=>a(383802),$=()=>a(666414),Y=()=>a(312578),G=()=>a(906651),X=()=>a(594546);function J(e){let{children:t,source:a,styles:n={}}=e;const o=(0,r().O7)(),l=(0,s().yK)((()=>({link:{cursor:"pointer"}})),[]),d=(0,i().VK)((()=>A().default.getConfigKey("mwn_refund_policy_link","link")),[]);return d?(0,R.jsx)("a",{style:{...l.link,...n},href:d,target:"_blank",onClick:()=>{(0,X().j)({environment:o,event:{eventName:"marketplace_refund_policy_click",eventProperties:{source:a}}}),A().default.logEvent("marketplace_refund_policy_click",a,{source:a})},children:t}):(0,R.jsx)(R.Fragment,{children:t})}var Q=()=>a(154186);function ee(e){const{couponCode:t,onApplyClick:a,onCouponChange:n,isApplyingCoupon:o,isCouponApplied:r,onRemoveClick:i,invalidCouponReason:l,disabled:c}=e,p=(0,d().YB)(),m=c||o||""===t,y=function(e){const{disabled:t,applyButtonDisabled:a}=e;return(0,s().yK)((e=>({container:{display:"flex",flexDirection:"column",gap:8,position:"relative"},inputOuter:{height:34,padding:"10px 6px 10px 10px",display:"flex",alignItems:"center",borderRadius:6,border:e.stroke.primary,background:e.surface.wash},input:{position:"relative"},inputInner:{cursor:t?"not-allowed":void 0},button:{background:"transparent",height:28,padding:"0px 8px 0px 8px",display:"flex",justifyContent:"center",alignItems:"center",borderRadius:6,isolation:"auto",cursor:a?"not-allowed":void 0,width:"max-content"},buttonContainer:{cursor:"pointer"},buttonHovered:{background:t?void 0:e.buttonHoveredBackground},buttonPressed:{background:t?void 0:e.buttonPressedBackground},invalidBoxShadow:{position:"absolute",pointerEvents:"none",isolation:"auto",borderRadius:6,inset:0,zIndex:1,boxShadow:"0px 0px 0px 1px #D44C47 inset, 0px 0px 0px 2px rgba(225, 111, 100, 0.35)"}})),[t,a])}({disabled:c||o,applyButtonDisabled:m}),g=Boolean(l);return(0,R.jsxs)("div",{style:y.container,children:[(0,R.jsx)(u().q,{styleName:"UISmall-12px/Medium",colorName:"secondary",children:(0,R.jsx)("label",{htmlFor:"couponInput",children:(0,R.jsx)(d()._H,{id:"inApp.marketplace.checkout.coupon.label",defaultMessage:"Coupon"})})}),(0,R.jsxs)("div",{style:y.input,children:[(0,R.jsx)(B().Z,{id:"couponInput",ignoreKeyboardMode:!0,value:t,disabled:c||o,onChange:n,placeholder:p.formatMessage({id:"inApp.marketplace.checkout.coupon.input.placeholder",defaultMessage:"Code"}),style:y.inputOuter,inputStyle:y.inputInner,rightStyle:y.buttonContainer,right:o?(0,R.jsx)(Y().Z,{}):r?(0,R.jsx)(Q().Z,{style:y.button,onClick:()=>{i()},hoveredStyle:y.buttonHovered,pressedStyle:y.buttonPressed,disabled:c,children:(0,R.jsx)(u().q,{styleName:"UIRegular-14px/Regular",colorName:"primary",children:(0,R.jsx)(d()._H,{id:"inApp.marketplace.checkout.coupon.remove",defaultMessage:"Remove"})})}):(0,R.jsx)(Q().Z,{style:y.button,onClick:async()=>{await a(t)},hoveredStyle:y.buttonHovered,pressedStyle:y.buttonPressed,disabled:m,children:(0,R.jsx)(u().q,{styleName:"UIRegular-14px/Regular",colorName:m?"secondary":"primary",children:(0,R.jsx)(d()._H,{id:"inApp.marketplace.checkout.coupon.apply",defaultMessage:"Apply"})})})}),g&&(0,R.jsx)("div",{style:y.invalidBoxShadow})]}),g&&(0,R.jsx)(u().q,{styleName:"UISmall-12px/Regular",colorName:"uiRedPrimary","aria-invalid":"true","aria-errormessage":p.formatMessage({id:"inApp.marketplace.checkout.coupon.invalid.label",defaultMessage:"Invalid coupon code"}),children:l})]})}var te=()=>a(715139);function ae(e){const{checkboxProps:t,label:a,error:n,containerStyles:o={}}=e,r=(0,s().yK)((()=>({container:{display:"flex",gap:8,pointer:"cursor"},checkbox:{marginTop:"1px"},text:{display:"flex",flexDirection:"column",gap:2}})),[]);return(0,R.jsxs)("label",{style:{...r.container,...o},children:[(0,R.jsx)(te().Z,{size:14,...t,style:{...t.style,...r.checkbox}}),(0,R.jsxs)("div",{style:r.text,children:[(0,R.jsx)(u().q,{styleName:"UISmall-12px/Regular",colorName:"primary",children:a}),n&&(0,R.jsx)(u().q,{styleName:"UISmall-12px/Regular",colorName:"uiRedPrimary",children:n})]})]})}function ne(e){let{displayInformation:{emailRequirement:t}}=e;const a=(0,s().yK)((e=>({container:{display:"flex",flexDirection:"column",gap:"8px"}})),[]),{isChecked:n,isError:r}=(0,i().VK)((()=>({isChecked:L().Z.state.allowCreatorToAddToMailingList,isError:L().Z.state.allowCreatorToAddToMailingListError})),[]);(0,o.useEffect)((()=>{n&&r&&L().Z.setState({...L().Z.state,allowCreatorToAddToMailingListError:!1})}),[n,r]);const l="required"===t;return l||"optional"===t?(0,R.jsx)("div",{style:a.container,children:(0,R.jsx)(ae,{label:(0,R.jsx)(d()._H,{id:"inApp.marketplace.checkout.saveEmail",defaultMessage:"Allow the creator to add me to their mailing list for updates, promotions, and helpful tips."}),checkboxProps:{onClick:()=>{L().Z.setState({...L().Z.state,allowCreatorToAddToMailingList:!L().Z.state.allowCreatorToAddToMailingList})},checked:n,"aria-required":l},error:l&&r&&(0,R.jsx)(d()._H,{id:"inApp.marketplace.checkout.emailRequired",defaultMessage:"You must opt-in to emails to continue"})})}):null}function oe(e){const{price:t,taxAmount:a,discount:n,isCalculatingNewPrice:o,discountedPrice:r,taxAmountWithDiscount:i}=e,l=(0,D().o3)({price:t,taxAmount:a,currencyValue:O().X.USD}),c=(0,d().YB)(),p=(0,s().yK)((e=>({orderSummaryContainer:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},priceSummaryContainer:{display:"flex",gap:4,alignItems:"center"},fullPriceStrikethrough:{textDecoration:"line-through",color:e.text.tertiary}})),[]);return(0,R.jsxs)("div",{style:p.orderSummaryContainer,children:[(0,R.jsxs)("div",{style:p.priceSummaryContainer,children:[(0,R.jsx)(u().q,{styleName:"UITitle-26px/Bold",colorName:"primary",children:void 0!==n&&void 0!==r?(0,R.jsx)(d()._H,{id:"inApp.marketplace.checkout.totalPrice.withDiscount",defaultMessage:"<strikethrough><fullPriceMoney></fullPriceMoney></strikethrough> <priceWithDiscountMoney></priceWithDiscountMoney>",values:{strikethrough:e=>(0,R.jsx)("span",{style:p.fullPriceStrikethrough,children:e}),fullPriceMoney:()=>(0,R.jsx)(z().W,{cost:{amount:l.amount,currencyCode:"USD"},intl:c,trailingZeroDisplay:"auto"}),priceWithDiscountMoney:()=>{const e=(0,D().o3)({price:r,taxAmount:i,currencyValue:O().X.USD});return(0,R.jsx)(z().W,{cost:{amount:e.amount,currencyCode:"USD"},intl:c,trailingZeroDisplay:"auto"})}}}):(0,R.jsx)(z().W,{cost:{amount:l.amount,currencyCode:"USD"},intl:c,trailingZeroDisplay:"auto"})}),(0,R.jsx)(u().q,{styleName:"UISmall-12px/Regular",colorName:"secondary",children:(0,R.jsx)(d()._H,{id:"inApp.marketplace.checkout.taxIfApplicable",defaultMessage:"(includes tax if applicable)"})})]}),o&&(0,R.jsx)(Y().Z,{})]})}function re(e){const{listingId:t}=e,a=(0,i().VK)((()=>A().default.getConfigKey("marketplace_transactional_email_config","listingIds")),[]),n=(0,i().VK)((()=>L().Z.state.agreedToTermsAndConditions),[]),o=(0,i().VK)((()=>L().Z.state.showTermsAndConditionsError),[]),r=(0,d().YB)(),l=(0,s().yK)((e=>({termsAndConditionsContainer:{display:"flex",flexDirection:"column",gap:2},link:{cursor:"pointer",color:e.text.primary}})),[]);return(0,R.jsx)("div",{style:l.termsAndConditionsContainer,children:(0,R.jsx)(ae,{checkboxProps:{onClick:()=>{L().Z.setState({...L().Z.state,agreedToTermsAndConditions:!n,showTermsAndConditionsError:!1})},"aria-required":!0,checked:n},label:r.formatMessage(a.includes(t)?ie.termsAndConditionsTransactionalEmail:ie.termsAndConditions,{a:e=>(0,R.jsx)("a",{style:l.link,href:"https://www.notion.so/notion/Terms-and-Privacy-28ffdd083dc3473e9c2da6ec011b58ac",target:"_blank",children:e}),refundLink:e=>(0,R.jsx)(J,{source:"checkout_modal",styles:l.link,children:e})}),error:o?r.formatMessage(ie.termsAndConditionsError):void 0})})}const ie=(0,d().vU)({termsAndConditionsTransactionalEmail:{id:"inApp.marketplace.payment.termsAndConditions.transactionalEmail",defaultMessage:"I agree to <a>Notion’s terms & conditions</a> and the Marketplace’s <refundLink>14-day refund policy</refundLink>. I also agree that the above email address may be shared with the template creator for transactional purposes"},termsAndConditions:{id:"inApp.marketplace.payment.termsAndConditions",defaultMessage:"I agree to <a>Notion’s terms & conditions</a> and the Marketplace’s <refundLink>14-day refund policy</refundLink>"},termsAndConditionsError:{id:"inApp.marketplace.payment.termsAndConditions.error",defaultMessage:"You must accept the Marketplace terms to continue"}});async function se(e){let{setIsApplyingCoupon:t,environment:a,coupon:n,productListingId:o,address:r,elements:i,acquisitionId:s}=e;const l=n.trim().toUpperCase();if(0===l.length)return;t(!0);const d=await y().p7({environment:a,coupon:l,productListingId:o});if(d){let e=0;if((0,h().A)(r)){const t=await S().callApi({eventName:"calculateMarketplaceTax",environment:a,data:{address:r,acquisitionId:s,couponCode:n}});if("success"===t.type&&t.data.valid){e=t.data.taxAmountWithCoupon??0;const a=t.data.totalAmountWithCoupon;i&&0!==a&&i.update({amount:a})}}L().Z.setState({...L().Z.state,discount:d.discount,discountedPrice:d.discountedPrice,isCouponApplied:!0,taxAmountWithDiscount:e}),y().xu({environment:a,coupon:n})}t(!1)}function le(e){const{displayInformation:t,price:a,isPaying:n,onSubmit:o,productListingId:r,acquisitionId:i,isTCCheckboxEnabled:s}=e,l=me();return(0,R.jsxs)("div",{style:l.sidebarContainer,children:[(0,R.jsxs)("div",{style:l.productCardContainer,children:[(0,R.jsx)(u().q,{styleName:"UISmall-12px/Medium",colorName:"secondary",children:(0,R.jsx)(d()._H,{id:"inApp.marketplace.checkout.product.label",defaultMessage:"Notion template"})}),(0,R.jsx)(F,{productInformation:t})]}),(0,R.jsxs)("div",{style:l.priceAndPaymentContainer,children:[(0,R.jsx)(de,{productListingId:r,acquisitionId:i,price:a,isPaying:n}),(0,R.jsx)("div",{style:l.requiredCheckboxesContainer,children:(0,R.jsx)(ce,{listingId:r,displayInformation:t,isTCCheckboxEnabled:s})}),(0,R.jsx)($().Z,{size:1}),(0,R.jsx)(pe,{onSubmit:o,price:a,isPaying:n}),s?null:(0,R.jsx)(ue,{listingId:r})]})]})}function de(e){const{productListingId:t,acquisitionId:a,price:s,isPaying:l}=e,d=(0,r().O7)(),c=(0,Z().d)(),u=(0,n().useElements)(),p=(0,o.useRef)(!1),[m,y]=(0,o.useState)(!1),g=(0,i().VK)((()=>L().Z.state.coupon),[]),f=(0,i().VK)((()=>L().Z.state.isCouponApplied),[]),h=(0,i().VK)((()=>L().Z.state.invalidCouponReason),[]),x=(0,i().VK)((()=>L().Z.state.taxAmount),[]),v=(0,i().VK)((()=>L().Z.state.address),[]),b=(0,o.useCallback)((async e=>{await se({environment:d,productListingId:t,acquisitionId:a,address:v,elements:u,setIsApplyingCoupon:y,coupon:e})}),[d,t,a,v,u]);(0,o.useEffect)((()=>{(async()=>{if(!c.coupon||!t||!a||!u||p.current)return;const e=c.coupon.trim().toUpperCase();L().Z.setState({...L().Z.state,coupon:e}),await se({environment:d,productListingId:t,acquisitionId:a,address:v,elements:u,setIsApplyingCoupon:y,coupon:e}),p.current=!0})()}),[c.coupon,d,t,a,v,u]);return(0,R.jsx)(ee,{couponCode:g,onCouponChange:e=>{const t=e.target.value.trim().toUpperCase();e.target.value=t,L().Z.setState({...L().Z.state,coupon:t})},onApplyClick:b,onRemoveClick:()=>{L().Z.setState({...L().Z.state,coupon:"",discount:void 0,isCouponApplied:!1,discountedPrice:void 0}),u&&u.update({amount:x+s})},isCouponApplied:f,isApplyingCoupon:m,invalidCouponReason:h,disabled:l})}function ce(e){const{displayInformation:t,listingId:a,isTCCheckboxEnabled:n}=e;return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(ne,{displayInformation:t}),n&&(0,R.jsx)(re,{listingId:a})]})}function ue(e){const{listingId:t}=e,a=(0,i().VK)((()=>A().default.getConfigKey("marketplace_transactional_email_config","listingIds")),[]),n=(0,s().yK)((e=>({link:{color:e.text.secondary}})),[]);return(0,R.jsx)(u().q,{styleName:"UISmall-12px/Regular",colorName:"secondary",children:a.includes(t)?(0,R.jsx)(d()._H,{id:"inApp.marketplace.payment.termsAndConditionsBuyLabel.transactionalEmail",defaultMessage:"By purchasing this template, I agree to <a>Notion’s terms & conditions</a> and the Marketplace’s <refundLink>14-day refund policy</refundLink>. I also agree that the above email address may be shared with the template creator for transactional purposes",values:{a:e=>(0,R.jsx)("a",{style:n.link,href:"https://www.notion.so/notion/Terms-and-Privacy-28ffdd083dc3473e9c2da6ec011b58ac",target:"_blank",children:e}),refundLink:e=>(0,R.jsx)(J,{source:"checkout_modal",styles:n.link,children:e})}}):(0,R.jsx)(d()._H,{id:"inApp.marketplace.payment.termsAndConditionsBuyLabel",defaultMessage:"By purchasing this template, I agree to <a>Notion’s terms & conditions</a> and the Marketplace’s <refundLink>14-day refund policy</refundLink>",values:{a:e=>(0,R.jsx)("a",{style:n.link,href:"https://www.notion.so/notion/Terms-and-Privacy-28ffdd083dc3473e9c2da6ec011b58ac",target:"_blank",children:e}),refundLink:e=>(0,R.jsx)(J,{source:"checkout_modal",styles:n.link,children:e})}})})}function pe(e){const{onSubmit:t,price:a,isPaying:n}=e,o=me(),r=(0,d().YB)(),s=(0,i().VK)((()=>L().Z.state.discountedPrice),[]),l=(0,i().VK)((()=>L().Z.state.taxAmount),[]),c=(0,i().VK)((()=>L().Z.state.discount),[]),u=(0,i().VK)((()=>L().Z.state.isCalculatingTax),[]),p=(0,i().VK)((()=>L().Z.state.taxAmountWithDiscount),[]),m=(0,D().o3)({taxAmount:void 0!==s?p:l,price:void 0!==s?s:a,currencyValue:O().X.USD});return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(oe,{price:a,discountedPrice:s,taxAmount:l,taxAmountWithDiscount:p,discount:c,isCalculatingNewPrice:u}),(0,R.jsx)(G().Z,{onClick:t,style:o.singleButton,disabled:n,children:n?(0,R.jsx)(Y().Z,{}):(0,R.jsx)("div",{style:o.buyButtonText,children:0===m.amount?r.formatMessage(ye.purchaseFreeTemplate):r.formatMessage(ye.purchaseTemplate,{money:()=>(0,R.jsx)(z().W,{cost:{amount:m.amount,currencyCode:"USD"},intl:r,trailingZeroDisplay:"auto"})})})})]})}function me(){return(0,s().yK)((e=>({sidebarContainer:{display:"flex",flexDirection:"column",gap:30},priceAndPaymentContainer:{display:"flex",flexDirection:"column",gap:20},productCardContainer:{display:"flex",flexDirection:"column",gap:8},doubleButton:{width:"250px"},alreadyOwnedCtas:{display:"flex",alignItems:"center",gap:20},requiredCheckboxesContainer:{display:"flex",flexDirection:"column",gap:16},singleButton:{width:"100%",height:36,borderRadius:8},buyButtonText:{fontSize:16,color:e.text.contrastPrimary,fontWeight:590}})),[])}const ye=(0,d().vU)({purchaseTemplate:{id:"inApp.marketplace.checkout.payment.buy",defaultMessage:"Buy for <money></money>"},alreadyOwned:{id:"marketplace.payment.alreadyOwned",defaultMessage:"You have successfully purchased this product"},alreadyRefunded:{id:"marketplace.payment.alreadyRefunded",defaultMessage:"You have already refunded this product"},templateFulfillmentMessage:{id:"inApp.marketplace.payment.templateFulfillmentMessage",defaultMessage:"Duplicate template"},buyerProfileMessage:{id:"inApp.marketplace.payment.buyerProfileMessage",defaultMessage:"Buyer profile"},purchaseFreeTemplate:{id:"inApp.marketplace.checkout.payment.buy.free",defaultMessage:"Add"}}),ge=(0,d().vU)({paymentError:{id:"marketplace.payment.error",defaultMessage:"An error occurred while processing your payment. {error}"},duplicationError:{id:"marketplace.payment.error.duplicationError",defaultMessage:"A error occurred duplication the template after your payment. Please refresh the page."}});function fe(e){const t=(0,r().O7)(),{displayInformation:a,alreadyOwned:s,price:l,acquisitionId:c,listingId:u,contacts:p}=e,N=(0,i().VK)((()=>"on"!==A().default.getEligibleGroup({experimentId:"marketplace_checkout_move_tc_checkbox",defaultGroup:"off"})),[]),D=(0,i().VK)((()=>A().default.getConfigKey("marketplace_redirect_url_after_purchase_config",u)),[u]),B=(0,i().VK)((()=>L().Z.state.address),[]),q=(0,i().VK)((()=>L().Z.state.discountedPrice),[]),V=(0,i().VK)((()=>L().Z.state.coupon),[]),W=(0,i().VK)((()=>L().Z.state.allowCreatorToAddToMailingList),[]),U=(0,i().VK)((()=>L().Z.state.agreedToTermsAndConditions),[]),H=(0,i().VK)((()=>L().Z.state.isTaxValid),[]),F=(0,i().VK)((()=>L().Z.state.isCalculatingTax),[]),z=(0,i().VK)((()=>f().Z.state.teamStore),[]),O=(0,i().VK)((()=>L().Z.state.paymentType),[]),$=(0,n().useStripe)(),Y=(0,n().useElements)(),G=(0,d().YB)(),[X,J]=(0,o.useState)(!1),[Q,ee]=(0,o.useState)(!1),te=he(),{currentSpaceStore:ae,currentSpaceViewStore:ne}=(0,i().VK)((()=>m().default.state),[]),oe=(0,g().W)(),re=(0,Z().d)(),ie=(0,r().Fy)().isMobile,se=(0,i().VK)((()=>{if(!c)return;return new(_().Ip)(t,{table:C().GL,id:c}).getStatus()}),[c,t]);(0,o.useEffect)((()=>{X&&"succeeded"===se&&(async()=>{if(!re.slug)return w().UW(G.formatMessage(ge.duplicationError)),void J(!1);D&&window.open(D,"_blank");const e=await j().N9({environment:t,slug:re.slug,locale:(0,b().E2)(G),acquisitionDestinationId:oe,currentSpaceId:oe});if(e&&e.block_id){const a=new(_().G)(t,{table:k().iU,id:e.block_id});if(ne&&a&&ae){const n=f().Z.state.from;if(y().nb(t),f().Z.setState({...f().Z.state,hasSuccessfullyPurchasedProduct:!0}),E().Z.setState({...E().Z.state,duplicationStatus:"duplicating"}),ie)return(0,j().iw)({environment:t,template:e,currentSpaceStore:ae,currentSpaceViewStore:ne,templateBlockStore:a,teamStore:z,from:n,isMobile:!0}).then((()=>{E().Z.setState({...E().Z.state,duplicationStatus:"success"})})),void(P().Z.state.open&&P().Z.setState({...P().Z.state,isCheckout:!1,item:{...P().Z.state.item,marketplaceTemplateMetadata:{...P().Z.state.item.marketplaceTemplateMetadata,userHasAcquiredTemplate:!0}}}));await(0,j().iw)({environment:t,template:e,currentSpaceStore:ae,currentSpaceViewStore:ne,templateBlockStore:a,teamStore:z,from:n,duplicationStartedToastProps:{iconGroup:v().V,iconGroupColorName:"greenPrimary",iconGroupVariant:"default",title:G.formatMessage({id:"inApp.marketplace.checkout.payment.success.duplication.started.title",defaultMessage:"Purchase successful"}),message:G.formatMessage({id:"inApp.marketplace.checkout.payment.success.duplication.started.message",defaultMessage:"The template is being added to your workspace. We will let you know when it’s ready to use."})}}),E().Z.setState({...E().Z.state,duplicationStatus:"success"})}}J(!1)})()}),[se,X,re.slug,z,ne,oe,G,t,ae,ie,D]);const de=(0,o.useMemo)((()=>!X&&H&&Q&&!F),[X,H,Q,F]),ce=(0,o.useCallback)((async e=>{var n;let o;e.preventDefault();const r=!U&&N,i="required"===a.emailRequirement&&!W,l={listingId:u,acquisitionId:c,currentSpaceId:oe};if(r||i)return x().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Terms and conditions or mailing list error",data:{miscDataToConvertToString:{...l,showTermsAndConditionsError:r,allowCreatorToAddToMailingListError:i}}}),void L().Z.setState({...L().Z.state,showTermsAndConditionsError:r,allowCreatorToAddToMailingListError:i});if(!Y)return void x().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"No Stripe elements found.",data:{miscDataToConvertToString:{...l}}});if(!$)return void x().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"No stripe instance found.",data:{miscDataToConvertToString:{...l}}});if(!oe)return void x().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"No spaceId found.",data:{miscDataToConvertToString:{...l}}});if(!B)return void x().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"No Stripe address found or invalid input.",data:{miscDataToConvertToString:{...l}}});if(s)return void x().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Customer already owns this product for the workspace.",data:{miscDataToConvertToString:{...l}}});if(!de&&0!==q)return void x().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Attempted payment without enabled payment.",data:{miscDataToConvertToString:{...l,isTaxValid:H,isPaymentElementComplete:Q,isCalculatingTax:F,isPaying:X}}});if("card"!==O){const e=Y.getElement("address");if(e){const t=await e.getValue();if(!t.complete)return void x().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Google/Apply Pay attempt with incomplete address",data:{miscDataToConvertToString:{...l,addressValue:t}}})}}if("card"===O){const e=0!==q?await Y.submit():{};if(e.error)return void x().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Element submit error",data:{miscDataToConvertToString:{...l,elementSubmitResponse:e}}})}L().Z.setState({...L().Z.state,showTermsAndConditionsError:!1}),J(!0),y().$g({environment:t,emailRequirement:a.emailRequirement});const d=await S().callApi({eventName:"confirmProductPurchase",environment:t,data:{productId:u,listingId:u,address:B,spaceId:oe,allowCreatorToAddToMailingList:W,couponCode:V}});if("failed"===d.type)return J(!1),x().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:"Confirm product purchase failed.",data:{miscDataToConvertToString:{...l,address:B,coupon:V,result:d}}}),void w().UW((0,T().wf)(G,d));let p,m;if(d.data.intentClientSecret){if(await Y.submit(),p=await $.confirmPayment({elements:Y,clientSecret:d.data.intentClientSecret,confirmParams:{return_url:window.location.href,expand:["amount"]},redirect:"if_required"}),void 0!==p.error)o=p.error,m="Stripe confirm payment error";else if("requires_action"===p.paymentIntent.status){const e=await $.handleNextAction({clientSecret:p.paymentIntent.client_secret??""});void 0!==e.error&&(o=e.error,m="Stripe handle next action error")}void 0!==o&&void 0!==m&&(x().log({level:"error",from:"marketplacePaymentContent.onSubmit",type:m,data:{miscDataToConvertToString:{...l,error:o}}}),w().UW(G.formatMessage(ge.paymentError,{error:(0,M().translateStripeError)(t,G,o)})),J(!1))}y().JC({environment:t,success:void 0===o,emailRequirement:a.emailRequirement,transactionValue:null===(n=p)||void 0===n||null===(n=n.paymentIntent)||void 0===n?void 0:n.amount,error:o})}),[$,Y,s,B,oe,q,a.emailRequirement,W,t,u,de,U,G,V,O,N,c,F,X,Q,H]),ue=(0,o.useMemo)((()=>(0,I().Ds)(ce,2e3,{leading:!0,trailing:!1})),[ce]),pe=async e=>{if(!Y||s)return;const a=function(e){return{zipCode:e.postal_code??"",country:e.country??"",addressLine1:e.line1??"",city:e.city??"",state:e.state??""}}(e.value.address);I().Xy(a,B)||((0,h().A)(a)&&l?await y().bF({environment:t,acquisitionId:c,address:a,elements:Y}):L().Z.setState({...L().Z.state,address:a,isTaxValid:!1,isCalculatingTax:!1}))};return ie?(0,R.jsx)(xe,{displayInformation:a,alreadyOwned:s,onAddressChange:pe,contacts:p??[],setIsPaymentElementComplete:ee,isPaying:X,listingId:u,acquisitionId:c,price:l??0,onSubmit:ue,isTCCheckboxEnabled:N}):(0,R.jsxs)("div",{style:te.contentContainer,children:[s?null:(0,R.jsx)(K,{onAddressChange:pe,contacts:p??[],setIsPaymentElementComplete:ee,isPaying:X}),(0,R.jsx)(le,{acquisitionId:c,displayInformation:a,alreadyOwned:s,price:l??0,isPaying:X,onSubmit:ue,productListingId:u,isTCCheckboxEnabled:N})]})}function he(){const{isMobileWidth:e,isTabletWidth:t,isLowResolutionTabletWidth:a}=(0,p().EQ)(),n=(0,r().Fy)().isMobile?e||t:e||a;return(0,s().yK)((e=>({contentContainer:{display:"flex",gap:32,flexDirection:n?"column":"row"},mobileContentContainer:{position:"sticky",bottom:-40,display:"flex",flexDirection:"column",gap:8,background:e.popoverBackground,borderTop:"1px solid lightgray",paddingTop:16,minHeight:124}})),[n])}function xe(e){const{displayInformation:t,alreadyOwned:a,onAddressChange:n,contacts:o,setIsPaymentElementComplete:r,isPaying:i,listingId:s,acquisitionId:l,price:d,onSubmit:c,isTCCheckboxEnabled:u}=e,p=he();return(0,R.jsxs)("div",{style:p.contentContainer,children:[(0,R.jsx)(F,{productInformation:t}),a?null:(0,R.jsx)(K,{onAddressChange:n,contacts:o??[],setIsPaymentElementComplete:r,isPaying:i}),(0,R.jsx)(de,{productListingId:s,acquisitionId:l,price:d??0,isPaying:i}),(0,R.jsx)(ce,{displayInformation:t,listingId:s,isTCCheckboxEnabled:u}),(0,R.jsx)("div",{style:p.mobileContentContainer,children:(0,R.jsx)(pe,{onSubmit:c,price:d??0,isPaying:i})})]})}function ve(){const e=(0,r().O7)(),t=(0,d().YB)(),a=(0,s().yK)((()=>({modalContentContainer:{minHeight:400,maxHeight:850,display:"flex",padding:"32px",flexDirection:"column",gap:24,borderRadius:12,position:"relative",overflow:"auto"},headingContainer:{display:"flex",flexDirection:"column",gap:2}})),[]),o=(0,n().useElements)(),h=(0,r().Fy)().isMobile,x=(0,i().VK)((()=>{var e;return null===(e=m().default.state.currentSpaceStore)||void 0===e?void 0:e.getName()}),[]),v=(0,g().W)(),b=(0,i().VK)((()=>f().Z.state.marketplaceListingId),[]),[k]=(0,l().r5)((async()=>{if(!v||!o)return;if(!b||!(0,c().e)(b))return;const a=await y().X4({environment:e,listingId:b,spaceId:v,intl:t});if(a&&(f().Z.setState({...f().Z.state,creatorId:a.creatorId,customerId:a.customerId}),y().Tz({environment:e,emailRequirement:a.displayInformation.emailRequirement})),a&&!a.alreadyOwned&&0!==a.contacts.length&&a.acquisitionId){const t=a.contacts[0],n={zipCode:t.address.postal_code??"",country:t.address.country??"",addressLine1:t.address.line1??"",city:t.address.city??"",state:t.address.state??""};await y().bF({environment:e,elements:o,address:n,acquisitionId:a.acquisitionId})}return a}),[v,e,b,t,o]),C=k.value;if(!b||!(0,c().e)(b))return null;if(!C)return null;const{displayInformation:I,alreadyOwned:S,acquisitionId:w}=C,T=C.alreadyOwned?void 0:C.price,A=C.alreadyOwned?void 0:C.contacts;return(0,R.jsxs)("div",{style:a.modalContentContainer,children:[(0,R.jsxs)("div",{style:a.headingContainer,children:[(0,R.jsx)(u().q,{styleName:"UITitle-26px/Bold",colorName:"primary",children:(0,R.jsx)(d()._H,{id:"inApp.marketplace.checkout.modal.header",defaultMessage:"Checkout"})}),void 0!==x&&(0,R.jsx)(u().q,{styleName:"UIHeader-17px/Regular",colorName:"secondary",children:h?(0,R.jsx)(d()._H,{id:"inApp.marketplace.checkout.modal.mobile.subheader",defaultMessage:"This template will be added to your Private space within {spaceName}",values:{spaceName:x}}):(0,R.jsx)(d()._H,{id:"inApp.marketplace.checkout.modal.subheader",defaultMessage:"This template is being added to {spaceName}",values:{spaceName:x}})})]}),(0,R.jsx)(p().PT,{throttle:100,lowResolutionTabletUpperBound:760,children:(0,R.jsx)(fe,{listingId:b,displayInformation:I,acquisitionId:w,alreadyOwned:S,price:T,contacts:A})})]})}},374327:(e,t,a)=>{a.d(t,{IK:()=>i,nr:()=>s,o3:()=>r});var n=()=>a(948505),o=()=>a(38812);function r(e){const{taxAmount:t,price:a,currencyValue:o}=e,r=new(n().n)(o,t);return new(n().n)(o,a).plus(r)}function i(e,t){return{appearance:(0,o().getStripeAppearanceV2)(e),mode:"payment",currency:"usd",amount:1e3,paymentMethodTypes:["card"],setupFutureUsage:"on_session",locale:(0,o().stripeElementLocaleGivenNotionLocale)(t)}}function s(e){return"card"===e||"google_pay"===e||"apple_pay"===e}},602422:(e,t,a)=>{a.d(t,{d:()=>r});var n=()=>a(219727),o=()=>a(142735);function r(){const e=(0,n().O7)();return(0,o().VK)((()=>{const{RouterStore:t}=e;return t.state.route}),[e])}},177116:(e,t,a)=>{a.d(t,{Z:()=>o});class n extends(()=>a(263184))().default{getInitialState(){return{address:{addressLine1:"",city:"",state:"",country:"",zipCode:""},allowCreatorToAddToMailingList:!1,allowCreatorToAddToMailingListError:!1,taxAmount:0,taxAmountWithDiscount:0,discountedPrice:void 0,discount:void 0,coupon:"",agreedToTermsAndConditions:!1,showTermsAndConditionsError:!1,isCouponInvalid:!1,isCouponApplied:!1,isCalculatingTax:!1,isTaxValid:!1,invalidCouponReason:"",paymentType:"card"}}}const o=new n},518172:(e,t,a)=>{a.d(t,{Z:()=>o});class n extends(()=>a(263184))().default{getInitialState(){return{isModalOpen:!1,marketplaceListingId:"",teamStore:void 0,hasSuccessfullyPurchasedProduct:!1,templateId:"",creatorId:"",customerId:""}}}const o=new n},851898:(e,t,a)=>{a.d(t,{Z:()=>o});class n extends(()=>a(263184))().default{getInitialState(){return{duplicationStatus:null}}}const o=new n},38812:(e,t,a)=>{a.r(t),a.d(t,{getStripe:()=>k,getStripeAppearanceV2:()=>w,injectStripe:()=>b,optionalPaymentMethodIdGivenPaymentData:()=>A,optionalStripeTokenGivenPaymentData:()=>T,stripeElementLocaleGivenNotionLocale:()=>C,translateStripeError:()=>S,useElementsOptions:()=>I});var n=()=>a(629756),o=()=>a(797894),r=a(667294),i=()=>a(219727),s=()=>a(142735),l=()=>a(846550),d=()=>a(578292);var c=()=>a(989478),u=()=>a(320080),p=()=>a(696459),m=()=>a(707513),y=()=>a(979614),g=()=>a(205228),f=()=>a(876822),h=()=>a(749826),x=a(785893);let v=null;function b(e){return function(t){const[a]=r.useState(k);return(0,x.jsx)(n().Elements,{stripe:a,children:(0,x.jsx)(n().ElementsConsumer,{children:a=>{let{stripe:n,elements:o}=a;const r={...t,stripe:n,elements:o};return(0,x.jsx)(e,{...r})}})})}}async function k(){return v||(o().loadStripe.setLoadParameters({advancedFraudSignals:!1}),v=(0,o().loadStripe)(g().default.stripe.key)),v}function C(e){switch(e){case"en-US":return"en";case"ko-KR":return"ko";case"ja-JP":return"ja";case"fr-FR":return"fr-FR";case"de-DE":return"de";case"es-ES":return"es-ES";case"es-LA":return"es-419";case"pt-BR":return"pt-BR";case"zh-CN":return"zh";case"zh-TW":return"zh-TW";case"da-DK":return"da";case"nl-NL":return"nl";case"fi-FI":return"fi";case"nb-NO":return"nb";case"sv-SE":return"sv";default:return"auto"}}function I(e){const t=(0,l().Fg)(),a=(0,i().O7)(),{type:n}=e,o="setup"===n||"subscription"===n?e.currency:void 0,m="subscription"===n?e.amount:void 0,y=(0,s().VK)((()=>{var e;return(null===(e=f().default.state)||void 0===e||null===(e=e.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.preferred_locale)||d().al}),[]),g=(0,s().VK)((()=>"KRW"===o&&function(e){const{experimentService:t,actor:a}=e;return t.checkGate({actor:a,gateName:"kr_card_payment_method"})}({experimentService:h().default,actor:{table:c().KJ,id:a.currentUser.id??""}})),[a.currentUser,o]);return(0,r.useMemo)((()=>{const e={appearance:w(t),locale:C(y)},a={paymentMethodTypes:(0,u().Rb)({currency:o,isKrCardFeatureGateEnabled:g})};switch(n){case"address":return e;case"setup":return{...e,...a,currency:null==o?void 0:o.toLowerCase(),mode:"setup",paymentMethodCreation:"manual"};case"subscription":return{...e,...a,amount:m,currency:null==o?void 0:o.toLowerCase(),mode:"subscription",paymentMethodCreation:"manual",setupFutureUsage:"off_session"};default:(0,p().t1)(n)}}),[t,y,n,o,m,g])}function S(e,t,a){if(!a.code)return a.message||"";switch(y()._q(e,{error:a.code,stripe_decline_code:a.decline_code}),a.code){case"invalid_expiry_year_past":return t.formatMessage({id:"stripeHelpers.invalidExpiryYear.error.message",defaultMessage:"Your card's expiration year is in the past."});case"invalid_cvc":return t.formatMessage({id:"stripeHelpers.invalidCVC.error.message",defaultMessage:"Your card's security code is invalid."});case"invalid_number":return t.formatMessage({id:"stripeHelpers.invalidNumber.error.message",defaultMessage:"Your card number is not a valid credit card number."});case"card_declined":return function(e,t){switch(t){case"expired_card":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.expiredCard",defaultMessage:"Your card was declined because it is an expired card."});case"incorrect_number":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.incorrectNumber",defaultMessage:"Your card was declined because you input an incorrect number."});case"insufficient_funds":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.declinedFunds",defaultMessage:"Your card was declined because of insufficient funds."});case"invalid_cvc":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.invalidCvc",defaultMessage:"Your card was declined because you input an invalid CVC number"});case"invalid_amount":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.invalidAmount",defaultMessage:"Your card was declined because payment amount exceeds the amount that's allowed."});default:return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message",defaultMessage:"Your card was declined."})}}(t,a.decline_code);default:return a.message||""}}function w(e){return{labels:"floating",theme:"dark"===e.mode?"night":"stripe",variables:{spacingGridRow:"8px",spacingGridColumn:"8px",spacingUnit:"4px",spacingTab:"4px",colorPrimary:e.text.primary,colorPrimaryText:e.text.primary,colorText:e.text.primary,colorTextSecondary:e.text.secondary,colorTextPlaceholder:e.text.tertiary,colorIcon:e.text.primary,colorIconCheckmark:e.icon.contrast,colorDanger:e.text.uiRedPrimary,colorBackground:e.whiteButtonBackground,colorIconTabHover:e.text.primary,colorIconTabSelected:e.text.uiBluePrimary,colorIconChevronDown:e.text.primary,fontFamily:m().Gl.sans,fontWeightLight:`${m().Ue.light}`,fontWeightNormal:`${m().Ue.regular}`,fontWeightMedium:`${m().Ue.medium}`,fontWeightBold:`${m().Ue.semibold}`,fontSizeBase:"14px",fontSizeSm:"12px",colorLogo:e.mode,colorLogoBlock:e.mode,colorLogoTab:e.mode,colorLogoTabSelected:e.mode,borderRadius:"6px"},rules:{".Tab":{padding:"10px 16px 10px 10px",fontSize:"13px",fontWeight:"510",lineHeight:"16px",color:e.text.primary,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",backgroundColor:e.whiteButtonBackground},".Tab:hover":{backgroundColor:e.whiteButtonHoveredBackground,color:e.text.primary},".Tab:focus":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:e.outlineBlueInputBoxShadow},".Tab--selected, .Tab--selected:hover, .Tab--selected:active":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.uiBluePrimary}`,color:e.text.primary,boxShadow:"none",outline:"none"},".Tab--selected:focus":{border:`1px solid ${e.stroke.uiBluePrimary}`,boxShadow:e.outlineBlueInputBoxShadow},".Input":{fontSize:"14px",lineHeight:"18px",letterSpacing:"-0.154px",padding:"4px 8px",boxShadow:"none",backgroundColor:e.surface.wash,border:`1px solid ${e.stroke.primary}`,color:e.text.primary},".Input--invalid":{border:"none",color:e.text.primary,boxShadow:e.outlineRedInputBoxShadow},".Label":{fontSize:"14px",lineHeight:"18px",letterSpacing:"-0.154px",color:e.text.tertiary},".Label--floating":{fontSize:"10px",fontWeight:"510",lineHeight:"13px",letterSpacing:"0.12px",marginTop:"4px",transition:"all 200ms ease",color:e.text.secondary},".Error":{fontSize:"12px",fontWeight:"400",lineHeight:"15px",color:e.text.uiRedPrimary},".CodeInput":{backgroundColor:e.surface.wash,border:`1px solid ${e.stroke.primary}`,boxShadow:"none"},".PickerItem, .PickerItem--selected":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",color:e.text.primary},".PickerItem:hover, .PickerItem--selected:hover":{backgroundColor:e.whiteButtonHoveredBackground,color:e.text.primary,border:`1px solid ${e.stroke.primary}`,boxShadow:"none"},".PickerItem--new":{fontSize:"14px",fontWeight:"500",lineHeight:"18px",color:e.text.primary},".PickerItem--highlight, .PickerItem--highlight:hover":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.uiBluePrimary}`,boxShadow:"none"},".PickerItem--highlight:hover":{backgroundColor:e.whiteButtonHoveredBackground},".TermsText":{color:e.text.secondary,fontSize:"12px",fontWeight:"400",lineHeight:"15px"},".CheckboxLabel":{color:e.text.primary,fontSize:"12px",fontWeight:"500",lineHeight:"15px"},".Action, .MenuAction":{color:e.text.primary,fontWeight:"400"},".Action:hover, .MenuAction:hover":{backgroundColor:e.buttonHoveredBackground},".BlockAction:focus, .CodeInput:focus, .Input:focus,.CheckboxInput:focus, .PickerItem:focus, .PickerAction:focus,.MenuAction:focus, .Action:focus, .SecondaryLink:focus":{boxShadow:e.outlineBlueInputBoxShadow},".MenuIcon, .MenuIcon:hover":{fill:e.text.primary},".Block":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",color:e.text.primary}}}}function T(e){return"stripeToken"===(null==e?void 0:e.type)?e.value:void 0}function A(e){return"paymentMethodId"===(null==e?void 0:e.type)?e.value:void 0}},793331:(e,t,a)=>{a.d(t,{W:()=>r});a(667294);var n=()=>a(948505),o=a(785893);function r(e){const{cost:t,intl:a}=e,r=e.trailingZeroDisplay??"auto",i=e.currencySign??"accounting",s=n().n.fromValue(t);let l=a.formatNumber(s.amount/Math.pow(10,s.currencyValue.minorUnitDigits),{style:"currency",currency:s.currencyCode,currencyDisplay:"symbol",currencySign:i});return"stripIfInteger"===r&&(l=l.replace(new RegExp(`[.,]0{${s.currencyValue.minorUnitDigits}}(\\s+.*)?$`),"$1")),(0,o.jsx)(o.Fragment,{children:l})}},848297:(e,t,a)=>{a.d(t,{V:()=>n});const n=(0,a(827282).CZ)("checkStack",{default:{loader:()=>a.e(63543).then(a.bind(a,263543))},small:{loader:()=>a.e(6141).then(a.bind(a,606141))},mini:{loader:()=>a.e(3725).then(a.bind(a,3725))},large:{loader:()=>a.e(65389).then(a.bind(a,465389))}})}}]);