"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[45953],{745953:(t,e,a)=>{a.d(e,{diagram:()=>w});var r=()=>a(894205),i=()=>a(268250),n=()=>a(3855),d=()=>a(632979),o=0,s=(0,n().eW)((function(t,e,a,r,s){const l=(0,n().eW)((function(t){switch(t){case s.db.relationType.AGGREGATION:return"aggregation";case s.db.relationType.EXTENSION:return"extension";case s.db.relationType.COMPOSITION:return"composition";case s.db.relationType.DEPENDENCY:return"dependency";case s.db.relationType.LOLLIPOP:return"lollipop"}}),"getRelationType");e.points=e.points.filter((t=>!Number.isNaN(t.y)));const p=e.points,c=(0,d().jvg)().x((function(t){return t.x})).y((function(t){return t.y})).curve(d().$0Z),g=t.append("path").attr("d",c(p)).attr("id","edge"+o).attr("class","relation");let h,f,x="";r.arrowMarkerAbsolute&&(x=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,x=x.replace(/\(/g,"\\("),x=x.replace(/\)/g,"\\)")),1==a.relation.lineType&&g.attr("class","relation dashed-line"),10==a.relation.lineType&&g.attr("class","relation dotted-line"),"none"!==a.relation.type1&&g.attr("marker-start","url("+x+"#"+l(a.relation.type1)+"Start)"),"none"!==a.relation.type2&&g.attr("marker-end","url("+x+"#"+l(a.relation.type2)+"End)");const y=e.points.length;let u,w,b,m,k=i().w8.calcLabelPosition(e.points);if(h=k.x,f=k.y,y%2!=0&&y>1){let t=i().w8.calcCardinalityPosition("none"!==a.relation.type1,e.points,e.points[0]),r=i().w8.calcCardinalityPosition("none"!==a.relation.type2,e.points,e.points[y-1]);n().cM.debug("cardinality_1_point "+JSON.stringify(t)),n().cM.debug("cardinality_2_point "+JSON.stringify(r)),u=t.x,w=t.y,b=r.x,m=r.y}if(void 0!==a.title){const e=t.append("g").attr("class","classLabel"),i=e.append("text").attr("class","label").attr("x",h).attr("y",f).attr("fill","red").attr("text-anchor","middle").text(a.title);window.label=i;const n=i.node().getBBox();e.insert("rect",":first-child").attr("class","box").attr("x",n.x-r.padding/2).attr("y",n.y-r.padding/2).attr("width",n.width+r.padding).attr("height",n.height+r.padding)}if(n().cM.info("Rendering relation "+JSON.stringify(a)),void 0!==a.relationTitle1&&"none"!==a.relationTitle1){t.append("g").attr("class","cardinality").append("text").attr("class","type1").attr("x",u).attr("y",w).attr("fill","black").attr("font-size","6").text(a.relationTitle1)}if(void 0!==a.relationTitle2&&"none"!==a.relationTitle2){t.append("g").attr("class","cardinality").append("text").attr("class","type2").attr("x",b).attr("y",m).attr("fill","black").attr("font-size","6").text(a.relationTitle2)}o++}),"drawEdge"),l=(0,n().eW)((function(t,e,a,r){n().cM.debug("Rendering class ",e,a);const i=e.id,d={id:i,label:e.id,width:0,height:0},o=t.append("g").attr("id",r.db.lookUpDomId(i)).attr("class","classGroup");let s;s=e.link?o.append("svg:a").attr("xlink:href",e.link).attr("target",e.linkTarget).append("text").attr("y",a.textHeight+a.padding).attr("x",0):o.append("text").attr("y",a.textHeight+a.padding).attr("x",0);let l=!0;e.annotations.forEach((function(t){const e=s.append("tspan").text("«"+t+"»");l||e.attr("dy",a.textHeight),l=!1}));let c=p(e);const h=s.append("tspan").text(c).attr("class","title");l||h.attr("dy",a.textHeight);const f=s.node().getBBox().height;let x,y,u;if(e.members.length>0){x=o.append("line").attr("x1",0).attr("y1",a.padding+f+a.dividerMargin/2).attr("y2",a.padding+f+a.dividerMargin/2);const t=o.append("text").attr("x",a.padding).attr("y",f+a.dividerMargin+a.textHeight).attr("fill","white").attr("class","classText");l=!0,e.members.forEach((function(e){g(t,e,l,a),l=!1})),y=t.node().getBBox()}if(e.methods.length>0){u=o.append("line").attr("x1",0).attr("y1",a.padding+f+a.dividerMargin+y.height).attr("y2",a.padding+f+a.dividerMargin+y.height);const t=o.append("text").attr("x",a.padding).attr("y",f+2*a.dividerMargin+y.height+a.textHeight).attr("fill","white").attr("class","classText");l=!0,e.methods.forEach((function(e){g(t,e,l,a),l=!1}))}const w=o.node().getBBox();var b=" ";e.cssClasses.length>0&&(b+=e.cssClasses.join(" "));const m=o.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",w.width+2*a.padding).attr("height",w.height+a.padding+.5*a.dividerMargin).attr("class",b).node().getBBox().width;return s.node().childNodes.forEach((function(t){t.setAttribute("x",(m-t.getBBox().width)/2)})),e.tooltip&&s.insert("title").text(e.tooltip),x&&x.attr("x2",m),u&&u.attr("x2",m),d.width=m,d.height=w.height+a.padding+.5*a.dividerMargin,d}),"drawClass"),p=(0,n().eW)((function(t){let e=t.id;return t.type&&(e+="<"+(0,n().UO)(t.type)+">"),e}),"getClassTitleString"),c=(0,n().eW)((function(t,e,a,r){n().cM.debug("Rendering note ",e,a);const i=e.id,d={id:i,text:e.text,width:0,height:0},o=t.append("g").attr("id",i).attr("class","classGroup");let s=o.append("text").attr("y",a.textHeight+a.padding).attr("x",0);const l=JSON.parse(`"${e.text}"`).split("\n");l.forEach((function(t){n().cM.debug(`Adding line: ${t}`),s.append("tspan").text(t).attr("class","title").attr("dy",a.textHeight)}));const p=o.node().getBBox(),c=o.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",p.width+2*a.padding).attr("height",p.height+l.length*a.textHeight+a.padding+.5*a.dividerMargin).node().getBBox().width;return s.node().childNodes.forEach((function(t){t.setAttribute("x",(c-t.getBBox().width)/2)})),d.width=c,d.height=p.height+l.length*a.textHeight+a.padding+.5*a.dividerMargin,d}),"drawNote"),g=(0,n().eW)((function(t,e,a,r){const{displayText:i,cssStyle:n}=e.getDisplayDetails(),d=t.append("tspan").attr("x",r.padding).text(i);""!==n&&d.attr("style",e.cssStyle),a||d.attr("dy",r.textHeight)}),"addTspan"),h={getClassTitleString:p,drawClass:l,drawEdge:s,drawNote:c},f={},x=(0,n().eW)((function(t){const e=Object.entries(f).find((e=>e[1].label===t));if(e)return e[0]}),"getGraphId"),y=(0,n().eW)((function(t){t.append("defs").append("marker").attr("id","extensionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),t.append("defs").append("marker").attr("id","extensionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z"),t.append("defs").append("marker").attr("id","compositionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","compositionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")}),"insertMarkers"),u={draw:(0,n().eW)((function(t,e,r,i){const o=(0,n().nV)().class;f={},n().cM.info("Rendering diagram "+t);const s=(0,n().nV)().securityLevel;let l;"sandbox"===s&&(l=(0,d().Ys)("#i"+e));const p="sandbox"===s?(0,d().Ys)(l.nodes()[0].contentDocument.body):(0,d().Ys)("body"),c=p.select(`[id='${e}']`);y(c);const g=new(a(645625).k)({multigraph:!0});g.setGraph({isMultiGraph:!0}),g.setDefaultEdgeLabel((function(){return{}}));const u=i.db.getClasses(),w=[...u.keys()];for(const a of w){const t=u.get(a),e=h.drawClass(c,t,o,i);f[e.id]=e,g.setNode(e.id,e),n().cM.info("Org height: "+e.height)}i.db.getRelations().forEach((function(t){n().cM.info("tjoho"+x(t.id1)+x(t.id2)+JSON.stringify(t)),g.setEdge(x(t.id1),x(t.id2),{relation:t},t.title||"DEFAULT")}));i.db.getNotes().forEach((function(t){n().cM.debug(`Adding note: ${JSON.stringify(t)}`);const e=h.drawNote(c,t,o,i);f[e.id]=e,g.setNode(e.id,e),t.class&&u.has(t.class)&&g.setEdge(t.id,x(t.class),{relation:{id1:t.id,id2:t.class,relation:{type1:"none",type2:"none",lineType:10}}},"DEFAULT")})),(0,a(388749).bK)(g),g.nodes().forEach((function(t){void 0!==t&&void 0!==g.node(t)&&(n().cM.debug("Node "+t+": "+JSON.stringify(g.node(t))),p.select("#"+(i.db.lookUpDomId(t)||t)).attr("transform","translate("+(g.node(t).x-g.node(t).width/2)+","+(g.node(t).y-g.node(t).height/2)+" )"))})),g.edges().forEach((function(t){void 0!==t&&void 0!==g.edge(t)&&(n().cM.debug("Edge "+t.v+" -> "+t.w+": "+JSON.stringify(g.edge(t))),h.drawEdge(c,g.edge(t),g.edge(t).relation,o,i))}));const b=c.node().getBBox(),m=b.width+40,k=b.height+40;(0,n().v2)(c,k,m,o.useMaxWidth);const M=`${b.x-20} ${b.y-20} ${m} ${k}`;n().cM.debug(`viewBox ${M}`),c.attr("viewBox",M)}),"draw")},w={parser:r().P0,db:r().pl,renderer:u,styles:r().Ee,init:(0,n().eW)((t=>{t.class||(t.class={}),t.class.arrowMarkerAbsolute=t.arrowMarkerAbsolute,r().pl.clear()}),"init")}}}]);