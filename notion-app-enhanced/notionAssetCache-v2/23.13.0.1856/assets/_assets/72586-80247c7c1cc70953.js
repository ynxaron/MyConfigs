"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[72586,81317],{491585:(e,t,o)=>{o.r(t),o.d(t,{loadWorkflowTemplateInstances:()=>c});o(670560),o(241792);var n=()=>o(494616),r=()=>o(696459),i=()=>o(826955);const l=!1;function c(e){const t=[];let o=!1;e.isDefined()||(o=!0);const c=e=>{var n;if(!e.isDefined())return void(o=!0);const r=null===(n=e.getProperties())||void 0===n?void 0:n.workflow_template_instance;r&&t.push({instancePointer:{type:"automation",id:e.id,spaceId:e.getSpaceId()},templateId:r.template_id})},a=e.getFormat().workflow_template_instance,p=e.getParentBlockStore();if(null==p||!p.isDefined())return{isLoading:!0,instances:[]};a&&t.push({instancePointer:{type:"collection",id:e.id},templateId:a.template_id});const s=p.getCollectionViewStores()??[];for(const n of s){if(!n.isDefined()){o=!0;continue}const e=n.getFormat().workflow_template_instance;e&&t.push({instancePointer:{type:"collection_view",id:n.id},templateId:e.template_id})}const d=e.getLayoutStore();if(d)if(d.isDefined()){var u;const e=null===(u=d.getFormat())||void 0===u?void 0:u.workflow_template_instance;e&&t.push({instancePointer:{type:"layout",id:d.id,spaceId:d.getSpaceId()},templateId:e.template_id})}else o=!0;const m=e.getTemplatePageStores();for(const n of m){const e=n.getModel();if(!e){o=!0;continue}if(!e.isPageBlock())continue;const r=e.getFormat().workflow_template_instance;r&&t.push({instancePointer:{type:"block",id:e.id,spaceId:e.getSpaceId()},templateId:r.template_id});const i=n.getAutomationStore();i&&c(i)}const f=e.getAutomationStores();for(const n of f)c(n);const y=e.getSpaceId(),g=e.getSchema();for(const[r,l]of Object.entries(g)){if(!l)continue;const o=l.workflow_template_instance;if(o&&t.push({instancePointer:{type:"property",id:r,collectionId:e.id},templateId:o.template_id}),"button"===l.type&&l.automation_id){c(i().Mz.createChildStore(e,{id:l.automation_id,spaceId:y,table:n().cv}))}}const v=e.getFormat().compound_workflow_template_instances??[];for(const n of v)t.push({instancePointer:{type:"compound",id:n.id,collectionId:e.id,instancePointers:n.instance_pointers.map((t=>{switch(t.type){case"automation":return{type:"automation",id:t.id,spaceId:y};case"block":return{type:"block",id:t.id,spaceId:y};case"collection_view":return{type:"collection_view",id:t.id};case"layout":return{type:"layout",id:t.id,spaceId:y};case"property":return{type:"property",id:t.id,collectionId:e.id}}(0,r().t1)(t)}))},templateId:n.template_id});return l&&console.log("loadWorkflowTemplateInstances: loaded workflow template instances for collection:",e.id,"isLoading:",o,"instances:",t),{isLoading:o,instances:t}}},281236:(e,t,o)=>{o.r(t),o.d(t,{TRUNCATE_COLLECTION_TEMPLATE_ITEMS_AT:()=>L,WorkflowTemplateLogger:()=>S,appendToAiGeneratedTemplates:()=>M,getChildCollectionStoreByTemplateId:()=>N,getCollectionTemplateFromId:()=>H,getIsSetupGeneratorEnabled:()=>G,getPropertyTemplates:()=>B,getSelectedFeatureTemplateIds:()=>A,getSuggestedCollectionTemplates:()=>U,getSuggestedTemplates:()=>j,getTemplatesInCompoundTemplate:()=>F,getWorkflowTemplateItemsCaption:()=>$,getWorkflowTemplateName:()=>E,globalWorkflowTemplates:()=>k,isCollectionTemplateParentStore:()=>P,remapPropertyIds:()=>O,setDynamicBuilderWorkflowTemplates:()=>R,shouldShowInSuggestedProperties:()=>q,useCaseByCollectionTemplateCategory:()=>z});o(821057),o(670560),o(122556),o(582845),o(250570),o(533019),o(721473),o(788208),o(22624),o(267602),o(916054),o(653476),o(470928),o(241792);var n=()=>o(780741),r=()=>o(926931),i=()=>o(353329),l=()=>o(731424),c=()=>o(712198),a=()=>o(217465),p=()=>o(827370),s=()=>o(752778),d=()=>o(255933),u=()=>o(955620),m=()=>o(513670),f=()=>o(696459),y=()=>o(887430),g=()=>o(982855),v=()=>o(527278),I=()=>o(852465),h=()=>o(749826),w=()=>o(826955),T=()=>o(877727),b=()=>o(382474);const _=(0,o(788860).vU)({untitled:{id:"workflowTemplates.untitled",defaultMessage:"Untitled"}});class S{log(e){0}warn(e){0}debug(e){false}}function P(e){return e instanceof w().zX||e instanceof w().H2||e instanceof w().G}const k=new(i().ni)((e=>{const t=h().default.checkGate({gateName:"packaging_m2_additional_entrypoints"}),o=h().default.checkGate({gateName:"packaging_m2_localize_templates"}),r=v().Z.getIntl(),i=[...C.builderTemplates,...(0,n().i1)(r,{includeAutomationsInCollections:t,localizeTemplates:o}),...Object.values(C.aiGeneratedTemplates)].find((t=>t.templateId===e));if(!i)throw new Error(`Template not found for ${e}`);return i})),C={aiGeneratedTemplates:{},builderTemplates:[]};function M(e){for(const t of e)C.aiGeneratedTemplates[t.templateId]=t}function R(e){let{templates:t,intl:o,shouldFakeLocalization:n}=e;C.builderTemplates=(0,r().Uo)({},o,t,{shouldFakeLocalization:n,strict:!1})}function O(e){let{collectionStore:t,dependencyMap:o,object:n}=e;(0,i().DY)({object:n,callback:e=>function(e){let{collectionStore:t,dependencyMap:o,objectWithProperty:n}=e;const r=n.property,i=(0,b().Zl)({collectionStore:t,sourceTemplateType:"property",sourcePrimitiveId:r,dependencyMap:o});n.property=i}({collectionStore:t,dependencyMap:o,objectWithProperty:e})})}const W=3;function $(e){if(0===e.length)return;const t=e.slice(0,W),o=e.length-t.length,n=t.join(", ");return o>0?`${n}, ${o}+`:n}function j(e,t){return function(e){const t=new Set(e.map((e=>e.templateId))),o=[];for(const n of e)o.push(...D(n).filter((e=>!t.has(e))).map((e=>k.fromId(e))).filter(i().iI).filter((e=>"control"===(0,T().D)()||!(0,i().yw)(e))));return o}((0,b().Bs)(e,t))}function D(e){return"compound"===e.type||"collection"===e.type?e.value.templateItems.filter((e=>"optionalDefaultOn"===e.optionality||"optionalDefaultOff"===e.optionality)).map((e=>e.pointer)):[]}function E(e){const{type:t}=e;switch(t){case"collection_view":return e.value.name??v().Z.formatMessage(y().b1[e.value.type]);case"property":return e.value.name;case"collection":return e.value.targetCollection.name;case"layout":case"compound":return e.name;case"block":const o=a().RecordMap.create(e.value.recordMap),n=o.getModel(e.value.blockPointer);return n?(0,u().QaF)(n.getRenderTitleTextValue({getRecordModel:c().o.fromRecordMap(o)})):v().Z.formatMessage(_.untitled);case"automation":return e.value.name??(0,l().XO)(v().Z.getIntl());default:(0,f().t1)(t)}}function A(e){return e.featureTemplateSelections.filter((e=>e.selected)).map((e=>e.template.templateId))}function N(e){let{environment:t,parentStore:o,collectionTemplateId:n}=e;const r=o.getSpaceId();if(!r)throw new Error(`Space ID not found for ${o}`);const i=new(w().H2)(t,{table:d().bx,id:r}),l=(0,b().f4)({environment:t,spaceStore:i,templateId:n});for(const a of l){var c;const e=new(w().NW)(t,{table:s().vF,id:a.id}),n=null===(c=e.getParentBlockStore())||void 0===c?void 0:c.getParentPointer();if(n&&p().dr.isEqual(n,o.pointer))return e}}function F(e){const t=e.value.templateItems.map((e=>k.fromId(e.pointer))),o=[];for(const n of t){if(!(0,i().qu)(n))throw new Error(`Invalid template "${n.templateId}" in compound template "${e.templateId}"`);o.push(n)}return o}function B(e){const t=[];for(const o of e)"property"===o.type?t.push(o):"compound"===o.type&&t.push(...F(o).filter((e=>(0,i().U2)(e,"property"))));return m().mN(t,(e=>e.templateId))}const L=3;function U(e){let{persona:t,parentStore:o}=e;const r=t&&"personalized"===(0,T().D)()?n().SN[t]:[],i=function(e){let{collectionTemplates:t,parentStore:o}=e;if(!o)return t;if((0,I().Mm)(o))return t;const n=(0,I().Y)(o)?o.getTeamPageStores():o.getContentStores(),r=new Set,i=new Set;for(const p of n){var l;const e=null===(l=p.getCollectionStore())||void 0===l?void 0:l.getWorkflowTemplateId(),t=e&&H(e);t&&(r.add(t.templateId),t.category&&i.add(t.category))}const c=[],a=[];for(const p of t)r.has(p.templateId)||p.category&&i.has(p.category)?c.push(p):a.push(p);return[...a,...c]}({collectionTemplates:[...k.allOfType({templateIds:r??[],type:"collection"}),...k.allOfType({templateIds:n().pA,type:"collection"})],parentStore:o});return m().mN(i,(e=>e.templateId))}function G(e){return!!(0,g().GD)(e)&&h().default.checkGate({gateName:"ai_setup_generator"})}function q(e){return"property"===e.type||"compound"===e.type&&F(e).every((e=>"property"===e.type))}const z={goals:"goals",projects:"project",tasks:"other",docs:"docs",meetings:"notes"};function H(e){try{return k.fromIdOfType({templateId:e,type:"collection"})}catch(t){return}}},382474:(e,t,o)=>{o.d(t,{A5:()=>R,Bs:()=>W,CX:()=>_,Hq:()=>j,OA:()=>B,Vc:()=>w,ZQ:()=>C,Zl:()=>b,_U:()=>F,cb:()=>D,cj:()=>$,f4:()=>k,ip:()=>A,w2:()=>M});o(821057),o(670560),o(267602),o(653476),o(470928),o(749411),o(241792),o(228244);var n=()=>o(29488),r=()=>o(353329),i=()=>o(799891),l=()=>o(494616),c=()=>o(396136),a=()=>o(752778),p=()=>o(139978),s=()=>o(483791),d=()=>o(513670),u=()=>o(696459),m=()=>o(239482),f=()=>o(826955),y=()=>o(999582),g=()=>o(491585),v=()=>o(281236);const I=!1;function h(e){let t;if("collection"===e.table)t=function(e){const t={};for(const o of e){const e=t[o.templateId]??[];e.push(o.instancePointer),t[o.templateId]=e}return t}((0,g().loadWorkflowTemplateInstances)(e).instances);else{const o=(0,n().O)(e.pointer),r=y().Z.getState();t=(null==r?void 0:r[o])??{}}const o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v().globalWorkflowTemplates.fromId;const o={},n=(0,d().HP)((e=>{try{return t(e),!0}catch(o){return!1}}));for(const[r,i]of Object.entries(e))n(r)&&(o[r]=i);return o}(t);return I&&(console.groupCollapsed("getTemplateIdToInstancePointersMap",e.pointer),console.trace(),console.log("Raw map:",t),console.log("Map with invalid template IDs removed:",o),console.groupEnd()),o}function w(e){let{environment:t,collectionStore:o}=e;const n=h(o),r=[];for(const[i,l]of Object.entries(n))for(const e of l)O({environment:t,instancePointer:e,inMemoryRecordCache:o.inMemoryRecordCache})&&r.push({instancePointer:e,templateId:i});return r}const T="dependency_";function b(e){let{collectionStore:t,sourceTemplateType:o,sourcePrimitiveId:n,dependencyMap:r}=e;const i=S({sourceTemplateType:o,sourcePrimitiveId:n,dependencyMap:r});if(!i)return n;const l=P(t,i);if(0===l.length)return`${T}${i}`;return l[l.length-1].id}function _(e){let{collectionStore:t,sourceTemplateType:o,sourcePrimitiveId:n,dependencyMap:r}=e;const i=S({sourceTemplateType:o,sourcePrimitiveId:n,dependencyMap:r});if(!i)return;const l=P(t,i);if(0===l.length)return;return l[l.length-1].id}function S(e){let{sourceTemplateType:t,sourcePrimitiveId:o,dependencyMap:n}=e;if(o.startsWith(T))return o.replace(T,"");return n[(0,r().aJ)(t,o)]}function P(e,t){return h(e)[t]??[]}function k(e){let{environment:t,spaceStore:o,templateId:n}=e;return P(o,n).filter((e=>O({environment:t,instancePointer:e,inMemoryRecordCache:o.inMemoryRecordCache})))}function C(e){let{collectionStore:t,templateId:o,instancePointerType:n}=e;const r=P(t,o);if(0===r.length)return;const i=r[r.length-1];if(i.type!==n)throw new Error(`Expect to find instance pointer type ${n} for template ID ${o} but found ${i.type} instead`);return i}function M(e){let{environment:t,collectionStore:o,templateId:n}=e;return Boolean(R({environment:t,scopeStore:o,templateId:n}))}function R(e){let{environment:t,scopeStore:o,templateId:n}=e;const r=o.pointer,l=P(o,n).filter((e=>O({environment:t,instancePointer:e,inMemoryRecordCache:o.inMemoryRecordCache}))),c=(0,d().mN)(l,(e=>e.id));if(c.length!==l.length){const e=l.map((e=>e.id));i().log({level:"warning",from:"workflowTemplatesInstanceHelpers",type:"duplicateAliveInstancePointers",data:{miscDataToConvertToString:{templateId:n,instanceIds:e}}})}if(0!==c.length)return c.length>1?void i().log({level:"warning",from:"workflowTemplatesInstanceHelpers",type:"moreThanOneAliveInstancePointer",data:{miscDataToConvertToString:{templateId:n,scope:r,uniqueAliveInstancePointers:c}}}):c[0]}function O(e){let{environment:t,instancePointer:o,inMemoryRecordCache:n}=e;if("property"===o.type){const e=new(f().NW)(t,{table:a().vF,id:o.collectionId},{inMemoryRecordCache:n});return Boolean(e.getSchema()[o.id])}if("collection_view"===o.type){const e=new(f().Xr)(t,{table:p().np,id:o.id},{inMemoryRecordCache:n});return Boolean(e.getAlive())}if("collection"===o.type){const e=new(f().NW)(t,{table:a().vF,id:o.id},{inMemoryRecordCache:n});return!(0,m().wf)(e)}if("layout"===o.type){const e=new(f().xj)(t,{table:s().Bh,id:o.id,spaceId:o.spaceId},{inMemoryRecordCache:n});return!(0,m().wf)(e)}if("compound"===o.type)return function(e){let{environment:t,instancePointer:o,inMemoryRecordCache:n}=e;return o.instancePointers.some((e=>O({environment:t,instancePointer:e,inMemoryRecordCache:n})))}({environment:t,instancePointer:o,inMemoryRecordCache:n});if("block"===o.type){const e=new(f().G)(t,{table:c().iU,id:o.id,spaceId:o.spaceId},{inMemoryRecordCache:n});return!(0,m().wf)(e)}if("automation"===o.type){const e=new(f().Mz)(t,{table:l().cv,id:o.id,spaceId:o.spaceId},{inMemoryRecordCache:n});return!(0,m().wf)(e)}(0,u().t1)(o)}function W(e,t){const o=h(t);return Object.keys(o).filter((o=>M({environment:e,collectionStore:t,templateId:o}))).map((e=>v().globalWorkflowTemplates.fromId(e)))}function $(e,t){const o=[],n=h(e);for(const r of Object.values(n))o.push(...r.filter((e=>e.type===t)));return o}function j(e){let{environment:t,collectionStore:o}=e;if(!o)return;const n=w({environment:t,collectionStore:o}).filter((e=>{let{instancePointer:t}=e;return"collection"===t.type&&t.id===o.id}));if(0!==n.length){if(n.length>1)throw new Error(`More than one collection preset templates found for collection ${o.id}`);return v().globalWorkflowTemplates.fromIdOfType({templateId:n[0].templateId,type:"collection"})}}function D(e){const{type:t}=e;return"collection_view"===t||"property"===t||"layout"===t||"compound"===t||"block"===t||"automation"===t}function E(e){let{environment:t,collectionStore:o}=e;return w({environment:t,collectionStore:o}).filter((e=>"compound"===e.instancePointer.type))}function A(e){let{environment:t,collectionStore:o,instancePointerId:n}=e;const r=w({environment:t,collectionStore:o}).find((e=>e.instancePointer.id===n));if(r)return v().globalWorkflowTemplates.featureFromId(r.templateId)}function N(e){let{environment:t,collectionStore:o,propertyId:n}=e;const r=function(e){let{environment:t,collectionStore:o,propertyId:n}=e;return w({environment:t,collectionStore:o}).filter((e=>"property"===e.instancePointer.type&&e.instancePointer.id===n))}({collectionStore:o,environment:t,propertyId:n}),i=E({environment:t,collectionStore:o}).filter((e=>{let{instancePointer:t}=e;return r.some((e=>t.instancePointers.some((t=>t.id===e.instancePointer.id))))}));return{propertyTemplateInstances:r,compoundTemplateInstances:i}}function F(e){let{collectionStore:t,environment:o,propertyId:n}=e;const{propertyTemplateInstances:i,compoundTemplateInstances:l}=N({environment:o,collectionStore:t,propertyId:n}),c=i.map((e=>{let{templateId:t}=e;return v().globalWorkflowTemplates.fromId(t)})).filter((e=>(0,r().U2)(e,"property")));return l.filter((e=>{let{templateId:t}=e;const o=v().globalWorkflowTemplates.fromId(t);if((0,r().U2)(o,"compound"))return c.some((e=>o.value.templateItems.some((t=>t.pointer===e.templateId&&"required"===t.optionality))))}))}function B(e){let{environment:t,collectionStore:o,compoundTemplateInstancesToDelete:n}=e;const r=n.flatMap((e=>e.instancePointer.instancePointers)),i=n.map((e=>e.instancePointer.id)),l=E({environment:t,collectionStore:o}),c=[];for(const a of l)if(!i.includes(a.instancePointer.id))for(const e of a.instancePointer.instancePointers)r.some((t=>t.id===e.id))&&c.push(e);return r.filter((e=>!c.some((t=>t.id===e.id))))}},353329:(e,t,o)=>{o.d(t,{CM:()=>M,DY:()=>S,EL:()=>s,HR:()=>y,IH:()=>b,Js:()=>C,U2:()=>g,Wl:()=>R,Yg:()=>d,Zl:()=>v,aJ:()=>u,dI:()=>w,iI:()=>I,kw:()=>_,ni:()=>m,py:()=>P,qu:()=>h,uC:()=>k,ym:()=>f,yw:()=>T});o(821057),o(670560),o(267602),o(653476),o(241792),o(228244);var n=()=>o(696459),r=()=>o(226413),i=()=>o(578292),l=()=>o(197874),c=()=>o(780741),a=()=>o(191234);const p=!1;function s(e){let{template:t,logger:o}=e;const n=[],r=t.dependencyMap??{},i=e=>{n.push(...Object.values(r).map((t=>({templateId:t,debugSource:e}))))};if("property"===t.type&&"formula"===t.value.type)i("formula");else if("automation"===t.type)i("automation");else if("collection_view"===t.type){const e=d({template:t,dependencyMap:r,logger:o});n.push(...e)}return n}function d(e){var t,o,n,r;let{template:i,dependencyMap:l,logger:c}=e;const a=[],s=(e,t)=>{if(!e)return;const o=l[`property:${e}`];o?a.push({templateId:o,debugSource:t}):c&&c.warn(`Unable to find template mapping for property "${e}" from ${t}`)};if(s(null===(t=i.value.format)||void 0===t||null===(t=t.collection_group_by)||void 0===t?void 0:t.property,"collection_group_by"),s(null===(o=i.value.format)||void 0===o||null===(o=o.board_columns_by)||void 0===o?void 0:o.property,"board_columns_by"),s(null===(n=i.value.query2)||void 0===n?void 0:n.calendar_by,"calendar_by"),s(null===(r=i.value.query2)||void 0===r?void 0:r.timeline_by,"timeline_by"),p)for(const p of(null===(d=i.value.query2)||void 0===d?void 0:d.sort)??[]){var d;s(p.property,"sort")}for(const p of(null===(u=i.value.format)||void 0===u?void 0:u.property_filters)??[]){var u;s(p.filter.property,"filter")}return a}function u(e,t){return`${e}:${t}`}class m{constructor(e){this.fromIdOfType=e=>{const{templateId:t,type:o}=e,n=this.fromId(t);if(n.type!==o)throw new Error(`Expected template type ${o} but got ${n.type}`);return n},this.featureFromId=e=>{const t=this.fromId(e);if(!v(t))throw new Error(`${t.type} is not a feature template`);return t},this.allOfType=e=>{const{templateIds:t,type:o}=e;return t.map((e=>this.fromId(e))).filter((e=>g(e,o)))},this.fromId=e}}function f(e){var t;const{type:o}=e;switch(o){case"property":return e.value.description;case"collection_view":return null===(t=e.value.format)||void 0===t?void 0:t.description;case"collection":case"layout":case"compound":case"block":case"automation":return e.description;default:(0,n().t1)(o)}}function y(e){var t;const{template:o,isPlural:n,isUpperCase:r}=e,{targetCollection:c}=o.value;let a;return a=null!==(t=c.format)&&void 0!==t&&t.item_name_config_v2?(0,l().Tg)({intl:(0,i().vc)(),isPlural:n,itemNameConfigV2:c.format.item_name_config_v2}):n?c.itemName.plural:c.itemName.singular,r?a.charAt(0).toLocaleUpperCase()+a.slice(1):a.toLocaleLowerCase()}function g(e,t){return e.type===t}function v(e){return a().hM.some((t=>t===e.type))}function I(e){return e.type in a().lz}function h(e){return!(!v(e)||"compound"===e.type)}function w(e,t){return e.value.type===t}function T(e){return"property"===e.type&&"relation"===e.value.type&&Boolean(e.relatedCollectionTemplateId)}function b(e){return"property"===e.type&&"button"===e.value.type&&Boolean(e.buttonAutomationId)}function _(e){return(0,r().t)(e.value)}function S(e){let{object:t,callback:o}=e;if(!(0,n().Kn)(t))return;const r=t.property;r&&"string"==typeof r&&"title"!==r&&o(t);for(const n of Object.values(t))S({object:n,callback:o})}const P=["timeline_by","timeline_by_end","calendar_by"];function k(e,t){return e.filter((e=>e.optionality===t)).map((e=>e.pointer))}function C(e){return e.value.templateItems.map((e=>e.pointer))}function M(e){return a().H0.some((t=>t===e))}function R(e){return e===c()._q}}}]);