"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[14733,37554],{636133:(e,t,r)=>{r.d(t,{Ce:()=>i,IC:()=>d,Jv:()=>u,QF:()=>p,Yc:()=>n,az:()=>s,eO:()=>l,s4:()=>c,ti:()=>a});var o=()=>r(594546);function n(e,t){o().K4(e,"workspace_creation_ability",t)}function a(e,t){o().K4(e,"workspace_creation_setting_updated",t)}function i(e,t){o().K4(e,"claimable_spaces_viewed",t)}function s(e,t){o().K4(e,"space_transfer_requested",t)}function c(e,t){o().K4(e,"space_transfer_completed",t)}function l(e,t){o().K4(e,"space_claim_upgrade_requested",t)}function d(e,t){o().K4(e,"space_claim_upgrade_completed",t)}function p(e,t){o().K4(e,"space_claim_deletion_started",t)}function u(e,t){o().K4(e,"space_claim_deletion_canceled",t)}},257185:(e,t,r)=>{r.d(t,{y:()=>o().y});var o=()=>r(949489)},953293:(e,t,r)=>{r.d(t,{R:()=>o().R});var o=()=>r(519454)},70662:(e,t,r)=>{r.r(t),r.d(t,{applyPerfmarkTrial:()=>Me,completeDesktopOnboardingForTeamPlan:()=>Pe,createSpaceWithTemplates:()=>he,getInitialState:()=>ce,getRedirectDataUpdate:()=>Te,getWorkflowTemplateForUseCase:()=>Ee,getWorkflowTemplatesForUseCases:()=>Ue,joinTeamSpaceWithTemplates:()=>ke,messages:()=>se,navigateWithRedirectData:()=>Se,redirectAfterOnboardingComplete:()=>be,timedTrialUpsellNextState:()=>fe,updateAndGetNextState:()=>le,updateAndGetPreviousState:()=>de});r(821057),r(267602),r(653476),r(241792);var o=()=>r(506347),n=()=>r(991460),a=()=>r(799891),i=()=>r(431595),s=()=>r(956057),c=()=>r(741633),l=()=>r(217465),d=()=>r(396136),p=()=>r(752778),u=()=>r(255933),m=()=>r(125571),_=()=>r(282017),g=()=>r(245015),f=()=>r(513670),y=()=>r(792409),v=()=>r(696459),b=()=>r(863119),S=()=>r(636133),w=()=>r(462928),I=()=>r(407391),h=()=>r(824462),k=()=>r(917801),C=()=>r(231077),T=()=>r(528918),D=()=>r(919671),O=()=>r(143346),M=()=>r(47443),P=()=>r(497065),U=()=>r(224597),E=()=>r(145284),N=()=>r(269299),A=()=>r(348141),R=()=>r(2971),V=()=>r(887430),x=()=>r(937419),L=()=>r(594546),F=()=>r(718959),j=()=>r(286338),W=()=>r(572623),Z=()=>r(527278),B=()=>r(345918),J=()=>r(803728),Y=()=>r(620218),z=()=>r(876822),G=()=>r(749826),q=()=>r(9599),K=()=>r(826955),Q=()=>r(576387),H=()=>r(548812),$=()=>r(334510),X=()=>r(548919),ee=()=>r(723721),te=()=>r(934262),re=()=>r(686350),oe=()=>r(707138),ne=()=>r(267344),ae=()=>r(505006),ie=()=>r(741636);const se=(0,r(788860).vU)({joiningWorkspace:{id:"onboardingStateActions.joiningWorkspace.loadingMessage",defaultMessage:"Joining team…"},creatingWorkspace:{id:"onboardingStateActions.creatingWorkspace.loadingMessage",defaultMessage:"Getting ready…"},creatingWorkflowTemplate:{id:"onboardingStateActions.creatingWorkflowTemplate.loadingMessage",defaultMessage:"Getting ready…"},navigatingToWorkspace:{id:"onboardingStateActions.navigatingToWorkspace.loadingMessage",defaultMessage:"Taking you to your workspace…"},errorNoAction:{id:"onboardingStateActions.errorMessage.noActionToPerform",defaultMessage:"No action to perform for {onboardingRedirectType}"},errorWorkspaceCreationPreventedWithEmail:{id:"onboardingStateActions.errorMessage.domainClaim.workspaceCreationPreventedWithEmail",defaultMessage:"You are signed in to {userEmailAddress} and do not have access to any workspaces. Please reach out to your IT department for access to Notion."},errorWorkspaceCreationPrevented:{id:"onboardingStateActions.errorMessage.domainClaim.workspaceCreationPrevented",defaultMessage:"You do not have access to any workspaces. Please reach out to your IT department for access to Notion."},errorWorkspaceDoesNotExist:{id:"onboardingStateActions.errorMessage.spaceDoesNotExist",defaultMessage:"Workspace does not exist."},errorWorkspaceDidNotLoad:{id:"onboardingStateActions.errorMessage.spaceDidNotLoad",defaultMessage:"Failed to load workspace."}});async function ce(e){let{environment:t,startOnboardingArgs:r,onboardingData:o,redirectData:a}=e;const c=t.currentUser.id;if(void 0===c)throw new Error("Environment currentUserId not defined.");const{type:l,redirectUrl:d,disableRedirectUrl:p}=r,u=t.device.isMobile,{currentUserRootStore:m}=z().default.state,_=0===(m&&m.isReady()?f().jj(m.getSpaceViewStores().filter((e=>e.getJoined())).map((e=>e.getSpaceId()))).length:0),g=(0,ee().pV)()?"perfmark":void 0,y={onboardingData:o,redirectData:a,isOnboarding:!0,isLoading:!1,flowId:s().Il(),currentUserId:c,isNewUser:_,stageNumber:0,spaceId:void 0,historicalStages:void 0,onboardingExperiments:{},stageStats:{startedTimeStampMs:Date.now()},trialId:g,performanceMarketingTerm:o.performanceMarketingTerm};if("new-user"===l){const e=o.joinableSpaceData.results.length>0;let r;r=u?d&&!p?"mobile_redirect":e?"mobile_joinable_spaces":"mobile_cold_start":d&&!p?"desktop_redirect":e?"desktop_joinable_spaces":"desktop_cold_start";const a={...y,flow:r,stage:"profile",uploadingProfilePhoto:!1,profilePhoto:null,prefilled:!1,passwordErrorData:null,emailOptIn:(0,n().Aw)(o.countryCode).defaultOptIn},i=re().$U({userStore:o.userStore});return i?pe({...a,...i},t):a}if("create-or-join"===l){const e=re().ey({onboardingData:o,isNewUserFlow:!1}),r=u?"mobile_join_or_create_space":"desktop_join_or_create_space";if(e.length>0)return{...y,flow:r,stage:"workspace_choose",joinableSpaces:e,prefilled:!1};if(o.canUserCreateSpace)return{...Oe(y),...y,flow:r,stage:"workspace_plan_choose",prefilled:!1,spaceJoinOrCreate:"create",useCases:[],collaborativeIntent:void 0};{S().Yc(t,{can_user_create_space:!1,is_new_user:!1,has_joinable_spaces:!1,onboarding_stage:void 0});const e=o.userStore.getEmail();throw oe().default.setState({...y,flow:r,stage:"error"}),new(i().bp)(e?Z().Z.formatMessage(se.errorWorkspaceCreationPreventedWithEmail,{userEmailAddress:e}):Z().Z.formatMessage(se.errorWorkspaceCreationPrevented),{newUser:!1})}}if("mobile-onboarding"===l)return{...y,flow:"mobile_existing_user",stage:"mobile_editor",spaceJoinOrCreate:"join"};v().t1(l)}async function le(e,t){if(!e.isOnboarding)return{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};const r={...e,stageNumber:e.stageNumber+1};switch(re().Ck(t),r.stage){case"profile":return pe(r,t);case"workspace_plan_choose":return me(r,t);case"workspace_collaborative_intent_choose":return function(e,t){return me({...e,stage:"workspace_plan_choose"},t,!0)}(r,t);case"workspace_choose":return async function(e,t){const{redirectData:r}=e;if("guest_redirect"===r.type)return De(e,r,"guest",t);if("create"===e.spaceJoinOrCreate)return{...Oe(e),planSelection:void 0,...e,stage:"workspace_plan_choose",useCases:[],collaborativeIntent:void 0};{const r=Y().default.DO_NOT_USE_markLegacy("onboarding.join_space"),{spaceStore:o,spaceViewStore:n,...a}=await Ie(e,t);re().At({environment:t,state:{onboardingExperiments:e.onboardingExperiments,userPersona:"userPersona"in e?e.userPersona:void 0,userRole:"userRole"in e?e.userRole:void 0,companySize:void 0,useCases:void 0,planSelection:void 0,categories:void 0,userEducationRole:void 0,userEducationLevel:void 0,notionUseFrequency:void 0,collaborativeIntent:void 0},spaceStore:void 0,spaceViewStore:n});const{spaceId:i,spaceViewId:s,redirectData:c}=a,{flow:l}=e;switch(l){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_redirect":case"desktop_joinable_spaces":return await be({environment:t,onboardingData:e.onboardingData,spaceId:i,spaceViewId:s,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:c,onboardingFlow:l,onboardingState:e}),Y().default.DO_NOT_USE_measureLegacy(r,{environment:t,data:{flow:e.flow,onboarding_complete_data:{stage:e.stage,redirect_data:c,is_new_user:re().rT(e),permission_level:"guest_redirect"===c.type?"guest":"member"}}}),{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};case"mobile_join_or_create_space":{const r={...e,...a};return ye(e.onboardingData,r,t)}case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":{const o={...e,...a};return Y().default.DO_NOT_USE_measureLegacy(r,{environment:t,data:{flow:e.flow,onboarding_complete_data:{stage:e.stage,redirect_data:c,is_new_user:re().rT(e),permission_level:"guest_redirect"===c.type?"guest":"member"}}}),ve({onboardingState:o,environment:t,flow:l})}default:return v().t1(l)}}}(r,t);case"persona_survey":return ue(r,t);case"workspace_create":return _e(r,t);case"invite":return ge(r,t);case"timed_trial_upsell":return fe(r,t);case"template_optout":return function(e,t){return{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id}}(0,t);case"workspace_setup":return async function(e,t){const{flow:r}=e;switch(r){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_joinable_spaces":case"desktop_redirect":return await be({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingState:e}),{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};case"mobile_join_or_create_space":return ye(e.onboardingData,e,t);case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":return P().T4(t),ve({onboardingState:e,environment:t,flow:r});default:return v().t1(r)}}(r,t);case"mobile_editor":return function(e){return{...e,stage:"mobile_sidebar"}}(r);case"mobile_sidebar":return function(e,t){if(re().og(t))return{...e,stage:"mobile_app_download"};return{...e,stage:"mobile_desktop"}}(r,t);case"mobile_desktop":return function(e,t){return{...e,stage:"mobile_web_clipper"}}(r);case"mobile_web_clipper":return function(e,t){if("mobile_existing_user"===e.flow)return Ce(e,t);return ye(e.onboardingData,e,t)}(r,t);case"mobile_app_download":return async function(e,t){if("mobile_existing_user"===e.flow)return Ce(e,t);return ye(e.onboardingData,e,t)}(r,t);case"error":return function(e){return{isOnboarding:!1,isLoading:!1,currentUserId:e.currentUser.id}}(t);default:v().t1(r)}}function de(e,t){if(!e.isOnboarding)throw new Error("Trying to go back on step which is not onboarding.");const r={...e,stageNumber:e.stageNumber-1};if(!oe().onboardingStagesWithBack.includes(e.stage))throw new Error(`Trying to go back in onboarding on step where back is not supported. Stage: ${e.stage}`);switch(r.stage){case"workspace_plan_choose":return function(e){const t=re().rT(e),r=re().ey({onboardingData:e.onboardingData,isNewUserFlow:t});if(r.length>0)return{...e,joinableSpaces:r,stage:"workspace_choose"};if(t)throw new Error("Trying to go back to profile step from plan choose for new user!");throw new Error("Trying to go back on plan choose step for existing user with no joinable spaces!")}(r);case"workspace_collaborative_intent_choose":return function(e){return{...e,stage:"workspace_plan_choose",collaborativeIntent:void 0}}(r);case"persona_survey":return function(e){if(G().default.checkGate({gateName:"onboarding_split_intent_question"}))return{...e,stage:"workspace_collaborative_intent_choose"};return{...e,stage:"workspace_plan_choose"}}(r);case"workspace_create":return function(e){const t=re().rT(e);if("school"===e.planSelection||"personal"===e.planSelection)return{...e,skip:!1,prefilled:e.prefilled,previousStage:"workspace_create",userPersona:e.userPersona,spaceName:e.spaceName,stage:"persona_survey"};return t&&"team"===e.planSelection?{...e,prefilled:e.prefilled,previousStage:"workspace_create",skip:!1,userPersona:e.userPersona,spaceName:e.spaceName,stage:"persona_survey"}:G().default.checkGate({gateName:"onboarding_split_intent_question"})?{...e,stage:"workspace_collaborative_intent_choose"}:{...e,prefilled:e.prefilled,stage:"workspace_plan_choose"}}(r);case"timed_trial_upsell":return function(e){const t=re().lr(e.onboardingData);return{...e,flow:e.flow,stage:"invite",isChecked:!0,emails:[],spaceSetupCompleted:!0,joinableUserEmailDomain:t,spaceJoinOrCreate:"create",inviteLinkUrl:e.inviteLinkUrl,shouldTriggerPostInviteAnimations:!1,isBulkInvite:!1,planSelection:e.planSelection,collaborativeIntent:e.collaborativeIntent}}(r);case"mobile_editor":return function(e){const t=re().lr(e.onboardingData);return{...e,flow:e.flow,stage:"invite",isChecked:!0,emails:[],spaceSetupCompleted:!0,joinableUserEmailDomain:t,spaceJoinOrCreate:"create",shouldTriggerPostInviteAnimations:!1,isBulkInvite:!1,teamStoreId:e.teamStoreId,inviteLinkUrl:e.inviteLinkUrl,spaceViewId:e.spaceViewId,planSelection:e.planSelection,collaborativeIntent:e.collaborativeIntent}}(r);case"mobile_sidebar":return function(e){return{...e,stage:"mobile_editor"}}(r);case"mobile_desktop":case"mobile_app_download":return function(e){return{...e,stage:"mobile_sidebar"}}(r);case"mobile_web_clipper":return function(e,t){return{...e,stage:"mobile_desktop"}}(r);case"workspace_choose":case"invite":case"template_optout":case"workspace_setup":case"profile":case"error":return null;default:v().t1(r)}}async function pe(e,t){await re()._J(e,t);const{password:r,...n}=e,a=g().Z.get(re().WX),{onboardingData:s,redirectData:c}=n,l=re().ey({onboardingData:s,isNewUserFlow:re().n0(n)});if("guest_redirect"===c.type)return De(n,c,"guest",t);if("redirect_page"===c.type||"redirect_space"===c.type)return De(n,c,"member",t);if("public_access_page_redirect"===c.type)return function(e,t,r){return we({environment:r,permissionLevel:"public",onboardingState:e}),M()._c({environment:r,store:new(K().G)(r,{table:d().iU,id:t.pageId}),pageVisitSource:o().tY.Onboarding}),{isOnboarding:!1,isLoading:!1,currentUserId:r.currentUser.id}}(n,c,t);if(a){const e=await h().callApi({eventName:"getPublicSpaceForInvite",environment:t,data:{type:"invite-link",inviteLinkCode:a}});if("success"===e.type){const{data:r}=e,{result:o}=r;if(o)return De(n,{type:"team_invite_redirect",spaceId:o.id,inviteCode:a},"member",t);throw new Error(Z().Z.formatMessage(se.errorWorkspaceDoesNotExist))}throw new Error(Z().Z.formatMessage(se.errorWorkspaceDidNotLoad))}if(l.length>0)return{...n,joinableSpaces:l,stage:"workspace_choose"};if(s.canUserCreateSpace){if(re().fz({state:n})){return{...n,spaceJoinOrCreate:"create",userPersona:void 0,useCases:[],stage:"workspace_plan_choose",planSelection:void 0,collaborativeIntent:void 0}}return{spaceName:void 0,...n,spaceJoinOrCreate:"create",userPersona:void 0,userRole:void 0,companySize:void 0,useCases:[],categories:[],stage:"persona_survey",skip:!1,previousStage:"profile",planSelection:void 0,collaborativeIntent:void 0}}{S().Yc(t,{can_user_create_space:!1,is_new_user:!0,has_joinable_spaces:!1,onboarding_stage:n.stage});const r=s.userStore.getEmail();throw oe().default.setState({...e,stage:"error"}),new(i().bp)(r?Z().Z.formatMessage(se.errorWorkspaceCreationPreventedWithEmail,{userEmailAddress:r}):Z().Z.formatMessage(se.errorWorkspaceCreationPrevented),{newUser:!0})}}function ue(e,t){!e.skip&&e.isNewUser&&function(e,t){const{onboardingData:r,userPersona:o,userRole:n,useCases:a,companySize:i}=t;N().createAndCommit({userAction:"onboardingStateActions.setUserPersonaRoleAndUseCases",environment:e,canUndo:!0,perform:e=>{A().d2({userSettingsStore:r.userSettingsStore,data:{persona:o,team_role:n,use_cases:a,company_size:i,persona_version:{version:"V4",timestamp:(new Date).getTime()}},transaction:e})}})}(t,e);const{onboardingData:r}=e,o=Z().Z.getIntl(),n={spaceIcon:null,uploadingSpaceIcon:!1,...Oe(e),...e,spaceJoinOrCreate:"create",userPersona:e.userPersona,stage:"workspace_create"},a=r.userStore.getFullName(o);if("planSelection"in n&&["personal","school"].includes(n.planSelection||"")&&a){const e=r.userStore.getProfilePhoto();return _e({...n,userPersona:n.userPersona||"unfilled",spaceName:re().eW(a,o),spaceIcon:e||null},t)}return n}function me(e,t,r){const o="school"===e.planSelection||"personal"===e.planSelection,n=re().fz({state:e}),a={userRole:void 0,companySize:void 0,spaceName:void 0,categories:[],...e,skip:!1,stage:"persona_survey",previousStage:"workspace_plan_choose"};if(G().default.checkGate({gateName:"onboarding_split_intent_question"})&&!r)return{...a,collaborativeIntent:void 0,stage:"workspace_collaborative_intent_choose"};if(n||o)return"team"===e.planSelection||o?a:ue({...e,skip:!0,userPersona:void 0,userRole:void 0,companySize:void 0,useCases:[],categories:[],previousStage:"workspace_plan_choose",spaceName:void 0,stage:"persona_survey",collaborativeIntent:void 0},t);{if("team"===e.planSelection){if("on"===G().default.getEligibleGroup({experimentId:"workspace_survey_enable_second_workspace",defaultGroup:"control"}))return a}const r={userRole:void 0,companySize:void 0,...e,spaceJoinOrCreate:"create",useCases:[],categories:[],stage:"workspace_create",spaceIcon:null,uploadingSpaceIcon:!1},{onboardingData:o}=e,n=Z().Z.getIntl(),i=o.userStore.getFullName(n),s=o.userStore.getProfilePhoto();if("planSelection"in e&&["personal","school"].includes(e.planSelection||"")&&i){return _e({...r,userPersona:e.userPersona||"unfilled",spaceName:re().eW(i,n),spaceIcon:s||null,useCases:e.useCases},t)}return r}}async function _e(e,t){const{flow:r,spaceJoinOrCreate:o,onboardingData:n}=e,a=Y().default.DO_NOT_USE_markLegacy("onboarding.create_space"),{spaceStore:i,spaceViewStore:s,...c}=await Ie(e,t);if(re().At({environment:t,state:{...e,userEducationRole:void 0,userEducationLevel:void 0,notionUseFrequency:void 0},spaceStore:i,spaceViewStore:s}),"team"===e.planSelection){const r=re().lr(e.onboardingData),{spaceId:o,inviteLinkCode:n}=c;if(Y().default.DO_NOT_USE_measureLegacy(a,{environment:t,data:{flow:e.flow,onboarding_complete_data:{stage:e.stage,redirect_data:e.redirectData,is_new_user:re().rT(e),permission_level:"guest_redirect"===e.redirectData.type?"guest":"member",plan:e.planSelection}}}),e.collaborativeIntent&&"multiplayer"!==e.collaborativeIntent){return ge({...e,isChecked:!1,stage:"invite",isBulkInvite:!1,spaceSetupCompleted:!0,shouldTriggerPostInviteAnimations:!1,inviteLinkUrl:void 0,emails:[],spaceViewId:s.id,joinableUserEmailDomain:void 0,teamStoreId:void 0},t)}return{...e,...c,isChecked:!0,spaceId:o,emails:[],joinableUserEmailDomain:r,inviteLinkUrl:n&&(0,B().cJ)(t,o,n),stage:"invite",isBulkInvite:!1,shouldTriggerPostInviteAnimations:!1,spaceSetupCompleted:!0}}switch(r){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_joinable_spaces":case"desktop_redirect":const{spaceId:i,spaceViewId:l,redirectData:d}=c;if(e.collaborativeIntent&&"multiplayer"===e.collaborativeIntent){return{...e,isChecked:!1,stage:"invite",isBulkInvite:!1,spaceSetupCompleted:!0,shouldTriggerPostInviteAnimations:!1,inviteLinkUrl:void 0,emails:[],spaceViewId:s.id,joinableUserEmailDomain:void 0,teamStoreId:void 0}}return T().j({message:se.navigatingToWorkspace}),await be({environment:t,onboardingData:n,spaceId:i,spaceViewId:l,spaceJoinOrCreate:o,redirectData:d,onboardingFlow:r,onboardingState:e}),T().x(),Y().default.DO_NOT_USE_measureLegacy(a,{environment:t,data:{flow:e.flow,onboarding_complete_data:{stage:e.stage,redirect_data:e.redirectData,is_new_user:re().rT(e),permission_level:"guest_redirect"===e.redirectData.type?"guest":"member",plan:e.planSelection}}}),{...e,spaceId:i,spaceViewId:l,flow:r,stage:"template_optout"};case"mobile_join_or_create_space":return ye(e.onboardingData,{...e,...c},t,a);case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":return ve({onboardingState:{...e,...c},environment:t,flow:r});default:return v().t1(r)}}async function ge(e,t){const r=Y().default.DO_NOT_USE_markLegacy("invite_next_state");await re().SN(e,t);const{flow:o,isNewUser:n,trialId:a}=e;switch(o){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_joinable_spaces":if("team"!==e.planSelection)return await be({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingState:e}),Y().default.DO_NOT_USE_measureLegacy(r,{environment:t,data:{numInvitesSent:e.emails.length}}),{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};return n&&"perfmark"===a||(0,H().TN)(t)?(await be({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingState:e}),Y().default.DO_NOT_USE_measureLegacy(r,{environment:t,data:{numInvitesSent:e.emails.length}}),Pe(e,t)):{...e,stage:"timed_trial_upsell"};case"desktop_redirect":return await be({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingState:e}),Y().default.DO_NOT_USE_measureLegacy(r,{environment:t,data:{numInvitesSent:e.emails.length}}),"team"===e.planSelection?Pe(e,t):{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};case"mobile_join_or_create_space":const i=ye(e.onboardingData,e,t);return Y().default.DO_NOT_USE_measureLegacy(r,{environment:t,data:{mobileOnboardingState:o}}),i;case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":const s=ve({onboardingState:e,environment:t,flow:o});return Y().default.DO_NOT_USE_measureLegacy(r,{environment:t,data:{mobileOnboardingState:o}}),s;default:return v().t1(o)}}async function fe(e,t){return await be({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingState:e}),Pe(e,t)}async function ye(e,t,r,o){return await be({environment:r,onboardingData:e,spaceId:t.spaceId,spaceViewId:t.spaceViewId,spaceJoinOrCreate:t.spaceJoinOrCreate,redirectData:t.redirectData,onboardingFlow:t.flow,onboardingState:t}),o&&Y().default.DO_NOT_USE_measureLegacy(o,{environment:r,data:{flow:t.flow,onboarding_complete_data:{stage:t.stage,redirect_data:t.redirectData,is_new_user:re().rT(t),permission_level:"guest_redirect"===t.redirectData.type?"guest":"member"}}}),{isOnboarding:!1,isLoading:!1,currentUserId:r.currentUser.id}}function ve(e){const{onboardingState:t,environment:r,flow:o}=e;if("oauth_authorization_redirect"===t.redirectData.type){const{responseType:e,integrationId:o,redirectUri:n,state:a,owner:i,userId:s,spaceId:c}=t.redirectData;D().g({environment:r,responseType:e,integrationId:o,redirectUri:n,state:a,owner:i,userId:s,spaceId:c})}return{...t,flow:o,stage:"mobile_editor"}}async function be(e){const{environment:t,redirectData:r,spaceViewId:o,spaceId:n,onboardingData:a,spaceJoinOrCreate:i,onboardingFlow:s,onboardingState:c}=e;await Se({environment:t,redirectData:r,spaceViewId:o,spaceId:n,onboardingData:a,spaceJoinOrCreate:i,onboardingFlow:s}),we({environment:t,spaceJoinOrCreate:i,permissionLevel:"member",onboardingState:c})}async function Se(e){const{environment:t,redirectData:r,spaceViewId:n,spaceId:a,onboardingData:i,spaceJoinOrCreate:s,onboardingFlow:u}=e;k().qL({bannerStore:q().Z,id:"SubscriptionEditingBlocker"}),t.device.isMobile&&N().createAndCommit({userAction:"onboardingStateActions.navigateWithRedirectData",environment:t,canUndo:!0,perform:e=>{ie().Mf({userStore:i.userStore,transaction:e})}});const g=n?K().V9.createChildStore(i.userRootStore,{table:m().zU,id:n}):void 0,f=_().bT();if("fork_page"===r.type&&g)await U().y3({environment:t,spaceViewStore:g,redirectPageId:r.pageId,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:o().tY.Onboarding,navigationType:"joiningOrCreatingSpace"});else if(f&&!i.onboardingCompleted)_().B9(),P().c4({environment:t,url:f,redirect:!0});else if("home"===r.type&&null!=g&&g.isDefined()){const e=await h().callApi({eventName:"getUserHomePages",environment:t,data:{spaceViewId:g.id,spaceId:g.getSpaceId()},headers:(0,c().Bb)({cellId:void 0,recordId:g.id,spaceId:g.getSpaceId()})}),{recordMap:r,homePageId:n}="success"===e.type?{recordMap:l().RecordMapWithRole.create(e.data.recordMap),homePageId:e.data.homePageId}:{recordMap:void 0,homePageId:void 0},a=g.pointer;r&&O().Wl({environment:t,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,pointer:a,model:r.getModel(a),role:r.getRole(a)||"none",updatePaths:[["settings","personal_home"]],debugSource:"onboardingStateActions.navigateWithRedirectData",force:!0}),await U().y3({environment:t,redirectPageId:n,spaceViewStore:g,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:o().tY.Onboarding,navigationType:"joiningOrCreatingSpace"})}else if("redirect_page"===r.type&&r.spaceId===a&&g)await O().bG({environment:t,pointer:{table:d().iU,id:r.pageId},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,userId:t.currentUser.id}),await U().y3({environment:t,spaceViewStore:g,redirectPageId:r.pageId,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:o().tY.Onboarding,navigationType:"joiningOrCreatingSpace"});else if("redirect_space"===r.type&&r.spaceId===a&&g)await U().y3({environment:t,spaceViewStore:g,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:o().tY.Onboarding,navigationType:"joiningOrCreatingSpace"});else if("mobile_native_home"===r.type&&g)await U().y3({environment:t,spaceViewStore:g,redirectPageId:void 0,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:o().tY.Onboarding,navigationType:"joiningOrCreatingSpace"});else if("getting_started_page"!==r.type&&"redirect_space"!==r.type&&"performance_marketing_template"!==r.type||!g)if("oauth_authorization_redirect"===r.type&&"mobile_cold_start"!==u&&"mobile_joinable_spaces"!==u&&"mobile_redirect"!==u){const{responseType:e,integrationId:o,redirectUri:n,state:a,owner:i,userId:s,spaceId:c}=r;D().g({environment:t,responseType:e,integrationId:o,redirectUri:n,state:a,owner:i,userId:s,spaceId:c})}else if(g)await U().y3({environment:t,spaceViewStore:g,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:o().tY.Onboarding,navigationType:"joiningOrCreatingSpace"});else{if(!i.firstSpaceView)throw new Error(Z().Z.formatMessage(se.errorNoAction,{onboardingRedirectType:r.type}));await U().y3({environment:t,spaceViewStore:i.firstSpaceView,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:o().tY.Onboarding,navigationType:"joiningOrCreatingSpace"})}else{let e;if("getting_started_page"===r.type&&r.collectionId){const o=K().NW.createChildStore(g.getSpaceStore(),{table:p().vF,id:r.collectionId});e=(await(0,V()._z)({environment:t,collectionStore:o})).collectionViewBlockStore()}await U().y3({environment:t,spaceViewStore:g,redirectPageId:r.pageId,userSettingsStore:i.userSettingsStore,userRootStore:i.userRootStore,isNewlyCreatedSpace:"create"===s,pageVisitSource:o().tY.Onboarding,navigationType:"joiningOrCreatingSpace",navigateToStore:e})}}function we(e){const{environment:t,onboardingState:r}=e;if(t.device.isElectron&&C().quickSearchRefresh(),!r.isOnboarding)return;const{onboardingData:{userStore:o}}=r;N().createAndCommit({userAction:"onboardingStateActions.setAndTrackOnboardingComplete",environment:t,canUndo:!0,perform:e=>{ie().Ex({userStore:o,transaction:e})}}),w().PL(t,{...re().jn(r),initial_workspace_type:"public"!==e.permissionLevel?e.spaceJoinOrCreate:void 0,permission_level:e.permissionLevel}),I().wk(t)}async function Ie(e,t){if("join"===e.spaceJoinOrCreate){T().j({message:se.joiningWorkspace});const r=await ke({environment:t,onboardingData:e.onboardingData,redirectData:e.redirectData,spaceId:e.spaceId||"",isNewUserOnboarding:re().rT(e)});return T().x(),r}{T().j({message:se.creatingWorkspace});const r=await he({environment:t,isNewUserOnboarding:re().rT(e),onboardingData:e.onboardingData,userPersona:e.userPersona,redirectData:e.redirectData,spaceName:e.spaceName,spaceIcon:e.spaceIcon,planSelection:e.planSelection,isPrivate:"team"!==e.planSelection,useCases:e.useCases,categories:e.categories,hasTrialId:Boolean(e.trialId),selectedWorkflowTemplates:[]}),o=e.isNewUser&&"perfmark"===e.trialId;if(!o&&(0,H().TN)(t)&&"team"===e.planSelection){await(0,$().applyReversePlusTrial)(r.spaceId,t,"onboarding")&&(0,J().ES)(t,"onboarding_reverse_trial_sidebar")}if(o&&e.planSelection&&re().rT(e)){const o=await Me(r.spaceId,e.planSelection,t),{enableTrialInfoModal:n,enableTrialIneligibleToast:a}=o;n&&(0,X().D)({openedFrom:"onboarding"}),a&&ne().Z.setState({open:!0,isExistingUser:!1})}return T().x(),r}}async function he(e){const{environment:t,onboardingData:r,userPersona:o,redirectData:n,spaceName:a,planSelection:i,spaceIcon:s,isPrivate:c,useCases:l,categories:d,isNewUserOnboarding:p,selectedWorkflowTemplates:u,collaborativeIntent:m}=e,_="team"===i?"team":"personal",g=Y().default.DO_NOT_USE_markLegacy("create_space_with_templates"),{spaceStore:f,spaceViewStore:y,inviteLinkCode:v,teamStore:b,personaTeamStore:S}=await U().wh({environment:t,planType:_,name:a,userRootStore:r.userRootStore,analyticsFrom:"onboarding",icon:s||void 0,userPersona:o,collaborativeIntent:m});let I;oe().default.setState({...oe().default.state,spaceId:f.id}),await Q().OR({environment:t,spaceId:f.id,isNewlyCreatedSpace:!0});let h=[],k={};if(re().VW(_)&&!r.performanceMarketingTerm){let e=[],r=[],o=[];if("use_cases_step_app_templates"===(0,j().r3)(t)){"control"!==(0,j().hm)(t)?(o=[...u??[],...Ue(l)],e=l.includes("wikis")?[R().wikiAppTemplateUri]:[]):(e=(0,R().getAppTemplatePresetsForUseCases)(l),r=(0,ae().getPageTemplatesForUseCases)(l,Z().Z.getIntl()))}else e=(0,R().getDefaultAppTemplatePresets)();k={appTemplates:e,pageTemplates:r,workflowTemplates:o}}else{let e=[];e=r.performanceMarketingTerm?(0,ae().getPerformanceMarketingSearchTermTemplates)(r.performanceMarketingTerm,Z().Z.getIntl()):ae().getStarterTemplatesForSpace({environment:t,onboardingPlanType:i,categories:d,intl:Z().Z.getIntl()}),e&&(h=e.map((e=>e.rootId))),k={pageTemplates:e}}I=await ae().createTemplatePagesInSpace({environment:t,redirectData:n,spaceViewStore:y,userSettingsStore:r.userSettingsStore,userRootStore:r.userRootStore,isPrivate:c,templatesToCreateInSpace:k,planType:_,spaceJoinOrCreate:"create",teamStore:b,personaTeamStore:S,useCases:l,userPersona:o,isNewUserOnboarding:p}),w().vd(t,{plan_selection:i,user_persona:o,initial_workspace_type:"create",space_id:f.id,onboarding_templates:h}),Y().default.DO_NOT_USE_measureLegacy(g,{environment:t,data:{}});const C=Te(n,I,t),T="pageId"in C?C.pageId:void 0;return x().default.setState({...x().default.state,onboardingData:{...r,redirectPageId:T}}),{redirectData:C,spaceId:f.id,spaceViewId:y.id,inviteLinkCode:v,spaceStore:f,spaceViewStore:y,teamStoreId:null==b?void 0:b.id}}async function ke(e){const{environment:t,onboardingData:r,spaceId:o,redirectData:n,isNewUserOnboarding:a}=e,i="team_invite_redirect"===n.type?n.inviteCode:void 0,{spaceViewStore:s}=await U().j({environment:t,spaceId:o,userRootStore:r.userRootStore,analyticsFrom:"onboarding",userSettingsStore:r.userSettingsStore,inviteCode:i,isOnboarding:!0});z().default.state.currentSpaceStore||z().default.setState({...z().default.state,currentSpaceStore:s.getSpaceStore()});const c=ae().getStarterTemplatesForSpace({environment:t,onboardingPlanType:"team",categories:[],isJoiner:!0,intl:Z().Z.getIntl()}),l=await ae().createTemplatePagesInSpace({environment:t,redirectData:n,spaceViewStore:s,isPrivate:!0,userSettingsStore:r.userSettingsStore,userRootStore:r.userRootStore,templatesToCreateInSpace:{pageTemplates:c},planType:"team",spaceJoinOrCreate:"join",useCases:[],userPersona:"unfilled",isNewUserOnboarding:a});w().e7(t,{initial_workspace_type:"join",space_id:o,onboarding_templates:null==c?void 0:c.map((e=>e.rootId))});return{redirectData:Te(n,l,t),spaceId:o,spaceViewId:s.id,inviteLinkCode:void 0,spaceStore:void 0,spaceViewStore:s,teamStoreId:void 0}}async function Ce(e,t){const r=await async function(e,t){const r="spaceId"in e.redirectData&&e.redirectData.spaceId,{onboardingData:o,redirectData:n}=e;if(r){const a=await ke({environment:t,onboardingData:o,redirectData:n,spaceId:r,isNewUserOnboarding:re().rT(e)});return{...e,...a,spaceId:r}}if("fork_page"===n.type){const r=F().o(o.userRootStore);if(r.length>0){const a=r[0].getSpaceId();if(a){const i=K().H2.createChildStore(o.userRootStore,{table:u().bx,id:a}),s=Te(n,await E().ux({environment:t,userRootStore:o.userRootStore,isPrivate:!0,forkedPageId:n.pageId,spaceStore:i,spaceViewStore:r[0]}),t);return{...e,redirectData:s,spaceViewId:r[0].id,spaceId:a}}}}return e}(e,t);return ye(e.onboardingData,r,t)}function Te(e,t,r){if(t){if("redirect_space"===e.type)return{type:e.type,pageId:t.id,spaceId:e.spaceId};if("getting_started_page"===e.type)return re().Ck(r)?{type:"mobile_native_home"}:{type:e.type,pageId:t.id};if("fork_page"===e.type)return{type:e.type,pageId:t.id};if("performance_marketing_template"===e.type)return{type:e.type,pageId:t.id}}return e}async function De(e,t,r,o){const{onboardingData:n}=e,a=Y().default.DO_NOT_USE_markLegacy("onboarding.join_space");if("guest"===r){if(we({environment:o,spaceJoinOrCreate:"join",permissionLevel:r,onboardingState:e}),"team_invite_redirect"===t.type)throw new Error("Cannot invite guests to workspace from invite links.");await U().j({environment:o,spaceId:t.spaceId,userRootStore:n.userRootStore,analyticsFrom:"onboarding",userSettingsStore:n.userSettingsStore,navigate:!0,redirectPageId:t.pageId})}else{const r=await ke({environment:o,onboardingData:n,redirectData:t,spaceId:t.spaceId,isNewUserOnboarding:re().rT(e)});await be({environment:o,onboardingData:n,spaceId:r.spaceId,spaceViewId:r.spaceViewId,spaceJoinOrCreate:"join",redirectData:r.redirectData,onboardingFlow:e.flow,onboardingState:e})}return Y().default.DO_NOT_USE_measureLegacy(a,{environment:o,data:{flow:e.flow,onboarding_complete_data:{stage:e.stage,redirect_data:t,is_new_user:re().rT(e),permission_level:r}}}),{isOnboarding:!1,isLoading:!1,currentUserId:o.currentUser.id}}function Oe(e){let t;e.onboardingData.isEducationPlanEligible&&(t="student");const{function:r}=(0,B().kO)();return r&&(t=r),{userPersona:t}}async function Me(e,t,r){let o=!1,n=!1;const i=await h().callApi({eventName:"checkAndApplyPerfmarkTrial",environment:r,data:{spaceId:e}});if("success"===i.type){const e="success"===i.data.status;(0,L().j)({environment:r,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:"perfmark",success:e,planType:t,..."error"===i.data.status&&{reason:i.data.reason}}}}),b().QF(r,{trial_id:"perfmark",success:e,planType:t,domainType:(0,W().JF)()}),"success"===i.data.status?o=!0:n=!0}else(0,L().j)({environment:r,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:"perfmark",success:!1,planType:t,reason:i.error.name}}}),b().QF(r,{trial_id:"perfmark",success:!1,planType:t}),a().log({level:"error",from:"onboardingActions",type:"applyPerfmarkTrialError",error:(0,y().Ui)(i.error)});return(0,ee().XG)(),{enableTrialInfoModal:o,enableTrialIneligibleToast:n}}function Pe(e,t,r,o){return"create"===e.spaceJoinOrCreate&&e.isNewUser&&!r&&te().default.setState({type:"team_creator",step:"welcome",initialTeamStoreId:e.teamStoreId}),"modal"===r&&(0,X().D)({openedFrom:"onboarding"}),"sidebar"===r&&(0,J().ES)(t,"onboarding_reverse_trial_sidebar"),o&&ne().Z.setState({open:!0,isExistingUser:!1}),{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id}}function Ue(e){return e.map((e=>Ee(e))).filter((e=>void 0!==e))}function Ee(e){switch(e){case"docs":return"docsCollection";case"project":return"projectsCollection";case"notes":return"meetingNotesCollection";case"goals":return"goalsCollection";default:return}}},913011:(e,t,r)=>{r.d(t,{H:()=>u});r(821057);var o=()=>r(792197),n=()=>r(308240),a=()=>r(215134),i=()=>r(6623),s=()=>r(639708),c=()=>r(269299),l=()=>r(590434),d=()=>r(655260),p=()=>r(772669);function u(e){let{environment:t,transaction:r,layoutStore:u,position:m,sessionId:_,beforePerformDeleteModule:g}=e;const f=u.getModules();if(!f)throw new Error("[deleteModuleAtPosition] modules by area not found for layout store");const y=(0,a().h7)(f,(e=>e.id===m.moduleId));if(!y)throw new Error("[deleteModuleAtPosition] module to delete not found");const{module:v,position:b}=y;if(!(0,i().Fo)(v))throw new Error("[deleteModuleAtPosition] module to delete is not removeable");var S;(c().createAndCommitOrAppend({environment:t,transaction:r,canUndo:!0,perform(e){!function(e){const{transaction:t,layoutStore:r,moduleLocation:a,moduleToDelete:i,beforePerformDeleteModule:d}=e;d&&d(t);if((0,s().Fc)(i)){const e=(0,l().m)(r,i);e&&(0,p().deleteViewsModuleDependencies)({layoutStore:r,module:e,transaction:t})}if("form_conditional_modules"===a.area){const e=o().CI.removeChildModule({pointer:r.pointer,modulesByArea:r.getModules(),module:i});for(const o of e)c().applyOperation({transaction:t,store:r,operation:o})}else{const e="views_main_tab_modules"===a.area?{area:a.area,viewId:a.viewId}:{area:n().mt[a.area]};c().applyOperation({transaction:t,store:r,operation:o().CI.deleteModuleInArea({...e,pointer:r.pointer,moduleId:i.id})})}}({environment:t,transaction:e,layoutStore:u,moduleLocation:b,moduleToDelete:v,beforePerformDeleteModule:g})},userAction:"pageLayout.deleteActions.deleteModuleAtPosition"}),_)&&d().DZ({environment:t,module:v,sessionId:_,collectionId:null===(S=u.getCollectionModel())||void 0===S?void 0:S.id,layoutId:u.id,context:(0,n().AR)(m.area),area:m.area})}},142730:(e,t,r)=>{r.d(t,{IR:()=>O,L0:()=>P,MF:()=>M,gm:()=>U,iQ:()=>E,m2:()=>C});r(821057),r(492176),r(7961),r(267602),r(653476);var o=()=>r(956057),n=()=>r(530980),a=()=>r(308240),i=()=>r(215134),s=()=>r(667932),c=()=>r(137785),l=()=>r(639708),d=()=>r(483791),p=()=>r(593515),u=()=>r(82937),m=()=>r(497065),_=()=>r(269299),g=()=>r(887430),f=()=>r(487270),y=()=>r(793935),v=()=>r(876822),b=()=>r(482162),S=()=>r(826955),w=()=>r(26796),I=()=>r(913011),h=()=>r(655260),k=()=>r(356117);function C(e){let{environment:t,transaction:r,collectionStore:o,userId:a,modules:i}=e;const c=(0,f().Ii)({environment:t,spaceId:o.getSpaceId(),table:d().Bh}),l=S().t1.createChildStore(o,c),{model:p,operations:[u]}=n().rp4.create({pointer:c,parent:o.pointer,createdByUserId:a,modules:i??(0,s()._P)()});_().applyOperation({transaction:r,store:l,operation:u});const m=n().kj1.setLayout(o.pointer,c);return _().applyOperation({transaction:r,store:o,operation:m}),{model:p,store:l}}function T(e){let t;return e?t=e:b().default.state.open&&b().default.state.targetStore?t=b().default.state.targetStore:v().default.state.mainEditorCurrentBlockStore&&(t=v().default.state.mainEditorCurrentBlockStore),t}function D(e){y().setUpdateExpand({environment:e,isExpanded:!1,from:"keyboard_default",saveDetailsSidebarPreference:!1}),u().xv({environment:e,from:"open_page_layout_editor",preventAnimation:!0})}function O(e){var t,r;let{environment:n,blockStore:a,collectionStore:i,collectionViewStore:s,from:c}=e;const l=function(e){var t;let r=T(e);if(null!==(t=r)&&void 0!==t&&t.isCollectionView()){const e=(0,g().fm)(r);r=e?e.resultsInViewOrder(1).at(0):void 0}return r}(a),d=window.location.href;D(n);const p=o().Il();w().Z.setState({isOpen:!0,mode:"layout-editor",collectionStore:i,pageStore:l,siteRootBlockStore:void 0,sessionId:p,initialSelectedModuleId:null==l||null===(t=l.getAssociatedCollectionStore())||void 0===t||null===(t=t.getLayoutStore())||void 0===t||null===(t=t.getModel())||void 0===t||null===(t=t.firstRawModuleOfType("titleWithIcon"))||void 0===t?void 0:t.id,urlOnOpen:d}),(0,h().Rt)({environment:n,from:c,context:"layout",sessionId:p,collectionId:null==i?void 0:i.id,existingLayoutId:null==i||null===(r=i.getLayoutStore())||void 0===r?void 0:r.id,collectionViewId:null==s?void 0:s.id})}function M(e){let{environment:t,store:r,siteRootBlockStore:n,from:a}=e;const i=T(r);D(t);const s=o().Il();w().Z.setState({isOpen:!0,mode:"site-settings-editor",collectionStore:void 0,pageStore:i,siteRootBlockStore:n,sessionId:s}),(0,h().Rt)({environment:t,context:"site",from:a,sessionId:s,collectionId:void 0,existingLayoutId:void 0})}function P(e){w().Z.getState().isOpen&&U(e)}function U(e){let{environment:t}=e;const r=w().Z.getState();if(!r.isOpen)throw new Error("Cannot close page layout editor. Page layout editor is not open.");"layout-editor"===r.mode&&r.urlOnOpen&&window.location.href!==r.urlOnOpen&&m().op(t),w().Z.setState({isOpen:!1})}function E(e){var t;let{environment:r,transaction:o,property:n,layoutStore:s}=e;const d=w().Z.getSessionId(),u=null===(t=s.getModel())||void 0===t?void 0:t.getRawModules(),m=s.getCollectionModel();if(!u||!m)return;const _=S().NW.createChildStore(s,m.pointer),g=(0,i()._i)(u,(e=>"titleWithIcon"===e.type));if(g&&(0,l().p9)(g.module)){var f;const{module:e,position:t}=g,i={...e,type:"titleWithIcon",propertyIds:null===(f=e.propertyIds)||void 0===f?void 0:f.filter((e=>e!==n))};(0,k().Uq)({environment:r,sessionId:d,transaction:o,layoutStore:s,position:{area:(0,a().Gc)(t.area),moduleId:e.id},updatedModule:(0,c().V)(i)})}const y=(0,i().MI)(u,(e=>"property"===e.type&&e.propertyId===n));for(const{module:i,position:c}of y){const e=i.id,t=(0,a().Gc)(c.area);(0,I().H)({environment:r,sessionId:d,transaction:o,layoutStore:s,position:{area:t,moduleId:e}})}const v=m.getFormat().collection_page_sections;if(v){const e=v.filter((e=>e.section!==n));p().Do({store:_,pageSectionFormats:e,transaction:o,environment:r})}}},356117:(e,t,r)=>{r.d(t,{Uq:()=>m,Wb:()=>g});r(821057),r(267602),r(470928),r(30005);var o=()=>r(109477),n=()=>r(530980),a=()=>r(308240),i=()=>r(712185),s=()=>r(215134),c=()=>r(667932),l=()=>r(639708),d=()=>r(827370),p=()=>r(421654),u=()=>r(269299);function m(e){let{environment:t,transaction:r,layoutStore:o,position:c,updatedModule:l,sessionId:d}=e;const p=a().mt[c.area],m=o.getRawModules();if("form_conditional_modules"===p){const e=null==m?void 0:m[p];if(!(null==e?void 0:e[c.moduleId]))throw new Error("Unable to find module being updated.");return void u().createAndCommitOrAppend({environment:t,transaction:r,canUndo:!0,perform(e){u().applyOperation({transaction:e,store:o,operation:n().CIp.updateNestedModule(o.pointer,p,(0,i().cm)(l))})},userAction:"BuilderLayoutModules.updateModule"})}if(!m)throw new Error("Unable to find modules");const _=(0,s().mT)(m,(e=>e.id===c.moduleId));if(!_||_.area!==p)throw new Error("Unable to find module being updated.");u().createAndCommitOrAppend({environment:t,transaction:r,canUndo:!0,perform(e){u().applyOperation({transaction:e,store:o,operation:n().CIp.updateModuleInArea({pointer:o.pointer,module:(0,i().cm)(l),..."views_main_tab_modules"===_.area?{area:_.area,viewId:_.viewId}:{area:_.area}})})},userAction:"BuilderLayoutModules.updateModule"})}function _(e){var t,r,o;let{collectionStore:n,layoutStore:a}=e;const i=new Map,s=n.getFormat(),c=[...null===(t=a.getModules())||void 0===t?void 0:t.page_main,...null===(r=a.getModules())||void 0===r?void 0:r.page_details],d=new Map;null===(o=s.property_visibility)||void 0===o||o.forEach((e=>{d.set(e.property,e)})),c.forEach((e=>{if(!(0,l().LP)(e))return(0,l().f)(e)?(i.set(e.propertyId,{property:e.propertyId}),void d.set(e.propertyId,{property:e.propertyId,visibility:"show"})):void 0;e.propertyIds.forEach((e=>{i.set(e,{property:e}),d.set(e,{property:e,visibility:"show"})}))}));const p=n.getNormalizedPropertyGroups();var u;p?p.forEach((e=>{var t;null===(t=e.propertyIds)||void 0===t||t.forEach((e=>{i.has(e)||i.set(e,{property:e})}))})):null===(u=s.collection_page_properties)||void 0===u||u.forEach((e=>{i.has(e.property)||i.set(e.property,e)}));return{propertiesFormat:Array.from(i.values()),propertyVisibility:Array.from(d.values())}}function g(e){let{environment:t,transaction:r,collectionStore:a,layoutStore:i}=e;const{propertiesFormat:s,propertyVisibility:m}=_({collectionStore:a,layoutStore:i});u().createAndCommitOrAppend({environment:t,transaction:r,canUndo:!0,perform(e){const t=i.getBlockChildrenPointers(),r=i.firstModuleOfType("viewsMain");r&&(0,l().aJ)(r)&&t.find((e=>d().dr.isEqual(e,r.collection_view_block_pointer)))&&u().applyOperation({transaction:e,store:i,operation:n().CIp.removeBlockChild(i.pointer,r.collection_view_block_pointer.id)}),u().applyOperation({transaction:e,store:i,operation:n().CIp.setModulesByAreas(i.pointer,(0,c()._P)())}),u().applyOperation({transaction:e,store:i,operation:n().CIp.deleteFormat(i.pointer)});const _=a.getFormat(),{page_section_visibility:g}=_;p().FH({stores:[a],update:{property_groups:void 0,collection_page_properties:s,property_visibility:m,...g?{page_section_visibility:o().dN}:void 0},transaction:e})},userAction:"BuilderLayoutModules.resetLayoutToDefault"})}},772669:(e,t,r)=>{r.r(t),r.d(t,{deleteViewsModuleDependencies:()=>a});var o=()=>r(349220),n=()=>r(332542);function a(e){const{layoutStore:t,module:r,transaction:a}=e,i=(0,o().TO)(r.getCollectionViewBlockStore());n().hr({childStore:i,parentStore:t,transaction:a})}},590434:(e,t,r)=>{r.d(t,{m:()=>a});var o=()=>r(826955);class n{constructor(e,t){this.parentStore=e,this.impl=t}getType(){return this.impl.type}getCollectionViewBlockStoreWithParent(e){return o().G.createChildStore(e,this.impl.collection_view_block_pointer)}getCollectionViewBlockStore(){return this.getCollectionViewBlockStoreWithParent(this.parentStore)}getInitialCollectionViewPointer(){const e=this.getCollectionViewBlockStoreWithParent(this.parentStore).getCollectionViewPointers();if(e.length>0)return e[0]}getId(){return this.impl.id}isUnlistedView(){return!1}createCollectionViewContext(){const e=this.getCollectionViewBlockStoreWithParent(this.parentStore),t=this.getInitialCollectionViewPointer();if(!t)return;const r=o().Xr.createChildStore(e,t);return{type:"collectionView",collectionViewBlockStore:e,collectionStore:r.getCollectionStore(),collectionViewStore:r,pageVisitSourceOverride:void 0}}}function a(e,t){if("views"===t.type||"viewsMain"===t.type)return new n(e,t)}},438665:(e,t,r)=>{r.d(t,{zL:()=>u,lB:()=>m,ZF:()=>p,DV:()=>f,an:()=>_,n9:()=>y,WV:()=>g});var o=()=>r(799891),n=()=>r(741633);const a={plans_page:["lic_25","lic_50","resurrection_offer","ai_fifty_percent_upgrade"],sidebar_upsell:["lic_25","lic_50"]};var i=()=>r(792409),s=()=>r(824462),c=()=>r(308186),l=()=>r(594546),d=()=>r(876822);async function p(e,t){var r;const{spaceId:o,offerCampaign:n}=t;if(!o||!n||null===(r=d().default.state.currentSpaceStore)||void 0===r||!r.canAdmin())return;const a=await s().callApi({eventName:"getCustomerOffer",environment:e,data:{spaceId:o,offerCampaign:n}});return"failed"!==a.type&&"offer"in a.data&&a.data.offer?a.data.offer:void 0}async function u(e){const{environment:t,spaceId:r,offerCampaign:o,entrypoint:n}=e,a=await s().callApi({eventName:"applyCustomerOffer",environment:t,data:{spaceId:r,offerCampaign:o,entrypoint:n??"unknown"}});if("failed"!==a.type)return a;c().x2(a)}async function m(e,t){const r=await s().callApi({eventName:"applyCustomerOffer",environment:e,data:{...t}});if("failed"!==r.type)return r;c().x2(r)}async function _(e){const{environment:t,spaceId:r,offerCampaign:o}=e;return void 0!==await p(t,{spaceId:r,offerCampaign:o})}async function g(e){var t;const{environment:r,hasReceived:a,offerType:c,newPlan:l,coupon:p}=e,u=null===(t=d().default.state.currentSpaceStore)||void 0===t?void 0:t.getSpaceId();if(!u)return;const m=await s().callApi({eventName:"updateCustomerOffer",environment:r,data:{spaceId:u,hasReceived:a,offerType:c,newPlan:l,coupon:p},headers:(0,n().Bb)({cellId:void 0,spaceId:u})});"failed"===m.type&&o().log({level:"error",from:"offerActions",type:"updateLegacyCustomerOfferFailed",error:(0,i().Ui)(m.error)})}async function f(e,t,r){const o=function(e){if(a.hasOwnProperty(e))return a[e]}(r);if(o)for(const n of o){const r=await p(e,{spaceId:t,offerCampaign:n});if((null==r?void 0:r.campaign)===n)return r}}function y(e){let{environment:t,spaceName:r,offerCampaign:o}=e;if(r)switch(o){case"lic_25":case"lic_50":(0,l().lu)(t,"lic_offer_eligible","lic_offer_eligible",3600,{workspace_name:r,lic_25:"lic_25"===o,lic_50:"lic_50"===o});break;case"resurrection_offer":(0,l().lu)(t,"resurrection_offer_eligible","resurrection_offer_eligible",3600,{workspace_name:r});break;default:return}}},334510:(e,t,r)=>{r.r(t),r.d(t,{applyMultiplayerReverseTrialIfEligible:()=>l().jG,applyReversePlusTrial:()=>l().tY,handleTrialUpgradeFromOnboarding:()=>l().TQ,handleTrialUpgradeFromOnboardingImpl:()=>l().M_,isEligibleForBlockLimitTimedTrial:()=>c});var o=()=>r(575861),n=()=>r(629719),a=()=>r(518019),i=()=>r(444297),s=()=>r(438665);async function c(e,t){const r=await a().Z.awaitData(e,{spaceId:null==t?void 0:t.id});if("free"!==(0,n().zt)(null==r?void 0:r.subscription))return!1;const c=null==t?void 0:t.getSetting("reach_block_limit_time");if(!c||(0,o().O5)(c)<3)return!1;if(await(0,i().n)(e))return!1;const l=t.getSpaceId();return!!(await(0,s().an)({environment:e,spaceId:l,offerCampaign:"default"}))}var l=()=>r(125165)},548919:(e,t,r)=>{r.d(t,{D:()=>a,Qk:()=>s,we:()=>i});var o=()=>r(873463),n=()=>r(914575);function a(e){n().Z.setState({open:!0,...e})}function i(){n().Z.setState({open:!1})}function s(e){o().Z.setState({open:!0,...e})}},125165:(e,t,r)=>{r.d(t,{M_:()=>M,TQ:()=>P,jG:()=>U,tY:()=>E});r(821057);var o=()=>r(730120),n=(r(667294),()=>r(799891)),a=()=>r(629719),i=()=>r(976102),s=()=>r(681941),c=()=>r(788860),l=()=>r(792409),d=()=>r(342792),p=()=>r(979614),u=()=>r(824462),m=()=>r(308186),_=()=>r(594546),g=()=>r(876822),f=()=>r(518019),y=()=>r(749826),v=()=>r(801072),b=()=>r(444297),S=()=>r(576387),w=()=>r(438665),I=()=>r(254687),h=()=>r(548812),k=()=>r(18281),C=()=>r(419157),T=()=>r(897257),D=()=>r(723721),O=r(785893);async function M(e){var t,r;const{environment:l,stripe:d,elements:u,trialData:_,trialDays:y,sessionId:v,customerName:b,businessName:w}=e;if(!T().subscriptionDataStoreInstance.state)return void n().log({level:"error",from:"trialUpsellActions",type:"StripeError",error:{miscDataString:"Unable to get subscription data."}});if(!u||!d)return void n().log({level:"error",from:"trialUpsellActions",type:"StripeError",error:{miscDataString:"Stripe elements not initialized when user tried to upgrade"}});const{error:h}=await u.submit();if(h)return void p().iL(l,{error:"could not submit form",error_type:"payment_method"});const M=await d.createPaymentMethod({elements:u});if(M.error)return void p().iL(l,{error:M.error.message,error_type:"payment_method"});if(!M.paymentMethod)return void p().iL(l,{error:"could not create token",error_type:"payment_method"});const P={type:"paymentMethodId",value:M.paymentMethod.id},U=g().default.state.currentSpaceStore;if(!U)return;const E=U.id,N=await I().aQ({environment:l,spaceId:E}),A=await f().Z.awaitData(l,{spaceId:E});if(!A)throw new Error("Billing data not loaded");const R=(0,a().Lg)(A),V=C().Z.state.selectedCurrencyCode??"USD",x=(0,D().Hy)(),L=(0,s().Vj)({prices:N,quantity:1,domainsQuantity:0}),F={product:x,interval:"month",currency:V},j=(0,i().dP)(L,R,F),W=o().ou.now().plus({days:y});return await async function(e){const{environment:t,spaceStore:r,paymentData:o,desiredState:n,stripe:a,trialData:i,customerName:s,businessName:l,addressZip:d,addressCountry:u,sessionId:_}=e,g=await f().Z.awaitData(t,{spaceId:r.id});try{const e=await S().Mg({environment:t,sessionId:_,spaceStore:r,desiredState:n,paymentData:o,from:"onboarding",trialData:i,billingEmail:(0,k().pu)(g),customerName:s,businessName:l,addressZip:d,addressCountry:u}),p=e.paymentIntentClientSecret,f=e.paymentIntentStatus;if(p&&"requires_action"===f){const{error:e}=await a.handleNextAction({clientSecret:p});e&&(await S().EO({environment:t,spaceStore:r,from:"subscription_upgrade_onboarding_failed_payment"}),m().UW((0,O.jsx)(c()._H,{id:"subscription.upgrade.payment_failed",defaultMessage:"Your payment could not be processed. Please provide an alternate payment method or you will lose access to Notion."})))}return"success"}catch{return void p().Bg(t)}}({environment:l,spaceStore:U,desiredState:{...j,trialEnd:W},paymentData:P,stripe:d,subscriptionTier:(0,D().Hy)(),trialData:_,customerName:b,businessName:w,addressZip:(null===(t=M.paymentMethod.billing_details.address)||void 0===t?void 0:t.postal_code)||"",addressCountry:(null===(r=M.paymentMethod.billing_details.address)||void 0===r?void 0:r.country)||"",sessionId:v})}const P=(0,r(513670).Ds)(M,1e3,{leading:!0,trailing:!1});async function U(e){let{spaceId:t,environment:r}=e;if(await(0,w().an)({environment:r,spaceId:t,offerCampaign:"reverse"})&&(0,h().jK)(r)){await E(t,r,"going_multiplayer")&&await v().Z.resetData(r,{spaceId:t})}}async function E(e,t,r){let o="reverse";try{const n=await(0,b().n)(t),a=Boolean(y().default.checkGate({gateName:"apply_reverse_trial_key"}));n&&(o="reverse_mm_ent");const i=`${e}_timed_trial`,s=a?(0,d().Ul)(i):void 0,c=await u().callApi({eventName:"applyReverseTrial",environment:t,data:{spaceId:e,trialData:{id:o,from:r},idempotencyKey:s}});return"success"===c.type?((0,_().j)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:o,success:"success"===c.data.status}}}),await S().bi(t),"success"===c.data.status):(N(o,t,c.error),!1)}catch(n){return N(o,t,n),!1}}function N(e,t,r){(0,_().j)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:e,success:!1}}}),n().log({level:"error",from:"trialUpsellActions",type:"applyReverseTrialError",error:(0,l().Ui)(r)})}},873463:(e,t,r)=>{r.d(t,{Z:()=>o});const o=r(263184).default.createValue({open:!1},{name:"TrialEndModalStore"})},914575:(e,t,r)=>{r.d(t,{Z:()=>o});const o=r(263184).default.createValue({open:!1},{name:"TrialInfoModalStore"})},877727:(e,t,r)=>{r.d(t,{C3:()=>s,D:()=>c,QZ:()=>i,fo:()=>a});var o=()=>r(146947),n=()=>r(749826);function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n().default.checkGate({gateName:"packaging_m2_additional_entrypoints"})&&i(e,t)}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!e.device.isPhone&&s(t)}function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n().default.checkGate({gateName:"workflow_templates_prototype",...e})||"control"!==c(e)}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o().locale.startsWith("en-")||n().default.checkGate({gateName:"packaging_m2_localize_templates"})?n().default.getEligibleGroup({experimentId:"packaging_m2_entry_point",defaultGroup:"control",...e}):"control"}},999582:(e,t,r)=>{r.d(t,{Z:()=>a});class o extends(()=>r(263184))().default{getInitialState(){return{}}}const n=new o;r(947115).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",n);const a=n},184441:(e,t,r)=>{r.d(t,{default:()=>a});class o extends(()=>r(263184))().default{getInitialState(){return{open:!1,isShowingLoadingState:!1}}updateUserCustomizations(e,t){this.state.open&&this.state.collectionTemplate&&this.setState({...this.state,userCustomizations:{...this.state.userCustomizations,[e]:t}})}updateCollectionTemplate(e){this.state.open&&this.state.collectionTemplate&&this.setState({...this.state,collectionTemplate:e})}updatePreviewCollectionViewTemplateId(e){this.state.open&&this.state.collectionTemplate&&this.setState({...this.state,previewCollectionViewTemplateId:e})}getParentStore(){return this.state.open?this.state.parentStore:void 0}getShouldShowExpandedTemplateList(){return this.state.open&&this.state.shouldShowExpandedTemplateList}setShouldShowExpandedTemplateList(e){this.state.open&&this.setState({...this.state,shouldShowExpandedTemplateList:e})}close(e){var t,r;this.state.open&&(null===(t=(r=this.state).onClose)||void 0===t||t.call(r,e),this.setState({open:!1,isShowingLoadingState:!1}))}reset(){this.setState(this.getInitialState())}}const n=new o;(0,r(947115).exposeDebugValue)("InitializeWorkflowTemplateModalStore",n);const a=n},29488:(e,t,r)=>{function o(e){return`${e.table}:${e.id}`}r.d(t,{O:()=>o})},912203:(e,t,r)=>{r.d(t,{$M:()=>f,GQ:()=>I,Jy:()=>C,LF:()=>k,NO:()=>m,Of:()=>T,SF:()=>p,TX:()=>w,XO:()=>y,Y_:()=>d,Ym:()=>g,bD:()=>b,cO:()=>u,fo:()=>h,rR:()=>_});r(267602),r(653476),r(228244);var o=()=>r(513670),n=()=>r(696459),a=()=>r(226413),i=()=>r(109477),s=()=>r(455222),c=()=>r(305580);(0,n().AO)((e=>(0,n().$K)(e)&&(0,n().$K)(e.target)&&(0,n().$K)(e.external_bot_id)?{true:{external_bot_id:e.external_bot_id,target:e.target}}:{false:e}));const l={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1},d={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function p(e){return Boolean(l[e.type]&&!(0,a().NK)(e)&&(!(0,a().qQ)(e)||void 0===(0,a().q3)(e)))}function u(e){const{collectionFormat:t,collectionSchema:r,filter:s,sort:l,sourcePropertyIds:d}=e,u=(d??(0,n().Yd)(r)).filter(((t,o,n)=>{const i=r[t];return!(!i||!p(i))&&(("relation"!==i.type||!e.restrictCrossSpace||!(0,a().Qh)(e.spaceId,i))&&(!s||s([t,i],o,r)))}));if(0===u.length)return[];if(!t||!1===l)return u;const m=(0,c().i)(t,r,void 0,i().j5.Page).collection_page_properties||[];return o().MR(u,(e=>m.findIndex((t=>t.property===e))))}function m(e){const{collectionFormat:t,collectionSchema:r,sort:s}=e,l=(0,n().Yd)(r).filter(((e,t,o)=>{const n=r[e];return!(!n||!(0,a().U8)(n))}));if(0===l.length)return[];if(!t||!1===s)return l;const d=(0,c().i)(t,r,void 0,i().j5.Page).collection_page_properties||[];return o().MR(l,(e=>d.findIndex((t=>t.property===e))))}function _(e){return e.type===s().$E.InvalidCharacter?{type:e.type,character:e.character}:e.type===s().$E.TokenExpected?{type:e.type,token:e.token}:e.type===s().FY.MissingSchemaPropertyOnThisRow||e.type===s().FY.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===s().FY.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection}:e.type===s().FY.MissingContextVariable?{type:e.type,valueId:e.valueId}:e.type===s().FY.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments}:e.type===s().FY.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex}:e.type===s().FY.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex}:e.type===s().FY.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer}:e.type===s().FY.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer}:e.type===s().FY.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection}:e.type===s().FY.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===s().FY.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType}:e.type===s().FY.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes}:e.type===s().FY.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name}:{type:e.type}}const g={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1};function f(e){return Boolean(g[e.type])}function y(e){const{collectionFormat:t,collectionSchema:r,filter:s,sort:l}=e,d=(0,n().Yd)(r).filter(((e,t,o)=>{var n;const i=r[e];return!(!i||!g[i.type])&&((!(0,a().qQ)(i)||null===(n=(0,a().q3)(i))||void 0===n||!n.auto_update_on_edit)&&(!s||s([e,i],t,r)))}));if(0===d.length)return[];if(!t||!1===l)return d;const p=(0,c().i)(t,r,void 0,i().j5.Page).collection_page_properties||[];return o().MR(d,(e=>p.findIndex((t=>t.property===e))))}const v={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1};function b(e){return v[e.type]}const S={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1};function w(e){return S[e.type]}function I(e){return 0===e}function h(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function k(e){const{property:t,collectionSchema:r}=e;return!!r&&!r[t]}function C(e){const{collectionSchema:t,property:r,type:o}=e,n=null==t?void 0:t[r];return!n||("action"===o?!p(n):!g[n.type])}function T(e){let{automationTrigger:t,collectionSchema:r}=e;if("event"===(null==t?void 0:t.type)||"notification_event"===(null==t?void 0:t.type)){const{pagesAdded:e,pagePropertiesEdited:o,source:a}=t.event;if(void 0===a)return!1;const i="some"===o.type&&o.some,s="all"===o.type&&o.all;if((i||s||[]).some((e=>k({collectionSchema:r,property:e.property})||C({collectionSchema:r,property:e.property,type:"trigger"}))))return!1;const c="some"===o.type&&(!(0,n().$K)(o.some)||0===o.some.length),l="all"===o.type&&(!(0,n().$K)(o.all)||0===o.all.length);if(!e&&("none"===o.type||c||l))return!1}else{if("recurrence"!==(null==t?void 0:t.type))return!1;if(!t.recurrence)return!1}return!0}},157955:(e,t,r)=>{r.r(t),r.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>M,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>I,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>w,MAX_RECURRENCE_INTERVAL:()=>f,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>y,RRULE_WEEKDAYS_MAP:()=>g,convertFromUnpersistedRecurrenceConfig:()=>E,convertToUnpersistedRecurrenceConfig:()=>P,getFormattedEndCondition:()=>O,getFormattedNextRecurrenceTime:()=>D,getNextDateUtc:()=>T,getRecurrenceAfter:()=>k,isRunningBetweenMidnightAnd3AM:()=>C,isValidRecurrenceInterval:()=>v,isValidRecurrenceNumberOfRuns:()=>b,rruleFromRecurrence:()=>S,templateAncestorsViolateRecurrenceNesting:()=>h});r(267602),r(653476),r(241792);var o=()=>r(730120);r(670560);function n(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];if(0===r.length)return e.map((e=>[e]));const a=[];for(const i of e)a.push(...n(r[0],...r.slice(1)).map((e=>[i,...e])));return a}var a=()=>r(696459),i=()=>r(326966),s=()=>r(803021),c=()=>r(646574),l=()=>r(998411),d=()=>r(578292);class p extends(()=>r(484885))().Ci{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var u=()=>r(494616);const m=(0,r(788860).vU)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12–3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),_={day:p.DAILY,week:p.WEEKLY,month:p.MONTHLY,year:p.YEARLY},g={MO:p.MO,TU:p.TU,WE:p.WE,TH:p.TH,FR:p.FR,SA:p.SA,SU:p.SU},f=99,y=999;function v(e){return(0,i().hj)(e)&&Number.isInteger(e)&&e>0&&e<=f}function b(e){return(0,i().hj)(e)&&Number.isInteger(e)&&e>0&&e<=y}function S(e){const{start_date:t,frequency:r,interval:o,weekdays:i,timezone:c,hour:l,minute:d}=e,u="week"===r&&i?i.map((e=>g[e])):void 0,m={};return(0,a().$K)(e.end_condition)&&("date"===e.end_condition.type?m.until=(0,s().pd)(e.end_condition.end_at):"number"===e.end_condition.type?m.count=e.end_condition.number_of_occurrences:(0,a().t1)(e.end_condition)),"month"===e.frequency&&(0,a().$K)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?m.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?m.byweekday=n(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,r]=e;return g[t].nth(r)})):(0,a().t1)(e.monthly_restriction)),new p({freq:_[r],dtstart:(0,s().pd)(t),interval:o,byweekday:u,tzid:c,byhour:l??0,byminute:d??0,bysecond:0,...m})}const w=1,I=1;function h(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const r=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),o=e.length,n=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,a=o>w,i=r.length>=I;return{violatesConstraint:a||i,templateNestingExceedsMaxDepth:a,ancestorHasDailyTemplate:i,nestedDepthOfAutomationAncestors:o,immediateAncestorRecurrenceType:n}}function k(e){const{recurrence:t,afterDate:r}=e;if((0,u().nA)(t)){const e=(0,s().kq)(r);return t.start_date>=e?new Date(t.start_date):void 0}{const e=S(t).after((0,s().pd)(r));if(!e)return;return(0,s().YL)(e)}}function C(e){return 0===e.hour||1===e.hour||2===e.hour}function T(e){return S(e).after((0,s().pd)((0,s().Jh)()))||void 0}function D(e){const{recurrence:t,intl:r}=e,n=T(E(t));if(!n)return;const a=C(t),i=o().ou.fromJSDate(n).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,d().E2)(r)).setZone(t.timezone),s=(0,c().p6)({date:i,dateFormat:"relative",allowRelativeDates:!0,intl:r,shortenDate:!0});if(a)return r.formatMessage(m.dateBetweenMidnightAnd3AM,{date:s});{let e=i.toLocaleString(o().ou.TIME_SIMPLE);return t.timezone!==(0,l().r)()&&(e+=` ${i.toFormat("ZZZZ")}`),r.formatMessage(m.dateAtTime,{date:s,time:e})}}function O(e,t){return(0,a().$K)(e)?"number"===e.type?t.formatMessage(m.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,c().p6)({date:o().ou.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().t1)(e):t.formatMessage(m.noEndCondition)}const M=100;function P(e){return{...e,start_date:(0,s().kq)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,s().kq)(e.end_condition.end_at)}:(0,a().t1)(e.end_condition):void 0}}function U(e,t){const r=o().ou.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,s().Jh)(r.toJSDate())}}function E(e){return{...e,start_date:(0,s().Jh)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?U(e,e.end_condition):(0,a().t1)(e.end_condition):void 0}}},519454:(e,t,r)=>{r.d(t,{R:()=>n});r(667294);var o=r(785893);const n=(0,r(827282).IU)("pencil",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M3.926 13.307H14.11c.183 0 .34-.066.472-.199a.644.644 0 00.198-.471.652.652 0 00-.198-.479.644.644 0 00-.472-.198H5.272l-1.346 1.347zm-.704-.636l7.683-7.684-1.312-1.319-7.69 7.684-.67 1.606c-.037.1-.017.191.06.273.083.082.174.105.274.069l1.655-.63zm8.34-8.326l.738-.732c.182-.187.278-.376.287-.567.009-.192-.068-.374-.232-.547l-.267-.267c-.169-.168-.351-.246-.547-.232-.196.014-.385.11-.567.287l-.739.732 1.327 1.326z"})})},667932:(e,t,r)=>{r.d(t,{KD:()=>c,_P:()=>d,l2:()=>p,x9:()=>l});r(267602),r(653476),r(241792);var o=()=>r(543172),n=()=>r(210349),a=()=>r(639708),i=()=>r(712185);const s={page_main:[{id:"cover",type:"cover"},{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyIds:[]},{id:"properties",type:"properties"},{id:"discussions",type:"discussions"},{id:"editor",type:"editor"}],page_details:[],form_layout_schema:[]},c={page_main:[{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyIds:[]},{id:"editor",type:"editor"}],page_details:[],form_layout_schema:[]};function l(e){return(0,i().Dl)({modulesByArea:s,collectionSchema:null==e?void 0:e.collectionSchema,collectionFormat:null==e?void 0:e.collectionFormat})}function d(){return{page_layout_schema:(0,i().L0)(s.page_main).map((e=>{if(!(0,a().zP)(e))return(0,n().T)(e)?{...e,id:(0,o().ZP)()}:e})).filter((e=>void 0!==e)),page_info_layout_schema:(0,i().L0)(s.page_details).map((e=>{if(!(0,a().zP)(e))return(0,n().T)(e)?{...e,id:(0,o().ZP)()}:e})).filter((e=>void 0!==e)),form_layout_schema:void 0}}function p(e,t){const r=void 0===t?[{id:(0,o().ZP)(),type:"formQuestion",formQuestionId:e}]:[{id:(0,o().ZP)(),type:"formQuestion",formQuestionId:e},{id:(0,o().ZP)(),type:"formQuestion",formQuestionId:t}];return{page_layout_schema:void 0,page_info_layout_schema:void 0,form_layout_schema:[{id:(0,o().ZP)(),type:"cover"},{id:(0,o().ZP)(),type:"formTitle"},...r,{id:(0,o().ZP)(),type:"formSubmit"}]}}},210349:(e,t,r)=>{r.d(t,{T:()=>i,s:()=>a});const o={normalizedTitleWithIcon:!0,properties:!0,property_number:!0,property_title:!0,property_person:!0,property_file:!0,property_text:!0,property_checkbox:!0,property_url:!0,property_email:!0,property_phone_number:!0,property_created_by:!0,property_last_edited_by:!0,property_button:!0,property_select:!0,property_multi_select:!0,property_status:!0,property_date:!0,property_created_time:!0,property_last_edited_time:!0,property_last_visited_time:!0,property_relation:!0,property_rollup:!0,property_formula:!0,property_auto_increment_id:!0,property_location:!0,property_verification:!0,views:!0,viewsMain:!0,relationsGroup:!0,formQuestion:!0,placeholder:!0,deleted_property:!1,cover:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,editor:!1,transcript:!1,formTitle:!1,formSubmit:!1},n={properties:!0,property:!0,relationsGroup:!0,formQuestion:!0,placeholder:!0,titleWithIcon:!0,cover:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,editor:!1,transcript:!1,formTitle:!1,formSubmit:!1,views:!0,viewsMain:!0,collectionView:!0,collectionViewV2:!0};function a(e,t){return!("editor"!==e.type||null==t||!t.isLayoutViewModuleEnabled||null!=t&&t.isLayoutViewModuleNextEnabled)||o[e.type]}function i(e){return n[e.type]}},6623:(e,t,r)=>{r.d(t,{Fo:()=>a,m7:()=>i});const o={property_number:!0,property_title:!0,property_person:!0,property_file:!0,property_text:!0,property_checkbox:!0,property_url:!0,property_email:!0,property_phone_number:!0,property_created_by:!0,property_last_edited_by:!0,property_button:!0,property_select:!0,property_multi_select:!0,property_status:!0,property_date:!0,property_created_time:!0,property_last_edited_time:!0,property_last_visited_time:!0,property_relation:!0,property_rollup:!0,property_formula:!0,property_auto_increment_id:!0,property_location:!0,property_verification:!0,deleted_property:!1,relationsGroup:!0,formSubmit:!0,formQuestion:!0,formTitle:!0,placeholder:!0,transcript:!0,cover:!1,normalizedTitleWithIcon:!1,properties:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,editor:!1,views:!0,viewsMain:!1},n={property_number:!0,property_title:!0,property_person:!0,property_file:!0,property_text:!0,property_checkbox:!0,property_url:!0,property_email:!0,property_phone_number:!0,property_created_by:!0,property_last_edited_by:!0,property_button:!0,property_select:!0,property_multi_select:!0,property_status:!0,property_date:!0,property_created_time:!0,property_last_edited_time:!0,property_last_visited_time:!0,property_relation:!0,property_rollup:!0,property_formula:!0,property_auto_increment_id:!0,property_location:!0,property_verification:!0,deleted_property:!1,formSubmit:!1,formQuestion:!1,formTitle:!1,placeholder:!1,transcript:!1,cover:!1,normalizedTitleWithIcon:!1,properties:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,relationsGroup:!0,editor:!1,views:!1,viewsMain:!1};function a(e){return o[e.type]}function i(e){return n[e.type]}}}]);