"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[26534],{587262:(e,t,o)=>{o.r(t),o.d(t,{COLLAPSE_THRESHOLD_IN_PIXELS:()=>X,FloatingTableOfContents:()=>N,FloatingTableOfContentsFullSizeContents:()=>ee,FloatingTableOfContentsMiniContents:()=>oe});o(267602),o(470928),o(241792);var n=o(667294),i=()=>o(387934),r=()=>o(219727),a=()=>o(142735),l=()=>o(846550),s=()=>o(494488),d=()=>o(970381),c=()=>o(467171),u=()=>o(492522),g=()=>o(954452),p=()=>o(958783),f=()=>o(58836),h=()=>o(628370),v=()=>o(729775),x=()=>o(384241),S=()=>o(939513),m=()=>o(247724),y=()=>o(942226),b=()=>o(84080),C=()=>o(480089),w=()=>o(333264),R=()=>o(704713),k=()=>o(466970),M=()=>o(309797),T=()=>o(857719),_=()=>o(639708),j=()=>o(472753),K=()=>o(128076);var V=()=>o(521635),O=()=>o(32969),H=()=>o(589525),I=()=>o(998901),B=()=>o(35982),L=()=>o(252097),P=()=>o(687647),F=()=>o(749826),A=()=>o(482162),E=()=>o(797522),z=()=>o(965903),D=()=>o(825559),Z=()=>o(846728);class G extends(()=>o(263184))().default{getInitialState(){return{displayState:"expanded"}}}var $=o(785893);const X=310,Y=!1;function N(e){const{store:t}=e,o=(0,r().O7)(),n=(0,a().VK)((()=>o.device.isMobile),[o]),i=(0,k().E)("floating_table_of_contents"),{navigableAncestorStore:l}=(0,D().m)({parentStore:t}),s=(0,a().VK)((()=>(0,y().wq)(t)),[t]),d=(0,a().VK)((()=>{const e=null==l?void 0:l.getModel();return i&&e&&"off"!==e.getFloatingTableOfContentsState()}),[i,l]),{isSidePeekOpen:c,isCenterPeekOpen:u}=(0,a().VK)((()=>({isSidePeekOpen:A().default.isSidePeekOpen(),isCenterPeekOpen:A().default.isCenterPeekOpen()})),[]),f=(0,a().VK)((()=>(0,H().Sx)(o)),[o]),h=(0,a().VK)((()=>V().Z.getPanelState("peek").isOpen),[]),v=(0,a().VK)((()=>L().d.state.open&&"chat"===L().d.state.currentView),[]),x=(S=t,(0,a().VK)((()=>{var e,t;const o=null===(e=S.getAssociatedCollectionStore())||void 0===e?void 0:e.getLayoutStore();if(!o)return!1;const n=o.firstModuleOfType("viewsMain");if(!n||!(0,_().aJ)(n))return!1;const i=K().G.createChildStore(o,n.collection_view_block_pointer);if(!i)return!1;const r=j().R.findCollectionViewBlockFromId(i.id),a=null==r||null===(t=r.collectionContextStore)||void 0===t?void 0:t.collectionViewStore();return a&&"page"!==a.getType()}),[S]));var S;const m=(0,a().VK)((()=>(0,g().fg)(o,t)&&(P().Z.state.open||p().default.state.open)),[o,t]);return!d||n||x||!s&&(c||f||v||m)||s&&(c||u&&h)?null:(0,$.jsx)(W,{store:e.store})}function W(e){const{store:t}=e,o=(0,n.useRef)(null),s=(0,a().qz)(void 0,G),{verticalScroller:d}=(0,n.useContext)(S().U)??{},{navigableAncestorStore:g,headerStores:p}=(0,D().m)({parentStore:t}),h=(0,r().O7)(),v=(0,a().VK)((()=>"floating_right"===F().default.getEligibleGroup({experimentId:"floating_table_of_contents_variants",defaultGroup:"control"})),[]),{closestSelectable:x,targetHorizontalRule:y}=(0,a().VK)((()=>{var e;if(!d)return{};const t=(null==d?void 0:d.getStore()).state.clientRect??d.getClientRect(),{selectableRectMap:o}=E().default.state,n=t&&t.top+t.height/4,i=O().C.findScrollToSelectablesFromIds(p.map((e=>e.id))),r=new Map(i.map((e=>[e.props.store.id,e]))),{stores:a,phase:l}=z().default.state,s=l===z().SelectionPhase.Selected?a.find((e=>r.has(e.id))):void 0,c=s&&r.get(s.id),u=c&&o.get(c);if(u&&t&&B().kK(u,t))return{closestSelectable:c,targetHorizontalRule:n};let g;if(void 0!==n)for(const d of i){const e=o.get(d);if(!e)continue;const t=e.top+e.height/2,i=Math.abs(n-t);(!g||i<g.distance)&&(g={distance:i,selectable:d})}return{targetHorizontalRule:n,closestSelectable:null===(e=g)||void 0===e?void 0:e.selectable}}),[p,d]),b=(0,R().X)(o,10),C=(0,a().VK)((()=>{var e;return null==g||null===(e=g.getModel())||void 0===e?void 0:e.getFloatingTableOfContentsState()}),[g]);(0,n.useEffect)((()=>{const e=!!b&&b.width>X,t="minimal"===C||v;s.setState({...s.state,displayState:e&&!t?"expanded":"collapsed_narrow"})}),[s,b,C,null==b?void 0:b.width,v]);const w=(0,M().WJ)(t),k=(0,a().VK)((()=>s.state.displayState),[s]);(0,n.useEffect)((()=>{Y&&y&&(0,i().yX)({top:y-3,bottom:y+3,left:0,width:9e3},"active header target")}));const _=(0,l().yK)((()=>({outerContainer:{position:"absolute",top:0,width:`calc(100% - ${v?0:w}px)`,height:`calc(100vh - ${c().R6(h.device.isElectronMac)}px)`,display:"flex",flexDirection:"column",pointerEvents:v?"none":void 0},viewportHeightContainer:{display:"flex"}})),[h.device.isElectronMac,w,v]),[j,K]=function(e){const t=(0,n.useRef)(null),o=(0,a().VK)((()=>{var o;const n=E().default.state.selectableRectMap,i=null===(o=t.current)||void 0===o?void 0:o.getBoundingClientRect();if(!i)return!1;for(const[t,r]of n)if(t.getContextSelectableContainer()===z().default.getCurrentDefaultContainer()&&"collection_view"!==t.props.store.getType()&&!t.props.ignoreForTocSelectionIntersection&&B().kK(r,i)){const o=t.props.store.getRecordStoreUIRoot();return e===o}return!1}),[e]);return[t,o]}(e.store),V={store:t,navigableAncestorStore:g,scrollTargetY:y,activeBlockId:null==x?void 0:x.props.store.id,headerStores:p,floatingTocStore:s};if(p.length<2&&"minimal"===C)return null;const H=v?T().Vw:T().bj;return(0,$.jsxs)(H,{style:{width:`calc(100% - ${v?0:46}px)`,gridRow:"1 / -1",paddingLeft:w,position:"sticky",top:0,right:v?0:void 0,zIndex:u().O9,transition:"opacity 0.2s ease",opacity:K?0:1,visibility:K?"hidden":"visible",pointerEvents:K?"none":"auto"},children:[(0,$.jsx)("div",{style:{width:"100%",height:0},ref:o}),(0,$.jsx)("div",{className:`hide-scrollbar ${m().hBn} ${m().lUC}`,style:_.outerContainer,children:(0,$.jsx)("div",{style:_.viewportHeightContainer,children:(0,$.jsx)(f().p,{allowSelectionWithin:!0,style:{width:"100%"},children:"expanded"===k?(0,$.jsx)(J,{ref:j,...V}):(0,$.jsx)(U,{...V,ref:j})})})})]})}const U=n.forwardRef((function(e,t){const i=(0,r().O7)(),{floatingTocStore:s}=e,d=(0,n.useRef)(null),c=(0,o(527327).sH)(),u=(0,a().VK)((()=>F().default.getEligibleGroup({experimentId:"floating_table_of_contents_variants",defaultGroup:"control"})),[]),g="floating_right"===u,p="hug_content_left"===u,f=(0,n.useRef)(),v=(0,a().VK)((()=>e=>{var t;(o(819828).Z.setState({isHovered:e}),s.setState({...s.state,displayState:e?"collapsed_full":"collapsed_narrow"}),e)&&(f.current=null===(t=d.current)||void 0===t?void 0:t.getBoundingClientRect(),(0,o(594546).j)({environment:i,event:{eventName:"open_page_table_of_contents",eventProperties:{}}}))}),[i,s]),x=(0,a().VK)((()=>"collapsed_narrow"===s.state.displayState),[s]),S=(0,l().yK)((()=>({miniSizeContainer:{width:56,display:"flex",flexDirection:"column",justifyContent:"center",paddingBottom:12,paddingRight:8}})),[]),{verticalOffsetInPx:m,maxHeightForFullSizeToc:y,maxHeightForCollapsedToc:C}=le(e.store,s),w=(0,n.useCallback)((e=>({opacity:e?1:0})),[]);return(0,$.jsxs)("div",{style:{maxHeight:y,marginBottom:60,...g?{pointerEvents:"auto"}:{}},onMouseLeave:()=>v(!1),children:[(0,$.jsx)(h().Z,{animate:w(x),style:{maxHeight:C,display:"flex",flexDirection:"row",position:"absolute",top:m,...g||p?{right:0}:{},overflowY:"hidden"},onMouseMove:b().V,children:(0,$.jsx)("div",{ref:c(d,t),style:S.miniSizeContainer,onMouseOver:()=>{v(!0)},children:(0,$.jsx)(oe,{...e})})}),(0,$.jsx)(h().Z,{tag:q,visible:!x,animate:{translateX:0,opacity:1},initial:{translateX:g?10:-10,opacity:0},exit:{translateX:g?10:-10,opacity:0},floatingTableOfContentsOnRightSide:g,originRect:f.current,onMouseLeave:()=>v(!1),contentProps:e,maxHeightForFullSizeToc:y})]})})),q=n.forwardRef((function(e,t){let{floatingTableOfContentsOnRightSide:n,originRect:i,contentProps:r,maxHeightForFullSizeToc:a,onMouseLeave:s,style:d}=e;const c=(0,l().yK)((e=>({fullSizeContainer:{width:242,display:"flex",flexDirection:"row",alignItems:"center",padding:"12px 12px 0 12px",marginRight:10,backgroundColor:e.contentBackground,boxShadow:e.largeLightBoxShadow,border:`1px solid ${e.lightDividerColor}`,borderRadius:14,position:"relative",overflowY:"auto"}})),[]);return(0,$.jsx)(o(967092).ZP,{preventCaptureEsc:!0,preventScaleTransition:!0,preventOpacityTransition:!0,popupType:o(104088).k.Popup,originGap:-56,alignmentToOrigin:I().Alignment.Start,open:!0,placementToOrigin:n?I().Placement.Left:I().Placement.Right,originRect:i,style:{background:void 0,boxShadow:void 0,overflow:void 0,marginTop:-10},render:()=>(0,$.jsx)("div",{style:{display:"flex",flexDirection:"row",width:258,paddingLeft:16,cursor:"default",...d},onMouseMove:e=>{(0,b().V)(e),e.stopPropagation()},onMouseLeave:s,ref:t,children:(0,$.jsx)("div",{style:c.fullSizeContainer,children:(0,$.jsx)(ee,{...r,fillBackground:!0,maxHeight:a})})})})})),J=n.forwardRef((function(e,t){const{store:o,floatingTocStore:n}=e,{verticalOffsetInPx:i,maxHeightForFullSizeToc:r}=le(o,n),l=(0,a().VK)((()=>"floating_right"===F().default.getEligibleGroup({experimentId:"floating_table_of_contents_variants",defaultGroup:"control"})),[]);return(0,$.jsx)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"end",...l?{pointerEvents:"auto"}:{}},children:(0,$.jsx)("div",{ref:t,onMouseMove:b().V,style:{position:"absolute",top:i,marginRight:60,width:250,overflowY:"auto",maxHeight:r},className:"hide-scrollbar",children:(0,$.jsx)(ee,{...e,maxHeight:r})})})}));function Q(e){const t=(0,a().VK)((()=>d().y({headerBlockId:e.headerStore.id,headerBlockIds:e.headerStores.map((e=>e.id)),index:e.index,getRecordModel:e.store.getRecordModel})),[e.headerStore.id,e.headerStores,e.index,e.store.getRecordModel]),o=(0,C().rv)(e.store),i=(0,l().yK)((n=>({container:{...o,cursor:"pointer",width:"100%",paddingBottom:e.isLast?12:void 0,color:e.isActive?n.text.uiBluePrimary:n.text.secondary,transition:"color 0.15s ease"},linkBoxHovered:{background:n.tint.regular,borderRadius:4,color:e.isActive?n.text.uiBluePrimary:n.text.primary},nameContainer:{display:"flex",alignItems:"center",marginLeft:12*t},name:{paddingRight:s().ZD.paddingRight,paddingLeft:s().ZD.paddingLeft,fontSize:13,lineHeight:1.3,display:"flex",alignItems:"center",padding:4}})),[o,t,e.isActive,e.isLast]),r=(0,Z().R)({pageStore:e.navigableAncestorStore,scrollToBlockId:e.headerStore.id,isFloatingToc:!0}),[c,u]=(0,n.useState)(!1);return e.navigableAncestorStore?(0,$.jsx)(v().Z,{style:{...i.container,...e.style},href:r.href,onClick:r.onClick,external:!1,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),hovered:!1,pressedStyle:{background:"none"},ignoreLocalHoverState:!0,children:(0,$.jsx)("div",{style:{...i.nameContainer,...c?i.linkBoxHovered:{}},children:(0,$.jsx)("div",{style:i.name,children:(0,$.jsx)(x().Z,{store:e.headerStore,shouldWrap:!0,underline:!1,maxLines:2})})})}):null}function ee(e){const{headerStores:t,navigableAncestorStore:o,maxHeight:n}=e,i=(0,l().yK)((e=>({container:{maxWidth:500,maxHeight:n,width:"100%",cursor:"default"},fillContainer:{padding:6,maxWidth:500,maxHeight:n,width:"100%",cursor:"default"}})),[n]);return(0,$.jsx)("div",{onMouseMove:b().V,style:e.fillBackground?i.fillContainer:i.container,children:t.map(((n,i)=>(0,$.jsx)(Q,{headerStore:n,index:i,isLast:i===t.length-1,headerStores:t,store:e.store,navigableAncestorStore:o,isActive:n.id===e.activeBlockId,scrollTargetY:e.scrollTargetY},n.id)))})}function te(e){const t=(0,a().VK)((()=>d().y({headerBlockId:e.headerStore.id,headerBlockIds:e.headerStores.map((e=>e.id)),index:e.index,getRecordModel:e.store.getRecordModel})),[e.headerStore.id,e.headerStores,e.index,e.store.getRecordModel]),o=(0,l().yK)((o=>{const n=o.accentColors.gray[800],i="dark"===o.mode&&e.isActive;return{lineContainer:{backgroundColor:e.isActive?n:o.fill.grayPrimary,height:2,width:16-4*t,transition:"background 0.2s ease, box-shadow 0.2s ease",boxShadow:i?`0px 0px 3px ${n}`:"none",borderRadius:2,marginLeft:4*t}}}),[t,e.isActive]);return e.navigableAncestorStore?(0,$.jsx)("div",{children:(0,$.jsx)("div",{style:o.lineContainer})}):null}function oe(e){const{headerStores:t,navigableAncestorStore:o}=e,n=(0,l().yK)((()=>({container:{display:"flex",flexDirection:"column",gap:12,paddingLeft:20,paddingBottom:12,height:"100%"}})),[]);return(0,$.jsx)("div",{style:n.container,onMouseMove:b().V,children:t.map(((n,i)=>(0,$.jsx)(te,{headerStore:n,index:i,headerStores:t,store:e.store,navigableAncestorStore:o,isActive:n.id===e.activeBlockId},n.id)))})}const ne=113,ie=600,re=18,ae=130;function le(e,t){const{verticalScroller:o}=(0,n.useContext)(S().U)??{},i=null==o?void 0:o.getStore(),r=(0,a().VK)((()=>(null==i?void 0:i.state.elementRef)??{current:null}),[i]),l=(0,w().j)(r),s=(0,w().$0)(r),d=(0,a().VK)((()=>{const t=O().C.findNodeFromBlockId(e.id),o=null==i?void 0:i.state;if(E().default.state.selectableElementRectMap,o&&t)return Math.max(t.offsetTop-l+re,ae)}),[e,i,l]),c=(0,a().VK)((()=>t.state.displayState),[t]),u=s&&d?s-d-("expanded"!==c?80:0):ie;return{maxHeightForFullSizeToc:u,maxHeightForCollapsedToc:Math.min(400,u),verticalOffsetInPx:d||ne}}}}]);