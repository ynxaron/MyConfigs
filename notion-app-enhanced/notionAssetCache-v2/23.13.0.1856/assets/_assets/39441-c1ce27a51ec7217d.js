"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[39441],{877807:(e,t,i)=>{i.d(t,{mX:()=>v,mo:()=>h,nH:()=>f});i(241792),i(667294);var n=()=>i(142735),s=()=>i(846550),o=()=>i(933868),r=()=>i(788860),a=()=>i(696459),d=()=>i(707513),l=()=>i(779733),c=()=>i(520849),u=()=>i(876822),m=()=>i(842574),p=()=>i(204642),g=i(785893);function h(e){const{openState:t}=e,{mainEditorCurrentBlockStore:i,currentSpaceStore:o}=(0,n().VK)((()=>{const{mainEditorCurrentBlockStore:e,currentSpaceStore:t}=u().default.state;return{mainEditorCurrentBlockStore:e,currentSpaceStore:t}}),[]),r=(0,n().VK)((()=>(0,l().wZ)()),[]),a=(0,s().yK)((e=>({scroller:{display:"flex",flexDirection:"column",maxHeight:290,...r?{border:`1px solid ${e.lightDividerColor}`,borderRadius:6,paddingTop:8,paddingLeft:12,paddingRight:12,paddingBottom:12,marginTop:15,marginBottom:5,marginLeft:-12,marginRight:-12}:{}},editContainer:{marginTop:2,marginBottom:2,color:e.regularTextColor}})),[r]);if(!i||!o)return null;const d=Date.now();return(0,g.jsx)(m().Z,{type:c().Z.Y,style:a.scroller,children:t.permissionChanges.map(((e,t)=>{let[n,s]=e;const r={timestamp:d,space_id:o.id,type:"permission-changed",permission_data:{before:n,after:s}};return(0,g.jsx)("div",{style:a.editContainer,children:(0,g.jsx)(p().Z,{rootStore:i,edit:r})},`${n.type}-${t}`)}))})}function f(e,t){return["remove","restrict"].includes(e.type)?t?(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.actionButton.restrictAccessV2",defaultMessage:"Change and unlink"}):(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.actionButton.restrictAccess",defaultMessage:"Restrict access"}):t?(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.actionButton.relink",defaultMessage:"Relink"}):"restoreTeamPermissions"===e.type?(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.actionButton.restoreTeamPermissions",defaultMessage:"Reset Permissions"}):(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.actionButton.restoreAccess",defaultMessage:"Restore access"})}function v(e,t){switch(e.type){case"remove":return t?(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.remove.descriptionV2",defaultMessage:"Change access and unlink share settings from parent page?"}):(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.restrict.description",defaultMessage:"Are you sure you want to remove this {permissionGroup} and restrict access? This page will no longer inherit share settings from the parent page.",values:{permissionGroup:C(e)}});case"restrict":return t?(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.remove.descriptionV2",defaultMessage:"Change access and unlink share settings from parent page?"}):(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.remove.description",defaultMessage:"Are you sure you want to change this role and restrict access? This page will no longer inherit share settings from the parent page."});case"restore":return t?(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.relink.description",defaultMessage:"Relink share settings?"}):e.permissionChanges.length>0?(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.restore.description",defaultMessage:"Are you sure you want to restore access? This will inherit the following permissions from the parent page:"}):(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.restoreNoChanges.description",defaultMessage:"Are you sure you want to restore access?"});case"restoreTeamPermissions":return t?(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.relink.description",defaultMessage:"Relink share settings?"}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{style:{fontWeight:d().Ue.semibold,marginBottom:4},children:(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.restoreTeamPermissions.mainDescription",defaultMessage:"Are you sure you want to reset permissions to match the teamspace defaults?"})}),(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.restoreTeamPermissions.warningMessage",defaultMessage:"Everyone else who is not part of the teamspace will lose access, including guests."})]});default:throw a().t1(e)}}function C(e){return(0,o().jg)(e.permissionItem)?(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.permissionGroup.user",defaultMessage:"user"}):(0,o().hV)(e.permissionItem)?(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.permissionGroup.group",defaultMessage:"group"}):(0,o().Ir)(e.permissionItem)?(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.permissionGroup.space",defaultMessage:"workspace"}):(0,g.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.permissionGroup.generic",defaultMessage:"permission"})}},985481:(e,t,i)=>{i.d(t,{k:()=>s});i(667294);var n=i(785893);const s=(0,i(827282).IU)("arrowRightSmaller",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M15.383 8.352a.877.877 0 01-.274.64l-5.156 5.14a.864.864 0 01-.617.266.831.831 0 01-.602-.234.795.795 0 01-.234-.586c0-.12.02-.232.063-.336a.912.912 0 01.187-.273l1.75-1.766 2.914-2.656.274.5-2.711.156H1.484c-.26 0-.471-.078-.632-.234a.851.851 0 01-.235-.617c0-.256.078-.461.235-.618a.856.856 0 01.632-.242h9.493l2.71.164-.273.508L10.5 5.5 8.75 3.727a.946.946 0 01-.188-.266.917.917 0 01-.062-.344c0-.234.078-.43.234-.586a.831.831 0 01.602-.234.79.79 0 01.328.07c.104.047.203.117.297.211l5.148 5.133a.877.877 0 01.274.64z"})})},80510:(e,t,i)=>{i.d(t,{Z:()=>s});i(667294);var n=i(785893);const s=(0,i(827282).IU)("arrowsDiverging",{viewBox:"0 0 12 12",svg:(0,n.jsx)("path",{d:"M6 11.2891C6.42188 11.2891 6.63281 11.0469 6.63281 10.5625V7.3457C6.63281 7.00586 6.71875 6.64062 6.89062 6.25C7.06641 5.85938 7.29492 5.47266 7.57617 5.08984C7.86133 4.70703 8.16992 4.35547 8.50195 4.03516C8.83789 3.71484 9.16406 3.45312 9.48047 3.25L9.95508 2.94531C10.1621 2.81641 10.2656 2.63281 10.2656 2.39453C10.2656 2.21875 10.2109 2.07227 10.1016 1.95508C9.99219 1.83789 9.8418 1.7793 9.65039 1.7793C9.4668 1.7793 9.29102 1.83398 9.12305 1.94336L8.81836 2.14844C8.51367 2.34766 8.20898 2.58984 7.9043 2.875C7.59961 3.15625 7.31641 3.45508 7.05469 3.77148C6.79297 4.08398 6.56836 4.39258 6.38086 4.69727C6.19727 4.99805 6.07227 5.26953 6.00586 5.51172H5.98828C5.91797 5.26953 5.79102 4.99805 5.60742 4.69727C5.42383 4.39258 5.19922 4.08398 4.93359 3.77148C4.67188 3.45508 4.38867 3.15625 4.08398 2.875C3.7832 2.58984 3.48047 2.34766 3.17578 2.14844L2.87109 1.94336C2.69922 1.83398 2.52344 1.7793 2.34375 1.7793C2.14844 1.7793 1.99609 1.83984 1.88672 1.96094C1.78125 2.08203 1.72852 2.22461 1.72852 2.38867C1.72852 2.62695 1.83203 2.8125 2.03906 2.94531L2.51367 3.25C2.83008 3.45312 3.1543 3.71484 3.48633 4.03516C3.81836 4.35547 4.12695 4.70703 4.41211 5.08984C4.69727 5.47266 4.92773 5.85938 5.10352 6.25C5.2793 6.64062 5.36719 7.00586 5.36719 7.3457V10.5625C5.36719 11.0469 5.57812 11.2891 6 11.2891ZM1.81641 3.9707L3.71484 1.52734C3.85547 1.33984 3.88281 1.17578 3.79688 1.03516C3.71484 0.890625 3.55469 0.814453 3.31641 0.806641L0.808594 0.712891C0.613281 0.705078 0.466797 0.763672 0.369141 0.888672C0.271484 1.00977 0.251953 1.16406 0.310547 1.35156L1.02539 3.75391C1.0918 3.98438 1.20312 4.125 1.35938 4.17578C1.51953 4.22656 1.67188 4.1582 1.81641 3.9707ZM10.0898 3.95898C10.2266 4.1543 10.375 4.23047 10.5352 4.1875C10.6992 4.14062 10.8164 4.00391 10.8867 3.77734L11.6777 1.39258C11.7402 1.20508 11.7246 1.04883 11.6309 0.923828C11.541 0.798828 11.3984 0.736328 11.2031 0.736328L8.68945 0.753906C8.45117 0.753906 8.28711 0.824219 8.19727 0.964844C8.10742 1.10156 8.13086 1.26562 8.26758 1.45703L10.0898 3.95898Z"})})},975899:(e,t,i)=>{i.d(t,{o:()=>n().o});var n=()=>i(81979)},314169:(e,t,i)=>{i.d(t,{L7:()=>S,iK:()=>I,qq:()=>M});i(821057),i(670560),i(667294);var n=()=>i(799891),s=()=>i(528514),o=()=>i(81954),r=()=>i(788860),a=()=>i(513670),d=()=>i(912732),l=()=>i(824462),c=()=>i(308186),u=()=>i(784234),m=()=>i(269299),p=()=>i(67961),g=()=>i(877807),h=()=>i(80510),f=()=>i(620218),v=()=>i(749826),C=()=>i(779733),b=i(785893);async function S(e){let{newRole:t,...i}=e;const n=i.oldPermissionItem,s=(0,a().d9)(n);return s.role=t,await I({newPermissionItem:s,...i})}async function I(e){const{oldPermissionItem:t,newPermissionItem:i,wasInherited:r,environment:a,store:c,sudoModeStore:p,restrictingVisibility:g,fromPermissionWrapper:h,trustedDomainsLoggingData:b}=e,S=(0,C().wZ)();if(!(0,s().Kf)(t,i))throw new Error("Permission type mismatch.");const I=!!p&&p.shouldSaveTransactionWithSudoMode(c),_=(0,s().nl)(t.role,i.role);if(r&&_!==i.role||g){return await M({environment:a,useSudoMode:I,store:c,permissionItem:i,fromPermissionWrapper:h,isRedesignEnabled:S,shouldInherit:!0,trustedDomainsLoggingData:b})}!c.isTopLevel()&&t.role!==i.role&&_!==t.role&&d().SM(a);const y="public_permission"===t.type&&"public_permission"===i.type&&"none"===t.role&&"none"!==i.role,w=("public_permission"===t.type&&"public_permission"===i.type&&!t.allow_search_engine_indexing&&i.allow_search_engine_indexing||y&&Boolean(v().default.checkGate({gateName:"include_nonindexed_public_content_for_scanning"})))&&Boolean(v().default.checkGate({gateName:"enable_public_content_scanning"}));return m().createAndCommit({userAction:"PermissionItem.handlePermissionItemChange",environment:a,canUndo:!0,useSudoMode:I,perform:t=>{const n=f().default.DO_NOT_USE_markLegacy("share_menu.update_page_permission_lag");u().l3({environment:a,store:c,permissionItems:[i],transaction:t,pagePermissionChangeLocation:e.location,metric:n,fromPermissionWrapper:h}),w&&t.postSubmitCallbacks.push((async e=>{e||await l().callApi({eventName:"enqueueScanContentTask",environment:a,data:{pagePointer:{id:c.id,table:"block",spaceId:(0,o().J)(c.pointer.spaceId)}}})}))}}),"trusted_domain_permission"===i.type&&n().log({level:"warning",from:"shareMenu.handlePermissionItemChange",type:"TrustedDomainPermissionChange",spaceId:(0,o().J)(c.pointer.spaceId),data:{miscDataToConvertToString:{message:"shareMenu.handlePermissionItemChange updating trusted domain permission",blockId:c.id,oldPermissionItem:t,newPermissionItem:i,trustedDomainsLoggingData:b}}}),!0}async function M(e){const{environment:t,useSudoMode:i,store:n,permissionItem:s,fromPermissionWrapper:o,isRedesignEnabled:a,shouldInherit:d,trustedDomainsLoggingData:l}=e,f="none"===(null==s?void 0:s.role)?{type:"remove",permissionItem:s}:{type:"restrict"};return!!("user_permission"===(null==s?void 0:s.type)&&(null==s?void 0:s.user_id)===t.currentUser.id||(a?await c().gt({message:(0,g().mX)(f,a),description:(0,b.jsx)(p().Z,{isSmall:!0,isMultiline:!0,children:(0,b.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.footer.whisperTextV2",defaultMessage:"Changing this will unlink this page from its parent, so it will no longer inherit share settings. Admins can still restore settings on unlinked pages."})}),acceptLabel:(0,g().nH)(f,a),icon:(0,h().Z)({height:24,width:24})}):await c().gt({message:(0,g().mX)(f),acceptLabel:(0,g().nH)(f),cancelLabel:(0,b.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.actionButton.close",defaultMessage:"Close"}),description:(0,b.jsx)(p().Z,{isSmall:!0,isMultiline:!0,children:(0,b.jsx)(r()._H,{id:"restrictedPermissionConfirmationModal.footer.whisperText",defaultMessage:"Admins will still be able to restore permissions from restricted pages."})})})).accept)&&(m().createAndCommit({userAction:"PermissionItem.onAccept",environment:t,canUndo:!0,useSudoMode:i,perform:e=>{u().Pk({environment:t,store:n,permissionItem:s,shouldInherit:d,transaction:e,fromPermissionWrapper:o,trustedDomainsLoggingData:l})}}),!0)}},314160:(e,t,i)=>{i.d(t,{Jh:()=>s,Mo:()=>r,O$:()=>d,_F:()=>o,aC:()=>a,mm:()=>l});var n=()=>i(594546);function s(e,t){(0,n().j)({environment:e,event:{eventName:"open_publish_modal",eventProperties:t}})}function o(e,t){(0,n().j)({environment:e,event:{eventName:"change_domain",eventProperties:t}})}function r(e,t){(0,n().j)({environment:e,event:{eventName:"update_seo_settings",eventProperties:t}})}function a(e,t){(0,n().j)({environment:e,event:{eventName:"site_set_link_expiration",eventProperties:t}})}function d(e,t){(0,n().j)({environment:e,event:{eventName:"page_unpublish",eventProperties:t}})}function l(e,t){(0,n().j)({environment:e,event:{eventName:"page_publish",eventProperties:t}})}},998470:(e,t,i)=>{i.d(t,{AB:()=>Z,Au:()=>O,C$:()=>G,DR:()=>P,Fo:()=>w,H2:()=>E,Hl:()=>F,KD:()=>$,Q6:()=>U,QP:()=>T,YU:()=>B,Y_:()=>j,c7:()=>R,cy:()=>K,dM:()=>x,dU:()=>A,f$:()=>D,gx:()=>W,pn:()=>H,t:()=>V,wt:()=>X,xz:()=>N,y_:()=>L,yr:()=>Q});i(821057),i(670560),i(267602),i(653476),i(241792),i(667294);var n=()=>i(396136),s=()=>i(81954),o=()=>i(928833),r=()=>i(899133),a=()=>i(788860),d=()=>i(513670),l=()=>i(342792),c=()=>i(824462),u=()=>i(636340),m=()=>i(752127),p=()=>i(102182),g=()=>i(269299),h=()=>i(205228),f=()=>i(487270),v=()=>i(314169),C=()=>i(663132),b=()=>i(479875),S=()=>i(836756),I=()=>i(759160),M=()=>i(314160),_=()=>i(566245),y=i(785893);function w(e){const{environment:t,store:i,type:n,header:r,domainId:a}=e,d=i.getSiteStore();if(d)return d.id;let l=a;var c;l||(l=null===(c=C().VA(i.getSpaceStore()))||void 0===c?void 0:c.id);const m=(0,f().$x)({environment:t,table:o().Gs,spaceId:(0,s().J)(i.getSpaceId())});g().createAndCommit({userAction:"publishSite.create",environment:t,canUndo:!0,perform:e=>{const s=u().Ue({environment:t,table:m.table,args:{id:m.id,type:n,spaceId:m.spaceId,blockId:i.id,domainId:l,currentUserId:t.currentUser.id,header:r??{}},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:e});return u().sW({store:i.getFormatStore(),data:{site_id:s.id},transaction:e}),s.id}})}function k(e){const{environment:t,siteRootBlockStore:i,domainId:n}=e;let s=i.getSiteStore();if(s||(w({environment:t,type:"site",store:i,domainId:n}),s=i.getSiteStore()),s)return s}function x(e){const{environment:t,domainId:i,resetWatermark:n}=e,s=k(e);s&&s.isDefined()&&(g().createAndCommit({userAction:"publishSite.updatePublicDomain",environment:t,canUndo:!0,perform:e=>{s.getDomainId()!==i&&g().applyOperation({transaction:e,store:s,operation:s.getModel().ops.updatePublicDomainId({domainId:i,currentUserId:t.currentUser.id})})}}),g().createAndCommit({userAction:"publishSite.resetWatermark",environment:t,canUndo:!0,perform:e=>{if(n){const i=s.getHeader();g().applyOperation({transaction:e,store:s,operation:s.getModel().ops.updateHeader({header:{...i,hideWatermark:!1},currentUserId:t.currentUser.id})})}}}),p().oV({label:(0,y.jsx)(a()._H,{id:"publishSiteSettings.publicDomain.confirmation",defaultMessage:"Successfully updated domain for all pages within this site"})}))}function P(e){const{environment:t,siteRootBlockStore:i,isSearchEngineIndexingEnabled:n}=e,o=k(e);if(!o)return;"form"!==o.getType()&&g().createAndCommit({userAction:"publishSite.updateSeoEnabled",environment:t,canUndo:!0,perform:e=>{o&&o.isDefined()&&n!==o.isSearchEngineIndexingEnabled()&&(g().applyOperation({transaction:e,store:o,operation:o.getModel().ops.updateIsSearchEngineIndexingEnabled({isSearchEngineIndexingEnabled:n,currentUserId:t.currentUser.id})}),n&&e.postSubmitCallbacks.push((async e=>{e||await c().callApi({eventName:"enqueueScanContentTask",environment:t,data:{pagePointer:{id:i.id,table:"block",spaceId:(0,s().J)(i.pointer.spaceId)}}})})))}})}function U(e){const{environment:t,store:i,seoTitle:n,seoDescription:s}=e;g().createAndCommit({userAction:"publishSite.create",environment:t,canUndo:!0,perform:e=>{const o=i.getFormat().seo_title,r=i.getFormat().seo_description;o===n&&r===s||(u().sW({store:i.getFormatStore(),data:{seo_title:n,seo_description:s},transaction:e}),(0,M().Mo)(t,{target_block_id:i.id,new_title:n??null,new_description:s??null}),p().oV({label:(0,y.jsx)(a()._H,{id:"siteSettingsEditor.publishSeoChanges.confirmation",defaultMessage:"Successfully updated the SEO settings"})}))}})}function A(e){I().Z.setState({...I().Z.state,settingOpen:e})}function Z(){I().Z.setState({...I().Z.state,settingOpen:"initial"})}function H(e){S().Z.setState({...S().Z.state,siteSettingContentType:e})}function j(e){var t,i,n;const{siteRootBlockStore:s,permissionItem:o,from:r,sudoModeStore:a}=e,d=s.getSiteStore(),l=null==d?void 0:d.getHeader(),c=(null==l||null===(t=l.customItems)||void 0===t?void 0:t.map((e=>e.blockId)))||[];I().Z.setState({settingOpen:"initial",permissionItem:o,from:r,sudoModeStore:a,faviconUrl:(null==d?void 0:d.getFaviconUrl())||null,previewImageUrl:(null==d?void 0:d.getPreviewImageUrl())||null,hideBreadcrumbs:null==l?void 0:l.hideBreadcrumbs,hideSearch:null==l?void 0:l.hideSearch,hideWatermark:null==l?void 0:l.hideWatermark,enableDuplicateAsTemplate:o.allow_duplicate,customHeaderBlockIds:c,googleAnalyticsId:null==d?void 0:d.getGoogleAnalyticsId(),theme:null==d||null===(i=d.getSettings())||void 0===i?void 0:i.theme,enableQna:null==d||null===(n=d.getSettings())||void 0===n?void 0:n.enableQna})}async function B(e){var t;const{environment:i,store:s,siteRootBlockStore:o}=e,r=k({environment:i,siteRootBlockStore:o}),u=null==r?void 0:r.getType();if(!r||"form"===u)return;const m=I().Z.getState();let h=!1;const f={};let b;m.enableQna&&(b=await async function(e){var t,i,n,s;const{environment:o,siteStore:r}=e,a=null===(t=r.getSettings())||void 0===t?void 0:t.siteUserId;if(a)return a;if(!((null===(i=r.getDomainStore())||void 0===i?void 0:i.getDomainName())??(null===(n=C().VA(r.getSpaceStore()))||void 0===n?void 0:n.domain_name)))throw new Error("no domain on site");const d=C().Co({spaceStore:r.getSpaceStore(),domainId:null===(s=r.getDomainStore())||void 0===s?void 0:s.id}).split(":")[0],u=`${(0,l().XR)(r.id)}@${d}`,m=await c().callApi({eventName:"createEmailUser",environment:o,data:{email:u}});if("failed"===m.type)throw new Error("failed to create qna user");return m.data.userId}({environment:i,siteStore:r})),g().createAndCommit({userAction:"publishSite.updateSiteSettingsInEditor",environment:i,canUndo:!0,perform:e=>{if(r&&r.isDefined()){var t,n;(r.getFaviconUrl()||null)!==m.faviconUrl&&(g().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateFaviconUrl({faviconUrl:m.faviconUrl,currentUserId:i.currentUser.id})}),h=!0,f.favicon=m.faviconUrl);(r.getPreviewImageUrl()||null)!==m.previewImageUrl&&(g().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updatePreviewImageUrl({previewImageUrl:m.previewImageUrl,currentUserId:i.currentUser.id})}),h=!0,f.preview_image=m.previewImageUrl);const s=r.getHeader();let o=s;const a=function(e,t){const i=e.map((e=>({type:"block",blockId:e})));if(!t&&0===i.length)return;if(t&&(0,d().Xy)(i,t))return;return i}(m.customHeaderBlockIds,null==s?void 0:s.customItems);a&&(o={...o,customItems:a},f.custom_headers=a.map((e=>e.blockId))),(null==s?void 0:s.hideBreadcrumbs)!==m.hideBreadcrumbs&&(o={...o,hideBreadcrumbs:m.hideBreadcrumbs},f.hide_breadcrumbs=m.hideBreadcrumbs),(null==s?void 0:s.hideSearch)!==m.hideSearch&&(o={...o,hideSearch:m.hideSearch},f.hide_search=m.hideSearch),(null==s?void 0:s.hideWatermark)!==m.hideWatermark&&(o={...o,hideWatermark:m.hideWatermark},f.hide_watermark=m.hideWatermark),o&&s!==o&&(g().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateHeader({header:o,currentUserId:i.currentUser.id})}),h=!0);r.getGoogleAnalyticsId()!==m.googleAnalyticsId&&(g().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateGoogleAnalyticsId({googleAnalyticsId:m.googleAnalyticsId,currentUserId:i.currentUser.id})}),h=!0,f.google_analytics_id=m.googleAnalyticsId);(null===(t=r.getSettings())||void 0===t?void 0:t.theme)!==m.theme&&(g().applyOperation({transaction:e,store:r,operation:r.getModel().ops.updateTheme({theme:m.theme,currentUserId:i.currentUser.id})}),h=!0,f.theme=m.theme);(null===(n=r.getSettings())||void 0===n?void 0:n.enableQna)!==m.enableQna&&(m.enableQna?b&&g().applyOperation({transaction:e,store:r,operation:{pointer:r.pointer,command:"update",path:["settings"],args:{enableQna:m.enableQna,siteUserId:b}}}):g().applyOperation({transaction:e,store:r,operation:{pointer:r.pointer,command:"update",path:["settings"],args:{enableQna:m.enableQna}}}),h=!0)}}});if((null===(t=m.permissionItem)||void 0===t?void 0:t.allow_duplicate)!==m.enableDuplicateAsTemplate&&m.permissionItem&&m.from){const e=m.from.table===n().iU?m.from.blockId:m.from.teamId;(0,v().iK)({oldPermissionItem:m.permissionItem,newPermissionItem:{...m.permissionItem,allow_duplicate:m.enableDuplicateAsTemplate},wasInherited:e!==s.id,environment:i,store:s,sudoModeStore:m.sudoModeStore,location:"published_site_settings"}),h=!0,f.enable_duplicate_as_template=m.enableDuplicateAsTemplate}h&&((0,_().u6)(i,{settings_changed:f}),p().oV({label:(0,y.jsx)(a()._H,{id:"siteSettingsEditor.publishChanges.confirmation",defaultMessage:"Changes published"})}))}function T(e){I().Z.setState({...I().Z.state,faviconUrl:e})}function D(e){I().Z.setState({...I().Z.state,previewImageUrl:e})}function V(e){I().Z.setState({...I().Z.state,hideBreadcrumbs:e})}function R(e){I().Z.setState({...I().Z.state,hideSearch:e})}function E(e){I().Z.setState({...I().Z.state,hideWatermark:e})}function L(e){I().Z.setState({...I().Z.state,enableDuplicateAsTemplate:e})}function F(e){const t=I().Z.state.customHeaderBlockIds.concat([e]);I().Z.setState({...I().Z.state,customHeaderBlockIds:t})}function O(e){const t=I().Z.state.customHeaderBlockIds.filter((t=>t!==e));I().Z.setState({...I().Z.state,customHeaderBlockIds:t})}function W(e){I().Z.setState({...I().Z.state,googleAnalyticsId:e})}function N(e){I().Z.setState({...I().Z.state,theme:e})}async function Q(e){const{environment:t,spaceStore:i,query:n,siteRootBlockId:s}=e;if(!i)return;const o=await c().callApi({eventName:"searchPagesInSite",environment:t,data:{query:n,spaceId:i.id,filters:r().u4({isDeletedOnly:!1,navigableBlockContentOnly:!0,excludeTemplates:!0,editedBy:[],ancestors:[s],inTeams:[]}),sort:{field:"relevance"},limit:10}});return"failed"!==o.type?o.data:void 0}async function G(e){const{environment:t,blockStore:i,slug:n}=e,s=await c().callApi({eventName:"updatePublicPageSlug",environment:t,data:{spaceId:i.getSpaceId(),blockId:i.id,slug:n,clientVersion:h().default.version}});if("success"!==s.type)return{error:s};p().oV({label:(0,y.jsx)(a()._H,{id:"customSlugInput.updateSuccess.toast",defaultMessage:"Successfully updated URL for this page"})})}function $(e){I().Z.setState({...I().Z.state,enableQna:e})}function X(e){const{environment:t,store:i,pageVisitSource:n}=e,{url:s}=b().$({store:i,pageVisitSource:n});m().D({environment:t,url:s})}function K(e){const{environment:t,siteStore:i,embedSettings:n}=e;g().createAndCommit({userAction:"embedSite.updateEmbedSettings",environment:t,canUndo:!0,perform:e=>{u().sW({store:i.getSettingsStore(),data:{embedSettings:n},transaction:e})}})}},566245:(e,t,i)=>{i.d(t,{Cx:()=>r,g2:()=>s,u6:()=>o});var n=()=>i(594546);function s(e,t){(0,n().j)({environment:e,event:{eventName:"open_customize_site",eventProperties:t}})}function o(e,t){(0,n().j)({environment:e,event:{eventName:"update_site_customization_settings",eventProperties:t}})}function r(e){(0,n().j)({environment:e,event:{eventName:"close_customize_site",eventProperties:{}}})}},759160:(e,t,i)=>{i.d(t,{Z:()=>s});class n extends(()=>i(263184))().default{getInitialState(){return{settingOpen:"initial",permissionItem:void 0,from:void 0,sudoModeStore:void 0,location:"",faviconUrl:null,previewImageUrl:null,hideBreadcrumbs:!1,hideSearch:!1,hideWatermark:!1,enableDuplicateAsTemplate:!1,customHeaderBlockIds:[],googleAnalyticsId:void 0,theme:void 0,enableQna:!1}}}const s=new n},266184:(e,t,i)=>{i.d(t,{Sl:()=>I,TA:()=>M,Zg:()=>b,a2:()=>y,eT:()=>_,mk:()=>S});i(821057),i(670560),i(267602),i(653476),i(667294);var n=()=>i(217465),s=()=>i(396136),o=()=>i(788860),r=()=>i(839002),a=()=>i(824462),d=()=>i(308186),l=()=>i(828946),c=()=>i(365872),u=()=>i(681832),m=()=>i(804217),p=()=>i(826955),g=()=>i(625820),h=()=>i(59864),f=()=>i(835374),v=i(785893);const C=50;function b(e){f().default.resetSitesForSpace(e.id)}async function S(e,t){const{spaceStore:i,currentUserId:o,limit:d}=t;if(!i.id)return;const[l]=await Promise.all([a().callApi({eventName:"getPublishedPagesForUser",environment:e,data:{spaceId:i.id,limit:d||C,fetchPublishedMetadata:!0}}),(0,r().Vs)(1500)]);if("failed"===l.type)throw new Error("Failed to fetch published pages.");if(l.data.recordMap){const e=[],t=n().RecordMapWithRole.create(l.data.recordMap),r=l.data.publishedEdits;for(const{model:n}of t)if(n&&n.table===s().iU){const t=p().G.createChildStore(i,{table:s().iU,id:n.id}),o=r[t.id],a=o&&o.authors?o.authors[0]:void 0,d={publishedTime:null==o?void 0:o.timestamp,publishedBy:a};e.push({store:t,publishedMetadata:d})}let a=e;return o&&(a=h().S(e,o)),f().default.initializeSiteResultsForSpace(i.id,a),a}}async function I(e,t){const{spaceStore:i}=t,n=e.currentUser.id,s=await S(e,{spaceStore:i,currentUserId:n});return s?s.filter((e=>{var t;return(null===(t=e.publishedMetadata.publishedBy)||void 0===t?void 0:t.id)===n})):[]}function M(e){c().lG(e),u().default.setState({...u().default.state,display:u().wV.Publish,tab:u().XF.Publish})}async function _(e){return new Promise(((t,i)=>{d().vC({message:(0,v.jsx)("div",{style:{textAlign:"center"},children:(0,v.jsx)(o()._H,{id:"sites.confirmUnpublish.title",defaultMessage:"Unpublish this site?"})}),description:(0,v.jsx)("div",{style:{textAlign:"center"},children:(0,v.jsx)(o()._H,{id:"sites.confirmUnpublish.caption",defaultMessage:"{pageTitle} will no longer be live on the web.",values:{pageTitle:e}})}),keepFocus:!0,items:[{label:(0,v.jsx)(o()._H,{id:"sites.confirmUnpublish.confirm",defaultMessage:"Unpublish"}),color:"red",onAccept:()=>t(!0)}],showCancel:!0})}))}async function y(e,t){if(!m().default.state.online)return[];const i=await l().x.searchActions.load();return await i.searchPublicPages({environment:t,query:e,source:"public_home_page_menu",limit:g().Xv})}},682551:(e,t,i)=>{i.d(t,{Z:()=>I});i(670560);var n=i(667294),s=()=>i(219727),o=()=>i(142735),r=()=>i(846550),a=()=>i(506347),d=()=>i(788860),l=()=>i(82937),c=()=>i(489434),u=()=>i(500174),m=()=>i(975899),p=()=>i(166104),g=()=>i(314160),h=()=>i(998470),f=()=>i(772084),v=()=>i(482162),C=()=>i(266184),b=()=>i(663132),S=i(785893);function I(e){let{blockStore:t,legacyColor:i}=e;const I=(0,o().VK)((()=>t.isFormBlock()),[t]),M=(0,s().O7)(),_=M.device.isMobile,y=(0,o().VK)((()=>{const e=f().UM(t);return b().Co({spaceStore:t.getSpaceStore(),domainId:e})}),[t]),w=(0,n.useCallback)((()=>{h().wt({environment:M,store:t,pageVisitSource:a().tY.SiteBanner})}),[M,t]),k=(0,n.useCallback)((()=>{var e;v().default.isSidePeekOpen()&&(null===(e=v().default.peekTargetStore.state)||void 0===e?void 0:e.id)!==t.id&&l().ME(),C().TA(M),(0,g().Jh)(M,{source:"site_settings_banner"})}),[t.id,M]),x=(0,r().yK)((()=>({icon:{height:16,width:16,marginRight:4}})),[]);if(!y||I)return null;let P;const U=[];return _?(P=(0,S.jsx)(d()._H,{defaultMessage:"This page is live on the web.",id:"pageViewBlock.sitesBannerMobile.message"}),U.push({label:(0,S.jsx)(d()._H,{defaultMessage:"View",id:"pageViewBlock.sitesBanner.view"}),onClick:()=>w()})):(P=(0,S.jsx)(d()._H,{defaultMessage:"This page is live on {domain}",id:"pageViewBlock.sitesBanner.message",values:{domain:y}}),U.push({label:(0,S.jsxs)(S.Fragment,{children:[(0,m().o)(x.icon),(0,S.jsx)(d()._H,{defaultMessage:"View site",id:"pageViewBlock.sitesBanner.viewSite"})]}),onClick:()=>w()},{label:(0,S.jsxs)(S.Fragment,{children:[(0,p().H)(x.icon),(0,S.jsx)(d()._H,{defaultMessage:"Site settings",id:"pageViewBlock.sitesBanner.settings"})]}),onClick:()=>k()})),(0,S.jsx)(c().j,{label:P,display:"full-width",actions:U,tint:(0,u().X)(i)})}},59864:(e,t,i)=>{i.d(t,{N:()=>a,S:()=>r});i(267602),i(470928);var n=()=>i(933868),s=()=>i(514737),o=()=>i(122479);function r(e,t){return e.sort(((e,i)=>{const n=e.store.canAdmin();if(n===i.store.canAdmin()){var s,o;const n=null===(s=e.publishedMetadata.publishedBy)||void 0===s?void 0:s.id,r=e.publishedMetadata.publishedTime,a=null===(o=i.publishedMetadata.publishedBy)||void 0===o?void 0:o.id,d=i.publishedMetadata.publishedTime;if(t){if(n===t&&a===t&&r&&d)return d-r;if(n===t)return-1;if(a===t)return 1}return r&&d?d-r:0}return n?-1:1}))}function a(e){const{environment:t,store:i}=e;if(!i.pathIsAccessibleAndAlive())return!1;const r=o().YO(i).find((e=>(0,n().$D)(e.permissionItem)&&"none"!==e.permissionItem.role));return!!r&&((!(0,n().$D)(r.permissionItem)||!(0,s().y)(r.permissionItem))&&!o().IJ(t,i))}},835374:(e,t,i)=>{i.d(t,{default:()=>o});i(267602),i(653476);var n=()=>i(513670);class s extends(()=>i(263184))().default{getInitialState(){return{sites:{},sortAscending:!0,sortColumn:void 0}}initializeSiteResultsForSpace(e,t){this.state.sites[e]=t,this.emit()}getSortedSitesForSpace(e,t){const{sortAscending:s,sortColumn:o}=this.state,r=this.state.sites[e];if(r)switch(o){case"page":return n().Xo(r,(e=>i(955620).QaF(e.store.getTitleValue()).toLowerCase()),s?"asc":"desc");case"published-by":return n().Xo(r,(e=>{const n=e.publishedMetadata.publishedBy,s=n?i(826955).t1.createChildStore(e.store,n):void 0;return null==s?void 0:s.getDisplayName(t).toLowerCase()}),s?"asc":"desc");case"published-date":return n().Xo(r,(e=>e.publishedMetadata.publishedTime),s?"asc":"desc");default:return r}}removeSiteFromSpace(e,t){const i=this.state.sites[e];i&&(this.state.sites[e]=i.filter((e=>e.store.id!==t)),this.emit())}resetSitesForSpace(e){this.state.sites[e]=void 0}}const o=new s},981219:(e,t,i)=>{i.d(t,{U:()=>n});const n=(0,i(827282).CZ)("xmark",{default:{loader:()=>i.e(71448).then(i.bind(i,471448))},small:{loader:()=>i.e(24056).then(i.bind(i,624056))},mini:{loader:()=>i.e(84500).then(i.bind(i,384500))},large:{loader:()=>i.e(71533).then(i.bind(i,71533))}})},81979:(e,t,i)=>{i.d(t,{o:()=>s});i(667294);var n=i(785893);const s=(0,i(827282).IU)("globe2",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM3.88477 3.76465C4.56836 3.11523 5.39551 2.61621 6.31836 2.34277C5.83301 2.82812 5.42285 3.51172 5.11523 4.3457C4.63672 4.19531 4.22656 3.99707 3.88477 3.76465ZM9.68848 2.34961C10.6045 2.62305 11.4316 3.11523 12.1084 3.76465C11.7734 4.00391 11.3633 4.19531 10.8848 4.35254C10.5771 3.51172 10.167 2.82812 9.68848 2.34961ZM8.47852 2.56836C9.0459 2.8418 9.56543 3.58008 9.93457 4.58496C9.4834 4.66699 8.99805 4.71484 8.47852 4.73535V2.56836ZM6.06543 4.58496C6.44141 3.58008 6.9541 2.8418 7.52148 2.56836V4.73535C7.00195 4.71484 6.5166 4.66699 6.06543 4.58496ZM2.05273 7.58594C2.14844 6.42383 2.58594 5.35059 3.25586 4.46875C3.67285 4.77637 4.21289 5.04297 4.8418 5.24121C4.66406 5.95215 4.54785 6.74512 4.51367 7.58594H2.05273ZM11.4863 7.58594C11.4521 6.74512 11.3359 5.95215 11.1582 5.24121C11.7871 5.04297 12.3271 4.7832 12.7373 4.46875C13.4141 5.35059 13.8516 6.42383 13.9473 7.58594H11.4863ZM5.49121 7.58594C5.52539 6.84082 5.62793 6.12988 5.78516 5.4873C6.33203 5.59668 6.91309 5.66504 7.52148 5.69238V7.58594H5.49121ZM8.47852 7.58594V5.69238C9.08691 5.66504 9.66797 5.59668 10.2148 5.4873C10.3721 6.12988 10.4746 6.84082 10.5088 7.58594H8.47852ZM2.05273 8.54297H4.51367C4.54785 9.39746 4.66406 10.1973 4.8418 10.915C4.21973 11.1133 3.68652 11.373 3.27637 11.6807C2.59277 10.792 2.14844 9.71191 2.05273 8.54297ZM5.49121 8.54297H7.52148V10.4707C6.91992 10.498 6.33203 10.5664 5.79199 10.6689C5.62793 10.0195 5.51855 9.29492 5.49121 8.54297ZM8.47852 10.4707V8.54297H10.5088C10.4814 9.29492 10.3721 10.0195 10.208 10.6689C9.66797 10.5664 9.08691 10.498 8.47852 10.4707ZM11.1582 10.915C11.3428 10.1973 11.4521 9.39746 11.4863 8.54297H13.9473C13.8516 9.71191 13.4072 10.792 12.7236 11.6807C12.3135 11.373 11.7803 11.1133 11.1582 10.915ZM8.47852 11.4277C8.99121 11.4482 9.47656 11.4961 9.9209 11.5781C9.55176 12.5625 9.03906 13.2939 8.47852 13.5605V11.4277ZM6.0791 11.5781C6.52344 11.4961 7.00879 11.4482 7.52148 11.4277V13.5605C6.96094 13.2939 6.44824 12.5625 6.0791 11.5781ZM3.90527 12.3848C4.24023 12.1523 4.65039 11.9609 5.12207 11.8105C5.42969 12.6309 5.83301 13.3008 6.30469 13.7793C5.40234 13.5059 4.58203 13.0205 3.90527 12.3848ZM10.8779 11.8105C11.3496 11.9609 11.7598 12.1523 12.0947 12.3848C11.418 13.0205 10.5977 13.5059 9.69531 13.7793C10.167 13.3008 10.5703 12.6309 10.8779 11.8105Z"})})}}]);