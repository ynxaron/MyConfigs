"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[23055],{947989:(e,o,n)=>{n.r(o),n.d(o,{RemoveAddOnModal:()=>T});n(821057);var a=n(667294),t=()=>n(146947),r=()=>n(219727),s=()=>n(142735),i=()=>n(646574),d=()=>n(956057),u=()=>n(629719),c=()=>n(976102),l=()=>n(893146),f=()=>n(381348),p=()=>n(788860),g=()=>n(513670),h=()=>n(979614),y=()=>n(102182),v=()=>n(228772),_=()=>n(576387),m=()=>n(438665),w=()=>n(548812),b=()=>n(661769),x=()=>n(984529),O=()=>n(135658),j=()=>n(663544),S=n(785893);function T(e){let{currentPeriodEnd:o,isOpen:n,onClose:g}=e;const x=(0,r().O7)(),[T,C]=a.useState("survey"),[A,B]=a.useState({reasons:[],reasonOther:void 0,reasonOtherTools:void 0}),[M,E]=a.useState(void 0),[R]=a.useState(d().Il());(0,a.useEffect)((()=>h().j(x,{name:"churn_survey",args:{churnType:"ai",reasons:A.reasons,reasonOther:A.reasonOther,reasonOtherTools:A.reasonOtherTools,stage:T,churnSurveyId:R}})),[x,T,A,R]);const k=(0,v().r)(),H=Boolean((0,s().VK)((()=>null==k?void 0:k.canAdmin()),[k])),F=(0,b().pQ)({spaceId:null==k?void 0:k.id}),P=(0,s().VK)((()=>(0,u().KU)(F)),[F]),U=(0,u().BU)({billingData:F,canUpdateBilling:H}),V=o?(0,i().Yx)(o,"long",t().locale):void 0,D=a.useCallback((()=>{h().j(x,{name:"churn_survey_close",args:{churnSurveyId:R}}),g()}),[R,x,g]);return(0,S.jsx)(j().r,{step:T,isOpen:n,onClose:D,children:(()=>{switch(T){case"survey":return(0,S.jsx)(O().tt,{options:I(),onSubmit:async e=>{h().j(x,{name:"churn_survey_submitted",args:{churnType:"ai",reasons:e.reasons,reasonOther:e.customTextByReason.other??void 0,reasonOtherTools:e.customTextByReason.using_another_ai_service??void 0,stage:T,churnSurveyId:R}}),B((o=>({...o,reasons:e.reasons,reasonOther:e.customTextByReason.other??void 0,reasonOtherTools:e.customTextByReason.using_another_ai_service??void 0})));const o=await m().ZF(x,{spaceId:null==k?void 0:k.id,offerCampaign:"ai_fifty_percent_downgrade"}),n=(0,l().iQ)(o);return n&&(0,f().pp)(n)?(E(n),void C("offer")):C("downgrade")}});case"offer":return M?(0,S.jsx)(O().oR,{currentProduct:"ai",secondaryButtonMessage:(0,S.jsx)(p()._H,{id:"removeAddOnModal.cancelAnyway",defaultMessage:"Cancel anyway"}),newProduct:"free",coupon:M,onSubmit:async e=>{if(e){h().j(x,{name:"offer_accepted",args:{coupon:M}});const e=null==k?void 0:k.id;if(P&&e&&U&&(0,f().pp)(M))return(0,w().$u)()?await m().zL({environment:x,spaceId:e,offerCampaign:"ai_fifty_percent_downgrade",entrypoint:"ai_downgrade_flow"}):await m().lB(x,{customerId:P,coupon:M,offerType:"add_on_downgrade_flow"}),D(),void y().oV({label:(0,S.jsx)(p()._H,{id:"applyCoupon.success",defaultMessage:"Coupon successfully applied"})})}C("downgrade")}}):void C("downgrade");case"downgrade":return(0,S.jsx)(O().hy,{title:(0,S.jsx)(p()._H,{id:"addOnCancellationStep.cancellation.title",defaultMessage:"Remove AI at the end of your billing period?"}),description:V?(0,S.jsx)(p()._H,{id:"addOnCancellationStep.cancellation.description",defaultMessage:"If you continue with the downgrade, you will continue to enjoy Notion AI until the end of your billing period on <bold>{periodEnd}</bold>. You can resubscribe anytime.",values:{periodEnd:V,bold:e=>(0,S.jsx)("b",{children:e})}}):null,onSubmit:async()=>{if(h().j(x,{name:"continue_downgrade_button_clicked"}),F&&k){const e=(0,u().Lg)(F),o=(0,c().t4)(e,"ai");await(0,_().Mg)({environment:x,spaceStore:k,from:"billing_page",desiredState:o})}C("confirmation")}});case"confirmation":if(F){const e=(0,u().Lg)(F);if(Boolean((0,u().a7)(e,"ai")))throw new Error("Notion AI is not cancelled or scheduled to be cancelled")}return(0,S.jsx)(O().AF,{title:(0,S.jsx)(p()._H,{id:"downgradeFlow.confirmationStep.ai.title",defaultMessage:"Notion AI has been removed"}),formattedPeriodEndDate:V})}})()})}function I(){return[...(0,g().TV)([x().f.tooExpensive,x().f.missingFeatures,x().f.upgradedByMistake,x().f.tooDifficult,x().f.notUsingEnough,x().f.qualityOfResults,x().f.usingAnotherAiService,x().f.dataSecurity]),x().f.other]}}}]);