"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[58591],{67901:(e,t,o)=>{o.d(t,{Z:()=>s});var n=o(667294),r=()=>o(142735),i=o(785893);function l(e){const{resultStore:t,render:l,...s}=e,a=(0,o(455876).Z)(s),c=(0,r().qz)(t,o(263184).default.createClass(void 0));(0,n.useEffect)((()=>{c.setState(a)}),[a,c]);const u=(0,r().VK)((()=>l?l(c):null),[l,c]);return(0,i.jsx)(i.Fragment,{children:u})}const s=n.memo(l)},259314:(e,t,o)=>{o.d(t,{Pt:()=>U,Xo:()=>G,ZP:()=>z});o(267602),o(653476),o(470928),o(241792);var n=o(667294),r=()=>o(629013),i=()=>o(219727),l=()=>o(142735),s=()=>o(846550),a=()=>o(788860),c=()=>o(513670),u=()=>o(250303),d=()=>o(931756),p=()=>o(139224),m=()=>o(879952),S=()=>o(990966),g=()=>o(765458),x=()=>o(84439),f=()=>o(830700),y=()=>o(628370),C=()=>o(69870),h=()=>o(119891),v=()=>o(206352),b=()=>o(291198),j=()=>o(92175),k=()=>o(967092),_=()=>o(560287),w=()=>o(71410),M=()=>o(347577),T=()=>o(565276),B=()=>o(735957),I=()=>o(521777),R=()=>o(932753),F=()=>o(845297),V=()=>o(364300),Z=()=>o(707513),A=()=>o(220193),P=()=>o(190970),L=()=>o(977012),D=()=>o(104088),K=()=>o(61738),H=o(785893);function O(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;const{device:r}=(0,i().O7)(),s=(0,l().VK)((()=>o.state.open),[o]),a=(0,n.useCallback)((e=>{e&&(0,T().yT)(e.target)||p().E3({collectionSettingsStore:o})}),[o]),c=(0,n.useCallback)((()=>(0,H.jsx)(g().PJ,{context:M().HV.FilterBar,collectionContextStore:t,collectionSettingsStore:o,hideDesktopHeader:!0})),[t,o]);return(0,n.useEffect)((()=>()=>p().E3({collectionSettingsStore:o})),[]),(0,H.jsx)(k().ZP,{popupType:r.isMobile?D().k.SlideUp:D().k.Popup,open:s,origin:(0,H.jsx)(N,{collectionContextStore:t,collectionSettingsStore:o}),onDismiss:a,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:c})}function N(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;const r=(0,i().O7)(),[c,d,m,S]=(0,l().VK)((()=>[t.currentSortsStore.state,t.localStateDiffStore.state,t.normalizedSchemaStore.state,t.permissionScopesStore.state]),[t]),g=c[0],x=g?m[g.property]:void 0,f=(0,n.useCallback)((()=>{u().wd({environment:r,collectionContextStore:t,action:"click_sort"}),p().wl({collectionSettingsStore:o,item:{type:"sort"}})}),[t,o,r]),y=(0,s().yK)((e=>({arrowIcon:{width:12,marginRight:4,fill:e.blueColor},arrowsIcon:{width:16,marginRight:4,fill:e.blueColor},title:{marginTop:-1,maxWidth:220,...Z().Yu}})),[]);let C;return C=1===c.length?g&&"descending"===g.direction?(0,A().N)(y.arrowIcon):(0,L().w)(y.arrowIcon):(0,P().T)(y.arrowsIcon),(0,H.jsx)(K().Z,{on:!0,hasDiff:Boolean(S.canConfigureBlock&&d.sorts),icon:C,title:(0,H.jsx)("span",{style:y.title,children:1===c.length&&x?x.name:(0,H.jsx)(a()._H,{defaultMessage:"{sortCount} sorts",id:"database.filterBar.sorts.label",values:{sortCount:c.length}})}),onClick:f})}let U=function(e){return e[e.FilterBar=0]="FilterBar",e[e.SettingsFilters=1]="SettingsFilters",e}({});const E=o(263184).default.createClass({open:!1,stack:[]},{name:"CreateFilterSettingsStore"});const z=function(e){var t;let{collectionContextStore:n,showHoverActionsStore:r,createFilterSettingsStore:a,saveControlMoreActionsButtonPopupStore:c}=e;const u=(0,i().MO)(),d=(0,s().Fg)(),p=(0,l().qz)(c,o(529048).Z),m=(0,l().qz)(a,E),S=(0,l().VK)((()=>(0,o(576868).Nq)(n)),[n]),g=(0,l().VK)((()=>u&&n.searchOpenStore.state),[u,n]),x=(0,l().Kw)(n.currentPropertyFiltersStore),f=(0,l().Kw)(n.currentSortsStore),y=(0,l().VK)((()=>n.shouldShowSourceStore.state?8:12),[n]),C=(0,l().VK)((()=>n.filterBarSortSettingsStore.state.open),[n]),h=f.length>0||C,v=(0,l().Kw)(n.permissionScopesStore),b=(0,l().VK)((()=>v.canConfigureBlock?n.currentCombinatorFilterStore.state:void 0),[v,n]),j=(0,l().VK)((()=>n.isUnlistedViewStore.state),[n]),k=(0,l().qz)(void 0,o(561280).Z),w=null===(t=(0,o(887430).jw)(n,d))||void 0===t?void 0:t.background;return(0,H.jsxs)("div",{style:{width:"100%",zIndex:o(492522)._Y,...j&&{paddingLeft:16,paddingRight:16}},onClick:e=>function(e,t){t.filtersBarOpenStore.setState(!0)}(0,n),children:[(0,H.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[g&&(0,H.jsx)(X,{collectionContextStore:n}),!g&&(0,H.jsxs)("div",{style:{position:"relative",flexGrow:0,overflow:"hidden"},children:[(0,H.jsx)(o(842574).Z,{store:k,type:o(520849).Z.X,style:{display:"flex",alignItems:"center",paddingTop:y,paddingBottom:8},children:u?(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)($,{collectionContextStore:n}),h&&(0,H.jsx)(q,{collectionContextStore:n}),h&&!u&&(0,H.jsx)(G,{}),b&&(0,H.jsx)(W,{collectionContextStore:n}),(0,H.jsx)(J,{collectionContextStore:n,propertyFilters:x}),(0,H.jsx)(oe,{collectionContextStore:n,showHoverActionsStore:r,createFilterSettingsStore:m})]}):(0,H.jsxs)(H.Fragment,{children:[h&&(0,H.jsx)(q,{collectionContextStore:n}),h&&!u&&(0,H.jsx)(G,{}),b&&(0,H.jsx)(W,{collectionContextStore:n}),(0,H.jsx)(J,{collectionContextStore:n,propertyFilters:x}),(0,H.jsx)(oe,{collectionContextStore:n,showHoverActionsStore:r,createFilterSettingsStore:m})]})}),!u&&(0,H.jsx)(o(242758).Z,{store:k,backgroundColor:w})]}),(0,H.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:"auto"},children:[!u&&S&&(0,H.jsx)(ee,{collectionContextStore:n,showHoverActionsStore:r,saveControlMoreActionsButtonPopupStore:p}),!u&&(0,H.jsx)(_().Z,{collectionContextStore:n})]})]}),u&&!g&&(0,H.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[S&&(0,H.jsx)(ee,{collectionContextStore:n,showHoverActionsStore:r,saveControlMoreActionsButtonPopupStore:p}),(0,H.jsx)(_().Z,{collectionContextStore:n})]})]})};function W(e){let{collectionContextStore:t}=e;return(0,H.jsx)(F().B,{context:U.FilterBar,collectionSettingsStore:t.filterBarCombinatorFilterSettingsStore,collectionContextStore:t})}function q(e){let{collectionContextStore:t}=e;return(0,H.jsx)(O,{collectionContextStore:t,collectionSettingsStore:t.filterBarSortSettingsStore},"sort")}function Y(e){let{filter:t,collectionContextStore:o}=e;const n=(0,l().VK)((()=>o.getFilterBarItemSettingsStore(t)),[o,t]);return(0,H.jsx)(V().Z,{id:t.id,context:U.FilterBar,collectionContextStore:o,collectionSettingsStore:n},t.id)}function G(){const e=(0,s().Fg)();return(0,H.jsx)("div",{style:{borderRight:`1px solid ${e.regularDividerColor}`,height:24,marginRight:12,marginLeft:8}})}function Q(e){e.searchOpenStore.setState(!1),e.searchQueryStore.setState("")}function J(e){let{propertyFilters:t,collectionContextStore:o}=e;const n=(0,i().O7)();if((0,l().Kw)(o.permissionScopesStore).canConfigureBlock){const e=t.map((e=>e.id));return(0,H.jsx)(h().ZP,{direction:"horizontal",keys:e,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>{const n=t.find((t=>t.id===e));if(n)return(0,H.jsx)(Y,{collectionContextStore:o,filter:n})},style:{display:"flex",flexShrink:0},onDrop:e=>function(e,t,o){if(!o.collectionViewBlockStore())return;const n=o.currentPropertyFiltersStore.state,r=c().oA(e.map((e=>n.find((t=>t.id===e)))));d().iU({environment:t,collectionContextStore:o,temporaryState:{...o.temporaryStateStore.state,propertyFilters:{value:r}}}),u().wd({environment:t,collectionContextStore:o,action:"reorder_filters"})}(e,n,o)})}return(0,H.jsx)(H.Fragment,{children:t.map((e=>(0,H.jsx)(Y,{filter:e,collectionContextStore:o},e.id)))})}function X(e){let{collectionContextStore:t}=e;const o=(0,a().YB)(),c=(0,s().Fg)(),u=(0,i().O7)(),d=(0,l().Kw)(t.searchQueryStore),p=(0,n.useCallback)((e=>{t.searchQueryStore.setState(e.target.value)}),[t]),m=(0,r().y)(p,250);return(0,H.jsx)(v().Z,{debugName:"CollectionViewFilterBar",capture:!0,children:(0,H.jsx)(w().Z,{capture:!0,render:e=>(0,H.jsx)("div",{...e,style:{width:"100%",paddingTop:u.device.isMobile?8:12,paddingBottom:6},children:(0,H.jsx)(K().Z,{wrapStyle:{width:"100%"},innerStyle:{width:"100%"},icon:(0,B().e)({width:14,fill:c.mediumIconColor,marginRight:6}),hideChevron:!0,title:(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(b().Z,{format:b().B.Transparent,value:d,placeholder:o.formatMessage({defaultMessage:"Type to searchâ€¦",id:"database.filterBar.mobileSearch.placeholder"}),onChange:m,autoComplete:"on",autoCorrect:"on",onBlur:()=>function(e){e.searchQueryStore.state||Q(e)}(t),onClearButtonClick:()=>Q(t),showClearButton:!0,focus:!u.device.isIOS||void 0,focusInitial:!0,inputStyle:{height:"100%"}}),(0,H.jsx)(C().Z,{show:!0})]})})})})})}function $(e){let{collectionContextStore:t}=e;const o=(0,s().Fg)(),n=(0,i().O7)();return"chart"===(0,l().VK)((()=>t.getViewType()),[t])?null:(0,H.jsx)(K().Z,{wrapStyle:{display:"flex",alignItems:"center"},icon:(0,B().e)({width:14,fill:o.mediumIconColor,marginRight:6}),hideChevron:!0,title:(0,H.jsx)("span",{style:{marginTop:-1,color:o.mediumTextColor},children:(0,H.jsx)(a()._H,{defaultMessage:"Search",id:"database.filterBar.search.title"})}),onClick:()=>function(e,t){S().clear({preventDismissMobileKeyboard:!0,environment:e}),m().ZH({preventDismissMobileKeyboard:!0,environment:e}),R().wG(),t.searchOpenStore.setState(!0),t.searchQueryStore.setState(""),u().wd({environment:e,collectionContextStore:t,action:"click_mobile_search"})}(n,t)},"search")}function ee(e){let{collectionContextStore:t,showHoverActionsStore:o,saveControlMoreActionsButtonPopupStore:n}=e;return(0,H.jsx)(x().ZP,{context:x().R1.FilterBar,collectionContextStore:t,showHoverActionsStore:o,moreActionsButtonPopupStore:n})}function te(e){let{collectionContextStore:t,createFilterSettingsStore:o}=e;return(0,H.jsx)(g().PJ,{context:M().HV.FilterBar,collectionContextStore:t,collectionSettingsStore:o,hideDesktopHeader:!0})}function oe(e){let{collectionContextStore:t,showHoverActionsStore:o,createFilterSettingsStore:r}=e;const s=(0,i().O7)(),c=(0,n.useCallback)((e=>function(e,t){e&&(0,T().yT)(e.target)||p().E3({collectionSettingsStore:t})}(e,r)),[r]),d=(0,f().o)({collectionContextStore:t}),m=(0,n.useCallback)((()=>(0,H.jsx)(te,{collectionContextStore:t,createFilterSettingsStore:r})),[t,r]),S=(0,n.useCallback)((()=>function(e,t,o){u().wd({environment:e,collectionContextStore:t,action:"click_new_filter"}),p().wl({collectionSettingsStore:o,item:{type:"createFilter"}})}(s,t,r)),[s,t,r]),g=(0,l().VK)((()=>r.state.open),[r]),x=(0,l().VK)((()=>o.state||g),[o,g]);return(0,H.jsx)(k().ZP,{open:g,popupType:s.device.isMobile?k().kQ.SlideUp:k().kQ.Popup,style:d?{height:M().DQ,maxHeight:M().DQ}:void 0,origin:(0,H.jsx)(y().Z,{tag:j().Z,visible:x,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},icon:I().R,isSmall:!0,isLightGray:!0,hovered:g,onClick:S,style:{fontSize:14},children:(0,H.jsx)(a()._H,{defaultMessage:"Add filter",id:"database.filterBar.addButton.title"})}),render:m,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,onDismiss:c})}},845297:(e,t,o)=>{o.d(t,{B:()=>b});var n=o(667294),r=()=>o(219727),i=()=>o(142735),l=()=>o(846550),s=()=>o(788860),a=()=>o(707513),c=()=>o(250303),u=()=>o(931756),d=()=>o(139224),p=()=>o(765458),m=()=>o(830700),S=()=>o(967092),g=()=>o(347577),x=()=>o(949842),f=()=>o(565276),y=()=>o(547430),C=()=>o(104088),h=()=>o(61738),v=o(785893);function b(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;const l=(0,r().O7)(),[s,a]=(0,i().VK)((()=>[o.state.open,t.currentCombinatorFilterStore.state]),[t,o]),c=(0,m().o)({collectionContextStore:t}),x=(0,n.useCallback)((()=>(0,v.jsx)(p().PJ,{context:g().HV.FilterBar,collectionContextStore:t,collectionSettingsStore:o,hideDesktopHeader:!0})),[t,o]),y=(0,n.useCallback)((e=>{var n;e&&(0,f().yT)(e.target)||(d().E3({collectionSettingsStore:o}),a&&0===(null===(n=a.filters)||void 0===n?void 0:n.length)&&u().iU({environment:l,collectionContextStore:t,temporaryState:{...t.temporaryStateStore.state,combinatorFilter:{value:void 0}}}))}),[t,o,l,a]);return(0,n.useEffect)((()=>()=>d().E3({collectionSettingsStore:o})),[]),(0,v.jsx)(S().ZP,{popupType:l.device.isMobile?C().k.SlideUp:C().k.Popup,open:s,origin:(0,v.jsx)(j,{collectionContextStore:t,collectionSettingsStore:o}),style:c?{height:g().DQ,maxHeight:g().DQ}:void 0,onDismiss:y,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:x})}function j(e){var t;let{collectionContextStore:o,collectionSettingsStore:u}=e;const p=(0,r().O7)(),m=(0,l().yK)((e=>({icon:{width:void 0,height:p.device.isMobile?14:12,fill:e.blueColor,marginRight:6},title:{maxWidth:180,...a().Yu}})),[p.device]),[S,g]=(0,i().VK)((()=>[Boolean(o.localStateDiffStore.state.combinatorFilter),o.currentCombinatorFilterStore.state]),[o]),f=(0,n.useCallback)((()=>{g&&(d().wl({collectionSettingsStore:u,item:{type:"filter"}}),c().wd({environment:p,collectionContextStore:o,action:"click_combinator_filter"}))}),[o,u,p,g]);return g?(0,v.jsx)(h().Z,{icon:(0,y().Q)(m.icon),title:(0,v.jsx)("span",{style:m.title,children:(0,v.jsx)(s()._H,{defaultMessage:"{ruleCount, plural, one {{ruleCount} rule} other {{ruleCount} rules}}",id:"database.filterBar.advancedFilterRulesCount.title",values:{ruleCount:(null===(t=g.filters)||void 0===t?void 0:t.length)||0}})}),on:!0,hasDiff:S,onClick:e=>(0,x().ZP)({event:e,context:x().Af.CollectionSettingsClick,callback:f})},"combinator"):null}},364300:(e,t,o)=>{o.d(t,{Z:()=>N});o(267602),o(653476),o(470928),o(241792);var n=o(667294),r=()=>o(142735),i=()=>o(455947),l=()=>o(788860),s=()=>o(707513),a=()=>o(250303),c=()=>o(931756),u=()=>o(139224),d=()=>o(780550),p=()=>o(654133),m=()=>o(576868),S=()=>o(949842),g=()=>o(620218),x=()=>o(998901),f=()=>o(104088),y=()=>o(163262),C=()=>o(803021),h=()=>o(995867),v=()=>o(605974),b=()=>o(396136),j=()=>o(696056),k=()=>o(752778),_=()=>o(989478),w=()=>o(499110),M=()=>o(513670),T=()=>o(696459),B=()=>o(384241),I=()=>o(308252),R=()=>o(32072),F=()=>o(826955),V=o(785893);const Z=function(e){let{schema:t,propertyFilter:n,parentStore:s,valueOnly:a,style:c}=e;const u=(0,r().VK)((()=>{const e=t[n.property];if(e&&(0,o(226413).p_)(e))return(0,o(129338).ke)(e,s)}),[t,n,s]),{filter:d}=n,p=(0,i().a_)(d)?d.subfilter:d,m=(0,i().h6)(p)&&!(0,i().mv)(d),S={...c,maxWidth:void 0};return(0,V.jsx)("span",{style:(0,i().gE)(p)?S:c,children:(0,V.jsx)(l()._H,{defaultMessage:"{propertyName}{colonSeparator} {filterOperator} {propertyValue}",id:"database.filterBarFilterValue.title",values:{propertyName:a?void 0:(0,V.jsx)(P,{propertyFilter:n,schema:t}),colonSeparator:a||m?void 0:":",filterOperator:(0,V.jsx)(L,{propertyFilter:n}),propertyValue:(0,V.jsx)(K,{propertyFilter:n,schema:t,parentStore:s,relatedCollectionAppConfigUri:u})}})})};function A(){return(0,V.jsx)(l()._H,{defaultMessage:"Not",id:"database.filterBarFilterValue.notOperator"})}function P(e){let{propertyFilter:t,schema:o}=e;const n=o[t.property];return n?(0,V.jsx)("span",{style:{fontWeight:s().Ue.medium},children:n.name}):null}function L(e){let{propertyFilter:t}=e;const{filter:o}=t,n=(0,i().a_)(o)?o.subfilter:o;if((0,i().Ly)(n))return"string_contains"===n.operator||"string_is"===n.operator?null:"string_does_not_contain"===n.operator||"string_is_not"===n.operator?(0,V.jsx)(A,{}):(0,V.jsx)(V.Fragment,{children:(0,R().WC)(n.operator)});if((0,i().h6)(n))return(0,V.jsx)(V.Fragment,{children:(0,R().WC)(n.operator)});if((0,i().XA)(n)){if("checkbox_is_not"===n.operator)return(0,V.jsx)(A,{})}else{if((0,i().dx)(n))return"enum_is"===n.operator?null:"enum_is_not"===n.operator?(0,V.jsx)(A,{}):(0,V.jsx)(V.Fragment,{children:(0,R().WC)(n.operator)});if((0,i().NU)(n))return"enum_contains"===n.operator?null:"enum_does_not_contain"===n.operator?(0,V.jsx)(A,{}):(0,V.jsx)(V.Fragment,{children:(0,R().WC)(n.operator)});if((0,i().r2)(n))return"status_is"===n.operator?null:"status_is_not"===n.operator?(0,V.jsx)(A,{}):(0,V.jsx)(V.Fragment,{children:(0,R().WC)(n.operator)});if((0,i().e)(n))return"relation_contains"===n.operator?null:"relation_does_not_contain"===n.operator?(0,V.jsx)(A,{}):(0,V.jsx)(V.Fragment,{children:(0,R().WC)(n.operator)});if((0,i().Gb)(n))return"person_contains"===n.operator?null:"person_does_not_contain"===n.operator?(0,V.jsx)(A,{}):(0,V.jsx)(V.Fragment,{children:(0,R().WC)(n.operator)});if((0,i().Mp)(n)){if("location_is"===n.operator)return null;if("location_is_not"===n.operator)return(0,V.jsx)(A,{})}else if((0,i().gE)(n)){if("date_is"===n.operator)return null;if("date_is_after"===n.operator)return(0,V.jsx)(l()._H,{defaultMessage:"After",id:"database.filterValue.dateType.dateIsAfter.title"});if("date_is_before"===n.operator)return(0,V.jsx)(l()._H,{defaultMessage:"Before",id:"database.filterValue.dateType.dateIsBefore.title"});if("date_is_on_or_after"===n.operator)return(0,V.jsx)(l()._H,{defaultMessage:"On or after",id:"database.filterValue.dateType.dateIsOnOrAfter.title"});if("date_is_on_or_before"===n.operator)return(0,V.jsx)(l()._H,{defaultMessage:"On or before",id:"database.filterValue.dateType.dateIsOnOrBefore.title"});if(!(0,i().TQ)(n))return(0,V.jsx)(V.Fragment,{children:(0,R().WC)(n.operator)});{const e=n.value;if(!e.value||"exact"!==e.type||!(0,C().gR)(e.value))return(0,V.jsx)(V.Fragment,{children:(0,R().ip)(e)});if(e.value.start_date&&e.value.end_date)return null;if(e.value.start_date)return(0,V.jsx)(l()._H,{defaultMessage:"Starting",id:"database.filterValue.dateType.starting.title"});if(e.value.end_date)return(0,V.jsx)(l()._H,{defaultMessage:"Ending",id:"database.filterValue.dateType.ending.title"})}}else{if((0,i().Jw)(n))return"verification_is"===n.operator?null:"verification_is_not"===n.operator?(0,V.jsx)(A,{}):(0,V.jsx)(V.Fragment,{children:(0,R().WC)(n.operator)});(0,T().t1)(n)}}return null}function D(e){let{index:t}=e;return(0,V.jsx)("span",{style:{whiteSpace:"pre"},children:(0,V.jsx)(l()._H,{defaultMessage:", ",id:"database.filterValue.commaSeparator"})},t)}function K(e){let{propertyFilter:t,schema:o,parentStore:n,relatedCollectionAppConfigUri:r}=e;const{filter:s}=t,a=(0,i().a_)(s)?s.subfilter:s;if(!(0,i().vR)(a))return null;if((0,i().Ly)(a)||(0,i().h6)(a)){const e=a.value.value;if(void 0!==e)return(0,V.jsx)("span",{children:e})}else if((0,i().XA)(a)){const e=a.value.value;if(!0===e)return(0,V.jsx)("span",{children:(0,V.jsx)(l()._H,{defaultMessage:"Checked",id:"database.filterValue.checkboxType.checked.title"})});if(!1===e)return(0,V.jsx)("span",{children:(0,V.jsx)(l()._H,{defaultMessage:"Unchecked",id:"database.filterValue.checkboxType.unchecked.title"})})}else{if((0,i().dx)(a)||(0,i().NU)(a)){const e=(0,i().dx)(a)?(0,i().mg)(a):(0,i().qC)(a),t=M().oA(e.map((e=>{let{value:t}=e;return t})));return 0===t.length?null:(0,V.jsx)("span",{children:(0,h().Z)(t,(e=>(0,V.jsx)(D,{index:e})))})}if((0,i().r2)(a)){const e=(0,i().wB)(a),t=M().oA(e.map((e=>{let{value:t}=e;return t})));return 0===t.length?null:(0,V.jsx)("span",{children:(0,h().Z)(t,(e=>(0,V.jsx)(D,{index:e})))})}if((0,i().e)(a)){const e=(0,i().YO)(a),t=M().oA(e.map(((e,t)=>{if(!e.value)return null;const o=e.type;if("exact"===o){const t=F().G.createChildStore(n,{table:b().iU,id:e.value});return(0,V.jsx)(B().Z,{style:{display:"inline"},store:t},e.value)}if("relative"===o){var i;if("builtin"===e.value.type)return r?(0,V.jsx)("span",{children:(0,V.jsx)(l()._H,{...null===(i=v().qB[r])||void 0===i||null===(i=i[e.value.variable])||void 0===i?void 0:i.messageDescriptor})},t):null;if("current_page_in_related_collection"===e.value.type)return(0,V.jsx)("span",{children:(0,V.jsx)(l()._H,{defaultMessage:"This page",id:"database.filterAndSort.currentPagePropertyValue.title"})},t)}else(0,T().t1)(o)})));return(0,V.jsx)(V.Fragment,{children:(0,h().Z)(t,(e=>(0,V.jsx)(D,{index:e})))})}if((0,i().Gb)(a))return(0,V.jsx)(H,{useFilter:a,parentStore:n});if((0,i().Mp)(a)){const e=(0,i().u0)(a),t=M().oA(e.map((e=>{if(e.value){const t=e.value,o=F().t1.createChildStore(n,{table:k().vF,id:t});return(0,V.jsx)(B().Z,{style:{display:"inline"},store:o},t)}})));return(0,V.jsx)(V.Fragment,{children:(0,h().Z)(t,(e=>(0,V.jsx)(D,{index:e})))})}if((0,i().gE)(a)){const e=o[t.property],n=(e&&"date"===e.type?e.date_format:void 0)||C().sF;let r;if("exact"===a.value.type){const e=a.value;if(e.value)if((0,C().J_)(e.value))r=e.value;else if((0,C().gR)(e.value)){const t=(0,C().Gc)(e.value);t&&(r=t.value)}}else if(!(0,i().TQ)(a))return(0,V.jsx)(V.Fragment,{children:(0,R().x)(a.value)});if(r)return(0,V.jsx)(I().Z,{style:{display:"inline"},value:r,dateFormat:n,shortenDateAndRange:!0})}else{if((0,i().Jw)(a)){const e=(0,i().fl)(a).filter((e=>{let{value:t}=e;return Boolean(t)})).map(R().cq);return 0===e.length?null:(0,V.jsx)("span",{children:(0,h().Z)(e,(e=>(0,V.jsx)(D,{index:e})))})}(0,T().t1)(a)}}return null}function H(e){let{parentStore:t,useFilter:o}=e;const n=(0,l().YB)(),s=(0,i().R8)(o),a=(0,r().VK)((()=>M().oA(s.map(((e,o)=>{if("relative"===e.type)return(0,V.jsx)("span",{children:(0,V.jsx)(l()._H,{defaultMessage:"Me",id:"database.filterValue.personType.firstPersonPropertyValue.title"})},o);if(e.value){const r=e.value;if(r.table===_().KJ){const e=F().t1.createChildStore(t,{table:r.table,id:r.id});return(0,V.jsx)("span",{children:(0,w().Nz)(n,e.getModel())},o)}if(r.table===j().cZ){const e=F().t1.createChildStore(t,{table:r.table,id:r.id});return(0,V.jsx)("span",{children:(0,y().Mh)(e.getModel())},o)}}})))),[s,t,n]);return(0,V.jsx)(V.Fragment,{children:(0,h().Z)(a,(e=>(0,V.jsx)(D,{index:e})))})}function O(e){let{id:t,context:s,collectionContextStore:y,collectionSettingsStore:C,onClick:h}=e;const v=(0,o(219727).O7)(),b=(0,o(846550).Fg)(),{filter:j,isReadOnly:k}=(0,r().VK)((()=>{const e=function(e,t){const o=t.currentPropertyFiltersStore.state;return o.find((t=>t.id===e))}(t,y),o=Boolean(y.viewsModuleContextStore.getViewModuleType());if(e&&o&&(0,i().dE)(e.filter.filter))return{filter:e,isReadOnly:!0};return{filter:e,isReadOnly:Boolean(e&&(0,m().mu)(e.id))}}),[y,t]),_=(0,r().VK)((()=>{const e=y.localStateDiffStore.state;return e.filters.updated.includes(t)||e.filters.added.includes(t)}),[y,t]),w=(0,r().VK)((()=>y.collectionViewStore()),[y]),M=(0,r().Kw)(y.normalizedSchemaStore),T=(0,r().VK)((()=>y.permissionScopesStore.state.canConfigureBlock),[y]),B=(0,r().VK)((()=>C.state.open),[C]),I=(0,r().VK)((()=>{var e;return j?null==y||null===(e=y.collectionStore())||void 0===e||null===(e=e.getSchema()[j.filter.property])||void 0===e?void 0:e.type:void 0}),[y,j]),R=(0,r().VK)((()=>j&&j.id===m().OC),[j]),F=(0,n.useCallback)((e=>{e&&(0,o(565276).yT)(e.target)||u().E3({collectionSettingsStore:C})}),[C]),A=(0,n.useCallback)((()=>{var e;h&&h(),j&&(C.state.open?u().E3({collectionSettingsStore:C}):u().wl({collectionSettingsStore:C,item:{type:"filter"}}),a().wd({environment:v,collectionContextStore:y,action:"click_property_filter",original_view_type:void 0,property_type:null==y||null===(e=y.collectionStore())||void 0===e||null===(e=e.getSchema()[j.filter.property])||void 0===e?void 0:e.type}))}),[y,C,v,j,h]),P=(0,n.useCallback)((()=>{u().E3({collectionSettingsStore:C})}),[C]),L=(0,n.useCallback)((e=>{var t;if(!j)return;const n=null===(t=y.remoteResultStore.state)||void 0===t?void 0:t.sizeHint,r=g().default.DO_NOT_USE_markLegacy("collections.update_filter_lag");g().default.DO_NOT_USE_measureAfterNextFlushLegacy(r,{environment:v,getData:()=>o(861026).Y5({from:"property_filter",property_type:I,collectionContextStore:y,sizeHintAtStart:n})});const i=j.filter,l=y.currentPropertyFiltersStore.state.map((t=>{if(t.id===j.id){return{...j,filter:{...i,filter:e}}}return t}));c().iU({environment:v,collectionContextStore:y,temporaryState:{...y.temporaryStateStore.state,propertyFilters:{value:l}}}),a().wd({environment:v,collectionContextStore:y,action:"update_property_filter",original_view_type:void 0,property_type:I})}),[y,v,j,I]),D=(0,o(629013).y)(L,250),K=(0,n.useCallback)((()=>{var e;if(!j)return;const t=y.currentPropertyFiltersStore.state.filter((e=>e.id!==j.id));c().iU({environment:v,collectionContextStore:y,temporaryState:{...y.temporaryStateStore.state,propertyFilters:{value:t}}}),a().wd({environment:v,collectionContextStore:y,action:"delete_property_filter",original_view_type:void 0,property_type:null==y||null===(e=y.collectionStore())||void 0===e||null===(e=e.getSchema()[j.filter.property])||void 0===e?void 0:e.type})}),[y,v,j]),H=(0,n.useCallback)((()=>{var e;if(!j)return;const{combinatorFilter:t,propertyFilters:n}=(0,m().Gz)(y,j);c().iU({environment:v,collectionContextStore:y,temporaryState:{...y.temporaryStateStore.state,propertyFilters:{value:n},combinatorFilter:{value:t}}});const r=s===o(259314).Pt.FilterBar?y.filterBarCombinatorFilterSettingsStore:y.filterOptionsCombinatorFilterSettingsStore;u().wl({collectionSettingsStore:r,item:{type:"filter"}}),a().wd({environment:v,collectionContextStore:y,action:"merge_filter_into_combinator",property_type:null==y||null===(e=y.collectionStore())||void 0===e||null===(e=e.getSchema()[j.filter.property])||void 0===e?void 0:e.type})}),[y,s,v,j]),O=(0,n.useCallback)(((e,t)=>{if(!w||!j)return null;const n=j.filter,r=!(0,i().Oo)(n),l=M[n.property];return(0,V.jsx)(o(61738).Z,{icon:l&&(0,V.jsx)(o(766933).ZP,{type:l.type,icon:l.icon,size:v.device.isMobile?18:16,theme:b,style:{fill:void 0,marginRight:6}}),title:r?(0,V.jsx)(Z,{propertyFilter:n,schema:M,style:U(),parentStore:w}):(0,V.jsx)("span",{style:U(),children:null==l?void 0:l.name}),on:r,hasDiff:_,disabled:t,hideChevron:t,onClick:e=>((0,S().ZP)({event:e,context:S().Af.CollectionSettingsClick,callback:A}),e.preventDefault(),!1),...e},j.id)}),[w,v,j,A,_,M,b]),N=(0,n.useCallback)((()=>R?(0,V.jsx)(p().Z,{placement:x().Placement.Bottom,render:e=>O(e,!0),renderTooltip:()=>(0,V.jsx)(l()._H,{id:"database.filterBarPropertyFilter.cannotConfigureSubitemDisplayMode",defaultMessage:"To modify this filter, first change the subitem display mode."})}):(0,V.jsx)(p().Z,{placement:x().Placement.Bottom,render:e=>O(e,!0),renderTooltip:()=>(0,V.jsx)(l()._H,{id:"database.filterBarPropertyFilter.cannotConfigure",defaultMessage:"This filter cannot be modified on this view."})})),[O,R]),E=(0,n.useCallback)((()=>{if(!j)return;const e=j.filter;return w?(0,V.jsx)(d().ZP,{collectionViewId:w.id,propertyFilter:e,schema:M,parentStore:w,onChange:L,onChangeDebounced:D,onClose:P,onDelete:K,onAddToCombinatorFilter:H,context:d().Qv.PropertyFilter,userCanConfigureFilters:T,allowRelativeDateFilter:!0,allowRelativePersonFilter:!0,collectionContextStore:y}):void 0}),[T,y,w,j,H,K,P,D,L,M]);return k?N():(0,V.jsx)(o(967092).ZP,{popupType:v.device.isMobile?f().k.SlideUp:f().k.Popup,open:B,origin:k?N():O(void 0,!1),onDismiss:F,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:E})}const N=n.memo(O,o(632314).Z);function U(){return{maxWidth:180,...s().Yu}}},61738:(e,t,o)=>{o.d(t,{Z:()=>a});o(667294);var n=()=>o(219727),r=()=>o(846550),i=()=>o(154186),l=()=>o(615634),s=o(785893);function a(e){const{icon:t,title:o,on:a,disabled:c,hasDiff:u,wrapStyle:d,innerStyle:p,hideChevron:m}=e,S=(0,n().O7)(),g=(0,r().yK)((e=>{const t=S.device.isMobile;return{filterPill:{fontSize:14,display:"inline-flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",borderRadius:32,height:t?28:24,lineHeight:t?"28px":"24px",padding:"0 8px",border:`1px solid ${e.outlineButtonBorder}`,color:e.mediumTextColor,...a&&{color:e.blueColor,border:`1px solid ${e.filterPillBorder}`,background:e.filterPillBackground},...c&&{color:e.text.uiBlueTertiary,border:`1px solid ${e.text.uiBlueTertiary}`,background:e.filterPillBackground},...p},hovered:a?{background:e.outlineBlueButtonHoveredBackground}:{},pressed:a?{background:e.outlineBlueButtonPressedBackground}:{},chevron:{width:10,marginLeft:4,marginTop:1,fill:c?e.text.uiBlueTertiary:a?e.blueColor:e.lightIconColor},diffDot:{position:"absolute",top:-2,right:-2,background:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[300],border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9}}}),[c,S.device.isMobile,p,a]);return(0,s.jsxs)("div",{style:{borderRadius:14,marginRight:6,display:"inline-flex",...u&&{position:"relative"},...d},children:[(0,s.jsxs)(i().Z,{disabled:c,style:g.filterPill,hoveredStyle:g.hovered,pressedStyle:g.pressed,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onClick:e.onClick,onDoubleClick:e.onDoubleClick,children:[t,o,!m&&(0,l().i)(g.chevron)]}),u&&(0,s.jsx)("div",{style:g.diffDot})]})}},455876:(e,t,o)=>{o.d(t,{Z:()=>d});o(267602),o(653476);var n=o(667294),r=()=>o(492788),i=()=>o(142735),l=()=>o(336860),s=()=>o(840521),a=()=>o(513670),c=()=>o(543172),u=()=>o(932753);function d(e){const{id:t,reducer:o,collectionContextStore:d,groupsPointer:p,debounceWait:m}=e,S=(0,i().VK)((()=>p),[p],{useDeepEqual:!0}),g=(0,i().VK)((()=>o),[o],{useDeepEqual:!0}),x=(0,i().VK)((()=>d.collectionViewStore()),[d]),f=(0,i().VK)((()=>d.normalizedFormatStore.state.collection_pointer),[d.normalizedFormatStore]),y=(0,i().VK)((()=>{var e;return null==x||null===(e=x.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_view_source").getValue()}),[x]),C=(0,n.useRef)(!1),h=(0,s().g)(),[v,b]=(0,n.useReducer)(((e,t)=>a().Xy(e,t)?e:t),void 0),j=(0,n.useCallback)((()=>{const e=d.localResultStore.state,o=d.remoteResultStore.state,n=e&&"reducer"===e.type?e.reducerResults[t]:void 0,r=o&&"reducer"===o.type?o.reducerResults[t]:void 0;return function(e){const{reducerId:t,localReducerResult:o,remoteReducerResult:n,collectionContextStore:r,reducer:i}=e,s=r.reducersStore.state,c=r.remoteResultStore.state,u=r.isClientModeEnabledStore.state;if(u)return o;if("aggregation"===i.type||"groups"===i.type){const e=r.isCreatingNewChartCollectionStore.state,n=null==c?void 0:c.reducerResults[t],l=r.wasCreatedThisSessionStore.state;if(e&&l){const e=Boolean(n&&"groups"===n.type&&("v2"===n.version?n.hasMore:0!==n.total)),t=Boolean(n&&"aggregation"===n.type&&"number"===n.aggregationResult.type&&0!==n.aggregationResult.value);return(e||t)&&r.isCreatingNewChartCollectionStore.setState(!1),o}if(n)return n;const u=Boolean(c&&"reducer"===c.type&&a().sE(c.reducerResults,((e,t)=>{const o=s[t];if(!o)return!1;const n="groups"===i.type?void 0:i.filter;return Boolean("results"===o.reducer.type&&!o.reducer.searchQuery&&"results"===e.type&&e.hasMore&&a().Xy(n,o.reducer.filter))})));return u?o:n}if("results"===i.type){var d;const e=r.wasCreatedThisSessionStore.state,i=Boolean(c&&"reducer"===c.type&&c.reducerResults[t]),s=null===(d=r.collectionViewStore())||void 0===d?void 0:d.getCollectionSource(),a=(0,l().WW)(s)||(0,l().v7)(s);if((i||e)&&!a&&o&&"results"===o.type){return{...o,hasMore:n&&"results"===n.type?n.hasMore:o.hasMore}}return n}}({reducerId:t,collectionContextStore:d,reducer:g,localReducerResult:n,remoteReducerResult:r})}),[d,g,t]),k=(0,n.useCallback)((()=>{C.current=!1,h.current||b(j())}),[j,h]),_=(0,n.useCallback)((()=>{C.current||(C.current=!0,r().default.afterNextFlush(k))}),[k]),[w]=(0,n.useState)((()=>(0,c().ZP)()));return(0,n.useEffect)((()=>{const e=m?(0,a().Ds)(_,m,{leading:!0}):_;return d.remoteResultStore.addListener(_),d.localResultStore.addListener(e),()=>{d.remoteResultStore.removeListener(_),d.localResultStore.removeListener(e)}}),[d,_,m]),(0,n.useEffect)((()=>(u().$D({reducerId:t,instanceId:w,reducer:g,collectionContextStore:d,groupsPointer:S}),()=>{u().$D({reducerId:t,instanceId:w,reducer:void 0,collectionContextStore:d,groupsPointer:S})})),[d,x,f,y,S,g,t,w]),(0,n.useEffect)((()=>{_()}),[]),(0,n.useEffect)((()=>(d.timingTracker.mountCollectionReducerRequest(t,g.type),()=>{d.timingTracker.unmountCollectionReducerRequest(t)})),[d,t,g]),v}},178498:(e,t,o)=>{o.d(t,{Z:()=>l});var n=o(667294),r=o(785893);function i(e,t){return(0,r.jsx)(o(18748).ZP,{...e,ref:t,style:{background:"none",borderBottom:"none",boxShadow:"",marginTop:2,marginBottom:6,paddingTop:4,paddingBottom:4,minHeight:"none",...e.style}})}const l=(0,n.forwardRef)(i)},840820:(e,t,o)=>{o.d(t,{Z:()=>a});o(667294);var n=()=>o(219727),r=()=>o(104088),i=()=>o(708518),l=()=>o(967092),s=o(785893);function a(e){const{isMobile:t}=(0,n().Fy)();return t?(0,s.jsx)(l().ZP,{ariaLabel:e.ariaLabel,open:e.isOpen,popupType:r().k.SlideUp,origin:e.origin,onDismiss:e.onDismiss,render:e.render,style:e.style}):(0,s.jsx)(i().Z,{ariaLabel:e.ariaLabel,open:e.isOpen,preventHideChildrenWhileOpening:!0,render:e.render,onDismiss:e.onDismiss,style:e.style,innerStyle:e.innerStyle,showCloseIcon:e.showCloseIcon})}},50272:(e,t,o)=>{o.d(t,{FF:()=>l,Yy:()=>a,bZ:()=>s});o(667294);var n=()=>o(788860),r=()=>o(125302),i=o(785893);function l(e){let{origin:t}=e;return(0,i.jsx)(r().r,{origin:t,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"current-sprint-view-tooltip",header:(0,i.jsx)(n()._H,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.header",defaultMessage:"Manage the current sprint"}),content:(0,i.jsx)(n()._H,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.content",defaultMessage:"Add tasks and update task status as your team makes progress during the sprint."})})}function s(e){let{origin:t}=e;return(0,i.jsx)(r().r,{origin:t,placementToOrigin:"bottom",tutorialId:"sprints-onboarding",tutorialStepId:"sprint-task-tooltip",header:(0,i.jsx)(n()._H,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.header",defaultMessage:"Change tasks status"}),content:(0,i.jsx)(n()._H,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.content",defaultMessage:'Drag this task to "In progress".'})})}function a(e){let{origin:t}=e;return(0,i.jsx)(r().r,{origin:t,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"complete-sprint-button-tooltip",header:(0,i.jsx)(n()._H,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.header",defaultMessage:"Complete this sprint"}),content:(0,i.jsx)(n()._H,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.content",defaultMessage:"Click the button when you're done with this sprint."})})}},560287:(e,t,o)=>{o.d(t,{Z:()=>et});var n=o(667294),r=()=>o(142735),i=()=>o(219727),l=()=>o(846550),s=()=>o(788860),a=()=>o(707513),c=()=>o(491927),u=()=>o(315917),d=()=>o(861026),p=()=>o(731322),m=()=>o(876822),S=()=>o(50272),g=(o(267602),o(653476),o(241792),()=>o(198690)),x=()=>o(263184),f=()=>o(506347),y=()=>o(926724),C=()=>o(38883),h=()=>o(803021),v=()=>o(646574),b=()=>o(827370),j=()=>o(396136),k=()=>o(126301),_=()=>o(955620),w=()=>o(568017),M=()=>o(513670),T=()=>o(696459),B=()=>o(326966),I=()=>o(47443),R=()=>o(86609),F=()=>o(285755),V=()=>o(141735),Z=()=>o(352230),A=()=>o(549813),P=()=>o(129338),L=()=>o(677559),D=()=>o(15409),K=()=>o(615634),H=()=>o(518530),O=()=>o(521777),N=()=>o(960852),U=()=>o(738957),E=()=>o(826955),z=()=>o(768826),W=()=>o(356321),q=()=>o(827973),Y=()=>o(448419),G=()=>o(1910),Q=()=>o(668001),J=()=>o(198829),X=()=>o(255577),$=()=>o(470386),ee=()=>o(92175),te=()=>o(906651),oe=()=>o(943620),ne=()=>o(384241),re=()=>o(388284),ie=()=>o(565796),le=()=>o(840820),se=()=>o(765513),ae=()=>o(78014),ce=o(785893);const ue=(0,s().vU)({completedPercentSummary:{id:"completeAutomationSprintModal.sprintSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} total tasks"},selectNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectNextSprintLabel",defaultMessage:"Next sprint"},selectDatesForNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectDatesForNextSprintLabel",defaultMessage:"Start and end dates"},nextSprintDatesLabel:{id:"completeAutomationSprintModal.sprintSummary.nextSprintDatesLabel",defaultMessage:"Next sprint dates"},cancelButton:{id:"completeAutomationSprintModal.sprintSummary.cancel",defaultMessage:"Cancel"},fallbackSprintName:{id:"completeAutomationSprintModal.sprintName.placeholder",defaultMessage:"Sprint"}});function de(e){let{onDismiss:t,...o}=e;const{isOpen:r}=o,l=(0,i().O7)(),s=(0,n.useId)(),a=e=>{t();let n=!1;(0,T().Kn)(e)&&(0,T().$K)(e.clickedCancel)&&(n=!0===e.clickedCancel),c().$X(l,{...(0,d().Pn)(o.taskCollectionContextStore),action:n?"cancel_modal":"dismiss_modal"})};return(0,ce.jsx)(le().Z,{ariaLabelledBy:s,isOpen:r,onDismiss:()=>a(),render:()=>(0,ce.jsx)(pe,{...o,onDismiss:a,titleAriaId:s})})}function pe(e){var t;const{completeSprintAutomationContext:o,setIsLoading:l,taskCollectionContextStore:a,onDismiss:c,completeSprintAutomationState:u,onAutomationComplete:d,titleAriaId:p}=e,{currentSprintId:S,querySprintsResult:f,currentSprintTaskSummary:y}=u,C=(0,s().YB)(),v=(0,i().O7)(),{isMobile:b}=(0,i().Fy)(),{value:_}=(0,L().XJ)(V().F.formulas),{value:w}=(0,L().XJ)(F().Sm.automationTypecheck),{value:M}=(0,L().XJ)(F().Sm.automationActionRegistry),T=(0,r().VK)((()=>m().default.state.currentUserSettingsStore),[]),I=(0,r().VK)((()=>o.sprintCollectionStore),[o]),R=(0,r().VK)((()=>{var e;const t=null===(e=o.automationContext)||void 0===e?void 0:e.automationStore;return null==t?void 0:t.getRecurrence()}),[o]),Z=(0,r().VK)((()=>{var e;return(null===(e=o.automationContext)||void 0===e||null===(e=e.automationActionStore.getConfig())||void 0===e?void 0:e.complete_sprint_action)??"complete_sprint_and_move_incomplete_tasks_to_next_sprint"}),[null===(t=o.automationContext)||void 0===t?void 0:t.automationActionStore]),P=(0,r().VK)((()=>I.getSpaceId()),[I]),D=(0,r().VK)((()=>{if(S)return E().G.createChildStore(I,{id:S,table:j().iU,spaceId:I.getSpaceId()})}),[S,I]),K=(0,r().VK)((()=>D?(0,A().vU)({intl:C,environment:v,store:D,untitledFallback:ue.fallbackSprintName}):C.formatMessage(ue.fallbackSprintName)),[D,C,v]),H=(0,r().VK)((()=>ye({sprintBlockStore:D,sprintCollectionStore:I})),[D,I]),O=(0,r().VK)((()=>Ce({sprintDateRange:H,intl:C})),[H,C]),[N,U]=n.useState(),z=(0,r().VK)((()=>x().default.createValue(Z)),[Z]),W=n.useMemo((()=>{if(!R||null==H||!H.end_date)return;const e=(0,k().Su)(R);return e?(0,k().rP)({currentSprintEndDate:H.end_date,sprintSchedule:e}):void 0}),[R,null==H?void 0:H.end_date]),q=(0,r().VK)((()=>{if("pointer"!==(null==N?void 0:N.type))return;return ye({sprintBlockStore:E().G.createChildStore(I,N.pointer),sprintCollectionStore:I})}),[N,I]),[Y,G]=n.useState(void 0),Q=n.useMemo((()=>{if(Y&&(0,h().h)(Y))return Y}),[Y]),J=n.useMemo((()=>{if(!f)return;const{nextSprintIds:e,futureSprintIds:t}=f;return e.length>0?e:t}),[f]),X=(0,r().VK)((()=>{if(void 0===J)return;const e=J[0];return e?{type:"pointer",pointer:{id:e,table:j().iU,spaceId:P}}:{type:"actionId"}}),[J,P]),$=(0,r().VK)((()=>{var e;return!Boolean(null==T||null===(e=T.getSettings())||void 0===e?void 0:e.seen_sprint_settings_engagement_banner)}),[T]);n.useEffect((()=>{X&&U(X)}),[X,U]),n.useEffect((()=>{G(q??W)}),[q,W,G]);const oe=n.useCallback((async()=>{if(c(),!(_&&w&&M&&N&&Q&&o.automationContext))return;l(!0);const e=0===(null==y?void 0:y.incompleteTaskCount)?"complete_sprint":z.state;if(!o.automationContext)return;const t={type:"recurrence",recurrence:{type:"completeSprint",completeSprintActionType:e,nextSprintDateRange:Q},automationStore:o.automationContext.automationStore,intl:C,parentRecordStore:o.currentCollectionViewBlockStore,formulasModule:_,isLoggedIn:v.currentUser.isLoggedIn(),automationTypecheckModule:w,automationActionRegistryModule:M},n=()=>{d()},{automationExecutionActions:r}=await F().Sm.automations.load();await r.executeClientAutomation({environment:v,clientContext:t,onUndo:()=>{l(!0),n(),l(!1)}}),n(),l(!1)}),[c,_,N,Q,o.automationContext,o.currentCollectionViewBlockStore,w,M,l,null==y?void 0:y.incompleteTaskCount,z,C,v,d]),ne=ge({isMobile:b}),{status:re}=(0,g().V)({value:u,validateLoaded:e=>!1===e.isLoading,waitTimeInMs:1*B().hM});if("pending"!==re&&u.isLoading)return(0,ce.jsx)(me,{titleAriaId:p,onDismiss:c,sprintCollectionStore:I});if(u.isLoading)return(0,ce.jsx)(Se,{titleAriaId:p,onDismiss:c});const{incompleteTaskCount:ie}=u.currentSprintTaskSummary,le=Boolean(N)&&Boolean(Q),se=void 0!==J&&J.length>0;return(0,ce.jsxs)("div",{style:ne.modalContainer,children:[(0,ce.jsx)("div",{style:ne.header,id:p,children:(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.sprintSummary.title",defaultMessage:"{sprintName} summary",values:{sprintName:K}})}),(0,ce.jsx)(fe,{currentSprintFormattedDateRange:O,currentSprintTaskSummary:y}),$&&(0,ce.jsx)(xe,{collectionContextStore:a,userSettingsStore:T,onDismissModal:c}),se&&(0,ce.jsxs)("div",{style:ne.flexRow,children:[C.formatMessage(ue.selectNextSprintLabel),(0,ce.jsx)(ke,{nextSprintInput:N,setNextSprintInput:U,completeSprintAutomationContext:o,sprintPageIds:J})]}),(0,ce.jsxs)("div",{style:ne.flexRow,children:[se?C.formatMessage(ue.selectDatesForNextSprintLabel):C.formatMessage(ue.nextSprintDatesLabel),(0,ce.jsx)(we,{sprintDateRange:Y,setSprintDateRange:G})]}),ie>0&&(0,ce.jsxs)("div",{style:ne.flexRow,children:[(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksLabel",defaultMessage:"{incompleteTaskCount, plural, one {{incompleteTaskCount} incomplete task} other {{incompleteTaskCount} incomplete tasks}}",values:{incompleteTaskCount:ie}}),(0,ce.jsx)(ve,{actionTypeStore:z})]}),(0,ce.jsx)(te().Z,{disabled:!le,onClick:()=>{oe()},style:ne.button,children:(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButton",defaultMessage:"Complete {sprintName}",values:{sprintName:K}})}),(0,ce.jsx)(ee().Z,{onClick:()=>c({clickedCancel:!0}),style:ne.button,children:C.formatMessage(ue.cancelButton)})]})}function me(e){const{onDismiss:t,sprintCollectionStore:o,titleAriaId:n}=e,l=(0,i().O7)(),a=(0,s().YB)(),{isMobile:c}=(0,i().Fy)(),u=(0,r().VK)((()=>o.getParentBlockStore()),[o]),d=ge({isMobile:c});return(0,ce.jsxs)("div",{style:d.modalContainer,children:[(0,ce.jsx)("div",{style:d.header,id:n,children:(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.missingCurrentSprint.title",defaultMessage:"No current sprint found"})}),(0,ce.jsx)(te().Z,{onClick:()=>{u&&I()._c({environment:l,store:u,pageVisitSource:f().tY.LinkInPage})},style:{...d.button,marginTop:24},children:(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.missingCurrentSprint.navigateToSprintsDatabase",defaultMessage:"Fix in Sprints database"})}),(0,ce.jsx)(ee().Z,{onClick:t,style:d.button,children:a.formatMessage(ue.cancelButton)})]})}function Se(e){const{onDismiss:t,titleAriaId:o}=e,n=(0,s().YB)(),{isMobile:r}=(0,i().Fy)(),l=ge({isMobile:r});return(0,ce.jsxs)("div",{style:l.modalContainer,children:[(0,ce.jsx)("div",{style:l.header,id:o,children:(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.sprintSummary.titlePlaceholder",defaultMessage:"Sprint summary"})}),(0,ce.jsx)("div",{style:l.subheader,children:(0,ce.jsx)(Q().Z,{style:l.subheaderShimmer})}),(0,ce.jsxs)("div",{style:l.flexRow,children:[n.formatMessage(ue.selectNextSprintLabel),(0,ce.jsx)(Q().Z,{style:l.flexRowShimmerBox1})]}),(0,ce.jsxs)("div",{style:l.flexRow,children:[n.formatMessage(ue.selectDatesForNextSprintLabel),(0,ce.jsx)(Q().Z,{style:l.flexRowShimmerBox2})]}),(0,ce.jsxs)("div",{style:l.flexRow,children:[(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksPlaceholder",defaultMessage:"Incomplete tasks"}),(0,ce.jsx)(Q().Z,{style:l.flexRowShimmerBox3})]}),(0,ce.jsx)(te().Z,{disabled:!0,onClick:M().ZT,style:l.button,children:(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButtonPlaceholder",defaultMessage:"Complete sprint"})}),(0,ce.jsx)(ee().Z,{onClick:t,style:l.button,children:n.formatMessage(ue.cancelButton)})]})}function ge(e){let{isMobile:t}=e;return(0,l().yK)((e=>{const o={height:44,borderRadius:8,display:"flex",alignItems:"center",width:void 0},n={...o,marginTop:12,marginBottom:18};return{modalContainer:{width:400,display:"flex",fontSize:t?a().JB.UIRegular.mobile:a().JB.UIRegular.desktop,flexDirection:"column",justifyContent:"center",padding:20},header:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:t?18:16,fontWeight:a().Ue.semibold},subheader:{display:"flex",alignItems:"center",justifyContent:"center",color:e.lightTextColor,marginBottom:16,gap:8},separator:{height:2,width:2,borderRadius:2,backgroundColor:e.lightIconColor},flexRow:{display:"flex",...t?{flexDirection:"column",fontSize:14,color:e.mediumTextColor}:{justifyContent:"space-between",alignItems:"center",height:24,marginBottom:16}},completedTaskGroup:{display:"flex",gap:4},button:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:8,...t&&o},subheaderShimmer:{borderRadius:4,marginTop:6,width:200,height:16,...t&&{height:22}},flexRowShimmerBox1:{borderRadius:4,width:60,height:16,...t&&n},flexRowShimmerBox2:{borderRadius:4,width:80,height:16,...t&&n},flexRowShimmerBox3:{borderRadius:4,width:140,height:16,...t&&n},dropdownButton:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:4,...t&&{...n,border:`1px solid ${e.stroke.secondary}`,justifyContent:"space-between"}},dropdownChevronIcon:{color:e.lightIconColor,width:12,height:"auto"}}}),[t])}function xe(e){const{collectionContextStore:t,userSettingsStore:o,onDismissModal:n}=e,r=(0,i().O7)(),c=(0,l().yK)((e=>({banner:{width:"100%",display:"flex",alignItems:"start",backgroundColor:e.accentColors.blue["light"===e.mode?50:300],borderRadius:4,padding:12,marginBottom:12,fontSize:12,lineHeight:1.5,gap:8},bannerContent:{flex:"1 1 auto",color:e.regularTextColor},bannerTitle:{fontWeight:a().Ue.regular},icon:{width:12,color:e.blueColor},repeatIcon:{flex:"0 0 auto",marginBlockStart:3},closeButton:{marginTop:-3,borderRadius:"50%"},link:{color:e.text.uiBluePrimary}})),[]);return(0,ce.jsxs)("div",{style:c.banner,children:[(0,ce.jsx)("div",{style:c.repeatIcon,children:(0,N().N)(c.icon)}),(0,ce.jsx)("div",{style:c.bannerContent,children:(0,ce.jsx)("div",{style:c.bannerTitle,children:(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.turnOnAutomaticSprints.banner.title",defaultMessage:"Complete your sprints automatically. Turn on Automated sprints in <linkToSprintSettings>Settings</linkToSprintSettings>.",values:{linkToSprintSettings:function(){for(var e=arguments.length,i=new Array(e),l=0;l<e;l++)i[l]=arguments[l];return(0,ce.jsx)(se().Z,{onClick:()=>{o&&(n(),R().zX({environment:r,userSettingsStore:o}),R().Rh(t))},disableUnderline:!0,style:c.link,children:i})}}})})}),(0,ce.jsx)(G().Z,{icon:H().U,ariaLabel:"closeButton",style:c.closeButton,onClick:()=>{o&&R().zX({environment:r,userSettingsStore:o})}})]})}function fe(e){const{currentSprintFormattedDateRange:t,currentSprintTaskSummary:o}=e,{isMobile:n}=(0,i().Fy)(),r=(0,s().YB)(),l=ge({isMobile:n}),a=o?r.formatMessage(ue.completedPercentSummary,{completedTaskCount:o.completedTaskCount,totalTaskCount:o.totalTaskCount}):void 0,c=t&&o?(0,ce.jsxs)(ce.Fragment,{children:[t,(0,ce.jsx)("div",{style:l.separator}),a]}):t||a;return void 0===c?null:(0,ce.jsx)("div",{style:l.subheader,children:c})}function ye(e){const{sprintBlockStore:t,sprintCollectionStore:o}=e;if(!t)return;const n=o.getPropertyMapping(),r=null==n?void 0:n[y().b0.Dates];if(!r)return;const i=t.getPropertyValue(r);if(!i)return;const l=(0,_().nai)(i)[0];return l?(0,h().Ls)(l):void 0}function Ce(e){const{sprintDateRange:t,intl:o}=e;if(t&&(0,h().h)(t))return(0,v().ZV)({value:t,allowRelativeDates:!1,shortenDateAndRange:!0,displayInUserTimezone:!0,intl:o})}const he={complete_sprint_and_move_incomplete_tasks_to_next_sprint:(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.sprintSummary.moveToNextSprintOption",defaultMessage:"Move to next sprint"}),complete_sprint_and_move_incomplete_tasks_to_backlog:(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.sprintSummary.moveToBacklogOption",defaultMessage:"Move to backlog"}),complete_sprint:(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.sprintSummary.keepInThisSprintOption",defaultMessage:"Keep in current sprint"})};function ve(e){const{actionTypeStore:t}=e,{isMobile:o}=(0,i().Fy)(),n=(0,r().Kw)(t),l=ge({isMobile:o});return(0,ce.jsx)(Y().ZP,{popupType:o?Y().Z4.SlideUp:Y().Z4.Popup,alignmentToOrigin:Y().vR.Start,placementToOrigin:Y().pO.Bottom,render:e=>(0,ce.jsx)(je,{actionTypeStore:t,buttonPopupParent:e}),renderOrigin:e=>(0,ce.jsxs)(ee().Z,{...e,style:l.dropdownButton,children:[he[n],(0,K().i)(l.dropdownChevronIcon)]})})}const be=["complete_sprint_and_move_incomplete_tasks_to_next_sprint","complete_sprint_and_move_incomplete_tasks_to_backlog","complete_sprint"];function je(e){const{actionTypeStore:t,buttonPopupParent:o}=e,{isMobile:n}=(0,i().Fy)(),s=(0,l().yK)((e=>({checkIcon:{color:e.lightIconColor,width:12,height:"auto",marginLeft:4}})),[]),a=(0,r().VK)((()=>be.map((e=>{const n=e===t.state;return{key:e,action:()=>{t.setState(e),o.close()},render:t=>(0,ce.jsx)(q().Z,{...t,title:he[e],right:n&&(0,D().e)(s.checkIcon)})}}))),[t,s.checkIcon,o]);let c;return c=n?{menuType:Z().o.ActionSheet}:{menuType:Z().o.Popup,maxHeight:"50vh",minWidth:230},(0,ce.jsx)(J().Z,{...c,children:(0,ce.jsx)(X().Z,{type:X().i.Vertical,initialFocus:0,sections:[{key:"sprint_automations",items:a,render:e=>(0,ce.jsx)(re().Z,{...e})}]})})}function ke(e){const{nextSprintInput:t,completeSprintAutomationContext:o,setNextSprintInput:n,sprintPageIds:a}=e,{sprintCollectionStore:c}=o,{isMobile:u}=(0,i().Fy)(),d=(0,i().O7)(),p=(0,s().YB)(),m=(0,r().VK)((()=>{if(void 0===t)return(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.sprintSelect.empty",defaultMessage:"Select sprint"});if("actionId"===t.type)return(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.sprintSelect.newSprint",defaultMessage:"New sprint"});if("pointer"===t.type){const e=E().G.createChildStore(c,t.pointer);return(0,A().vU)({intl:p,environment:d,store:e,untitledFallback:ue.fallbackSprintName})}(0,T().t1)(t)}),[t,p,c,d]),S=ge({isMobile:u}),g=(0,l().yK)((e=>({button:{...void 0===t&&{color:e.lightTextColor}}})),[t]),x={...S.dropdownButton,...g.button};return 0===a.length||1===a.length?(0,ce.jsx)(ee().Z,{style:x,disabled:!0,children:m}):(0,ce.jsx)(Y().ZP,{popupType:u?Y().Z4.SlideUp:Y().Z4.Popup,alignmentToOrigin:Y().vR.Start,placementToOrigin:Y().pO.Bottom,render:e=>(0,ce.jsx)(_e,{buttonPopupParent:e,completeSprintAutomationContext:o,sprintPageIds:a,nextSprintInput:t,setNextSprintInput:n}),renderOrigin:e=>(0,ce.jsxs)(ee().Z,{...e,style:x,children:[m,(0,K().i)(S.dropdownChevronIcon)]})})}function _e(e){const{sprintPageIds:t,completeSprintAutomationContext:o,buttonPopupParent:a,nextSprintInput:c,setNextSprintInput:u}=e,{sprintCollectionStore:d}=o,{isMobile:p}=(0,i().Fy)(),m=(0,r().VK)((()=>d.getSpaceId()),[d]),S=(0,r().VK)((()=>(0,P().U1)({collectionStore:o.taskCollectionStore,property:y().Es.TaskToSprintRelation}).filter((e=>e.visible&&("title"===e.property||o.sprintCollectionSchema[e.property])))),[o]),g=(0,r().VK)((()=>new(U().Z)),[]),x=(0,l().yK)((e=>({checkIcon:{color:e.lightIconColor,width:12,height:"auto",marginLeft:4},plusIcon:{color:e.lightIconColor,width:12,height:"auto"},createSprintRow:{display:"flex",gap:4},sprintRow:{display:"flex",maxHeight:22,alignItems:"center"},recordTitle:{...p&&{marginRight:12}}})),[p]),f="purple",h=(0,l().Fg)(),v=(0,w().KR)(h,f),k=n.useMemo((()=>{const e="actionId"===(null==c?void 0:c.type);return{key:"new_sprint",action:()=>{u({type:"actionId"}),a.close()},render:t=>(0,ce.jsx)(q().Z,{...t,icon:(0,O().R)(x.plusIcon),title:(0,ce.jsxs)("div",{style:x.createSprintRow,children:[(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.selectSprintDropdown.createNew",defaultMessage:"New sprint"}),(0,ce.jsx)(ae().Z,{isRound:!0,showRemoveButton:!1,value:(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.selectSprintDropdown.createNewToken",defaultMessage:"Next"}),format:C().lo.Medium,isSingle:!0,color:v.textColor,backgroundColor:v.backgroundColor,showColoredDot:f})]}),right:e&&(0,D().e)(x.checkIcon)})}}),[c,a,u,x,v]),_=(0,r().VK)((()=>t.map((e=>{const t={id:e,table:j().iU,spaceId:m},o=E().G.createChildStore(d,t),n=o.getIcon(),r="pointer"===(null==c?void 0:c.type)&&b().dr.isEqual(c.pointer,t);return{key:e,action:()=>{u({type:"pointer",pointer:t}),a.close()},render:e=>(0,ce.jsx)(q().Z,{...e,icon:n&&(0,ce.jsx)(oe().Z,{disabled:!0,icon:n,isEmptyPage:!1,size:20}),title:(0,ce.jsx)("div",{style:x.sprintRow,children:S.map((e=>"title"===e.property?(0,ce.jsx)(ne().Z,{store:o,style:x.recordTitle},"title"):(0,ce.jsx)(z().m,{store:o,property:e.property,disabled:!1,locked:!1,format:W().C.Relation,tableWrap:!1,blockPropertyValueOverlayStore:g,collectionStore:d},e.property))).filter(T().$K)}),right:r&&(0,D().e)(x.checkIcon)})}}))),[d,g,a,c,S,m,u,x,t]),M=[{key:"sprints",items:n.useMemo((()=>_.length>0?_:[k]),[_,k]),render:e=>(0,ce.jsx)(re().Z,{...e})}];let B;return B=p?{menuType:Z().o.ActionSheet}:{menuType:Z().o.Popup,maxHeight:"50vh",minWidth:230},(0,ce.jsx)(J().Z,{...B,children:(0,ce.jsx)(X().Z,{type:X().i.Vertical,initialFocus:0,sections:M})})}function we(e){const{sprintDateRange:t,setSprintDateRange:o}=e,a=(0,s().YB)(),{isMobile:c}=(0,i().Fy)(),u=n.useMemo((()=>Ce({sprintDateRange:t,intl:a})),[t,a]),d=ge({isMobile:c}),p=(0,l().yK)((e=>({button:{...!u&&{color:e.lightTextColor}}})),[u]),m=(0,r().VK)((()=>u||(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.sprintSummary.nextSprintDate.placeholder",defaultMessage:"Select dates"})),[u]);return(0,ce.jsx)(Y().ZP,{popupType:c?Y().Z4.SlideUp:Y().Z4.Popup,alignmentToOrigin:Y().vR.Start,placementToOrigin:Y().pO.Bottom,render:e=>(0,ce.jsx)(Me,{sprintDateRange:t,setSprintDateRange:o,onDismiss:()=>{e.close()}}),renderOrigin:e=>(0,ce.jsxs)(ee().Z,{...e,style:{...d.dropdownButton,...p.button},children:[m,(0,K().i)(d.dropdownChevronIcon)]})})}function Me(e){const{sprintDateRange:t,setSprintDateRange:o,onDismiss:r}=e,{isMobile:l}=(0,i().Fy)(),a=n.useMemo((()=>({starting:null!=t&&t.start_date?{type:"date",start_date:t.start_date}:void 0,ending:null!=t&&t.end_date?{type:"date",start_date:t.end_date}:void 0})),[t]);let c;return c=l?{menuType:Z().o.Modal,right:(0,ce.jsx)($().DoneMenuText,{}),onClickRight:r}:{menuType:Z().o.Popup,maxHeight:"50vh",paddingTop:6},(0,ce.jsxs)(J().Z,{...c,children:[(0,ce.jsx)(re().Z,{children:(0,ce.jsx)(ie().Z,{title:void 0,disableMenuWrap:!0,allowRelativeRangeFilter:!0,value:a,onUpdate:e=>{var t,n;if(e.error)return;const r={...a,...e.value},i=null===(t=r.starting)||void 0===t?void 0:t.start_date,l=null===(n=r.ending)||void 0===n?void 0:n.start_date;o({type:"daterange",start_date:i,end_date:l})},onDismiss:r})}),(0,ce.jsx)(re().Z,{topBorder:!0,children:(0,ce.jsx)(q().Z,{focused:!1,onClick:()=>{o(void 0)},title:(0,ce.jsx)(s()._H,{id:"completeAutomationSprintModal.sprintSummary.datePicker.clear",defaultMessage:"Clear"})})})]})}o(470928);var Te=()=>o(998411),Be=()=>o(801812),Ie=()=>o(605974),Re=()=>o(824462),Fe=()=>o(856466),Ve=()=>o(253335);function Ze(e){if(!e)return;if("aggregation"!==e.type)return;if("text"!==e.aggregationResult.type)return;const t=e.aggregationResult.value,o=null==t?void 0:t.split("/");if(!o||2!==o.length)return;const n=Number(o[0]),r=Number(o[1]);return{completedTaskCount:n,incompleteTaskCount:r-n,totalTaskCount:r,completedTaskPercent:0===r?0:n/r}}function Ae(e){if(!e)return;const t=e.getPropertyMapping(),o=null==t?void 0:t[y().Es.TaskToSprintRelation];if(!o)return;return Ve().Ws.filter.property=o,{...Ve().Ws.filter,property:o}}function Pe(e,t){if(!t)return;const o=t.getPropertyMapping(),n=Ae(t);if(!n)return;const r=null==o?void 0:o[y().Es.Status];if(!r)return;const i=t.getSchema()[r];if(!i||"status"!==i.type)return;const l=(0,Fe().F_)(e,i);return l?{type:"aggregation",filter:{operator:"and",filters:[n]},aggregation:{aggregator:{operator:"count_per_group",groupName:l},property:r}}:void 0}class Le extends x().default{getInitialState(){return{isLoading:!0,currentSprintId:void 0,querySprintsResult:void 0,currentSprintTaskSummary:void 0}}updateCurrentSprint(e){const{querySprintsResult:t,currentSprintTaskSummary:o}=this.state;void 0!==e&&void 0!==t&&void 0!==o?this.setState({isLoading:!1,currentSprintId:e,querySprintsResult:t,currentSprintTaskSummary:o}):e?this.setState({...this.state,currentSprintId:e}):this.setState({...this.state,isLoading:!0,currentSprintId:e})}updateNextAndFutureSprints(e){const{currentSprintId:t,currentSprintTaskSummary:o}=this.state;void 0!==t&&void 0!==e&&void 0!==o?this.setState({isLoading:!1,currentSprintId:t,querySprintsResult:e,currentSprintTaskSummary:o}):e?this.setState({...this.state,querySprintsResult:e}):this.setState({...this.state,isLoading:!0,querySprintsResult:e})}updateCurrentSprintTaskSummary(e){const{currentSprintId:t,querySprintsResult:o}=this.state;void 0!==t&&void 0!==o&&void 0!==e?this.setState({isLoading:!1,currentSprintId:t,querySprintsResult:o,currentSprintTaskSummary:e}):e?this.setState({...this.state,currentSprintTaskSummary:e}):this.setState({...this.state,isLoading:!0,currentSprintTaskSummary:e})}}const De=Le;function Ke(e){const{taskCollectionContextStore:t,completeSprintAutomationContext:o,children:l,isModalOpen:a}=e,{sprintCollectionStore:c}=o,u=c.id,d=(0,i().O7)(),p=(0,r().VK)((()=>new De),[]),m=(0,r().VK)((()=>p.state),[p]),S=(0,r().VK)((()=>{var e;const o=t.relativeVariableStore.state;return null==o||null===(e=o[u])||void 0===e?void 0:e.current}),[u,t]);n.useEffect((()=>{p.updateCurrentSprint(S)}),[S,p]);const[{value:g}]=(0,Be().r5)((async()=>await async function(e){var t;const{environment:o,completeSprintAutomationContext:n}=e,{sprintCollectionStore:r}=n,i=function(e){var t,o;const{sprintCollectionStore:n,sprintCollectionSchema:r}=e,i=n.getPropertyMapping(),l=null==i?void 0:i[y().b0.StatusV2];if(!l)return;const s=r[l];if(!s||"status"!==s.type)return;const a=null===(t=s.options)||void 0===t||null===(t=t.find((e=>e.id===y().YE)))||void 0===t?void 0:t.value,c=null===(o=s.options)||void 0===o||null===(o=o.find((e=>e.id===y().eH)))||void 0===o?void 0:o.value;if(!a||!c)return;const u=Ie().qB[y().p$].next.reducer.getCombinatorFilter(r);if(!u)return;const d={type:"results",filter:u,limit:He},p={type:"results",filter:{operator:"and",filters:[{property:l,filter:{operator:"status_is",value:{type:"is_option",value:c}}}]},limit:He};return{[y().YE]:d,[y().eH]:p}}(n),l=r.getPropertyMapping(),s=null==l?void 0:l[y().b0.Dates],a=null==l?void 0:l[y().b0.UniqueId];if(!i||!s||!a)return;const c={userId:o.currentUser.id,userTimeZone:(0,Te().r)(),searchQuery:void 0,sort:[{property:s,direction:"ascending"},{property:a,direction:"ascending"}],reducers:i},u=null===(t=r.getParentBlockStore())||void 0===t?void 0:t.getCollectionViewStores()[0],d=r.getSpaceId();if(!u)return;const p=await Re().callApi({eventName:"queryCollection",environment:o,data:{source:{type:"collection",id:r.id,spaceId:d},collectionView:{id:u.id,spaceId:d},loader:c},tracking:{src:"complete_sprint_modal_sprint_picker"}});if("success"!==p.type)return;const m=p.data.result.reducerResults[y().YE],S=p.data.result.reducerResults[y().eH];if("results"!==m.type||"results"!==S.type)return;const g=m.blockIds,x=S.blockIds;return{nextSprintIds:g,futureSprintIds:x}}({environment:d,completeSprintAutomationContext:o})),[S,d,o]);n.useEffect((()=>{p.updateNextAndFutureSprints(g)}),[g,p]);const x=(0,s().YB)(),[{value:f}]=(0,Be().r5)((async()=>await async function(e){var t;const{environment:o,completeSprintAutomationContext:n,intl:r}=e,{taskCollectionStore:i}=n,l=Pe(r,i);if(!l)return;const s=Ae(i);if(!s)return;const a={filter:{operator:"and",filters:[s]},userId:o.currentUser.id,userTimeZone:(0,Te().r)(),searchQuery:"",sort:[],reducers:{completed_tasks_in_current_sprint:l}},c=null===(t=i.getParentBlockStore())||void 0===t?void 0:t.getCollectionViewStores()[0],u=i.getSpaceId();if(!c)return;const d=await Re().callApi({eventName:"queryCollection",environment:o,data:{source:{type:"collection",id:i.id,spaceId:u},collectionView:{id:c.id,spaceId:u},loader:a},tracking:{src:"complete_sprint_modal_sprint_picker"}});if("success"!==d.type)return;return Ze(d.data.result.reducerResults.completed_tasks_in_current_sprint)}({intl:x,environment:d,completeSprintAutomationContext:o})),[S,d,o,a]);return n.useEffect((()=>{p.updateCurrentSprintTaskSummary(f)}),[f,p]),(0,ce.jsx)(ce.Fragment,{children:l({completeSprintAutomationState:m,onAutomationComplete:()=>{p.reset()}})})}const He=5;var Oe=()=>o(661297),Ne=()=>o(67901),Ue=()=>o(576868),Ee=()=>o(472344);function ze(e){const{percentage:t}=e;return(0,ce.jsx)(Ee().b,{numberValue:t,numberFormat:void 0,numberPrecision:void 0,numberShowAs:{type:"ring",maxValue:1,color:"blue",showValue:!1},shouldRenderTooltip:!1,progressSize:15})}const We=function(e){const{isLoading:t,taskSummary:n,styles:r}=e;return(0,ce.jsx)("div",{style:{width:16,height:"auto",...r},children:t?(0,ce.jsx)(o(312578).Z,{}):(0,ce.jsx)(ze,{percentage:(null==n?void 0:n.completedTaskPercent)??0})})};function qe(e){const{taskCollectionContextStore:t,children:o}=e,n=(0,r().VK)((()=>(0,Ue().Nq)(t)),[t]),i=(0,r().VK)((()=>t.collectionStore()),[t]),l=(0,s().YB)(),a=(0,r().VK)((()=>Pe(l,i)),[i,l]);return!a||n?null:(0,ce.jsx)(Ne().Z,{id:"completed_tasks_in_current_sprint_view",collectionContextStore:t,reducer:a,render:e=>{const t=Ze(e.state);return t?(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsx)(Ye,{currentSprintTasksInView:t}),o(t)]}):null}})}function Ye(e){const{currentSprintTasksInView:t}=e,o=(0,l().yK)((e=>({summary:{display:"flex",alignItems:"center",justifyContent:"center",columnGap:5,color:e.lightTextColor,fontSize:a().JB.UIRegular.desktop,fontWeight:a().Ue.regular,whiteSpace:"nowrap"}})),[]),{isPhone:n}=(0,i().Fy)();return n?null:(0,ce.jsxs)("div",{style:o.summary,children:[(0,ce.jsx)(We,{styles:{paddingTop:1},isLoading:!1,taskSummary:t}),(0,ce.jsx)(s()._H,{id:"completeAutomationSprintAutomation.inlineSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} tasks",values:{completedTaskCount:t.completedTaskCount,totalTaskCount:t.totalTaskCount}})]})}function Ge(e){const{collectionContextStore:t,completeSprintAutomationContext:o}=e,l=(0,i().O7)(),[s,a]=n.useState(!1),[S,g]=n.useState(!1),x=n.useCallback((()=>{g(!1)}),[g]),f=(0,r().VK)((()=>o.permissionsContext.canEdit),[o.permissionsContext.canEdit]),y=(0,r().VK)((()=>m().default.state.currentUserSettingsStore),[]),C=()=>{g(!0);"complete-sprint-button-tooltip"===(0,p().wF)(y,"sprints-onboarding")&&u().tutorialGoToNextStep(l,"sprints-onboarding"),c().$X(l,{...(0,d().Pn)(t),action:"open_modal"})};return f?(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsx)(Ke,{completeSprintAutomationContext:o,taskCollectionContextStore:t,isModalOpen:S,children:e=>{let{completeSprintAutomationState:n,onAutomationComplete:r}=e;return(0,ce.jsx)(de,{completeSprintAutomationContext:o,isOpen:S,onDismiss:x,setIsLoading:a,taskCollectionContextStore:t,completeSprintAutomationState:n,onAutomationComplete:r})}}),(0,ce.jsx)(qe,{taskCollectionContextStore:t,children:()=>(0,ce.jsx)(Qe,{taskCollectionContextStore:t,onClick:C,isLoading:s})})]}):null}function Qe(e){const{taskCollectionContextStore:t,onClick:o,isLoading:c}=e,{isPhone:u}=(0,i().Fy)(),d=n.useRef(null),p=function(e){const{isPhone:t}=e;return(0,l().yK)((e=>({button:{height:26,marginLeft:8,fontWeight:a().Ue.medium,...t&&{flexGrow:1,borderRadius:8,height:44}}})),[t])}({isPhone:u}),g=(0,r().VK)((()=>t.collectionViewBlockStore()),[t]),x=(0,r().VK)((()=>m().default.state.currentSpaceStore),[]),f=(0,r().VK)((()=>null==g?void 0:g.getSpaceId()),[g]);if(!g)return(0,ce.jsx)(ce.Fragment,{});const y=f===(null==x?void 0:x.id);return(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsx)(Oe().Z,{ref:d,onClick:o,style:p.button,disabled:c,disabledFeedback:c,children:(0,ce.jsx)(s()._H,{defaultMessage:"Complete sprint",id:"completeSprintAutomationButton.label"})}),y&&(0,ce.jsx)(S().Yy,{origin:d})]})}var Je=()=>o(730120);function Xe(e){var t;const{collectionContextStore:o,sprintAutomationContext:n}=e,s=(0,l().yK)((e=>({summary:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:17,columnGap:5,color:e.lightTextColor,fontSize:a().JB.UIRegular.desktop,fontWeight:a().Ue.regular,whiteSpace:"nowrap"},icon:{width:16,height:"auto",paddingTop:2}})),[]),{isPhone:c}=(0,i().Fy)(),u=(0,r().VK)((()=>{var e;const t=null===(e=n.automationContext)||void 0===e?void 0:e.automationStore.getRunAt();if(!t)return;const o=Je().ou.fromMillis(t,{zone:"utc"}).toLocal().startOf("day"),r=Je().ou.now().startOf("day"),i=o.diff(r,"days").days;return i<1?"soon":1===i?"today":2===i?"tomorrow":i-1}),[null===(t=n.automationContext)||void 0===t?void 0:t.automationStore]);return u?(0,ce.jsx)(qe,{taskCollectionContextStore:o,children:()=>c?null:(0,ce.jsxs)("div",{style:s.summary,children:[(0,N().N)(s.icon),(0,ce.jsx)($e,{daysRemaining:u})]})}):null}function $e(e){const{daysRemaining:t}=e;return"soon"===t?(0,ce.jsx)(s()._H,{id:"completeAutomationSprintAutomation.inlineSummary.endingSoon",defaultMessage:"Ending soon"}):"today"===t?(0,ce.jsx)(s()._H,{id:"completeAutomationSprintAutomation.inlineSummary.endsToday",defaultMessage:"Ends today"}):"tomorrow"===t?(0,ce.jsx)(s()._H,{id:"completeAutomationSprintAutomation.inlineSummary.endsTomorrow",defaultMessage:"Ends tomorrow"}):(0,ce.jsx)(s()._H,{id:"completeAutomationSprintAutomation.inlineSummary.daysRemaining",defaultMessage:"Ends in {daysRemaining} days",values:{daysRemaining:t}})}const et=function(e){var t;const{collectionContextStore:o}=e,n=(0,r().VK)((()=>o.completeSprintButtonContextStore.state),[o]),i=(0,r().VK)((()=>{var e;return Boolean(null==n||null===(e=n.automationContext)||void 0===e?void 0:e.automationStore.isActive())}),[null==n||null===(t=n.automationContext)||void 0===t?void 0:t.automationStore]);return n?i?(0,ce.jsx)(Xe,{collectionContextStore:o,sprintAutomationContext:n}):(0,ce.jsx)(Ge,{collectionContextStore:o,completeSprintAutomationContext:n}):null}},779013:(e,t,o)=>{o.d(t,{_:()=>i});var n=o(667294);const r=new Map;function i(e){const t=!r.get(e),o=(0,n.useRef)(t);return o.current&&r.set(e,!0),(0,n.useEffect)((()=>()=>{o.current&&r.set(e,!1)}),[e]),o.current}},404553:(e,t,o)=>{o.d(t,{M:()=>n().M});var n=()=>o(682890)},220193:(e,t,o)=>{o.d(t,{N:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("arrowDownThick",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M7.99316 1.52246C7.40527 1.52246 7.00195 1.93262 7.00195 2.54785V10.1357L7.07031 11.6191L5.69629 10.0332L4.1582 8.50195C3.98047 8.31738 3.74805 8.19434 3.44727 8.19434C2.91406 8.19434 2.51074 8.59082 2.51074 9.15137C2.51074 9.41113 2.61328 9.65039 2.81836 9.8623L7.26172 14.3125C7.44629 14.5039 7.72656 14.6133 7.99316 14.6133C8.2666 14.6133 8.54004 14.5039 8.72461 14.3125L13.1748 9.8623C13.3799 9.65039 13.4824 9.41113 13.4824 9.15137C13.4824 8.59082 13.0791 8.19434 12.5459 8.19434C12.252 8.19434 12.0195 8.31738 11.835 8.50195L10.2969 10.0332L8.92285 11.6191L8.98438 10.1357V2.54785C8.98438 1.93262 8.58789 1.52246 7.99316 1.52246Z"})})},985481:(e,t,o)=>{o.d(t,{k:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("arrowRightSmaller",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M15.383 8.352a.877.877 0 01-.274.64l-5.156 5.14a.864.864 0 01-.617.266.831.831 0 01-.602-.234.795.795 0 01-.234-.586c0-.12.02-.232.063-.336a.912.912 0 01.187-.273l1.75-1.766 2.914-2.656.274.5-2.711.156H1.484c-.26 0-.471-.078-.632-.234a.851.851 0 01-.235-.617c0-.256.078-.461.235-.618a.856.856 0 01.632-.242h9.493l2.71.164-.273.508L10.5 5.5 8.75 3.727a.946.946 0 01-.188-.266.917.917 0 01-.062-.344c0-.234.078-.43.234-.586a.831.831 0 01.602-.234.79.79 0 01.328.07c.104.047.203.117.297.211l5.148 5.133a.877.877 0 01.274.64z"})})},977012:(e,t,o)=>{o.d(t,{w:()=>n().w});var n=()=>o(933713)},735957:(e,t,o)=>{o.d(t,{e:()=>n().e});var n=()=>o(570328)},681245:(e,t,o)=>{o.d(t,{D:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("eyeHideInversePadded",{viewBox:"0 0 24 24",svg:(0,n.jsx)("path",{d:"M17.3867 18.1074C17.6055 18.3193 17.9404 18.333 18.1592 18.1074C18.3848 17.875 18.3711 17.5469 18.1592 17.335L6.5791 5.76855C6.37402 5.55664 6.01855 5.5498 5.80664 5.76855C5.60156 5.97363 5.60156 6.3291 5.80664 6.53418L17.3867 18.1074ZM12 6.1582C10.8105 6.1582 9.73047 6.36328 8.72559 6.69141L9.81934 7.78516C10.5098 7.58691 11.2275 7.4707 12 7.4707C16.3682 7.4707 19.8408 11.2715 19.8408 12.0713C19.8408 12.6113 18.7334 14.0059 16.9766 15.1064L17.9883 16.125C20.1348 14.7168 21.3857 12.8779 21.3857 12.0713C21.3857 10.6699 17.6055 6.1582 12 6.1582ZM12 17.9912C13.2646 17.9912 14.4199 17.7725 15.4658 17.4102L14.3789 16.3232C13.6338 16.542 12.8477 16.6787 12 16.6787C7.63184 16.6787 4.15918 13.0283 4.15918 12.0713C4.15918 11.6133 5.32129 10.1299 7.19434 8.98145L6.16211 7.94922C3.92676 9.37109 2.60742 11.251 2.60742 12.0713C2.60742 13.4727 6.46973 17.9912 12 17.9912ZM15.4111 13.3906C15.5889 12.9873 15.6914 12.5361 15.6914 12.0713C15.6914 10.0137 14.0508 8.39355 12 8.39355C11.5283 8.39355 11.084 8.48242 10.6738 8.65332L15.4111 13.3906ZM12 15.7559C12.5332 15.7559 13.0322 15.6328 13.4766 15.4209L8.64355 10.5811C8.4248 11.0322 8.30176 11.5312 8.30176 12.0781C8.30859 14.0811 9.94238 15.7559 12 15.7559Z"})})},419273:(e,t,o)=>{o.d(t,{f:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("plusThick",{viewBox:"0 0 14 14",svg:(0,n.jsx)("path",{d:"M2 7.16357C2 7.59692 2.36011 7.95093 2.78735 7.95093H6.37622V11.5398C6.37622 11.9731 6.73022 12.3271 7.16357 12.3271C7.59692 12.3271 7.95093 11.9731 7.95093 11.5398V7.95093H11.5398C11.9731 7.95093 12.3271 7.59692 12.3271 7.16357C12.3271 6.73022 11.9731 6.37622 11.5398 6.37622H7.95093V2.78735C7.95093 2.36011 7.59692 2 7.16357 2C6.73022 2 6.37622 2.36011 6.37622 2.78735V6.37622H2.78735C2.36011 6.37622 2 6.73022 2 7.16357Z"})})},911206:(e,t,o)=>{o.d(t,{j:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("sortPadded",{viewBox:"0 0 24 24",svg:(0,n.jsx)("path",{d:"M7.50879 5.80273L4.06348 9.32324C3.92676 9.4668 3.83789 9.67188 3.83789 9.85645C3.83789 10.2803 4.13184 10.5674 4.54883 10.5674C4.75391 10.5674 4.91797 10.499 5.04785 10.3623L6.46289 8.89941L7.37891 7.83984L7.32422 9.30273V17.8477C7.32422 18.2715 7.625 18.5723 8.04199 18.5723C8.45898 18.5723 8.75977 18.2715 8.75977 17.8477V9.30273L8.70508 7.83984L9.62793 8.89941L11.0361 10.3623C11.166 10.499 11.3369 10.5674 11.5352 10.5674C11.9521 10.5674 12.2461 10.2803 12.2461 9.85645C12.2461 9.67188 12.1641 9.4668 12.0205 9.32324L8.58203 5.80273C8.28125 5.48828 7.80957 5.48145 7.50879 5.80273ZM16.4912 18.3398L19.9365 14.8057C20.0732 14.6689 20.1621 14.4639 20.1621 14.2793C20.1621 13.8555 19.8682 13.5684 19.4512 13.5684C19.2461 13.5684 19.082 13.6367 18.9453 13.7734L17.5371 15.2295L16.6211 16.2959L16.6758 14.833V6.28809C16.6758 5.87109 16.375 5.56348 15.958 5.56348C15.541 5.56348 15.2334 5.87109 15.2334 6.28809V14.833L15.2881 16.2959L14.3721 15.2295L12.9639 13.7734C12.8271 13.6367 12.6631 13.5684 12.4648 13.5684C12.0479 13.5684 11.7539 13.8555 11.7539 14.2793C11.7539 14.4639 11.8359 14.6689 11.9727 14.8057L15.418 18.3398C15.7188 18.6475 16.1904 18.6543 16.4912 18.3398Z"})})},682890:(e,t,o)=>{o.d(t,{M:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("arrowDown",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M8 1.57715C7.5625 1.57715 7.25488 1.88477 7.25488 2.33594V10.8262L7.30957 12.3027L5.50488 10.2861L3.95312 8.75488C3.82324 8.625 3.63184 8.53613 3.42676 8.53613C3.0166 8.53613 2.70898 8.85059 2.70898 9.26758C2.70898 9.46582 2.78418 9.64355 2.94141 9.80762L7.44629 14.3193C7.59668 14.4697 7.79492 14.5586 8 14.5586C8.20508 14.5586 8.40332 14.4697 8.55371 14.3193L13.0586 9.80762C13.2158 9.64355 13.291 9.46582 13.291 9.26758C13.291 8.85059 12.9902 8.53613 12.5801 8.53613C12.3682 8.53613 12.1836 8.625 12.0469 8.75488L10.4951 10.2861L8.69043 12.2959L8.74512 10.8262V2.33594C8.74512 1.88477 8.44434 1.57715 8 1.57715Z"})})},570328:(e,t,o)=>{o.d(t,{e:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("collectionSearch",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M0 6.35938C0 9.86719 2.85156 12.7188 6.35938 12.7188C7.66406 12.7188 8.85938 12.3203 9.85938 11.6406L13.4531 15.2344C13.6719 15.4609 13.9766 15.5625 14.2812 15.5625C14.9453 15.5625 15.4219 15.0625 15.4219 14.4141C15.4219 14.1016 15.3125 13.8125 15.1016 13.5938L11.5312 10.0156C12.2734 8.99219 12.7188 7.72656 12.7188 6.35938C12.7188 2.85156 9.86719 0 6.35938 0C2.85156 0 0 2.85156 0 6.35938ZM1.65625 6.35938C1.65625 3.76562 3.75781 1.65625 6.35938 1.65625C8.95312 1.65625 11.0625 3.76562 11.0625 6.35938C11.0625 8.95312 8.95312 11.0625 6.35938 11.0625C3.75781 11.0625 1.65625 8.95312 1.65625 6.35938Z"})})}}]);