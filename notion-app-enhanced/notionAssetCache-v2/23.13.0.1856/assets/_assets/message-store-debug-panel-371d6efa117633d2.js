"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[51308],{36706:(e,t,n)=>{n.r(t),n.d(t,{MessageStoreDebugPanel:()=>S});n(670560),n(241792);var a=()=>n(332594),s=()=>n(30817),i=()=>n(757814),o=()=>n(698649),r=()=>n(917455),l=n(667294),d=()=>n(846550),u=()=>n(513670),c=()=>n(326966),h=()=>n(748621),p=()=>n(957861),g=()=>n(560038),x=()=>n(97331),m=n(785893);const b=300,v=500,f=1*c().C0,k={...n(193382).j,fontSize:"10px",background:"black",border:"1px solid white",color:"white"},y={fontSize:"10px"};function M(e,t,n){const a=e.slice();return a.push(t),a.length>n&&a.splice(0,a.length-n),a}function S(){const[e,t]=(0,l.useState)({subscriptions:[],queueSize:[],pendingUnsubscribes:[],pendingEvictions:[]}),n=(0,l.useMemo)((()=>[{pluralName:"subscriptions",stroke:"white",fill:"black",data:e.subscriptions},{pluralName:"queued requests",stroke:"yellow",fill:"transparent",data:e.queueSize},{pluralName:"pending unsubscribes",stroke:"springgreen",fill:"transparent",data:e.pendingUnsubscribes},{pluralName:"pending evictions",stroke:"lightgray",fill:"transparent",data:e.pendingEvictions}]),[e]);(0,l.useEffect)((()=>{const n=window.setTimeout((()=>{const n=(0,x().Tm)(),a=(0,x().EM)(),s=g().Z.getPendingUnsubscribeCount(),i=p().Z.getPendingEvictionCount();t({subscriptions:M(e.subscriptions,n._total,b),queueSize:M(e.queueSize,a.queue,b),pendingUnsubscribes:M(e.pendingUnsubscribes,s,b),pendingEvictions:M(e.pendingEvictions,i,b)})}),f);return()=>window.clearTimeout(n)}),[e]);const a=(0,d().yK)((()=>({panelStyle:{position:"fixed",right:"calc(50% - 160px)",bottom:0,width:"320px",color:"white",background:"rgba(0, 0, 0, 0.75)",padding:"8px"},headingStyle:{fontWeight:600,fontSize:"14px"}})),[]);return(0,m.jsx)(h().Z,{open:!0,children:(0,m.jsxs)("div",{style:a.panelStyle,children:[(0,m.jsx)("div",{style:a.headingStyle,children:"MessageStore metrics"}),(0,m.jsx)(j,{width:304,height:64,dataStreams:n,maxDataLength:b,baseMaxDataValue:v,dataPointIntervalMs:f})]})})}function w(e){const t=Date.now()-e;return t<c().C0?"just now":t<c().hM?`${Math.round(t/c().C0)} seconds ago`:`${(t/c().hM).toFixed(1)} minutes ago`}function j(e){const{width:t,height:n,dataStreams:d,maxDataLength:c,baseMaxDataValue:h,dataPointIntervalMs:p}=e,[g,x]=(0,l.useState)(),b=(0,l.useMemo)((()=>Math.max(h,...u().xH(d.map((e=>e.data))))),[d,h]),v=(0,l.useMemo)((()=>(0,s().Z)({range:[n,0],domain:[0,b],nice:!0})),[n,b]),f=(0,l.useMemo)((()=>(0,s().Z)({range:[0,t],domain:[0,c-1],nice:!0})),[t,c]),M=(0,l.useCallback)((()=>x(void 0)),[]),S=(0,l.useCallback)((e=>{const{x:t}=(0,a().Z)(e)||{x:0},n=Math.round(f.invert(t)),s=d[0].data.length;if(n>=s)return void x(void 0);const i=d[0][n],o=v(i),r=Date.now()-(s-1-n)*p;x({x:t,y:o,dataStreamIndex:n,timestamp:r})}),[f,d,v,p]);return(0,m.jsxs)("div",{children:[(0,m.jsxs)("svg",{width:t,height:n,children:[d.map(((e,t)=>(0,m.jsx)(i().Z,{data:e.data,x:(e,t)=>f(t),y:e=>v(e),strokeWidth:1,stroke:e.stroke,fill:e.fill,yScale:v},t))),(0,m.jsx)(o().Z,{x:0,y:0,width:t,height:n,fill:"transparent",onMouseMove:S,onMouseLeave:M})]}),g&&(0,m.jsx)("div",{children:(0,m.jsxs)(r().Z,{top:g.y,left:g.x,style:k,children:[(0,m.jsx)("div",{style:{color:"darkgray"},children:w(g.timestamp)}),d.map(((e,t)=>(0,m.jsxs)("div",{style:{color:e.stroke},children:[e.data[g.dataStreamIndex]," ",e.pluralName]},t)))]},Math.random())}),(0,m.jsx)("div",{style:y,children:d.map(((e,t)=>(0,m.jsxs)("div",{style:{color:e.stroke},children:[0===e.data.length?"0":e.data[e.data.length-1]," ",e.pluralName]},t)))})]})}}}]);