"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[86609],{86609:(t,e,n)=>{n.d(e,{KV:()=>G,Rh:()=>L,U6:()=>H,Wu:()=>et,Xx:()=>j,YD:()=>tt,g9:()=>z,jc:()=>Y,m8:()=>Q,ys:()=>J,zX:()=>Z});n(122556),n(582845),n(250570),n(533019),n(721473),n(788208),n(22624),n(267602),n(30005),n(241792),n(228244);var o=()=>n(730120),r=()=>n(506347),a=()=>n(926724),i=()=>n(271896),s=()=>n(226413),c=()=>n(803021),l=()=>n(874459),d=()=>n(956057),p=()=>n(528514),u=()=>n(494616),m=()=>n(922713),S=()=>n(396136),g=()=>n(752778),f=()=>n(255933),y=()=>n(306164),v=()=>n(856466),_=()=>n(126301),k=()=>n(955620),C=()=>n(253335),w=()=>n(110232),h=()=>n(285755),D=()=>n(23151),T=()=>n(932753),b=()=>n(544903),V=()=>n(594546),A=()=>n(487270),x=()=>n(527278),F=()=>n(876822),B=()=>n(826955),I=()=>n(250303),O=()=>n(824462),P=()=>n(984871),R=()=>n(139224),E=()=>n(421654),W=()=>n(636340),M=()=>n(511614),U=()=>n(269299),N=()=>n(663366),X=()=>n(348141);const q="week";function j(t){var e;const{environment:n,transaction:o,tasksBlockStore:r,sprintsBlockStore:a}=t,i=null===(e=a.getFormat())||void 0===e?void 0:e.collection_pointer,s=r.getFormat().collection_pointer;if(!i||!s)return;const c=B().NW.createChildStore(a,i),l=c.getRole()??"none";if(!(0,p().yY)(l,"editor"))return;c.getAutomationStores().some((t=>t.isCompleteSprintAutomation()))||K({environment:n,transaction:o,sprintCollectionStore:c,taskCollectionStore:B().NW.createChildStore(r,s),sprintSettingsConfig:v().iZ})}function K(t){const{environment:e,sprintSettingsConfig:n,transaction:o,sprintCollectionStore:r,taskCollectionStore:a}=t,i=r.getSpaceId(),s=(0,A().TS)({environment:e,table:u().cv,spaceId:i}),c=(0,A().TS)({environment:e,table:m().Xj,spaceId:i});W().ae({environment:e,table:u().cv,inMemoryRecordCache:r.inMemoryRecordCache,value:{id:s,parent_id:r.id,parent_table:r.table,alive:!0,space_id:i,status:n.autoCompleteSprints?"active":"disabled",trigger:{id:d().Il(),type:"recurrence",recurrence:ot(n)},action_ids:[c]},transaction:o}),E().FH({stores:[r],update:{automation_ids:[...r.getFormat().automation_ids??[],s]},transaction:o}),W().ae({environment:e,table:m().Xj,inMemoryRecordCache:r.inMemoryRecordCache,transaction:o,value:{id:c,parent_id:s,parent_table:u().cv,type:"complete_sprint",alive:!0,space_id:i,config:{sprint_collection:r.getSpaceShardedPointer(),task_collection:a.getSpaceShardedPointer(),complete_sprint_action:n.actionConfig.complete_sprint_action}}})}function G(t){const{environment:e,automationStore:n,transaction:o,newDuration:r,currentSprintBlockStore:a}=t;W().sW({store:n.getTriggerStore().getKeyStore("recurrence"),data:{interval:r},transaction:o}),$({environment:e,transaction:o,automationStore:n,currentSprintBlockStore:a})}function z(t){const{environment:e,automationStore:n,transaction:o,newWeekday:r,currentSprintBlockStore:a}=t;W().sW({store:n.getTriggerStore().getKeyStore("recurrence"),data:{weekdays:[r]},transaction:o}),$({environment:e,transaction:o,automationStore:n,currentSprintBlockStore:a})}function Y(t){const{environment:e,actionStore:n,automationStore:o,transaction:r,newAutocompleteStatus:a,currentSprintBlockStore:s}=t;W().sW({store:o,data:{status:a?"active":"disabled"},transaction:r}),$({environment:e,transaction:r,automationStore:o,currentSprintBlockStore:s});const c=o.getParentPointer();if(!c||c.table!==g().vF)return;const l=(0,V().mc)(e),d={automation_id:o.id,automation_actions:[{automation_action_id:n.id,type:"complete_sprint"}],automation_triggers:[{type:"recurrence"}],collection_id:c.id};a?(0,i().Rt)(l,d):(0,i().ai)(l,d)}function $(t){const{automationStore:e,currentSprintBlockStore:n,transaction:r,environment:i}=t;if(!e.isActive())return;const s=e.getRecurrence();if(!s)return;const l=(0,_().Su)(s);if(!l)return;const d=n.getPropertyValue(a().b0.Dates);if(!d)return;const p=(0,k().nai)(d)[0];if(!p||"daterange"!==p.type)return;const u=p.start_date,{start_date:m,end_date:S}=(0,_().DW)({currentSprintStartDate:u,sprintSchedule:l});W().sW({store:e.getTriggerStore().getKeyStore("recurrence"),data:{start_date:(0,c().Jh)(o().ou.fromISO(m).plus({minutes:1}).toJSDate())},transaction:r}),D().xD({store:n,propertyId:a().b0.Dates,transaction:r,environment:i,type:"dateValue",dateValue:{type:"daterange",start_date:u,end_date:S}})}function H(t){const{transaction:e,newRemainingTasksBehavior:n,actionStore:o}=t;W().sW({store:o.getConfigStore(),data:{complete_sprint_action:n},transaction:e})}async function J(t){var e;const{appTemplatesSetupActions:n,appTemplatesSprintBoardActions:o,appConfigs:i}=await b().vF.load(),{environment:s,collectionContextStore:c,from:l}=t,{currentSpaceViewStore:d}=F().default.state,p=c.collectionStore(),u=null==p?void 0:p.getParentBlockStore(),m=null==u?void 0:u.getParentStore(),g=null==p||null===(e=p.getFormat())||void 0===e?void 0:e.app_config_uri,v=g&&(0,w().YB)(i(),g);if(!p||!u||!m||!d||m.table!==f().bx&&m.table!==S().iU&&m.table!==y().e0||!v)return;const _=u.getFormat().app_id,k=_?await O().callApi({eventName:"getCollectionViewBlocksByAppId",environment:s,data:{spaceId:u.getSpaceId(),appId:_}}):void 0,h="success"===(null==k?void 0:k.type)&&k.data.result.length?k.data.result.map((t=>B().G.createChildStore(m,{table:S().iU,id:t.blockId,spaceId:u.getSpaceId()}))):[u];await nt({environment:s,taskCollectionStore:p,executeFn:()=>{const t=U().createAndCommit({userAction:"sprintSettingsActions.handleTurnOnSprints",environment:s,canUndo:!0,perform:t=>{const e=(0,C().eu)(),r=n.applyTypedFeatures({environment:s,spaceViewStore:d,appParentStore:m,appUri:v.uri,features:[{type:"simple",featureUri:e.uri}],transaction:t,createOrModify:"modify",appCollectionViewBlockStores:h}),i=o.createSprintPage({environment:s,spaceViewStore:d,appParentStore:m,transaction:t,blockStores:r,creationEntryPoint:{type:"sprint_settings"}});if(R().E3({collectionSettingsStore:c.settingsStore}),!i)return;const p=l?{feature:{id:a().Es.TaskToSprintRelation,from:l,type:"notion://projects/tasks_with_sprints_feature"}}:{};return I()._H({environment:s,collectionContextStore:c,from:"view_settings",property:a().Es.TaskToSprintRelation,property_type:"relation",is_suggested_property:!0,...p}),i}});t.serverCommitResult.then((()=>{const e=t.performResult;e&&M().r({environment:s,store:e,pageVisitSource:r().tY.Create})}))}})}async function Q(t){const{environment:e,collectionContextStore:n,sprintSettingsContext:o,sprintBoardViewBlockIds:i}=t,{sprintCollectionStore:s,automationContext:c,currentCollectionViewBlockStore:l,sprintCollectionViewBlockStore:d,taskCollectionStore:p,taskCollectionViewBlockStore:u}=o;if(!s||!d||!c)return;const m=u.getSpaceId(),g=[d,...i.map((t=>new(B().G)(e,{id:t,table:S().iU,spaceId:m})))];l.id===u.id?R().E3({collectionSettingsStore:n.settingsStore}):M().r({environment:e,store:u,pageVisitSource:r().tY.LeaveOrRemove});const{automationActions:f}=await h().Sm.automations.load(),{automationStore:y}=c;await nt({environment:e,taskCollectionStore:p,executeFn:()=>{U().createAndCommit({userAction:"sprintSettingsActions.handleTurnOffSprints",environment:e,canUndo:!0,perform:t=>{!function(t){const{transaction:e,blocksToDelete:n,environment:o,taskCollectionStore:r,sprintCollectionStore:i}=t;W().sW({store:i,transaction:e,data:{alive:!1}}),P().E2({environment:o,collectionStore:r,schema:r.getSchema(),property:a().Es.TaskToSprintRelation,transaction:e,permanentlyDelete:!0}),N().y8({environment:o,blocks:n,transaction:e,permanentlyDelete:!0})}({environment:e,transaction:t,blocksToDelete:g,sprintCollectionStore:s,taskCollectionStore:p}),f.disableAutomation({automationStore:y,environment:e,transaction:t}),f.deleteAutomation({automationStore:y,environment:e,transaction:t})}}),I().y9({environment:e,collectionContextStore:n,property_type:"relation",from:"view_settings",property:a().Es.TaskToSprintRelation})}})}function Z(t){const{environment:e,userSettingsStore:n}=t;U().createAndCommit({userAction:"sprintSettingsActions.handleSeenSprintsEngagementBanner",environment:e,canUndo:!0,perform:t=>{X().d2({userSettingsStore:n,data:{seen_sprint_settings_engagement_banner:!0},transaction:t})}})}function L(t){t.settingsStore.setState({open:!0,stack:[{type:"main"},{type:"sprintSettings"}]})}function tt(t){const{environment:e,collectionContextStore:n,currentViewBlockStore:o,taskCollectionViewBlockStore:r}=t,i=n.collectionViewStore();if(!i)return;const s=i.getFormat(),c=i.getRawQuery();U().createAndCommit({userAction:"sprintSettingsActions.handleManageSprintFromThisView",environment:e,canUndo:!0,perform:t=>{if(T().iG({collectionViewStore:i,transaction:t,update:{name:x().Z.formatMessage(C().sY.tasksCurrentSprintV2ViewName),query2:{...c,filter:void 0},format:{...s,collection_view_icon:"/icons/playback-play-button_gray.svg",property_filters:C().Jt,app_config_uri:a().g3,hide_linked_collection_name:!0}}}),o.id===r.id){var e;const n=(null===(e=o.getFormat())||void 0===e?void 0:e.app_uri_map)??{},c=s.app_config_uri;c&&delete n[c],E().FH({stores:[r],update:{app_uri_map:{...n,[a().g3]:i.id}},transaction:t})}}})}function et(t){const{environment:e,sprintSettingsContext:n}=t;if(!n)return;const o=n.sprintCollectionStore,r=(null==o?void 0:o.getRole())??"none";o&&(0,p().yY)(r,"editor")&&n.automationContextLoaded&&!n.automationContext&&U().createAndCommit({userAction:"sprintSettingsActions.ensureCompleteSprintAutomation",environment:e,canUndo:!0,perform:t=>{K({environment:e,transaction:t,sprintCollectionStore:o,taskCollectionStore:n.taskCollectionStore,sprintSettingsConfig:v().iZ})}})}async function nt(t){const{executeFn:e,environment:n,taskCollectionStore:o}=t;await async function(t){var e;const{environment:n,taskCollectionStore:o}=t,r=o.getFormat().app_uri_map,i=a().Es.TaskToSprintRelation,c=o.getSchema(),l=(null==r?void 0:r[i])??i,d=c[l];if(!d||!(0,s().p_)(d))return;const p=null===(e=(0,s().j0)(d))||void 0===e?void 0:e.id;if(!p)return;const u=new Set([l]);Object.entries(c).forEach((t=>{var e;let[n,o]=t;o&&(0,s().p_)(o)&&(null===(e=(0,s().j0)(o))||void 0===e?void 0:e.id)===p&&u.add(n)}));const{serverCommitResult:m}=U().createAndCommit({userAction:"sprintSettingsActions.clearSprintRelationDataFromTaskCollection",environment:n,canUndo:!0,perform:t=>{for(const e of u)P().E2({environment:n,transaction:t,permanentlyDelete:!0,collectionStore:o,schema:c,property:e});null==r||delete r[i],r&&E().FH({stores:[o],transaction:t,update:{app_uri_map:r}})}});await m}({environment:n,taskCollectionStore:o}),e()}function ot(t){return{frequency:q,interval:t.recurrenceConfig.interval,weekdays:t.recurrenceConfig.weekdays,start_date:(0,c().Jh)(o().ou.local().set({hour:0,minute:0,second:0,millisecond:0}).toJSDate()),timezone:(0,l().Sv)(),hour:0,minute:0}}},23151:(t,e,n)=>{n.d(e,{Fv:()=>A,JN:()=>h,QG:()=>F,cQ:()=>V,f$:()=>D,fX:()=>b,td:()=>T,xD:()=>x});n(670560),n(267602),n(30005),n(241792);var o=()=>n(730120),r=()=>n(552221),a=()=>n(532850),i=()=>n(803021),s=()=>n(874459),c=()=>n(998411),l=()=>n(752778),d=()=>n(513670),p=()=>n(696459),u=()=>n(250303),m=()=>n(384667),S=()=>n(366257),g=()=>n(332542),f=()=>n(636340),y=()=>n(970105),v=()=>n(887430),_=()=>n(32969),k=()=>n(35982),C=()=>n(826955),w=()=>n(526243);function h(t){const{environment:e,droppedStores:n,duplicate:a,calendarBy:d,transaction:p,collectionContextStore:S}=t,f=o().ou.fromMillis(t.startOfDay);let y=!0;for(const o of n){const e=t.collectionStore?t.collectionStore:(0,v().Bm)({store:o,collectionContextStore:S});if(o.getParentTable()===l().vF||!e){y=!1;break}g().zw({childStore:o,parentStore:e,transaction:p})||(y=!1)}const _=m().Ab({environment:e,droppedStores:n,duplicate:a,transaction:p,collectionStore:t.collectionStore});for(const o of _){const n=t.collectionStore?t.collectionStore:(0,v().Bm)({store:o,collectionContextStore:S});if(!n)continue;const a=n.getMappedProperty(d),l=o.getPropertyStore(a),g=(0,r().G)(l.getValue())||s().Lg((0,c().r)()),_=s().c$(g,(0,c().r)()),k=f.toFormat(s().Iq);let C;if("date"===_.type||"datetime"===_.type)C={..._,start_date:k};else{const t=s().NK(_,(0,c().r)());if(!t.end)return;const e={..._,start_date:k},n=s().NK(e,(0,c().r)()).start.diff(t.start,"days"),o=t.end.plus(n).toFormat(s().Iq);C={..._,start_date:k,end_date:o}}const w=s().c$(C,i().yw(g)||(0,c().r)());m().mp({environment:e,store:o,collectionStore:n,collectionContextStore:S,shouldCoerce:!0,groupsPointer:[],transaction:p,alreadyMovedToCollection:y}),x({environment:e,type:"dateValue",propertyId:a,store:o,transaction:p,dateValue:w}),u().rv({environment:e,collectionContextStore:S,block_id:o.id,property:a,property_type:"date",from:"calendar"})}}function D(t){const{calendarStore:e,direction:n,targetStore:o}=t;e.setState({...e.state,isDragging:!0,targetStore:o,direction:n,temporaryValue:void 0})}function T(t){const{calendarStore:e,x:n,y:a,calendarBy:l}=t,p=e.state;if(p.isDragging){const t=(0,r().G)(p.targetStore.getPropertyStore(l).getValue());if(!t)return;const u=s().c$(t,(0,c().r)()),m=p.temporaryValue||t,S=s().c$(m,(0,c().r)()),g=[];p.dayStoreMap.forEach(((t,e)=>{g.push({store:t,timestamp:e})}));const f=g.find((t=>{let{store:e}=t;const o=_().C.getRectFromStore(e);return Boolean(o&&k().uh(o,n,a))}));let y;if(f){const t=o().ou.fromMillis(f.timestamp),e=t.endOf("day"),n=t.toFormat(s().Iq);if(u){const r=s().NK(u,(0,c().r)());if(p.direction===w().to.Left)if(o().Xp.fromDateTimes(t,e).contains(r.start))y=u;else{let t;t="datetimerange"===u.type||"daterange"===u.type?{...u,start_date:n,end_date:u.end_date}:"datetime"===u.type?{type:"datetimerange",start_date:n,start_time:u.start_time,end_date:u.start_date,end_time:u.start_time,time_zone:u.time_zone,reminder:u.reminder}:{type:"daterange",start_date:n,end_date:u.start_date,reminder:u.reminder};const e=s().NK(t,(0,c().r)());y=!r.end&&e.start>r.start||r.end&&e.start>r.end?S:t}else if(r.end?o().Xp.fromDateTimes(t,e).contains(r.end):o().Xp.fromDateTimes(t,e).contains(r.start))y=u;else{let t;t="date"===u.type?{...u,type:"daterange",end_date:n}:"datetime"===u.type?{...u,type:"datetimerange",end_date:n,end_time:"00:00"}:{...u,end_date:n};const e=s().NK(t,(0,c().r)());y=e.end&&e.end<e.start?S:t}}}if(y&&!d().Xy(S,y)){const t=s().c$(y,i().yw(m)||(0,c().r)());e.setState({...p,temporaryValue:t})}}}function b(t){const{environment:e,calendarStore:n,calendarBy:o,transaction:r}=t,a=n.state;a.isDragging&&a.temporaryValue&&(x({type:"dateValue",environment:e,dateValue:a.temporaryValue,propertyId:o,store:a.targetStore,transaction:r}),n.setState({...n.state,isDragging:!1}))}function V(t){const{calendarStore:e}=t,n=e.state;n.isDragging&&e.setState({...n,isDragging:!1})}function A(t){const{environment:e,store:n,collectionStore:r,collectionContextStore:i,startDayOfWeek:l,transaction:d}=t,p=i.dateRangeStartStore.state,u=(0,c().r)(),S=i.normalizedQueryStore.state;if(!S||!S.calendar_by)return;const g=(null==r?void 0:r.getMappedProperty(S.calendar_by))??S.calendar_by,y=s().gQ(p,l,u),v=y.startOf("month"),_=y.endOf("month"),k=o().ou.now().startOf("day");let C;return C=o().Xp.fromDateTimes(v,_).contains(k)?s().hT(k.valueOf(),u):s().hT(s().em(p,l,u).valueOf(),u),f().sW({store:n.getPropertiesStore(),data:{[g]:a().d7(C)},transaction:d}),m().mp({environment:e,store:n,collectionStore:r,collectionContextStore:i,shouldCoerce:!0,groupsPointer:[],transaction:d}),n}function x(t){const{environment:e,store:n,propertyId:o,transaction:r}=t;let i;"timestamp"===t.type?i=s().hT(t.timestampMs.valueOf(),(0,c().r)()):"dateValue"===t.type?i=t.dateValue:(0,p().t1)(t);const l=n.getPropertyValue(o),d=a().d7(i);f().sW({store:n.getPropertiesStore(),data:{[o]:d},transaction:r}),S().H({environment:e,store:n,dateProperty:{id:o,oldValue:l,newValue:d}})}function F(t){const{environment:e,collectionStore:n,calendarBy:o,store:r,insertStores:a,collectionContextStore:i,transaction:s}=t,c=r.getPropertyStore(o).getValue();for(const l of a)m().mp({environment:e,store:l,collectionStore:n,collectionContextStore:i,shouldCoerce:!0,groupsPointer:[],transaction:s}),y().sO({environment:e,store:l.getPropertyStore(o),value:c,transaction:s});return a.map((t=>C().G.createChildStore(n,t.pointer)))}},856466:(t,e,n)=>{n.d(e,{$X:()=>i,F_:()=>s,iZ:()=>a});n(267602),n(470928);var o=()=>n(926724),r=()=>n(295617);const a={autoCompleteSprints:!1,actionConfig:{complete_sprint_action:"complete_sprint_and_move_incomplete_tasks_to_next_sprint"},recurrenceConfig:{interval:2,weekdays:["MO"]}};function i(t){const{eventTracker:e,properties:n}=t;e.DO_NOT_USE_commonTrackEvent({eventName:"complete_sprint_action",properties:n})}function s(t,e){var n;return null===(n=e.groups)||void 0===n||null===(n=n.find((e=>e.id===o().nl||(null==e?void 0:e.name)===r().RW||(null==e?void 0:e.name)===t.formatMessage(r().ct.statusGroupNameComplete))))||void 0===n?void 0:n.name}},126301:(t,e,n)=>{n.d(e,{DW:()=>s,IX:()=>i,Su:()=>r,rP:()=>a});var o=()=>n(730120);function r(t){if("week"===t.frequency&&t.weekdays&&1===t.weekdays.length)return{weekday:t.weekdays[0],duration:t.interval}}function a(t){const{currentSprintEndDate:e,sprintSchedule:n}=t;return c({startDate:d({dateToAdjust:o().ou.fromISO(e),weekday:n.weekday,wrapForEqualDays:!0}),duration:n.duration})}function i(t){const{userTimeZone:e,sprintSchedule:n}=t;return c({startDate:o().ou.local({zone:e}),duration:n.duration})}function s(t){const{currentSprintStartDate:e,sprintSchedule:n}=t,r=d({dateToAdjust:o().ou.fromISO(e),weekday:n.weekday,wrapForEqualDays:!1}),{end_date:a}=c({startDate:r,duration:n.duration});let i=o().ou.fromISO(a);const s=o().ou.now().startOf("day");for(;i.diff(s,"days").days<0;)i=i.plus({weeks:1});return{type:"daterange",start_date:i.plus({days:1}).minus({weeks:n.duration}).toISODate(),end_date:i.toISODate()}}function c(t){const{startDate:e,duration:n}=t,o=e.plus({weeks:n}).minus({days:1});return{type:"daterange",start_date:e.toISODate(),end_date:o.toISODate()}}const l={SU:0,MO:1,TU:2,WE:3,TH:4,FR:5,SA:6};function d(t){const{dateToAdjust:e,weekday:n,wrapForEqualDays:o}=t,r=p({currentWeekday:e.weekday%7,nextWeekday:l[n],wrapForEqualDays:o});return e.plus({days:r})}function p(t){const{currentWeekday:e,nextWeekday:n,wrapForEqualDays:o}=t,r="number"==typeof e?e:l[e],a="number"==typeof n?n:l[n];if(r===a)return o?7:0;let i=r,s=0;for(;i!==a;)i===l.SA?i=0:i+=1,s+=1;return s}}}]);