"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[52194],{616728:(e,t,n)=>{n.r(t),n.d(t,{AuthSyncListener:()=>U});var s=n(667294),o=()=>n(219727),a=()=>n(142735);const r="initial_handshake";var i=()=>n(989478),u=()=>n(788860),c=()=>n(513670),l=()=>n(839002),d=()=>n(342792),m=()=>n(205228),f=()=>n(826955),g=()=>n(704259),v=()=>n(385875),p=n(785893);const y=1;function U(){const e=(0,o().O7)(),t=(0,u().YB)(),n=`${m().default.identity.domainBaseUrl}/authSync`,U=e.currentUser.isLoggedIn(),[w,h]=(0,s.useState)(null),[E,I]=(0,s.useState)({value:!1,count:0}),C=(0,a().VK)((()=>g().default.getTotalUnreadMentionsCount()),[]),S=(0,a().VK)((()=>v().Z.getAllSpaceViewStores(e)),[e]);(0,s.useEffect)((()=>{const e=t=>{const n=m().default.identity.domainBaseUrl;t.origin===n&&t.ports&&t.ports[0]&&(h(t.ports[0]),window.removeEventListener("message",e))};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}}),[]),(0,s.useEffect)((()=>{U&&(E.value||0===E.count||null==w||w.postMessage({version:y,name:"unreadCount",source:"notion",unreadCount:C}))}),[U,E.count,E.value,w,C]);const b=(0,s.useCallback)((async()=>{const e=c().mN(S,"userId"),n=await(0,l().qd)(e,10,(async e=>{if(!e.userId)return;const n=f().U6.createChildStore(e,{table:i().KJ,id:e.userId});await n.load();const s=n.getEmail(),o=n.getDisplayName(t);return{id:e.userId,displayName:o,emailAddress:s}}));null==w||w.postMessage({version:y,name:"accountSwitcher",source:"notion",accounts:n})}),[t,w,S]);(0,s.useEffect)((()=>{U&&(E.value||0===E.count)&&b()}),[U,b,E.count,E.value]),(0,s.useEffect)((()=>{e.currentUser.id&&(0,d().e)(e.currentUser.id)&&(null==w||w.postMessage({version:y,name:"setNotionUserID",source:"notion",notionUserID:e.currentUser.id,type:"mutation"}))}),[e.currentUser.id,w]),(0,s.useEffect)((()=>{U||null==w||w.postMessage({version:y,name:"setNotionUserID",source:"notion",notionUserID:"",type:"mutation"})}),[U,w]);const k=(0,s.useCallback)((e=>{if(e.data.version!==y)return;const{source:t}=e.data;if("notion"!==t&&"mailLoaded"===e.data.name)I((e=>({value:!0,count:e.count+1})))}),[]);return(0,s.useEffect)((()=>(h((e=>(e&&(e.onmessage=k),e))),()=>{h((e=>(e&&(e.onmessage=null),e)))})),[k,w]),(0,p.jsx)("iframe",{src:n,style:{display:"none"},onLoad:e=>function(e){const t=e.currentTarget;setTimeout((()=>{var e;null===(e=t.contentWindow)||void 0===e||e.postMessage(r,m().default.identity.domainBaseUrl)}),50)}(e),title:"Notion Identity"})}}}]);