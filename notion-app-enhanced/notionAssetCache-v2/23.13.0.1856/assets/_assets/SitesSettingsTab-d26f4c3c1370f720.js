"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[79582],{266184:(e,t,i)=>{i.d(t,{Sl:()=>j,TA:()=>v,Zg:()=>y,a2:()=>w,eT:()=>C,mk:()=>S});i(821057),i(670560),i(267602),i(653476),i(667294);var s=()=>i(217465),n=()=>i(396136),o=()=>i(788860),a=()=>i(839002),r=()=>i(824462),l=()=>i(308186),d=()=>i(828946),c=()=>i(365872),u=()=>i(681832),h=()=>i(804217),p=()=>i(826955),m=()=>i(625820),g=()=>i(59864),b=()=>i(835374),f=i(785893);const x=50;function y(e){b().default.resetSitesForSpace(e.id)}async function S(e,t){const{spaceStore:i,currentUserId:o,limit:l}=t;if(!i.id)return;const[d]=await Promise.all([r().callApi({eventName:"getPublishedPagesForUser",environment:e,data:{spaceId:i.id,limit:l||x,fetchPublishedMetadata:!0}}),(0,a().Vs)(1500)]);if("failed"===d.type)throw new Error("Failed to fetch published pages.");if(d.data.recordMap){const e=[],t=s().RecordMapWithRole.create(d.data.recordMap),a=d.data.publishedEdits;for(const{model:s}of t)if(s&&s.table===n().iU){const t=p().G.createChildStore(i,{table:n().iU,id:s.id}),o=a[t.id],r=o&&o.authors?o.authors[0]:void 0,l={publishedTime:null==o?void 0:o.timestamp,publishedBy:r};e.push({store:t,publishedMetadata:l})}let r=e;return o&&(r=g().S(e,o)),b().default.initializeSiteResultsForSpace(i.id,r),r}}async function j(e,t){const{spaceStore:i}=t,s=e.currentUser.id,n=await S(e,{spaceStore:i,currentUserId:s});return n?n.filter((e=>{var t;return(null===(t=e.publishedMetadata.publishedBy)||void 0===t?void 0:t.id)===s})):[]}function v(e){c().lG(e),u().default.setState({...u().default.state,display:u().wV.Publish,tab:u().XF.Publish})}async function C(e){return new Promise(((t,i)=>{l().vC({message:(0,f.jsx)("div",{style:{textAlign:"center"},children:(0,f.jsx)(o()._H,{id:"sites.confirmUnpublish.title",defaultMessage:"Unpublish this site?"})}),description:(0,f.jsx)("div",{style:{textAlign:"center"},children:(0,f.jsx)(o()._H,{id:"sites.confirmUnpublish.caption",defaultMessage:"{pageTitle} will no longer be live on the web.",values:{pageTitle:e}})}),keepFocus:!0,items:[{label:(0,f.jsx)(o()._H,{id:"sites.confirmUnpublish.confirm",defaultMessage:"Unpublish"}),color:"red",onAccept:()=>t(!0)}],showCancel:!0})}))}async function w(e,t){if(!h().default.state.online)return[];const i=await d().x.searchActions.load();return await i.searchPublicPages({environment:t,query:e,source:"public_home_page_menu",limit:m().Xv})}},666e3:(e,t,i)=>{i.d(t,{Z:()=>l});i(667294);var s=()=>i(142735),n=()=>i(846550),o=()=>i(707513),a=()=>i(663132),r=i(785893);function l(e){const{spaceStore:t,domainId:i,isRelative:l}=e,d=(0,s().VK)((()=>a().Co({spaceStore:t,domainId:i})),[t,i]),c=(0,n().yK)((e=>({tag:{width:"fit-content",maxWidth:"98%",paddingLeft:6,paddingRight:6,borderRadius:3,background:e.buttonHoveredBackground,...o().Yu},relativeUrl:{color:e.text.tertiary}})),[]);return(0,r.jsxs)("div",{style:c.tag,children:[d,l&&(0,r.jsx)("span",{style:c.relativeUrl,children:"/..."})]})}},113989:(e,t,i)=>{i.r(t),i.d(t,{SitesSettingsTab:()=>ye});var s=i(667294),n=()=>i(846550),o=()=>i(788860),a=()=>i(707513),r=()=>i(666414),l=()=>i(360964),d=()=>i(504117),c=()=>i(868614),u=()=>i(677559);const h=new(u().Ss)("SitesDomainsSection",(async()=>await Promise.all([i.e(70206),i.e(75882),i.e(52576),i.e(40226)]).then(i.bind(i,119317)))),p=(0,u().kF)(h,(e=>e.DomainsSection));var m=()=>i(148126),g=(i(670560),i(241792),()=>i(730120)),b=()=>i(219727),f=()=>i(142735),x=()=>i(646574),y=()=>i(154186),S=()=>i(668001),j=()=>i(654133),v=()=>i(67961),C=()=>i(239444),w=()=>i(378907),k=()=>i(623596),M=()=>i(653457),I=()=>i(772084),A=()=>i(998901),Z=()=>i(826955),B=()=>i(266184),_=()=>i(663132),P=()=>i(835374),U=()=>i(666e3),H=()=>i(865479),F=()=>i(448419),T=()=>i(1910),V=()=>i(921981),D=()=>i(913813),K=()=>i(314160),R=()=>i(836756),L=()=>i(506347),O=()=>i(155055),W=()=>i(959137),Y=()=>i(827973),$=()=>i(198829),N=()=>i(255577),z=()=>i(388284),E=()=>i(352230),X=()=>i(166104),G=()=>i(998470),J=()=>i(479875),q=i(785893);function Q(e){const{store:t,parent:i,isSettingsDisabled:s,onSettingsClick:o}=e,a=(0,b().O7)(),r=(0,n().yK)((()=>({actionIcon:{width:14,height:14}})),[]),l=[{key:"view",render:e=>(0,q.jsx)(ee,{...e,iconStyle:r.actionIcon}),action:()=>{G().wt({environment:a,store:t,pageVisitSource:L().tY.SiteSettings}),O().gV(a,{action:"view_site"}),i.close()}},{key:"copy",render:e=>(0,q.jsx)(te,{...e,iconStyle:r.actionIcon}),action:()=>{!async function(e,t){const{url:i}=J().$({store:t,pageVisitSource:L().tY.SiteSettings}),s=await W().F.clipboardActions.load();s.copyString({environment:e,stringValue:i,copiedMessage:s.clipboardMessages.copiedLinkToClipboard})}(a,t),O().gV(a,{action:"copy_site_link"}),i.close()}}],d={key:"settings",render:e=>(0,q.jsx)(ie,{...e,iconStyle:r.actionIcon,disabled:s}),action:()=>{o(t.id),O().gV(a,{action:"configure_site"}),i.close()}};return(0,q.jsx)($().Z,{menuType:E().o.Popup,width:160,children:(0,q.jsx)(N().Z,{initialFocus:void 0,type:N().i.Vertical,sections:[{key:"link",render:e=>(0,q.jsx)(z().Z,{...e}),items:l},{key:"settings",render:e=>(0,q.jsx)(z().Z,{...e,topBorder:!0}),items:[d]}]})})}const ee=s.forwardRef(((e,t)=>{const{iconStyle:s}=e;return(0,q.jsx)(Y().Z,{...e,ref:t,icon:(0,i(975899).o)(s),title:(0,q.jsx)(o()._H,{id:"sites.siteActions.viewSite",defaultMessage:"View site"})})}));ee.displayName="ViewAction";const te=s.forwardRef(((e,t)=>{const{iconStyle:s}=e;return(0,q.jsx)(Y().Z,{...e,ref:t,icon:(0,i(802600).a)(s),title:(0,q.jsx)(o()._H,{id:"sites.siteActions.copySiteLink",defaultMessage:"Copy site link"})})}));te.displayName="CopyAction";const ie=s.forwardRef(((e,t)=>{const{iconStyle:s,disabled:n}=e;return n?(0,q.jsx)(j().Z,{renderTooltip:()=>(0,q.jsx)(o()._H,{id:"sites.siteActions.noEditAccess",defaultMessage:"You do not have access to update the settings for this published site."}),placement:A().Placement.Bottom,render:n=>(0,q.jsx)(Y().Z,{...(0,i(164079).Z)(n,e),ref:t,icon:(0,X().H)(s),title:(0,q.jsx)(o()._H,{id:"sites.siteActions.settings",defaultMessage:"Settings"})})}):(0,q.jsx)(Y().Z,{...e,ref:t,icon:(0,X().H)(s),title:(0,q.jsx)(o()._H,{id:"sites.siteActions.settings",defaultMessage:"Settings"})})}));ie.displayName="SettingsAction";var se=()=>i(396136),ne=()=>i(620768),oe=()=>i(880556),ae=()=>i(279674),re=()=>i(333023),le=()=>i(834758);function de(e){let{spaceStore:t,blockId:i,onClose:s,onUnpublish:n}=e;const o=(0,b().O7)(),a=Z().G.createChildStore(t,{table:se().iU,id:i}),r=(0,f().VK)((()=>re().mk({store:a,environment:o}).mostPermissivePublicItem),[o,a]);return"none"===r.permissionItem.role?(s(),null):(0,q.jsx)(ce,{store:a,mostPermissivePublicItem:r,onClose:s,onUnpublish:n})}function ce(e){const{store:t,mostPermissivePublicItem:i,onClose:r,onUnpublish:l}=e,d=(0,f().VK)((()=>"seo"===R().Z.state.siteSettingContentType),[]),c=(0,s.useCallback)((()=>{G().pn("initial")}),[]),u=(0,n().yK)((()=>({container:{flex:1,paddingBottom:8},titleContainer:{display:"flex",alignItems:"center",gap:4,padding:20,fontSize:14,lineHeight:1.25,fontWeight:a().Ue.semibold,paddingLeft:d?8:20},publishIcon:{height:16,width:16}})),[d]);return(0,q.jsxs)("div",{style:u.container,children:[(0,q.jsxs)("div",{style:u.titleContainer,children:[d&&(0,q.jsx)(ue,{onClick:c}),(0,q.jsx)(v().Z,{children:(0,q.jsx)(o()._H,{defaultMessage:"Publish settings",id:"publishSiteSettings.settings.title"})}),(0,ae().v)(u.publishIcon),(0,q.jsx)(ne().U,{onClick:r})]}),(0,q.jsx)(le().D7,{store:t,mostPermissivePublicItem:i,sudoModeStore:void 0,location:"published_site_settings",showManageAllDomains:!1,showAllPublishedSites:!1,onUnpublish:l,shouldAskForConfirmationOnPublish:!0})]})}function ue(e){const{onClick:t}=e,i=(0,o().YB)(),s=(0,n().yK)((()=>({topContainer:{display:"flex",alignItems:"center",width:"max-content"},backButtonPressedStyle:{backgroundColor:"transparent"},iconButton:{marginRight:6,height:24,width:24},arrowIcon:{height:16,width:16,strokeWidth:a().Ue.semibold}})),[]);return(0,q.jsx)("div",{style:s.topContainer,children:(0,q.jsx)(T().Z,{icon:oe().W,iconStyle:s.arrowIcon,style:s.iconButton,onClick:t,ariaLabel:i.formatMessage({id:"publishSiteSettings.settings.backbutton.ariaLabel",defaultMessage:"Go back to publish settings."})})})}function he(e){const{spaceStore:t,store:i,isSettingsDisabled:o}=e,a=(0,b().O7)(),[r,l]=(0,s.useState)(void 0),d=(0,s.useCallback)((e=>{l(e)}),[l]),c=(0,s.useCallback)((()=>{l(void 0),R().Z.reset()}),[l]),u=(0,n().yK)((()=>({settingButtonIcon:{width:18,height:18}})),[]);return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(F().ZP,{alignmentToOrigin:A().Alignment.End,renderOrigin:e=>(0,q.jsx)(T().Z,{...e,ariaLabel:"Site settings",icon:D().O,iconStyle:u.settingButtonIcon}),popupType:F().Z4.Popup,render:e=>(0,q.jsx)(Q,{store:i,parent:e,isSettingsDisabled:o,onSettingsClick:d})}),(0,q.jsx)(V().c,{isOpen:Boolean(r),onDismiss:c,areaConstraint:{width:{type:"fixed",length:480}},render:()=>r?(0,q.jsx)(de,{spaceStore:t,blockId:r,onClose:c,onUnpublish:()=>{P().default.removeSiteFromSpace(t.id,r),(0,K().O$)(a,{target_block_id:i.id})}}):null})]})}const pe=5e3;function me(){const e=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"3px 5px":0;return[{key:"page",header:(0,q.jsx)(o()._H,{id:"sites.header.pageColumnHeader",defaultMessage:"Page"}),style:{width:"32%",padding:e}},{key:"domain",header:(0,q.jsx)(o()._H,{id:"sites.header.domainColumnHeader",defaultMessage:"Domain"}),style:{width:"28%"}},{key:"published-by",header:(0,q.jsx)(o()._H,{id:"sites.home.publishedByColumnHeader",defaultMessage:"Published by"}),style:{width:"20%",padding:e}},{key:"published-date",header:(0,q.jsx)(o()._H,{id:"sites.home.publishedDateColumnHeader",defaultMessage:"Published date"}),style:{width:"16%",padding:e}},{key:"edit",header:(0,q.jsx)(q.Fragment,{}),style:{width:"4%"}}]}function ge(e){let{column:t,onSortableColumnClick:i,header:s}=e;const o=(0,n().yK)((e=>({wrapper:{display:"flex"},text:{fontSize:a().JB.UISmall.desktop,fontWeight:a().Ue.regular,color:e.mediumTextColor},sortButton:{display:"flex",alignItems:"center",padding:"3px 5px",overflow:"hidden",maxWidth:"100%",borderRadius:4},sortIcon:{fill:e.mediumTextColor,width:12,height:12,marginLeft:4}})),[]),{sortColumn:r,sortAscending:l}=(0,f().VK)((()=>{const{sortColumn:e,sortAscending:t}=P().default.state;return{sortColumn:e,sortAscending:t}}),[]),d=["page","published-or-created-by","published-date"].includes(t),c=()=>{if(t===r)return(0,k().K)({...o.sortIcon,...!l&&{transform:"rotate(180deg)"}})};return s&&d?(0,q.jsx)("div",{style:o.wrapper,children:(0,q.jsxs)(y().Z,{style:o.sortButton,onClick:()=>i(t),children:[s,c()]})}):s?(0,q.jsx)("div",{style:o.wrapper,children:s}):(0,q.jsx)(q.Fragment,{children:s})}function be(e){const{spaceStore:t}=e,i=(0,b().O7)(),a=i.currentUser.id,r=(0,o().YB)();(0,s.useEffect)((()=>(B().mk(i,{spaceStore:t,currentUserId:a,limit:pe}),()=>{B().Zg(t)})),[i,t,a]);const l=(0,n().yK)((e=>({headerContainer:{display:"flex",alignItems:"center",gap:4,marginBottom:12},helpIcon:{height:14,width:15,color:e.icon.tertiary},tableBox:{tableLayout:"fixed"},cell:{paddingRight:12,height:44},shimmerBox:{height:12,gap:16,display:"flex",borderRadius:6}})),[]),d=(0,f().VK)((()=>{const e=P().default.getSortedSitesForSpace(t.id,r);if(!e)return;const i=[];for(const s of e){const{store:e,publishedMetadata:n}=s,o=e.id,a=e.canAdmin(),l=I().UM(e),d=_().Nc(e.getSpaceStore(),l),c=n.publishedTime?(0,x().ZW)({value:g().ou.fromMillis(n.publishedTime),preset:"medium"}):"",u=n.publishedBy,h=u?Z().t1.createChildStore(e,u):void 0,p=null==h?void 0:h.getDisplayName(r),m=h instanceof Z().U6?(0,q.jsx)(C().Z,{userStore:h,avatarSize:20,style:{width:"fit-content",maxWidth:"98%"}},`${o}-published-by`):(0,q.jsx)(fe,{text:p},`${o}-published-by`);i.push({key:o,columns:[(0,q.jsx)(H().Z,{store:e},o),(0,q.jsx)(U().Z,{spaceStore:t,domainId:null==d?void 0:d.id,isRelative:!0},`${o}-domain`),m,(0,q.jsx)(fe,{text:c},`${o}-published-on`),(0,q.jsx)(he,{spaceStore:t,store:e,isSettingsDisabled:!a},`${o}-actions`)]})}return i}),[t,r]),u=(0,s.useMemo)((()=>Array.from({length:9}).map(((e,t)=>({columns:Array.from({length:5}).map(((e,t)=>(0,q.jsx)(S().Z,{style:l.shimmerBox},t))),key:`shimmerRow-${t}`})))),[l.shimmerBox]),h=!d,p=d&&0===d.length,m=(0,s.useCallback)((e=>{const{sortColumn:t,sortAscending:i}=P().default.state,s=e!==t||!i;P().default.setState({...P().default.state,sortAscending:s,sortColumn:e})}),[]);return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(c().Z,{style:l.headerContainer,children:[(0,q.jsx)(o()._H,{id:"sites.home.title",defaultMessage:"All published sites"}),(0,q.jsx)(j().Z,{renderTooltip:()=>(0,q.jsx)(o()._H,{id:"sites.home.tooltip",defaultMessage:"Notion pages that have been published as a site"}),render:e=>(0,q.jsx)("div",{...e,children:(0,M().m)(l.helpIcon)}),placement:A().Placement.Bottom,alignment:A().Alignment.Center})]}),h?(0,q.jsx)(w().Z,{columns:me(!0),rows:u,tableStyle:l.tableBox,cellStyle:l.cell}):(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(w().Z,{columns:me(!1).map((e=>({key:e.key,header:(0,q.jsx)(ge,{column:e.key,onSortableColumnClick:m,header:e.header}),style:e.style}))),rows:d,tableStyle:l.tableBox,cellStyle:l.cell}),p&&(0,q.jsx)(xe,{})]})]})}function fe(e){const{text:t}=e,i=(0,n().yK)((()=>({text:{width:"fit-content",maxWidth:"98%",...a().Yu}})),[]);return t?(0,q.jsx)("div",{style:i.text,children:t}):null}function xe(){const e=(0,n().yK)((e=>({message:{textAlign:"center",marginTop:12,marginBottom:12,color:e.text.tertiary}})),[]);return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(v().Z,{style:e.message,children:(0,q.jsx)(o()._H,{id:"sites.results.empty",defaultMessage:"You have no published sites in this workspace"})}),(0,q.jsx)(r().Z,{size:1})]})}function ye(e){const{spaceStore:t}=e,i=(0,n().yK)((()=>({headerContainer:{display:"flex"},titleContainer:{flex:1},learnMoreButton:{fontWeight:a().Ue.regular}})),[]);return(0,q.jsxs)(d().ZP,{children:[(0,q.jsx)(c().Z,{large:!0,divider:"full",children:(0,q.jsxs)("div",{style:i.headerContainer,children:[(0,q.jsx)("div",{style:i.titleContainer,children:(0,q.jsx)(o()._H,{id:"sites.heading.title",defaultMessage:"Sites"})}),(0,q.jsx)(l().Z,{buttonStyle:i.learnMoreButton,title:(0,q.jsx)(o()._H,{id:"sites.heading.learnMore",defaultMessage:"Learn more"}),href:(0,m().UY)("guides.autogeneratedDomains"),analyticsFrom:"sites_settings"})]})}),(0,q.jsx)(p,{spaceStore:t}),(0,q.jsx)(r().Z,{size:20,isHidden:!0}),(0,q.jsx)(be,{spaceStore:t})]})}},59864:(e,t,i)=>{i.d(t,{N:()=>r,S:()=>a});i(267602),i(470928);var s=()=>i(933868),n=()=>i(514737),o=()=>i(122479);function a(e,t){return e.sort(((e,i)=>{const s=e.store.canAdmin();if(s===i.store.canAdmin()){var n,o;const s=null===(n=e.publishedMetadata.publishedBy)||void 0===n?void 0:n.id,a=e.publishedMetadata.publishedTime,r=null===(o=i.publishedMetadata.publishedBy)||void 0===o?void 0:o.id,l=i.publishedMetadata.publishedTime;if(t){if(s===t&&r===t&&a&&l)return l-a;if(s===t)return-1;if(r===t)return 1}return a&&l?l-a:0}return s?-1:1}))}function r(e){const{environment:t,store:i}=e;if(!i.pathIsAccessibleAndAlive())return!1;const a=o().YO(i).find((e=>(0,s().$D)(e.permissionItem)&&"none"!==e.permissionItem.role));return!!a&&((!(0,s().$D)(a.permissionItem)||!(0,n().y)(a.permissionItem))&&!o().IJ(t,i))}},835374:(e,t,i)=>{i.d(t,{default:()=>o});i(267602),i(653476);var s=()=>i(513670);class n extends(()=>i(263184))().default{getInitialState(){return{sites:{},sortAscending:!0,sortColumn:void 0}}initializeSiteResultsForSpace(e,t){this.state.sites[e]=t,this.emit()}getSortedSitesForSpace(e,t){const{sortAscending:n,sortColumn:o}=this.state,a=this.state.sites[e];if(a)switch(o){case"page":return s().Xo(a,(e=>i(955620).QaF(e.store.getTitleValue()).toLowerCase()),n?"asc":"desc");case"published-by":return s().Xo(a,(e=>{const s=e.publishedMetadata.publishedBy,n=s?i(826955).t1.createChildStore(e.store,s):void 0;return null==n?void 0:n.getDisplayName(t).toLowerCase()}),n?"asc":"desc");case"published-date":return s().Xo(a,(e=>e.publishedMetadata.publishedTime),n?"asc":"desc");default:return a}}removeSiteFromSpace(e,t){const i=this.state.sites[e];i&&(this.state.sites[e]=i.filter((e=>e.store.id!==t)),this.emit())}resetSitesForSpace(e){this.state.sites[e]=void 0}}const o=new n}}]);