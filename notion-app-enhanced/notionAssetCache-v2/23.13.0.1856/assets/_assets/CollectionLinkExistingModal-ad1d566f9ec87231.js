"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[9587],{10053:(e,t,r)=>{r.r(t),r.d(t,{CollectionLinkExistingModal:()=>A});r(267602),r(653476),r(241792);var i=r(667294),n=()=>r(219727),s=()=>r(142735),o=()=>r(846550),a=()=>r(855855),l=()=>r(577223),c=()=>r(455947),d=()=>r(998411),u=()=>r(989478),h=()=>r(899133),p=()=>r(788860),g=()=>r(707513),m=()=>r(384667),S=()=>r(269299),f=()=>r(154186),v=()=>r(827973),I=()=>r(78078),y=()=>r(1910),b=()=>r(573357),C=()=>r(291198),x=()=>r(668001),R=()=>r(198829),k=()=>r(255577),L=()=>r(943620),w=()=>r(384241),T=()=>r(388284),M=()=>r(576808),_=()=>r(141735),P=()=>r(718959),j=()=>r(576868),B=()=>r(352230),W=()=>r(766463),E=()=>r(677559),O=()=>r(521777),q=()=>r(749826),V=r(785893);function A(e){let{collectionContextStore:t,groupFormat:r,onClose:l,onAddOrLink:g}=e;const m=(0,p().YB)(),S=(0,n().O7)(),f=(0,s().VK)((()=>t.collectionStore()),[t]),[v,I]=i.useState(""),y=(0,i.useMemo)((()=>r?[r]:[]),[r]),C=(0,s().VK)((()=>{const e=(0,j().ze)(t,!1);if(!e)return;const r=t.collectionStore();if(!r)return;const i=S.currentUser.id;return(0,c().q)({context:{schema:r.getSchema(),userId:i,userTimeZone:(0,d().r)(),userStartOfWeek:P().AK.state,relativeVariableResult:t.relativeVariableStore.state,currentPageInRelatedCollection:t.viewsModuleContextStore.currentPageInRelatedCollectionId(),intl:m,collectionFeatureGates:(0,a().Q)({experimentService:q().default,actor:i?{table:u().KJ,id:i}:void 0,spaceId:r.getSpaceId()})},propertyMapping:r.getPropertyMapping(),filter:e})}),[t,S.currentUser.id,m]),{results:x,isResultsLoading:k}=(0,W().s)({searchQuery:v,limit:50,disable:!1,source:"link_existing_menu",type:h().n8.BlocksInCollection,filters:{requireEditPermissions:!0,excludeTemplates:!0,navigableBlockContentOnly:!0,parentId:null==f?void 0:f.id}}),{value:L}=(0,E().XJ)(_().F.formulas),w=(0,s().VK)((()=>{const e=new Map,t=new Map;return x.filter((r=>{let{store:i}=r;const n=i.getModel();return!C||!n||!C({block:n,getRecordModel:i.getRecordModel,propertyMapping:null==f?void 0:f.getPropertyMapping(),resultCache:e,regExpCache:t,experimentService:q().default,formulasModule:L})})).slice(0,10)}),[f,C,x,L]),T=(0,o().yK)((()=>({menuContent:{maxHeight:180,width:400}})),[]);return(0,V.jsx)(b().Z,{capture:!0,allowMenuList:!0,allowEsc:!0,allowUndo:!0,allowTabUntab:!0,render:()=>(0,V.jsx)(R().Z,{menuType:B().o.Popup,header:(0,V.jsx)(N,{searchQuery:v,onSearchQueryChange:I}),footer:v&&(0,V.jsx)(Z,{searchQuery:v,collectionContextStore:t,groupsPointer:y,onClose:l,onAddOrLink:g}),children:(0,V.jsx)("div",{style:T.menuContent,children:k?(0,V.jsx)(D,{}):(0,V.jsx)(K,{searchResults:w,collectionContextStore:t,groupsPointer:y,onClose:l,onAddOrLink:g})})})})}function K(e){let{searchResults:t,collectionContextStore:r,groupsPointer:i,onClose:a,onAddOrLink:c}=e;const u=(0,n().O7)(),h=(0,p().YB)(),{collectionStore:g,icon:m}=(0,s().VK)((()=>{const e=r.collectionStore();return{collectionStore:e,icon:null==e?void 0:e.getIcon()}}),[r]),f=(0,o().yK)((e=>({sectionTitleWrapper:{display:"flex",alignItems:"center",gap:4},collectionTitleWrapper:{display:"flex",alignItems:"center",color:e.text.primary,gap:2}})),[]),v=(0,V.jsx)("div",{style:f.sectionTitleWrapper,children:(0,V.jsx)(p()._H,{id:"CollectionLinkExistingModal.resultsSection",defaultMessage:"Link a page from {relationName}",values:{relationName:(0,V.jsxs)("div",{style:f.collectionTitleWrapper,children:[(0,V.jsx)(L().Z,{icon:m,disabled:!0,isEmptyPage:!0,size:12}),g&&(0,V.jsx)(w().Z,{store:g})]})}})});return(0,V.jsx)(k().Z,{type:k().i.Vertical,initialFocus:0,sections:[{key:"results",showNoResultMessage:!0,items:t.map((e=>{let{store:t}=e;return function(e){let{blockStore:t,collectionContextStore:r,groupsPointer:i,onClose:n,onAddOrLink:s,environment:o,intl:a}=e;return{key:t.id,action:()=>{const e=r.collectionStore();if(!e)return;const n=t.getModel();n&&S().createAndCommit({userAction:"CollectionLinkExistingModal.onLinkExisting",environment:o,canUndo:!0,perform:c=>{const{update:u}=l().RA({block:n,schema:e.getSchema(),propertyMapping:e.getPropertyMapping(),userFilterContext:{userId:o.currentUser.id,userTimeZone:(0,d().r)(),userStartOfWeek:P().AK.state},filter:(0,j().ze)(r,!1),groupBy:r.getGroupByAndGroupFormats().groupBy,groupsPointer:i,relativeVariableResult:r.relativeVariableStore.state,currentPageInRelatedCollection:r.viewsModuleContextStore.currentPageInRelatedCollectionId(),getRecordModel:e.getRecordModel,intl:a,resultCache:new Map,regExpCache:new Map,experimentService:q().default});M().b({environment:o,store:t,properties:u,transaction:c}),s&&s(c,t,u)}}).performResult},render:e=>{let{ref:r,...i}=e;return(0,V.jsx)(U,{blockStore:t,...i})}}}({blockStore:t,collectionContextStore:r,groupsPointer:i,onClose:a,onAddOrLink:c,environment:u,intl:h})})),render:e=>(0,V.jsx)(T().Z,{title:v,children:e.children})}]})}function U(e){let{blockStore:t,...r}=e;const{focused:i,onClick:n}=r,a=(0,p().YB)(),l=(0,s().VK)((()=>t.getIcon()),[t]),c=(0,o().yK)((e=>({item:{height:32},itemRight:{marginRight:4},pageTitleWrapper:{display:"flex",alignItems:"center"},icon:{marginRight:4},title:{...g().Yu,maxWidth:"100%",fontWeight:500},iconButton:{right:6,background:e.popoverBackground,boxShadow:e.lightBoxShadow,padding:2},iconButtonHover:{borderRadius:4}})),[]);return(0,V.jsx)(v().Z,{...r,textWrapperStyle:{marginLeft:6},title:(0,V.jsxs)("div",{style:c.pageTitleWrapper,children:[(0,V.jsx)(L().Z,{icon:l,style:c.icon,disabled:!0,isEmptyPage:!0,size:20}),(0,V.jsx)(w().Z,{underline:!0,enableHover:!0,store:t,style:c.title})]}),right:i?(0,V.jsx)(y().Z,{hasBackground:!1,ariaLabel:a.formatMessage({id:"CollectionLinkExistingModal.linkButton.ariaLabel",defaultMessage:"Link page"}),icon:O().R,onClick:n,hoveredStyle:c.iconButtonHover,style:c.iconButton}):void 0,style:c.item,rightStyle:c.itemRight})}function N(e){let{searchQuery:t,onSearchQueryChange:r}=e;const{device:i}=(0,n().O7)(),s=(0,p().YB)(),a=(0,o().yK)((e=>({headerWrap:{display:"flex",width:"100%",position:"relative",padding:"6px 10px",fontSize:i.isMobile?g().JB.UIRegular.mobile:g().JB.UIRegular.desktop,boxShadow:`\n\t\t\t\t\t0 1px 0 ${e.darkDividerColor}\n\t\t\t\t`},input:{flexGrow:1}})),[i]);return(0,V.jsx)("div",{style:a.headerWrap,children:(0,V.jsx)(C().Z,{style:a.input,value:t,placeholder:s.formatMessage({id:"CollectionLinkExistingModal.searchPlaceholder",defaultMessage:"Link a pageâ€¦"}),forceShowClearButton:Boolean(t),focus:!0,onChange:e=>r(e.target.value),onClearButtonClick:()=>{r("")},format:C().B.Transparent})})}function Z(e){let{searchQuery:t,collectionContextStore:r,groupsPointer:s,onClose:a,onAddOrLink:l}=e;const c=(0,n().O7)(),d=(0,o().yK)((e=>({button:{display:"flex",alignItems:"center",gap:6,width:"100%",paddingInline:12,paddingBlock:8,fontSize:c.device.isMobile?g().JB.UIRegular.mobile:g().JB.UIRegular.desktop,boxShadow:`\n\t\t\t\t\t0 -1px 0 ${e.darkDividerColor}\n\t\t\t\t`,color:e.text.secondary},pageTitle:{color:e.text.primary}})),[c.device]),u=(0,i.useCallback)((()=>{S().createAndCommit({userAction:"CollectionLinkExistingModal.onLinkExisting",environment:c,canUndo:!0,perform:e=>{const{newStore:i}=m().IW({environment:c,collectionContextStore:r,groupsPointer:s,shouldCoerce:!0,from:{createBlock:"relation_link_existing"},transaction:e,inMemoryRecordCache:c.defaultRecordCache.inMemoryRecordCache,title:t});l&&l(e,i)}}).performResult,a()}),[r,c,s,l,a,t]);return(0,V.jsxs)(f().Z,{style:d.button,onClick:u,children:[(0,O().R)({width:14}),(0,V.jsx)("div",{children:(0,V.jsx)(p()._H,{id:"CollectionLinkExistingModal.addPageButton",defaultMessage:"Create {pageTitle}",values:{pageTitle:(0,V.jsx)("span",{style:d.pageTitle,children:t})}})})]})}const D=(0,i.memo)((function(){const e=(0,o().yK)((e=>({wrapper:{display:"flex",flexDirection:"column",gap:8,paddingBottom:12},resultsWrapper:{marginRight:8,marginLeft:12},icon:{height:16,width:16,borderRadius:4},pageName:{height:15,borderRadius:4,marginLeft:-1},sectionName:{height:12,borderRadius:4,width:"20%",marginTop:15,marginLeft:13,marginBottom:6}})),[]);return(0,V.jsxs)("div",{style:e.wrapper,children:[(0,V.jsx)(x().Z,{style:e.sectionName}),(0,V.jsx)("div",{style:e.resultsWrapper,children:(0,V.jsx)(I().sg,{gap:12,children:Array.from({length:3},((t,i)=>(0,V.jsx)("div",{children:(0,V.jsxs)(I().X2,{gap:8,alignItems:"center",children:[(0,V.jsx)(x().Z,{style:e.icon}),(0,V.jsx)(x().Z,{style:{...e.pageName,width:r(513670).UP(["30%","40%","43%","45%","48%","50%","54%","55%","60%"])}})]})},`relation-result-shimmer-${i}`)))})})]})}))},12530:(e,t,r)=>{r.d(t,{N:()=>s,Z:()=>a});r(667294);var i=r(785893);const n={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:16,height:16,fontSize:10,textAlign:"center",fontWeight:r(707513).Ue.semibold,borderRadius:4,color:r(568017).ZP.white,position:"static",marginLeft:6,WebkitFontSmoothing:"auto"};let s=function(e){return e[e.Red=0]="Red",e[e.Gray=1]="Gray",e}({});function o(e){return!!e&&e>0}const a=function(e){let{count:t,color:a,style:c,numberStyle:d,fadeIn:u}=e;const h=a===s.Red,p=(0,r(846550).yK)((e=>({badge:{...n,...c,...(t??0)>99&&{width:void 0,padding:2},background:h?e.redBadgeBackground:e.lightIconColor,...u&&{transition:"opacity 0.1s",opacity:o(t)?1:0}}})),[t,u,h,c]);return u||o(t)?(0,i.jsx)("div",{style:p.badge,children:(0,i.jsx)(l,{count:t,numberStyle:d})}):null};function l(e){let{count:t,numberStyle:r}=e;return t?1===t?(0,i.jsx)("span",{style:{marginLeft:-.5,...r},children:"1"}):t>99?(0,i.jsx)("span",{style:{letterSpacing:-.5,...r},children:"99+"}):t>9?(0,i.jsx)("span",{style:{letterSpacing:-.5,marginLeft:-.5,...r},children:t}):(0,i.jsx)("span",{style:{...r},children:t}):null}},766463:(e,t,r)=>{r.d(t,{s:()=>V});r(670560),r(122556),r(582845),r(250570),r(533019),r(721473),r(788208),r(22624),r(267602),r(916054),r(653476),r(470928),r(241792),r(228244);var i=r(667294),n=()=>r(629013),s=()=>r(219727),o=()=>r(142735),a=()=>r(511115),l=()=>r(364402),c=()=>r(565630),d=()=>r(647834),u=()=>r(752778),h=()=>r(899133),p=()=>r(513670),g=()=>r(855741),m=()=>r(696459),S=()=>r(326966),f=()=>r(824462),v=()=>r(932753),I=()=>r(594546),y=()=>r(43721),b=()=>r(15981),C=()=>r(8),x=()=>r(90065),R=()=>r(620218),k=()=>r(828946),L=()=>r(98228),w=()=>r(876822),T=()=>r(804217),M=()=>r(749826),_=()=>r(63317),P=()=>r(485014),j=()=>r(21965),B=()=>r(826955);class W extends(()=>r(263184))().default{getInitialState(){return{query:void 0,localResults:[],numTotalLocalResults:0,serverResults:[],numTotalServerResults:0,searchSessionId:(0,r(956057).Il)(),isResultsLoading:!1}}}const E=W;var O=()=>r(677559),q=()=>r(358565);function V(e){var t;const{searchQuery:r,limit:W,source:V,type:N,disable:Z,overrideSpaceStore:D,overrideSearchSessionId:F,usePrefetch:z,isTitleOnly:G=!0}=e,$=(0,s().O7)(),Q=(0,c().D9)(r),H=(0,c().D9)(e.filters),J=(0,i.useRef)(0),Y=(0,i.useRef)(!0),X=(0,o().VK)((()=>T().default.state.online),[]),ee=(0,o().VK)((()=>e.isLocalOnlyMode||!X),[X,e.isLocalOnlyMode]),te=(0,i.useMemo)((()=>new E),[]),re=(0,o().VK)((()=>F&&F!==te.state.searchSessionId?(te.update((e=>({...e,searchSessionId:F}))),F):te.state.searchSessionId),[te,F]),{searchLocalResults:ie,searchServerResults:ne,isResultsLoading:se,numTotalLocalResults:oe,numTotalServerResults:ae}=(0,o().VK)((()=>({searchLocalResults:te.state.localResults,searchServerResults:te.state.serverResults,isResultsLoading:te.state.isResultsLoading,numTotalLocalResults:te.state.numTotalLocalResults,numTotalServerResults:te.state.numTotalServerResults})),[te]),le=(0,o().VK)((()=>{if(ee||se&&Y.current)return ie;let e=function(e){const{localResults:t,serverResults:r}=e,i=t.map((e=>e.store.id)),n=new Set(i),s=r.filter((e=>!n.has(e.store.id)));return[...t,...s]}({localResults:ie,serverResults:ne});return N===h().n8.CollectionsInSpace&&(e=U(e)),e}),[ee,se,ie,ne,N]),ce=(0,o().VK)((()=>D||w().default.state.currentSpaceStore),[D]),de=(0,o().VK)((()=>"on"===M().default.getEligibleGroup({experimentId:"search-use-local-reranker-layered",parameter:"shouldUseLocalReranker",defaultGroup:"control"})),[]),ue=(0,o().VK)((()=>ee&&X&&Boolean(z)),[ee,X,z]),he=(0,o().VK)((()=>(0,C().bC)($).hasPublicAccessPermission),[$]),pe=(0,i.useMemo)((()=>{const t={navigableBlockContentOnly:G,...e.filters};return(0,h().u4)(t)}),[e.filters,G]),ge=(0,i.useMemo)((()=>{var t;return function(e){const{blockTypes:t,queryType:r}=e;switch(r){case h().n8.CollectionsInSpace:return["collection_view","collection_view_page"];case h().n8.BlocksInCollection:return["page","collection_view_page"];case h().n8.BlocksInSpace:default:return[...t??[]]}}({blockTypes:null===(t=e.filters)||void 0===t?void 0:t.blockTypes,queryType:N})}),[null===(t=e.filters)||void 0===t?void 0:t.blockTypes,N]),me=(0,i.useCallback)(((e,t)=>{const{isSuccess:r,totalResultsCount:i,localCacheMetadata:n,query:s}=t;R().default.measure(e,{environment:$,data:{start_time:e.startTime,success:r,surface:V,num_results:i,search_session_id:re,local_cache_metadata:n,query_length:s.length}})}),[$,V,re]),Se=(0,i.useCallback)(((e,t)=>{const{isSuccess:r,totalResultsCount:i,query:n}=t;R().default.measure(e,{environment:$,data:{start_time:e.startTime,success:r,surface:V,num_results:i,search_session_id:re,search_session_flow_number:J.current,query_length:n.length}})}),[$,V,re]),fe=(0,O().XJ)(k().x.searchActions),ve=(0,i.useCallback)((e=>{const t=R().default.mark("rum.local_quick_search_query"),{query:r,spaceStore:i}=e;if("resolved"!==fe.status)return;const n=N===h().n8.CollectionsInSpace;let s=[];0===r.length&&n&&(s=function(e){const{spaceStore:t,environment:r}=e,i=(0,v().lG)({currentUserId:r.currentUser.id,spaceId:t.id}).map((e=>{const r=B().NW.createChildStore(t,{table:u().vF,id:e}).getParentBlockStore();if(null==r?void 0:r.pathIsAccessibleAndAlive())return r}));return(0,p().oA)(i)}({environment:$,spaceStore:i}).map(((e,t)=>({store:e,originalPosition:t,id:e.id,score:0,spaceId:e.getSpaceId(),sources:[h().vp.Local],featureGroups:[],serverEventProperties:void 0}))));const o=P().Z.state.localSearchableBlocksCache,a=(0,y().U)({environment:$,overrideSpaceStore:i,overrideLocalSearchableBlocksCache:o}),l=(0,q().NH)({environment:$,parentStore:i,isOnline:X,requestInput:{query:{text:r,filters:{...pe,blockTypes:ge},sort:{field:"relevance"}},limit:ee?W:Math.min(W,5)},localSearchCache:o,shouldUseNewRerankerDebugOverrideEnabled:de,shouldLimitLocalResultsWhenOnline:!ee,hasPublicAccessPermission:he}),c=ue?K({query:r,serverResults:Me.current}):[],d=l&&g().x.unwrapOr(l,void 0),m=(null==d?void 0:d.results)??[],S=(null==d?void 0:d.total)??0;let f=p().mN([...s,...m,...c],(e=>e.id));f=n?U(f):f,te.update((e=>e.query!==r?e:(Pe.current=f.map((e=>e.id)),me(t,{query:r,isSuccess:Boolean(d),totalResultsCount:S,localCacheMetadata:a}),{...e,localResults:f,isResultsLoading:!ee&&e.isResultsLoading,numTotalLocalResults:S})))}),[ge,$,pe,he,ee,X,W,fe.status,te,de,N,me,ue]),Ie=(0,n().y)(ve,L().E5),ye=(0,i.useCallback)((e=>{const{result:t,isMetaClick:i,context:n}=e;(0,I().j)({environment:$,event:{eventName:"select_search_item",eventProperties:{sources:t.sources,localSources:Array.from(t.localSource||new Set),searchSessionId:re,searchSessionFlowNumber:J.current,context:n,queryStringLength:r.length,totalSearchResultCount:oe+ae,numLocalResults:ie.length,numTotalLocalResults:oe,isMobile:$.device.isMobile,isMetaClick:i,hasFilters:Boolean(pe),originalPosition:t.originalPosition,selectedItemIndex:t.originalPosition,selectedSearchResultMetadata:{blockId:t.id,blockType:t.store.getModel().type},searchSource:V,verificationState:(0,x().T7)(t.store)}}})}),[$,oe,ae,ie,r,re,J,pe,V]),be=Q===r,Ce=p().Xy(H,e.filters),xe=Boolean(Q&&!r),Re=Ce&&be,ke=!Z&&ce&&!Re,Le=xe||!Ce,we=(0,i.useRef)(!1),Te=(0,i.useRef)([]),Me=(0,i.useRef)([]),_e=(0,i.useRef)([]),Pe=(0,i.useRef)([]),je=(0,o().VK)((()=>{if("mention_menu"!==V)return;return j().Z.getMentionedIds($.currentUser.id)}),[$.currentUser.id,V]),Be=(0,i.useCallback)((async e=>{const t=R().default.mark("rum.server_quick_search_query"),{query:r,spaceStore:i,size:n}=e,s=i.id;if(ee&&!ue)return;const o=!Y.current&&Ce?Te.current:[],a=ue?K({query:r,serverResults:Me.current}):[];if(ue&&(r.length<=1||a.length>=5||_e.current.some((e=>e===r))))return;_e.current.push(r);const c=await f().callApi({eventName:"search",environment:$,data:{type:N,query:r,spaceId:s,collectionId:(null==pe?void 0:pe.parentId)??"",limit:ue?15:n+1,filters:pe,sort:{field:"relevance"},source:V,searchSessionId:re,searchSessionFlowNumber:J.current,recentlyMentionedPageIds:je,recentPagesForBoosting:(0,b().Wk)(_().Z.getWithoutSubscribing(s)),excludedBlockIds:p().jj([...o.map((e=>e.id)),...Pe.current||[],...Me.current.map((e=>e.id))]),ignoresHighlight:!0}});if(!c||"failed"===c.type)return;const u=c.data.total,h=(0,S().m8)((0,m().qP)(c.data.trackEventProperties).map((e=>{let[t,r]=e;return[`server-${t}`,r]}))),g=c.data.results.slice(0,n).map(((e,t)=>{const r=B().G.createChildStore(i,{id:e.id,spaceId:e.spaceId,table:"block"}),n=ue?function(e){const{result:t,store:r,environment:i}=e;if(t.terms)return t.terms;const n=r.getModel();if(!n)return[];const s=i.defaultRecordCache.inMemoryRecordCache.makeGetRecordValueFn(i.currentUser.id),o=(0,d().$B)((0,l().ut)({blockValue:n,getRecordValue:s}).text);if(!o)return[];return A(o)}({environment:$,store:r,result:e}):e.terms;return{store:r,originalPosition:t,...e,serverEventProperties:h,terms:n}}));we.current=!(u<=n);const v=[...o,...g];Te.current=v,Me.current=p().mN([...ue?g:[],...Me.current],(e=>e.id)),ue||(te.update((e=>e.query!==r?e:(Se(t,{query:r,isSuccess:"success"===c.type,totalResultsCount:u}),{...e,serverResults:v,isResultsLoading:!1,numTotalServerResults:u}))),J.current+=1)}),[ee,Ce,$,N,pe,V,re,je,Pe,te,Se,ue]),We=(0,i.useCallback)((e=>{!Z&&ce&&we.current&&!se&&X&&(te.update((e=>({...e,isResultsLoading:!0}))),we.current=!1,Y.current=!1,Be({query:r,spaceStore:ce,size:e??20}))}),[ce,Z,Be,X,se,r,te]),Ee=(0,a().z)(We,L().rE),Oe=(0,n().y)(Be,ue?0:L().rE);return(0,i.useEffect)((()=>{if(Le){const e=te.getInitialState();te.update((t=>({...e,searchSessionId:t.searchSessionId}))),Me.current=[],_e.current=[]}ke&&(Y.current=!0,te.update((e=>({...e,isResultsLoading:!0,query:r}))),Ie({query:r,spaceStore:ce}),Oe({query:r,spaceStore:ce,size:W}))}),[ce,Ie,Oe,W,r,ke,te,Le]),{results:le,isResultsLoading:se,searchSessionId:re,fetchAdditionalServerResultsOnChange:!Z&&!ee&&we.current&&Re?Ee:void 0,searchSessionFlowNumber:J.current,hasMoreResults:we.current,searchAnalytics:{trackSelectSearchItem:ye}}}function A(e){return e.normalize().toLocaleLowerCase().split(/\s/gu)}function K(e){const{query:t,serverResults:r}=e;if(!t)return[];const i=A(t),n=i.pop();return n?r.filter((e=>{const t=e.terms??[],r=t.find((e=>e.startsWith(n))),s=i.every((e=>t.some((t=>t===e))));return r&&s})):[]}function U(e){const t=new Set;return e.filter((e=>{const r=e.store.getCollectionViewSourceCollectionStore();return!(!r||t.has(r.id))&&(t.add(r.id),!0)}))}},965910:(e,t,r)=>{r.d(t,{h:()=>i().h});var i=()=>r(968061)},420406:(e,t,r)=>{r.d(t,{$:()=>i});function i(e,t){t.route.name;return!1}},341643:(e,t,r)=>{r.d(t,{DW:()=>v,IG:()=>m,J4:()=>f,hZ:()=>S,q9:()=>g,qq:()=>I,s4:()=>p});var i=r(667294),n=()=>r(219727),s=()=>r(142735),o=()=>r(801812),a=()=>r(677559),l=()=>r(690664),c=()=>r(105649),d=()=>r(291335),u=()=>r(590972),h=()=>r(420406);const p=new(a().Ss)("PerformanceToolbar",(()=>Promise.all([r.e(62743),r.e(5242),r.e(4642),r.e(69197),r.e(52658),r.e(54194)]).then(r.bind(r,333301)))),g=(0,a().kF)(p,(e=>e.PerformanceToolbar)),m=(0,a().kF)(p,(e=>e.PerformanceToolbarSettings));function S(){const e=(0,n().O7)();return(0,s().VK)((()=>(0,h().$)(e,e.RouterStore.state)),[e])}function f(){const e=(0,n().O7)(),t=y("PerformanceToolbarStore"),r=y("isPerformanceToolbarVisible");return(0,s().VK)((()=>!(!t||!r)&&r(e,e.RouterStore.state,t.state)),[r,e,t])}function v(){const e=y("PerformanceToolbarStore");return(0,s().VK)((()=>!!e&&e.state.isPerformanceToolbarMounted),[e])}function I(){const e=(0,n().O7)(),t=y("createPerformanceToolbarMouseListeners"),r=y("PerformanceToolbarStore"),{sidebarExpanded:o,sidebarWidth:a,secondarySidebarExpanded:h,secondarySidebarWidth:p,updateSidebarExpanded:g,updateSidebarWidth:m}=(0,s().VK)((()=>({sidebarExpanded:d().sidebarExpandedStore.state,sidebarWidth:d().sidebarWidthStore.state,secondarySidebarExpanded:c().default.isOpen(),secondarySidebarWidth:l().default.getWidth(),updateSidebarExpanded:u().default.state.expanded,updateSidebarWidth:u().default.state.width})),[]);return(0,i.useEffect)((()=>{if(r&&t)return t(e,(e=>r.update((t=>({...t,isMouseNearPerformanceToolbar:e})))),o,a,h,p,g,m)}),[t,e,r,o,a,h,p,g,m])}function y(e){const t=S(),[{value:r}]=(0,o().r5)((()=>t?p.load().then((t=>t[e])):Promise.resolve(void 0)),[e,t]);return r}},184441:(e,t,r)=>{r.d(t,{default:()=>s});class i extends(()=>r(263184))().default{getInitialState(){return{open:!1,isShowingLoadingState:!1}}updateUserCustomizations(e,t){this.state.open&&this.state.collectionTemplate&&this.setState({...this.state,userCustomizations:{...this.state.userCustomizations,[e]:t}})}updateCollectionTemplate(e){this.state.open&&this.state.collectionTemplate&&this.setState({...this.state,collectionTemplate:e})}updatePreviewCollectionViewTemplateId(e){this.state.open&&this.state.collectionTemplate&&this.setState({...this.state,previewCollectionViewTemplateId:e})}getParentStore(){return this.state.open?this.state.parentStore:void 0}getShouldShowExpandedTemplateList(){return this.state.open&&this.state.shouldShowExpandedTemplateList}setShouldShowExpandedTemplateList(e){this.state.open&&this.setState({...this.state,shouldShowExpandedTemplateList:e})}close(e){var t,r;this.state.open&&(null===(t=(r=this.state).onClose)||void 0===t||t.call(r,e),this.setState({open:!1,isShowingLoadingState:!1}))}reset(){this.setState(this.getInitialState())}}const n=new i;(0,r(947115).exposeDebugValue)("InitializeWorkflowTemplateModalStore",n);const s=n},77973:(e,t,r)=>{r.d(t,{U:()=>_});var i=r.n(r(389539)),n=(r(821057),r(409045),r(453627),r(994774),r(995194),r(520522),r(200082),r(379976),r(724224),r(761121),r(637133),r(241792),r.n(r(402568))),s=()=>r(513670),o=()=>r(326966),a=()=>r(431595),l=()=>r(24945),c=()=>r(255933);const d={version:8,notion_version:0,variant:2},u={version:8,notion_version:1,variant:2},h=0,p=1,g=6,m=8,S=10,f=Date.UTC(2024,0,1);function v(e,t){if(e)return t[h]=255,t[h+1]=240|15&t[h+1],t;const r=Math.floor(((new Date).getTime()-f)/o().A0);if(r>=4096||r<0)throw new Error("Invalid offsetInDays.");return t[h]=r>>4,t[h+1]=r<<4&240|15&t[h+1],t}function I(e,t){if(e>=2**36||e<0)throw new Error("Invalid spaceShortId.");t[p]=240&t[p]|e/2**32&15;for(let r=0;r<4;r++)t[p+1+r]=e/2**(24-8*r)&255;return t}function y(e,t){const r=e?1:0;return t[g]=d.version<<4&240|d.notion_version<<1&14|1&r,t[m]=d.variant<<6&192|63&t[m],t}function b(e,t){if("block"===e)return t[S]=(0,l().ym)(e)|63&t[S],t;const r=(0,l().ym)(e);return t[S]=r>>8&127,t[S+1]=255&r,t}function C(e,t){const r=(0,l().Nq)(e);return t[S]=127&r|128&t[S],t}function x(e,t,r,i){const n=new Uint8Array(16),s=globalThis.crypto.getRandomValues(n);return r!==c().bx&&v(e,s),I(t,s),y(i,s),b(r,s),w(s)}function R(e,t,r){return k(e,t,r)}function k(e,t,r){const i=n()(r),o=s().yo(i,2).map((e=>parseInt(e.join(""),16)));if((0,l().LV)(t)){if(void 0===e)throw new(a().D3)(`Deterministic ID for '${t}' must specify a space short id`)}else if(void 0!==e)throw new(a().D3)(`Deterministic ID for '${t}' should not provide a space short id`);const c=new Uint8Array(o);return e&&I(e,c),C(t,c),function(e){e[g]=240&u.version<<4|14&u.notion_version<<1|1&e[g],e[m]=192&u.variant<<6|63&e[m]}(c),w(c)}const L=new Array(256).fill(0).map(((e,t)=>t.toString(16).padStart(2,"0")));function w(e){let t=0;return L[e[t++]]+L[e[t++]]+L[e[t++]]+L[e[t++]]+"-"+L[e[t++]]+L[e[t++]]+"-"+L[e[t++]]+L[e[t++]]+"-"+L[e[t++]]+L[e[t++]]+"-"+L[e[t++]]+L[e[t++]]+L[e[t++]]+L[e[t++]]+L[e[t++]]+L[e[t++]]}var T=()=>r(956057);const M=`,${[r(363777).uK].join(",")},`;class _{constructor(e){this.environmentName=void 0,this.mainShortId=void 0,this.getSettings=void 0,this.isServerOriginated=void 0,this.mapSpaceIdToShortId=void 0,this.idCreatorLogger=void 0,this.environmentName=e.environmentName,this.mainShortId=r(631871).jF[this.environmentName],this.getSettings=e.getSettings,this.isServerOriginated=e.isServerOriginated,this.mapSpaceIdToShortId=e.mapSpaceIdToShortId,this.idCreatorLogger=e.idCreatorLogger??(()=>{})}idInMain(e,t){const{enableTestDateOffset:r,enableIdSchema:i}=this.getSettings(t);return!i||M.includes(`,${e},`)?this.legacyId(e,"disabled",t):(this.idCreatorLogger(void 0,e,r?"id_schema_test":"id_schema",t),function(e,t,r,i){return x(e,t,r,i)}(r,this.mainShortId,e,this.isServerOriginated))}pointerInMain(e,t){return{table:e,id:this.idInMain(e,t)}}async idWithSpaceId(e,t,r){const{enableTestDateOffset:n,enableIdSchema:s}=this.getSettings(r);if(!s)return this.legacyId(t,"disabled",r);const o=this.mapSpaceIdToShortId(e),a=i().types.isPromise(o)?await o:o;return a?(this.idCreatorLogger(e,t,n?"id_schema_test":"id_schema",r),x(n,a,t,this.isServerOriginated)):this.legacyId(t,"missing_short_id",r)}async pointerWithSpaceId(e,t,r){return{table:t,spaceId:e,id:await this.idWithSpaceId(e,t,r)}}idWithSpaceShortId(e,t,r){const{enableTestDateOffset:i,enableIdSchema:n}=this.getSettings(r);return n?(this.idCreatorLogger(void 0,t,i?"id_schema_test":"id_schema",r),x(i,e,t,this.isServerOriginated)):this.legacyId(t,"disabled",r)}legacyId(e,t,r){return this.idCreatorLogger(void 0,e,t,r),T().Il()}async deterministicIdWithSpaceId(e,t,r,n){const{enableTestDateOffset:s,enableIdSchema:o}=this.getSettings(n);if(!o)return this.idCreatorLogger(e,t,"disabled",n),T().Ul(r);const a=this.mapSpaceIdToShortId(e),l=i().types.isPromise(a)?await a:a;return l?(this.idCreatorLogger(e,t,s?"id_schema_test":"id_schema",n),R(l,t,r)):(this.idCreatorLogger(e,t,"missing_short_id",n),T().Ul(r))}deterministicIdWithSpaceShortId(e,t,r,i){const{enableTestDateOffset:n,enableIdSchema:s}=this.getSettings(i);return s?(this.idCreatorLogger(void 0,t,n?"id_schema_test":"id_schema",i),R(e,t,r)):(this.idCreatorLogger(void 0,t,"disabled",i),T().Ul(r))}async getSpaceIdCreator(e){if(!e)return new P(e,this.idCreatorLogger);const{enableIdSchema:t}=this.getSettings();if(!t)return new P(e,this.idCreatorLogger);const r=this.mapSpaceIdToShortId(e),n=i().types.isPromise(r)?await r:r;return this.getSpaceShortIdCreator(e,n)}getSpaceIdCreatorSync(e){if(!e)return new P(e,this.idCreatorLogger);const{enableIdSchema:t}=this.getSettings();if(!t)return new P(e,this.idCreatorLogger);const r=this.mapSpaceIdToShortId(e),n=i().types.isPromise(r)?void 0:r;return this.getSpaceShortIdCreator(e,n)}getSpaceShortIdCreator(e,t){const{enableIdSchema:r}=this.getSettings();return r&&t?new j(e,this,t):new P(e,this.idCreatorLogger)}async getSpaceIdCreatorFromModel(e){return e.getShortIdStr()?this.getSpaceShortIdCreator(e.id,Number(e.getShortIdStr())):await this.getSpaceIdCreator(e.id)}}class P{constructor(e,t){this.spaceId=void 0,this.idCreatorLogger=void 0,this.spaceId=e,this.idCreatorLogger=t}idInSavedSpace(e,t){return this.idCreatorLogger(void 0,e,"disabled",t),T().Il()}idInMain(e,t){return this.idCreatorLogger(void 0,e,"disabled",t),T().Il()}deterministicIdInSavedSpace(e,t,r){return this.idCreatorLogger(void 0,e,"disabled",r),T().Ul(t)}pointerInMain(e,t){return{id:this.idInMain(e),table:e}}pointerInSavedSpace(e,t){return{id:this.idInSavedSpace(e),table:e,spaceId:this.spaceId}}getSpaceId(){return this.spaceId}}class j{constructor(e,t,r){this.spaceId=void 0,this.idCreator=void 0,this.spaceShortId=void 0,this.spaceId=e,this.idCreator=t,this.spaceShortId=r}idInSavedSpace(e,t){return this.idCreator.idWithSpaceShortId(this.spaceShortId,e,t)}idInMain(e,t){return this.idCreator.idInMain(e,t)}deterministicIdInSavedSpace(e,t,r){return this.idCreator.deterministicIdWithSpaceShortId(this.spaceShortId,e,t,r)}pointerInMain(e,t){return{id:this.idInMain(e,t),table:e}}pointerInSavedSpace(e,t){return{id:this.idInSavedSpace(e,t),table:e,spaceId:this.spaceId}}getSpaceId(){return this.spaceId}}},971095:(e,t,r)=>{r.d(t,{A:()=>i});const i=(0,r(830742).LS)("importEvernote")}}]);