"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[15746],{637677:(e,t,o)=>{o.r(t),o.d(t,{CollectionFormEditorView:()=>R});var n=o(667294),r=()=>o(219727),i=()=>o(142735),l=()=>o(263184),a=()=>o(205951),s=()=>o(67901),d=()=>o(628370),c=()=>o(347577),u=()=>o(826955),p=(o(821057),o(267602),o(470928),()=>o(492788)),m=()=>o(70186),f=()=>o(956057),C=()=>o(955620),S=()=>o(139224),y=()=>o(990966),v=()=>o(125659),g=()=>o(233417),h=()=>o(949842),_=()=>o(275200),w=()=>o(356140),I=()=>o(913011),x=()=>o(162178),b=()=>o(8564),L=()=>o(857719),M=()=>o(560801),V=()=>o(367933),k=()=>o(75433),K=()=>o(127519),T=()=>o(807230),j=()=>o(18281),P=()=>o(30795),E=()=>o(897257);class B extends l().default{getInitialState(){}autofocusQuestionDescription(e){let{questionId:t}=e;this.setState({questionId:t,questionInputType:"description"})}autofocusQuestionTitle(e){let{questionId:t}=e;this.setState({questionId:t,questionInputType:"title"})}clear(){this.setState(void 0)}}var D=()=>o(641929),O=o(785893);function H(e){let{collectionContextStore:t,collectionViewStore:o,layoutStore:l,headingWidth:a,isCollectionEmpty:s}=e;const d=(0,r().O7)(),c=(0,i().qz)(void 0,V().Z),u=(0,w().W)(),p=(0,i().Kw)(E().subscriptionDataStoreInstance),m=(0,P().V)(p);return(0,n.useEffect)((()=>{u&&p&&j().Ln(d,u,p,m)&&T().hT(d)}),[d,u,p,m]),(0,O.jsx)(Z,{collectionContextStore:t,collectionViewStore:o,layoutStore:l,layoutBuilderModuleSelectionStore:c,headingWidth:a,isCollectionEmpty:s,children:(0,O.jsx)(A,{children:(0,O.jsx)(L().Xg,{type:"form",children:(0,O.jsx)(b().v,{area:"form_layout_schema"})})})})}function Z(e){let{children:t,collectionContextStore:o,collectionViewStore:a,layoutStore:s,layoutBuilderModuleSelectionStore:d,headingWidth:c,isCollectionEmpty:u}=e;const h=(0,r().O7)(),w=(0,i().VK)((()=>o.collectionStore()),[o]),[b]=(0,n.useState)(f().Il()),L=(0,i().VK)((()=>d.getState()),[d]),V=(0,i().qz)(void 0,M().Z),K=(0,i().qz)(void 0,B),T=(0,i().qz)(void 0,g().Z),j=l().default.createValue(!1,{name:"headerFocusStore"}),P=(0,i().VK)((()=>o.permissionScopesStore.state.canConfigureCollection),[o]),E=(0,i().VK)((()=>a.getFormBlockStore()),[a]),H=(0,i().VK)((()=>h.WindowSizeStore.state.height),[h.WindowSizeStore]),Z=(0,n.useCallback)((e=>{var t;const n=d.getState();if(n&&"existing_module"===n.type){var r,i;const t=null===(r=s.getModules().form_conditional_modules)||void 0===r?void 0:r[n.moduleId],o=void 0!==t?t:null===(i=s.getModules().form_layout_schema)||void 0===i?void 0:i.find((e=>e.id===n.moduleId));!o||"placeholder"!==o.type||t||e&&("existing_module"!==e.type||n.moduleId===e.moduleId)||(0,I().H)({environment:h,position:{area:t?"form_conditional_modules":"form_layout_schema",moduleId:o.id},layoutStore:s,sessionId:b})}if(d.setState(e),(e||n)&&y().clear({environment:h}),!e||"existing_module"!==e.type||e.isDragging)return;if(!w)return;const l=s.getModuleById(e.moduleId);if(!l)return;const a=void 0!==(null===(t=s.getModules().form_conditional_modules)||void 0===t?void 0:t[l.id]);p().default.afterNextFlush((()=>{const e=k().Z.findModuleContainer({layoutStore:s,moduleId:l.id}),t=null==e?void 0:e.getNode(),n={current:t??null},r=null==t?void 0:t.getBoundingClientRect();switch(((null==r?void 0:r.bottom)??0)+120>H&&(0,_().Wr)(t,{edgeDist:.5*H,animate:!0}),l.type){case"formQuestion":S().r$({collectionContextStore:o,collectionSettingsStore:o.settingsStore,ref:n}),S().FK({collectionSettingsStore:o.settingsStore,item:{type:"formQuestionEditSettings",formQuestionId:l.formQuestionId,moduleId:l.id},ref:n});break;case"placeholder":S().r$({collectionContextStore:o,collectionSettingsStore:o.settingsStore}),S().FK({collectionSettingsStore:o.settingsStore,item:{type:"formQuestionCreateSettings",moduleId:l.id,area:a?"form_conditional_modules":"form_layout_schema",parentModuleId:l.parentModuleId,parentConditionalGroupId:l.parentConditionalGroupId},ref:n});break;default:throw new Error("Unexpected module type")}}))}),[d,w,s,h,b,H,o]),A=l().default.createValue(!1),F=(0,n.useMemo)((()=>({collectionStore:w,layoutStore:s,currentModuleSelection:L,setModuleSelection:Z,sessionId:b,addModuleHoverMenuStore:V,canEditLayout:P,isPropertyTypeSearchInputDirtyStore:A,layoutBuilderModuleSelectionStore:d})),[w,s,L,Z,b,V,P,A,d]),R=(0,n.useMemo)((()=>{if(!w||!E)throw new Error("Need a collection store and form block store to build the form context");return{autofocusedQuestionTextStore:K,formBlockStore:E,headerMouseStore:T,headerFocusStore:j,collectionStore:w,isCollectionEmpty:u}}),[K,E,j,T,w,u]);(0,n.useEffect)((()=>{o.formsBaseLayoutEditorContextValueStore.setState(F),o.formsSpecificLayoutEditorContextValueStore.setState(R)}),[o,F,R]);const $=(0,n.useRef)(!1);(0,n.useEffect)((()=>{if(!1===$.current&&E&&E.isReady()){$.current=!0;const e=E.getTitleStore();e&&!C().QaF(e.getValue())&&y().setSelectionAtEnd({store:e})}}),[E,$]);const q=(0,n.useCallback)((()=>{Z(void 0),S().E3({collectionSettingsStore:o.settingsStore})}),[o.settingsStore,Z]);return(0,m().L)(q),w&&a?(0,O.jsx)(v().L1,{value:o,children:(0,O.jsx)(x().Dt.Provider,{value:F,children:(0,O.jsx)(D().E.Provider,{value:R,children:t})})}):null}function A(e){let{children:t}=e;const{setModuleSelection:o,currentModuleSelection:r,layoutStore:l}=(0,x().J9)(),a=(0,v().Y$)(),s=(0,i().VK)((()=>a.settingsStore.state.open),[a]),d=(0,n.useCallback)((()=>{o(void 0)}),[o]);(0,n.useEffect)((()=>{s||d()}),[d,s]);const c=(0,i().VK)((()=>(K().default.state,K().default.getRootFormQuestionStoreOfSelection())),[]),u=(0,i().VK)((()=>"existing_module"===(null==r?void 0:r.type)?l.getModuleById(r.moduleId):void 0),[r,l]);return(0,n.useEffect)((()=>{c&&u&&"formQuestion"===(null==u?void 0:u.type)&&c.id!==u.formQuestionId&&(d(),S().E3({collectionSettingsStore:a.settingsStore}))}),[d,a.settingsStore,u,c]),(0,O.jsx)("div",{style:{paddingBottom:96,cursor:"default"},onClick:e=>{(0,h().ZP)({event:e,context:h().Af.EditorClick,callback:()=>{d()}})},children:t})}const F=l().default.createClass(void 0,{name:"ReducerResultStore"});function R(e){const{paddingLeft:t,paddingRight:o,collectionContextStore:n,headingWidth:l}=e,p=(0,r().O7)(),m=(0,i().VK)((()=>p.device.isMobile),[p.device]),f=(0,i().VK)((()=>n.collectionViewStore()),[n]),C=(0,i().VK)((()=>n.settingsStore),[n]),S=(0,i().VK)((()=>{if(f)return f.getFormBlockStore()}),[f]),y=(0,i().VK)((()=>{if(!S)return;const e=null==S?void 0:S.getFormat().form_layout_pointer;return e?u().xj.createChildStore(S,e):void 0}),[S]),v=(0,i().VK)((()=>null==y?void 0:y.isDefined()),[y]),g=(0,i().VK)((()=>null==S?void 0:S.isDefined()),[S]),h=(0,i().VK)((()=>"sidebar"===(0,c().F4)(n,m,l)&&C.state.open),[n,C,l,m]),_=(0,i().qz)(void 0,F),w=(0,i().VK)((()=>!!_.state&&0===_.state.blockIds.length),[_]);return f&&y&&v&&g?(0,O.jsxs)("div",{style:{paddingLeft:t,paddingRight:o},children:[(0,O.jsx)(s().Z,{id:"form_editor_results",collectionContextStore:n,reducer:{type:"results",filter:{operator:"and",filters:[]},limit:1},resultStore:_}),(0,O.jsx)(d().Z,{animate:{width:h?`calc(100% - ${a().P4}px)`:"100%"},children:(0,O.jsx)(H,{collectionContextStore:n,collectionViewStore:f,layoutStore:y,headingWidth:l,isCollectionEmpty:w})})]}):null}},42392:(e,t,o)=>{o.d(t,{p:()=>i});var n=()=>o(677559);const r=new(n().Ss)("PulsingWrapper",(async()=>o.e(66043).then(o.bind(o,125756)))),i=(0,n().iS)(r,(e=>e.PulsingWrapper),{renderLoading:(e,t)=>t.children})},820545:(e,t,o)=>{o.d(t,{I:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("arrowLeftRounded",{viewBox:"0 0 16 13",svg:(0,n.jsx)("path",{d:"M0.617188 6.85156C0.617188 6.60677 0.710938 6.39323 0.898438 6.21094L6.03906 1.07812C6.13281 0.984375 6.23177 0.914062 6.33594 0.867188C6.4401 0.820312 6.54948 0.796875 6.66406 0.796875C6.90365 0.796875 7.10417 0.875 7.26562 1.03125C7.42708 1.1875 7.50781 1.38281 7.50781 1.61719C7.50781 1.74219 7.48438 1.85677 7.4375 1.96094C7.39062 2.0599 7.32812 2.14844 7.25 2.22656L5.5 4L2.59375 6.66406L2.3125 6.15625L5.02344 5.99219H14.5156C14.776 5.99219 14.9844 6.07292 15.1406 6.23438C15.3021 6.39062 15.3828 6.59635 15.3828 6.85156C15.3828 7.10156 15.3021 7.30729 15.1406 7.46875C14.9844 7.625 14.776 7.70312 14.5156 7.70312H5.02344L2.3125 7.54688L2.59375 7.04688L5.5 9.70312L7.25 11.4688C7.32812 11.5469 7.39062 11.638 7.4375 11.7422C7.48438 11.8464 7.50781 11.9583 7.50781 12.0781C7.50781 12.3125 7.42708 12.5078 7.26562 12.6641C7.10417 12.8203 6.90365 12.8984 6.66406 12.8984C6.4349 12.8984 6.22917 12.8099 6.04688 12.6328L0.898438 7.49219C0.710938 7.3099 0.617188 7.09635 0.617188 6.85156Z"})})},660065:(e,t,o)=>{o.d(t,{r:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("arrowRightRounded",{viewBox:"0 0 16 13",svg:(0,n.jsx)("path",{d:"M15.3828 6.85156C15.3828 7.09635 15.2917 7.3099 15.1094 7.49219L9.95312 12.6328C9.77083 12.8099 9.5651 12.8984 9.33594 12.8984C9.09635 12.8984 8.89583 12.8203 8.73438 12.6641C8.57812 12.5078 8.5 12.3125 8.5 12.0781C8.5 11.9583 8.52083 11.8464 8.5625 11.7422C8.60938 11.638 8.67188 11.5469 8.75 11.4688L10.5 9.70312L13.4141 7.04688L13.6875 7.54688L10.9766 7.70312H1.48438C1.22396 7.70312 1.01302 7.625 0.851562 7.46875C0.695312 7.30729 0.617188 7.10156 0.617188 6.85156C0.617188 6.59635 0.695312 6.39062 0.851562 6.23438C1.01302 6.07292 1.22396 5.99219 1.48438 5.99219H10.9766L13.6875 6.15625L13.4141 6.66406L10.5 4L8.75 2.22656C8.67188 2.14844 8.60938 2.0599 8.5625 1.96094C8.52083 1.85677 8.5 1.74219 8.5 1.61719C8.5 1.38281 8.57812 1.1875 8.73438 1.03125C8.89583 0.875 9.09635 0.796875 9.33594 0.796875C9.45052 0.796875 9.5599 0.820312 9.66406 0.867188C9.76823 0.914062 9.86719 0.984375 9.96094 1.07812L15.1094 6.21094C15.2917 6.39323 15.3828 6.60677 15.3828 6.85156Z"})})},536635:(e,t,o)=>{o.d(t,{Z:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("arrowUp",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M8 14.5586C8.44434 14.5586 8.74512 14.251 8.74512 13.7998V5.30957L8.69043 3.83984L10.4951 5.84961L12.0469 7.38086C12.1836 7.51074 12.3682 7.59961 12.5801 7.59961C12.9902 7.59961 13.291 7.28516 13.291 6.86816C13.291 6.66992 13.2158 6.49219 13.0586 6.32812L8.55371 1.81641C8.40332 1.66602 8.20508 1.57715 8 1.57715C7.79492 1.57715 7.59668 1.66602 7.44629 1.81641L2.94141 6.32812C2.78418 6.49219 2.70898 6.66992 2.70898 6.86816C2.70898 7.28516 3.0166 7.59961 3.42676 7.59961C3.63184 7.59961 3.82324 7.51074 3.95312 7.38086L5.50488 5.84961L7.30957 3.83301L7.25488 5.30957V13.7998C7.25488 14.251 7.5625 14.5586 8 14.5586Z"})})},135515:(e,t,o)=>{o.d(t,{A:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("plusMedium",{viewBox:"0 0 16 16",svg:(0,n.jsx)("g",{children:(0,n.jsx)("path",{d:"M2 8a.77.77 0 01.237-.566.762.762 0 01.566-.244h4.394V2.803a.77.77 0 01.237-.566A.773.773 0 018 2c.225 0 .416.079.573.237a.773.773 0 01.237.566V7.19h4.387c.22 0 .409.081.566.244A.773.773 0 0114 8a.781.781 0 01-.237.573.785.785 0 01-.566.23H8.81v4.401a.764.764 0 01-.237.56A.781.781 0 018 14a.773.773 0 01-.566-.237.764.764 0 01-.237-.559V8.803H2.803a.785.785 0 01-.566-.23A.781.781 0 012 8z"})})})},395272:(e,t,o)=>{o.d(t,{p:()=>r});o(667294);var n=o(785893);const r=(0,o(827282).IU)("trashSmall",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M5.31055 14.3398C4.85742 14.3398 4.49414 14.2129 4.2207 13.959C3.95117 13.7051 3.80664 13.3516 3.78711 12.8984L3.38867 4.45508H2.74414C2.59961 4.45508 2.47656 4.4043 2.375 4.30273C2.27344 4.20117 2.22266 4.07812 2.22266 3.93359C2.22266 3.79297 2.27344 3.67383 2.375 3.57617C2.47656 3.47461 2.59961 3.42383 2.74414 3.42383H13.2617C13.4062 3.42383 13.5273 3.47266 13.625 3.57031C13.7266 3.66797 13.7773 3.78906 13.7773 3.93359C13.7773 4.07812 13.7266 4.20117 13.625 4.30273C13.5273 4.4043 13.4062 4.45508 13.2617 4.45508H12.6172L12.2188 12.8926C12.1992 13.3457 12.0527 13.6992 11.7793 13.9531C11.5059 14.2109 11.1445 14.3398 10.6953 14.3398H5.31055ZM5.42773 13.3027H10.5723C10.7363 13.3027 10.8711 13.248 10.9766 13.1387C11.082 13.0332 11.1387 12.8926 11.1465 12.7168L11.5273 4.45508H4.45508L4.85352 12.7168C4.86133 12.8887 4.91797 13.0293 5.02344 13.1387C5.12891 13.248 5.26367 13.3027 5.42773 13.3027ZM6.27734 12.3535C6.15625 12.3535 6.05859 12.3203 5.98438 12.2539C5.91016 12.1836 5.87109 12.0898 5.86719 11.9727L5.69141 5.83203C5.6875 5.71875 5.72266 5.62695 5.79688 5.55664C5.87109 5.48242 5.96875 5.44531 6.08984 5.44531C6.21094 5.44531 6.30859 5.48047 6.38281 5.55078C6.45703 5.62109 6.49414 5.71289 6.49414 5.82617L6.67578 11.9668C6.67578 12.084 6.63867 12.1777 6.56445 12.248C6.49414 12.3184 6.39844 12.3535 6.27734 12.3535ZM8 12.3535C7.87891 12.3535 7.7793 12.3184 7.70117 12.248C7.62695 12.1777 7.58984 12.0859 7.58984 11.9727V5.83203C7.58984 5.71875 7.62695 5.62695 7.70117 5.55664C7.7793 5.48242 7.87891 5.44531 8 5.44531C8.125 5.44531 8.22461 5.48242 8.29883 5.55664C8.37695 5.62695 8.41602 5.71875 8.41602 5.83203V11.9727C8.41602 12.0859 8.37695 12.1777 8.29883 12.248C8.22461 12.3184 8.125 12.3535 8 12.3535ZM9.72852 12.3535C9.60352 12.3535 9.50391 12.3184 9.42969 12.248C9.35938 12.1777 9.32617 12.084 9.33008 11.9668L9.50586 5.83203C9.50977 5.71484 9.54883 5.62109 9.62305 5.55078C9.69727 5.48047 9.79297 5.44531 9.91016 5.44531C10.0352 5.44531 10.1328 5.48242 10.2031 5.55664C10.2773 5.62695 10.3125 5.71875 10.3086 5.83203L10.1328 11.9727C10.1289 12.0898 10.0898 12.1836 10.0156 12.2539C9.94141 12.3203 9.8457 12.3535 9.72852 12.3535ZM5.33984 3.81055V2.54492C5.33984 2.0957 5.47461 1.74609 5.74414 1.49609C6.01758 1.24219 6.39648 1.11523 6.88086 1.11523H9.10742C9.5918 1.11523 9.9707 1.24219 10.2441 1.49609C10.5176 1.74609 10.6543 2.0957 10.6543 2.54492V3.81055H9.57031V2.59766C9.57031 2.44922 9.52148 2.33008 9.42383 2.24023C9.32617 2.14648 9.19531 2.09961 9.03125 2.09961H6.95703C6.79688 2.09961 6.66797 2.14648 6.57031 2.24023C6.47266 2.33008 6.42383 2.44922 6.42383 2.59766V3.81055H5.33984Z"})})},356140:(e,t,o)=>{o.d(t,{W:()=>i});var n=()=>o(142735),r=()=>o(876822);function i(){const{currentSpaceStore:e}=(0,n().VK)((()=>r().default.state),[]);return null==e?void 0:e.id}},579012:(e,t,o)=>{o.d(t,{K:()=>s});var n=o(667294),r=()=>o(219727),i=()=>o(142735),l=()=>o(99537),a=()=>o(162178);function s(){const{layoutStore:e,currentModuleSelection:t,setModuleSelection:o,sessionId:s}=(0,a().J9)(),d=(0,r().O7)(),c=(0,i().VK)((()=>{var t;return null===(t=e.getModel())||void 0===t?void 0:t.getLayoutType()}),[e]),u="form"===c?"form_layout_schema":"new_module"===(null==t?void 0:t.type)?t.area:void 0;return(0,n.useCallback)((n=>{const{layoutModule:r,transaction:i}=n;if(!e.getModel()||!u||"form_conditional_modules"===u)return;let a;if("form"===c)a=n.position??{type:"area_relative",area:"form_layout_schema",location:"end_moveable"};else{if("new_module"!==(null==t?void 0:t.type))return;if("form_conditional_modules"===t.area)return;a="views_main_tab_modules"===t.area?{type:"area_relative",area:t.area,viewId:t.viewsMainTabId,location:"end_moveable"}:{type:"area_relative",area:t.area,location:"end_moveable"}}(0,l().sW)({environment:d,sessionId:s,layoutStore:e,position:a,module:r,transaction:i,isPropertyCreation:!1}),o({type:"existing_module",moduleId:r.id,isDragging:!1})}),[u,t,d,e,c,s,o])}},946650:(e,t,o)=>{o.d(t,{l:()=>u,w:()=>p});var n=o(667294),r=()=>o(219727),i=()=>o(142735),l=()=>o(269299),a=()=>o(348141),s=()=>o(718959),d=()=>o(876822);function c(e){let{userSettingsDismissibleKey:t}=e;const o=(0,r().O7)(),c=(0,i().VK)((()=>d().default.state.currentUserSettingsStore),[]),u=(0,i().VK)((()=>{const e=null==c?void 0:c.getSettings();return!e||Boolean(e[t])}),[t,c]),p=(0,i().VK)((()=>{const e=(0,s().B7)(o),t=null==c?void 0:c.getSettings();return Boolean(e)&&Boolean(t)&&!o.device.isMobile&&!u}),[o,c,u]),m=n.useCallback((()=>{c&&!u&&p&&l().createAndCommit({environment:o,userAction:"LayoutInfoPanelButtonEducationTooltip.dismiss",canUndo:!1,perform:e=>{a().d2({userSettingsStore:c,transaction:e,data:{[t]:Date.now()}})}})}),[o,p,t,c,u]);return{shouldShowTooltip:p,dismissTooltip:m}}function u(){return c({userSettingsDismissibleKey:"layout_info_panel_button_education_tooltip_dismissed_at"})}function p(){return c({userSettingsDismissibleKey:"layout_builder_add_module_button_education_tooltip_dismissed_at"})}},274860:(e,t,o)=>{o.d(t,{G:()=>s});var n=o(667294),r=()=>o(543172),i=()=>o(579012),l=()=>o(946650),a=()=>o(162178);function s(e){const{setModuleSelection:t,layoutStore:o}=(0,a().J9)(),s=(0,i().K)(),{dismissTooltip:d}=(0,l().w)();return(0,n.useCallback)((()=>{var n;"form"===(null===(n=o.getModel())||void 0===n?void 0:n.getLayoutType())&&"form_conditional_modules"!==e.area?s({layoutModule:{type:"placeholder",id:(0,r().ZP)()},position:e.afterModuleId?{type:"module_relative",area:e.area,direction:"below",relativeToModuleId:e.afterModuleId}:void 0}):(t({type:"new_module",isDragging:!1,..."views_main_tab_modules"===e.area?{area:"views_main_tab_modules",viewsMainTabId:e.viewsMainTabId}:{area:e.area}}),"page_main"===e.area&&d())}),[o,e,s,t,d])}},560801:(e,t,o)=>{o.d(t,{Z:()=>n});class n extends(()=>o(263184))().default{getInitialState(){return{isOpen:!1}}}},367933:(e,t,o)=>{o.d(t,{Z:()=>n});class n extends(()=>o(263184))().default{getInitialState(){}}},688745:(e,t,o)=>{o.d(t,{D5:()=>b,Ym:()=>x,cP:()=>I});o(821057),o(267602),o(916054),o(653476),o(241792),o(667294);var n=()=>o(146947),r=()=>o(780741),i=()=>o(481529),l=()=>o(494616),a=()=>o(396136),s=()=>o(752778),d=()=>o(139978),c=()=>o(483791),u=()=>o(212360),p=()=>o(788860),m=()=>o(513670),f=()=>o(696459),C=()=>o(250303),S=()=>o(984871),y=()=>o(308186),v=()=>o(269299),g=()=>o(90065),h=()=>o(826955),_=()=>o(382474),w=o(785893);function I(e){let{transaction:t,collectionStore:o,templateId:n,instance:r,logger:p}=e;p.debug(`Creating/updating ${u().qB} record for "${n}".`);const m=o.getSpaceId(),C=r.id;if("automation"===r.type){const e={table:l().cv,id:C,spaceId:m};v().applyOperation({store:h().Mz.createChildStore(o,e),operation:i().op.set({pointer:e,path:["properties","workflow_template_instance"],args:{template_id:n}}),transaction:t})}else if("block"===r.type){const e={table:a().iU,id:C,spaceId:m};v().applyOperation({store:h().G.createChildStore(o,e),operation:i().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:n}}),transaction:t})}else if("collection"===r.type){const e={table:s().vF,id:C,spaceId:m};v().applyOperation({store:o,operation:i().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:n}}),transaction:t})}else if("collection_view"===r.type){const e={table:d().np,id:C,spaceId:m};v().applyOperation({store:h().Xr.createChildStore(o,e),operation:i().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:n}}),transaction:t})}else if("layout"===r.type){const e={table:c().Bh,id:C,spaceId:m};v().applyOperation({store:h().xj.createChildStore(o,e),operation:i().op.set({pointer:e,path:["format","workflow_template_instance"],args:{template_id:n}}),transaction:t})}else if("compound"===r.type){if(r.instancePointers.length<2)throw new Error(`Compound template instance ${r.id} must contain 2 or more instances`);const e=r.instancePointers.map((e=>{switch(e.type){case"automation":return{type:"automation",id:e.id};case"block":return{type:"block",id:e.id};case"collection_view":return{type:"collection_view",id:e.id};case"layout":return{type:"layout",id:e.id};case"property":return{type:"property",id:e.id}}(0,f().t1)(e)}));v().applyOperation({store:o,operation:{command:"keyedObjectListUpdate",pointer:o.pointer,path:["format","compound_workflow_template_instances"],args:{value:{template_id:n,id:r.id,instance_pointers:e}}},transaction:t})}else"property"===r.type?v().applyOperation({store:o,operation:i().op.update({pointer:o.pointer,path:["schema",r.id],args:{workflow_template_instance:{template_id:n}}}),transaction:t}):(0,f().t1)(r)}function x(e){let{environment:t,collectionStore:o,propertyId:n,compoundTemplateInstancesToDelete:i,collectionContextStore:l,from:a}=e;if(!i.every((e=>e.templateId===r()._5)))return!1;if(!(0,g().h$)())return!1;const s=(0,_().OA)({environment:t,collectionStore:o,compoundTemplateInstancesToDelete:i}),d=m().jj(s.filter((e=>"property"===e.type&&e.id!==n)).map((e=>e.id)));return L({environment:t,collectionStore:o,clickedPropertyId:n,otherPropertyIds:d,collectionContextStore:l,from:a}),!0}function b(e){let{environment:t,collectionStore:o,propertyId:n,collectionContextStore:r,from:i}=e;const l=o.getSchema(),a=Object.keys(l).filter((e=>e!==n&&((0,g().TJ)({collectionStore:o,propertyId:e})||(0,g().e_)(e))));return L({environment:t,collectionStore:o,clickedPropertyId:n,otherPropertyIds:a,collectionContextStore:r,from:i}),!0}function L(e){var t;let{environment:o,collectionStore:r,clickedPropertyId:i,otherPropertyIds:l,collectionContextStore:a,from:s}=e;const d=[i,...l],c=[{label:(0,w.jsx)(p()._H,{id:"workflowTemplateInstanceActions.deleteRequiredProperty.deleteOption",defaultMessage:"{count, plural, one {Delete {count} property} other {Delete {count} properties}}",values:{count:d.length}}),color:"red",onAccept:()=>function(e){let{environment:t,collectionStore:o,collectionContextStore:n,propertyIds:r,from:i}=e;v().createAndCommit({userAction:"workflowTemplateInstanceActions.handleDeleteAccept",environment:t,canUndo:!0,perform:e=>{const l=o.getSchema();for(const a of r){S().E2({environment:t,collectionStore:o,schema:l,property:a,transaction:e});const r=l[a];r&&C().y9({environment:t,collectionContextStore:n,property_type:r.type,from:i,property:a})}}})}({environment:o,collectionStore:r,collectionContextStore:a,propertyIds:d,from:s})}],u=r.getSchema(),m=l.map((e=>{if(e===i)return;const t=u[e];return null==t?void 0:t.name})).filter(f().$K),g=null===(t=u[i])||void 0===t?void 0:t.name,h=new Intl.ListFormat(n().locale,{style:"long",type:"conjunction"}),_=(0,w.jsx)(p()._H,{id:"workflowTemplateInstanceActions.deleteRequiredProperty.deletePropertyFromDb",defaultMessage:"{hasPropertyName, select, true {Delete {propertyName} from this database? This will also delete the following properties: {otherPropertyNames}} other {Delete this property from this database? This will also delete the following properties: {otherPropertyNames}}}",values:{hasPropertyName:Boolean(g),propertyName:g,otherPropertyNames:h.format(m)}});y().vC({message:(0,w.jsx)("span",{children:_}),showCancel:!0,keepFocus:!0,innerStyle:{width:400},items:c})}},994085:(e,t,o)=>{o.d(t,{m:()=>s});o(492176),o(7961),o(398858),o(461318),o(33228);const n="://",r="www.",i=/.+\..+\..+/,l=/\.{2,}/,a=/.+\..+/;function s(e){const t=e.trim();if(0===t.length)return!1;if(-1===t.indexOf(".")&&-1===t.indexOf("localhost"))return!1;if("."===t.at(t.length-1)||-1!==t.indexOf(" "))return!1;let o,s=`${-1===t.indexOf(n)?"http://":""}${t}`;try{o=new URL(s)}catch(c){const e=-1===s.indexOf(r),[t,i]=s.split(n);s=`${t}${n}${e?"www.":""}${i}`;try{o=new URL(s)}catch(c){return!1}}const d=o.hostname;return!l.test(d)&&(!(t.includes(r)&&"localhost"!==d&&!i.test(d))&&!("localhost"!==d&&!a.test(d)))}}}]);