"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[79308],{998621:(e,t,r)=>{r.r(t),r.d(t,{CollectionChartView:()=>ke});var o=r(667294),i=()=>r(219727),a=()=>r(142735),n=()=>r(970977),l=()=>r(998411),s=()=>r(186923),u=()=>r(205951),d=()=>r(628370),c=()=>r(55406);var p=()=>r(629352),g=(r(670560),()=>r(790300)),m=()=>r(455947),h=()=>r(576868),y=()=>r(263483);var v=()=>r(347577),f=()=>r(163085),x=()=>r(876822),C=()=>r(307369),S=()=>r(673507),b=()=>r(965105),V=()=>r(120793),w=()=>r(145112),R=()=>r(696459),_=()=>r(455876),M=()=>r(132258),T=()=>r(834458),D=()=>r(608352),P=()=>r(532850),k=()=>r(788860),B=()=>r(691594),L=()=>r(594546),K=()=>r(861026),F=()=>r(846550),A=()=>r(661727),O=()=>r(653457),z=()=>r(998901),j=()=>r(1910),E=()=>r(654133),G=r(785893);function H(e){let{message:t,tooltipMessage:r,tooltipAriaLabel:o}=e;const i=(0,F().yK)((e=>({container:{padding:"8px 4px 8px 14px",borderRadius:20,backgroundColor:"light"===e.mode?(0,A().Fq)(e.accentColors.gray[100],.3):"rgba(255, 255, 255, 0.05)",width:"max-content",margin:"0 auto",marginBottom:20},text:{fontSize:12,textAlign:"center",color:e.mediumTextColor},iconStyle:{width:14,height:14,fill:e.mediumTextColor,position:"absolute",bottom:-2},iconContainer:{position:"relative",height:14,width:30}})),[]);return(0,G.jsx)("div",{style:i.container,children:(0,G.jsxs)("div",{style:i.text,children:[t,(0,G.jsx)(E().Z,{renderTooltip:()=>r,placement:z().Placement.Top,render:e=>(0,G.jsx)(j().Z,{icon:()=>(0,O().m)(i.iconStyle),ariaLabel:o,style:{...i.iconContainer},disableBackground:!0,...e})})]})})}const N=(0,k().vU)({earliestDates:{defaultMessage:"Only showing earliest {limit} {dateGroupByOption}",id:"charts.limitsWarning.earliestDates"},latestDates:{defaultMessage:"Only showing latest {limit} {dateGroupByOption}",id:"charts.limitsWarning.latestDates"},lowestNumbers:{defaultMessage:"Only showing lowest {limit} values",id:"charts.limitsWarning.lowestNumbers"},highestNumbers:{defaultMessage:"Only showing highest {limit} values",id:"charts.limitsWarning.highestNumbers"},genericLimit:{defaultMessage:"Only showing {limit} options in {propertyName}",id:"charts.limitsWarning.genericLimit"}}),$=(0,k().vU)({addFilters:{defaultMessage:"Add filters to reduce the data range.",id:"charts.limitsWarning.tooltip.addFilters"}}),q=(0,k().vU)({column:{defaultMessage:"Max {limit} bars can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.columnChart"},bar:{defaultMessage:"Max {limit} bars can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.barChart"},line:{defaultMessage:"Max {limit} data points can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.lineChart"},donut:{defaultMessage:"Max {limit} slices can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.donutChart"},subGroups:{defaultMessage:"Max {limit} groups can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.subGroups"}});function Z(e,t,r){const o=null==e?void 0:e.type;if((0,D().ib)(t)&&"relative"===t.groupBy)return N.genericLimit;if("ascending"===r.type)switch(o){case"formula":switch((0,T().getFormulaPropertySchemaResultType)(e)){case"date":return N.earliestDates;case"number":return N.lowestNumbers;default:return N.genericLimit}case"date":case"created_time":case"last_edited_time":case"last_visited_time":return N.earliestDates;case"number":return N.lowestNumbers;default:return N.genericLimit}else{if("descending"!==r.type)return N.genericLimit;switch(o){case"formula":switch((0,T().getFormulaPropertySchemaResultType)(e)){case"date":return N.latestDates;case"number":return N.highestNumbers;default:return N.genericLimit}case"date":case"created_time":case"last_edited_time":case"last_visited_time":return N.latestDates;case"number":return N.highestNumbers;default:return N.genericLimit}}}function I(e){let{chartConfig:t,chartLimit:r,collectionContextStore:o}=e;const{limitType:i,limit:n}=r,l=(0,k().YB)(),s=(0,a().Kw)(o.normalizedSchemaStore);if("results"===i&&"results_reducer"===t.dataConfig.type){const e=(0,P().Qm)({schema:s,property:t.dataConfig.nameProperty});return e?(0,G.jsx)(k()._H,{...N.genericLimit,values:{limit:n,propertyName:e.name}}):null}if("groups"===i&&"groups_reducer"===t.dataConfig.type){const e=t.dataConfig.groupBy,r=(0,D().mu)(e),o=(0,P().Qm)({schema:s,property:e.property});if(!o)return null;const i=Z(o,e,r);return(0,G.jsx)(k()._H,{...i,values:{limit:n,dateGroupByOption:(0,D().ib)(e)?l.formatMessage(B().HE[e.groupBy]).toLocaleLowerCase():void 0,propertyName:o.name}})}if("subGroups"===i&&"groups_reducer"===t.dataConfig.type&&(0,g().u)(t)&&t.dataConfig.aggregationConfig.stackOptions){const e=t.dataConfig.aggregationConfig.stackOptions.groupBy,r=(0,D().mu)(e),o=(0,P().Qm)({schema:s,property:e.property});if(!o)return null;const i=Z(o,e,r);return(0,G.jsx)(k()._H,{...i,values:{limit:n,dateGroupByOption:(0,D().ib)(e)?e.groupBy:void 0,propertyName:o.name}})}return null}function W(e){let{chartConfig:t,chartReducerResults:r,loadingProps:n,collectionContextStore:l}=e;const s=(0,k().YB)(),u=function(e){let{chartConfig:t,chartReducerResults:r,collectionContextStore:n}=e;const l=(0,i().O7)(),s=(0,a().VK)((()=>(0,y().WT)()),[]),u=(0,a().VK)((()=>(0,y().Zl)()),[]),d=(0,a().VK)((()=>(0,y().K9)()),[]),c=(0,a().VK)((()=>(0,K().Pn)(n)),[n]),p=o.useMemo((()=>{let e;return"results_reducer"===t.dataConfig.type&&"results"===(null==r?void 0:r.type)&&r.blockIds.length>=u?e={limitType:"results",limit:u}:"groups_reducer"===t.dataConfig.type&&"groups"===(null==r?void 0:r.type)&&r.results.length>=s?e={limitType:"groups",limit:s}:"groups_reducer"===t.dataConfig.type&&"groups"===(null==r?void 0:r.type)&&r.subGroupResults&&r.subGroupResults.length>=d&&(e={limitType:"subGroups",limit:d}),e}),[t.dataConfig.type,r,s,u,d]);return o.useEffect((()=>{(0,L().j)({environment:l,event:{eventName:"charts_data_length",eventProperties:{chart_group_length:"groups"===(null==r?void 0:r.type)?r.results.length:void 0,chart_results_length:"results"===(null==r?void 0:r.type)?r.blockIds.length:void 0,chart_sub_group_length:"groups"===(null==r?void 0:r.type)&&r.subGroupResults?r.subGroupResults.length:void 0,chart_data_limit:p,...c}}})}),[p,r,c,l]),p}({chartConfig:t,chartReducerResults:r,collectionContextStore:l});if(void 0===u||n.isInitialLoading||n.isThrottledLoading)return null;const{limitType:d,limit:c}=u;return(0,G.jsx)(H,{message:(0,G.jsx)(I,{chartConfig:t,collectionContextStore:l,chartLimit:u}),tooltipMessage:(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("div",{children:(0,G.jsx)(k()._H,{..."subGroups"===d?q.subGroups:q[t.type],values:{limit:c}})}),(0,G.jsx)("div",{children:(0,G.jsx)(k()._H,{...$.addFilters})})]}),tooltipAriaLabel:s.formatMessage("subGroups"===d?q.subGroups:q[t.type],{limit:c})})}r(267602),r(653476),r(241792),r(228244);var Y=()=>r(332143),Q=()=>r(56718),U=()=>r(677559);const X=new(U().Ss)("CollectionChartView",(async()=>await Promise.all([r.e(94556),r.e(78701),r.e(38804),r.e(27856),r.e(62789),r.e(92341),r.e(38632),r.e(48005),r.e(79308)]).then(r.bind(r,358281)))),J=(0,U().kF)(X,(e=>e.AxisChart));var ee=()=>r(559729),te=()=>r(270315),re=()=>r(615719),oe=(r(470928),()=>r(717245)),ie=()=>r(342792);function ae(e){const{chartConfig:t,dataPoint:r,format:o}=e;if(!t||"placeholder"===t.type||"results_reducer"===t.dataConfig.type||!t.dataConfig.groupBy||!r)return{};const i=t.dataConfig.groupBy.property,a=ne({groupByFormat:t.dataConfig.groupBy,dataPoint:r}),n={table_properties:[{property:"title",visible:!0,width:276},{property:i,visible:!0}]};return(null!=o&&o.property_filters||a)&&(n.property_filters=[...(null==o?void 0:o.property_filters)??[],...a?[a]:[]]),"groups_reducer"===t.dataConfig.type&&(0,g().u)(t)&&t.dataConfig.aggregationConfig.stackOptions&&(n.collection_group_by=function(e){var t;if(null===(t=e.aggregationConfig)||void 0===t||!t.stackOptions)return;return e.aggregationConfig.stackOptions.groupBy}(t.dataConfig)),n}function ne(e){const{groupByFormat:t,dataPoint:r}=e;if(r.isUncategorized&&"checkbox"!==t.type)return{filter:{filter:{operator:"is_empty"},property:t.property},id:(0,ie().ZP)()};if((0,D().aB)(t))return{filter:{filter:{operator:"string_is",value:{type:"exact",value:r.name}},property:t.property},id:(0,ie().ZP)()};if("checkbox"===t.type)return{filter:{filter:{operator:"checkbox_is",value:{type:"exact",value:!Boolean(r.isUncategorized)}},property:t.property},id:(0,ie().ZP)()};if("number"===t.type){let e;if(r.numberValue?e=r.numberValue:r.x&&(e=r.x),!e)return;return{filter:{filter:{operator:"number_equals",value:{type:"exact",value:e}},property:t.property},id:(0,ie().ZP)()}}if((0,D().TD)(t))return{filter:{filter:{operator:"status_is",value:{type:"group"===t.groupBy?"is_group":"is_option",value:r.name}},property:t.property},id:(0,ie().ZP)()};if("select"===t.type)return{filter:{filter:{operator:"enum_is",value:{type:"exact",value:r.name}},property:t.property},id:(0,ie().ZP)()};if("multi_select"===t.type)return{filter:{filter:{operator:"enum_contains",value:{type:"exact",value:r.name}},property:t.property},id:(0,ie().ZP)()};if((0,D().S1)(t)){const e=r.actorPointer;if(!e)return;return{filter:{filter:{operator:"person_contains",value:{type:"exact",value:e}},property:t.property},id:(0,ie().ZP)()}}if((0,D().ib)(t)){if(!r.dateValue)return;switch(r.dateValue.type){case"today":case"yesterday":case"tomorrow":case"last_7_days":case"next_7_days":case"last_30_days":case"next_30_days":return;case"day":return{filter:{filter:{operator:"date_is",value:{type:"exact",value:{type:"date",start_date:r.dateValue.range.start_date}}},property:t.property},id:(0,ie().ZP)()};case"week":case"month":case"year":return{filter:{filter:{operator:"date_is_within",value:{type:"exact",value:{type:"daterange",start_date:r.dateValue.range.start_date,end_date:r.dateValue.range.end_date}}},property:t.property},id:(0,ie().ZP)()};default:(0,R().t1)(r.dateValue)}}else{if((0,D().zb)(t.type))return r.relationId?{filter:{filter:{operator:"relation_contains",value:{type:"exact",value:r.relationId}},property:t.property},id:(0,ie().ZP)()}:r.relativeSprintVariable?{filter:{filter:{operator:"relation_contains",value:{type:"relative",value:{type:"builtin",variable:r.relativeSprintVariable}}},property:t.property},id:(0,ie().ZP)()}:void 0;if("formula"===t.type){return ne({groupByFormat:{...t.groupBy,property:t.property},dataPoint:r})}if("location"===t.type)return;(0,R().t1)(t.type)}}function le(e){const{chartConfig:t,collectionViewBlockStore:r,format:i,seriesData:a}=e;return(0,o.useCallback)((e=>{!function(e){const{chartConfig:t,collectionViewBlockStore:r,format:o,seriesData:i,xValue:a}=e;if(!r)return;const n=function(e,t){if(!e||0===e.length)return;return e[0].data.find((e=>e.x===t))}(i,a);if(!n)return;const l=ae({chartConfig:t,format:o,dataPoint:n}),s={type:"table",parent_id:r.id,parent_table:r.table,alive:!0,space_id:r.getSpaceId(),format:{...l,is_unlisted:!0}};oe().M.openAndCreateEphemeralCollectionView({collectionViewValue:s,collectionViewBlockStore:r})}({chartConfig:t,collectionViewBlockStore:r,format:i,seriesData:a,xValue:e})}),[t,r,i,a])}var se=()=>r(422118),ue=(r(731107),()=>r(513670));const de=(0,k().vU)({noData:{defaultMessage:"No data",id:"database.chart.multipleSeriesTooltip.noData"},empty:{defaultMessage:"Empty",id:"database.chart.tooltip.empty"}});function ce(e,t,r){var i;const n=(0,k().YB)(),l=(0,F().yK)((e=>({defaultContainer:{border:`1px solid ${e.accentColors.gray[100]}`,borderRadius:"8px",backgroundColor:e.cardContentBackground,maxHeight:"375px",maxWidth:"300px",width:"max-content",overflow:"hidden",pointerEvents:"auto",boxShadow:"0px 2px 4px rgb(0, 0, 0, 0.1)"},scrollContainer:{overflow:"auto",padding:"15px 15px 10px 15px",maxHeight:"375px"},containerSingleSeries:{padding:"10px 15px 10px 15px"},header:{fontSize:"12px",paddingBottom:"7px",color:e.regularTextColor,overflowX:"hidden",whiteSpace:"normal",display:"block"},row:{fontSize:"12px",lineHeight:"18px",textAlign:"left",display:"flex",justifyContent:"space-between",gap:"16px"},square:{height:"7px",width:"7px",minWidth:"7px",borderRadius:"1px",borderWidth:"0px",marginRight:"6px",marginTop:"6px",verticalAlign:"top",display:"inline-block"},rowLeft:{display:"inline-block",color:e.chartRowLeftColor,overflowX:"hidden",whiteSpace:"normal"},rowLeftContainer:{display:"inline-flex"},rowRight:{color:e.chartRowRightColor},noData:{color:e.chartRowLeftColor}})),[]),s=(0,o.useMemo)((()=>n.formatMessage(de.noData)),[n]),u=o.useCallback((e=>Object.keys(e).reduce(((t,r)=>`${t}${(0,ue().GL)(r)}:${e[r]};`),"")),[]),{rowStyle:d,squareStyle:c,rowLeftStyles:p,rowLeftContainerStyle:m,rowRightStyles:h,headerStyles:y,outsideContainerStyle:v,scrollContainerStyle:f,containerSingleSeriesStyle:x,noDataStyle:C}=(0,o.useMemo)((()=>({outsideContainerStyle:u(l.defaultContainer),scrollContainerStyle:u(l.scrollContainer),containerSingleSeriesStyle:u({...l.defaultContainer,...l.containerSingleSeries}),rowStyle:u(l.row),rowLeftContainerStyle:u(l.rowLeftContainer),squareStyle:u(l.square),rowLeftStyles:u(l.rowLeft),rowRightStyles:u(l.rowRight),headerStyles:u(l.header),noDataStyle:u(l.noData)})),[l,u]),S=(0,o.useMemo)((()=>({useHTML:!0,shadow:!1,borderWidth:0,backgroundColor:void 0,outside:!1,stickOnContact:!0,hideDelay:100})),[]),b=(0,a().VK)((()=>"donut"===(null==e?void 0:e.type)),[null==e?void 0:e.type]),V=(0,a().VK)((()=>{var t;return("bar"===(null==e?void 0:e.type)||"column"===(null==e?void 0:e.type))&&("groups_reducer"===e.dataConfig.type&&(!!e.dataConfig.aggregationConfig.stackOptions&&"percent"===(null===(t=e.chartFormat)||void 0===t?void 0:t.axisGroupStyle)))}),[e]),w=(0,a().VK)((()=>{var r,o;if("precision_from_number_property"===(null==e||null===(r=e.chartFormat)||void 0===r?void 0:r.numberPrecisionOverride)){const r=null==e?void 0:e.dataConfig;if(!r||"results_reducer"!==r.type)return;const o=(0,P().Qm)({schema:t,property:r.valueProperty});return o?(0,se().NX)(o):void 0}return null==e||null===(o=e.chartFormat)||void 0===o?void 0:o.numberPrecisionOverride}),[null==e||null===(i=e.chartFormat)||void 0===i?void 0:i.numberPrecisionOverride,null==e?void 0:e.dataConfig,t]),R=(0,o.useMemo)((()=>({...S,formatter:function(){const r=this.color??this.series.color,{label:o,value:i}=(0,se().Xn)({chartConfig:e,schema:t,highChartsLabel:this.point.name,highChartsValue:this.point.y,isMultiSeries:!1,intl:n,numberPrecisionOverride:w});let a="";b&&this.point.percentage&&(a=` (${(0,se().T3)(this.point.percentage)}%)`);const l=""===o?n.formatMessage(de.empty):o;return`\n\t\t\t\t\t<div style="${x}">\n\t\t\t\t\t\t<div style="${d}">\n\t\t\t\t\t\t\t<div style="${m}"> \n\t\t\t\t\t\t\t\t<div style="${c} background-color: ${r};"></div> \n\t\t\t\t\t\t\t\t<div style="${p}">\n\t\t\t\t\t\t\t\t\t${l}\n\t\t\t\t\t\t\t\t</div> \n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style="${h}">\n\t\t\t\t\t\t\t\t${i}${a}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`}})),[S,e,t,n,w,b,x,d,m,c,p,h]),_=(0,o.useMemo)((()=>({...S,shared:!0,formatter:function(){var r;const o=null===(r=this.points)||void 0===r?void 0:r.filter((e=>!(null==e||!e.y)&&0!==e.y));("line"===this.series.type||"area"===this.series.type||"areaspline"===this.series.type)&&(null==o||o.sort(((e,t)=>((null==t?void 0:t.y)??0)-((null==e?void 0:e.y)??0))));let i=this.point.name;if(e&&(0,g().u)(e)&&"groups_reducer"===e.dataConfig.type){const r=e.dataConfig,o=r.groupBy,a=(0,P().Qm)({schema:t,property:r.groupBy.property});a&&(i=(0,se().hZ)({propertySchema:a,groupByFormat:o,aggregation:e.dataConfig.aggregationConfig.aggregation,highChartsLabel:this.point.name,intl:n}))}return o&&0!==o.length?`\n\t\t\t\t<div style="${v}">\n\t\t\t\t<div style="${f}">\n\t\t\t\t\t<div style="${y}">${i}</div>\n\t\t\t\t\t${o.map((r=>{const o=r.color??r.series.color,{label:i,value:a}=(0,se().Xn)({chartConfig:e,schema:t,highChartsLabel:r.series.name,highChartsValue:r.y??void 0,isMultiSeries:!0,intl:n,numberPrecisionOverride:w});let l="";V&&r.percentage&&(l=` (${(0,se().T3)(r.percentage)}%)`);const s=""===i?n.formatMessage(de.empty):i;return`\n\t\t\t\t\t\t\t<div style="${d}">\n\t\t\t\t\t\t\t\t<div style="${m}">\n\t\t\t\t\t\t\t\t\t<div style="${c} background-color: ${o};"></div> \n\t\t\t\t\t\t\t\t\t\t<div style="${p}">\n\t\t\t\t\t\t\t\t\t\t\t${s}\n\t\t\t\t\t\t\t\t\t\t</div> \n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span style="${h}">\n\t\t\t\t\t\t\t\t\t${a}${l}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`})).join("")}\n\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`:`\n\t\t\t\t\t<div style="${v}">\n\t\t\t\t\t<div style="${f}">\n\t\t\t\t\t\t<div style="${y}">${i}</div>\n\t\t\t\t\t\t<div style="${d} ${C}">\n\t\t\t\t\t\t${s}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t`}})),[S,e,v,f,y,t,n,d,C,s,w,V,m,c,p,h]);return r?1===r.length?R:_:S}const pe=ce;var ge=()=>r(466970);function me(e){let{collectionContextStore:t,groupedChartReducerResults:r,groupedDataConfig:n,chartFormat:l,timezone:s,loadingProps:u,axisType:d}=e;const p=(0,i().O7)(),m=(0,k().YB)(),h=(0,F().Fg)(),v=(0,o.useRef)(!0),f=(0,ge().E)("charts_drilldown"),{chartConfig:x,chartErrorStore:C,collectionViewStore:S,collectionViewBlockStore:b,databaseType:V}=(0,a().VK)((()=>{const e=t.collectionViewStore(),r=null==e?void 0:e.getChartConfig();return{chartConfig:r&&(0,g().u)(r)&&"groups_reducer"===r.dataConfig.type?r:void 0,chartErrorStore:t.chartErrorStore,collectionViewStore:e,collectionViewBlockStore:t.collectionViewBlockStore(),databaseType:t.databaseType}}),[t]),R=(0,a().Kw)(t.normalizedSchemaStore),_=(0,a().Kw)(t.normalizedFormatStore),M=(0,a().VK)((()=>(0,P().Qm)({schema:R,property:n.groupBy.property})),[n.groupBy.property,R]),T=(0,a().VK)((()=>{if(n.aggregationConfig.aggregation.property)return(0,P().Qm)({schema:R,property:n.aggregationConfig.aggregation.property})}),[n.aggregationConfig.aggregation,R]),B=(0,a().VK)((()=>null==l?void 0:l.mainSort),[null==l?void 0:l.mainSort]),L=(0,a().VK)((()=>null==l?void 0:l.axisAvatar),[null==l?void 0:l.axisAvatar]),K=(0,a().VK)((()=>{if("side_by_side"===(null==l?void 0:l.axisGroupStyle))return;if(n.aggregationConfig.stackOptions){if(null!=l&&l.axisGroupStyle)return l.axisGroupStyle;if("line"!==(null==x?void 0:x.type))return w().UJ.normal}}),[null==x?void 0:x.type,null==l?void 0:l.axisGroupStyle,n.aggregationConfig]),A=(0,a().VK)((()=>M?M.name||te().SO[M.type]:""),[M]),O=(0,a().VK)((()=>{const e=n.aggregationConfig;if((0,Y().HK)(e.aggregation)){return(0,c().Hk)({aggregation:e.aggregation,databaseType:V,intl:m})||""}const t=(0,c().Hk)({aggregation:e.aggregation,databaseType:V,intl:m});return T?`${T.name||te().SO[T.type]} (${t})`:""}),[n.aggregationConfig,V,m,T]),z=(0,a().VK)((()=>(0,w().vi)(x)),[x]),j=!!x&&(0,re().bc)(x),E=(null==l?void 0:l.hideLegend)||j,H=(0,a().VK)((()=>{const e=null==l?void 0:l.axisGridLine;return!e||("horizontal"===e||"both"===e)}),[l]),N=(0,a().VK)((()=>{const e=null==l?void 0:l.axisGridLine;return!!e&&("vertical"===e||"both"===e)}),[l]),$=(0,a().VK)((()=>(0,y().WT)()),[]),q=(0,a().VK)((()=>(0,y().K9)()),[]),Z=(0,a().VK)((()=>{if(r&&x)return(0,re().P3)({groupedChartReducerResults:r,chartConfig:x,sortType:"main"})}),[r,x]),I=(0,a().VK)((()=>{if(!(r&&t&&b&&Z))return;const{result:e,xAxisType:o}=function(e){var t;let{collectionContextStore:r,groupedDataConfig:o,groupedChartReducerResults:i,chartFormat:a,timezone:n,theme:l,environment:s,intl:u,getRecordModel:d,renderGroupsFromAggregationArgs:c,groupsLimit:p,subGroupsLimit:g,databaseType:m,schema:h,collectionViewFormat:y}=e;const v=i.aggregationResults;if(!v)return;const f=(0,re().VB)({groupedDataConfig:o,hideEmptyGroups:Boolean(null==a?void 0:a.axisHideEmptyGroups),mainSort:null==a?void 0:a.mainSort});if("v2"===(null==i?void 0:i.version)){var x;const e=i.results.filter((e=>e.visible)).map((e=>({property:o.groupBy.property,value:e.value}))),t=o.aggregationConfig.stackOptions,a=t?null===(x=i.subGroupResults)||void 0===x?void 0:x.filter((e=>e.visible)).map((e=>({property:t.groupBy.property,value:e.value}))):[];return{result:(0,re().FZ)({collectionContextStore:r,groupedDataConfig:o,groupResults:e,subGroupResults:a,aggregationResults:v,xAxisType:f,timezone:n,environment:s,intl:u,theme:l,groupTotals:c.groupTotals}),xAxisType:f}}const C=(0,D().Qq)({schema:h,groupBy:o.groupBy});let S=(0,ee().Cz)({groupBy:o.groupBy,schema:h,formatGroups:y[D().Uh]||[],schemaGroups:C,reducerResults:i.results,getRecordModel:d,relativeVariableResult:r.relativeVariableStore.state,viewAppConfigUri:m,allowedCollectionStores:r.collectionStoresStore.state,renderGroupsFromAggregationArgs:c});S=S.filter((e=>!(0,D().eF)(e))),S=S.slice(0,p);const b=o.aggregationConfig.stackOptions?(0,D().Qq)({schema:h,groupBy:o.aggregationConfig.stackOptions.groupBy}):void 0,V=i.subGroupResults&&null!==(t=o.aggregationConfig.stackOptions)&&void 0!==t&&t.groupBy?(0,ee().Cz)({groupBy:o.aggregationConfig.stackOptions.groupBy,schema:h,formatGroups:y.chart_subgroups||[],schemaGroups:b,reducerResults:i.subGroupResults,getRecordModel:d,relativeVariableResult:r.relativeVariableStore.state,viewAppConfigUri:m,allowedCollectionStores:r.collectionStoresStore.state}).filter((e=>!(0,D().eF)(e))).slice(0,g):void 0,w=(0,re().FZ)({collectionContextStore:r,groupedDataConfig:o,groupResults:S,subGroupResults:V,aggregationResults:v,xAxisType:f,timezone:n,environment:s,intl:u,theme:l,groupTotals:c.groupTotals});return{result:w,xAxisType:f}}({collectionContextStore:t,groupedDataConfig:n,groupedChartReducerResults:r,chartFormat:l,timezone:s,theme:h,environment:p,intl:m,getRecordModel:b.getRecordModel,renderGroupsFromAggregationArgs:Z,groupsLimit:$,subGroupsLimit:q,databaseType:V,schema:R,collectionViewFormat:_})||{};if(!o)return;var i;v.current&&(null===(i=t.databaseItemsVisibleTracker)||void 0===i||i.handleItemsRenderStart(),v.current=!1);const a=r.results.some((e=>(0,Q().z_)(e)?e.visible:e.total>0));return{seriesData:null==e?void 0:e.seriesData,maxValue:(null==e?void 0:e.maxValue)??0,minValue:(null==e?void 0:e.minValue)??0,xAxisType:o,reverseXAxis:(0,re().Iq)({xAxisType:o,mainSort:B}),hasData:a}}),[r,$,q,t,b,n,R,_,V,B,l,s,p,m,h,Z],{useDeepEqual:!0}),W=ce(x,R,null==I?void 0:I.seriesData),U=(0,se().V4)(null==S?void 0:S.getRecordModel,m,L===w().lr.avatar_name),X=(0,o.useMemo)((()=>M&&(0,w().Sw)(M)&&(void 0===L||L===w().lr.avatar||L===w().lr.avatar_name)),[L,M]),oe=(()=>{if(!M)return;if(X)return U;if((0,w().HQ)(M))return(0,se().py)({propertySchema:M,aggregation:n.aggregationConfig.aggregation,intl:m,numberPrecisionOverride:null==l?void 0:l.numberPrecisionOverride});const e="formula"===n.groupBy.type?n.groupBy.groupBy:n.groupBy;return(0,D().ib)(e)&&(0,w().l2)(M)?(0,se().vY)({groupBy:e.groupBy,dateFormat:M.date_format,intl:m}):void 0})(),ie=(()=>{if(T)return(0,w().HQ)(T)?(0,se().py)({propertySchema:T,aggregation:n.aggregationConfig.aggregation,intl:m,numberPrecisionOverride:null==l?void 0:l.numberPrecisionOverride}):void 0})(),ae=(e=>{const t=null===(e=n.aggregationConfig.stackOptions)||void 0===e?void 0:e.groupBy;if(E||!t)return;const r="formula"===t.type?t.groupBy:t,o=t.property,i=(0,P().Qm)({schema:R,property:o});return i&&(0,D().ib)(r)&&(0,w().l2)(i)?e=>(0,se().qQ)({dateString:e,dateFormat:i.date_format,groupBy:r.groupBy,intl:m}):void 0})(),ne=le({chartConfig:x,collectionViewBlockStore:b,format:_,seriesData:(null==I?void 0:I.seriesData)||[]}),ue=(0,a().VK)((()=>!(!T||!I)&&(0,se().ug)({dataYAxisMax:I.maxValue,dataYAxisMin:I.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,propertySchema:T,aggregation:n.aggregationConfig.aggregation})),[I,null==l?void 0:l.yAxisMax,null==l?void 0:l.yAxisMin,n.aggregationConfig.aggregation,T]),de=(0,a().Kw)(t.isInPeekRendererStore);o.useEffect((()=>{var e;if(!S)return;const t=null==r?void 0:r.subGroupResults;if(Boolean(x&&(0,g().u)(x)&&"groups_reducer"===x.dataConfig.type&&(null===(e=x.dataConfig.aggregationConfig.stackOptions)||void 0===e?void 0:e.groupBy))&&t){if(1===t.length&&!t[0].value.value){const e=new Map(C.state);return e.set(S.id,"stackBy_property_no_values"),void C.setState(e)}}const o=new Map(C.state);o.delete(S.id),C.setState(o)}),[x,S,null==r?void 0:r.subGroupResults,C]);const pe=(0,o.useCallback)((()=>{t.onItemMount()}),[t]);return(0,G.jsx)(J,{axisType:d,timezone:s,seriesData:(null==I?void 0:I.seriesData)||[],hasData:Boolean(null==I?void 0:I.hasData),loadingProps:u,xAxisType:null==I?void 0:I.xAxisType,xAxisTitle:A,yAxisTitle:O,axisLabelFormat:null==l?void 0:l.axisLabel,colorTheme:null==l?void 0:l.colorTheme,chartHeight:null==l?void 0:l.height,weightColorValue:null==l?void 0:l.weightColorValue,hideLegend:E,showCaption:null==l?void 0:l.showCaption,caption:null==l?void 0:l.caption,showHorizontalGridLines:H,showVerticalGridLines:N,dataLabelsEnabled:z,columnStacking:K,axisHideEmptyGroups:null==l?void 0:l.axisHideEmptyGroups,tooltipOptions:W,sortReversed:null==I?void 0:I.reverseXAxis,xLabelFormatter:oe,disableXAxisAutoRotation:X,yLabelFormatter:ie,dataLabelFormatter:ie,stackLabelFormatter:ie,legendLabelFormatter:ae,yAxisAllowDecimals:ue,dataYAxisMax:null==I?void 0:I.maxValue,dataYAxisMin:null==I?void 0:I.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,onLoadEventHandler:pe,isInPeekMode:de,onSeriesClick:f?ne:void 0})}const he=new(U().Ss)("CollectionChartView",(async()=>await Promise.all([r.e(94556),r.e(78701),r.e(38804),r.e(27856),r.e(62789),r.e(92341),r.e(38632),r.e(48005),r.e(79308)]).then(r.bind(r,209269)))),ye=(0,U().kF)(he,(e=>e.DonutChart));var ve=()=>r(582900),fe=()=>r(707513);function xe(e,t){const r=(0,k().YB)(),o=(0,F().yK)((e=>({name:{maxWidth:"250px",...fe().Yu,display:"inline-block",verticalAlign:"middle"},value:{display:"inline-block",verticalAlign:"middle",marginLeft:5}})),[]),i=(0,a().VK)((()=>null==e?void 0:e.chartFormat),[e]);if((null==i?void 0:i.donutDataLabels)!==w().gg.none)return function(){const{label:a,value:n}=(0,se().Xn)({chartConfig:e,schema:t,highChartsLabel:this.point.name,highChartsValue:this.point.y,isMultiSeries:!1,intl:r,numberPrecisionOverride:void 0});let l="";return this.point.percentage&&(l=` (${(0,se().T3)(this.point.percentage)}%)`),(null==i?void 0:i.donutDataLabels)===w().gg.value?`${n}${l}`:(null==i?void 0:i.donutDataLabels)===w().gg.name?ve().Z.renderToStaticMarkup((0,G.jsx)("div",{style:o.name,children:a})):(null==i?void 0:i.donutDataLabels)===w().gg.name_and_value?ve().Z.renderToStaticMarkup((0,G.jsxs)("div",{children:[(0,G.jsx)("div",{style:o.name,children:a}),(0,G.jsx)("div",{style:o.value,children:`${n}${l}`})]})):void 0}}var Ce=()=>r(114079),Se=()=>r(527278);const be=(0,k().vU)({total:{id:"charts.donut.aggregationValue.total",defaultMessage:"Total"},totalPropertyName:{id:"charts.donut.aggregationValue.totalPropertyName",defaultMessage:"Total {propertyName}"},averagePropertyName:{id:"charts.donut.aggregationValue.averagePropertyName",defaultMessage:"Average {propertyName}"},minPropertyName:{id:"charts.donut.aggregationValue.minPropertyName",defaultMessage:"Min {propertyName}"},maxPropertyName:{id:"charts.donut.aggregationValue.maxPropertyName",defaultMessage:"Max {propertyName}"},medianPropertyName:{id:"charts.donut.aggregationValue.medianPropertyName",defaultMessage:"Median {propertyName}"},uniquePropertyName:{id:"charts.donut.aggregationValue.uniquePropertyName",defaultMessage:"Distinct {propertyName}"}});function Ve(e,t,r,i){const a=(0,k().YB)();return(0,o.useMemo)((()=>{if(!e||!r)return;const o=e.aggregationResult,n=(0,P().Qm)({schema:i,property:r});if(!o||"number"!==o.type||!n)return;let l;const s=o.value?(0,se().dt)(o.value,2):void 0;if((0,w().HQ)(n)&&"count"!==t&&"unique"!==t){const e=(0,se().ff)(n)??"number";l=(0,Ce().uf)(s,e,a,"compact")}else l=(0,Ce().uf)(s,"number",a,"compact");let u;const d=n.name;switch(t){case"sum":u=Se().Z.formatMessage(be.totalPropertyName,{propertyName:d});break;case"average":u=Se().Z.formatMessage(be.averagePropertyName,{propertyName:d});break;case"min":u=Se().Z.formatMessage(be.minPropertyName,{propertyName:d});break;case"max":u=Se().Z.formatMessage(be.maxPropertyName,{propertyName:d});break;case"median":u=Se().Z.formatMessage(be.medianPropertyName,{propertyName:d});break;case"unique":u=Se().Z.formatMessage(be.uniquePropertyName,{propertyName:d});break;default:u=Se().Z.formatMessage(be.total)}return{title:l,subtitle:u}}),[e,t,a,r,i])}function we(e){let{collectionContextStore:t,groupedChartReducerResults:r,aggregationChartReducerResults:n,groupedDataConfig:l,chartFormat:s,timezone:u,loadingProps:d}=e;const c=(0,i().O7)(),p=(0,k().YB)(),g=(0,F().Fg)(),m=(0,o.useRef)(!0),h=(0,ge().E)("charts_drilldown"),{collectionViewBlockStore:v,databaseType:f,schema:x,chartConfig:C}=(0,a().VK)((()=>{var e;const r=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getChartConfig();return{collectionViewBlockStore:t.collectionViewBlockStore(),databaseType:t.databaseType,schema:t.normalizedSchemaStore.state,chartConfig:r&&"donut"===r.type&&"groups_reducer"===r.dataConfig.type?r:void 0}}),[t]),S=(0,a().VK)((()=>(0,D().Qq)({schema:x,groupBy:l.groupBy})),[l,x]),b=(0,a().Kw)(t.normalizedFormatStore),V=(0,a().VK)((()=>(0,y().WT)()),[]),R=(0,a().VK)((()=>{if(r&&C)return(0,re().P3)({groupedChartReducerResults:r,chartConfig:C,sortType:"main"})}),[r,C]),_=(0,a().VK)((()=>{const e=null==r?void 0:r.aggregationResults;if(!v||!R||!e)return;if("v2"===(null==r?void 0:r.version)){const i=r.results.filter((e=>e.visible)).map((e=>({property:l.groupBy.property,value:e.value}))),a=(0,re().yd)({collectionContextStore:t,groupedDataConfig:l,groupResults:i,aggregationResults:e,timezone:u,environment:c,intl:p,theme:g,groupTotals:R.groupTotals});var o;if(m.current)null===(o=t.databaseItemsVisibleTracker)||void 0===o||o.handleItemsRenderStart(),m.current=!1;return a}let i=(0,ee().Cz)({groupBy:l.groupBy,schema:x,formatGroups:b[D().Uh]||[],schemaGroups:S,reducerResults:r.results,getRecordModel:v.getRecordModel,relativeVariableResult:t.relativeVariableStore.state,viewAppConfigUri:f,allowedCollectionStores:t.collectionStoresStore.state,renderGroupsFromAggregationArgs:R});i=i.filter((e=>!(0,D().eF)(e))),i=i.slice(0,V);const a=(0,re().yd)({collectionContextStore:t,groupedDataConfig:l,groupResults:i,aggregationResults:e,timezone:u,environment:c,intl:p,theme:g,groupTotals:R.groupTotals});var n;m.current&&(null===(n=t.databaseItemsVisibleTracker)||void 0===n||n.handleItemsRenderStart(),m.current=!1);return a}),[r,l,u,c,p,t,g,v,f,x,S,V,b,R],{useDeepEqual:!0}),M=(0,a().VK)((()=>!(null!=s&&s.donutHideValue)),[null==s?void 0:s.donutHideValue]),T=(0,a().VK)((()=>"count"===l.aggregationConfig.aggregation.aggregator?l.groupBy.property:l.aggregationConfig.aggregation.property),[l]),B=Ve(n,l.aggregationConfig.aggregation.aggregator,T,x),L=(0,a().VK)((()=>null==s?void 0:s.valueLabel),[null==s?void 0:s.valueLabel])||(null==B?void 0:B.subtitle),K=pe(C,x,_),A=(()=>{const e="formula"===l.groupBy.type?l.groupBy.groupBy:l.groupBy,t=(0,P().Qm)({schema:x,property:l.groupBy.property});if(t)return(0,D().ib)(e)&&(0,w().l2)(t)?r=>(0,se().qQ)({dateString:r.toString(),dateFormat:t.date_format,groupBy:e.groupBy,intl:p}):void 0})(),O=xe(C,x),z=le({chartConfig:C,collectionViewBlockStore:v,format:b,seriesData:_}),j=(0,o.useCallback)((()=>{t.onItemMount()}),[t]),E=(0,a().Kw)(t.isInPeekRendererStore);return(0,G.jsx)(ye,{timezone:u,seriesData:_||[],title:M?null==B?void 0:B.title:void 0,subtitle:M?L:void 0,loadingProps:d,colorTheme:null==s?void 0:s.colorTheme,chartHeight:null==s?void 0:s.height,weightColorValue:null==s?void 0:s.weightColorValue,hideLegend:null==s?void 0:s.hideLegend,showCaption:null==s?void 0:s.showCaption,caption:null==s?void 0:s.caption,tooltipOptions:K,legendLabelFormatter:A,onLoadEventHandler:j,dataLabelsFormatter:O,isInPeekMode:E,onSeriesClick:h?z:void 0})}function Re(e){let{collectionContextStore:t,resultsChartReducerResults:r,resultsDataConfig:n,chartFormat:l,timezone:s,loadingProps:u,axisType:d}=e;const c=(0,i().O7)(),p=(0,k().YB)(),m=(0,F().Fg)(),h=(0,o.useRef)(!0),{chartConfig:y,collectionViewBlockStore:v,collectionViewStore:f}=(0,a().VK)((()=>{const e=t.collectionViewStore(),r=null==e?void 0:e.getChartConfig();return{chartConfig:r&&(0,g().u)(r)&&"results_reducer"===r.dataConfig.type?r:void 0,collectionViewBlockStore:t.collectionViewBlockStore(),collectionViewStore:e}}),[t]),x=(0,a().Kw)(t.normalizedSchemaStore),C=null==l?void 0:l.mainSort,S=(0,a().VK)((()=>{const e=n.nameProperty,t=x[e];return t?t.name||te().SO[t.type]:""}),[n.nameProperty,x]),b=(0,a().VK)((()=>{const e=x[n.valueProperty];return e?`${e.name||te().SO[e.type]}`:""}),[n,x]),V=!!y&&(0,re().bc)(y),R=(null==l?void 0:l.hideLegend)||V,_=(0,a().VK)((()=>{const e=null==l?void 0:l.axisGridLine;return!e||("horizontal"===e||"both"===e)}),[l]),M=(0,a().VK)((()=>{const e=null==l?void 0:l.axisGridLine;return!!e&&("vertical"===e||"both"===e)}),[l]),T=(0,a().VK)((()=>{if(!n||!t||!v)return;const e="category",o=(0,re().C6)({collectionContextStore:t,resultsDataConfig:n,resultsChartReducerResults:r,chartType:"axis",xAxisType:e,timezone:s,environment:c,intl:p,theme:m});var i;h.current&&(null===(i=t.databaseItemsVisibleTracker)||void 0===i||i.handleItemsRenderStart(),h.current=!1);const a=r&&r.blockIds.length>0;return{seriesData:null==o?void 0:o.seriesData,maxValue:(null==o?void 0:o.maxValue)??0,minValue:(null==o?void 0:o.minValue)??0,xAxisType:e,reverseXAxis:(0,re().Iq)({xAxisType:e,mainSort:C}),hasData:a}}),[n,t,v,r,s,c,p,m,C],{useDeepEqual:!0}),D=(0,a().VK)((()=>(0,w().vi)(y)),[y]),B=(0,a().VK)((()=>(0,P().Qm)({schema:x,property:n.nameProperty})),[n.nameProperty,x]),L=(0,a().VK)((()=>(0,P().Qm)({schema:x,property:n.valueProperty})),[n.valueProperty,x]),K=(0,se().Bv)(null==f?void 0:f.getRecordModel,p,s),A=(()=>{if(B)return"title"===B.type?K:void 0})(),O=L?(0,se().py)({propertySchema:L,aggregation:void 0,intl:p,numberPrecisionOverride:null==l?void 0:l.numberPrecisionOverride}):void 0,z=(0,a().VK)((()=>!(!L||!T)&&(0,se().ug)({dataYAxisMax:T.maxValue,dataYAxisMin:T.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,propertySchema:L,aggregation:void 0})),[T,null==l?void 0:l.yAxisMax,null==l?void 0:l.yAxisMin,L]),j=ce(y,x,null==T?void 0:T.seriesData),E=(0,o.useCallback)((()=>{t.onItemMount()}),[t]),H=(0,a().Kw)(t.isInPeekRendererStore);return(0,G.jsx)(J,{axisType:d,timezone:s,seriesData:(null==T?void 0:T.seriesData)||[],hasData:Boolean(null==T?void 0:T.hasData),loadingProps:u,xAxisType:null==T?void 0:T.xAxisType,xAxisTitle:S,yAxisTitle:b,axisLabelFormat:null==l?void 0:l.axisLabel,colorTheme:null==l?void 0:l.colorTheme,chartHeight:null==l?void 0:l.height,weightColorValue:null==l?void 0:l.weightColorValue,hideLegend:R,showCaption:null==l?void 0:l.showCaption,caption:null==l?void 0:l.caption,showHorizontalGridLines:_,showVerticalGridLines:M,dataLabelsEnabled:D,columnStacking:void 0,tooltipOptions:j,sortReversed:null==T?void 0:T.reverseXAxis,xLabelFormatter:A,dataLabelFormatter:O,yLabelFormatter:O,yAxisAllowDecimals:z,dataYAxisMax:null==T?void 0:T.maxValue,dataYAxisMin:null==T?void 0:T.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,onLoadEventHandler:E,isInPeekMode:H})}function _e(e){let{collectionContextStore:t,resultsChartReducerResults:r,aggregationChartReducerResults:n,resultsDataConfig:l,chartFormat:s,timezone:u,loadingProps:d}=e;const c=(0,i().O7)(),p=(0,k().YB)(),g=(0,F().Fg)(),m=(0,o.useRef)(!0),{chartConfig:h,collectionViewBlockStore:y,collectionViewStore:v}=(0,a().VK)((()=>{const e=t.collectionViewStore(),r=null==e?void 0:e.getChartConfig();return{chartConfig:r&&"donut"===r.type&&"results_reducer"===r.dataConfig.type?r:void 0,collectionViewBlockStore:t.collectionViewBlockStore(),collectionViewStore:t.collectionViewStore()}}),[t]),f=(0,a().Kw)(t.normalizedSchemaStore),x=(0,a().VK)((()=>{var e;if(!r||!y)return;const o=(0,re().C6)({collectionContextStore:t,resultsDataConfig:l,resultsChartReducerResults:r,chartType:"donut",xAxisType:void 0,timezone:u,environment:c,intl:p,theme:g});var i;m.current&&(null===(i=t.databaseItemsVisibleTracker)||void 0===i||i.handleItemsRenderStart(),m.current=!1);const a=null==o||null===(e=o.seriesData)||void 0===e?void 0:e[0];return[{...a,data:(null==a?void 0:a.data)||[],type:"pie"}]}),[r,y,t,l,u,c,p,g],{useDeepEqual:!0}),C=(0,a().VK)((()=>{if(l.valueProperty)return l.valueProperty}),[l]),S=(0,a().VK)((()=>!(null!=s&&s.donutHideValue)),[null==s?void 0:s.donutHideValue]),b=Ve(n,"sum",C,f),V=pe(h,f,x),w=(0,o.useCallback)((()=>{t.onItemMount()}),[t]),R=(0,se().Bv)(null==v?void 0:v.getRecordModel,p,u),_=(()=>{if("title"===l.nameProperty)return R})(),M=xe(h,f),T=(0,a().Kw)(t.isInPeekRendererStore);return(0,G.jsx)(ye,{timezone:u,seriesData:x||[],title:S?null==b?void 0:b.title:void 0,subtitle:S?null==b?void 0:b.subtitle:void 0,loadingProps:d,colorTheme:null==s?void 0:s.colorTheme,chartHeight:null==s?void 0:s.height,weightColorValue:null==s?void 0:s.weightColorValue,hideLegend:null==s?void 0:s.hideLegend,showCaption:null==s?void 0:s.showCaption,caption:null==s?void 0:s.caption,tooltipOptions:V,legendLabelFormatter:_,onLoadEventHandler:w,dataLabelsFormatter:M,isInPeekMode:T})}var Me=()=>r(729201);function Te(e){var t;let{collectionContextStore:r,chartConfig:i,timezone:n,reducerRequestType:l,groupedChartReducer:s,aggregationChartReducer:u,resultsChartReducer:d}=e;const{reducer:c,reducerKey:p}=(0,a().VK)((()=>"groups"===l?{reducer:s,reducerKey:V().FW}:"results"===l?{reducer:d,reducerKey:V().OS}:void(0,R().t1)(l)),[s,l,d]),m=(0,a().VK)((()=>(0,M().q)()),[]),h=(0,_().Z)({id:p,reducer:c,collectionContextStore:r,debounceWait:m}),y=(0,a().Kw)(r.isFullScreenStore),v=(0,o.useMemo)((()=>{var e;const t=(null==i||null===(e=i.chartFormat)||void 0===e?void 0:e.height)||w().Dv.medium;return(0,w().Ni)(t)}),[null==i||null===(t=i.chartFormat)||void 0===t?void 0:t.height]),f=(0,a().VK)((()=>{var e;if(void 0!==h)return;const t=r.remoteErrorStore.state;return"msg"!==(null==t?void 0:t.requestSrc)?"RequestTimeoutCancellationError"===(null==t||null===(e=t.errorBody)||void 0===e?void 0:e.name)?"queryCollection_timeout":t?"queryCollection_generic":void 0:void 0}),[r,h]),{loadingProps:x,chartConfigToDisplay:C}=function(e){let{collectionContextStore:t,chartConfig:r,chartReducerResults:i}=e;const n=(0,o.useRef)(void 0),l=(0,o.useRef)(void 0),[s,u]=(0,o.useState)(void 0),d=(0,a().VK)((()=>t.shouldShowSpinnerStore.state),[t],{useDeepEqual:!0}),c=(0,a().VK)((()=>void 0===i||Boolean(t.lastRemoteRequestStore.state&&t.remoteRequestStore.state&&!ue().Xy(t.lastRemoteRequestStore.state.source,t.remoteRequestStore.state.source))),[i,t]),p=(0,a().VK)((()=>t.isFullScreenStore.state),[t]);(0,o.useEffect)((()=>{n.current=r,(t.isClientModeEnabledStore.state||t.isViewSpecificClientModeEnabledStore.state)&&u(r)}),[r,t]),(0,o.useEffect)((()=>{d||(l.current=n.current)}),[d]),(0,o.useEffect)((()=>{l.current=n.current,u(n.current)}),[null==r?void 0:r.type]);const{nameProperty:g,valueProperty:m}=(0,a().VK)((()=>"results_reducer"===(null==r?void 0:r.dataConfig.type)?{nameProperty:r.dataConfig.nameProperty,valueProperty:r.dataConfig.valueProperty}:{}),[null==r?void 0:r.dataConfig]);return(0,o.useEffect)((()=>{l.current=n.current,u(n.current)}),[g,m]),(0,o.useEffect)((()=>{u(d?l.current:n.current)}),[d]),{loadingProps:{isInitialLoading:c,isThrottledLoading:(0,Me().Z)(d,200,0),initialLoadingSvg:(0,o.useCallback)((()=>(0,G.jsx)(b().f,{chartType:null==r?void 0:r.type,showCopy:p})),[null==r?void 0:r.type,p])},chartConfigToDisplay:s}}({collectionContextStore:r,chartConfig:i,chartReducerResults:h});if(f)return(0,G.jsx)(S().Z,{chartError:f,collectionSettingsStore:r.settingsStore,chartType:null==i?void 0:i.type});if(C){if(i&&(0,g().u)(i)&&C&&(0,g().u)(C))return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(W,{loadingProps:x,chartConfig:C,chartReducerResults:h,collectionContextStore:r}),(0,G.jsx)(De,{collectionContextStore:r,chartConfig:i,chartConfigToDisplay:C,chartReducerResults:h,loadingProps:x,timezone:n,chartHeight:v,isFullScreen:y})]});if("donut"===(null==i?void 0:i.type)&&C&&"donut"===C.type)return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(W,{loadingProps:x,chartConfig:C,chartReducerResults:h,collectionContextStore:r}),(0,G.jsx)(Pe,{collectionContextStore:r,chartConfig:i,chartConfigToDisplay:C,chartReducerResults:h,timezone:n,loadingProps:x,aggregationChartReducer:u,chartHeight:v,isFullScreen:y})]})}return(0,G.jsx)("div",{style:{height:v,width:"100%"},children:(0,G.jsx)(b().f,{chartType:null==i?void 0:i.type,showCopy:y})})}function De(e){let{collectionContextStore:t,chartConfig:r,chartConfigToDisplay:o,chartReducerResults:i,timezone:a,loadingProps:n,chartHeight:l,isFullScreen:s}=e;if(r&&(0,g().u)(r)&&o&&(0,g().u)(o)){if("groups_reducer"===o.dataConfig.type&&(void 0===i||"groups"===(null==i?void 0:i.type)))return(0,G.jsx)(me,{loadingProps:n,timezone:a,groupedDataConfig:o.dataConfig,chartFormat:r.chartFormat,collectionContextStore:t,groupedChartReducerResults:i,axisType:r.type});if("results_reducer"===o.dataConfig.type&&(void 0===i||"results"===(null==i?void 0:i.type)))return(0,G.jsx)(Re,{loadingProps:n,timezone:a,resultsDataConfig:o.dataConfig,chartFormat:r.chartFormat,collectionContextStore:t,resultsChartReducerResults:i,axisType:r.type})}return(0,G.jsx)("div",{style:{height:l,width:"100%"},children:(0,G.jsx)(b().f,{chartType:null==r?void 0:r.type,showCopy:s})})}function Pe(e){let{collectionContextStore:t,chartConfig:r,chartConfigToDisplay:o,chartReducerResults:i,timezone:n,loadingProps:l,aggregationChartReducer:s,chartHeight:u,isFullScreen:d}=e;const c=(0,a().VK)((()=>(0,M().q)()),[]),p=(0,_().Z)({id:V().jW,reducer:s,collectionContextStore:t,debounceWait:c});return"groups_reducer"!==o.dataConfig.type||void 0!==i&&"groups"!==(null==i?void 0:i.type)?"results_reducer"!==o.dataConfig.type||void 0!==i&&"results"!==(null==i?void 0:i.type)?(0,G.jsx)("div",{style:{height:u,width:"100%"},children:(0,G.jsx)(b().f,{chartType:null==r?void 0:r.type,showCopy:d})}):(0,G.jsx)(_e,{loadingProps:l,timezone:n,resultsDataConfig:o.dataConfig,chartFormat:r.chartFormat,collectionContextStore:t,resultsChartReducerResults:i,aggregationChartReducerResults:p}):(0,G.jsx)(we,{loadingProps:l,timezone:n,groupedDataConfig:o.dataConfig,chartFormat:r.chartFormat,collectionContextStore:t,groupedChartReducerResults:i,aggregationChartReducerResults:p})}function ke(e){const{collectionContextStore:t,isPreviewing:r,paddingLeft:o,paddingRight:V,headingWidth:w=0}=e,R=(0,i().O7)(),_=(0,a().VK)((()=>R.device.isMobile),[R.device]),{collectionViewBlockStore:M,collectionSettingsStore:T,collectionViewStore:D,chartErrorStore:P}=(0,a().VK)((()=>({collectionViewBlockStore:t.collectionViewBlockStore(),collectionSettingsStore:t.settingsStore,collectionViewStore:t.collectionViewStore(),chartErrorStore:t.chartErrorStore})),[t]),k=(0,a().Kw)(t.isFullScreenStore),B=(0,a().Kw)(t.isInHomeWidgetStore),L=(0,a().VK)((()=>!!t.viewsModuleContextStore.getViewModuleType()),[t]),K=(0,a().VK)((()=>M&&f().Z.isBlockInTemplate(M)),[M]),F=(0,a().Kw)(t.normalizedFormatStore),A=(0,a().VK)((()=>F.chart_config),[F]),O=(0,a().VK)((()=>{var e;return(null==D?void 0:D.id)&&(null===(e=t.updateFreeChartsResultStore.state.get(D.id))||void 0===e?void 0:e.isPending)}),[t.updateFreeChartsResultStore,D]),{canViewChart:z,canViewChartError:j}=(0,s().n)({collectionContextStore:t}),E=(0,a().VK)((()=>{const e=(0,n().SO)({chartConfig:A,collectionSchema:t.normalizedSchemaStore.state});if(void 0!==e)return e;const r=D?P.getState().get(D.id):void 0;if(void 0!==r)return r;let o;return K||!j&&z||(o=j??"paywall"),o}),[A,P,t.normalizedSchemaStore,D,z,j,K],{useDeepEqual:!0}),H=(0,a().VK)((()=>"sidebar"===(0,v().F4)(t,_,w)&&T.state.open),[t,T,w,_]),N=(0,a().VK)((()=>{var e;const t=null===(e=x().default.state.currentUserSettingsStore)||void 0===e?void 0:e.getSettings(),r=null==t?void 0:t.time_zone,o=(0,l().r)();return r||o}),[]),$=(0,p().x)({chartConfig:A,chartError:E,collectionContextStore:t}),q=function(e){let{chartConfig:t,chartError:r,collectionContextStore:o}=e;return(0,a().VK)((()=>{var e,o;if((!r||(0,n().se)(r))&&t&&"placeholder"!==t.type)if("groups_reducer"===(null===(e=t.dataConfig)||void 0===e?void 0:e.type)){const e=(0,c().x7)(t);if(e)return{type:"aggregation",aggregation:e}}else if("results_reducer"===(null===(o=t.dataConfig)||void 0===o?void 0:o.type))return{type:"aggregation",aggregation:{aggregator:"sum",property:t.dataConfig.valueProperty}}}),[t,r],{useDeepEqual:!0})}({chartConfig:A,chartError:E,collectionContextStore:t}),Z=function(e){let{chartConfig:t,chartError:r,collectionContextStore:o}=e;const i=(0,a().VK)((()=>{var e;const r=(0,h().RL)({collectionContextStore:o,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}),i=t&&(0,g().u)(t)?null===(e=t.chartFormat)||void 0===e?void 0:e.axisHideEmptyGroups:void 0,a=t&&(0,g().u)(t)&&"results_reducer"===t.dataConfig.type?t.dataConfig.valueProperty:void 0;if(i&&a){const e={property:a,filter:{operator:"is_not_empty"}},t={property:a,filter:{operator:"number_does_not_equal",value:{type:"exact",value:0}}};r.push(e,t)}return(0,m().kk)(r)}),[o,t]),l=(0,a().VK)((()=>(0,y().Zl)()),[]);return(0,a().VK)((()=>{if((!r||(0,n().se)(r))&&t&&"placeholder"!==t.type&&"results_reducer"===t.dataConfig.type)return{type:"results",limit:l,filter:i}}),[r,t,i,l],{useDeepEqual:!0})}({chartConfig:A,chartError:E,collectionContextStore:t}),I=(0,a().VK)((()=>{var e,r;if(A&&"placeholder"!==A.type&&q)return"groups_reducer"===(null==A||null===(e=A.dataConfig)||void 0===e?void 0:e.type)&&$?{reducerRequestType:"groups",groupedChartReducer:$,aggregationChartReducer:q,collectionContextStore:t,chartConfig:A,timezone:N}:"results_reducer"===(null==A||null===(r=A.dataConfig)||void 0===r?void 0:r.type)&&Z?{reducerRequestType:"results",resultsChartReducer:Z,aggregationChartReducer:q,collectionContextStore:t,chartConfig:A,timezone:N}:void 0}),[A,t,$,q,Z,N]);if(!M)return null;let W;return W=E&&!(0,n().se)(E)?"paywall"!==E||!O&&void 0!==z?(0,G.jsx)(S().Z,{chartError:E,collectionSettingsStore:t.settingsStore,chartType:null==A?void 0:A.type}):(0,G.jsx)(b().f,{chartType:null==A?void 0:A.type,showCopy:k}):A&&"placeholder"!==A.type&&I?(0,G.jsx)(Te,{...I}):(0,G.jsx)(S().Z,{chartError:A?"data_model_invalid":"chart_config_not_found",collectionSettingsStore:t.settingsStore,chartType:null==A?void 0:A.type}),(0,G.jsx)("div",{style:{paddingLeft:o,paddingRight:V,paddingTop:15},children:(0,G.jsx)(C().Z,{store:M,shouldShowHalo:!k&&!B,canSelect:!k&&!L,disablePointerEvents:r,analyticsName:"chart",children:(0,G.jsx)(d().Z,{animate:{width:H?`calc(100% - ${u().P4}px)`:"100%"},children:W})})})}},209269:(e,t,r)=>{r.r(t),r.d(t,{DonutChart:()=>v});r(670560),r(267602),r(653476);var o=r(667294),i=()=>r(846550),a=()=>r(145112),n=()=>r(582900),l=()=>r(788860),s=()=>r(513670),u=()=>r(696459),d=()=>r(707513),c=()=>r(265195),p=()=>r(2581),g=()=>r(202638),m=()=>r(812372),h=r(785893);const y=14;function v(e){const t=(0,l().YB)(),r=(0,i().Fg)(),v=e.chartHeight||a().Dv.medium,w=e.seriesData.length>0&&e.seriesData[0].data.length>0,R=o.useMemo((()=>w?e.seriesData:[{name:"No data",data:[]}]),[w,e.seriesData]),_=(0,o.useMemo)((()=>(0,c().zn)(e.colorTheme||"auto",Boolean(e.weightColorValue),r)),[e.colorTheme,e.weightColorValue,r]),M=(0,o.useMemo)((()=>(0,a().Ni)(v)),[v]),T=e.dataLabelsFormatter?.9:1,D=(M-160)*T,P=(0,o.useMemo)((()=>{const o=e.showCaption?(0,p().I)(e.caption):"";return s().TS((0,g().Z)(r),{chart:{type:"pie",height:M,events:{render:function(){const o=this,i=o.container;if(i)if(w){if(e.title){var a;const e=o.title.getBBox();null===(a=o.title)||void 0===a||a.attr({y:y+o.plotTop+(o.plotHeight-e.height)/2})}}else(0,p().E)({intl:t,theme:r,chartType:"donut",container:i,hasData:w,hasBadYAxisRange:!1,isInPeekMode:Boolean(e.isInPeekMode)})},load:e.onLoadEventHandler}},time:{timezone:e.timezone},title:{useHTML:!0,floating:!0,text:void 0},series:R,..._,plotOptions:{pie:{size:D,innerSize:v===a().Dv.small||v===a().Dv.medium?"85%":"90%",showInLegend:!e.hideLegend,color:w?void 0:"transparent",fillColor:w?"transparent":r.tableDividerColor,states:{inactive:{opacity:1}},dataLabels:{enabled:!!e.dataLabelsFormatter,formatter:e.dataLabelsFormatter}},series:{cursor:e.onSeriesClick?"pointer":void 0,point:{events:{click:function(){e.onSeriesClick&&e.onSeriesClick(this.x)}}},marker:{enabled:!1},states:{hover:{halo:null}}}},legend:{enabled:!e.hideLegend,labelFormatter:function(){if(e.legendLabelFormatter){const t=this.index,r=R.length>0?R[0].data[t]:void 0;return e.legendLabelFormatter(this.name,r)}return this.name}},caption:{text:o},tooltip:{...e.tooltipOptions},responsive:{rules:f(D,v)}})}),[e,r,M,R,_,D,v,w,t]),k=(0,i().yK)((e=>({titleStyle:{fontWeight:500,color:e.text.primary,textAlign:"center"},subtitleStyle:{color:e.text.secondary,fontWeight:400,lineHeight:"15px",textAlign:"center",...d().Yu}})),[]),B=o.useCallback(((t,r)=>{const o=r||v,i=function(e,t,r){const o=(e||"").split("").filter((e=>","!==e&&"."!==e)),i=5*o.length;if(t&&x(t,r)){const e=t/5-i;return r===a().Dv.small||r===a().Dv.medium?Math.max(e,C):Math.max(e,S)}if(r===a().Dv.extra_large){const e=108-i;return Math.max(e,V)}if(r===a().Dv.large){const e=84-i;return Math.max(e,b)}if(r===a().Dv.medium){const e=72-i;return Math.max(e,S)}{const e=48-i;return Math.max(e,C)}}(e.title,t,o),l=function(e){if(!e||e===a().Dv.small||e===a().Dv.medium)return 12;if(e===a().Dv.large)return 14;if(e===a().Dv.extra_large)return 16;(0,u().t1)(e)}(o),s=function(e,t){if(e&&x(e,t))return.5*e;return t===a().Dv.extra_large?400:t===a().Dv.large?250:t===a().Dv.medium?150:80}(t,o),d=t??200,c=d<50?"":n().Z.renderToStaticMarkup((0,h.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,h.jsx)("div",{style:{...k.titleStyle,fontSize:i,lineHeight:`${i+13}px`,maxWidth:s},children:e.title}),e.subtitle&&d>=200?(0,h.jsx)("div",{style:{...k.subtitleStyle,fontSize:l,lineHeight:`${l+3}px`,maxWidth:s},children:e.subtitle}):null]}));return{title:{useHTML:!0,floating:!0,text:w?c:""}}}),[v,e.title,e.subtitle,k.titleStyle,k.subtitleStyle,w]);return(0,h.jsx)(m().Z,{loadingProps:e.loadingProps,chartOptions:P,containerHeight:M,getResponsiveChartOptions:B})}function f(e,t){const r=[];return t!==a().Dv.extra_large&&t!==a().Dv.large||r.push({condition:{maxWidth:e},chartOptions:{plotOptions:{pie:{size:void 0}}}}),r.push({condition:{maxWidth:(0,a().Q5)(t)},chartOptions:{plotOptions:{pie:{size:"75%"}}}}),r}function x(e,t){return t===a().Dv.extra_large?e-180<(0,a().Q5)(t):t===a().Dv.large?e-100<(0,a().Q5)(t):e<(0,a().Q5)(t)}const C=8,S=12,b=18,V=24},228772:(e,t,r)=>{r.d(t,{r:()=>a});var o=()=>r(142735),i=()=>r(876822);function a(){return(0,o().VK)((()=>i().default.state.currentSpaceStore),[])}}}]);