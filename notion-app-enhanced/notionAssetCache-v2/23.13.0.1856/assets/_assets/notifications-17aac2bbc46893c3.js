(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[51909],{942834:(e,t,i)=>{"use strict";i.d(t,{k:()=>r});var o=()=>i(431143),a=()=>i(253502),n=()=>i(636340),s=()=>i(269299);function r(e){const{environment:t,key:i,selectedKey:r,following:l,followSettings:d,navigableBlockId:c,userId:u,spaceId:p,from:f}=e;s().createAndCommit({userAction:"UpdateSidebarFollowControl.setFollowing",environment:e.environment,canUndo:!1,perform:t=>{n().Ue({environment:e.environment,table:o().t0,args:{following:l,followSettings:d,navigableBlockId:c,userId:u,spaceId:p},inMemoryRecordCache:e.environment.defaultRecordCache.inMemoryRecordCache,transaction:t})}}),l?a().RJ(t,{from:"page_updates"}):a().ub(t,{from:"page_updates"}),r!==i&&a().kL(t,{from:f,navigableBlockId:c,oldSetting:r,newSetting:i})}},281063:(e,t,i)=>{"use strict";i.d(t,{Z:()=>C});var o=i(667294),a=()=>i(98642),n=()=>i(142735),s=()=>i(846550),r=()=>i(532850),l=()=>i(722917),d=()=>i(788860),c=()=>i(707513),u=()=>i(43360),p=()=>i(18748),f=()=>i(67961),m=()=>i(141735),g=()=>i(718959),h=()=>i(527278),b=()=>i(487073),y=()=>i(876822),v=()=>i(604068),x=()=>i(444851),S=()=>i(19029),M=()=>i(8208),j=()=>i(958783),k=()=>i(472675),N=()=>i(297490),w=()=>i(887328),_=()=>i(654953),T=i(785893);function C(e){const{environment:t,menuListItemProps:i,shouldShowTopDividerLine:C,shouldShowBottomDividerLine:I,shouldExpandDiscussionWidth:R,noBackgroundColors:U,onMouseEnter:A,onMouseLeave:P,onFocus:V,onBlur:B}=e,Z=(0,n().VK)((()=>y().default.state.mainEditorCurrentBlockStore),[]),L=(0,n().VK)((()=>(0,g().B7)(t)),[t]),E=x().IX,K=(0,n().VK)((()=>M().Z.state.isActivelyComposing),[]),H=(0,n().VK)((()=>M().Z.state.isHovered),[]),D=(0,o.useCallback)((()=>{null==A||A()}),[A]),F=(0,o.useCallback)((()=>{null==P||P()}),[P]),O=(0,o.useCallback)((()=>{null==V||V()}),[V]),G=(0,o.useCallback)((()=>{j().default.hasContent()?M().Z.resetAllActiveSources():(j().default.reset(),M().Z.reset()),null==B||B()}),[B]),z=(0,d().YB)(),W=(0,o.useRef)(null);(0,a().c)(b().Z,(()=>({getNode:()=>W.current})),[]);const q=(0,s().yK)((e=>({menuDiscussionItem:{marginLeft:-14,marginRight:-14,width:"calc(100% + 28px)"},discussionContainer:{paddingTop:t.device.isMobile?4:6,borderTop:!t.device.isMobile&&C?`1px solid ${e.regularDividerColor}`:void 0,borderBottom:!t.device.isMobile&&I?`1px solid ${e.regularDividerColor}`:void 0,transition:"background 300ms ease",background:U?void 0:K?e.focusDiscussionBackground:H?e.hoveredDiscussionBackground:void 0},comment:{position:"relative",fontSize:14},commentElementsBelowUserRow:{paddingLeft:x().yx},avatar:{marginTop:0,marginRight:8,userSelect:"none"},userRow:{display:"flex",flexDirection:"row",alignItems:"center",userSelect:"none"},placeholder:{height:8,width:81,borderRadius:6,background:e.lightDividerColor},attachIcon:{width:18,height:18,fill:e.mediumIconColor},text:{cursor:"text",lineHeight:"20px",paddingTop:4},attachmentContainer:{display:"flex",alignItems:"center"},draftLabel:{margin:"0 6px",flexBasis:140,whiteSpace:"normal",flexGrow:void 0,display:"inline",color:e.text.tertiary},commentAuthorPlaceholder:{marginRight:8,marginTop:2,height:E,width:E,borderRadius:20,flexShrink:0},container:{paddingTop:x().En,paddingRight:16,paddingBottom:x().rb,paddingLeft:16},noOverflow:{overflow:"hidden"},commentContext:{display:"flex",width:"100%",marginTop:6,marginBottom:22,fontSize:13,color:e.text.secondary},displayName:{fontWeight:c().Ue.medium,whiteSpace:"normal"},fullWidthFlex:{display:"flex",width:"100%"},smallTopPadding:{marginTop:1}})),[E,t.device.isMobile,H,K,U,I,C]),Y=(0,o.useCallback)((async()=>{const e=await m().F.formulas.load();v().Dc({environment:t,allowActionsWhileCommenting:!0,formulasModule:e})}),[t]),X=(0,n().VK)((()=>!j().default.state.open||"reaction"===j().default.state.content),[]),$=(0,n().VK)((()=>{var e;return j().default.getBlockStore()??(null===(e=j().default.getClosestBlockStore())||void 0===e?void 0:e.parentBlockStore)}),[]),J=(0,n().VK)((()=>j().default.getPropertyId()),[]),Q=(0,n().VK)((()=>{if(J){var e;const t=null===(e=j().default.getBlockStore())||void 0===e?void 0:e.getAssociatedCollectionStore();if(!t||"collection"!==t.table)return;const i=t.getSchema();return(0,r().Qm)({schema:i,property:J})}}),[J]),ee=(0,n().VK)((()=>(0,l().Kc)(h().Z.getIntl()).title),[]),te=(0,n().VK)((()=>j().default.getDiscussionInputStore()),[]),ie=(0,n().VK)((()=>null==L?void 0:L.getDisplayName(z)),[L,z]),oe=(0,n().VK)((()=>null==$?void 0:$.getSpaceId()),[$]),ae=(0,n().VK)((()=>v().Qu({environment:t})),[t]),ne=(0,n().VK)((()=>j().default.getType()),[]),se=(0,n().VK)((()=>null==$?void 0:$.getValue()),[$]);if(X||!ee||!L||!$||!Z||!te||!oe||!se&&"block"===ne||!ae&&"inline"===ne)return null;const re="inline"===ne||J,le="block"===ne&&!J?(0,T.jsx)(u().ZP,{blockValue:se,rootStore:$,blockPreviewLocation:"comments_sidebar"}):re?(0,T.jsx)(u().KX,{value:{value:(null==ae?void 0:ae.context)??[],spaceId:oe},propertySchema:ee,labeled:!1,rootStore:$,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!0}):null;return(0,T.jsx)("div",{style:q.discussionContainer,ref:W,onClick:null==i?void 0:i.onClick,onMouseEnter:D,onMouseLeave:F,children:(0,T.jsx)(p().ZP,{allowTextSelection:!0,style:q.menuDiscussionItem,title:(0,T.jsx)("div",{style:q.container,children:(0,T.jsxs)("div",{style:q.comment,children:[(0,T.jsxs)("div",{style:q.userRow,children:[(0,T.jsx)(k().S,{authorStore:L,avatarSize:E,avatarStyle:q.avatar,placeholderStyle:q.commentAuthorPlaceholder}),(0,T.jsxs)("div",{style:q.noOverflow,children:[(0,T.jsx)("span",{style:q.displayName,children:ie||(0,T.jsx)("span",{style:q.placeholder})}),(0,T.jsx)(f().Z,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:q.draftLabel,children:(0,T.jsx)(d()._H,{defaultMessage:"Draft",id:"DraftCommentInputWithContext.draftLabel"})})]})]}),(0,T.jsxs)("div",{style:q.commentElementsBelowUserRow,children:[(0,T.jsx)("div",{style:q.commentContext,children:(0,T.jsxs)("div",{style:q.fullWidthFlex,children:[(0,T.jsx)(N().C,{}),Q&&(0,T.jsx)(_().Z,{propertySchema:Q}),(0,T.jsx)("div",{style:q.smallTopPadding,children:le})]})}),(0,T.jsx)(w().Z,{showAvatar:!1,parentStore:Z,blockStore:$,onSubmit:Y,discussionInputStore:te,isNewComment:!0,isEditingExistingComment:!1,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,discussionFormat:S().DiscussionFormat.Sidebar,canDrop:!0,disableFocusRing:!0,adjustWidthForDraftDiscussions:R,dontMoveCursorToInputEndOnFocus:!0,onBlur:G,onFocus:O},"draft-comment-sidebar")]})]})})})},"draft-comment-discussion-updates")}},123256:(e,t,i)=>{"use strict";i.d(t,{Z:()=>w});var o=i(667294),a=()=>i(219727),n=()=>i(142735),s=()=>i(846550),r=()=>i(492522),l=()=>i(788860),d=()=>i(696459),c=()=>i(82937),u=()=>i(879952),p=()=>i(942226),f=()=>i(505462),m=()=>i(815532),g=()=>i(123145),h=()=>i(690664),b=()=>i(105649),y=()=>i(793935),v=()=>i(589525),x=()=>i(291335),S=()=>i(590972),M=()=>i(998901),j=()=>i(482162),k=()=>i(64260),N=i(785893);const w=function(e){let{type:t}=e;const s=(0,a().O7)(),l=(0,n().qz)(void 0,i(233417).Z),p=(0,o.useRef)(!1),b=(0,o.useCallback)((()=>function(e,t){t.setState({...t.state,mousePressed:!1}),_({isResizing:!1},e)}(t,l)),[t,l]),k=(0,o.useCallback)((()=>function(e,t,i,o){if(!o.current){switch(t){case"page":y().setExpand({environment:e,isExpanded:!x().sidebarExpandedStore.state,from:"sidebar_resizer",saveDetailsSidebarPreference:!0}),x().sidebarOpenStore.setState(!1);break;case"update":y().setUpdateExpand({environment:e,isExpanded:!(0,v().Sx)(e),from:"drag",saveDetailsSidebarPreference:!0});break;case"peek":c().xv({environment:e,from:"resizer_click"});break;case"secondary_sidebar":m().TN({environment:e});break;default:(0,d().t1)(t)}i.setState({...i.state,mouseEntered:!1})}i.setState({...i.state,mousePressed:!1}),_({isResizing:!1},t)}(s,t,l,p)),[s,t,l]),w=(0,o.useCallback)((e=>function(e,t,i,o){switch(f().clear(t),o.current=!0,i){case"page":y().setWidth({width:T(e.currentX,i,t),environment:t});break;case"update":y().setUpdateWidth({width:T(e.currentX,i,t),environment:t});break;case"peek":y().setPeekWidth({width:T(e.currentX,i,t),environment:t});break;case"secondary_sidebar":h().default.setWidth(T(e.currentX,i,t));break;default:(0,d().t1)(i)}}(e,s,t,p)),[s,t]),R=(0,o.useCallback)((()=>function(e,t,i,o){u().ZH({environment:e}),i.setState({...i.state,mousePressed:!0}),o.current=!1,_({...x().sidebarResizingStore.state,isResizing:!0},t)}(s,t,l,p)),[s,t,l]),{device:U}=s,A=(0,n().VK)((()=>function(e){const t=function(e){switch(e){case"page":return x().sidebarWidthStore.state;case"secondary_sidebar":const t=x().sidebarExpandedStore.state,i=g().l_();return t?x().sidebarWidthStore.state+i:i;case"update":return S().default.state.width;case"peek":return j().default.state.preferredSidePeekWidth;default:(0,d().t1)(e)}}(e);switch(e){case"page":case"secondary_sidebar":return t;case"peek":case"update":return window.innerWidth-t;default:(0,d().t1)(e)}}(t)),[t]),P=(0,n().Kw)(x().sidebarMouseEnterYStore),V=(0,n().Kw)(i(197666).Z),B=(0,n().VK)((()=>function(e){return{cursor:"col-resize",height:"100%",width:12,marginLeft:"update"===e?-S().default.state.width:-6}}(t)),[t]),Z=(0,n().VK)((()=>function(e,t){const i=(0,v().in)(t);return{position:"absolute",left:"peek"===e?0:void 0,right:"peek"!==e?0:void 0,width:0,flexGrow:0,zIndex:"peek"===e?r().YO:1,top:i?0:-1,bottom:i?0:-1,pointerEvents:"auto"}}(t,s)),[t,s]);return V||U.isChromebook?null:(0,N.jsx)(i(654133).Z,{renderTooltip:()=>(0,N.jsx)(C,{type:t}),originRect:new DOMRect(A,P,0,0),delayThreshold:0,placement:"page"===t||"secondary_sidebar"===t?M().Placement.Right:M().Placement.Left,originGap:10,render:e=>(0,N.jsx)("div",{style:Z,...(0,i(164079).Z)(e,{onMouseMove:()=>function(e){_({isResizerHovered:!0},e)}(t),onMouseLeave:()=>function(e){_({isResizerHovered:!1},e)}(t),onMouseEnter:I}),children:(0,N.jsx)(i(790964).Z,{onDraggableDragStart:R,onDraggableDragMove:w,onDraggableDragEnd:k,onDraggableDragCancel:b,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:e=>(0,N.jsx)("div",{style:B,...e})})})})};function _(e,t){switch(t){case"page":x().sidebarResizingStore.update((t=>({...t,...e})));break;case"update":S().default.update((t=>({...t,...e})));break;case"secondary_sidebar":b().default.update((t=>({...t,...e})));break;case"peek":break;default:(0,d().t1)(t)}}function T(e,t,i){let o;switch(t){case"page":o=e;break;case"secondary_sidebar":o=e-(x().sidebarExpandedStore.state?x().sidebarWidthStore.state:0);break;case"peek":case"update":o=window.innerWidth-e;break;default:(0,d().t1)(t)}const a=function(e){const t=window.innerWidth;switch(e){case"page":return 480;case"update":return Math.min(t/2,v().Nc);case"peek":return(0,p().my)();case"secondary_sidebar":return h().o;default:(0,d().t1)(e)}}(t),n=function(e,t){switch(e){case"page":return x().SIDEBAR_MIN_WIDTH;case"update":return S().AO;case"peek":return j().SIDEPEEK_MIN_WIDTH;case"secondary_sidebar":return h().u;default:(0,d().t1)(e)}}(t);return o>a?a:o<n?n:o}function C(e){let{type:t}=e;const i=(0,s().Fg)(),o=(0,a().O7)(),r=(0,n().VK)((()=>function(e,t){switch(e){case"page":return(0,v().in)(t);case"update":return(0,v().Sx)(t);case"peek":return j().default.state.open;case"secondary_sidebar":return b().default.isOpen();default:(0,d().t1)(e)}}(t,o)),[t,o]),c=i.mediumInvertedTextColor,u=(0,N.jsx)(k().Z,{name:"toggleSidebar"}),p="secondary_sidebar"===t||"update"===t?(0,N.jsx)(l()._H,{defaultMessage:"Close <invertedcolor>Click</invertedcolor>",id:"sidebarResizer.tooltip.closeMessage.noShortcut",values:{invertedcolor:e=>(0,N.jsx)("span",{style:{color:c},children:e}),keyboardShortcut:u}}):(0,N.jsx)(l()._H,{defaultMessage:"Close <invertedcolor>Click or {keyboardShortcut}</invertedcolor>",id:"sidebarResizer.tooltip.closeMessage",values:{invertedcolor:e=>(0,N.jsx)("span",{style:{color:c},children:e}),keyboardShortcut:u}});return(0,N.jsxs)(N.Fragment,{children:[r?p:(0,N.jsx)(l()._H,{defaultMessage:"Lock open <invertedcolor>Click or {keyboardShortcut}</invertedcolor>",id:"sidebarResizer.tooltip.lockMessage",values:{invertedcolor:e=>(0,N.jsx)("span",{style:{color:c},children:e}),keyboardShortcut:u}}),(0,N.jsx)("br",{}),(0,N.jsx)(l()._H,{defaultMessage:"Resize <invertedcolor>Drag</invertedcolor>",id:"sidebarResizer.tooltip.resizeMessage",values:{invertedcolor:e=>(0,N.jsx)("span",{style:{color:c},children:e}),keyboardShortcut:u}})]})}function I(e){x().sidebarMouseEnterYStore.setState(e.clientY)}},83340:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PageAnalyticsPageOptOut:()=>y,TopbarPageAnalyticsOptOutMenu:()=>b,TopbarPageAnalyticsOptOutMenuStore:()=>h});i(667294);var o=()=>i(219727),a=()=>i(142735),n=()=>i(788860),s=()=>i(261930),r=()=>i(148126),l=()=>i(998901),d=()=>i(104088),c=()=>i(876822),u=()=>i(78078),p=()=>i(967092),f=()=>i(765513),m=()=>i(579807),g=i(785893);const h=i(263184).default.createValue({isOpen:!1,rect:void 0},{name:"TopbarPageAnalyticsOptOutMenuStore"});function b(){const e=(0,o().O7)(),t=(0,a().VK)((()=>h.state.isOpen),[]),i=(0,a().VK)((()=>h.state.rect),[]),s=(0,a().VK)((()=>c().default.state.mainEditorCurrentBlockStore),[]);return s?(0,g.jsx)(p().ZP,{popupType:e.device.isMobile?d().k.SlideUp:d().k.Popup,alignmentToOrigin:l().Alignment.Center,open:t,render:()=>(0,g.jsx)("div",{style:{minWidth:360,padding:16},children:(0,g.jsxs)(u().sg,{gap:16,children:[(0,g.jsx)("div",{style:{fontSize:16,fontWeight:500},children:(0,g.jsx)(n()._H,{id:"TopbarPageAnalyticsOptOutMenu.heading",defaultMessage:"Privacy settings"})}),(0,g.jsx)(y,{store:s})]})}),originRect:i,onDismiss:()=>h.setState({isOpen:!1,rect:void 0})}):null}function y(e){const t=(0,o().O7)(),i=(0,a().VK)((()=>{const e=c().default.state.currentSpaceViewStore;return null==e?void 0:e.getSettings()}),[]),l=(0,a().VK)((()=>{const t=null==i?void 0:i.page_analytics_opt_out_list;return null==t?void 0:t.includes(e.store.id)}),[i,e.store.id]);return(0,g.jsx)(m().Z,{type:"dropdown",currentOption:l?"do_not_record":"record",options:[{key:"record",label:(0,g.jsx)(n()._H,{id:"page_analytics.opt_out.record",defaultMessage:"Record"})},{key:"do_not_record",label:(0,g.jsx)(n()._H,{id:"page_analytics.opt_out.do_not_record",defaultMessage:"Don't record"})}],onSelectOption:i=>{"do_not_record"===i?s().kY(t,e.store.id):s().pu(t,e.store.id)},isMobile:t.device.isMobile,title:(0,g.jsx)(n()._H,{id:"page_analytics.opt_out.title",defaultMessage:"My view history"}),caption:(0,g.jsx)(n()._H,{id:"page_analytics.opt_out.caption",defaultMessage:"Page editors can see my view history for this page. <inlinelink>Learn more</inlinelink>.",values:{inlinelink:e=>(0,g.jsx)(f().Z,{external:!0,href:(0,r().UY)("guides.pageAnalytics"),children:e})}}),captionStyle:{maxWidth:270}})}},562219:(e,t,i)=>{"use strict";i.d(t,{J:()=>n});var o=()=>i(677559);const a=new(o().Ss)("UpdateSidebarTabInfo",(async()=>await i.e(60895).then(i.bind(i,931656)))),n=(0,o().kF)(a,(e=>e.UpdateSidebarTabInfo))},156216:(e,t,i)=>{"use strict";i.d(t,{PQ:()=>U,ZP:()=>A,b8:()=>I});i(241792);var o=i(667294),a=()=>i(219727),n=()=>i(142735),s=()=>i(846550),r=()=>i(788860),l=()=>i(696459),d=()=>i(603274),c=()=>i(269299),u=()=>i(827973),p=()=>i(448419),f=()=>i(1910),m=()=>i(198829),g=()=>i(255577),h=()=>i(388284),b=()=>i(654133),y=()=>i(67961),v=()=>i(949842),x=()=>i(352230),S=()=>i(453382),M=()=>i(138876),j=()=>i(688026),k=()=>i(733641),N=()=>i(491174),w=()=>i(76225),_=()=>i(326264),T=i(785893);const C=(0,r().vU)({changePageNotificationSettings:{defaultMessage:"Change page notification settings",id:"inboxActionsMenu.notificationSettings.tooltipMessage"},markUnread:{defaultMessage:"Mark this notification as unread",id:"inboxActionsMenu.markNotificationAsUnread.tooltipMessage"},markRead:{defaultMessage:"Mark this notification as read",id:"inboxActionsMenu.markNotificationAsRead.tooltipMessage"},archive:{defaultMessage:"Archive this notification",id:"inboxActionsMenu.handleArchive.tooltipMessage"},unarchive:{defaultMessage:"Unarchive",id:"inboxActionsMenu.handleUnarchive.tooltipMessage"}}),I=96;function R(e){const{notification:t,rootStore:l,onArchiveClicked:u,onUnarchiveClicked:m,onMarkAsReadClicked:g,onMarkAsUnreadClicked:h}=e,y=(0,a().O7)(),x=(0,a().Fy)(),k=(0,r().YB)(),I=(0,o.useContext)(i(880290).B),R=(0,n().VK)((()=>!!t&&(0,i(309672).$2)(t.type)),[t]),A=(0,n().VK)((()=>{const e=null==t?void 0:t.navigable_block_id;if(e)return i(826955).G.createChildStore(l,{table:i(396136).iU,id:e})}),[l,t]),P=(0,n().VK)((()=>null==A?void 0:A.getFollowSettingsKey()),[A]),V=(0,n().VK)((()=>{if(!P)return[];if(!A)return[];return _().Zk({followSettingsKey:P,environment:y,blockStore:A,from:"inbox"})}),[P,y,A]),B=(0,n().VK)((()=>R&&V.length>0),[R,V]),Z=(0,o.useCallback)((e=>{t&&(0,v().ZP)({event:e,context:v().Af.NotificationClick,callback:()=>{u(),c().createAndCommit({userAction:"InboxActionsMenu.handleArchive",environment:y,canUndo:!0,perform:e=>{d().aZ({notification:t,rootStore:l,transaction:e})}})}})}),[y,t,u,l]),L=(0,o.useCallback)((e=>{t&&(0,v().ZP)({event:e,context:v().Af.NotificationClick,callback:()=>{m(),c().createAndCommit({userAction:"Activity.handleUnarchive",environment:y,canUndo:!0,perform:e=>{d().E1({notificationId:t.id,visited:!1,rootStore:l,transaction:e})}})}})}),[y,t,m,l]),E=(0,o.useCallback)((e=>{t&&(0,v().ZP)({event:e,context:v().Af.NotificationClick,callback:()=>{t.read?h():g(),c().createAndCommit({userAction:"InboxActionsMenu.toggleNotificationReadStatus",environment:y,canUndo:!0,perform:e=>{d().$h({notification:t,rootStore:l,transaction:e,read:!t.read})}})}})}),[y,t,g,h,l]),K=(0,o.useCallback)((()=>{P&&A&&t&&i(253502).Z8({environment:y,notificationId:t.id,pageId:A.pointer.id,isCurrentlyFollowing:(0,i(603332).Z)(P).following,from:"inbox"})}),[y,A,P,t]),H=(0,s().yK)((e=>{const o={fill:e.icon.secondary,padding:(x.isMobile,0),width:(x.isMobile,22),height:(x.isMobile,22)};return{container:{display:"flex",gap:1,height:"min-content",padding:2,borderWidth:x.isMobile?0:1,borderStyle:"solid",borderColor:e.stroke.primary,background:e.buttonGroupBackground,borderRadius:6,boxShadow:x.isMobile?void 0:"0px 2px 4px 0px rgba(22, 29, 27, 0.02)"},button:{height:x.isMobile?30:24,width:x.isMobile?30:24},icon:{...o},iconVisited:{...o,...x.isMobile?{height:17.5,width:17.5}:{height:15,width:15}},iconUnvisited:{...o,marginTop:-.5,height:17.75,width:17.75},iconMarkUnread:{...o,...t.read&&{height:21,width:21},...!t.read&&{height:20.5,width:20.5}},headerLabel:{paddingLeft:16,paddingRight:16,paddingTop:10,fontWeight:i(707513).Ue.semibold}}}),[x.isMobile,t.read]),D=(0,w().aE)();return t.visited?(0,T.jsx)("div",{style:H.container,children:(0,T.jsx)(b().Z,{renderTooltip:()=>k.formatMessage(C.unarchive),render:e=>(0,T.jsx)(f().Z,{ariaLabel:k.formatMessage(C.unarchive),style:H.button,icon:N().s,iconStyle:H.iconVisited,onClick:L,...e})})}):(0,T.jsxs)("div",{style:H.container,children:[B&&(0,T.jsx)(b().Z,{renderTooltip:()=>(0,T.jsx)(r()._H,{...C.changePageNotificationSettings}),render:e=>(0,T.jsx)(p().ZP,{style:D.popup,popupType:x.isMobile?p().Z4.SlideUp:p().Z4.Popup,alignmentToOrigin:p().vR.Start,placementToOrigin:p().pO.Bottom,render:e=>(0,T.jsx)(U,{blockStore:A,notification:t,handlers:{handleUnarchive:L,handleArchive:Z,toggleNotificationReadStatus:E},closePopup:()=>e.close()}),renderOrigin:t=>(0,T.jsx)(f().Z,{ariaLabel:k.formatMessage(C.changePageNotificationSettings),style:H.button,icon:i(787356).t,iconStyle:H.iconUnvisited,...e,...(0,i(164079).Z)(t,{onClick:()=>K()})})})},"pageNotificationSettings"),(0,T.jsx)(b().Z,{renderTooltip:()=>k.formatMessage(t.read?C.markUnread:C.markRead),render:e=>(0,T.jsx)(f().Z,{ariaLabel:k.formatMessage(t.read?C.markUnread:C.markRead),style:H.button,icon:t.read?j().F:M().F,iconStyle:H.iconMarkUnread,onClick:E,...e})},"markUnread"),"activity"!==I&&(0,T.jsx)(b().Z,{renderTooltip:()=>k.formatMessage(C.archive),render:e=>(0,T.jsx)(f().Z,{ariaLabel:k.formatMessage(C.archive),style:H.button,icon:S().H,iconStyle:H.icon,onClick:Z,...e})},"archive")]})}function U(e){const{blockStore:t,notification:i,handlers:o,closePopup:d}=e,{handleArchive:c,handleUnarchive:p,toggleNotificationReadStatus:f}=o,b=(0,a().O7)(),v=(0,a().Fy)(),I=(0,r().YB)(),R=(0,n().VK)((()=>null==t?void 0:t.getFollowSettingsKey()),[t]),U=(0,n().VK)((()=>{if(!R)return[];if(!t)return[];return _().Zk({followSettingsKey:R,environment:b,blockStore:t,from:"inbox"})}),[R,b,t]),A=(0,w().aE)(),P=(0,s().yK)((()=>({iconContainer:{display:"flex",justifyContent:"center",alignItems:"center",...A.icon},icon:{height:24,width:24}})),[A.icon]);return(0,T.jsx)(m().Z,{menuType:x().o.Popup,height:v.isMobile?"50vh":void 0,minWidth:250,maxWidth:v.isMobile?"100vw":void 0,scrollerStyle:A.menuScroller,header:!v.isMobile&&(0,T.jsx)(y().Z,{style:A.header,isSmall:!v.isMobile,isSecondaryColor:!v.isMobile,children:(0,T.jsx)(r()._H,{id:"UpdateSidebarTabUpdatesHeader.pageNotificationSettings.label",defaultMessage:"Page notification settings"})}),children:(0,T.jsx)(g().Z,{type:g().i.Vertical,sections:[...v.isMobile?[{key:"Actions title",render:()=>(0,T.jsx)(y().Z,{style:A.header,isSmall:!v.isMobile,isSecondaryColor:!v.isMobile,children:(0,T.jsx)(r()._H,{id:"inbox.actionsSectionTitle.label",defaultMessage:"Actions"})}),items:[]},{key:"Actions",render:e=>(0,T.jsx)(h().Z,{...e,topBorder:!1,style:A.sectionMenuItem}),items:["markAsReadOrUnread","archive"].map(((e,t)=>{const o=t===U.length-1,a=v.isMobile&&o;return{key:e,render:t=>"archive"===e?(0,T.jsx)(u().Z,{...t,style:{...A.buttonMenuItem,...a&&A.transparentButtonMenuItemBorder},pressedStyle:A.buttonMenuItemPressed,icon:i.visited?(0,N().s)({...A.icon,padding:3}):(0,S().H)(A.icon),title:I.formatMessage(i.visited?C.unarchive:C.archive),titleStyle:A.title}):"markAsReadOrUnread"===e?(0,T.jsx)(u().Z,{...t,style:{...A.buttonMenuItem,...a&&A.transparentButtonMenuItemBorder},pressedStyle:A.buttonMenuItemPressed,icon:i.read?(0,T.jsx)("div",{style:P.iconContainer,children:(0,j().F)(P.icon)}):(0,T.jsx)("div",{style:P.iconContainer,children:(0,M().F)(P.icon)}),title:I.formatMessage(i.read?C.markUnread:C.markRead),titleStyle:A.title}):void(0,l().t1)(e),action:t=>{let{event:o}=t;"markAsReadOrUnread"===e?f(o):"archive"===e?i.visited?p(o):c(o):(0,l().t1)(e),d()}}}))}]:[],...v.isMobile?[{key:"Page notification settings title",render:()=>(0,T.jsx)(y().Z,{style:A.subheader,isSmall:!v.isMobile,isSecondaryColor:!v.isMobile,children:(0,T.jsx)(r()._H,{id:"inbox.notifyMeForSectionTitle.label",defaultMessage:"Notify me for"})}),items:[]}]:[],{key:"Page notification settings",render:e=>(0,T.jsx)(h().Z,{...e,topBorder:!1,style:A.sectionMenuItem}),items:U.map(((e,t)=>{const i=t===U.length-1,o=v.isMobile&&i;return{key:e.action.analyticsName,render:t=>(0,T.jsx)(u().Z,{...t,style:{...A.buttonMenuItem,...o&&A.transparentButtonMenuItemBorder},pressedStyle:A.buttonMenuItemPressed,title:e.title,titleStyle:A.title,right:e.isSelectedOption?(0,k().k)(A.checkIcon):void 0}),action:()=>{e.action.action({environment:b,blocks:[],lazyDependencies:{clipboardActions:void 0,formulasModule:void 0,markdownLinkifyIt:void 0,tinyMceMicrosoftWordPasteFilter:void 0},publicEditMode:void 0}),d()}}}))}],initialFocus:void 0,onAccept:()=>d()})})}const A=o.memo(R)},462274:(e,t,i)=>{"use strict";i.d(t,{o:()=>d});i(667294);var o=()=>i(142735),a=()=>i(788860),n=()=>i(696459),s=()=>i(648432),r=()=>i(763589),l=i(785893);function d(){const e=(0,o().VK)((()=>(0,r().Fz)()),[]);switch(e){case"unread_and_read":case"unread_only":return(0,l.jsx)(s().Z,{message:(0,l.jsx)(a()._H,{defaultMessage:"You'll be notified here for @mentions, page activity, and page invites",id:"inbox.filterEmptyState.nonArchivedMessage"}),title:(0,l.jsx)(a()._H,{defaultMessage:"You're all caught up",id:"inbox.filterEmptyState.nonArchivedTitle"})});case"archived_only":return(0,l.jsx)(s().Z,{message:(0,l.jsx)(a()._H,{defaultMessage:"Any Inbox updates you archived will show up here.",id:"inbox.filterEmptyState.archivedMessage"}),title:(0,l.jsx)(a()._H,{defaultMessage:"No archived updates",id:"inbox.filterEmptyState.archivedTitle"})});case"all_updates":return(0,l.jsx)(s().Z,{message:(0,l.jsx)(a()._H,{defaultMessage:"Any activity in the workspace will show up here.",id:"inbox.filterEmptyState.allPagesMessage"}),title:(0,l.jsx)(a()._H,{defaultMessage:"No activity in the workspace",id:"inbox.filterEmptyState.allPagesTitle"})});default:(0,n().t1)(e)}}},326264:(e,t,i)=>{"use strict";i.d(t,{SZ:()=>v,Zk:()=>h,bf:()=>g,t0:()=>y});i(667294);var o=()=>i(926724),a=()=>i(788860),n=()=>i(696459),s=()=>i(38562),r=()=>i(942834),l=()=>i(102182),d=()=>i(855238),c=()=>i(733641),u=()=>i(876822),p=()=>i(603332),f=i(785893);const m=(0,a().vU)({repliesAndMentions:{id:"pageNotificationSettings.repliesAndMentions.displayName",defaultMessage:"Mentions"},comments:{id:"pageNotificationSettings.comments.displayName",defaultMessage:"Comments"},allUpdates:{id:"pageNotificationSettings.allUpdates.displayName",defaultMessage:"All"},importantUpdates:{id:"pageNotificationSettings.importantUpdates.displayName",defaultMessage:"Important"}});function g(e){switch(e){case"Mentions":return m.repliesAndMentions;case"Comments":return m.comments;case"All":return m.allUpdates;case"Important":return m.importantUpdates;default:return}}function h(e){const{followSettingsKey:t,environment:i,blockStore:n,from:s}=e,r=b({key:"none",selectedKey:t,title:(0,f.jsx)(a()._H,{id:"GetNotifiedDropdown.repliesAndMentions.label",defaultMessage:"Replies and @mentions"}),displayName:m.repliesAndMentions,environment:i,blockStore:n,from:s}),l=b({key:"comments",selectedKey:t,title:(0,f.jsx)(a()._H,{id:"GetNotifiedDropdown.allComments.label",defaultMessage:"All comments"}),displayName:m.comments,environment:i,blockStore:n,from:s}),d=b({key:"all",selectedKey:t,title:(0,f.jsx)(a()._H,{id:"GetNotifiedDropdown.allUpdates.label",defaultMessage:"All updates"}),caption:(0,f.jsx)(a()._H,{id:"GetNotifiedDropdown.simpleAllUpdates.caption",defaultMessage:"All comments and property changes"}),displayName:m.allUpdates,environment:i,blockStore:n,from:s}),c=n.getAssociatedCollectionStore();if(!c)return[l,r];const u=c.getDatabaseType();if(u===o().Ym){return[d,b({key:"important",selectedKey:t,title:(0,f.jsx)(a()._H,{id:"GetNotifiedDropdown.importantUpdatesTasks.label",defaultMessage:"Important updates"}),caption:(0,f.jsx)(a()._H,{id:"GetNotifiedDropdown.importantUpdatesTasks.caption",defaultMessage:"All comments and changes to Status, Assignee, or Due Date"}),displayName:m.importantUpdates,environment:i,blockStore:n,from:s}),r]}if(u===o().wW){return[d,b({key:"important",selectedKey:t,title:(0,f.jsx)(a()._H,{id:"GetNotifiedDropdown.importantUpdatesProjects.label",defaultMessage:"Important updates"}),caption:(0,f.jsx)(a()._H,{id:"GetNotifiedDropdown.importantUpdatesProjects.caption",defaultMessage:"All comments and changes to Status or Date"}),displayName:m.importantUpdates,environment:i,blockStore:n,from:s}),r]}return[d,b({key:"comments",selectedKey:t,title:(0,f.jsx)(a()._H,{id:"GetNotifiedDropdown.onlyCommentsAllComments.label",defaultMessage:"All comments"}),displayName:m.comments,environment:i,blockStore:n,from:s}),r]}function b(e){const{key:t,title:i,caption:o,selectedKey:a,environment:n,blockStore:m,from:g,displayName:h}=e,b=y({key:t,userSelectedKey:a}),v={icon:{width:14,height:14},rightWrapper:o?{alignSelf:"flex-start",paddingTop:2}:{}};return{action:(0,s().cN)({key:t,displayName:h,analyticsName:t,validators:[],closeParentMenu:!0,action:()=>{const{currentUserRootStore:e}=u().default.state;if(e){const{following:i,followSettings:o}=(0,p().Z)(t),s=e.id,d=m.id,c=m.getSpaceId();r().k({environment:n,following:i,followSettings:o,navigableBlockId:d,spaceId:c,userId:s,from:g,key:t,selectedKey:a}),"inbox"!==g&&"more_menu"!==g||l().d4({item:{label:x(t)},undoFunc:()=>{const{following:e,followSettings:i}=(0,p().Z)(a);r().k({environment:n,following:e,followSettings:i,navigableBlockId:d,spaceId:c,userId:s,from:g,key:t,selectedKey:a})}})}},render:e=>(0,f.jsx)(d().Z,{...e,title:i,caption:o,shouldWrapCaption:!0,right:b?(0,c().k)(v.icon):(0,f.jsx)("div",{style:v.icon}),rightStyle:v.right})}),title:i,isSelectedOption:b}}function y(e){const{key:t,userSelectedKey:i}=e;return"important"===i||"comments"===i?"important"===t||"comments"===t:t===i}function v(e){switch(e){case"subscribed":return(0,f.jsx)(a()._H,{id:"GetNotifiedDropdown.followedFeedSettingSuccess.snackbarMessage",defaultMessage:"Followed the feed"});case"unsubscribed":return(0,f.jsx)(a()._H,{id:"GetNotifiedDropdown.unfollowedFeedSettingSuccess.snackbarMessage",defaultMessage:"Unfollowed the feed"});default:(0,n().t1)(e)}}function x(e){switch(e){case"none":return(0,f.jsx)(a()._H,{id:"GetNotifiedDropdown.subscribedRepliesAndMentionsSuccess.snackbarMessage",defaultMessage:"Subscribed to replies and @mentions"});case"comments":return(0,f.jsx)(a()._H,{id:"GetNotifiedDropdown.subscribedAllCommentsSuccess.snackbarMessage",defaultMessage:"Subscribed to all comments"});case"important":return(0,f.jsx)(a()._H,{id:"GetNotifiedDropdown.subscribedImportantUpdatesSuccess.snackbarMessage",defaultMessage:"Subscribed to important updates"});case"all":return(0,f.jsx)(a()._H,{id:"GetNotifiedDropdown.subscribedAllUpdatesSuccess.snackbarMessage",defaultMessage:"Subscribed to all updates"});default:(0,n().t1)(e)}}},603332:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var o=()=>i(431143),a=()=>i(696459);function n(e,t){switch(e){case"all":return{following:!0,followSettings:{...(0,o().yI)({explicitly_set_by_user:!0}),feed_setting:t}};case"important":return{following:!0,followSettings:{...(0,o().GC)({explicitly_set_by_user:!0}),feed_setting:t}};case"comments":return{following:!0,followSettings:{...(0,o().r$)({explicitly_set_by_user:!0}),feed_setting:t}};case"none":return{following:!1,followSettings:{...(0,o().vU)({explicitly_set_by_user:!0}),feed_setting:t}};default:(0,a().t1)(e)}}},295608:(e,t,i)=>{"use strict";i.r(t),i.d(t,{getNotificationValues:()=>d,getState:()=>l,setState:()=>r});i(241792);var o=()=>i(114882),a=()=>i(779565),n=()=>i(876822);let s={};function r(e){s={...s,...e}}function l(){return s}function d(){const e=s.result;if(!e)return null;const t=n().default.state.currentSpaceStore;return t?e.map((e=>{const i={table:a().uX,id:e,spaceId:t.getSpaceId()},n=t.getRecordValue(i),s=null==n?void 0:n.activity_id;if(s&&n){const e={table:o().TY,id:s,spaceId:t.getSpaceId()};n.activity=t.getRecordValue(e)}return n})):null}},40642:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GetNotifiedFor:()=>c,InboxActionsMenu:()=>ei().ZP,InboxFilterForUnreadButton:()=>ii,InboxMentionsActionButtons:()=>ri,InboxModalHeader:()=>pi,InboxNotificationSettingsButton:()=>kt,InboxRefreshAllTabButton:()=>ci,MobileInboxPopup:()=>Xt,NotificationGroupActionsMenu:()=>wi,NotificationInboxPanelContent:()=>Mi,SidebarInboxButton:()=>fi().t,TopbarUpdatesMenu:()=>N,UnreadMentionsBadge:()=>li().Z,UpdateSidebar:()=>tt});var o=i(667294),a=()=>i(142735),n=()=>i(846550),s=()=>i(788860),r=()=>i(707513),l=()=>i(621913),d=i(785893);function c(e){const{navigableBlockStore:t,from:i,buttonPopupStore:o,style:c}=e,u=(0,a().VK)((()=>t.isPageBlock()),[t]),p=(0,n().yK)((e=>({label:{fontSize:r().JB.UIRegular.desktop,color:e.regularTextColor,fontWeight:r().Ue.medium},border:{border:`1px solid ${e.outlineButtonBorder}`,borderRadius:4,marginTop:8}})),[]);return u?(0,d.jsxs)("div",{style:c,children:[(0,d.jsx)("div",{style:p.label,children:(0,d.jsx)(s()._H,{id:"UpdateSidebarTabUpdatesHeader.pageNotificationSettings.label",defaultMessage:"Page notification settings"})}),(0,d.jsx)("div",{style:p.border,children:(0,d.jsx)(l().h,{blockStore:t,moreProminentStyling:!0,from:i,buttonPopupStore:o})})]}):null}var u=()=>i(857773),p=()=>i(198829),f=()=>i(219727),m=()=>i(467171),g=()=>i(247724),h=()=>i(657174),b=()=>i(590972),y=()=>i(749826),v=()=>i(844659);const x=new(i(529048).Z);var S=()=>i(539245);function M(){return(0,d.jsx)(s()._H,{id:"updateSidebar.header.updatesLabel",defaultMessage:"Updates"})}function j(e){const t=(0,f().O7)(),{enablePageAnalytics:i,navigableBlockStore:o,inPeekView:l,noTopMargin:c}=e,u=(0,n().yK)((e=>({updatesHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:c?0:m().R6(t.device.isElectronMac),paddingTop:4,width:"100%",background:l?e.popoverBackground:e.contentBackground,padding:"12px 12px 12px 16px",borderBottom:`1px solid ${e.regularDividerColor}`},getNotifiedFor:{...i?{padding:8}:{paddingBottom:14}},label:{fontSize:14,color:e.regularTextColor,fontWeight:r().Ue.medium}})),[c,t.device.isElectronMac,l,i]),p=(0,a().VK)((()=>b().default.state.currentSubTab),[]),j=l?x:v().Z,k=(0,a().VK)((()=>"on"===y().default.getEligibleGroup({experimentId:"remove_updates_topbar_button_v2",defaultGroup:"control",disableExposureLogging:!0})),[]);return(0,d.jsxs)("div",{style:{...u.updatesHeaderStyle,...i?{padding:"0 6px"}:{}},className:g().cFM,children:[!k&&(0,d.jsx)(h().Xm,{navigableBlockStore:o,from:"page_updates",buttonPopupStore:j,style:u.getNotifiedFor}),i?(0,d.jsx)(S().Z,{tabs:[(0,d.jsx)(M,{},"updates"),(0,d.jsx)(s()._H,{id:"updateSidebar.header.analyticsLabel",defaultMessage:"Analytics"},"analytics")],selectedIndex:p,onChange:e.onTabChange,style:{...u.label,padding:0,boxShadow:"none"},tabStyle:{padding:"12px 0"}}):(0,d.jsx)("div",{style:u.label,children:(0,d.jsx)(M,{})})]})}var k=()=>i(352230);function N(e){const{blockStore:t,spaceStore:i}=e,o=function(e){const{spaceStore:t,blockStore:i}=e,o=(0,a().VK)((()=>{var e,t;return(null==i||null===(e=i.getModel())||void 0===e?void 0:e.isCollectionView())?null===(t=i.getCollectionPointer())||void 0===t?void 0:t.id:void 0}),[i]);if(!t)return;const n=i.id,s=t.id;return{navigableBlockId:n,collectionId:o,spaceId:s}}({blockStore:t,spaceStore:i});return o?(0,d.jsx)(p().Z,{menuType:k().o.Popup,className:g().KLh,header:(0,d.jsx)(j,{navigableBlockStore:t,enablePageAnalytics:!1,noTopMargin:!0,inPeekView:!0}),children:(0,d.jsx)(u().Z,{empty:()=>(0,d.jsx)(w,{}),source:"updates_sidebar",navigableBlockStore:t,...o},t.id)}):null}function w(){const e=(0,n().yK)((e=>({container:{marginTop:64,textAlign:"center",paddingLeft:18,paddingRight:18,marginBottom:64},content:{fontSize:14,color:e.mediumTextColor,marginTop:4}})),[]);return(0,d.jsx)("div",{style:e.container,children:(0,d.jsx)("div",{style:e.content,children:(0,d.jsx)("span",{children:(0,d.jsx)(s()._H,{defaultMessage:"No edits in this page yet.",id:"topbar.updatesButton.emptyState"})})})})}var _=()=>i(492522),T=()=>i(696459),C=()=>i(381140),I=()=>i(628370),R=()=>i(299519),U=()=>i(123256),A=()=>i(54076),P=()=>i(115699),V=()=>i(730120),B=()=>i(832924),Z=()=>i(520849),L=()=>i(876822),E=()=>i(842574),K=(i(267602),i(916054),i(653476),i(749411),i(241792),i(731107),()=>i(239297)),H=()=>i(146947),D=()=>i(646574),F=()=>i(874459),O=()=>i(801812),G=()=>i(114079),z=()=>i(934158),W=()=>i(696056),q=()=>i(989478),Y=()=>i(513670),X=()=>i(632314),$=()=>i(372931),J=()=>i(824462),Q=()=>i(853686),ee=()=>i(196587),te=()=>i(871953),ie=()=>i(758018),oe=()=>i(852465),ae=()=>i(148126),ne=()=>i(407544),se=()=>i(906555),re=()=>i(151684),le=()=>i(384697),de=()=>i(653457),ce=()=>i(858856),ue=()=>i(166104),pe=()=>i(998901),fe=()=>i(70751),me=()=>i(826955),ge=()=>i(18281),he=()=>i(656221),be=()=>i(448419),ye=()=>i(78078),ve=()=>i(312578),xe=()=>i(661297),Se=()=>i(654133),Me=()=>i(634760),je=()=>i(67961),ke=()=>i(981583),Ne=()=>i(304109),we=()=>i(83340);const _e=Date.now();function Te(e){let{store:t,spaceId:i,isDisabledForWorkspace:r}=e;const[l,c]=(0,o.useState)("last_28_days"),[u,m]=(0,o.useState)({state:r?"disabled-for-workspace":"loading"}),g=(0,f().O7)(),h=(0,n().Fg)(),b=(0,a().VK)((()=>{const{currentSpaceStore:e}=L().default.state;return null==e?void 0:e.getName()}),[]),y=(0,a().VK)((()=>{switch(l){case"last_7_days":return 7;case"last_28_days":return 28;case"last_90_days":return 90;case"all_time":return}}),[l]);(0,o.useEffect)((()=>{r||async function(){const e=await J().callApi({eventName:"getPageAnalytics",environment:g,data:{pageId:t.id,spaceId:i,days:y}});if("failed"===e.type)return void m({state:"empty"});const o=e.data.map((e=>{let{ds:t,total_views:i,unique_views:o}=e;return{ds:t,values:{total_views:i,unique_views:o}}}));o.filter((e=>{let{ds:t}=e;return F().OQ.isoToUnixMs(t,"UTC")??_e<=_e})).every((e=>{let{values:t}=e;return 0===t.total_views}))?m({state:"empty"}):m({state:"loaded",data:o})}()}),[g,t.id,r,i,y]);const v=(0,n().yK)((e=>({fullHeight:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},spinner:{width:32,height:32}})),[]);return"loading"===u.state?(0,d.jsx)("div",{style:v.fullHeight,children:(0,d.jsx)(ve().Z,{style:v.spinner})}):"empty"===u.state?(0,d.jsx)("div",{style:v.fullHeight,children:(0,d.jsx)(Ke,{heading:(0,d.jsx)(s()._H,{id:"page_analytics.empty.heading",defaultMessage:"No page analytics yet"}),description:(0,d.jsx)(s()._H,{id:"page_analytics.empty.description",defaultMessage:"It may take some time for page view information to appear."})})}):"disabled-for-workspace"===u.state?(0,d.jsx)("div",{style:v.fullHeight,children:(0,d.jsx)(Ke,{heading:(0,d.jsx)(s()._H,{id:"page_analytics.disabled.heading",defaultMessage:"Page viewership tracking is disabled"}),description:(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16},children:[b?(0,d.jsx)(s()._H,{id:"page_analytics.disabled.description",defaultMessage:"Page viewership and analytics is turned off for all pages in {name}",values:{name:b}}):(0,d.jsx)(s()._H,{id:"page_analytics.disabled.description.unnamed",defaultMessage:"Page viewership and analytics is turned off for all pages in your space"}),(0,d.jsxs)("a",{href:(0,ae().UY)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:h.regularTextColor,alignItems:"center",textDecoration:"none",cursor:"pointer"},children:[(0,de().m)({width:14,height:14}),(0,d.jsx)(je().Z,{isSmall:!0,children:(0,d.jsx)(s()._H,{id:"page_analytics.disabled.learnMore",defaultMessage:"Learn more"})})]})]})})}):(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"},children:[(0,d.jsxs)(ye().sg,{grow:1,gap:16,children:[(0,d.jsx)(Re,{store:t,data:u.data,currentFilter:l,onChangeFilter:c}),(0,d.jsx)(Ae,{store:t}),(0,d.jsx)(Ee,{spaceId:i,store:t})]}),(0,d.jsxs)("div",{style:{borderTop:`1px solid ${h.regularDividerColor}`,padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,d.jsx)(be().ZP,{renderOrigin:e=>{let{onClick:t}=e;return(0,d.jsx)(xe().Z,{onClick:t,icon:ue().H,children:(0,d.jsx)(s()._H,{id:"page_analytics.timeseries.settings",defaultMessage:"Settings"})})},popupType:g.device.isMobile?be().Z4.SlideUp:be().Z4.Popup,render:()=>(0,d.jsx)(p().Z,{menuType:k().o.Popup,width:460,children:(0,d.jsx)("div",{style:Ie,children:(0,d.jsx)(we().PageAnalyticsPageOptOut,{store:t})})})}),(0,d.jsxs)("a",{href:(0,ae().UY)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:h.regularTextColor,alignItems:"center",textDecoration:"none",cursor:"pointer"},children:[(0,de().m)({width:14,height:14}),(0,d.jsx)(je().Z,{isSmall:!0,children:(0,d.jsx)(s()._H,{id:"page_analytics.timeseries.learnMore",defaultMessage:"Learn more"})})]})]})]})}const Ce=175,Ie={margin:"8px 16px",pointerEvents:"auto",cursor:"default"};function Re(e){const[t,i]=(0,ne().e)(),{blueLayer:a,yellowLayer:n}=(0,K().useTimeSeriesPalette)(),r=(0,o.useMemo)((()=>{if(0===e.data.length)return _e;const t=F().OQ.isoToUnixMs(e.data[0].ds,"UTC")??_e;return Math.min(t,_e)}),[e.data]);return(0,d.jsxs)("div",{children:[(0,d.jsx)(Ue,{store:e.store,data:e.data,currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter}),(0,d.jsx)("div",{ref:t,style:{...Ie,marginBottom:0},children:(0,d.jsx)(ee().J,{startDate:(0,D().$6)(r,!0),endDate:(0,D().$6)(_e,!0),width:i,height:Ce,data:e.data,layers:[{key:"total_views",...a,renderLabel:e=>(0,d.jsx)(s()._H,{id:"page_analytics.timeseries.total_views",defaultMessage:"{views, plural, one {1 total view} other {{views} total views}}",values:{views:e}})},{key:"unique_views",...n,renderLabel:e=>(0,d.jsx)(s()._H,{id:"page_analytics.timeseries.unique_views",defaultMessage:"{uniqueViews, plural, one {1 unique view} other {{uniqueViews} unique views}}",values:{uniqueViews:e}})}]})})]})}function Ue(e){const t=(0,s().YB)(),i=(0,o.useMemo)((()=>e.data.reduce(((e,t)=>{let{values:i}=t;return e+i.total_views}),0)),[e.data]);return(0,d.jsx)("div",{style:{margin:"14px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,d.jsxs)(ye().X2,{justifyContent:"space-between",alignItems:"center",grow:1,children:[(0,d.jsxs)(ye().X2,{gap:4,children:[(0,d.jsx)(je().Z,{style:{fontWeight:500},children:(0,d.jsx)(s()._H,{id:"page_analytics.timeseries.title",defaultMessage:"Views"})}),(0,d.jsx)(je().Z,{isSecondaryColor:!0,children:(0,d.jsx)(s()._H,{id:"page_analytics.timeseries.totalViews",defaultMessage:"({totalViews} total)",values:{totalViews:(0,G().uf)(i,"number_with_commas",t)}})})]}),(0,d.jsx)(Ne().f,{currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter})]})})}function Ae(e){const{store:t}=e,{pageVisitStore:i,presenceStore:n}=(0,a().Kw)(L().default),r=(0,f().O7)();(0,o.useEffect)((()=>{Q().Ri(r,{blockStore:t,pageVisitStore:i,incremental:!1,limit:Q().s4})}),[r,t,i]);const[{value:l,status:c}]=(0,O().r5)((async()=>{const{currentSpaceStore:e}=L().default.state;if(!e)return[];return(await(0,he().rX)({environment:r,spaceId:t.getSpaceId()})).map((e=>e.getEmailDomain()))}),[r,t]),u=(0,a().VK)((()=>"resolved"!==c?[]:(0,ie().AQ)({pageVisitStore:i,presenceStore:n,blockStore:t,trustedEmailDomains:l})),[i,n,t,c,l]);if(0===u.length)return null;const p=u.map((e=>{let{userId:i,activityTimestampNearestMinuteMs:o,onTrustedDomain:a}=e;return{actorStore:me().U6.createChildStore(t,{id:i,table:q().KJ}),timestamp:o,onTrustedDomain:a}}));return(0,d.jsxs)("div",{style:{...Ie,display:"flex",flexDirection:"column",gap:12},children:[(0,d.jsx)(je().Z,{style:{fontWeight:500},children:(0,d.jsx)(s()._H,{id:"page_analytics.viewers.title",defaultMessage:"Viewers"})}),(0,d.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:(0,d.jsx)(Ve,{store:t,actorStores:p,collapsedLabel:(0,d.jsx)(s()._H,{id:"page_analytics.viewers.expand",defaultMessage:"Show more viewers"}),expandedLabel:(0,d.jsx)(s()._H,{id:"page_analytics.viewers.collapse",defaultMessage:"Show less viewers"})})})]})}const Pe=5;function Ve(e){const{store:t,actorStores:i,collapsedLabel:a,expandedLabel:n}=e,[s,r]=(0,o.useState)(!0),l=s?i.slice(0,Pe):i;return(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[l.map((e=>{let{actorStore:i,timestamp:o,onTrustedDomain:a}=e;return(0,d.jsx)(Be,{store:t,actorStore:i,timestamp:o,onTrustedDomain:a},i.id)})),i.length>Pe&&(0,d.jsx)("button",{onClick:e=>{e.preventDefault(),r(!s)},style:{background:"none",border:"none",textAlign:"left",padding:0,marginTop:4},children:(0,d.jsxs)(je().Z,{isSecondaryColor:!0,isSmall:!0,style:{display:"flex",gap:3,alignItems:"center"},children:[s?a:n,s?(0,re().E)({width:12}):(0,le().R)({width:12})]})},"toggle")]})}function Be(e){const{actorStore:t,timestamp:i,onTrustedDomain:r}=e,l=(0,s().YB)(),c=(0,o.useMemo)((()=>{const e=Date.now();return(0,D().tv)(Math.min(i??e,e),H().locale)}),[i]),u=(0,a().VK)((()=>t.getDisplayName(l)),[t,l]),p=(0,n().yK)((e=>({icon:{width:14,height:14,position:"relative",top:1,color:e.mediumTextColor},tooltip:{marginTop:2}})),[]);return(0,d.jsxs)(ye().X2,{alignItems:"center",justifyContent:"space-between",children:[(0,d.jsxs)(ye().X2,{gap:4,children:[(0,d.jsx)(Ze,{actorStore:t}),(0,d.jsx)(je().Z,{style:{fontWeight:500},children:u})]}),(0,d.jsx)(je().Z,{isSecondaryColor:!0,children:i?(0,d.jsx)("span",{title:(0,D().Yx)(i,"medium_with_time",H().locale),children:c}):c}),r&&(0,d.jsx)("div",{style:p.tooltip,children:(0,d.jsx)(Se().Z,{renderTooltip:()=>(0,d.jsx)(s()._H,{id:"page_analytics.viewers.sharedEmailDomainUser.tooltip.message",defaultMessage:"Shared email domain user"}),render:e=>(0,d.jsx)("div",{...e,style:p.icon,children:(0,ce().D)()}),placement:pe().Placement.Bottom})})]})}function Ze(e){const{actorStore:t}=e;return t.table===W().cZ?(0,d.jsx)(Me().Z,{botStore:t,size:18}):t.table===q().KJ?(0,d.jsx)(ke().Z,{userStore:t,size:18}):t.table===z().y0?(0,d.jsx)(ke().Z,{userStore:void 0,size:18}):void(0,T().t1)(t)}function Le(e){const{environment:t,store:i,spaceId:n,hasAccessToEditors:s}=e,[,,r]=(0,a().AF)(void 0,fe().o),[l,d]=(0,o.useState)([]);(0,o.useEffect)((()=>{s&&$().hh(t,{store:r,activityIds:l,spaceId:n,filterActivityTypes:[],filterDateRange:{starting:void 0,ending:void 0},navigableBlockId:i.id})}),[l,r,n,i.id,t,s]);return(0,a().VK)((()=>{if(!s)return[];const e=r.state.activityIds;(0,X().Z)(l,e)||d(e);const{currentSpaceStore:t}=L().default.state;if(!t)return[];const o=l.map((e=>(0,oe().No)(t,e,t.id))).flatMap((e=>{const t=e.getValue();return t?"top-level-block-created"!==t.type&&"top-level-block-deleted"!==t.type&&"block-edited"!==t.type?[]:function(e,t){var i;return Y().oA(null===(i=e.edits)||void 0===i?void 0:i.flatMap((e=>{var i;return null===(i=e.authors)||void 0===i?void 0:i.map((i=>({actorStore:(0,te().nc)({parentStore:t,pointer:i}),timestamp:e.timestamp})))})))}(t,i):[]})),a=Y().MR(o,"timestamp").reverse();return Y().mN(a,(e=>e.actorStore.id))}),[l,r,s,i])}function Ee(e){const{spaceId:t,store:i}=e,o=(0,f().O7)(),n=(0,a().VK)((()=>(0,ge().qb)(o,"business")||(0,ge().qb)(o,"enterprise")),[o]),r=Le({environment:o,hasAccessToEditors:n,spaceId:t,store:i}),l=(0,a().VK)((()=>{const e=i.getCreatedByPointer(),t=i.getCreatedTime();if(e&&t)return{actorStore:(0,te().nc)({parentStore:i,pointer:e}),createdTime:t}}),[i]);return(0,d.jsxs)("div",{style:{...Ie,display:"flex",flexDirection:"column",gap:12},children:[(0,d.jsx)(je().Z,{style:{fontWeight:500},children:(0,d.jsx)(s()._H,{id:"page_analytics.editors.title",defaultMessage:"Editors"})}),l&&(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10,marginBottom:6},children:[(0,d.jsx)(je().Z,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500},children:(0,d.jsx)(s()._H,{id:"page_analytics.editors.createdBy",defaultMessage:"Created by"})}),(0,d.jsx)(Be,{store:i,actorStore:l.actorStore,timestamp:l.createdTime})]}),n&&r.length>0&&(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[(0,d.jsx)(je().Z,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500},children:(0,d.jsx)(s()._H,{id:"page_analytics.editors.editedBy",defaultMessage:"Recently edited by"})}),(0,d.jsx)(Ve,{actorStores:r,store:i,collapsedLabel:(0,d.jsx)(s()._H,{id:"page_analytics.editors.expand",defaultMessage:"Show more editors"}),expandedLabel:(0,d.jsx)(s()._H,{id:"page_analytics.editors.collapse",defaultMessage:"Show less editors"})})]})]})}function Ke(e){const t=(0,n().yK)((e=>({column:{display:"flex",flexDirection:"column"},row:{display:"flex"},centered:{textAlign:"center",alignItems:"center",width:250},analyticsIcon:{position:"relative",top:-8,left:-4},secondaryIcon:{fill:e.mediumTextColor},settingsButton:{padding:"7.5px 10px",alignSelf:"center"},link:{cursor:"pointer",justifyContent:"center",alignItems:"center",padding:8,alignSelf:"center"}})),[]);return(0,d.jsx)("div",{style:{...t.column,gap:24},children:(0,d.jsxs)("div",{style:{...t.column,...t.centered,gap:4},children:[(0,se().z)({...t.secondaryIcon,...t.analyticsIcon,width:62,height:62}),(0,d.jsx)(je().Z,{isSecondaryColor:!0,style:{fontSize:16,fontWeight:500},children:e.heading}),(0,d.jsx)(je().Z,{isSecondaryColor:!0,style:{whiteSpace:"normal",overflow:"visible"},children:e.description})]})})}function He(e){let{enablePageAnalytics:t}=e;const i=(0,a().VK)((()=>L().default.state.mainEditorCurrentBlockStore),[]),o=(0,a().VK)((()=>{const e=V().ou.now().minus({years:1}).valueOf();return!!i&&i.getCreatedTime()<e}),[i]),r=(0,a().VK)((()=>L().default.state.currentSpaceStore),[]),l=(0,a().VK)((()=>!(null!=i&&i.canRead())),[i]),c=(0,a().VK)((()=>{var e;const t=null==i?void 0:i.getModel();return i&&null!=t&&t.isCollectionView()?null===(e=i.getCollectionPointer())||void 0===e?void 0:e.id:void 0}),[i]),p=(0,a().VK)((()=>Boolean(null==r?void 0:r.getSettings().disable_page_analytics)),[r]),f=(0,n().yK)((e=>({updatesEmptyStyle:{flex:1,display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",color:e.mediumTextColor,fontSize:14,background:e.contentBackground,marginRight:0,pointerEvents:"auto",height:"100%"},updatesNotEmptyStyle:{display:"flex",flexDirection:"column",flex:"1 1 0%",background:e.contentBackground,marginRight:0,pointerEvents:"auto",marginTop:1,height:"100%"}})),[]),m=(0,a().VK)((()=>b().default.state.currentSubTab),[]);return l?(0,d.jsx)(E().Z,{type:Z().Z.Y,style:f.updatesEmptyStyle,children:(0,d.jsx)("div",{style:{width:200,alignSelf:"center"},children:(0,d.jsx)(s()._H,{id:"updateSidebar.commentContainer.restricted",defaultMessage:"You don't have permission to view the updates of this restricted page."})})}):r&&i?(0,d.jsxs)(E().Z,{type:Z().Z.Y,ref:e=>{B().default.UpdateSidebarScroller=e},style:f.updatesNotEmptyStyle,children:[t&&(0,d.jsx)("div",{style:{display:m===b().uF.Analytics?"block":"none",height:"100%"},children:(0,d.jsx)(Te,{spaceId:r.id,store:i,isDisabledForWorkspace:p})}),(0,d.jsx)("div",{style:{display:m===b().uF.Updates?"block":"none"},children:(0,d.jsx)(u().Z,{collectionId:c,navigableBlockStore:i,spaceId:r.id,source:"updates_sidebar",empty:e=>(0,d.jsx)(E().Z,{type:Z().Z.Y,style:f.updatesEmptyStyle,ref:e=>{B().default.UpdateSidebarScroller=e},children:(0,d.jsx)("div",{style:{width:200,alignSelf:"center"},children:e.hasFiltersOn?(0,d.jsx)(s()._H,{id:"updateSidebar.updatesContainer.emptyAfterSearch",defaultMessage:"No updates match the requested filters."}):o?(0,d.jsx)(s()._H,{id:"updateSidebar.updatesContainer.emptyMaybePurged",defaultMessage:"There are no recent updates on this page. Page updates are retained for one year."}):(0,d.jsx)(s()._H,{id:"updateSidebar.updatesContainer.empty",defaultMessage:"No updates on this page yet."})})})},i.id)})]}):null}var De=()=>i(562219),Fe=()=>i(345918),Oe=()=>i(70191),Ge=()=>i(341643),ze=()=>i(355435),We=()=>i(793935),qe=()=>i(589525),Ye=()=>i(311562),Xe=()=>i(482162);function $e(e){const{currentTab:t}=e,i=(0,a().VK)((()=>L().default.state.mainEditorCurrentBlockStore),[]),n=(0,a().VK)((()=>L().default.state.renderPhase),[]),[s,r]=(0,o.useState)(!1),l=(0,o.useMemo)((()=>Date.now()),[]),c=(0,a().VK)((()=>b().default.state.timeOpenedComments),[]),u=void 0!==c?Math.max(l,c):l;if((0,o.useEffect)((()=>{s||"rendered"!==n||r(!0)}),[null==i?void 0:i.id,s,n]),!i||!s)return(0,d.jsx)(A().B,{areaHeight:window.innerHeight});switch(t){case b().gY.Comments:return(0,d.jsx)(P().J,{timeViewed:u,location:"sidebar"});case b().gY.Updates:return(0,d.jsx)(He,{enablePageAnalytics:e.enablePageAnalytics});case b().gY.Info:return(0,d.jsx)(De().J,{store:i,context:Ye().S.Frame,disabled:!1,shownAs:"sidebar"});default:(0,T().t1)(t)}}function Je(e){const t=(0,a().VK)((()=>({width:b().default.state.width,isAnimating:b().default.state.isAnimating})),[]),i=(0,Ge().J4)(),{shouldLoadSidebarComponents:s,isExpanded:r}=e,l=(0,o.useRef)(null),[c,u]=(0,o.useState)(!1);(0,o.useEffect)((()=>{const e=requestAnimationFrame((()=>u(!0)));return()=>cancelAnimationFrame(e)}),[]);const p=(0,n().yK)((e=>({container:{flexGrow:0,flexShrink:0,width:t.width,zIndex:_().XB,borderLeft:r?`1px solid ${e.regularDividerColor}`:"1px solid rgba(0,0,0,0)",alignSelf:"flex-end",position:"absolute",right:0,top:0,height:i?`calc(100vh - ${ze().tL}px)`:"100vh",pointerEvents:"none"},wrap:{height:"100%"},content:{position:"absolute",top:0,bottom:0,display:"flex",flexDirection:"column",overflow:"visible",zIndex:_().XB,width:t.width}})),[t.width,r,i]);return s?(0,d.jsx)(I().Z,{tag:"aside",visible:r,initial:{translateX:"100%"},animate:{translateX:0},exit:{translateX:"100%"},skip:!c,onAnimationStart:()=>{b().default.setState({...b().default.state,isAnimating:!0})},onAnimationEnd:()=>{b().default.setState({...b().default.state,isAnimating:!1})},"aria-hidden":!r||void 0,ref:l,style:p.container,onMouseMove:()=>{t.isAnimating||b().default.setState({...b().default.state,mouseEntered:!0})},onMouseLeave:()=>{t.isAnimating||b().default.setState({...b().default.state,mouseEntered:!1})},children:(0,d.jsx)("div",{style:p.wrap,children:(0,d.jsx)("div",{style:p.content,children:(0,d.jsx)(et,{...e})})})}):null}function Qe(e){let{enablePageAnalytics:t,navigableBlockStore:i,onTabChange:o}=e;const s=(0,f().O7)(),r=(0,a().VK)((()=>b().default.state.currentTab),[]),l=(0,n().yK)((()=>({commentsHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:m().R6(s.device.isElectronMac)}})),[s]);switch(r){case b().gY.Comments:return(0,d.jsx)("div",{style:l.commentsHeaderStyle});case b().gY.Updates:return(0,d.jsx)(j,{navigableBlockStore:i,enablePageAnalytics:t,onTabChange:o});case b().gY.Info:return(0,d.jsx)("div",{style:l.commentsHeaderStyle});default:(0,T().t1)(r)}}function et(e){const{isResizerHovered:t,isResizing:i,currentTab:s,expanded:r}=(0,a().VK)((()=>{const{isResizerHovered:e,isResizing:t,currentTab:i,expanded:o}=b().default.state;return{isResizerHovered:e,isResizing:t,currentTab:i,expanded:o}}),[]),{currentBlockStore:l}=e,c=(0,f().O7)(),{currentTabToRender:u}=(0,a().VK)((()=>({currentTabToRender:l.isCollectionView()&&!l.isCollectionViewPageWithContent()?b().gY.Updates:s})),[l,s]),p=(0,a().VK)((()=>{const{currentSpaceStore:e}=L().default.state;return!(!e||(0,Fe().Cx)(e))}),[]),m=o.useCallback((e=>{C().Zm(c,{tab:e===b().uF.Updates?"updates":"analytics",origin:Xe().default.state.open?"peek_view":"page"}),b().default.setState({...b().default.state,currentSubTab:e})}),[c]),h=(0,n().yK)((e=>({pane:{display:"flex",flexDirection:"column",height:"100%",position:"relative",pointerEvents:"none",maxHeight:"100%",backgroundColor:s===b().gY.Comments?void 0:"inherit"},resizerStyle:{position:"absolute",top:0,left:-3,bottom:0,right:0,height:"100vh",width:3,zIndex:-1,display:"block",transition:"box-shadow 300ms ease-in",...(t||i)&&r?{boxShadow:e.sidebarResizerBoxShadow}:{}}})),[s,t,i,r]);let y;return u===b().gY.Comments?y="Page comments":u===b().gY.Info?y="Info":u===b().gY.Updates?y="Page updates and analytics":(0,T().t1)(u),(0,d.jsxs)("div",{style:h.pane,className:g().zar,role:"dialog","aria-label":y,children:[(0,d.jsx)("div",{style:h.resizerStyle}),(0,d.jsx)(Qe,{enablePageAnalytics:p,navigableBlockStore:l,onTabChange:m}),(0,d.jsx)($e,{currentTab:u,enablePageAnalytics:p}),r&&(0,d.jsx)(U().Z,{type:"update"})]})}function tt(e){const{isElectronMac:t,currentBlockStore:i}=e,n=(0,a().VK)((()=>({width:b().default.state.width,isAnimating:b().default.state.isAnimating,canRender:b().default.state.canRender})),[]),s=(0,a().VK)((()=>L().default.state.currentSpaceStore),[]),r=(0,o.useMemo)((()=>null==s?void 0:s.clone()),[s]),l=(0,f().O7)(),{isExpanded:c,closeSidebar:u}=(0,a().VK)((()=>({isExpanded:(0,qe().Sx)(l),closeSidebar:()=>We().setUpdateExpand({environment:l,isExpanded:!1,from:"close_for_space",saveDetailsSidebarPreference:!0})})),[l]),[p,m]=(0,o.useState)(!1),[g,h]=(0,o.useState)(void 0);(0,o.useEffect)((()=>{(void 0===g||g===i.id)&&c&&(m(!0),h(i.id))}),[g,i,c]);const y=(0,a().VK)((()=>i.getAssociatedCollectionStore()),[i]);if(!(0,a().VK)((()=>{if(!n.canRender)return!1;if(r)return!0;if((0,qe().pW)()&&!l.currentUser.isLoggedIn())return!0;if(!y)return!1;const{count:e}=(0,Oe().nJ)({collectionStore:y});return e>0}),[y,n.canRender,r,l.currentUser]))return null;const v=()=>(0,d.jsx)(Je,{isElectronMac:t,isFullyExpanded:!n.isAnimating,currentBlockStore:i,isExpanded:c,closeSidebar:u,shouldLoadSidebarComponents:p});return r?(0,d.jsx)(R().Z,{store:r,droppable:!0,render:v},(null==r?void 0:r.id)||i.id):v()}var it=()=>i(839002),ot=()=>i(253502),at=()=>i(603274),nt=()=>i(573357),st=()=>i(906769),rt=()=>i(951113),lt=()=>i(118761),dt=()=>i(729201),ct=()=>i(179512),ut=()=>i(297861),pt=()=>i(781022),ft=()=>i(763589),mt=()=>i(659203),gt=()=>i(462274),ht=()=>i(383017),bt=()=>i(105285),yt=()=>i(1910),vt=()=>i(123145),xt=()=>i(738483),St=()=>i(838266),Mt=()=>i(577325);function jt(e){let{location:t}=e;const i=(0,s().YB)(),a=(0,f().O7)(),r=(0,f().Fy)(),l=(0,o.useCallback)((()=>{const{device:e}=a;ot().FR(a),e.isMobile?xt().Z.setState({open:!0,source:xt().Y.Updates}):(Mt().Z.setState({...Mt().Z.state,open:!1}),St().default.setState({...St().default.state,currentTab:"notifications",defaultSubtab:void 0}),St().default.setState({...St().default.state,open:!0}))}),[a]),c=(0,vt().dc)(),u=(0,n().yK)((e=>({mobileTopBarIcon:{height:18,width:18,fill:e.regularTextColor},webUpdatesModalIcon:{width:16,height:16},button:r.isMobile?{height:30,width:30}:c.button})),[r.isMobile,c.button]);let p;switch(t){case"mobileTopBar":p=u.mobileTopBarIcon;break;case"webUpdatesModal":p=u.webUpdatesModalIcon;break;default:(0,T().t1)(t)}return(0,d.jsx)(Se().Z,{renderTooltip:()=>(0,d.jsx)(s()._H,{defaultMessage:"Open notifications settings",id:"updatesModal.openNotifications.tooltip"}),render:e=>(0,d.jsx)(yt().Z,{style:u.button,icon:ue().H,iconStyle:p,onClick:l,ariaLabel:i.formatMessage({id:"updatesModal.openNotifications.tooltipAriaLabel",defaultMessage:"Open notifications settings button"}),...e})})}const kt=o.memo(jt);i(670560),i(30005),i(228244);var Nt=()=>i(799891),wt=()=>i(741633),_t=()=>i(779565),Tt=()=>i(269299);function Ct(e){let{isScrolledToTopWithStickyHeader:t}=e;const i=(0,n().yK)((e=>({border:{flexShrink:0,width:"100%",boxShadow:t?"0 0 0 transparent":`0 1px 0 ${e.regularDividerColor}`,transition:"box-shadow 300ms",height:2,marginTop:-14,position:"sticky",zIndex:99,top:22,paddingTop:6,backgroundColor:e.contentBackground}})),[t]);return(0,d.jsx)("div",{style:i.border})}var It=()=>i(677559);const Rt=new(It().Ss)("activityNotification",(async()=>await Promise.all([i.e(87647),i.e(6215)]).then(i.bind(i,274213)))),Ut=(0,It().kF)(Rt,(e=>e.ActivityNotification));var At=()=>i(466970),Pt=()=>i(635596),Vt=()=>i(263168),Bt=()=>i(295608),Zt=()=>i(620218);const Lt={};function Et(e){const{groupName:t}=e;switch(t){case"today":return(0,d.jsx)(s()._H,{id:"InboxTimeGroupHeader.today",defaultMessage:"Today"});case"this_week":return(0,d.jsx)(s()._H,{id:"InboxTimeGroupHeader.thisWeek",defaultMessage:"This week"});case"last_week":return(0,d.jsx)(s()._H,{id:"InboxTimeGroupHeader.lastWeek",defaultMessage:"Last week"});case"older":return(0,d.jsx)(s()._H,{id:"InboxTimeGroupHeader.older",defaultMessage:"Older"});default:(0,T().t1)(t)}}function Kt(e){const{groupName:t,shouldStickyHeader:i}=e,o=(0,n().yK)((e=>({headerContainer:{paddingTop:3,paddingBottom:3,paddingLeft:16,paddingRight:16,color:e.text.secondary,fontWeight:r().Ue.medium,fontSize:"12px",...i&&{position:"sticky",top:0,backgroundColor:e.contentBackground,zIndex:2,paddingBottom:4,paddingTop:2}}})),[i]);return(0,d.jsx)("div",{style:o.headerContainer,children:(0,d.jsx)(Et,{groupName:t})})}var Ht=()=>i(880290);const Dt=new class{constructor(){this.state=new Map,this.noOpListener=()=>{}}cacheInboxPointers(e,t,i){const o=this.state.get(t);if(o)for(const a of o)e.defaultRecordCache.inMemoryRecordCache.removeListenerToRecord(a,this.noOpListener),(0,Vt().unsubscribeAfterDelay)({environment:e,pointer:a,userId:e.currentUser.id});for(const a of i)e.defaultRecordCache.inMemoryRecordCache.addListenerToRecord(a,this.noOpListener),(0,Vt().cancelEviction)({pointer:a,userId:e.currentUser.id});this.state.set(t,i)}getNotificationIds(e){const t=this.state.get(e);if(!t)return;return t.filter((e=>e.table===_t().uX)).map((e=>e.id))}};const Ft=function(e){const[t,n]=(0,o.useState)(Math.random()),[s,r]=(0,o.useState)(20),l=(0,f().O7)(),c=(0,a().VK)((()=>i(804217).default.state.online),[]),u=(0,a().VK)((()=>{var e;return null===(e=L().default.state.currentUserStore)||void 0===e?void 0:e.id}),[]);return(0,o.useEffect)((()=>{if(u){const e=Y().P2(((e,t)=>{String(t).includes("unreadCount")||n(Math.random())}),1e3),t=(0,i(183922).Lp)(u),o=Pt().ZP.addListener(t,e,void 0,l);if(o)return()=>{Pt().ZP.removeListener(o,l)}}}),[u,l]),c?(0,d.jsx)(qt,{checkpoint:t,type:e.type,empty:e.empty,source:e.source,tab:e.tab,size:s,setSize:r,scrolledToTop:e.isScrolledToTopFromOtherSidebar}):(0,d.jsx)(Gt,{type:e.type})};function Ot(e){const t=(0,f().O7)(),i=(0,f().Fy)();return(0,n().yK)((o=>({placeholder:{...Yt(e,t),paddingTop:i.isMobile?64:void 0,minHeight:i.isMobile?void 0:220,display:"flex",textAlign:"center",alignItems:"center",justifyContent:"center",fontSize:14,color:o.regularTextColor,overflow:"hidden"}})),[i.isMobile,t,e]).placeholder}function Gt(e){let{type:t}=e;const i=Ot(t);return(0,d.jsx)("div",{style:i,children:(0,d.jsx)("div",{children:(0,d.jsx)(s()._H,{defaultMessage:"Please go online to view your inbox.",id:"notificationInbox.offline.message"})})})}function zt(e){let{request:t,error:i,result:n,type:r,empty:l,source:c,tab:u,size:p,setSize:m,scrolledToTop:g,requestType:h}=e;const b=(0,f().O7)(),y=(0,f().Fy)(),v=(0,a().VK)((()=>L().default.state.currentSpaceStore),[]),x=n??Dt.getNotificationIds(h),S=(0,a().Kw)(pt().default),M=(0,o.useContext)(Ht().B),[j,k]=(0,a().VK)((()=>{if(!x)return[[],[]];const e=[],i=v?x.map((e=>me().t1.createChildStore(v,{table:_t().uX,id:e}))):[],o=[],a=Y().oA(i.map((i=>{const a=i.getValue();if(!a)return null;if(a.invalid)return null;if("mentions"===t.type&&a.visited)return null;if("archive"===t.type&&!a.visited)return null;const n=oe().sl(i);if(!n||!n.isReady())return null;const s=n.getModel();if(!s||s.invalid)return o.push(a),null;const r=i.getDiscussionStore();if(null!=r&&r.isReady()&&"none"===(null==r?void 0:r.getRole()))return o.push(a),null;e.push(i.pointer),e.push(n.pointer),r&&e.push(r.pointer);const l=i.getNavigableBlockPointer();if(l&&e.push(l),M){if("inbox"===M&&"commented"!==a.type)return null;if("activity"===M&&"commented"===a.type)return null}return{activity:s,notification:a}}))).sort(((e,t)=>Number(t.notification.end_time)-Number(e.notification.end_time)));return Dt.cacheInboxPointers(b,h,e),[a,o]}),[x,v,b,h,t.type,M]),N=(0,a().VK)((()=>ft().Fz()),[]),w=0===(0,a().VK)((()=>ft().$x(j,t.type)),[j,t.type]).size,_=(0,At().E)("sticky_inbox_date_buckets"),C=(0,o.useCallback)((()=>{if(!v||i)return null;if(!x)return null;const e=[];let t=[];const a=ft().mx();let n;return j.forEach(((i,s,r)=>{let{activity:l,notification:p}=i;const f={source:c,tab:u,notification:p},m=Number(p.end_time),h=a.findIndex((e=>{const{cutoffTime:t}=e;return void 0===t||t<=m}));if(h!==n){const i=a[h].name,s=_&&!y.isMobile;s&&0===e.length&&e.push((0,d.jsx)(Ct,{isScrolledToTopWithStickyHeader:g},`${i}-sticky-header`)),e.push((0,d.jsx)("div",{children:t},`${i}-section-name`)),t=[(0,d.jsxs)(o.Fragment,{children:[1!==e.length&&(0,d.jsx)("div",{style:{height:8}}),(0,d.jsx)(Kt,{groupName:i,shouldStickyHeader:s})]},`${i}-inbox-group-section`)],n=h}t.push((0,d.jsx)(Ut,{activity:l,rootStore:v,isFirst:!1,isLast:!1,tabArgs:f},l.id))})),e.push((0,d.jsx)("div",{children:t},"time-grouping")),e}),[v,i,x,j,c,u,_,y.isMobile,g]),I=(0,It().XJ)(Rt);(0,o.useEffect)((()=>{if(!v)return;!function(e,t,i){const o=e.filter((e=>!e.read));0!==o.length&&(Nt().log({level:"warning",from:"NotificationInbox",type:"invalidNotificationData",data:{ids:o.map((e=>e.id))}}),Tt().createAndCommit({userAction:"NotificationUpdates.unreadNotificationNotRendered",environment:i,canUndo:!0,perform:e=>{for(const i of o)at().$h({notification:i,rootStore:t,transaction:e,read:!0})}}))}(k,v,b);const e=j.some((e=>{let{notification:t}=e;return!t.read&&!t.visited})),t=e&&j.some((e=>{let{notification:t}=e;return t.read&&!t.visited}));switch(N){case"unread_and_read":case"unread_only":pt().default.setState({...S,currentTab:"mentions",isCurrentTabEmpty:w,containsBothReadAndUnreadNotifications:t,containsUnreadNotifications:e,showOnlyUnreadNotifications:"unread_only"===N,unreadNotificationIds:[]});break;case"archived_only":pt().default.setState({...S,isCurrentTabEmpty:w,currentTab:"archive"});break;case"all_updates":break;default:(0,T().t1)(N)}}),[N,S,w,j,v,b,k]);const R=Ot(r);return!v||i?(0,d.jsx)("div",{style:R,children:(0,d.jsx)(s()._H,{defaultMessage:"Something went wrong.",id:"notificationUpdates.unknownErrorMessage"})}):x&&"resolved"===I.status?(0,d.jsxs)("div",{style:w?R:Yt(r,b),children:[w&&l,(0,d.jsx)("section",{role:"feed",className:"notranslate",children:C()}),(0,d.jsx)(st().Z,{onChange:e=>{if(!y.isMobile&&"closed"===ft().T6())return null;e<200&&x.length>=p&&m(x.length+20)}})]}):(0,d.jsx)("div",{style:Yt(r,b),children:(0,d.jsx)(A().B,{areaHeight:window.innerHeight})})}function Wt(e){const t=(0,f().O7)();return(0,o.useEffect)((()=>{void 0!==e.requestId&&function(e,t){if(!(e in Lt))return;const i=Lt[e];if(i.measured)return;i.measured=!0;const{startTime:o,size:a,type:n}=i;Zt().default.DO_NOT_USE_measureLegacy({metricName:"notification_render",startTime:o},{environment:t,data:{size:a,type:n}})}(e.requestId,t)}),[e.requestId,t]),(0,d.jsx)(d.Fragment,{children:e.children})}function qt(e){const{type:t,empty:i,source:n,tab:s,size:r,setSize:l,scrolledToTop:c,checkpoint:u}=e,p=(0,f().O7)(),{currentUserStore:m,currentSpaceStore:g}=(0,a().VK)((()=>{const{currentUserStore:e,currentSpaceStore:t}=L().default.state;return{currentUserStore:e,currentSpaceStore:t}}),[]),h=(0,a().VK)((()=>"unread_only"===ft().Fz()),[]),[b,y]=(0,o.useState)(u),v=(0,o.useMemo)((()=>function(e,t){switch(e){case"mentions":return t?"unread_only":"unread_and_read";case"archive":return"archived";default:(0,T().t1)(e)}}(t,h)),[t,h]),[x,S]=(0,O().r5)((async()=>{if(!m||!g)return null;const e=m.id,i=g.id,o=pt().default.startLoading();var a,n;n={size:r,type:t},(a=o)in Lt||(Lt[a]={measured:!1,startTime:performance.now(),size:n.size,type:n.type});const s=await J().callApi({eventName:"getNotificationLogV2",environment:p,data:{spaceId:i,size:r,type:v,variant:"no_grouping"},userId:e,headers:(0,wt().Bb)({spaceId:i})});if(pt().default.endLoading(o),"failed"===s.type)throw s.error;return{notificationIds:s.data.notificationIds,requestId:o}}),[g,m,p,v,r,t],{throttle:1e3});if((0,o.useEffect)((()=>{u!==b&&(S(),y(u))}),[u,b,S]),!m||!g||!x)return null;const M=g.id,j=m.id,{value:k,error:N}=x,w={spaceId:M,userId:j,type:t};return Bt().setState({request:w,result:null==k?void 0:k.notificationIds}),(0,d.jsx)(Wt,{requestId:null==k?void 0:k.requestId,children:(0,d.jsx)(zt,{type:t,requestType:v,empty:i,source:n,tab:s,size:r,setSize:l,request:w,error:N,result:null==k?void 0:k.notificationIds,scrolledToTop:c})})}function Yt(e,t){const{device:i}=t;return{minHeight:i.isMobile||"mentions"===e?void 0:"75vh"}}function Xt(e){const t=(0,f().Fy)(),i=(0,f().O7)();(0,o.useEffect)((()=>()=>(ot().nI(i),void at().G7({environment:i,newTab:"mentions",shouldTrack:!1}))),[i]);const a=(0,n().yK)((e=>({chevron:{fill:e.regularTextColor,width:26,height:26},padding:{width:1}})),[]);let s;if(t.isMobile){const i="mobileTopBar";s={menuType:k().o.Modal,title:(0,d.jsx)(bt().Q,{}),width:e.format===lt().EX.RenderAsPage?"100vw":void 0,renderAsPage:e.format===lt().EX.RenderAsPage,leftRightButtonStyle:{paddingRight:14},right:[(0,d.jsx)(kt,{location:i},"InboxNotificationSettingsButton"),(0,d.jsx)("span",{style:a.padding},"paddingSpan2"),(0,d.jsx)(ht().$,{},"InboxFilterButton"),(0,d.jsx)("span",{style:a.padding},"paddingSpan1"),(0,d.jsx)(mt().p,{},"InboxEllipsisButton")],left:[(0,d.jsx)(Qt,{},"loading-spinner"),t.isPhone&&(0,ut().Y)("supportsNativeHome")&&e.format===lt().EX.RenderAsPage&&!(0,ut().Y)("supportsNativeInbox")?void 0:(0,ct().k)(a.chevron)],onClickLeft:e.onClose,whiteBackground:!0,disableHeaderShadow:!0}}else s={menuType:k().o.Popup,height:"auto"};return(0,d.jsxs)(p().Z,{...s,className:g().C18,children:[(0,d.jsx)(st().Z,{onChange:(e,t)=>{let{offsetFromTop:i}=t;pt().n.setState(i<=0)}}),(0,d.jsx)(nt().Z,{capture:!0,allowUndo:!0,allowEsc:!0,allowMobileAutoScroll:!0,render:()=>e.format===lt().EX.RenderAsPage?(0,d.jsx)(Jt,{}):(0,d.jsx)($t,{})})]})}function $t(){const e=(0,a().VK)((()=>{var e;return null===(e=L().default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),t=(0,a().VK)((()=>ft().Fz()),[]),i={emptyState:{marginTop:100,cursor:"auto"}};return(0,d.jsx)(d.Fragment,{children:"all_updates"!==t?(0,d.jsx)(Ft,{type:"archived_only"===t?"archive":"mentions",source:"notifications_tab",tab:"inbox",empty:(0,d.jsx)("div",{style:i.emptyState,children:(0,d.jsx)(gt().o,{})})},t):e&&(0,d.jsx)(u().Z,{spaceId:e,source:"notifications_tab",empty:()=>(0,d.jsx)("div",{style:i.emptyState,children:(0,d.jsx)(gt().o,{})})},t)})}function Jt(){const e=(0,f().O7)();return(0,d.jsx)(rt().Z,{fetch:async()=>{await it().Vs(0),await L().default.waitUntil((()=>void 0!==L().default.state.currentSpaceStore))},loading:()=>(0,d.jsx)(o.Fragment,{}),willRender:()=>{var t;null===(t=e.mobileNative)||void 0===t||t.markTransitionReady({type:"updates"})},render:()=>(0,d.jsx)(I().Z,{initial:{opacity:0},animate:{opacity:1},children:(0,d.jsx)($t,{})})})}function Qt(){const e=(0,a().VK)((()=>void 0!==pt().default.state.loadingId),[]),t=(0,dt().Z)(e,400,0);return(0,ut().Y)("supportsNativeHome")?t?(0,d.jsx)(ve().Z,{style:{width:14}}):(0,d.jsx)("div",{style:{width:14}}):null}var ei=()=>i(156216);function ti(e){let{location:t}=e;const r=(0,s().YB)(),l=(0,f().O7)(),{currentTab:c,showOnlyUnreadNotifications:u,isCurrentTabEmpty:p}=(0,a().VK)((()=>{const{currentTab:e,isCurrentTabEmpty:t}=pt().default.state;return{currentTab:e,showOnlyUnreadNotifications:"mentions"===e&&pt().default.state.showOnlyUnreadNotifications,isCurrentTabEmpty:t}}),[]),m=(0,o.useCallback)((async()=>{if(u)pt().default.update((e=>({...e,showOnlyUnreadNotifications:!1,unreadNotificationIds:[]}))),ot().U0(l,{toggled_to:"off"});else{const e=await at().Qy({environment:l});pt().default.update((t=>({...t,showOnlyUnreadNotifications:!0,unreadNotificationIds:e}))),ot().U0(l,{toggled_to:"on"})}}),[l,u]),g=(0,n().yK)((e=>({mobileTopBarIcon:{height:18,width:18,fill:u?void 0:e.regularTextColor},webUpdatesModalIcon:{height:17,width:17},desktopInboxPanelIcon:{height:18,width:18,...!u&&{fill:e.regularTextColor}}})),[u]);if("mentions"!==c)return null;const h=!u&&p,b=u?(0,d.jsx)(s()._H,{defaultMessage:"Show all notifications",id:"updatesModal.unreadNotificationsFilterButton.allTooltip"}):(0,d.jsx)(s()._H,{defaultMessage:"Show unread notifications only",id:"updatesModal.unreadNotificationsFilterButton.unreadTooltip"}),y=u?r.formatMessage({defaultMessage:"Show all notifications",id:"updatesModal.unreadNotificationsFilterButton.allTooltipAriaLabel"}):r.formatMessage({defaultMessage:"Show unread notifications only",id:"updatesModal.unreadNotificationsFilterButton.unreadTooltipAriaLabel"});let v,x;switch(t){case"mobileTopBar":v=void 0,x=g.mobileTopBarIcon;break;case"webUpdatesModal":v=!!u||void 0,g.webUpdatesModalIcon;break;case"desktopInboxPanel":v=!!u||void 0,x=g.desktopInboxPanelIcon;break;default:(0,T().t1)(t)}return(0,d.jsx)(Se().Z,{disableTooltip:h,renderTooltip:()=>b,render:e=>(0,d.jsx)(yt().Z,{icon:i(783310).I,isBlue:u,hovered:v,iconStyle:x,disabled:h,onClick:m,ariaLabel:y,...e})})}const ii=o.memo(ti);var oi=()=>i(453382);const ai=(0,i(827282).IU)("mailOpen",{viewBox:"0 0 16 16",svg:(0,d.jsx)("path",{d:"M2.88965 15.9277C2.17415 15.9277 1.63639 15.75 1.27637 15.3945C0.920898 15.0436 0.743164 14.515 0.743164 13.8086V7.00684C0.743164 6.76074 0.756836 6.54427 0.78418 6.35742C0.816081 6.17057 0.863932 6.00423 0.927734 5.8584C0.996094 5.71257 1.08496 5.57812 1.19434 5.45508C1.30371 5.32747 1.43815 5.19987 1.59766 5.07227L6.88184 0.916016C7.12793 0.715495 7.36035 0.558268 7.5791 0.444336C7.80241 0.325846 8.03939 0.266602 8.29004 0.266602C8.54069 0.266602 8.77539 0.325846 8.99414 0.444336C9.21745 0.558268 9.45215 0.715495 9.69824 0.916016L14.9824 5.07227C15.1419 5.19987 15.2764 5.32747 15.3857 5.45508C15.4951 5.57812 15.5817 5.71257 15.6455 5.8584C15.7139 6.00423 15.7617 6.17057 15.7891 6.35742C15.821 6.54427 15.8369 6.76074 15.8369 7.00684V13.8086C15.8369 14.515 15.6569 15.0436 15.2969 15.3945C14.9414 15.75 14.4059 15.9277 13.6904 15.9277H2.88965ZM2.84863 14.8818H13.7314C14.0687 14.8818 14.3285 14.7907 14.5107 14.6084C14.6976 14.4307 14.791 14.1641 14.791 13.8086V6.82227C14.791 6.6582 14.7751 6.51921 14.7432 6.40527C14.7113 6.29134 14.6611 6.19108 14.5928 6.10449C14.529 6.01335 14.4424 5.92448 14.333 5.83789L9.11035 1.76367C8.94173 1.63607 8.80046 1.53809 8.68652 1.46973C8.57259 1.39681 8.44043 1.36035 8.29004 1.36035C8.13965 1.36035 8.00749 1.39681 7.89355 1.46973C7.77962 1.53809 7.63835 1.63607 7.46973 1.76367L2.24707 5.83789C2.1377 5.92448 2.04883 6.01335 1.98047 6.10449C1.91667 6.19108 1.86882 6.29134 1.83691 6.40527C1.80501 6.51921 1.78906 6.6582 1.78906 6.82227V13.8086C1.78906 14.1641 1.88021 14.4307 2.0625 14.6084C2.24479 14.7907 2.50684 14.8818 2.84863 14.8818ZM1.51562 14.6357L6.88184 9.37207C7.11882 9.13509 7.35352 8.96419 7.58594 8.85938C7.82292 8.75456 8.06217 8.70215 8.30371 8.70215C8.54525 8.70215 8.78223 8.75456 9.01465 8.85938C9.24707 8.96419 9.48405 9.13509 9.72559 9.37207L15.085 14.6357L14.374 15.3467L9.13086 10.1787C8.98047 10.0283 8.83691 9.92122 8.7002 9.85742C8.56803 9.78906 8.43587 9.75488 8.30371 9.75488C8.16699 9.75488 8.03027 9.78906 7.89355 9.85742C7.76139 9.92122 7.6224 10.0283 7.47656 10.1787L2.2334 15.3467L1.51562 14.6357ZM5.81543 10.6094L1.5498 6.3916L2.26074 5.68066L6.5332 9.90527L5.81543 10.6094ZM10.0742 9.90527L14.3398 5.68066L15.0508 6.3916L10.7852 10.6094L10.0742 9.90527Z"})});var ni=()=>i(704259);function si(e){let{}=e;const t=(0,f().Fy)(),i=(0,f().O7)(),r=(0,a().Kw)(pt().n),l=(0,a().VK)((()=>{const{currentTab:e,isCurrentTabEmpty:t}=pt().default.state;if("mentions"!==e||t)return;const{containsBothReadAndUnreadNotifications:i,containsUnreadNotifications:o,showOnlyUnreadNotifications:a}=pt().default.state;return{containsBothReadAndUnreadNotifications:i,containsUnreadNotificationsAccordingToUpdatesStore:o,showOnlyUnreadNotifications:a}}),[]),c=(0,a().VK)((()=>ni().default.getUnreadCountForCurrentSpace().mentions>0),[]),u=(0,o.useCallback)((()=>{ot().Xf(i),at().go(i)}),[i]),p=(0,o.useCallback)((()=>{if(!l)return;const{containsBothReadAndUnreadNotifications:e,showOnlyUnreadNotifications:t}=l;let o="none";t?o="unread":e&&(o="read"),ot().zD(i,{readFilter:o}),at().rG(i,"mentions",o)}),[i,l]),m=(0,n().yK)((e=>{const i={opacity:1,flex:1,height:t.isMobile?32:27,fontSize:14};return{headerWithBottomBorder:{borderBottom:r?void 0:`1px solid ${e.regularDividerColor}`},container:{display:"flex",marginTop:t.isMobile?12:0,marginLeft:16,marginRight:16,paddingBottom:12,gap:8},buttons:i,buttonsWithLoweredOpacity:{...i,opacity:.7}}}),[t.isMobile,r]);if(!l)return null;const{containsBothReadAndUnreadNotifications:g,containsUnreadNotificationsAccordingToUpdatesStore:h,showOnlyUnreadNotifications:b}=l,y=h||c;return(0,d.jsx)("div",{style:m.headerWithBottomBorder,children:(0,d.jsxs)("div",{style:m.container,children:[(0,d.jsx)(Se().Z,{disableTooltip:y,renderTooltip:e=>(0,d.jsx)("div",{...e,children:(0,d.jsx)(s()._H,{defaultMessage:"All notifications have been marked as read.",id:"updatesModal.spaceUpdatesTab.markAllReadButton.disabledTooltip"})}),render:e=>(0,d.jsx)(xe().Z,{onClick:u,style:y?m.buttons:m.buttonsWithLoweredOpacity,isSmall:!t.isMobile,disabled:!y,icon:ai,...e,children:(0,d.jsx)(s()._H,{defaultMessage:"Mark all as read",id:"updatesModal.spaceUpdates.mentionsTab.markAllReadButtonTitle"})})}),(0,d.jsx)(xe().Z,{onClick:p,style:m.buttons,isSmall:!t.isMobile,icon:oi().H,children:b?(0,d.jsx)(s()._H,{defaultMessage:"Archive unread",id:"updatesModal.spaceUpdates.mentionsTab.archiveUnreadButtonTitle"}):g?(0,d.jsx)(s()._H,{defaultMessage:"Archive read",id:"updatesModal.spaceUpdates.mentionsTab.archiveReadButtonTitle"}):(0,d.jsx)(s()._H,{defaultMessage:"Archive all",id:"updatesModal.spaceUpdates.mentionsTab.archiveAllButtonTitle"})})]})})}const ri=o.memo(si);var li=()=>i(621811);function di(e){let{location:t,onClick:o}=e;const r=(0,s().YB)(),l=(0,a().VK)((()=>pt().default.state.currentTab),[]),c=(0,n().yK)((e=>({mobileTopBarIcon:{height:18,width:18,fill:e.regularTextColor},webUpdatesModalIcon:{height:17,width:17}})),[]);if("allPages"!==l)return null;let u;switch(t){case"mobileTopBar":u=c.mobileTopBarIcon;break;case"webUpdatesModal":u=c.webUpdatesModalIcon;break;default:(0,T().t1)(t)}return(0,d.jsx)(Se().Z,{renderTooltip:()=>(0,d.jsx)(s()._H,{defaultMessage:"Refresh",id:"updatesModal.allUpdatesRefreshButton.refreshButtonDescription"}),render:e=>(0,d.jsx)(yt().Z,{icon:i(345192).n,iconStyle:u,onClick:o,ariaLabel:r.formatMessage({defaultMessage:"Refresh",id:"updatesModal.allUpdatesRefreshButton.refreshButtonDescriptionAriaLabel"}),...e})})}const ci=o.memo(di);function ui(e){let{orderedTabConfigs:t,onClickRefreshAllTab:l}=e;const c=(0,f().Fy)(),u=(0,f().O7)(),{currentTab:p,currentTabIndex:m}=(0,a().VK)((()=>{const{currentTab:e}=pt().default.state,i=t.findIndex((t=>t.tab===e));return{currentTab:e,currentTabIndex:i}}),[t]),h=(0,o.useMemo)((()=>t.map(((e,t)=>{if(e.showSeparatorBefore)return t-1})).filter(T().$K)),[t]),b=(0,a().VK)((()=>ni().default.getUnreadCountForCurrentSpace().mentions>0),[]),y=(0,o.useCallback)((e=>{const i=t[e],o=null==i?void 0:i.tab;o&&p!==o&&at().G7({environment:u,newTab:o,shouldTrack:!0})}),[p,u,t]),v=(0,n().yK)((()=>({mentionsContainer:{display:"flex",alignItems:"center",justifyContent:"center",fontWeight:b?r().Ue.medium:void 0},tabBarRightStyle:{justifyContent:"space-between"},helpButton:{marginLeft:0,...c.isMobile&&{marginTop:-1}},unreadMentionsBadge:{marginLeft:6},actionButtons:{display:"flex",justifyContent:"center",gap:6}})),[c.isMobile,b]),x=i(12530).N.Red,M={mentions:(0,d.jsxs)("div",{style:v.mentionsContainer,className:g().I2F,children:[(0,d.jsx)("div",{children:(0,d.jsx)(s()._H,{defaultMessage:"Inbox",id:"updatesModal.mentionsTab.title"})}),(0,d.jsx)(li().Z,{type:"currentSpace",color:x,style:v.unreadMentionsBadge})]}),allPages:(0,d.jsx)("div",{className:g().gjL,children:(0,d.jsx)(s()._H,{defaultMessage:"All",id:"updatesModal.allUpdatesTab.title"})}),archive:(0,d.jsx)("div",{className:g().HKr,children:(0,d.jsx)(s()._H,{defaultMessage:"Archived",id:"updatesModal.archiveTab.title"})})},j=t.map((e=>M[e.tab])),k="webUpdatesModal",N=!c.isMobile&&(0,d.jsxs)("div",{style:v.actionButtons,children:[(0,d.jsx)(ci,{location:k,onClick:l}),(0,d.jsx)(ii,{location:k}),(0,d.jsx)(kt,{location:k})]}),w=(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(Se().Z,{render:e=>(0,d.jsx)(i(360964).Z,{href:(0,ae().UY)("guides.notifications"),analyticsFrom:"inbox_tabs_link",style:v.helpButton,...e}),renderTooltip:()=>(0,d.jsx)(s()._H,{id:"updatesButton.learnMoreAboutInboxLink",defaultMessage:"Learn more about notifications"})}),N]});return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(S().Z,{tabs:j,selectedIndex:m,onChange:y,separatorIndexes:h,right:w,rightStyle:v.tabBarRightStyle}),"mentions"===p&&(0,d.jsx)(ri,{})]})}const pi=o.memo(ui);var fi=()=>i(938938),mi=()=>i(745740),gi=()=>i(369954),hi=()=>i(333264),bi=()=>i(953293),yi=()=>i(14801),vi=()=>i(105649),xi=()=>i(561280);function Si(){const e=(0,n().yK)((e=>({button:{display:"flex",justifyContent:"center",alignItems:"center",gap:6,height:36,width:174,position:"absolute",left:"50%",marginLeft:-87,bottom:12,zIndex:20,borderRadius:18,background:e.blueColor,color:e.white,boxShadow:e.buttonBoxShadow,fontSize:14},hovered:{background:e.blueButtonHoveredBackground},pressed:{background:e.blueButtonPressedBackground},icon:{width:16,height:16}})),[]);return(0,d.jsxs)(mi().Z,{style:e.button,hoveredStyle:e.hovered,pressedStyle:e.pressed,href:"https://dev.notion.so/notion/346c06d81dbf4cf188bf44fcef6a6a62?v=fa0376c6fb2a40f0b77d68b683f73e5b&pvs=4",external:!0,children:[(0,bi().R)(e.icon),(0,d.jsx)("div",{children:"Provide Feedback"})]})}function Mi(){const e=(0,a().VK)((()=>{const{currentSpaceStore:e}=L().default.state;if(e)return e.id}),[]),t=(0,a().VK)((()=>!1),[]),i=(0,a().VK)((()=>vt().l_()),[]),s=(0,a().VK)((()=>vi().default.state.mode),[]),r=(0,a().VK)((()=>ft().Fz()),[]),{isTablet:l}=(0,f().Fy)(),c=(0,At().E)("tablet_refresh_gate"),p=(0,n().yK)((e=>({container:{flexDirection:"column",width:"100%",display:"flex",marginTop:l&&c?12:void 0},scroller:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",marginRight:0,pointerEvents:"auto",width:"100%",..."peek"===s?{}:{minWidth:i}},emptyState:{marginTop:100,cursor:"auto"}})),[i,s,l,c]),m=(0,a().qz)(void 0,xi().Z),g=(0,a().VK)((()=>m.state.elementRef??{current:null}),[m]),h=0===(0,hi().j)(g),b=(0,o.useContext)(Ht().B),y=(0,At().E)("sticky_inbox_date_buckets");return(0,d.jsxs)("div",{style:p.container,children:[(0,d.jsx)(yi().A,{type:b??"inbox"}),!y&&(0,d.jsx)(gi().A,{scrollerStore:m}),(0,d.jsxs)(E().Z,{type:Z().Z.Y,style:p.scroller,store:m,children:[(0,d.jsx)(st().Z,{onChange:(e,t)=>{let{offsetFromTop:i}=t;pt().n.setState(i<=0)}}),"all_updates"!==r?(0,d.jsx)(Ft,{type:"archived_only"===r?"archive":"mentions",source:"notifications_tab",tab:"inbox",empty:(0,d.jsx)("div",{style:p.emptyState,children:(0,d.jsx)(gt().o,{})}),isScrolledToTopFromOtherSidebar:h},r):e&&(0,d.jsx)(u().Z,{spaceId:e,source:"notifications_tab",empty:()=>(0,d.jsx)("div",{style:p.emptyState,children:(0,d.jsx)(gt().o,{})})},r)]}),t&&(0,d.jsx)(Si,{})]})}var ji=()=>i(949842);function ki(e){const{notificationActivityPairs:t}=e,l=t.map((e=>{let{notification:t}=e;return t})),c=(0,f().O7)(),u=(0,f().Fy)(),p=(0,s().YB)(),m=l?l[0]:void 0,g=(0,a().VK)((()=>l.every((e=>e.read))),[l]),h=(0,a().VK)((()=>ft().Fz()),[]),[b,y]=(0,o.useState)(!1),v=(0,o.useCallback)((e=>{l&&m&&(0,ji().ZP)({event:e,context:ji().Af.NotificationClick,callback:()=>{y(!0);const e=l.map((e=>{let{id:t}=e;return t}));(async()=>{try{await J().callApi({eventName:"setNotificationsStatus",environment:c,data:{spaceId:m.space_id,notificationIds:e,archived:!0}})}finally{y(!1)}})();const i=l.filter((e=>!e.read));at().Jl("mentions",m.space_id,(e=>Math.max(e-i.length,0))),ot().Ee(c,{target:"archive",affectedNotificationIds:e,notificationActivityPairs:t})}})}),[c,l,m,t]),x=(0,o.useCallback)((e=>{l&&m&&(0,ji().ZP)({event:e,context:ji().Af.NotificationClick,callback:()=>{let e;if(y(!0),g){const i=l.map((e=>{let{id:t}=e;return t}));e=async()=>{try{await J().callApi({eventName:"setNotificationsStatus",environment:c,data:{spaceId:m.space_id,notificationIds:i,read:!1}})}finally{y(!1)}},at().Jl("mentions",m.space_id,(e=>e+i.length)),ot().Ee(c,{target:"mark_as_unread",affectedNotificationIds:i,notificationActivityPairs:t})}else{const i=l.filter((e=>!e.read)).map((e=>{let{id:t}=e;return t}));e=async()=>{try{await J().callApi({eventName:"setNotificationsStatus",environment:c,data:{spaceId:m.space_id,notificationIds:i,read:!0}})}finally{y(!1)}},at().Jl("mentions",m.space_id,(e=>Math.max(e-i.length,0))),ot().Ee(c,{target:"mark_as_read",affectedNotificationIds:i,notificationActivityPairs:t})}e()}})}),[c,l,m,g,t]),S=(0,n().yK)((e=>({container:{display:"flex",height:"min-content",padding:u.isMobile?0:2,borderWidth:u.isMobile?0:1,borderStyle:"solid",borderColor:u.isMobile?"transparent":e.stroke.primary,background:u.isMobile?"transparent":e.surface.elevated,borderRadius:6},button:{height:u.isMobile?30:26,width:u.isMobile?30:26},inboxIconBase:{fill:e.icon.secondary,stroke:e.icon.secondary,strokeOpacity:1,strokeWidth:.25},iconStyle:{fill:e.mediumIconColor,padding:2},readIcon:{width:u.isMobile?21:19,height:u.isMobile?22:20},archiveIcon:{width:u.isMobile?24:23,height:u.isMobile?24:23},ellipsisIcon:{width:u.isMobile?24:23,height:u.isMobile?24:23},headerLabel:{paddingLeft:16,paddingRight:16,paddingTop:10,fontWeight:r().Ue.semibold}})),[u]);return m?"archived_only"===h?null:(0,d.jsxs)("div",{style:S.container,children:[(0,d.jsx)(Se().Z,{renderTooltip:()=>(0,d.jsx)(s()._H,{...Ni.archiveNotificationGroup}),render:e=>(0,d.jsx)(yt().Z,{ariaLabel:p.formatMessage(Ni.archiveNotificationGroup),style:S.button,icon:oi().H,iconStyle:{...S.iconStyle,...S.archiveIcon,height:18,width:18,...S.inboxIconBase},onClick:v,disabled:b,...e})}),(0,d.jsx)(Se().Z,{renderTooltip:()=>g?(0,d.jsx)(s()._H,{...Ni.markNotificationGroupAsUnread}):(0,d.jsx)(s()._H,{...Ni.markNotificationGroupAsRead}),render:e=>(0,d.jsx)(yt().Z,{ariaLabel:g?p.formatMessage(Ni.markNotificationGroupAsUnread):p.formatMessage(Ni.markNotificationGroupAsRead),style:S.button,icon:g?i(688026).F:i(138876).F,iconStyle:{...S.iconStyle,...S.readIcon,...g?{height:17,width:17}:{height:16,width:16},...S.inboxIconBase},onClick:x,disabled:b,...e})})]}):null}const Ni=(0,s().vU)({markNotificationGroupAsRead:{defaultMessage:"Mark notifications in this page as read",id:"NotificationGroupActionsMenu.markNotificationAsRead.tooltipMessage"},markNotificationGroupAsUnread:{defaultMessage:"Mark notifications in this page as unread",id:"NotificationGroupActionsMenu.markNotificationAsUnread.tooltipMessage"},archiveNotificationGroup:{defaultMessage:"Archive notifications in this page",id:"NotificationGroupActionsMenu.handleArchive.tooltipMessage"},changePageNotificationSettings:{defaultMessage:"Change page notification settings",id:"NotificationGroupActionsMenu.notificationSettings.tooltipMessage"}}),wi=o.memo(ki)},585742:(e,t,i)=>{"use strict";i.d(t,{W:()=>a});class o extends(()=>i(442))().Z{}const a=new o},309672:(e,t,i)=>{"use strict";i.d(t,{$2:()=>re,Bg:()=>ae,P6:()=>B,Qs:()=>E,VP:()=>se,W9:()=>oe,Wy:()=>te,XW:()=>Z,_2:()=>J,_u:()=>ie,bC:()=>L,gt:()=>$,iR:()=>z,jQ:()=>ne,kU:()=>Q,oP:()=>H,qJ:()=>V,rn:()=>O,sn:()=>D,tA:()=>q,v4:()=>ee});i(670560),i(267602),i(653476),i(30005),i(241792);var o=()=>i(513670),a=()=>i(696459),n=()=>i(326966),s=()=>i(816512),r=()=>i(731424),l=()=>i(156642),d=()=>i(163262),c=()=>i(552221),u=()=>i(226413),p=()=>i(532850),f=()=>i(803021),m=()=>i(646574),g=()=>i(109477),h=()=>i(22183),b=()=>i(942275),y=()=>i(321160),v=()=>i(530980),x=()=>i(528514),S=()=>i(375255),M=()=>i(548347),j=()=>i(494616),k=()=>i(396136),N=()=>i(696056),w=()=>i(752778),_=()=>i(255933),T=()=>i(458196),C=()=>i(306164),I=()=>i(989478),R=()=>i(955620),U=()=>i(499110),A=()=>i(501274),P=()=>i(496205);const V=(0,i(788860).vU)({defaultPluralizedUserNames:{defaultMessage:"Someone",id:"pushNotification.pluralizedUserNames.defaultLabel"},defaultPermissionGroupName:{defaultMessage:"Deleted group",id:"pushNotification.permissionGroupName.defaultLabel"},defaultPageName:{defaultMessage:"a Notion page",id:"pushNotification.pageName.defaultLabel"},untitledPermissionGroupName:{defaultMessage:"Untitled group",id:"pushNotification.permissionGroupName.untitledLabel"},userEditedPermissionGroup:{defaultMessage:"{userName} edited {permissionGroupName}",id:"pushNotification.userEditedTarget.label"},userDeletedPermissionGroup:{defaultMessage:"{userName} deleted {permissionGroupName}",id:"pushNotification.userDeletedTarget.label"},userCreatedPermissionGroup:{defaultMessage:"{userName} created {permissionGroupName}",id:"pushNotification.userCreatedTarget.label"},unknownAuthor:{defaultMessage:"Unknown author",id:"pushNotification.authorPhrase.unknown"},untitledSpaceName:{defaultMessage:"Untitled",id:"pushNotification.untitledSpaceName.label"},untitledTeamName:{defaultMessage:"Untitled",id:"pushNotification.untitledTeamName.label"},untitledCollectionName:{defaultMessage:"Untitled",id:"pushNotification.untitledCollectionName.placeholder"},untitledBlockTitle:{defaultMessage:"Untitled",id:"pushNotification.untitledBlockTitle.placeholder"},twoUserNames:{defaultMessage:"{firstAuthor} and {secondAuthor}",id:"pushNotification.twoUserNames.label"},threePlusUserNames:{defaultMessage:"{othersCount, plural, one {{firstAuthor} and {othersCount} other} other {{firstAuthor} and {othersCount} others}}",id:"pushNotification.threePlusUserNames.label"},editorPermissionLabel:{defaultMessage:"Full access",id:"pushNotifications.editorPermissionLevel.label"},readerPermissionLabel:{defaultMessage:"Read only",id:"pushNotifications.readerPermissionLevel.label"},editOnlyPermissionLabel:{defaultMessage:"Edit only",id:"pushNotifications.editOnlyPermissionLevel.label"},editPermissionLabel:{defaultMessage:"Edit",id:"pushNotifications.editPermissionLevel.label"},commentOnlyPermissionLabel:{defaultMessage:"Comment only",id:"pushNotifications.commentOnlyPermissionLevel.label"},noAccessPermissionLabel:{defaultMessage:"No access",id:"pushNotifications.noAccessPermissionLevel.label"},publicPermissionRoleLabel:{defaultMessage:"Public ({permissionLevel})",id:"pushNotifications.publicPermissions.label"},userNameWithRole:{defaultMessage:"{userName} ({permissionLevel})",id:"pushNotifications.userPermissionsWithRole.label"},botNameWithRole:{defaultMessage:"{botName} ({permissionLevel})",id:"pushNotifications.botPermissionsWithRole.label"},spaceNameWithRole:{defaultMessage:"{spaceName} ({permissionLevel})",id:"pushNotifications.spacePermissionsWithRole.label"},imageInPushNotification:{defaultMessage:"{imageEmoji} Image",id:"pushNotification.imageInPushNotification.placeholder"},topLevelBlockCreated:{defaultMessage:"{userName} created {targetName} in {spaceName}",id:"pushNotification.userCreatedBlockInSpace.message"},topLevelBlockDeleted:{defaultMessage:"{userName} deleted {targetName} in {spaceName}",id:"pushNotification.userDeletedBlockInSpace.message"},collectionRowCreated:{defaultMessage:"{userName} created {targetName} in {collectionName}",id:"pushNotification.userCreatedRowInCollection.message"},collectionRowDeleted:{defaultMessage:"{userName} deleted {targetName} in {collectionName}",id:"pushNotification.userDeletedRowInCollection.message"},emptyBlockEditedProperty:{defaultMessage:"Empty",id:"pushNotification.emptyBlockPropertyValueEdited.placeholderLabel"},propertyNameAndValueEdited:{defaultMessage:"{propertyName} ({propertyValue})",id:"pushNotification.propertyNameWithEditedValue.notificationSubject"},propertyNameAndValueNotificationBody:{defaultMessage:"{propertyName} ({propertyValue})",id:"pushNotification.propertyNameWithEditedValue.notificationBody"},blockDeletedEditBody:{defaultMessage:"[Deleted] {renderedBlock}",id:"pushNotification.deletedBlock.notificationContents"},blockEditedNotification:{defaultMessage:"{userName} edited {blockName}",id:"pushNotification.blockEdited.notificationSubject"},blockPropertyEditedNotification:{defaultMessage:"{userName} edited {blockName}",id:"pushNotification.blockPropertyEdited.notificationSubject"},mobileBlockPropertyEditedNotification:{defaultMessage:"{userName} edited",id:"pushNotification.mobileBlockPropertyEdited.notificationSubject"},userEditedPermissionsFor:{defaultMessage:"{userName} edited permissions for {targetName}",id:"pushNotifications.permissionsEditedForPageOrSpace.notificationSubject"},userMentionedIn:{defaultMessage:"{userName} mentioned you in {targetName}",id:"pushNotifications.userMentionedInPage.notificationSubject"},mobileUserMentionedIn:{defaultMessage:"{userName} mentioned you",id:"pushNotifications.mobileUserMentionedInPage.notificationSubject"},permissionGroupMentionedIn:{defaultMessage:"{userName} mentioned {groupName} in {targetName}",id:"pushNotifications.groupMentionedInPage.notificationSubject"},teamMentionedIn:{defaultMessage:"{userName} mentioned {teamName} in {targetName}",id:"pushNotifications.teamMentionedInPage.notificationSubject"},userDeletedComment:{defaultMessage:"[Deleted] {commentText}",id:"pushNotifications.userDeletedCommentText.notificationContents"},userCommentedSubject:{defaultMessage:"{userName} commented in {targetName}",id:"pushNotifications.userCommentedSubject.notificationSubject"},userSuggestedSubject:{defaultMessage:"{userName} suggested in {targetName}",id:"pushNotifications.userSuggestedSubject.notificationSubject"},mobileUserCommentedSubject:{defaultMessage:"{userName} commented",id:"pushNotifications.mobileUserCommentedSubject.notificationSubject"},mobileUserSuggestedSubject:{defaultMessage:"{userName} commented",id:"pushNotifications.mobileUserSuggestedSubject.notificationSubject"},userAddedToSpace:{defaultMessage:"{userName} added you to {workspaceName}",id:"pushNotifications.userAddedToSpace.notificationSubject"},mobileUserInvited:{defaultMessage:"{userName} invited you",id:"pushNotifications.mobileUserInvited.notificationSubject"},mobileUserInvitedByBot:{defaultMessage:"You have been invited",id:"pushNotifications.mobileUserInvitedByBot.notificationSubject"},userInvitedToSpace:{defaultMessage:"{userName} invited you to {workspaceName}",id:"pushNotifications.userInvitedToSpace.notificationSubject"},userInvitedToSpaceByBot:{defaultMessage:"You have been invited to {workspaceName}",id:"pushNotifications.userInvitedToSpaceByBot.notificationSubject"},userEditedCollectionSubject:{defaultMessage:"{userName} edited {collectionName}",id:"pushNotifications.collectionEdited.notificationSubject"},userEditedCollectionPageLayoutSubject:{defaultMessage:"{userName} edited the layout of {collectionName}",id:"pushNotifications.collectionPageLayoutEdited.notificationSubject"},userCreatedCollectionSubject:{defaultMessage:"{userName} created {collectionName}",id:"pushNotifications.collectionCreated.notificationSubject"},collectionDescriptionDeleted:{defaultMessage:"{userName} deleted the description for {collectionName}",id:"pushNotifications.collectionDescriptionDeleted.notificationSubject"},collectionDescriptionCreated:{defaultMessage:"{userName} added a description for {collectionName}",id:"pushNotifications.collectionDescriptionAdded.notificationSubject"},untitledCollectionView:{defaultMessage:"Untitled",id:"pushNotifications.untitledCollection.label"},collectionViewEditedSubject:{defaultMessage:"{userName} edited view {collectionViewName} in {collectionName}",id:"pushNotifications.collectionViewEdited.notificationSubject"},collectionPropertyEditedUnknown:{defaultMessage:"Unknown",id:"pushNotifications.unknownCollectionPropertyName.label"},collectionPropertyEditedSubject:{defaultMessage:"{userName} edited property {propertyType} in {collectionName}",id:"pushNotifications.collectionPropertyEdited.subject"},reminderSubject:{defaultMessage:"Reminder in {pageName}",id:"pushNotifications.reminderChanged.subject"},pageLockedActivity:{defaultMessage:"{userName} locked {pageName}",id:"pushNotifications.pageLocked.subject"},pageUnlockedActivity:{defaultMessage:"{userName} unlocked {pageName}",id:"pushNotifications.pageUnlocked.subject"},emailEditedActivity:{defaultMessage:"{userName} edited their account settings",id:"pushNotifications.emailAccountSettingsEdited.subject"},emptyPropertyBody:{defaultMessage:"Empty",id:"pushNotifications.emptyPropertyValueInCollection.label"},unknownRelationValueChange:{defaultMessage:"Unknown",id:"pushNotifications.unknownRelationPropertyChanged.label"},unknownAuthorInPropertySchemaChange:{defaultMessage:"Unknown author",id:"pushNotifications.unknownAuthorUpdatedProperty.label"},accessRequestedSubject:{defaultMessage:"{userName} requested access to {pageName}",id:"pushNotifications.accessRequested.subject"},editAccessRequestedSubject:{defaultMessage:"{userName} requested edit access to {pageName}",id:"pushNotifications.editAccessRequested.subject"},accessRequestResolvedApprovedSubject:{defaultMessage:"Your request to invite {guestEmail} to {pageName} has been approved",id:"pushNotifications.accessRequestResolved.approved.subject"},accessRequestResolvedRejectedSubject:{defaultMessage:"Your request to invite {guestEmail} to {pageName} has been rejected",id:"pushNotifications.accessRequestResolved.subject"},membershipRequestedSubject:{defaultMessage:"{userName} requested to add a new member to {workspaceName}",id:"pushNotifications.membershipRequested.subject"},guestInviteRequestedSubject:{defaultMessage:"{userName} requested to invite a guest to {workspaceName}",id:"pushNotifications.guestInviteRequested.subject"},blockFormatEditPageIconName:{defaultMessage:"Page Icon",id:"pushNotifications.formatChange.pageIcon.label"},pageIconImagePlaceholder:{defaultMessage:"Image",id:"pushNotifications.formatChange.pageIcon.imagePlaceholder"},pageDeletedActivity:{defaultMessage:"{userName} deleted {pageName}",id:"pushNotifications.pageDeleted.subject"},pageRestoredActivity:{defaultMessage:"{userName} restored {pageName}",id:"pushNotifications.pageRestored.subject"},pagePermanentlyDeletedActivity:{defaultMessage:"{userName} permanently deleted {pageName}",id:"pushNotifications.pagePermanentlyDeleted.subject"},userInvitedToTeam:{defaultMessage:"{userName} invited you to {teamName}",id:"pushNotifications.userInvitedToTeam.notificationSubject"},privateContentTransferred:{defaultMessage:"{author} transferred private content from {fromUserName} to you: {pageName}",id:"pushNotifications.privateContentTransferred.notificationSubject"},verificationExpired:{defaultMessage:"Verification expired for {pageName}",id:"pushNotifications.verificationExpired.notificationSubject"},importSuccessful:{defaultMessage:"Your {importSource} import was successful",id:"pushNotifications.importCompleted.notificationSubject"},importFailed:{defaultMessage:"Your {importSource} import has failed",id:"pushNotifications.importFailed.notificationSubject"},exportCompleted:{defaultMessage:"Your workspace export is ready",id:"pushNotifications.exportCompleted.notificationSubject"},inAppNotificationAutomationActionTriggered:{defaultMessage:"{automationName} sent you a message",id:"pushNotifications.inAppNotificationAutomationActionTriggered.notificationSubject"},noConflictsFound:{defaultMessage:"No conflicts found",id:"pushNotifications.noConflictsFound.notificationSubject"},automationTypecheckErrorRaisedSubject:{defaultMessage:"{automationName} is invalid",id:"pushNotifications.automationTypecheckErrorRaised.notificationSubject"},automationTypecheckErrorRaisedBody:{defaultMessage:"Resolve any errors or remove failing steps to enable this automation",id:"pushNotifications.automationTypecheckErrorRaised.notificationBody"}});function B(e){const{activity:t,getRecordValue:i}=e,a=t.getEdits();return o().oA((0,n().cf)(o().xH(a.map((e=>e.authors||[])))).map((e=>{const t=i(e);if(t)return(0,s().LU)({table:e.table,value:t})})))}function Z(e,t){const i=e.map((e=>e?(0,s().$4)(t,e):t.formatMessage(V.unknownAuthor)));return function(e,t){if(1===t.length)return t[0];if(2===t.length)return e.formatMessage(V.twoUserNames,{firstAuthor:t[0],secondAuthor:t[1]});if(t.length>2){const i=t.length-1;return e.formatMessage(V.threePlusUserNames,{othersCount:i,firstAuthor:t[0]})}return e.formatMessage(V.defaultPluralizedUserNames)}(t,i)}function L(e){var t;const{recipientUser:i,authors:o}=e,a=o.filter((e=>e.id!==(null==i?void 0:i.id)));if(0===a.length)return;const n=a[0];var s;return n.table===I().KJ&&null!==(t=n.asActor)&&void 0!==t&&t.profile_photo?null===(s=n.asActor)||void 0===s?void 0:s.profile_photo:void 0}function E(e){if(!o().xb(e))return e[0].id}function K(e){const{blockValue:t,getRecordValue:i,userTimeZone:o,intl:a}=e,n=v().kk5.fromBlock(t),s=v().omK.fromGetRecordValueFn(i);return n.getRenderTitleWithEmojiOrPlaceholder({getRecordModel:s,userTimeZone:o,intl:a})}function H(e){return function(e){const{activity:t,getRecordValue:i,pageVisitSource:o,userTimeZone:a,intl:n}=e,s=v().omK.fromGetRecordValueFn(i),r=t.navigable_block_id||t.top_level_block_id||t.collection_row_id;if(r){const l=i({table:k().iU,id:r,spaceId:t.space_id});if(l){return{url:v().kk5.fromBlock(l).getRenderUrl({getRecordModel:s,baseUrl:e.baseURL,pageVisitSource:o}),title:K({intl:n,blockValue:l,getRecordValue:i,userTimeZone:a})}}return{url:e.baseURL||"/",title:n.formatMessage(V.untitledBlockTitle)}}if(t.collection_id)return W(e);if("user-invited"===t.type){const o=function(e){const{activity:t}=e,i=v().omK.fromGetRecordValueFn(e.getRecordValue||e.getRecordModel);if(!t.permission_group_id)return;const o=ae({spaceId:t.space_id,permissionGroupId:t.permission_group_id,getRecordModel:i});if(o)return{icon:o.getIcon(),name:o.getName()};return}({activity:t,getRecordValue:i}),a=s({table:_().bx,id:t.space_id});if(a&&o)return{title:ne(n,o),url:a.getRenderUrl({baseUrl:e.baseURL})}}else{if("team-membership-edited"===t.type)return F(e);if("access-requested"===t.type){const i=s({id:t.getAccessRequestId(),table:M().J8,spaceId:t.space_id});if(i&&i.isTeamMembershipRequest())return F(e)}}return G(e)}(e).title.replaceAll(/[\r\n]+/g," ")}function D(e){const{activity:t}=e,i=t.navigable_block_id||t.top_level_block_id||t.collection_row_id;return i||(t.collection_id?t.collection_id:void 0)}function F(e){const{activity:t,getRecordValue:i,intl:o}=e,a=v().omK.fromGetRecordValueFn(i),n=e.baseURL||"/",s=o.formatMessage(V.untitledTeamName);if(!t.team_id)return{url:n,title:s};const r=a({table:C().e0,id:t.team_id}),l=a({table:_().bx,id:t.space_id});return{url:(null==l?void 0:l.getRenderUrl({baseUrl:e.baseURL}))??n,title:(null==r?void 0:r.getRenderTitleWithEmojiOrPlaceholder({intl:o}))??s}}function O(e){return G(e).title}function G(e){const{activity:t,getRecordValue:i,intl:o}=e,a=i({table:_().bx,id:t.space_id});if(a){const t=v().kk5.fromSpace(a);return{title:t.getRenderTitleWithEmojiOrPlaceholder({intl:o}),url:t.getRenderUrl({baseUrl:e.baseURL})}}return{url:e.baseURL||"/",title:o.formatMessage(V.untitledSpaceName)}}function z(e){return W(e).title}function W(e){const{activity:t,getRecordValue:i,pageVisitSource:o,userTimeZone:a,intl:n}=e;if(t.collection_id){const s=i({table:w().vF,id:t.collection_id,spaceId:t.space_id});if(s){const t=v().kk5.fromCollection(s),i=v().omK.fromGetRecordValueFn(e.getRecordValue),r=t.getRenderTitleWithEmojiOrPlaceholder({getRecordModel:i,userTimeZone:a,intl:n});return{url:t.getRenderUrl({getRecordModel:i,baseUrl:e.baseURL,pageVisitSource:o}),title:r}}return{url:e.baseURL||"/",title:n.formatMessage(V.untitledCollectionName)}}return{url:e.baseURL||"/",title:n.formatMessage(V.untitledCollectionName)}}function q(e){const{activity:t,getRecordValue:i,intl:o}=e;if("in-app-notification-automation-action-triggered"===t.type||"automation-typecheck-error-raised"===t.type){const e=v().omK.fromGetRecordValueFn(i),a=e({table:j().cv,id:t.getEdits()[0].automation_id,spaceId:t.space_id});return(null==a?void 0:a.getNameWithDefault(e,o))??(0,r().XO)(o)}}function Y(e){if(e.blockValue.properties)return(0,S().Xh)({intl:e.intl,textValue:e.blockValue.properties.title,getRecordModel:v().omK.fromGetRecordValueFn(e.getRecordValue),userTimeZone:e.userTimeZone})}function X(e,t){const i=(0,x().kD)(t,void 0);return e.formatMessage(i)}function $(e){let{userTimeZone:t,activity:i,getRecordValue:a,pageVisitSource:n,intl:s,experimentService:r,collectionFeatureGates:l}=e;const c=i.getEdits();if(c.length){const e=[];c.forEach((t=>{"permission-created"===t.type?e.push(t.permission_data):"permission-deleted"===t.type?e.push({...t.permission_data,role:"none"}):"permission-restriction-created"===t.type||"permission-restriction-deleted"===t.type?(t.permission_data.calculated_changes||[]).forEach((t=>{let[i,o]=t;e.push(o)})):e.push(t.permission_data.after)}));const u=o().oA(e.sort(x()._G).map((e=>{if("user_permission"===e.type){const t=a({table:I().KJ,id:e.user_id}),i=(0,U().Nz)(s,t),o=X(s,e.role);return s.formatMessage(V.userNameWithRole,{userName:i,permissionLevel:o})}if("space_permission"===e.type){const o=O({intl:s,activity:i,getRecordValue:a,userTimeZone:t,pageVisitSource:n,experimentService:r,collectionFeatureGates:l}),d=X(s,e.role);return s.formatMessage(V.spaceNameWithRole,{spaceName:o,permissionLevel:d})}if("public_permission"===e.type){const t=X(s,e.role);return s.formatMessage(V.publicPermissionRoleLabel,{permissionLevel:t})}if("bot_permission"===e.type){const t=a({table:N().cZ,id:e.bot_id}),i=(0,d().Mh)(t),o=X(s,e.role);return s.formatMessage(V.botNameWithRole,{botName:i,permissionLevel:o})}})));return s.formatList(u,{type:"conjunction",style:"narrow"})}}function J(e){const{intl:t}=e;switch(e.blockValue.type){case l().Ti.text:case l().Ti.encryptedText:case l().Ti.header:case l().Ti.subHeader:case l().Ti.subSubHeader:case l().Ti.factory:case l().Ti.equation:case l().Ti.code:return Y(e);case l().Ti.toggle:return` ${Y(e)}`;case l().Ti.bulletedList:return` ${Y(e)}`;case l().Ti.numberedList:return`1. ${Y(e)}`;case l().Ti.quote:return`${Y(e)}`;case l().Ti.toDo:return(function(e){let{blockValue:t}=e;return p().Ml(t.properties&&t.properties.checked)}(e)?" ":" ")+Y(e);case l().Ti.file:case l().Ti.bookmark:return` ${Y(e)}`;case l().Ti.embed:case l().Ti.framer:case l().Ti.whimsical:case l().Ti.mixpanel:case l().Ti.miro:case l().Ti.abstract:case l().Ti.sketch:case l().Ti.excalidraw:case l().Ti.replit:case l().Ti.hex:case l().Ti.deepnote:case l().Ti.tweet:case l().Ti.gist:case l().Ti.maps:case l().Ti.invision:case l().Ti.video:case l().Ti.audio:case l().Ti.image:return t.formatMessage(V.imageInPushNotification,{imageEmoji:""});case l().Ti.drive:return function(e){const{blockValue:t}=e,i=(0,g().v0)(v().kk5.fromBlock(t));return i&&i.title?i.title:K(e)}(e);case l().Ti.page:case l().Ti.collectionView:case l().Ti.collectionViewPage:return K(e);case l().Ti.tableRow:return function(e){var t;const{blockValue:i,getRecordValue:o,userTimeZone:a,intl:n}=e,s=o({table:i.parent_table,id:i.parent_id,spaceId:i.space_id});if(!s||!i)return;const r=i.properties,l=(null===(t=s.format)||void 0===t?void 0:t.table_block_column_order)||[];return l&&r?l.map((e=>(0,S().Xh)({textValue:r[e],getRecordModel:v().omK.fromGetRecordValueFn(o),userTimeZone:a,intl:n}))).join(", "):void 0}(e)}}function Q(e){const{getRecordValue:t,baseURL:i,userTimeZone:o,intl:a,collectionFeatureGates:n}=e,s=t({table:k().iU,id:e.blockId});if(s){if("page"===s.type){const r=(0,b().ky)({block:s,getRecordValue:t});if(r){const i=u().oC(r),o=i[e.property],l=o?o.name:void 0,d=ee({property:e.property,schema:i,block:s,getRecordValue:t,userTimeZone:e.userTimeZone,baseURL:e.baseURL,intl:a,experimentService:e.experimentService,collectionFeatureGates:n})||a.formatMessage(V.emptyPropertyBody);return a.formatMessage(V.propertyNameAndValueNotificationBody,{propertyName:l,propertyValue:d})}return J({intl:a,blockValue:s,getRecordValue:t,baseURL:i,userTimeZone:o})}return J({intl:a,blockValue:s,getRecordValue:t,baseURL:i,userTimeZone:o})}}function ee(e){const{property:t,schema:i,getRecordValue:o,userTimeZone:a,baseURL:r,intl:l,experimentService:d,collectionFeatureGates:c}=e,g=i[t],b=v().kk5.fromBlock(e.block);if(!b.getProperties()||!g)return;const y=b.getProperties()[t];if("formula"===g.type){const e=v().omK.fromGetRecordValueFn(o),s=(0,h().primitiveFormulaValueFromPropertySchema)({schema:i,property:t,blockModel:b,getRecordModel:e,intl:l,userTimeZone:a,depth:0,resultCache:new Map,regExpCache:new Map,experimentService:d,collectionFeatureGates:c});return f().U3(s)?(0,m().ZV)({allowRelativeDates:!0,intl:l,value:s,userTimeZone:a}):"boolean"==typeof s?s?u().bx:u().HC:(0,n().hj)(s)?s.toString():s}if("person"===g.type)return l.formatList(p().DW({textValue:y,propertySchema:g,blockCreatorPointer:b.getCreatedByPointer()}).map((e=>{const t=o(e),i=(0,s().LU)({table:e.table,value:t});return(0,s().$4)(l,i)})),{type:"conjunction",style:"narrow"});if("created_by"===g.type){const e=b.getCreatedByPointer();if(!e)return l.formatMessage(V.unknownAuthorInPropertySchemaChange);const t=o(e),i=t&&(0,s().LU)({table:e.table,value:t});return i?(0,s().$4)(l,i):l.formatMessage(V.unknownAuthorInPropertySchemaChange)}return"created_time"===g.type?(0,m().Yx)(b.getCreatedTime(),"short",l.locale,a):y?te({propertySchema:g,textValue:y,getRecordValue:o,userTimeZone:a,baseURL:r,intl:l,experimentService:d,collectionFeatureGates:c}):void 0}function te(e){const{propertySchema:t,textValue:i,getRecordValue:o,userTimeZone:n,baseURL:r,intl:l,collectionFeatureGates:d}=e;if("title"===t.type||"text"===t.type)return(0,S().Xh)({intl:l,textValue:i,getRecordModel:v().omK.fromGetRecordValueFn(o),userTimeZone:n});if("select"===t.type){const e=t.options||[];return p().Sj(i,e)}if("multi_select"===t.type){const e=t.options||[];return l.formatList(p().uP(i,e),{type:"conjunction",style:"narrow"})}if("checkbox"===t.type)return p().Ml(i)?u().bx:u().HC;if("date"===t.type){const e=(0,c().G)(i);if(e)return(0,m().ZV)({allowRelativeDates:!0,intl:l,value:e,date_format:t.date_format,time_format:t.time_format,userTimeZone:n})}else{if("person"===t.type)return l.formatList(p().DW({textValue:i,propertySchema:t,blockCreatorPointer:void 0}).map((e=>{const t=o(e),i=(0,s().LU)({table:e.table,value:t});return(0,s().$4)(l,i)})),{type:"conjunction",style:"narrow"});if("relation"===t.type){const e=p().j$({relationValue:p().rq(i),getRecordModel:v().omK.fromGetRecordValueFn(o),propertySchema:t,includeDeleted:d.relations_show_deleted,includeInvalidCollection:d.relations_show_invalid_collection,includeNoAccess:d.relations_show_no_access});return l.formatList(e.map(o).map((e=>e?K({intl:l,blockValue:e,getRecordValue:o,baseURL:r,userTimeZone:n}):l.formatMessage(V.unknownRelationValueChange))),{type:"conjunction",style:"narrow"})}if("number"===t.type){const e=p().VY(i);if(void 0!==e)return e.toString()}else if("auto_increment_id"===t.type){const e=p().ah(i);if(void 0!==e)return e.toString()}else{if("file"===t.type)return l.formatList(p().g(i).map((e=>e.name||e.url)),{type:"conjunction",style:"narrow"});if("url"===t.type||"phone_number"===t.type||"email"===t.type)return(0,R().Jcv)(i);if("created_by"===t.type)return;if("created_time"===t.type)return;if("formula"===t.type)return;if("rollup"===t.type)return;if("last_edited_by"===t.type)return;if("last_edited_time"===t.type)return;if("last_visited_time"===t.type)return;if("button"===t.type)return;if("status"===t.type)return p().ZG(i,t);if("location"===t.type)return;if("verification"===t.type){const e=P()._w(i),t=e?P().WN(e):{type:"none"};if("none"===t.type)return l.formatMessage(P().X3.none);const a=o(t.actorPointer),r=(0,s().LU)({table:t.actorPointer.table,value:a}),d=(0,s().$4)(l,r);return"verified"===t.type&&t.isIndefinite?l.formatMessage(P().X3.verifiedIndefinitely,{actor:d}):l.formatMessage(P().X3.verifiedUntil,{actor:d,datetime:A().nK({dateTime:t.dateTimeRange.end,intl:l,userTimeZone:n,displayInUserTimezone:!1,alwaysIncludeTimezone:!0})})}(0,a().t1)(t)}}}function ie(e){if("page_icon"===e.formatProperty)return e.intl.formatMessage(V.blockFormatEditPageIconName)}function oe(e){const{formatProperty:t,block:i,getRecordValue:o,intl:a}=e;if("page_icon"===t){const e=v().kk5.fromBlock(i).getRenderIcon({getRecordModel:v().omK.fromGetRecordValueFn(o)});return e?(0,y().Z)(e.icon)?e.icon:a.formatMessage(V.pageIconImagePlaceholder):a.formatMessage(V.emptyBlockEditedProperty)}}function ae(e){const t=v().omK.fromGetRecordValueFn(e.getRecordValue||e.getRecordModel),{spaceId:i,permissionGroupId:o}=e;return t({table:T().GQ,id:(0,T().L9)({spaceId:i,spacePermissionGroupId:o}),spaceId:i})}function ne(e,t){if(t){return[(0,y().Z)(t.icon)?t.icon:void 0,t.name.length>0?t.name:e.formatMessage(V.untitledPermissionGroupName)].filter(Boolean).join(" ")}return e.formatMessage(V.defaultPermissionGroupName)}function se(e){const t=v().omK.fromGetRecordValueFn(e.getRecordValue||e.getRecordModel),{spaceId:i,teamId:o}=e;return t({table:C().e0,id:o,spaceId:i})}function re(e){switch(e){case"block-property-edited":case"reacted":case"commented":case"permission-group-mentioned":case"team-mentioned":case"reminder":case"user-invited":case"in-app-notification-automation-action-triggered":case"user-mentioned":return!0;case"access-requested":case"access-request-resolved":case"email-edited":case"private-content-transferred":case"team-membership-edited":case"verification-expired":case"export-completed":case"import-completed":case"no-conflicts-found":case"automation-typecheck-error-raised":case"block-edited":case"collection-edited":case"collection-page-layout-edited":case"collection-property-edited":case"collection-row-created":case"collection-row-deleted":case"collection-view-edited":case"page-deleted":case"page-locked":case"page-permanently-deleted":case"page-restored":case"page-unlocked":case"permissions-edited":case"top-level-block-created":case"top-level-block-deleted":return!1;default:return(0,a().P)(e),!1}}},400939:e=>{var t=/[a-zA-Z0-9_\u0392-\u03c9\u00c0-\u00ff\u0600-\u06ff]+|[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af]+/g;e.exports=function(e){var i=e.match(t),o=0;if(!i)return 0;for(var a=0;a<i.length;a++)i[a].charCodeAt(0)>=19968?o+=i[a].length:o+=1;return o}}}]);