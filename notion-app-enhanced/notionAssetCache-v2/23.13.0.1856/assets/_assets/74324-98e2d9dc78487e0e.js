"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[74324],{420645:(e,t,n)=>{n.d(t,{C:()=>Ln});n(821057),n(241792);var o=n(667294),r=()=>n(219727),i=()=>n(142735),a=()=>n(846550),l=()=>n(801812),s=()=>n(325490),c=()=>n(361929),d=()=>n(955620),u=()=>n(824462),p=()=>n(827973),m=()=>n(448419),f=()=>n(1910),g=()=>n(198829),h=()=>n(255577),y=()=>n(92175),x=()=>n(388284),v=()=>n(654133),S=()=>n(755589),w=()=>n(508853),b=()=>n(57687),C=()=>n(487270),k=()=>n(352230),j=()=>n(688173),I=()=>n(151684),T=()=>n(292141),B=()=>n(256101),M=()=>n(876822),R=()=>n(804217),A=()=>n(826955),K=()=>n(452435),D=()=>n(298721),F=()=>n(970105),N=()=>n(269299),z=()=>n(345837),_=()=>n(632775),V=()=>n(12512),Z=()=>n(233227),O=()=>n(317050),P=n(785893);const L=(0,n(827282).IU)("stop",{viewBox:"0 0 20 20",svg:(0,P.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 19 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,P.jsx)("rect",{y:"0.793945",width:"18.8027",height:"18.8027",rx:"9.40137",fill:"#37352F"}),(0,P.jsx)("rect",{x:"5.91028",y:"6.7041",width:"6.98255",height:"6.98255",rx:"0.783447",fill:"white"})]})});var $=()=>n(156538);function U(e){const{store:t,onSubmit:n,clientStore:l,threadStore:s}=e,c=(0,r().O7)(),[u,p]=o.useState(!1),m=(0,i().VK)((()=>0===(0,d().VrM)(t.getValue()||[])),[t]),g=(0,i().VK)((()=>l.state.loading||void 0!==(null==s?void 0:s.getCurrentInferenceId())),[l,s]),h=(0,o.useCallback)((()=>{if(!s)return;const{serverCommitResult:e}=N().createAndCommit({userAction:"AIChatTranscript.StopInferenceButton.handleClick",environment:c,canUndo:!0,perform:e=>{(0,D().Q0)({threadStore:s,transaction:e,clientStore:l})}});l.setState({...l.state,stopInferencePromise:e})}),[c,s,l]),y=(0,o.useCallback)((async()=>{const{dictationActions:e}=await _().Xb.load(),n=(0,d().QaF)(t.getValue()||[]);await e.StreamingDictationManager.start({environment:c,onTranscription:e=>{const o=n?`${n}\n${e}`:e;N().createAndCommit({userAction:"AIChatInput.handleDictation",environment:c,canUndo:!0,perform:e=>{F().sO({environment:c,store:t,value:(0,d().TPx)(o),transaction:e})}})}}),p(!0)}),[c,t]),x=(0,o.useCallback)((async()=>{const{dictationActions:e}=await _().Xb.load();e.StreamingDictationManager.stop(),p(!1)}),[]),v=(0,a().yK)((e=>({stagingAndInputWrap:{overflow:"inherit",flexGrow:1,flexShrink:1},wrap:{display:"flex",alignItems:"center",fontSize:14,flexWrap:"wrap",boxShadow:`0px 0px 0px 0.5px ${e.stroke.primary}, 0px 4px 12px -2px rgba(0, 0, 0, 0.08)`,backgroundColor:"dark"===e.mode?e.accentColors.translucentGray[100]:e.contentBackground,borderRadius:12,overflow:"inherit",position:"relative"},textContainer:{flexGrow:1,padding:"10px 12px 16px 12px",minHeight:void 0,maxHeight:240,overflow:"auto"},placeholder:{opacity:1,cursor:"text"},rightGutter:{display:"flex",alignItems:"center",justifyContent:"center",padding:6,gap:6},sendButtonIcon:{width:28,height:28},microphoneIcon:{width:28},stopIcon:{width:28,height:28}})),[]),S=(0,o.useCallback)((()=>{null==n||n(t.getValue())}),[n,t]);return(0,P.jsx)("div",{style:v.stagingAndInputWrap,tabIndex:0,children:(0,P.jsxs)("div",{style:v.wrap,onClick:e=>{if(e.target===e.currentTarget){const n=$().E.findEditableWithStore(t);n&&n.handleClick(e)}},children:[(0,P.jsx)(z().Z,{style:v.textContainer,placeholder:"Ask AI anything...",disabled:!1,store:t,placeholderStyle:v.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableEnter:!1,onEnter:S,disableMobileActionBar:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestEdit:!0,inPageFind:V().B3.none,usePopupForMentionOnMobile:!0}),(0,P.jsx)("div",{style:{flexGrow:1,flexBasis:"50px"}}),(0,P.jsx)("div",{style:v.rightGutter,children:u?(0,P.jsx)(f().Z,{icon:L,onClick:x,iconStyle:v.stopIcon,ariaLabel:"stop-recording"},"stop-recording"):g?(0,P.jsx)(f().Z,{icon:L,onClick:h,iconStyle:v.stopIcon,ariaLabel:"stop-ai-message"},"stop-inference"):(0,P.jsxs)(P.Fragment,{children:[!u&&(0,P.jsx)(f().Z,{icon:Z().q,onClick:y,iconStyle:v.microphoneIcon,ariaLabel:"start-recording"},"start-recording"),(0,P.jsx)(f().Z,{icon:O()._,onClick:S,iconStyle:v.sendButtonIcon,isBlue:!m,disabled:m,ariaLabel:"submit-ai-message"},"send-message")]})})]})})}n(267602),n(653476);var E=()=>n(923301),W=()=>n(176233),H=()=>n(989478),J=()=>n(788860),G=()=>n(715139),X=()=>n(291198),q=()=>n(108714),Y=()=>n(661297),Q=()=>n(981583),ee=()=>n(718611),te=()=>n(641702),ne=()=>n(286735),oe=()=>n(518530),re=()=>n(325107),ie=()=>n(764153),ae=()=>n(953293),le=()=>n(26587),se=()=>n(94565),ce=()=>n(832770),de=()=>n(392192);function ue(e){var t;const[n,r]=o.useState(e.defaultOpen??!1),i=(0,a().yK)((t=>({wrap:{cursor:"pointer",...e.style},header:{display:"flex",alignItems:"center",gap:8,...e.headerStyle},content:{cursor:"auto",marginTop:12},icon:{width:16,height:16,fill:t.regularIconColor},chevronDownIcon:{width:12,height:12,fill:t.mediumIconColor,transition:"transform 0.2s ease-in-out",transformOrigin:"center",transform:n?"rotate(0deg)":"rotate(-90deg)"}})),[e.style,e.headerStyle,n]),l=(0,o.useCallback)((()=>r(!n)),[n]);return(0,P.jsxs)("div",{style:i.wrap,children:[(0,P.jsxs)(de().Z,{onClick:l,style:i.header,children:[e.left,null===(t=e.icon)||void 0===t?void 0:t.call(e,{...i.icon,...e.iconStyle}),e.label,(0,P.jsx)("div",{style:{flexGrow:1}}),e.right,(0,I().E)(i.chevronDownIcon)]}),n&&(0,P.jsx)("div",{style:i.content,children:e.children})]})}n(670560),n(470928);var pe=()=>n(704923),me=()=>n(666908),fe=()=>n(741633),ge=()=>n(783190),he=()=>n(956898),ye=()=>n(342792),xe=()=>n(308186),ve=()=>n(144628);async function Se(e){const{environment:t,step:n,threadStore:o,metadata:r}=e,i=o.getTranscript(),a=o.getSpaceId();if(!a)throw new Error("Space ID not found");const l=i.findIndex((e=>e.id===n.id));if(l<0)throw new Error("Step not found in transcript");const s=i.slice(0,l+1),c=s.find((e=>"config"===e.type));if(!c)throw new Error("Config step not found in transcript");const d=`${c.value.type}-${n.type}`;await async function(e){const{environment:t,transcript:n,spaceId:o,project:r,dataset:i,metadata:a}=e;await u().callApi({eventName:"insertIntoBraintrustDataset",environment:t,data:{project:r,dataset:i,value:{id:(0,ye().ZP)(),input:{type:"inferenceTranscript",spaceId:o,traceId:(0,ye().ZP)(),transcript:n},metadata:a}}}),xe().PV({message:`Saved to project: ${r}, dataset: ${i}`,onAccept:()=>{window.open(function(e,t){return`https://braintrust.dev/app/Notion/p/${e}/datasets/${t}`}(r,i),"_blank")},acceptLabel:"Open in Braintrust"})}({environment:t,transcript:s,spaceId:a,project:(0,me().eQ)(c.value.type),dataset:d,metadata:r})}var we=()=>n(906651);function be(e){let{style:t,...n}=e;const o=(0,a().yK)((e=>({button:{borderRadius:100,background:e.assistantTintedActionButtonBackground,padding:"0 14px",height:32}})),[]);return(0,P.jsx)(y().Z,{style:{...o.button,...t},...n})}function Ce(e){let{style:t,...n}=e;const o=(0,a().yK)((()=>({button:{alignSelf:"flex-start",borderRadius:100,display:"flex",padding:"0 14px",height:32}})),[]);return(0,P.jsx)(we().Z,{style:{...o.button,...t},...n})}function ke(e){const t=(0,a().yK)((t=>({container:{boxShadow:`0px 0px 0px 1px ${t.stroke.secondary}, 0 1px 3px rgba(0, 0, 0, 0.06)`,backgroundColor:"dark"===t.mode?t.accentColors.translucentGray[100]:t.contentBackground,borderRadius:12,...e.style}})),[e.style]);return(0,P.jsx)("div",{style:t.container,children:e.children})}var je=()=>n(504008),Ie=()=>n(66077),Te=()=>n(959137),Be=()=>n(254940),Me=()=>n(28832),Re=()=>n(98275),Ae=()=>n(964433),Ke=()=>n(542058),De=()=>n(677559);function Fe(e){const{step:t}=e,n=(0,a().yK)((e=>({wrap:{}})),[]);return(0,P.jsx)("div",{style:n.wrap,children:(0,P.jsx)(Ne,{markdown:t.value})})}function Ne(e){const{markdown:t}=e,n=(0,r().O7)(),i=(0,De().XJ)(Ae().p),a=(0,De().XJ)(Ke().m),{value:l}=(0,De().XJ)(Te().F.clipboardActions),s=(0,o.useMemo)((()=>{if(t&&l&&!["idle","pending"].includes(i.status)&&!["idle","pending"].includes(a.status))return je().Z.withListenerIgnored((()=>{const e=new(Ie().Z)({name:"AIChatTranscript.MarkdownChatStep",isTemporaryData:!0}),o=N().createAndCommit({userAction:"AIChatTranscript.MarkdownChatStep.markdownToBlocks",environment:n,canUndo:!1,perform:o=>{const r=l.markdownToBlocks({environment:n,text:t,inMemoryRecordCache:e,transaction:o,markdownOptions:{},markdownLinkifyIt:i.value,tinyMceMicrosoftWordPasteFilter:a.value});if(r)return(0,Be().postProcessAICreatedStores)(n,r),(0,Be().wrapTemporaryBlocksInList)({environment:n,stores:r,inMemoryRecordCache:e,transaction:o})}}).performResult;return e.addCacheFallback(n.defaultRecordCache.inMemoryRecordCache),o}))}),[t,n,i,a,l]);return s?(0,P.jsx)(Me().O,{displayName:"AIChatTranscript.MarkdownChatStep",disabled:!0,children:(0,P.jsx)(Re().Z,{store:s,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0})}):null}n(122556),n(582845),n(250570),n(533019),n(721473),n(788208),n(22624),n(916054),n(30005);var ze=()=>n(506347),_e=()=>n(413880),Ve=()=>n(572948),Ze=()=>n(696459),Oe=()=>n(860562),Pe=()=>n(729775),Le=()=>n(312578),$e=()=>n(967092),Ue=()=>n(384241),Ee=()=>n(205228),We=()=>n(429725),He=()=>n(536691),Je=()=>n(887863),Ge=()=>n(503741),Xe=()=>n(735501),qe=()=>n(998901),Ye=(n(228244),()=>n(707513)),Qe=()=>n(488949);function et(e){const{children:t,style:n,title:i,status:l,defaultOpen:s=!0}=e,c=(0,r().Fy)(),[d,u]=(0,o.useState)(s),p=(0,a().yK)((e=>({wrap:{display:"flex",flexDirection:"column",boxShadow:e.aiEditCardDropShadow,background:"dark"===e.mode?e.cardBackground:e.contentBackground,borderRadius:12,padding:"12px 16px",maxWidth:"min(100%, 640px)",fontSize:c.isMobile?Ye().JB.UIRegular.mobile:Ye().JB.UIRegular.desktop,marginBottom:8,border:`1px solid ${e.stroke.secondary}`,...n},header:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},title:{fontWeight:Ye().Ue.medium,flex:1},toggleIcon:{width:8,height:8,transition:"transform 200ms ease",transform:d?"rotate(180deg)":"rotate(90deg)"},content:{marginTop:d?12:0,display:d?"block":"none"},status:{padding:"2px 8px",borderRadius:12,fontSize:12,fontWeight:Ye().Ue.medium,color:e.contentBackground},statusNotStarted:{backgroundColor:e.accentColors.gray[400]},statusInProgress:{backgroundColor:e.accentColors.blue[400]},statusDone:{backgroundColor:e.accentColors.green[400]},statusError:{backgroundColor:e.accentColors.red[400]}})),[n,c,d]);return(0,P.jsxs)("div",{style:p.wrap,children:[(0,P.jsxs)("div",{style:p.header,onClick:()=>u(!d),children:[(0,Qe().L)({width:8,height:8,transition:"transform 200ms ease-out",transform:`rotateZ(${d?180:90}deg)`,marginRight:4}),(0,P.jsx)("div",{style:p.title,children:i}),(0,P.jsx)("div",{style:{...p.status,...(()=>{switch(l){case"notStarted":return p.statusNotStarted;case"inProgress":return p.statusInProgress;case"done":return p.statusDone;case"error":return p.statusError}})()},children:(()=>{switch(l){case"notStarted":return"Not Started";case"inProgress":return"In Progress";case"done":return"Done";case"error":return"Error"}})()})]}),(0,P.jsx)("div",{style:p.content,children:t})]})}function tt(e){let{value:t}=e;const n=(0,a().yK)((e=>({pill:{display:"inline-flex",alignItems:"center",height:24,padding:"2px 8px",borderRadius:6,backgroundColor:e.surface.elevated,border:`1px solid ${e.stroke.primary}`,color:e.text.secondary,fontSize:Ye().JB.UISmall.desktop,fontWeight:Ye().Ue.regular,whiteSpace:"nowrap"}})),[]);return(0,P.jsx)("span",{style:n.pill,children:t})}function nt(e){let{possibleValues:t,guide:n}=e;const o=(0,r().Fy)(),i=(0,a().yK)((e=>({container:{fontSize:o.isMobile?Ye().JB.UISmall.mobile:Ye().JB.UISmall.desktop,color:e.regularTextColor,padding:"12px 0"},statusSection:{marginBottom:12},label:{color:e.lightTextColor,marginBottom:8,fontWeight:500},progressBar:{width:"100%",height:4,backgroundColor:e.stroke.secondary,borderRadius:2},progressFill:{width:"100%",height:"100%",backgroundColor:e.accentColors.blue[400],borderRadius:2,transition:"width 200ms ease"},infoSection:{marginTop:16},categories:{color:e.regularTextColor,marginBottom:8},categoryList:{display:"flex",flexWrap:"wrap",gap:8,marginTop:4},guide:{color:e.lightTextColor,fontSize:"0.9em",fontStyle:"italic",lineHeight:"1.4"}})),[o]);return(0,P.jsxs)("div",{style:i.container,children:[(0,P.jsxs)("div",{style:i.statusSection,children:[(0,P.jsx)("div",{style:i.label,children:"✓ Classification complete!"}),(0,P.jsx)("div",{style:i.progressBar,children:(0,P.jsx)("div",{style:i.progressFill})})]}),(0,P.jsxs)("div",{style:i.infoSection,children:[(0,P.jsxs)("div",{style:i.categories,children:[(0,P.jsx)("div",{style:i.label,children:"Available Categories:"}),(0,P.jsx)("div",{style:i.categoryList,children:t.map((e=>(0,P.jsx)(tt,{value:e},e)))})]}),n&&(0,P.jsxs)("div",{style:i.guide,children:[(0,P.jsx)("div",{style:i.label,children:"Classification Guide:"}),n]})]})]})}function ot(e){var t,n;let{groupStep:o}=e;const{steps:r}=o,i=r.some((e=>"registered-tool-error"===e.type))?"error":r.some((e=>"registered-tool-output"===e.type))?"done":"inProgress",a=r.find((e=>"registered-tool-call"===e.type)),l=(null==a||null===(t=a.input)||void 0===t?void 0:t.possibleValues)??[],s=(null==a||null===(n=a.input)||void 0===n?void 0:n.classificationGuide)??"";return(0,P.jsx)(et,{title:"Classify Rows Using AI",status:i,defaultOpen:!0,children:(0,P.jsx)(nt,{possibleValues:l,guide:s})})}function rt(){const e=(0,r().Fy)(),t=(0,a().yK)((t=>({container:{fontSize:e.isMobile?Ye().JB.UISmall.mobile:Ye().JB.UISmall.desktop,color:t.regularTextColor,padding:"8px 0"},label:{color:t.lightTextColor,marginBottom:4},progressBar:{width:"100%",height:4,backgroundColor:t.stroke.secondary,borderRadius:2},progressFill:{width:"100%",height:"100%",backgroundColor:t.accentColors.blue[400],borderRadius:2,transition:"width 200ms ease"}})),[e]);return(0,P.jsxs)("div",{style:t.container,children:[(0,P.jsx)("div",{style:t.label,children:"Done computing new column values!"}),(0,P.jsx)("div",{style:t.progressBar,children:(0,P.jsx)("div",{style:t.progressFill})})]})}function it(e){let{groupStep:t}=e;const{steps:n}=t,o=n.some((e=>"registered-tool-error"===e.type))?"error":n.some((e=>"registered-tool-output"===e.type))?"done":"inProgress";return(0,P.jsx)(et,{title:"Compute Column Using AI",status:o,defaultOpen:!0,children:(0,P.jsx)(rt,{})})}var at=()=>n(363253);const lt=3e3;function st(e){let{content:t,label:n}=e;const o=(0,r().Fy)(),i=(0,a().yK)((e=>({container:{fontSize:o.isMobile?Ye().JB.UISmall.mobile:Ye().JB.UISmall.desktop,color:e.regularTextColor,marginBottom:12},contentContainer:{fontFamily:"monospace",backgroundColor:e.codeBlockBackground,padding:8,borderRadius:4,overflowX:"auto"},label:{color:e.lightTextColor,marginBottom:4}})),[o]);return(0,P.jsxs)("div",{style:i.container,children:[(0,P.jsx)("div",{style:i.label,children:n}),(0,P.jsx)("div",{style:i.contentContainer,children:(0,P.jsx)("pre",{children:t})})]})}function ct(e){let{step:t,showDetails:n}=e;if(!n)return null;if("registered-tool-call"===t.type){let e=JSON.stringify(t.input,null,2);return e.length>lt&&(e=`${e.slice(0,lt)}...`),(0,P.jsx)(st,{content:e,label:"Input"})}if("registered-tool-output"===t.type){let e=JSON.stringify(t.output,null,2);return e.length>lt&&(e=`${e.slice(0,lt)}...`),(0,P.jsx)(st,{content:e,label:"Output"})}if("registered-tool-error"===t.type){let e=JSON.stringify(t.error,null,2);return e.length>lt&&(e=`${e.slice(0,lt)}...`),(0,P.jsx)(st,{content:e,label:"Error"})}(0,Ze().t1)(t)}function dt(e){const{groupStep:t}=e,{toolName:n,steps:i}=t,l=(0,r().Fy)(),[s,c]=(0,o.useState)(!1),d=(0,a().yK)((e=>({container:{fontSize:l.isMobile?Ye().JB.UISmall.mobile:Ye().JB.UISmall.desktop,color:e.regularTextColor},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},button:{display:"flex",alignItems:"center",gap:4,padding:"4px 8px",borderRadius:4,cursor:"pointer",color:e.lightTextColor,backgroundColor:e.buttonBackground,border:`1px solid ${e.stroke.secondary}`,fontSize:l.isMobile?Ye().JB.UISmall.mobile:Ye().JB.UISmall.desktop}})),[l]),u=i.some((e=>"registered-tool-error"===e.type))?"error":i.some((e=>"registered-tool-output"===e.type))?"done":"inProgress",p=i.map((e=>(0,P.jsx)(ct,{step:e,showDetails:s},e.id)));return(0,P.jsx)(et,{title:`Tool: ${n}`,status:u,children:(0,P.jsxs)("div",{style:d.container,children:[(0,P.jsx)("div",{style:d.header,children:(0,P.jsxs)("button",{style:d.button,onClick:()=>c(!s),children:[(0,at().z)({width:16,height:16}),s?"Hide Details":"Show Details"]})}),p]})})}const ut=500;function pt(e){let{step:t}=e;const n=(0,r().Fy)(),o=(0,a().yK)((e=>({container:{fontSize:n.isMobile?Ye().JB.UISmall.mobile:Ye().JB.UISmall.desktop,color:e.regularTextColor},label:{color:e.lightTextColor,marginBottom:4},schema:{fontFamily:"monospace",backgroundColor:e.codeBlockBackground,padding:8,borderRadius:4,overflowX:"auto"},exampleData:{marginTop:8,fontFamily:"monospace",backgroundColor:e.codeBlockBackground,padding:8,borderRadius:4,overflowX:"auto"}})),[n]);if("registered-tool-output"!==t.type)return null;const{tableName:i,schemaSummary:l,exampleContent:s}=t.output;return(0,P.jsxs)("div",{style:o.container,children:[(0,P.jsx)("div",{style:o.label,children:"Table Name"}),(0,P.jsx)("div",{children:i}),(0,P.jsx)("div",{style:o.label,children:"Schema"}),(0,P.jsx)("div",{style:o.schema,children:l.length>ut?`${l.slice(0,ut)}...`:l}),(0,P.jsx)("div",{style:o.label,children:"Example Data"}),(0,P.jsx)("pre",{style:o.exampleData,children:s})]})}function mt(e){let{groupStep:t}=e;const{steps:n}=t,o=n.map((e=>"registered-tool-output"===e.type?(0,P.jsx)(pt,{step:e},e.id):null)),r=n.some((e=>"registered-tool-error"===e.type))?"error":n.some((e=>"registered-tool-output"===e.type))?"done":"inProgress";return(0,P.jsx)(et,{title:"Load Database to SQLite",status:r,defaultOpen:!1,children:o})}n(398858),n(461318),n(33228);var ft=()=>n(884399);function gt(e){let{headers:t,rows:n}=e;const o=(0,r().Fy)(),i=(0,a().yK)((e=>({table:{width:"100%",borderCollapse:"collapse",fontSize:o.isMobile?Ye().JB.UISmall.mobile:Ye().JB.UISmall.desktop},headerCell:{padding:8,textAlign:"left",borderBottom:`1px solid ${e.stroke.secondary}`,color:e.lightTextColor,fontWeight:Ye().Ue.medium},cell:{padding:8,borderBottom:`1px solid ${e.stroke.secondary}`,color:e.regularTextColor}})),[o]);return(0,P.jsxs)("table",{style:i.table,children:[(0,P.jsx)("thead",{children:(0,P.jsx)("tr",{children:t.map(((e,t)=>(0,P.jsx)("th",{style:i.headerCell,children:e},t)))})}),(0,P.jsx)("tbody",{children:n.map(((e,t)=>(0,P.jsx)("tr",{children:e.map(((e,t)=>(0,P.jsx)("td",{style:i.cell,children:e},t)))},t)))})]})}function ht(e){let{step:t}=e;const n=(0,r().Fy)(),o=(0,a().yK)((e=>({container:{fontSize:n.isMobile?Ye().JB.UISmall.mobile:Ye().JB.UISmall.desktop,color:e.regularTextColor,marginBottom:12},sqlContainer:{fontFamily:"monospace",backgroundColor:e.codeBlockBackground,padding:8,borderRadius:4,overflowX:"auto"}})),[n]),{sql:i}=t.input;return(0,P.jsx)("div",{style:o.container,children:i&&(0,P.jsx)("div",{style:o.sqlContainer,children:(0,P.jsx)("pre",{children:i})})})}function yt(e){let{step:t,inputStep:n}=e;const i=(0,r().Fy)(),[l,s]=(0,o.useState)(!1),c=(0,a().yK)((e=>({container:{fontSize:i.isMobile?Ye().JB.UISmall.mobile:Ye().JB.UISmall.desktop,color:e.regularTextColor},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},resultCount:{color:e.lightTextColor},buttonsContainer:{display:"flex",gap:8},button:{display:"flex",alignItems:"center",gap:4,padding:"4px 8px",borderRadius:4,cursor:"pointer",color:e.lightTextColor,backgroundColor:e.buttonBackground,border:`1px solid ${e.stroke.secondary}`,fontSize:i.isMobile?Ye().JB.UISmall.mobile:Ye().JB.UISmall.desktop},tableContainer:{border:`1px solid ${e.stroke.secondary}`,borderRadius:4,overflow:"hidden"}})),[i]),{queryResult:d}=t.output;let u;try{u=JSON.parse(d)}catch{return(0,P.jsx)("div",{children:"Invalid result format"})}const p=u.length,m=u.slice(0,10),f=[...Object.keys(m[0]||{})],g=m.map((e=>Object.values(e).map((e=>String(e)))));return(0,P.jsxs)("div",{style:c.container,children:[(0,P.jsxs)("div",{style:c.header,children:[(0,P.jsx)("div",{style:c.resultCount,children:0===p?"No results":1===p?"1 result":`${p} results${p>10?" (showing first 10)":""}`}),(0,P.jsxs)("div",{style:c.buttonsContainer,children:[(0,P.jsxs)("button",{style:c.button,onClick:()=>s(!l),children:[(0,at().z)({width:16,height:16}),l?"Hide SQL":"Show SQL"]}),(0,P.jsxs)("button",{style:c.button,onClick:()=>{const e=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="query_results.json",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)},children:[(0,ft().a)({width:16,height:16}),"Download"]})]})]}),l&&n?(0,P.jsx)(ht,{step:n}):null,p>0&&(0,P.jsx)("div",{style:c.tableContainer,children:(0,P.jsx)(gt,{headers:f,rows:g})})]})}function xt(e){let{groupStep:t}=e;const{steps:n}=t,o=n.find((e=>"registered-tool-call"===e.type)),r=n.map(((e,t)=>"registered-tool-output"===e.type?(0,P.jsx)(yt,{step:e,inputStep:o},e.id):null)),i=n.some((e=>"registered-tool-error"===e.type))?"error":n.some((e=>"registered-tool-output"===e.type))?"done":"inProgress";return(0,P.jsx)(et,{title:"Run SQL Query",status:i,defaultOpen:!0,children:r})}function vt(e){let{groupStep:t}=e;return"detect-classification-categories-using-llm"===t.toolName||"load-database-content"===t.toolName?(0,P.jsx)(dt,{groupStep:t}):"classify-rows-using-llm"===t.toolName?(0,P.jsx)(ot,{groupStep:t}):"load-database-to-sqlite-table"===t.toolName?(0,P.jsx)(mt,{groupStep:t}):"compute-column-using-llm"===t.toolName?(0,P.jsx)(it,{groupStep:t}):"run-sql-on-sqlite-table"===t.toolName?(0,P.jsx)(xt,{groupStep:t}):"output-value"===t.toolName?null:void(0,Ze().t1)(t)}function St(e){if(0===e)return"0s";const t=Math.floor(e/1e3),n=Math.floor(t/60),o=t%60;return`${n?`${n}m `:""}${o?`${o}s`:""}`}function wt(e){var t;let{transcriptStepId:n,step:i,styles:a,getStatusStyles:l,threadStore:s,clientStore:c,researchModeCitationInfo:d}=e;const[u,p]=(0,o.useState)(!1),[m,f]=(0,o.useState)(null),g=(0,o.useRef)(new Map),h=(0,r().O7)(),x=Ee().default.isLocalhost,S=(0,o.useCallback)((()=>{const e=s.getTranscript().findIndex((e=>e.id===n)),{serverCommitResult:t}=N().createAndCommit({userAction:"AIChatTranscript.RunFromStepButton.handleClick",environment:h,canUndo:!0,perform:t=>{(0,D().a7)({threadStore:s,stepIndex:e,stepKey:i.key,transaction:t})}});(0,D().nD)({environment:h,threadStore:s,clientStore:c,threadCommitResult:t})}),[h,s,c,i.key,n]);return(0,P.jsxs)("div",{style:{...a.stepWrap},children:[(0,P.jsxs)("div",{style:{...a.step,cursor:"pointer"},onClick:()=>p(!u),children:[(0,P.jsxs)("span",{style:{display:"flex",alignItems:"center",gap:8},children:[((e,t)=>{switch(e){case"done":return 1===t?(0,Xe().t)({width:14,height:14,fill:a.statusNeedsMoreInfo.backgroundColor}):0===t?(0,Ge().B)({width:14,height:14,fill:a.statusFailed.backgroundColor}):(0,Je().r)({width:14,height:14,fill:a.statusDone.backgroundColor});case"in-progress":return(0,P.jsx)(Le().Z,{style:{width:14,height:14}});case"needs-more-info":return(0,Xe().t)({width:14,height:14,fill:a.statusNeedsMoreInfo.backgroundColor});case"cancelled":return(0,oe().U)({width:14,height:14,fill:a.statusCancelled.backgroundColor});case"failed":return(0,Ge().B)({width:14,height:14,fill:a.statusFailed.backgroundColor});default:return null}})(i.status,null===(t=i.eval)||void 0===t?void 0:t.completeness),(0,P.jsx)("span",{children:i.key}),i.retryCount?` (attempt #${i.retryCount+1})`:"",(()=>{if(i.timestampEndMs&&i.timestampStartMs)return(0,P.jsx)("span",{style:{color:"#666",fontSize:"0.9em"},children:St(i.timestampEndMs-i.timestampStartMs)})})()]}),(0,P.jsx)("span",{style:{...a.expandIcon,...u?a.expandIconRotated:{}},children:(0,He().A)({width:14,height:14})})]}),(0,P.jsx)("div",{style:{overflow:"hidden",height:u?"auto":0,transition:"height 200ms cubic-bezier(0.4, 0, 0.2, 1)"},children:(0,P.jsxs)("div",{style:a.expandedContent,children:[(0,P.jsx)("div",{style:a.question,children:`(${i.agent}) "${i.question}"`}),x&&(0,P.jsx)("div",{children:(0,P.jsx)(y().Z,{onClick:S,isSmall:!0,shouldShrink:!1,icon:le().I,iconStyle:a.icon,children:"Retry"})}),i.findings?(0,P.jsx)("div",{style:a.findings,children:(w=i.findings,w.split(/(\[\d+\])/g).map(((e,t)=>{const n=e.match(/\[(\d+)\]/);if(n){const o=n[1],r=m===o;return(0,P.jsx)("span",{ref:e=>{e?g.current.set(o,e):g.current.delete(o)},style:{cursor:"pointer",color:r?"blue":"inherit"},onClick:e=>{e.stopPropagation(),f((e=>e===o?null:o))},children:e},`citation-${o}-${t}`)}return(0,P.jsx)("span",{children:e},`text-${t}`)})))}):null,i.toolsUsed&&i.toolsUsed.length>0&&(0,P.jsx)("div",{style:a.content,children:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=new Map;for(const n of e)t.has(n.toolCallId)||t.set(n.toolCallId,{id:n.toolCallId,type:"registered-tool-grouping",toolName:n.toolName,toolCallId:n.toolCallId,steps:[]}),t.get(n.toolCallId).steps.push(n);return Array.from(t.values())}(i.toolsUsed).map((e=>(0,P.jsx)(vt,{groupStep:e},e.toolCallId)))}),i.additionalContextForAgent&&(0,P.jsxs)("details",{style:a.details,children:[(0,P.jsx)("summary",{style:a.summary,children:"Additional context ▾"}),(0,P.jsx)("div",{style:a.additionalContext,children:i.additionalContextForAgent})]}),i.additionalLoadableContent&&(0,P.jsxs)("details",{style:a.details,children:[(0,P.jsxs)("summary",{style:a.summary,children:["Additional loadable content (",i.additionalLoadableContent.length,") ▾"]}),(0,P.jsx)("div",{style:a.content,children:i.additionalLoadableContent.map((e=>(0,P.jsx)("div",{children:e.description},e.id)))})]}),i.claims&&(0,P.jsxs)("details",{style:a.details,children:[(0,P.jsxs)("summary",{style:a.summary,children:["Claims (",i.claims.length,") ▾"]}),(0,P.jsx)("div",{style:a.content,children:i.claims.map((e=>{var t;const n=null===(t=i.artifacts)||void 0===t?void 0:t.filter((t=>{var n;return null==e||null===(n=e.supportingArtifactIds)||void 0===n?void 0:n.includes(t.id)})),o=n&&(0,P.jsxs)("div",{style:a.artifactTooltipContent,children:[(0,P.jsx)("div",{style:a.subtitle,children:"Supporting Evidence"}),null==n?void 0:n.map(((e,t)=>(0,P.jsx)(Ct,{artifact:e,researchModeCitationInfo:d},e.id)))]}),r=(0,P.jsx)(v().Z,{isLightBackground:!0,renderTooltip:()=>o,render:t=>{var n;return(0,P.jsx)("span",{...t,children:null!==(n=i.eval)&&void 0!==n&&null!==(n=n.claimsScores)&&void 0!==n&&n[e.id]?(0,Je().r)({width:12,height:12,fill:a.evalTrue.color}):(0,Ge().B)({width:12,height:12,fill:a.evalFalse.color})})}});return(0,P.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[i.eval&&r,(0,P.jsx)("span",{children:e.content})]},e.id)}))})]}),i.artifacts&&(0,P.jsxs)("details",{style:a.details,children:[(0,P.jsxs)("summary",{style:a.summary,children:["Supporting evidence (",i.artifacts.length,") ▾"]}),(0,P.jsx)("div",{style:a.content,children:i.artifacts.map((e=>(0,P.jsx)(Ct,{artifact:e,researchModeCitationInfo:d},e.id)))})]}),i.workLog&&(0,P.jsxs)("details",{style:a.details,children:[(0,P.jsxs)("summary",{style:a.summary,children:["Work log (",i.workLog.length,") ▾"]}),(0,P.jsx)("div",{style:a.content,children:i.workLog.map((e=>(0,P.jsx)("div",{children:e},e)))})]}),i.eval&&(0,P.jsxs)("details",{style:a.details,children:[(0,P.jsx)("summary",{style:a.summary,children:"Eval ▾"}),(0,P.jsxs)("div",{style:a.content,children:[(0,P.jsxs)("div",{children:["Completeness: ",i.eval.completeness]},"completeness"),(0,P.jsxs)("div",{children:["Faithfulness: ",i.eval.faithfulness]},"faithfulness")]})]}),m&&g.current.get(m)&&(0,P.jsx)($e().ZP,{open:Boolean(m),onClosed:()=>f(null),onDismiss:()=>f(null),originRect:g.current.get(m).getBoundingClientRect(),popupType:$e().kQ.Popup,placementToOrigin:qe().Placement.Bottom,alignmentToOrigin:qe().Alignment.Start,originGap:16,style:{minWidth:300,maxWidth:400,maxHeight:400,overflow:"auto"},preventScaleTransition:!1,render:()=>(0,P.jsx)(kt,{claimId:m,claims:i.claims||[],artifacts:i.artifacts||[],onClose:()=>f(null),researchModeCitationInfo:d})})]})})]},i.key);var w}function bt(e){switch(e.target){case"slack":return{...e,href:(0,_e()._B)(e.href),domain:e.domain||"",baseUrl:e.baseUrl||"",channelId:e.channelId||"",messageId:e.messageId||"",threadTs:e.threadTs||"",type:"slack"};case"google-drive":return{...e,href:(0,_e().JV)(e.href),url:e.url||"",type:"google-drive"};case"github":return{...e,href:(0,_e().RI)(e.href),url:e.url||"",type:"github"};case"webpage":return{...e,href:(0,_e().Wf)(e.href),url:e.url||"",type:"webpage"};case"jira":return{...e,href:(0,_e().yV)(e.href),url:e.url||"",type:"jira"};case"helpdoc":return{...e,href:(0,_e().Lv)(e.href),url:e.url||"",type:"helpdoc"};default:(0,Ze().t1)(e.target)}}function Ct(e){var t,n,o;const{artifact:l,researchModeCitationInfo:s,onClose:c}=e,d=(0,r().O7)(),u=(0,a().yK)((e=>({artifactContent:{display:"flex",alignItems:"center",marginBottom:8,fontSize:12,color:e.regularTextColor},iconWrap:{position:"relative",marginRight:12,marginTop:1,width:20,height:20},icon:{position:"absolute",left:0,top:0},titleElement:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},verifiedClaim:{color:e.accentColors.green[400]},wrapper:{padding:"12px 16px",borderRadius:4,backgroundColor:e.surface.elevated,position:"relative"},closeButton:{position:"absolute",right:8,top:8,cursor:"pointer",color:e.mediumTextColor}})),[]),p=(0,i().VK)((()=>{var e,t,n;return"notion"===(null===(e=l.citationInfo)||void 0===e?void 0:e.citationType)&&null!==(t=l.citationInfo)&&void 0!==t&&t.pageId?new(A().G)(d,{table:"block",id:null===(n=l.citationInfo)||void 0===n?void 0:n.pageId}):void 0}),[d,l.citationInfo]),m=(0,i().VK)((()=>{var e,t,n;return"notion"===(null===(e=l.citationInfo)||void 0===e?void 0:e.citationType)&&null!==(t=l.citationInfo)&&void 0!==t&&t.blockId?new(A().G)(d,{table:"block",id:null===(n=l.citationInfo)||void 0===n?void 0:n.blockId}):void 0}),[d,l.citationInfo]),{metaHref:f,href:g}=(0,i().VK)((()=>{var e,t,n,o,r;if("claim"===(null===(e=l.citationInfo)||void 0===e?void 0:e.citationType))return{metaHref:void 0,href:void 0};if("notion"===(null===(t=l.citationInfo)||void 0===t?void 0:t.citationType)){if(!p)return{metaHref:void 0,href:void 0};const e=(0,We().ZP)({store:m||p,fullyQualified:!1,pageVisitSource:ze().tY.AIQna});return{metaHref:e,href:e}}if("slack"===(null===(n=l.citationInfo)||void 0===n?void 0:n.target)){var i,a;const e=(0,Ve().St)({...l.citationInfo,channelId:(null===(i=l.citationInfo)||void 0===i?void 0:i.channelId)||"",messageId:(null===(a=l.citationInfo)||void 0===a?void 0:a.messageId)||""});return{metaHref:e,href:e}}return{metaHref:null===(o=l.citationInfo)||void 0===o?void 0:o.url,href:null===(r=l.citationInfo)||void 0===r?void 0:r.url}}),[p,m,l.citationInfo]);let h;var y,x,v,S;if("claim"===(null===(t=l.citationInfo)||void 0===t?void 0:t.citationType))h=(0,P.jsxs)("div",{style:u.artifactContent,children:[(0,P.jsx)("div",{style:u.iconWrap,children:(0,Je().r)({width:14,height:14,fill:u.verifiedClaim.color})}),(0,P.jsx)(kt,{stepKey:null===(y=l.citationInfo)||void 0===y?void 0:y.stepKey,claimId:null===(x=l.citationInfo)||void 0===x?void 0:x.claimId,claims:s.stepCitations[null===(v=l.citationInfo)||void 0===v?void 0:v.stepKey].claims,artifacts:s.stepCitations[null===(S=l.citationInfo)||void 0===S?void 0:S.stepKey].artifacts,researchModeCitationInfo:s})]},l.id);else if("notion"===(null===(n=l.citationInfo)||void 0===n?void 0:n.citationType)){var w,b,C;const e=null!==(w=l.citationInfo)&&void 0!==w&&w.blockId?[null===(b=l.citationInfo)||void 0===b?void 0:b.blockId]:[];h=(0,P.jsx)(Pe().Z,{href:g,metaHref:f,external:!0,children:(0,P.jsxs)("div",{style:u.artifactContent,children:[(0,P.jsx)("div",{style:u.iconWrap,children:p&&(0,P.jsx)(Oe().HY,{citation:{pointer:{table:"block",id:null===(C=l.citationInfo)||void 0===C?void 0:C.pageId},type:l.citationInfo.citationType,store:p,inlineCitedBlockIds:e,...l.citationInfo},size:14,style:u.icon})}),p&&0===e.length&&(0,P.jsxs)("div",{style:{width:"100%"},children:[(0,P.jsx)(Ue().Z,{store:p,style:{fontSize:14}}),(0,P.jsx)(Oe().vi,{citationText:l.content})]}),p&&e.length>0&&(0,P.jsx)(Oe().HW,{inlineCitedBlockIds:e,store:p})]},l.id)})}else if("universal_search"===(null===(o=l.citationInfo)||void 0===o?void 0:o.citationType)){var k,j,I;let e;if("slack"===(null===(k=l.citationInfo)||void 0===k?void 0:k.target)){var T,B;const t=null===(T=l.citationInfo)||void 0===T||null===(T=T.text)||void 0===T||null===(T=T.split(":"))||void 0===T?void 0:T[0];e=(0,P.jsx)(J()._H,{id:"ResearcherPlanStep.SlackCitationTitle.title",defaultMessage:"{author} in #{title}",values:{title:null===(B=l.citationInfo)||void 0===B?void 0:B.title,author:t}})}else{var M;e=(0,P.jsx)("span",{style:u.titleElement,children:null===(M=l.citationInfo)||void 0===M?void 0:M.title})}h=(0,P.jsx)(Pe().Z,{href:g,metaHref:f,external:!0,children:(0,P.jsxs)("div",{style:u.artifactContent,children:[(null===(j=l.citationInfo)||void 0===j?void 0:j.target)&&(0,P.jsx)("div",{style:u.iconWrap,children:(0,P.jsx)(Oe().HY,{citation:bt(l.citationInfo),size:14,style:u.icon})}),(0,P.jsx)(Oe().T6,{citationText:null===(I=l.citationInfo)||void 0===I?void 0:I.text,titleElement:e})]},l.id)})}else h=(0,P.jsx)("div",{style:u.artifactContent,children:l.content},l.id);return(0,P.jsxs)("div",{style:c?u.wrapper:{},children:[c&&(0,P.jsx)("div",{onClick:c,role:"button",tabIndex:0,style:u.closeButton,children:(0,oe().U)({width:16,height:16})}),h]})}function kt(e){let{claimId:t,claims:n,artifacts:o,onClose:r,researchModeCitationInfo:i,stepKey:l}=e;const s=(0,a().yK)((e=>({wrapper:{padding:"12px 16px",borderRadius:4,backgroundColor:e.surface.elevated,position:"relative"},closeButton:{position:"absolute",right:8,top:8,cursor:"pointer",color:e.mediumTextColor},title:{fontSize:12,fontWeight:500,color:e.regularTextColor,marginBottom:8},subtitle:{fontSize:12,fontWeight:500,color:e.regularTextColor,marginTop:12,marginBottom:8},summary:{fontSize:14,color:e.darkTextColor,whiteSpace:"pre-wrap"}})),[]),c=n.find((e=>e.id===t)),d=o.filter((e=>{var t;return null==c||null===(t=c.supportingArtifactIds)||void 0===t?void 0:t.includes(e.id)}));return c?(0,P.jsxs)("div",{style:s.wrapper,children:[r&&(0,P.jsx)("div",{onClick:r,role:"button",tabIndex:0,style:s.closeButton,children:(0,oe().U)({width:16,height:16})}),(0,P.jsxs)("div",{style:s.title,children:["Claim",l?` (${l})`:""]}),(0,P.jsxs)("div",{style:s.summary,children:[(0,P.jsx)("div",{style:{marginBottom:12},children:c.content}),d.length>0&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{style:s.subtitle,children:"Supporting Evidence"}),d.map((e=>(0,P.jsx)(Ct,{artifact:e,researchModeCitationInfo:i},e.id)))]})]})]}):null}function jt(e){const{step:t,stepId:n,threadStore:r,clientStore:l}=e,s=t.value.filter((e=>"cancelled"!==e.status)),c=(0,o.useMemo)((()=>{const e={};return s.forEach((t=>{e[t.key]={claims:t.claims??[],artifacts:t.artifacts??[]}})),{stepCitations:e}}),[s]),[d,u]=(0,o.useState)(!0),p=(0,i().VK)((()=>"researcher"===l.state.config.type&&(!0===l.state.config.disablePlanRevision||!1===l.state.config.autoExecutePlan)),[l]),m=(0,i().VK)((()=>"researcher"===l.state.config.type&&!1===l.state.config.autoExecutePlan),[l]),f=(0,a().yK)((e=>({wrap:{display:"flex",flexDirection:"column",marginBottom:32},stepGroup:{borderBottom:`1px solid ${e.regularDividerColor}`,display:"flex",flexDirection:"column"},stepWrap:{paddingTop:16,paddingBottom:16,display:"flex",flexDirection:"column",borderBottom:`1px solid ${e.lightDividerColor}`},step:{display:"flex",alignItems:"center",gap:8,color:e.regularTextColor,fontSize:14,fontWeight:500},additionalContext:{fontSize:12,color:e.mediumTextColor},status:{fontSize:12,padding:"2px 6px",borderRadius:4,backgroundColor:"rgba(0,0,0,0.05)"},statusDone:{backgroundColor:e.blueColor,color:"#FFFFFF"},statusInProgress:{backgroundColor:e.blueColor,color:"#FFFFFF"},statusNeedsMoreInfo:{backgroundColor:e.accentColors.purple[400],color:"#FFFFFF"},statusFailed:{backgroundColor:e.accentColors.red[400],color:"#FFFFFF"},statusCancelled:{backgroundColor:e.accentColors.gray[400],color:"#FFFFFF"},details:{marginTop:4},summary:{cursor:"pointer",userSelect:"none",color:e.mediumTextColor,fontSize:12,fontWeight:500,display:"flex",alignItems:"center",gap:4,padding:"4px 0"},content:{fontSize:12,color:e.mediumTextColor,padding:"4px 0",whiteSpace:"pre-wrap"},question:{fontWeight:500,marginBottom:8},findings:{marginTop:8,marginBottom:8},expandIcon:{marginLeft:"auto",fontSize:12,display:"flex",alignItems:"center",transition:"transform 200ms ease-out"},expandIconRotated:{transform:"rotate(-180deg)"},expandedContent:{marginTop:16,color:e.darkTextColor},summaryRow:{display:"flex",alignItems:"center",gap:8,padding:"16px 0",cursor:"pointer",fontSize:14,fontWeight:500,color:e.regularTextColor,borderBottom:`1px solid ${e.regularDividerColor}`},stepsContent:{display:"flex",flexDirection:"column"},evalTrue:{color:e.accentColors.green[400]},evalFalse:{color:e.accentColors.red[400]},subtitle:{fontSize:12,fontWeight:500,color:e.regularTextColor,marginTop:12,marginBottom:8}})),[]);function g(e,t){return"done"===e?t.statusDone:"in-progress"===e?t.statusInProgress:"needs-more-info"===e?t.statusNeedsMoreInfo:"cancelled"===e||"failed"===e?t.statusCancelled:{}}const h=function(e){const t=new Map,n=new Map,o=new Map;e.forEach((e=>{t.set(e.key,new Set),n.set(e.key,0),o.set(e.key,e)})),e.forEach((e=>{e.dependentKeys&&e.dependentKeys.forEach((o=>{var r;null===(r=t.get(o))||void 0===r||r.add(e.key),n.set(e.key,(n.get(e.key)||0)+1)}))}));const r=[];let i=Array.from(n.entries()).filter((e=>{let[t,n]=e;return 0===n})).map((e=>{let[t]=e;return t}));for(;i.length>0;){const e=[],a=[];for(const r of i){const i=o.get(r);e.push(i);const l=Array.from(t.get(r)||[]);l.sort();for(const e of l)n.set(e,(n.get(e)||0)-1),0===n.get(e)&&a.push(e)}r.push(e),i=a}return r}(s),y=s.filter((e=>"done"===e.status||"failed"===e.status)).length,x=y===s.length;return s.length?(0,P.jsxs)("div",{style:f.wrap,children:[(0,P.jsxs)("div",{style:f.summaryRow,onClick:()=>u(!d),children:[(0,P.jsx)("span",{style:{display:"flex",alignItems:"center",gap:8},children:x?(0,P.jsxs)(P.Fragment,{children:[(0,Je().r)({width:14,height:14,fill:f.statusDone.backgroundColor}),(0,P.jsx)("span",{style:{display:"flex",alignItems:"center",gap:8},children:`${y} of ${s.length} steps complete `}),(0,P.jsx)("span",{children:(()=>{const e=s.map((e=>e.timestampStartMs)).filter((e=>void 0!==e)),t=s.map((e=>e.timestampEndMs)).filter((e=>void 0!==e));if(e.length&&t.length){const n=Math.max(...t)-Math.min(...e);return(0,P.jsx)("span",{style:{color:"#666",fontSize:"0.9em"},children:`Took ${St(n)}`})}return null})()})]}):m&&s.every((e=>"not-started"===e.status))?(0,P.jsx)("span",{children:`${s.length} steps planned`}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Le().Z,{style:{width:14,height:14}}),(0,P.jsx)("span",{children:`${y} of ${s.length} steps complete`})]})}),(0,P.jsx)("span",{style:{...f.expandIcon,...d?f.expandIconRotated:{}},children:(0,He().A)({width:14,height:14})})]}),(0,P.jsx)("div",{style:{overflow:"hidden",height:d?"auto":0,opacity:d?1:0,transition:"height 200ms cubic-bezier(0.4, 0, 0.2, 1)"},children:(0,P.jsx)("div",{style:f.stepsContent,children:h.filter((e=>!!p||e.every((e=>!e.dependentKeys||e.dependentKeys.every((e=>{const t=s.find((t=>t.key===e));return"done"===(null==t?void 0:t.status)||"failed"===(null==t?void 0:t.status)})))))).map(((e,t)=>(0,P.jsx)("div",{style:f.stepGroup,children:e.map((e=>(0,P.jsx)(wt,{step:e,styles:f,getStatusStyles:g,threadStore:r,clientStore:l,transcriptStepId:n,researchModeCitationInfo:c},e.key)))},t)))})})]}):null}var It=()=>n(379079),Tt=()=>n(58836),Bt=()=>n(316855),Mt=()=>n(132280);function Rt(e){const{step:t,threadStore:n,clientStore:o,loading:r}=e,l=(0,a().yK)((e=>({wrap:{}})),[]),s=(0,i().VK)((()=>(0,ve().G)({clientStore:o,threadStore:n})),[o,n]);return(0,P.jsxs)("div",{style:l.wrap,children:[(0,P.jsx)(At,{markdown:t.value,citationInfo:t.citationInfo||{stepCitations:{}}}),n&&s.length>0&&!r&&(0,P.jsx)("div",{style:{animation:"fadeIn 0.7s ease-in"},children:(0,P.jsx)(Kt,{threadStore:n,clientStore:o,transcript:s})})]})}function At(e){const{markdown:t,citationInfo:n}=e,[i,a]=(0,o.useState)(null),l=(0,o.useRef)(new Map),s=(0,o.useMemo)((()=>(0,It().FR)(t)),[t]),c=(0,r().O7)(),d=(0,De().XJ)(Ae().p),u=(0,De().XJ)(Ke().m),{value:p}=(0,De().XJ)(Te().F.clipboardActions),m=(0,o.useCallback)((()=>{if(!p)return;const e=(0,It().jH)(s);p.copyString({environment:c,stringValue:e,copiedMessage:p.clipboardMessages.copiedToClipboard})}),[c,s,p]),g=(0,o.useMemo)((()=>{if(s&&p&&!["idle","pending"].includes(d.status)&&!["idle","pending"].includes(u.status))return je().Z.withListenerIgnored((()=>{const e=new(Ie().Z)({name:"AIChatTranscript.MarkdownChatStep",isTemporaryData:!0}),t=N().createAndCommit({userAction:"AIChatTranscript.MarkdownChatStep.markdownToBlocks",environment:c,canUndo:!1,perform:t=>{const n=p.markdownToBlocks({environment:c,text:s,inMemoryRecordCache:e,transaction:t,markdownOptions:{},markdownLinkifyIt:d.value,tinyMceMicrosoftWordPasteFilter:u.value});if(n)return(0,Be().postProcessAICreatedStores)(c,n),(0,Be().wrapTemporaryBlocksInList)({environment:c,stores:n,inMemoryRecordCache:e,transaction:t})}}).performResult;return e.addCacheFallback(c.defaultRecordCache.inMemoryRecordCache),t}))}),[s,c,d,u,p]);return(0,o.useEffect)((()=>{const e=document.querySelectorAll('a[href$="#citation:"], a[href*="#citation:"]'),t=e=>(e.preventDefault(),e.stopPropagation(),!1);e.forEach((e=>{const n=e.getAttribute("href");if(!n)return;const o=n.indexOf("#citation:");if(-1===o)return;const r=n.slice(o+10),[i,s,c]=r.split("|"),d=decodeURIComponent(i),u=decodeURIComponent(s),p=decodeURIComponent(c);l.current.set(`${d}|${u}|${p}`,e),e.addEventListener("click",(e=>{t(e),a((e=>e===`${d}|${u}|${p}`?null:`${d}|${u}|${p}`))}),!0),e.addEventListener("mousedown",t,!0),e.addEventListener("mouseup",t,!0),e.addEventListener("mouseover",t,!0),e.addEventListener("mouseout",t,!0),e.addEventListener("contextmenu",t,!0)}));const n=l.current;return()=>{e.forEach((e=>{const n=e.getAttribute("href");null!=n&&n.includes("#citation:")&&(e.removeEventListener("click",t,!0),e.removeEventListener("mousedown",t,!0),e.removeEventListener("mouseup",t,!0),e.removeEventListener("mouseover",t,!0),e.removeEventListener("mouseout",t,!0),e.removeEventListener("contextmenu",t,!0))})),n.clear()}}),[g]),g?(0,P.jsxs)("div",{style:{position:"relative"},children:[(0,P.jsx)(f().Z,{ariaLabel:"copy",icon:re().U,onClick:m,style:{position:"absolute",top:8,right:8,zIndex:1,width:32,height:32},iconStyle:{width:24,height:24}}),(0,P.jsx)(Me().O,{displayName:"AIChatTranscript.ResearcherReportStep",disabled:!0,children:(0,P.jsx)(Tt().p,{allowSelectionWithin:!0,children:(0,P.jsx)(Re().Z,{store:g,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0})})}),i&&l.current.get(i)&&(0,P.jsx)($e().ZP,{open:Boolean(i),onClosed:()=>a(null),onDismiss:()=>a(null),originRect:l.current.get(i).getBoundingClientRect(),popupType:$e().kQ.Popup,placementToOrigin:qe().Placement.Bottom,alignmentToOrigin:qe().Alignment.Start,originGap:16,style:{minWidth:300,maxWidth:400,maxHeight:400,overflow:"auto"},preventScaleTransition:!1,render:()=>{const[e,t,o]=i.split("|");if("claim"===t){const t=n.stepCitations[e];return t?(0,P.jsx)(kt,{claimId:o,claims:t.claims,artifacts:t.artifacts,onClose:()=>a(null),researchModeCitationInfo:n,stepKey:e}):null}if("artifact"===t){var r;const t=null===(r=n.stepCitations[e])||void 0===r?void 0:r.artifacts.find((e=>e.id===o));return t?(0,P.jsx)(Ct,{artifact:t,researchModeCitationInfo:n,onClose:()=>a(null)},t.id):null}}})]}):null}function Kt(e){const{threadStore:t,transcript:n,clientStore:l}=e,s=(0,r().O7)(),[c,d]=(0,o.useState)(""),p=(0,i().VK)((()=>l.state.traceId),[l]),f=(0,i().VK)((()=>t.getSpaceId()),[t]),g=(0,i().VK)((()=>l.state.config),[l]),h=(0,o.useCallback)((e=>{d(e.target.value)}),[]),x=(0,o.useCallback)(((e,t)=>{n&&p&&f&&async function(e){const{environment:t,feedbackType:n,notes:o,configType:r,spaceId:i,traceId:a}=e,l="thumbsUp"===n?"inference_transcript_thumbs_up":"inference_transcript_thumbs_down";await u().callApi({eventName:"saveAssistantFeedback",environment:t,data:{type:l,inferenceTranscriptType:r,id:a,space_id:i,notes:o},headers:(0,fe().Bb)({spaceId:i})}),xe().PV({message:"Saved to Braintrust"})}({environment:s,feedbackType:t,notes:c,configType:g.type,spaceId:f,traceId:p}),e.close()}),[s,n,c,f,p,g.type]),v=(0,a().yK)((e=>({popup:{display:"flex",flexDirection:"column",gap:8,padding:8,width:350},feedbackTitle:{marginBottom:6,fontSize:14,fontWeight:500,marginTop:6}})),[]);return(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{style:v.feedbackTitle,children:"Provide feedback"}),(0,P.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:40},children:[(0,P.jsx)(m().ZP,{popupType:m().Z4.Popup,placementToOrigin:m().pO.Bottom,alignmentToOrigin:m().vR.Center,renderOrigin:e=>(0,P.jsx)(y().Z,{isSmall:!0,shouldShrink:!1,icon:Mt().P,...e,children:"Good"}),render:e=>(0,P.jsxs)("div",{style:v.popup,children:[(0,P.jsx)(Bt().Z,{value:c,onChange:h,placeholder:"Add comments here",autoFocus:!0,textarea:!0}),(0,P.jsx)(Y().Z,{onClick:()=>{x(e,"thumbsUp"),d("")},children:"Save"})]})}),(0,P.jsx)(m().ZP,{popupType:m().Z4.Popup,placementToOrigin:m().pO.Bottom,alignmentToOrigin:m().vR.Center,renderOrigin:e=>(0,P.jsx)(y().Z,{isSmall:!0,shouldShrink:!1,icon:se().A,...e,children:"Bad"}),render:e=>(0,P.jsxs)("div",{style:v.popup,children:[(0,P.jsx)(Bt().Z,{value:c,onChange:h,placeholder:"Add comments here",autoFocus:!0,textarea:!0}),(0,P.jsx)(Y().Z,{onClick:()=>{x(e,"thumbsDown"),d("")},children:"Save"})]})})]})]})}var Dt=()=>n(513670),Ft=()=>n(212493),Nt=()=>n(661641);function zt(e){const{step:t}=e,n=t.operations.filter((e=>void 0===e.databaseName)),o=(0,Dt().vM)(t.operations.filter((e=>void 0!==e.databaseName)),(e=>e.databaseName));return(0,P.jsxs)(Ft().jX,{direction:"column",gap:30,children:[(0,P.jsx)(Ot,{categoryName:"",name:"Databases",operations:n}),Object.entries(o).map((e=>{let[t,n]=e;return(0,P.jsx)(_t,{databaseName:t,operations:n},t)}))]})}function _t(e){const{databaseName:t,operations:n}=e,o=n.filter((e=>e.databaseName===t&&void 0===e.propertyName&&void 0===e.viewName)),r=(0,Dt().vM)(n.filter((e=>void 0!==e.propertyName&&void 0===e.viewName)),(e=>e.propertyName)),i=(0,Dt().vM)(n.filter((e=>void 0!==e.viewName)),(e=>e.viewName)),a=Object.keys(r).sort(),l=Object.keys(i).sort();return(0,P.jsxs)(Ft().jX,{direction:"column",gap:30,children:[(0,P.jsx)(Ot,{categoryName:"database",name:t,operations:o,excludeKeys:["databaseName"]}),Object.entries(r).map((e=>{let[t,n]=e;return(0,P.jsx)(Vt,{propertyName:t,operations:n},t)})),Object.entries(i).map((e=>{let[t,n]=e;return(0,P.jsx)(Zt,{viewName:t,operations:n},t)})),(0,P.jsx)(Nt().q,{styleName:"UIRegular-14px/Semibold",children:`Defined ${a.length} properties`}),(0,P.jsx)("ul",{children:a.map((e=>(0,P.jsx)("li",{children:e},e)))}),(0,P.jsx)(Nt().q,{styleName:"UIRegular-14px/Semibold",children:`Defined ${l.length} views`}),(0,P.jsx)("ul",{children:l.map((e=>(0,P.jsx)("li",{children:e},e)))})]})}function Vt(e){const{propertyName:t,operations:n}=e;return(0,P.jsx)(Ot,{categoryName:"property",name:t,operations:n,excludeKeys:["databaseName","propertyName"]})}function Zt(e){const{viewName:t,operations:n}=e;return(0,P.jsx)(Ot,{categoryName:"view",name:t,operations:n,excludeKeys:["databaseName","viewName"]})}function Ot(e){const{name:t,categoryName:n,operations:o,excludeKeys:r=[]}=e,i=Lt();return(0,P.jsxs)(Ft().jX,{direction:"column",gap:10,children:[(0,P.jsxs)(Ft().jX,{direction:"row",align:"center-left",gap:4,children:[(0,P.jsx)(Nt().q,{styleName:"UIRegular-14px/Semibold",children:t}),(0,P.jsx)(Nt().q,{styleName:"UIRegular-14px/Regular",colorName:"tertiary",children:n})]}),(0,P.jsx)(Ft().jX,{gap:4,children:o.map(((e,t)=>{const{type:n,...o}=e;return(0,P.jsxs)(Ft().jX,{direction:"row",gap:10,style:i.operationRow,children:[(0,P.jsx)(Ft().jX,{width:250,style:i.operationType,padding:15,children:(0,P.jsx)(Nt().q,{styleName:"UIRegular-14px/Medium",colorName:"secondary",children:n})}),(0,P.jsx)(Ft().jX,{direction:"column",gap:10,padding:15,children:Object.entries(o).map((e=>{let[t,n]=e;return r.includes(t)?null:(0,P.jsxs)(Ft().jX,{direction:"row",gap:4,children:[(0,P.jsx)(Ft().jX,{width:150,style:i.propertyKey,children:(0,P.jsx)(Nt().q,{styleName:"UISmall-12px/Regular",colorName:"secondary",children:t})}),(0,P.jsx)(Pt,{value:n})]},t)}))})]},t)}))})]})}function Pt(e){const{value:t}=e,n=Lt();return"string"==typeof t?(0,P.jsx)("div",{style:n.monospace,children:t}):(0,P.jsx)("div",{style:n.monospace,children:JSON.stringify(t,null,2)})}function Lt(){return(0,a().yK)((e=>({operationRow:{background:e.surface.wash},operationType:{background:e.fill.lightGraySecondary,flexShrink:0},propertyKey:{flexShrink:0},monospace:{fontFamily:"monospace",fontSize:12,whiteSpace:"pre-wrap",lineHeight:1.3}})),[])}var $t=()=>n(167705);function Ut(e){const{step:t}=e,n=(0,a().yK)((e=>({monospace:{fontFamily:"monospace",fontSize:12,whiteSpace:"pre-wrap",lineHeight:1.3}})),[]),[r,i]=(0,o.useState)(!1),l=t.setup.allTemplates.length,s=t.setup.allTemplates.filter((e=>"collection"===e.type)).length,c=t.setup.allTemplates.filter((e=>"property"===e.type)).length,d=t.setup.allTemplates.filter((e=>"collection_view"===e.type)).length;return(0,P.jsxs)(Ft().jX,{align:"top-left",direction:"row",gap:4,children:[(0,P.jsx)($t().Z,{isSidebar:!1,open:r,onClick:()=>i(!r),fill:!1}),r?(0,P.jsx)(Ft().jX,{padding:"6px 2px",style:n.monospace,children:JSON.stringify(t,null,2)}):(0,P.jsx)(Ft().jX,{align:"center-left",height:24,children:(0,P.jsx)(Nt().q,{styleName:"UIRegular-14px/Semibold",children:`Generated ${l} templates (${s} collections, ${c} properties, ${d} views)`})})]})}var Et=()=>n(531179);function Wt(e){let{step:t}=e;const n=(0,a().yK)((e=>({wrap:{display:"inline-flex",alignItems:"center",justifyContent:"center",padding:"4px 8px",border:`1px solid ${e.regularDividerColor}`,borderRadius:12,alignSelf:"center"},jsonWrap:{display:"flex",flexDirection:"column",marginLeft:"36px",padding:"4px 8px",border:`1px solid ${e.regularDividerColor}`,borderRadius:12}})),[]);let r=!0,i=t.type,l=(0,P.jsx)(Et().G,{data:t});(0,W().yt)(t)?l=(0,P.jsx)(Et().G,{data:t.context}):(0,W().qb)(t)||(0,W().Y)(t)?i=`load ${t.type} (${t.observationType})`:(0,W().NK)(t)||(0,W().SX)(t)?i=`retrieval ${t.type} (${t.observationType})`:(0,W().zZ)(t)||(0,W().cz)(t)?i=`${t.observationType} ${t.type}`:(0,W().Xr)(t)?r=!1:(0,W().Zn)(t)?(r=!1,t.namespace&&(i=`${t.type} (${t.namespace})`)):(0,Ze().t1)(t);const[s,c]=(0,o.useState)(r);return(0,P.jsxs)("div",{style:n.jsonWrap,children:[(0,P.jsx)("div",{onClick:()=>c(!s),children:(0,P.jsx)("strong",{children:i})}),(0,P.jsx)("div",{style:s?{display:"none"}:{},children:l})]})}function Ht(e){const{store:t,onSubmit:n}=e,o=(0,a().yK)((e=>({stagingAndInputWrap:{boxShadow:`0px 0px 0px 1px ${e.stroke.secondary}, 0px 4px 12px -2px rgba(0, 0, 0, 0.08)`,backgroundColor:"dark"===e.mode?e.accentColors.translucentGray[100]:"transparent",borderRadius:12,paddingTop:4,paddingRight:12,paddingBottom:4,paddingLeft:12,overflow:"inherit",flexGrow:1,flexShrink:1,maxWidth:"80%"},wrap:{display:"flex",alignItems:"center",fontSize:14,flexWrap:"wrap"},textContainer:{flexGrow:1,padding:"4px 0",minHeight:void 0,maxHeight:240,overflow:"auto"},placeholder:{opacity:1,cursor:"text"}})),[]);return(0,P.jsx)("div",{style:o.stagingAndInputWrap,tabIndex:0,children:(0,P.jsx)("div",{style:o.wrap,onClick:e=>{if(e.target===e.currentTarget){const n=$().E.findEditableWithStore(t);n&&n.handleClick(e)}},children:(0,P.jsx)(z().Z,{onEnter:n,style:o.textContainer,placeholder:"Ask AI anything",disabled:!1,store:t,placeholderStyle:o.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableEnter:!1,disableMobileActionBar:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestEdit:!0,inPageFind:V().B3.none,usePopupForMentionOnMobile:!0})})})}function Jt(e){const{functionCalls:t,results:n}=e,o=(0,a().yK)((e=>({wrap:{padding:8,marginTop:12},args:{fontWeight:500,color:e.text.secondary,fontSize:12,marginBottom:4,marginTop:12,marginLeft:8},icon:{width:16,height:16,fill:e.text.secondary},codeBlock:{fontFamily:"monospace",whiteSpace:"pre-wrap",wordWrap:"break-word",background:e.codeBlockBackground,color:e.regularTextColor,padding:8,borderRadius:8,fontSize:12,marginTop:8}})),[]),r=t.map((e=>{const t=n.find((t=>t.toolCallId===e.toolCallId));return{call:e,result:t}}));return(0,P.jsx)(ke,{style:o.wrap,children:r.map((e=>{let{call:t,result:n}=e;return(0,P.jsxs)(ue,{label:t.key,iconStyle:o.icon,icon:n?n.error?oe().U:B().Z:at().z,children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{style:o.args,children:"Args"}),(0,P.jsx)("div",{style:o.codeBlock,children:JSON.stringify(t.args,null,2)})]}),n?n.error?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{children:"Error:"}),(0,P.jsx)("div",{style:o.codeBlock,children:JSON.stringify(n.error,null,2)})]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{children:"Result:"}),(0,P.jsx)("div",{style:o.codeBlock,children:n.returnValue||""})]}):null]},t.toolCallId)}))})}function Gt(e){const{step:t,functionCallResults:n}=e,o=(0,a().yK)((e=>({wrap:{display:"flex",flexDirection:"column"},chat:{display:"flex",flexDirection:"column",gap:12,marginRight:24,padding:8,border:`1px solid ${e.regularDividerColor}`,borderRadius:8,marginBottom:8,whiteSpace:"pre-wrap"},name:{fontWeight:"bold"},code:{whiteSpace:"pre-wrap",wordWrap:"break-word",fontFamily:"monospace",background:e.codeBlockBackground,color:e.regularTextColor,padding:8,margin:0,marginBottom:12,fontSize:12},thinking:{color:e.mediumTextColor},proposeWorkflowUpdateWrap:{marginBottom:12}})),[]);if(!t.value)return null;const r=(0,pe().Ms)(t.value),i=t.functionCalls||[];return(0,P.jsxs)("div",{style:o.wrap,children:[r.map(((e,t)=>{if("text"===e.type)return(0,P.jsx)(Xt,{value:e.content},t);if("update-workflow"===e.name){let o;try{o=JSON.parse(function(e){const t=[];let n=!1,o=!1;for(let i=0;i<e.length;i++){const r=e[i];"\\\\"!==r||o?(o||'"'!==r?n||("{"===r||"["===r?t.push(r):"}"===r?"{"===t[t.length-1]&&t.pop():"]"===r&&"["===t[t.length-1]&&t.pop()):n?(t.pop(),n=!1):(t.push('"'),n=!0),o=!1):o=!0}let r=e;for(let i=t.length-1;i>=0;i--)switch(t[i]){case"{":r+="}";break;case"[":r+="]";break;case'"':r+='"'}return r}(e.content))}catch(n){}return o&&o.requirements?(0,P.jsx)(Xt,{value:`\n${o.name?`## ${o.name}`:""}\n\n${o.description?`${o.description}`:""}\n\n${o.requirements}\n`.trim()},t):null}return null})),(i.length>0||n.length>0)&&(0,P.jsx)(Jt,{functionCalls:i,results:n})]})}function Xt(e){const{value:t}=e;return(0,P.jsx)(Ne,{markdown:t})}var qt=()=>n(15409);function Yt(e){const{step:t}=e,n=(0,a().yK)((e=>({wrap:{border:`1px solid ${e.regularDividerColor}`,borderRadius:8,padding:12,marginBottom:8}})),[]);return(0,P.jsx)("div",{style:n.wrap,children:(0,P.jsx)(ue,{label:`Past run: ${t.value.trigger_key}`,icon:t.value.error?oe().U:qt().e,children:(0,P.jsx)(ce().c,{value:JSON.stringify(t.value,null,2),disabled:!0,language:"json"})})})}var Qt=()=>n(396136),en=()=>n(521632),tn=()=>n(850790),nn=()=>n(869851),on=()=>n(745435),rn=()=>n(877691),an=()=>n(128076),ln=()=>n(151833),sn=()=>n(152399),cn=()=>n(286427),dn=()=>n(922065);function un(e){const{steps:t,renderStep:n,done:r,durationMs:i,style:l}=e,[s,c]=(0,o.useState)(!1),d=(0,a().yK)((e=>({container:{display:"flex",flexDirection:"column",...l},header:{display:"flex",alignItems:"center",gap:8,color:e.text.tertiary,fontSize:14,cursor:"pointer",padding:"4px 8px",margin:"0 -6px",backgroundColor:s?e.tint.regular:"transparent",alignSelf:"flex-start"},headerText:{flexGrow:1},steps:{display:"flex",flexDirection:"column",color:e.text.tertiary,fontSize:14,listStyle:"none",padding:0,marginTop:8,marginBottom:0},step:{display:"flex",gap:14,minHeight:32,padding:"0 8px"},icon:{width:10,height:10,fill:e.mediumIconColor,transition:"transform 0.2s ease-in-out",transformOrigin:"center",transform:s?"rotate(0deg)":"rotate(-90deg)"},spinner:{width:14,height:14},stepTrack:{display:"flex",flexDirection:"column",gap:8,alignItems:"center"},stepTrackBullet:{width:6,height:6,borderRadius:6,marginTop:7,backgroundColor:e.tint.regular},stepTrackLine:{flexGrow:1,width:1,backgroundColor:e.tint.regular},stepContent:{flexGrow:1,alignSelf:"flex-start"}})),[s,l]),u=(0,o.useCallback)((()=>{c(!s)}),[s]),p=e=>`${Math.floor(e/6e4)}m ${Math.floor(e%6e4/1e3)}s`;let m;return m=r?i?`Thought for ${p(i)}`:"Thought":t.length>0?s?i?`Thinking for ${p(i)}`:"Thinking":n(t[t.length-1]):"Thinking...",(0,P.jsxs)("div",{style:d.container,children:[(0,P.jsxs)(y().Z,{style:d.header,onClick:u,children:[!r&&(0,P.jsx)(Le().Z,{style:d.spinner}),(0,P.jsx)("div",{style:d.headerText,children:m}),(0,I().E)(d.icon)]}),s&&(0,P.jsx)("ul",{style:d.steps,children:t.map(((e,o)=>(0,P.jsxs)("li",{style:d.step,children:[(0,P.jsxs)("div",{style:d.stepTrack,children:[(0,P.jsx)("div",{style:d.stepTrackBullet}),o<t.length-1&&(0,P.jsx)("div",{style:d.stepTrackLine})]}),(0,P.jsx)("div",{style:d.stepContent,children:n(e)})]},o)))})]})}function pn(e){var t,n,r,l,s,c,d;const{step:u,threadStore:p,loading:m}=e,f=dn().r,g=(0,J().YB)(),[h,y]=(0,o.useState)(!1),x=(0,o.useCallback)((()=>{y(!h)}),[h]),v=(0,i().VK)((()=>{const e=(0,ve().G)({clientStore:f,threadStore:p}).filter((e=>"workflow"===e.type&&!e.workflow_block_id)),t=e[e.length-1];return(null==t?void 0:t.id)===u.id}),[f,p,u.id]),S=(0,a().yK)((e=>({container:{display:"flex",flexDirection:"column",overflow:"hidden",marginBottom:12,marginTop:12},thinkingStep:{marginBottom:8},name:{fontWeight:600,fontSize:14,flexGrow:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},workflowComponentsHeader:{fontWeight:500,color:e.text.secondary,fontSize:12,marginBottom:4,marginTop:12,marginLeft:6},workflowComponentIcon:{width:16,height:16,fill:e.text.tertiary},workflowComponentsContainer:{display:"flex",flexDirection:"column",gap:2},header:{display:"flex",flexDirection:"column",gap:2,padding:12},nameContainer:{display:"flex",alignItems:"center",gap:12},description:{color:e.text.secondary,fontSize:14,fontWeight:400},expandIcon:{width:12,height:12,fill:e.mediumIconColor,transition:"transform 0.2s ease-in-out",transformOrigin:"center",transform:h?"rotate(0deg)":"rotate(-90deg)"},content:{padding:"0 8px 12px",borderTop:`1px solid ${e.stroke.secondary}`,backgroundColor:e.surface.wash},actions:{display:"flex",alignItems:"center",gap:8,marginTop:8},detailsButton:{borderRadius:100,background:e.assistantTintedActionButtonBackground,padding:"0 14px",height:32},badge:{backgroundColor:e.tint.regular,color:e.text.secondary,padding:"4px 8px",borderRadius:6}})),[h]),w=null===(t=u.value)||void 0===t?void 0:t.name,b=null===(n=u.value)||void 0===n?void 0:n.description,C=Object.values((null===(r=u.value)||void 0===r?void 0:r.modules)||[]),k=Object.values((null===(l=u.value)||void 0===l?void 0:l.triggers)||[]),j=Object.values((null===(s=u.value)||void 0===s?void 0:s.functions)||[]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(ke,{style:S.container,children:[(0,P.jsxs)("div",{style:S.header,children:[(0,P.jsxs)("div",{style:S.nameContainer,children:[(0,P.jsx)("div",{style:S.name,children:w||"Untitled workflow"}),u.isUpdate&&!u.workflow_block_id&&(0,P.jsx)(en().Z,{style:S.badge,content:(0,P.jsx)("span",{children:"Draft"})})]}),b&&(0,P.jsx)("div",{style:S.description,children:b}),(0,P.jsxs)("div",{style:S.actions,children:[!m&&v&&(0,P.jsx)(mn,{step:u,threadStore:p,clientStore:f}),(0,P.jsx)(be,{style:S.detailsButton,onClick:x,children:h?"Hide":"Details"}),(!m||!v)&&(0,P.jsx)(fn,{step:u})]})]}),h&&(0,P.jsxs)("div",{style:S.content,children:[C.length>0&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{style:S.workflowComponentsHeader,children:"Modules"}),(0,P.jsx)("div",{style:S.workflowComponentsContainer,children:C.map((e=>(0,P.jsx)(ue,{label:sn()._T.getName(e,g),icon:"database"===e.type?on().t:nn().L,iconStyle:S.workflowComponentIcon,children:(0,P.jsx)(ce().c,{value:JSON.stringify(e,null,2),disabled:!0,language:"json"})},e.key)))})]}),((null===(c=u.value)||void 0===c?void 0:c.views)||[]).length>0&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{style:S.workflowComponentsHeader,children:"Views"}),(0,P.jsx)("div",{style:S.workflowComponentsContainer,children:((null===(d=u.value)||void 0===d?void 0:d.views)||[]).map((e=>(0,P.jsx)(ue,{label:e.name,icon:rn().J,iconStyle:S.workflowComponentIcon,children:(0,P.jsx)(ce().c,{value:JSON.stringify(e,null,2),disabled:!0,language:"json"})},e.key)))})]}),k.length>0&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{style:S.workflowComponentsHeader,children:"Triggers"}),(0,P.jsx)("div",{style:S.workflowComponentsContainer,children:k.map((e=>(0,P.jsx)(ue,{label:e.name,icon:tn().K,iconStyle:S.workflowComponentIcon,children:(0,P.jsx)(ce().c,{value:JSON.stringify(e,null,2),disabled:!0,language:"json"})},e.key)))})]}),j.length>0&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{style:S.workflowComponentsHeader,children:"Functions"}),(0,P.jsx)("div",{style:S.workflowComponentsContainer,children:j.map((e=>(0,P.jsx)(o.Fragment,{children:(0,P.jsxs)(ue,{label:`${e.name}`,icon:at().z,iconStyle:S.workflowComponentIcon,children:[(0,P.jsx)(ce().c,{value:e.value||"",disabled:!0,language:"typescript"}),(0,P.jsx)(ce().c,{value:JSON.stringify({...e,value:void 0,tests:void 0},null,2),disabled:!0,language:"json"}),(0,P.jsx)("div",{style:S.workflowComponentsContainer,children:(e.tests||[]).map((e=>(0,P.jsx)(ue,{label:e.description.name,icon:e.result?e.result.passed?B().Z:oe().U:void 0,iconStyle:S.workflowComponentIcon,children:(0,P.jsx)(ce().c,{value:JSON.stringify(e,null,2),disabled:!0,language:"json"})},e.description.name)))})]})},e.key)))})]})]})]}),u.isUpdate&&(0,P.jsx)(un,{steps:u.progressSteps||[],renderStep:e=>(0,P.jsx)(gn,{step:e}),durationMs:u.durationMs,done:u.completed||!1,style:S.thinkingStep})]})}function mn(e){const{step:t,threadStore:n,clientStore:a}=e,l=(0,r().O7)(),s=(0,i().VK)((()=>(0,ve().G)({clientStore:a,threadStore:n})),[a,n]).find((e=>"config"===e.type)),d=s&&"workflow"===s.value.type&&s.value.workflowBlockId?s.value.workflowBlockId:t.workflow_block_id,u=(0,i().VK)((()=>{const{currentSpaceStore:e}=M().default.state;if(!d||!e)return;const t=an().G.createChildStore(e,{table:Qt().iU,id:d,spaceId:e.id}).getFormat().workflow_id;return t?ln().h.createChildStore(n,{table:c().An,id:t,spaceId:e.id}):void 0}),[d,n]),p=(0,i().VK)((()=>{if(!u)return!0;const e=(0,cn().x)(u);return!Dt().Xy(e,t.value)}),[u,t.value]),m=(0,o.useCallback)((()=>{N().createAndCommit({userAction:"AIChatTranscript.SaveWorkflowButton.handleClick",environment:l,canUndo:!0,perform:e=>{u?(0,K().U0)({workflowStore:u,environment:l,workflow:t.value,transaction:e}):(0,K().Ux)({environment:l,workflow:t.value,workflowBlockId:d,transaction:e,threadStore:n,step:t})}})}),[l,t,u,n,d]);return u&&!p?null:(0,P.jsx)(Ce,{onClick:m,children:u?"Update workflow":"Create workflow"})}function fn(e){const{step:t}=e,n=(0,r().O7)(),i=(0,o.useCallback)((()=>{const{currentSpaceStore:e}=M().default.state;if(!e||!t.workflow_block_id)return;const o=an().G.createChildStore(e,{table:Qt().iU,id:t.workflow_block_id,spaceId:e.id});(0,K().TY)({environment:n,store:o})}),[n,t.workflow_block_id]);return t.workflow_block_id?(0,P.jsx)(be,{onClick:i,children:"Open workflow"}):null}function gn(e){const{step:t}=e;return"added-module-type"===t.type?(0,P.jsx)("div",{children:`Added ${t.moduleType}`}):"updated-module"===t.type?(0,P.jsx)("div",{children:`Updated ${t.moduleName}`}):"updated-view"===t.type?(0,P.jsx)("div",{children:`Updated view ${t.viewName}`}):"updated-trigger"===t.type?(0,P.jsx)("div",{children:`Updated trigger ${t.triggerName}`}):"updated-function"===t.type?(0,P.jsx)("div",{children:`Updated function ${t.functionName}`}):void(0,Ze().t1)(t)}function hn(e){const{threadId:t,clientStore:n,config:r,threadStore:l,isInEditor:s}=e,c=(0,a().yK)((e=>({title:{fontSize:16,color:e.mediumTextColor,fontWeight:500},transcript:{display:"flex",flexDirection:"column",fontSize:14,marginBottom:36,paddingLeft:12,paddingRight:12}})),[]),d=(0,i().VK)((()=>(0,ve().G)({clientStore:n,threadStore:l})),[n,l]),u=(0,i().VK)((()=>n.state.config),[n]),p=(0,i().VK)((()=>n.state.showDebug),[n]),m=(0,i().VK)((()=>n.state.loading||void 0!==(null==l?void 0:l.getCurrentInferenceId())),[n,l]),f=(0,i().VK)((()=>n.state.config),[n]),g=(0,o.useCallback)((e=>{n.setState({...n.state,config:e})}),[n]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[!s&&!t&&!r&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{style:c.title,children:"Select a mode"}),(0,P.jsx)("div",{style:{display:"flex",flexDirection:"column"},children:E().t8.map(((e,t)=>(0,P.jsx)(xn,{config:e,clientStore:n},t)))}),(0,P.jsx)(yn,{activeConfig:u})]}),!s&&!t&&r&&p&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{style:c.title,children:`Chat Mode: ${r.type}`}),(0,P.jsx)(yn,{activeConfig:u})]}),f&&p&&(0,P.jsx)(Rn,{config:f,setConfig:g})]}),l&&d.length>0&&(0,P.jsx)("div",{style:c.transcript,children:d.map(((e,t)=>(0,P.jsx)(Sn,{step:e,threadStore:l,clientStore:n,loading:m,isLastStep:t===d.length-1,nextStep:d[t+1]},e.id)))})]})}function yn(e){const{activeConfig:t}=e,n=(0,a().yK)((e=>({helpText:{marginTop:12,color:e.mediumTextColor,fontSize:12},link:{display:"inline",fontWeight:500,color:e.opacityLinkDecorationColor,textDecoration:"underline"}})),[]);let o="";return"researcher"===t.type&&(o=(0,P.jsxs)("div",{children:["For more info on research mode, check out the pre-alpha FAQ: ",(0,P.jsx)(q().Z,{href:"https://dev.notion.so/notion/Research-Mode-Pre-Alpha-FAQ-17cb35e6e67f809faf27f0cf77135ab1",style:n.link,children:"Research Mode Pre-Alpha FAQ"})]})),""===o?null:(0,P.jsx)("div",{style:n.helpText,children:o})}function xn(e){const{config:t,clientStore:n}=e,r=(0,o.useCallback)((()=>{n.setState({...n.state,config:t})}),[n,t]),a=(0,i().VK)((()=>n.state.config.type===t.type),[n,t]);return(0,P.jsx)(y().Z,{onClick:r,icon:a?B().Z:void 0,children:t.type})}function vn(e){const{step:t,threadStore:n,clientStore:r,loading:l,isLastStep:s,nextStep:c}=e,d=(0,i().VK)((()=>r.state.showDebug),[r]),[u,p]=(0,o.useState)(!1),m=(0,o.useCallback)((()=>{p(!0)}),[]),f=(0,o.useCallback)((()=>{p(!1)}),[]);let g=!1;"workflow"===t.type&&(g=!0);const h=u||s||g,y=(0,a().yK)((e=>({wrap:{display:"flex",flexDirection:"column",gap:4},feedbackActions:{display:"flex",alignItems:"center",gap:4,opacity:h?1:0},stepActions:{display:"flex",alignItems:"center",gap:4,opacity:h?1:0,marginTop:4}})),[h]);let x=null;x="config"===t.type?d?(0,P.jsx)(wn,{step:t}):null:"user"===t.type?(0,P.jsx)(bn,{step:t,clientStore:r,threadStore:n}):"error"===t.type||"workflow-error"===t.type?(0,P.jsx)(Mn,{step:t}):"markdown-chat"===t.type?(0,P.jsx)(Fe,{step:t}):"title"===t.type?null:"workflow-inference"===t.type?"workflowAgent8"===t.inferenceType||"workflowChatRunAgent"===t.inferenceType?(0,P.jsx)(Gt,{step:t,functionCallResults:"workflow-function-call-results"===(null==c?void 0:c.type)?c.value:[]}):null:"workflow"===t.type?(0,P.jsx)(pn,{step:t,threadStore:n,loading:l}):"workflow-function-call-results"===t.type?null:"workflow-run-context"===t.type?(0,P.jsx)(Yt,{step:t}):"search-queries"===t.type||"search-results"===t.type?(0,P.jsx)(Kn,{step:t}):"search-chat"===t.type?(0,P.jsx)(Fe,{step:{id:t.id,type:"markdown-chat",value:t.value}}):"fast-researcher-plan"===t.type||"fast-researcher-search-results"===t.type?(0,P.jsx)(Kn,{step:t}):"fast-researcher-chat"===t.type?(0,P.jsx)(Fe,{step:{id:t.id,type:"markdown-chat",value:t.value}}):"setup-operations"===t.type?(0,P.jsx)(zt,{step:t}):"setup"===t.type?(0,P.jsx)(Ut,{step:t}):"researcher-plan"===t.type?(0,P.jsx)(jt,{step:t,threadStore:n,clientStore:r,stepId:t.id}):"researcher-plan-update"===t.type||"researcher-plan-step-update"===t.type||"researcher-agent"===t.type||"researcher-plan-replay-from-previous"===t.type||"researcher-text-observation"===t.type||"researcher-next-steps"===t.type?null:"researcher-report"===t.type?(0,P.jsx)(Rt,{step:t,threadStore:n,clientStore:r,loading:l}):"search-observation"===t.type?null:"context"===t.type?"value"in t?(0,P.jsx)(Dn,{step:t}):null:"registered-tool-call"===t.type||"registered-tool-output"===t.type||"registered-tool-error"===t.type||"retry"===t.type||"debug-inference"===t.type||"autocorrect"===t.type||"memory-agent"===t.type||"summarize-transcript"===t.type||"summarize-transcript-response"===t.type?null:"registered-tool-grouping"===t.type?(0,P.jsx)(vt,{groupStep:t}):(0,W().Xr)(t)||(0,W().qb)(t)||(0,W().Y)(t)||(0,W().NK)(t)||(0,W().SX)(t)||(0,W().zZ)(t)||(0,W().cz)(t)||(0,W().Zn)(t)?(0,P.jsx)(Wt,{step:t}):(0,P.jsx)(An,{step:t}),d&&null===x&&(x=(0,P.jsx)(kn,{step:t}));let v=null;"config"===t.type||"error"===t.type||"title"===t.type||"context"===t.type||"setup"===t.type||"workflow-error"===t.type||"workflow-run-context"===t.type||"setup-operations"===t.type||"retry"===t.type||"memory-agent"===t.type||"markdown-chat"===t.type||"fast-researcher-chat"===t.type||"search-chat"===t.type?v=null:"researcher-plan"===t.type?v=(0,P.jsx)(jn,{step:t,threadStore:n,clientStore:r,label:"Retry"}):"researcher-plan-step-update"===t.type||"researcher-plan-update"===t.type||"researcher-next-steps"===t.type||"researcher-agent"===t.type||"researcher-report"===t.type||"search-observation"===t.type||"researcher-plan-replay-from-previous"===t.type||"researcher-text-observation"===t.type||"user"===t.type?v=null:"workflow-inference"===t.type?"workflowAgent8"!==t.inferenceType&&"workflowChatRunAgent"!==t.inferenceType||l||s&&!l&&(v=(0,P.jsxs)(P.Fragment,{children:[t.functionCalls&&t.functionCalls.length>0&&(0,P.jsx)(In,{step:t,threadStore:n,clientStore:r}),"workflowAgent8"===t.inferenceType&&t.updateWorkflow&&(0,P.jsx)(jn,{step:t,threadStore:n,clientStore:r,label:"Build"})]})):v=("workflow"===t.type||"workflow-function-call-results"===t.type||"registered-tool-call"===t.type||"registered-tool-output"===t.type||"registered-tool-error"===t.type||"registered-tool-grouping"===t.type||"debug-inference"===t.type||"autocorrect"===t.type||"search-queries"===t.type||"search-results"===t.type||"fast-researcher-search-results"===t.type||"fast-researcher-plan"===t.type||"summarize-transcript"===t.type||"summarize-transcript-response"===t.type||(0,W().Xr)(t)||(0,W().qb)(t)||(0,W().Y)(t)||(0,W().NK)(t)||(0,W().SX)(t)||(0,W().zZ)(t)||(0,W().cz)(t)||(0,W().Zn)(t),null);let S=null;if("markdown-chat"===t.type||"fast-researcher-chat"===t.type||"search-chat"===t.type?S=(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Bn,{step:t}),(0,P.jsx)(Tn,{step:t,threadStore:n})]}):"workflow-inference"===t.type&&("workflowAgent8"!==t.inferenceType&&"workflowChatRunAgent"!==t.inferenceType||(S=(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Bn,{step:t}),(0,P.jsx)(Tn,{step:t,threadStore:n})]}))),!x)return null;const w="user"===t.type?"right":"left";return(0,P.jsxs)("div",{style:y.wrap,onMouseEnter:m,onMouseLeave:f,children:[x,S&&(0,P.jsxs)("div",{style:y.feedbackActions,children:["right"===w&&(0,P.jsx)("div",{style:{flexGrow:1}}),S,"left"===w&&(0,P.jsx)("div",{style:{flexGrow:1}})]}),v&&(0,P.jsxs)("div",{style:y.stepActions,children:["right"===w&&(0,P.jsx)("div",{style:{flexGrow:1}}),v,"left"===w&&(0,P.jsx)("div",{style:{flexGrow:1}})]})]})}const Sn=o.memo(vn);function wn(e){const{step:t}=e,n=(0,a().yK)((e=>({wrap:{display:"inline-flex",alignItems:"center",justifyContent:"center",padding:"4px 10px",borderRadius:16,alignSelf:"center",background:e.surface.contrast,boxShadow:`0 0 0 0.5px ${e.stroke.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.04)`,fontSize:11,fontWeight:600,color:e.white,textTransform:"uppercase",userSelect:"none"}})),[]);return(0,P.jsx)("div",{style:n.wrap,children:t.value.type})}function bn(e){const{step:t,clientStore:n,threadStore:l}=e,s=(0,r().O7)(),c=(0,a().Fg)(),d=(0,J().YB)(),u=t.userId===s.currentUser.id,p=(0,i().VK)((()=>{const{currentSpaceStore:e}=M().default.state;if(e&&t.userId)return A().U6.createChildStore(e,{table:H().KJ,id:t.userId})}),[t.userId]),m=(0,i().VK)((()=>null==p?void 0:p.getDisplayName(d)),[p,d]),[g,h]=(0,o.useState)(!1),[y,x]=(0,o.useState)(!1),v=(0,a().yK)((e=>({container:{display:"flex",flexDirection:"column",alignItems:u?"flex-end":"flex-start",gap:4},messageRow:{display:"flex",alignItems:"start",gap:8,width:"100%",justifyContent:u?"flex-end":"flex-start"},userLabel:{color:e.mediumTextColor,fontSize:12,marginLeft:52},bubble:{maxWidth:"80%",padding:"8px 12px",borderRadius:16,backgroundColor:e.tint.regular,whiteSpace:"pre-wrap",wordWrap:"break-word"},actionsRow:{display:"flex",gap:4,justifyContent:"flex-end",opacity:g||y?1:0,marginBottom:u?0:12},hoverAction:{width:24,height:24},avatarContainer:{paddingTop:4}})),[u,g,y]),S=(0,i().VK)((()=>{const e=l.getSpaceId();return e?(0,te().IY)({environment:s,textValue:{value:t.value,spaceId:e},parentStore:l,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disabled:!0,theme:c,emojiType:(0,ee().e_)(s),katex:s.KatexStore.getKatex(),formulaValueTypes:[]}):null}),[t.value,s,l,c]),w=(0,o.useCallback)((()=>{h(!0)}),[]),C=(0,o.useCallback)((()=>{h(!1)}),[]),k=(0,o.useCallback)((()=>{x(!0),h(!1)}),[]),j=(0,o.useCallback)((e=>{x(!1),h(!1);const o=l.getTranscript().findIndex((e=>e.id===t.id));if(o<0)throw new Error("Step not found");const{serverCommitResult:r}=N().createAndCommit({userAction:"AIChatTranscript.RunFromStepButton.handleClick",environment:s,canUndo:!0,perform:t=>{(0,D().bc)({threadStore:l,stepIndex:o,newValue:e,transaction:t}),(0,D().mH)({threadStore:l,stepIndex:o,transaction:t})}});(0,D().nD)({environment:s,threadStore:l,clientStore:n,threadCommitResult:r})}),[n,s,l,t]),{store:I,setValue:T}=(0,b().Cl)({initialValue:t.value}),B=(0,o.useCallback)((()=>{x(!1),T(t.value)}),[t.value,T]),R=(0,o.useCallback)((()=>{j(I.getValue()||[])}),[j,I]);return(0,P.jsxs)("div",{style:v.container,onMouseEnter:w,onMouseLeave:C,children:[!u&&(0,P.jsx)("div",{style:v.userLabel,children:m}),(0,P.jsxs)("div",{style:v.messageRow,children:[!u&&p&&(0,P.jsx)("div",{style:v.avatarContainer,children:(0,P.jsx)(Q().Z,{userStore:p,size:32})}),!y&&(0,P.jsx)("div",{style:v.bubble,children:S}),y&&(0,P.jsx)(Ht,{onSubmit:R,store:I})]}),(0,P.jsxs)("div",{style:v.actionsRow,children:[u&&!y&&(0,P.jsx)(f().Z,{style:v.hoverAction,icon:ae().R,ariaLabel:"Edit message",onClick:k}),y&&(0,P.jsx)(Cn,{step:t,onCancel:B,onSave:R})]})]})}function Cn(e){const{step:t,onCancel:n,onSave:r}=e,{store:i}=(0,b().Cl)({initialValue:t.value}),a=(0,o.useCallback)((()=>{r(i.getValue()||[])}),[i,r]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(f().Z,{onClick:n,icon:oe().U,ariaLabel:"Cancel"}),(0,P.jsx)(f().Z,{onClick:a,icon:ne().$,ariaLabel:"Save"})]})}function kn(e){const{step:t}=e,n=(0,a().yK)((e=>({container:{display:"flex",flexDirection:"column",gap:4},messageRow:{display:"flex",alignItems:"flex-start",gap:8,width:"100%",justifyContent:"flex-start"},button:{width:"fit-content",color:e.mediumTextColor,fontSize:12},bubble:{padding:"8px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:12,backgroundColor:e.contentBackground,whiteSpace:"pre-wrap",wordWrap:"break-word",marginBottom:4}})),[]),[r,i]=(0,o.useState)(!1);return(0,P.jsxs)("div",{style:n.container,children:[(0,P.jsx)(y().Z,{onClick:()=>i(!r),style:n.button,children:t.type}),r&&(0,P.jsx)("div",{style:n.bubble,children:(0,P.jsx)(ce().c,{language:"json",value:JSON.stringify(t,null,2)})})]})}function jn(e){const{step:t,threadStore:n,clientStore:i,label:a}=e,l=(0,r().O7)(),s=(0,o.useCallback)((()=>{const e=n.getTranscript().findIndex((e=>e.id===t.id));if(e<0)throw new Error("Step not found");const{serverCommitResult:o}=N().createAndCommit({userAction:"AIChatTranscript.RunFromStepButton.handleClick",environment:l,canUndo:!0,perform:t=>{(0,D().mH)({threadStore:n,stepIndex:e,transaction:t})}});(0,D().nD)({environment:l,threadStore:n,clientStore:i,threadCommitResult:o})}),[l,t.id,n,i]);return(0,P.jsx)(Ce,{onClick:s,children:a})}function In(e){const{step:t,threadStore:n,clientStore:i}=e,l=(0,r().O7)(),s=(0,a().yK)((e=>({icon:{height:10}})),[]),c=(0,o.useCallback)((()=>{const e=n.getTranscript().findIndex((e=>e.id===t.id));if(e<0)throw new Error("Step not found");const{serverCommitResult:o}=N().createAndCommit({userAction:"AIChatTranscript.RunFromStepButton.handleClick",environment:l,canUndo:!0,perform:t=>{(0,D().mH)({threadStore:n,stepIndex:e,transaction:t})}});(0,D().nD)({environment:l,threadStore:n,clientStore:i,threadCommitResult:o})}),[l,t.id,n,i]);return(0,P.jsx)(y().Z,{onClick:c,isSmall:!0,shouldShrink:!1,icon:le().I,iconStyle:s.icon,children:t.functionCalls&&t.functionCalls.length>1?"Run all":"Run"})}function Tn(e){const{step:t,threadStore:n}=e,i=(0,r().O7)(),l=(0,r().Fy)(),s=(0,a().yK)((e=>({icon:{height:14},popup:{display:"flex",flexDirection:"column",gap:8,padding:8,width:350}})),[]),[c,d]=(0,o.useState)(""),u=(0,o.useCallback)((e=>{d(e.target.value)}),[]),p=(0,o.useCallback)((async e=>{e.close(),await Se({environment:i,step:t,threadStore:n,metadata:{comment:c}})}),[i,t,n,c]);return(0,P.jsx)(m().ZP,{popupType:l.isMobile?m().Z4.SlideUp:m().Z4.Popup,placementToOrigin:m().pO.Bottom,alignmentToOrigin:m().vR.Center,renderOrigin:e=>(0,P.jsx)(f().Z,{icon:se().A,iconStyle:s.icon,...e,ariaLabel:"Report feedback"}),render:e=>(0,P.jsxs)("div",{style:s.popup,children:[(0,P.jsx)(X().Z,{value:c,onChange:u,placeholder:"Add comments here",autoFocus:!0,textarea:!0}),(0,P.jsx)(Y().Z,{onClick:()=>p(e),children:"Save"})]})})}function Bn(e){const{step:t}=e,n=(0,r().O7)(),i=(0,o.useCallback)((()=>{(0,D().cG)({environment:n,step:t})}),[n,t]);return(0,P.jsx)(f().Z,{icon:re().U,ariaLabel:"Copy step text",onClick:i})}function Mn(e){const{step:t}=e,n=(0,a().yK)((e=>({container:{padding:8},icon:{width:16,height:16,fill:e.errorText},header:{color:e.errorText}})),[]);return(0,P.jsx)(ke,{style:n.container,children:(0,P.jsx)(ue,{label:"Error",icon:ie().l,iconStyle:n.icon,children:(0,P.jsx)(ce().c,{value:JSON.stringify(t,null,2),disabled:!0,language:"text"})})})}function Rn(e){const{config:t,setConfig:n}=e,o=Object.entries(t).filter((e=>{let[t,n]=e;return"type"!==t&&("boolean"==typeof n||"string"==typeof n||"number"==typeof n)})),r=(0,a().yK)((e=>({wrap:{margin:"12px 0",display:"flex",flexDirection:"column",gap:8},title:{fontSize:16,color:e.mediumTextColor,fontWeight:500},row:{display:"flex",alignItems:"center",gap:8,color:e.mediumTextColor,fontSize:12},input:{width:200,backgroundColor:e.contentBackground,border:`1px solid ${e.regularDividerColor}`,fontSize:12,color:e.mediumTextColor}})),[]);if(0===o.length)return null;const i=o.map((e=>{let[o,i]=e;return((e,o)=>"boolean"==typeof o?(0,P.jsxs)("div",{style:r.row,children:[(0,P.jsx)(G().Z,{checked:o,onClick:()=>n({...t,[e]:!o}),size:12}),(0,P.jsx)("span",{children:e})]},e):"string"==typeof o||"number"==typeof o?(0,P.jsxs)("div",{style:r.row,children:[(0,P.jsx)("span",{children:e}),(0,P.jsx)(X().Z,{value:o.toString(),onChange:r=>{const i="number"==typeof o?Number(r.target.value):r.target.value;n({...t,[e]:i})},style:{width:200}})]},e):null)(o,i)}));return i.length>0?(0,P.jsxs)("div",{style:r.wrap,children:[(0,P.jsx)("div",{style:r.title,children:"Configuration"}),(0,P.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:16},children:i})]}):null}function An(e){const{step:t}=e;return(0,P.jsx)(ue,{label:`Unknown step type: ${t.type}`,icon:ie().l,children:(0,P.jsx)(ce().c,{value:JSON.stringify(t,null,2),language:"text"})})}function Kn(e){const{step:t}=e;return(0,P.jsx)(ue,{label:t.type,children:(0,P.jsx)(ce().c,{value:JSON.stringify(t,null,2)})})}function Dn(e){var t;const{step:n}=e,r=(0,a().yK)((e=>({wrap:{display:"inline-flex",alignItems:"center",justifyContent:"center",padding:"4px 10px",borderRadius:16,alignSelf:"center",background:e.surface.elevated,boxShadow:`0 0 0 0.5px ${e.stroke.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.04)`,fontSize:11,fontWeight:600,textTransform:"uppercase",margin:"24px 0",userSelect:"none"}})),[]),i=(0,o.useMemo)((()=>{var e;if(null===(e=n.value)||void 0===e||!e.currentDatetime)return null;return new Date(n.value.currentDatetime).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}),[null===(t=n.value)||void 0===t?void 0:t.currentDatetime]);return(0,P.jsx)("div",{style:r.wrap,children:i})}var Fn=()=>n(154186),Nn=()=>n(164079);function zn(e){const{clientStore:t,threadStore:n}=e,l=(0,r().O7)(),s=(0,a().yK)((e=>({topBar:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,fontSize:14},modelPickerRow:{display:"flex",alignItems:"center",gap:8},configEditorWrap:{display:"flex",flexDirection:"column",gap:8,overflowY:"auto",fontSize:14},inferencesWrap:{display:"flex",flexDirection:"column",gap:8,overflowY:"auto",fontSize:14},tagsRow:{display:"flex",alignItems:"center",gap:8}})),[]),c=(0,o.useCallback)((()=>{t.setState({...t.state,showDebug:!1})}),[t]),d=(0,o.useCallback)((async()=>{const{accept:e}=await xe().gt({message:"Are you sure you want to save all inferences?",description:"IMPORTANT: Please check with the engineering team first! This will add all selected inferences to their respective Braintrust datasets to be loaded as few-shot examples, and could break AI workflows if not done carefully.",acceptLabel:"Save",cancelLabel:"Cancel",acceptColor:"red",acceptButtonType:"solid",cancelButtonType:"outline"});e&&await async function(e){const{environment:t,clientStore:n}=e;n.setState({...n.state,loading:!0});const{cachedInferences:o,annotationInferences:r}=(0,ve().h)(n),i=n.state.tags,a=o.map((e=>{const t=(0,ge().o_)(e.value.input);return r.find((e=>(0,ge().o_)(e.value.input)===t))||e}));await Promise.all(a.map((e=>{const o=n.state.inferenceKeysToMemories[e.key];return u().callApi({eventName:"insertIntoBraintrustDataset",environment:t,data:{project:me().V8,dataset:e.value.input.type,value:{...e.value,input:{...e.value.input,examples:[]},metadata:{...e.value.metadata,...o?{memories:[o.value]}:{}},tags:i}}})}))),xe().PV({message:"Saved"}),n.setState({...n.state,loading:!1})}({environment:l,clientStore:t})}),[t,l]),p=(0,i().VK)((()=>{const{cachedInferences:e}=(0,ve().h)(t);return e.length}),[t]),m=(0,i().VK)((()=>t.state.inferences.length),[t]),g=(0,i().VK)((()=>t.state.loading),[t]),h=(0,i().VK)((()=>t.state.inferences),[t]),x=(0,i().VK)((()=>{var e;return null==n||null===(e=n.getData())||void 0===e?void 0:e.inferences}),[n]),[v,S]=(0,o.useState)(!1);(0,o.useEffect)((()=>{x&&x.length>0&&0===h.length&&!v&&(t.setState({...t.state,inferences:x.map(((e,t)=>({type:"inference",key:(0,ge().o_)(e.input),index:t,value:e,isFinal:!1})))}),S(!0))}),[x,h.length,t,v]);const w=(0,o.useCallback)((()=>{const{acceptedInferenceKeys:e}=t.state;e.length>0?t.setState({...t.state,acceptedInferenceKeys:[]}):t.setState({...t.state,acceptedInferenceKeys:t.state.inferences.map((e=>e.key))})}),[t]),b=(0,o.useCallback)((()=>{const{acceptedInferenceKeys:e}=t.state;e.length>0?t.setState({...t.state,acceptedInferenceKeys:[]}):t.setState({...t.state,acceptedInferenceKeys:t.state.inferences.filter((e=>e.isFinal)).map((e=>e.key))})}),[t]),C=(0,o.useCallback)((()=>{!function(e){const{clientStore:t}=e;t.state.abortController&&t.state.abortController.abort(),t.setState({...t.state,abortController:void 0,loading:!1,temporarySteps:[]})}({clientStore:t})}),[t]);return(0,P.jsxs)("div",{style:{padding:16,gap:16,display:"flex",flexDirection:"column",rowGap:16},children:[(0,P.jsxs)("div",{style:s.topBar,children:[g&&(0,P.jsx)(Le().Z,{}),m>0&&(0,P.jsx)("div",{children:`${m} inference${1===m?"":"s"}`}),g&&(0,P.jsx)(y().Z,{onClick:C,isRed:!0,children:"Cancel"}),(0,P.jsx)("div",{style:{flexGrow:1}}),!g&&m>0&&(0,P.jsx)(y().Z,{onClick:b,children:"Toggle all final"}),!g&&m>0&&(0,P.jsx)(y().Z,{onClick:w,children:"Toggle all"}),!g&&p>0&&(0,P.jsx)(y().Z,{isBlue:!0,onClick:d,children:`Save ${p} inference${1===p?"":"s"}`}),(0,P.jsx)(f().Z,{onClick:c,icon:oe().U,ariaLabel:"close debug tools"})]}),!g&&p>0&&(0,P.jsxs)("div",{style:s.tagsRow,children:["Tags",(0,P.jsx)(Pn,{clientStore:t})]}),(0,P.jsx)("div",{style:s.inferencesWrap,children:h.map(((e,n)=>(0,P.jsx)(Vn,{inference:e,clientStore:t},`${e.key}-${n}`)))})]})}function _n(e){const{inference:t,clientStore:n}=e,l=t.key,s=(0,r().O7)(),c=(0,a().yK)((e=>({wrap:{display:"flex",flexDirection:"column",gap:12,padding:8,border:`1px solid ${e.regularDividerColor}`,borderRadius:4,whiteSpace:"pre-wrap"},header:{display:"flex",gap:8,alignItems:"center"},toggle:{border:"none",padding:0,margin:0},code:{whiteSpace:"pre-wrap",fontFamily:"monospace",background:e.codeBlockBackground,color:e.regularTextColor,padding:8,margin:0,marginBottom:12,fontSize:12},lockedIcon:{width:16}})),[]),d=(0,i().VK)((()=>n.state.inferenceKeysToAnnotations[l]),[n,l]),p=(0,o.useCallback)((e=>{const t=e.target.value,o={...n.state.inferenceKeysToAnnotations,[l]:t};n.setState({...n.state,inferenceKeysToAnnotations:o})}),[n,l]),m=(0,i().VK)((()=>{const{acceptedInferenceKeys:e}=n.state;return e.includes(l)}),[n,l]),f=(0,o.useCallback)((e=>{const{acceptedInferenceKeys:t,inferences:o}=n.state,r=e.shiftKey;if(t.includes(l))if(r){const e=o.findIndex((e=>e.key===l)),r=o.slice(0,e+1).map((e=>e.key));n.setState({...n.state,acceptedInferenceKeys:Dt().jj(t.filter((e=>!r.includes(e))))})}else n.setState({...n.state,acceptedInferenceKeys:t.filter((e=>e!==l))});else if(r){const e=o.findIndex((e=>e.key===l)),r=o.slice(0,e+1).map((e=>e.key)),i=Dt().jj([...t,...r]);n.setState({...n.state,acceptedInferenceKeys:i})}else n.setState({...n.state,acceptedInferenceKeys:Dt().jj([...t,l])})}),[n,l]),g=(0,o.useMemo)((()=>{const e=null==t?void 0:t.value.expected;if(!e)return"";if("string"!=typeof e)return e.map((e=>{if("text"===e.type)return`[text]\n${e.content}`;{let n;try{n=JSON.stringify(JSON.parse(e.content),null,2)}catch(t){n=e.content}return`[tool:${e.name}]\n${n}`}})).join("\n");try{return e.trim().startsWith("{")?JSON.stringify(JSON.parse(e),null,2):e}catch(n){return e}}),[t]),h=(0,i().VK)((()=>n.state.inferenceKeysToMemories[l]),[n,l]),x=(0,o.useCallback)((async()=>{await async function(e){const{environment:t,clientStore:n,inference:o}=e,r=n.state.inferenceKeysToAnnotations[o.key],i=n.state.model,a=M().default.state.currentSpaceStore;if(!a)throw new Error("No current space store");if(!i)return void xe().PV({message:"No model selected"});const l=await u().callStreamApi({eventName:"runInferenceTranscript",environment:t,data:{transcript:[{id:(0,ye().ZP)(),type:"config",value:{type:"debug-inference",inference:{...o.value,input:{...o.value.input,...r?{annotation:r}:void 0}},model:i}}],traceId:(0,ye().ZP)(),spaceId:a.id,generateTitle:!1},headers:(0,fe().Bb)({spaceId:a.id})});if("failed"===l.type)throw l.error;const s=[];if(he().H1.is(l.data))for await(const c of l.data)if("debug-inference"===c.type)s.push(c.value),n.setState({...n.state,inferences:n.state.inferences.map((e=>e.key===o.key?{...e,value:{...e.value,expected:(0,pe().De)(s)}}:e))});else if("error"===c.type)throw c.message}({environment:s,clientStore:n,inference:t})}),[n,s,t]),v=(0,o.useCallback)((async()=>{await async function(e){const{environment:t,clientStore:n,inference:o}=e,r=n.state.inferenceKeysToAnnotations[o.key],i=n.state.model,a=M().default.state.currentSpaceStore;if(!a)throw new Error("No current space store");if(!i)return void xe().PV({message:"No model selected"});if(!r)return void xe().PV({message:"No feedback found"});n.setState({...n.state,inferenceKeysToMemories:{...n.state.inferenceKeysToMemories,[o.key]:{loading:!0,value:{originalOutput:[],feedback:"",inputSummary:"",promptFeedback:"",testInstructions:"",originalOutputPassesTest:!1,originalOutputTestResults:[],correctedOutputs:[],verified:!1}}}});const l=await u().callStreamApi({eventName:"runInferenceTranscript",environment:t,data:{transcript:[{id:(0,ye().ZP)(),type:"config",value:{type:"memory-agent",inference:o.value,feedback:r,model:i}}],traceId:(0,ye().ZP)(),spaceId:a.id,generateTitle:!1},headers:(0,fe().Bb)({spaceId:a.id})});if("failed"===l.type)throw l.error;let s;if(he().H1.is(l.data))for await(const c of l.data)if("memory-agent"===c.type)s=c.value,n.setState({...n.state,inferenceKeysToMemories:{...n.state.inferenceKeysToMemories,[o.key]:{loading:!0,value:c.value}}});else if("error"===c.type)throw xe().PV({message:c.message}),c.message;s&&n.setState({...n.state,inferenceKeysToMemories:{...n.state.inferenceKeysToMemories,[o.key]:{loading:!1,value:s}}})}({environment:s,clientStore:n,inference:t})}),[n,s,t]);return t?(0,P.jsxs)("div",{style:c.wrap,children:[(0,P.jsxs)("div",{style:c.header,children:[(0,P.jsx)(G().Z,{checked:m,size:14,onClick:f}),(0,P.jsx)("span",{style:{flexGrow:1},children:Zn(t.value.input,t.isFinal)}),(0,P.jsx)(y().Z,{onClick:x,children:"Retry"}),(0,P.jsx)(y().Z,{onClick:v,children:"Run memory agent"})]}),(0,P.jsx)(X().Z,{value:d,placeholder:"Write feedback",onChange:p,textarea:!0,autosize:!0}),(0,P.jsx)(ue,{label:"Input",style:c.toggle,children:(0,P.jsx)(ce().c,{language:"json",value:JSON.stringify({...t.value.input,examples:void 0},null,2)})}),t.value.expected&&(0,P.jsx)(ue,{label:"Output",style:c.toggle,children:(0,P.jsx)(ce().c,{value:g,language:"json"})}),h&&(0,P.jsx)(ue,{label:"Memory "+(h.value.verified?"✅":"❌"),style:c.toggle,left:h.loading&&(0,P.jsx)(Le().Z,{}),children:(0,P.jsx)(ce().c,{value:JSON.stringify(h.value,null,2),language:"json"})})]}):null}const Vn=o.memo(_n);function Zn(e,t){let n=e.type;"fileName"in e&&(n+=` – ${e.fileName}`),"testName"in e&&(n+=` – ${e.testName}`),"functionKey"in e&&(n+=` – ${e.functionKey}`),"key"in e&&(n+=` – ${e.key}`);const o=["retries","validationRetries"];for(const r of o)if(r in e&&e[r].length>0){n+=` (${e[r].filter((e=>"assistant"!==e.type)).length} error steps)`}return t&&(n+=" ✅"),n}function On(e){const t=e.model,n=(0,a().yK)((e=>({badge:{fontSize:12,fontWeight:500,padding:"1px 6px",backgroundColor:e.cardHoveredBackground,color:e.lightTextColor,borderRadius:4,...Ye().Yu},checkIcon:{width:14}})),[]);return(0,P.jsx)(m().ZP,{popupType:m().Z4.Popup,placementToOrigin:m().pO.Bottom,alignmentToOrigin:m().vR.Start,renderOrigin:t=>(0,P.jsx)(v().Z,{renderTooltip:()=>(0,P.jsx)("div",{children:"Select a model"}),placement:qe().Placement.Bottom,alignment:qe().Alignment.Center,render:o=>(0,P.jsx)(Fn().Z,{...(0,Nn().Z)(t,o),ignoreLocalHoverState:!0,children:(0,P.jsx)("div",{style:n.badge,children:e.model||"Default model"})})}),render:o=>(0,P.jsx)(g().Z,{menuType:k().o.Popup,children:(0,P.jsx)(h().Z,{type:h().i.Vertical,initialFocus:0,sections:[{key:"models",render:e=>(0,P.jsx)(x().Z,{...e,title:"Models",shouldShowBottomDivider:!0}),items:pe().Kz.map((r=>({key:r,action:()=>{e.setModel(r),o.close()},render:e=>(0,P.jsx)(p().Z,{...e,title:r,right:r===t?(0,B().Z)(n.checkIcon):void 0})})))}]})})})}function Pn(e){const{clientStore:t}=e,n=(0,i().VK)((()=>t.state.tags),[t]),r=(0,o.useCallback)((e=>{const o=n.includes(e)?n.filter((t=>t!==e)):[...n,e];t.setState({...t.state,tags:o})}),[t,n]);return(0,P.jsx)(P.Fragment,{children:E().Bc.map((e=>(0,P.jsxs)(y().Z,{onClick:()=>r(e),style:{display:"flex",alignItems:"center",gap:4},children:[(0,P.jsx)(G().Z,{checked:n.includes(e),size:14,disabled:!0}),(0,P.jsx)("span",{children:e})]},e)))})}function Ln(e){const{threadId:t,config:n,showSidebarButton:l,onThreadChange:u,defaultUserMessage:p,collectionContextStore:m,clientStore:g}=e,{isElectronWindows:h}=(0,r().Fy)(),y=(0,r().O7)(),x=(0,i().VK)((()=>g.state.showDebug),[g]),k=(0,i().VK)((()=>{const{currentSpaceStore:e}=M().default.state;if(e&&t)return A().V3.createChildStore(e,{table:s().kL,id:t,spaceId:e.id})}),[t]),{store:B,setValue:R}=(0,b().Cl)({initialValue:(0,d().TPx)(p)});(0,o.useEffect)((()=>{n&&g.state.config!==n&&g.setState({...g.state,config:n})}),[g,n]);const F=x,N=(0,a().yK)((e=>({pageLayout:{display:"flex",flexDirection:"column",minHeight:"100vh",width:"100%",backgroundColor:e.contentBackground,order:2},header:{flex:"0 0 auto",height:42,display:"flex",alignItems:"center",padding:"0 12px 0 16px",backgroundColor:e.contentBackground},columns:{display:"flex",flexDirection:"row",flex:1,minHeight:0,gap:12,...F&&{paddingLeft:16}},chatColumn:{flex:1,display:"flex",flexDirection:"column",minHeight:0},contentWrapper:{flex:1,overflowY:"auto",position:"relative"},contentContainer:{margin:"0 auto",width:"100%",maxWidth:800,padding:"16px 12px 16px",marginLeft:"auto"},inputWrapper:{flex:"0 0 auto",position:"relative",backgroundColor:e.contentBackground,padding:"0 0 16px"},scrollToBottomButton:{position:"absolute",left:"50%",bottom:"100%",transform:"translate(-50%, -8px)",zIndex:2,padding:10,borderRadius:20,backgroundColor:e.surface.elevated,border:"none",cursor:"pointer",fontWeight:500,boxShadow:`0px 0px 0px 0.5px ${e.stroke.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.02), 0px 4px 16px -2px rgba(0, 0, 0, 0.1)`,transition:"opacity 150ms ease-out, transform 150ms ease-out",opacity:0,pointerEvents:"none"},scrollToBottomButtonVisible:{opacity:1,transform:"translate(-50%, -16px)",pointerEvents:"auto"},scrollToBottomButtonHidden:{opacity:0,transform:"translate(-50%, -8px)",pointerEvents:"none"},inputContainer:{margin:"0 auto",width:"100%",maxWidth:800,padding:"0 12px",marginLeft:"auto"},gradientMask:{width:"100%",height:44,pointerEvents:"none",position:"absolute",bottom:"100%",background:`linear-gradient(to bottom, rgba(255, 255, 255, 0), ${e.contentBackground})`},leftActions:{display:"flex",alignItems:"center",gap:8,marginRight:"auto"},rightActions:{display:"flex",alignItems:"center",gap:8,marginLeft:"auto"},title:{position:"absolute",left:"50%",transform:"translateX(-50%)",fontSize:16,fontWeight:500,textAlign:"center"},floatingColumn:{zIndex:1,marginTop:4,marginBottom:16,backgroundColor:e.contentBackground,overflow:"auto",boxShadow:"0px 18px 32px 0px rgba(0, 0, 0, 0.04), 0px 0px 0px 1px rgba(0, 0, 0, 0.03)",backdropFilter:"blur(10px)",borderRadius:8,padding:8,display:"flex",flexDirection:"column",gap:8},historyColumn:{width:350},debugColumn:{width:"33%"},previewColumn:{width:"33%"},iconButton:{width:32,height:32},iconButtonIcon:{width:18,height:18,fill:e.regularIconColor},chevronDownIcon:{width:12,height:12,fill:e.regularIconColor,transform:"translateY(1px)"}})),[F]),z=(0,o.useRef)(null),[_,V]=(0,o.useState)(!0),Z=(0,o.useCallback)((()=>{const e=z.current;if(!e)return;const t=e.scrollHeight-e.scrollTop-e.clientHeight<50;V(t)}),[]);(0,o.useEffect)((()=>{const e=z.current;if(!e)return;e.addEventListener("scroll",Z);const t=new MutationObserver((()=>{setTimeout(Z,100)}));return t.observe(e,{childList:!0,subtree:!0,characterData:!0}),setTimeout(Z,100),()=>{e.removeEventListener("scroll",Z),t.disconnect()}}),[Z,t]);const O=(0,o.useCallback)((()=>{const e=z.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})}),[]),L=(0,o.useCallback)((e=>{R(void 0);const{currentSpaceStore:t,currentUserStore:o}=M().default.state;if(!t||!e)throw new Error("No current space or value");if(!y.currentUser.id)throw new Error("No current user");const r=(null==k?void 0:k.id)??(0,C().TS)({environment:y,table:s().kL,spaceId:t.id}),i=function(e){var t,n;const{environment:o,config:r,collectionContextStore:i}=e;if("workflow"!==(null==r?void 0:r.type)||!i)return;const a=i.collectionViewBlockStore();if((null==a?void 0:a.id)!==r.workflowBlockId)return;if(null!=a&&null!==(t=a.getFormat())&&void 0!==t&&t.workflow_id)return;const l=(null==i||null===(n=i.collectionViewBlockStore())||void 0===n?void 0:n.getCollectionPointers())??[];if(0===l.length)return;return(0,K().fz)({environment:o,collectionPointers:l})}({environment:y,config:n,collectionContextStore:m});let a=[];i&&(a=[{id:(0,C().TS)({environment:y,table:c().An,spaceId:t.id}),type:"workflow",value:i}]),(0,D().cz)({environment:y,clientStore:g,threadStore:k,threadId:r,additionalSteps:a,config:n||g.state.config,workflowStore:void 0,userStore:o,spaceStore:t,value:e}),null==u||u({id:r})}),[g,y,R,u,n,k,m]),$=(0,o.useCallback)((()=>{g.setState({...g.state,showDebug:!g.state.showDebug})}),[g]),E=(0,o.useCallback)((()=>{(0,D().po)({clientStore:g}),null==u||u({id:void 0})}),[g,u]),W=(0,i().VK)((()=>g.state.model),[g]),H=(0,o.useCallback)((e=>{g.setState({...g.state,model:e})}),[g]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{style:N.header,children:[(0,P.jsxs)("div",{style:N.leftActions,children:[l&&(0,P.jsx)(w().o,{}),(0,P.jsx)($n,{onNewChatClick:E,onThreadChange:u,threadId:t}),h&&(0,P.jsx)(S().m,{})]}),(0,P.jsxs)("div",{style:N.rightActions,children:[(0,P.jsx)(On,{model:W,setModel:H}),(0,P.jsx)(v().Z,{renderTooltip:()=>(0,P.jsx)("span",{children:"Debug"}),render:e=>(0,P.jsx)(f().Z,{...e,icon:j().r,iconStyle:N.iconButtonIcon,style:N.iconButton,ariaLabel:"Debug",onClick:$})}),(0,P.jsx)(v().Z,{renderTooltip:()=>(0,P.jsx)("span",{children:"New chat"}),render:e=>(0,P.jsx)(f().Z,{...e,icon:T().e,iconStyle:N.iconButtonIcon,style:N.iconButton,ariaLabel:"New chat",onClick:E})})]})]}),(0,P.jsxs)("div",{style:N.columns,children:[x&&(0,P.jsx)("div",{style:{...N.floatingColumn,...N.debugColumn},children:(0,P.jsx)(zn,{clientStore:g,threadStore:k})}),(0,P.jsxs)("div",{style:N.chatColumn,children:[(0,P.jsx)("div",{style:N.contentWrapper,ref:z,children:(0,P.jsx)("div",{style:N.contentContainer,children:(0,P.jsx)(hn,{clientStore:g,threadId:t,config:n,threadStore:k})})}),(0,P.jsxs)("div",{style:N.inputWrapper,children:[(0,P.jsx)("button",{onClick:O,style:{...N.scrollToBottomButton,...!_&&N.scrollToBottomButtonVisible},children:(0,I().E)(N.chevronDownIcon)}),(0,P.jsx)("div",{style:N.gradientMask}),(0,P.jsx)("div",{style:N.inputContainer,children:(0,P.jsx)(U,{store:B,onSubmit:L,clientStore:g,threadStore:k})})]})]})]})]})}function $n(e){let{onThreadChange:t,threadId:n,onNewChatClick:o}=e;const c=(0,r().O7)(),d=(0,i().VK)((()=>{const{currentSpaceStore:e}=M().default.state;if(e&&n)return A().V3.createChildStore(e,{table:s().kL,id:n,spaceId:e.id})}),[n]),f=(0,i().VK)((()=>{var e;return null==d||null===(e=d.getData())||void 0===e?void 0:e.title}),[d]),v=(0,i().VK)((()=>{const{currentSpaceStore:e}=M().default.state;if(e)return{spaceId:e.id}}),[]),S=(0,a().yK)((e=>({title:{color:n?e.text.primary:e.text.secondary},checkIcon:{width:14},chevronDownIcon:{width:10,marginLeft:6,fill:e.mediumIconColor},newChatButtonContainer:{padding:8},newChatButton:{width:"100%",textAlign:"center",justifyContent:"center",background:e.assistantTintedActionButtonBackground}})),[n]),[{value:w}]=(0,l().r5)((async()=>{if(!v)return;if(!R().default.state.online)return;const e=await u().callApi({eventName:"getInferenceTranscriptsForUser",environment:c,data:v});return"failed"!==e.type?e.data.transcripts:void 0}),[v,c]);return(0,P.jsx)(m().ZP,{popupType:m().Z4.Popup,placementToOrigin:m().pO.Bottom,alignmentToOrigin:m().vR.Start,renderOrigin:e=>(0,P.jsxs)(y().Z,{disabled:!w||!w.length,ariaLabel:"history",...e,children:[(0,P.jsx)("span",{style:S.title,children:n?f||"Untitled chat":"New chat"}),w&&!!w.length&&(0,P.jsx)(P.Fragment,{children:(0,I().E)(S.chevronDownIcon)})]}),render:e=>(0,P.jsx)(g().Z,{menuType:k().o.Popup,children:(0,P.jsx)(h().Z,{type:h().i.Vertical,initialFocus:0,sections:[{key:"history",render:t=>(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{style:S.newChatButtonContainer,children:(0,P.jsx)(y().Z,{style:S.newChatButton,onClick:()=>{o(),e.close()},children:"New chat"})}),(0,P.jsx)(x().Z,{...t,title:"Previous chats",shouldShowBottomDivider:!0})]}),items:(w||[]).map((o=>({key:o.id,action:()=>{e.close(),null==t||t({id:o.id})},render:e=>(0,P.jsx)(p().Z,{...e,title:o.title||"Untitled chat",right:n===o.id?(0,B().Z)(S.checkIcon):void 0})})))}]})})})}},493843:(e,t,n)=>{n.d(t,{$o:()=>E,Fv:()=>Z,IL:()=>G,J4:()=>P,KA:()=>_,Nf:()=>z,_p:()=>q,cQ:()=>W,f$:()=>O,fX:()=>U,j2:()=>N,k2:()=>J,mg:()=>Y,mz:()=>$,oP:()=>V,tF:()=>X,td:()=>L,x:()=>H});n(670560),n(267602),n(470928),n(30005),n(241792),n(228244);var o=()=>n(730120),r=()=>n(492788),i=()=>n(506347),a=()=>n(926724),l=()=>n(331540),s=()=>n(874459),c=()=>n(998411),d=()=>n(35980),u=()=>n(513670),p=()=>n(696459),m=()=>n(250303),f=()=>n(384667),g=()=>n(366257),h=()=>n(139224),y=()=>n(421654),x=()=>n(636340),v=()=>n(531515),S=()=>n(47443),w=()=>n(794586),b=()=>n(879952),C=()=>n(970105),k=()=>n(990966),j=()=>n(269299),I=()=>n(932753),T=()=>n(887430),B=()=>n(861026),M=()=>n(804217),R=()=>n(826955),A=()=>n(965903),K=()=>n(807230),D=()=>n(701182),F=()=>n(645843);function N(e){const{collectionViewStore:t,collectionContextStore:n,timelineState:o,environment:r}=e,i=r.currentUser.id,a=(0,D().B8)(t.id),l=(0,D().pQ)(t,r),s=n.permissionScopesStore.state,c=u().Ds((()=>{if(o.destroyed)return;const e={zoomLevel:o.zoomLevel.state,centerTimestamp:(0,D().al)(o)};d().Z.set({userId:i,key:a,value:e})}),1e3),p=u().Ds((()=>{if(o.destroyed||!M().default.state.online||!r.currentUser.isLoggedIn()||!s.canConfigureBlock)return;const e={zoomLevel:o.zoomLevel.state,centerTimestamp:(0,D().al)(o)},n=t.getFormat().timeline_preference;u().Xy(n,e)||j().createAndCommit({userAction:"collectionTimelineViewActions.setRemotePreference",environment:r,canUndo:!0,perform:n=>{y().FH({stores:[t],update:{timeline_preference:e},transaction:n})}})}),5e3);o.savePreference=()=>{c(),p()},z({timelineState:o,environment:r,...l})}function z(e){const{timelineState:t,zoomLevel:n,centerTimestamp:o,environment:i}=e,{savePreference:a}=t,l=i.WindowSizeStore.state.width+2*D().Ge,s=(0,D().x2)(n,l),c=o-s/2,d=o+s/2;t.zoomLevel.setState(n),t.currentRange.setState({startTimestamp:c,endTimestamp:d}),r().default.afterNextFlush((()=>{_({timelineState:t,centerTimestamp:o}),a&&a()}))}function _(e){const{timelineState:t,centerTimestamp:n}=e,{horizontalScroller:o,outerSizeObserver:r}=t;if(!o)return;const i=t.zoomLevel.state,{startTimestamp:a,endTimestamp:l}=t.currentRange.state,s=r.rect.state.width;if(s===(0,D().e$)(i,l-a))return;const c=(0,D().e$)(i,n-a)-s/2;o.scrollLeft=c,t.scrollLeft.setState(c)}function V(e){const{environment:t,store:n,query:o,date:r,schema:i,transaction:a}=e,{timeline_by:l}=o;if(!l)return;const s=n.getAssociatedCollectionStore(),c=(null==s?void 0:s.getMappedProperty(l))??l,d=o.timeline_by_end?(null==s?void 0:s.getMappedProperty(o.timeline_by_end))??o.timeline_by_end:void 0,u=(0,D().TW)({store:n,dateValue:r,query:o,schema:(null==s?void 0:s.getSchema())??i}),p=n.getPropertyValue(c),m=d?n.getPropertyValue(d):void 0;return x().sW({store:n.getPropertiesStore(),data:u,transaction:a}),g().H({environment:t,store:n,dateProperty:{id:c,newValue:(null==u?void 0:u[c])??[],oldValue:p},otherDateProperty:d?{id:d,newValue:(null==u?void 0:u[d])??[],oldValue:m}:void 0}),n}function Z(e){var t;const{environment:n,timelineState:r,collectionStore:i,collectionContextStore:a,store:l,query:d,groupFormat:u,transaction:p}=e,m=r.zoomLevel.state,g=(0,D().al)(r),{snapUnit:h,getDateRangePlaceholderDuration:y}=D().BJ[m],{timeline_by:x}=d;if(!x)return;const v=null===(t=a.groupsStore.getGroupState(u))||void 0===t?void 0:t.resultsStore.state;if(!v)return;const S=o().ou.fromMillis(g),w=(0,D().DS)(S,h),b=(0,D().DS)(y(S),h),C=(0,D().AZ)({startValue:(0,s().Lg)((0,c().r)()),snapUnit:h,desiredStart:w,desiredEnd:b});return V({environment:n,store:l,query:d,schema:i.getSchema(),date:C,transaction:p}),f().$T({environment:n,collectionStore:i,before:!0,store:v[0],insertStores:[l],collectionContextStore:a,groupsPointer:u?[u]:[],transaction:p}),l}function O(e){const{type:t,timelineState:n,store:o,startX:r,query:i,schema:a,intl:l,environment:s}=e,{horizontalScroller:c}=n,{startTimestamp:d}=n.currentRange.state;if(!c)return;b().Ys({environment:s,store:o});const p=c.scrollLeft,{stores:m}=A().default.state,f=u().oA(m.map((e=>{const t=(0,D().bk)({store:e,query:i,schema:a,userId:s.currentUser.id,intl:l,formulasModule:void 0});if(t)return{startValue:t,store:e}})));n.dragState.setState({type:t,startStore:o,stores:f.map((e=>{let{store:t}=e;return t})),startValues:f.map((e=>{let{startValue:t}=e;return t})),temporaryValues:f.map((e=>{let{startValue:t}=e;return t})),startX:r,startStartTimestamp:d,startScrollLeft:p})}function P(e){const{timelineState:t,store:n,startX:o,startY:r,schema:i,collectionContextStore:a,verticalScroller:l}=e,{horizontalScroller:s}=t,{startTimestamp:c}=t.currentRange.state;if(!s||!l)return;const d=s.scrollLeft,u=l.scrollTop,p=(0,D().YE)(a,n,i);t.drawState.setState({startStore:n,startDependencyRelationPointers:p,temporaryDependencyRelationPointers:[...p],startX:o,startY:r,startScrollLeft:d,startScrollTop:u,startStartTimestamp:c,xOffsetPx:0,yOffsetPx:0,tryToCompleteDrawnArrow:!1})}function L(e){const{timelineState:t,currentX:n}=e,{horizontalScroller:o}=t,r=t.zoomLevel.state,i=t.dragState.state,{startTimestamp:a}=t.currentRange.state;if(!i||!o)return;const{type:l,startStartTimestamp:c,startValues:d,startScrollLeft:m,startX:f,startStore:g,stores:h}=i,y=D().BJ[r],{snapUnit:x}=y,v=o.scrollLeft-m+(n-f)+(0,D().e$)(r,a-c),S=(0,D().x2)(r,v),w=d[h.indexOf(g)];let b;if(l===D().px.LeftResizer){const{start:e}=(0,D().XO)(w,x),t=e.plus(S);b=d.map((e=>{const n=(0,D().AZ)({startValue:e,snapUnit:x,desiredStart:t});return(0,s().gW)(n)}))}else if(l===D().px.RightResizer){const{end:e}=(0,D().XO)(w,x),t=e.plus(S);b=d.map((e=>{const n=(0,D().AZ)({startValue:e,snapUnit:x,desiredEnd:t});return(0,s().Qq)(n)}))}else l===D().px.ItemDrag?b=d.map((e=>{const{start:t,end:n}=(0,D().XO)(e,x),o=t.plus(S),r=o.plus(n.valueOf()-t.valueOf());return(0,D().AZ)({startValue:e,snapUnit:x,desiredStart:o,desiredEnd:r})})):(0,p().t1)(l);u().Xy(i.temporaryValues,b)||t.dragState.setState({...i,temporaryValues:b})}function $(e){const{timelineState:t,currentX:n,currentY:o,verticalScroller:r}=e,i=t.drawState.state,a=t.zoomLevel.state,{startTimestamp:l}=t.currentRange.state,{horizontalScroller:s}=t;if(!i||!s||!r)return;const{startDependencyRelationPointers:c,startStore:d,startX:p,startY:m,startScrollLeft:f,startScrollTop:g,startStartTimestamp:h}=i,y=s.scrollLeft,x=r.scrollTop,v=y-f+(n-p)+(0,D().e$)(a,l-h),S=x-g+(o-m),w=t.hoveredItem.state;if(w&&w!==d&&!c.some((e=>e.id===w.id))){const e=[...c,{table:"block",id:w.id,spaceId:w.getSpaceId()}];u().Xy(i.temporaryDependencyRelationPointers,e)||t.drawState.setState({...i,temporaryDependencyRelationPointers:e,xOffsetPx:void 0,yOffsetPx:void 0})}else t.drawState.setState({...i,temporaryDependencyRelationPointers:[...c],xOffsetPx:v,yOffsetPx:S})}function U(e){const{environment:t,collectionContextStore:n,timelineState:o,query:r,schema:i,transaction:a}=e,l=o.dragState.state,{timeline_by:s}=r;if(!l||!s)return;const{temporaryValues:c,stores:d}=l;c.forEach(((e,o)=>{const l=d[o];V({environment:t,store:l,query:r,schema:i,transaction:a,date:e}),m().rv({environment:t,collectionContextStore:n,block_id:l.id,property:s,property_type:"date",from:"timeline"})})),o.dragState.setState(void 0)}function E(e){var t;const{timelineState:n,environment:o,transaction:r,collectionContextStore:i,isFullScreen:a,isRootChild:l}=e,s=n.drawState.state,c=n.dateRangePlaceholder.state;if(!s)return;const{startStore:d,startDependencyRelationPointers:u,temporaryDependencyRelationPointers:p}=s;if(!d)return void n.drawState.setState(void 0);let f;if(c.active){const{date:e,store:t,parentStore:a,groupFormat:l,newTimelineItemProps:s,existingTimelineItemProps:u}=c;if(t&&u){const{query:n,schema:i}=u;V({environment:o,store:t,query:n,schema:i,date:e,transaction:r}),f={table:"block",id:t.id,spaceId:d.getSpaceId()}}else if(s){const{query:n,schema:c,isFullScreen:u,canEditTimelineItems:p,subitemPath:m}=s,g=Y({environment:o,date:e,store:t,parentStore:a,query:n,schema:c,isFullScreen:u,groupFormat:l,canEditTimelineItems:p,collectionContextStore:i,subitemPath:m,transaction:r,from:"timeline_complete_draw"});g&&(f={table:"block",id:g.id,spaceId:d.getSpaceId()})}n.dateRangePlaceholder.setState({active:!1})}else f=p.find((e=>!u.includes(e)));const g=(0,D()._e)(i);if(g){const{property:e}=g;f&&(v().hE({environment:o,propertyWithInverse:g,sourceStore:d,destStore:R().G.createChildStore(d,f),position:{type:"after"},transaction:r}),m().rv({environment:o,collectionContextStore:i,block_id:d.id,property:e,property_type:"relation",from:"timeline",isFromBulkActionsToolbar:!1,isUnthrottled:!0})),n.drawState.setState(void 0)}else h().wl({item:{type:"dependencies",from:"view_options"},collectionSettingsStore:i.settingsStore}),n.drawState.setState({...s,tryToCompleteDrawnArrow:!0});const y=null===(t=f)||void 0===t?void 0:t.id;y&&(0,F().LE)(o,{...(0,B().Pn)(i),...(0,F().Ii)({environment:o,collectionContextStore:i,timelineState:n,isFullScreen:a,isRootChild:l}),dependenciesPropertyID:null==g?void 0:g.property,blockedByStoreID:d.id,blockingStoreID:y})}function W(e){const{timelineState:t,environment:n}=e;t.dragState.state&&(t.dragState.setState(void 0),b().ZH({environment:n}))}function H(e){const{timelineState:t,environment:n}=e;t.drawState.state&&(t.drawState.setState(void 0),b().ZH({environment:n}))}function J(e){const{stores:t,collectionViewStore:n,schema:o,transaction:r}=e,i=n.getType(),a=n.getQuery(o),l=[];a&&("calendar"===i?a.calendar_by&&l.push(a.calendar_by):"timeline"===i&&(a.timeline_by&&l.push(a.timeline_by),a.timeline_by_end&&l.push(a.timeline_by_end)));for(const s of t)for(const e of l)C().sO({environment:s.environment,store:s.getPropertyStore(e),value:void 0,transaction:r})}function G(e){const{dependency:t,collectionContextStore:n,environment:o,timelineState:r,isFullScreen:i,isRootChild:a}=e,l=(0,D()._e)(n),s=n.collectionStore();if(!l||!s)return;const{property:c}=l,{store:d,relationPointer:u}=t,p=d.getSchema()[c];p&&"relation"===p.type&&(j().createAndCommit({userAction:"CollectionTimelineDependenciesOverlay.handleRemoveRelation",environment:o,canUndo:!0,perform:e=>{v().Bl({environment:o,propertyWithInverse:l,sourceStore:d,destStore:R().G.createChildStore(d,u),transaction:e}),m().rv({environment:o,block_id:u.id,property:c,property_type:p.type,from:"timeline",collectionContextStore:n,isFromBulkActionsToolbar:!1,isUnthrottled:!0})}}),(0,F().lf)(o,{...(0,B().Pn)(n),...(0,F().Ii)({environment:o,collectionContextStore:n,timelineState:r,isFullScreen:i,isRootChild:a}),dependenciesPropertyID:c,blockedByStoreID:d.id,blockingStoreID:u.id}))}function X(e){const{collectionViewStore:t,newProperty:n,transaction:o}=e;y().FH({stores:[t],update:{timeline_arrows_by:{property:n}},transaction:o})}function q(e){var t;const{collectionContextStore:n,relationPropertyId:o,transaction:r}=e,i=n.collectionStore();if(!i)return;const s=o?i.getSchema()[o]:void 0,c="relation"===(null==s?void 0:s.type)&&s.property&&"relation"===(null===(t=i.getSchema()[s.property])||void 0===t?void 0:t.type)?s.property:void 0;y().FH({stores:[i],update:{collection_default_arrows_by:o,...i.getFormat().app_config_uri===l().iS?{app_uri_map:{...i.getFormat().app_uri_map?i.getFormat().app_uri_map:{},[a().Es.BlockingRelation]:o,[a().Es.BlockedRelation]:c}}:{}},transaction:r})}function Y(e){const{environment:t,transaction:n,date:o,parentStore:r,query:a,schema:l,isFullScreen:s,groupFormat:c,canEditTimelineItems:d,collectionContextStore:u,from:p}=e;if(!(0,K().ww)(t))return;const m=c?[c]:[],g=u.groupsStore.getGroupState(m);if(!g)return;if(r)return function(e){const{environment:t,transaction:n,date:o,store:r,parentStore:a,query:l,schema:s,groupFormat:c,canEditTimelineItems:d,collectionContextStore:u,subitemPath:p}=e;if(!r||!a)return;const m=c?[c]:[],g=f().yk({environment:t,collectionContextStore:u,groupsPointer:m,store:r,before:!1,collectionStore:a,transaction:n,subitemPath:p,subitemInsertDirection:"into"});if(g){if(V({environment:t,store:g,query:l,schema:s,date:o,transaction:n}),t.device.isMobile)S()._c({environment:t,store:g,pageVisitSource:i().tY.Create});else if(g&&d){const e=g.getBlockTitleStore();k().setSelectionAtStart({store:e})}return g}}(e);u.searchQueryStore.state&&I().Ug({searchQuery:"",collectionContextStore:u,isFullScreen:s});const h=f().IW({environment:t,collectionContextStore:u,groupsPointer:m,shouldCoerce:!0,templateStore:u.defaultPageTemplateStore.state,transaction:n,from:{createBlock:p},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache});if(!h)return;const y=h.coercionSucceeded,x=h.newStore;if(V({environment:t,store:x,query:a,schema:l,date:o,transaction:n}),t.device.isMobile)S()._c({environment:t,store:x,pageVisitSource:i().tY.Create});else if(y&&d){const e=x.getBlockTitleStore();k().setSelectionAtEnd({store:e})}else w().CH({environment:t,store:x,peekMode:(0,T().kr)(u),resultsStore:null==g?void 0:g.resultsStore,collectionContextStore:u,pageVisitSource:i().tY.Create});return x}},645843:(e,t,n)=>{n.d(t,{Al:()=>s,CB:()=>c,H6:()=>l,Ii:()=>f,LE:()=>p,gw:()=>d,iR:()=>i,lf:()=>m,ne:()=>u,zI:()=>a});n(267602),n(653476);var o=()=>n(594546),r=()=>n(701182);function i(e,t){o().lu(e,"timeline_view","timeline_view",5,t)}function a(e,t){o().K4(e,"timeline_zoom_level_update",t)}function l(e,t){o().K4(e,"timeline_today_click",t)}function s(e,t){o().K4(e,"timeline_shift_time_click",t)}function c(e,t){o().K4(e,"timeline_toggle_table_click",t)}function d(e,t){o().K4(e,"timeline_item_scroll_arrow_click",t)}function u(e,t){o().K4(e,"timeline_item_resize",t)}function p(e,t){o().K4(e,"timeline_dependency_arrow_add",t)}function m(e,t){o().K4(e,"timeline_dependency_arrow_delete",t)}function f(e){const{environment:t,collectionContextStore:n,timelineState:o,isFullScreen:i,isRootChild:a}=e,l=o.zoomLevel.state,s=n.normalizedFormatStore.state,c=(0,r().C1)({environment:t,format:s,isFullScreen:i,isRootChild:a}),d=c&&s.timeline_table_properties?s.timeline_table_properties.length:0,u=s.timeline_properties||[],p=u.filter((e=>"title"!==e.property));return{zoom_level:l,show_table:c,show_table_properties_count:d,show_timeline_title:u.length!==p.length,show_timeline_properties_count:p.length}}},887330:(e,t,n)=>{n.d(t,{C:()=>r,L:()=>i});var o=()=>n(707513);function r(e){const{theme:t,isInHomeWidget:n}=e;return{display:"flex",alignItems:"center",fontSize:14,padding:6,...n?{height:24,width:24,color:t.lightTextColor,fill:t.lightIconColor}:{height:28,width:28,color:t.mediumIconColor,fill:t.mediumIconColor},fontWeight:o().Ue.regular,lineHeight:1,borderRadius:6}}function i(e){const{theme:t}=e;return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:t.mediumIconColor,fontWeight:o().Ue.regular,lineHeight:1,borderRadius:4}}},681035:(e,t,n)=>{n.d(t,{S:()=>i});var o=()=>n(677559);const r=new(o().Ss)("CollectionItemCover",(async()=>{const{CollectionItemCover:e}=await Promise.all([n.e(62743),n.e(37912)]).then(n.bind(n,682652));return{CollectionItemCover:e}})),i=(0,o().kF)(r,(e=>e.CollectionItemCover))},850790:(e,t,n)=>{n.d(t,{K:()=>r});n(667294);var o=n(785893);const r=(0,n(827282).IU)("boltFilled",{svg:(0,o.jsx)("path",{d:"M0 12.117c0 .38.293.664.703.664h5.518l-2.91 7.91c-.381 1.006.664 1.543 1.318.723l8.877-11.094c.166-.205.254-.4.254-.625 0-.371-.293-.664-.703-.664H7.539l2.91-7.91C10.83.115 9.785-.422 9.131.408L.254 11.492c-.166.215-.254.41-.254.625z"}),viewBox:"0 0 14 22"})},688173:(e,t,n)=>{n.d(t,{r:()=>o().r});var o=()=>n(146007)},286735:(e,t,n)=>{n.d(t,{$:()=>o().$});var o=()=>n(235665)},756085:(e,t,n)=>{n.d(t,{f:()=>r});n(667294);var o=n(785893);const r=(0,n(827282).IU)("chevronLeft",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M3.61816 8.06445C3.61816 8.29688 3.70703 8.49512 3.8916 8.67285L9.22363 13.8887C9.36719 14.0391 9.55859 14.1143 9.77734 14.1143C10.2217 14.1143 10.5703 13.7725 10.5703 13.3213C10.5703 13.1025 10.4814 12.9043 10.3311 12.7539L5.52539 8.06445L10.3311 3.375C10.4814 3.21777 10.5703 3.01953 10.5703 2.80078C10.5703 2.35645 10.2217 2.01465 9.77734 2.01465C9.55859 2.01465 9.36719 2.08984 9.22363 2.24023L3.8916 7.45605C3.70703 7.63379 3.625 7.83203 3.61816 8.06445Z"})})},363253:(e,t,n)=>{n.d(t,{z:()=>r});n(667294);var o=n(785893);const r=(0,n(827282).IU)("code",{viewBox:"0 0 16 16",svg:(0,o.jsx)("g",{children:(0,o.jsx)("path",{d:"M.056 8.122a.72.72 0 01.07-.306.91.91 0 01.204-.285l3.39-3.05a.745.745 0 01.542-.215.675.675 0 01.505.236c.14.158.202.337.188.537a.737.737 0 01-.264.51L1.855 8.122l2.836 2.573a.737.737 0 01.264.51.716.716 0 01-.188.537.694.694 0 01-.505.242.766.766 0 01-.543-.22L.33 8.708a.87.87 0 01-.204-.274.756.756 0 01-.07-.312zm6.43 5.21a.675.675 0 01-.446-.355.782.782 0 01-.027-.58l2.605-8.942c.068-.226.186-.384.354-.473a.714.714 0 01.559-.054.678.678 0 01.446.344.69.69 0 01.048.553l-2.621 8.98a.738.738 0 01-.35.463.711.711 0 01-.569.064zm9.453-5.21a.695.695 0 01-.065.312.869.869 0 01-.204.274l-3.39 3.056a.773.773 0 01-.547.22.677.677 0 01-.5-.242.707.707 0 01-.193-.537.738.738 0 01.263-.51l2.841-2.573-2.84-2.573a.738.738 0 01-.264-.51.7.7 0 01.193-.537.659.659 0 01.5-.236.75.75 0 01.548.214l3.389 3.051a.91.91 0 01.204.285c.047.1.068.202.064.306z"})})})},869851:(e,t,n)=>{n.d(t,{L:()=>r});n(667294);var o=n(785893);const r=(0,n(827282).IU)("connections",{viewBox:"0 0 16 14",svg:(0,o.jsx)("g",{children:(0,o.jsx)("path",{d:"M2.825 5.581A2.32 2.32 0 112.832.939a2.32 2.32 0 01-.007 4.642zm10.343 0A2.32 2.32 0 1113.175.94a2.32 2.32 0 01-.007 4.641zM2.825 4.331c.609 0 1.073-.473 1.073-1.074 0-.602-.464-1.067-1.073-1.067a1.05 1.05 0 00-1.06 1.067c0 .601.465 1.073 1.06 1.073zm10.343 0c.608 0 1.066-.473 1.066-1.074 0-.602-.458-1.067-1.066-1.067-.595 0-1.066.465-1.066 1.067a1.06 1.06 0 001.066 1.073zm-6.89-.466a.595.595 0 110-1.19.595.595 0 010 1.19zm1.722 0a.595.595 0 110-1.19.595.595 0 010 1.19zm1.723 0a.595.595 0 010-1.19.6.6 0 01.594.596.6.6 0 01-.594.594zm1.675 3.131a.594.594 0 01-.595-.588c0-.328.266-.595.595-.595a.592.592 0 010 1.183zm-6.795 0a.594.594 0 01-.595-.588.595.595 0 011.19 0 .594.594 0 01-.595.588zm5.502 1.429a.595.595 0 010-1.19.6.6 0 01.595.595.6.6 0 01-.595.595zm-4.21 0a.595.595 0 010-1.19.6.6 0 01.594.595.6.6 0 01-.594.595zM8 13.196a2.327 2.327 0 01-2.317-2.33 2.32 2.32 0 014.642 0A2.328 2.328 0 018 13.195zm0-1.258c.608 0 1.066-.471 1.066-1.073 0-.595-.458-1.06-1.066-1.06a1.05 1.05 0 00-1.066 1.06A1.06 1.06 0 008 11.938z"})})})},745435:(e,t,n)=>{n.d(t,{t:()=>r});n(667294);var o=n(785893);const r=(0,n(827282).IU)("database",{viewBox:"0 0 20 20",svg:(0,o.jsx)("path",{d:"M16.25 5v1.25c0 1.381-2.797 2.5-6.25 2.5s-6.25-1.119-6.25-2.5V5c0-1.381 2.797-2.5 6.25-2.5s6.25 1.119 6.25 2.5zM10 14.375c-2.784 0-4.744-.569-5.963-1.378-.187.237-.287.49-.287.753V15c0 1.381 2.797 2.5 6.25 2.5s6.25-1.119 6.25-2.5v-1.25c0-.262-.103-.516-.287-.753-1.22.806-3.179 1.378-5.963 1.378zM10 10c-2.784 0-4.744-.569-5.963-1.378-.187.237-.287.49-.287.753v1.25c0 1.381 2.797 2.5 6.25 2.5s6.25-1.119 6.25-2.5v-1.25c0-.262-.103-.516-.287-.753C14.742 9.428 12.784 10 10 10z"})})},109806:(e,t,n)=>{n.d(t,{c:()=>r});n(667294);var o=n(785893);const r=(0,n(827282).IU)("eye",{viewBox:"0 0 32 32",svg:(0,o.jsx)("path",{d:"M16.006 25.812c8.863 0 14.994-7.17 14.994-9.406C31 14.16 24.858 7 16.006 7 7.252 7 1 14.16 1 16.406c0 2.236 6.252 9.406 15.006 9.406zm0-3.242a6.194 6.194 0 01-6.197-6.164c-.012-3.452 2.744-6.164 6.197-6.164 3.419 0 6.185 2.711 6.185 6.164 0 3.364-2.766 6.164-6.185 6.164zm0-3.94c1.228 0 2.246-1.007 2.246-2.224 0-1.228-1.018-2.235-2.246-2.235-1.24 0-2.258 1.007-2.258 2.235 0 1.217 1.018 2.224 2.258 2.224z"})})},877691:(e,t,n)=>{n.d(t,{J:()=>r});n(667294);var o=n(785893);const r=(0,n(827282).IU)("layout",{viewBox:"0 0 14 14",svg:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.39999 2.19999C2.28953 2.19999 2.19999 2.28953 2.19999 2.39998V11.5999C2.19999 11.7103 2.28953 11.7999 2.39999 11.7999H4.99997C5.11042 11.7999 5.19997 11.7103 5.19997 11.5999V2.39998C5.19997 2.28953 5.11042 2.19999 4.99997 2.19999H2.39999ZM1 2.39998C1 1.6268 1.62679 1 2.39999 1H4.99997C5.77316 1 6.39995 1.6268 6.39995 2.39998V11.5999C6.39995 12.3731 5.77316 12.9999 4.99997 12.9999H2.39999C1.62679 12.9999 1 12.3731 1 11.5999V2.39998ZM9 8.80036C8.88954 8.80036 8.8 8.88991 8.8 9.00036V11.6003C8.8 11.7108 8.88954 11.8003 9 11.8003H11.6C11.7105 11.8003 11.8 11.7108 11.8 11.6003V9.00036C11.8 8.88991 11.7105 8.80036 11.6 8.80036H9ZM7.60001 9.00036C7.60001 8.22717 8.2268 7.60037 9 7.60037H11.6C12.3731 7.60037 13 8.22717 13 9.00036V11.6003C13 12.3736 12.3731 13.0003 11.6 13.0003H9C8.2268 13.0003 7.60001 12.3736 7.60001 11.6003V9.00036ZM8.79994 2.39998C8.79994 2.28953 8.88949 2.19999 8.99994 2.19999H11.5999C11.7104 2.19999 11.7999 2.28953 11.7999 2.39998V4.99997C11.7999 5.11043 11.7104 5.19996 11.5999 5.19996H8.99994C8.88949 5.19996 8.79994 5.11043 8.79994 4.99997V2.39998ZM8.99994 1C8.22675 1 7.59995 1.6268 7.59995 2.39998V4.99997C7.59995 5.77316 8.22675 6.39995 8.99994 6.39995H11.5999C12.3731 6.39995 12.9999 5.77316 12.9999 4.99997V2.39998C12.9999 1.6268 12.3731 1 11.5999 1H8.99994Z"})})},848854:(e,t,n)=>{n.d(t,{v:()=>o().v});var o=()=>n(545914)},994875:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});class o extends(()=>n(263184))().default{getInitialState(){return{discussionIdToExpansionStartPointMap:{}}}}const r=new o},877727:(e,t,n)=>{n.d(t,{C3:()=>l,D:()=>s,QZ:()=>a,fo:()=>i});var o=()=>n(146947),r=()=>n(749826);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r().default.checkGate({gateName:"packaging_m2_additional_entrypoints"})&&a(e,t)}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!e.device.isPhone&&l(t)}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r().default.checkGate({gateName:"workflow_templates_prototype",...e})||"control"!==s(e)}function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o().locale.startsWith("en-")||r().default.checkGate({gateName:"packaging_m2_localize_templates"})?r().default.getEligibleGroup({experimentId:"packaging_m2_entry_point",defaultGroup:"control",...e}):"control"}},999582:(e,t,n)=>{n.d(t,{Z:()=>i});class o extends(()=>n(263184))().default{getInitialState(){return{}}}const r=new o;n(947115).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",r);const i=r},832770:(e,t,n)=>{n.d(t,{c:()=>f});n(821057);var o=n(667294),r=()=>n(846550),i=()=>n(308186),a=()=>n(291198),l=()=>n(92175),s=()=>n(315605),c=()=>n(677559),d=()=>n(466970);const u={SimpleMonacoWrapper:new(c().Ss)("SimpleMonacoWrapper",(async()=>{const[e,t,o]=await Promise.all([n.e(39404).then(n.bind(n,180705)).then((e=>e.default)),n.e(43959).then(n.bind(n,263764)).then((e=>e.loader)),n.e(85349).then(n.bind(n,257649))]);return t.config({monaco:e}),o}))};(0,c().kF)(u.SimpleMonacoWrapper,(e=>e.SimpleMonacoWrapper));var p=n(785893);function m(e){const{value:t,onSave:n,disabled:d,language:u="typescript"}=e,[m,f]=o.useState(!1),[g,h]=o.useState(void 0),{value:y}=(0,c().XJ)(s().o),x=(0,r().yK)((e=>({container:{position:"relative"},input:{whiteSpace:"pre-wrap",wordWrap:"break-word",fontFamily:"monospace",background:e.codeBlockBackground,color:e.regularTextColor,margin:0,marginBottom:12,fontSize:12,padding:16,borderRadius:12},controls:{position:"absolute",top:8,right:8,display:"flex",gap:8,zIndex:1},codeDisplay:{whiteSpace:"pre-wrap",wordWrap:"break-word",fontFamily:"monospace",background:e.codeBlockBackground,margin:0,marginBottom:12,fontSize:12,"& code":{fontFamily:"inherit",fontSize:"inherit",padding:0,background:"none"},padding:16,borderRadius:12}})),[]),v=(0,o.useCallback)((e=>{h(e.target.value)}),[]),S=(0,o.useCallback)((()=>{if(void 0!==g)try{null==n||n(g),h(void 0),f(!1)}catch(e){console.error(e),e instanceof Error&&i().PV({message:e.message})}}),[n,g]),w=(0,o.useCallback)((()=>{h(void 0),f(!1)}),[]),b=(0,o.useCallback)((()=>{f(!0),h(t)}),[t]),C=o.useMemo((()=>{if(!y)return t;return y.highlight(t,y.languages[u]||y.languages.javascript,u)}),[y,t,u]);return d?(0,p.jsx)("div",{style:x.codeDisplay,dangerouslySetInnerHTML:{__html:C}}):(0,p.jsxs)("div",{style:x.container,children:[(0,p.jsx)("div",{style:x.controls,children:m?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(l().Z,{onClick:w,children:"Discard"}),(0,p.jsx)(l().Z,{onClick:S,children:"Save"})]}):(0,p.jsx)(l().Z,{onClick:b,children:"Edit"})}),m?(0,p.jsx)(a().Z,{value:void 0!==g?g:t,onChange:v,textarea:!0,style:x.input,autosize:!0,autosizeMinHeight:80}):(0,p.jsx)("div",{style:x.codeDisplay,dangerouslySetInnerHTML:{__html:C}})]})}function f(e){return(0,d().E)("ai_workflows_monaco_code_editor"),(0,p.jsx)(m,{...e})}},152399:(e,t,n)=>{n.d(t,{Dk:()=>f,N6:()=>d,VI:()=>m,_4:()=>u,_T:()=>c});n(821057),n(670560),n(267602),n(653476),n(30005),n(241792);var o=()=>n(335696),r=()=>n(513670),i=()=>n(543172),a=()=>n(826955),l=()=>n(286427);function s(e){var t;return"oauth2"!==(null===(t=n(846940).O[e.type].authentication)||void 0===t?void 0:t.type)||!(!e.state||!("connectionPointer"in e.state))&&Boolean(e.state.connectionPointer)}const c={getName:(e,t)=>g[e.type].getName(t,e),getDescription:(e,t)=>g[e.type].getDescription(t),isValidAndConnected:(e,t,n)=>s(e)&&g[e.type].isValidAndConnected(e,t,n),getMessageIfNotValid:(e,t)=>{var n,o;return null===(n=g[e.type])||void 0===n||null===(o=n.getMessageIfNotValid)||void 0===o?void 0:o.call(n,t)}};function d(e){var t,n,i;const{workflowStore:s,databaseModule:c,store:d}=e,u=null==c||null===(t=c.state)||void 0===t?void 0:t.pointer,m=Object.fromEntries(Object.entries((null==c||null===(n=c.state)||void 0===n?void 0:n.propertyKeyToIdMap)||{}).filter((e=>{let[t]=e;return"content"!==t}))),f=null==c||null===(i=c.state)||void 0===i?void 0:i.schema;if(!u||!f||!m)return null;const g=a().NW.createChildStore(d,u);if(!g)return null;const h=((0,l().x)(s).modules||[]).filter((e=>"database"===e.type)),{schema:y,propertyKeyToIdMap:x}=(0,o().dw)({databaseKey:c.key,schema:g.getSchema(),databaseModules:h}),v=[],S=[],w=[];return Object.entries(y).forEach((e=>{let[t,n]=e;t in f?r().Xy(p(n),p(f[t]))||S.push({name:t,type:n.type}):v.push({name:t,type:n.type})})),Object.keys(f).forEach((e=>{e in y||w.push({name:e,type:f[e].type})})),{propertyMapChanged:!r().Xy(m,x),addedProperties:v,removedProperties:w,changedProperties:S}}function u(e){var t,n,r;const{workflowStore:i,databaseModule:s,store:c}=e,d=null==s||null===(t=s.state)||void 0===t?void 0:t.pointer,u=Object.fromEntries(Object.entries((null==s||null===(n=s.state)||void 0===n?void 0:n.propertyKeyToIdMap)||{}).filter((e=>{let[t]=e;return"content"!==t}))),p=null==s||null===(r=s.state)||void 0===r?void 0:r.schema;if(!d||!p||!u)return null;const m=a().NW.createChildStore(c,d);if(!m)return null;const f=((0,l().x)(i).modules||[]).filter((e=>"database"===e.type)),{schema:g,propertyKeyToIdMap:h}=(0,o().dw)({databaseKey:s.key,schema:m.getSchema(),databaseModules:f});return{notionState:{schema:g,propertyKeyToIdMap:h},moduleState:{schema:p,propertyKeyToIdMap:u}}}function p(e){if(r().PO(e)){const t=Object.fromEntries(Object.entries(e).map((e=>{let[t,n]=e;return[t,p(n)]})).filter((e=>{let[t,n]=e;return void 0!==n})));return r().xb(t)?void 0:t}if(Array.isArray(e)){const t=r().oA(e.map(p));return r().xb(t)?void 0:t}if(null!=e&&("string"!=typeof e||""!==e))return e}function m(e){var t,n,r;const{store:s,databaseModule:c,workflowStore:d}=e,u=null==c||null===(t=c.state)||void 0===t?void 0:t.pointer,m=null==c||null===(n=c.state)||void 0===n?void 0:n.propertyKeyToIdMap;if(!u||!m)return"needs-create";const f=a().NW.createChildStore(s,u);if(!f)return"loading-database";if(!c.state)throw new Error("Database module state not found");const g=(null===(r=(0,l().x)(d).modules)||void 0===r?void 0:r.filter((e=>"database"===e.type)))||[],h={};for(const o of g){const{state:e}=o;if(!e)throw new Error("Database state not found");if(e.pointer&&e.propertyKeyToIdMap){h[o.key]={collectionPointer:e.pointer,propertyKeyToIdMap:e.propertyKeyToIdMap};for(const t of Object.keys(e.schema))h[o.key].propertyKeyToIdMap[t]=e.propertyKeyToIdMap[t]||(0,i().ZP)()}}const y=f.getSchema(),x=(0,o().c1)({notionSchema:y,databaseKey:c.key,databaseKeyMap:h}),{schema:v}=(0,o().yr)({databaseKey:c.key,databaseKeyMap:h,workflowSchema:c.state.schema,notionSchema:y,connectedRelationCollections:x,databaseModules:g});return{workflowSchema:p(v),notionSchema:p(f.getSchema())}}function f(e){const t=m({store:e.store,databaseModule:e.databaseModule,workflowStore:e.workflowStore});if("needs-create"===t||"loading-database"===t)return t;return r().Xy(p(t.workflowSchema),p(t.notionSchema))?"synced":"needs-update"}const g={database:{getDescription:e=>e.formatMessage({defaultMessage:"This connection allows accessing and editing the connected Notion database.",id:"workflow.module.database.description"}),getName:(e,t)=>t.state?(0,r().kC)(t.name):e.formatMessage({defaultMessage:"Database",id:"workflow.module.database.title"}),isValidAndConnected:(e,t,n)=>"synced"===f({store:n,databaseModule:e,workflowStore:t}),getMessageIfNotValid:e=>e.formatMessage({defaultMessage:"The workflow and database are out of sync. Sync them to continue using this workflow.",id:"workflow.module.database.notConnected"})},slack:{getDescription:e=>e.formatMessage({defaultMessage:"This connection allows sending messages and receiving triggers from a connected Slack workspace.",id:"workflow.module.slack.description"}),getName:e=>e.formatMessage({defaultMessage:"Slack",id:"workflow.module.slack.title"}),isValidAndConnected:()=>!0,getMessageIfNotValid:e=>e.formatMessage({defaultMessage:"Slack is not connected. Click the button above to configure it.",id:"workflow.module.slack.notConnected"})},users:{getDescription:e=>e.formatMessage({defaultMessage:"This connection allows getting information about users in your Notion workspace.",id:"workflow.module.users.description"}),getName:e=>e.formatMessage({defaultMessage:"Users",id:"workflow.module.users.title"}),isValidAndConnected:()=>!0},files:{getDescription:e=>e.formatMessage({defaultMessage:"This connection allows working with files in your Workflow.",id:"workflow.module.files.description"}),getName:e=>e.formatMessage({defaultMessage:"Files",id:"workflow.module.files.title"}),isValidAndConnected:()=>!0},ai:{getDescription:e=>e.formatMessage({defaultMessage:"This connection allows the workflow to use AI when performing a run",id:"workflow.module.ai.description"}),getName:e=>e.formatMessage({defaultMessage:"AI",id:"workflow.module.ai.title"}),isValidAndConnected:()=>!0},recurrence:{getDescription:e=>e.formatMessage({defaultMessage:"This connection allows triggering an Automation on a schedule.",id:"workflow.module.recurrence.description"}),getName:e=>e.formatMessage({defaultMessage:"Recurrence",id:"workflow.module.recurrence.title"}),isValidAndConnected:()=>!0},search:{getDescription:e=>e.formatMessage({defaultMessage:"This connection allows the workflow to search for content in your Notion workspace.",id:"workflow.module.search.description"}),getName:e=>e.formatMessage({defaultMessage:"Search",id:"workflow.module.search.title"}),isValidAndConnected:()=>!0},discussions:{getDescription:e=>e.formatMessage({defaultMessage:"This connection allows manipulating the comments on a Notion database",id:"workflow.module.discussions.description"}),getName:e=>e.formatMessage({defaultMessage:"Discussions",id:"workflow.module.discussions.title"}),isValidAndConnected:()=>!0},agent:{getDescription:e=>e.formatMessage({defaultMessage:"This connection adds a chat interface that the workflow can interact with.",id:"workflow.module.agent.description"}),getName:(e,t)=>t.name?(0,r().kC)(t.name):e.formatMessage({defaultMessage:"Agent",id:"workflow.module.agent.title"}),isValidAndConnected:()=>!0},notionmail:{getDescription:e=>e.formatMessage({defaultMessage:"Integration with Notion Mail",id:"workflow.module.notionmail.description"}),getName:e=>e.formatMessage({defaultMessage:"Notion Mail",id:"workflow.module.notionmail.title"}),isValidAndConnected:(e,t,n)=>{var o;return Boolean(null===(o=e.state)||void 0===o?void 0:o.connectionPointer)},getMessageIfNotValid:e=>e.formatMessage({defaultMessage:"Notion Mail is not connected. Click the button above to configure it.",id:"workflow.module.notionmail.notConnected"})},zendesk:{getDescription:e=>e.formatMessage({id:"workflows.modules.zendesk.description",defaultMessage:"Integration with Zendesk Support"}),getName:(e,t)=>e.formatMessage({id:"workflows.modules.zendesk.name",defaultMessage:"Zendesk"}),isValidAndConnected:(e,t,n)=>{var o;return Boolean(null===(o=e.state)||void 0===o?void 0:o.connectionPointer)},getMessageIfNotValid:e=>e.formatMessage({id:"workflows.modules.zendesk.notConnected",defaultMessage:"Please connect to Zendesk"})}}},29488:(e,t,n)=>{function o(e){return`${e.table}:${e.id}`}n.d(t,{O:()=>o})},146007:(e,t,n)=>{n.d(t,{r:()=>r});n(667294);var o=n(785893);const r=(0,n(827282).IU)("bug",{viewBox:"0 0 64 64",svg:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("path",{d:"m32,8c-5.55,0-9,3.83-9,10h18c0-6.17-3.45-10-9-10Z"}),(0,o.jsx)("path",{d:"m48,36h12v-4h-12v-6.01c2.74-.06,4.78-.94,6.76-2.92l4.24-4.24-2.83-2.83-4.24,4.24c-1.3,1.3-2.41,1.76-4.24,1.76h-13.69v32c6.15,0,10.63-3.12,12.7-8.47l1.54,1.54c1.3,1.3,1.76,2.41,1.76,4.24v2.69h4v-2.69c0-2.9-.88-5.02-2.93-7.07l-3.26-3.26c.12-.95.19-1.94.19-2.98v-2Z"}),(0,o.jsx)("path",{d:"m12.07,20.24l-4.24-4.24-2.83,2.83,4.24,4.24c1.98,1.98,4.02,2.85,6.76,2.92v6.01H4v4h12v2c0,1.04.07,2.03.19,2.98l-3.26,3.26c-2.05,2.05-2.93,4.17-2.93,7.07v2.69h4v-2.69c0-1.83.46-2.95,1.76-4.24l1.54-1.54c2.08,5.35,6.55,8.47,12.7,8.47V22h-13.69c-1.83,0-2.95-.46-4.24-1.76Z"})]})})},235665:(e,t,n)=>{n.d(t,{$:()=>r});n(667294);var o=n(785893);const r=(0,n(827282).IU)("checkmark",{viewBox:"0 0 20 20",svg:(0,o.jsx)("path",{d:"M10.0693 18.166C14.7759 18.166 18.6606 14.2812 18.6606 9.58301C18.6606 4.88477 14.7676 1 10.061 1C5.36279 1 1.48633 4.88477 1.48633 9.58301C1.48633 14.2812 5.37109 18.166 10.0693 18.166ZM9.13965 13.6836C8.82422 13.6836 8.56689 13.5508 8.33447 13.2437L6.30078 10.7783C6.15137 10.5874 6.07666 10.3965 6.07666 10.189C6.07666 9.75732 6.41699 9.40869 6.84863 9.40869C7.10596 9.40869 7.30518 9.5 7.521 9.77393L9.11475 11.791L12.5347 6.3125C12.7173 6.02197 12.9497 5.88086 13.2153 5.88086C13.6387 5.88086 14.0205 6.17139 14.0205 6.61133C14.0205 6.80225 13.9209 7.00977 13.8047 7.19238L9.91162 13.2437C9.729 13.5342 9.45508 13.6836 9.13965 13.6836Z"})})}}]);