"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[67092],{592183:(e,t,n)=>{n.r(t),n.d(t,{setToggleState:()=>k,startTranscribingBlockOnPage:()=>A,startTranscription:()=>C,stopTranscription:()=>I,updatePreferredSummarizationFormat:()=>R});n(492176),n(7961);var o=()=>n(156642),i=()=>n(396136),r=()=>n(989478),a=()=>n(342792),s=()=>n(959137),c=()=>n(421654),l=()=>n(332542),d=()=>n(636340),u=()=>n(970105),p=()=>n(269299),m=()=>n(254940),f=()=>n(298721),y=()=>n(964433),h=()=>n(527278),g=()=>n(876822),v=(n(670560),()=>n(852465));function b(e,t){const n=t??[];e.isType("transcription")&&n.push(e);const o=e.getContentStores();for(const i of o)b(i,n);return n}function x(e){const{blockStore:t}=e,n=t.getNavigableBlockStore();if(!n)return[];const o=[],i=(0,v().MI)({blockStore:n,transclusionReferences:"omit",childPages:"omit"});for(const r of i){const e=r.getFormatStore();(null==e?void 0:e.getKeyValue("created_by_transcription_block_id"))===t.id&&o.push(r)}return o}var _=()=>n(648587),S=()=>n(874023);function k(e){const{blockId:t,state:n}=e;_().i.setOpen(t,n)}const w=(0,n(788860).vU)({transcribingTitle:{id:"transcriptionBlock.transcribingTitle",defaultMessage:"Transcribing..."}});function C(e){var t;const{environment:n,blockStore:o}=e;_().i.setCurrentlyListeningBlockId(o.id);const i=o.getContentStores().at(-1)??o;S().DictationManager.startDictation({environment:n,blockStore:i,from:"transcription_block",preCreateDictationBlock:!0});const a=null===(t=g().default.state.currentUserStore)||void 0===t?void 0:t.id;if(!a)return;const s=o.getBlockTitleStore();p().createAndCommit({userAction:"transcriptionBlockActions.initializeTitle",environment:n,perform:e=>{const t=[[h().Z.formatMessage(w.transcribingTitle)]];u().sO({environment:n,store:s,value:t,transaction:e}),c().FH({stores:[o],update:{transcription_state:{state:"transcribing",transcriber_id:a,transcriber_table:r().KJ}},transaction:e})}})}async function I(e){const{environment:t,blockStore:n,disableSummarization:o}=e;_().i.setCurrentlyListeningBlockId(void 0),p().createAndCommit({userAction:"transcriptionBlockActions.stopTranscription",environment:t,perform:e=>{c().FH({stores:[n],update:{transcription_state:{state:"idle"}},transaction:e})}}),S().DictationManager.stopDictation({environment:t,from:"transcription_block"}),o||await T({environment:t,blockStore:n})}async function T(e){const{environment:t,blockStore:n}=e;if(!g().default.state.mainEditorCurrentBlockStore)return;const r=n.pointer.spaceId;if(!r)return;const u=n.getParentStore();if((null==u?void 0:u.table)!==i().iU)return;M({environment:t,blockStore:n});const h={...n.pointer,spaceId:r},v=await y().p.load(),b=await s().F.clipboardActions.load();await(0,f()._O)({environment:t,onResponse:e=>{if("summarize-transcript-response"!==e.type)return;M({environment:t,blockStore:n});const o=e.response;p().createAndCommit({userAction:"transcriptionBlockActions.summarizeTranscript",environment:t,perform:e=>{const i=b.markdownToBlocks({environment:t,text:o,inMemoryRecordCache:n.inMemoryRecordCache,transaction:e,markdownOptions:{},markdownLinkifyIt:v,tinyMceMicrosoftWordPasteFilter:void 0});if(i){(0,m().postProcessAICreatedStores)(t,i),c().FH({stores:i,update:{created_by_transcription_block_id:n.id},transaction:e});for(const t of i)l().SH({childStore:t,parentStore:u,transaction:e,before:n.id})}}})},data:{transcript:[{id:(0,a().ZP)(),type:"config",value:{type:"summarize-transcript",transcriptPointer:h}},{id:(0,a().ZP)(),type:"summarize-transcript"}],traceId:(0,a().ZP)(),spaceId:r,generateTitle:!1},upsellFrom:"transcription_block"}),p().createAndCommit({userAction:"transcriptionBlockActions.createDivider",environment:t,perform:e=>{const i=d().j4({environment:t,type:o().Ti.divider,format:{created_by_transcription_block_id:n.id},inMemoryRecordCache:u.inMemoryRecordCache,transaction:e});l().SH({childStore:i,parentStore:u,transaction:e,before:n.id})}}),_().i.setSettingsOpenForBlockId(n.id)}function M(e){const{environment:t,blockStore:n}=e,o=x({blockStore:n});o.length>0&&p().createAndCommit({userAction:"transcriptionBlockActions.deletePreviousSummarizationBlocks",environment:t,perform:e=>{for(const t of o){const n=t.getParentStore();(null==n?void 0:n.table)===i().iU&&l().hr({childStore:t,parentStore:n,transaction:e})}}})}function A(e){const{environment:t}=e,n=g().default.state.mainEditorCurrentBlockStore;if(!n)return;const o=b(n);o.sort(((e,t)=>t.getCreatedTime()-e.getCreatedTime()));const i=o[0];i&&C({environment:t,blockStore:i})}async function R(e){var t;const{environment:n,blockStore:o,format:i}=e;if((null===(t=o.getFormat())||void 0===t?void 0:t.transcription_summarization_format_type)===i)return;p().createAndCommit({userAction:"transcriptionBlockActions.updatePreferredSummarizationFormat",environment:n,perform:e=>{c().FH({stores:[o],update:{transcription_summarization_format_type:i},transaction:e})}});x({blockStore:o}).length>0&&await T({environment:n,blockStore:o})}},492961:(e,t,n)=>{n.d(t,{h:()=>h});n(670560),n(409045),n(453627),n(994774),n(995194),n(520522),n(200082),n(379976),n(724224),n(761121),n(637133),n(267602),n(241792),n(731107);var o=n(667294),i=()=>n(142735),r=()=>n(846550),a=()=>n(283444),s=()=>n(201741),c=()=>n(360666),l=n(785893);const d=50,u=7e3,p=(d+u)/2,m=(d+p)/2,f=(p+u)/2,y=8;function h(){const e=(0,i().VK)((()=>s().default.state.audioRecorder),[]),t=(0,i().Kw)(c().Z),[n,p]=(0,o.useState)(new Array(y).fill(1));(0,o.useEffect)((()=>{if(e&&t){const n=new AbortController,o=n.signal,i=()=>{const{mediaStream:n}=e;if(n){const e=t.createAnalyser();e.fftSize=2048;const i=(()=>{const o=t.createMediaStreamSource(n),i=t.createBiquadFilter();i.type="highpass",i.frequency.setValueAtTime(m,t.currentTime);const r=t.createBiquadFilter();return r.type="lowpass",r.frequency.setValueAtTime(f,t.currentTime),[o,i,r,e]})();for(let t=0;t<i.length-1;t++)i[t].connect(i[t+1]);const r=()=>{for(const e of i)e.disconnect()};t.resume();const a=new Uint8Array(e.frequencyBinCount),s=()=>{if(o.aborted)return void r();e.getByteFrequencyData(a);const n=t.sampleRate/2/e.frequencyBinCount,i=Math.round(d/n),c=Math.round(u/n),l=a.slice(i,c+1),m=Math.floor(l.length/y),f=[];for(let e=0;e<y;e++){const t=l.slice(e*m,e<y-1?(e+1)*m:l.length+1),n=t.reduce(((e,t)=>e+t),0)/t.length,o=Math.max(1,Math.min(12,n/3));f.push(o)}p(f),requestAnimationFrame(s)},c=requestAnimationFrame(s);return()=>{cancelAnimationFrame(c),r()}}};let r=i();const s=()=>{"function"==typeof r&&r(),r=i()};return e.emitter.on(a().oF,s),()=>{e.emitter.off(a().oF,s),"function"==typeof r&&r(),n.abort()}}}),[e,n.length,t]);const h=(0,r().yK)((e=>({barStyle:{flexShrink:0,bottom:"0",width:"1.5px",backgroundColor:e.icon.primary,borderRadius:"1px"}})),[]);return e?(0,l.jsx)("div",{style:{height:"20px",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",gap:1.3},children:n.map(((e,t)=>(0,l.jsx)("div",{style:{...h.barStyle,height:`${e}px`}},t)))}):(0,l.jsx)("div",{style:{fontSize:"8px"},children:"No audio"})}},124333:(e,t,n)=>{n.d(t,{l:()=>I,$:()=>C});n(241792);var o=n(667294),i=()=>n(219727),r=()=>n(142735),a=()=>n(846550),s=()=>n(707513),c=()=>n(827973),l=()=>n(448419),d=()=>n(255577),u=()=>n(92175),p=()=>n(388284),m=()=>n(442531),f=()=>n(677559),y=()=>n(696347),h=()=>n(653457),g=()=>n(733641),v=()=>n(385485),b=()=>n(452701),x=()=>n(354986),_=()=>n(761588),S=()=>n(247724),k=n(785893);function w(e){const t=(0,i().O7)(),{parent:n}=e,o=(0,r().VK)((()=>Object.keys(_().jH).indexOf((0,x()._A)(t.currentUser.id))),[t.currentUser.id]),a=[{key:"languages",render:e=>(0,k.jsx)(p().Z,{...e,topBorder:0!==e.index}),items:(0,x().TG)().map((e=>{let[o,[i]]=e;const r={key:o,render:e=>(0,k.jsx)(c().Z,{...e,title:i}),action:()=>{(0,x().Yg)(t,o),n.close()}};return r}))}];return(0,k.jsx)("div",{className:S().tXr,style:{display:"flex",flexDirection:"column",width:150},children:(0,k.jsx)(d().Z,{type:d().i.Vertical,initialFocus:o,sections:a})})}function C(e){const{languagePopupStore:t}=e,n=(0,i().O7)(),c=(0,r().VK)((()=>(0,x()._A)(n.currentUser.id)),[n.currentUser.id]);(0,o.useEffect)((()=>{v().ZP.updateMediaDevices()}),[]);const d=(0,a().yK)((e=>({container:{padding:"8px 0px",display:"flex",flexDirection:"column",alignItems:"flex-start",width:300,gap:8},microphoneText:{marginLeft:12,fontSize:12,fontWeight:s().Ue.medium,color:e.text.secondary},microphoneSection:{display:"flex",flexDirection:"column",width:"100%"},languageText:{fontSize:14,color:e.text.primary},languageSection:{padding:"0px 14px",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},rightChevronStyle:{width:13,height:13,opacity:.5,color:e.icon.secondary},line:{width:"100%",height:1,backgroundColor:e.icon.tertiary,opacity:.3},languageButtonStyle:{fontSize:14,display:"flex",alignItems:"center",gap:10,color:e.text.secondary},helpSection:{padding:"5px 14px",display:"flex",alignItems:"center",justifyContent:"flex-start",gap:4,cursor:"pointer"},helpText:{fontSize:12,color:e.text.tertiary},helpIcon:{width:16,height:16,color:e.icon.tertiary}})),[]),p=(0,o.useMemo)((()=>(0,y().o)(d.rightChevronStyle)),[d.rightChevronStyle]),g=(0,o.useMemo)((()=>(0,h().m)(d.helpIcon)),[d.helpIcon]),{value:b}=(0,f().XJ)(m().io);if(!b)return null;const{motion:_}=b;return(0,k.jsxs)("div",{style:d.container,children:[(0,k.jsxs)("div",{style:d.microphoneSection,children:[(0,k.jsx)("div",{style:d.microphoneText,children:"Microphone"}),(0,k.jsx)(I,{})]}),(0,k.jsx)("div",{style:d.line}),(0,k.jsxs)("div",{style:d.languageSection,children:[(0,k.jsx)("div",{style:d.languageText,children:"Language"}),(0,k.jsx)(l().ZP,{buttonPopupStore:t,renderOrigin:e=>(0,k.jsxs)(u().Z,{style:d.languageButtonStyle,...e,children:[c," ",p]}),stopClickPropagation:!0,popupType:l().Z4.Popup,render:e=>(0,k.jsx)(w,{parent:e})})]}),(0,k.jsx)("div",{style:d.line}),(0,k.jsxs)(_.div,{style:d.helpSection,onClick:()=>window.open("https://www.notion.so/help/audio-dictation","_blank"),variants:{hover:{opacity:.6},tap:{opacity:1}},whileHover:"hover",whileTap:"tap",transition:{duration:.2},children:[g,(0,k.jsx)("div",{style:d.helpText,children:"Learn about Dictation"})]})]})}function I(){const e=(0,r().Kw)(v().UR),t=(0,r().Kw)(v().TZ),n=(0,r().VK)((()=>e.findIndex((e=>e.deviceId===(null==t?void 0:t.deviceId)))),[e,t]),o=[{key:"devices",render:e=>(0,k.jsx)(p().Z,{...e,topBorder:0!==e.index}),items:e.map((e=>({key:e.deviceId,render:n=>(0,k.jsx)(c().Z,{...n,title:e.label,right:e.deviceId===(null==t?void 0:t.deviceId)?(0,g().k)({width:14,height:14}):void 0}),action:()=>{b().Z.setState(e)}})))}];return(0,k.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:(0,k.jsx)(d().Z,{type:d().i.Vertical,initialFocus:n,sections:o})})}},454573:(e,t,n)=>{n.r(t),n.d(t,{DictationAvatar:()=>S,DictationBubble:()=>B,StopDictationButton:()=>H,StopDictationButtonMobile:()=>ae,StopDictationListener:()=>le,dictationActions:()=>o(),hooks:()=>r(),transcriptionBlockActions:()=>i()});var o=()=>n(874023),i=()=>n(592183),r=()=>n(693026),a=n(667294),s=()=>n(219727),c=()=>n(142735),l=()=>n(846550),d=()=>n(442531),u=()=>n(677559),p=()=>n(524434),m=()=>n(201741),f=()=>n(788860),y=()=>n(844085),h=()=>n(576917),g=()=>n(154186),v=()=>n(654133),b=()=>n(259878),x=()=>n(233227),_=n(785893);function S(e){let{enableClickToScroll:t=!1,rootStore:n,noMarginRight:o=!1,noOutline:i=!1,noTooltip:s=!1}=e;const d=(0,c().Kw)(p().r4),u=(0,r().useIsDictatingToPage)(n),S=(0,a.useCallback)((e=>d?e.UIUserAvatarSelfBorder:e.accentColors.gray[800]),[d]),k=(0,b().dY)(S,!0),w=(0,l().yK)((e=>({tooltip:{color:e.mediumInvertedTextColor,minWidth:150,paddingTop:2,paddingBottom:2,lineHeight:1.3},microphoneIcon:{width:.55*b().IX,height:.55*b().IX,pointerEvents:"none",color:e.white},avatarContainer:{width:b().IX,height:b().IX,borderRadius:b().IX,backgroundColor:d?e.assistantCornerButtonBackground:e.accentColors.gray[800],display:"grid",placeItems:"center"}})),[d]),C=(0,a.useMemo)((()=>(0,x().q)(w.microphoneIcon)),[w.microphoneIcon]),I=(0,c().VK)((()=>m().CX.state),[]);return!u&&n?null:(0,_.jsx)(v().Z,{textWrap:!0,disableTooltip:s,renderTooltip:()=>(0,_.jsxs)("div",{children:[(0,_.jsx)("div",{children:(0,_.jsx)(f()._H,{defaultMessage:"Transcribing your words",id:"topbar.presenceIndicator.dictation.tooltip.description"})}),(0,_.jsx)("div",{style:w.tooltip,children:(0,_.jsx)(f()._H,{defaultMessage:"Click to see where",id:"topbar.presenceIndicator.dictation.tooltip.action"})})]}),render:e=>{const n=(0,_.jsx)("div",{style:{...k.avatarOuterOutline,...i?{outline:"none"}:{},...o?{marginRight:0}:{}},children:(0,_.jsx)("div",{style:{...k.avatarBorder,...w.avatarContainer},children:d?(0,_.jsx)(h().P,{variant:"avatar",wrapWithPadding:!1,shadowVariant:"none"}):C})});return t&&I?(0,_.jsx)(g().Z,{...e,onClick:()=>y().hl([I],!0),style:k.button,hoveredStyle:k.buttonHovered,pressedStyle:k.buttonPressed,children:n}):(0,_.jsx)("div",{...e,style:{cursor:"default"},children:n})}})}n(670560),n(267602),n(30005);var k=()=>n(492522),w=()=>n(696459),C=()=>n(30840),I=()=>n(333264);function T(e){let t=[];return e.nodeType===Node.TEXT_NODE?t.push(e):e.childNodes.forEach((e=>{t=t.concat(T(e))})),t}const M=25;function A(e){let{scrollerStore:t,children:n,framerMotion:o}=e;const i=(0,c().Kw)(m().CX),r=(0,c().VK)((()=>t.state.elementRef??{current:null}),[t]),s=(0,I().j)(r),[l,d]=(0,a.useState)(),[u,p]=(0,a.useState)(),f=(0,C().Si)(t),y=(0,C().nA)(t),h=null==f?void 0:f.getNode(),g=null==h?void 0:h.querySelector(".notion-page-content"),v=null==g?void 0:g.querySelector(`[data-block-id="${i}"]`);(0,a.useEffect)((()=>{m().default.setState({...m().default.state,dictationBubbleScrollPosition:null==u?void 0:u.top})}),[u]),(0,a.useEffect)((()=>{if(g){let e;const t=new MutationObserver((t=>{(0,w().$K)(e)&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>d(Date.now())))}));return t.observe(g,{subtree:!0,characterData:!0,childList:!0}),()=>{t.disconnect(),(0,w().$K)(e)&&cancelAnimationFrame(e)}}}),[g]),(0,a.useEffect)((()=>{if(h){let e;const t=new ResizeObserver((()=>{(0,w().$K)(e)&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>d(Date.now())))}));return t.observe(h),()=>{t.disconnect(),(0,w().$K)(e)&&cancelAnimationFrame(e)}}}),[h]),(0,a.useLayoutEffect)((()=>{if(!v||!h){const e=setTimeout((()=>{p(void 0)}),200);return()=>{clearTimeout(e)}}{const e=document.createRange(),t=v.querySelector('[data-content-editable-leaf="true"]')??v,n=T(t),o=h.getBoundingClientRect();if(n.length>0){const t=n[n.length-1];e.selectNodeContents(t),e.collapse(!1);const i=e.getBoundingClientRect(),r=i.top+s-o.top+(i.height-M)/2,a=i.right-o.left+5;p({top:r,left:a})}else{const e=t.getBoundingClientRect(),n=window.getComputedStyle(t),i=parseInt(n.lineHeight,10),r=parseInt(n.paddingTop,10),a=isNaN(i)?e.height:i,c=isNaN(r)?0:r,l=e.top+c+s-o.top+(a-M)/2,d=e.left-o.left;p({top:l,left:d})}}}),[v,h,l,s]);const b=(0,w().$K)(u);(0,a.useEffect)((()=>{if(y&&b)switch(y){case"Page":return m().default.setState({...m().default.state,blockRenderedInPage:!0}),()=>{m().default.setState({...m().default.state,blockRenderedInPage:!1})};case"PeekView":return m().default.setState({...m().default.state,blockRenderedInPeekView:!0}),()=>{m().default.setState({...m().default.state,blockRenderedInPeekView:!1})}}}),[y,b]);const x=(0,a.useRef)(null);(0,a.useEffect)((()=>{if(!u||!x.current)return;const e=new IntersectionObserver((e=>{const[t]=e;let n;n=t.isIntersecting?"inScreen":t.boundingClientRect.top<0?"above":"below",m().default.setState({...m().default.state,dictationBubbleRelativeToScreen:n})}),{root:h,rootMargin:"0px",threshold:[0,1]});x.current&&e.observe(x.current);const t=x.current;return()=>{t&&e.unobserve(t)}}),[h,u]);const{motion:S}=o;return u?(0,_.jsx)(S.div,{ref:x,initial:{transform:`translate(${u.left}px, ${u.top}px)`},animate:{transform:`translate(${u.left}px, ${u.top}px)`},transition:{duration:.2},style:{display:"block",position:"absolute",top:0,left:3,width:0,height:0,zIndex:k().lB-1},children:n}):null}function R(e){const{value:t}=(0,u().XJ)(d().io);return t?(0,_.jsx)(A,{...e,framerMotion:t}):null}n(241792);function j(e){const{framerMotion:t}=e,{motion:n}=t,o=(0,d()._7)(t);(0,a.useEffect)((()=>{(async()=>{await o.start((e=>({y:[0,-7,0],transition:{duration:.6,delay:.15*e,repeat:1/0,repeatDelay:1,ease:"easeInOut"}})))})()}),[o]);const i=(0,l().yK)((e=>({dotStyle:{width:6,height:6,flexShrink:0,backgroundColor:e.icon.quaternary,borderRadius:"50%"}})),[]);return(0,_.jsx)(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},style:{display:"flex",justifyContent:"center",alignItems:"center",gap:3},children:[...Array(3)].map(((e,t)=>(0,_.jsx)(n.div,{custom:t,animate:o,style:i.dotStyle},t)))})}function F(){const{value:e}=(0,u().XJ)(d().io);return e?(0,_.jsx)(j,{framerMotion:e}):null}function B(e){let{scrollerStore:t}=e;const{isMobile:n}=(0,s().Fy)(),o=(0,c().Kw)(m().TI),i=(0,c().Kw)(m().dg),{value:r}=(0,u().XJ)(d().io);if(!r)return null;const{AnimatePresence:a,motion:l}=r;return o?(0,_.jsx)(R,{scrollerStore:t,children:(0,_.jsxs)(l.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[!n&&(0,_.jsx)("div",{style:{position:"absolute",top:0,transform:"translateX(-50%)"},children:(0,_.jsx)(E,{size:23})}),(0,_.jsx)("div",{style:{position:"absolute",top:0,transform:n?"translate(-50%, -85%)":"translate(-50%, -40%)",zIndex:5},children:(0,_.jsx)(S,{noMarginRight:!0,noOutline:!0,noTooltip:!0})}),(0,_.jsx)(a,{children:i&&(0,_.jsx)("div",{style:{transform:"translate(25px, 8px)"},children:(0,_.jsx)(F,{})})})]})}):null}function E(e){let{size:t}=e;const n=(0,c().Kw)(p().r4),o=(0,l().yK)((e=>({verticalLine:{height:t,zIndex:1,width:2,borderRadius:15,backgroundColor:n?e.UIUserAvatarSelfBorder:e.accentColors.gray[800]}})),[t,n]);return(0,_.jsx)("div",{style:o.verticalLine})}var D=n(973935),P=()=>n(745740),K=()=>n(448419),O=()=>n(45909),z=()=>n(154057),q=()=>n(151684),N=()=>n(529048),L=()=>n(725751),V=()=>n(482162),U=()=>n(492961),Z=()=>n(124333);const Y=document.body;function $(e){let{rootStore:t,framerMotion:n}=e;const i=(0,s().MO)(),d=(0,r().useIsDictatingToPage)(t),u=(0,s().O7)(),p=(0,c().VK)((()=>m().default.state.audioRecorder),[]),f=(0,c().qz)(void 0,N().Z),y=(0,c().qz)(void 0,N().Z),h=(0,c().VK)((()=>Boolean(L().default.state.isShowingTabBar)),[]),g=(0,a.useCallback)((()=>{(0,o().stopDictation)({environment:u,from:"button"})}),[u]),v=(0,a.useCallback)((e=>{null==e||e.stopPropagation(),e&&(0,z().uG)(e)||(y.state.open?y.reset():f.state.open?f.reset():f.setState({...f.state,open:!0}))}),[f,y]),x=(0,c().VK)((()=>"dark"===u.ThemeStore.state.mode),[u]),[S,w]=(0,a.useState)(!1),C=(0,a.useCallback)((()=>{w(!0)}),[]),I=(0,a.useCallback)((()=>{w(!1)}),[]),[T,M]=(0,a.useState)(!1),A=(0,a.useCallback)((()=>{M(!0)}),[]),R=(0,a.useCallback)((()=>{M(!1)}),[]),j=(0,l().yK)((e=>({dictationButtonStyle:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:25,gap:2,height:24,cursor:"pointer",padding:"6px 2px 6px 2px",backgroundColor:x?"#2D2D2D":"#F1F0EF",...(0,O().X)({noDrag:u.device.isElectron&&!h})},downChevronContainer:{display:"flex",alignItems:"center",justifyContent:"center",height:20,width:20,borderRadius:20},downIcon:{fill:T?e.icon.secondary:e.icon.tertiary,width:10,height:10},redSquare:{width:10,height:10,borderRadius:2,backgroundColor:S?x?e.accentColors.red[500]:"rgba(191, 67, 64, 1)":x?e.accentColors.red[700]:e.accentColors.red[500]},redSquareContainer:{width:20,height:20,borderRadius:20,display:"flex",alignItems:"center",justifyContent:"center"}})),[x,u.device.isElectron,h,T,S]),F=(0,a.useMemo)((()=>(0,q().E)(j.downIcon)),[j.downIcon]),B=(0,c().VK)((()=>{var e;return V().default.isCenterPeekOpen()&&(null===(e=V().default.peekTargetStore.state)||void 0===e?void 0:e.id)!==(null==t?void 0:t.id)}),[null==t?void 0:t.id]),E=(0,a.useRef)(null),[$,H]=(0,a.useState)(null);(0,a.useEffect)((()=>{if(!E.current)return void H(null);const e=E.current.getBoundingClientRect();H({top:e.top+window.scrollY,left:e.left+window.scrollX})}),[B]);const X=(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(P().Z,{style:j.redSquareContainer,onClick:g,onMouseEnter:C,onMouseLeave:I,children:(0,_.jsx)("div",{style:j.redSquare})}),(0,_.jsx)(U().h,{}),(0,_.jsx)(P().Z,{className:"notion-dictation-button-up-chevron",style:j.downChevronContainer,onClick:v,onMouseEnter:A,onMouseLeave:R,children:F})]}),W=(0,b().qh)({environment:u,isShowingTabBar:h,isShowingInPostFeed:!1}),{motion:J}=n;return d&&p&&!i?(0,_.jsx)("div",{style:{marginLeft:W.marginLeft,marginTop:W.marginTop,marginRight:.5*Number(W.marginLeft)*-1},children:(0,_.jsx)(K().ZP,{buttonPopupStore:f,renderOrigin:()=>(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(J.div,{ref:E,className:"notion-dictation-button",style:j.dictationButtonStyle,onClick:g,initial:{opacity:0,x:15},animate:{opacity:1,x:0},transition:{duration:.4},children:X}),B&&(0,D.createPortal)((0,_.jsx)("div",{className:"notion-dictation-button-duplicate",style:{...j.dictationButtonStyle,position:"fixed",top:(null==$?void 0:$.top)||0,left:(null==$?void 0:$.left)||0,zIndex:k().Wd+1},onClick:g,children:X}),Y)]}),stopClickPropagation:!0,popupType:u.device.isMobile?K().Z4.SlideUp:K().Z4.Popup,popupWrapStyle:{top:6},render:()=>(0,_.jsx)(Z().$,{languagePopupStore:y})})}):null}function H(e){const{value:t}=(0,u().XJ)(d().io);return t?(0,_.jsx)($,{...e,framerMotion:t}):null}n(409045),n(453627),n(994774),n(995194),n(520522),n(200082),n(379976),n(724224),n(761121),n(637133);var X=()=>n(236029);const W=(0,n(827282).IU)("stopDictation",{viewBox:"0 0 36 36",svg:(0,_.jsxs)("svg",{width:"36",height:"36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,_.jsx)("rect",{width:"36",height:"36",rx:"18",fill:"#D34F43",fillOpacity:".1"}),(0,_.jsx)("path",{d:"M12.2 21.7v-8.3c0-.5.2-.9.5-1.2.3-.3.7-.4 1.2-.4h8.2c.5 0 .9.1 1.2.4.3.3.5.7.5 1.2v8.3c0 .5-.2.9-.5 1.2-.3.3-.7.4-1.2.4h-8.2c-.5 0-1-.1-1.2-.4-.3-.3-.5-.7-.5-1.2Z",fill:"#D44C47"})]})});var J=()=>n(76225),G=()=>n(707138),Q=()=>n(749826),ee=()=>n(369320),te=()=>n(105381),ne=()=>n(283444),oe=()=>n(317924),ie=()=>n(553848);var re=()=>n(360666);function ae(){const e=(0,s().O7)(),{isMobileNative:t,isPhone:n}=(0,s().Fy)(),i=(0,c().VK)((()=>{const e=G().default.state.isOnboarding,t=te().Z.state.open,n=ee().Z.hasOpenPopups();return e||t||n}),[]),r=(0,c().VK)((()=>!i&&m().default.getState().enabled&&!m().default.getState().loading),[i]),l=(0,a.useCallback)((()=>{(0,o().stopDictation)({environment:e,from:"mobile_bar_button"})}),[e]);return(0,a.useEffect)((()=>{i&&l()}),[i,l]),function(e){const t=(0,c().Kw)(ie().Z);(0,a.useEffect)((()=>{t&&(e(),ie().Z.reset())}),[t,e])}(l),function(e){const t=(0,s().O7)(),n=(0,c().VK)((()=>{const e=m().P7.state;if(e)return!e.isDictatableBlock()||e.pathIsDead()}),[]),o=(0,c().VK)((()=>!m().w7.state),[]),i=(0,a.useRef)(!0),r=(0,c().VK)((()=>(0,oe().w_)(t.TabbedRouterStore.state)),[t]);(0,a.useEffect)((()=>{(0,w().$K)(n)&&n&&e()}),[n,e]),(0,a.useEffect)((()=>{if(o){const t=setTimeout((()=>{e()}),250);return()=>{clearTimeout(t)}}}),[o,e]),(0,a.useEffect)((()=>{t.device.isMobileNative&&r&&(i.current?i.current=!1:e())}),[t,r,i,e])}(l),r&&t&&n?(0,_.jsx)(se,{handleClick:l}):null}function se(e){const{handleClick:t}=e,n=(0,s().O7)(),o=(0,X().Z)(!0);!function(){const{mobileNative:e}=(0,s().O7)();(0,a.useEffect)((()=>(null==e||e.requestKeepScreenOn(!0),()=>{null==e||e.requestKeepScreenOn(!1)})),[e])}();const i=(0,J().Ij)(),[r,d]=(0,c().VK)((()=>[n.WindowSizeStore.getSafePaddingLeftPx(16),n.WindowSizeStore.getSafePaddingRightPx(16)]),[n.WindowSizeStore]),u=(0,l().yK)((e=>({container:{position:"absolute",width:"100%",bottom:i,minHeight:50,paddingTop:"6px",paddingBottom:"6px",paddingRight:d,paddingLeft:r,border:`1px solid ${e.stroke.secondary}`,background:e.contentBackground},dictationButtonStyle:{display:"flex",justifyContent:"space-between",verticalAlign:"center",cursor:"pointer",gridAutoFlow:"column",placeItems:"center",gap:10,alignItems:"center"},icon:{color:e.redBadgeBackground},settingsContainer:{display:"flex",alignItems:"center",justifyContent:"center",height:25,width:25,borderRadius:25},settingsContainerHoveredStyle:{background:e.whiteButtonPressedBackground}})),[i,r,d]),p=(0,a.useMemo)((()=>W({width:36,height:36,...u.icon})),[u.icon]);return(0,_.jsx)("div",{style:{...u.container,zIndex:k().Wd+1},...o,children:(0,_.jsxs)("div",{className:"notion-dictation-button",style:{...u.dictationButtonStyle},children:[(0,_.jsx)("div",{style:{flexGrow:1,maxWidth:36}}),(0,_.jsx)("div",{style:{maxWidth:480,width:"100%",justifyContent:"center",display:"flex",verticalAlign:"middle"},children:(0,_.jsx)(ce,{})}),(0,_.jsx)("div",{onClick:t,children:p})]})})}function ce(){const e=(0,c().VK)((()=>m().default.state.audioRecorder),[]),t=(0,c().Kw)(re().Z),n=(0,c().VK)((()=>({lowshelf_filter_frequency:Q().default.getConfigKey("mobile_dictation_visualizer","lowshelf_filter_frequency"),lowshelf_filter_gain:Q().default.getConfigKey("mobile_dictation_visualizer","lowshelf_filter_gain"),fft_size:Q().default.getConfigKey("mobile_dictation_visualizer","fft_size"),trim_threshold:Q().default.getConfigKey("mobile_dictation_visualizer","trim_threshold"),min_hz:Q().default.getConfigKey("mobile_dictation_visualizer","min_hz"),max_hz:Q().default.getConfigKey("mobile_dictation_visualizer","max_hz")})),[]),o=(0,a.useRef)(null);return(0,a.useEffect)((()=>{if(e&&t){const i=new AbortController,r=i.signal,a=()=>{const{mediaStream:i}=e;if(i){const e=t.createMediaStreamSource(i),a=t.createBiquadFilter();a.type="lowshelf",a.frequency.setValueAtTime(n.lowshelf_filter_frequency,t.currentTime),a.gain.setValueAtTime(n.lowshelf_filter_gain,t.currentTime);const s=t.createAnalyser();s.fftSize=n.fft_size,e.connect(a),a.connect(s),t.resume();const c=new Uint8Array(s.frequencyBinCount),l=()=>{if(r.aborted)return e.disconnect(),void a.disconnect();s.getByteFrequencyData(c);const i=t.sampleRate/2/s.frequencyBinCount,u=n.min_hz??0,p=n.max_hz?Math.round(n.max_hz/i):c.length,m=c.slice(u,p),f=o.current,y=null==f?void 0:f.getContext("2d");if(f&&y){const e=window.devicePixelRatio||1,t=f.getBoundingClientRect();f.width=t.width*e,f.height=t.height*e,y.scale(e,e);const o=4;f.height=30*o;const i=f.width,r=f.height,a=1*o;y.clearRect(0,0,i,r);const s=i/(a+o),c=Math.min(1,m.length/s);let l=0;for(let d=0;d<m.length;d++){const e=m[d*c],t=.05*Math.random(),s=(null==n?void 0:n.trim_threshold)??40,u=(Math.max(e,s)-s)/(255-s),p=Math.max(.05,u>0?u+t:0)*r;if(y.fillStyle="rgb(128,128,128)",l+a<=i&&y.fillRect(l,r/2-p/2,a,p),l+=a+o,l>=i)break}}d=requestAnimationFrame(l)};let d=requestAnimationFrame(l);return()=>{cancelAnimationFrame(d),e.disconnect(),a.disconnect()}}};let s=a();const c=()=>{"function"==typeof s&&s(),s=a()};return e.emitter.on(ne().oF,c),()=>{e.emitter.off(ne().oF,c),"function"==typeof s&&s(),i.abort()}}}),[e,t,n]),e?(0,_.jsx)("canvas",{ref:o,style:{width:"100%",height:30}}):(0,_.jsx)("div",{style:{fontSize:8},children:"No audio recorder available"})}function le(){const e=(0,s().O7)(),t=(0,c().VK)((()=>{const e=m().P7.state;if(e)return!e.isDictatableBlock()||e.pathIsDead()}),[]),n=(0,c().VK)((()=>!m().w7.state),[]);return(0,a.useEffect)((()=>{(0,w().$K)(t)&&t&&(0,o().stopDictation)({environment:e})}),[t,e]),(0,a.useEffect)((()=>{if(n){const t=setTimeout((()=>{(0,o().stopDictation)({environment:e})}),350);return()=>{clearTimeout(t)}}}),[n,e]),null}},360666:(e,t,n)=>{n.d(t,{Z:()=>i});class o extends(()=>n(263184))().default{constructor(){super()}getInitialState(){}setState(e){this.instanceState&&this.instanceState.close(),super.setState(e)}addListener(e){super.addListener(e),this.instanceState||this.setState((0,n(982774).k)(24e3))}removeListener(e){super.removeListener(e),0===this.listenerCount()&&this.setState(void 0)}}const i=new o},648587:(e,t,n)=>{n.d(t,{i:()=>i});class o extends(()=>n(263184))().default{getInitialState(){return{toggleMap:{},currentlyListeningBlockId:void 0,settingsOpenForBlockId:void 0}}setOpen(e,t){this.setState({...this.state,toggleMap:{...this.state.toggleMap,[e]:t}})}isOpen(e){return!!this.state.toggleMap[e]}setCurrentlyListeningBlockId(e){this.setState({...this.state,currentlyListeningBlockId:e})}getCurrentlyListeningBlockId(){return this.state.currentlyListeningBlockId}setSettingsOpenForBlockId(e){this.setState({...this.state,settingsOpenForBlockId:e})}isSettingsOpenForBlockId(e){return this.state.settingsOpenForBlockId===e}}const i=new o},912203:(e,t,n)=>{n.d(t,{$M:()=>h,GQ:()=>S,Jy:()=>C,LF:()=>w,NO:()=>m,Of:()=>I,SF:()=>u,TX:()=>_,XO:()=>g,Y_:()=>d,Ym:()=>y,bD:()=>b,cO:()=>p,fo:()=>k,rR:()=>f});n(267602),n(653476),n(228244);var o=()=>n(513670),i=()=>n(696459),r=()=>n(226413),a=()=>n(109477),s=()=>n(455222),c=()=>n(305580);(0,i().AO)((e=>(0,i().$K)(e)&&(0,i().$K)(e.target)&&(0,i().$K)(e.external_bot_id)?{true:{external_bot_id:e.external_bot_id,target:e.target}}:{false:e}));const l={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1},d={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function u(e){return Boolean(l[e.type]&&!(0,r().NK)(e)&&(!(0,r().qQ)(e)||void 0===(0,r().q3)(e)))}function p(e){const{collectionFormat:t,collectionSchema:n,filter:s,sort:l,sourcePropertyIds:d}=e,p=(d??(0,i().Yd)(n)).filter(((t,o,i)=>{const a=n[t];return!(!a||!u(a))&&(("relation"!==a.type||!e.restrictCrossSpace||!(0,r().Qh)(e.spaceId,a))&&(!s||s([t,a],o,n)))}));if(0===p.length)return[];if(!t||!1===l)return p;const m=(0,c().i)(t,n,void 0,a().j5.Page).collection_page_properties||[];return o().MR(p,(e=>m.findIndex((t=>t.property===e))))}function m(e){const{collectionFormat:t,collectionSchema:n,sort:s}=e,l=(0,i().Yd)(n).filter(((e,t,o)=>{const i=n[e];return!(!i||!(0,r().U8)(i))}));if(0===l.length)return[];if(!t||!1===s)return l;const d=(0,c().i)(t,n,void 0,a().j5.Page).collection_page_properties||[];return o().MR(l,(e=>d.findIndex((t=>t.property===e))))}function f(e){return e.type===s().$E.InvalidCharacter?{type:e.type,character:e.character}:e.type===s().$E.TokenExpected?{type:e.type,token:e.token}:e.type===s().FY.MissingSchemaPropertyOnThisRow||e.type===s().FY.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===s().FY.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection}:e.type===s().FY.MissingContextVariable?{type:e.type,valueId:e.valueId}:e.type===s().FY.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments}:e.type===s().FY.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex}:e.type===s().FY.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex}:e.type===s().FY.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer}:e.type===s().FY.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer}:e.type===s().FY.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection}:e.type===s().FY.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===s().FY.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType}:e.type===s().FY.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes}:e.type===s().FY.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name}:{type:e.type}}const y={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1};function h(e){return Boolean(y[e.type])}function g(e){const{collectionFormat:t,collectionSchema:n,filter:s,sort:l}=e,d=(0,i().Yd)(n).filter(((e,t,o)=>{var i;const a=n[e];return!(!a||!y[a.type])&&((!(0,r().qQ)(a)||null===(i=(0,r().q3)(a))||void 0===i||!i.auto_update_on_edit)&&(!s||s([e,a],t,n)))}));if(0===d.length)return[];if(!t||!1===l)return d;const u=(0,c().i)(t,n,void 0,a().j5.Page).collection_page_properties||[];return o().MR(d,(e=>u.findIndex((t=>t.property===e))))}const v={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1};function b(e){return v[e.type]}const x={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1};function _(e){return x[e.type]}function S(e){return 0===e}function k(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function w(e){const{property:t,collectionSchema:n}=e;return!!n&&!n[t]}function C(e){const{collectionSchema:t,property:n,type:o}=e,i=null==t?void 0:t[n];return!i||("action"===o?!u(i):!y[i.type])}function I(e){let{automationTrigger:t,collectionSchema:n}=e;if("event"===(null==t?void 0:t.type)||"notification_event"===(null==t?void 0:t.type)){const{pagesAdded:e,pagePropertiesEdited:o,source:r}=t.event;if(void 0===r)return!1;const a="some"===o.type&&o.some,s="all"===o.type&&o.all;if((a||s||[]).some((e=>w({collectionSchema:n,property:e.property})||C({collectionSchema:n,property:e.property,type:"trigger"}))))return!1;const c="some"===o.type&&(!(0,i().$K)(o.some)||0===o.some.length),l="all"===o.type&&(!(0,i().$K)(o.all)||0===o.all.length);if(!e&&("none"===o.type||c||l))return!1}else{if("recurrence"!==(null==t?void 0:t.type))return!1;if(!t.recurrence)return!1}return!0}},157955:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>A,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>S,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>_,MAX_RECURRENCE_INTERVAL:()=>h,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>g,RRULE_WEEKDAYS_MAP:()=>y,convertFromUnpersistedRecurrenceConfig:()=>F,convertToUnpersistedRecurrenceConfig:()=>R,getFormattedEndCondition:()=>M,getFormattedNextRecurrenceTime:()=>T,getNextDateUtc:()=>I,getRecurrenceAfter:()=>w,isRunningBetweenMidnightAnd3AM:()=>C,isValidRecurrenceInterval:()=>v,isValidRecurrenceNumberOfRuns:()=>b,rruleFromRecurrence:()=>x,templateAncestorsViolateRecurrenceNesting:()=>k});n(267602),n(653476),n(241792);var o=()=>n(730120);n(670560);function i(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(0===n.length)return e.map((e=>[e]));const r=[];for(const a of e)r.push(...i(n[0],...n.slice(1)).map((e=>[a,...e])));return r}var r=()=>n(696459),a=()=>n(326966),s=()=>n(803021),c=()=>n(646574),l=()=>n(998411),d=()=>n(578292);class u extends(()=>n(484885))().Ci{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var p=()=>n(494616);const m=(0,n(788860).vU)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12–3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),f={day:u.DAILY,week:u.WEEKLY,month:u.MONTHLY,year:u.YEARLY},y={MO:u.MO,TU:u.TU,WE:u.WE,TH:u.TH,FR:u.FR,SA:u.SA,SU:u.SU},h=99,g=999;function v(e){return(0,a().hj)(e)&&Number.isInteger(e)&&e>0&&e<=h}function b(e){return(0,a().hj)(e)&&Number.isInteger(e)&&e>0&&e<=g}function x(e){const{start_date:t,frequency:n,interval:o,weekdays:a,timezone:c,hour:l,minute:d}=e,p="week"===n&&a?a.map((e=>y[e])):void 0,m={};return(0,r().$K)(e.end_condition)&&("date"===e.end_condition.type?m.until=(0,s().pd)(e.end_condition.end_at):"number"===e.end_condition.type?m.count=e.end_condition.number_of_occurrences:(0,r().t1)(e.end_condition)),"month"===e.frequency&&(0,r().$K)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?m.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?m.byweekday=i(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return y[t].nth(n)})):(0,r().t1)(e.monthly_restriction)),new u({freq:f[n],dtstart:(0,s().pd)(t),interval:o,byweekday:p,tzid:c,byhour:l??0,byminute:d??0,bysecond:0,...m})}const _=1,S=1;function k(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),o=e.length,i=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,r=o>_,a=n.length>=S;return{violatesConstraint:r||a,templateNestingExceedsMaxDepth:r,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:o,immediateAncestorRecurrenceType:i}}function w(e){const{recurrence:t,afterDate:n}=e;if((0,p().nA)(t)){const e=(0,s().kq)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=x(t).after((0,s().pd)(n));if(!e)return;return(0,s().YL)(e)}}function C(e){return 0===e.hour||1===e.hour||2===e.hour}function I(e){return x(e).after((0,s().pd)((0,s().Jh)()))||void 0}function T(e){const{recurrence:t,intl:n}=e,i=I(F(t));if(!i)return;const r=C(t),a=o().ou.fromJSDate(i).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,d().E2)(n)).setZone(t.timezone),s=(0,c().p6)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(r)return n.formatMessage(m.dateBetweenMidnightAnd3AM,{date:s});{let e=a.toLocaleString(o().ou.TIME_SIMPLE);return t.timezone!==(0,l().r)()&&(e+=` ${a.toFormat("ZZZZ")}`),n.formatMessage(m.dateAtTime,{date:s,time:e})}}function M(e,t){return(0,r().$K)(e)?"number"===e.type?t.formatMessage(m.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,c().p6)({date:o().ou.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,r().t1)(e):t.formatMessage(m.noEndCondition)}const A=100;function R(e){return{...e,start_date:(0,s().kq)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,s().kq)(e.end_condition.end_at)}:(0,r().t1)(e.end_condition):void 0}}function j(e,t){const n=o().ou.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,s().Jh)(n.toJSDate())}}function F(e){return{...e,start_date:(0,s().Jh)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?j(e,e.end_condition):(0,r().t1)(e.end_condition):void 0}}}}]);