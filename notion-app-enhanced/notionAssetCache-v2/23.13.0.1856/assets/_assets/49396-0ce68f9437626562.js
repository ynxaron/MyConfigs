"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[49396],{832024:(t,o,e)=>{e.d(o,{AK:()=>p,Mc:()=>r,OS:()=>l,Td:()=>_,Uu:()=>c,XC:()=>s,ZK:()=>y,e8:()=>m,gV:()=>d,hc:()=>g,n0:()=>v,u0:()=>f,xi:()=>u});var n=()=>e(594546),i=()=>e(572623),a=()=>e(697623);function r(t){n().K4(t,"add_slack_integration")}function c(t){n().K4(t,"remove_slack_integration")}function s(t,o){n().K4(t,"slack_notification_create",o)}function u(t,o){n().K4(t,"slack_notification_delete",o)}function l(t,o){n().K4(t,"slack_notification_update",o)}function d(t,o){const e=a().zt(),r=i().JF();n().K4(t,"slack_imports_invite_render_button",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id})}function m(t,o){const e=a().zt(),r=i().JF();n().K4(t,"slack_imports_invite_render_invite_popup",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id})}function p(t,o){const e=a().zt(),r=i().JF();n().K4(t,"slack_imports_invite_click_invite_button",{subscription_tier:e,domain_type:r,invited_user_count:o.invited_user_count,origin:o.origin,invite_token_query:o.inviteTokenQuery,invite_targets:o.inviteTargets,invite_flow_id:o.invite_flow_id})}function f(t,o){const e=a().zt(),r=i().JF();n().K4(t,"slack_imports_invite_completed",{subscription_tier:e,domain_type:r,invited_user_count:o.invited_user_count,is_success:o.is_success,origin:o.origin,invite_flow_id:o.invite_flow_id,error:o.error,invite_stage:o.invite_stage})}function _(t,o){const e=a().zt(),r=i().JF();n().K4(t,"slack_imports_invite_dismiss_popup",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id})}function g(t,o){const e=a().zt(),r=i().JF();n().K4(t,"slack_imports_invite_click_select_all",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id,invited_user_count:o.invited_user_count,is_unselect:o.is_unselect,invite_token_query:o.invite_token_query})}function v(t,o){const e=a().zt(),r=i().JF();n().K4(t,"slack_imports_invite_start_slack_integration",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id,from:o.from})}function y(t,o){const e=a().zt(),r=i().JF();n().K4(t,"slack_imports_invite_complete_slack_integration",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id,from:o.from,is_success:o.is_success})}},49396:(t,o,e)=>{e.r(o),e.d(o,{addAutomationAction:()=>G,clearInvalidVariables:()=>U,createAutomation:()=>W,deleteAutomation:()=>Q,disableAutomation:()=>q,duplicateAutomation:()=>B,duplicateAutomationAction:()=>j,enableAutomation:()=>O,insertEmptyTextInDuplicateBlockAction:()=>z,messages:()=>E,removeAutomationAction:()=>D,reorderAutomationActions:()=>J});e(821057),e(122556),e(582845),e(250570),e(533019),e(721473),e(788208),e(22624),e(267602),e(653476),e(470928),e(30005),e(241792);var n=e.n(e(369282)),i=()=>e(492788),a=()=>e(912203),r=()=>e(271896),c=()=>e(764052),s=()=>e(559102),u=()=>e(92960),l=()=>e(481529),d=()=>e(827370),m=()=>e(494616),p=()=>e(922713),f=()=>e(81954),_=()=>e(955620),g=()=>e(513670),v=()=>e(543172),y=()=>e(855741),S=()=>e(696459),M=()=>e(832024),h=()=>e(282662),A=()=>e(332542),T=()=>e(636340),b=()=>e(990966),k=()=>e(269299),C=()=>e(205228),I=()=>e(872308),w=()=>e(594546),R=()=>e(615676),K=()=>e(487270),x=()=>e(32969),F=()=>e(637118),P=()=>e(309841),$=()=>e(658517),V=()=>e(807629);const E=(0,e(788860).vU)({genericErrorMessage:{id:"automations.buttonTrigger.genericErrorMessage",defaultMessage:"Button failed to execute"},open:{defaultMessage:"Open",id:"automations.buttonTrigger.open"},undo:{defaultMessage:"Undo",id:"automations.buttonTrigger.undo"},defaultConfirmationWorkflowText:{defaultMessage:"Are you sure you want to continue?",id:"automations.buttonTrigger.defaultConfirmationWorkflowText"},defaultContinueWorkflowMessage:{defaultMessage:"Continue",id:"automations.buttonTrigger.defaultContinueWorkflowMessage"},defaultStopWorkflowMessage:{defaultMessage:"Cancel",id:"automations.buttonTrigger.defaultStopWorkflowMessage"},errorQueryCollectionTooManyPages:{defaultMessage:"Button impacts too many pages",id:"automations.buttonTrigger.errorQueryCollectionTooManyPages"},errorRecordInTrash:{id:"automations.buttonTrigger.errorRecordInTrash",defaultMessage:"Button is editing a page in trash"}});function W(t){const{actionIds:o,automationId:e,automationName:i,environment:a,inMemoryRecordCache:r,parentPointer:c,transaction:s,trigger:u}=t,l=e??(0,K().TS)({environment:a,table:m().cv,spaceId:c.spaceId}),d=T().ae({environment:a,inMemoryRecordCache:r??a.defaultRecordCache.inMemoryRecordCache,table:m().cv,transaction:s,value:{action_ids:o,alive:!0,id:l,parent_id:c.id,parent_table:c.table,properties:{name:i},space_id:c.spaceId,status:"active",trigger:u}});return n()(d.isTriggerType(u.type),"Trigger type mismatch"),d}function G(t){const{actionId:o,environment:e,intl:a,automationStore:c,actionType:s,transaction:u,insertionPoint:l,config:f,createDuplicateBlocksContainer:g=!0,builderType:y="sidebar"}=t,M=c.getSpaceId();if(!M)return;let A;if("duplicate_blocks"===s&&g){A=T().j4({environment:e,inMemoryRecordCache:c.inMemoryRecordCache,transaction:u,type:"text"});const t=z({environment:e,contentStore:A.getContentStore(),transaction:u});i().default.afterNextFlush((()=>{const o=x().C.find((o=>d().dr.isEqual(o.props.store.pointer,t.pointer)));o&&b().setSelectionAtStart({store:o.props.store.getBlockTitleStore()})}))}const k=f??function(t){const{actionType:o,automationStore:e,intl:n}=t;if("modal_confirmation"===o)return{continue_button:{text:n.formatMessage(E.defaultContinueWorkflowMessage)},cancel_button:{text:n.formatMessage(E.defaultStopWorkflowMessage)},text:{type:"simple",value:(0,_().TPx)(n.formatMessage(E.defaultConfirmationWorkflowText))}};if("define_variables"===o){const t=(0,v().ZP)();return{values:{[t]:{name:(0,$().h)(e.getActionStores(),n.formatMessage(p().eC)),value:{type:"simple",value:[[""]]}}},variableIds:[t]}}}({actionType:s,automationStore:c,intl:a})??{},C=T().ae({environment:e,inMemoryRecordCache:c.inMemoryRecordCache,table:p().Xj,transaction:u,value:{id:o,type:s,parent_id:c.id,parent_table:m().cv,alive:!0,space_id:M,config:k,blocks:A?[A.id]:[]}});return A&&h().R3({transaction:u,parentStore:C.getKeyStore("blocks"),appendStore:A}),!l||"afterActionId"in l?h().R3({transaction:u,parentStore:c.getActionIdsStore(),appendStore:C,after:null==l?void 0:l.afterActionId}):"beforeActionId"in l?h().Ce({transaction:u,parentStore:c.getActionIdsStore(),prependStore:C,before:l.beforeActionId}):(0,S().t1)(l),N({transaction:u,automationStore:c}),(0,P().GV)(((t,o,n)=>{const i=(0,w().mc)(e),a=(0,P().TI)({automationActionStore:C,formulaAnalyticsModule:o,formulasModule:t,simpleFormulasModule:n});(0,S().$K)(a)&&(0,r().A2)(i,{automation_action:a,automation_action_id:C.id,automation_id:C.getParentId(),builder_type:y}),C.isDefined()&&(0,r().eI)(i,{automation_action_id:C.id,automation_action_type:C.getType(),automation_id:c.id,builder_type:y})})),n()(C.isType(s),"Action type mismatch"),C}function B(t){const{actorPointer:o,environment:e,includeParenting:n,sourceAutomationStore:i,targetAutomationId:a,transaction:r}=t,c=i.getParentStore();if(!c||!c.isReady())throw new Error("Automation parent store not ready");const u=i.getValue(),l=i.getSpaceId();if(!(0,S().$K)(u)||!(0,S().$K)(l))throw new Error("Undefined automation value or space id");const d={},_={...(0,g().Xh)(u),id:a??(0,K().TS)({environment:e,table:m().cv,spaceId:(0,f().J)(l)})};d[i.id]=_.id,(0,S().$K)(_.action_ids)&&(0,S().Of)(_.action_ids)&&_.action_ids.forEach((t=>d[t]=(0,K().TS)({environment:e,table:p().Xj,spaceId:(0,f().J)(l)})));const v=t=>{let{requested:o}=t;const e=d[o.id];return(0,S().$K)(e)?{...o,id:e}:o};(0,s().J_)({actor:o,duplicateRecord:_,options:{},mapper:v,originalRecord:u});const y=T().ae({environment:e,inMemoryRecordCache:i.inMemoryRecordCache,table:m().cv,transaction:r,value:_});n&&A().jG({childStore:y,parentStore:c,transaction:r});const M=i.getActionStores(),h=Promise.all(M.map((t=>{const o=d[t.id],{automationActionStore:n,onComplete:i}=j({environment:e,includeParenting:!1,mapper:v,sourceActionStore:t,targetAutomationActionId:o,transaction:r});return A().jG({childStore:n,parentStore:y,transaction:r}),i}))),b=h.then((t=>t.flat()));return{automationStore:y,onComplete:b}}function j(t){const{environment:o,includeParenting:e,insertionPoint:n,mapper:i,sourceActionStore:a,targetAutomationActionId:c,transaction:u}=t,l=a.getParentStore();if(!l||!l.isReady())throw new Error("Automation store is not ready");const d=a.getValue(),m=a.getSpaceId();if(!(0,S().$K)(d)||!(0,S().$K)(m))throw new Error("Undefined action value or space id");const _={...(0,g().Xh)(d),id:c??(0,K().TS)({environment:o,table:p().Xj,spaceId:(0,f().J)(m)})},v=o.currentUser.id,y=a.inMemoryRecordCache.makeGetRecordRoleFn(v);(0,s().XJ)({duplicateRecord:_,getRecordRole:y,originalRecord:d,mapper:t=>(null==i?void 0:i(t))??t.requested,options:{},originOptions:{baseUrl:C().default.domainBaseUrl,publicDomainName:C().default.publicDomainName},duplicateBlocks:!1});const M=T().ae({environment:o,inMemoryRecordCache:a.inMemoryRecordCache,table:p().Xj,transaction:u,value:_});e&&(!n||"afterActionId"in n?A().jG({after:null==n?void 0:n.afterActionId,childStore:M,parentStore:l,transaction:u}):"beforeActionId"in n?A().SH({before:null==n?void 0:n.beforeActionId,childStore:M,parentStore:l,transaction:u}):(0,S().t1)(n),N({transaction:u,automationStore:l}));const h=Promise.all(a.getBlockStores().map((t=>{const[e,n]=I().duplicateBlock({addCopyName:!1,baseUrl:C().default.domainBaseUrl,deepCopyTransclusionContainers:!1,environment:o,preferDuplicateLocation:"local",publicDomainName:C().default.publicDomainName,resolveTemplateVariables:!1,stores:[t],targetSpaceId:(0,f().J)(t.pointer.spaceId),transaction:u}),i=e[0];return A().jG({childStore:i,parentStore:M,transaction:u}),n}))),b=M.getModel();return(0,S().$K)(b)&&(0,P().GV)(((t,e,n)=>{const i=(0,w().mc)(o),a=(0,P().TI)({automationActionStore:M,formulaAnalyticsModule:e,formulasModule:t,simpleFormulasModule:n});(0,S().$K)(a)&&(0,r().A2)(i,{automation_action:a,automation_action_id:b.id,automation_id:b.parent_id,from:"duplicate"}),(0,r().eI)(i,{automation_action_id:b.id,automation_action_type:b.type,automation_id:l.id,from:"duplicate"})})),{automationActionStore:M,onComplete:h}}function J(t){const{environment:o,automationStore:e,automationTypecheckModule:n,contextType:i,formulasModule:a,intl:r,newActionIds:c,transaction:s,from:u,movedActionId:l}=t;T().sW({store:e,transaction:s,data:{action_ids:c}}),N({automationStore:e,transaction:s});X({automationStore:e,transaction:s,typecheckResult:(0,V().k)({automationStore:e,automationTypecheckModule:n,contextType:i,formulasModule:a,intl:r})}),(0,w().j)({environment:o,event:{eventName:"automation_action_move",eventProperties:{automation_id:e.id,automation_action_id:l,from:u}}})}function D(t){const{actionStore:o,automationStore:e,automationTypecheckModule:n,contextType:i,environment:a,formulasModule:r,intl:c,transaction:s}=t,u=(0,V().k)({automationStore:e,automationTypecheckModule:n,contextType:i,formulasModule:r,intl:c});Y({automationActionStore:o,environment:a,transaction:s,hasError:(y().x.isSuccess(u)&&u.value.actionValidationFailures[o.id]||[]).length>0}),X({automationStore:e,transaction:s,typecheckResult:u})}function U(t){const{automationStore:o,automationTypecheckModule:e,contextType:n,formulasModule:i,intl:a,transaction:r}=t;X({automationStore:o,transaction:r,typecheckResult:(0,V().k)({automationStore:o,automationTypecheckModule:e,contextType:n,formulasModule:i,intl:a})})}function N(t){const{automationStore:o,transaction:e}=t;o.getSpaceId()&&o.getActionStores().forEach(((t,o)=>{var n;if(!t.isDefined())return;const i=t.getModel();i.isType("open_page")&&"url"===(null===(n=i.getConfig())||void 0===n||null===(n=n.target)||void 0===n?void 0:n.type)&&!(0,a().GQ)(o)&&T().sW({store:t.getConfigStore(),transaction:e,data:{target:null}})}))}function X(t){const{automationStore:o,transaction:e,typecheckResult:n}=t,i=o.getSpaceId(),a=o.getModel();if(i&&a&&!y().x.isFail(n))for(const r of a.getActionIds()){const t=o.getRecordStore(o,{table:p().Xj,id:r,spaceId:i});if(!t.isDefined())continue;const a=t.getModel(),s=new Set(n.value.actionInputValueTypes[r].map((t=>{if(t.kind===u().FormulaContextValueKind.Binding||t.kind===u().FormulaContextValueKind.ContextValue)return t.id;t.kind!==u().FormulaContextValueKind.ThisRow&&(0,S().t1)(t)})).filter(S().$K)),{value:d}=(0,c().e)({automationActionModel:a,baseUrl:C().default.domainBaseUrl,preventClearingConfig:!0,publicDomainName:C().default.publicDomainName,sourceSpaceId:i,visitors:{visitCollectionProperty:void 0,visitCollectionPropertyPointer:void 0,visitFormulaContextValue:t=>s.has(t)?{type:"keep"}:{type:"replace",value:void 0},visitFormulaPageProperty:void 0,visitRecordPointer:void 0}}),m=l().op.update({pointer:t.pointer,path:["config"],args:d.getConfig()??{}});k().applyOperation({store:t,operation:m,transaction:e})}}function z(t){const{environment:o,contentStore:e,transaction:n}=t,i=T().j4({environment:o,type:"text",inMemoryRecordCache:e.inMemoryRecordCache,transaction:n,spaceId:e.pointer.spaceId});return h().R3({parentStore:e,appendStore:i,transaction:n}).childStore}function O(t){const{automationStore:o,environment:e,transaction:n}=t;T().sW({store:o,data:{status:"active"},transaction:n});const i=o.getModel();(0,S().$K)(i)&&(0,P().GV)(((t,n,a)=>{const c=(0,F().Ep)(o);let s=[];c&&y().x.isSuccess(c)&&(s=c.value.valueTypes);const u=(0,w().mc)(e),l=(0,r().TY)({automationModel:i,formulaAnalyticsModule:n,formulasModule:t,formulaTypecheckContextValues:s,getRecordModel:o.getRecordModel,featureGates:(0,R().W)(),simpleFormulasModule:a});(0,r().Rt)(u,l)}))}function q(t){const{automationStore:o,environment:e,status:n,transaction:i}=t,a=n??"disabled";T().sW({store:o,data:{status:a},transaction:i}),o.isTriggerType("recurrence")&&T().sW({store:o,data:{run_at:void 0},transaction:i});const c=o.getModel();(0,S().$K)(c)&&(0,P().GV)(((t,n,i)=>{const a=(0,F().Ep)(o);let s=[];a&&y().x.isSuccess(a)&&(s=a.value.valueTypes);const u=(0,w().mc)(e),l=(0,r().TY)({automationModel:c,formulaAnalyticsModule:n,formulasModule:t,formulaTypecheckContextValues:s,getRecordModel:o.getRecordModel,featureGates:(0,R().W)(),simpleFormulasModule:i});(0,r().ai)(u,l)}))}function Q(t){const{automationStore:o,environment:e,transaction:n}=t;T().sW({store:o,data:{alive:!1},transaction:n});const i=o.getActionStores();for(const r of i)Y({automationActionStore:r,automationStore:o,environment:e,transaction:n});const a=o.getModel();(0,S().$K)(a)&&(0,P().GV)(((t,n,i)=>{const c=(0,F().Ep)(o);let s=[];c&&y().x.isSuccess(c)&&(s=c.value.valueTypes);const u=(0,w().mc)(e),l=(0,r().TY)({automationModel:a,formulaAnalyticsModule:n,formulasModule:t,formulaTypecheckContextValues:s,getRecordModel:o.getRecordModel,featureGates:(0,R().W)(),simpleFormulasModule:i});(0,r().uO)(u,l),a.isNotificationType()&&M().xi(e,{type:"granular",source:"collection_view_settings",collection_id:a.parent_id})}))}function Y(t){const{automationActionStore:o,automationStore:e,environment:n,transaction:i,hasError:a=!1}=t;let c=o.getParentStore();if((0,S().$K)(e)){const t=o.getParentPointer();if(!(0,S().$K)(t))throw new Error("Automation action does not have a parent pointer");if(!d().dr.isEqual(t,e.pointer))throw new Error(`Automation action parent pointer does not match argument: ${d().dr.toKey(t)}, ${d().dr.toKey(e.pointer)}`);c=e}else if(!(0,S().$K)(c))throw new Error("Automation store is undefined");A().hr({childStore:o,parentStore:c,transaction:i});const s=o.getBlockStores();for(const r of s)A().hr({childStore:r,parentStore:o,transaction:i});const u=o.getModel();(0,S().$K)(u)&&(0,P().GV)(((t,e,i)=>{const s=(0,w().mc)(n),l=(0,P().TI)({automationActionStore:o,formulaAnalyticsModule:e,formulasModule:t,simpleFormulasModule:i});(0,S().$K)(l)&&(0,r().OK)(s,{automation_action:l,automation_action_id:u.id,automation_id:u.parent_id,has_error:a}),(0,r().co)(s,{automation_action_id:u.id,automation_action_type:u.type,automation_id:c.id,has_error:a})}))}},309841:(t,o,e)=>{e.d(o,{GV:()=>m,TI:()=>l,yE:()=>d});e(267602),e(653476),e(241792);var n=()=>e(271896),i=()=>e(855741),a=()=>e(696459),r=()=>e(141735),c=()=>e(594546),s=()=>e(615676),u=()=>e(637118);function l(t){const{automationActionStore:o,automationStore:e,formulaAnalyticsModule:r,formulasModule:c,simpleFormulasModule:l}=t,d=o.getModel(),m=e??o.getParentStore();if(!d||!m)return;const p=m.getActionStores().map((t=>t.getModel())).filter(a().$K),f=(0,u().Ep)(m);let _=[];return f&&i().x.isSuccess(f)&&(_=f.value.valueTypes),(0,n().Bj)({automationActionModel:d,automationActionModels:p,formulaAnalyticsModule:r,formulasModule:c,simpleFormulasModule:l,formulaTypecheckContextValues:_,getRecordModel:o.getRecordModel,featureGates:(0,s().W)()})}function d(t,o){const{automationStore:e,automationActionStore:n}=o;e.isTriggerType("event")||e.isTriggerType("notification_event")||m(((o,i,a)=>{const r=l({automationActionStore:n,automationStore:e,formulaAnalyticsModule:i,formulasModule:o,simpleFormulasModule:a});r&&(0,c().A3)(t,"automation_action_update",n.id,1,{automation_action:r,automation_action_id:n.id,automation_id:e.id})}))}function m(t){return Promise.all([r().F.formulas.load(),r().F.formulaAnalytics.load(),r().F.simpleFormulas.load()]).then((o=>{let[e,n,i]=o;t(e,n,i)})).catch((t=>{console.error("Error sending analytics for automations",t)}))}},658517:(t,o,e)=>{e.d(o,{h:()=>n});e(122556),e(582845),e(250570),e(533019),e(721473),e(788208),e(22624),e(267602),e(731107);function n(t,o){const e=t.reduce(((t,o)=>{if(o.isType("define_variables")){var e;const n=null===(e=o.getModel())||void 0===e?void 0:e.getVariables();if(n)for(const o of Object.values(n))t.add(o.name)}return t}),new Set),n=o.replace(/\s*\d+$/,"");let i=1,a=`${n} ${i}`;for(;e.has(a);)a=`${n} ${i}`,i++;return a}}}]);