"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[71896],{271896:(e,t,o)=>{o.d(t,{A2:()=>g,Bj:()=>h,OK:()=>M,Rt:()=>_,T0:()=>m,TY:()=>A,ai:()=>v,co:()=>p,eI:()=>d,r4:()=>f,uO:()=>y});o(821057),o(670560),o(267602),o(653476),o(30005),o(241792),o(228244);var a=()=>o(513670),l=()=>o(855741),i=()=>o(696459),n=()=>o(446866),u=()=>o(177634),r=()=>o(989478),c=()=>o(955620),s=()=>o(367026);function d(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"add_automation_step",properties:t})}function p(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"delete_automation_step",properties:t})}function m(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_create",properties:t})}function f(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_update",properties:t})}function y(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_delete",properties:t})}function _(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_enable",properties:t})}function v(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_disable",properties:t})}function g(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_create",properties:t})}function M(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_delete",properties:t})}function T(e){const{formulaAnalyticsModule:t,formulasModule:o,formulaTypecheckContextValues:a,getRecordModel:n,spaceId:r,value:c,featureGates:s}=e;if("formula"===c.type){if(!(0,i().$K)(c.value))return;const e=l().x.unwrapOr(o.parseFormulaInputToAst(c.value),void 0);if(e){const l=o.addTypesToFormulaAST(e,{handleDataRequest:(0,u().lc)(n),spaceId:r,valueTypes:a,featureGates:s});return{...t.getFormulaAnalytics(e,{getRecordModel:n,typecheckContextValues:a}),formula_return_type:l.node.type,redacted_formula:t.getRedactedFormulaAsStringSync(e,{getRecordModel:n,typecheckContextValues:a})}}}else{if("simple"===c.type){if(!(0,i().$K)(c.value))return;return t.getSimpleFormulaAnalytics(c.value,{getRecordModel:n,typecheckContextValues:a})}(0,i().t1)(c.type)}}function h(e){const{automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:l,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f,simpleFormulasModule:y}=e;return t.isType("assistant_basic")?{automation_action_id:t.pointer.id,type:"assistant_basic"}:t.isType("complete_sprint")?{automation_action_id:t.pointer.id,type:"complete_sprint"}:t.isType("create_page")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:a,formulaTypecheckContextValues:l,getRecordModel:n,featureGates:u}=e,r=t.getConfig();let c,s=[];const d=null==r?void 0:r.collection,p=null==r?void 0:r.properties;if((0,i().$K)(d)&&(0,i().$K)(p)&&p.length>0){const e=n(d),f=null==e?void 0:e.getNormalizedSchema();(0,i().$K)(f)&&(s=p.map((e=>{var t;return(null===(t=f[e])||void 0===t?void 0:t.type)??"unknown"})));const y=null==r?void 0:r.values;if(a&&(0,i().$K)(y)){c=[];for(const e of p){var m;const i=null===(m=y[e])||void 0===m?void 0:m.value;if(!i)continue;const r=T({formulaAnalyticsModule:o,formulasModule:a,getRecordModel:n,formulaTypecheckContextValues:l,spaceId:t.spaceId,value:i,featureGates:u});r&&c.push(r)}}}return{automation_action_id:t.pointer.id,property_formula_stats:c,property_types:s,type:"create_page"}}({automationActionModel:t,formulaAnalyticsModule:l,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):t.isType("duplicate_blocks")?{automation_action_id:t.pointer.id,type:"duplicate_blocks"}:t.isType("modal_confirmation")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:a,formulaTypecheckContextValues:l,getRecordModel:n,featureGates:u}=e,r=t.getConfig(),c=[];if(a&&(0,i().$K)(r)&&r.text){const e=T({formulasModule:a,formulaAnalyticsModule:o,getRecordModel:n,formulaTypecheckContextValues:l,spaceId:t.spaceId,value:r.text,featureGates:u});e&&c.push(e)}return{automation_action_id:t.pointer.id,formula_stats:c,type:"modal_confirmation"}}({automationActionModel:t,formulaAnalyticsModule:l,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):t.isType("open_page")?{automation_action_id:t.pointer.id,type:"open_page"}:t.isType("query_collection")?{automation_action_id:t.pointer.id,type:"query_collection"}:t.isType("send_in_app_notification")?function(e){var t;const{automationActionModel:o,formulaAnalyticsModule:a,formulasModule:l,formulaTypecheckContextValues:n,getRecordModel:u,featureGates:r,simpleFormulasModule:s}=e,d={automation_action_id:o.pointer.id,messageCharacterCount:0,type:"send_in_app_notification"},p=o.getConfig();if(!(0,i().$K)(p))return d;if((0,i().$K)(p.target))if("formula"===p.target.type&&(0,i().$K)(p.target.value)){if(d.targetData={type:"formula",numUserFormulaTargets:(0,c().lcG)(p.target.value.value).length,numFormulaContextTargets:s.getReferencedContextValueIds(p.target.value).length},l){const e=T({formulasModule:l,formulaAnalyticsModule:a,getRecordModel:u,formulaTypecheckContextValues:n,spaceId:o.spaceId,value:p.target.value,featureGates:r});e&&(d.formula_stats??=[],d.formula_stats.push(e))}}else if("property"===p.target.type&&(0,i().$K)(p.target.propertyId)&&(0,i().$K)(p.target.collectionPointer)){const e=u(p.target.collectionPointer),t=null==e?void 0:e.getSchema();var m;(0,i().$K)(t)&&(d.targetData={type:"property",propertyType:null===(m=t[p.target.propertyId])||void 0===m?void 0:m.type})}if((0,i().$K)(null===(t=p.notification_message)||void 0===t?void 0:t.value)&&(d.messageCharacterCount=(0,c().Vkf)(p.notification_message.value),l)){const e=T({formulasModule:l,formulaAnalyticsModule:a,getRecordModel:u,formulaTypecheckContextValues:n,spaceId:o.spaceId,value:p.notification_message,featureGates:r});e&&(d.formula_stats??=[],d.formula_stats.push(e))}return d}({automationActionModel:t,formulaAnalyticsModule:l,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f,simpleFormulasModule:y}):t.isType("send_gmail_notification")?function(e){var t,o,l,u,s,d,p;const{automationActionModel:m,formulaAnalyticsModule:f,formulasModule:y,formulaTypecheckContextValues:_,getRecordModel:v,featureGates:g}=e,M=m.getConfig();if(!(0,i().$K)(M))return{automation_action_id:m.pointer.id,fields:{},recipient_domains:{},type:"send_gmail_notification"};const h=Object.fromEntries(Object.entries(M||{}).map((e=>{let[t,o]=e;var a;return"formula"===(null==o?void 0:o.type)?[t,Boolean(null==o||null===(a=o.value)||void 0===a?void 0:a.value)]:"simple"===(null==o?void 0:o.type)?[t,Boolean(null==o?void 0:o.value)]:[t,Boolean(o)]}))),{to:A,cc:k,bcc:C}=M,K=[...(null==A||null===(t=A.value)||void 0===t?void 0:t.value)||[],...(null==k||null===(o=k.value)||void 0===o?void 0:o.value)||[],...(null==C||null===(l=C.value)||void 0===l?void 0:l.value)||[]],x=[...(0,c().lcG)(K).map((e=>v({table:r().KJ,id:e}))).map((e=>null==e?void 0:e.email)).filter(i().$K),...(0,n().CU)((0,c().Jcv)(K))],$=a().VF(x.map((e=>e.split("@")[1]))),b=[null===(u=M.to)||void 0===u?void 0:u.value,null===(s=M.cc)||void 0===s?void 0:s.value,null===(d=M.bcc)||void 0===d?void 0:d.value,null===(p=M.reply_to)||void 0===p?void 0:p.value,M.from_name,M.email_subject,M.email_body].map((e=>{if(y&&(0,i().$K)(e))return T({formulaAnalyticsModule:f,formulasModule:y,getRecordModel:v,formulaTypecheckContextValues:_,spaceId:m.spaceId,value:e,featureGates:g})})).filter(i().$K);return{automation_action_id:m.pointer.id,fields:h,formula_stats:b,recipient_domains:$,type:"send_gmail_notification"}}({automationActionModel:t,formulaAnalyticsModule:l,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):t.isType("slack_notification")?{automation_action_id:t.pointer.id,type:"slack_notification"}:t.isType("update_pages")?function(e){const{automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:a,formulasModule:l,formulaTypecheckContextValues:n,getRecordModel:r,featureGates:c}=e,d=t.getConfig(),p=[],m=[],f=[];if((0,i().$K)(d)&&(0,i().$K)(d.target)&&(0,i().$K)(d.properties)&&d.properties.length>0){let e;if("variable"===d.target.type){const t=(0,u().MY)(d.target.id);if("action"===t.source){const t=(0,s().w)({actionModels:o,id:d.target.id}).collectionPointer;if((0,i().$K)(t)){const o=r(t);e=null==o?void 0:o.getNormalizedSchema()}}else{if("global"!==t.source||"button_page"!==t.global)throw new Error("Failed loading property schema");{const t=(0,u().vx)(n,d.target.id);if("block"===(null==t?void 0:t.type.type)&&(0,i().$K)(t.type.collection)){const o=r(t.type.collection);e=null==o?void 0:o.getNormalizedSchema()}}}}else if("collection"===d.target.type){const t=r(d.target.collection);e=null==t?void 0:t.getNormalizedSchema()}(0,i().$K)(e)&&d.properties.forEach((o=>{const u=e[o];if((0,i().$K)(u)&&(p.push(u.type),l&&(0,i().$K)(d.values))){const e=d.values[o];if((0,i().$K)(e)&&(m.push({type:u.type,operator:e.action}),e.value)){const o=T({formulasModule:l,formulaAnalyticsModule:a,getRecordModel:r,formulaTypecheckContextValues:n,spaceId:t.spaceId,value:e.value,featureGates:c});o&&f.push(o)}}}))}return{automation_action_id:t.pointer.id,property_configs:m,property_formula_stats:f,property_types:p,type:"update_pages"}}({automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:l,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):t.isType("define_variables")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:a,formulaTypecheckContextValues:l,getRecordModel:n,featureGates:u}=e,r=t.getConfig(),c=[];if(a&&(0,i().$K)(r)&&r.values)for(const i of Object.values(r.values))if(i.value){const e=T({formulasModule:a,formulaAnalyticsModule:o,getRecordModel:n,formulaTypecheckContextValues:l,spaceId:t.spaceId,value:i.value,featureGates:u});e&&c.push(e)}return{automation_action_id:t.pointer.id,formula_stats:c,type:"define_variables"}}({automationActionModel:t,formulaAnalyticsModule:l,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):t.isType("http_request")?{automation_action_id:t.pointer.id,type:"http_request"}:t.isType("publish_site")?{automation_action_id:t.pointer.id,type:"publish_site"}:void(0,i().t1)(t)}function A(e){const{automationModel:t,builderType:o="sidebar",formulaAnalyticsModule:a,formulasModule:l,formulaTypecheckContextValues:n,getRecordModel:u,featureGates:r,simpleFormulasModule:c,source:s}=e,d=[],p=t.getActionPointers().map((e=>u(e))).filter(i().$K);for(const M of t.getActionPointers()){const e=u(M);(0,i().$K)(e)&&d.push(h({automationActionModel:e,automationActionModels:p,formulaAnalyticsModule:a,formulasModule:l,formulaTypecheckContextValues:n,getRecordModel:u,featureGates:r,simpleFormulasModule:c}))}const m=[];let f,y,_;if(t.isEventType()||t.isNotificationType()){var v;const e=t.getEventConfiguration(),o=u(t.getParentPointer());f=t.getParentId();const a=t.getEventConfiguration();if("collection_view"===(null===(v=a.source)||void 0===v?void 0:v.type)){const e=u(a.source.pointer);_=null==e?void 0:e.parent_id,y=null==a?void 0:a.source.pointer.id}const l=null==o?void 0:o.getNormalizedSchema();if((0,i().$K)(l)){const{pagesAdded:t,pagePropertiesEdited:o}=e;if(t&&m.push({type:"page"}),"any"===o.type)m.push({condition:"any",type:"property"});else if("none"===o.type)m.push({condition:"none",type:"property"});else{let e=[];"some"===o.type?e=o.some??[]:"all"===o.type&&(e=o.all??[]);const t=[],a=[];e.forEach((e=>{var o;const n=null===(o=l[e.property])||void 0===o?void 0:o.type;(0,i().$K)(n)&&(t.push({type:n,operator:e.filter.operator}),a.push(n))})),m.push({condition:o.type,property_configs:t,property_types:a,type:"property"})}}}else if(t.isButtonType())m.push({type:"button"});else if(t.isRecurrenceType()){var g;m.push({type:"recurrence",frequency:null===(g=t.getTrigger().recurrence)||void 0===g?void 0:g.frequency})}else(0,i().t1)(t);return{automation_actions:d,automation_id:t.id,automation_triggers:m,collection_id:f,collection_view_id:y,collection_view_block_id:_,builder_type:o,source:s}}},367026:(e,t,o)=>{o.d(t,{w:()=>i});o(267602),o(470928);var a=()=>o(696459),l=()=>o(177634);function i(e){var t;const{actionModels:o,id:i}=e,n=(0,l().MY)(i),u="action"===n.source?o.find((e=>e.id===n.action_id)):void 0,r=(0,a().$K)(u)&&u.isType("create_page")?null===(t=u.getConfig())||void 0===t?void 0:t.collection:void 0;return{automationValueInfo:n,collectionPointer:r,actionModel:u}}}}]);