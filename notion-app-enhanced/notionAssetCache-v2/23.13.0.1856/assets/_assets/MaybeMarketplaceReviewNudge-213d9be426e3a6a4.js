"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[83658],{297138:(e,t,i)=>{i.r(t),i.d(t,{MaybeMarketplaceReviewNudge:()=>y});var n=i(667294),r=()=>i(219727),o=()=>i(142735),s=()=>i(801812),a=()=>i(924172),d=()=>i(824462),c=()=>i(876822),u=()=>i(528831),l=()=>i(131405),g=()=>i(681314),v=()=>i(367666),w=()=>i(436037),m=()=>i(451191),I=i(785893);const h=15,_=10,p=10,f=1;function y(e){let{blockStore:t}=e;const i=(0,r().O7)(),{installationPointer:y,version:k,lastEditedById:R,lastEditedTime:S,createdTime:q}=function(e){return(0,o().VK)((()=>{var t;if(!e.isDefined())return{};const i=e.getModel();return{installationPointer:i.getIsImprintableBlock()?null===(t=i.getFormat().installation_imprint)||void 0===t?void 0:t.pointer:void 0,lastEditedById:e.getLastEditedById(),lastEditedTime:e.getLastEditedTime(),createdTime:e.getCreatedTime(),version:i.getVersion()}}),[e])}(t),{acquisitionPointer:T}=function(e){const t=(0,r().O7)();return(0,o().VK)((()=>{if(!e)return{};const i=new(g().r)(t,e);return{acquisitionPointer:null==i?void 0:i.getAcquisitionPointer()}}),[t,e])}(y),{customerPointer:C,acquisitionStatus:b,listingId:V,acquisitionId:M,succeededTime:N}=function(e){const t=(0,r().O7)();return(0,o().VK)((()=>{var i,n;if(!e)return{};const r=new(u().I)(t,e);return{acquisitionStatus:null==r?void 0:r.getStatus(),succeededTime:(null===(i=r.getAttributes())||void 0===i?void 0:i.succeeded_time)??r.getCreatedTime(),customerPointer:null==r?void 0:r.getCustomerPointer(),listingId:null==r?void 0:r.getListingId(),acquisitionId:null==r||null===(n=r.getModel())||void 0===n?void 0:n.id}}),[t,e])}(T),{acquirerId:P,customerId:E}=function(e){let{customerPointer:t,acquisitionStatus:i,succeededTime:n,listingId:s}=e;const d=(0,r().O7)();return(0,o().VK)((()=>{var e,r;if(!t||"succeeded"!==i||!s||!n||(0,a().OB)(n))return{};const{currentUserSettingsStore:o}=c().default.state;if(null==o||!o.isDefined())return{};const u=o.getSettingsStore().getKeyStore("marketplace_review_nudge").getValue();if(Object.keys(u||{}).length>=p||(null===(e=(u||{})[s])||void 0===e?void 0:e.length)>=f)return{};const g=new(l().x)(d,t);return{acquirerId:null==g?void 0:g.getAcquirerId(),customerId:null==g||null===(r=g.getModel())||void 0===r?void 0:r.id}}),[d,t,i,s,n])}({customerPointer:C,acquisitionStatus:b,succeededTime:N,listingId:V}),O=function(e){let{currentUserId:t,listingId:i,customerId:r,acquirerId:s,version:a,lastEditedById:d,lastEditedTime:c,createdTime:u}=e;const l=(0,n.useRef)(Date.now());return(0,o().VK)((()=>{if(!(r&&s&&i&&a&&d&&c&&u))return!1;if(c<l.current)return!1;if(s!==t||d!==t)return!1;return!((c-u)/6e4<h)&&!(a<_)}),[t,i,r,s,a,d,c,u])}({currentUserId:i.currentUser.id,listingId:V,customerId:E,acquirerId:P,version:k,lastEditedById:R,lastEditedTime:S,createdTime:q}),{reviewId:B,isReady:K}=function(e){let{acquisitionId:t,listingId:i,customerId:o,shouldDisplayNudge:a}=e;const c=(0,r().O7)(),[u,l]=(0,n.useState)(),[g,w]=(0,s().UK)((async()=>{if(i&&o&&t){const e=await d().callApi({eventName:"getMarketplaceListingReviewForCustomer",environment:c,data:{listingId:i,customerId:o}});if("success"===e.type&&e.data.success){const{reviewId:i}=e.data;v().Z.setReviewId(t,i),l(i)}}}),[c,i,o,t]),m=Boolean(a&&i&&o&&t);return(0,n.useEffect)((()=>{m&&w()}),[m,w]),{reviewId:u,isReady:"resolved"===g.status}}({acquisitionId:M,listingId:V,customerId:E,shouldDisplayNudge:O}),{isReady:X,isComplete:D,rating:A}=(0,w().D)(B);return O&&K&&X&&!D&&!A&&M&&V?(0,I.jsx)(m().bv,{acquisitionId:M,listingId:V}):null}},451191:(e,t,i)=>{i.d(t,{bv:()=>a,g4:()=>o});var n=()=>i(677559);const r=new(n().Ss)("MaybeMarketplaceReviewNudge",(()=>i.e(83658).then(i.bind(i,297138)))),o=(0,n().kF)(r,(e=>e.MaybeMarketplaceReviewNudge)),s=new(n().Ss)("MarketplaceReviewNudge",(()=>Promise.all([i.e(55470),i.e(76317)]).then(i.bind(i,173885)))),a=(0,n().kF)(s,(e=>e.MarketplaceReviewNudge))},436037:(e,t,i)=>{i.d(t,{D:()=>u,Y:()=>c});var n=()=>i(219727),r=()=>i(142735),o=()=>i(924172),s=()=>i(567237),a=()=>i(826955),d=()=>i(367666);function c(e){return u((0,r().VK)((()=>d().Z.getReviewId(e)),[e]))}function u(e){const t=(0,n().O7)();return(0,r().VK)((()=>{if(e){const i=new(a().wP)(t,{table:s().ZI,id:e}),n=i.isReady(),r=i.getModel();return{isReady:n,isComplete:Boolean(r&&(0,o().AG)(r)),rating:i.getRating()}}return{isComplete:!1,isReady:!0}}),[t,e])}},367666:(e,t,i)=>{i.d(t,{Z:()=>o});const n={reviewIdCache:{},isOpen:!1,acquisitionId:"",stage:"rating",rating:0,source:void 0};class r extends(()=>i(263184))().default{getInitialState(){return{...n}}setReviewId(e,t){this.setState({...this.state,reviewIdCache:{...this.state.reviewIdCache,[e]:t}})}getReviewId(e){return this.state.reviewIdCache[e]}openModal(e){let{stage:t,acquisitionId:i,rating:r,source:o}=e;this.setState({...n,reviewIdCache:this.state.reviewIdCache,isOpen:!0,acquisitionId:i,stage:t,rating:r||0,source:o})}closeModal(){this.setState({...n,reviewIdCache:this.state.reviewIdCache})}updateState(e){this.setState({...this.state,...e})}}const o=new r},924172:(e,t,i)=>{i.d(t,{AG:()=>f,Gp:()=>p,Hs:()=>I,L8:()=>w,OB:()=>y,St:()=>l,d8:()=>d,n$:()=>k});var n=()=>i(696459),r=()=>i(575861),o=()=>i(431595),s=()=>i(567237);const a=15;function d(e){if(!s().ZK.includes(e))throw new(o().XV)("Rating must be an integer between 1 and 5.",{type:"marketplace_listing_review_invalid_rating"});return!0}const c=3,u=100;function l(e){if(e.length<c)throw new(o().XV)("Title too short",{type:"marketplace_listing_review_title_too_short"});if(e.length>u)throw new(o().XV)("Title too long",{type:"marketplace_listing_review_title_too_long"})}const g=50,v=1500;function w(e){if(e.length<g)throw new(o().XV)("Description too short",{type:"marketplace_listing_review_description_too_short"});if(e.length>v)throw new(o().XV)("Title too long",{type:"marketplace_listing_review_description_too_long"})}const m=40;function I(e){if(0===e.length)throw new(o().XV)("Name is required",{type:"marketplace_listing_review_name_too_short"});if(e.length>m)throw new(o().XV)("Name too long",{type:"marketplace_listing_review_name_too_long"})}const h=5,_=1500;function p(e){if(e.length<h)throw new(o().XV)("Creator response too short",{type:"marketplace_listing_review_creator_response_too_short"});if(e.length>_)throw new(o().XV)("Creator response too long",{type:"marketplace_listing_review_creator_response_too_long"})}function f(e){return void 0!==e.getTitle()&&void 0!==e.getSerializedContent()}function y(e){return(0,r().Je)(e)<a}function k(e){switch(e){case"mostRecent":return{columnName:"updated_time",direction:"descending"};case"highestRating":return{columnName:"rating",direction:"descending"};case"lowestRating":return{columnName:"rating",direction:"ascending"};default:(0,n().t1)(e)}}}}]);