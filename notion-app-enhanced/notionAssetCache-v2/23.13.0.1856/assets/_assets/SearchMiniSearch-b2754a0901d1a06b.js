"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[71704],{51820:(e,t,n)=>{n.d(t,{Z:()=>s});var r=()=>n(983946),o=()=>n(619013),i=()=>n(13882);function s(e,t){(0,i().Z)(2,arguments);var n=(0,o().Z)(e).getTime(),s=(0,r().Z)(t);return new Date(n+s)}},493843:(e,t,n)=>{n.d(t,{$o:()=>z,Fv:()=>N,IL:()=>$,J4:()=>U,KA:()=>D,Nf:()=>q,_p:()=>G,cQ:()=>Y,f$:()=>O,fX:()=>Z,j2:()=>L,k2:()=>W,mg:()=>Q,mz:()=>B,oP:()=>K,tF:()=>X,td:()=>j,x:()=>H});n(670560),n(267602),n(470928),n(30005),n(241792),n(228244);var r=()=>n(730120),o=()=>n(492788),i=()=>n(506347),s=()=>n(926724),a=()=>n(331540),c=()=>n(874459),l=()=>n(998411),u=()=>n(35980),d=()=>n(513670),p=()=>n(696459),m=()=>n(250303),f=()=>n(384667),h=()=>n(366257),y=()=>n(139224),v=()=>n(421654),g=()=>n(636340),S=()=>n(531515),_=()=>n(47443),b=()=>n(794586),I=()=>n(879952),x=()=>n(970105),R=()=>n(990966),C=()=>n(269299),T=()=>n(932753),k=()=>n(887430),w=()=>n(861026),M=()=>n(804217),P=()=>n(826955),A=()=>n(965903),E=()=>n(807230),V=()=>n(701182),F=()=>n(645843);function L(e){const{collectionViewStore:t,collectionContextStore:n,timelineState:r,environment:o}=e,i=o.currentUser.id,s=(0,V().B8)(t.id),a=(0,V().pQ)(t,o),c=n.permissionScopesStore.state,l=d().Ds((()=>{if(r.destroyed)return;const e={zoomLevel:r.zoomLevel.state,centerTimestamp:(0,V().al)(r)};u().Z.set({userId:i,key:s,value:e})}),1e3),p=d().Ds((()=>{if(r.destroyed||!M().default.state.online||!o.currentUser.isLoggedIn()||!c.canConfigureBlock)return;const e={zoomLevel:r.zoomLevel.state,centerTimestamp:(0,V().al)(r)},n=t.getFormat().timeline_preference;d().Xy(n,e)||C().createAndCommit({userAction:"collectionTimelineViewActions.setRemotePreference",environment:o,canUndo:!0,perform:n=>{v().FH({stores:[t],update:{timeline_preference:e},transaction:n})}})}),5e3);r.savePreference=()=>{l(),p()},q({timelineState:r,environment:o,...a})}function q(e){const{timelineState:t,zoomLevel:n,centerTimestamp:r,environment:i}=e,{savePreference:s}=t,a=i.WindowSizeStore.state.width+2*V().Ge,c=(0,V().x2)(n,a),l=r-c/2,u=r+c/2;t.zoomLevel.setState(n),t.currentRange.setState({startTimestamp:l,endTimestamp:u}),o().default.afterNextFlush((()=>{D({timelineState:t,centerTimestamp:r}),s&&s()}))}function D(e){const{timelineState:t,centerTimestamp:n}=e,{horizontalScroller:r,outerSizeObserver:o}=t;if(!r)return;const i=t.zoomLevel.state,{startTimestamp:s,endTimestamp:a}=t.currentRange.state,c=o.rect.state.width;if(c===(0,V().e$)(i,a-s))return;const l=(0,V().e$)(i,n-s)-c/2;r.scrollLeft=l,t.scrollLeft.setState(l)}function K(e){const{environment:t,store:n,query:r,date:o,schema:i,transaction:s}=e,{timeline_by:a}=r;if(!a)return;const c=n.getAssociatedCollectionStore(),l=(null==c?void 0:c.getMappedProperty(a))??a,u=r.timeline_by_end?(null==c?void 0:c.getMappedProperty(r.timeline_by_end))??r.timeline_by_end:void 0,d=(0,V().TW)({store:n,dateValue:o,query:r,schema:(null==c?void 0:c.getSchema())??i}),p=n.getPropertyValue(l),m=u?n.getPropertyValue(u):void 0;return g().sW({store:n.getPropertiesStore(),data:d,transaction:s}),h().H({environment:t,store:n,dateProperty:{id:l,newValue:(null==d?void 0:d[l])??[],oldValue:p},otherDateProperty:u?{id:u,newValue:(null==d?void 0:d[u])??[],oldValue:m}:void 0}),n}function N(e){var t;const{environment:n,timelineState:o,collectionStore:i,collectionContextStore:s,store:a,query:u,groupFormat:d,transaction:p}=e,m=o.zoomLevel.state,h=(0,V().al)(o),{snapUnit:y,getDateRangePlaceholderDuration:v}=V().BJ[m],{timeline_by:g}=u;if(!g)return;const S=null===(t=s.groupsStore.getGroupState(d))||void 0===t?void 0:t.resultsStore.state;if(!S)return;const _=r().ou.fromMillis(h),b=(0,V().DS)(_,y),I=(0,V().DS)(v(_),y),x=(0,V().AZ)({startValue:(0,c().Lg)((0,l().r)()),snapUnit:y,desiredStart:b,desiredEnd:I});return K({environment:n,store:a,query:u,schema:i.getSchema(),date:x,transaction:p}),f().$T({environment:n,collectionStore:i,before:!0,store:S[0],insertStores:[a],collectionContextStore:s,groupsPointer:d?[d]:[],transaction:p}),a}function O(e){const{type:t,timelineState:n,store:r,startX:o,query:i,schema:s,intl:a,environment:c}=e,{horizontalScroller:l}=n,{startTimestamp:u}=n.currentRange.state;if(!l)return;I().Ys({environment:c,store:r});const p=l.scrollLeft,{stores:m}=A().default.state,f=d().oA(m.map((e=>{const t=(0,V().bk)({store:e,query:i,schema:s,userId:c.currentUser.id,intl:a,formulasModule:void 0});if(t)return{startValue:t,store:e}})));n.dragState.setState({type:t,startStore:r,stores:f.map((e=>{let{store:t}=e;return t})),startValues:f.map((e=>{let{startValue:t}=e;return t})),temporaryValues:f.map((e=>{let{startValue:t}=e;return t})),startX:o,startStartTimestamp:u,startScrollLeft:p})}function U(e){const{timelineState:t,store:n,startX:r,startY:o,schema:i,collectionContextStore:s,verticalScroller:a}=e,{horizontalScroller:c}=t,{startTimestamp:l}=t.currentRange.state;if(!c||!a)return;const u=c.scrollLeft,d=a.scrollTop,p=(0,V().YE)(s,n,i);t.drawState.setState({startStore:n,startDependencyRelationPointers:p,temporaryDependencyRelationPointers:[...p],startX:r,startY:o,startScrollLeft:u,startScrollTop:d,startStartTimestamp:l,xOffsetPx:0,yOffsetPx:0,tryToCompleteDrawnArrow:!1})}function j(e){const{timelineState:t,currentX:n}=e,{horizontalScroller:r}=t,o=t.zoomLevel.state,i=t.dragState.state,{startTimestamp:s}=t.currentRange.state;if(!i||!r)return;const{type:a,startStartTimestamp:l,startValues:u,startScrollLeft:m,startX:f,startStore:h,stores:y}=i,v=V().BJ[o],{snapUnit:g}=v,S=r.scrollLeft-m+(n-f)+(0,V().e$)(o,s-l),_=(0,V().x2)(o,S),b=u[y.indexOf(h)];let I;if(a===V().px.LeftResizer){const{start:e}=(0,V().XO)(b,g),t=e.plus(_);I=u.map((e=>{const n=(0,V().AZ)({startValue:e,snapUnit:g,desiredStart:t});return(0,c().gW)(n)}))}else if(a===V().px.RightResizer){const{end:e}=(0,V().XO)(b,g),t=e.plus(_);I=u.map((e=>{const n=(0,V().AZ)({startValue:e,snapUnit:g,desiredEnd:t});return(0,c().Qq)(n)}))}else a===V().px.ItemDrag?I=u.map((e=>{const{start:t,end:n}=(0,V().XO)(e,g),r=t.plus(_),o=r.plus(n.valueOf()-t.valueOf());return(0,V().AZ)({startValue:e,snapUnit:g,desiredStart:r,desiredEnd:o})})):(0,p().t1)(a);d().Xy(i.temporaryValues,I)||t.dragState.setState({...i,temporaryValues:I})}function B(e){const{timelineState:t,currentX:n,currentY:r,verticalScroller:o}=e,i=t.drawState.state,s=t.zoomLevel.state,{startTimestamp:a}=t.currentRange.state,{horizontalScroller:c}=t;if(!i||!c||!o)return;const{startDependencyRelationPointers:l,startStore:u,startX:p,startY:m,startScrollLeft:f,startScrollTop:h,startStartTimestamp:y}=i,v=c.scrollLeft,g=o.scrollTop,S=v-f+(n-p)+(0,V().e$)(s,a-y),_=g-h+(r-m),b=t.hoveredItem.state;if(b&&b!==u&&!l.some((e=>e.id===b.id))){const e=[...l,{table:"block",id:b.id,spaceId:b.getSpaceId()}];d().Xy(i.temporaryDependencyRelationPointers,e)||t.drawState.setState({...i,temporaryDependencyRelationPointers:e,xOffsetPx:void 0,yOffsetPx:void 0})}else t.drawState.setState({...i,temporaryDependencyRelationPointers:[...l],xOffsetPx:S,yOffsetPx:_})}function Z(e){const{environment:t,collectionContextStore:n,timelineState:r,query:o,schema:i,transaction:s}=e,a=r.dragState.state,{timeline_by:c}=o;if(!a||!c)return;const{temporaryValues:l,stores:u}=a;l.forEach(((e,r)=>{const a=u[r];K({environment:t,store:a,query:o,schema:i,transaction:s,date:e}),m().rv({environment:t,collectionContextStore:n,block_id:a.id,property:c,property_type:"date",from:"timeline"})})),r.dragState.setState(void 0)}function z(e){var t;const{timelineState:n,environment:r,transaction:o,collectionContextStore:i,isFullScreen:s,isRootChild:a}=e,c=n.drawState.state,l=n.dateRangePlaceholder.state;if(!c)return;const{startStore:u,startDependencyRelationPointers:d,temporaryDependencyRelationPointers:p}=c;if(!u)return void n.drawState.setState(void 0);let f;if(l.active){const{date:e,store:t,parentStore:s,groupFormat:a,newTimelineItemProps:c,existingTimelineItemProps:d}=l;if(t&&d){const{query:n,schema:i}=d;K({environment:r,store:t,query:n,schema:i,date:e,transaction:o}),f={table:"block",id:t.id,spaceId:u.getSpaceId()}}else if(c){const{query:n,schema:l,isFullScreen:d,canEditTimelineItems:p,subitemPath:m}=c,h=Q({environment:r,date:e,store:t,parentStore:s,query:n,schema:l,isFullScreen:d,groupFormat:a,canEditTimelineItems:p,collectionContextStore:i,subitemPath:m,transaction:o,from:"timeline_complete_draw"});h&&(f={table:"block",id:h.id,spaceId:u.getSpaceId()})}n.dateRangePlaceholder.setState({active:!1})}else f=p.find((e=>!d.includes(e)));const h=(0,V()._e)(i);if(h){const{property:e}=h;f&&(S().hE({environment:r,propertyWithInverse:h,sourceStore:u,destStore:P().G.createChildStore(u,f),position:{type:"after"},transaction:o}),m().rv({environment:r,collectionContextStore:i,block_id:u.id,property:e,property_type:"relation",from:"timeline",isFromBulkActionsToolbar:!1,isUnthrottled:!0})),n.drawState.setState(void 0)}else y().wl({item:{type:"dependencies",from:"view_options"},collectionSettingsStore:i.settingsStore}),n.drawState.setState({...c,tryToCompleteDrawnArrow:!0});const v=null===(t=f)||void 0===t?void 0:t.id;v&&(0,F().LE)(r,{...(0,w().Pn)(i),...(0,F().Ii)({environment:r,collectionContextStore:i,timelineState:n,isFullScreen:s,isRootChild:a}),dependenciesPropertyID:null==h?void 0:h.property,blockedByStoreID:u.id,blockingStoreID:v})}function Y(e){const{timelineState:t,environment:n}=e;t.dragState.state&&(t.dragState.setState(void 0),I().ZH({environment:n}))}function H(e){const{timelineState:t,environment:n}=e;t.drawState.state&&(t.drawState.setState(void 0),I().ZH({environment:n}))}function W(e){const{stores:t,collectionViewStore:n,schema:r,transaction:o}=e,i=n.getType(),s=n.getQuery(r),a=[];s&&("calendar"===i?s.calendar_by&&a.push(s.calendar_by):"timeline"===i&&(s.timeline_by&&a.push(s.timeline_by),s.timeline_by_end&&a.push(s.timeline_by_end)));for(const c of t)for(const e of a)x().sO({environment:c.environment,store:c.getPropertyStore(e),value:void 0,transaction:o})}function $(e){const{dependency:t,collectionContextStore:n,environment:r,timelineState:o,isFullScreen:i,isRootChild:s}=e,a=(0,V()._e)(n),c=n.collectionStore();if(!a||!c)return;const{property:l}=a,{store:u,relationPointer:d}=t,p=u.getSchema()[l];p&&"relation"===p.type&&(C().createAndCommit({userAction:"CollectionTimelineDependenciesOverlay.handleRemoveRelation",environment:r,canUndo:!0,perform:e=>{S().Bl({environment:r,propertyWithInverse:a,sourceStore:u,destStore:P().G.createChildStore(u,d),transaction:e}),m().rv({environment:r,block_id:d.id,property:l,property_type:p.type,from:"timeline",collectionContextStore:n,isFromBulkActionsToolbar:!1,isUnthrottled:!0})}}),(0,F().lf)(r,{...(0,w().Pn)(n),...(0,F().Ii)({environment:r,collectionContextStore:n,timelineState:o,isFullScreen:i,isRootChild:s}),dependenciesPropertyID:l,blockedByStoreID:u.id,blockingStoreID:d.id}))}function X(e){const{collectionViewStore:t,newProperty:n,transaction:r}=e;v().FH({stores:[t],update:{timeline_arrows_by:{property:n}},transaction:r})}function G(e){var t;const{collectionContextStore:n,relationPropertyId:r,transaction:o}=e,i=n.collectionStore();if(!i)return;const c=r?i.getSchema()[r]:void 0,l="relation"===(null==c?void 0:c.type)&&c.property&&"relation"===(null===(t=i.getSchema()[c.property])||void 0===t?void 0:t.type)?c.property:void 0;v().FH({stores:[i],update:{collection_default_arrows_by:r,...i.getFormat().app_config_uri===a().iS?{app_uri_map:{...i.getFormat().app_uri_map?i.getFormat().app_uri_map:{},[s().Es.BlockingRelation]:r,[s().Es.BlockedRelation]:l}}:{}},transaction:o})}function Q(e){const{environment:t,transaction:n,date:r,parentStore:o,query:s,schema:a,isFullScreen:c,groupFormat:l,canEditTimelineItems:u,collectionContextStore:d,from:p}=e;if(!(0,E().ww)(t))return;const m=l?[l]:[],h=d.groupsStore.getGroupState(m);if(!h)return;if(o)return function(e){const{environment:t,transaction:n,date:r,store:o,parentStore:s,query:a,schema:c,groupFormat:l,canEditTimelineItems:u,collectionContextStore:d,subitemPath:p}=e;if(!o||!s)return;const m=l?[l]:[],h=f().yk({environment:t,collectionContextStore:d,groupsPointer:m,store:o,before:!1,collectionStore:s,transaction:n,subitemPath:p,subitemInsertDirection:"into"});if(h){if(K({environment:t,store:h,query:a,schema:c,date:r,transaction:n}),t.device.isMobile)_()._c({environment:t,store:h,pageVisitSource:i().tY.Create});else if(h&&u){const e=h.getBlockTitleStore();R().setSelectionAtStart({store:e})}return h}}(e);d.searchQueryStore.state&&T().Ug({searchQuery:"",collectionContextStore:d,isFullScreen:c});const y=f().IW({environment:t,collectionContextStore:d,groupsPointer:m,shouldCoerce:!0,templateStore:d.defaultPageTemplateStore.state,transaction:n,from:{createBlock:p},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache});if(!y)return;const v=y.coercionSucceeded,g=y.newStore;if(K({environment:t,store:g,query:s,schema:a,date:r,transaction:n}),t.device.isMobile)_()._c({environment:t,store:g,pageVisitSource:i().tY.Create});else if(v&&u){const e=g.getBlockTitleStore();R().setSelectionAtEnd({store:e})}else b().CH({environment:t,store:g,peekMode:(0,k().kr)(d),resultsStore:null==h?void 0:h.resultsStore,collectionContextStore:d,pageVisitSource:i().tY.Create});return g}},645843:(e,t,n)=>{n.d(t,{Al:()=>c,CB:()=>l,H6:()=>a,Ii:()=>f,LE:()=>p,gw:()=>u,iR:()=>i,lf:()=>m,ne:()=>d,zI:()=>s});n(267602),n(653476);var r=()=>n(594546),o=()=>n(701182);function i(e,t){r().lu(e,"timeline_view","timeline_view",5,t)}function s(e,t){r().K4(e,"timeline_zoom_level_update",t)}function a(e,t){r().K4(e,"timeline_today_click",t)}function c(e,t){r().K4(e,"timeline_shift_time_click",t)}function l(e,t){r().K4(e,"timeline_toggle_table_click",t)}function u(e,t){r().K4(e,"timeline_item_scroll_arrow_click",t)}function d(e,t){r().K4(e,"timeline_item_resize",t)}function p(e,t){r().K4(e,"timeline_dependency_arrow_add",t)}function m(e,t){r().K4(e,"timeline_dependency_arrow_delete",t)}function f(e){const{environment:t,collectionContextStore:n,timelineState:r,isFullScreen:i,isRootChild:s}=e,a=r.zoomLevel.state,c=n.normalizedFormatStore.state,l=(0,o().C1)({environment:t,format:c,isFullScreen:i,isRootChild:s}),u=l&&c.timeline_table_properties?c.timeline_table_properties.length:0,d=c.timeline_properties||[],p=d.filter((e=>"title"!==e.property));return{zoom_level:a,show_table:l,show_table_properties_count:u,show_timeline_title:d.length!==p.length,show_timeline_properties_count:p.length}}},887330:(e,t,n)=>{n.d(t,{C:()=>o,L:()=>i});var r=()=>n(707513);function o(e){const{theme:t,isInHomeWidget:n}=e;return{display:"flex",alignItems:"center",fontSize:14,padding:6,...n?{height:24,width:24,color:t.lightTextColor,fill:t.lightIconColor}:{height:28,width:28,color:t.mediumIconColor,fill:t.mediumIconColor},fontWeight:r().Ue.regular,lineHeight:1,borderRadius:6}}function i(e){const{theme:t}=e;return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:t.mediumIconColor,fontWeight:r().Ue.regular,lineHeight:1,borderRadius:4}}},233032:(e,t,n)=>{n.r(t),n.d(t,{default:()=>We});n(670560),n(122556),n(582845),n(250570),n(533019),n(721473),n(788208),n(22624),n(267602),n(916054),n(653476),n(30005),n(241792),n(228244);var r=()=>n(983946),o=()=>n(51820),i=()=>n(13882),s=6e4;var a=n(667294),c=()=>n(219727),l=()=>n(142735),u=()=>n(846550),d=()=>n(506347),p=()=>n(135857),m=()=>n(998411),f=()=>n(565630),h=()=>n(801812),y=()=>n(741633),v=()=>n(375255),g=()=>n(196442),S=()=>n(899133),_=()=>n(467171),b=()=>n(788860),I=()=>n(513670),x=()=>n(707513),R=()=>n(824462),C=()=>n(231077),T=()=>n(67338),k=()=>n(718959),w=()=>n(250625),M=()=>n(15981),P=()=>n(750858),A=()=>n(358565),E=()=>n(766463),V=()=>n(370590),F=()=>n(183922),L=()=>n(696459),q=()=>n(957042),D=()=>n(635596),K=()=>n(749826);const N=50;class O extends(()=>n(263184))().default{getInitialState(){return{pageIdToUsers:{},similarUserIdToLastVisitedPageId:{}}}getPageIdToActiveSimilarUsersCount(){const e={};for(const[t,n]of(0,L().qP)(this.state.pageIdToUsers))e[t]=(null==n?void 0:n.length)??0;return e}}const U=new O;var j=()=>n(615389),B=()=>n(863606);const Z=6e4;function z(){const e=(0,c().O7)(),t=e.currentUser.id,n=(0,l().VK)((()=>{K().default.checkGate({gateName:"similar_user_page_presence_store"});return!1}),[]),r=(0,l().VK)((()=>{if(!n)return[];const e=j().O.state;if(!e)return[];return(0,L().qP)(e).sort(((e,t)=>{let[n,r]=e,[o,i]=t;return i-r})).slice(0,N).map((e=>{let[t]=e;return t}))}),[t,n]),o=(0,a.useCallback)(((e,t)=>{const n=function(e){if(!e||"object"!=typeof e||!("userPageVisit"in e)||!function(e){const t=(0,q().Gu)(V().mI,e);return void 0===t}(e.userPageVisit))return;return e.userPageVisit}(t);if(!n)return;const r=e.split("/")[1],{visitedAt:o,blockId:i}=n,s={userId:r,visitedAt:o};U.update((e=>{var t;const n=(0,I().oA)(null===(t=e.pageIdToUsers[i])||void 0===t?void 0:t.filter((e=>e.userId!==r)));return{...e,similarUserIdToLastVisitedPageId:{...e.similarUserIdToLastVisitedPageId,[r]:i},pageIdToUsers:{...e.pageIdToUsers,[i]:[s,...n]}}}))}),[]);(0,a.useEffect)((()=>{if(!n)return;const t=r.map((t=>D().ZP.addListener((0,F().Ns)(t),o,void 0,e)));return()=>{t.forEach((t=>{t&&D().ZP.removeListener(t,e)}))}}),[e,o,n,r]),(0,B().W)((()=>{U.update((e=>{const t={...e};for(const[n,r]of(0,L().qP)(t.pageIdToUsers)){const e=null==r?void 0:r.filter((e=>{const n=Y({timestamp:{timestamp:e.visitedAt}.timestamp,numberOfMinutes:10});return n&&delete t.similarUserIdToLastVisitedPageId[e.userId],!n}));0===(null==e?void 0:e.length)?delete t.pageIdToUsers[n]:t.pageIdToUsers[n]=e}return t}))}),Z,n)}function Y(e){return Date.now()-e.timestamp>=e.numberOfMinutes*Z}var H=()=>n(842595),W=()=>n(277616),$=()=>n(813313),X=n(785893);const G=(0,n(827282).IU)("speechBubble",{viewBox:"0 0 16 16",svg:(0,X.jsx)("path",{d:"M4.32 15.424c.39 0 .677-.192 1.149-.609l2.344-2.064h4.116c2.057 0 3.213-1.19 3.213-3.22V4.22c0-2.03-1.156-3.22-3.213-3.22H3.213C1.163 1 0 2.19 0 4.22V9.53c0 2.037 1.196 3.22 3.165 3.22h.28v1.675c0 .608.322.998.875.998zm.342-1.531v-1.949c0-.403-.178-.56-.56-.56H3.26c-1.285 0-1.9-.65-1.9-1.894V4.26c0-1.243.615-1.893 1.9-1.893h8.627c1.278 0 1.893.65 1.893 1.894v5.23c0 1.243-.615 1.893-1.893 1.893h-4.15c-.417 0-.622.068-.909.369l-2.167 2.14z"})});var Q=()=>n(944039),J=()=>n(156045),ee=()=>n(115129),te=()=>n(787306),ne=()=>n(546155),re=()=>n(998901),oe=()=>n(520849),ie=()=>n(876822),se=()=>n(379072),ae=()=>n(255810),ce=()=>n(692304),le=()=>n(147542),ue=()=>n(127519),de=(n(470928),()=>n(903057)),pe=()=>n(955620),me=()=>n(770844),fe=()=>n(236692),he=()=>n(789168),ye=()=>n(726143);const ve={dateRangeFilter:{everything:!0},createdByFilter:{everything:!1,notion:!0}};function ge(e,t){return Boolean(ve[t][e]||ve[t].everything)}async function Se(e){var t;const{environment:n,menuListItemAction:r,query:o,isNewElectronTab:i,assistantConfigurationStoreState:s,searchSessionId:a,surface:c}=e;le().Z.update((e=>({...e,isOpen:!1})));const l=i?(0,w().DJ)(null==r?void 0:r.event)||"tab":(0,w().DJ)(null==r?void 0:r.event);(0,he().openFullPageChat)({environment:n,primeTextInput:o,shouldFocusInput:!1,openInNew:l,deepFindRequestedForNewTabOrWindow:!0,query:o,from:"search"});const u=(null==s?void 0:s.searchScope)??de().Q,d=(0,pe().TPx)(o);let p=await async function(e){var t,n;const{searchScope:r,environment:o,assistantSurface:i,query:s}=e,a=null===(t=se().default.getActiveSession())||void 0===t?void 0:t.clientSteps.find((e=>"human"===e.type)),{sessionId:c}=await(0,me().resetAndInitializeAssistantSession)({environment:o,deepFindRequested:!0}),l=se().default.getSessionContext(c);if(!l)return;const u=s&&(0,pe().QaF)(s).trim().length>0?s:void 0,d=ge(r.type,"createdByFilter"),p=ge(r.type,"dateRangeFilter"),m={...r,...d?{}:{createdByFilter:void 0},...p?{}:{dateRangeFilter:void 0}};null===(n=e.setSelectedSearchScope)||void 0===n||n.call(e,m),l.assistantConfigurationStore.setSearchScope(m);const f=u??(null==a?void 0:a.text);if(!f)return;return await(0,me().commitHumanStep)({environment:o,sessionId:c,text:f,assistantSurfaceType:i.type}),c}({environment:n,assistantSurface:ye().FP.fullPage,searchScope:u,query:d});if("deep_dive"===c)return;p||(p=se().default.getActiveSessionId()??se().default.getNextSessionId());const m=(null===(t=se().default.getSessionContext(p))||void 0===t?void 0:t.evaluator.getTranscript())??[];(0,fe().trackAssistantOpened)(n,{hasQuery:!0,from:"search",searchSessionId:a,isReminder:!1,reminderType:void 0,sessionId:p,startTimestamp:(null==s?void 0:s.sessionStartTimestamp)||Date.now(),transcript:m})}var _e=()=>n(827973),be=()=>n(78078),Ie=()=>n(206352),xe=()=>n(291198),Re=()=>n(94967),Ce=()=>n(255577),Te=()=>n(708518),ke=()=>n(92175),we=()=>n(967092),Me=()=>n(679063),Pe=()=>n(842574),Ae=()=>n(906769),Ee=()=>n(388284),Ve=()=>n(627990),Fe=()=>n(259878),Le=()=>n(821671),qe=()=>n(648776);const De=7,Ke=20;function Ne(){const e=(0,c().O7)(),t=(0,b().YB)(),n=(0,l().VK)((()=>ie().default.state.currentSpaceViewStore),[]),x=(0,l().Kw)(le().Z);z();const V=(0,l().VK)((()=>{const e=ie().default.state.currentSpaceStore;if("deep_dive"!==x.surface||!e)return;const n=x.store.getValue();return(0,v().Xh)({textValue:n,getRecordModel:e.getRecordModel,userTimeZone:(0,m().r)(),intl:t})}),[x,t]),F=(0,l().VK)((()=>"deep_dive"===x.surface?(null==V?void 0:V.trim())??"":x.query.trim()),[x,V]);(0,a.useEffect)((()=>{x.isOpen&&le().Z.update((e=>({...e,openedTimeMs:Date.now()})))}),[x.isOpen]);const L=(0,ee().P)();(0,h().r5)((async()=>{if(!L.botId)return;const t="two_days",r=(0,te().$X)(t);await(0,Q().YZ)({environment:e,currentSpaceViewStore:n,forceRefetch:!1,reason:"background_load",botId:L.botId,timeRange:{key:t,...r}})}),[L.botId,n,e]);const q=(0,l().VK)((()=>"on"===K().default.getEligibleGroup({experimentId:"search_quickfind_prefetch"})),[]),D=0===F.length,{results:N,searchSessionId:O,searchSessionFlowNumber:U,isResultsLoading:j,searchAnalytics:Z}=(0,E().s)({searchQuery:F,limit:De,source:q?"mini_quick_find_prefetch":"mini_quick_find",type:S().n8.BlocksInSpace,disable:D,isLocalOnlyMode:!0,overrideSearchSessionId:x.sessionId,usePrefetch:q}),[Y,H]=(0,a.useState)("recents"),G=(0,f().D9)(Y),de=(0,a.useMemo)((()=>(0,g().A7)({searchSessionId:O,searchSessionFlowNumber:U})),[O,U]),pe=(0,l().VK)((()=>x.isNewElectronTab),[x.isNewElectronTab],{debugName:"MiniSearch.isNewElectronTab"}),me=(0,l().VK)((()=>ae().default.state.tabs),[],{debugName:"MiniSearch.electronTabs"}),fe=(0,l().VK)((()=>{if(0===F.length)return[];return(0,A().GQ)({query:F,environment:e,searchMode:"nav-local-only"})??[]}),[e,F],{debugName:"MiniSearch.matchingActions"}),he=(0,a.useCallback)((e=>{var t;const n=null===(t=le().Z.state.previousTextSelection)||void 0===t?void 0:t.multiSelection;le().Z.update((t=>({...t,isOpen:!1,query:e.shouldResetQuery?"":F,isNewElectronTab:!1,openedTimeMs:e.shouldResetMetricsState?void 0:t.openedTimeMs,sessionId:e.shouldResetMetricsState?void 0:t.sessionId,previousTextSelection:void 0}))),$e(!1),Be(!1),Ne(Ke),n&&"editing"!==ue().default.state.mode&&ue().default.setState({forceExtendAnnotations:{},mode:"editing",multiSelection:n})}),[F]),ye=(0,a.useCallback)((t=>(0,Le().V)({environment:e,result:t,action:()=>he({shouldResetQuery:!0,shouldResetMetricsState:!1}),queryId:de,isMiniSearch:!0,desktopProps:{electronTabs:me,isNewElectronTabSearch:Boolean(pe)}})),[he,me,e,pe,de]),ve=(0,a.useMemo)((()=>{const e=[];return fe.forEach((t=>{const{eventName:n}=t;"full_search"!==n&&"full_search_deep_dive"!==n&&"deep_dive"!==n&&e.push(ye(t))})),e}),[ye,fe]),ge=(0,l().VK)((()=>"default"===x.surface&&"center"===x.position),[x]),_e=function(){const e=(0,c().O7)(),[t,n]=(0,a.useState)([]),u=(0,l().VK)((()=>ne().Z.getEvents()),[]),d=(0,l().VK)((()=>ie().default.state.currentSpaceStore),[]),p=(0,a.useCallback)((()=>{const e=Date.now();if(!d)return[];const t=u.filter((t=>{var n;if(t.isAllDay||"declined"===t.responseStatus)return!1;const a=function(e,t){(0,i().Z)(2,arguments);var n=(0,r().Z)(t);return(0,o().Z)(e,n*s)}(new Date(t.end.dateTime),5);return((null===(n=t.attachments)||void 0===n?void 0:n.length)??0)>0&&a.getTime()>=e}));return t}),[d,u]);(0,B().W)((()=>{const e=p(),r=e.map((e=>e.id)),o=t.map((e=>e.id));(0,I().e5)(r,o).length>0&&n(e)}),12e4,!0);const m=2,f=(0,l().VK)((()=>{const n=[];for(const r of t){const{attachments:t}=r;if(n.length===m)break;const o=(0,I().oA)(null==t?void 0:t.map((t=>{const n=t.fileUrl;return(0,J().G)({environment:e,fileUrl:n,currentSpaceStore:d})}))),i=o.length>0?o[0]:void 0;i&&!n.includes(i)&&n.push(i)}return n}),[t,e,d]);return f}(),be=(0,l().VK)((()=>(0,k().np)()),[]),ke=(0,l().VK)((()=>ie().default.state.currentSpaceStore),[]),Me=(0,l().VK)((()=>null==ke?void 0:ke.id),[null==ke?void 0:ke.id]),[Fe,Ne]=(0,a.useState)(Ke),[Ue,Be]=(0,a.useState)(!1),[We,$e]=(0,a.useState)(!1),Xe=(0,l().VK)((()=>M().X4.state.filter((e=>e.pageId!==(null==be?void 0:be.id)&&!_e.some((t=>t.id===e.pageId)))).slice(0,Fe-_e.length)),[null==be?void 0:be.id,Fe,_e]),Ge=(0,a.useCallback)((t=>{Me&&(0,qe().nl)({environment:e,offsetFromBottom:t,spaceId:Me,setIsLoadingRecents:Be,setEndOfRecentsReached:$e,numRecents:Fe,setNumRecents:Ne,endOfRecentsReached:We,isLoadingRecents:Ue,incrementBy:Ke})}),[We,e,Ue,Fe,Me]),Qe=d().tY.MiniQuickFind,Je=(0,a.useMemo)((()=>"results"===Y?"query_results":"recent_pages"),[Y]),et=(0,l().VK)((()=>e.device.isElectron),[e]),tt=(0,l().VK)((()=>(0,P().b)(e)),[e]),nt=(0,a.useCallback)((t=>{const n=t.store;return{action:r=>{let{event:o}=r;const i=(0,w().DJ)(o);if(Z.trackSelectSearchItem({result:t,isMetaClick:Boolean(i),context:Je}),i||he({shouldResetQuery:!0,shouldResetMetricsState:!1}),et&&tt){const e=(0,p().Z)({pageModel:n.getModel(),pageId:n.id,pageVisitSource:Qe,queryId:de});C().openQuickSearchResult(e)}else T().PR({searchResult:{type:"custom",store:n},environment:e,pageVisitSource:Qe,queryId:de,openInNew:i,electronTabSearch:{tabs:me,isNewTab:Boolean(pe)},context:Je})},key:n.id,render:e=>(0,X.jsx)(je,{...e,store:n,currentView:Y})}}),[he,Je,me,e,tt,et,pe,Qe,Z,de,Y]),rt=(0,l().VK)((()=>N.map((e=>nt(e)))),[nt,N],{debugName:"MiniSearch.resultItems"}),ot=(0,l().VK)((()=>{const e=new Map;return Xe.forEach(((t,n)=>{const r=(0,M()._5)(t.visitedAt),o=Oe({blockStore:t.store,idx:n,resultFeatureNames:["RECENT_ALIVE_PAGES"]}),i=nt(o);var s;e.has(r)?null===(s=e.get(r))||void 0===s||s.push(i):e.set(r,[i])})),e}),[nt,Xe],{debugName:"MiniSearch.resultsByBucket"}),it=(0,a.useMemo)((()=>{const e=[...ve,...rt];if(0!==e.length)return{items:e,key:"results",render:e=>(0,X.jsx)(Ee().Z,{...e,title:t.formatMessage(Ye.quickMatchesSectionTitle)})}}),[t,ve,rt]),st=(0,l().VK)((()=>{var e;return null===(e=se().default.getActiveSession())||void 0===e?void 0:e.assistantConfigurationStore.state}),[],{debugName:"MiniSearch.assistantConfigurationStoreState"}),at=(0,a.useCallback)((t=>Se({environment:e,menuListItemAction:t.menuListItemAction,query:F,isNewElectronTab:pe,assistantConfigurationStoreState:st,searchSessionId:O,surface:x.surface})),[st,e,pe,x.surface,F,O]),ct=(0,l().VK)((()=>{const e=function(e){const{query:t,onClick:n}=e;return{action:e=>n(e),key:"deep-find-entry-point",render:e=>(0,X.jsx)(ze,{menuListProps:e,query:t})}}({query:F,onClick:e=>at({menuListItemAction:e})});return{items:[e],key:"search",render:e=>(0,X.jsx)(Ee().Z,{...e})}}),[at,F]),lt=(0,a.useMemo)((()=>{if(pe)return(0,qe().De)({environment:e,intl:t,electronTabs:me,isNewElectronTab:pe})}),[e,t,pe,me]),ut=(0,l().VK)((()=>{const e=[];if(lt&&e.push({items:[lt],key:"new-page",render:e=>(0,X.jsx)(Ee().Z,{...e})}),_e.length>0){const n=_e.map(((e,t)=>Oe({blockStore:e,idx:t,resultFeatureNames:["UPCOMING_MEETING_ATTACHMENTS"]})));e.push({items:n.map(nt),key:"upcoming-meeting-attachments",render:e=>(0,X.jsx)(Ee().Z,{...e,title:t.formatMessage(Ye.fromCalendarEvents)})})}return M()._k.forEach((t=>{const n=ot.get(t);n&&0!==n.length&&e.push({items:n,key:`recent-pages-${t}`,render:e=>(0,X.jsx)(Ee().Z,{...e,title:(0,X.jsx)(qe().Kg,{bucket:t})})})})),e}),[nt,t,lt,_e,ot]),dt=(0,a.useMemo)((()=>{const e=[ct];return it&&e.push(it),e}),[it,ct]),pt=(0,a.useMemo)((()=>new(ce().Z)),[]),mt=(0,a.useCallback)((e=>{pt.setState({focus:{section:e.section??0,indexLocal:e.indexLocal,indexGlobal:e.indexGlobal,footerFocused:!1}})}),[pt]),ft=j&&"recents"===G&&!D;(0,a.useEffect)((()=>{D||ft?H("recents"):j||H("results"),mt({indexLocal:0,indexGlobal:0,section:0})}),[mt,D,j,ft]),(0,a.useEffect)((()=>{x.isOpen&&Me&&(R().callApi({eventName:"warmSearchCache",environment:e,data:{spaceId:Me}}),R().callApi({eventName:"warmVectorDBCache",environment:e,data:{spaceId:Me},headers:(0,y().Bb)({spaceId:Me})}))}),[x.isOpen,e,Me]);const ht=(0,a.useCallback)((e=>{const t=e.trim();0===t.length&&H("recents"),le().Z.update((e=>({...e,query:t})))}),[]),yt=F.length>0&&"default"===x.surface&&0===N.length&&!ft&&0===ve.length&&"results"===Y,vt=function(e){const{shouldUseCenterModal:t,isElectron:n,shouldShowEmptyState:r}=e,o=(0,c().O7)(),{isDeepDive:i,isSidebarPosition:s}=(0,l().VK)((()=>{const e=le().Z.state;return{isDeepDive:"deep_dive"===e.surface,isSidebarPosition:"default"===e.surface&&"sidebar"===e.position}}),[]),d=(0,a.useMemo)((()=>n?(0,_().R6)(o.device.isElectronMac):void 0),[o.device.isElectronMac,n]);return(0,u().yK)((e=>{const o=s?500:400;return{searchIcon:{color:e.mediumIconColor,width:20,height:20,marginLeft:4,marginRight:4},input:{margin:"10px 10px",width:"auto",fontSize:14},container:{width:t?600:i?"100%":420,display:"flex",flexDirection:"column"},scroller:{width:"100%",minHeight:i?0:o,maxHeight:o,position:"relative",...r&&{display:"flex",justifyContent:"center",alignItems:"center"}},popup:{marginTop:s&&n?d:0}}}),[s,t,i,r,n,d])}({shouldUseCenterModal:ge,isElectron:et,shouldShowEmptyState:yt}),gt=(0,a.useMemo)((()=>{if("deep_dive"===x.surface)return null;const e={placeholder:t.formatMessage(pe?Ye.openInNewTabPlaceholder:Ye.defaultInputPlaceHolder),left:pe?(0,$().z)(vt.searchIcon):(0,W().q)(vt.searchIcon)};return(0,X.jsx)(Ie().Z,{capture:!0,debugName:"MiniSearch",children:(0,X.jsx)(Re().Z,{capture:!0,debugName:"MiniSearch",onEsc:()=>he({shouldResetQuery:!1,shouldResetMetricsState:!0}),children:(0,X.jsx)(xe().Z,{...e,value:F,focus:!0,onChange:e=>ht(e.target.value),format:xe().B.Transparent,style:vt.input,autoFocus:!0,focusInitial:!0,onSubmit:e=>{yt&&at({menuListItemAction:void 0})}})})})}),[he,at,t,pe,x.surface,F,ht,yt,vt.input,vt.searchIcon]),St=(0,l().VK)((()=>(0,X.jsxs)("div",{style:vt.container,children:[gt,(0,X.jsx)(Pe().Z,{type:oe().Z.Y,style:vt.scroller,children:yt?(0,X.jsx)(He,{}):(0,X.jsxs)(X.Fragment,{children:[(0,X.jsx)(Ce().Z,{type:Ce().i.Vertical,initialFocus:0,sections:"recents"===Y?ut:dt,disableKeyboardArrowWrap:!0,store:pt}),"recents"===Y?(0,X.jsx)(Ae().Z,{onChange:Ge}):null]})}),(0,X.jsx)(Ze,{})]})),[vt.container,vt.scroller,gt,yt,Y,ut,dt,pt,Ge]);return ge?(0,X.jsx)(Te().Z,{open:x.isOpen,onDismiss:()=>he({shouldResetQuery:!1,shouldResetMetricsState:!0}),render:()=>St,disableAnimation:!0,isWaxPaper:!0,backgroundStyle:{background:"transparent"},innerStyle:{width:"max-content",height:"max-content"},style:{display:"flex",alignItems:"center"}}):(0,X.jsx)(we().ZP,{open:x.isOpen,popupType:we().kQ.Popup,originRect:"default"===x.surface?void 0:x.domRect,sameWidthAsOrigin:"deep_dive"===x.surface,style:vt.popup,placementToOrigin:re().Placement.Bottom,alignmentToOrigin:Ve().v2.Start,keepFocus:"deep_dive"===x.surface,disableMouseCapture:"deep_dive"===x.surface,preventCaptureEsc:"deep_dive"===x.surface,render:()=>St,onDismiss:()=>he({shouldResetQuery:!1,shouldResetMetricsState:!0})})}function Oe(e){const{blockStore:t,idx:n,resultFeatureNames:r}=e;return{id:t.id,score:0,spaceId:t.getSpaceId(),sources:[S().vp.Local],featureGroups:r?[{groupName:"custom",features:r.map((e=>({name:e,value:1})))}]:[],store:t,originalPosition:n,localSource:new Set,serverEventProperties:void 0}}function Ue(e){const{spaceStore:t,similarUsers:r,isUserPresentOnPage:o}=e;if(!t)return[];return[...r].sort(((e,t)=>{const n=o({userId:e.userId,visitedAt:e.visitedAt});return n!==o({userId:t.userId,visitedAt:t.visitedAt})?n?-1:1:t.visitedAt-e.visitedAt})).slice(0,4).map((e=>{const r=n(277533).U.createChildStore(t,{table:n(989478).KJ,id:e.userId});return r.load(),{store:r,visitedAt:e.visitedAt,isPresent:o({userId:e.userId,visitedAt:e.visitedAt})}}))}const je=a.memo(a.forwardRef((function(e,t){const{store:r,focused:o,currentView:i}=e,s=(0,l().VK)((()=>(0,Me().Lk)(r)),[r]),c=(0,l().VK)((()=>(0,X.jsx)(Me().ZP,{store:r,showFullPathInTooltip:!0})),[r]),d=(0,l().VK)((()=>ie().default.state.currentSpaceStore),[]),p=(0,l().VK)((()=>r.id),[r]),m=(0,l().VK)((()=>U.state.pageIdToUsers[p]??[]),[p]),f="results"===i||s&&o,h=(0,l().VK)((()=>(0,X.jsx)(n(384241).Z,{store:r,style:{fontWeight:x().Ue.medium}})),[r]),y=(0,l().VK)((()=>r.getIcon()),[r]),v=(0,l().VK)((()=>r.isEmptyPage()),[r]),g=(0,l().VK)((()=>(0,X.jsx)(n(943620).Z,{disabled:!0,icon:y,isEmptyPage:v,size:20})),[y,v]),S=(0,l().VK)((()=>U.state.similarUserIdToLastVisitedPageId),[]),_=(0,a.useCallback)((e=>function(e){return!Y({timestamp:e.timestamp,numberOfMinutes:2})}({timestamp:e.visitedAt})&&S[e.userId]===p),[S,p]),b=(0,l().VK)((()=>Ue({spaceStore:d,similarUsers:m,isUserPresentOnPage:_})),[_,m,d]),I=(0,l().VK)((()=>b.every((e=>e.store.isReady()))),[b]),R=(0,a.useMemo)((()=>{if(!I)return null;const e=b.length;return(0,X.jsx)("div",{style:{display:"flex"},children:b.map(((t,n)=>{let{store:r,visitedAt:o,isPresent:i}=t;return(0,X.jsx)("span",{style:{zIndex:e-n},children:(0,X.jsx)(Be,{userStore:r,isPresent:i})},`search-user-presence-${r.id}-${p}-${o}`)}))})}),[I,p,b]),C=(0,u().yK)((e=>({enterIcon:{width:12,height:12,color:e.text.secondary,display:o?"block":"none"},divider:{color:e.text.secondary}})),[o]),T=(0,a.useMemo)((()=>(0,X.jsxs)(be().X2,{gap:12,alignItems:"center",children:[R,(0,X.jsx)("div",{children:(0,H().U)(C.enterIcon)})]})),[R,C.enterIcon]);return(0,X.jsx)(_e().Z,{...e,ref:t,buttonStyle:{padding:"4px 0px"},hoveredStyle:{padding:"4px 0px"},title:(0,X.jsxs)(be().X2,{gap:4,children:[h,s&&!f?(0,X.jsxs)(X.Fragment,{children:[(0,X.jsx)("span",{style:C.divider,children:"â€“"}),c]}):null]}),caption:f&&s?(0,X.jsx)(be().X2,{gap:4,children:c}):void 0,icon:g,right:T,className:"notranslate"})})));function Be(e){const{userStore:t,isPresent:r}=e,o=(0,b().YB)(),i=(0,Fe().dY)((e=>(0,n(568017).iY)(t.id,e)),r),{name:s,email:a}=(0,l().VK)((()=>({name:(0,n(499110).Nz)(o,t.getModel()),email:t.getEmail()})),[o,t]),c=(0,u().yK)((e=>({avatarOuterOutline:{...i.avatarOuterOutline,outlineColor:r?i.avatarOuterOutline.outlineColor:e.accentColors.gray[100]}})),[r,i.avatarOuterOutline]);return(0,X.jsx)(n(654133).Z,{textWrap:!0,renderTooltip:()=>(0,X.jsxs)("div",{children:[(0,X.jsx)("div",{children:s}),(0,X.jsx)("div",{children:a})]}),render:e=>(0,X.jsx)("div",{style:c.avatarOuterOutline,...e,children:(0,X.jsx)("div",{style:i.avatarBorder,children:(0,X.jsx)(n(981583).Z,{iconStyle:i.avatarInnerOutline,style:i.uiUserAvatarStyles,size:Fe().IX,isOffline:!r,userStore:t,avatarShouldShowShadow:!0,initialOverrideStyle:i.initialColor})})})})}function Ze(){const e=(0,b().YB)(),t=(0,u().yK)((e=>({container:{padding:"6px 8px",color:e.text.secondary,display:"flex",justifyContent:"flex-end",borderTop:`1px solid ${e.lightDividerColor}`,marginTop:1},button:{fontSize:13,gap:6,paddingLeft:10,color:e.text.secondary},icon:{width:12,height:12}})),[]);return(0,X.jsx)("div",{style:t.container,children:(0,X.jsx)(ke().Z,{icon:G,iconStyle:t.icon,isLightGray:!0,style:t.button,onClick:()=>window.open("https://notion.enterprise.slack.com/archives/C07CXLHAV7A","_blank"),children:e.formatMessage(Ye.giveSearchFeedback)})})}function ze(e){const{menuListProps:t,query:n}=e,{focused:r}=t,o=(0,l().VK)((()=>le().Z.state.surface),[]),i=(0,u().yK)((e=>({container:{padding:"8px 0px",borderRadius:6},title:{fontWeight:x().Ue.medium},enterIcon:{width:12,height:12,color:e.text.secondary},searchIcon:{width:20,height:20}})),[]),s=`Search for "${n}" ${"deep_dive"!==o?"in full page":""}`.trim(),c=(0,a.useMemo)((()=>{if(r)return(0,X.jsx)("div",{children:(0,H().U)(i.enterIcon)})}),[i.enterIcon,r]);return(0,X.jsx)(_e().Z,{...t,title:s,titleStyle:i.title,icon:(0,W().q)(i.searchIcon),style:i.container,right:c})}const Ye=(0,b().vU)({openInNewTabPlaceholder:{defaultMessage:"Open in new tab...",id:"MiniSearch.openInNewTab"},defaultInputPlaceHolder:{defaultMessage:"Search or ask anything",id:"MiniSearch.defaultInputPlaceHolder"},giveSearchFeedback:{defaultMessage:"Give search feedback",id:"MiniSearch.giveSearchFeedback"},fromCalendarEvents:{id:"miniSearch.fromCalendarEvents",defaultMessage:"From calendar events"},noQuickResultsFound:{id:"miniSearch.noQuickResultsFound",defaultMessage:"No quick results found"},searchMoreSources:{id:"miniSearch.searchMoreSources",defaultMessage:"Press {returnButton} to expand your search"},returnKey:{id:"miniSearch.returnKey",defaultMessage:"Return"},quickMatchesSectionTitle:{id:"miniSearch.quickMatches.sectionTitle",defaultMessage:"Quick matches"}});function He(){const e=(0,u().yK)((e=>({wrapper:{display:"grid",alignItems:"center",height:"100%",width:"100%",userSelect:"none"},container:{textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",gap:4},iconContainer:{display:"flex",gap:4,alignItems:"center",marginBottom:16},logoIcon:{width:32,height:32,padding:6},iconWrapper:{padding:2,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",marginLeft:-12,background:e.white,border:`1.5px solid ${e.lightDividerColor}`},heading:{fontSize:14,fontWeight:500,color:e.text.secondary,display:"flex",alignItems:"center",gap:8},subtext:{fontSize:14,color:e.text.secondary},returnIcon:{width:12,height:12},returnText:{display:"flex",alignItems:"center",gap:6,fontSize:12,border:`1px solid ${e.stroke.secondary}`,padding:"2px 4px",borderRadius:4,color:e.text.secondary,fontFamily:"monospace",fontWeight:400}})),[]),t=(0,X.jsxs)("span",{style:e.returnText,children:[(0,H().U)(e.returnIcon),(0,X.jsx)(b()._H,{...Ye.returnKey})]});return(0,X.jsx)("div",{style:e.wrapper,children:(0,X.jsxs)("div",{style:e.container,children:[(0,X.jsx)("div",{style:e.heading,children:(0,X.jsx)(b()._H,{...Ye.noQuickResultsFound})}),(0,X.jsx)("div",{style:e.heading,children:(0,X.jsx)(b()._H,{...Ye.searchMoreSources,values:{returnButton:t}})})]})})}const We=function(){return(0,l().VK)((()=>n(524434).KR.isQuickFindEnabled()),[])?(0,X.jsx)(Ne,{}):null}},766463:(e,t,n)=>{n.d(t,{s:()=>K});n(670560),n(122556),n(582845),n(250570),n(533019),n(721473),n(788208),n(22624),n(267602),n(916054),n(653476),n(470928),n(241792),n(228244);var r=n(667294),o=()=>n(629013),i=()=>n(219727),s=()=>n(142735),a=()=>n(511115),c=()=>n(364402),l=()=>n(565630),u=()=>n(647834),d=()=>n(752778),p=()=>n(899133),m=()=>n(513670),f=()=>n(855741),h=()=>n(696459),y=()=>n(326966),v=()=>n(824462),g=()=>n(932753),S=()=>n(594546),_=()=>n(43721),b=()=>n(15981),I=()=>n(8),x=()=>n(90065),R=()=>n(620218),C=()=>n(828946),T=()=>n(98228),k=()=>n(876822),w=()=>n(804217),M=()=>n(749826),P=()=>n(63317),A=()=>n(485014),E=()=>n(21965),V=()=>n(826955);class F extends(()=>n(263184))().default{getInitialState(){return{query:void 0,localResults:[],numTotalLocalResults:0,serverResults:[],numTotalServerResults:0,searchSessionId:(0,n(956057).Il)(),isResultsLoading:!1}}}const L=F;var q=()=>n(677559),D=()=>n(358565);function K(e){var t;const{searchQuery:n,limit:F,source:K,type:j,disable:B,overrideSpaceStore:Z,overrideSearchSessionId:z,usePrefetch:Y,isTitleOnly:H=!0}=e,W=(0,i().O7)(),$=(0,l().D9)(n),X=(0,l().D9)(e.filters),G=(0,r.useRef)(0),Q=(0,r.useRef)(!0),J=(0,s().VK)((()=>w().default.state.online),[]),ee=(0,s().VK)((()=>e.isLocalOnlyMode||!J),[J,e.isLocalOnlyMode]),te=(0,r.useMemo)((()=>new L),[]),ne=(0,s().VK)((()=>z&&z!==te.state.searchSessionId?(te.update((e=>({...e,searchSessionId:z}))),z):te.state.searchSessionId),[te,z]),{searchLocalResults:re,searchServerResults:oe,isResultsLoading:ie,numTotalLocalResults:se,numTotalServerResults:ae}=(0,s().VK)((()=>({searchLocalResults:te.state.localResults,searchServerResults:te.state.serverResults,isResultsLoading:te.state.isResultsLoading,numTotalLocalResults:te.state.numTotalLocalResults,numTotalServerResults:te.state.numTotalServerResults})),[te]),ce=(0,s().VK)((()=>{if(ee||ie&&Q.current)return re;let e=function(e){const{localResults:t,serverResults:n}=e,r=t.map((e=>e.store.id)),o=new Set(r),i=n.filter((e=>!o.has(e.store.id)));return[...t,...i]}({localResults:re,serverResults:oe});return j===p().n8.CollectionsInSpace&&(e=U(e)),e}),[ee,ie,re,oe,j]),le=(0,s().VK)((()=>Z||k().default.state.currentSpaceStore),[Z]),ue=(0,s().VK)((()=>"on"===M().default.getEligibleGroup({experimentId:"search-use-local-reranker-layered",parameter:"shouldUseLocalReranker",defaultGroup:"control"})),[]),de=(0,s().VK)((()=>ee&&J&&Boolean(Y)),[ee,J,Y]),pe=(0,s().VK)((()=>(0,I().bC)(W).hasPublicAccessPermission),[W]),me=(0,r.useMemo)((()=>{const t={navigableBlockContentOnly:H,...e.filters};return(0,p().u4)(t)}),[e.filters,H]),fe=(0,r.useMemo)((()=>{var t;return function(e){const{blockTypes:t,queryType:n}=e;switch(n){case p().n8.CollectionsInSpace:return["collection_view","collection_view_page"];case p().n8.BlocksInCollection:return["page","collection_view_page"];case p().n8.BlocksInSpace:default:return[...t??[]]}}({blockTypes:null===(t=e.filters)||void 0===t?void 0:t.blockTypes,queryType:j})}),[null===(t=e.filters)||void 0===t?void 0:t.blockTypes,j]),he=(0,r.useCallback)(((e,t)=>{const{isSuccess:n,totalResultsCount:r,localCacheMetadata:o,query:i}=t;R().default.measure(e,{environment:W,data:{start_time:e.startTime,success:n,surface:K,num_results:r,search_session_id:ne,local_cache_metadata:o,query_length:i.length}})}),[W,K,ne]),ye=(0,r.useCallback)(((e,t)=>{const{isSuccess:n,totalResultsCount:r,query:o}=t;R().default.measure(e,{environment:W,data:{start_time:e.startTime,success:n,surface:K,num_results:r,search_session_id:ne,search_session_flow_number:G.current,query_length:o.length}})}),[W,K,ne]),ve=(0,q().XJ)(C().x.searchActions),ge=(0,r.useCallback)((e=>{const t=R().default.mark("rum.local_quick_search_query"),{query:n,spaceStore:r}=e;if("resolved"!==ve.status)return;const o=j===p().n8.CollectionsInSpace;let i=[];0===n.length&&o&&(i=function(e){const{spaceStore:t,environment:n}=e,r=(0,g().lG)({currentUserId:n.currentUser.id,spaceId:t.id}).map((e=>{const n=V().NW.createChildStore(t,{table:d().vF,id:e}).getParentBlockStore();if(null==n?void 0:n.pathIsAccessibleAndAlive())return n}));return(0,m().oA)(r)}({environment:W,spaceStore:r}).map(((e,t)=>({store:e,originalPosition:t,id:e.id,score:0,spaceId:e.getSpaceId(),sources:[p().vp.Local],featureGroups:[],serverEventProperties:void 0}))));const s=A().Z.state.localSearchableBlocksCache,a=(0,_().U)({environment:W,overrideSpaceStore:r,overrideLocalSearchableBlocksCache:s}),c=(0,D().NH)({environment:W,parentStore:r,isOnline:J,requestInput:{query:{text:n,filters:{...me,blockTypes:fe},sort:{field:"relevance"}},limit:ee?F:Math.min(F,5)},localSearchCache:s,shouldUseNewRerankerDebugOverrideEnabled:ue,shouldLimitLocalResultsWhenOnline:!ee,hasPublicAccessPermission:pe}),l=de?O({query:n,serverResults:Me.current}):[],u=c&&f().x.unwrapOr(c,void 0),h=(null==u?void 0:u.results)??[],y=(null==u?void 0:u.total)??0;let v=m().mN([...i,...h,...l],(e=>e.id));v=o?U(v):v,te.update((e=>e.query!==n?e:(Ae.current=v.map((e=>e.id)),he(t,{query:n,isSuccess:Boolean(u),totalResultsCount:y,localCacheMetadata:a}),{...e,localResults:v,isResultsLoading:!ee&&e.isResultsLoading,numTotalLocalResults:y})))}),[fe,W,me,pe,ee,J,F,ve.status,te,ue,j,he,de]),Se=(0,o().y)(ge,T().E5),_e=(0,r.useCallback)((e=>{const{result:t,isMetaClick:r,context:o}=e;(0,S().j)({environment:W,event:{eventName:"select_search_item",eventProperties:{sources:t.sources,localSources:Array.from(t.localSource||new Set),searchSessionId:ne,searchSessionFlowNumber:G.current,context:o,queryStringLength:n.length,totalSearchResultCount:se+ae,numLocalResults:re.length,numTotalLocalResults:se,isMobile:W.device.isMobile,isMetaClick:r,hasFilters:Boolean(me),originalPosition:t.originalPosition,selectedItemIndex:t.originalPosition,selectedSearchResultMetadata:{blockId:t.id,blockType:t.store.getModel().type},searchSource:K,verificationState:(0,x().T7)(t.store)}}})}),[W,se,ae,re,n,ne,G,me,K]),be=$===n,Ie=m().Xy(X,e.filters),xe=Boolean($&&!n),Re=Ie&&be,Ce=!B&&le&&!Re,Te=xe||!Ie,ke=(0,r.useRef)(!1),we=(0,r.useRef)([]),Me=(0,r.useRef)([]),Pe=(0,r.useRef)([]),Ae=(0,r.useRef)([]),Ee=(0,s().VK)((()=>{if("mention_menu"!==K)return;return E().Z.getMentionedIds(W.currentUser.id)}),[W.currentUser.id,K]),Ve=(0,r.useCallback)((async e=>{const t=R().default.mark("rum.server_quick_search_query"),{query:n,spaceStore:r,size:o}=e,i=r.id;if(ee&&!de)return;const s=!Q.current&&Ie?we.current:[],a=de?O({query:n,serverResults:Me.current}):[];if(de&&(n.length<=1||a.length>=5||Pe.current.some((e=>e===n))))return;Pe.current.push(n);const l=await v().callApi({eventName:"search",environment:W,data:{type:j,query:n,spaceId:i,collectionId:(null==me?void 0:me.parentId)??"",limit:de?15:o+1,filters:me,sort:{field:"relevance"},source:K,searchSessionId:ne,searchSessionFlowNumber:G.current,recentlyMentionedPageIds:Ee,recentPagesForBoosting:(0,b().Wk)(P().Z.getWithoutSubscribing(i)),excludedBlockIds:m().jj([...s.map((e=>e.id)),...Ae.current||[],...Me.current.map((e=>e.id))]),ignoresHighlight:!0}});if(!l||"failed"===l.type)return;const d=l.data.total,p=(0,y().m8)((0,h().qP)(l.data.trackEventProperties).map((e=>{let[t,n]=e;return[`server-${t}`,n]}))),f=l.data.results.slice(0,o).map(((e,t)=>{const n=V().G.createChildStore(r,{id:e.id,spaceId:e.spaceId,table:"block"}),o=de?function(e){const{result:t,store:n,environment:r}=e;if(t.terms)return t.terms;const o=n.getModel();if(!o)return[];const i=r.defaultRecordCache.inMemoryRecordCache.makeGetRecordValueFn(r.currentUser.id),s=(0,u().$B)((0,c().ut)({blockValue:o,getRecordValue:i}).text);if(!s)return[];return N(s)}({environment:W,store:n,result:e}):e.terms;return{store:n,originalPosition:t,...e,serverEventProperties:p,terms:o}}));ke.current=!(d<=o);const g=[...s,...f];we.current=g,Me.current=m().mN([...de?f:[],...Me.current],(e=>e.id)),de||(te.update((e=>e.query!==n?e:(ye(t,{query:n,isSuccess:"success"===l.type,totalResultsCount:d}),{...e,serverResults:g,isResultsLoading:!1,numTotalServerResults:d}))),G.current+=1)}),[ee,Ie,W,j,me,K,ne,Ee,Ae,te,ye,de]),Fe=(0,r.useCallback)((e=>{!B&&le&&ke.current&&!ie&&J&&(te.update((e=>({...e,isResultsLoading:!0}))),ke.current=!1,Q.current=!1,Ve({query:n,spaceStore:le,size:e??20}))}),[le,B,Ve,J,ie,n,te]),Le=(0,a().z)(Fe,T().rE),qe=(0,o().y)(Ve,de?0:T().rE);return(0,r.useEffect)((()=>{if(Te){const e=te.getInitialState();te.update((t=>({...e,searchSessionId:t.searchSessionId}))),Me.current=[],Pe.current=[]}Ce&&(Q.current=!0,te.update((e=>({...e,isResultsLoading:!0,query:n}))),Se({query:n,spaceStore:le}),qe({query:n,spaceStore:le,size:F}))}),[le,Se,qe,F,n,Ce,te,Te]),{results:ce,isResultsLoading:ie,searchSessionId:ne,fetchAdditionalServerResultsOnChange:!B&&!ee&&ke.current&&Re?Le:void 0,searchSessionFlowNumber:G.current,hasMoreResults:ke.current,searchAnalytics:{trackSelectSearchItem:_e}}}function N(e){return e.normalize().toLocaleLowerCase().split(/\s/gu)}function O(e){const{query:t,serverResults:n}=e;if(!t)return[];const r=N(t),o=r.pop();return o?n.filter((e=>{const t=e.terms??[],n=t.find((e=>e.startsWith(o))),i=r.every((e=>t.some((t=>t===e))));return n&&i})):[]}function U(e){const t=new Set;return e.filter((e=>{const n=e.store.getCollectionViewSourceCollectionStore();return!(!n||t.has(n.id))&&(t.add(n.id),!0)}))}},848854:(e,t,n)=>{n.d(t,{v:()=>r().v});var r=()=>n(545914)},994875:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});class r extends(()=>n(263184))().default{getInitialState(){return{discussionIdToExpansionStartPointMap:{}}}}const o=new r},877727:(e,t,n)=>{n.d(t,{C3:()=>a,D:()=>c,QZ:()=>s,fo:()=>i});var r=()=>n(146947),o=()=>n(749826);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o().default.checkGate({gateName:"packaging_m2_additional_entrypoints"})&&s(e,t)}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!e.device.isPhone&&a(t)}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o().default.checkGate({gateName:"workflow_templates_prototype",...e})||"control"!==c(e)}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r().locale.startsWith("en-")||o().default.checkGate({gateName:"packaging_m2_localize_templates"})?o().default.getEligibleGroup({experimentId:"packaging_m2_entry_point",defaultGroup:"control",...e}):"control"}},999582:(e,t,n)=>{n.d(t,{Z:()=>i});class r extends(()=>n(263184))().default{getInitialState(){return{}}}const o=new r;n(947115).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",o);const i=o},29488:(e,t,n)=>{function r(e){return`${e.table}:${e.id}`}n.d(t,{O:()=>r})},912203:(e,t,n)=>{n.d(t,{$M:()=>y,GQ:()=>I,Jy:()=>C,LF:()=>R,NO:()=>m,Of:()=>T,SF:()=>d,TX:()=>b,XO:()=>v,Y_:()=>u,Ym:()=>h,bD:()=>S,cO:()=>p,fo:()=>x,rR:()=>f});n(267602),n(653476),n(228244);var r=()=>n(513670),o=()=>n(696459),i=()=>n(226413),s=()=>n(109477),a=()=>n(455222),c=()=>n(305580);(0,o().AO)((e=>(0,o().$K)(e)&&(0,o().$K)(e.target)&&(0,o().$K)(e.external_bot_id)?{true:{external_bot_id:e.external_bot_id,target:e.target}}:{false:e}));const l={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1},u={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function d(e){return Boolean(l[e.type]&&!(0,i().NK)(e)&&(!(0,i().qQ)(e)||void 0===(0,i().q3)(e)))}function p(e){const{collectionFormat:t,collectionSchema:n,filter:a,sort:l,sourcePropertyIds:u}=e,p=(u??(0,o().Yd)(n)).filter(((t,r,o)=>{const s=n[t];return!(!s||!d(s))&&(("relation"!==s.type||!e.restrictCrossSpace||!(0,i().Qh)(e.spaceId,s))&&(!a||a([t,s],r,n)))}));if(0===p.length)return[];if(!t||!1===l)return p;const m=(0,c().i)(t,n,void 0,s().j5.Page).collection_page_properties||[];return r().MR(p,(e=>m.findIndex((t=>t.property===e))))}function m(e){const{collectionFormat:t,collectionSchema:n,sort:a}=e,l=(0,o().Yd)(n).filter(((e,t,r)=>{const o=n[e];return!(!o||!(0,i().U8)(o))}));if(0===l.length)return[];if(!t||!1===a)return l;const u=(0,c().i)(t,n,void 0,s().j5.Page).collection_page_properties||[];return r().MR(l,(e=>u.findIndex((t=>t.property===e))))}function f(e){return e.type===a().$E.InvalidCharacter?{type:e.type,character:e.character}:e.type===a().$E.TokenExpected?{type:e.type,token:e.token}:e.type===a().FY.MissingSchemaPropertyOnThisRow||e.type===a().FY.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===a().FY.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection}:e.type===a().FY.MissingContextVariable?{type:e.type,valueId:e.valueId}:e.type===a().FY.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments}:e.type===a().FY.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex}:e.type===a().FY.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex}:e.type===a().FY.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer}:e.type===a().FY.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer}:e.type===a().FY.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection}:e.type===a().FY.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===a().FY.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType}:e.type===a().FY.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes}:e.type===a().FY.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name}:{type:e.type}}const h={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1};function y(e){return Boolean(h[e.type])}function v(e){const{collectionFormat:t,collectionSchema:n,filter:a,sort:l}=e,u=(0,o().Yd)(n).filter(((e,t,r)=>{var o;const s=n[e];return!(!s||!h[s.type])&&((!(0,i().qQ)(s)||null===(o=(0,i().q3)(s))||void 0===o||!o.auto_update_on_edit)&&(!a||a([e,s],t,n)))}));if(0===u.length)return[];if(!t||!1===l)return u;const d=(0,c().i)(t,n,void 0,s().j5.Page).collection_page_properties||[];return r().MR(u,(e=>d.findIndex((t=>t.property===e))))}const g={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1};function S(e){return g[e.type]}const _={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1};function b(e){return _[e.type]}function I(e){return 0===e}function x(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function R(e){const{property:t,collectionSchema:n}=e;return!!n&&!n[t]}function C(e){const{collectionSchema:t,property:n,type:r}=e,o=null==t?void 0:t[n];return!o||("action"===r?!d(o):!h[o.type])}function T(e){let{automationTrigger:t,collectionSchema:n}=e;if("event"===(null==t?void 0:t.type)||"notification_event"===(null==t?void 0:t.type)){const{pagesAdded:e,pagePropertiesEdited:r,source:i}=t.event;if(void 0===i)return!1;const s="some"===r.type&&r.some,a="all"===r.type&&r.all;if((s||a||[]).some((e=>R({collectionSchema:n,property:e.property})||C({collectionSchema:n,property:e.property,type:"trigger"}))))return!1;const c="some"===r.type&&(!(0,o().$K)(r.some)||0===r.some.length),l="all"===r.type&&(!(0,o().$K)(r.all)||0===r.all.length);if(!e&&("none"===r.type||c||l))return!1}else{if("recurrence"!==(null==t?void 0:t.type))return!1;if(!t.recurrence)return!1}return!0}},157955:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>M,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>I,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>b,MAX_RECURRENCE_INTERVAL:()=>y,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>v,RRULE_WEEKDAYS_MAP:()=>h,convertFromUnpersistedRecurrenceConfig:()=>E,convertToUnpersistedRecurrenceConfig:()=>P,getFormattedEndCondition:()=>w,getFormattedNextRecurrenceTime:()=>k,getNextDateUtc:()=>T,getRecurrenceAfter:()=>R,isRunningBetweenMidnightAnd3AM:()=>C,isValidRecurrenceInterval:()=>g,isValidRecurrenceNumberOfRuns:()=>S,rruleFromRecurrence:()=>_,templateAncestorsViolateRecurrenceNesting:()=>x});n(267602),n(653476),n(241792);var r=()=>n(730120);n(670560);function o(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(0===n.length)return e.map((e=>[e]));const i=[];for(const s of e)i.push(...o(n[0],...n.slice(1)).map((e=>[s,...e])));return i}var i=()=>n(696459),s=()=>n(326966),a=()=>n(803021),c=()=>n(646574),l=()=>n(998411),u=()=>n(578292);class d extends(()=>n(484885))().Ci{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var p=()=>n(494616);const m=(0,n(788860).vU)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),f={day:d.DAILY,week:d.WEEKLY,month:d.MONTHLY,year:d.YEARLY},h={MO:d.MO,TU:d.TU,WE:d.WE,TH:d.TH,FR:d.FR,SA:d.SA,SU:d.SU},y=99,v=999;function g(e){return(0,s().hj)(e)&&Number.isInteger(e)&&e>0&&e<=y}function S(e){return(0,s().hj)(e)&&Number.isInteger(e)&&e>0&&e<=v}function _(e){const{start_date:t,frequency:n,interval:r,weekdays:s,timezone:c,hour:l,minute:u}=e,p="week"===n&&s?s.map((e=>h[e])):void 0,m={};return(0,i().$K)(e.end_condition)&&("date"===e.end_condition.type?m.until=(0,a().pd)(e.end_condition.end_at):"number"===e.end_condition.type?m.count=e.end_condition.number_of_occurrences:(0,i().t1)(e.end_condition)),"month"===e.frequency&&(0,i().$K)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?m.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?m.byweekday=o(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return h[t].nth(n)})):(0,i().t1)(e.monthly_restriction)),new d({freq:f[n],dtstart:(0,a().pd)(t),interval:r,byweekday:p,tzid:c,byhour:l??0,byminute:u??0,bysecond:0,...m})}const b=1,I=1;function x(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),r=e.length,o=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=r>b,s=n.length>=I;return{violatesConstraint:i||s,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:s,nestedDepthOfAutomationAncestors:r,immediateAncestorRecurrenceType:o}}function R(e){const{recurrence:t,afterDate:n}=e;if((0,p().nA)(t)){const e=(0,a().kq)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=_(t).after((0,a().pd)(n));if(!e)return;return(0,a().YL)(e)}}function C(e){return 0===e.hour||1===e.hour||2===e.hour}function T(e){return _(e).after((0,a().pd)((0,a().Jh)()))||void 0}function k(e){const{recurrence:t,intl:n}=e,o=T(E(t));if(!o)return;const i=C(t),s=r().ou.fromJSDate(o).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().E2)(n)).setZone(t.timezone),a=(0,c().p6)({date:s,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(i)return n.formatMessage(m.dateBetweenMidnightAnd3AM,{date:a});{let e=s.toLocaleString(r().ou.TIME_SIMPLE);return t.timezone!==(0,l().r)()&&(e+=` ${s.toFormat("ZZZZ")}`),n.formatMessage(m.dateAtTime,{date:a,time:e})}}function w(e,t){return(0,i().$K)(e)?"number"===e.type?t.formatMessage(m.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,c().p6)({date:r().ou.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,i().t1)(e):t.formatMessage(m.noEndCondition)}const M=100;function P(e){return{...e,start_date:(0,a().kq)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,a().kq)(e.end_condition.end_at)}:(0,i().t1)(e.end_condition):void 0}}function A(e,t){const n=r().ou.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,a().Jh)(n.toJSDate())}}function E(e){return{...e,start_date:(0,a().Jh)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?A(e,e.end_condition):(0,i().t1)(e.end_condition):void 0}}}}]);