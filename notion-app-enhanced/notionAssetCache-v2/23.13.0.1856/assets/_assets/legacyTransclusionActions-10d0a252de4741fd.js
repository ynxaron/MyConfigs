"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[89793],{659134:(e,t,r)=>{r.r(t),r.d(t,{fixLegacyTransclusion:()=>T,maybeAutofixLegacyTransclusionProperty:()=>C});r(670560),r(122556),r(582845),r(250570),r(533019),r(721473),r(788208),r(22624);var o=()=>r(799891),n=()=>r(396136),a=()=>r(81954),i=()=>r(792409),c=()=>r(205228),s=()=>r(872308),l=()=>r(487270),u=()=>r(123927),p=()=>r(852465),d=()=>r(148882),g=()=>r(826955),m=()=>r(540520),y=()=>r(282662),b=()=>r(453999),f=()=>r(879952),S=()=>r(269299);const h=new Set(["text","table_row","header","sub_header","sub_sub_header","to_do","bulleted_list","numbered_list","toggle"]);function C(e){const{parentStore:t,transaction:r,store:a,environment:c}=e,p=a.path[1];if(2!==a.path.length||"properties"!==a.path[0]||"string"!=typeof p)return;const b=a.getRecordStoreAtRootPath();if(!(b instanceof g().G))return;const f=b.getType();if(!f||!h.has(f))return;const S=function(e){var t;const{environment:r,store:o,parentStore:a,transaction:i}=e;if(o.getSpaceId()!==a.getSpaceId())return;const c=null===(t=a.getModel())||void 0===t?void 0:t.getContentIds();if(null==c||!c.includes(o.id))return;if(d().transactionQueue.isPendingTransactionForRecord(a.pointer)||d().transactionQueue.isPendingTransactionForRecord(o.pointer))return;const p=(0,u().hC)(),g=s().loadLocalSubtree(r,{blockId:o.id,inMemoryRecordCache:o.inMemoryRecordCache,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,includeLegacyTransclusionBlockValues:p}).recordMap;if(!g)return;const m=s().localDuplicate({environment:r,sourceBlockId:o.id,targetBlockPointer:(0,l().Ii)({environment:r,table:n().iU,spaceId:o.pointer.spaceId}),sourceBlockSubtree:g,targetInMemoryRecordCache:o.inMemoryRecordCache,deepCopyTransclusionContainers:!1,resolveTemplateVariables:!1,transaction:i,preventLegacyTransclusions:p});return y().rS({parentStore:a.getContentStore(),oldChildStore:o,newChildStore:m.targetBlockStore,transaction:i}),m.targetBlockStore}({environment:c,store:b,parentStore:t,transaction:r});if(!S)return;const C=S.getPropertyStore(p);if(C)return r.postSubmitCallbacks.push((e=>{e&&o().log({from:"legacyTransclusionActions",level:"error",type:"maybeAutofixLegacyTransclusionProperty",error:{miscErrorString:(0,i().LK)(e)}}),m().Gb(c,{block_type:f,successful:!e})})),C;o().log({from:"legacyTransclusionActions",level:"error",type:"maybeAutofixLegacyTransclusionProperty",error:{message:"copied transclusion block does not have expected property"}})}function T(e){const{environment:t,store:r}=e,o=r.getRecordStoreUIParent();o&&(0,p().dz)(o)&&S().createAndCommit({userAction:"legacyTransclusionActions.fixLegacyTransclusion",environment:t,canUndo:!0,perform:e=>{const[n]=s().duplicateBlock({environment:t,stores:[r],addCopyName:!1,transaction:e,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!1,targetSpaceId:(0,a().J)(r.pointer.spaceId),baseUrl:c().default.domainBaseUrl,publicDomainName:c().default.publicDomainName,preferDuplicateLocation:"local"}),i=n[0],{childStore:l}=y().BE({parentStore:o,insertStore:i,afterStore:r,transaction:e});b().Od({store:r,transaction:e}),f().Z5({environment:t,stores:[l]})}})}}}]);